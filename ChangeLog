2017-06-06 17:28:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c0c463e)

    Released v2.2.30.2.


M	NEWS
M	configure.ac

2017-06-05 19:05:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (112db5a)

    push-notification: Fix crash in OX driver's deinit

    The http_client doesn't always exist.

M	src/plugins/push-notification/push-notification-driver-ox.c

2017-06-05 12:14:57 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (a5704dd)

    auth: Access always first entry when flushing failures

    The code is deleting the first item after accessing it, and then moving
    forward. It will eventually go beyond the array and get NULL ptr and fail.

    Instead we need to always get the first item, since the array deletion is
    moving the queued items forward.

    Broken by e18b4e41

M	src/auth/auth-request-handler.c

2017-05-31 16:15:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (eebd877)

    Released v2.2.30.1.


M	NEWS
M	configure.ac

2017-05-31 10:09:41 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8b46897)

    auth: Fix vpopmail for 2.2


M	src/auth/userdb-vpopmail.c

2017-05-31 13:03:47 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (67c02e0)

    quota: Update version number for script client


M	src/plugins/quota/quota.c

2017-05-30 14:03:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (281eeeb)

    mail-filter: tabescape args, this is required by script client 4


M	src/plugins/mail-filter/istream-ext-filter.c
M	src/plugins/mail-filter/ostream-ext-filter.c

2017-05-30 14:01:39 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (626d661)

    welcome: tabescape args, this is required by script client 4


M	src/plugins/welcome/welcome-plugin.c

2017-05-30 14:01:17 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (2518005)

    global: Update script client version number

    Broken by b383ed51d75bce0f69f126bc4ff7192985ca30f2

M	src/plugins/fts/fts-parser-script.c
M	src/plugins/mail-filter/istream-ext-filter.c
M	src/plugins/mail-filter/ostream-ext-filter.c
M	src/plugins/welcome/welcome-plugin.c

2017-05-30 21:12:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8acbc67)

    Released v2.2.30.


M	NEWS
M	configure.ac

2017-05-30 10:01:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (364b29e)

    lib-storage: Fix compiler warning in test-mail-storage


M	src/lib-storage/test-mail-storage.c

2017-05-30 11:30:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7b98e00)

    auth: Fix crash on passdb lookup when all passdbs were skipped

    Finishes the fix in 614f5b6febaf3c825f9200ab3b62d9d047197b0e

    Fixes: auth: Panic: file auth-request.c: line 2493 (get_log_prefix):
    assertion failed: (auth_request->mech != NULL)

M	src/auth/auth-request.c

2017-05-24 23:49:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1fb2191)

    lib-storage: Fix crash in test-mail-storage


M	src/lib-storage/test-mail-storage.c

2017-05-15 15:35:37 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (dc743c1)

    mail-crypt-plugin: Set copy-hook only if save_version > 0

    Otherwise we might use it in read-only mode, too.

M	src/plugins/mail-crypt/mail-crypt-plugin.c

2017-05-04 09:14:17 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c32180e)

    mail-crypt: Re-encrypt mails when copying/moving

    Otherwise the mail cannot be opened after moving

M	src/plugins/mail-crypt/mail-crypt-plugin.c

2017-05-24 22:31:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (057700f)

    lib-storage: Fix memory leak in test-mail-storage


M	src/lib-storage/test-mail-storage.c

2017-05-24 21:56:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d68e9de)

    lib-storage: Add unit test for set/get/push/pop storage error operations


M	src/lib-storage/Makefile.am
A	src/lib-storage/test-mail-storage.c

2017-05-24 21:29:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ee6ee3e)

    lib-storage: Fix mail_storage_set_critical() when input parameter is an old
    internal error

    This could have caused garbage in the error string.

M	src/lib-storage/mail-storage.c

2017-05-24 19:16:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (88e088d)

    lib-storage: Fix mail_storage_last_error_push/pop() to work with internal
    errors


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2017-05-22 17:56:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5c9dced)

    imap: Fix unhibernation after earlier change


M	src/imap/imap-master-client.c

2017-05-17 19:02:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6c4273f)

    imap NOTIFY: Flush any pending notifications on NOOP

    This is mainly to allow testing NOTIFY easily with imaptest scripts. This is
    cheap anyway, because mailbox_list_notify_flush() doesn't do any syscalls
    when there's no work.

M	src/imap/cmd-noop.c
M	src/imap/imap-notify.c
M	src/imap/imap-notify.h

2017-05-17 19:01:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3ee1976)

    lib-storage: Implement mailbox_list_notify_flush()

    This flushes any pending notifications. For now it only checks if there's a
    pending notification waiting for a timeout. It could also stat() the files
    to make sure, but that's probably unnecessary.

M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/mailbox-list-notify.c
M	src/lib-storage/mailbox-list-notify.h
M	src/lib-storage/mailbox-list-private.h

2017-05-17 18:13:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5a4921a)

    lib-storage: Explicitly name function pointers in mailbox lists

    This allows adding more fields to struct mailbox_list_vfuncs without 
    compiler warnings.

M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c

2017-05-17 17:49:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d45052a)

    lib-storage: Always update highestmodseq in mailbox list index

    This is required for mailbox-list-notify API to work correctly. For example
    IMAP NOTIFY session with CONDSTORE enabled could be listening for 
    FlagChanges, but another session without CONDSTORE enabled could be updating 
    flags in a mailbox that has never been opened with CONDSTORE enabled. NOTIFY
    wouldn't see this change, unless it was always written to 
    dovecot.list.index.

M	src/lib-storage/list/mailbox-list-index-status.c

2017-05-17 17:14:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f7e77fb)

    lib-storage: Fix mailbox list index notifications when modseqs aren't
    enabled.

    No notifications were sent if highest_modseqs weren't updated in mailbox 
    list index.

M	src/lib-storage/list/mailbox-list-index-notify.c

2017-05-17 11:40:53 +0300 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (8f195c1)

    imap: login reply should be sent sooner


M	src/imap/main.c

2017-04-04 00:32:07 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (f9b93cc)

    lib-http: client: Fixed race condition between DNS refresh lookup and a soft
    connection timeout.

    The refreshing DNS lookup cleared all the IPs, but the soft connection
    timeout (and maybe other code) still relied on them. Adding tests everywhere
    for host->ips_count == 0 is annoying, so I changed the DNS lookup code such
    that the stale IPs remain present while the DNS lookup is being performed. 
    The pending lookup prevents new connections through
    http_client_host_refresh(), so this will not create potentially useless
    connections.

M	src/lib-http/http-client-host.c

2017-05-24 17:19:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (120b88f)

    lib-master: Replace listeners with /dev/null in SIGQUIT instead of closing

    This should be somewhat safer.

M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c

2017-05-22 10:13:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9b58d1b)

    lib-index: Fix crash in mail_transaction_log_view_set_all() error handling


M	src/lib-index/mail-transaction-log-view.c

2017-05-22 10:11:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bb61249)

    lib-index: Fix start_offset > sync_offset error handling for in-memory
    indexes


M	src/lib-index/mail-transaction-log-file.c

2017-05-24 17:52:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d4620b9)

    Released v2.2.30.rc1.


M	NEWS
M	configure.ac

2017-05-19 10:45:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4ac0050)

    auth: Fix linking duplicate .a libraries to unit test


M	src/auth/Makefile.am

2017-05-08 12:49:39 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (231278a)

    util: script: Increased the major protocol version due to earlier changes.


M	src/lib-program-client/program-client-remote.c
M	src/util/script.c

2017-05-09 13:33:23 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (262a9b6)

    util: script: Amended protocol with the ability to convey a set of
    environment variables that are passed to the script.

    The acceptable environment variables are selected using the -e parameter;
    others are ignored silently.

M	src/lib-program-client/program-client-remote.c
M	src/util/script.c

2017-05-08 12:48:08 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (2dcb39c)

    util: script: Amended the protocol to pass arguments escaped to prevent
    problems with newlines.

    Newlines are used as argument delimiters in the protocol, which will cause
    problems.

M	src/lib-program-client/program-client-remote.c
M	src/util/script.c

2017-05-09 13:43:39 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (b493240)

    lib-program-client: local: Fixed use of unterminated string array of
    environment variables in exec_child().


M	src/lib-program-client/program-client-local.c

2017-05-09 14:22:06 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (61d198b)

    lib-program-client: Made the test suite ignore the protocol version.


M	src/lib-program-client/test-program-client-remote.c

2016-10-20 15:41:54 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (a6d2ab1)

    lib-program-client: Gave variables pointing to a program-client more logical
    names.

    Was still based on when it was called the script-client.

M	src/lib-program-client/program-client-local.c
M	src/lib-program-client/program-client-remote.c

2017-05-19 17:44:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f193b50)

    imap: Move struct client_sync_context to imap-sync-private.h and add imap_
    prefix


M	src/imap/imap-client.h
M	src/imap/imap-sync-private.h
M	src/imap/imap-sync.c

2017-05-19 16:34:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (41e71d7)

    imap: Allow plugins to replace existing FETCH handlers

    They can use imap_fetch_handler_lookup() to get the old init() function. 
    Then they can imap_fetch_handler_unregister() the existing handler and 
    register a new handler, which can do its own work and call the old init() if
    needed.

M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2017-05-17 16:47:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (55206cb)

    lib-index: Improve "start_offset > current sync_offset" error message.

    Try to make it clear what is the root cause of it.

M	src/lib-index/mail-transaction-log-file.c

2017-05-17 16:28:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b2b4825)

    lib-index: mail_transaction_log_file_get_highest_modseq_at() - return error
    string

    This can help figuring out why some error happened when more context is 
    provided in the caller's error messages.

M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/test-mail-transaction-log-view.c

2017-05-17 16:21:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c95d24a)

    lib-index: Add missing error logging for mail_index_view_sync_begin()


M	src/lib-index/mail-index-view-sync.c

2017-05-17 13:33:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0e0d686)

    lib-index: mail_transaction_log_file_map() - return reason/error string

    This can help figuring out why some error happened when more context is 
    provided in the caller's error messages.

M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/test-mail-transaction-log-view.c

2017-05-17 13:31:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f71db30)

    lib-index: mail_transaction_log_view_set_all() - don't entirely ignore
    corrupted logs

    Ignore them only if it's followed by an index reset.

M	src/lib-index/mail-transaction-log-view.c

2017-05-18 23:13:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (65e20e8)

    lib-storage: Fix mailbox list index records without guid having invalid
    flags

    With LAYOUT=index the mailbox is found with its GUID. If it doesn't exist, 
    the mailbox has to be either \NonExistent or \NoSelect. It probably doesn't 
    make much difference which one, so we'll fix them by adding \NoSelect.

    With other layouts the GUID is allowed to be empty, because it can be looked 
    up from the actual mailbox.

M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2017-05-18 23:06:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0ab7379)

    lib-storage: Fix mailbox list index records with name_id=0

    name_id=0 isn't valid, so it needs to be changed and writen to the disk. The
    write-to-disk part wasn't working.

M	src/lib-storage/list/mailbox-list-index.c

2017-05-19 09:45:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (90caca5)

    lib: Fix memory leak in test-istream-concat


M	src/lib/test-istream-concat.c

2017-05-18 22:18:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8b4a5a2)

    lib: Fix crash when seeking istream-concat to EOF and trying to read it


M	src/lib/istream-concat.c
M	src/lib/test-istream-concat.c

2017-05-18 21:10:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c8be24b)

    imapc: Make sure a valid UIDVALIDITY is returned by SELECT

    Fixes errors such as: Error: Synchronization corrupted index header
    (in-memory index): uidvalidity=0, but next_uid=9

M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c

2017-05-18 21:08:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d13fe79)

    imapc: Fix assert-crash if server doesn't send EXISTS reply to SELECT

    Fixes: Panic: file imapc-sync.c: line 477 (imapc_sync_index): assertion
    failed: (mbox->sync_fetch_first_uid == 1)

M	src/lib-storage/index/imapc/imapc-storage.c

2017-05-18 20:18:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dacfe2a)

    lib-imap-client: Change server IP only on connect() failures

    Also log an warning-level message about it. This is mainly useful to see 
    that a slow connection could be caused by a connect() timeout. Since more 
    IPs are still available, it's not yet an error.

M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2017-05-18 19:42:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ec7aec9)

    imapc: Fix infinite reconnection when server keeps sending corrupted state

    When corrupted state was found, imapc_client_mailbox_reconnect() is called 
    to reconnect. This call skipped the normal "is it safe to reconnect?" checks
    causing potentially infinite reconnections.

M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c

2017-05-18 19:40:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5e1694a)

    lib-imap: imap_parser_unref() should always set parser=NULL

    Not just when the last reference is cleared. This is how *_unref()s should 
    work everywhere in Dovecot. This fixes a bug in lib-imap-client where a 
    parser could have been accessed after it was already freed.

M	src/lib-imap/imap-parser.c

2017-05-18 18:09:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cd56eb0)

    imapc: Avoid resending duplicate FETCH when reconnecting during the initial
    sync


M	src/lib-storage/index/imapc/imapc-sync.c

2017-05-18 18:01:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (890b2c9)

    imapc: If initial SELECT fails, don't resend it twice on reconnect.


M	src/lib-storage/index/imapc/imapc-storage.c

2017-05-18 17:36:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7eb0f6c)

    lib-imap-client: Avoid infinite reconnection loops when retrying command
    fails

    reconnect_command_count wasn't calculated correctly, because the SELECT and 
    potentially other following sync commands weren't included in it.

M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c

2017-05-18 12:32:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5fbdfc5)

    lib: Add dovecot_build_info variable containing Dovecot build information.

    By default this includes the version, including the git hash. The idea is 
    that this version information would be available in all the core dumps.

    The DOVECOT_BUILD_INFO can be overridden by compiling with:

    DOVECOT_BUILD_INFO='"build info"' make

M	src/lib/lib.c
M	update-version.sh

2017-05-16 17:53:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (88bb978)

    auth: If passdb/userdb ldap has blocking=yes, auth master shouldn't connect
    to ldap


M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2017-05-18 11:57:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0776684)

    director: Add old host's up/down and vhost count parameters to
    director_flush_socket

    The "down" status allows the script to determine whether it should try to 
    perform any work on the old host. The vhost count may be unnecessary, but 
    might be useful for some purpose.

M	src/director/director.c
M	src/director/director.h

2017-04-30 12:31:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0da3e95)

    dsync: Try to commit transactions every dsync_commit_msgs_interval messages

    This was first attempted to be implemented by 
    ec0cc8fa647794e44a1afaa448f495a713048dc4, but it was later partially 
    reverted by 5973d496b16721af6d2c1fa90b016aacddf13554. This current commit
    should fix its problems.

M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2017-05-12 12:44:27 +0300 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (00bc301)

    lib-storage: add a mail user pre-deinit vfunc

    This allows plugins to perform checks right before the deinit call.

M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2017-05-04 19:59:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ab396a8)

    imapc: Try to merge STOREs together as much as possible when syncing


M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/imapc/imapc-sync.h

2017-05-05 15:20:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d9d4a24)

    lib-storage: Avoid unnecessary UIDNEXT lookups after saving a mail

    The vsize checking code was expecting that this would always be a cheap 
    operation, but with imapc code it could trigger a remote STATUS (UIDNEXT) 
    call. Do this only when we've checked that this mailbox is updating vsize 
    header at all.

M	src/lib-storage/index/index-mailbox-size.c

2017-05-12 15:42:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c7a5b3b)

    imapc-quota: Avoid sending unnecessarily many GETQUOTA[ROOT] commands

    The last_refresh == ioloop_timeval check didn't work, because the refresh 
    itself updated ioloop_timeval. This caused a single quota lookup to issue 
    multiple GETQUOTA[ROOT] commands to imapc.

M	src/plugins/quota/quota-imapc.c

2017-05-10 12:44:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (be741f4)

    doveadm mailbox status: Add "firstsaved" field.


M	doc/man/doveadm-mailbox.1.in
M	src/doveadm/doveadm-mail-mailbox-status.c

2017-05-09 14:29:04 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (962cc84)

    lib-index: Add mail_cache_expunge_count

    It can be called to correctly handle cache counters when records are
    removed.

M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-sync-update.c

2017-05-02 12:18:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ed2df35)

    lib-imap: imap_append_string_for_humans() - Change CR/LF to space

    Practically this shouldn't matter, because in email headers a CR/LF is 
    always followed by a space/tab. But maybe this can be used for some other
    purposes in future, and it makes the unit tests clearer. :)

M	src/lib-imap/imap-quote.c
M	src/lib-imap/test-imap-quote.c

2017-05-12 11:13:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5d23124)

    lib-storage: Add missing ATTR_FORMAT to mail_set_mail_cache_corrupted()


M	src/lib-storage/mail-storage-private.h

2017-05-09 14:01:07 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (be2c388)

    lib-storage: Use new mail_cache_set_seq_corrupted_reason


M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2017-05-09 14:00:38 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (12fef03)

    lib-index: Add mail_cache_set_seq_corrupted_reason

    Marks a seq in cache corrupted, and removes that instead of the whole cache.

M	src/lib-index/mail-cache.c
M	src/lib-index/mail-cache.h

2017-05-12 13:35:06 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b9d46a5)

    lib-storage: Remove index_storage_save_continue

    It was not intended for v2.2

M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h

2017-05-12 07:47:56 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (7b6002e)

    lib-storage: Unconstify test functions

    Removes a compiler warning

M	src/lib-storage/test-mail-search-args-simplify.c

2017-05-12 07:41:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (cacb6b1)

    lib: Use t_malloc instead of t_malloc_no0

    Broken in 4792d4bd

M	src/lib/strfuncs.c

2017-05-02 15:38:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4792d4b)

    lib: Add dec2str_buf()

    Conflicts:
    src/lib/strfuncs.c

M	src/lib/strfuncs.c
M	src/lib/strfuncs.h

2017-05-02 18:40:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ca96439)

    master: Send SIGQUIT to processes running at deinit to close socket
    listeners.

    This allows Dovecot to be restarted even when some lmtp/doveadm process is 
    running for a long time. Otherwise it would keep the inet_listener socket 
    open and prevent the new Dovecot from binding to the port.

M	src/master/service-monitor.c

2017-05-02 16:13:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (64f36ab)

    lib-master: When running under master, close listeners immediately on
    SIGQUIT


M	src/lib-master/master-service.c

2017-05-02 18:39:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (aceadf8)

    lib-master: Remove listener's IO earlier if possible

    This is needed for the next change to work properly.

M	src/lib-master/master-service.c

2017-05-02 15:56:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (253e069)

    master: Wait more precisely 5 secs at deinit for child processes to die.

    Use milliseconds granularity instead of seconds.

M	src/master/service-monitor.c

2017-05-02 15:41:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e1c225a)

    lib: Use lib_signals_syscall_error() for write() failure in signal handler


M	src/lib/lib-signals.c

2017-05-02 15:41:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c0a5fa2)

    lib: Add lib_signals_syscall_error()


M	src/lib/lib-signals.c
M	src/lib/lib-signals.h

2017-05-09 13:15:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (983dd2b)

    man: Fix doveadm-flags examples

    Patch by Frank Ebert

M	doc/man/doveadm-flags.1.in

2017-05-09 12:25:49 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e567897)

    auth: Do not use AUTH_SUBSYS_MECH in logging when request->mech is NULL

    This can happen when a lookup is done instead of authentication.

    Fixes auth: Panic: file auth-request.c: line 2560 (get_log_prefix):
    assertion failed: (auth_request->mech != NULL)

M	src/auth/auth-request.c

2017-05-08 12:24:52 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (395b6f6)

    passdb-imap: Make sure ssl verification is possible with current settings


M	src/auth/passdb-imap.c

2017-05-08 12:24:21 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (f1cd65e)

    passdb-imap: Add ssl_ca_file setting

    Allow setting SSL trust roots from a file

M	src/auth/passdb-imap.c

2017-04-28 20:28:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (a92ae4a)

    passdb-imap: Add option to control certificate verification

    Turn it on by default

M	src/auth/passdb-imap.c

2017-05-08 13:35:35 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (66adc48)

    lib-ssl-iostream: Support IP address SANs


M	src/lib-ssl-iostream/iostream-openssl-common.c

2017-05-05 12:35:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1724615)

    imap: Set FETCH transactions hidden only when \Seen flags are implicitly set

    This simplifies implementing some plugins and has no downsides to core 
    functionality.

M	src/imap/imap-fetch.c

2017-05-04 17:31:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (914fd41)

    lib-storage: Fix memory leak in mail_search_args_simplify()

    The leaks happened when search args were already initialized (which they 
    usually were at this point) and some of the args were dropped entirely.

    Improved the unit test to initialize search args before calling the 
    simplify, so valgrind would notice if there are any leaks.

    Conflicts:
    src/lib-storage/test-mail-search-args-simplify.c

M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2017-05-02 15:02:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e0b4f4c)

    lib-master: Add comments to struct master_service_connection

    Conflicts:
    src/lib-master/master-service.h

M	src/lib-master/master-service.h

2017-04-28 14:35:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f1d136a)

    lib-storage: When save is aborted, close dest_mail without crashing

    Fixes: Panic: file mail-index-transaction-update.c: line 1023
    (mail_index_update_ext): assertion failed: (seq > 0 && (seq <=
    mail_index_view_get_messages_count(t->view) || seq <= t->last_new_seq))

    Because cache was still attempted to be updated, but the mail was already 
    expunged from index.

M	src/lib-storage/index/index-storage.c

2017-04-28 14:06:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d670c0c)

    lib-storage: Move backend code to a common index_storage_save_abort_last()

    Conflicts:
    src/lib-storage/index/index-storage.c
    src/lib-storage/index/index-storage.h

M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/mbox/mbox-save.c

2017-04-27 14:09:08 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ca9ca6f)

    auth: Log reason for skipping passdb


M	src/auth/auth-request.c

2017-04-28 12:49:37 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3edea87)

    auth: Add test suite for username filter


M	src/auth/Makefile.am
A	src/auth/test-username-filter.c

2017-04-28 10:25:14 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (05090e8)

    auth: Refactor auth to use libauth.la

    This makes writing new unit tests easier, as you can link to libauth.la.

M	src/auth/Makefile.am

2017-04-28 12:51:20 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (6b29257)

    auth: Add username_filter for passdb block

    username_filter lets you specify one or more pattern(s) for including or
    excluding users. exclusion patterns are denoted with ! prefix.

    if any exclude matches the username, passdb will be skipped. if any
    inclusions is specified, and the username does not match one of them, passdb
    will be skipped.

M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/auth/passdb.c
M	src/auth/passdb.h

2017-04-27 11:53:13 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0859ad4)

    auth: Use MECH subsystem when logging error about skipping all password
    databases

    Otherwise it will assert-crash because all password databases were skipped.

M	src/auth/auth-request.c

2017-04-27 12:54:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d644a2e)

    lib-storage: mail_search_arg_to_imap() - Fix writing invalid keywords

    Just write the original invalid keyword string as output. It might not be 
    entirely invalid - just invalid within this mailbox (e.g. a mailbox doesn't 
    allow new keywords).

M	src/lib-storage/mail-search-args-imap.c

2017-04-27 12:53:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0674091)

    lib-storage: Fix searching when search query has invalid keywords.

    For example "SEARCH KEYWORD ]" was returning all mails instead of nothing.

M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search.h

2017-04-27 12:50:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0682df0)

    lib-index: mail_index_update_keywords() - don't assert if adding/removing 0
    keywords

    Although it would be nice for the caller to check it, it's easier to do 
    here. It's mainly a problem with mailbox_keywords_create_valid() that may 
    unexpectedly create empty keywords.

M	src/lib-index/mail-index-transaction-update.c

2017-04-26 23:41:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1164a65)

    quota: imapc backend now never enforces the quota itself

    It just causes a lot of GETQUOTA/GETQUOTAROOT calls to remove. In theory we 
    could make this optional, but I doubt anyone would want it.

M	src/plugins/quota/quota-imapc.c

2017-04-26 23:43:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7dde6c6)

    lib-storage: Fix crash in mail_get_parts() with a special plugin

    If plugin hooks into mail_get_stream() which causes data->parts to be set, 
    this code crashed with:

    Panic: file index-mail.c: line 1163 (index_mail_parse_body): assertion
    failed: (data->parser_ctx != NULL)

M	src/lib-storage/index/index-mail.c

2017-04-26 23:13:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (16672e9)

    imapc: Don't send NOOP on sync if MAILBOX_SYNC_FLAG_FAST is set

    Fast syncing should do only the minimal amount of work.

M	src/lib-storage/index/imapc/imapc-sync.c

2017-04-26 15:04:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (10b70dc)

    imap: Allow plugins to hook into syncing.

    Ideally all of the existing pieces in the syncing code would start using 
    this at some point, so their code could be moved to a more logical location.

M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-sync-private.h
M	src/imap/imap-sync.c

2017-04-26 14:57:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (98c5b9f)

    imap: Move struct imap_sync_context to imap-sync-private.h


M	src/imap/Makefile.am
A	src/imap/imap-sync-private.h
M	src/imap/imap-sync.c

2017-04-18 15:55:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (644ec41)

    lib-storage: mail_search_arg_to_imap() - minor keywords writing optimization

    Avoid an extra str_delete() by checking whether the parenthesis are needed.

M	src/lib-storage/mail-search-args-imap.c

2017-04-18 15:51:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fe43895)

    lib-storage: mail_search_arg_to_imap() - minor FLAGS writing optimization

    Avoid an extra str_delete() by immediately calculating whether the 
    parenthesis are needed.

M	src/lib-storage/mail-search-args-imap.c

2017-04-18 15:38:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cd955fd)

    lib: Add bits_is_power_of_two()


M	src/lib/bits.h
M	src/lib/test-bits.c

2016-04-19 21:14:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cafe14c)

    lib: Fixed bits_required64() with 32bit systems.

    Broken by 84f697c5e30565823619abaaeb57164c789d4b66.

M	src/lib/bits.h

2016-02-05 15:57:30 +0200 Phil Carmody <phil@dovecot.fi> (70176c9)

    lib: bits - GCC (and clang) provide bit-twiddle intrinsics, use them

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/bits.c
M	src/lib/bits.h

2016-02-03 18:34:13 +0200 Phil Carmody <phil@dovecot.fi> (b973512)

    lib: bits - new fractional log-like helper

    For stats gathering, where the data can have a wide range of values, you 
    don't necessarily need the same granularity along the full range of values. 
    For example, 1ms and 11ms latencies are very different, but 1.001s and 
    1.011s latencies are not worth distinguishing. Something logarithmic seems 
    more apt. Simply looking at power-of-2 sized bands (e.g. doing log2(n)), 
    however, is too granular, so these new helpers let you specify how fine to
    (linearly) subdivide each of those bands. 1 fractional bit splits each power
    of 2 band into 2 halves. 2 fractional bits splits each power of 2 band into
    4 quarters, and so on. 0 fractional bits is just log2().

    Exact identification of percentiles is impossible, but it was anyway, as you 
    simply cannot store all the data required to calculate them. However, a mere 
    896 buckets will permit you to have 32 bands per power of 2, 5 fracional
    bits. The above example would have buckets such as 2.432s-2.496s, and
    55.3s-56.3s. Assuming smooth distribution lets you calculate percentiles
    more accurately, just assume within each bucket is a trapezial distribution.
    This holds even if the distribution is multi-modal, which it will be.
    However, maths required.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/bits.h

2017-04-17 01:14:02 +0300 Andriy Syrovenko <andriys@gmail.com> (3d6b8ea)

    auth: Fixed dovecot/auth hanging when child ntlm_auth crashes while
    processing an authentication request


M	src/auth/mech-winbind.c

2017-04-26 14:20:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (86a8cb6)

    imapc: Fix memory leak when closing mailbox with delayed changes


M	src/lib-storage/index/imapc/imapc-storage.c

2017-04-25 12:39:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ce59b1b)

    imapc: Use UID SEARCH instead of SEARCH

    UIDs work better for some broken IMAP servers, so it's safer to use it.

    Keep using sequences for ESEARCH, since servers supporting it aren't at 
    least yet known to be broken and the search result with sequences is 
    smaller.

M	src/lib-storage/index/imapc/imapc-search.c

2017-04-24 17:59:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2c84071)

    quota: Add imapc backend

    This allows using imapc storage with imapc quota. The quota acts as 
    read-only, so it's used only when the current quota usage is explicitly 
    asked.

    The quota can be looked up using either a mailbox name or quota root name. 
    By default INBOX's quota is looked up. If there are multiple quota roots 
    returned for the mailbox, only the first quota root returned by the 
    QUOTAROOT reply is used.

M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/plugins/quota/Makefile.am
A	src/plugins/quota/quota-imapc.c
M	src/plugins/quota/quota.c

2017-04-24 17:58:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7f4df18)

    quota: Fix namespace deduplication when mailboxes don't have paths.

    Nothing requires a mailbox path for quota backends, especially imapc. Still
    do namespace deduplication based on alias_for settings.

M	src/plugins/quota/quota.c

2017-04-24 17:10:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e019007)

    imapc: include imapc-client.h in imapc-storage.h

    It was already required to be able to successfully include imapc-storage.h.

M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2017-04-24 18:13:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fd541d4)

    imap-plugins: Use client_add_capability() for adding dynamic capabilities


M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c

2017-04-24 18:51:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2a02927)

    imap: Use client_add_capability() for adding all dynamic capabilities


M	src/imap/imap-client.c

2017-04-24 18:12:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3f2259e)

    imap: Add client_add_capability()


M	src/imap/imap-client.c
M	src/imap/imap-client.h

2017-04-24 13:29:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4cce569)

    imapc: Add imapc_features=fetch-bodystructure

    This allows using the remote IMAP server's BODY and BODYSTRUCTURE replies.

M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2017-04-24 13:27:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (36a0235)

    lib-storage: Add mail_storage.nonbody_access_fields

    This avoids index_mail_update_access_parts_pre() from opening the mail 
    stream unnecessarily for fields that can be looked up via other methods by
    the storage.

M	src/lib-storage/index/index-mail.c
M	src/lib-storage/mail-storage-private.h

2017-04-24 13:05:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1663aa0)

    lib-storage: Add index_mail_get_cached_body[structure]()

    This just moves the code to these functions without changing any of the 
    logic.

M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2017-04-24 14:04:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (623ff66)

    lib-imap: Make imap_bodystructure_parse_args() public


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h

2017-04-24 12:50:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b53fb9a)

    lib-imap: Add imap_write_arg() to write only a single arg


M	src/lib-imap/imap-util.c
M	src/lib-imap/imap-util.h

2017-04-23 19:57:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (954ba25)

    lib-imap-client: Fix imapc_client_get_capabilities() when called without
    connections


M	src/lib-imap-client/imapc-client.c

2017-04-23 17:19:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (57c33cb)

    imapc: Fix crash in mailbox_exists() when LAYOUT isn't imapc.

    Especially breaks LAYOUT=none.

M	src/lib-storage/index/imapc/imapc-storage.c

2017-04-23 13:35:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (efcc1c4)

    imapc: Support imapc_features=search without ESEARCH extension


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-search.h

2017-04-23 19:14:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (906bc95)

    imapc: Make sure client is logged in when checking capabilities

    Especially with imapc_features=delay-login the capability could have been 
    looked at before the client was even connected.

M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c

2017-04-23 18:51:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3bcc8df)

    imapc: Add imapc_mailbox.capabilities

    Use it instead of imapc_client_get_capabilities(). Simplifies the following
    patch.

M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2017-04-23 18:57:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e3efff9)

    imapc: Rename imapc_storage_has_modseqs() to imapc_mailbox_has_modseqs()

    Simplifies the following patch.

M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2017-04-21 12:54:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1d567a4)

    cassandra: Use fallback consistency for CASS_ERROR_LIB_NO_HOSTS_AVAILABLE
    errors

    I'm not entirely sure if this is always appropriate, but at least this error 
    happens every time when attempting to use write_consistency=two when there 
    is only a single Cassandra node.

M	src/lib-sql/driver-cassandra.c

2017-04-21 20:59:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (107b217)

    dsync-server: Fix support for dsync_features=empty-header-workaround

    Fixes: Panic: Unknown key: empty_hdr_workaround

M	src/doveadm/dsync/dsync-ibc-stream.c

2017-04-21 13:35:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3c998a1)

    *-login: Add client_vfuncs.send_raw_data()

    This allows login plugins to hook into seeing all the data that is sent to 
    the imap/pop3 client.

M	src/imap-login/imap-login-client.c
M	src/imap-urlauth/imap-urlauth-login.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/pop3-login/client.c

2017-04-21 13:27:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3d235c3)

    imap: Add imap_client_vfuncs.send_tagline()

    This allows plugins to catch all the IMAP command replies.

M	src/imap/imap-client.c
M	src/imap/imap-client.h

2017-04-18 10:23:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cd4ca14)

    *-login: Unload plugins at deinit.


M	src/login-common/main.c

2017-04-19 15:01:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b1e42d6)

    lib-storage: Allow mail_add_temp_wanted_fields() to be called before
    mail_set_seq*()

    Quota plugin was already doing this, but it didn't actually work. It was 
    also crashing with imapc:

    Panic: file mail-cache-lookup.c: line 341 (mail_cache_field_exists):
    assertion failed: (seq > 0)

M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail.c

2017-04-20 19:16:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a1cc76a)

    lib-storage: Add mailbox_attribute_unregister_internal[s]()

    This allows plugins to unregister internal attributes when they're unloaded.

M	src/lib-storage/mailbox-attribute.c
M	src/lib-storage/mailbox-attribute.h

2017-04-13 15:13:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (07ca904)

    lib-storage: mail_search_args_simplify() - deduplicate flags

    This needs to be done in a bit more complicated way because multiple 
    SEARCH_FLAGS parameters are wanted to be merged together using a single 
    shared value.flags. Move this merging last after all the deduplication is 
    done.

M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2017-04-13 15:09:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (52a4634)

    lib-storage: mail_search_args_simplify() - simplify "x AND NOT x"

    Implemented for SEARCH_KEYWORD, SEARCH_TEXT, SEARCH_BODY and SEARCH_HEADER*. 
    Dates and sizes would need special code, which gets a bit complicated.

M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2017-04-13 14:05:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9af86df)

    lib-storage: Add more tests to test-mail-search-args-simplify


M	src/lib-storage/test-mail-search-args-simplify.c

2017-04-13 13:57:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8a30756)

    lib-storage: mail_search_arg_to_imap() - remove () around a single
    flag/keyword


M	src/lib-storage/mail-search-args-cmdline.c
M	src/lib-storage/mail-search-args-imap.c
M	src/lib-storage/test-mail-search-args-imap.c
M	src/lib-storage/test-mail-search-args-simplify.c

2017-04-13 13:04:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9930a0d)

    lib-storage: mail_search_args_simplify() - deduplicate KEYWORDs


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2017-04-13 12:51:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (72269e8)

    lib-storage: mail_search_args_to_cmdline() - Fix writing FLAGS & KEYWORDS


M	src/lib-storage/mail-search-args-cmdline.c

2017-04-13 12:36:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ec4d918)

    lib-storage: mail_search_args_to_cmdline() - Write MAILBOX glob without X-
    prefix

    Since SEARCH_MAILBOX is written out as "MAILBOX", SEARCH_MAILBOX_GLOB should 
    also be written as "MAILBOX" rather than "X-MAILBOX".

M	src/lib-storage/mail-search-args-cmdline.c

2017-04-11 20:39:55 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (aa2399c)

    auth: Check var_expand error in vpopmail


M	src/auth/userdb-vpopmail.c

2017-04-11 15:50:14 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (633e34e)

    auth: Filter passdbs on credentials lookup start

    Consistency with how plain verify works.

M	src/auth/auth-request.c

2017-04-11 15:47:33 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (9ad7afa)

    auth: Fix mechanism filter to support `none`

    Otherwise credentials lookup can fail. None indicates that it should match
    when no mech is specified.

M	src/auth/auth-request.c

2017-04-11 15:33:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bb087f9)

    auth: Use mem_equals_timing_safe() for all password hash comparisons.

    It's unlikely these could be used to perform timing attacks, since the 
    attacker would have to have broken MD5/SHA badly enough to be able to 
    quickly generate string that result in wanted hashes. Still, the extra cost
    is almost nothing and it's always better to be super paranoid!

M	src/auth/auth-master-connection.c
M	src/auth/mech-apop.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-gssapi.c
M	src/auth/mech-ntlm.c
M	src/auth/mech-rpa.c
M	src/auth/mech-scram-sha1.c
M	src/auth/password-scheme-pbkdf2.c
M	src/auth/password-scheme-scram.c
M	src/auth/password-scheme.c

2017-04-09 15:31:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2d1959d)

    auth: Shuffle failed auth requests before sending the failure replies.

    This might be helpful against some timing attacks.

    Using Fisherâ€“Yates shuffle.

M	src/auth/auth-request-handler.c

2017-04-09 15:19:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fb7a68e)

    doveadm: Make doveadm_password safe against timing attacks.


M	src/doveadm/client-connection.c

2017-04-09 00:50:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4e11e0a)

    auth: Make plaintext password comparisons safe against timing attacks


M	src/auth/password-scheme.c

2017-04-09 00:49:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3119194)

    lib: Add mem_equals_timing_safe()


M	src/lib/strfuncs.c
M	src/lib/strfuncs.h
M	src/lib/test-strfuncs.c

2017-04-10 20:53:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8b4fe6f)

    fts: Initialize fts after namespaces have been added

    This way paths are correctly set, and fts indexes are written to correct
    place. This affects mbox with lucene.

    Fixes Panic: file mailbox-list.c: line 1158 (mailbox_list_try_mkdir_root):
    assertion failed (strncmp(root_dir, path, strlen(root_dir)) == 0)

M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h

2017-04-11 15:05:53 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d9ce435)

    fts: Remove indentation from fts_mailbox_list_created

    Preparation for next commit

M	src/plugins/fts/fts-storage.c

2017-04-12 12:24:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b440bbf)

    Makefile: Another fix for make distcheck when using scan-build

    It seems to run two configures with different parameters, which results in 
    some of the files not being cleaned up. So this hopefully fixes:

    ERROR: files left in build directory after distclean:
    ./src/util/tcpwrap

M	Makefile.am

2017-04-11 09:34:11 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (9c8ed72)

    lib-imap: imap-bodystructure: Fixed handling of a multipart part without
    children in imap_bodystructure_parse().

    In imap_bodystructure_write(), an empty multipart part is addressed by
    generating an empty text/plain part. However, when parsing that back with
    imap_bodystructure_parse() against a parsed message_part tree, this case
    needs to be considered explicitly. Otherwise, it will not be able to match
    the message part hierarchies.

    This adds a test suite item that tests both the write (previous commit) and
    parse functions.

M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/test-imap-bodystructure.c

2017-04-12 10:13:15 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (b8dc77b)

    lib-imap: imap-bodystructure: Fixed handling of a multipart part without
    children in imap_bodystructure_write().

    In that case it writes an empty text/plain part to prevent generating an
    invalid BODYSTRUCURE. However, it always generated the basic BODY version
    without the extra fields for a full BODYSTRUCTURE.

M	src/lib-imap/imap-bodystructure.c

2017-04-11 20:32:19 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b30e3da)

    auth: Fix compile problem with vpopmail

    79fe1b28df44ba22b230326bee895583c1df5a28 forgot to remove const from table.

M	src/auth/userdb-vpopmail.c

2017-04-11 14:55:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f82cd18)

    Makefile: Fix make distcheck when using scan-build

    The _build directory shouldn't be deleted afterwards or it'll just fail.

M	Makefile.am

2017-04-11 11:23:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7c33158)

    Improve valgrind suppressions.


M	run-test-valgrind.supp

2017-01-11 19:43:30 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f1fc156)

    lib-dict-sql: Try merge sets to single update

    This attempts to put mergeable keys into same update instead of using
    multiple SQL statements.

M	src/lib-dict/dict-sql.c

2017-04-11 10:11:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (892ba92)

    lib, userdb-vpopmail: Fully remove var_expand_table_build()

    It was accidentally removed in master-2.2 as part of the changes in 
    122014ad84488d6309dc7d1572dfc988fedc18c4

    This finishes up the removal as it was done in master in 
    79fe1b28df44ba22b230326bee895583c1df5a28

M	src/auth/userdb-vpopmail.c
M	src/lib/var-expand.h

2017-04-10 17:07:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3a1c643)

    lib-imap-client: Fix reconnection

    There was already code for reconnection. We just shouldn't have gone very 
    far in imapc_connection_connect() if we were still waiting for reconnection 
    delay to pass.

M	src/lib-imap-client/imapc-connection.c

2017-04-10 18:12:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fb4c9c0)

    lib-imap-client: Fixes to unit test


M	src/lib-imap-client/test-imapc-client.c

2017-04-10 17:10:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c47cdae)

    lib-imap-client: Add unit test

    Initially this tests some connection and reconnection problems.

M	src/lib-imap-client/Makefile.am
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
A	src/lib-imap-client/test-imapc-client.c

2017-04-10 17:09:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dcd135e)

    lib-imap-client: Include "ms" in reconnect warning message


M	src/lib-imap-client/imapc-connection.c

2017-04-10 17:06:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ed10bdd)

    lib-imap-client: Remove hardcoded IMAPC_CONNECT_RETRY_WAIT_MSECS

    We have a setting for it now.

M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2017-04-10 16:44:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4b32dbb)

    lib-imap-client: Disconnection during LOGIN should still have
    state=disconnected

    It's not an authentication failure, which would imply that the user or 
    password was wrong.

M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c

2017-04-10 16:18:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (59a0265)

    lib-imap-client: Make command tag counter externally accessible

    This allows unit tests to reset it.

M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c

2017-04-10 15:49:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b522906)

    lib-imap-client: Call the public login callback exactly once.

    Previously it was also called only once, as long as there were only a single 
    imap connection. (The current imapc code wouldn't create more than one 
    connection.) It was a bit confusing what the expectation was, so now the 
    callback is never called more than once.

M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2017-04-10 14:14:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (19762b4)

    lib-imap-client: imapc_client_deinit() didn't set client=NULL


M	src/lib-imap-client/imapc-client.c

2017-04-10 13:50:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1955422)

    imapc: Change imapc_connection_retry_interval default to be 1 second.

    10 secs at least is too high. Usually the connection problem is very 
    intermittent and even an immediate reconnection would succeed.

M	src/lib-storage/index/imapc/imapc-settings.c

2017-04-10 13:48:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0fa6c72)

    lib-imap-client: Change connect_retry_interval_secs to _msecs

    This allows caller to provide better precision.

M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-storage.c

2017-04-10 13:46:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (aca5aa7)

    lib-imap-client: Use struct timeval for tracking last_connect time.

    This provides better accuracy when calculating how much time there's left 
    until reconnection.

M	src/lib-imap-client/imapc-connection.c

2017-04-10 13:02:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d4fed32)

    lib-http: Improve request stats text.

    It's important to know how long the request was in queue before it was sent.

    Also the "n attempts in m secs" makes more sense if it was counting only the 
    time after the initial request was sent, not including the queuing time.

    If there is more than 1 attempt, log separately how long all the attempts 
    were waited on vs. how long the last attempt took.

M	src/lib-http/http-client-request.c

2017-04-10 12:59:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e88a770)

    lib-http: Add http_client_request_stats.first_sent_msecs

    Also rename sent_msecs to last_sent_msecs.

M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2017-04-10 12:53:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (869fc20)

    lib-http: Track request's first and last send attempt times separately.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2017-04-05 12:36:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1fbeeb3)

    *-login: Move code to login_anvil_init()

    Calling this allows plugins that need to talk to anvil make sure they have 
    an anvil connection even if mail_max_userip_connections=0.

M	src/login-common/login-common.h
M	src/login-common/main.c

2017-04-05 12:52:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (86306a3)

    doveadm who: Don't aggregate empty usernames with different IPs

    We'll assume that in that case anvil is used to track IP addresses rather 
    than usernames. (Dovecot core doesn't currently use this.)

M	src/doveadm/doveadm-who.c

2017-04-07 09:28:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ab8b02a)

    lib-http: Remove unnecessary enum declaration.

    Most of these were removed by a8fe899601735459641edae975c0fa08be8482e2

M	src/lib-http/http-client-private.h

2017-04-05 14:14:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bffd1b3)

    example-config: Add blocking setting to dovecot-ldap.conf.ext


M	doc/example-config/dovecot-ldap.conf.ext

2017-04-08 09:58:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6e6a9df)

    auth-var-expand-crypt plugin: Add missing ldflags


M	src/plugins/var-expand-crypt/Makefile.am

2017-04-09 15:48:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (161f40a)

    fts-solr: Don't double-escape headers.


M	src/plugins/fts-solr/fts-backend-solr.c

2017-04-07 16:27:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b9ba6ce)

    auth: Fix crash in passdb imap on connection failures


M	src/auth/passdb-imap.c

2017-04-07 16:13:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b8f84b0)

    lib-ssl-iostream: Don't require SSL CA certs if require_valid_cert==FALSE

    This happened only when verify_remote_cert was also TRUE. But this behavior 
    now allows verifying the cert without actually requiring it to be valid.

M	src/lib-ssl-iostream/iostream-openssl-context.c

2017-04-07 15:47:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3a081fc)

    auth: passdb imap: Use ssl_client_ca_* settings.

    The args = ssl_ca_dir=.. setting still overrides the ssl_client_ca_dir.

M	src/auth/passdb-imap.c

2017-04-07 09:34:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1716f29)

    global: Remove extra ';' to fix compiler errors

    Sun C doesn't like them.

M	src/auth/auth-policy.c
M	src/plugins/mail-crypt/mail-crypt-key.c

2017-04-07 09:32:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (eedf482)

    global: Make sure all files end with newline

    Fixes compiler warnings with Sun C.

M	src/lib-imap/imap-envelope.c
M	src/lib-mail/message-part-data.c
M	src/lib-mail/message-part-data.h

2017-04-07 10:55:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7712d89)

    fs-posix: Fix FS_METADATA_WRITE_FNAME to preserve the path

    It should only change the filename.

M	src/lib-fs/fs-posix.c

2017-04-07 12:45:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b3f3347)

    doveadm force-resync: Skip autocreated mailboxes that don't exist yet.

    Since they don't exist, there's nothing to resync in them either. This
    avoids unnecessarily creating them.

M	src/doveadm/doveadm-mail.c

2017-04-07 12:42:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (59f5cb5)

    dict-sql: Fix setting $variables to iteration key when map had multiple
    values


M	src/lib-dict/dict-sql.c

2017-04-07 09:14:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (90dbea8)

    lib: Redefine NULL only if HAVE_TYPE_CHECKS is set


M	src/lib/compat.h

2017-04-07 09:11:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (be8a58d)

    lib: Add a common HAVE_TYPE_CHECKS

    I'm not sure if it should be checking gcc >= 3.0 or 3.3, but they're all old
    so doesn't really matter.

    The __cplusplus check was added to both, since it wouldn't have done 
    anything anyway as COMPILE_ERROR_IF_TRUE() is 0 for __cplusplus.

M	src/lib/compat.h
M	src/lib/macros.h

2017-04-05 15:59:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3d2437d)

    *-login: Minor logging cleanup if client is disconnected before sending
    banner.

    Avoid unnecessarily adding "(no auth attempts in 0 secs)" when the reason 
    string already makes it clear that the user didn't even have a chance to 
    authenticate.

    This kind of disconnection currently happens only with some plugins.

M	src/imap-login/imap-login-client.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/pop3-login/client.c

2017-04-06 20:43:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ddaf6ab)

    example-config: Add connect/read/write_timeout to mysql connect settings


M	doc/example-config/dovecot-sql.conf.ext

2017-04-06 20:00:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (12ad349)

    imapc: Remove "_sec" suffix from imapc_connection_retry_interval_secs

    Its type is SET_TIME, so the value doesn't have to be in seconds.

M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2017-04-06 19:49:07 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (5ca66e6)

    imap-login: Retain client ID only when enabled


M	src/imap-login/imap-login-client.c

2017-04-05 14:23:47 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ca65ac2)

    lib-storage: Set internal error in imapc_list_get_hierarchy_sep


M	src/lib-storage/index/imapc/imapc-list.c

2017-04-05 14:23:26 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (553fcd5)

    imapc: Use IMAPC_COMMAND_STATE_AUTH_FAILED to indicate auth failure


M	src/auth/passdb-imap.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2017-04-05 14:22:38 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0816664)

    lib-imap-client: Do not reset ips when reconnecting

    Avoids infinite loop

M	src/lib-imap-client/imapc-connection.c

2017-04-05 13:27:57 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (1b7b0f7)

    lib-storage: Return empty value in imapc_list_get_storage_name on auth error

    Avoids clobbering authentication error.

M	src/lib-storage/index/imapc/imapc-list.c

2017-04-05 12:48:31 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (eedc4e4)

    lib-storage: Do not clobber error with imapc


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c

2017-04-05 12:47:24 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8986717)

    global: Fix imapc_client_login usage


M	src/auth/passdb-imap.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/imapc-storage.c

2017-04-05 12:09:57 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (2cc26e4)

    lib-imap-client: Add login_callback setter

    This way it can be set before actually calling login which might happen some
    time later.

M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h

2017-04-04 23:33:51 +0300 Dmitry Yakunin <d.yakunin@rambler-co.ru> (fab03d4)

    imapc: Fix memory leak in disconnected state


M	src/lib-imap-client/imapc-connection.c

2017-04-05 09:26:54 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (076f7f5)

    auth: Update default policy string to include device id and protocol


M	src/auth/auth-settings.c

2017-04-04 15:59:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (879cad3)

    imap: Set command reason strings using the new human_args

    This way the reason string is already suitable for logging, since it's 
    guaranteed to be valid UTF-8 without control chars.

M	src/imap/imap-commands-util.c

2017-04-04 15:58:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (82e99cd)

    imap: Add client_command_context.human_args

    Generated with imap_write_args_for_human()

M	src/imap/imap-client.c
M	src/imap/imap-client.h

2017-04-04 15:58:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5ffca78)

    lib-imap: Add imap_write_args_for_human()


M	src/lib-imap/imap-util.c
M	src/lib-imap/imap-util.h

2017-04-04 15:38:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (57997bb)

    imap: Add imap_client_command_get_reason()

    All the command -> reason string conversions now go through this function.

M	src/imap/cmd-fetch.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h

2017-04-04 13:28:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c2145f2)

    lib: Increase net_connect*() EADDRNOTAVAIL retries to 20

    4 is too little, since on busy systems it's sometimes failing. These calls 
    should be pretty cheap, so lets try if 20 is enough.

    It would be nice if this was configurable, but the only practical way right 
    now would be to use environment variable, which is a bit ugly. We could try
    it next if 20 is still not enough.

M	src/lib/net.c

2017-04-03 18:44:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (aa11368)

    imapc: Compiler warning fix for 32bit systems


M	src/lib-imap-client/imapc-connection.c

2017-03-31 10:57:14 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b376929)

    lib-imap-client: Make authentication failures more consistent

    This way they always say the same prefix, which is easier to spot.

M	src/lib-imap-client/imapc-connection.c

2017-03-31 10:49:50 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (803e341)

    lib-imap-client: Call login_callback on all authentication failures


M	src/lib-imap-client/imapc-connection.c

2017-03-31 10:12:58 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (4efdfe9)

    lib-imap-client: Fix reconnection

    This patch fixes reconnections to actually consider all IP addresses first
    and then delay for interval and retry at most retry count times.

M	src/lib-imap-client/imapc-connection.c

2017-03-31 11:01:15 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c4da131)

    lib-imap-client: Remove io earlier to avoid hammering

    If connection has failed and reconnection is not yet possible, io has to be
    removed here, otherwise it will keep hammering the callback.

M	src/lib-imap-client/imapc-connection.c

2017-03-31 10:58:47 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (1389e47)

    lib-imap-client: Only LOGOUT from connected connections


M	src/lib-imap-client/imapc-client.c

2017-03-31 09:44:28 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (555b4a3)

    lib-imap-client: Make retry count and interval configurable


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2017-03-31 09:59:02 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8293257)

    lib-imap-client: Add imapc_client_try_stop


M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c

2017-03-30 16:09:06 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (036f34d)

    lib-sasl: Add missing input handler for xoauth2


M	src/lib-sasl/mech-oauthbearer.c

2017-04-03 12:40:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dbed1a0)

    director: Fix mail_hosts_dup() to duplicate tags correctly.

    The host->tag pointed to the old hosts list. Also the new hosts list's tags 
    array wasn't filled.

    This fixes USER-LOOKUP to return host with default configuration, which
    fixes doveadm director status <user> to not show "Initial config" as empty.

M	src/director/mail-host.c

2017-04-03 11:41:29 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (9ddb3f7)

    doveadm: Call mailbox_set_reason with initialized mailbox


M	src/doveadm/doveadm-mail-import.c

2017-04-01 22:12:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cbe889f)

    global: Add mailbox_transaction_set_reason() calls

    Added to the most important places.

M	src/imap/cmd-append.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-select.c
M	src/imap/cmd-store.c
M	src/imap/cmd-thread.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h
M	src/imap/imap-search.c
M	src/imap/imap-state.c
M	src/imap/imap-sync.c
M	src/indexer/master-connection.c
M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/mail-autoexpunge.c
M	src/plugins/quota/quota-storage.c

2017-04-01 21:54:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d28d40b)

    lib-storage: Add mailbox_transaction_set_reason()


M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2017-04-01 21:43:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1365792)

    global: Add mailbox_set_reason() calls

    Added to the most important places.

M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-save.c
M	src/doveadm/doveadm-mail.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-getmetadata.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-resetkey.c
M	src/imap/cmd-select.c
M	src/imap/cmd-setmetadata.c
M	src/imap/cmd-subscribe.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-notify.c
M	src/imap/imap-state.c
M	src/imap/imap-status.c
M	src/indexer/master-connection.c
M	src/lib-imap-storage/imap-metadata.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-lda/mail-deliver.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/mail-autoexpunge.c
M	src/lib-storage/mail-storage.c
M	src/lmtp/commands.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-status.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-storage.c
M	src/pop3/pop3-client.c

2017-04-01 21:16:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b6726ae)

    lib-storage: Add mailbox_set_reason()

    Use it to log a debug message when mailbox is being opened.

M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2017-03-27 18:05:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b6a369a)

    lib-index: Don't increase modseq for backend/dirty flag changes

    These flags are used only for internal changes and they shouldn't be 
    triggering any modseq changes.

    To avoid modseqs from unexpectedly shrinking, the new modseq counting 
    behavior is enabled only for newly rotated transaction log files that have a
    new minor_version.

M	src/doveadm/doveadm-dump-log.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mail-transaction-log.h
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c

2017-03-30 20:38:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0713b92)

    lib-index: Add macros to check if transaction log file version is new
    enough.

    The version numbers are 8bit, so we can generate a single 16bit number out 
    of them.

M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.h

2017-03-29 01:25:21 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (c8379b4)

    lib-http: client: Implemented means to obtain request statistics.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2017-03-31 23:12:47 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d4b3a9b)

    lib: Fix strcasecmp mistake in var-expand


M	src/lib/var-expand.c

2017-03-31 16:42:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b73b1f9)

    lmtp: Die at startup if config reading fails.

    Although most of the time it's not strictly required for config to be read
    here, one exception is SSL server settings. If this config reading fails,
    the SSL initialization just crashes. So this gives a better error message
    than a crash. Also config reading really isn't supposed to fail anyway.

M	src/lmtp/main.c

2017-03-30 23:25:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f2ed4ef)

    lib-index: Assert in mail_index_append_finish_uids() to prevent UID wrapping

    This should be handled better eventually, but it's better to crash earlier 
    now than later. This avoids a later assert:

    Panic: file mail-index-transaction-finish.c: line 187
    (mail_index_transaction_get_uid): assertion failed: (rec->uid != 0)

M	src/lib-index/mail-index-transaction-update.c

2017-03-31 12:28:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (738f09f)

    lib-fs: Add FS_METADATA_ORIG_PATH

    This allows fs backends to keep track of the original filename and use it 
    for logging purposes and such.

M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2017-03-31 12:28:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (549888d)

    lib-fs: Allow fs_set_metadata() to update already added metadata.

    Previously we were just appending the metadata multiple times with different 
    values, which could have caused problems.

M	src/lib-fs/fs-api.c

2017-03-31 01:02:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0545e6b)

    imap: Fix assert-crash when hibernation triggers during IDLE syncing

    Fixes: Panic: file cmd-idle.c: line 182 (idle_hibernate_timeout): assertion
    failed: (ctx->sync_ctx == NULL)

M	src/imap/cmd-idle.c

2017-03-27 11:02:31 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (bb8b63e)

    var-expand-crypt: Fix data decryption


M	src/plugins/var-expand-crypt/var-expand-crypt-plugin.c

2017-03-27 09:39:03 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ba0aa2d)

    var-expand-crypt: Add error handling for initialization


M	src/plugins/var-expand-crypt/var-expand-crypt-plugin.c

2017-03-27 09:34:50 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (cbf8b2a)

    var-expand-crypt: Do not free dcrypt context twice

    Found by coverity

M	src/plugins/var-expand-crypt/var-expand-crypt-plugin.c

2017-03-31 15:30:58 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c2f200c)

    test-var-expand: Expect error


M	src/lib/test-var-expand.c

2017-03-23 15:17:44 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (b82a1a4)

    var-expand-crypt: Remove pointless assigment

    It's never used

M	src/plugins/var-expand-crypt/var-expand-crypt-plugin.c

2017-03-23 15:12:45 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ffd9c62)

    var-expand-crypt: Fix base64 encoding

    the break was missing, also removed confusing block.

M	src/plugins/var-expand-crypt/var-expand-crypt-plugin.c

2016-11-18 14:47:05 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (217905e)

    var-expand-crypt: Encryption/decryption support for var-expand

    Registers new encrypt and decrypt processors for var-expand.

M	configure.ac
M	src/plugins/Makefile.am
A	src/plugins/var-expand-crypt/Makefile.am
A	src/plugins/var-expand-crypt/var-expand-crypt-plugin.c

2016-12-25 10:36:59 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ec4485c)

    lib: Add tests for extensions


M	src/lib/test-var-expand.c

2016-11-18 09:39:46 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (122014a)

    lib: Add extension support for var-expand

    This enables loading new var-expand features using plugins.

M	src/lib/Makefile.am
M	src/lib/lib.c
A	src/lib/var-expand-private.h
M	src/lib/var-expand.c

2017-03-27 13:55:28 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0314505)

    lib: Use error_r in var_expand_long and friends

    This is aligment commit for extensions, and differs from v2.3 so that error
    is reported in var_expand_with_funcs since the public API is not changed.

M	src/lib/var-expand.c

2017-03-30 23:46:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b74e236)

    lib-http: http_client_request_delay_from_response() should use per-request
    timeout as max

    It was using the global request_timeout_msecs for the maximum timeout, which
    could be different from the per-request timeout set by 
    http_client_request_set_attempt_timeout_msecs().

M	src/lib-http/http-client-request.c

2017-03-30 22:29:13 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (34c9aed)

    lib-http: client: Fixed request-specific attempt timeout.

    This is the timeout applied to a single request attempt. Using
    http_client_request_set_attempt_timeout_msecs() this can be set for a
    specific request. However, this was mostly ignored for requests that weren't
    in the process of handling response payload. Instead, the global
    request_timeout_msecs client setting was used.

    Also amended the (currently manual) test suite with tests that demonstated
    the problem and now verify the fix.

M	src/lib-http/http-client-connection.c
M	src/lib-http/test-http-client-errors.c

2017-03-28 19:40:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4f67426)

    lib-index: Use time_to_local_day_start() instead of reimplementing


M	src/lib-index/mail-index-transaction-update.c

2017-03-28 19:14:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6d9227e)

    lib: Add time_to_local_day_start()


M	src/lib/test-time-util.c
M	src/lib/time-util.c
M	src/lib/time-util.h

2017-03-27 17:44:45 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6129bb3)

    lib-index: Code cleanup - expand LOG_WANT_ROTATE() macro

    There was no reason it had to be a macro. Also this fixes off-by-one error
    when checking for log_rotate_min_size.

M	src/lib-index/mail-transaction-log.c

2017-03-17 10:28:36 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (1389da1)

    test: lib-http: Check write_full return value in test

    Makes static analyzers happier

M	src/lib-http/test-http-client.c

2017-03-17 10:26:50 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (b64df82)

    test: fts-squat: Ignore gettimeofday return value in test

    Makes static analyzers happier

M	src/plugins/fts-squat/squat-test.c

2017-03-17 10:26:06 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f5132aa)

    test: lib-index: Ensure conficts_seqs is created in test

    Makes static analyzers happier

M	src/lib-index/test-mail-index-transaction-finish.c

2017-03-17 10:25:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (df63964)

    test: lib: Ensure item is not null

    Makes static analyzers happier

M	src/lib/test-priorityq.c

2017-03-17 10:19:17 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3c269a8)

    test: lib-fts: Ignore uni_utf8_get_valid_data return value

    Makes static analyzers happier

M	src/lib-fts/test-fts-tokenizer.c

2017-03-17 10:17:59 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (dc50da7)

    test: mail-crypt: Check dcrypt_id_key_private_old return value

    Makes static analyzers happier

M	src/plugins/mail-crypt/test-mail-key.c

2017-03-17 10:16:11 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (63bc80a)

    test: lib-http: Check o_stream_send return value

    Makes static analyzers happier

M	src/lib-http/test-http-server.c

2017-03-17 10:13:59 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f76d378)

    test: lib: Check o_stream_send return value

    Make static analyzers happier

M	src/lib/test-ostream-escaped.c

2017-03-27 19:50:53 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d2cda64)

    driver-cassandra: Add metric for slow queries


M	src/lib-sql/driver-cassandra.c

2017-03-29 20:04:47 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (b482028)

    push-notification-driver-ox: Wait for http requests to finish in deinit

    This is to make sure mail_user is still usable in http response callback.

M	src/plugins/push-notification/push-notification-driver-ox.c

2017-03-30 15:53:59 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (276dedb)

    director: Log vhost count changes and HOST-UP/DOWN


M	src/director/director-connection.c
M	src/director/doveadm-connection.c
M	src/director/mail-host.c
M	src/director/mail-host.h

2017-03-30 01:42:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ac37a92)

    master: When logging fork() EAGAIN failure, include current ulimit -u value


M	src/master/service-process.c

2017-03-27 16:33:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6c6fe8d)

    doveadm dump log: Use shared lib-index code for updating modseq

    When MAIL_TRANSACTION_MODSEQ_UPDATE records were seen, the printed modseqs 
    afterwards weren't correct.

    Now that mail_transaction_update_modseq() is used, we don't need to keep 
    this code synchronized with it.

M	src/doveadm/doveadm-dump-log.c

2017-03-27 16:30:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d491248)

    doveadm dump log: Cleanup - don't change hdr.size

    Needed by the next commit.

M	src/doveadm/doveadm-dump-log.c

2017-03-27 16:26:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8dca8b4)

    doveadm dump log: Use istream for reading the file.

    Cleans up the code a bit and removes the 1MB record limit.

M	src/doveadm/doveadm-dump-log.c

2017-03-29 13:28:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d6baf55)

    lib-storage: Fix potential dict transaction leak on transaction rollback.


M	src/lib-storage/index/index-transaction.c

2017-03-29 13:27:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (90927c8)

    lib-dict: Keep a linked list of all transactions in dict.

    This helps debugging if a transaction is leaked.

M	src/lib-dict/dict-private.h
M	src/lib-dict/dict.c

2017-03-29 16:15:36 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c2bdba6)

    auth: Do not cache username unless it was changed by lookup

    This could've caused usernames to be unexpectedly changed because they were
    cached by a lookup that did not include username in the cache key.

M	src/auth/auth-request.c

2017-03-29 15:37:36 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b0fcc4f)

    auth: Mark username changed if it's changes in
    auth_request_try_update_username

    It was forgotten in by 865a82c1

M	src/auth/auth-request.c

2017-03-07 13:32:15 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5f2a639)

    lib: Add uuid support to guid


M	src/lib/guid.c
M	src/lib/guid.h
M	src/lib/test-guid.c

2017-03-23 14:09:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (28cdaf6)

    mail-log: Differentiate autoexpunges from expunges


M	src/plugins/mail-log/mail-log-plugin.c

2017-03-23 14:08:30 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ee4ce07)

    lib-storage: Indicate mail is being autoexpunged

    This way plugins, such as mail_log, can detect this.

M	src/lib-storage/mail-autoexpunge.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail.c

2017-03-27 15:28:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1fdc2de)

    config: Don't stop the process due to idling.

    If the config process restarts, it also reloads configuration. We'd rather 
    want the configuration reloads to always be explicit.

M	src/config/config-settings.c

2017-03-27 13:44:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (454f387)

    cassandra: Fallback consistency fix - it wasn't used permanently

    Because the "do I want to retry using primary consistency?" check was done 
    using the first failure timestamp, after 60 seconds that check always 
    returned TRUE. We should instead be checking the last timestamp for a query
    that was sent with the primary consistency.

M	src/lib-sql/driver-cassandra.c

2017-03-27 13:33:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (87c3d63)

    cassandra: Fallback consistency fix - max retry interval was set wrong

    The maximum msecs is _MAX_RETRY_MSECS, not _FIRST_RETRY_MSECS

M	src/lib-sql/driver-cassandra.c

2017-03-26 19:08:18 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (c1b218c)

    lib-http: client: Fix aborting a request that has a delayed error.

    Caused by recent changes in delayed error handling.

M	src/lib-http/http-client-request.c
M	src/lib-http/test-http-client-errors.c

2017-03-19 15:35:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (772535e)

    imapc: Add imapc_features=delay-login

    The connection to imapc_host is delayed until it's actually needed to be 
    performed.

M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2017-03-19 15:34:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c8e6aa6)

    imap: Remove imapc-specific "is connection valid?" code

    This is now done by imapc itself in the previous patch

M	src/imap/main.c

2017-03-19 15:32:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a7b6847)

    imapc: Fail user creation if login to imapc_host fails.

    This causes imapc to actually wait for the login to succeed or fail. Such a
    wait was already done by the imap code, which will be removed by the next
    patch.

M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2017-03-25 15:46:58 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e1275ba)

    quota: Add backend register/unregister

    This way, other mail plugins can register their own quota backends.

M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2017-03-24 14:46:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (dfabd74)

    lib-mail: Fix read overflow / crash in message_header_decode()

    If the input string was "=?charset?Q|B?text?", the code attempted to look up 
    the character after it. And if it was "=", the callback was called with 
    size=-1, which ends up in a crash.

M	src/lib-mail/message-header-decode.c
M	src/lib-mail/test-message-header-decode.c

2016-12-16 22:18:02 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (26fde3e)

    doc: mention no_ticket in ssl config example


M	doc/example-config/conf.d/10-ssl.conf

2017-03-23 20:16:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5f7ffdb)

    imap-login: Move forward_fields updating code to login-common

    This allows using the new client_add_forward_field() in e.g. plugins.

M	src/imap-login/imap-login-client.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h

2017-03-24 04:21:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a440c98)

    lib-storage: Fix mail_user_autoexpunge() return value to be initialized
    properly


M	src/lib-storage/mail-autoexpunge.c

2017-03-23 14:27:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (35b5cca)

    lib-storage: Change mail_user_autoexpunge() to return number of autoexpunged
    mails


M	src/lib-storage/mail-autoexpunge.c
M	src/lib-storage/mail-autoexpunge.h

2017-03-23 14:19:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bc72ba6)

    lmtp: Trigger autoexpunging only for the last RCPT TO.

    Otherwise if the autoexpunging takes a long time, the LMTP client could 
    disconnect due to a timeout. The mails would still eventually get delivered 
    though, so it would result in duplicate mails being delivered.

    An alternative to this would be to keep all the mail_users referenced until 
    the delivery is finished and then autoexpunge all of them at the end. It 
    increases memory usage though and complicates the code, so at least for now 
    it's not implemented.

M	src/lmtp/commands.c

2017-03-23 14:15:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (70d0076)

    lib-storage: Replace MAIL_STORAGE_SERVICE_FLAG_AUTOEXPUNGE with explicit
    mail_user_autoexpunge()

    This allows better control of which users are being autoexpunged. This patch
    changes behavior at least in two ways now:

    1) After shared folder access, the owner user isn't autoexpunged at deinit. 
    Although this is a bit questionable of whether it should be or not.

    2) LMTP's quota check at RCPT TO stage doesn't trigger autoexpunging.

M	src/imap/imap-client.c
M	src/imap/main.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/lmtp/commands.c
M	src/lmtp/main.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c

2017-03-23 14:08:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b551e46)

    pop3: Start autoexpunging only after client is disconnected


M	src/pop3/pop3-client.c

2017-03-16 11:15:18 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (5c556ef)

    global: Log internal storage error on failure


M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-save.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/imap/imap-state.c
M	src/indexer/master-connection.c
M	src/lda/main.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-lda/mail-deliver.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/mail-autoexpunge.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lmtp/commands.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/mail-crypt/doveadm-mail-crypt.c
M	src/plugins/mail-crypt/mail-crypt-acl-plugin.c
M	src/plugins/mail-crypt/mail-crypt-key.c
M	src/plugins/mail-crypt/test-mail-key.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/push-notification/push-notification-driver-ox.c
M	src/plugins/push-notification/push-notification-event-mailboxcreate.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c

2017-03-17 09:23:00 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (6732ce3)

    lmtp: Log internal error on STATUS_CHECK_OVER_QUOTA failure


M	src/lmtp/commands.c

2017-03-16 11:12:29 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (dcf7e4f)

    lib-storage: Add mail_storage_get_last_internal_error()

    This returns the error given to mail_storage_set_critical().

M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2017-03-22 17:17:41 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (690f935)

    quota: Add quota_max_mail_size setting


M	doc/example-config/conf.d/90-quota.conf
M	src/plugins/quota/Makefile.am
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-status.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/quota.h

2017-03-23 10:16:30 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (9edefd4)

    quota: Use quota_alloc_result in quota_settings.test_alloc


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c
M	src/plugins/trash/trash-plugin.c

2017-03-23 13:48:04 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (42edee2)

    quota: Introduce quota_alloc_result return type


M	src/plugins/quota/quota-status.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/quota.h

2017-03-23 15:05:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2dec373)

    dbox: Allow ":" separator between mail_attachment_fs driver and args.

    The ":" separator is nowadays commonly used elsewhere for the separator, so
    it should work here as well.

M	src/lib-storage/index/dbox-common/dbox-storage.c

2016-11-22 10:54:43 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ff271fa)

    lib: Fix whitespace in var-expand.c


M	src/lib/var-expand.c

2017-02-25 23:34:03 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (6f1f9ba)

    lib-storage: Add and use default mailbox iterator

    The idea is to allow mail plugins to see also the non-existent autoboxes by
    feeding them thru the iterator.

    Fixes problem where autocreated boxes are not seen by ACL plugin.

M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mailbox-list-private.h

2017-03-21 13:14:41 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e8878af)

    lib-storage: Expose mailbox_list_init_autocreate

    It is needed when backend_ctx is created on the fly

M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/mailbox-list-private.h

2017-02-25 23:33:20 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f958661)

    acl: Use MODULE_CONTEXT for mailbox list iterator


M	src/plugins/acl/acl-mailbox-list.c

2017-02-25 23:59:21 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (09b0bde)

    acl: Use mailbox_list_context instead of ctx->ctx

    This prepares for the next commit

M	src/plugins/acl/acl-mailbox-list.c

2017-03-22 12:01:18 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (8843942)

    lib-dict: Ensure all iterations and transactions are done in deinit


M	src/lib-dict/dict.c

2017-03-22 12:01:07 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5790690)

    lib-dict: Track transaction counts


M	src/lib-dict/dict-private.h
M	src/lib-dict/dict.c

2017-03-22 10:33:20 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (6440a34)

    lib-dict: Fix test-dict linkage


M	src/lib-dict/Makefile.am

2017-03-22 10:32:58 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a0053e5)

    lib-dict: Use dict-fail iterator and transaction when missing from dict
    driver


M	src/lib-dict/dict.c

2017-03-22 12:05:32 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (9cce451)

    dict: Update correct counter in dict_iterate_init


M	src/lib-dict/dict.c

2017-03-22 10:32:04 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (08e4685)

    lib-dict: Add dict-fail driver

    It can be used for providing various failures

M	src/lib-dict/Makefile.am
A	src/lib-dict/dict-fail.c
M	src/lib-dict/dict-private.h

2017-03-17 12:58:08 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (0e7af5e)

    global: Log mailbox_list internal errors


M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/imap/main.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/mail-autoexpunge.c
M	src/plugins/quota/quota-count.c
M	src/plugins/virtual/virtual-config.c
M	src/pop3/pop3-client.c

2017-03-17 12:38:21 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (99b77f8)

    lib-storage: Add mailbox_list_get_last_internal_error()

    This returns the error given to mailbox_list_set_critical().

M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2017-03-22 23:19:51 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (7c75172)

    lib: Download unicode.org files from dovecot.org


M	src/lib-fts/Makefile.am
M	src/lib/Makefile.am

2017-03-17 23:39:33 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (06a7484)

    lib-http: client: Implemented http_client_request_url_str() function that
    accepts an URL string rather than a pre-parsed URL object.

    If the provided HTTP URL is invalid, the callback with the error is called
    some time later from the ioloop. This change also amends the
    test-http-client-errors test suite with a new test for this new feature.

M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h
M	src/lib-http/test-http-client-errors.c

2017-03-17 23:51:19 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (452cc7b)

    lib-http: client: Make sure a request's log label never gets a duplicate
    request target part.

    Make sure the URL part of the label always only consists of a
    http://host:port part and nothing more.

M	src/lib-http/http-client-request.c

2017-03-17 23:35:55 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (7b84629)

    lib-http: client: Restructured the handling of delayed errors.

    The req->delayed_error* fields are cleared before the callback is called and
    before the request is dereferenced. This way, freeing the request never
    removes it from the delayed request list when the list is being processed. 
    It also makes it possible to resubmit the request from the callback (mainly
    for future use).

M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c

2017-03-17 23:18:52 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (4d57187)

    lib-http: client: Clear request pointer immediately in
    http_client_request_error().


M	src/lib-http/http-client-request.c

2017-03-17 23:00:42 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (62852b8)

    lib-http: test-http-client-errors: Added test for using https:// while SSL
    is not configured.


M	src/lib-http/test-http-client-errors.c

2017-03-19 15:47:41 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (6da637f)

    global: Use http_response_get_message() to log HTTP responses.


M	src/auth/auth-policy.c
M	src/lib-http/http-client-connection.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts/fts-parser-tika.c
M	src/plugins/push-notification/push-notification-driver-ox.c

2017-03-19 15:09:03 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (a474158)

    lib-http: Added a function to obtain a message suitable for logging from a
    response object.

    This prevents logging internal error codes (>= 9000).

M	src/lib-http/http-response.h

2017-03-19 15:06:13 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (f6d2025)

    lib-http: Explicitly define the start of the range of internal response
    status codes.


M	src/lib-http/http-client.h
M	src/lib-http/http-response.h

2017-03-17 23:03:03 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (07b3070)

    lib-http: test-http-client-errors: Always use the proper error status code
    definitions rather than an integer literal.


M	src/lib-http/test-http-client-errors.c

2017-03-22 09:03:20 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0a812a1)

    doveadm: Send and receive exit codes correctly

    The old code would assume TEMPFAIL for almost everything.

M	src/doveadm/client-connection.c
M	src/doveadm/server-connection.c

2017-03-22 19:21:55 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (37f0284)

    doveadm: Add exit code/string conversion functions


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm.h

2017-03-02 23:12:45 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (e8a8ae0)

    lib-lda: smtp-client: Fixed memory leak of the error message string.


M	src/lib-lda/smtp-client.c

2017-03-02 23:51:45 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (17084e3)

    lib-lda: smtp-client: Fixed cleanup of LMTP client at end of transaction.

    It was not deinitialized, causing a memory leak.

M	src/lib-lda/smtp-client.c

2017-03-02 00:42:13 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (a3a4c12)

    lib-smtp: lmtp-client: Fixed bug in timeout handling.

    The timeout was erroneously stopped when lmtp_client_send() was invoked
    before a connection was established. Once the connection finally got
    established, the timeout was removed. This would cause the client to wait
    indefinitely.

M	src/lib-smtp/lmtp-client.c

2017-03-02 00:03:50 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (14a37c4)

    lib-lda: smtp-client: Make sure only the first error determines the tempfail
    status.

    The client is supposed to stop running the moment the first error occurs.
    However, there is a (very unlikely) possiblity that the encapsulated LMTP
    client issues both an RCPT and DATA error callback in sequence. In that
    case, the second callback should not override the tempfail status of the
    first (the second likely is a tempfail). If the server disconnects right
    after failing the last of at least two recipients, the lmtp-client would
    issue a DATA callback with a disconnection error. The disconnect error would
    set the client->tempfail flag, which caused smtp_client_deinit*() to always
    return -1 in this scenario.

M	src/lib-lda/smtp-client.c

2016-11-05 22:00:09 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (077b350)

    lib-lda: smtp-client: Renamed "smtp_client" parameters to "client" for
    consistency.


M	src/lib-lda/smtp-client.c

2017-03-22 01:05:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fcb3ccf)

    lib: Add missing error handling to o_stream_cork()

    With ostream-file the corking could have called buffer_flush(), which could 
    have failed and set stream_errno, but nothing would set last_failed_errno.

    Fixes: Panic: file ostream.c: line 59 (o_stream_close_full): assertion
    failed: (stream->last_failed_errno != 0)

M	src/lib/ostream.c

2017-03-20 20:21:56 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (9945103)

    lib-dict: Ensure init returns dict


M	src/lib-dict/dict.c

2017-03-10 10:05:14 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2c182e0)

    pop3-login: Add FORWARD for XCLIENT

    This allows passing passdb variables. They are prefixed with forward_ when
    imported to extra fields.

M	src/pop3-login/client.c

2017-03-10 10:04:33 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (870ed05)

    pop3-login: Pass forward_ passdb args using XCLIENT command


M	src/pop3-login/pop3-proxy.c

2017-02-20 20:37:09 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (6ca2c62)

    imap-login: Allow x-forward- to specify forward fields from trusted networks


M	src/imap-login/imap-login-client.c
M	src/imap-login/imap-proxy.c
M	src/login-common/client-common-auth.c

2017-02-20 20:36:58 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (dcdece5)

    auth: Accept forward_fields from auth client


M	src/auth/auth-request.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2017-03-16 13:36:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d9ab909)

    auth: Add auth_fields_import_prefixed


M	src/auth/auth-fields.c
M	src/auth/auth-fields.h

2017-03-14 10:01:51 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ccb936a)

    auth: Support client_id variable

    When imap_id_retain is turned on, contains the client ID request content
    with dovecot special vars removed.

M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request-var-expand.h

2017-03-16 10:01:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7ee65ad)

    imap-login: Forward original client ID to next hop

    This will be done if ID is present.

M	src/imap-login/imap-proxy.c

2017-02-20 19:11:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f1d4d44)

    imap-login: Retain ID request without dovecot specials


M	src/imap-login/imap-login-client.c
M	src/login-common/client-common.h

2017-02-21 14:46:31 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5658aec)

    imap-login: Add option to retain client id

    This should be enabled if client_id is wanted for auth policy

M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-login-settings.h

2017-02-20 18:58:21 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3b3dc40)

    auth: Accept client_id from auth client

    Client ID contains the ID client request string for IMAP.

M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2017-03-09 14:08:40 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f61eac3)

    login-common: Add preproxy pool

    preproxy pool can be used to do allocations that are released once proxying
    starts.

M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/login-proxy.c

2017-01-29 01:03:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9fe890f)

    imapc: Use LOGOUT to cleanly disconnect from server.

    This makes it clearer in the remote server's logs whether the disconnection 
    was intentional or not.

    Use a hardcoded 5 second timeout for LOGOUT. It should be enough time for 
    the server to finish sending the tagged reply.

M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c

2017-03-16 18:46:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7c5caf3)

    lib-storage: Don't reset \Recent flags when rebuilding index

    The recent flags are tracked with first_recent_uid in the header. If the 
    first_recent_uid is valid in the old index, preserve it. This way all mails
    don't show as having \Recent flag.

    This was used by sdbox and mdbox code.

M	src/lib-storage/index/index-rebuild.c

2017-03-16 09:38:59 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (265b99e)

    trash: Move config file to trash user

    Makes static analyser happy

M	src/plugins/trash/trash-plugin.c

2017-03-05 19:45:04 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (a39b5b2)

    lib-http: test-http-server-errors: Fixed logically dead code.

    Problem reported by Coverity.

M	src/lib-http/test-http-server-errors.c

2017-03-02 18:32:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (058ae8d)

    example-config: Update deliver_log_format comment


M	doc/example-config/conf.d/10-logging.conf

2017-03-02 09:15:13 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3ad0449)

    lib-ssl-iostream: Ensure verify_remote_cert is true

    Forgotten in 38424b8081a75be3ef93729fed4d30dbafca5885

M	src/lib-ssl-iostream/iostream-ssl.c

2017-02-20 09:32:15 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d7f6e4a)

    lib-ssl-iostream: Fix ambiguity with SSL settings

     - lib-ssl-iostream as client: Use only allow_invalid_cert. If it's not set,
    verify the server cert.
    - lib-ssl-iostream as server: If verify_client_cert=FALSE, don't ask for the
    client cert. Otherwise, ask for client cert but still allow it if
    allow_invalid_cert=TRUE.

M	src/lib-ssl-iostream/iostream-openssl-context.c

2017-03-01 13:12:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (895a31a)

    imap-hibernate: Avoid using casts


M	src/imap-hibernate/imap-client.c

2017-03-01 09:15:29 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0129697)

    trash: Read settings after namespaces are loaded

    Fixes Panic: file mail-namespace.c: line 709 (mail_namespace_find):
    assertion failed: (ns != NULL)

M	src/plugins/trash/trash-plugin.c

2017-02-27 16:23:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d82bad3)

    master: Try to listen on master socket even if all services couldn't be
    listened to.

    This could happen during a settings reload.

M	src/master/service-listen.c

2017-02-27 16:22:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (64c85d1)

    master: Add missing error logging for master socket listening failure.


M	src/master/service-listen.c

2017-02-27 16:22:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3b5d60f)

    master: Don't crash if master socket couldn't be re-opened after settings
    reload.


M	src/master/service-monitor.c

2017-02-23 11:47:20 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (8f02dfd)

    imap-hibernate: Support userdb in var_expand


M	src/imap-hibernate/imap-client.c

2017-02-26 16:10:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (35b3470)

    lib-index: Fix test-mail-index-transaction-update

    It was broken with TZ=Australia/ACT. Fixing it seems too troublesome, so 
    just use TZ=UTC during the test.

M	src/lib-index/test-mail-index-transaction-update.c

2017-02-26 16:09:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9e3c265)

    lib-index: Minor fix to day_first_uid updating

    mktime() was getting a bit confused around day changes. Giving it only 
    year/month/day makes it less confused.

M	src/lib-index/mail-index-transaction-update.c

2017-03-11 19:20:30 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2f7bf18)

    doveadm: Do not crash doveadm-server if input file missing

    save commands expects valid input file for it to work, if we are not running
    for cli, and input file is not provided, provide EINVAL error to caller via
    i_stream_error.

M	src/doveadm/doveadm-mail.c

2017-03-16 09:36:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (07b2780)

    lib-dcrypt: Add asserts

    Fixes several static analysis reports

M	src/lib-dcrypt/dcrypt-openssl.c

2017-02-27 18:13:54 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (edab7ec)

    lib-storage & imap: add MAIL_ERROR_UNAVAILABLE as [UNAVAILABLE]

    [UNAVAILABLE] is defined in RFC 5530 and we were just missing a MAIL_ERROR_* 
    constant to make use of it.

M	src/doveadm/doveadm-mail.c
M	src/imap/imap-commands-util.c
M	src/lib-storage/mail-error.h

2017-03-08 15:39:34 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (8590275)

    imap, pop3, indexer-worker: Add (deinit) to process title before
    autoexpunging runs.

    lmtp should also do this, but it needs a bit larger changes.

M	src/imap/imap-client.c
M	src/imap/main.c
M	src/indexer/master-connection.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c

2017-03-08 17:09:12 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (cc6a567)

    pop3: Add client.destroyed boolean


M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h

2017-03-13 14:23:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ad50487)

    auth: Auth workers shouldn't return username if it wasn't changed

    This continues the previous fix where username was always added to 
    passdb/userdb cache, even if the username wasn't changed. That could have 
    resulted in wrongly changing usernames if the cache key didn't uniquely 
    identify the user.

M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-worker-client.c
M	src/auth/passdb-blocking.c
M	src/auth/userdb-blocking.c

2017-03-13 13:49:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3b9d623)

    auth: passdb/userdb lookups via auth-worker cached too much of the replies

    Only the fields returned by the lookup itself were supposed to be cached. 
    This was especially problematic if the lookup via auth-worker didn't 
    uniquely identify the user. For example doing a passdb lookup for an 
    attribute shared by multiple users could have caused the reply to contain 
    the previous cached user's all extra fields.

M	src/auth/auth-worker-client.c

2017-03-15 13:29:11 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3c87f3e)

    auth: Properly hide all fields with passwords

    client reply line wasn't hiding all items which contain 'pass' substring.
    This was inconsistent behaviour since elsewhere this was done.

M	src/auth/auth-client-connection.c

2017-03-15 18:20:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4325f1b)

    *-login: Change API for how login_plugins hook into client allocation.

    The previous API worked badly when there were more than one plugin. The
    current behavior works similarly to how mail_plugins work.

M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/main.c

2017-03-13 22:52:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (170f62e)

    cassandra: Treat CASS_ERROR_SERVER_UNAVAILABLE as "write success is
    uncertain"

    Looks like the write could still have actually gone through.

M	src/lib-sql/driver-cassandra.c

2017-03-16 01:22:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (45598d3)

    lib-oauth2: Don't free oauth2_request too early.

    Move the freeing explicitly to only after calling the callback. The previous
    method of freeing it on when http_request was destroyed could have happened
    too early when oauth2_parse_json() called i_stream_unref(), which released
    the last reference to the http_request.

M	src/lib-oauth2/oauth2-introspect.c
M	src/lib-oauth2/oauth2-refresh.c
M	src/lib-oauth2/oauth2-token-validate.c

2017-03-16 01:12:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4662171)

    lib-oauth2: Fix memory leak if HTTP URL parsing fails.

    Also delay calling the callback. The callers don't necessarily expect an 
    immediate callback (auth/db-oauth2.c doesn't).

M	src/lib-oauth2/oauth2-introspect.c
M	src/lib-oauth2/oauth2-private.h
M	src/lib-oauth2/oauth2-refresh.c
M	src/lib-oauth2/oauth2-token-validate.c
M	src/lib-oauth2/oauth2.c

2017-03-16 00:54:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f72a75a)

    auth: oauth2 - cleanup db_oauth2_lookup_callback_t

    db parameter isn't needed, because request->db already contains it. Also
    moved request parameter to be the first.

M	src/auth/db-oauth2.c
M	src/auth/db-oauth2.h
M	src/auth/passdb-oauth2.c

2017-03-16 00:51:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2eea5e3)

    auth: oauth2 - make it easier to see where db_oauth2_callback() is called

    Doesn't fix anything, but places the db_oauth2_callback() calls into the end 
    of _continue() calls so it's clearer that they're always being called 
    exactly once.

M	src/auth/db-oauth2.c

2017-03-16 01:35:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (92709fc)

    auth: oauth2 - Clarify token validation success/valid error handling

    result->error is NULL only if result->success && !result->valid. Also
    !result->success is the more important error handling case. Write out these
    cases explicitly so it's easier to understand.

M	src/auth/db-oauth2.c

2017-03-16 00:42:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (91ae7a2)

    auth: oauth2 - remove db_oauth2_request.failed

    It is an unnecessary duplication of passdb_result.

M	src/auth/db-oauth2.c
M	src/auth/db-oauth2.h
M	src/auth/passdb-oauth2.c

2017-03-16 00:38:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0aa06a2)

    auth: oauth2 - remove db_oauth2_request.result

    It's not a persistent state. When it's set, the callback needs to be called. 
    This way it's more difficult to forget to set it.

M	src/auth/db-oauth2.c
M	src/auth/db-oauth2.h
M	src/auth/passdb-oauth2.c

2017-03-16 00:33:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (693b6f9)

    auth: oauth2 - Template expand failure should be an internal error

    Not the default "password mismatch". Also changed the API to be closer to 
    the other nearby functions.

M	src/auth/db-oauth2.c

2017-03-16 00:32:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3f1dde2)

    auth: oauth2 - make db_oauth2_template_export() static

    It's not used outside db-oauth2.c

M	src/auth/db-oauth2.c
M	src/auth/db-oauth2.h

2017-03-16 00:25:19 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (98fce39)

    auth: oauth2 - introspection lookup error should be internal failure

    Not the default, which is "password mismatch".

M	src/auth/db-oauth2.c

2017-03-16 00:15:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e2065b3)

    auth: oauth2 - Make sure db_oauth2_request.req is set to NULL when it gets
    freed.

    Doesn't fix anything, but makes it clearer that req->req must not be aborted
    anymore after this stage, because it gets freed anyway.

M	src/auth/db-oauth2.c

2017-03-16 00:13:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (68df507)

    auth: oauth2 - Fix aborting auth requests on deinit.

    The auth_request needs to be finished by calling the callback.

M	src/auth/db-oauth2.c

2017-03-06 14:59:46 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (21d083f)

    auth: Do not double-expand key in passdb dict when authenticating

    Broken by 79042f8c

M	src/auth/db-dict.c

2017-03-09 11:32:21 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (319959b)

    *-login: Remove unused client.proxy_state


M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h

2017-03-09 10:48:33 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (c386ebe)

    pop3-login: Remove usage of client.common.proxy_state


M	src/pop3-login/client.h
M	src/pop3-login/pop3-proxy.c

2017-03-09 10:46:36 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (7a69077)

    pop3-login: Log proxy state as human-readable string.


M	src/pop3-login/client.c
M	src/pop3-login/client.h
M	src/pop3-login/pop3-proxy.c
M	src/pop3-login/pop3-proxy.h

2017-03-09 10:41:52 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (e7d9dd0)

    imap-login: Log proxy state as human-readable string.

    Separate sent/received state and log them as strings.

M	src/imap-login/imap-login-client.c
M	src/imap-login/imap-login-client.h
M	src/imap-login/imap-proxy.c
M	src/imap-login/imap-proxy.h

2017-03-09 10:31:39 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (043aa65)

    *-login: Add client.proxy_get_state() for providing human-readable proxy
    state

    If not implemented, it defaults to the old method of returning proxy_state 
    number.

M	src/imap-urlauth/imap-urlauth-login.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/login-proxy.c
M	src/pop3-login/client.c

2017-03-07 14:36:45 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (be66ad9)

    pop3: Set process title before syncing mailbox.

    The syncing could be taking a long time, so it's useful to have the username 
    in the process title during that.

M	src/pop3/pop3-client.c

2017-03-08 10:07:37 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (7d4b3c6)

    imap: If unhibernation fails due to a mailbox error, log the mailbox name.


M	src/imap/imap-state.c

2017-03-08 09:28:14 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (1a7641c)

    imap: When disconnecting due to FETCH failure, include "FETCH" in the log
    message.


M	src/imap/cmd-fetch.c

2017-03-07 18:10:57 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7979af4)

    lib-sasl: Fix xoauth2 data format

    Authentication data was missing user=

M	src/lib-sasl/mech-oauthbearer.c

2017-03-07 10:09:20 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (c9e9cfa)

    db-oauth2: Make sure request is removed only once

    Callback might be called twice.

M	src/auth/db-oauth2.c

2017-03-07 10:08:08 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (1ad3209)

    lib-oauth2: Use http client destroy callback

    Avoids freeing memory early.

    Fixes signal 11 crash in auth

M	src/lib-oauth2/oauth2-introspect.c
M	src/lib-oauth2/oauth2-refresh.c
M	src/lib-oauth2/oauth2-token-validate.c

2017-03-06 13:16:12 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3f97702)

    auth: Apply skips to first passdb

    This is required to apply filters to first passdb, so that mechanism filters
    can be applied.

M	src/auth/auth-request.c

2017-03-03 08:31:50 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (665a208)

    lib-oauth2: Add missing content-type header


M	src/lib-oauth2/oauth2-introspect.c

2016-10-20 12:08:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0217804)

    lib: Added i_strchr_to_next()


M	src/lib/strfuncs.h

2017-03-01 12:29:17 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (081097d)

    fts: Don't add NULL content disposition or type to HTTP header


M	src/plugins/fts/fts-parser-tika.c

2017-02-27 20:40:43 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (de93e95)

    doveadm: Add missing newline to proxy kick output


M	src/doveadm/doveadm-proxy.c

2017-02-27 20:38:43 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (67c6ef1)

    doveadm: Ensure -- is added to command line before positional arguments for
    non-mails commands as well

    Was forgotten from 967efe37d1f10a28c0a086cc5919d4ce8917bed8

M	src/doveadm/doveadm-cmd.c

2017-02-27 19:12:32 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d466d48)

    doveadm: Ensure -- is added to command line before positional arguments

    This prevents parser from choking on dash.

M	src/doveadm/doveadm-mail.c

2017-02-27 19:04:55 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fcbeb4f)

    doveadm: Fix allow-empty-mailbox-name handling

    It was supposed to be handled for metadata commands only.

    Broken in 26c41874cf6019c3e39f0ed630b2a07a92b2635f

M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2017-02-27 14:21:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (649b00f)

    doveadm move: Use mailbox_move() instead of copy+expunge

    This allows for some optimizations to be done.

M	src/doveadm/doveadm-mail-copymove.c

2017-02-27 09:39:06 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (5cd4c53)

    master: add cassandra to printed build options


M	src/master/main.c

2017-02-25 21:47:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8825f7a)

    lib-dcrypt: Replace #if OPENSSL_VERSION_NUMBER with more explicit checks


M	configure.ac
M	src/lib-dcrypt/dcrypt-openssl.c

2017-02-25 21:41:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9a16958)

    lib-dcrypt: Move most of the OpenSSL #if handling to macros

    This avoids #if calls being littered all over the file.

    This change can cause HMAC_CTX_free(NULL) to be called, but that seems to 
    work fine without crashing.

M	src/lib-dcrypt/dcrypt-openssl.c

2017-02-26 15:37:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (316fb8b)

    lib: Fix t_strf*time() unit tests

    Timezone isn't part of the standard struct tm, so %z doesn't necessarily 
    expand as expected outside Linux.

M	src/lib/test-time-util.c

2017-02-26 15:21:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4d884cb)

    dsync: Fix syncing attributes with large values.

    This mainly meant that large Sieve scripts weren't synced properly, because 
    their last_change field was never deserialized, so it was set to 0.

M	src/doveadm/dsync/dsync-ibc-stream.c

2017-02-26 14:32:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (39f751d)

    lazy-expunge: Use mailbox_move() instead of mailbox_copy()

    This allows some optimizations to be performed that are only possible when 
    moving messages.

    It's slightly strange now that mail_expunge() is triggered twice for the 
    same source mail, but lazy_expunge plugin is called very early so most 
    plugins won't see it called twice. Currently only acl plugin sees it, and it
    doesn't care.

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2017-02-24 12:27:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9725765)

    mail-filter: Add missing error handling in ostream-ext-filter


M	src/plugins/mail-filter/ostream-ext-filter.c

2017-02-24 12:17:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9961552)

    auth: Removed dead code from oauth2 mechanism


M	src/auth/mech-oauth2.c

2017-02-24 12:13:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e7b2e59)

    acl plugin: Fix Coverity warning

    Just switch the MALLOC_ADD() parameters, so that arithmetic doesn't get 
    inside a sizeof().

M	src/plugins/acl/acl-cache.h

2017-02-23 19:38:31 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (8c173f2)

    lib-http: client: Fixed i_unreached() failure occurring when a host's list
    of IPs changes while a connection is still pending.

    In that case, the IP of the pending connection may no longer be associated
    with that host. If the IP was not found anymore, the i_unreached() error
    occurred.

M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c

2017-02-23 11:29:17 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (770b0c3)

    auth: Export oauth2 pass_attrs to passdb reply


M	src/auth/db-oauth2.c

2017-02-23 01:24:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7e525eb)

    virtual: Include virtual mailbox name in "Mailbox ID unexpectedly lost"
    error


M	src/plugins/virtual/virtual-sync.c

2017-02-22 15:29:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d02348d)

    lib-storage: Allow mail_storage_set_error() to use existing error_string

    Fixes some code that may be attempting to copy an error from one storage to 
    another, but actually ends up trying to copy within the same storage.

M	src/lib-storage/mail-storage.c

2016-11-01 18:43:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9a19e15)

    lib-mail: istream-attachment-connector now allows msg_size=-1 for "unknown".


M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/istream-attachment-connector.h
M	src/lib-mail/test-istream-attachment.c

2016-11-01 18:42:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (83ba28b)

    lib-mail: Make sure istream-attachment-connector detects wrong mail size.


M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/test-istream-attachment.c

2016-12-23 14:15:49 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (a427bf4)

    lib-mail: Fix memory leak in test-istream-attachment


M	src/lib-mail/test-istream-attachment.c

2016-12-23 13:08:59 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (a540d9c)

    lib-mail: Improve istream-attachment-extractor unit test for EIO errors


M	src/lib-mail/test-istream-attachment.c

2016-12-23 12:59:13 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (e5e1659)

    lib-mail: istream-attachment-extractor - use EIO for internal errors

    These happen only if the attachment writing failed for some reason. The
    input stream itself can't have any errors, so EINVAL isn't proper.

M	src/lib-mail/istream-attachment-extractor.c

2016-12-23 12:56:24 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (7e6a434)

    lib-mail: istream-attachment-extractor - remove unnecessary code

    It's enough to set the stream_errno.

M	src/lib-mail/istream-attachment-extractor.c

2016-11-01 18:35:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f981b71)

    lib: Added i_stream_create_min_sized*()


M	src/lib/istream-sized.c
M	src/lib/istream-sized.h
M	src/lib/test-istream-sized.c

2016-12-23 12:52:45 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (a7ce883)

    lib: istream-sized - consistently set stream_errno=EINVAL if stream is too
    large

    Earlier it was sometimes done and sometimes not, depending on whether the 
    parent istream happened to stop at the expected boundary.

M	src/lib/istream-sized.c

2016-12-23 12:51:41 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (19d66fe)

    lib: istream-sized - set stream_errno=EPIPE if stream is too small


M	src/lib/istream-sized.c
M	src/lib/istream-sized.h
A	src/lib/test-istream-sized.c

2016-12-23 12:26:17 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (6f287dc)

    lib: istream-sized - remove explicit i_error() logging

    The stream_errno is set, so it's the caller's responsibility to log the 
    error. There's no need to log it twice.

M	src/lib/istream-sized.c

2016-05-16 20:17:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f43f9f5)

    lib: istream-sized should log errors with its own name, not parent's name


M	src/lib/istream-sized.c

2016-05-09 11:08:33 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (3d304f6)

    lib: remove failed bool from sized_istream struct

    This is no longer needed as we are now checking for stream_errno also in
    istream.c

M	src/lib/istream-sized.c

2016-11-01 14:47:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (043ee67)

    lib: Added i_stream_create_sized_range()

    This is just a small wrapper to i_stream_create_sized() to specify stream's 
    start offset.

M	src/lib/istream-sized.c
M	src/lib/istream-sized.h

2017-02-22 20:05:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b0cd8e1)

    maildir: Fix checking vsize caching decision in "is this pop3 user?"

    If vsize extension is used, it's practically the same as if vsize's caching 
    decision was YES.

M	src/lib-storage/index/maildir/maildir-mail.c

2017-02-22 20:04:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (45cf4ac)

    pop3c: Remove unnecessarily duplicated code setting vsize to cache

    This is important now that the vsize can be added also to index's vsize 
    extension.

M	src/lib-storage/index/pop3c/pop3c-mail.c

2017-02-22 20:03:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6d520ee)

    pop3c: Prefetched streams didn't call istream_opened() or set virtual_size


M	src/lib-storage/index/pop3c/pop3c-mail.c

2017-02-22 17:45:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (27b2e8b)

    trash plugin: Use correct hook for overriding mail_user vfuncs

    This was always wrong to do, and it crashes after 
    f32382d2da479a4371e08c443679528db37ea988

M	src/plugins/trash/trash-plugin.c

2017-02-22 17:21:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (570fb4d)

    expire plugin: Use correct hook for overriding mail_user vfuncs

    This was always wrong to do, and it crashes after 
    f32382d2da479a4371e08c443679528db37ea988

M	src/plugins/expire/expire-plugin.c

2017-02-22 15:32:19 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5a6d3f5)

    lazy-expunge: Fix error handling for GUID lookups

    If the mail is already expunged, the error should be ignored. In other
    situations the original error string should be preserved as part of the
    logged error message.

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2017-02-22 16:09:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a442399)

    lib-storage: Add missing service_user ref when creating shared mailbox's
    user.

    Was forgotten from d1bf4ae66b8bf3b9e28df1823d6d4adda2b923b6

    Fixes: Panic: file mail-storage-service.c: line 1513
    (mail_storage_service_user_unref): assertion failed: (user->refcount > 0)

M	src/lib-storage/index/shared/shared-storage.c

2017-01-30 21:53:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e591a39)

    lib-mail: Fix message_part_data_is_plain_7bit()

    Content-Type parameters weren't handled exactly right. Broken by recent
    changes.

M	src/lib-mail/message-part-data.c

2017-02-22 13:02:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b61798c)

    quota: Don't log "Internal quota calculation error"

    It's not very informative and we can't give a better error message without 
    changing the APIs. The real error should have been logged already anyway, so
    this is just duplication of an error. I think originally this was added 
    because some backend forgot to log an error.

M	src/plugins/quota/quota-storage.c

2017-02-22 13:30:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (533b300)

    global: Replace mail_storage_service_user_free() with _unref()


M	src/doveadm/doveadm-auth-server.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap/imap-client.c
M	src/imap/main.c
M	src/indexer/master-connection.c
M	src/lda/main.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/plugins/mail-crypt/doveadm-mail-crypt.c
M	src/plugins/mail-crypt/mail-crypt-acl-plugin.c
M	src/plugins/mail-crypt/test-mail-key.c
M	src/plugins/quota/quota-status.c
M	src/pop3/pop3-client.c

2017-02-22 13:28:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (dc59f8c)

    lib-storage: Use refcounting for mail_storage_service_user

    doveadm import was freeing the user too early, which resulted 
    mail_user._service_user pointing to freed memory. More importantly, after
    34512eaad8b1b2f929e6d6e3a2f7252c29fba97b user->set was pointing to already
    freed memory.

M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h
M	src/lib-storage/mail-user.c

2017-02-22 10:44:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (544a392)

    lib-lda: Fix pigeonhole testsuite to not crash


M	src/lib-lda/mail-deliver.c

2017-02-21 22:34:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d89a40c)

    lib: Fix again test-utc-mktime with 32bit time_t


M	src/lib/test-utc-mktime.c

2017-02-21 12:38:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (87e4dd1)

    lib-lda: Fix delivery logging when Sieve performs multiple actions

    Previous code assumed that it would work like:
    - save/copy
    - transaction commit
    - mail_deliver_ctx_get_log_var_expand_table()
    - repeat for transaction 2

    While it really works:
    - transaction 1: save/copy
    - transaction 2: save/copy
    - transaction 1: commit
    - mail_deliver_ctx_get_log_var_expand_table()
    - transaction 2: commit
    - mail_deliver_ctx_get_log_var_expand_table()

    So the cache needs to be stored per transaction. This code still wouldn't 
    work correctly if Sieve saved mails multiple times within the same 
    transaction, but that doesn't happen (at least currently).

M	src/lib-lda/mail-deliver.c

2017-02-21 12:36:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7c6a1de)

    lib-lda: Refactor - mail_deliver_log_update_cache() doesn't need entire
    deliver_ctx


M	src/lib-lda/mail-deliver.c

2017-02-21 12:34:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2d42ba7)

    lib-lda: Refactor - Add struct mail_deliver_mailbox


M	src/lib-lda/mail-deliver.c

2017-02-21 19:55:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1b41f47)

    lib: Fix test-utc-mktime with 32bit time_t


M	src/lib/test-utc-mktime.c

2017-02-21 16:25:48 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (8aa80a3)

    lib-mail: Place input/output of message-date tests in one struct

    Define both input and output of a message date test case in a single struct
    so it is easier to follow and less error prone. Also add some leap second
    tests.

M	src/lib-mail/test-message-date.c

2017-02-21 17:00:14 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (bebf618)

    lib: Place input/output of utc_mktime tests in one struct

    Define both input and output of a utc_mktime test case in a single struct so
    it is easier to follow and less error prone.

M	src/lib/test-utc-mktime.c

2017-02-21 16:25:25 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (fe7e8f4)

    lib: Accept leap second in utc_mktime

    Accept leap second at any time in utc_mktime since utc_mktime is being used
    before applying the timezone offset everywhere.

M	src/lib/test-utc-mktime.c
M	src/lib/utc-mktime.c
M	src/lib/utc-mktime.h

2017-02-21 14:42:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e694444)

    imap: Fix error message in failed FETCH's NO reply.

    This was broken only with the new imap_fetch_failure = no-after setting.

M	src/imap/cmd-fetch.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2017-02-21 15:44:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (95e2c9f)

    imapc: Error handling wasn't setting storage error everywhere.

    This would have used the previous error, which might not have been correct.

M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2017-02-20 15:47:33 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (86f26de)

    lib-index: Unconstifty pointer array

    clang complained about the extra const.

M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction.c

2017-02-20 15:35:02 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d7904f9)

    lib-index: Add missing initialization for chained hooks


M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction.c

2017-02-20 15:28:36 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (58e93ef)

    lib,lib-storage: Move hook building code to lib

    This allows it to be reused elsewhere

M	src/lib-storage/mail-storage-hooks.c
M	src/lib/Makefile.am
A	src/lib/hook-build.c
A	src/lib/hook-build.h

2017-02-20 14:34:25 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0510f81)

    lib-index: Allow multiple hooks for transaction creation


M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction.c

2017-02-21 14:20:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b3443fc)

    lib-storage: Fix mail.access_type for search prefetches


M	src/lib-storage/index/index-search.c

2017-02-21 13:48:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3d0de61)

    lmtp: Fix lmtp_user_concurrency_limit when userdb changes the username

    Anvil LOOKUP was done with the original username, while CONNECT/DISCONNECT 
    was done with the changed username. So LOOKUP always thought that there were
    zero concurrent sessions for the user.

M	src/lmtp/commands.c

2017-02-21 11:55:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9be49ac)

    cassandra: Don't use i_error() from non-main thread

    It will only cause crashes. This was done only if the internal communication
    pipe couldn't be written to, which was pretty unlikely to happen.

M	src/lib-sql/driver-cassandra.c

2017-02-21 13:08:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (08e9445)

    lib-storage: Fix assert-crash on corrupted dovecot.list.index with
    name_id==0

    Fixes: Panic: file hash.c: line 213 (hash_table_insert_node): assertion
    failed: (key != NULL)

M	src/lib-storage/list/mailbox-list-index.c

2017-02-20 19:35:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a79136b)

    lib-storage: Add asserts to make sure lookup_abort is being used correctly.


M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort.c

2017-02-20 19:34:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (228a8ba)

    lib-storage, pop3-migration: Reset lookup_abort before continuing to search

    This doesn't really fix anything right now, but it'll allow adding the 
    asserts in the following commit.

M	src/lib-storage/index/index-mailbox-size.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c

2017-02-21 11:52:59 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7a765d4)

    auth: Make sure tokeninfo or introspection URL is given


M	src/auth/db-oauth2.c

2017-02-21 11:21:19 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7a5813e)

    auth: Make tokeninfo optional

    It is not supported by all OAuth2 solutions

M	src/auth/db-oauth2.c

2017-02-21 11:18:37 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3fe1b91)

    lib-oauth2: Support basic authorization


M	src/lib-oauth2/oauth2-introspect.c
M	src/lib-oauth2/oauth2-refresh.c
M	src/lib-oauth2/oauth2-token-validate.c

2017-02-20 14:50:39 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (522951a)

    lib-lda: Do not involve mail-deliver plugin unnecessarely

    If no mail delivery by LDA/LMTP is being done, do not hook into the process.

    Fixes signal 11 crash with lazy-expunge.

M	src/lib-lda/mail-deliver.c

2017-02-20 14:26:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e0a5e6b)

    lib-compression: Fix test-compression to build without zlib


M	src/lib-compression/test-compression.c

2017-02-20 14:07:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fc036db)

    imap: Revert change to use [PARSE] in FETCH replies.

    Lets leave this for v2.3. Apparently Roundcube has some workarounds that 
    assume [UNKNOWNCTE].

    Partially reverts 8fe64e2af5b6ce7b6ffa6453beaf569dca089e59

M	src/imap/cmd-fetch.c

2017-02-20 09:18:45 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d497151)

    pop3c: Add no pipelining pop3c feature

    This should help with certain broken pop3c servers that advertise that they
    support pipelining but they really don't.

M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-client.h
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-settings.h
M	src/lib-storage/index/pop3c/pop3c-storage.c

2016-05-25 01:57:08 +0200 Stephan Bosch <stephan@dovecot.fi> (2b6a621)

    Partially implemented IMAP SEARCH=X-MIMEPART capability.

    This capability is currently Dovecot-specific.

M	src/lib-storage/Makefile.am
M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/imapc/imapc-search.c
A	src/lib-storage/index/index-search-mime.c
M	src/lib-storage/index/index-search-private.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search-args-cmdline.c
M	src/lib-storage/mail-search-args-imap.c
A	src/lib-storage/mail-search-mime-build.c
A	src/lib-storage/mail-search-mime-build.h
A	src/lib-storage/mail-search-mime-register.c
A	src/lib-storage/mail-search-mime-register.h
A	src/lib-storage/mail-search-mime.c
A	src/lib-storage/mail-search-mime.h
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/test-mail-search-args-imap.c

2017-01-14 13:33:05 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (f884f1b)

    lib-imap: Created test-imap-envelope.


M	src/lib-imap/Makefile.am
A	src/lib-imap/test-imap-envelope.c

2016-12-29 14:02:05 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (097940b)

    lib-imap: imap-envelope: Added function for parsing ENVELOPE from string.


M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-envelope.h

2016-10-26 23:44:47 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (e0837a5)

    lib-imap: Added more comments to imap-bodystructure and imap-envelope.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-envelope.c

2016-10-24 01:45:18 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (d669f76)

    lib-imap: imap-bodystructure: Added support for making
    imap_bodystructure_parse() work without a pre-existing message_part tree.

    It can now create the tree from the BODYSTRUCTURE string itself.

M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
M	src/lib-imap/test-imap-bodystructure.c

2016-10-24 01:01:19 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (40216e4)

    lib-mail: message-part-data: Implemented message_part_data_get_filename().

    Gets the message part's filename if it has any.

M	src/lib-mail/message-part-data.c
M	src/lib-mail/message-part-data.h

2016-10-24 00:19:05 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (353ee3a)

    lib-mail: message-part-data: Renamed struct message_part_envelope_data to
    message_part_envelope.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-envelope.h
M	src/lib-mail/message-part-data.c
M	src/lib-mail/message-part-data.h
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.h

2016-10-23 22:29:49 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (e1ee210)

    lib-imap: imap-envelope: Moved imap_envelope_headers to
    lib-mail/message-part-data as message_part_envelope_headers.


M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-envelope.h
M	src/lib-mail/message-part-data.c
M	src/lib-mail/message-part-data.h
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail-headers.c

2016-10-23 20:05:33 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (11b1d8c)

    lib-imap: imap-bodystructure: Moved message_part_data header parsing and
    query functions to their own module in lib-mail.

    Moved code from imap-bodystructure and imap-envelope.

M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-envelope.h
M	src/lib-imap/test-imap-bodystructure.c
M	src/lib-mail/Makefile.am
A	src/lib-mail/message-part-data.c
A	src/lib-mail/message-part-data.h
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c

2016-10-23 19:47:12 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (efe512e)

    lib-imap: imap-bodystructure: Renamed imap_bodystructure_is_plain_7bit() to
    message_part_data_is_plain_7bit().


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
M	src/lib-storage/index/index-mail.c

2016-10-23 19:00:10 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (ecc6fee)

    lib-imap: imap-envelope: Renamed imap_envelope_parse_header() to
    message_part_envelope_parse_from_header().


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-envelope.h
M	src/lib-storage/index/index-mail-headers.c

2016-10-23 18:10:01 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (b3fe91a)

    lib-imap: imap-evenvelope: Changed imap_envelope_get_field() into a private
    equivalent.


M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-envelope.h

2016-10-23 17:51:59 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (4861794)

    lib-imap: imap-bodystructure: Renamed imap_bodystructure_parse_header() to
    message_part_data_parse_from_header().


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
M	src/lib-imap/test-imap-bodystructure.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c

2016-10-23 17:27:07 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (edb0016)

    lib-imap: imap-bodystructure: Grouped together functions relating to the
    conversion of BODYSTRUCTURE to BODY.

    This only moves code.

M	src/lib-imap/imap-bodystructure.c

2016-10-23 16:50:25 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (b1cb88c)

    lib-imap: imap-bodystructure: Changed struct message_part_body to contain
    fully decoded data.

    Contained unparsed IMAP string data before.

M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
M	src/lib-imap/imap-envelope.c
M	src/lib-storage/index/index-mail.c

2016-10-23 16:49:37 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (3a39bcd)

    lib-imap: imap-envelope: Added function to parse struct
    message_part_envelope_data from parsed imap args.


M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-envelope.h

2016-10-23 14:06:44 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (d6790cf)

    lib-imap: imap-bodystructure: Renamed `d' parameter to `data' in
    parse_content_header() function.


M	src/lib-imap/imap-bodystructure.c

2016-10-23 13:52:10 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (ee7da9a)

    lib-imap: imap-envelope: Removed useless pool field from struct
    message_part_envelope_data.


M	src/lib-imap/imap-envelope.c

2016-10-23 13:50:05 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (34d2e3c)

    lib-imap: imap-bodystructure: Removed useless pool field from struct
    message_part_data.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h

2016-10-23 13:29:43 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (50ace8c)

    lib-mail: Gave message_part_data its own field in struct message_part.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
M	src/lib-mail/message-part.h
M	src/lib-storage/index/index-mail.c

2016-10-23 13:10:11 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (d61ce13)

    lib-imap: imap-bodystructure: Renamed struct message_part_body_data to
    message_part_data.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
M	src/lib-storage/index/index-mail.c

2016-10-23 12:10:44 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (5dc17f0)

    lib-imap: Removed existing envelope parsing function.

    This is currently only used by imaptest. Alternative API is provided in
    later commit.

M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-envelope.h

2017-01-08 12:00:15 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (f507f8b)

    lib-imap: test-imap-bodystructure: Added normalization tests.


M	src/lib-imap/test-imap-bodystructure.c

2017-01-09 02:03:25 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (78915da)

    lib-imap: imap-bodystructure: Allow alternative syntax and omitted optional
    elements in parser input.

    This makes the parser accept any RFC-compliant BODYSTRUCTURE syntax, instead
    of only what Dovecot itself produces. This way the parser could reliably be
    used in the lib-imap-client if ever needed.

M	src/lib-imap/imap-bodystructure.c

2017-01-09 16:29:26 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (c0e6247)

    lib-imap: test-imap-bodystructure: Added more tests.


M	src/lib-imap/test-imap-bodystructure.c

2017-01-09 16:20:29 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (de68ecd)

    lib-imap: test-imap-bodystructure: Improved handing of parse errors.

    Actually show the parse error.

M	src/lib-imap/test-imap-bodystructure.c

2017-01-09 16:16:46 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (f4b7f88)

    lib-imap: test-imap-bodystructure: Added support for more than one test
    case.


M	src/lib-imap/test-imap-bodystructure.c

2017-01-08 22:50:02 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (d02959f)

    lib-imap: imap-bodystructure: Fixed parse error message about invalid
    Content-M5 field.


M	src/lib-imap/imap-bodystructure.c

2017-02-20 01:24:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8f42a89)

    example-config: Add mail_sort_max_read_count setting.


M	doc/example-config/conf.d/10-mail.conf

2017-02-20 01:16:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f6d5c07)

    example-config: Add mail_vsize_bg_after_count setting.


M	doc/example-config/conf.d/10-mail.conf

2017-02-20 01:00:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9ba287f)

    example-config: Add imap_fetch_failure setting.


M	doc/example-config/conf.d/20-imap.conf

2017-02-20 00:26:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2a63de6)

    lib-mail: Fix matched-parameter in HEADER_FILTER_ADD_MISSING_EOH callback

    The matched-parameter in the regular EOH callback is the reverse of what 
    it's in v2.3 tree. So preserve it here.

M	src/lib-mail/istream-header-filter.c

2017-02-19 23:03:40 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (a78382a)

    .gitignore: Fixed location of ignored m4 files.

    Probably got cherry-picked wrong from development branch.

M	.gitignore

2017-02-04 16:15:57 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (f789d8e)

    lib-http: test-http-response-parse: Properly test multiple sequential
    responses.


M	src/lib-http/test-http-response-parser.c

2017-02-19 21:58:54 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (2eaabeb)

    auth: oauth2 mechanism: Fixed implicit boolean expression involving a
    pointer.

    Found with Clang -Wstrict-bool.

M	src/auth/mech-oauth2.c

2017-02-18 05:01:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (37038df)

    lib-storage: Add explicit MAIL_ERROR_LOOKUP_ABORT error

    The MAIL_ERROR_NOTPOSSIBLE was a bit too generic to assume to mean the same 
    thing. It doesn't look like there are any external plugins that break 
    because of this change.

M	src/doveadm/doveadm-mail.c
M	src/imap/imap-commands-util.c
M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/mail-error.h
M	src/lib-storage/mail.c
M	src/pop3/pop3-client.c

2017-02-17 19:29:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (da29d3a)

    lib-storage: Add mail.access_type


M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/mail-storage.h

2017-02-17 19:07:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (89aff52)

    lib-storage: Add mail_sort_max_read_count setting.

    This controls how many slow mail accesses sorting can perform before it 
    fails:

    a NO [LIMIT] Requested sort would have taken too long

    The SORT reply is still returned, but it's likely not correct.

M	src/lib-storage/index/index-sort-private.h
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2017-02-17 18:56:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8c96c6d)

    lib-storage: Add MAIL_ERROR_LIMIT


M	src/doveadm/doveadm-mail.c
M	src/imap/imap-commands-util.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/mail-error.h

2017-02-17 18:32:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (808dfbe)

    imap: If SEARCH/SORT fails but returns some results, send them to client.

    The previous error handling fixes cause SEARCH/SORT to now fail if there are
    any problems reading mails. This change makes the commands still return the
    best known results, so the IMAP client can still use them, even though they
    may not be entirely correct.

M	src/imap/imap-search.c

2017-02-17 18:30:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f565008)

    lib-storage: Fix error handling when searching mails

    Only expunge errors and failures caused by lookup_abort should be ignored. 
    The rest of the mail errors mean that the search result might not be 
    correct. We'll still run the search as fully as possible, but we just return
    an error at the end.

M	src/lib-storage/index/index-search.c

2017-02-17 18:24:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (61b952f)

    lib-storage: Search optimization - avoid parsing message_parts unnecessarily

    If they're not already cached, the mail is parsed twice: once to get the 
    message_parts and again to perform the actual search. The searching can 
    however do the message_parts parsing internally as well.

M	src/lib-storage/index/index-search.c

2017-02-17 18:19:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (af01d7c)

    lib-storage: Fix error handling when sorting mails.

    All errors were treated the same as if message had been expunged. This 
    caused potentially wrong results to be sent to the client without any 
    indication that they're wrong.

M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-private.h
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-sort.h

2017-02-17 16:31:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (75673aa)

    lib-storage: Change vsize calculation to use the new mail_stream_opened

    This avoids calling mail_get_virtual_size() twice and is a bit cleaner 
    approach.

M	src/lib-storage/index/index-mailbox-size.c

2017-02-17 16:20:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0d736be)

    lib-storage: Add mail.mail_stream_opened and .mail_metadata_accessed

    These allow determining after mail_*() calls how efficiently they were 
    performed.

M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage.h

2017-02-17 16:14:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (db102ed)

    lib-storage: Clarify what MAIL_LOOKUP_ABORT_READ_MAIL means.

    It should maybe even be renamed to something clearer.

M	src/lib-storage/mail-storage.h

2017-02-19 01:44:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (143ef74)

    dsync: Don't assert-crash if duplicate attributes are seen

    Just ignore the duplicates. Normally this shouldn't happen, but due to some
    bugs for example a Sieve script could be returned once by doveadm_sieve 
    plugin and another time from mail_attribute_dict.

M	src/doveadm/dsync/dsync-mailbox-export.c

2017-02-19 15:47:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bd612a0)

    imap: Fix running time in tagged command replies.

    The timing information was updated only after command_exec() returned. Most
    of the commands were handled within a single command_exec() though, so at
    the time when tagline was sent the running_usecs was still zero.

    The msecs in ioloop timing was correct though, because it relied only on the
    command start timing info.

M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c
M	src/imap/imap-commands.h

2017-02-19 02:03:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3413b38)

    doveadm: Add explicit mail_storage_init/deinit() calls

    This mainly prevents losing hooks that were registered by doveadm plugins.

    Otherwise what happens is:
    - mail_plugins are unloaded and they unregister their hooks
    - doveadm plugins (e.g. doveadm_sieve) are NOT unloaded
    - mail_storage_deinit() frees all the registered hooks
    - next mail_storage_init() initializes all new hooks
    - All mail_plugins are loaded and they register again their hooks
    - doveadm plugins are NOT re-loaded or re-initialized, so their existing 
    hooks were lost.

M	src/doveadm/doveadm-mail.c

2017-02-19 02:02:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d670659)

    lib-storage: mail_storage_init/deinit() is now reference counted.

    This allows calling them multiple times and only the final deinit frees the 
    data.

M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage.c

2017-02-19 02:01:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c72c403)

    lib-storage: Assert-crash if duplicate internal hooks are added.


M	src/lib-storage/mail-storage-hooks.c

2017-02-19 15:54:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cd7d294)

    fs-posix: Add "no-fsync" parameter.

    This disables calling fdatasync() when fs_write() was done with 
    FS_OPEN_FLAG_FSYNC. Useful for making tests faster.

M	src/lib-fs/fs-posix.c

2017-02-19 14:49:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (099cd74)

    imap: Code cleanup - Remove duplicate flags from imap_fetch_state

    All the cur_flushed, line_partial and line_finished were about the same 
    thing.

M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2017-02-19 14:34:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e42cd94)

    imap: Fix sending UID only when necessary on broken FETCHes.

    b748f91d0677fffaa2208b39ebb6db3aeb2e937b changed UID to be sent for most 
    FETCH replies. There was also some existing code that attempted to do this, 
    but didn't fully work.

    So now:

    1) If there are no non-buffered replies, the entire FETCH response isn't 
    sent.

    2) If the buffer was already flushed and nothing else was sent, add UID to 
    reply. The code paths for handling this are differently for 
    imap_fetch_failure = disconnect-immediately vs others (depending on 
    imap_fetch_cur_failed() return value).

M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2017-02-16 20:39:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f6f4ad6)

    imap: Include info about last command in disconnection log line.

    Only if LOGOUT isn't sent, because that's already visible.

M	src/imap/imap-client.c
M	src/imap/imap-client.h

2017-02-16 20:29:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (687ea5a)

    imap: Code cleanup - Move code to client_command_stats_append()


M	src/imap/imap-client.c

2017-02-16 20:17:32 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f386c50)

    imap: Add imap_client.logged_out at LOGOUT

    This is useful for determining if client did a clean logout

M	src/imap/cmd-logout.c
M	src/imap/imap-client.h

2017-02-16 20:14:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4e7a1d4)

    imap: Code cleanup - move command stats to struct client_command_stats


M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c
M	src/imap/imap-sync.c

2017-02-17 15:46:38 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (58282a7)

    mech-oauth2: Clarify logging


M	src/auth/mech-oauth2.c

2017-02-17 15:45:34 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3fa10ae)

    mech-oauth2: Set user_given=TRUE when username given in OAUTHBEARER


M	src/auth/mech-oauth2.c

2017-02-17 15:44:17 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (333c979)

    mech-oauth2: Fix gs2-header parsing


M	src/auth/mech-oauth2.c

2017-02-19 00:36:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c16c05a)

    lib: Fix assert-crash in unit test.

    Messed up merging.

M	src/lib/test-strfuncs.c

2017-02-13 15:33:21 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (bf1f57d)

    auth: Add oauth2 passdb


M	src/auth/Makefile.am
A	src/auth/db-oauth2.c
A	src/auth/db-oauth2.h
A	src/auth/passdb-oauth2.c
M	src/auth/passdb.c

2017-02-04 23:56:04 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5bad922)

    auth: Add xoauth2 and oauthbearer mechanisms


M	src/auth/Makefile.am
A	src/auth/mech-oauth2.c
M	src/auth/mech.c

2017-02-06 12:56:27 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (cdf00f5)

    auth: Add mechanism filter for passdbs


M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/auth/passdb.c
M	src/auth/passdb.h

2017-02-08 13:06:13 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (cc52a2c)

    auth: Add accessor for passdb template arguments


M	src/auth/passdb-template.c
M	src/auth/passdb-template.h

2017-01-26 10:49:08 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a5e2288)

    lib-oauth2: Add support library for OAUTH2


M	configure.ac
M	src/Makefile.am
A	src/lib-oauth2/Makefile.am
A	src/lib-oauth2/oauth2-introspect.c
A	src/lib-oauth2/oauth2-private.h
A	src/lib-oauth2/oauth2-refresh.c
A	src/lib-oauth2/oauth2-token-validate.c
A	src/lib-oauth2/oauth2.c
A	src/lib-oauth2/oauth2.h

2017-02-14 18:48:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (678cbf4)

    lib-storage: Update vsize header after sync only if sizes are cached.

    The result isn't needed yet in that case, so if it's slow to get the sizes 
    it might as well be delayd until later. This is especially useful when 
    indexer-worker triggers FTS indexing. The vsizes can be added to index after
    the mail is already read for FTS. Without this change the vsize update would
    first open all the mails and then the FTS indexing would open all the mails
    a second time.

M	src/lib-storage/index/index-mailbox-size.c

2017-02-07 16:18:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e4a574f)

    lib-storage: Add mail_vsize_bg_after_count setting.

    If folder vsize calculation requires opening more than this many mails from 
    disk (i.e. mail sizes aren't in cache already), return failure and finish 
    the calculation via indexer process.

    This should be used like:

    protocol !indexer-worker {
     mail_vsize_bg_after_count = 10
    }

M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/plugins/quota/quota-count.c

2017-02-07 13:53:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2dccf7c)

    lib-storage: Don't stop vsize calculation on expunged mails.

    I don't know why I added such logic there in the first place. If we just 
    skip the expunged mails, the end result should still be correct and usable
    when cached.

M	src/lib-storage/index/index-mailbox-size.c

2017-02-15 22:13:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9d2f3c3)

    lib-index: Fix updating mail_index_header.day_first_uid

    If user received a mail every day, the day_first_uid wasn't being updated. 
    This caused wrong caching decisions to be made in dovecot.index.cache:

     - Accessing >1 week old emails should have changed caching decision from
    "tmp" to "yes". This might not have happened, although as long as 
    day_first_uid[7] pointed to an existing mail and email client accessed all
    the mails, this wouldn't have changed anything.

     - Cache compression is supposed to drop >1 week old mails when caching 
    decision is "tmp". Not enough mails were being dropped because 
    day_first_uid[7] pointed to a much older than 1 week old mails.

    Also added a unit test to make sure this works.

    Broken by d9ee2f9fb3ef7b9391bfeeff1b374aead51667aa

M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/test-mail-index-transaction-update.c

2017-02-15 22:12:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fbfcbf3)

    lib-index: Add day_stamp parameter to mail_index_update_day_headers()

    This will help creating a unit test.

M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/test-mail-index-transaction-finish.c

2017-02-15 18:20:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4decb8c)

    lib-storage: Re-open mailbox after it's undeleted.

    This is needed with mailbox formats that didn't fully open the mailbox while 
    it was undeleted.

M	src/lib-storage/mail-storage.c

2017-02-15 18:18:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fdaba55)

    lib-storage: Don't sync mailbox after undeleting it.

    This is useful only when deleting it. With undeletion the syncing isn't 
    useful and might actually be harmful with mailbox formats that didn't fully
    open the mailbox while it was undeleted.

M	src/lib-storage/mail-storage.c

2017-02-15 18:05:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0f3f732)

    lib-storage: Make sure mailbox undeletion won't go to infinite loop


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2017-02-15 23:32:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7bf7bc9)

    mail-log: Add mail_log_cached_only setting.

    If enabled, everything except "save" event will log only the fields that can 
    be looked up from cache. This improves performance if some of the fields 
    aren't cached and it's not a strict requirement to log them.

M	src/plugins/mail-log/mail-log-plugin.c

2017-02-15 13:46:06 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (d177753)

    lib-imap-client: pass the reply text to the auth-failed state change
    callback


M	src/lib-imap-client/imapc-connection.c

2017-02-15 09:13:05 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (b9838d5)

    lib-imap-client: invoke state change callback on "authentication success"


M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c

2017-02-15 09:12:35 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (4231957)

    lib-imap-client: add callback to notify consumers about state changes

    Add a callback to notify imapc users about failures.  Currently, the only 
    failure defined is "authentication failed".

M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c

2017-02-14 08:58:10 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (934dc5b)

    lib-imap-client: centralize authentication failed error logging


M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-storage.c

2017-02-04 15:40:41 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (992657a)

    lib-http: response parser: Drop previous response's pool immediately when
    parsing continues.

    Prevously, it would only do that when the first byte of the next response
    was received. This prevents wasting memory when no response is being parsed.

M	src/lib-http/http-response-parser.c

2017-02-04 16:21:51 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (968c754)

    lib-http: response parser: Always clear response to prevent referring to
    stale data.


M	src/lib-http/http-response-parser.c

2017-02-04 13:59:10 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (6f56bdf)

    lib-http: message parser: Don't allocate a pool for the next message until
    it is needed.

    This prevents wasting memory when no message is being parsed.

M	src/lib-http/http-message-parser.c
M	src/lib-http/http-message-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c

2017-02-04 14:11:36 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (2a1e57b)

    lib-http: message parser: Delay allocation of message header.


M	src/lib-http/http-message-parser.c

2017-02-04 14:03:25 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (b3bfde7)

    lib-http: message parser: Don't create the connection_options array, unless
    it is actually used.


M	src/lib-http/http-message-parser.c
M	src/lib-http/http-request.c

2017-02-14 17:35:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bf70b41)

    lib-mail: Fix duplicate HEADER_FILTER_ADD_MISSING_EOH callback call

    If headers weren't modified, the second reading of the istream shouldn't 
    call any callbacks.

M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2017-02-15 00:08:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (708ff40)

    doveadm: Added "mailbox path" command

    This allows easily printing a path for a mailbox, index, control dir, etc.

M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2017-02-14 20:23:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (28f1862)

    lib-lda: Code cleanup - remove unnecessary dest_mail check


M	src/lib-lda/mail-deliver.c

2017-02-14 20:20:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a4806a6)

    lib-lda: Don't set mail_deliver_context.dest_mail too early.

    It must be NULL for the caller, unless save_dest_mail==TRUE

M	src/lib-lda/mail-deliver.c

2017-02-13 20:49:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cacc4f8)

    lib-lda: Implement %{storage_id} correctly


M	src/lib-lda/mail-deliver.c

2017-02-13 20:47:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0f196b4)

    lib-lda: Fix deliver_log_format variables with Sieve

    With Sieve it was using src_mail for getting the values, which weren't 
    correct especially if Sieve had modified the mail.

M	src/lda/main.c
M	src/lib-lda/Makefile.am
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h
M	src/lmtp/main.c

2017-02-13 20:46:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d19c444)

    lib-lda: Code cleanup - mail_deliver_open_mail() now uses uid parameter


M	src/lib-lda/mail-deliver.c

2017-02-13 20:44:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (db8465f)

    lib-lda: Remove %{storage_id} setting for now.

    It doesn't work with Sieve. The following patches add it back properly.

M	src/lib-lda/mail-deliver.c

2017-02-17 11:25:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6033462)

    lib-lda: Redesign mail_deliver_context.var_expand_table cache


M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h

2016-04-27 13:06:52 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (051cf2c)

    lib-lda: remove forced logging of session_id


M	src/lib-lda/mail-deliver.c

2017-02-09 18:01:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3c8711e)

    lib-lda: Remove unused mail_deliver_get_log_var_expand_table()


M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h

2017-02-17 11:17:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e9744a9)

    lib-lda: Initialize var_expand_tab[] directly.

    This is a partially pick from acfda38b75d0f0e899ef692fef01593bd56ed85e to be
    able to cherry-pick the following patches more easily.

M	src/lib-lda/mail-deliver.c

2017-02-09 18:49:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (99e60a2)

    lib-lda: Avoid using mailbox_save_set_dest_mail()


M	src/lib-lda/mail-deliver.c

2017-02-09 18:46:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4c3958a)

    lib-storage: Add mailbox_save_get_dest_mail()

    This marks mailbox_save_set_dest_mail deprecated. It's not efficient to use 
    since it frees the already-created dest_mail.

M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2017-02-13 20:23:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6816dcc)

    virtual: Fix saving to a virtual mailbox to work again

    Previous changes broke it.

M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-storage.h

2017-02-09 17:18:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (18bfb2a)

    plugins: Remove unnecessary mail_save_context.dest_mail==NULL checks

    It can never be NULL after the previous change: "lib-storage: Always create 
    mail_save_context.dest_mail".

M	src/plugins/notify/notify-storage.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/zlib/zlib-plugin.c

2017-02-09 17:14:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7c9cb63)

    lib-storage: Remove unnecessary mail_save_context.dest_mail==NULL checks

    It can never be NULL after the previous change: "lib-storage: Always create 
    mail_save_context.dest_mail".

    The code removal in maildir_transaction_save_commit_pre() seemed potentially
    dangerous, but I don't think such code path is possible anymore. Also even
    if it is, it's probably fine since the mail_free() is called even earlier
    than before (although that itself might have been a problem).

    This also removes last traces of code that made it possible to save mails to 
    mbox without assigning UID to the mail. The previous commit already caused 
    this, so this is just removing dead code.

M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-save.h
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-sync-private.h
M	src/lib-storage/index/mbox/mbox-sync.c

2017-02-09 16:53:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ef88cf8)

    lib-storage: Always create mail_save_context.dest_mail

    This allows removing similar mail_alloc() from storage backends and plugins 
    that need it.

    As a side effect, this changes mbox code to always assign UIDs to saved 
    mails. This shouldn't be much of a problem, since it happened practically 
    always already.

M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2017-02-09 16:34:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9fbca08)

    lib-storage: Fix mailbox list index hook usage

    The previous method appeared to work, but not if the internal hooks were 
    used more than once.

M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2017-02-14 10:42:26 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (70bc7ec)

    lib-index: zero mmap_length after logging error

    Logging that mmap(size=0) failed looks suspicious.

M	src/lib-index/mail-cache.c

2017-02-13 19:40:22 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2ffab54)

    mail-crypt: Do not restrict access in unit test

    This works around problem with docker

M	src/plugins/mail-crypt/test-mail-key.c

2017-02-14 10:54:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b627d2a)

    lib: Clarify *_strsplit_spaces() and add unit test


M	src/lib/strfuncs.h
M	src/lib/test-strfuncs.c

2017-02-13 23:46:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a108b91)

    lib: Add pool_alloconly_create_clean()

    This partially reverts 2a2beae3a4c1e75b3aeff996781503138e6f24bc

M	src/lib/mempool-alloconly.c
M	src/lib/mempool.h

2017-02-13 20:02:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9eb09de)

    LAYOUT=index: Fix duplicate mailbox name renaming to actually work


M	src/lib-storage/list/mailbox-list-index.c

2017-02-13 20:01:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (27ec469)

    LAYOUT=index: Rename mailbox_list_index_node.corrupted_parent to
    corrupted_ext

    The code will be useful for other purposes also besides updating corrupted 
    parents.

M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2017-01-31 19:43:30 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (cc42a09)

    driver-cassandra: Add support for speculative execution


M	configure.ac
M	src/lib-sql/driver-cassandra.c

2017-02-08 12:03:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (583320b)

    lib-index: Add MAIL_INDEX_OPEN_FLAG_NO_DIRTY

    This way mailbox format backends that don't need dirty flags can use them 
    for other purposes.

M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index.h

2017-02-10 16:26:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c92338c)

    cassandra: Track query counts internally and include them in metrics


M	src/lib-sql/driver-cassandra.c

2017-02-13 18:06:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (391e998)

    lib-compress: Fix missing .gz header error message


M	src/lib-compression/istream-zlib.c

2017-02-13 18:05:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e72d13f)

    lib-compress: Fix assert-crash when .gz header size exceeds buffer max
    length

    Instead treat the stream as corrupted and return EINVAL.

    Fixes: Panic: file istream.c: line 182 (i_stream_read): assertion failed:
    (_stream->skip != _stream->pos)

M	src/lib-compression/istream-zlib.c
M	src/lib-compression/test-compression.c

2017-02-10 15:27:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ea6a744)

    lib-http: http_client_request_add_header() - Add key/value asserts

    These don't check that they're entirely correct as required by HTTP 
    specifications. They're mainly there as a quick check that if the caller 
    didn't validate the key/value in any way, we'll crash instead of creating a
    potential security hole. (Because with line feeds the attacker could add
    extra headers or even entirely new HTTP requests.)

M	src/lib-http/http-client-request.c

2017-02-13 09:09:28 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (77486ef)

    lib-index: clear file->mmap_size only after logging it

    Logging the error with size=0 loses information.

M	src/lib-index/mail-transaction-log-file.c

2017-02-13 09:08:25 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (bae12f8)

    lib-index: don't reset ioloop_time on mmap error

    The variables seems to have been in the wrong order.

M	src/lib-index/mail-transaction-log-file.c

2017-02-08 12:47:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f2ecd42)

    quota: Log why quota_over_flag check is skipped if mail_debug=yes


M	src/plugins/quota/quota.c

2017-02-07 15:46:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f51b1ce)

    quota: If quota_over_script is unset, skip the quota_over check.


M	src/plugins/quota/quota.c

2017-02-07 15:44:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (23a6d2d)

    quota: If quota_over_flag_value is unset, skip the quota_over check.


M	src/plugins/quota/quota.c

2017-02-07 15:33:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (da01950)

    quota: Remove quota_over_flag_* from quota_root.

    They are used only in one specific location and don't need to be stored 
    permanently.

M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2017-02-10 13:17:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fe529b2)

    global: Add asserts to make static analyzer happier.


M	src/auth/db-ldap.c
M	src/doveadm/doveadm-mail-index.c
M	src/lib-auth/auth-master.c
M	src/lib-fs/fs-posix.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/mail-autoexpunge.c
M	src/lib/file-dotlock.c
M	src/lib/iostream-temp.c

2017-02-10 13:15:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a3fbc77)

    pop3-login: Code cleanup - Make sure destroying client stops processing.

    It would currently do it in any case, but this makes it clearer.

M	src/pop3-login/client.c

2017-02-10 13:15:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7abf8f2)

    global: Ignore unnecessary return values.


M	src/imap-urlauth/imap-urlauth-worker.c
M	src/plugins/virtual/virtual-storage.c

2017-02-10 13:13:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2ed6bdb)

    mail-filter: Handle handshake write() failure


M	src/plugins/mail-filter/istream-ext-filter.c

2017-02-10 12:50:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (edeae7f)

    fts: Fix crash using fts_autoexpunge_exclude = \Special-use crash

    It crashed whenever seeing a mailbox that didn't have any special-use flags.

M	src/plugins/fts/fts-storage.c

2017-02-10 12:46:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b2a28ae)

    doveadm mailbox metadata list: Fix listing all metadata.

    It was listing only private attributes, because key_type=0 happens to be 
    MAIL_ATTRIBUTE_TYPE_PRIVATE and key was never NULL.

M	src/doveadm/doveadm-mail-mailbox-metadata.c

2017-02-10 12:41:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a215689)

    mail-crypt-acl: Fix error handling

    Don't crash if mail_user creation failed.

M	src/plugins/mail-crypt/mail-crypt-acl-plugin.c

2017-02-10 12:40:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3a42316)

    doveadm mailbox cryptokey generate: Fix error handling

    Don't crash if mail_user creation failed.

M	src/plugins/mail-crypt/doveadm-mail-crypt.c

2017-02-10 12:33:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (247f01b)

    doveadm mailbox cryptokey generate: Fix memory leak

    dest_user was set to NULL, but never freed.

M	src/plugins/mail-crypt/doveadm-mail-crypt.c

2017-02-10 12:09:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2b46706)

    doveadm director map: Fix checking if host parameter is required


M	src/doveadm/doveadm-director.c

2017-02-10 11:58:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (87c56d0)

    lib: Avoid unnecessary Coverity warnings in MALLOC_*()

    There doesn't seem to be any other nice way of avoiding these without 
    separately marking every instance.

M	src/lib/malloc-overflow.h

2017-02-09 16:33:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d3d515c)

    TODO: Remove some of the implemented features


M	TODO

2017-02-06 18:34:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (df745bd)

    sdbox: Fix assert-crash on mailbox create race

    If another process created the mailbox at the same time, the mailbox_guid 
    wasn't set and opening the mailbox assert-crashed:

    Panic: file mail-storage.c: line 1744 (mailbox_get_metadata): assertion
    failed: ((items & MAILBOX_METADATA_GUID) == 0 ||
    !guid_128_is_empty(metadata_r->guid))

M	src/lib-storage/index/dbox-single/sdbox-storage.c

2017-02-07 21:07:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (aabb256)

    quota: Clarify quota_count() return value.


M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-private.h

2017-02-07 20:41:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a3eb846)

    quota: Make sure quota_warning doesn't wrap "quota before" value.

    This could happen in some race conditions (and with bugs).

M	src/plugins/quota/quota.c

2017-02-07 18:26:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1e2f5bf)

    quota: When executing quota_warning/over_flag script, log the reason why.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-util.c
M	src/plugins/quota/quota.c

2017-02-07 13:19:17 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (1cf6991)

    lib: Check that output max size is non-zero when version specified

    Otherwise we try to send version to non-existent output stream.

M	src/lib/connection.c

2017-01-22 13:40:00 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (77643f9)

    lib-storage: Added mail_user_init_ssl_client_settings().


M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2016-12-28 12:02:14 -0600 johnkwoods <john.woods@greatplainsmfg.com> (0167220)

    lib-ldap: Remove extra return

    The ldap_connection_queue_request() function returns void. Trying to
    "return" something from a void function caused compiling issues on Solaris
    (Oracle Developer Studio 12.5).

M	src/lib-ldap/ldap-compare.c

2017-01-22 17:24:02 -0600 J. Nick Koston <nick@cpanel.net> (d1c7804)

    fts-solr: Allow username/password for solr connction

    Solr comes open to the world by default. For better security, we protect our
    solr installs with a user and password.  This change allows dovecot to
    connect to these instances.

    Example usage in a fts.conf (permissions 0600)
    fts_solr = url=http://nick:pass@127.0.0.1:8983/solr/dovecot/

M	src/plugins/fts-solr/solr-connection.c

2017-02-08 23:01:32 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (53a4f7f)

    pop3c: Increase timeout for PASS to 5 minutes.


M	src/lib-storage/index/pop3c/pop3c-client.c

2017-02-06 14:05:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3b1a82e)

    indexer: Don't send more requests directly from worker status callback

    This causes assert-crashes when workers disconnect while having multiple 
    requests:

    indexer: Error: Indexer worker disconnected, discarding 2 requests for
    user@domain indexer: Panic: file indexer.c: line 69 (queue_try_send_more):
    assertion failed: (worker_connection_is_connected(conn))

M	src/indexer/indexer.c

2017-02-05 16:49:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f617072)

    imap: Add imap_fetch_failure setting

    This controls what happens when FETCH fails for some mails. The possible 
    values are:

    disconnect-immediately: This is the original behavior. Whenever FETCH fails
    for a mail, the FETCH is aborted and client is disconnected.

    disconnect-after: The FETCH runs for all the requested mails, skipping any
    mails that returned failures, but at the end the client is still 
    disconnected.

    no-after: The FETCH runs for all the requested mails, skipping any mails 
    that returned failures. At the end tagged NO reply is returned. If the 
    client attempts to FETCH the same failed mail more than once, the client is
    disconnected. This is to avoid clients from going into infinite loops trying
    to FETCH a broken mail.

M	src/imap/cmd-fetch.c
M	src/imap/imap-client.h
M	src/imap/imap-commands-util.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h
M	src/imap/imap-settings.c
M	src/imap/imap-settings.h

2016-05-02 13:26:05 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (8fe64e2)

    lib-imap, imap: BINARY [UNKNOWNCTE] to [PARSE]


M	src/imap/cmd-fetch.c
M	src/lib-imap/imap-resp-code.h

2017-02-05 16:24:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e1997d4)

    imap: Share mailbox closing code in SELECT/UNSELECT/CLOSE/LOGOUT/deinit


M	src/imap/cmd-close.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-select.c
M	src/imap/cmd-unselect.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h

2017-02-05 16:23:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7b87f61)

    imap: Free search updates on CLOSE


M	src/imap/cmd-close.c

2017-02-05 16:10:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (17b83d9)

    imap: Don't send empty FETCH () on failure

    It violates IMAP RFC. Send FETCH (UID n) instead.

M	src/imap/imap-fetch.c

2017-02-06 11:02:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9b1bec8)

    lib-ssl-iostream: Fix memory leak in RSA_generate_key_ex() usage


M	src/lib-ssl-iostream/iostream-openssl-context.c

2017-02-06 11:23:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (48fde2a)

    auth: Handle delayed credentials identically in auth-workers


M	src/auth/auth-request.c

2017-02-06 10:55:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2c4a553)

    lib: Make sure NULL is defined to be ((void *)0)

    This avoids us having to do explicit (void *)NULL casts in e.g. io_add(...,
    NULL) context parameter.

M	src/lib/compat.h

2017-02-04 13:51:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b5e88b7)

    lib-storage: Don't duplicate service user's settings into mail_user

    The mail_storage_service_user.user_set isn't used afterwards, so it can be 
    directly used to avoid wasting memory.

M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2017-02-04 13:38:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (518b81b)

    lib-storage: Don't unnecessarily duplicate user's all setting strings

    user->unexpanded_set and user->set have the same life-time, so they can 
    point to same strings.

M	src/lib-storage/mail-user.c

2017-02-05 20:29:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (313edff)

    lib-ssl-iostream: Remove libdovecot_openssl_common.la

    Using such a library results in the same code being duplicated (in OSX) in 
    both libssl_iostream_openssl.so and libdcrypt_openssl.so.  This breaks the 
    idea of openssl_init_refcount, because each one will have their own one.

    libdcrypt_openssl.so now links to libssl_iostream_openssl.so, which 
    shouldn't really be a problem, because lib-ssl-iostream is part of the core 
    libdovecot.so already. It would have been possible to also install 
    libdovecot_openssl_common.so and link it to both libssl_iostream_openssl.so 
    and libdcrypt_openssl.so, but that seems unnecessarily complicated.

M	src/lib-dcrypt/Makefile.am
M	src/lib-ssl-iostream/Makefile.am

2017-02-05 20:28:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f82283c)

    lib-ssl-iostream: Remove empty $(ssl_sources) from Makefile


M	src/lib-ssl-iostream/Makefile.am

2017-02-05 20:26:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0f3542d)

    lib-dcrypt: Link unit tests with libssl_iostream.la

    libssl_iostream_openssl.so requires this, and it doesn't get added from 
    anywhere automatically.

M	src/lib-dcrypt/Makefile.am

2017-02-05 20:24:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6ceb810)

    lib-dcrypt: Remove unnecessary -shared link flag

    Not sure if this is harmful, but since no other plugin uses this it's not 
    needed either.

M	src/lib-dcrypt/Makefile.am

2017-02-05 20:22:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (25bc04e)

    lib-dcrypt: Don't link liblib.la to libdcrypt_openssl.so

    At best this does nothing, at worst (like with OSX) it duplicates the entire
    liblib and creates split state between the two instances.

M	src/lib-dcrypt/Makefile.am

2017-02-05 20:20:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9483ccd)

    lib-dcrypt: If dcrypt can't be initialized, log also the reason.

    This is very helpful when debugging linking issues.

M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2017-02-05 21:38:33 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5f07a06)

    lib-ssl-iostream: Detect whether to call ERR_remove_[thread_]state() via
    configure


M	configure.ac
M	src/lib-ssl-iostream/dovecot-openssl-common.c

2017-02-05 21:31:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5cc5edf)

    lib-ssl-iostream: Call OBJ_cleanup() for all OpenSSL versions

    Just to reduce the #if checks that uglify the code.

M	src/lib-ssl-iostream/dovecot-openssl-common.c

2017-02-05 21:10:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (92ae85d)

    lib-ssl-iostream: Detect OPENSSL_cleanup() via configure

    It's ugly to have both OpenSSL version number check and a special LibreSSL 
    check.

M	configure.ac
M	src/lib-ssl-iostream/dovecot-openssl-common.c

2017-02-05 21:04:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6c74870)

    lib-ssl-iostream: Detect OpenSSL memory functions' parameters via configure

    The version number check doesn't work correctly for LibreSSL.

M	configure.ac
M	src/lib-ssl-iostream/dovecot-openssl-common.c

2017-02-05 21:56:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (905553c)

    lib-ssl-iostream: Use ASN1_STRING_get0_data() if it exists

    This avoids deprecation warnings about ASN1_STRING_data() in OpenSSL v1.1.

M	configure.ac
M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl.h

2017-02-05 21:51:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8adfdb0)

    lib-ssl-iostream: Use RSA_generate_key_ex() if it exists

    This avoids deprecation warnings about RSA_generate_key() in OpenSSL v1.1.

M	configure.ac
M	src/lib-ssl-iostream/iostream-openssl-context.c

2017-02-06 00:11:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d03fb40)

    dict-sql: Move USING TIMESTAMP to correct location for INSERTs


M	src/lib-dict/dict-sql.c

2017-02-06 00:48:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8e89229)

    auth: Pass through passdb extra fields to auth-worker requests


M	src/auth/auth-request.c

2017-02-06 00:46:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d906a02)

    auth: Code cleanup - Move userdb extra fields exporting to its own function


M	src/auth/auth-request.c

2017-01-25 23:26:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9c65e86)

    lib-storage: Expunging now uses GUID only if it's in cache.

    Otherwise the GUID lookup may be expensive, which is especially bad when 
    deleting a large number of mails.

M	src/lib-storage/index/index-mail.c

2017-02-03 19:40:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ab14fa8)

    lib-storage: Fix autoexpunge locking to actually work correctly.

    It wasn't actually skipping the autoexpunging if the lock already existed. 
    It autoexpunged anyway.

M	src/lib-storage/mail-autoexpunge.c

2017-02-03 14:22:02 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (921f061)

    fts: Use mailbox_list_created hook

    Otherwise the deinit hook might get lost and fts would not be deinitialized.

    Reverts 11f12ca1c97583b551a4286fa6cd1ab33aa67680 which seems to have been
    unnecessary

    Fixes indexer-worker signal 11 crash

M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h

2017-02-03 16:16:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (24ffb6a)

    lib-storage: Once hooks have run, set vlast to NULL to make sure it's not
    used

    The functions can't be correctly overridden outside their own specific 
    hooks. It would work only if hook_build_update() is called afterwards and 
    currently there's no public API for that.

M	src/lib-storage/mail-storage-hooks.c

2017-02-04 10:42:21 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7954017)

    lib-storage: Put vsize in index only if it's not there


M	src/lib-storage/index/index-mail.c

2017-01-30 21:28:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3145333)

    lib-storage: Add assert to make sure header parsing isn't recursed


M	src/lib-storage/index/index-mail-headers.c

2017-02-02 01:36:50 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (2444e60)

    lib-http: client: Fixed peer reconnection failure handling.

    The addressed problem occurs in a very specific situation in which the
    original successful connection is dropped, yet a new connection fails. It
    manifests as an assertion failure or panic:

    Panic: file ioloop-epoll.c: line 189 (io_loop_handler_run_internal):
    assertion failed: (msecs >= 0) Panic: BUG: No IOs or timeouts set. Not
    waiting for infinity.

    The timing is very critical. However, this doesn't mean that the occurrence
    of this problem is very unlikely; it can happen frequently under high load.

M	src/lib-http/http-client-queue.c
M	src/lib-http/test-http-client-errors.c

2017-02-02 01:34:35 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (504701e)

    lib-http: client: Respect the connection idle timeout, even when all queues
    have unlinked from a peer.

    Otherwise, the DNS TTL timeout dictates the connection idle timeout in some
    situations.

M	src/lib-http/http-client-peer.c

2017-02-02 11:47:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (89b0207)

    dict: Fix error logging if TIMESTAMP parameters are wrong.


M	src/dict/dict-commands.c

2017-02-02 11:32:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (eb4f493)

    dict-sql: Add missing USING TIMESTAMP for DELETE queries


M	src/lib-dict/dict-sql.c

2017-01-31 21:03:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (544cbb9)

    imap: Fix panic on FETCH X-MAILBOX in virtual mailbox when mail is expunged


M	src/imap/imap-fetch.c

2017-01-31 13:41:48 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (7a8d8f4)

    lib-http: server: Fix premature connection destroy in
    http_server_connection_output().

    Added a reference to the connection object while it is sending the remainder
    of a response's payload. This is necessary, since
    http_server_response_send_more() can destroy the connection, for example
    when the request has a "Connection: close" header. This will only occur for
    responses with a very large payload, because otherwise the payload is fully
    sent in in the initial pass.

M	src/lib-http/http-server-connection.c

2017-01-09 23:13:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f0707a5)

    lib-storage: When logging corrupted mail size, disable logging Message-ID
    for now

    This was causing crashes in some situations. It was originally added to 
    figure out if there were problems with dovecot.index.cache containing data
    for wrong messages. This was never found to happen, although now thinking
    about it, the problem may have been 
    741287129c22cadc14c05584704685b31169dbce. So perhaps this code could be 
    removed permanently as well.

    6b44fc75c0039d1006ce4d543544552449b8e229 also attempted to fix this, but it 
    wasn't enough. There was still some code path that lead to recursive header 
    parsing.

M	src/lib-storage/index/istream-mail.c

2017-01-30 15:12:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3fce0ce)

    lib-storage: Set vsize extension when copying mails.


M	src/lib-storage/index/index-storage.c

2017-01-30 15:11:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (744bfcf)

    lib-storage: Add index_mail_get_vsize_extension()


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2017-01-30 15:06:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (107df47)

    lib-storage: Move index_mail.vsize_ext_id to mailbox.mail_vsize_ext_id

    It's mailbox-specific, so it doesn't have to be looked up every time. Also
    this is needed for the following fix.

M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-private.h

2016-12-14 18:13:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f4917b1)

    imapc: Allow using LAYOUT=none without crashing.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c

2017-01-29 00:24:33 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (987cf37)

    imap: Don't unregister internal commands at deinit.

    This allows plugins to unregister commands without errors being logged.

M	src/imap/imap-commands.c

2017-01-26 22:42:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0188882)

    lib-storage: Lock autoexpunging so only a single process does it.

    This hopefully helps to avoid duplicates with lazy_expunge plugin.

M	src/lib-storage/mail-autoexpunge.c

2017-01-29 01:08:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (aff4ade)

    imap: Use struct mailbox_status.flags for FLAGS reply


M	src/imap/imap-commands-util.c

2017-01-29 01:06:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8b17a7d)

    lib-storage: Add struct mailbox_status.flags

    This is similar to permanent_flags, except it tells which flags can be 
    changed at all in the session. Mainly it allows plugins to make changes to 
    IMAP's untagged FLAGS reply.

M	src/lib-storage/index/index-status.c
M	src/lib-storage/mail-storage.h

2017-01-27 21:36:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f78adb9)

    lib: io_loop_set_current() - do nothing if ioloop doesn't change

    There's no need to call the switch callbacks if the ioloop doesn't change.

M	src/lib/ioloop.c

2017-01-27 13:56:30 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (0ceec81)

    doveadm: add doveadm_http_rawlog_dir setting


M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h

2017-01-24 17:18:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b694e99)

    lib-fts: Fix assert-crash in fts_icu_lcase()

    Fixes: Panic: file fts-icu.c: line 152 (fts_icu_lcase): assertion failed:
    (err != U_BUFFER_OVERFLOW_ERROR)

M	src/lib-fts/fts-icu.c
M	src/lib-fts/test-fts-icu.c

2017-01-27 09:41:36 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (55aa977)

    lib-storage: Fix comparison to use virtual size instead of body virtual size

    Was forgotten on 7f1ecb14

M	src/lib-storage/index/index-mail.c

2017-01-26 09:55:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3f7b36a)

    lib-index: Don't log error on dovecot.index.cache delete if it doesn't exist

    For example if a cache is marked as corrupted and there is no cache, it's 
    not really an error that it doesn't exist.

    Fixes: Error: unlink(.../dovecot.index.cache) failed: No such file or
    directory (in mail-cache.c:29)

M	src/lib-index/mail-cache.c

2017-01-26 19:51:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (dcd0c99)

    lib-storage: Filling vsize to index on read used wrong size


M	src/lib-storage/index/index-mail.c

2017-01-26 09:42:26 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fab7e8a)

    lib-storage: Clear virtual size from index if size is corrupted


M	src/lib-storage/index/index-mail.c

2017-01-14 18:34:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (425d868)

    fts: Fix search query generation when tokens are filtered out.

    For example with English stopwords when searching "foo and bar" it should be
    equilevant to "foo bar", since "and" is filtered out.

M	src/plugins/fts/fts-search-args.c

2017-01-23 18:02:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8839eaa)

    director: "doveadm director move" to same host now refreshes user's timeout

    This allows keeping user constantly in the same backend by just periodically 
    moving the user there.

M	src/director/doveadm-connection.c

2017-01-16 14:01:57 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (29e8c5a)

    dict-sql: Do not increment on set

    When merging sets do not use increment mode in builder.

M	src/lib-dict/dict-sql.c

2017-01-17 09:59:54 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e90fb60)

    dict-sql: Fix iterator to not fail

    When iterating a prefix without exact key flag, do not fail when no more
    maps are matched if at least one map has already matched.

    Fixes Error: dict_iterate_deinit failed: sql dict iterate failed for ...:
    Invalid/unmapped path

M	src/lib-dict/dict-sql.c

2016-10-16 22:55:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e4f3960)

    dict-sql: Error handling fix & code cleanup

    Only the first sql_dict_iterate_next_query() error was handled correctly.

M	src/lib-dict/dict-sql.c

2017-01-24 12:42:25 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2a85b1a)

    lib-sasl: Fix oauthbearer compatibility with 2.2


M	src/lib-sasl/mech-oauthbearer.c

2017-01-22 23:55:24 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (fa940ae)

    lib-http: client: Fixed handling of errors occurring for unsubmitted
    requests during http_client_request_send_payload().

    When http_client_request_send_payload() is executed for the first time, the
    request is submitted. Errors occurring during submission don't trigger a
    callback immediately. Instead, these are queued in the client and will
    trigger a callback when an ioloop is run with the client. However, in
    http_client_request_send_payload() the ioloop is never executed when the
    request fails that way, meaning that the callback was never called. Since
    for example SOLR assumes the callback is always called for an error in 
    http_client_request_send_payload(), this causes all kinds of problems.

    Fixed by manually handling the delayed request errors in
    http_client_request_send_payload() explicitly.

M	src/lib-http/http-client-request.c

2017-01-18 13:46:12 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f9cc83c)

    lib-sasl: Add OAUTHBEARER and XOAUTH2 mechanism


M	src/lib-sasl/Makefile.am
M	src/lib-sasl/dsasl-client-private.h
M	src/lib-sasl/dsasl-client.c
A	src/lib-sasl/mech-oauthbearer.c

2017-01-18 13:45:27 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5328a2e)

    lib-sasl: Add API for setting and getting extra values

    This allows setting extra parameters for authentication and recovering
    extended result information from mechanism.

M	src/lib-sasl/dsasl-client-private.h
M	src/lib-sasl/dsasl-client.c
M	src/lib-sasl/dsasl-client.h

2017-01-20 18:19:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5c2dc4a)

    imapc: Fix assert-crash on some connect failures

    imapc_storage_has_modseqs() causes imapc_client_get_capabilities() to be 
    called, which assert-crashes if there isn't a valid connection:

    Panic: file imapc-client.c: line 438 (imapc_client_get_capabilities):
    assertion failed: (conn != NULL)

M	src/lib-storage/index/imapc/imapc-storage.c

2017-01-20 15:57:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9f6e400)

    director: Add more debug logging for moving & killing users


M	src/director/director.c

2017-01-20 16:06:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (956c62e)

    director: Fix USER-MOVE getting stuck if a director already uses the correct
    host


M	src/director/director.c

2017-01-20 16:03:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e6b3e47)

    director: Ignore doveadm user move if host is already the same.


M	src/director/doveadm-connection.c

2017-01-20 15:54:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8f4bd3b)

    director: Make sure USER-KILLED isn't sent before USER-MOVE

    If USER-MOVE was for a user that didn't exist, killing sent USER-KILLED 
    immediately before the forwarding USER-MOVE. This caused the move to get 
    stuck, giving errors like:

    director: Error: Finishing user 3224731354 move timed out, its state may now
    be inconsistent (state=waiting-for-everyone)

M	src/director/director.c

2017-01-20 15:52:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (30d3f03)

    director: Add assert to make sure USER-MOVE doesn't change tag


M	src/director/director.c

2016-12-27 09:45:58 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (722cfd3)

    lib-storage: Copy cache decisions from inbox on create

    Otherwise the decisions are definitely wrong, since they are nonexistent.
    Copying from INBOX would make sense.

M	src/lib-storage/mail-storage.c

2016-12-27 09:44:52 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (21149ee)

    lib-index: Add mail_cache_decisions_copy

    This allows priming cache decisions for a folder.

M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache.h

2017-01-03 12:50:58 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (349ad03)

    lib-index: Unconstify mail_cache_register_get_list

    This way the result is usable as input for mail_cache_register_fields.

M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache.h

2017-01-20 14:46:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (affc86a)

    lib-storage: Fix mailbox's vsize header check for mailboxes not in
    dovecot.list.index

    If mailbox wasn't yet in the dovecot.list.index, mailbox_list_index_status() 
    for it returns FALSE and doesn't initialize the status. In some situations
    this may have caused a non-empty mailbox's vsize to be returned as 0.

M	src/lib-storage/list/mailbox-list-index-status.c

2017-01-10 02:12:25 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (372b2fa)

    lib-http: client: Make sure req->conn is only not NULL when that connection
    holds a reference to that request.

    This consolidates the management of req->conn to one place, thereby
    preventing mishaps. It makes sure req->conn is always properly assigned,
    making it more reliable. This fixes a problem that emerged in the
    http-proxy.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c

2017-01-19 02:16:06 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (44ecba5)

    lib-http: client: Keep connection reference throughout
    http_client_connection_return_response().

    Before, it was held in two intervals. Next commit requires this change, but
    it also simplifies this function significantly.

M	src/lib-http/http-client-connection.c

2017-01-17 19:49:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (94c6000)

    master: Remove unnecessary service listener start

    The listening was already started later on in the same function. Also in
    some cases it would have been started unnecessarily, like when service was
    stopped or more processes were created immediately.

M	src/master/service-monitor.c

2017-01-18 04:46:15 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (875efb0)

    index: don't try to unlink in-memory cache file

    Avoid these errors:

    Error: unlink((in-memory index).cache) failed: No such file or directory (in
    mail-cache.c:29)

M	src/lib-index/mail-cache.c

2017-01-17 20:34:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (63bdb77)

    doveadm direcor add: Fix checking number as hostname.

    521c0460fe705f32ea6899c8b1f101043fe0898c was completely broken.

M	src/doveadm/doveadm-director.c

2017-01-17 20:03:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (380bf2a)

    doveconf: Don't read freed memory.

    Giving -c parameter frees the returned orig_config_path.

M	src/config/doveconf.c

2017-01-17 15:22:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a9ed8ae)

    doveadm direcor add: Don't accept number as a valid hostname.

    This is usually a mistake. For example "doveadm director add -t host 100" 
    shouldn't be adding a new IP 100 (0.0.0.100)

M	src/doveadm/doveadm-director.c

2017-01-17 16:28:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ca39c2c)

    stats plugin: Fix /proc/self/io fd leak on plugin deinit

    This could have been a problem with doveadm-server processes if they had 
    service_count>1, because doveadm unloads all plugins between commands.

M	src/plugins/stats/mail-stats-fill.c
M	src/plugins/stats/mail-stats.h
M	src/plugins/stats/stats-plugin.c

2017-01-17 16:23:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9e01752)

    doveadm: Outgoing dsync TCP connections leaked socket

    If doveadm-server was running with service_count>1, each dsync run leaked a 
    socket.

M	src/doveadm/doveadm-dsync.c

2017-01-17 19:21:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f9f08e1)

    lib-dict: Compiler warning fix


M	src/lib-dict/dict.h

2017-01-16 09:37:05 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (877ef48)

    dict-sql: Fix flushing

    Remove flushing from set, and add it to unset. Fixes signal 11 crash caused
    by infinite recursion.

M	src/lib-dict/dict-sql.c

2017-01-16 16:58:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cba7c7f)

    dict-file: Fix potential crash when doing other dict calls during iteration.

    If file was refreshed, the hash table was cleared, which broke the existing 
    iterators.

M	src/lib-dict/dict-file.c

2017-01-16 17:12:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cc64a82)

    lib-dict: Add assert to make sure all iterators are deinitialized.


M	src/lib-dict/dict-private.h
M	src/lib-dict/dict.c

2017-01-16 16:57:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b43f7a5)

    lib: Add asserts to make sure hash table isn't freed while it's frozen.


M	src/lib/hash.c

2017-01-16 23:55:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (887bddc)

    fts-solr: Escape {} chars when sending queries

    Fixes: java.lang.IllegalArgumentException: Invalid character found in the
    request target. The valid characters are defined in RFC 7230 and RFC 3986

    Based on patch by Michael Welsh Duggan

M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2017-01-17 01:37:25 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (998e94a)

    lib-http: server: Do not generate a payload for a failure response for a
    HEAD request.


M	src/lib-http/http-server-request.c

2017-01-17 01:36:10 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (1ffb3ca)

    lib-http: server: Prevent sending response payload when it is not allowed by
    the specification.

    For a HEAD request, the payload is omitted, but the associated headers are
    generated. For the other cases, an assert failure is now triggered.

M	src/lib-http/http-server-response.c

2017-01-03 17:21:33 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (14eb551)

    lib-storage: Add vsize extension to index

    Keep virtual size in index, instead of cache when it's less than 2^32-1.
    This helps when cache becomes corrupted, and goes away, we still have
    virtual sizes for quota calculations.

M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2017-01-15 19:56:32 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (afdbd32)

    lib-storage: Fix assert-crash on mailbox_copy/move() failure

    If mailbox_save_cancel() was being called outside mail_storage_copy() it
    assert-crashed:

    Panic: file mail-storage.c: line 2168 (mailbox_save_context_reset):
    assertion failed: (ctx->copying_via_save)

M	src/lib-storage/mail-storage.c

2016-05-20 13:53:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c7949e3)

    lib: Minor panic message improvement.


M	src/lib/ioloop-epoll.c

2017-01-14 16:11:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b1dc39e)

    lib-storage: If namespaces weren't successfully created, don't autoexpunge
    at deinit.


M	src/lib-storage/mail-user.c

2017-01-14 16:12:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (23c8b18)

    lib-storage: Add struct mail_user.namespaces_created

    This makes it easier to determine in mail_namespaces_added hook if the 
    namespaces being added are the initial ones or later ones.

M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-user.h

2017-01-14 16:12:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fffd49c)

    lib-storage: Stop namespaces_added|created hooks immediately when user has
    failed


M	src/lib-storage/mail-storage-hooks.c

2017-01-14 16:10:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5f6b6dc)

    doveadm dict get: Support printing multiple values.


M	src/doveadm/doveadm-dict.c

2017-01-09 20:32:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a08f235)

    dict-sql: Support multiple values for lookups

    The value's fields must be comma-separated without spaces, for example:

    map {
     value_field = field1,field2
     value_type = string,uint
     ...

    Only the first field is used for INSERTs and UPDATEs.

M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql-settings.h
M	src/lib-dict/dict-sql.c

2017-01-12 20:35:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f58c640)

    dict-client: Support multiple values for lookups


M	src/dict/dict-commands.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-client.h

2017-01-12 20:22:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b130584)

    lib-dict: Add support for lookup to return multiple values

    Implements only the initial stubs to the drivers.

M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h
M	src/plugins/dict-ldap/dict-ldap.c

2017-01-14 16:54:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (25d2704)

    dict-sql: Remove unnecessary "affected rows" tracking from dict_set()

    This was useful for dict_atomic_inc(), but not for dict_set().

    Fixes assert-crash with Cassandra: Panic: file driver-cassandra.c: line 1350
    (driver_cassandra_update): assertion failed: (affected_rows == NULL)

M	src/lib-dict/dict-sql.c

2017-01-14 16:45:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bfd7b7e)

    dict-sql: Fix previous "merge sets" to flush at commit

    The last dict_set() within transaction was being ignored.

M	src/lib-dict/dict-sql.c

2017-01-14 15:10:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (327fa45)

    lib-storage: Fix accessing the same "raw" mailbox multiple times in process.

    If the same file was opened as the raw mailbox multiple times, the previous 
    mail_index was cached by mail-index-alloc-cache. Opening it the second time 
    already contained a mail in the index, so trying to add another one logged 
    an error:

    Error: Log synchronization error at seq=1,offset=256 for (in-memory index):
    Append with UID 1, but next_uid = 2

M	src/lib-storage/index/raw/raw-sync.c

2017-01-13 20:39:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d708ff3)

    imapc: Fix re-sending retryable commands after reconnect


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2017-01-13 10:10:00 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (00fc96e)

    lib-dict: Fix compability for 2.2

    Fixes commit 595b94c8 compability with 2.2.

M	src/lib-dict/dict-sql.c

2017-01-12 16:20:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d5d8f7b)

    lib-storage: Allow namespaces_created hook to return failure via user error.


M	src/lib-storage/mail-namespace.c

2017-01-12 00:53:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d52d0f2)

    lib-storage: Improve namespace error message - include separator char.

    It wasn't always obvious what the character should have been when namespace
    didn't have an explicitly configured separator.

M	src/lib-storage/mail-namespace.c

2017-01-11 19:43:30 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (595b94c)

    lib-dict-sql: Try merge sets to single update

    This attempts to put mergeable keys into same update instead of using
    multiple SQL statements.

M	src/lib-dict/dict-sql.c

2017-01-11 02:51:13 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (01867a4)

    Updated copyright notices to include the year 2017.


M	doc/man/doveadm-acl.1.in
M	doc/man/doveadm-altmove.1.in
M	doc/man/doveadm-auth.1.in
M	doc/man/doveadm-batch.1.in
M	doc/man/doveadm-deduplicate.1.in
M	doc/man/doveadm-director.1.in
M	doc/man/doveadm-dump.1.in
M	doc/man/doveadm-exec.1.in
M	doc/man/doveadm-expunge.1.in
M	doc/man/doveadm-fetch.1.in
M	doc/man/doveadm-flags.1.in
M	doc/man/doveadm-force-resync.1.in
M	doc/man/doveadm-fs.1.in
M	doc/man/doveadm-fts.1.in
M	doc/man/doveadm-help.1.in
M	doc/man/doveadm-import.1.in
M	doc/man/doveadm-index.1.in
M	doc/man/doveadm-instance.1.in
M	doc/man/doveadm-kick.1.in
M	doc/man/doveadm-log.1.in
M	doc/man/doveadm-mailbox-cryptokey.1.in
M	doc/man/doveadm-mailbox.1.in
M	doc/man/doveadm-mount.1.in
M	doc/man/doveadm-move.1.in
M	doc/man/doveadm-penalty.1.in
M	doc/man/doveadm-proxy.1.in
M	doc/man/doveadm-purge.1.in
M	doc/man/doveadm-pw.1.in
M	doc/man/doveadm-quota.1.in
M	doc/man/doveadm-replicator.1.in
M	doc/man/doveadm-search-query.7
M	doc/man/doveadm-search.1.in
M	doc/man/doveadm-stats.1.in
M	doc/man/doveadm-sync.1.in
M	doc/man/doveadm-user.1.in
M	doc/man/doveadm-who.1.in
M	doc/man/doveadm.1.in
M	doc/man/doveconf.1.in
M	doc/man/dovecot-lda.1.in
M	doc/man/dovecot.1.in
M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-fields.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-policy.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request-stats.c
M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-stats.c
M	src/auth/auth-token.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-dict-cache-key.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-dovecot-token.c
M	src/auth/mech-external.c
M	src/auth/mech-plain-common.c
M	src/auth/mech-plain.c
M	src/auth/mech.c
M	src/auth/mycrypt.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-template.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme-pbkdf2.c
M	src/auth/password-scheme-rpa.c
M	src/auth/password-scheme.c
M	src/auth/test-auth-cache.c
M	src/auth/test-auth-request-var-expand.c
M	src/auth/test-db-dict.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-template.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection-http.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth-server.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-dict.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-dump-dcrypt-file.c
M	src/doveadm/doveadm-dump-dcrypt-key.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-batch.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-save.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-formatted.c
M	src/doveadm/doveadm-print-json.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-pw.c
M	src/doveadm/doveadm-replicator.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-deserializer.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox.c
M	src/doveadm/dsync/dsync-serializer.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/doveadm/test-doveadm-util.c
M	src/imap-hibernate/imap-client.c
M	src/imap-hibernate/imap-hibernate-client.c
M	src/imap-hibernate/imap-hibernate-settings.c
M	src/imap-hibernate/imap-master-connection.c
M	src/imap-hibernate/main.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/imap-login-client.c
M	src/imap-login/imap-login-commands.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-login-settings.c
M	src/imap-urlauth/imap-urlauth-login.c
M	src/imap-urlauth/imap-urlauth-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap-urlauth/imap-urlauth.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-genurlauth.c
M	src/imap/cmd-getmetadata.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-resetkey.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-setmetadata.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-urlfetch.c
M	src/imap/cmd-x-cancel.c
M	src/imap/cmd-x-state.c
M	src/imap/imap-client-hibernate.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-list.c
M	src/imap/imap-master-client.c
M	src/imap/imap-notify.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-state.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-settings.c
M	src/indexer/indexer-worker-settings.c
M	src/indexer/indexer-worker.c
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-pool.c
M	src/ipc/client.c
M	src/ipc/ipc-connection.c
M	src/ipc/ipc-group.c
M	src/ipc/ipc-settings.c
M	src/ipc/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-charset/test-charset.c
M	src/lib-compression/compression.c
M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lz4.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c
M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-lz4.c
M	src/lib-compression/ostream-lzma.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-compression/test-compression.c
M	src/lib-dcrypt/dcrypt-gnutls.c
M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c
M	src/lib-dict-extra/dict-fs.c
M	src/lib-dict-extra/dict-register.c
M	src/lib-dict/dict-cdb.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict-transaction-memory.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-dns/dns-util.c
M	src/lib-dns/test-dns-util.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-dict.c
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-test-async.c
M	src/lib-fs/fs-test.c
M	src/lib-fs/fs-wrapper.c
M	src/lib-fs/istream-fs-file.c
M	src/lib-fs/istream-fs-stats.c
M	src/lib-fs/istream-metawrap.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-fs/ostream-metawrap.c
M	src/lib-fs/test-fs-metawrap.c
M	src/lib-fts/fts-filter-common.c
M	src/lib-fts/fts-filter-contractions.c
M	src/lib-fts/fts-filter-english-possessive.c
M	src/lib-fts/fts-filter-lowercase.c
M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-icu.c
M	src/lib-fts/fts-language.c
M	src/lib-fts/fts-library.c
M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-common.c
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/fts-tokenizer.c
M	src/lib-fts/test-fts-filter.c
M	src/lib-fts/test-fts-icu.c
M	src/lib-fts/test-fts-language.c
M	src/lib-fts/test-fts-tokenizer.c
M	src/lib-http/http-auth.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-date.c
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-header.c
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-parser.c
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-response.c
M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-url.c
M	src/lib-http/test-http-auth.c
M	src/lib-http/test-http-client-errors.c
M	src/lib-http/test-http-client.c
M	src/lib-http/test-http-date.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-payload.c
M	src/lib-http/test-http-request-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-server-errors.c
M	src/lib-http/test-http-server.c
M	src/lib-http/test-http-transfer.c
M	src/lib-http/test-http-url.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-imap-storage/imap-metadata.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-keepalive.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-bodystructure.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-quote.c
M	src/lib-imap/test-imap-url.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-map.c
M	src/lib-index/test-mail-index-modseq.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-ldap/ldap-client.c
M	src/lib-ldap/ldap-compare.c
M	src/lib-ldap/ldap-connection-pool.c
M	src/lib-ldap/ldap-connection.c
M	src/lib-ldap/ldap-entry.c
M	src/lib-ldap/ldap-iterator.c
M	src/lib-ldap/ldap-search.c
M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/mail-html2text.c
M	src/lib-mail/mail-user-hash.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-binary-part.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-hash.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-part.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-size.c
M	src/lib-mail/message-snippet.c
M	src/lib-mail/ostream-dot.c
M	src/lib-mail/qp-decoder.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-mail/test-istream-binary-converter.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-mail-html2text.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-hash.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-message-part.c
M	src/lib-mail/test-message-search.c
M	src/lib-mail/test-message-snippet.c
M	src/lib-mail/test-ostream-dot.c
M	src/lib-mail/test-qp-decoder.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-mail/test-rfc822-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-haproxy.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service.c
M	src/lib-master/mountpoint-list.c
M	src/lib-master/syslog-util.c
M	src/lib-master/test-master-service-settings-cache.c
M	src/lib-program-client/program-client-local.c
M	src/lib-program-client/program-client-private.h
M	src/lib-program-client/program-client-remote.c
M	src/lib-program-client/program-client.c
M	src/lib-program-client/program-client.h
M	src/lib-program-client/test-program-client-local.c
M	src/lib-program-client/test-program-client-remote.c
M	src/lib-sasl/dsasl-client.c
M	src/lib-sasl/mech-external.c
M	src/lib-sasl/mech-login.c
M	src/lib-sasl/mech-plain.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-settings/test-settings-parser.c
M	src/lib-smtp/lmtp-client.c
M	src/lib-sql/driver-cassandra.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-ssl-iostream/dovecot-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-stats/stats-connection.c
M	src/lib-stats/stats-parser.c
M	src/lib-stats/stats.c
M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/fail-mail.c
M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-deleted-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-pop3-uidl.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-list-index.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-notify-tree.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-autoexpunge.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-args-cmdline.c
M	src/lib-storage/mail-search-args-imap.c
M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-attribute-internal.c
M	src/lib-storage/mailbox-attribute.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list-notify.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-recent-flags.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/mailbox-watch.c
M	src/lib-storage/test-mail-search-args-imap.c
M	src/lib-storage/test-mail-search-args-simplify.c
M	src/lib-storage/test-mailbox-get.c
M	src/lib-test/test-common.c
M	src/lib-test/test-istream.c
M	src/lib-test/test-ostream.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base32.c
M	src/lib/base64.c
M	src/lib/bits.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/compat.c
M	src/lib/connection.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-create-locked.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/guid.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-temp.c
M	src/lib/iostream.c
M	src/lib/ipwd.c
M	src/lib/iso8601-date.c
M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-callback.c
M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-failure-at.c
M	src/lib/istream-file.c
M	src/lib/istream-hash.c
M	src/lib/istream-jsonstr.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/istream-sized.c
M	src/lib/istream-tee.c
M	src/lib/istream-timeout.c
M	src/lib/istream-unix.c
M	src/lib/istream.c
M	src/lib/json-parser.c
M	src/lib/json-tree.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/log-throttle.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/nfs-workarounds.c
M	src/lib/numpack.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-escaped.c
M	src/lib/ostream-failure-at.c
M	src/lib/ostream-file.c
M	src/lib/ostream-hash.c
M	src/lib/ostream-null.c
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/pkcs5.c
M	src/lib/primes.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/rand.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str-table.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base32.c
M	src/lib/test-base64.c
M	src/lib/test-bits.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-data-stack.c
M	src/lib/test-failures.c
M	src/lib/test-guid.c
M	src/lib/test-hash-format.c
M	src/lib/test-hash-method.c
M	src/lib/test-hash.c
M	src/lib/test-hex-binary.c
M	src/lib/test-ioloop.c
M	src/lib/test-iostream-temp.c
M	src/lib/test-iso8601-date.c
M	src/lib/test-istream-base64-decoder.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-chain.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-failure-at.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-istream-unix.c
M	src/lib/test-istream.c
M	src/lib/test-json-parser.c
M	src/lib/test-json-tree.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-log-throttle.c
M	src/lib/test-malloc-overflow.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-net.c
M	src/lib/test-numpack.c
M	src/lib/test-ostream-escaped.c
M	src/lib/test-ostream-failure-at.c
M	src/lib/test-ostream-file.c
M	src/lib/test-pkcs5.c
M	src/lib/test-primes.c
M	src/lib/test-printf-format-fix.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-str-table.c
M	src/lib/test-str.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-strnum.c
M	src/lib/test-time-util.c
M	src/lib/test-timing.c
M	src/lib/test-unichar.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/test-wildcard-match.c
M	src/lib/time-util.c
M	src/lib/timing.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/uri-util.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/doveadm-connection.c
M	src/log/log-connection.c
M	src/log/log-error-buffer.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/capabilities-posix.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-client.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile-update.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-global-file.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/dict-ldap/dict-ldap-settings.c
M	src/plugins/dict-ldap/dict-ldap.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fs-compress/fs-compress.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser-tika.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search-args.c
M	src/plugins/fts/fts-search-serialize.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/xml2text.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/last-login/last-login-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-crypt/doveadm-mail-crypt.c
M	src/plugins/mail-crypt/fs-crypt-common.c
M	src/plugins/mail-crypt/fs-crypt-settings.c
M	src/plugins/mail-crypt/fs-crypt.c
M	src/plugins/mail-crypt/fs-mail-crypt.c
M	src/plugins/mail-crypt/mail-crypt-acl-plugin.c
M	src/plugins/mail-crypt/mail-crypt-global-key.c
M	src/plugins/mail-crypt/mail-crypt-key.c
M	src/plugins/mail-crypt/mail-crypt-plugin.c
M	src/plugins/mail-crypt/mail-crypt-pluginenv.c
M	src/plugins/mail-crypt/mail-crypt-userenv.c
M	src/plugins/mail-crypt/test-mail-global-key.c
M	src/plugins/mail-crypt/test-mail-key.c
M	src/plugins/mail-filter/istream-ext-filter.c
M	src/plugins/mail-filter/mail-filter-plugin.c
M	src/plugins/mail-filter/ostream-ext-filter.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/mailbox-alias/mailbox-alias-plugin.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-storage.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/pop3-migration/test-pop3-migration-plugin.c
M	src/plugins/push-notification/push-notification-driver-dlog.c
M	src/plugins/push-notification/push-notification-driver-ox.c
M	src/plugins/push-notification/push-notification-drivers.c
M	src/plugins/push-notification/push-notification-drivers.h
M	src/plugins/push-notification/push-notification-event-flagsclear.c
M	src/plugins/push-notification/push-notification-event-flagsclear.h
M	src/plugins/push-notification/push-notification-event-flagsset.c
M	src/plugins/push-notification/push-notification-event-flagsset.h
M	src/plugins/push-notification/push-notification-event-mailboxcreate.c
M	src/plugins/push-notification/push-notification-event-mailboxcreate.h
M	src/plugins/push-notification/push-notification-event-mailboxdelete.c
M	src/plugins/push-notification/push-notification-event-mailboxdelete.h
M	src/plugins/push-notification/push-notification-event-mailboxrename.c
M	src/plugins/push-notification/push-notification-event-mailboxrename.h
M	src/plugins/push-notification/push-notification-event-mailboxsubscribe.c
M	src/plugins/push-notification/push-notification-event-mailboxsubscribe.h
M	src/plugins/push-notification/push-notification-event-mailboxunsubscribe.c
M	src/plugins/push-notification/push-notification-event-mailboxunsubscribe.h
M	src/plugins/push-notification/push-notification-event-message-common.h
M	src/plugins/push-notification/push-notification-event-messageappend.c
M	src/plugins/push-notification/push-notification-event-messageappend.h
M	src/plugins/push-notification/push-notification-event-messageexpunge.c
M	src/plugins/push-notification/push-notification-event-messageexpunge.h
M	src/plugins/push-notification/push-notification-event-messagenew.c
M	src/plugins/push-notification/push-notification-event-messagenew.h
M	src/plugins/push-notification/push-notification-event-messageread.c
M	src/plugins/push-notification/push-notification-event-messageread.h
M	src/plugins/push-notification/push-notification-event-messagetrash.c
M	src/plugins/push-notification/push-notification-event-messagetrash.h
M	src/plugins/push-notification/push-notification-events-rfc5423.c
M	src/plugins/push-notification/push-notification-events-rfc5423.h
M	src/plugins/push-notification/push-notification-events.c
M	src/plugins/push-notification/push-notification-events.h
M	src/plugins/push-notification/push-notification-plugin.c
M	src/plugins/push-notification/push-notification-plugin.h
M	src/plugins/push-notification/push-notification-triggers.c
M	src/plugins/push-notification/push-notification-triggers.h
M	src/plugins/push-notification/push-notification-txn-mbox.c
M	src/plugins/push-notification/push-notification-txn-mbox.h
M	src/plugins/push-notification/push-notification-txn-msg.c
M	src/plugins/push-notification/push-notification-txn-msg.h
M	src/plugins/quota-clone/quota-clone-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-status.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota-util.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/test-quota-util.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/stats/mail-stats-connection.c
M	src/plugins/stats/mail-stats-fill.c
M	src/plugins/stats/mail-stats.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/welcome/welcome-plugin.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/replication/aggregator/aggregator-settings.c
M	src/replication/aggregator/aggregator.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/dsync-client.c
M	src/replication/replicator/notify-connection.c
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue-auth.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/stats/client-export.c
M	src/stats/client-reset.c
M	src/stats/client.c
M	src/stats/fifo-input-connection.c
M	src/stats/global-memory.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.c
M	src/stats/mail-user.c
M	src/stats/main.c
M	src/stats/stats-carbon.c
M	src/stats/stats-settings.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2017-01-11 01:57:46 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (74d223d)

    global: Replaced all instances of memset(p, 0, sizeof(*p)) with the new
    i_zero() macro.

    Used the following script:

    C_FILES=`git ls-files *.c` H_FILES=`git ls-files *.h` for F in "$C_FILES
    $H_FILES"; do
           echo "$F"
     perl -p -i -e
    's/safe_memset\(&\(?([^,]*)\)?,\s*0,\s*sizeof\(\g1\)\)/i_zero_safe(&$1)/g'
    $F
     perl -p -i -e
    's/safe_memset\(([^,]*),\s*0,\s*sizeof\(\*\g1\)\)/i_zero_safe($1)/g' $F
     perl -p -i -e
    's/memset\(&\(?([^,]*)\)?,\s*0,\s*sizeof\(\g1\)\)/i_zero(&$1)/g' $F
     perl -p -i -e 's/memset\(([^,]*),\s*0,\s*sizeof\(\*\g1\)\)/i_zero($1)/g' $F 
    done

M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/main.c
M	src/auth/passdb-pam.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/doveconf.c
M	src/config/old-set-parser.c
M	src/dict/main.c
M	src/director/login-connection.c
M	src/doveadm/client-connection-http.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth-server.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-batch.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-formatted.c
M	src/doveadm/doveadm-print-json.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-pw.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/imap-hibernate/imap-hibernate-client.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/imap-proxy.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap-urlauth/imap-urlauth.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-select.c
M	src/imap/cmd-setmetadata.c
M	src/imap/cmd-store.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-fetch.c
M	src/imap/imap-master-client.c
M	src/imap/imap-notify.c
M	src/imap/imap-state.c
M	src/imap/imap-status.c
M	src/imap/main.c
M	src/indexer/indexer-worker.c
M	src/indexer/master-connection.c
M	src/lda/main.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-dcrypt/dcrypt-gnutls.c
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/test-crypto.c
M	src/lib-dict-extra/dict-fs.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-dict.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-test-async.c
M	src/lib-fs/fs-test.c
M	src/lib-fts/fts-icu.c
M	src/lib-http/http-auth.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-date.c
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-parser.c
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-response.c
M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-url.c
M	src/lib-http/test-http-auth.c
M	src/lib-http/test-http-client-errors.c
M	src/lib-http/test-http-client.c
M	src/lib-http/test-http-payload.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-server-errors.c
M	src/lib-http/test-http-server.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-storage/imap-metadata.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-id.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/test-mail-index-map.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/smtp-client.c
M	src/lib-ldap/ldap-compare.c
M	src/lib-ldap/ldap-connection.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-snippet.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-hash.c
M	src/lib-mail/test-message-search.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service.c
M	src/lib-master/mountpoint-list.c
M	src/lib-master/test-master-service-settings-cache.c
M	src/lib-ntlm/ntlm-message.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-smtp/lmtp-client.c
M	src/lib-sql/driver-cassandra.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-deleted-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-pop3-uidl.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-sync-list-index.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-notify-tree.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mailbox-attribute.c
M	src/lib-storage/mailbox-list.c
M	src/lib/buffer.c
M	src/lib/connection.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop.c
M	src/lib/iso8601-date.c
M	src/lib/istream-sized.c
M	src/lib/istream.c
M	src/lib/lib-signals.c
M	src/lib/md4.c
M	src/lib/md5.c
M	src/lib/mempool-alloconly.c
M	src/lib/mountpoint.c
M	src/lib/net.c
M	src/lib/ostream.c
M	src/lib/restrict-access.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/sha3.c
M	src/lib/test-ioloop.c
M	src/lib/test-utc-mktime.c
M	src/lib/timing.c
M	src/lib/uri-util.c
M	src/lib/var-expand.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/main.c
M	src/log/log-connection.c
M	src/login-common/client-common-auth.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-openssl.c
M	src/master/main.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-backend-vfile-update.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-global-file.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/dict-ldap/dict-ldap-settings.c
M	src/plugins/dict-ldap/dict-ldap.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-parser-tika.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/xml2text.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/last-login/last-login-plugin.c
M	src/plugins/mail-crypt/doveadm-mail-crypt.c
M	src/plugins/mail-crypt/mail-crypt-acl-plugin.c
M	src/plugins/mail-crypt/mail-crypt-global-key.c
M	src/plugins/mail-crypt/mail-crypt-plugin.c
M	src/plugins/mail-crypt/mail-crypt-pluginenv.c
M	src/plugins/mail-crypt/test-mail-global-key.c
M	src/plugins/mail-crypt/test-mail-key.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/push-notification/push-notification-driver-ox.c
M	src/plugins/push-notification/push-notification-event-flagsclear.c
M	src/plugins/push-notification/push-notification-event-flagsset.c
M	src/plugins/push-notification/push-notification-event-messageappend.c
M	src/plugins/push-notification/push-notification-event-messagenew.c
M	src/plugins/quota-clone/quota-clone-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-status.c
M	src/plugins/quota/quota-util.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/test-quota-util.c
M	src/plugins/stats/mail-stats-fill.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/replication/replicator/replicator-queue-auth.c
M	src/replication/replicator/replicator-queue.c
M	src/stats/client-export.c
M	src/stats/client-reset.c
M	src/stats/main.c
M	src/util/script-login.c

2017-01-10 19:23:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b2fa20b)

    configure: Link libsmtp before libdns

    Fixes linking LIBDOVECOT when using .a libraries

M	configure.ac

2016-05-06 21:43:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8747064)

    lib-settings: Added settings_get_time_msecs()


M	src/lib-settings/Makefile.am
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings-parser.h
A	src/lib-settings/test-settings-parser.c

2017-01-10 14:45:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b4b4f8d)

    lib-storage: Compile & indent fix for previous change.


M	src/lib-storage/index/index-mail-headers.c

2017-01-05 10:50:55 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (01129c5)

    lib-storage: Prevent recursion in header parsing

    If header parsing error occurs and error handling tries to get fields, such
    as Message-ID, it will cause crash. This fixes problem by preventing reading
    from non-cached headers while they are being parsed.

    Fixes lmtp: Panic: file ../../../src/lib/array.h: line 219 (array_idx_i): 
    assertion failed: (idx * array->element_size < array->buffer->used)

M	src/lib-storage/index/index-mail-headers.c

2017-01-09 17:48:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4ca3356)

    cassandra: Support configuring heartbeat_interval and idle_timeout


M	src/lib-sql/driver-cassandra.c

2017-01-09 20:31:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0787b76)

    cassandra: Add support for "bigint" value type.


M	src/lib-sql/driver-cassandra.c

2017-01-09 22:39:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d165b70)

    dict-client: When failing to resend commands after reconnect, their success
    is uncertain.

    It's possible that the writes before the disconnection did actually finish 
    successfully. If any of them were commits, we need to return 
    DICT_COMMIT_RET_WRITE_UNCERTAIN.

M	src/lib-dict/dict-client.c

2017-01-09 17:05:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (aed6c42)

    dict-sql: Support transaction timestamps with Cassandra driver


M	src/lib-dict/dict-sql.c

2017-01-09 19:16:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f528d54)

    dict-client: Pass through transaction timestamp to dict-server


M	src/dict/dict-commands.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-client.h

2017-01-09 16:55:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (293e9fc)

    lib-dict: Add dict_transaction_set_timestamp()


M	src/lib-dict/dict-private.h
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h

2017-01-09 19:10:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a007cfc)

    dict-ldap|fs: Explicitly specify used dict_vfuncs methods.

    This was done for other dict drivers in 
    ade5567577dadb0b275c840208d3ad21a9f00a36

M	src/lib-dict-extra/dict-fs.c
M	src/plugins/dict-ldap/dict-ldap.c

2016-12-29 13:17:57 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (52336da)

    config: Fix checking if <path needs to be expanded


M	src/config/config-parser.c

2017-01-09 15:12:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2d0fd3e)

    lmtp: Don't deliver truncated email when client disconnects before "." line

    This didn't happen always, because the EOF was handled in two different 
    places in different ways.

M	src/lmtp/commands.c

2017-01-10 15:55:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ecb3be1)

    auth: Fix compiling tests


M	src/auth/Makefile.am

2017-01-09 09:57:58 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0f3c4b9)

    auth-policy: Add missing settings


M	src/auth/auth-settings.c
M	src/auth/auth-settings.h

2017-01-08 20:09:33 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (135600f)

    auth-policy: Enable SSL connections


M	src/auth/Makefile.am
M	src/auth/auth-policy.c

2016-12-30 16:20:12 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (81fdd61)

    lib-lda: Moved LMTP client to lib-smtp.

    This makes the LMTP client available without dependency on lib-storage. For
    Dovecot v2.3, the newly created lib-smtp will evolve into a full
    client/server SMTP implementation. That will then remove the remaining SMTP
    code from lib-lda.

M	configure.ac
M	dovecot-config.in.in
M	src/Makefile.am
M	src/lib-lda/Makefile.am
A	src/lib-smtp/Makefile.am
R100	src/lib-lda/lmtp-client.c	src/lib-smtp/lmtp-client.c
R100	src/lib-lda/lmtp-client.h	src/lib-smtp/lmtp-client.h
M	src/lmtp/Makefile.am

2016-10-28 21:34:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c6c2976)

    configure: Fix link ordering

    libprogram_client.la needs to be before libdns.la

M	configure.ac

2017-01-10 13:29:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2eb0ef7)

    director: Fix assert-crash when flush script takes too long

    Fixes: Panic: file director.c: line 966 (director_user_move_timeout):
    assertion failed: (user->kill_ctx->kill_state != USER_KILL_STATE_FLUSHING)

M	src/director/director.c

2017-01-09 23:04:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6d887ec)

    lib-program-client: Fix crash after disconnecting client.


M	src/lib-program-client/program-client.c

2017-01-09 21:57:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8486bad)

    dict-client: Log slightly different error when it's uncertain if commit
    failed


M	src/lib-dict/dict-client.c

2017-01-04 14:02:28 -0800 Greg C <bearggg@users.noreply.github.com> (5a2358d)

    auth-policy: hashed_password will always be blank, tell buffer it has data
    so str_len works when converting to hex


M	src/auth/auth-policy.c

2017-01-08 18:44:32 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (42d12a3)

    lib-program-client: Do not call program_client_fail twice

    Fixes crash in program-client caused by use of freed memory.

M	src/lib-program-client/program-client.c

2016-12-25 10:14:07 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d2cc2b0)

    istream-mmap: Mark stream eof on error and copy errno


M	src/lib/istream-mmap.c

2016-12-16 20:27:09 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (0a7caaa)

    lib, lib-http: add HTTP_URL_ALLOW_PCT_NUL flag

    This allows a URL to contain %00.

M	src/lib-http/http-url.c
M	src/lib-http/http-url.h
M	src/lib/uri-util.c
M	src/lib/uri-util.h

2016-12-27 14:01:14 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (79a26b1)

    autoexpunge: Consider last_rename_stamp on expunge

    When expunging by saved date, see if last_rename_stamp is more recent than
    saved date, and use that instead.

    This prevents mails getting deleted on a folder that was just renamed, the
    user probably expects autoexpunge to consider these emails as fresh.

M	src/lib-storage/mail-autoexpunge.c

2016-12-28 22:45:22 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (b88c159)

    index-storage: Update mailbox last_rename_stamp on rename


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-private.h

2016-12-27 15:03:51 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (34f7cc3)

    lib-mail: header filter should call callback for added EOH

    If we add a EOH because there wasn't one and HEADER_FILTER_ADD_MISSING_EOH
    was specified, we should invoke the callback for it.  Otherwise, it is
    unnecessarily difficult for consumers to add a header since there is no way
    to know if EOH will be present ahead of time.

M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-12-28 10:49:49 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (e41845d)

    lib-mail: refactor header filter test code


M	src/lib-mail/test-istream-header-filter.c

2016-12-21 07:53:52 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (c8a0f01)

    lib-compression: use LZ4_compress_default if can

    LZ4_compress is deprecated.

M	configure.ac
M	src/lib-compression/ostream-lz4.c

2016-12-18 12:03:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (963da01)

    lib-storage: Update mail_get_headers() API comment

    The API was changed by 990d55ce3fc461eeacce3ef830b1c5dde5c3f150

M	src/lib-storage/mail-storage.h

2016-12-18 13:20:20 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (365096b)

    lib: Created i_zero() wrapper for memset(p, 0, sizeof(*p)).

    Also creates an i_zero_safe() version for safe_memset().

M	src/lib/macros.h

2016-12-23 13:58:38 -0800 Nick Wallingford <nick@wallingford.cc> (15964b7)

    Fix link failure against libressl.


M	src/lib-ssl-iostream/dovecot-openssl-common.c

2016-04-12 13:08:05 +0300 Baofeng <baofeng.wang@dovecot.com> (cf36129)

    storage: do NOT feed p_strconcat() with NULL.

    p_strconcat will never take NULL as an valid argument. So
    ns->list->set.alt_dir has to be checked NULL.

M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2016-12-19 15:31:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1997fe1)

    lib-index: Fix assert-crash if .log creation unexpectedly fails at the end

    Pretty much the only reason for this to happen is if the index directory was
    deleted while another process still had the index open. Even this doesn't
    normally trigger this crash, because there are other checks earlier that
    usually catch it. So it crashes only in some race conditions.

    Fixes: Error: rename(.../dovecot.index.log.newlock, .../dovecot.index.log)
    failed: No such file or directory Panic: file mail-transaction-log-file.c:
    line 105 (mail_transaction_log_file_free): assertion failed: (!file->locked)

M	src/lib-index/mail-transaction-log-file.c

2016-12-20 13:40:17 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (7686697)

    stats: use o_stream_nsend in client-export


M	src/stats/client-export.c

2016-12-22 11:58:29 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (2068fde)

    fs-randomfail: Fix failure handling for fs_read()


M	src/lib-fs/fs-randomfail.c

2016-12-21 20:56:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2422b56)

    lib-index: Fix checking if cache file becomes >4GB


M	src/lib-index/mail-cache.c

2016-12-20 13:34:43 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (9f6ad59)

    imap: use o_stream_nsend when not checking failure


M	src/imap/cmd-getmetadata.c
M	src/imap/cmd-thread.c
M	src/imap/imap-master-client.c

2016-12-20 10:03:40 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (68a71b3)

    replication: ignore o_stream_send errors in doveadm-connection


M	src/replication/replicator/doveadm-connection.c

2016-12-22 11:53:06 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (50593e2)

    lib-mail: message_binary_part_deserialize(): Return error if body line count
    is too large

    The input was unsigned int, so output must also fit into unsigned int.

M	src/lib-mail/message-binary-part.c

2016-12-22 10:48:27 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (c12b91e)

    dovecot.service.in: Improve [service] examples

    Move them inside [service] section so that simply uncommenting them works. 
    Also give a better example of how Environment might be used.

M	dovecot.service.in

2016-12-21 21:33:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (14a866d)

    replication plugin: Error handling code cleanup

    The old code happened to work in all cases, but it was more of an accident.

M	src/plugins/replication/replication-plugin.c

2016-12-21 19:50:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (80d514f)

    Fix compiling when compiler doesn't support typeof()


M	src/lib-dns/test-dns-util.c
M	src/plugins/dict-ldap/dict-ldap.c

2016-12-19 12:16:20 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (eb0308e)

    lib-index: Make sure buffer is not null before freeing

    Fixes signal 11 crash under stress.

M	src/lib-index/mail-transaction-log-file.c

2016-12-18 22:54:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (88f7ecd)

    configure: Define __STDC_LIMIT_MACROS for CXXFLAGS

    Fixes SIZE_MAX being undefined when building fts-lucene.

M	configure.ac

2016-12-18 13:20:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a9f1d66)

    master: Update assert to make sure optind != 0

    Hopefully prevents Coverity warning about "doubleops[optind]" access being 
    uninitialized.

M	src/master/main.c

2016-12-18 12:54:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2d53d80)

    lib: Remove dead code from unit test


M	src/lib/test-malloc-overflow.c

2016-11-29 23:37:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (92f2c8b)

    lib: Allow only known %chars in printf_format_fix_noalloc()

    Otherwise if some libc adds a new unsupported character, our %n check might 
    break.

M	src/lib/printf-format-fix.c

2016-11-29 23:29:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (966ae45)

    lib: Fix %n detection in printf_format_fix_noalloc()

    It's undefined how flags, precision or length modifiers are handled with %n, 
    so make sure we catch all of them to detect an unwanted %n.

M	src/lib/printf-format-fix.c
M	src/lib/test-printf-format-fix.c

2016-11-29 23:21:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c38f699)

    lib: Optimize printf_format_fix_noalloc()

    Using strchr() is faster than looping through the characters manually. Since
    this function is being called a lot, it's worth optimizing.

M	src/lib/printf-format-fix.c

2016-12-17 20:03:46 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (28f5ddb)

    lib-imap-client: Fixed boolean vs integer mixup in debug message format
    argument.

    Found with Clang -Wstrict-bool.

M	src/lib-imap-client/imapc-connection.c

2016-12-16 23:38:58 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (4ba0369)

    lib-http: client: Added test for premature connection loss to
    test-http-client-errors.


M	src/lib-http/test-http-client-errors.c

2016-12-16 23:58:43 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (6650976)

    lib-http: client: Added test for normal connection backoff behavior to
    test-http-client-errors.


M	src/lib-http/test-http-client-errors.c

2016-12-16 23:36:19 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (4710cc0)

    lib-http: client: Treat connections that get disconnected prematurely as
    connection failures.

    This means that the backoff time is increased when this happens. A premature
    disconnection happens when the connection is disconnected before any data is
    received from the server.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2016-12-16 22:30:42 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (bee4ea8)

    lib-http: client: Consolidated connection loss handling into a single
    function.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h

2016-12-16 22:00:47 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (adbc1f7)

    lib-http: client: Moved connection backoff timer management to separate
    functions.


M	src/lib-http/http-client-peer.c

2016-12-16 21:41:29 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (2cf7f1b)

    lib-http: client: Prevent infinite event loop involving the request handler.

    Could happen when a backoff time is active.

M	src/lib-http/http-client-peer.c

2016-04-11 21:20:48 +0300 Baofeng <baofeng.wang@dovecot.com> (9bc8d9b)

    auth: do NOT feed p_strconcat() with NULL

    p_strconcat will never take NULL as an valid argument. Check possible NULL
    string before calling it.

M	src/auth/auth.c

2016-12-17 11:31:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (eed2ab4)

    master: PROCESS-STATUS output was duplicated many times


M	src/master/master-client.c

2016-12-15 17:43:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (613ab47)

    imapc: Log server disconnection error only once.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c

2016-12-15 17:45:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7bebbde)

    imapc: Minor debug logging improvement


M	src/lib-imap-client/imapc-connection.c

2016-12-15 17:36:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (eb2df28)

    imapc: Don't retry a failed reconnection before 10 secs have passed

    This mainly avoids a lot of unnecessary connect attempts within a short time
    period, for example if the caller attempts to perform some work for all the
    mailboxes.

M	src/lib-imap-client/imapc-connection.c

2016-12-15 17:31:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fd2be97)

    imapc: Fix infinite reconnect loop to remote server that is down

    This happened only in some situations. Usually there would have bene some 
    command in the queue, which would cause the reconnect-check to fail.

M	src/lib-imap-client/imapc-connection.c

2016-12-17 10:55:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4dd1b48)

    lib: Compiler warning fix for 32bit systems


M	src/lib/test-malloc-overflow.c

2016-12-12 07:28:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4fcb886)

    global: Make sure *_malloc() calculations won't cause integer overflows.


M	src/auth/auth-request-var-expand.c
M	src/doveadm/doveadm-dump-index.c
M	src/lib-imap/imap-utf7.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index.c
M	src/lib-master/master-login.c
M	src/lib-program-client/program-client-local.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/mailbox-list.c
M	src/lib/data-stack.c
M	src/lib/hex-binary.c
M	src/lib/str-find.c
M	src/lib/strfuncs.c
M	src/log/log-error-buffer.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-cache.h
M	src/pop3/pop3-client.h
M	src/pop3/pop3-commands.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-session.c
M	src/stats/mail-user.c

2016-12-12 07:19:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3391c9e)

    global: Change string position/length from unsigned int to size_t

    Mainly to avoid truncating >4GB strings, which might potentially cause some
    security holes. Normally there are other limits, which prevent such 
    excessive strings from being created in the first place.

    I'm sure this didn't find everything. Maybe everything could be found with 
    compiler warnings. -Wconversion kind of does it, but it gives way too many 
    unnecessary warnings.

    These were mainly found with:

    grep " = strlen" egrep "unsigned int.*(size|len)"

M	src/auth/auth-cache.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/db-checkpassword.c
M	src/auth/db-ldap.c
M	src/auth/mech-gssapi.c
M	src/auth/mech-scram-sha1.c
M	src/auth/password-scheme.c
M	src/auth/userdb-dict.c
M	src/config/config-parser-private.h
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/doveconf.c
M	src/config/old-set-parser.c
M	src/director/director-connection.c
M	src/doveadm/doveadm-auth-server.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/imap/cmd-list.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-subscribe.c
M	src/imap/imap-list.c
M	src/imap/imap-notify.c
M	src/imap/imap-status.c
M	src/imap/main.c
M	src/ipc/main.c
M	src/lib-compression/compression.c
M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-lzma.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-fs/fs-dict.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-test.c
M	src/lib-fts/fts-filter-english-possessive.c
M	src/lib-fts/fts-icu.c
M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/test-fts-tokenizer.c
M	src/lib-http/http-client-request.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-utf7.c
M	src/lib-lda/lmtp-client.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-sync.h
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-notify-tree.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib/array.c
M	src/lib/env-util.c
M	src/lib/failures.c
M	src/lib/istream-base64-encoder.c
M	src/lib/json-parser.c
M	src/lib/module-dir.c
M	src/lib/net.c
M	src/lib/ostream-file.c
M	src/lib/printf-format-fix.c
M	src/lib/printf-format-fix.h
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str.c
M	src/lib/strfuncs.c
M	src/lib/test-printf-format-fix.c
M	src/lib/unlink-old-files.c
M	src/lib/var-expand.c
M	src/lmtp/commands.c
M	src/log/log-error-buffer.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/master/master-settings.c
M	src/master/service-process.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/dict-ldap/dict-ldap.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-search-args.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/mail-crypt/mail-crypt-pluginenv.c
M	src/plugins/mail-crypt/mail-crypt-userenv.c
M	src/plugins/quota/quota-dirsize.c
M	src/replication/aggregator/replicator-connection.c

2016-12-12 05:16:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (94a5109)

    lib: Optimization - p_strconcat() doesn't need to allocate from data stack

    Various other parts of the code already rely on p_malloc() not overwriting 
    t_buffer_get()'ed data. p_strconcat() can do that as well.

M	src/lib/strfuncs.c

2016-12-12 04:55:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (95ed21e)

    lib: *_new(): Use the new MALLOC_MULTIPLY() macro to avoid overflows

    Cast the sizeof() result to unsigned int, because it's definitely always 
    enough and in many cases this allows optimizing away the wrap-check.

M	src/lib/data-stack.h
M	src/lib/mempool.h

2016-12-12 04:53:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bbc11b4)

    lib: Add MALLOC_MULTIPLY() and MALLOC_ADD()

    These can be used for calculating memory allocation sizes. If there's an 
    overflow, the macro panics.

M	src/lib/Makefile.am
M	src/lib/lib.h
A	src/lib/malloc-overflow.h
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-malloc-overflow.c

2016-12-12 03:55:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d75ed27)

    lib: Remove t_buffer_*_type()

    The t_buffer_*() shouldn't normally be used anyway except in some low-level 
    string/buffer manipulation code, so there's not much point in trying to make 
    easier to use versions of them.

M	src/lib/data-stack.h
M	src/lib/test-data-stack.c

2016-12-12 03:48:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (201c1ef)

    master: Removed unused process_exec(extra_args) parameter

    Removes unnecessarily complicated code marked with @UNSAFE.

M	src/master/common.h
M	src/master/main.c
M	src/master/service-process.c

2016-12-15 18:15:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ff6dc2d)

    lib-storage: Make dovecot.list.index's filename configurable.

    This is useful when there are multiple namespaces pointing to the same mail 
    root directory. For example mdbox with lazy-expunge:

    namespace {
     prefix = Expunged/
     location = mdbox:~/mdbox:MAILBOXDIR=expunged:LISTINDEX=expunged.list.index
     ..
    }

M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2016-12-15 18:13:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a6c3260)

    lib-storage: Deduplicate code into mailbox_list_settings_init_defaults()


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2016-12-16 18:52:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ab61662)

    director: Fix crash when using director_flush_socket

    Broken accidentally when merging b44033e45e9f48f8a6e1ac5905234fec5de6d6cc

M	src/director/director.c

2016-12-15 19:03:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7cf33ac)

    director: Fix USER-KICK and USER-KICK-ALT forwarding

    The internal IPC command was prefixed, which caused the remote director to
    reject the commands and disconnect:

    director(...): Command proxy: Unknown command proxy director(...): Remote
    sent invalid protocol data recently, waiting 57 secs before allowing further
    communication

M	src/director/director.c

2016-12-15 19:02:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (21df6cf)

    director: doveadm command handling was missing USER-KICK-ALT


M	src/director/doveadm-connection.c

2016-12-15 15:00:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7837109)

    imap: Fix STORE UNCHANGEDSINCE to work with >32bit modseqs.


M	src/imap/cmd-store.c

2016-12-15 15:20:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cac30e4)

    lib-storage: Fix "*" in SEARCH seqset/uidset

    4294967295 is used for "*", which matches the last existing message. Which
    we don't know what it is at the time of search args simplification, so avoid
    making any assumptions about it.

    It's a bit ugly that 4294967295 can't be used as a valid UID, but this 
    restriction has already existed since the beginning of Dovecot. A future 
    alternative might be to add MAIL_SEARCH_ARG_FLAG_SEQSET_WITH_STAR, but 
    that's a bit complicated change.

M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2016-12-15 15:01:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d677fd4)

    imapc: Don't allow "*" in SEARCH replies

    Doesn't fix anything, but makes the parsing a bit more correct.

M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-search.c

2016-12-14 19:36:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e847976)

    fts-squat: Use file_cache_new_path() for squat indexes


M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c

2016-12-14 19:35:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e430554)

    lib-index: Use file_cache_new_path() for dovecot.index.cache


M	src/lib-index/mail-cache.c

2016-12-14 19:35:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (897f17c)

    lib: Add file_cache_new_path() to include path in error messages.


M	src/lib/file-cache.c
M	src/lib/file-cache.h

2016-12-14 23:20:12 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (db6e8f1)

    driver-mysql: Do not hex-encode again

    Use correct syntax to provide data to mysql in hex format, without recoding 
    it in hex format again.

M	src/lib-sql/driver-mysql.c

2016-12-13 16:04:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bfb24d8)

    lib-storage: Fix crash in obox's dsync-merge


M	src/lib-storage/list/mailbox-list-index-backend.c

2016-12-09 16:01:20 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ddc3de0)

    mail-crypt: Treat empty values correctly

    If mail_crypt_curve or mail_crypt_save_version is left empty, disable the
    plugin. Don't error out.

M	src/plugins/mail-crypt/mail-crypt-plugin.c

2016-12-14 17:39:04 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (299e2ee)

    mail-crypt: Skip tests if dcrypt cannot be initialized

    Avoids breaking tests on system without working ECC keys.

M	src/plugins/mail-crypt/test-mail-global-key.c
M	src/plugins/mail-crypt/test-mail-key.c

2016-12-14 11:42:56 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (cc94fec)

    auth-policy: Allow unsupported attributes in response

    Do not choke if we receive unsupported attributes in response. This allows
    better interoperability with different systems that are getting signals from 
    auth policy server that are not (yet) supported by dovecot.

M	src/auth/auth-policy.c

2016-12-14 10:32:44 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (008b46a)

    sha3: Fix typo in ifdef

    The code was supposed to be used with big endian machines.

    Reported by than@redhat.com

M	src/lib/sha3.c

2016-12-12 15:21:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1007f76)

    lib-test: Change test_fatal_func_t to take unsigned int stage as parameter.

    It could never be -1, so this makes it clearer. It also removes annoying 
    casts when comparing stage to e.g. N_ELEMENTS().

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h
M	src/lib/test-array.c
M	src/lib/test-data-stack.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-printf-format-fix.c

2016-12-12 15:17:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (200176a)

    lib-test: test_run_with_fatals() now takes a const array


M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2016-12-12 15:16:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (333ccb2)

    lib-test: Introduce test_fatal_func_t as typedef and comment how it works.


M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2016-12-12 09:41:02 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (b127fb2)

    doveadm-mail: Set exit code to EX_TEMPFAIL on timeout

    When running `doveadm save` command on proxy/director and the remote command
    execution times out, exit code must be set to EX_TEMPFAIL.

    Fixes Panic: file doveadm-mail.c: line 405 (doveadm_mail_next_user): 
    assertion failed: (ctx->exit_code != 0)

M	src/doveadm/doveadm-mail.c

2016-12-12 09:39:34 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e78960f)

    doveadm-save: Set exit code to EX_TEMPFAIL on open error

    Prevents potential crash on doveadm_mail_next_user

M	src/doveadm/doveadm-mail-save.c

2016-12-14 02:51:54 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (29ddc07)

    lib-imap: imap-bodystructure: Prevent writing erroneous whitespace between
    items in an envelope address list.

    Both imap_bodystructure_write() and imap_body_parse_from_bodystructure()
    produced such invalid output. This caused an RFC 3501 violation in IMAP
    FETCH BODY and BODYSTRUCTURE responses.

    Test suite is amended to test this situation.

M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/test-imap-bodystructure.c

2016-12-13 18:31:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (619d00a)

    lib-index: Add mail_index_revert_changes()

    This can be used to revert changes done in a transaction to the specified 
    existing mail.

M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index.h

2016-12-14 10:23:17 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2277ba5)

    mail-crypt: Ensure array is created before accessing it

    Fixes segmentation fault on fs-crypt when keys are not configured.

M	src/plugins/mail-crypt/mail-crypt-global-key.c
M	src/plugins/mail-crypt/test-mail-global-key.c

2016-12-14 12:46:50 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (98fdeba)

    doveadm-director: Show tag field from response

    Fix off-by-one in doveadm director dump

M	src/doveadm/doveadm-director.c

2016-12-12 15:14:52 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (891b344)

    imap: Fix assert when waiting for input on SEARCH/SORT

    Set cmd->state to CLIENT_COMMAND_STATE_WAIT_EXTERNAL because we are not
    expecting input or output.

    Fixes Panic: file imap-client.c: line 854 (client_check_command_hangs):
    assertion failed: (client->io != NULL || (client->output_cmd_lock != NULL &&
    client->output_cmd_lock != client->input_lock))

M	src/imap/imap-search.c

2016-12-12 12:37:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (364aa47)

    dsync: Fix .dovecot-sync.lock timeout checking

    Whenever the lock file was recreated, the lock timeout was reset. Switched 
    to using file_create_locked(), which already solves this problem and has 
    compatible locking.

M	src/doveadm/dsync/dsync-brain.c

2016-12-12 12:53:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ec6eabd)

    dsync: Improve process title during initialization

    If something is hanging, this should make it clear what exactly it is.

M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain.c

2016-12-12 12:42:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d48b82d)

    doveadm-server: Show UNIX socket connections as <local> in process title

    Earlier they were shown as empty string.

M	src/doveadm/client-connection.c

2016-12-12 12:43:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (731eee9)

    doveadm: Add global doveadm_verbose_proctitle setting.

    This previously existed only for doveadm-server, but adding it to doveadm 
    CLI makes it easier to do process title updates for it as well.

M	src/doveadm/doveadm.c

2016-12-12 12:51:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (46c6c7a)

    doveadm: When connecting to doveadm-server via TCP, use 30s timeout

    Should be enough, and better than the kernel's default, which might be a lot 
    more.

M	src/doveadm/doveadm-util.c

2016-12-12 10:40:20 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (de8d17a)

    lib-storage: Do not try to recover missing list index

    Fixes Panic: file mailbox-list-index.c: line 342
    (mailbox_list_index_parse_records): assertion failed: (node != NULL)

M	src/lib-storage/list/mailbox-list-index.c

2016-12-05 15:17:30 +0000 Paul Howarth <paul@city-fan.org> (a42f612)

    configure: Fix some implicit function declarations

    Some configure tests fail unexpectedly if the compiler flag
    -Werror=implicit-function-declarations is enabled, which can result in the
    wrong implementations being used.

    This compiler flag is now enabled by default in Fedora Rawhide: 
    https://fedoraproject.org/wiki/Changes/Fedora26CFlags

    <stdlib.h> is needed for exit()
    <string.h> is needed for strcpy()

M	configure.ac

2016-12-07 14:23:12 +0100 manuel <manuel@mausz.at> (c927f01)

    openssl: Clear error queue after an incomplete SSL_shutdown

    If the SSL_shutdown-call fails (e.g. because the underlaying socket has 
    already been closed) OpenSSL puts the corresponding error into the queue. We
    don't care about details so we need to clear the queue.

    Otherwise the error will be pulled while error checking the next OpenSSL 
    call of an unrelated connection.

M	src/lib-ssl-iostream/iostream-openssl.c
M	src/login-common/ssl-proxy-openssl.c

2016-12-09 15:06:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3f4d68e)

    imapc: Don't send NOOP immediately after SELECT

    NOOP is normally used by mailbox syncing to check if there are any changes 
    done by other concurrent IMAP sessions. But doing it immediately after 
    SELECT is unnecessary, because nothing could have changed.

M	src/lib-storage/index/imapc/imapc-sync.c

2016-12-09 11:11:11 +0000 Timo Sirainen <timo.sirainen@dovecot.fi> (634c8fd)

    config: Avoid excessive data stack usage when matching local_name

    Moved config_filter_match_local_name() to its own function to make adding
    the data stack frame easier.

    Based on patch by J. Nick Koston

M	src/config/config-filter.c

2016-12-09 09:57:57 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (41d538d)

    doveadm-server: http: Fixed temp_path_prefix for iostream-temp.

    The temp_path_prefix was "/tmp", which is extended to
    "/tmp<hostname>.<pid>.<random>" by safe_mkstemp.

    Obviously, mortal users cannot create a file like that, causing this error: 
    doveadm: Error: safe_mkstemp(/tmp) failed: Permission denied

    The temp_path_prefix should have been "/tmp/doveadm.", as it is elsewhere as
    well.

M	src/doveadm/client-connection-http.c

2016-12-08 13:01:48 +0200 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (1f6c70b)

    lib: add t_strfgmtime and t_strftime


M	src/lib/test-time-util.c
M	src/lib/time-util.c
M	src/lib/time-util.h

2016-12-08 19:37:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7951e22)

    lib: Improve seq_range_array_invert() unit tests

    Try all possible combinations for seq=0..7 and seq=4294967288..4294967295 
    and make sure they're inverted correctly.

M	src/lib/test-seq-range-array.c

2016-12-07 10:19:02 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (93d5beb)

    lib-storage: Add test for inversion of n->max

    In mail-search-simplify-args, ensure that ALL NOT UID 3:* becomes UID 1:2

M	src/lib-storage/test-mail-search-args-simplify.c

2016-12-06 11:50:13 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (98ac5ee)

    lib-storage: Fix typo in function name


M	src/lib-storage/mail-search-args-simplify.c

2016-12-08 18:07:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (27128a3)

    lib: Comment seq_range_array_invert() that its values must be within
    min_seq..max_seq


M	src/lib/seq-range-array.h

2016-12-08 17:50:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b7a0844)

    lib: Fix seq_range_array_invert() when input contains 2^32-1

    This caused next_min_seq to be wrapped to 0, which was handled wrong later 
    on.

    Fixes: Panic: file mail-index-map.c: line 549
    (mail_index_map_lookup_seq_range): assertion failed: (first_uid > 0)

M	src/lib/seq-range-array.c
M	src/lib/test-seq-range-array.c

2016-12-07 00:14:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a2e65fe)

    cassandra: Treat "Request timed out" also as
    SQL_RESULT_ERROR_TYPE_WRITE_UNCERTAIN

    CASS_ERROR_SERVER_WRITE_TIMEOUT is "Write timeout" as reported by Cassandra 
    server, while CASS_ERROR_LIB_REQUEST_TIMED_OUT is timeout as reported by the 
    Cassandra library.

M	src/lib-sql/driver-cassandra.c

2016-12-05 09:53:06 +0000 Paul Howarth <paul@city-fan.org> (6ea072d)

    configure: Fix HAVE_MYSQL_SSL_CIPHER check


M	configure.ac

2016-12-06 18:14:31 +0200 Phil Carmody <phil@dovecot.fi> (66cbd09)

    plugins: mail-crypt - fix static analysis pedantry

    Clang cannot see that ret is -1, 0, or 1 upon assigment, and therefore
    -1 or 0 upon entry into the if block. Therefore it considers ret==0 not to
    be a tautology if ret!=-1, and thus falsifiable. It concludes that bad
    things can later happen.

    The easiest way to persuade it otherwise and make it clear to a human that
    things are sane is to make the first error check to be for any negative ret
    value, which forces the else path to explicitly imply ret==0, which means
    that clause can also be removed. Just removing the ret==0 doesn't make it so
    clear to the human that there's no third case.

    The final change is simply to mimic the ret==-1 to ret<0 change earlier.

    clang's error message:

    doveadm-mail-crypt.c:290:14: error: variable 'pubid' is used uninitialized
    whenever '&&' condition is false [-Werror,-Wsometimes-uninitialized]
     } else if (ret == 0 &&
                ^~~~~~~~ doveadm-mail-crypt.c:304:35: note: uninitialized use
    occurs here
      res->id = p_strdup(_ctx->pool, pubid);
                                     ^~~~~ doveadm-mail-crypt.c:290:14: note:
    remove the '&&' if its condition is always true
     } else if (ret == 0 &&
                ^~~~~~~~~~~

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/mail-crypt/doveadm-mail-crypt.c

2016-12-05 17:29:08 +0200 Phil Carmody <phil@dovecot.fi> (ec8dc91)

    lib/macros.h - protect old compilers from use of modern features

    no_sanitize(integer) is not in 3.5 (debian stable's version), but is 
    documented in 3.9. Exactly when it appeared isn't immediately obvious.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/macros.h

2016-12-04 03:44:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f7f4b65)

    configure: Fix building without OpenSSL

    AM_CONDITIONAL() needs to be part of the code path that is always run, or it
    fails with:

    configure: error: conditional "SSL_VERSION_GE_102" was never defined.

M	configure.ac

2016-12-03 20:48:30 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (4865422)

    dsync: Fixed boolean expression in dsync_mailbox_import_deinit().

    Found with Clang -Wstrict-bool.

M	src/doveadm/dsync/dsync-mailbox-import.c

2016-11-29 23:18:56 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0da9c83)

    lib: Add hmac helpers

    These run hmac for given data with given parameters and returns stack
    allocated buffer. They are helpful when doing lots of HMACs, such as the
    AWS4 signing protocol.

M	src/lib/hmac.c
M	src/lib/hmac.h

2016-11-24 18:12:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4add20e)

    sdbox: Rebuild index after it's been fsck'd


M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c

2016-11-28 03:26:01 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (b2b9e92)

    global: Added missing copyright notices.


M	src/auth/auth-policy.c
M	src/auth/mech-plain-common.c
M	src/auth/mycrypt.c
M	src/auth/password-scheme-rpa.c
M	src/doveadm/doveadm-print-formatted.c
M	src/doveadm/doveadm-print-json.c
M	src/lib-dcrypt/dcrypt-gnutls.c
M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c
M	src/lib-dns/test-dns-util.c
M	src/lib-fts/fts-library.c
M	src/lib-fts/fts-tokenizer-common.c
M	src/lib-http/http-request.c
M	src/lib-http/http-response.c
M	src/lib/pkcs5.c

2016-11-21 23:19:26 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (8adcf3d)

    lib-http: client: Fixed assert failure occurring when a new connection fails
    for a peer that has active connections.

    Fixes: Panic: file http-client-queue.c: line 481
    (http_client_queue_connection_failure): assertion failed: (queue->cur_peer
    == NULL)

M	src/lib-http/http-client-queue.c
M	src/lib-http/test-http-client-errors.c

2016-12-02 22:42:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (aeb41ed)

    dsync: Fix log format string broken by earlier change


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2016-12-02 22:29:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ffee200)

    dsync: Add mailbox names as well as GUIDs to log messages.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2016-12-01 02:29:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (41eb999)

    lib-storage: Fix simplifying sequence sets and UID sets.

    They were being handled completely wrong. The unit tests testing them were
    also completely wrong.

M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2016-12-01 02:26:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5cafce3)

    lib: seq_range_array_*(): Fix seq2=2^32-1 handling

    Adding/merging it when it already existed added duplicated seq_range.

M	src/lib/seq-range-array.c
M	src/lib/test-seq-range-array.c

2016-12-01 00:56:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (05278ed)

    lib-storage: Return vsize=0 from mailbox list index for empty mailboxes.

    If it's known that the mailbox has no mails, there's no reason to open the 
    mailbox to see that its size is 0.

M	src/lib-storage/list/mailbox-list-index-status.c

2016-11-30 15:59:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2d259b5)

    dict-client: Don't timeout lookups without waiting 1sec in dict ioloop.

    What could have happened was:

     - dict-client sends a request to dict-server
    - dict-client process starts doing something else
    - dict-server answers
    - dict-client process continues doing something else for over 30 seconds,
      not reading the dict-server answer
    - dict-client process gets back to dict ioloop, which runs the timeout
      before checking if there is anything available for reading.

    Now we'll wait for 1 second in the last dict ioloop before assuming that 
    there's a timeout.

M	src/lib-dict/dict-client.c

2016-12-01 19:06:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (19ae8a2)

    dsync: When logging "Mailbox changed caused a desync", log also the reason.

    The reason is usually somewhere in the debug logs, but it's difficult to 
    find from there.

M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2016-12-01 01:38:02 -0600 J. Nick Koston <nick@cpanel.net> (cda8cd7)

    config: Match multiple names in local_name

    This can significantly reduce memory usage when using a UCC certificate with
    multiple names by only loading the certificate and key once.

M	src/config/config-filter.c

2016-11-24 04:06:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3002d94)

    quota: Don't skip quota checks when moving mails between different quota
    roots.


M	src/plugins/quota/quota-storage.c

2016-11-24 20:40:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (be6bbcf)

    lib-storage: Add struct mail_save_context.copy_src_mail


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2016-11-30 02:17:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (18c5347)

    man: Update doveadm director flush description


M	doc/man/doveadm-director.1.in

2016-11-30 12:34:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cf7aca7)

    lib-storage: If mailbox_create() fails, don't leave box in partially opened
    state.

    For example with sdbox it may have opened the indexes, but not set mailbox's 
    GUID. A following MAILBOX_METADATA_GUID would then assert-crash because GUID 
    is empty.

M	src/lib-storage/mail-storage.c

2016-11-30 00:28:08 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (4f8d1db)

    mail-crypt: Remove dead assigment


M	src/plugins/mail-crypt/mail-crypt-key.c

2016-11-30 00:04:53 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (736d516)

    mail-crypt: Do not try to read error from unset variable


M	src/plugins/mail-crypt/mail-crypt-acl-plugin.c

2016-11-28 23:05:16 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (55f9181)

    mail-crypt: Do not attempt to cache keys on failure


M	src/plugins/mail-crypt/mail-crypt-key.c

2016-11-29 10:57:49 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (dcb58b0)

    autogen: Use HTTPS for wiki


M	autogen.sh

2016-11-28 15:20:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (beb9cf3)

    lib-dcrypt: Add error handling for dcrypt_key_id_private


M	src/lib-dcrypt/istream-decrypt.c

2016-11-28 15:17:55 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e8ca306)

    mail-crypt: Add error handling for mailbox_open in tests


M	src/plugins/mail-crypt/test-mail-key.c

2016-11-28 15:15:21 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (34ee727)

    doveadm-mail-crypt: Skip existing keys properly

    When generating new keypairs, handle existing keys correctly when skipping
    them.

M	src/plugins/mail-crypt/doveadm-mail-crypt.c

2016-11-28 14:52:50 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d5f9cd9)

    mail-crypt: Do not attempt to cache freed keypair


M	src/plugins/mail-crypt/mail-crypt-key.c

2016-11-28 14:45:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5f53b84)

    mail-crypt: Fail if key is not found and save_version less than 2

    Fail if save version is set to 0 or 1, instead of trying to use undefined
    value for public key.

M	src/plugins/mail-crypt/mail-crypt-plugin.c

2016-11-28 13:36:56 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (187826a)

    mail-crypt: Skip undef values if OpenSSL is <1.0.2

    OpenSSL 1.0.1 and earlier generate undef warnings due to using stack as
    randomness source in a way that valgrind does not like, so we disable undef
    value checks for mail-crypt-plugin.

M	src/plugins/mail-crypt/Makefile.am

2016-11-28 13:32:16 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a71d70b)

    m4: Detect OpenSSL version 1.0.2

    valgrind cannot work in all cases if openssl version is 1.0.2, so we need to
    know this to selectively disable valgrind.

M	configure.ac

2016-11-28 14:12:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (33498b5)

    dovecot.m4: Add NOUNDEF option to run-test.sh

    Using this environment variable will disable undefined value errors in
    valgrind.

M	dovecot.m4

2016-11-28 13:52:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2d4bf75)

    lib-index: mail_transaction_log_file_sync(): Don't mix I/O errors and
    corruption


M	src/lib-index/mail-transaction-log-file.c

2016-11-28 13:04:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (daa3eb9)

    lib-index: Fix assert-crash after "log file shrank" error.

    Fixes: Panic: file buffer.c: line 316 (buffer_set_used_size): assertion
    failed: (used_size <= buf->alloc)

M	src/lib-index/mail-transaction-log-file.c

2016-11-28 12:16:26 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fb7cdf7)

    mail-crypt: Commit transaction before lookup in test

    Key cannot be found if it's not committed before.

M	src/plugins/mail-crypt/test-mail-key.c

2016-11-25 01:45:29 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (4c38e5e)

    Add suppression for openssl leak


M	run-test-valgrind.supp

2016-11-25 00:45:35 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (c242e07)

    mail-crypt: Add manpage


M	.gitignore
M	doc/man/Makefile.am
A	doc/man/doveadm-mailbox-cryptokey.1.in
M	doc/man/doveadm-mailbox.1.in

2016-11-24 14:48:03 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (8797af3)

    mail-crypt: Add mail-crypt plugin


M	configure.ac
M	src/plugins/Makefile.am
A	src/plugins/mail-crypt/Makefile.am
A	src/plugins/mail-crypt/doveadm-mail-crypt.c
A	src/plugins/mail-crypt/fs-crypt-common.c
A	src/plugins/mail-crypt/fs-crypt-settings.c
A	src/plugins/mail-crypt/fs-crypt-settings.h
A	src/plugins/mail-crypt/fs-crypt.c
A	src/plugins/mail-crypt/fs-mail-crypt.c
A	src/plugins/mail-crypt/mail-crypt-acl-plugin.c
A	src/plugins/mail-crypt/mail-crypt-common.h
A	src/plugins/mail-crypt/mail-crypt-global-key.c
A	src/plugins/mail-crypt/mail-crypt-global-key.h
A	src/plugins/mail-crypt/mail-crypt-key.c
A	src/plugins/mail-crypt/mail-crypt-key.h
A	src/plugins/mail-crypt/mail-crypt-plugin.c
A	src/plugins/mail-crypt/mail-crypt-plugin.h
A	src/plugins/mail-crypt/mail-crypt-pluginenv.c
A	src/plugins/mail-crypt/mail-crypt-userenv.c
A	src/plugins/mail-crypt/test-mail-global-key.c
A	src/plugins/mail-crypt/test-mail-key.c

2016-11-25 09:49:25 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f581a8d)

    lib-dcrypt: Use module_dir setting


M	src/lib-dcrypt/Makefile.am
M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2016-11-25 09:48:43 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3dfbf3b)

    lib-dcrypt: Add module_dir setting

    This is needed for unit tests that require dcrypt, so that they can load
    backend without installing it first.

M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/dcrypt.h

2016-11-25 16:14:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a38f1ab)

    lib-storage: Fix raw storage to sync mailboxes correctly.

    Broken by b9da8540e665138b3cad0b637c08c0ab7d7a7eeb

M	src/lib-storage/index/raw/raw-sync.c

2016-11-25 15:34:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (162b8a3)

    lib-storage: Fix error handling in mailbox_list_index_refresh_force()

    Broken by recent changes.

M	src/lib-storage/list/mailbox-list-index.c

2016-11-22 01:28:33 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0805d0f)

    mkcert.sh: Use umask to create key file as 0600

    Fixes a race condition between creation of the file and a later chmod. This
    script was mostly meant as an example though, and not really for production
    use. Especially because it generates self-signed certs. CVE-2016-4983

M	doc/mkcert.sh

2016-11-24 18:12:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (265b585)

    mdbox: Rebuild index after it's been fsck'd


M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-map.h
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c

2016-11-24 17:52:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a81c40f)

    lib-storge: Call mail_storage.list_index_corrupted() when needed

    The callback is called whenever mailbox list index appears to be corrupted 
    with LAYOUT=index. The storage is responsible for adding to the index any 
    mailboxes that are missing.

M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2016-11-24 15:50:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (243d0d9)

    lib-storage: Add mail_storage.list_index_corrupted()

    The actual implementation is in the next commit.

M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-deleted-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/plugins/virtual/virtual-storage.c

2016-11-24 17:16:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (219dd30)

    lib-index: Add mail_index_unset_fscked()

    This can be used to easily remove MAIL_INDEX_HDR_FLAG_FSCKD. It takes a 
    transaction parameter instead of sync_ctx because some index rebuilds are
    done with a separate transaction while the sync_ctx is rolled back.

M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index.h

2016-11-24 15:49:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ead5dce)

    lib-index: fsck now adds MAIL_INDEX_HDR_FLAG_FSCKD to header.

    It can only be removed by an explicit header update.

M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index.h

2016-11-24 15:41:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (745c851)

    lib-storage: Rename mailbox_list_index.corrupted to
    corrupted_names_or_parents

    Makes it clearer what exactly the flag means.

M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2016-11-24 15:14:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a37771a)

    lib-index: If index open fails with fsck, retry opening once.

    The fsck should have fixed the log offsets and open should work.

M	src/lib-index/mail-index-map-read.c

2016-11-24 15:12:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5829710)

    lib-index: fsck: Fix log_file_head|tail_offset properly


M	src/lib-index/mail-index-fsck.c

2016-11-25 10:22:18 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (25a1ca4)

    lib-dcrypt: Add assert that vfs is initialized


M	src/lib-dcrypt/dcrypt.c

2016-11-24 19:53:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (67bb90d)

    lib-storage: Fail if no namespaces have list=yes

    The previous check allowed all namespaces to have list=children. This 
    crashed later on in mail_namespaces_get_root_sep(), because it couldn't find
    any list=yes namespaces.

M	src/lib-storage/mail-namespace.c

2016-11-25 00:17:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3472278)

    lib-index: Compiler warning fix


M	src/lib-index/mail-transaction-log.c

2016-11-22 18:34:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6bde01d)

    lib-mail: Add randomness test to test-mail-html2text


M	src/lib-mail/test-mail-html2text.c

2016-11-22 18:33:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (582003e)

    lib-mail: Fix assert-crash in mail_html2text_more() with invalid input.

    parse_data() continues forward thinking that it might have valid input, 
    until it has enough data and realizes that there's nothing valid. This 
    triggers:

    Panic: file mail-html2text.c: line 312 (mail_html2text_more): assertion
    failed: (pos >= buf_orig_size)

M	src/lib-mail/mail-html2text.c
M	src/lib-mail/test-mail-html2text.c

2016-11-19 02:32:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (62a17f6)

    lib: Clarify that buffer_write() zero-fills buffer when writing past its
    size


M	src/lib/buffer.h
M	src/lib/test-buffer.c

2016-11-19 01:54:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (56c5e1c)

    global: Code cleanup - avoid passing NULL to functions with non-null
    parameter


M	src/lib-dcrypt/test-stream.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/index-mailbox-size.c
M	src/lib/buffer.c
M	src/lib/istream.c

2016-11-19 02:00:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8dc068f)

    global: Avoid unnecessary unsigned integer wraps.

    Avoids complains from clang -fsanitize=integer

M	src/indexer/master-connection.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c

2016-11-19 01:59:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1215cce)

    global: Avoid loops unnecessarily decreasing below zero.

    Avoids complains from clang -fsanitize=integer

M	src/lib-mail/message-address.c
M	src/lib-mail/message-snippet.c
M	src/lib/sha3.c

2016-11-19 01:57:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5791bc2)

    lib: Mark md4/md5/sha1/sha2 code with ATTR_UNSIGNED_WRAPS


M	src/lib/md4.c
M	src/lib/md5.c
M	src/lib/sha1.c
M	src/lib/sha2.c

2016-11-19 01:56:19 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7acacae)

    lib-index: mail_index_map_register_ext(ext_offset=-1) now sets hdr_offset=-1

    It shouldn't make any difference, but this is a less confusing value.

M	src/lib-index/mail-index-map.c

2016-11-19 01:39:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1868f86)

    lib: Add ATTR_UNSIGNED_WRAPS for disabling clang -fsanitize=integer


M	src/lib/macros.h

2016-11-24 23:26:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3e14076)

    lib-index: Compiler warning fix.


M	src/lib-index/mail-transaction-log.c

2016-11-23 23:19:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0882459)

    lib-storage: Rotate dovecot.list.index.log* more often.

    The history in these files isn't as important as in mailbox indexes. Reduce
    disk space usage by rotating them more often and deleting the
    .log.2 more quickly.

M	src/lib-storage/list/mailbox-list-index.c

2016-11-23 23:12:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (39815e8)

    lib-index: Add mail_index_set_log_rotation()


M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c

2016-11-23 22:42:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e6a3d02)

    lib-storage: Try harder to rename a corrupted mailbox name to its old name.

    If the old name exists, use it as a prefix for the new name. This is 
    especially useful when restoring autocreated mailboxes. A new mailbox could
    have already been autocreated, but it's still useful to have the broken one
    renamed with the same prefix, so it'll be clear that these mailboxes should
    be merged.

M	src/lib-storage/list/mailbox-list-index-backend.c

2016-11-24 19:32:44 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (565ae33)

    dsync: Do not try replace remote folder GUID when doing oneway sync

    Oneway sync tried to replace remote folder's GUID when running in one way
    mode. This causes trouble, e.g. when running with imapc, because you can't
    do this.

M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2016-11-23 18:43:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (903a3ef)

    lib-storage: Fix rotation of dovecot.list.index.log

    After b9da8540e665138b3cad0b637c08c0ab7d7a7eeb the tail offsets weren't 
    being updated anymore when mail_index_sync_next() wasn't used to skip over
    all the data. Mailbox list index wasn't doing this, and so the log was never
    rotated since tail_offset was never equal to head_offset.

M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c

2016-11-23 17:14:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5e21c15)

    imapc: Fix assert that checks if mail is expunged locally.

    The EXPUNGE may have been sent while imapc_sync_index() was issuing remote
    imapc commands. It would end up being in delayed_expunged_uids, so the
    assert needs to check that too.

    Fixes: Panic: file imapc-sync.c: line 290 (imapc_initial_sync_check):
    assertion failed: (mail_index_is_expunged(view, lseq))

M	src/lib-storage/index/imapc/imapc-sync.c

2016-11-23 17:14:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (baca122)

    imapc: Cleanup - change delayed_expunged_uids to seq_range.

    This simplifies the next commit.

M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.h

2016-11-23 15:57:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2c3f376)

    auth: Don't crash expanding %variables when username isn't set.

    This continues the auth-policy fix in 
    c3d3faa4f72a676e183f34be960cff13a5a725ae

M	src/auth/auth-request-var-expand.c

2016-11-23 13:25:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (174242a)

    sdbox: Don't log an error if stub is added twice

    There's no locking for them, so it's fine if two processes add the same 
    mail. The second one could be ignored, but it was a bit easier to just let
    it rename over the first one.

M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-file.h
M	src/lib-storage/index/dbox-single/sdbox-save.c

2016-11-23 13:16:19 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (1f2c35d)

    auth: Fix auth-policy crash when username is NULL

    If SASL request is invalid, or incomplete, and username is left NULL, handle
    it gracefully by adding just NUL byte in auth policy digest for username.

M	src/auth/auth-policy.c

2016-11-22 10:21:24 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (1df7774)

    lib-storage: require MAIL_STORAGE_CLASS_FLAG_STUBS when caching

    If we are going to be using the storage for caching, we should check that 
    the storage actually supports mail stubs.

M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2016-11-22 18:00:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (988ff60)

    lib-fts: Add randomness test to test-fts-tokenizer


M	src/lib-fts/test-fts-tokenizer.c

2016-11-22 16:35:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8c4b4b9)

    lib-fts: Make sure address tokenizer can't return empty tokens.

    This happened when address was a token that first looked like it could be a
    valid address, but then got truncated due to reaching maxlen, followed by
    truncating the UTF8-sequence and finally all the rest of the '-' or
    '.' chars that were valid at the beginning of the address are stripped away
    by fts_tokenizer_delete_trailing_invalid_char(), leaving nothing left.

    Fixes: Panic: file fts-tokenizer.c: line 206 (fts_tokenizer_next): assertion
    failed: (ret <= 0 || (*token_r)[0] != '\0')

M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/test-fts-tokenizer.c

2016-11-22 17:31:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3b27e27)

    lib-fts: Fix fts_tokenizer_delete_trailing_partial_char() unit test


M	src/lib-fts/test-fts-tokenizer.c

2016-11-22 12:03:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (323d035)

    lib-index: Handle invalid headers as "corruption", not "temporary error"

    This is especially required for "Header's corrupted flag is set" error, 
    which won't get fixed otherwise.

    It's a bit more questionable if we should treat major version or CPU 
    architecture change as corruption, but it's possible those only exist 
    because of corruption. It's also very unlikely that either is really 
    happening. Ideally there would be a hash that verifies whether the header is
    corrupted or not.

M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c

2016-11-22 10:59:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c647daf)

    dict-client: dict_lookup*() deleted the first byte of the result.


M	src/lib-dict/dict-client.c

2016-11-21 14:05:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b8eed64)

    quota-clone: Flush quota-clone 10s after quota update if it's not already
    done

    This way a long-running IMAP session can't keep the quota-clone desynced for
    a long time.

M	src/plugins/quota-clone/quota-clone-plugin.c

2016-11-21 14:02:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ad10b85)

    quota-clone: Code cleanup - moved recursion check to quota_clone_flush()


M	src/plugins/quota-clone/quota-clone-plugin.c

2016-11-21 23:43:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (954b210)

    lib-dict: Add extra NULL-check to make static analyzer happier

    str_array_length() already checked NULL internally though.

M	src/lib-dict/dict-client.c

2016-11-21 13:57:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (df2a53f)

    lib-index: Limit mmap errors in txn log file to 1/s


M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h

2016-11-21 13:53:50 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0c92338)

    lib-index: Limit mmap errors in index cache to 1/s


M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.c

2016-11-21 13:34:57 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ae4d746)

    lib-index: Limit mmap syscall errors in index to 1/s


M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-private.h

2016-11-21 13:33:42 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a48c485)

    lib-index: Do not crash if log is missing

    Fixes sigfault when index and index.log files are corrupted.

M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-view.c

2016-11-21 19:05:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4330fa0)

    dict-client: Server can now send command replies in any order.

    This way one slow lookup doesn't block all the other ones.

    This change keeps backwards compatibility in the dict protocol for both 
    client and server.

M	src/dict/dict-commands.c
M	src/dict/dict-connection.h
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-client.h

2016-11-21 19:04:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (691f4f5)

    dict: Make sure iterate doesn't add to ostream when it's already full.


M	src/dict/dict-commands.c

2016-11-21 18:52:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a9d14bb)

    dict: Moved iterate's corking to more correct location.

    Commands' input handling already corks ostream in connection.c.

M	src/dict/dict-commands.c
M	src/dict/dict-connection.c

2016-11-21 18:46:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d3b8b1e)

    dict-client: Include reconnection-status in slow dict lookup messages.


M	src/lib-dict/dict-client.c

2016-11-21 16:55:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c2db9c8)

    dict-client: Add warn_slow_msecs setting

    This allows configuring the default 5 seconds "slow dict lookup" warning.

M	src/lib-dict/dict-client.c

2016-11-21 16:45:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0bfc9b7)

    dict-client: Add time spent in dict-server to "slow dict lookup" messages.

    This way you can see if the slowness was due to some communication problem 
    between dict-client/server or internally in dict server.

    This change keeps backwards compatibility in the dict protocol for both 
    client and server.

M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-connection.h
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-client.h

2016-11-21 16:44:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e2d1cff)

    dict-client: Code cleanup - handle tab-unescaping before callbacks.


M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-client.h

2016-11-21 13:29:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9627b1a)

    lib-index: Revert log flooding prevention / 3c014db6f

    This was intended only for mmap() errors.

M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.c

2016-11-19 04:04:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0077638)

    fts: Fixed potential crash when indexing mails.

    Normally it seems like compilers had built code that had added a NULL after
    the array, but there was no guarantee for that.

M	src/plugins/fts/fts-parser.c

2016-11-18 16:03:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (13fd9a5)

    imap: Fix recent flags importing when un-hibernating

    The initial RECENT counter that was sent didn't include pre-hibernation
    \Recent flags.

    \Recent flags were also added for mails that were already expunged, which 
    could have caused recent counter to be wrong later on, and possibly 
    assert-crash with:

    Panic: file index-status.c: line 130 (index_storage_get_open_status):
    assertion failed: (status_r->recent <= status_r->messages)

M	src/imap/imap-state.c

2016-11-18 16:58:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b513814)

    lib-index: Improve errors - return reason in mail_transaction_log_refresh()


M	src/lib-index/mail-transaction-log.c

2016-11-18 16:52:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1b0b3b6)

    lib-index: Improve errors - return reason in
    mail_transaction_log_file_open()


M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c

2016-11-18 16:41:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (704657e)

    lib-index: Add more information to "Missing middle file" error.


M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/test-mail-transaction-log-view.c

2016-11-18 16:27:33 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7e290d2)

    lib-index: mail_transaction_log_find_file() - remove wrong optimization.

    When opening the index, it's possible that:

    process A: .log is opened with seq=1 process B: Rotates the .log and writes
    a new dovecot.index with
     log_file_seq=2 process A: dovecot.index is opened.
    mail_transaction_log_view_set() now
     wants to file log_file_seq=2 with mail_transaction_log_find_file(), but
     because open_count==0, the .log isn't refreshed.

M	src/lib-index/mail-transaction-log.c

2016-11-18 16:15:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (00ecebf)

    lib-index: Compiler warning fix


M	src/lib-index/mail-index-map-read.c

2016-11-18 15:46:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6db548a)

    lib-index: If mmap() fails, include the attempted size in the error.


M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-transaction-log-file.c

2016-11-18 15:39:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (23c7e63)

    lib-storage: Fix checking stub_seq failure in mailbox_save_set_uid()


M	src/lib-storage/mail-storage.c

2016-11-18 15:17:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7fdf108)

    sdbox: Implement support for mail stubs


M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-save.c

2016-11-18 15:16:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (66c5ede)

    lib-storage: Add support for storing "mail stubs"

    These allow treating a storage backend as a cache where the mail bodies 
    don't necessarily exist.

M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2016-10-20 15:54:40 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (d80bf6c)

    lib-storage: Fixed a boolean expression.

    Problem found with clang -Wstrict-bool.

M	src/lib-storage/mail-storage.c

2016-10-17 09:13:21 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (588a47c)

    lib-storage: treat empty root_dir as an empty string


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2016-11-18 14:10:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b44a93c)

    imapc: %zu isn't standard, use PRIuSIZE_T instead.


M	src/lib-storage/index/imapc/imapc-storage.c

2016-10-12 14:32:51 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (244b25c)

    imapc: don't mix positional and designated initialization


M	src/lib-storage/index/imapc/imapc-list.c

2016-11-15 18:39:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a14d000)

    lib: Add connection.allow_empty_args_input

    This simplifies input_args() callbacks since they don't always have to check 
    for args[0] == NULL. This is enabled by default, because none of the current 
    users want it and it's somewhat unlikely there even will be those in future.

M	src/lib/connection.c
M	src/lib/connection.h

2016-11-17 15:59:02 -0500 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (1d0ef5c)

    lib-storage: fix index_mail_get_headers return value

    And make it more obvious that we're not setting the actual return value in 
    index_mail_get_first_header.

M	src/lib-storage/index/index-mail-headers.c

2016-11-18 01:23:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2aa182a)

    lib-index: Fix detecting whether caller synced everything in mailbox.

    When mailbox_index_sync_begin() was followed by _commit(), without _next()s 
    in the middle actually syncing the mailbox, the tail_offset was updated to 
    indicate that the mailbox was fully synced. Existing code didn't rely on 
    this, so it probably didn't break anything.

    This code hasn't worked for a long time, because log_view is always read 
    fully to the end in _sync_begin().

M	src/lib-index/mail-index-sync.c

2016-11-15 00:42:27 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (853f5e3)

    lib-storage: Add mail_storage_service_user_get_pool()


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2016-11-15 00:41:38 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (f148562)

    global: Replace some settings_parse_line() calls with
    settings_parse_keyvalue()


M	src/config/config-parser.c
M	src/doveadm/doveadm-dsync.c
M	src/lib-storage/mail-storage-service.c

2016-11-15 00:36:57 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (47505a2)

    lib-settings: Add settings_parse_keyvalue()


M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings-parser.h

2016-11-14 23:32:05 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (758c719)

    lib-settings: Avoid duplicating settings' values when not needed


M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings-parser.h

2016-11-14 22:57:41 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (fa42553)

    imapc: Use struct mail_namespace.user_set


M	src/lib-storage/index/imapc/imapc-list.c

2016-11-14 22:43:07 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (f0343cb)

    lib-storage: Add mail_namespace_get_driver_settings() and use it.

    It obsoletes mail_storage_get_driver_settings().

M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2016-10-17 09:18:27 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (c0d3aa5)

    imapc: use serialized settings as unique_root_dir

    Without this, it is not possible to instantiate multiple imapc storages. Any
    attempts to will result in multiple namespaces sharing the same storage, 
    regardless of if that was the intention.

M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2016-11-14 22:32:42 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (f242660)

    lib-storage: Add struct mail_namespace.user_set


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h

2016-11-14 18:34:02 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (d97ad2e)

    lib-storage: Use mail_namespace_alloc() for mail_namespaces_init_location()

    Based on patch by Jeff Sipek

M	src/lib-storage/mail-namespace.c

2016-11-14 18:33:37 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (d5fa1f2)

    lib-storage: Add mail_namespace_alloc()

    This makes it easier to create new namespaces. Based on patch by Jeff Sipek

M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h

2016-11-10 13:19:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2479d44)

    lib-storage: Add asserts to make sure mailbox_header_lookup_ctx is used
    correctly.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail.c

2016-11-14 17:41:23 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (c04a8e7)

    lib-index: Added mail_index_transaction_get_highest_modseq()


M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-file.c

2016-11-14 17:37:31 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (3ccf77a)

    lib-index: Added internal mail_index_transaction_finish_so_far()

    This can be called multiple times before mail_index_transaction_finish(). 
    It's going to perform all the work of reordering mails and dropping 
    unnecessary changes that can be done before changing sequences to UIDs.

    This will be needed for the following patch that implements 
    mail_index_transaction_get_highest_modseq().

M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/test-mail-index-transaction-finish.c

2016-11-14 17:22:53 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (3d4a16d)

    lib-index: Assert if mail_index_transaction_sort_appends() sees any uid==0

    Every mail must have an UID at this stage.

M	src/lib-index/mail-index-transaction-sort-appends.c

2016-10-31 10:49:38 +0000 Paul Howarth <paul@city-fan.org> (ed526ea)

    configure: Fix build with old OpenSSL without SSL_clear_options

    SSL_clear_options was introduced in OpenSSL 0.9.8m but may be backported to
    older versions in "enterprise" OS releases, so a version check is
    insufficient here.

    It was originally implemented as a macro but is a function in more recent
    OpenSSL versions, so a test that works for both cases is needed.

M	configure.ac
M	src/lib-ssl-iostream/iostream-openssl.c

2016-11-17 17:13:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f8d52f6)

    lib-index: Make sure an already-corrupted index/log isn't written


M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-transaction-log-file.c

2016-11-17 02:48:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (70f4b4f)

    imapc: Fix assert-crash when deleting mailbox triggers
    mailbox_get_open_status().

    For example vsize header updating triggers this.

    Fixes: Panic: file mail-storage.c: line 1683: unreached

M	src/lib-storage/index/imapc/imapc-storage.c

2016-11-16 21:40:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d0f04ac)

    lib-storage: Fix compiler warnings about enum mismatches


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-sync.c

2016-11-16 03:11:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7962988)

    LAYOUT=index: Try to rename corrupted mailbox name during mailbox open.


M	src/lib-storage/list/mailbox-list-index-backend.c

2016-11-16 03:10:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1e32b21)

    lib-storage: Added struct mailbox.corrupted_mailbox_name

    This allows backends that are adding lost mailboxes to mailbox list index to 
    indicate that they don't actually know the name of the mailbox, and the 
    mailbox list index should try to figure it out and rename the mailbox to its 
    proper name.

M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/mail-storage-private.h

2016-11-16 03:06:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0e6ec60)

    LAYOUT=index: Don't write corrupted mailbox names to box-name header.

    This way when opening a mailbox the box-name header isn't overwritten by a
    corrupted name.

    Keep track of the corrupted names with
    MAILBOX_LIST_INDEX_FLAG_CORRUPTED_NAME flag in list index records. The flag
    isn't removed until the mailbox is renamed.

M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2016-11-16 03:01:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c4057d7)

    lib-storage: Preserve box-name header when rebuilding index.


M	src/lib-storage/index/index-rebuild.c

2016-11-16 01:44:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ad98f19)

    doveadm dump: Add support for the new box-name index header.


M	src/doveadm/doveadm-dump-index.c

2016-11-16 01:43:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (03917da)

    LAYOUT=index: Update mailbox name to mailbox index's header when opening.

    This way if the mailbox list index gets lost, a recent mailbox name is still 
    available.

M	src/lib-storage/index/index-storage.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/mail-storage-private.h

2016-11-16 01:09:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d76ce1b)

    lib-storage: Prevent renaming mailbox under itself.

    This resulted earlier in a loop, which broke the mailbox index. Note that
    IMAP already prevented this, so it could only be triggered by other tools,
    like doveadm.

M	src/lib-storage/list/mailbox-list-index-backend.c

2016-11-16 01:04:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4e42afd)

    lib-storage: Prevent parent loops in mailbox list index


M	src/lib-storage/list/mailbox-list-index.c

2016-11-16 01:03:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (dbe6c90)

    lib-storage: Fix invalid parents in LAYOUT=index

    Previously it just kept complaining without fixing the errors.

M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2016-11-16 01:01:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (95be2fc)

    lib-storage: Improve mailbox list index corruption errors


M	src/lib-storage/list/mailbox-list-index.c

2016-11-16 00:57:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5cbd16c)

    lib-storage: If LAYOUT=index loses mailbox names, write the generated ones
    to index.

    Previously it just kept complaining and regenerating new names, without 
    actually fixing up the situation.

M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2016-11-16 00:55:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d980af3)

    lib-storage: Fix handling LAYOUT=index losing mailbox names

    It lost all the mailbox names.

M	src/lib-storage/list/mailbox-list-index.c

2016-11-11 13:40:55 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2e896b5)

    config: Match local_name using dns-util

    This way it correctly handles wildcards.

M	src/config/Makefile.am
M	src/config/config-filter.c

2016-11-11 13:36:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (41bee81)

    lib-dns: Add tests for dns-util


M	src/lib-dns/Makefile.am
A	src/lib-dns/test-dns-util.c

2016-11-11 13:13:29 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0440813)

    lib-dns: Add DNS specific matching algorithms

    RFC4343 and RFCRFC4592 compare and match algorithms

M	src/lib-dns/Makefile.am
A	src/lib-dns/dns-util.c
A	src/lib-dns/dns-util.h

2016-11-16 21:36:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bb2fcd3)

    master: Fix compiling with systemd after /dev/null changes


M	src/master/service-listen.c

2016-11-16 17:36:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (82a1704)

    configure: Removed AC_CONFIG_MACRO_DIR([m4]) for now

    Fixes: libtoolize: AC_CONFIG_MACRO_DIR([m4]) conflicts with
    ACLOCAL_AMFLAGS=-I ..

M	configure.ac

2016-11-16 12:47:59 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (9c7ff1c)

    imap: Use correct format specifier for highestmodseq


M	src/imap/imap-state.c

2016-11-16 13:45:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1e78108)

    Makefile: Add -I . to ACLOCAL_AMFLAGS

    Without this when aclocal is automatically run it doesn't generate a working 
    configure.

M	Makefile.am

2016-11-16 13:29:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c4c48f8)

    lib-index: Fix flushing NFS if minimum wanted transaction log file is lost


M	src/lib-index/mail-transaction-log-view.c

2016-11-15 18:55:36 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3336e99)

    imap: Add details why unhibernation failed

    This can help understanding why client failed to unhibernate.

M	src/imap/imap-state.c

2016-11-16 11:41:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d01fa63)

    global: Use fd_close_maybe_stdio()


M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap/imap-client.c
M	src/lib/connection.c
M	src/lmtp/client.c
M	src/pop3/pop3-client.c

2016-11-16 11:40:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (58bd950)

    lib: Add fd_close_maybe_stdio()

    The idea is that this should be used whenever closing fds that may be 0 or 
    1. If they are closed normally, the following code may end up using 0/1 fd 
    for other purposes, which could cause problems.

M	src/lib/lib.c
M	src/lib/lib.h

2016-11-16 11:37:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2481c30)

    global: use dev_null_fd instead of opening /dev/null


M	src/lib-program-client/program-client-local.c
M	src/lib/module-dir.c
M	src/master/common.h
M	src/master/main.c
M	src/master/service-process.c

2016-11-16 11:35:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f3fc24f)

    master: Don't unlink login sockets at startup if someone is listening to
    them.

    The original check there never worked, because null_fd was always set.

    Normally the master.pid file would prevent this happening, but if it didn't 
    exist, the sockets would be unlinked and usually also created back.

M	src/master/common.h
M	src/master/main.c
M	src/master/master-settings.c

2016-11-16 11:17:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2b3d98d)

    lib-master: Revert redundant stdin/stdout/stderr fd checks

    This is now done by lib_init() in a bit nicer way.

    Reverts 08923d2c956ece3dc604d5842ba152c2bdb11fb9

M	src/lib-master/master-service.c

2016-11-16 11:09:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c5f651e)

    lib: Make sure stdin/stdout/stderr have fd at startup and keep /dev/null
    always open

    This guarantees we will always have a fd that can be used as /dev/null. It
    works even inside chroots.

M	src/lib/lib.c
M	src/lib/lib.h

2016-11-15 23:56:19 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (17c9926)

    Fix -Wstrict-bool compiler warnings.


M	src/lib-index/mail-index-sync-update.c
M	src/lib/sha3.c

2016-11-03 15:30:58 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f373f2e)

    doveadm-save: Check stream errno before save

    This is to ensure the file has been really opened.

M	src/doveadm/doveadm-mail-save.c

2016-11-13 20:04:27 +0200 Apollon Oikonomopoulos <apoikos@debian.org> (c164f8a)

    Manually cleanup OpenSSL from dovecot_openssl_common_global_unref()

    OpenSSL 1.1 features a cleanup function that is automatically run on
    shutdown using atexit(3). This function frees all OpenSSL-allocated
    resources.

    In dovecot, OpenSSL is loaded indirectly using dlopen(3) against the
    relevant dovecot crypto module and is finally unloaded using dlclose(3).
    Until OpenSSL 1.0.1c this worked fine, however OpenSSL 1.0.1c makes sure[1]
    that the library stays loaded after the initial dlclose() so that the
    atexit(3) handlers can run on shutdown. This, together with the fact that
    dovecot uses custom allocation functions for OpenSSL and has already
    partially free()'d some of OpenSSL's resources in module_free(), leads to a 
    segfault at process shutdown[2].

    We fix this by explicitly calling OPENSSL_cleanup() during module unload.
    This is safe to do, as long as we will never want to subsequently
    re-initialize OpenSSL.

    [1]
    https://github.com/openssl/openssl/commit/4af9f7fe79ff82b90c16969b7e5871435056377b
    [2]
    https://buildd.debian.org/status/fetch.php?pkg=dovecot&arch=amd64&ver=1:2.2.26.0-2&stamp=1478873022

    Signed-off-by: Apollon Oikonomopoulos <apoikos@debian.org>

M	src/lib-ssl-iostream/dovecot-openssl-common.c

2016-11-15 12:55:44 +0100 Apollon Oikonomopoulos <apoikos@debian.org> (b775f8b)

    ssl: fix reference to SSLv2 and disable SSLv3

    This is driven by the fact that OpenSSL 1.1 does not know about SSLv2 at all
    and dovecot's defaults simply make OpenSSL error out with "Unknown protocol
    'SSLv2'"[1]. So we change the defaults to refer to SSLv2 iff OpenSSL seems
    to know something about it.

    While at it, it's also a good idea to disable SSLv3 by default as well.

    [1] https://bugs.debian.org/844347

    Signed-off-by: Apollon Oikonomopoulos <apoikos@debian.org>

M	doc/example-config/conf.d/10-ssl.conf
M	src/lib-master/master-service-ssl-settings.c

2016-11-15 11:42:47 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (ba72c69)

    lib-http: Use io_wait_timer for tracking wait times.

    The previous code was completely incorrect, since it wasn't even tracking 
    the HTTP request's start usecs.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2016-11-15 11:41:53 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (9b69686)

    dict-client: Use io_wait_timer for tracking wait times.

    This way the "dict wait" time includes all ioloop waits that wait on the 
    dict-client, not just in dict_wait().

M	src/lib-dict/dict-client.c

2016-11-15 11:21:56 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (4c8b671)

    lib: Added io_wait_timer

    This allows easier tracking of how much time the io_wait_timer has been 
    spending on (multiple) ioloops.

M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2016-11-15 11:20:41 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (47c7576)

    lib: Code cleanup - move code to ioloop_add_wait_time()


M	src/lib/ioloop.c

2016-11-15 11:11:37 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (52c4324)

    lib: Fix ioloop wait times when io_loop_time_refresh() is used


M	src/lib/ioloop-private.h
M	src/lib/ioloop.c

2016-11-15 20:10:43 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ac2373f)

    doveadm: Put doveadm_mail_iter_init parameters to right order


M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-flags.c

2016-11-15 13:40:54 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (43735d5)

    lib-storage: Add vsize hdr on empty mailbox


M	src/lib-storage/index/index-mailbox-size.c

2016-11-15 13:17:05 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (11eaa05)

    doveadm-director: Include tag in add line


M	src/doveadm/doveadm-director.c

2016-11-15 09:33:15 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (41e2afa)

    doveadm-import: Open source boxes read-only

    This allows importing emails from read-only locations, such as backups.

M	src/doveadm/doveadm-mail-import.c

2016-11-15 09:32:31 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (81c22db)

    doveadm: Add open read-only parameter to mailbox iterator

    This allows iterating mailboxes so that they are opened for read-only.

M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-iter.h
M	src/doveadm/doveadm-mail-search.c

2016-11-06 02:50:52 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (03cb943)

    stats: Add support for carbon-server

    Allows admin to specify stats_carbon_server=ip:port. Stats are delivered in
    "key value" format to specified port. Can be received with e.g. metronome.

M	src/stats/Makefile.am
M	src/stats/mail-stats.c
M	src/stats/mail-stats.h
A	src/stats/stats-carbon.c
A	src/stats/stats-carbon.h
M	src/stats/stats-settings.c
M	src/stats/stats-settings.h

2016-11-09 15:17:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fd7219a)

    lib: Add net_ipport2str

    Converts struct ip_addr + port into either 127.0.0.1:6000 or [::1]:6000.

M	src/lib/net.c
M	src/lib/net.h

2016-11-14 10:52:22 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a2ad021)

    doveadm: Fix error reporting for doveadm-dump-dcrypt


M	src/doveadm/doveadm-dump-dcrypt-file.c
M	src/doveadm/doveadm-dump-dcrypt-key.c

2016-11-14 14:54:37 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (2135342)

    lib: Assert-crash in i_close_fd() if fd == 0

    lib-master now guarantees that fd==0 doesn't normally happen.

M	src/lib/macros.h

2016-11-14 14:51:45 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (fd717f4)

    master: Remove redundant check to guarantee stdin/stdout/stderr fd
    existence.

    The previous method also wasn't correct, since it was setting close-on-exec 
    flag for the fds. Although this didn't normally make any difference, since 
    stdin & stdout was explicitly dup2()ed to /dev/null and for all except the 
    log process stderr was also being dup2()ed.

M	src/master/main.c

2016-11-14 14:48:20 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (7071e57)

    lib-master: Make sure stdin/stdout/stderr fds are open.

    We'll just open /dev/null for them if they don't already exist.

M	src/lib-master/master-service.c

2016-11-14 16:45:24 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (15150ac)

    lib: Mark istream with eof=TRUE on all errors

    Previously only i_stream_read() did this, but i_stream_seek(), _stat(),
    _get_size() and _create() didn't. This caused assert-crashes on error 
    conditions in code which assumed that when stream_errno != 0, eof==TRUE.

M	src/lib/istream.c

2016-11-09 15:40:48 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fa542e3)

    lib-program-client: Do not call callback when destroying


M	src/lib-program-client/program-client-private.h
M	src/lib-program-client/program-client.c

2016-11-14 13:22:06 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (9eba01e)

    dict-client: When dict-server times out, log ioloop/lock waits.


M	src/lib-dict/dict-client.c

2016-11-14 13:18:13 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (80a903b)

    dict-client: Code cleanup to timeout handling.

    No functional changes.

M	src/lib-dict/dict-client.c

2016-11-14 13:14:25 +0100 Timo Sirainen <timo.sirainen@dovecot.fi> (26bab69)

    dict-client: Dict server timeout may have occurred too early.


M	src/lib-dict/dict-client.c

2016-11-11 17:00:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (22a30b5)

    lib-index: Improve error messages when transaction log is unexpectedly lost


M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-sync-private.h
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-view.c

2016-11-10 23:00:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2b41fba)

    dict-client: Forward dict_iterate_set_limit() to dict server


M	src/dict/dict-commands.c
M	src/lib-dict/dict-client.c

2016-11-10 23:23:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (db29579)

    dict-client: Code cleanup - remember all iteration flags


M	src/lib-dict/dict-client.c

2016-11-10 22:57:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0640d22)

    lib-dict: Fix infinite loop when row limit is reached.

    If dict_iterate_has_more() keeps returning TRUE, the caller keeps calling 
    dict_iterate().

M	src/lib-dict/dict.c

2016-11-10 18:24:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (739c4c0)

    sdbox: Fix crash on mailbox_sync*() when mailbox auto-open fails.


M	src/lib-storage/index/dbox-single/sdbox-sync.c

2016-11-11 13:06:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (da8e733)

    director: Don't access freed memory during deinit


M	src/director/mail-host.c

2016-11-09 15:17:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b1818b9)

    director: Fix crash when receiving USER-MOVE for nonexistent user.


M	src/director/director.c

2016-11-08 20:41:15 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7dc4e79)

    imap: Free box on error

    Otherwise the box wil leak as it is not assigned anywhere and can cause
    crash on imap exit due to stats plugin timeout leak.

M	src/imap/imap-state.c

2016-10-20 19:06:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ea6c665)

    director: Keep per-tag directory


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/mail-host.c
M	src/director/mail-host.h
M	src/director/main.c
M	src/director/notify-connection.c

2016-11-01 14:36:19 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (789e6eb)

    director: Code cleanup - typedef user_free_hook

    This is done because user_free_hook needs to be also used in mail_host. If
    it changes, this reduces the places that need touching.

M	src/director/user-directory.c
M	src/director/user-directory.h

2016-11-01 14:40:49 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0996493)

    director: Code cleanup - Reorder includes

    This is required to enable typedef of user_free_hook

M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/mail-host.h
M	src/director/notify-connection.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c

2016-10-20 20:31:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e9a9d39)

    director: Code cleanup - moved username_hash generation to director.h

    It's not really user_directory specific. This is especially important in the
    following patches that add per-tag user_directories. It's also not always
    known which tag the username_hash refers to, so there can't be different
    tag-specific username_hash generators.

M	src/director/director-request.c
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/notify-connection.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2016-10-20 19:38:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dccfab9)

    director: Code cleanup - added user director_iterate_users_*() wrappers.

    This will shrink the diff for the following changes.

M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c

2016-10-20 19:17:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a433b8b)

    director: Code cleanup - use temporary users variables

    This will shrink the diff for the following changes.

M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c
M	src/director/doveadm-connection.c

2016-10-20 16:14:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7bf427c)

    director: Code cleanup - moved code to notify_update_user()


M	src/director/notify-connection.c

2016-10-20 15:13:04 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (6588dc3)

    director: const mail_host in mail_host_get_tag


M	src/director/mail-host.c
M	src/director/mail-host.h

2016-11-05 19:06:33 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (6a7943d)

    lib: Add test vectors for message digests


M	src/lib/test-hash-method.c

2016-11-05 11:48:27 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fb21560)

    lib: Add SHA3 hashing methods for 256 and 512 bits


M	src/lib/Makefile.am
M	src/lib/hash-method.c
A	src/lib/sha3.c
A	src/lib/sha3.h

2016-11-05 11:47:40 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d29f070)

    lib: Move sha context and result size to new header

    This is to prepare for SHA3 inclusion

M	src/lib/Makefile.am
A	src/lib/sha-common.h
M	src/lib/sha2.h

2016-11-04 12:18:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b388982)

    lib-storage: Updated MAIL_SEARCH_ARG_FLAG_USE_TZ comment.


M	src/lib-storage/mail-search.h

2016-11-04 12:04:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f33ead8)

    lib-storage: Fix doveadm search query parsing to use timezones correctly.

    When using a date string, e.g. "senton 25-Mar-2007" it should work the same 
    way as IMAP does and show all mails whose sent date is on 25th, ignoring 
    whatever the timezone is in the Date header (or in case of
    received/saved-date it would be using the timestamps in server's local
    timezone, again just like IMAP).

    When search with an exact UNIX timestamp or a time interval (e.g.
    "3 days"), it should be using UTC times for doing all comparisons.

M	src/doveadm/doveadm-dsync.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2016-11-04 12:03:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (25609df)

    lib-storage: Reverse MAIL_SEARCH_ARG_FLAG_USE_TZ handling again.

    It wasn't really wrong, it was just confusing. And doveadm's tz-handling was
    wrong.

    Reverses 059e4ac419224598349704b74cb9f6b49278df46

M	src/lib-storage/index/index-search.c

2016-11-03 19:16:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (48a6ada)

    lib: Define ARRAY_TYPE for uint8_t, uint16_t and uint64_t.


M	src/lib/array-decl.h

2016-11-01 21:50:29 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e086fc3)

    auth: Use buffer_truncate_rshift_bits


M	src/auth/auth-policy.c

2016-10-27 16:20:20 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (cd5d16a)

    lib: Add tests for hashed var-expand


M	src/lib/test-var-expand.c

2016-10-27 15:37:45 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (f7f66f6)

    lib: Add generic hashing support to var-expand

    Enables use of

    %{H;rounds=<rounds>,truncate=<bits>,salt=<salt>:field}

    syntax in any variable expansion. H is any supported hash algorithm or pkcs5
    for PKCS#5 PBKDF2 using SHA256.

M	src/lib/var-expand.c

2016-10-31 19:20:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d845c5c)

    lib: var_expand() code cleanup - Moved short %v expansion to its own
    function.


M	src/lib/var-expand.c

2016-11-01 20:14:43 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (45aeec4)

    lib: Add unit test for buffer truncate


M	src/lib/test-buffer.c

2016-05-16 13:19:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (51fb864)

    lib: Updated buffer_set_used_size() comment and added unit test.


M	src/lib/buffer.h
M	src/lib/test-buffer.c

2016-10-27 16:19:52 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (01557bc)

    lib: Do not consume {} inside %{}


M	src/lib/var-expand.c

2016-11-01 20:06:46 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (56e3366)

    lib: Add buffer truncate


M	src/lib/buffer.c
M	src/lib/buffer.h

2016-11-02 23:00:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (36447e7)

    auth: Make static analyzer happier.

    Don't complain about uninitialized static_password being sent to 
    passdb_handle_credentials(). It could only happen for failures, and 
    passdb_handle_credentials() wouldn't have used the password then.

M	src/auth/passdb-static.c

2016-11-02 21:59:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a5fd196)

    fts: Fix error message when syncing FTS root mailbox fails.


M	src/plugins/fts/fts-api.c

2016-11-02 15:31:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (765dd99)

    lib: ioloop-notify-kqueue wasn't storing source filename.


M	src/lib/ioloop-notify-kqueue.c

2016-11-09 00:48:32 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (b061448)

    lib-http: test-http-client-errors: Add test for server that returns error
    status early while client is still sending blocking payload.


M	src/lib-http/test-http-client-errors.c

2016-11-09 00:46:32 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (78d1558)

    lib-http: client: Fixed assert failure occurring when server returns error
    status early while client is still sending blocking payload.


M	src/lib-http/http-client-request.c

2016-11-09 00:24:54 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (7421c8e)

    lib-http: Added blocking client support to test-http-client-errors.


M	src/lib-http/test-http-client-errors.c

2016-11-03 21:06:27 +0100 Stephan Bosch <stephan.bosch@dovecot.fi> (4d150ce)

    lib-http: Fixed potential segfault problem in test-http-client-errors.

    Found by Coverity.

M	src/lib-http/test-http-client-errors.c

2016-10-25 09:56:34 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (c58821d)

    lib-http: Added DNS-related tests to test-http-client-errors.


M	src/lib-http/test-http-client-errors.c

2016-09-16 20:29:00 +0200 Stephan Bosch <stephan@dovecot.fi> (e9b4a88)

    lib-http: client: Destroy host and associated queue objects after no more
    requests remain and an idle timeout expires.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c

2016-09-16 20:22:17 +0200 Stephan Bosch <stephan@dovecot.fi> (2ac61a7)

    lib-http: client: Implemented host name lookup TTL.

    Host name lookups will now be performed again when the results have expired. 
    Without access to TTL information from DNS lookups, all lookups will use the
    same default TTL for now.

M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2016-09-15 22:49:54 +0200 Stephan Bosch <stephan@dovecot.fi> (d9fee0b)

    lib-http: client: Added http_client_queue_requests_active().

    It counts how many active requests a queue has.

M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c

2016-09-16 01:58:27 +0200 Stephan Bosch <stephan@dovecot.fi> (6d39f7b)

    lib-http: client: Create queue->pending_peers array from the beginning.

    This simplifies the code, since the pending peers array is always used.

M	src/lib-http/http-client-queue.c

2016-09-16 01:35:09 +0200 Stephan Bosch <stephan@dovecot.fi> (6d7bf6d)

    lib-http: client: Link peers to queue earlier: during connection attempts.

    This makes sure that queues keep track of which peers are doing stuff on its
    behalf. This is important to be able to manage the active peers when a new
    host name lookup was performed; if a peer is no longer listed in the
    returned IPs it should be dropped.

M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c

2016-09-15 02:14:46 +0200 Stephan Bosch <stephan@dovecot.fi> (3db76db)

    lib-http: client: Created http_client_peer_drop() function that closes a
    peer object gracefully.

    It checks whether any connections are still present. It checks whether a
    backoff timer is still active. This change and subsequent changes prepare
    for being able to destroy a queue when it becomes unused. All peers linked
    to such a queue are unlinked and dropped when inactive and unlinked.

M	src/lib-http/http-client-peer.c

2016-06-16 22:02:08 +0200 Stephan Bosch <stephan@dovecot.fi> (3a939e6)

    lib-http: client/server: Enable the TCP_NODELAY option for all connections.

    This disables the TCP Nagle algorithm. With the Nagle algorithm enabled, TCP
    waits a little to accumulate more data in a small segment before it is sent.
    For transfer of large continuous payloads, this is not useful and even
    harmful. If the final remaining bit of the payload is small, the TCP layer
    will wait for a significant amount of time at the end of the payload. For
    many sequential transfers, this amounts to much waiting time. This is
    particularly evident in the test-http-payload test suite tool. Setting
    TCP_NODELAY decreases its run time from up to 20 minutes to about half a
    minute my system.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-server-connection.c

2016-06-16 22:01:06 +0200 Stephan Bosch <stephan@dovecot.fi> (a2f8d56)

    lib: Created net_set_tcp_nodelay(), which enables the TCP_NODELAY socket
    option.

    This disables the TCP Nagle algorithm.

M	src/lib/net.c
M	src/lib/net.h

2016-05-23 02:36:10 +0200 Stephan Bosch <stephan@dovecot.fi> (3019190)

    lib-http: client: Improved labeling of debug messages.

    Request label is corrected. Labels are now pre-composed and stored.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2016-04-16 03:54:00 +0200 Stephan Bosch <stephan@dovecot.fi> (70b91e6)

    lib-http: server: Implemented means to gracefully shut down the server.

    While shutting down, it will not accept new requests and connections are
    closed once they become idle.

M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-private.h
M	src/lib-http/http-server.c
M	src/lib-http/http-server.h

2016-04-27 12:00:25 +0200 Stephan Bosch <stephan@rename-it.nl> (09d628c)

    lib-http: client: Added ability to configure a specific proxy for individual
    requests.

    This way, a request can be routed to a specific proxy (or origin server).
    The destination can also be a unix socket.

M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2016-04-16 02:05:28 +0200 Stephan Bosch <stephan@dovecot.fi> (5a1f8f0)

    lib-http: client: Added pure attribute to some of the request property
    functions.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2016-04-16 02:03:10 +0200 Stephan Bosch <stephan@dovecot.fi> (390a66a)

    lib-http: client: Cleaned up headers and added some more documentation
    there.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.h

2016-09-15 02:09:47 +0200 Stephan Bosch <stephan@dovecot.fi> (0c43fc2)

    lib-http: client: Unlink all queues from peer when it is disconnected.

    Before, queues were only destroyed when the whole client was destroyed. This
    change and subsequent changes prepare for being able to destroy a queue when
    it becomes unused.

M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c

2016-09-15 01:59:23 +0200 Stephan Bosch <stephan@dovecot.fi> (9f5429b)

    lib-http: client: Improved logging of connection loss handling in peer.


M	src/lib-http/http-client-peer.c

2016-09-14 21:37:38 +0200 Stephan Bosch <stephan@dovecot.fi> (7b4439d)

    lib-http: client: If a peer object is no longer linked to a queue, don't
    close it until all connections are inactive.

    The peer object is canceled, rather than closed. Which means that any newly
    started and idle connections are closed immediately. Requests may be pending
    though. This is only relevant when hosts/queues are removed at some point. 
    This is a preparational change for having a maximum lifetime on
    hosts/queues, in which case this becomes a possibility.

M	src/lib-http/http-client-peer.c

2016-09-14 01:37:05 +0200 Stephan Bosch <stephan@dovecot.fi> (e008bd3)

    lib-http: client: Added debug messages that indicate when a queue is
    linked/unlinked to a peer.


M	src/lib-http/http-client-peer.c

2016-09-14 01:30:16 +0200 Stephan Bosch <stephan@dovecot.fi> (786336c)

    lib-http: client: Added function that counts how many connections are active
    within a peer.


M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2016-09-14 01:26:10 +0200 Stephan Bosch <stephan@dovecot.fi> (2bde4ed)

    lib-http: client: Added function that checks whether a connection is
    currently active.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h

2016-09-11 19:34:34 +0200 Stephan Bosch <stephan@dovecot.fi> (6324e0d)

    lib-http: client: Created http_client_connection_failure() handler.


M	src/lib-http/http-client-connection.c

2016-09-11 19:44:32 +0200 Stephan Bosch <stephan@dovecot.fi> (d9c3269)

    lib-http: client: Set conn->connect_request to NULL immediately in
    http_client_connection_tunnel_response().

    Prevents referring to this completed request in other parts of the code.

M	src/lib-http/http-client-connection.c

2016-09-11 17:46:10 +0200 Stephan Bosch <stephan@dovecot.fi> (17ec7e6)

    lib-http: client: Improved handling of hosts with explicit IP address.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h

2016-09-11 14:51:28 +0200 Stephan Bosch <stephan@dovecot.fi> (b707ace)

    lib-http: Made test-http-client-errors more reliable.


M	src/lib-http/test-http-client-errors.c

2016-11-01 12:35:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fea1942)

    lib-index: Don't waste 3 bytes of space in struct mail_index_record.

    It was always supposed to be used mainly for keywords, but it got broken 
    many years ago and nobody noticed.

M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index.h

2016-11-01 12:43:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (aef7a71)

    lib-storage: Don't enable modseqs on STATUS_HIGHESTMODSEQ.

    This is requested always by IMAP's SELECT command even when the IMAP client 
    hasn't requested it. We don't want to unnecessarily enable modseqs that use
    up memory and disk space when they're not really needed. Other callers may
    also be interested in asking for HIGHESTMODSEQ (which is nowadays actually
    always available) without enabling full modseq tracking.

M	src/lib-storage/mail-storage.c

2016-11-01 15:51:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b5169b9)

    lib-storage: Reverse MAIL_SEARCH_ARG_FLAG_USE_TZ handling.

    It was being used the wrong way. SEARCH SENTON/BEFORE/AFTER should have 
    checked the times within the mail's timezone, not UTC.

M	src/lib-storage/index/index-search.c

2016-10-31 21:39:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2b7c01f)

    doveadm director: Fix memory leaks if hostname lookup fails.


M	src/doveadm/doveadm-director.c

2016-11-01 17:09:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (86810bd)

    lib: Fix str_truncate() when string size is already smaller.

    Previous behavior either added extra NULs to the string or assert-crashed.

M	src/lib/str.h
M	src/lib/test-str.c

2016-05-03 20:17:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7b086b7)

    lib: Added more unit tests to str_*()


M	src/lib/test-str.c

2016-04-30 14:03:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (00b0331)

    lib: Make str_*() inline which are simple buffer_* wrappers.


M	src/lib/str.c
M	src/lib/str.h

2016-09-16 09:53:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (02cb957)

    imap/pop3 proxy: If passdb returns proxy_not_trusted, don't send ID/XCLIENT

    This allows using Dovecot proxying feature towards less trusted servers.

M	src/imap-login/imap-proxy.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h
M	src/pop3-login/pop3-proxy.c

2016-10-31 20:19:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (99b7459)

    auth: If passwd-file can't be read, return tempfail (not user unknown).


M	src/auth/db-passwd-file.c
M	src/auth/db-passwd-file.h
M	src/auth/passdb-passwd-file.c
M	src/auth/userdb-passwd-file.c

2016-10-31 20:06:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0a28037)

    auth: If uidgid_file doesn't exist, fail the userdb lookup.


M	src/auth/auth-request.c

2016-10-28 13:26:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (284a79d)

    mdbox: Fix assert-crash caused by race condition with multiple doveadm
    purges.

    This fixes a problem where an email that was just written to a new m.* file
    gets expunged and purged by another process.

    Fixes: Panic: file mdbox-map.c: line 1359: unreached

M	src/lib-storage/index/dbox-multi/mdbox-map.c

2016-10-31 19:12:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1b2adc0)

    fs-randomfail: "write" probability was reversed.

    0 meant 100% while 100 meant 0%

M	src/lib-fs/fs-randomfail.c

2016-10-31 15:37:00 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ef43e82)

    lib-test: Do not init/deinit library twice

    If lib is initialized, do not initialize or deinitialize library. This is
    done to allow using master_service in unit tests which also wants to perform
    lib init and deinit itself.

M	src/lib-test/test-common.c

2016-10-31 15:36:39 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (955fd57)

    lib: Add function to see if lib is initialized

    This is needed by test-lib to prevent double init/deinit.

M	src/lib/lib.c
M	src/lib/lib.h

2016-10-28 19:38:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (42f5200)

    dsync: Fix potential assert on mailbox deinit.

    Should have happened only in somewhat rare error conditions that require 
    resyncing.

    Fixes: Panic: file dsync-brain-mailbox.c: line 358
    (dsync_brain_sync_mailbox_deinit): assertion failed: (brain->failed ||
    brain->sync_type == DSYNC_BRAIN_SYNC_TYPE_CHANGED)

M	src/doveadm/dsync/dsync-brain-mailbox.c

2016-10-28 17:10:16 +0300 Paul Howarth <paul@city-fan.org> (c2b23ae)

    configure: Improve check for OpenSSL without EC support

    The original test was for EC_KEY_new but some systems had that and not 
    EVP_PKEY_CTX_new_id, so the test was switched to that function. However,
    Fedora releases 12 through 17 have EVP_PKEY_CTX_new_id but not EC_KEY_new.
    So we need to test for both functions before enabling the dcrypt build.

M	configure.ac

2016-10-28 11:54:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9b59f54)

    auth: Fix crash when exporting passdb fields to auth-worker that have NULL
    values


M	src/auth/auth-request.c

2016-10-27 13:20:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2d10495)

    lib-compression: Fixed fd leak in unit test


M	src/lib-compression/test-compression.c

2016-10-27 11:19:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4a349dc)

    lib-auth: Minor debug logging improvement.

    Include "PASS" or "USER" in the prefix to make it clear what the reply is 
    for.

M	src/lib-auth/auth-master.c

2016-10-28 17:00:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (42f190c)

    lib-program-client: Fix building with compilers that have no typeof()


M	src/lib-program-client/test-program-client-remote.c

2016-07-15 11:31:25 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (4f59e60)

    auth: Remove i_assert for credentials scheme


M	src/auth/auth-request.c

2016-10-27 03:58:21 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (f0c3eb6)

    doveadm: fix compile warning in doveadm-dump-index


M	src/doveadm/doveadm-dump-index.c

2016-10-21 14:34:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0db2a56)

    director: Fix shutdown_clients=no to not break

    The director process must shut down even with with shutdown_clients=no. 
    Otherwise the two director processes will try to keep competing with each 
    others and log errors like:

    director: Warning: Director 10.0.0.123:9090/right disconnected us with
    reason: Replacing with new incoming connection director: Warning: Director
    10.0.0.123:9090/right disconnected us with reason: Replacing with
    10.0.0.124:9090

M	src/director/main.c

2016-10-21 00:25:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2732f22)

    imap-hibernate: Fix "DONE" handling.

    1. If only "DONE\r\n" was sent, it randomly failed with BAD because of 
    out-of-bounds buffer read.

    2. If "DONE\r\n" was followed by a command tag but no space afterwards, we 
    kept waiting for the input to continue. But since the DONE was already sent, 
    we should break the IDLE already at that point without any further waiting.

M	src/imap-hibernate/imap-client.c

2016-10-26 23:20:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1f6e271)

    doveadm dump: Dump mailbox names in mailbox.list.index's header.


M	src/doveadm/doveadm-dump-index.c

2016-10-26 18:06:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7d33533)

    *-login: Removed enforcing maximum calculated fd limit.

    Just use the regular ulimit. Login process has become complicated enough 
    that counting the exact fd size isn't so easy anymore.

    Also apparently this low fd limit is causing errors with new Linux kernels: 
    pop3-login: Error: fd_send(pop3, 18) failed: Too many references: cannot
    splice

M	src/login-common/main.c

2016-10-26 18:05:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2a77c83)

    Compiler warning fixes with -Wstrict-bool


M	src/lib-compression/test-compression.c
M	src/lib-sql/driver-cassandra.c

2016-10-26 14:58:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2db8fb6)

    lib: Fixed net_str2port*() comments


M	src/lib/net.h

2016-10-25 20:52:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2cc140b)

    doveadm fs get: Use pager formatter by default to avoid extra LF at the end.


M	src/doveadm/doveadm-fs.c

2016-10-25 20:54:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9dc9701)

    doveadm: Code cleanup - add and use DOVEADM_PRINT_TYPE_PAGER macro


M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print.h

2016-10-25 20:51:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (98193d1)

    doveadm: "pager" formatter supports now DOVEADM_PRINT_HEADER_FLAG_HIDE_TITLE


M	src/doveadm/doveadm-print-pager.c

2016-04-21 14:22:10 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (9c12525)

    doveadm: \f\n only between pages in pager

    No more \f\n in the end.

M	src/doveadm/doveadm-print-pager.c

2016-10-25 22:39:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (00e99bc)

    director: Avoid assert-crash at deinit if user moves are still being added.

    Fixes: Panic: file user-directory.c: line 312 (user_directory_deinit):
    assertion failed: (array_count(&dir->iters) == 0)

M	src/director/main.c

2016-10-25 22:17:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d0268f2)

    director: Send user's old and new backend IPs to flush script.

    If user was created due to the user-move, don't execute the flush script 
    since it wouldn't really have any work to do anyway.

M	src/director/director.c
M	src/director/director.h

2016-10-25 22:12:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (06da11f)

    director: User move - Don't try to kick user's connections if user wasn't
    even known.


M	src/director/director.c

2016-10-25 22:06:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9309b3b)

    director: Code cleanup - moved user kill startup to its own function.

    No functional changes.

M	src/director/director.c

2016-10-25 21:47:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5c3b438)

    director: Code cleanup - global director is no longer needed.


M	src/director/director.h
M	src/director/main.c

2016-10-17 01:07:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6f93a3d)

    director: Moved all user killing state to struct director_kill_context

    This should make it a bit easier to understand the life time of user 
    killing. It also simplifies code by removing struct 
    director_user_kill_finish_ctx.

    Finally, this already reduces memory usage with 32bit systems, and would 
    make it possible to reduce also on 64bit systems if timestamp is shrank to 
    31 bits and weak bit moved after it. I'm not sure if that would be better 
    for performance though. In any case it would provide free space for 4 extra 
    bytes if that were needed in future.

M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2016-10-25 21:41:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7d3ede1)

    director: Code cleanup - rename director_kill_context.self to
    kill_is_self_initiated


M	src/director/director.c

2016-10-20 16:46:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (21f9786)

    director: Code cleanup - added USER_IS_BEING_KILLED() macro


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2016-10-20 16:41:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bd98482)

    director: Code cleanup - move enum user_kill_state to director.h

    This will be needed by following commits

M	src/director/director.c
M	src/director/director.h
M	src/director/user-directory.c
M	src/director/user-directory.h

2016-10-25 21:20:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ccb4317)

    director: Fix HOST-RESET-USERS with host parameter.

    The logic was reversed: It should flush the specified host, not some other 
    host. Broken by 11ee3b40320a31669bd717fecbe1e332dad4fd84

M	src/director/doveadm-connection.c

2016-10-25 01:03:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7929dac)

    doveadm director dump: Fixed output to include LFs

    Otherwise all the output will be mixed up in the same line.

M	src/doveadm/doveadm-director.c

2016-10-25 00:48:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5872208)

    director: Execute director_flush_socket only from one director.

    Having each director do it would be redundant since they're all supposed to 
    be performing the same flush task to the same backend.

M	src/director/director.c
M	src/director/user-directory.h

2016-10-25 00:32:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b59011b)

    director: Improve debug logging output.


M	src/director/director-connection.c
M	src/director/director.c

2016-10-25 00:25:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9eba5d4)

    director: Fix user move hangs when another move is triggered early.

    Running "doveadm director flush" before the previous flush hadn't fully 
    finished could have caused users to hang until their move timeout:

    director: Error: Finishing user 3249070169 move timed out, its state may now
    be inconsistent (state=waiting-for-everyone)

M	src/director/director-connection.c
M	src/director/director.c

2016-10-25 00:22:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (50d882d)

    director: Prevent race conditions by adding USER_KILL_STATE_FLUSHING

    In theory it's possible that a user is freed during a flush and added back 
    before flush is finished, possibly even being moved again. This check makes 
    sure that we don't finish such move unless we're actually at the correct 
    flushing state. (If there's another flush also running for the user it'll be
    ignored.)

    This is also useful for logging purposes.

M	src/director/director.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2016-10-25 00:13:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (50d96a7)

    director: If user host conflict is detected, make sure new host is sent
    back.

    USER-KICK-HASH was sent, but the sender didn't get back a USER reply with 
    the new host. This could have increased how long user's host differred in 
    directors.

    Avoids repeating this error: Error: User hash 2957018085 is being redirected
    to two hosts: 10.0.0.30 and 10.0.0.201 (old_ts=1477338836)

M	src/director/director-connection.c

2016-10-24 22:42:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2e52280)

    doveadm director flush: Added --max-parallel parameter.


M	src/doveadm/doveadm-director.c

2016-10-24 22:41:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4a9870f)

    director: HOST-RESET-USERS moves users more slowly now.

    By default only 100 users can be moved in parallel. This can be overridden 
    with HOST-RESET-USERS parameter.

    This delaying is especially useful when director_flush_socket is used to 
    avoid huge floods to the script service. Even without the socket it's still 
    good for avoiding unnecessary load spikes when all users are kicked at once 
    and they reconnect back at the same time.

M	src/director/doveadm-connection.c
M	src/director/doveadm-connection.h
M	src/director/main.c
M	src/director/user-directory.h

2016-10-25 00:11:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (535c94c)

    director: If user move times out, log the state it was in at the time.


M	src/director/director.c

2016-10-24 22:39:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e275b15)

    director: Log user's kill_state with a human-readable string.


M	src/director/director-connection.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2016-10-24 22:27:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e235070)

    doveadm director: Invalid parameters cause doveadm to fail silently.

    doveadm_cmd_context.cmd doesn't point directly to doveadm_cmd_director.

M	src/doveadm/doveadm-director.c

2016-10-24 22:22:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5a8bc5b)

    director: Fix sending up/down state in handshakes.

    They were never sent, because HOSTs were sent before director had waited for 
    the remote to send its version number. So sender thought that the remote's 
    minor_version was too old and it didn't send the up/down state at all.

    This caused errors like:

    Warning: director(10.0.0.30:9090/left): Host 10.0.0.30 is being updated
    before previous update had finished (up -> down) - setting to state=down
    vhosts=100 Error: director(10.0.0.30:9090/left): Director 10.0.0.30 SYNC
    request hosts don't match us - resending hosts (seq=6, remote
    hosts_hash=262126213, my hosts_hash=2458934259)

M	src/director/director-connection.c

2016-10-24 21:58:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7322a89)

    director: If SYNCs are received during handshake, send them later.

    This fixes delays during handshake: Error: Ring SYNC appears to have got
    lost, resending

M	src/director/director-connection.c
M	src/director/director-host.h

2016-10-24 20:21:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d4845ae)

    director: Code cleanup - Give tab-unescaped args to all doveadm command
    handlers.


M	src/director/doveadm-connection.c

2016-10-24 20:20:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9bf84e4)

    director: USER-MOVE didn't handle non-hash username correctly.

    The entire command line was being hashed instead of just the username.

M	src/director/doveadm-connection.c

2016-10-24 20:16:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b7d3b04)

    director: Make sure IP address parsing works in DIRECTOR-ADD/REMOVE

    We were passing the entire string through to net_addr2ip(). It seems that 
    inet_aton() stops at whitespace though, so this wasn't actually causing 
    errors at least on Linux.

M	src/director/doveadm-connection.c

2016-10-24 20:08:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (30a1cb8)

    director: Code cleanup - moved command handling to its own function.


M	src/director/doveadm-connection.c

2016-10-24 20:07:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4bc6ff0)

    director: Show in process title how many users are being moved.


M	src/director/director.c
M	src/director/director.h
M	src/director/main.c

2016-10-24 20:00:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4d0d0b9)

    director: Code cleanup - Finish user move always in the same function.


M	src/director/director.c

2016-10-24 19:59:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b99248e)

    director: Call state_change_callback on user move timeout.


M	src/director/director.c
M	src/director/director.h
M	src/director/main.c

2016-10-21 12:50:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c98b47e)

    director: Code cleanup - allow commands handlers to stop processing input

    Now returning 0 exits the input reading without disconnecting client.

M	src/director/doveadm-connection.c

2016-10-25 13:27:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (a9b39bd)

    lib-mail: Add tests for dec/hexdec encoded entities


M	src/lib-mail/test-mail-html2text.c

2016-10-25 12:48:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (74fc4d6)

    lib-mail: Support decimal/hexadecimal encoded entities

    Add support for &#nnn; and &#xnnn; entities.

M	src/lib-mail/mail-html2text.c

2016-10-25 10:29:50 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (7692403)

    imap-login: Skip NIL value in ID handler

    NIL value can cause hard crash, depending what the key is. For x-proxy-ttl,
    NIL will crash on any system, x-originating-ip will crash on some nss
    versions (e.g. centos 6.7).

    Migitating factor here is that the NIL value is only accepted from trusted
    network.

M	src/imap-login/imap-login-client.c

2016-10-24 18:52:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3c692ac)

    lib-compression: Added unit tests for reading .gz files


M	src/lib-compression/test-compression.c

2016-10-24 18:31:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4b55ea6)

    lib-compression: Added file uncompression support for test-compression

    This can be useful for debugging.

M	src/lib-compression/test-compression.c

2016-10-24 18:29:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (446d84d)

    lib-compress: Don't assume too early that gz file continues after a trailer.

    Some istreams don't have EOF immediately set after the gz trailer. This 
    fixes errors like "missing gz trailer at 1675"

M	src/lib-compression/istream-zlib.c

2016-10-21 13:55:42 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (60cc5af)

    doveadm: Rewind input early enough

    Command input needs to be rewinded earlier in doveadm_mail_next_user.

M	src/doveadm/doveadm-mail.c

2016-10-24 17:15:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bee600b)

    istream-zlib: "missing gz trailer" error message was wrong.


M	src/lib-compression/istream-zlib.c

2016-10-24 15:59:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5611e23)

    lib: With FILE_LOCK_SLOW_WARNING_MSECS log a warning also when keeping lock
    for long.

    This can help catching which process kept the lock for too long.

M	src/lib/file-lock.c

2016-10-24 16:57:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (71ceef4)

    configure: Fixed checking if OpenSSL is too old for lib-dcrypt

    EVP_PKEY_CTX_set_ec_paramgen_curve_nid() is a macro, so it can't be checked 
    with AC_CHECK_LIB().

M	configure.ac

2016-10-24 16:05:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cab3ca1)

    lib: Fix compiler warnings in test-ioloop

    Fixes: test-ioloop.c:72: error: ignoring return value of â€˜writeâ€™, declared
    with attribute warn_unused_result

M	src/lib/test-ioloop.c

2016-10-24 13:08:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9407950)

    lib-http: Add ioloop and lock wait information to timeout messages.

    It'll now log for example: 9007 Request timed out (Request sent 7.087 secs
    ago, 0.076 in other ioloops, 7.012 in locks, connected 7.087 secs ago)

    Which points out that the problem wasn't really with the HTTP, but with 
    locking. This likely should be fixed in some way also in lib-http so that it
    gives a bit of extra time for reading the request, but that's a separate 
    fix.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2016-10-24 12:17:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (240efa2)

    dict-client: Fix logging how much time was spent in other ioloops in slow
    lookup warnings.

    The warning's idea is to show why the lookup could have been slow. We 
    differentiate between time spent in dict_wait() waiting only for the dict
    result and time spent in other ioloops waiting for potentially other things
    as well (and time spent waiting for locks during this time).

    The previous code didn't work right when multiple ioloops were used, which 
    happened sometimes.

    Also changed %u to %d just in case some calculation is wrong. It's nicer to 
    get a slightly negative value rather than a huge positive one.

M	src/lib-dict/dict-client.c

2016-10-24 12:16:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ba356ae)

    lib: Added ioloop_global_wait_usecs

    This is helpful when multiple ioloops aren't used and 
    io_loop_get_wait_usecs() can't be easily used for all of them.

M	src/lib/ioloop.c
M	src/lib/ioloop.h

2016-10-24 14:05:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (62ce1ac)

    lib: Add FILE_LOCK_SLOW_WARNING_MSECS environment.

    Log a warning if any locking takes longer than the specified number of 
    milliseconds. This can be enabled globally with:

    import_environment = $import_environment FILE_LOCK_SLOW_WARNING_MSECS=1000

M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-lock.h

2016-10-24 13:28:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3f47951)

    lib-index: Fix potential error when reading from uncommitted cache
    transaction

    If dovecot.index.cache is compressed during the transaction, the new cache 
    fields mapping doesn't necessarily match what is in the transaction.

    Fixes: Error: Corrupted index cache file .../dovecot.index.cache: field
    index too large (27 >= 17)

    Although there may be other cache corruption errors it also fixes.

M	src/lib-index/mail-cache-transaction.c

2016-10-24 12:25:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a07d617)

    lib-index: Fix potential assert-crash when reading cache

    Fixes: Panic: file mail-cache-lookup.c: line 258
    (mail_cache_lookup_iter_next): assertion failed: (ctx->offset != 0)

    Broken by d33fc6c584718efd46159e1d8f46488b9dfc66f5

M	src/lib-index/mail-cache-lookup.c

2016-10-24 12:23:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (60ae739)

    master: If chrooted service's core wasn't dumped, suggest to unset the
    chroot.


M	src/master/service-process.c

2016-10-24 11:34:05 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (676e114)

    lib: Add test for ioloop fd polling


M	src/lib/test-ioloop.c

2016-10-24 10:13:42 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0fe6b12)

    lib: Fix kqueue io_loop_get_wait_time usage

    The code needs to take into consideration, when there is no IO to be waited,
    but possibly there is io_set_pending used, or just timeouts.

M	src/lib/ioloop-kqueue.c

2016-10-24 10:08:42 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (4397b24)

    lib: Ensure tv_r gets set in io_loop_get_wait_time

    If this does not get reset here to 0 it can cause errors or unpredictable
    behaviour in select/kqueue polling, such as very long delays.

M	src/lib/ioloop.c

2016-10-22 22:45:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0b94b5a)

    director: Fix crash handling director_flush_socket when user is freed.


M	src/director/director.c

2016-10-13 16:11:48 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (a64e49f)

    director: Support flush socket

    This allows specifying an URI to execute on user kill. It can be of form 
    exec:/path/to/bin, unix:/path/to/socket or tcp:ip:port

    The location is sent FLUSH username-hash per killed user. You can execute
    some action there, and you are expected to return '+\nOK\n' as reply once
    you are done.

M	src/director/Makefile.am
M	src/director/director-settings.c
M	src/director/director-settings.h
M	src/director/director.c

2016-10-22 12:58:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d6c1b8c)

    configure: Improved checking if OpenSSL is too old for lib-dcrypt

    Some OpenSSL versions had EC_KEY_new, but not other needed functions.

M	configure.ac

2016-10-21 14:34:51 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (85e2e56)

    lib-program-client: Add URI based constructor


M	src/lib-program-client/program-client.c
M	src/lib-program-client/program-client.h

2016-10-20 22:59:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9896dde)

    dovecot.m4: Added DOVECOT_BINARY_LDFLAGS for future compatibility

    Mainly to keep the serial number the same in v2.2 and v2.3 tree.

M	dovecot.m4

2016-10-20 14:23:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d10043f)

    dovecot-config: Added dovecot_statedir


M	Makefile.am
M	dovecot-config.in.in
M	dovecot.m4

2016-08-08 13:12:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7adf84c)

    Moved cc-wrapper.sh handling to dovecot.m4

    When configuring Dovecot --without-shared-libs and pointing external plugins 
    to uninstalled sources --with-dovecot, any binaries complied for plugins 
    weren't using cc-wrapper.sh, which could have caused runtime failures when 
    they attempted to load plugins dynamically. Now it's possible to add 
    DC_CC_WRAPPER to plugins' configure.ac to build with the cc-wrapper.sh.

M	Makefile.am
D	cc-wrapper.sh.in
M	configure.ac
M	dovecot.m4

2016-07-14 20:53:46 +0200 Stephan Bosch <stephan@rename-it.nl> (e4a48fe)

    Added LIBDOVECOT_PUSH_NOTIFICATION_INCLUDE to dovecot.m4.


M	dovecot.m4

2016-10-20 12:24:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (406dfb5)

    pop3: Fix pop3_logout_format=%{deleted_size} expansion when there are no
    deletions

    Should be "0", not empty string.

M	src/pop3/pop3-client.c

2016-10-20 12:06:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ada6d5f)

    %{auth_domain} shouldn't include the leading '@'


M	src/imap-hibernate/imap-client.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c

2016-10-20 18:31:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d348951)

    lib-ldap: Fixed compiling with OpenBSD


M	src/lib-ldap/ldap-search.c

2016-10-20 16:30:49 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d24a5eb)

    auth: Escape local_name


M	src/auth/auth-request.c
M	src/lib-auth/auth-client-request.c

2016-10-20 16:06:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d80ade0)

    login-common: Include local_name in login_var_expand_table

    This way it can be used in login_log_format

M	src/login-common/client-common.c

2016-10-20 15:46:01 +0200 Stephan Bosch <stephan.bosch@dovecot.fi> (18a85e2)

    lib-program-client: Fixed boolean expressions.

    Problems found with clang -Wstrict-bool.

M	src/lib-program-client/program-client-local.c

2016-10-20 16:30:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3459db0)

    auth: Fixed assert-crash on invalid auth-client input

    For example if client sends invalid input like: auth: Error: BUG:
    Authentication client sent unknown command: XYZ

    Fixes crash: auth: Panic: key not found from hash

M	src/auth/auth-request-handler.c

2016-10-20 13:30:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6516a74)

    Added "doveadm process status"

    This allows asking for processes' current status in master process.

M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-master.c
M	src/master/master-client.c

2016-10-20 13:12:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7c4cbc9)

    Added "doveadm service status"

    This allows asking for services' current status in master process.

M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-master.c
M	src/master/master-client.c

2016-10-20 13:22:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (02db667)

    doveadm-master: Code cleanup - simplify sending command args to master.

    This also escapes the parameters to make sure nothing bad can be sent.

M	src/doveadm/doveadm-master.c

2016-10-20 13:11:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bcab4a3)

    doveadm service stop: Convert to doveadm v2 API


M	src/doveadm/doveadm-master.c

2016-10-20 13:10:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ae1884e)

    doveadm service stop: Code cleanup - Prepare for other service commands.


M	src/doveadm/doveadm-master.c

2016-10-20 13:09:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7fa3afc)

    doveadm service stop: Moved command handling to doveadm-master.c

    It's talking to master process, and there will be other non-service commands 
    that talk to the master process in the same way.

M	src/doveadm/Makefile.am
M	src/doveadm/doveadm-master.c
D	src/doveadm/doveadm-service.c

2016-10-11 12:43:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bc185e3)

    doveadm user: If lookup fails, don't write it to the same line as header.


M	src/doveadm/doveadm-auth.c

2016-10-19 21:49:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cbff70d)

    doveadm-server: Show incoming connection's IP and running command is process
    title.


M	src/doveadm/client-connection-http.c
M	src/doveadm/client-connection-private.h
M	src/doveadm/client-connection.c
M	src/doveadm/client-connection.h
M	src/doveadm/doveadm.h
M	src/doveadm/main.c

2016-10-18 00:37:32 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (588e91e)

    auth: Pass local_name to auth-request

    This allows using local_name in various places, such as passdb/userdb
    queries.

M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request-var-expand.h
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h
M	src/login-common/client-common.h
M	src/login-common/login-settings.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-openssl.c

2016-10-20 10:11:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3a3c783)

    login proxy: Hanging outgoing SSL connections caused using already-freed
    memory

    This mainly happened when login proxy closed the connection due to connect 
    timeout. The ssl-proxy still had a reference and existed for a longer time. 
    If SSL handshake still succeeded afterwards, it now called 
    login_proxy_ssl_handshaked(), which accessed the already-freed proxy and 
    likely crashed.

    Fixed the ssl-client proxy code specifically. Alternatively ssl_proxy_free() 
    could be calling ssl_proxy_destroy() always, but since ssl-server side of 
    the code seems to have been working fine, I don't want to accidentally break
    it.

M	src/login-common/login-proxy.c

2016-10-19 21:03:24 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (fdcd289)

    lib-program-client: Correctly handle error code


M	src/lib-program-client/program-client-remote.c

2016-10-19 20:40:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (33e297c)

    lib: Copy target_uid from restrict_access_settings

    One cannot assign to set->uid, causing compile error.

M	src/lib/restrict-access.c

2016-10-19 19:02:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (13cb1cf)

    lib-program-client: Try drop setuid root by default

    But not if root privileges are asked for.

M	src/lib-program-client/program-client-local.c

2016-10-19 18:44:35 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (eda95c8)

    lib: Add drop_setuid_root for restrict_access

    drop_setuid_root, when set to true, will detect and try to drop getuid()==0.
    This is done by recovering current effective UID to set->uid if set->uid ==
    -1, and then doing seteuid(0). It will also drop out any other extra
    privileges, such as extra groups not requested for.

M	src/lib/restrict-access.c
M	src/lib/restrict-access.h

2016-10-12 14:57:51 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (de4ac43)

    lib-storage: clean up mailbox_list_create to improve readability

    There is no reason to use mailbox_list_driver_find() here instead of 
    mailbox_list_find_class() as (1) we do not need the index into the list 
    driver array, and (2) dealing with double-pointers is harder than regular 
    pointers.

M	src/lib-storage/mailbox-list.c

2016-04-22 22:44:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (28f8fb7)

    .gitignore: Updated to include auto-added m4/*


M	.gitignore

2016-10-19 19:41:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (67e7554)

    push-notification: Error handling fix and cleanups.


M	src/plugins/push-notification/push-notification-driver-ox.c

2016-10-19 18:25:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ace297d)

    dovecot-ldap.conf.ext: Updated sasl_bind comment.


M	doc/example-config/dovecot-ldap.conf.ext

2016-10-19 16:31:01 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ddc3960)

    lib-program-client: Fix memory access problem


M	src/lib-program-client/program-client.c

2016-10-19 16:24:56 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (4cf10a8)

    lib-program-client: Backport test-program-client-unix


M	src/lib-program-client/test-program-client-remote.c

2016-10-19 16:06:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d7b1c76)

    lib-program-client: Fix local tests


M	src/lib-program-client/Makefile.am
M	src/lib-program-client/test-program-client-local.c

2016-10-17 14:19:40 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (7842be8)

    lib-program-client: Disable valgrind

    For local test, we can't use valgrind, it's too unreliable (breaks execution
    sometimes).

M	src/lib-program-client/Makefile.am

2016-10-17 09:46:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e39f1f4)

    lib-program-client: Move version string to define


M	src/lib-program-client/program-client-remote.c

2016-10-17 09:35:14 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (11d5906)

    lib-program-client: Add switch_ioloop vfunc

    This lets program-client backends do their own special io loop switching.

M	src/lib-program-client/program-client-local.c
M	src/lib-program-client/program-client-private.h
M	src/lib-program-client/program-client-remote.c
M	src/lib-program-client/program-client.c

2016-10-15 13:59:45 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c1b5185)

    lib-program-client: Use milliseconds in idle timeout


M	src/lib-program-client/program-client-local.c
M	src/lib-program-client/program-client-private.h
M	src/lib-program-client/program-client.c
M	src/lib-program-client/program-client.h
M	src/lib-program-client/test-program-client-local.c
M	src/lib-program-client/test-program-client-remote.c

2016-10-17 09:09:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (6d1ea52)

    lib-program-client: Use child-wait

    This makes the client waiting asynchronous.

M	src/lib-program-client/program-client-local.c
M	src/lib-program-client/program-client.c

2016-10-17 09:11:38 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (444f4d8)

    lib-program-client: Disconnect asynchronously


M	src/lib-program-client/program-client-private.h
M	src/lib-program-client/program-client-remote.c
M	src/lib-program-client/program-client.c

2016-10-12 13:14:03 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d568bab)

    lib-program-client: Use restrict-access

    This makes the program-client execution behave more consistent to the rest
    of the core code.

M	src/lib-program-client/program-client-local.c
M	src/lib-program-client/program-client.h
M	src/lib-program-client/test-program-client-local.c
M	src/lib-program-client/test-program-client-remote.c

2016-10-13 10:11:52 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (338bc72)

    lib: Add reference counting to child_wait_pid


M	src/lib/child-wait.c

2016-10-17 12:34:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d8c5d6f)

    lib-storage: Make sure mailbox_uidvalidity_next() doesn't return 0.

    0 isn't a valid IMAP UIDVALIDITY, and Dovecot treats 0 as "not assigned".

M	src/lib-storage/mailbox-uidvalidity.c

2016-10-17 21:03:51 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (8146503)

    lib-dcrypt: add a test for password change

    Test that you can encrypt a key with password, encrypt a key with the 
    password protected key, change the password, and still load a key that you 
    encrypted with the key encrypted using the first password.

M	src/lib-dcrypt/test-crypto.c

2016-10-18 14:57:31 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (19fe875)

    doveadm: trim doveadm dump dcrypt-key input

    dcrypt does not like extra newlines at the end of a key.

M	src/doveadm/doveadm-dump-dcrypt-key.c

2016-10-17 09:34:04 +0200 Steffen Templin <steffen.templin@open-xchange.com> (78cd02d)

    push-notification: Resolve indentation problem


M	src/plugins/push-notification/push-notification-driver-ox.c

2016-10-06 07:35:17 +0000 Steffen Templin <steffen.templin@open-xchange.com> (35aba69)

    push-notification: Re-open mailbox and sync it to get unseen count.


M	src/plugins/push-notification/push-notification-driver-ox.c

2016-10-05 13:28:49 +0300 Steffen Templin <steffen.templin@open-xchange.com> (3a23ef7)

    push-notification: Add unseen count to OX driver.


M	src/plugins/push-notification/push-notification-driver-ox.c

2016-10-10 20:38:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6a44e1e)

    global: Handle broken Content-Type headers consistently.

    1) Only the first Content-Type header is used. (Simpler than using the
    last.)

    2) Invalid Content-Types are parsed as far as we can. This is mainly to make 
    sure they aren't treated as missing Content-Types, which could cause them to 
    become text/plain.

M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-search.c
M	src/plugins/fts/fts-build-mail.c

2016-10-10 20:24:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c0c6115)

    lib-imap: imap_bodystructure_parse() ignores text/plain flag mismatch for
    now.

    Maybe we can enable it some day far into the future, but for now this just 
    causes unnecessary cache file rebuilds.

M	src/lib-imap/imap-bodystructure.c

2016-10-10 20:23:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ad485ae)

    lib-imap: Don't write a broken Content-Type as text/plain to BODYSTRUCTURE

    Mainly because it doesn't match with MESSAGE_PART_FLAG_TEXT in message_part.

M	src/lib-imap/imap-bodystructure.c

2016-10-15 23:04:35 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (72d1b16)

    config: Compare local_name case insensitive

    DNS and certificate names should be compared case insensitive.

M	src/config/config-filter.c

2016-10-17 23:25:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8e104e2)

    lib: Add null_strcasecmp


M	src/lib/strfuncs.c
M	src/lib/strfuncs.h

2016-10-17 19:38:07 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d88f6e1)

    auth-policy: Use request's pool instead of new pool

    This fixes existing memory leak in auth_report, which is caused by using
    separate memory pool instead of request's pool.

    Thank you for Andrea Carpani for extensive debugging.

M	src/auth/auth-policy.c

2016-10-16 22:58:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (df6bf02)

    dict-sql: Use LIMIT in SQL queries with dict_iterate_set_limit()


M	src/lib-dict/dict-sql.c

2016-10-16 22:40:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1b69afd)

    lib-dict: Added dict_iterate_set_limit()


M	src/lib-dict/dict-private.h
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h

2016-10-17 19:21:34 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d97dad4)

    lib-dict: Duplicate result value in mempool

    Duplicate the result value already in callback to avoid it getting lost
    during async calls.

    Reported & tested by Pierre Jaury.

M	src/lib-dict/dict-client.c

2016-10-18 10:45:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (335e246)

    lib-fs: Fixed fs_metadata_find() to actually work


M	src/lib-fs/fs-api.c

2016-10-17 23:06:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (da00d76)

    lib-mail: Fixed infinite loop in istream-attachment-extractor

    Broken by 7f74811b7. Pretty much any larger attachment going through this
    istream had a good potential of going into an infinite loop.

M	src/lib-mail/istream-attachment-extractor.c

2016-10-17 10:59:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a8dca04)

    lib-fs: Added FS_METADATA_WRITE_FNAME to allow renaming a file being
    written.


M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-dict.c
M	src/lib-fs/fs-posix.c

2016-10-11 01:04:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e11fd32)

    lib-fs: Added internal fs_metadata_find() helper function


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2016-10-11 00:46:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c4fc984)

    lib-fs: Optimize changing FS_METADATA_INTERNAL_PREFIX metadata.

    file->metadata_changed doesn't need to change in that situation. It's used 
    by fs-metawrap to find out if it needs to rewrite metadata during a write, 
    but internal metadata isn't written to its header.

M	src/lib-fs/fs-api.c

2016-10-17 12:41:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f6c5b41)

    sdbox: Removed duplicated code.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2016-10-17 10:36:17 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (84a75fa)

    lib-dcrypt: change unit test ec curve to secp521r1

    This curve is more common, so unit tests will pass on more machines.

M	src/lib-dcrypt/test-crypto.c

2016-10-17 09:13:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8b28c54)

    lib-fs: Lazily initialize timings to save memory.


M	src/lib-fs/fs-api.c

2016-10-14 17:13:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3f86b94)

    lib-storage: Use MAILDIR_INFO_SEP_S

    Replace hardcoded : with MAILDIR_INFO_SEP_S

M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-uidlist.c

2016-10-14 15:28:32 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (54b9c83)

    lib-dcrypt: Fix uninitialized memory


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/test-crypto.c

2016-10-14 13:48:41 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (0e82875)

    lib-dcrypt: str_new to t_str_new in some test-crypto tests

    str_new from default_pool was not properly freed.

M	src/lib-dcrypt/test-crypto.c

2016-10-13 23:38:36 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (ae0f389)

    lib-dcrypt: enc_key and pw must be NULL on storing unencrypted private key

    Add tests for password and key encryption, and get_info on them. Also give
    examples of valid cipher values for password and key encryption in dcrypt.h
    comment.

M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt.h
M	src/lib-dcrypt/test-crypto.c

2016-10-12 21:29:51 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (ee4b086)

    lib-dcrypt: fix comment of dovecot format v2 to use colon

    Version 2 field separator was changed to colon.

M	src/lib-dcrypt/dcrypt.h

2016-10-10 20:35:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (933d16f)

    auth: Compiler warning fix


M	src/auth/db-ldap.c

2016-10-02 14:14:48 +0200 Stephan Bosch <stephan@dovecot.fi> (c73322f)

    lib: uri-util: Always fully check the syntax of percent encoding while
    parsing URI components.


M	src/lib/uri-util.c

2016-05-08 22:56:59 +0200 Stephan Bosch <stephan@rename-it.nl> (f1df3b3)

    uri-util: Added public function for parsing single percent encoding
    instances.


M	src/lib/uri-util.c
M	src/lib/uri-util.h

2016-02-20 19:47:58 +0200 Stephan Bosch <stephan@rename-it.nl> (76c9f14)

    uri-util: Fixed assertion failure for invalid character in path segment.


M	src/lib/uri-util.c

2016-10-14 09:49:16 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ac80b9d)

    lib-index: unlink_directory has no error


M	src/lib-index/test-mail-index-modseq.c

2016-10-14 09:48:43 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (6fd1b5d)

    imap-hibernate: Adjust API usage for ostream


M	src/imap-hibernate/imap-client.c

2016-10-14 09:45:11 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (204ad3f)

    Revert "uri-util: Fixed assertion failure for invalid character in path
    segment."

    This reverts commit dbbdcc1224f81a40e746a09e6d44af7c4f24ff71.

M	src/lib/uri-util.c

2016-10-14 09:45:09 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0dda73f)

    Revert "lib: uri-util: Always fully check the syntax of percent encoding
    while parsing URI components."

    This reverts commit 5b6dc4c53617362baf8713815621bebbeb38c8cc.

M	src/lib/uri-util.c

2016-05-18 17:45:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dd0eaa5)

    lib: Don't set ostream buffer as blocking


M	src/lib/ostream-buffer.c

2016-05-16 19:33:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2892649)

    lib: Added ostream.blocking boolean

    Similar to istream.blocking.

M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream-null.c
M	src/lib/ostream.c
M	src/lib/ostream.h

2016-04-30 14:10:59 +0200 Stephan Bosch <stephan@rename-it.nl> (85df9a4)

    lib: ostream-file: Allow creating derived file output streams.


M	src/lib/Makefile.am
A	src/lib/ostream-file-private.h
M	src/lib/ostream-file.c

2016-04-30 13:55:52 +0200 Stephan Bosch <stephan@rename-it.nl> (6853a86)

    lib: ostream-file: Split o_stream_file_writev() from
    o_stream_file_writev_full().


M	src/lib/ostream-file.c

2016-04-30 13:51:59 +0200 Stephan Bosch <stephan@rename-it.nl> (660db45)

    lib: ostream-file: Renamed o_stream_writev() to o_stream_file_writev_full().


M	src/lib/ostream-file.c

2016-04-30 13:29:47 +0200 Stephan Bosch <stephan@rename-it.nl> (be83239)

    lib: ostream-file: Renamed iov_size to iov_count everywhere and made it
    unsigned int for consistency.


M	src/lib/ostream-file.c

2016-10-12 12:04:10 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (6a01276)

    auth: Pass userdb fields to worker

    If this is not done, then those userdb handlers that need access to userdb
    variables for e.g. interpolation, cannot access them.

M	src/auth/auth-request.c
M	src/auth/auth-worker-client.c

2016-10-11 13:18:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f7eed93)

    auth: Don't re-insert userdb results from auth cache data back to cache.

    This was also breaking TTLs for the cached userdb results, because each 
    re-insert reset the TTL.

M	src/auth/auth-request.c
M	src/auth/auth-request.h

2016-10-10 21:22:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d29c704)

    lib-program-client: Fixed potential panic in test-program-client-local

    If the run finished before io_loop_run(), it would panic with: Panic: BUG:
    No IOs or timeouts set. Not waiting for infinity.

M	src/lib-program-client/test-program-client-local.c

2016-10-10 21:19:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (282de4e)

    lib-program-client: Fixed program_client_run() that succeeds rapidly.

    program_client_run_async() could have called the callback with result=0 
    before io_loop_run(). This happened with local client.

    Fixes in test-program-client-local: Panic: BUG: No IOs or timeouts set. Not
    waiting for infinity.

M	src/lib-program-client/program-client.c

2016-10-10 23:53:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2c2d64e)

    fs-metawrap: Don't assert-crash when trying to write an empty file.

    Fixes: Panic: file fs-metawrap.c: line 401
    (fs_metawrap_write_stream_finish): assertion failed:
    (file->super_output->offset > 0 || file->super_output->stream_errno != 0)

M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/test-fs-metawrap.c

2016-10-11 00:31:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8cf999a)

    lib-fs: Renamed internal i_stream_mail_read() to i_stream_fs_stats_read()

    Just to make backtraces look clearer. Originally forgot to change this after
    copy&pasting code from istream-mail.c

M	src/lib-fs/istream-fs-stats.c

2016-10-10 20:58:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4d51949)

    lib-program-client: Fixed running test-program-client-local as root.

    uid/gid == -1 isn't treated as "don't change" in here.

M	src/lib-program-client/test-program-client-local.c

2016-09-21 10:55:47 +0300 Matwey V. Kornilov <matwey.kornilov@gmail.com> (79d9a65)

    auth: Fix default SASL bind for LDAP

    User may configure Dovecot to use SASL bind as default bind method.  This
    can be the case when ldapi:/// (or ldaps:///) with SASL EXTERNAL is used. 
    Currently, Dovecot returns LDAP connection to wrong bind state after first 
    successful auth bind, LDAP simple bind always used to rebind.  This may
    broke setup when ACL in LDAP configured not to allow search/bind for such
    simple bind.

M	src/auth/db-ldap.c

2016-09-21 10:50:02 +0300 Matwey V. Kornilov <matwey.kornilov@gmail.com> (aae4595)

    auth: Introduce db_ldap_bind_sasl() function

    Do refactoring in db_ldap_connect() before fixing the SASL bind issue in the
    next commit.

M	src/auth/db-ldap.c

2016-10-06 15:22:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5bdbda0)

    doveadm director kick: Added -f <passdb field> parameter.

    This works for all the user_* passdb fields.

M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h
M	src/doveadm/doveadm-director.c

2016-10-06 15:19:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (242005b)

    doveadm director kick: Escape username properly.

    This only mattered if the username contained \001, TAB or LF characters, 
    which isn't normal.

M	src/doveadm/doveadm-director.c

2016-10-06 15:13:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5170189)

    director: Escape username when handling USER-KICK.

    This could have caused problems if username parameter contained TABs or LFs, 
    which of course shouldn't normally happen.

M	src/director/director.c

2016-10-06 14:54:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e07044d)

    doveadm proxy kick: Support multiple user parameters.


M	src/doveadm/doveadm-proxy.c

2016-10-06 14:53:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (124bfae)

    doveadm proxy kick: Added -f <passdb field> parameter.

    This works for all the user_* passdb fields.

M	src/doveadm/doveadm-proxy.c
M	src/login-common/login-proxy.c

2016-10-06 14:38:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c82b58c)

    doveadm proxy list: Show all user_* fields in output.


M	src/doveadm/doveadm-proxy.c
M	src/login-common/login-proxy.c

2016-10-05 23:22:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (27c3fd8)

    *-login: Store user_* passdb fields to client->alt_usernames.


M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h
M	src/login-common/login-common.h
M	src/login-common/main.c

2016-10-10 17:37:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2a736c0)

    last-login: Don't execute last_login on IMAP unhibernation.


M	src/plugins/last-login/last-login-plugin.c

2016-10-10 17:19:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ec769b5)

    quota: Don't execute quota_over_script if userdb lookup was over 10 secs ago


M	src/plugins/quota/quota.c

2016-10-10 17:19:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dcddd3e)

    imap-hibernate: Preserve mail_user.session_create_time through hibernation


M	src/imap-hibernate/imap-client.c
M	src/imap-hibernate/imap-client.h
M	src/imap-hibernate/imap-hibernate-client.c
M	src/imap/imap-client-hibernate.c
M	src/imap/imap-master-client.c

2016-10-10 17:19:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0e72564)

    lib-storage: Added mail_user.session_create_time and .session_restored


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2016-10-06 14:54:24 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3b5562a)

    imap-hibernate: Properly fix hibernation

    The previous fix did not properly fix hibernation as the clients still
    dropped out of hibernate. Also the tag used was no longer following. This 
    change will track tag changes and keeps the hibernation process going on
    until the user enters something else than DONE\r\ntag IDLE\r\n in same 
    packet.

M	src/imap-hibernate/imap-client.c
M	src/imap-hibernate/imap-client.h
M	src/imap-hibernate/imap-hibernate-client.c
M	src/imap/imap-client-hibernate.c
M	src/imap/imap-master-client.c
M	src/imap/imap-state.c
M	src/imap/imap-state.h

2016-10-10 13:40:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (be7f203)

    cassandra: Added latency_aware_routing connect-parameter.

    There's currently no way to change the default settings for it.

M	src/lib-sql/driver-cassandra.c

2016-10-10 13:59:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4236767)

    lmtp: Handle lmtp_user_concurrency_limit before lmtp_rcpt_check_quota

    The quota lookup is more expensive, so it shouldn't be done unnecessarily.

M	src/lmtp/commands.c

2016-10-10 10:37:24 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ba9270a)

    doveadm-sync: Document end-date flag


M	doc/man/doveadm-sync.1.in

2016-10-10 10:36:52 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (69031c6)

    doveadm-sync: Add end-date support


M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2016-10-10 10:13:12 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (4e02ed7)

    doveadm-sync: Document start date


M	doc/man/doveadm-sync.1.in
M	src/doveadm/doveadm-dsync.c

2016-10-09 23:34:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f719585)

    lib-compression: Fixed compler warnings and wrongly triggering asserts.

    Broken by 7f74811b7.

M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lz4.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c

2016-10-06 13:50:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6a1110d)

    global: Make sure i_stream_read() calls handle 0 and -2 return values
    correctly.


M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-mail-save.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/dsync/dsync-mail.c
M	src/imap/cmd-append.c
M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lz4.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c
M	src/lib-dict-extra/dict-fs.c
M	src/lib-http/http-client-connection.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/mail-copy.c
M	src/lib/istream-seekable.c

2016-10-06 13:39:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5cb85a0)

    log: Minor error logging and comment improvement.


M	src/log/log-connection.c

2016-10-06 13:09:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (463fc80)

    imapc: Added imapc_max_line_length to limit maximum memory usage.

    The default is still unlimited, but this should be set to something smaller 
    for untrusted servers.

M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2016-10-06 12:10:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (851a128)

    lib-index: Added test-mail-index-modseq unit test


M	src/lib-index/Makefile.am
A	src/lib-index/test-mail-index-modseq.c

2016-10-05 16:34:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (367aa5e)

    lib-storage: Fixed assert-crash in mailbox_save_cancel()

    Broken by 05150df8f. Fixes: Panic: file mail-storage.c: line 2137
    (mailbox_save_context_reset): assertion failed: (ctx->saving)

M	src/lib-storage/mail-storage.c

2016-09-27 16:15:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b816c98)

    lib: If connect() fails with EADDRNOTAVAIL, retry it 4 more times.

    This is needed on busy systems. Nicely explained in: 
    https://idea.popcount.org/2014-04-03-bind-before-connect/

M	src/lib/net.c

2016-10-05 15:03:05 +0300 Phil Carmody <phil@dovecot.fi> (66bd5a6)

    plugins/fts - make storage errors more informative

    There are 3 different ways to fail ending a transaction (one of which is
    itself just a record that something now unknown previously failed). Identify
    which one in the logs.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts/fts-storage.c

2016-10-04 17:31:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f2dc727)

    lib-storage: autoexpunge mailboxes with wildcards didn't work with namespace
    prefix.


M	src/lib-storage/mail-autoexpunge.c

2016-09-27 19:48:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d8907e9)

    lib-index: If view syncing sees index is reset, always mark the view as
    inconsistent.

    Not only when the mailbox has messages, because that could still mess up 
    assumptions about UIDs. A somewhat better check could have been to do this 
    only when next_uid>1 (= there have been messages at some point in this 
    mailbox), but it's safer to just always mark the view as inconsistent.

M	src/lib-index/mail-index-view-sync.c

2016-09-27 19:45:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9bce4ed)

    lib-index: When finding a view is reset, don't attempt any further syncing.

    This could cause various errors to be logged, such as: Error: Append with
    UID 7103, but next_uid = 7242

M	src/lib-index/mail-index-view-sync.c

2016-09-27 19:41:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c7b9351)

    lib-index: Fixed potential assert-crash when view syncing sees a reset
    marker.

    It should never try to use main index map at that point, because 
    view_sync_have_expunges() looks changes only before the reset marker. Fixes:

    Error: Index .../dovecot.index lost messages without expunging (36 -> 27)

M	src/lib-index/mail-index-view-sync.c

2016-09-27 19:39:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c4a8f06)

    lib-storage: Make sure mailbox_sync*() fails if view is inconsistent
    afterwards.


M	src/lib-storage/index/index-sync.c

2016-09-27 19:38:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e32754a)

    imap: If mailbox is inconsistent after syncing, don't try to sync message
    counts.

    This fixes (e.g. after doveadm force-resync): Panic: Message count decreased

M	src/imap/imap-sync.c

2016-10-02 14:18:35 +0200 Stephan Bosch <stephan@dovecot.fi> (4cdd921)

    lib-http: uri: Removed unnecessary checking of percent encoding of query and
    fragment parts.

    This is now always performed in lib/uri-util.

M	src/lib-http/http-url.c

2016-10-02 14:14:48 +0200 Stephan Bosch <stephan@dovecot.fi> (5b6dc4c)

    lib: uri-util: Always fully check the syntax of percent encoding while
    parsing URI components.


M	src/lib/uri-util.c

2016-10-03 10:08:45 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (42beb17)

    lib-test: Fix memory leak in test-ostream


M	src/lib-test/test-ostream.c

2016-10-03 10:08:31 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (35fa25c)

    lib-test: Fix illegal memory access in test-ostream


M	src/lib-test/test-ostream.c

2016-10-03 09:11:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (bf24499)

    io: Add source filename

    This will make debugging alot easier when you can see what the filename is
    as well.

M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-kqueue.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2016-09-30 13:42:45 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (70193d8)

    lib-test: Added test_ostream for testing nonblocking ostreams.


M	src/lib-test/Makefile.am
M	src/lib-test/test-common.h
A	src/lib-test/test-ostream.c

2016-09-30 13:10:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (364ce1d)

    lib-test: Moved test_istream code to its own test-istream.c file.


M	src/lib-test/Makefile.am
M	src/lib-test/test-common.c
A	src/lib-test/test-istream.c

2016-09-30 13:04:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3def8e5)

    lib-test: Allow test_istream_set_*() for test-istream's children.

    It will internally find the test_istream from parents. This simplifies the 
    testing code so that it doesn't have to keep track of both the test_istream 
    and the final istream.

M	src/lib-test/test-common.c

2016-09-27 20:21:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (97ad7d5)

    director: Ignore duplicates in director_servers setting.


M	src/director/director-host.c

2016-09-30 12:36:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (de72596)

    lib-storage: mail_user_dup() should duplicate also userdb_fields.


M	src/lib-storage/mail-user.c

2016-09-29 14:15:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c943681)

    lib-storage: Don't reset mail_save_context.saving too early.

    If mailbox_save_using_mail() ended up in mail_storage_copy(), saving was set 
    to FALSE before the copy() method was finished running. This caused e.g. 
    notify plugin to think that this was a copy event instead of a save event.

    Added comments and asserts to clarify how the logic should work between all
    the different copying/moving/saving flags.

M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2016-09-29 14:00:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (88b127b)

    lib-storage: If mailbox_move() fails, reset mail_save_context.moving==FALSE


M	src/lib-storage/mail-storage.c

2016-09-27 15:50:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0f1db26)

    master: Removed hardcoded listen() backlog limit.

    If it's already too large, the kernel will truncate it automatically. So 
    there shouldn't be any reason for us to explicitly limit it.

M	src/master/service-listen.c

2016-09-26 15:38:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b0f6292)

    dict-client: Fixed lock and ioloop wait timings in log messages.

    Previously it was logging the total amount of time spent on lock waits or on 
    ioloop during the existence of the entire process, rather than how much time 
    the command itself was spending on those. This wasn't very useful. Now it
    also tries to separate the time spent on the main ioloop and in dict_wait().

M	src/lib-dict/dict-client.c

2016-09-26 16:44:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d8dfef4)

    dict-client: Don't return "Dict server timeout" too early.

    This could have happened when many dict commands were being run without the
    timeout being reset in the middle.

M	src/lib-dict/dict-client.c

2016-09-26 16:34:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0b7991e)

    dict-client: Remove timeout when there are only background commands.

    Normally the timeout wasn't added in the first place, but it was if a 
    non-background command was added first and it was followed by a background 
    command.

M	src/lib-dict/dict-client.c

2016-09-21 13:47:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bf4a242)

    lib: Fixed ostream-failure-at with blocking parent stream.

    Blocking ostream returns either a full success or a full failure. It can't 
    return that only n/m bytes were written.

    Fixes assert: Panic: file ostream.c: line 255 (o_stream_sendv_int):
    assertion failed: (!stream->blocking)

M	src/lib/ostream-failure-at.c

2016-09-19 11:08:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2d3f055)

    lib-ssl-iostream: The final fix to make the SSL plugin loading not fail..


M	src/lib-ssl-iostream/iostream-ssl.c

2016-09-18 16:33:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7cf115f)

    lib-ssl-iostream: Fixed OpenSSL module to be actually initialized.


M	src/lib-http/test-http-client.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl.c

2016-09-16 08:39:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2d3cb95)

    lib-http: Link test-http-client libssl_iostream_openssl.so directly.

    This way it can be run without having to do make install first.

M	src/lib-http/Makefile.am
M	src/lib-http/test-http-client.c

2016-09-16 08:35:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a8fce6a)

    lib-ssl-iostream: Use more standard _init() & _deinit() to initialize SSL
    plugin

    This is mainly to make it easier for test programs to link to the plugin 
    directly.

M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl-private.h
M	src/lib-ssl-iostream/iostream-ssl.c

2016-09-10 11:15:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (41f4efe)

    doveadm: Don't allow doveadm_print_header(title==NULL) anymore.

    It's not used anywhere, and if it was used it would have crashed with at 
    least "tab" backend.

M	src/doveadm/doveadm-print.c

2016-09-09 17:40:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (429441c)

    fts-squat: Fixed memory leak on corrupted uidlist handling


M	src/plugins/fts-squat/squat-uidlist.c

2016-09-09 17:39:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (67d2a45)

    dict-file: Don't leak a lock on temp file creation failure.


M	src/lib-dict/dict-file.c

2016-10-11 11:03:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a98be20)

    lib: iostream-temp: Fixed o_stream_send_istream() with >2GB files

    8051312f9 wasn't quite enough.

M	src/lib/iostream-temp.c

2016-10-10 14:42:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2803686)

    lib-program-client: Compiler warning fixes


M	src/lib-program-client/test-program-client-remote.c

2016-10-10 14:20:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a3217af)

    lib-program-client: Avoid busy-looping while waiting for ostream to have
    space.


M	src/lib-program-client/program-client.c

2016-10-07 19:49:24 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e5e08bf)

    lib-program-client: Add test suite for program client


M	src/lib-program-client/Makefile.am
A	src/lib-program-client/test-program-client-local.c
A	src/lib-program-client/test-program-client-remote.c

2016-10-07 19:48:59 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (2393384)

    lib-program-client: Expose asynchronous API


M	src/lib-program-client/program-client-private.h
M	src/lib-program-client/program-client-remote.c
M	src/lib-program-client/program-client.c
M	src/lib-program-client/program-client.h

2016-10-06 11:57:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (de0de87)

    lib-program-client: Whitespace fix


M	src/lib-program-client/program-client-local.c
M	src/lib-program-client/program-client-private.h
M	src/lib-program-client/program-client.c

2016-09-12 13:02:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d8e11da)

    lib-program-client: Add program-client from pigeonhole


M	configure.ac
M	dovecot-config.in.in
M	src/Makefile.am
A	src/lib-program-client/Makefile.am
A	src/lib-program-client/program-client-local.c
A	src/lib-program-client/program-client-private.h
A	src/lib-program-client/program-client-remote.c
A	src/lib-program-client/program-client.c
A	src/lib-program-client/program-client.h

2016-09-29 09:51:40 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c549d51)

    doveadm-import: Update manpage


M	doc/man/doveadm-import.1.in

2016-09-29 10:17:05 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (9811490)

    doveadm-import: Add -U parameter to specify source user

    When doing import, you can specify which user to use as source user.

M	src/doveadm/doveadm-mail-import.c

2016-09-29 10:15:24 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e62a4b5)

    doveadm-import: Use target user as source user

    This is done to avoid spurious error messages caused by being ran as root.

M	src/doveadm/doveadm-mail-import.c

2016-09-28 13:34:46 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (351aa01)

    imap-hibernate: Accept RFC DONE\IDLE

    Change imap-hibernate to accept DONE\r\n<tag> IDLE\r\n as well, which is
    specified by RFC

M	src/imap-hibernate/imap-client.c

2016-09-27 13:28:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8428e40)

    lib-storage: Update mailbox.recent_flags_count correctly.

    The counter was increased even if the UID was already in recent_flags. This
    is the only place where I found that recent_flags and recent_flags_count
    could become desynced (which they definitely were in a core dump), so
    hopefully this fixes assert-crashes like:

    Panic: file index-status.c: line 130 (index_storage_get_open_status):
    assertion failed: (status_r->recent <= status_r->messages)

M	src/lib-storage/mailbox-recent-flags.c

2016-09-27 13:50:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6d8be32)

    dsync: Virtual sizes weren't exported properly with -I parameter.

    Although they were incorrectly being exported with -T parameter. This makes
    -I work without assert-crashing.

M	src/doveadm/dsync/dsync-mailbox-export.c

2016-09-27 13:50:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (35ed782)

    dsync: Renamed "max sync size" parameter from -S to -I.

    -S can't be used because it was already used for the generic socket path, so
    it didn't actually work.

M	src/doveadm/doveadm-dsync.c

2016-09-14 07:13:50 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (70d190c)

    doveadm: refactor mailbox attribute get/set/unset/list to share more code


M	src/doveadm/doveadm-mail-mailbox-metadata.c

2016-09-13 07:50:04 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (c262cd3)

    doveadm: allow access to server attributes via empty mailbox name


M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-09-13 07:49:41 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (0878b1e)

    lib-storage: remove attribute accessibility checks

    index_storage_attribute_{set,get} should assume that the caller performed 
    due diligence and checked whether or not the user is allowed to store under 
    the key.

M	src/lib-storage/index/index-attribute.c

2016-09-13 03:33:06 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (f9c0271)

    doveadm: lowercase attribute names before trying to parse them

    This now matches what the imap server does.

M	src/doveadm/doveadm-mail-mailbox-metadata.c

2016-09-13 03:32:06 -0400 Josef 'Jeff' Sipek <jeff.sipek@dovecot.fi> (d05c38a)

    lib-storage: document mailbox and server attribute handling


M	src/lib-storage/mailbox-attribute.h

2016-09-23 14:59:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (211d75a)

    login proxy: Don't leak connections if reconnect fails with "Host is down"

    Double-disconnection was also attempting to close the same fd twice, but I 
    think that couldn't have happened before this leak was fixed.

M	src/login-common/login-proxy.c

2016-09-22 14:14:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b0f7c3f)

    lib: Add test for pending io without timeouts


M	src/lib/test-ioloop.c

2016-09-22 14:13:43 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (34e1b3a)

    lib: Update ioloop attributes

    With pending IO, the ioloop attributes still need updating, instead of just
    returning.

M	src/lib/ioloop.c

2016-09-22 14:23:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3cefb7d)

    lib-mail: message_header_hash_more() now allows input in any slices.

    There wasn't necessarily any guarantees that the input would be sliced in 
    such a way that the repeating '?' would be dropped the same way every time.

M	src/doveadm/dsync/dsync-mail.c
M	src/lib-mail/message-header-hash.c
M	src/lib-mail/message-header-hash.h
M	src/lib-mail/test-message-header-hash.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-09-22 14:16:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a3caf91)

    lib-mail: Removed obsolete comment about message_header_hash_more()

    pop3-migration plugin uses this function now, so it doesn't need to be kept 
    in sync.

M	src/lib-mail/message-header-hash.c

2016-09-22 13:47:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a396343)

    pop3-migration: "first POP3 msg" warning didn't actually show the first one.

    It was showing the first index in an array, which had nothing to do with 
    being the first POP3 message number.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-09-22 13:38:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (051db9c)

    dbox: mailbox_update() shouldn't reset pop3-uidl header.

    This broke reading migrated POP3 UIDLs.

M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c

2016-09-21 20:50:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (566c9a2)

    login-proxy: Fixed "Host is down" never reseting itself.

    Broken by c8eb8314a, which moved adding num_waiting_connections earlier. 
    After that it was never 0 at the check time.

M	src/login-common/login-proxy.c

2016-09-21 16:17:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e7d12f1)

    lib: test-istream-chain fixes


M	src/lib/test-istream-chain.c

2016-09-20 18:08:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bfed4b1)

    lib-dcrypt: Don't finalize encryption on o_stream_flush()

    For example the default o_stream_uncork() implementation enforces flushing 
    and it's probably better not to change that. In general there's really no 
    reason to perform the finalization at flush when the stream can't be written 
    to anymore (whereas lib-compression ostreams allow writes after flushes).

M	src/lib-dcrypt/ostream-encrypt.c

2016-09-21 13:26:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (946de45)

    lib: Fixed istream-chain when it has multiple "previous streams".

    Fixes assert: Panic: file istream-chain.c: line 223 (i_stream_chain_read):
    assertion failed: (cur_data_pos == data_size)

    Unit test for it by Stephan Bosch.

M	src/lib/istream-chain.c
M	src/lib/test-istream-chain.c

2016-09-21 12:19:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ca0eec0)

    doveadm fs get: Fixed logging error messages.

    The error is in istream, not in fs.

M	src/doveadm/doveadm-fs.c

2016-09-20 21:06:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e26249c)

    imap-login: Add missing brace


M	src/imap-login/imap-proxy.c

2016-09-20 18:51:18 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (24068f9)

    imap-proxy: Fix typo in comment


M	src/imap-login/imap-proxy.c

2016-09-20 15:02:42 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (4b7ae2a)

    imap-login: Honor nopipelining during preauth


M	src/imap-login/imap-proxy.c

2016-09-20 12:47:32 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (5983575)

    lib-dcrypt: Set NOPLUGIN_LDFLAGS to empty

    Avoids -Wl,--as-needed here

M	src/lib-dcrypt/Makefile.am

2016-09-20 10:52:08 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (dca450b)

    lib-dcrypt: Makefile.am fix

    Remove dcrypt.c from openssl library and add missing slash

M	src/lib-dcrypt/Makefile.am

2016-09-16 15:50:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (7cf692d)

    lib: Ensure handler_context is not NULL

    handler context must not be NULL here.

M	src/lib/ioloop-epoll.c

2016-09-16 15:49:36 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b03157a)

    lib: Prevent crash in ioloop

    If only non-fd sources and no timeouts are in ioloop, prevent crash and
    unnecessary waiting when there are pending IOs.

M	src/lib/ioloop.c

2016-09-19 16:20:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ec50efe)

    lib: Assert if i_stream_create_seekable_path(temp_path_prefix==NULL)

    If the stream becomes large enough it would crash then in a callback 
    function, which makes debugging more difficult.

M	src/lib/istream-seekable.c

2016-09-19 12:27:16 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ea091ce)

    fts-plugin: Remove NULL assert

    fts_backend_update_deinit will set box to NULL and call update_set_mailbox
    then. NULL check needs to be done in backends.

M	src/plugins/fts/fts-api.c

2016-09-19 12:26:46 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (04a1b38)

    fts-backend-solr: Check that box is not NULL

    fts_backend_update_deinit will set box to NULL and call update_set_mailbox
    then.

M	src/plugins/fts-solr/fts-backend-solr.c

2016-09-19 12:26:08 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ff3bf63)

    fts-backend-lucene: Check that box is not NULL

    fts_backend_update_deinit will set box to NULL and call update_set_mailbox
    then.

M	src/plugins/fts-lucene/fts-backend-lucene.c

2016-09-17 12:57:00 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (461e4c7)

    auth-policy: Ref/unref auth request

    If auth_request is not referenced it can go away before HTTP response is
    handled.

M	src/auth/auth-policy.c

2016-09-16 17:13:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (69de251)

    fs-randomfail: Operation is unfinished on EAGAIN, not ENOENT.

    This caused crashes and other problems when using randomfail with 
    asynchronous fs drivers.

M	src/lib-fs/fs-randomfail.c

2016-09-15 11:30:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6857116)

    lib: safe_mkstemp*() didn't always truncate prefix back to original on
    failure.

    This caused repeated safe_mkstemp*() calls with the same prefix to keep 
    increasing its size. It probably didn't really break anything (unless it was 
    called enough many times to reach 255 filename length), but the filenames 
    were still confusingly ugly.

M	src/lib/safe-mkstemp.c

2016-09-15 10:23:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f2ade30)

    pop3-migration: Fixed crash when not specifying pop3_migration_mailbox
    setting.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-09-14 14:19:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7736f24)

    iostream-temp: If write() to temp file fails at any time, move it back to
    memory.

    Similarly to if the write() to temp fails during the initial move attempt. 
    This way even if write() fails due to out of disk space, it's not visible to
    caller. An error message is logged in any case.

M	src/lib/iostream-temp.c
M	src/lib/iostream-temp.h

2016-09-14 19:06:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c06590c)

    pop3-migration: Avoid unnecessarily using stream's hdr_size.

    Shouldn't change any behavior, except reduce CPU usage a little bit.

M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/pop3-migration/pop3-migration-plugin.h
M	src/plugins/pop3-migration/test-pop3-migration-plugin.c

2016-09-14 18:57:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f75889f)

    imapc: mail_get_stream() shouldn't return cached hdr_size


M	src/lib-storage/index/imapc/imapc-mail.c

2016-09-13 22:54:02 +0200 Stephan Bosch <stephan@dovecot.fi> (9d0e247)

    lib-http: client: Fixed hang occurring when nested ioloops are used in
    response callbacks.

    To prevent missing disconnect events, i_stream_read() is called once a
    change in ioloop is detected. However, if something was actually read into
    the stream, the input handler was never called. So, a response could linger
    in the stream buffer, without being handled, thereby causing the connection
    to hang indefinitely. An additional input event could end the hang, but
    sometimes this doesn't happen before the request times out.

    This problem was seen in test-http-payload once in about 10 invocations. 
    Obox uses nested ioloops, to this applies there.

M	src/lib-http/http-client-connection.c

2016-09-10 11:32:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ecdabaf)

    doveadm-auth: Handle unexpected auth "continue" request without crashing.


M	src/doveadm/doveadm-auth.c

2016-09-10 11:28:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6f94745)

    lib-lda: Cleanup error handling in LMTP client code.

    If there are no successful recipients, we'll need to deinit the client. But
    at that point we've already called all the callbacks, so the line parameter
    to lmtp_client_fail_full() isn't actually used anywhere. This was confusing
    static analyzer because global_fail_string was used as parameter, which
    could have been NULL and wouldn't have been valid for the callbacks.

M	src/lib-lda/lmtp-client.c

2016-09-10 11:16:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (41d9145)

    lib-master: Fixed memory leak when IPC server is handling commands.

    This mainly meant that when login processes responded to doveadm proxy 
    list/kick commands memory was leaked.

M	src/lib-master/ipc-server.c

2016-09-10 11:13:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b49ca32)

    dict-client: Don't crash if dict-server returns broken reply.

    Just treat missing <tab>value as empty value.

M	src/lib-dict/dict-client.c

2016-09-09 18:18:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (88eab52)

    auth: Make sure auth_request_log_info() doesn't crash when there are no
    passdbs

    auth_request_is_disabled_master_user() could have caused such crash.

M	src/auth/auth-request.c

2016-09-09 18:12:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (abea9d7)

    auth: Explicitly ignore return value to make static analyzer happier.


M	src/auth/auth-policy.c

2016-09-09 18:10:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (83ad90e)

    Added asserts to make static analyzer happier.


M	src/lib-fs/fs-posix.c
M	src/lib-index/mailbox-log.c
M	src/lib-stats/stats-connection.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib/istream-file.c
M	src/login-common/login-proxy-state.c
M	src/plugins/fts/fts-api.c
M	src/plugins/virtual/virtual-mail.c

2016-09-09 18:07:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0ee86a8)

    Removed dead code to make static analyzer happier.


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/mail-storage.c
M	src/plugins/fts-squat/squat-trie.c

2016-09-09 17:55:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d464010)

    lib-storage: Fix potential crash when userdb-returns "key+=value" for a
    nonexistent setting.

    type would have also happened to be initialized to SET_STR for the crash to 
    happen.

M	src/lib-storage/mail-storage-service.c

2016-09-09 17:36:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7ee368a)

    lib-imap-urlauth: Don't access freed memory on errors.


M	src/lib-imap-urlauth/imap-urlauth-connection.c

2016-09-13 07:22:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e90a0ed)

    imap, pop3: Added rawlog_dir setting to store IMAP/POP3 traffic logs.

    This at least partially replaces the "rawlog" post-login binary. For now the
    "rawlog" binary supports some parameters, which aren't configurable for
    rawlog_dir.

M	src/imap/imap-client.c
M	src/imap/imap-settings.c
M	src/imap/imap-settings.h
M	src/pop3/pop3-client.c
M	src/pop3/pop3-settings.c
M	src/pop3/pop3-settings.h

2016-09-09 15:51:43 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (9c96b04)

    pop3-migration-plugin: Add to index after successful retry

    Also change return value to indicate that the hash has been assigned to
    header.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-09-12 09:47:26 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (63648d3)

    doveconf: Hide any _api_key


M	src/config/doveconf.c

2016-08-16 12:28:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (5affc31)

    doveconf: hide ssl_key without -P


M	src/config/doveconf.c

2016-09-05 16:26:56 +0300 Phil Carmody <phil@dovecot.fi> (8d41c2d)

    plugins: fts - replace i_assert under _expunge_log_subtract with warning
    (API change)

    The helper whose interface is changing currently has no other known clients
    (there's little need for it to be exposed at all).

    This should never happen, but if it does, just tally the number of times it
    happened, and squirt out a warning message after the whole subtract. If it
    happens at all, there's no reason not to expect a lot, so only warn once per
    file.

    In particular - do not assert crash when this is seen - it has been seen on
    live test systems where file corruption seems to have occured. As this can
    only be associated with corrupt fts indexes, seeing this error implies that
    the whole FTS index should be rebuilt for that user.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-expunge-log.h

2016-08-10 13:07:01 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ad082a8)

    lib-storage: Limit folder full name only

    Before we had limit of 16 levels and 255 bytes per name which is same as
    4096 bytes. Now we limit only the total length of the name to
    MAILBOX_LIST_NAME_MAX_LENGTH. For compability reasons, we are restricting
    individual component names to 255 characters.

M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2016-08-22 16:13:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (38a2542)

    fs-metawrap: Added assert to make sure we don't create empty files.

    It seems like this could be happening in some situation.

M	src/lib-fs/fs-metawrap.c

2016-09-09 02:48:45 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bd64561)

    fs-randomfail: Fixed assert-crash in fs_write_stream_abort_error()


M	src/lib-fs/fs-randomfail.c

2016-09-09 01:42:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (063b8d8)

    imap-hibernate: Increased imap-master communication timeout from 5s to 30s

    Looks like 5s isn't enough in loaded environments. It's also not really a 
    problem if the timeout is large, it's just going to take a while longer to 
    restore the connection. When timeout is reached the client would just get 
    disconnected anyway.

M	src/imap-hibernate/imap-master-connection.c

2016-09-09 14:07:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5186e35)

    lib-storage: Fixed accessing user as root when user has no uid.

    This shouldn't normally be done, but might as well fix it. Fixes:

    Fatal: mail-storage-service: seteuid(4294967295) failed: Invalid argument

M	src/lib-storage/mail-storage-service.c

2016-09-09 00:59:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8e757fc)

    lib-index: Fixed mail_index_modseq_get_next_log_offset() when accessing
    .log.2

    file->sync_offset was set only after header, so sync_highest_modseq was also 
    same as initial_modseq. The previous code then just returned offset pointing 
    to sync_offset, which was too early.

M	src/lib-index/mail-transaction-log-file.c

2016-09-08 23:54:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (32c8340)

    lib-index: Make sure new dovecot.index.log files start tracking modseqs.

    This will make mail_index_modseq_get_next_log_offset() work correctly even 
    if modseqs haven't been explicitly enabled.

M	src/lib-index/mail-transaction-log-file.c

2016-08-23 22:36:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (adf7780)

    lib-storage: Code cleanup for mailbox_get_expunge*()

    The previous code did actually work as well, but it wasn't very obvious that 
    it did.

M	src/lib-storage/mailbox-get.c

2016-09-09 01:31:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d0b5b7e)

    imap: When hibernating, wait for old imap process to cleanup before creating
    new ones.

    This fixes stats errors:

    stats: Error: FIFO input error: CONNECT: Duplicate session ID
    Y7Q6E4U7xO1/AAAB for user testuser service imap stats: Warning: Couldn't
    find session ID: Y7Q6E4U7xO1/AAAB

M	src/imap-hibernate/imap-hibernate-client.c
M	src/imap/imap-client-hibernate.c

2016-09-09 02:50:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (67c9729)

    lib-fs: Moved fs_write_stream_abort_parent() to fs-api-private.h

    Only fs wrapper drivers are supposed to call it.

M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.h

2016-09-08 19:01:54 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (7963367)

    lib-index: limit mail_index error prints to one per ioloop_time

    This is to prevent log flooding.

M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.c

2016-09-09 10:38:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4148574)

    lib-test: Added missing va_end() call.


M	src/lib-test/test-common.c

2016-09-09 03:05:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bd30f04)

    lib-test: test_expect_errors() now works for the entire log string, not just
    format parameter


M	src/lib-test/test-common.c

2016-08-09 18:29:19 +0300 Phil Carmody <phil@dovecot.fi> (f663500)

    lib-test: test-exit helper to stop valgrind complaining about fork()s

    fork()s that want to _exit() will cause valgrind's full memory leak checker
    to complain a lot - this performs a quick cleanup first.

    Before:
     phil@phil:~/repos/dovecot-core$ valgrind --trace-children=yes
    --leak-check=full --show-leak-kinds=all src/lib/test-lib --match unix
     ==19576==   total heap usage: 4 allocs, 0 frees, 17,858 bytes allocated
     istream unix ......................................................... : ok
     0 / 1 tests failed
     ==19575==   total heap usage: 7 allocs, 7 frees, 19,327 bytes allocated

    After:
     phil@phil:~/repos/dovecot-core$ valgrind --trace-children=yes
    --leak-check=full --show-leak-kinds=all src/lib/test-lib --match unix
     istream unix ......................................................... : ok
     ==4993==   total heap usage: 4 allocs, 4 frees, 17,858 bytes allocated
     0 / 1 tests failed
     ==4992==   total heap usage: 7 allocs, 7 frees, 19,327 bytes allocated

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h
M	src/lib/test-istream-unix.c

2016-07-12 13:28:54 +0300 Phil Carmody <phil@dovecot.fi> (7d43648)

    lib-test: enable naming of tests, such that only a subset is run

    How to use these will become clear in a subsequent patch. Even if you don't
    want to name tests, the macros can reduce redundancy in the code, as the
    list of test function prototypes and the list of test functions to call
    become the same lists, expanded through 2 different macros.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2016-06-01 13:57:34 +0300 Phil Carmody <phil@dovecot.fi> (8154226)

    lib-test: improve expected error handling

    If we expect a specific error string, then when we see it, suppress it.

    We do not suppress errors expected by count, because if we get unexpected 
    errors, then we do not want them suppressed, and we have no way of 
    distinguishing between the expected and unexpected errors.

    This of course favours the use of the expected string version of the helper, 
    but alas that's not always usable, as you can only expect one at a time.

    Additionally, if we failed to see an expected message, then when we no
    longer expect to see it, reset the expected message state to not cascade
    further test assertion failures.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

    Conflicts:
    src/lib-test/test-common.c

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h
M	src/lib/test-failures.c

2016-09-09 01:08:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3e2ec5a)

    stats: Include PIDs in "Duplicate session ID" errors.


M	src/stats/mail-session.c

2016-09-08 22:08:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (54ee447)

    lib-index: mail_index_modseq_get_next_log_offset() shouldn't return offset
    beyond view's head

    This also allows removing the same workaround from dsync code.

M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/lib-index/mail-index-modseq.c

2016-09-07 11:52:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (980f2d5)

    imap: Avoid wrongly assert-crashing in client_check_command_hangs()

    Fixes assert:

    Panic: file imap-client.c: line 837 (client_check_command_hangs): assertion
    failed: (client->io != NULL)

M	src/imap/imap-client.c

2016-09-08 20:23:35 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (853992a)

    stats plugin: Don't send any stats before CONNECT was successfully sent.

    After stats write failures this fixes warnings like: Warning: stats:
    Couldn't find session ID: smqAXQE8pIp/AAAB

M	src/plugins/stats/mail-stats-connection.c
M	src/plugins/stats/mail-stats-connection.h
M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h

2016-09-08 20:18:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e19ba44)

    lib-stats: stats_connection_send() now returns whether it succeeded or not


M	src/lib-stats/stats-connection.c
M	src/lib-stats/stats-connection.h

2016-09-08 16:50:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ceb5ed3)

    doveadm flags: Sync mailbox after committing transaction.


M	src/doveadm/doveadm-mail-flags.c

2016-09-07 22:06:55 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (91f0296)

    lmtp: Always read settings before dropping privs

    If lmtp is ran explicitly as root, settings were not read.

M	src/lmtp/main.c

2016-09-07 22:00:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (51b18a2)

    imap: Fixed assert-crash if un-hibernation failed to initialize user.

    master_service_client_connection_destroyed() was also being called in 
    imap_master_client_destroy() so it was done twice.

    Fixes: Panic: file master-service.c: line 775
    (master_service_client_connection_destroyed): assertion failed:
    (service->total_available_count > 0)

M	src/imap/imap-master-client.c

2016-09-05 12:42:08 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b3a3731)

    fs-api: Retrieve errno before dest->copy_output is NULL'ed

    CID 10144: When aborting output, errno retrieval is attempted after
    dest->copy_output has already been unreffed. Found by coverity.

M	src/lib-fs/fs-api.c

2016-09-06 09:24:06 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (55992ff)

    lib-storage: Check that UID is set before caching


M	src/lib-storage/index/index-mail-binary.c

2016-09-06 09:23:54 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (86fe000)

    lib-imap-storage: Check that UID is assigned before caching


M	src/lib-imap-storage/imap-msgpart.c

2016-09-05 15:56:05 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ff405d5)

    zlib-plugin: Check that UID is assigned

    When caching, code has to check whether UID is assigned to avoid reusing
    cache for different email since they all have UID = 0 before they are
    actually committed.

M	src/plugins/zlib/zlib-plugin.c

2016-09-06 16:17:13 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (1bac2e4)

    quota: Flush quota after recalc

    Correctly fix issue where the dict commit is left unfinished.

M	src/plugins/quota/doveadm-quota.c

2016-09-06 16:02:26 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e525e42)

    lib-dict: Discard result when callback is NULL on async call


M	src/lib-dict/dict-client.c

2016-09-06 02:56:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6a008d8)

    lib-dcrypt: Avoid infinite loop if istream header is too large.

    We'll return an error now instead. We can't just return -2 here, because
    nothing was actually being returned to the caller. Attempting to do that
    would just trigger an assert:

    Panic: file istream.c: line 182 (i_stream_read): assertion failed:
    (_stream->skip != _stream->pos)

M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/test-stream.c

2016-08-25 12:27:51 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b5d604b)

    dcrypt: Test for stream prefetch


M	src/lib-dcrypt/test-stream.c

2016-08-25 12:26:55 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (527d6c5)

    dcrypt: Allow stream prefetch

    We might get stream that has already been buffered, so we must try read it
    in case buffer is full.

M	src/lib-dcrypt/istream-decrypt.c

2016-08-31 20:14:41 +0300 Phil Carmody <phil@dovecot.fi> (2e7a019)

    Fix control flow and T_BEGIN/T_END hygiene

    You mustn't goto, break, continue, or return from out of a T_BEGIN {...}
    T_END block, as that will lose a t_pop(). This has been seen in the wild:
    Panic: Leaked t_pop() call

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/director/login-connection.c
M	src/lib/file-lock.c

2016-08-31 09:20:49 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (cfb4971)

    lib-fs: Do not abort parent of parent


M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-wrapper.c
M	src/plugins/fs-compress/fs-compress.c

2016-08-28 18:40:01 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8dfdcd1)

    doveadm-server: Reset error code between calls


M	src/doveadm/client-connection.c

2016-08-28 19:55:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0204e1f)

    stats: Reset nearly all global mail stats

    We leave num_connected_sessions alone.

M	src/stats/client-reset.c

2016-08-28 19:14:08 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ea0bb9e)

    stats: Fix user login counters

    Before we would count all users twice, because the same counters would get
    increment in both CONNECT and ADD-USER. Now we do not increment them at all
    on ADD-USER.

M	src/stats/mail-domain.c
M	src/stats/mail-session.c
M	src/stats/mail-user.c

2016-08-24 03:56:44 -0400 Josef 'Jeff' Sipek <jeffpc@josefsipek.net> (7ba262b)

    lib-master: don't leak config path

    The config path can already be non-NULL thanks to the default config path 
    code or the CONFIG_PATH environmental variable.

M	src/lib-master/master-service.c

2016-08-23 23:31:40 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (37ff608)

    lib-fs: abort parent in fs_file_write_stream_abort_parent


M	src/lib-fs/fs-api.c

2016-08-23 13:06:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (30a61cb)

    imap: Track how much time was spent on waiting for locks.


M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c

2016-08-23 12:55:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5b05972)

    dict-client: In slow query warnings, log time spent in ioloop and lock
    waits.

    Possibly we want to remove the warnings entirely if most of the time has
    been spent on lock waits (or alternatively: not spent in ioloop).

M	src/lib-dict/dict-client.c

2016-08-23 12:48:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (09d0a0a)

    lib: Track how much time has been spent on waiting for locks.


M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-lock.h

2016-08-23 14:08:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1fd44e0)

    imap: Fixed expunge handling when un-hiberanting

    Fixes these errors:

    Failed to import client state: Message count mismatch after handling
    expunges Message UIDs CRC32 mismatch

M	src/imap/imap-state.c

2016-08-23 20:12:47 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8ff16d0)

    lib-fts: Add missing include


M	src/lib-fts/fts-filter-common.c

2016-08-23 13:41:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f0bf900)

    lib-fs: Fixes to previous fs_write_stream_abort*() changes.


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-randomfail.c

2016-08-23 13:40:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (33b34cb)

    lib-storage: Fixed istream-attachment-extractor error handling.


M	src/lib-storage/index/index-attachment.c

2016-08-23 13:40:35 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8c225e4)

    lib-mail: Clarify istream-attachment-extractor's error handling API usage.


M	src/lib-mail/istream-attachment-extractor.h

2016-08-22 09:42:26 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (bb35c31)

    lib-fs: Add fs_write_stream_abort_parent and use it

    Will do all the things abort_error does, but leaves error untouched. You are
    expected to set one yourself.

M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-wrapper.c
M	src/plugins/fs-compress/fs-compress.c

2016-08-23 10:53:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d76499e)

    lib-storage: Added mailbox_recent_flags_expunge_uid()

    For storage backends where it's useful.

M	src/lib-storage/mailbox-recent-flags.c
M	src/lib-storage/mailbox-recent-flags.h

2016-08-22 23:41:05 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (d5e9329)

    lib-fts: Change normalizer filter to use new truncate.


M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/test-fts-filter.c

2016-08-21 22:12:33 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (7a78786)

    lib-fts: Cut overlong strings in lowercase filter.

    Added new common truncate function for filters. It also removes any partial 
    characters, that would remain from plain truncation.

M	src/lib-fts/Makefile.am
A	src/lib-fts/fts-filter-common.c
A	src/lib-fts/fts-filter-common.h
M	src/lib-fts/fts-filter-lowercase.c
M	src/lib-fts/test-fts-filter.c

2016-08-17 16:47:19 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (6b34eef)

    lib-fts: Add max_length to common filter struct. Reorder fields.

    The latter is for for imaginary alignment enhancements.

M	src/lib-fts/fts-filter-private.h

2016-08-19 16:00:30 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (cc8e8c4)

    fs-api: Add and use fs_write_stream_abort_error

    This lets caller to specify error instead of setting it with fs_error. Doing
    it like this lets us percolate the error upwards.

M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-wrapper.c
M	src/lib-storage/index/index-attachment.c
M	src/plugins/fs-compress/fs-compress.c

2016-08-19 14:47:33 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d4d390f)

    quota-dict: Make sure all transactions complete


M	src/plugins/quota/quota-dict.c

2016-08-18 14:48:50 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (af4e68f)

    pop3: Fix deleted_count expansion


M	src/pop3/pop3-client.c

2016-08-18 11:22:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (65cf80a)

    lmtp: Support %{userdb:*} variables in mail_log_prefix


M	src/lmtp/commands.c

2016-08-15 23:43:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (673e05e)

    quota, last-login: Disable "slow dict commit" warnings

    Anything (especially long lock waits) can happen between the commit and when 
    we read their replies.

M	src/plugins/last-login/last-login-plugin.c
M	src/plugins/quota/quota-dict.c

2016-08-15 23:40:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e53c3da)

    lib-dict: Added dict_transaction_no_slowness_warning()


M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h

2016-08-15 23:36:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3bb1aec)

    dict-client: Keep transaction's pointer in command until it's finished.


M	src/lib-dict/dict-client.c

2016-08-15 23:16:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (01e58ef)

    dict-client: Improve "slow dict operation" warnings in error conditions.

    There's no need to log both an error and a warning.

M	src/lib-dict/dict-client.c

2016-08-17 17:57:16 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (28d1de5)

    imap-hibernate: fix input_pending check in client_unhibernate_cmp

    Check c2->input_pending instead of c1->input_pending when calculating 
    comparison value for c2.

M	src/imap-hibernate/imap-client.c

2016-08-17 17:20:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (43cce3e)

    lib-dcrypt: Fixed accessing out-of-bounds data in istream.

    Also some small cleanups to make it clearer what's actually happening.

M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/ostream-encrypt.c

2016-08-17 16:25:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3d35367)

    lib-dcrypt: Fixed partial reads in header and limit header's max size.

    Also fixes test-stream to actually test nonblocking reads correctly.

M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/test-stream.c

2016-08-16 14:49:35 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e8671af)

    fts-squat: Ensure child is not NULL

    Makes static analysers happy

M	src/plugins/fts-squat/squat-trie.c

2016-08-16 14:47:35 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (bd86b25)

    lib-master: Check for NULL in input/output

    Makes static analysers happy

M	src/lib-master/master-login-auth.c

2016-08-16 14:46:08 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (45e3aa0)

    auth: Ensure username can't be left unset in APOP

    Makes static analysers happy

M	src/auth/mech-apop.c

2016-08-16 14:42:41 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d18e554)

    imapc: Make sure imail.stream is not NULL

    Makes static analysers happy

M	src/lib-storage/index/imapc/imapc-mail.c

2016-08-16 14:39:37 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (33efd47)

    lib-storage: Make sure data->stream isn't NULL

    Makes static analysers happy

M	src/lib-storage/index/index-mail-headers.c

2016-08-16 14:36:07 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (be4e632)

    auth: Check for NULL auth token

    Makes static analysers happy

M	src/auth/mech-dovecot-token.c

2016-08-16 13:49:01 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (23554f9)

    lib: Fix SENTRY_CHAR to different kind of number

    Makes static analysers happier

M	src/lib/test-mempool-alloconly.c

2016-08-16 13:46:09 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (a6067d4)

    lib-http: Ensure fstream is not NULL in test

    Makes static analysers happier

M	src/lib-http/test-http-payload.c

2016-08-16 13:44:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (5978fb8)

    lib-index: Do not do pointless memmove

    Makes static analysers happier, since moving the data when days is 0 or days
    is 8 is effectively non-op.

M	src/lib-index/mail-index-transaction-update.c

2016-08-16 13:31:48 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0d1ff87)

    test-priorityq: Ensure item is not NULL

    Makes static analysers happy

M	src/lib/test-priorityq.c

2016-08-16 13:30:36 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (1dfbc5e)

    md5: Initialize block

    Makes static analysers happy

M	src/lib/md5.c

2016-08-16 14:53:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1eedaab)

    lib-storage: If chdir to home doesn't work, chdir to root instead.

    Most importantly this fixes unlink_directory() when current directory after
    dropping privileges can't be open()ed.

M	src/lib-storage/mail-storage-service.c

2016-08-16 14:04:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (80d0268)

    lib-storage: Minor error message fix


M	src/lib-storage/list/mailbox-list-delete.c

2016-08-16 11:05:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2d1aea8)

    lib-mail: Compiling fix for message-snippet change - U'x' isn't standard.


M	src/lib-mail/message-snippet.c

2016-03-29 22:30:17 +0200 nikwrt <nikwrt@gmx.de> (3060a08)

    fts-squat: fix Corrupted squat uidlist bug


M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-trie.h
M	src/plugins/fts-squat/squat-uidlist.c

2016-08-15 19:22:31 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3a2cd40)

    lib-mail: Fix snippet generation

    Now we won't add leading whitespace for no reason, and also strip BOM when
    found.

M	src/lib-mail/message-snippet.c

2016-08-15 13:30:44 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c09f8e4)

    dcrypt: Fix encrypted test keys


M	src/lib-dcrypt/test-crypto.c

2016-08-15 11:32:31 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (486c1ba)

    dcrypt: Update v2 sample


M	src/lib-dcrypt/sample-v2.asc

2016-08-15 11:27:04 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (649443e)

    dcrypt: Retrieve key length correctly


M	src/lib-dcrypt/dcrypt-openssl.c

2016-08-13 14:31:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9d9be93)

    lib: Avoid compiler warning if off_t has the same size as ssize_t.


M	src/lib/mmap-util.c

2016-08-13 14:16:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (caefe52)

    dsync: Further fixes to received_timestamp and virtual_size parsing (-t and
    -S parameters)


M	src/doveadm/dsync/dsync-ibc-stream.c

2016-08-13 01:00:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (78def5d)

    dsync: Added missing fields to ibc-stream.


M	src/doveadm/dsync/dsync-ibc-stream.c

2016-08-12 01:24:16 +0200 Stephan Bosch <stephan@rename-it.nl> (de51763)

    lib: Implemented i_stream_create_copy_from_data().

    Unlike i_stream_create_from_data(), this function makes a copy of the
    provided data block. This way, the application does not need to worry about
    keeping it allocated for the lifetime of the stream. The copied data is
    allocated durably on the system pool and freed once the stream is destroyed.

M	src/lib/istream-data.c
M	src/lib/istream.h

2016-07-25 10:24:44 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (1e06a0e)

    lib,lib-test: stop calling memcmp and memcpy with NULL in tests


M	src/lib-test/test-common.c
M	src/lib/test-istream-base64-decoder.c
M	src/lib/test-istream-crlf.c

2016-07-25 10:21:43 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (fe98f65)

    lib-mail: stop calling str_append_n and memcmp with NULL in tests


M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-parser.c

2016-08-10 15:40:23 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (caf1bd5)

    lib-storage: don't crash when pop3c-client timeouts


M	src/lib-storage/index/pop3c/pop3c-client.c

2016-08-11 12:46:42 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (603bf65)

    doveadm-dump: Add missing include


M	src/doveadm/doveadm-dump-dcrypt-key.c

2016-08-11 17:27:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bb6928d)

    -Wstrict-bool warning fixes


M	src/doveadm/doveadm-auth-server.c
M	src/doveadm/doveadm-dump-dcrypt-file.c

2016-08-11 17:23:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (89d64f2)

    doveadm sync: Fixed -S parameter parsing to actually work.


M	src/doveadm/doveadm-dsync.c

2016-07-01 14:30:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dd05333)

    doveadm sync/backup: Added -S <max size> parameter to skip too large mails.


M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2016-07-13 09:51:08 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d28ac27)

    auth-db-dict: Allow key name expansion

    This allows expansion of dictionary keys based on userdb variables on dict
    lookup mapping. Example: key userdb {
     key = %{userdb:nspace:default}/userdb
     format = json
    }

M	src/auth/db-dict.c

2016-08-09 11:48:10 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (58bdd08)

    openssl: Fix v1.1 compability


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-ssl-iostream/dovecot-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/login-common/ssl-proxy-openssl.c

2016-08-08 15:31:50 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b3bc729)

    OpenSSL: link against OpenSSL libs explicitly


M	src/lib-dcrypt/Makefile.am
M	src/lib-ssl-iostream/Makefile.am

2016-07-23 23:40:15 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (deb33c7)

    doveadm: add doveadm-dump-dcrypt-key


M	doc/man/doveadm-dump.1.in
M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-dump-dcrypt-key.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-dump.h

2016-08-10 19:15:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (19e19b1)

    quota: If quota lookup updates vsize header, lock it earlier to avoid a
    deadlock.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2016-08-10 19:13:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b44e4cc)

    quota: Fixed handling when mail size lookup fails due to mail already being
    expunged.

    We don't want to fail it as a quota allocation failure, but just pass 
    through the "mail is expunged" error to the original caller.

M	src/plugins/quota/quota.c

2016-08-10 17:56:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ebbcd40)

    dict-client: Improved timeout error message.


M	src/lib-dict/dict-client.c

2016-08-10 17:54:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (06a2305)

    lib: Added connection_input_timeout_reason()


M	src/lib/connection.c
M	src/lib/connection.h

2016-08-10 17:44:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4ed04ae)

    lib: Added connection.connect_started/finished timestamps.


M	src/lib/connection.c
M	src/lib/connection.h

2016-08-11 14:28:24 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (2207665)

    configure: Fix dcrypt build


M	configure.ac
M	src/Makefile.am
M	src/lib-dcrypt/Makefile.am

2016-08-09 18:06:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0b68489)

    quota: Don't get message sizes when updating mailbox that ignores quotas.

    Nothing is done with the size anyway.

M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2016-08-10 19:07:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (aec3f3f)

    lib-storage: Fixed potential .vsize.lock deadlock.


M	src/lib-storage/index/index-storage.c

2016-08-10 17:15:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (492cbf3)

    auth: Removed redundant noauthenticate checks.

    Now that noauthenticate also adds nopassword field.

M	src/auth/auth-request.c
M	src/auth/passdb-sql.c

2016-08-10 17:14:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (05780dd)

    auth: When setting noauthenticate=yes, also set nopassword=yes

    There are various places which check only "nopassword", but not
    "noauthenticate".

M	src/auth/auth-request.c

2016-08-10 17:41:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4fd09db)

    lib: Added connection.last_input_tv for more accuracy


M	src/lib/connection.c
M	src/lib/connection.h

2016-08-10 17:37:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (041b037)

    lib: connection_disconnect() now resets last_input

    If we reconnect, its value would otherwise be wrong.

M	src/lib/connection.c

2016-08-10 17:11:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f874d7a)

    auth: Blocking userdb lookup shouldn't reset extra fields.


M	src/auth/userdb-blocking.c

2016-08-10 14:05:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (faf735b)

    login-proxy: Fixed assert-crash/hang on connect errors.

    The internal BUG would have left the host hanging. "Host is down" or any 
    immediate connect() error would have assert-crashed with:

    Panic: file login-proxy.c: line 470 (login_proxy_disconnect): assertion
    failed: (proxy->state_rec->num_waiting_connections > 0)

M	src/login-common/login-proxy.c

2016-08-10 01:39:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bf5a1d5)

    lmtp: Reverted default port 24 change 1cbf46898.

    This might break some existing installation since otherwise the local port 
    is the default. So lets just keep it a v2.3.x change.

M	src/lmtp/commands.c

2016-08-08 19:25:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (14da98f)

    doveadm: Fixed -A and -u wildcard handling with server connections.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-08-08 19:24:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (10e1efd)

    doveadm: Fixed hanging when printing output from different server
    connections.


M	src/doveadm/server-connection.c

2016-08-08 19:22:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fb163f4)

    doveadm: Avoid recursively calling server input callback

    Probably doesn't fix anything, but it could cause confusing backtraces at 
    least.

M	src/doveadm/server-connection.c

2016-08-08 19:16:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (efb991a)

    doveadm-server: Fixed potential hang when reading replies to multiple
    commands


M	src/doveadm/server-connection.c

2016-08-08 19:11:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a0e641d)

    doveadm: Revert earlier NUL-printing change 793b024bf.

    It changes the output in ways that are a bit difficult to fix. Also the the
    important part where NULs printing is useful is in a message body, which
    should work even without this change. So for now just revert it.

M	src/doveadm/server-connection.c

2016-08-08 17:56:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9411a15)

    lib-auth: Avoid crash after user iteration if connection failed.


M	src/lib-auth/auth-master.c

2016-08-08 17:13:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (eed4d7d)

    doveadm: Removed unused code.


M	src/doveadm/doveadm-mail-save.c

2016-08-08 12:36:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (25c2147)

    doveadm: Extra safety - initialize cmd_input_fd to -1

    Just to be sure it's never attempted to be accessed as 0 (stdin) before 
    being initialized. (It didn't happen with current code as far as I know.)

M	src/doveadm/doveadm-mail.c

2016-08-08 16:15:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4a4f7ff)

    dsync: Fixed empty-header-workaround


M	src/doveadm/dsync/dsync-mailbox-import.c

2016-08-08 16:06:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c2bb974)

    dsync_features: For consistency use '-' and not '_'

    Other _features and _workarounds settings use also '-'.

M	src/doveadm/doveadm-settings.c

2016-08-08 14:39:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1c5c13e)

    doveadm: When printing input from doveadm-server, don't truncate at NUL.


M	src/doveadm/server-connection.c

2016-08-08 13:21:34 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (573f68e)

    doveadm: Pass connection to mail context


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail.c

2016-08-08 11:38:54 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8029a3f)

    doveadm: Use str_append_tabescaped_n


M	src/doveadm/doveadm-print-server.c

2016-08-08 11:23:02 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (2fe2b54)

    lib: Add binary-safe tabescape


M	src/lib/strescape.c
M	src/lib/strescape.h

2016-08-08 09:29:26 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (dd35442)

    doveadm: Streamline tabunescape


M	src/doveadm/server-connection.c

2016-08-03 12:46:21 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (3d98ba2)

    doveadm: add doveadm dump dcrypt-file


M	doc/man/doveadm-dump.1.in
M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-dump-dcrypt-file.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-dump.h

2016-08-06 22:12:13 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (d94f8b1)

    lib-dcrypt: make decrypt_istream format and flags visible


M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/istream-decrypt.h

2016-08-06 22:07:00 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (519bd85)

    lib-dcrypt: add dcrypt-iostream.h

    Move everything from dcrypt-iostream-private.h and enum 
    io_stream_encrypt_flags to the new dcrypt-iostream.h file.

M	src/lib-dcrypt/Makefile.am
D	src/lib-dcrypt/dcrypt-iostream-private.h
A	src/lib-dcrypt/dcrypt-iostream.h
M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/ostream-encrypt.c
M	src/lib-dcrypt/ostream-encrypt.h
M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2016-08-05 15:21:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3328f9f)

    dsync: Add support for features

    Add empty_header_workaround as first feature

M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2016-04-09 18:21:23 -0500 J. Nick Koston <nick@cpanel.net> (8572be9)

    quota_clone plugin: quota_clone_mail_user_created warned without debug

    "The quota_clone_dict setting is missing from configuration" warning would
    be thrown when debug mode was not enabled.  This warning happens under
    normal circumstances when prefix="" namespace is not defined (usually when
    set to INBOX.)

    See http://dovecot.org/list/dovecot-cvs/2012-October/021981.html for more
    details on the automagic prefix="" namespace.

    This change suppresses the spurious warning.

M	src/plugins/quota-clone/quota-clone-plugin.c

2016-04-09 13:43:16 +0200 Wido den Hollander <wido@widodh.nl> (1cbf468)

    lmtp: Use port 24 if no port has been provided

    This allows using the LMTP, IMAP and POP3 proxy on the same Dovecot
    installation without the userdb providing the port to connect to.

    TCP port 24 is registered at IANA as: "any private mail system"

    LMTP being the Local Mail Transfer Protocol classifies as a private mail
    system and thus justifies the usage of port 24.

    Prior to this patch the LTMP client would connect to TCP port 0 by default
    if the userdb did not provide a port to connect to.

M	src/lmtp/commands.c

2016-08-06 17:59:10 +0200 Stephan Bosch <stephan@dovecot.fi> (c48b3d9)

    istream-base64-encoder: Implemented proper stat function that returns the
    encoded size of the stream.

    For Base64 encoding, the size of the encoded data can be determined from the
    input data size exactly.

M	src/lib/istream-base64-encoder.c
M	src/lib/test-istream-base64-encoder.c

2016-08-08 15:51:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f960799)

    lib: ostream-temp didn't update offset when dup()ing fd.


M	src/lib/iostream-temp.c

2016-08-05 22:57:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (847a3da)

    dict-client: Fixed error message for failed synchronous dict_lookup()

    The error message was allocated from data stack, but freed too early.

M	src/lib-dict/dict-client.c

2016-08-04 21:44:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (71bf466)

    lib-dcrypt: Added unit tests to nonblocking istream-decrypt


M	src/lib-dcrypt/test-stream.c

2016-08-04 21:38:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b0f2d21)

    lib-dcrypt: test-stream writes now to buffer, not to temp-iostream

    This simplifies the following change.

M	src/lib-dcrypt/test-stream.c

2016-08-04 21:29:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (156b151)

    lib-dcrypt: Support nonblocking istreams.


M	src/lib-dcrypt/istream-decrypt.c

2016-08-04 19:45:35 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (b460aae)

    lib-dcrypt: add 0 to 400 byte stream test

    Remove 8 byte speacial case also.

M	src/lib-dcrypt/test-stream.c

2016-08-04 18:35:53 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (6d03998)

    lib-dcrypt: error message on missing decrypt key or password

    Return a sensible error message when loading an encrypted private key is 
    attempted but the decrypt key or password is missing.

M	src/lib-dcrypt/dcrypt-openssl.c

2016-08-04 17:11:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (41a9b7a)

    lib-http: Support per-request timeout and max_attempts


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2016-08-02 23:25:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (588a9f8)

    director: Throttle user move/kill failure errors after 100/sec.

    If it happened to a lot of users, they can take a lot of space in logs.

M	src/director/director.c
M	src/director/director.h
M	src/director/main.c

2016-08-02 23:14:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (652f72b)

    lib: Added log throttling API.


M	src/lib/Makefile.am
A	src/lib/log-throttle.c
A	src/lib/log-throttle.h
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-log-throttle.c

2016-08-04 17:39:02 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (624e356)

    lib-dcrypt: don't give strstr NULL in test-crypto


M	src/lib-dcrypt/test-crypto.c

2016-07-15 09:53:12 +0200 x16a0 <m.k-92@gmx.de> (02d7058)

    Fixed searching multiple mailboxes

    When searching multiple mailboxes, a condition to search these mailboxes is
    added to the query string. However, this condition has to be separated from
    the preceding condition by a space (a '+' in this case, as it's encoded);
    otherwise, Solr considers it to be part of the previous condition, in which
    case it will fail to parse it properly. Therefore, this patch adds that one
    missing character so it works again.

M	src/plugins/fts-solr/fts-backend-solr.c

2016-08-04 22:15:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3ddf19c)

    lib-dcrypt: Fixed test-stream unit test not to leak memory

    Broken by previous change.

M	src/lib-dcrypt/test-stream.c

2016-08-04 21:51:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (15e175c)

    lib-auth: Unescape passdb/userdb extra fields.

    This only affected \001, \t, \r and \n characters which were left 
    tab-escaped (e.g. \t as "\001t").

M	src/lib-auth/auth-master.c

2016-08-04 20:21:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (089b8ee)

    istream-decrypt: Fix error handling in stream header


M	src/lib-dcrypt/istream-decrypt.c

2016-08-04 19:39:56 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (baf8f0a)

    lib-dcrypt: Skip checks if no backend found


M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2016-08-02 22:31:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e26dc88)

    director: Added more debug information to "Ping timed out" error


M	src/director/director-connection.c

2016-08-04 12:57:58 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (3f07c94)

    lib-dcrypt: drop format from key_load_public


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt-private.h
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/dcrypt.h
M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2016-08-04 12:52:20 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (45cc36e)

    lib-dcrypt: drop format from key_load_private


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt-private.h
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/dcrypt.h
M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2016-08-04 12:19:05 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (b55e127)

    lib-dcrypt: get_info in openssl_load_private_key

    Use dcrypt_openssl_key_string_get_info to determine the key format instead
    of taking it as a parameter.

M	src/lib-dcrypt/dcrypt-openssl.c

2016-08-04 10:54:20 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (791f275)

    lib-dcrypt: get_info in openssl_load_public_key

    Use dcrypt_openssl_key_string_get_info to determine the key format instead
    of taking it as a parameter.

M	src/lib-dcrypt/dcrypt-openssl.c

2016-08-03 17:55:15 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (5bc9fcc)

    lib-dcrypt: change v2 key field separator to ':'


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/test-crypto.c

2016-08-04 15:57:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (de9c240)

    lib-dcrypt: Do not unref key twice


M	src/lib-dcrypt/dcrypt-openssl.c

2016-08-03 10:14:35 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (60ead27)

    lib-dcrypt: Handle short reads in header correctly


M	src/lib-dcrypt/istream-decrypt.c

2016-07-25 14:04:47 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (99bc07e)

    lib-dcrypt: add crashing 8 byte garbage read test


M	src/lib-dcrypt/test-stream.c

2016-07-15 16:31:01 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (89a8f5d)

    dcrypt: Update API for testing


M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2016-07-15 16:30:51 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (612d324)

    dcrypt-iostream: Ref/unref keys


M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/ostream-encrypt.c

2016-07-15 16:27:03 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (863ce61)

    dcrypt: Use refcounting on keys


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt-private.h
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/dcrypt.h

2016-08-04 08:55:12 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (284a77b)

    last-login: Add error handling for commit


M	src/plugins/last-login/last-login-plugin.c

2016-08-03 13:18:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5d5553d)

    lib-index: Fixed debug logging.


M	src/lib-index/mail-cache-lookup.c

2016-07-29 01:02:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (48d503d)

    lib-index: If mail_debug=yes, log cache compressions.


M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-index.h
M	src/lib-storage/index/index-storage.c

2016-07-25 14:20:05 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (3224dae)

    Use mail_get_*stream_because() wherever possible.


M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-copy.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/pop3/pop3-commands.c

2016-07-29 00:37:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d4aec67)

    lib-index: Added mail_cache_get_missing_reason()


M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache.h

2016-07-25 14:16:39 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (8deeb07)

    lib-storage: Added mail_get_stream_because() and
    mail_get_hdr_stream_because()

    With mail_debug=yes each mail access is now logged with a reason. This can 
    be helpful when figuring out why something isn't in dovecot.index.cache.

M	src/lib-storage/index/index-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c

2016-08-02 21:16:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b5c1836)

    doveadm proxy kick: Fixed output message.


M	src/doveadm/doveadm-proxy.c

2016-08-02 21:10:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (92d780b)

    lib-lda: Support %{storage_id} in deliver_log_format


M	src/lib-lda/mail-deliver.c

2016-08-02 21:09:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (73ebd9d)

    lib-lda: Code cleanup - move code to mail_deliver_open_mail()

    No functional changes. On its own this is a rather useless cleanup, but 
    simplifies the next patch.

M	src/lib-lda/mail-deliver.c

2016-08-02 20:09:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (79f0c30)

    imap: When un-hibernating, send notification to imap-hibernate process
    earlier.

    The initialization shouldn't take a long time, but there's really no need to 
    keep imap-hibernate itself waiting (and maybe timing out) if it does.

M	src/imap/imap-master-client.c

2016-08-02 20:03:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6df3a72)

    imap-hibernate: If un-hibernation failed due to timeout, log whether we saw
    version line.

    Could help with debugging.

M	src/imap-hibernate/imap-master-connection.c

2016-07-19 10:16:17 -0600 Timo Sirainen <timo.sirainen@dovecot.fi> (0e6c2c0)

    imap-hibernate: If imap-master socket is busy, retry un-hibernation later.


M	src/imap-hibernate/imap-client.c
M	src/imap-hibernate/imap-client.h
M	src/imap-hibernate/imap-master-connection.c
M	src/imap-hibernate/imap-master-connection.h
M	src/imap-hibernate/main.c

2016-08-02 13:41:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e16245a)

    lib: var_has_key() properly ignores key=='\0' now.


M	src/lib/test-var-expand.c
M	src/lib/var-expand.c
M	src/lib/var-expand.h

2016-08-02 13:38:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (55b26ae)

    lib: var_get_key() didn't handle %{long_variables} correctly

    This also fixes var_has_key()'s long_key handling.

M	src/lib/test-var-expand.c
M	src/lib/var-expand.c
M	src/lib/var-expand.h

2016-08-02 01:04:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (413e0d9)

    --without-shared-libs was linking libdovecot.so to mail binaries.

    Broken by e42dd7149.

M	src/lib-storage/Makefile.am

2016-07-23 12:02:29 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (06c2217)

    lib-fs: Added fs_get_nlinks()

    Although fs_stat() could return this, its caller can't indicate whether it
    actually wants the link count. Usually fs_stat() is used only to get the
    file's size. In some backends it's not cheap to get the link count, so
    adding this function allows the caller to explicitly ask for it.

M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-dict.c
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-test.c
M	src/lib-fs/fs-wrapper.c
M	src/lib-fs/fs-wrapper.h
M	src/plugins/fs-compress/fs-compress.c

2016-07-25 17:41:36 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (66417aa)

    dict-client: Don't keep a request timeout when there are only background
    commands.


M	src/lib-dict/dict-client.c

2016-07-25 17:32:11 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (b1b1b92)

    dict-client: When we get disconnected, reconnect and re-send commands.


M	src/lib-dict/dict-client.c

2016-07-25 17:08:18 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (c1a4bc4)

    dict-client: Improved timeout error message


M	src/lib-dict/dict-client.c

2016-08-02 01:02:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9f48846)

    dict-client: Fixed hang in async iteration if it failed.


M	src/lib-dict/dict-client.c

2016-08-01 22:18:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7730456)

    quota: Log an error if mail's size can't be read.

    We were still logging "Internal quota calculation error" but not necessarily 
    any other reason.

M	src/plugins/quota/quota.c

2016-07-29 00:59:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b3a52b0)

    lib-storage: mbox_min_index_size setting didn't work correctly.


M	src/lib-storage/index/index-storage.c

2016-07-28 21:15:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2103e21)

    lib-storage: Don't crash fetching body.snippet when multipart/alternative
    part has no Content-Type


M	src/lib-storage/index/index-mail.c

2016-07-26 13:53:56 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (b4156be)

    auth: Fixed caching to support %{passdb} and %{userdb}


M	src/auth/auth-cache.c
M	src/auth/test-auth-cache.c

2016-07-26 13:52:44 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (0a21a4e)

    auth: Set userdb_lookup flag correctly for blocking userdb lookups.

    This caused at least userdb-related logging to log the passdb instead.

M	src/auth/auth-worker-client.c

2016-07-26 13:52:20 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (759da60)

    auth: Code cleanup - use const for struct auth_request.


M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request-var-expand.h

2016-07-25 14:09:38 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (780a61a)

    lazy-expunge: If lazy-expunge transaction failed already, stop further
    expunges.

    Most importantly if the lazy-expunge mailbox opening fails, we don't now 
    retry opening the mailbox for each expunged mail.

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-07-24 18:26:50 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (6d941a2)

    lib: Potential compiling fix.

    STATIC_ARRAY apparently requires that the parameter is named in some gcc 
    versions? In any case doesn't hurt.

M	src/lib/sha1.h

2016-07-13 09:46:08 +0200 Stephan Bosch <stephan@dovecot.fi> (b4796b3)

    Calling i_stream_next_line() on a chain stream would sometimes erroneously
    use the stream->w_buffer.

    It used the wrong check to assess whether the w_buffer is usable. The chain
    stream only uses the w_buffer when partial stream data needs to be merged.
    Otherwise, a parent stream's buffer is used directly. However, this does not
    mean that w_buffer will be NULL in that case, which is what
    i_stream_next_line() assumed.

M	src/lib/istream.c

2016-07-11 20:27:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fdb1b59)

    lib-dcrypt: Allow flushing ostream multiple times.

    The first time flushes the encryption and the following times just flush the 
    parent stream.

M	src/lib-dcrypt/ostream-encrypt.c

2016-07-11 20:27:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e3bdc11)

    lib-dcrypt: Improved error message when istream isn't encrypted.


M	src/lib-dcrypt/istream-decrypt.c

2016-07-19 18:28:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d81a83b)

    master: Don't leak master socket to child processes.


M	src/master/service-listen.c

2016-07-17 13:51:05 -0600 Timo Sirainen <timo.sirainen@dovecot.fi> (349c58a)

    fts: Fixed fts_autoindex when no fts_autoindex_exclude settings existed.


M	src/plugins/fts/fts-storage.c

2016-07-16 11:30:39 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (9517760)

    lib-dict: Added DICT_COMMIT_RET_WRITE_UNCERTAIN


M	src/dict/dict-commands.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-client.h
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.h

2016-07-17 12:37:06 -0600 Timo Sirainen <timo.sirainen@dovecot.fi> (88e9042)

    cassandra: Support commit2 API


M	src/lib-sql/driver-cassandra.c

2016-07-17 12:33:41 -0600 Timo Sirainen <timo.sirainen@dovecot.fi> (766680f)

    lib-sql: Added sql_transaction_commit2()

    In v2.3 the sql_transaction_commit() API was just modified, but for now 
    we'll add this _commit2() to preserve API compatibility.

M	src/lib-sql/driver-cassandra.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api-private.h
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-api.h

2016-07-15 16:40:31 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (6e7d98b)

    cassandra: Support returning SQL_RESULT_ERROR_TYPE_WRITE_UNCERTAIN


M	src/lib-sql/driver-cassandra.c

2016-07-15 16:40:05 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (a91fc8e)

    lib-sql: Added sql_result_get_error_type().

    For now the only special error type is
    SQL_RESULT_ERROR_TYPE_WRITE_UNCERTAIN.

M	src/lib-sql/sql-api-private.h
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-api.h

2016-07-14 16:16:52 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (9dc6403)

    dict: Fixed crash on iteration handling.


M	src/dict/dict-commands.c

2016-07-14 07:22:04 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (3f18da0)

    dict-client: Improved logging for slow queries.

    Especially commits now say what the first query within the commit was.

M	src/lib-dict/dict-client.c

2016-07-14 06:53:54 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (58fd3cd)

    doveadm fetch: Fixed body.snippet.


M	src/doveadm/doveadm-mail-fetch.c

2016-07-13 15:10:57 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (c294b67)

    dbox: Initialize pop3-uidl header on INBOX creation.

    This way we don't add any UIDLs to dovecot.index.cache on the first POP3 
    UIDL access. We'll assume that pop3-uidl header is updated whenever any 
    backend UIDLs are added, which should happen nowadays.

M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c

2016-07-13 14:07:02 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (12f9b06)

    lib-storage: Initialize pop3-uidl header also when no backend UIDLs exist.

    The first time POP3 UIDL command is used, set the header even when there are 
    no backend UIDLs to prevent any further UIDL caching.

M	src/lib-storage/index/index-pop3-uidl.c

2016-07-11 14:56:41 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c14ec39)

    auth: Fail request if last passdb is noauthenticate


M	src/auth/auth-request.c

2016-07-11 14:56:25 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (319773b)

    gssapi: Add missing PASSDB_RESULT_NEXT clause


M	src/auth/mech-gssapi.c

2016-07-11 16:13:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7615356)

    lib-fs: Added fs_metadata_init_or_clear() helper


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2016-07-11 14:18:36 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e1a3bc1)

    passdb: Skip credentials handling for noauthenticate


M	src/auth/passdb.c

2016-07-11 11:28:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3afcdd2)

    lib-storage: Fixed crash on subscription listing if subscription refresh
    fails.


M	src/lib-storage/list/mailbox-list-iter.c

2016-07-09 20:11:45 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (cd1786b)

    auth: Skip authentication with noauthenticate


M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-worker-client.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-sql.c
M	src/auth/passdb.h

2016-07-11 11:55:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (baf1d37)

    mdbox: Fixed crash when saving POP3 UIDLs to a non-empty mailbox.

    Fixes assert:

    Panic: file mdbox-save.c: line 337: unreached

M	src/lib-storage/index/dbox-multi/mdbox-save.c

2016-07-11 11:40:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (758d119)

    pop3c: Fixed crash in syncing when local indexes existed but UIDL wasn't
    cached.


M	src/lib-storage/index/pop3c/pop3c-sync.c

2016-07-11 10:22:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (174ed0d)

    lmtp: Don't send double-DISCONNECT to anvil.

    Happened with lmtp_user_concurrency_limit > 0. Fixes errors like:

    Error: connect limit: disconnection for unknown pid 123 + ident
    lmtp/username

M	src/lmtp/commands.c

2016-07-06 23:41:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (efac003)

    Compiler warning fix


M	src/doveadm/doveadm-zlib.c

2016-07-05 18:15:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (965a025)

    fs-sis*: Use fs_wrapper_*() wherever possible


M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2016-07-05 18:12:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b496de0)

    fs-sis*: Minor error handling function cleanups.

    We don't really need to go to the parent fs, so just use what is easiest.

M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2016-07-05 18:03:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7da5f38)

    fs-sis*: Removed unnecessary error copying.

    It was probably needed in the beginning, but nowadays the parent-most fs 
    keeps the error. There's no need to copy it around.

M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2016-07-05 17:59:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2f97ab5)

    fs-metawrap: Use fs_wrapper_*() wherever possible


M	src/lib-fs/fs-metawrap.c

2016-07-05 17:55:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fad8a52)

    fs-compress: Use fs_wrapper_*() wherever possible


M	src/plugins/fs-compress/fs-compress.c

2016-07-05 17:52:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (485061c)

    lib-fs: Implement all lib-fs functions as wrappers to parent stream.


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-api-private.h
A	src/lib-fs/fs-wrapper.c
A	src/lib-fs/fs-wrapper.h

2016-07-06 13:15:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6bdee9c)

    lib-dcrypt: istream-decrypt now differentiates between temporary errors and
    corruption.


M	src/lib-dcrypt/istream-decrypt.c

2016-07-06 13:11:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e16a00a)

    lib-dcrypt: Set stream_errno on istream-decrypt read failures.

    Fixes assert-crashes that would happen otherwise.

M	src/lib-dcrypt/istream-decrypt.c

2016-07-06 13:31:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d374ad0)

    lib: Updated istream's stream_errno comments.


M	src/lib/istream.h

2016-07-06 13:24:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d49e6f5)

    lib-compression: istream-zlib/lzma now differentiates between temporary
    errors and corruption.


M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c

2016-07-05 20:58:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8e8aca6)

    lib-storage: Clarify that mail_namespace_find_inbox() never returns NULL.

    If namespaces==NULL, this function isn't even supposed to be called.

M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h

2016-07-05 14:41:41 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (833b6a1)

    passdb-static: Support password scheme

    This allows password argument to provide scheme instead of defaulting to
    plain. If no scheme is provided, plain is defaulted.

M	src/auth/passdb-static.c

2016-07-04 11:57:43 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (6d2fa6b)

    lib-dcrypt: tell in error_r that RSA key has to be converted to pkey


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/test-crypto.c

2016-07-04 18:25:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (4c16747)

    doveadm-pw: Use debug value when loading modules


M	src/doveadm/doveadm-pw.c

2016-07-04 18:24:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (2fbaab1)

    dcrypt: Fix linkage into libdovecot.so


M	configure.ac
M	src/lib-dcrypt/Makefile.am

2016-07-04 15:05:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (eb56627)

    master: Add master socket's io listener later.

    Most importantly this fixes startup failure with kqueue:

    Panic: kevent(EV_ADD, READ, 56) failed: Bad file descriptor

    kqueue doesn't survive a fork(), so this change delays its creation until 
    after fork().

M	src/master/service-listen.c
M	src/master/service-monitor.c

2016-07-04 14:44:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (51121ee)

    master: Make sure stdout isn't closed on startup failures.

    closing master_fd might have tried to close(0) since it wasn't initialized 
    to -1.

M	src/master/service.c

2016-07-04 09:37:33 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ac0b7e9)

    configure: Add m4 and aux dir to configure


M	Makefile.am
M	configure.ac
A	m4/.gitkeep

2016-07-04 09:30:13 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d9c865c)

    configure: Fix static array check


M	configure.ac

2016-07-04 09:21:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (20e802d)

    dcrypt: Optional if no ECC support


M	configure.ac
M	src/Makefile.am

2016-07-01 17:42:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (943b057)

    dict-client: Attempt to connect to dict socket for 1 second before failing.


M	src/lib-dict/dict-client.c

2016-07-01 15:13:55 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8f25439)

    man: Provide usage for doveadm mailbox update


M	doc/man/doveadm-mailbox.1.in

2016-07-01 01:14:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (93fa374)

    lib-dcrypt: Removed dead code.


M	src/lib-dcrypt/ostream-encrypt.c

2016-07-01 12:23:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (804d4d3)

    lib-storage: Fixed mailbox_delete_empty() error message when mails exist


M	src/lib-storage/index/index-storage.c

2016-07-01 16:37:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4f6d918)

    lib-http: Clarify response message when retries have happened.

    "1 attempts" sounds like 1 attempt in total, while this was actually the 
    second attempt.

M	src/lib-http/http-client-request.c

2016-07-01 16:36:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (765b9a4)

    dict-client: Make sure query's start_time is up-to-date.


M	src/lib-dict/dict-client.c

2016-07-01 16:34:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e0b20ce)

    dict-client: Don't log slow background async commit/iteration replies.

    If a caller has already finished iteration, or does async commit without a 
    callback, it means that it started the query without caring when it 
    finishes. The caller may already have been doing blocking work while waiting
    for the dict reply. We don't want to log a warning, because it could be
    completely wrong.

M	src/lib-dict/dict-client.c

2016-07-01 16:31:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0597f83)

    cassandra: Added debug_queries connect setting.

    This logs all the queries and how long they took, without having to log all 
    the other Cassandra library debug messages.

M	src/lib-sql/driver-cassandra.c

2016-07-01 16:31:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ae79144)

    cassandra: If query fails, include how long the reply took in the error
    message.


M	src/lib-sql/driver-cassandra.c

2016-07-01 16:30:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (971d8e9)

    cassandra: Warn if queries take too long (default 5 secs)

    Can be changed with e.g. "connect = ... warn_timeout=30s"

M	src/lib-sql/driver-cassandra.c

2016-07-01 16:27:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d1b137b)

    LAYOUT=index: Make sure error is preserved if created mailbox can't be added
    to list index.

    mailbox_delete() could overwrite the error.

M	src/lib-storage/list/mailbox-list-index-backend.c

2016-07-01 11:56:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7c40beb)

    dict-client: When skipping connect() due to earlier failure, preserve the
    original error.


M	src/lib-dict/dict-client.c

2016-07-01 11:41:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7a7a88b)

    dict-client: If commit fails to send BEGIN, don't try sending anything else.

    Fixes memory leak and also fixes overwriting the original error message.

M	src/lib-dict/dict-client.c

2016-07-01 11:12:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (74bb40a)

    lib-storage: Autoexpunging should ignore nonexistent mailboxes.

    The check was done too late after recent changes.

M	src/lib-storage/mail-autoexpunge.c

2016-07-01 11:07:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9b351a5)

    doveadm mailbox update: Avoid assert-crash on errors.


M	src/doveadm/doveadm-mail-mailbox.c

2016-07-01 02:49:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9ef42e2)

    login-proxy: cork+uncork in flush callbacks

    Potentially reduces latency at the end of a larger data transfer.

M	src/login-common/login-proxy.c

2016-07-01 01:11:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4de7ae7)

    configure: Check if C99 "static" keyword is supported for array sizes.


M	configure.ac
M	src/lib/macros.h

2016-06-30 22:35:59 +0200 Stephan Bosch <stephan@rename-it.nl> (d844a88)

    lib-http: client: Fixed potential segfault problem in
    http_client_connection_server_close().

    Used wrong variable: it is set to NULL by http_client_request_unref() before
    it is used. Problem found by Coverity.

M	src/lib-http/http-client-connection.c

2016-06-30 18:13:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (87e9855)

    lib-dcrypt: Compiling fix


M	src/lib-dcrypt/dcrypt.c

2016-06-30 16:21:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7934f37)

    imap: Fixed reading LDA settings from config.


M	src/imap/imap-settings.c

2016-06-30 14:08:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3fea4d5)

    master: Stopping didn't close dead-pipes early enough.

    This caused stopping to be too slow. Broken by 0153cf542.

M	src/master/service-monitor.c

2016-06-30 12:10:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ab65ab6)

    lmtp: Removed assert, which triggers if anvil connect fails.


M	src/lmtp/commands.c

2016-06-30 12:08:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (758df8f)

    lmtp: Fixed pipelining of commands after RCPT TO

    We should stop while waiting for anvil reply. Broken by ced943b0a.

M	src/lmtp/commands.c

2016-06-30 11:57:19 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (45bdb33)

    auth-request: Whitespace fix


M	src/auth/auth-request.c

2016-06-30 10:03:18 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (52343c7)

    auth-request: Correctly allocate mech_password and credentials_scheme


M	src/auth/auth-request.c

2016-06-30 09:29:26 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b65a492)

    dcrypt: Free keys in test-stream


M	src/lib-dcrypt/test-stream.c

2016-06-30 09:06:51 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (7875fb9)

    dcrypt: Add tests for 0 and 1 byte data


M	src/lib-dcrypt/test-stream.c

2016-06-30 09:06:33 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c716578)

    dcrypt: Fix bugs in 0 and 1 byte payload files


M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/ostream-encrypt.c

2016-06-30 01:27:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c9f9b0c)

    lib-ssl-iostream: Compiler fix to previous commit


M	src/lib-ssl-iostream/dovecot-openssl-common.c

2016-06-30 01:15:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bb2aa71)

    lib-ssl-iostream: Disable "CRYPTO_set_mem_functions() was called too late"
    for now

    It always happens at least with Ubuntu 16.04.

M	src/lib-ssl-iostream/dovecot-openssl-common.c

2016-06-29 23:56:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fc05ac2)

    auth: delay_until can optionally now have +<max random secs> suffix.


M	src/auth/auth-request.c

2016-06-29 23:54:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (82f1dbb)

    auth: Fixed checking if delay_until is too large


M	src/auth/auth-request.c

2016-06-29 22:29:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7be1766)

    dsync: When full resync is wanted in a stateful sync, output empty state.

    This continues 3d49dc64d, which didn't actually work because 
    brain->require_full_resync was either cleared earlier or it was never even
    set in this brain.

M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-private.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-ibc.h

2016-06-29 21:09:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (06aeecf)

    doveadm: Read settings with service=doveadm

    This was done for mail commands while initializing the mail user, but other
    commands weren't using it. This meant that doveadm was using only global
    settings instead of protocol doveadm { .. } settings for everything except
    mail commands.

M	src/doveadm/doveadm.c
M	src/doveadm/main.c

2016-06-29 20:44:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (47441da)

    doveadm user: Avoid potential crashes when running via doveadm-server


M	src/doveadm/doveadm-auth-server.c

2016-06-29 22:11:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8051312)

    lib: iostream-temp: Fixed o_stream_send_istream() with >2GB files


M	src/lib/iostream-temp.c

2016-06-29 19:22:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (923ed58)

    dict-sql: Treat NULL value the same as "key not found"


M	src/lib-dict/dict-sql.c

2016-06-28 23:12:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c32f2e2)

    doveadm: Added "service stop" command to stop specific services.


M	src/doveadm/Makefile.am
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
A	src/doveadm/doveadm-service.c

2016-06-26 23:04:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e296bf5)

    master: Allow stopping specific services via master socket.


M	src/master/Makefile.am
M	src/master/main.c
A	src/master/master-client.c
A	src/master/master-client.h
M	src/master/service-listen.c
M	src/master/service-monitor.c
M	src/master/service.h

2016-06-28 23:38:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (976683c)

    master: Added service_monitor_stop_close() to stops service and close its
    listeners.


M	src/master/service-monitor.c
M	src/master/service-monitor.h

2016-06-28 23:38:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fde7b8a)

    master: Added support for stopping specific services.

    We need to have a per-service fd for detecting a dead master.

M	src/master/service-monitor.c
M	src/master/service-process.c
M	src/master/service.c
M	src/master/service.h

2016-06-29 19:12:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (127b836)

    lib-storage: Fixed search arg initialization tracking for INTHREAD


M	src/lib-storage/mail-search.c

2016-06-29 18:49:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6b1428f)

    virtual: Fixed error handling when matching mailboxes by metadata.


M	src/plugins/virtual/virtual-config.c

2016-06-29 18:34:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (390d6d5)

    maildir: Improved "Filename keeps changing" error handling/logging


M	src/lib-storage/index/maildir/maildir-util.c

2016-06-29 18:33:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (26e22ea)

    maildir: Code comment update


M	src/lib-storage/index/maildir/maildir-sync.c

2016-06-29 18:31:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0649b7a)

    maildir: Fixed updating filenames in existing uidlist

    Broken by 042668c0c.

    This could have caused errors like:

     - maildir_file_do(...): Filename keeps changing
    - Expunged message reappeared, giving a new UID

M	src/lib-storage/index/maildir/maildir-uidlist.c

2016-06-03 17:30:58 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3626987)

    doveadm-server: Do not crash if empty data in authorization


M	src/doveadm/client-connection-http.c

2016-05-31 22:22:37 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (418280f)

    doveadm: Implement user and auth cache flush to server


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-auth-server.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm.c
M	src/doveadm/main.c

2016-06-04 08:14:45 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d536790)

    doveadm-server: Skip doveadm_print_init

    Some commands need to do output that is not doable with doveadm_print, so we
    need to have a flag to indicate this.

M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-cmd.h

2016-06-29 16:34:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (20a3cd1)

    lmtp: If anvil lookup fails, ignore lmtp_user_concurrency_limit

    Previously it was randomly allowing or disallowing the client.

M	src/lmtp/commands.c

2016-06-29 15:25:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7e75c14)

    auth: Added delay_until passdb extra field.


M	src/auth/auth-request.c
M	src/auth/auth-request.h

2016-06-29 16:01:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7dbddb3)

    auth: Fixed plaintext authentication when auth policy was already processed.

    Broken by e82511362.

M	src/auth/auth-request.c

2016-06-29 15:49:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0f8880f)

    lib-fts: Added maxlen parameter to icu-normalizer.

    This is needed because the normalization can increase the token's length.

M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter.h
M	src/lib-fts/test-fts-filter.c

2016-06-28 22:20:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (df0e630)

    auth: Added ":remove" suffix for passdb/userdb extra fields to remove
    fields.


M	src/auth/auth-request.c

2016-06-29 14:09:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f36ac99)

    lmtp: Increase user's concurrency limit already after RCPT TO.

    This way it's not possible for a lot of mails to arrive to user concurrently 
    and bypass the lmtp_user_concurrency_limit.

M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2016-06-29 14:07:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2722e8d)

    lmtp: If user has rached lmtp_user_concurrency_limit, fail at RCPT TO stage.

    Otherwise LMTP client would have to send the entire email body before 
    getting the failure.

M	src/lmtp/client.h
M	src/lmtp/commands.c

2016-06-20 14:43:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dbad2ad)

    lib-storage: Fixed MAILBOX_METADATA_FIRST_SAVE_DATE with
    mailbox_list_index=no

    This also meant that autoexpunging wasn't working then.

M	src/lib-storage/index/index-status.c

2016-06-29 14:55:12 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (5659f5e)

    auth-policy: Do not do policy checks every time


M	src/auth/auth-request.c

2016-06-29 14:43:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3031ddf)

    auth: Finish policy.[ch] renaming..


M	src/auth/Makefile.am
M	src/auth/auth-policy.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/main.c

2016-06-29 14:31:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8ce4a3a)

    auth: Avoid nonstandard #pragma once


M	src/auth/auth-policy.h

2016-06-29 14:30:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e041c2d)

    auth: Rename policy.[ch] to auth-policy.[ch]


R100	src/auth/policy.c	src/auth/auth-policy.c
R100	src/auth/policy.h	src/auth/auth-policy.h

2016-06-28 13:24:09 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (3dba616)

    lib-dcrypt: correctly set version 2 on key info

    Dovecot format version 2 keys were incorrectly reported as version 1 before.

M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/test-crypto.c

2016-06-29 14:16:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5f8a6be)

    lib-index: Fixed view syncing when changes couldn't be read from transaction
    logs

    Fixes errors like:

    Log synchronization error at seq=0,offset=0 for .../dovecot.index: Append
    with UID 5, but next_uid = 6
    .../dovecot.index view syncing failed to apply changes

M	src/lib-index/mail-index-view-sync.c

2016-06-29 14:12:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3b28618)

    auth-policy: Do not allow/report when master query

    This way auth policy isn't consulted when e.g. doveadm is used.

M	src/auth/policy.c

2016-06-29 13:52:09 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (223cfcf)

    auth-policy: Report success earlier


M	src/auth/auth-request-handler.c

2016-06-29 00:37:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (be2be31)

    configure: Detect SSL_COMP_free_compression_methods() by linking

    Fixes using libressl.

M	configure.ac
M	src/lib-ssl-iostream/dovecot-openssl-common.c

2016-06-28 22:01:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e1295b9)

    lib: Added assert to iostream-temp

    Input stream isn't expected to shrink here. Potentially this could be 
    changed to an error instead.

M	src/lib/iostream-temp.c

2016-06-28 19:45:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5157c3c)

    lazy-expunge: Fixed crash when copying from internal namespace

    Most importantly fixes crash in LDA.

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-06-28 10:25:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2c8e5ee)

    dict-ldap: Fixed linking with OSX


M	src/plugins/dict-ldap/Makefile.am

2016-06-28 10:15:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (80b88a6)

    auth: Compiler warning fixes


M	src/auth/policy.c

2016-06-03 21:35:48 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (084bdd0)

    auth-policy: Hook auth policy to auth code


M	src/auth/auth-request-handler.c
M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request-var-expand.h
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/main.c

2016-06-03 20:21:42 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (5bbf561)

    auth-policy: Add policy implementation


M	src/auth/Makefile.am
M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request-var-expand.h
M	src/auth/auth-request.h
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
A	src/auth/policy.c
A	src/auth/policy.h
M	src/config/settings-get.pl

2016-06-10 14:31:00 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (8edd430)

    fts plugin: Added fts_autoindex_exclude settings.

    fts_autoindex_exclude setting specifies special-use flag or mailbox name to 
    be excluded.

     - If a name starts with '\', it's treated as a case-insensitive special-use 
    flag.

     - Multiple names can be specified with serial numbers, for example:

      plugin {
       fts_autoindex_exclude = \Junk
       fts_autoindex_exclude2 = \Trash
       fts_autoindex_exclude3 = DUMPSTER
       fts_autoindex_exclude4 = New folder
     }

M	src/plugins/fts/fts-storage.c

2016-06-27 16:37:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3412a5b)

    lib-dcrypt: Make static analyzer happier


M	src/lib-dcrypt/test-crypto.c

2016-06-27 14:43:58 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (714e632)

    dcrypt: Add tests for v1 and v2 public keys and RSA


M	src/lib-dcrypt/test-crypto.c

2016-06-27 14:43:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (eddbff8)

    dcrypt-openssl: Various fixes

    Fix v1 and v2 key handling and some allocation issues.

M	src/lib-dcrypt/dcrypt-openssl.c

2016-06-27 14:13:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e91e993)

    lib-dcrypt: Added sample-v1_short.asc to EXTRA_DIST


M	src/lib-dcrypt/Makefile.am

2016-06-27 13:21:05 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e0d192f)

    istream-decrypt: Ensure we can open short v1 files


A	src/lib-dcrypt/sample-v1_short.asc
M	src/lib-dcrypt/test-stream.c

2016-06-27 13:19:35 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (9491509)

    istream-decrypt: Correctly check the header length for v1


M	src/lib-dcrypt/istream-decrypt.c

2016-06-24 12:14:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3e85269)

    last-login: Ignore the plugin if last_login_dict setting is empty


M	src/plugins/last-login/last-login-plugin.c

2016-06-23 18:04:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (60d99d0)

    lib-ssl-iostream: Use ENGINE_set_default()


M	src/lib-ssl-iostream/dovecot-openssl-common.c

2016-06-23 17:21:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (90d2a4a)

    lazy_expunge: Optimize checking for last instance when moving a mail.

    It's never the last instance, so we don't need to even check it.

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-06-22 01:24:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (39b4214)

    fts-lucene: Fixed crash on error or auto-rebuild conditions.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2016-06-21 22:08:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (064fe96)

    welcome plugin: -Wstrict-bool warning fix


M	src/plugins/welcome/welcome-plugin.c

2016-06-21 21:26:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f194f5c)

    LAYOUT=index: Existence or GUID lookups don't need to refresh mailboxes.


M	src/lib-storage/list/mailbox-list-index-status.c

2016-06-21 21:39:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7ffa592)

    lib-storage: Added a kludgy quick-"parameter" to list_index_has_changed()


M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/mail-storage-private.h

2016-06-21 21:06:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cc9df11)

    LAYOUT=index: Avoid unnecessary work for setting \Marked flags in LIST
    reply.

    If MAILBOX_LIST_ITER_RETURN_NO_FLAGS is set, the caller doesn't care about 
    the flags.

M	src/lib-storage/list/mailbox-list-index-iter.c

2016-06-20 11:33:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e9ff071)

    lib-dcrypt: dcrypt_keypair_generate() no longer assumes pair_r to be
    initialized.

    It wasn't clear that it should have been zeroed. It also likely isn't very 
    useful to be able to place the generated key to existing keys.

M	src/lib-dcrypt/dcrypt.c

2016-06-19 22:27:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7caacde)

    lib-dcrypt: Check for all the return values in unit tests


M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2016-06-19 22:21:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (15648d9)

    lib-dcrypt: Added missing error handling.

    Most of these are probably unnecessary now that malloc() no longer fails. 
    Also some of the NULL checks may not be needed since OpenSSL functions
    (usually?) return failure on NULL parameters, but sometimes they perform a
    different operation. So overall, probably safer to include these checks.

M	src/lib-dcrypt/dcrypt-openssl.c

2016-06-19 22:18:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c39dd40)

    lib-dcrypt: Don't ignore BIO errors.

    Might happen due to out of memory?

M	src/lib-dcrypt/dcrypt-openssl.c

2016-06-19 21:21:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0e8ca25)

    lib-dcrypt: dcrypt_key_type_public/private() can no longer fail.

    Removed unnecessary failure handling.

M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt-private.h
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/dcrypt.h
M	src/lib-dcrypt/ostream-encrypt.c

2016-06-19 21:20:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (92b22c9)

    lib-dcrypt: dcrypt_key_convert_private_to_public() can no longer fail.

    Removed unnecessary failure handling.

M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt-private.h
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/dcrypt.h
M	src/lib-dcrypt/test-crypto.c

2016-06-19 20:55:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (49046dc)

    lib-dcrypt: Assert-crash if key parameter is NULL.

    If it happens, it's a bug.

M	src/lib-dcrypt/dcrypt-openssl.c

2016-06-19 20:48:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (83c5005)

    lib-dcrypt: Assert-crash if impossible private/public keys are seen.


M	src/lib-dcrypt/dcrypt-openssl.c

2016-06-21 18:47:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cb21fec)

    doveadm fs delete: Allow multiple paths also with -R parameter.


M	src/doveadm/doveadm-fs.c

2016-06-21 18:30:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dc9e4ab)

    doveadm: Fixed --long-parameters handling


M	src/doveadm/doveadm-cmd.c

2016-06-20 20:06:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (15730f8)

    dbox: Optimize POP3 MAIL_FETCH_UIDL_BACKEND.

    We keep track of the highest UID known to have POP3 UIDL in index's header. 
    If saving adds a newer message, it'll also update the header. When fetching 
    UIDL_BACKEND, we can need to check only mails with lower UIDs. There are 
    some race conditions here, but normally UIDLs are set only once during 
    migration so it shouldn't matter.

M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-save.h
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
A	src/lib-storage/index/index-pop3-uidl.c
A	src/lib-storage/index/index-pop3-uidl.h
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage-private.h

2016-06-20 11:39:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (525ddf5)

    Added welcome plugin.


M	configure.ac
M	src/plugins/Makefile.am
A	src/plugins/welcome/Makefile.am
A	src/plugins/welcome/welcome-plugin.c

2016-06-21 15:11:04 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (4559dcf)

    doc: fix wrong tense in doveadm-expunge man page


M	doc/man/doveadm-expunge.1.in

2016-06-21 17:26:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (07a1f7b)

    fs-posix: Allow ":" as well as space as parameter separator.

    This makes it consistent with all the other fs drivers.

M	src/lib-fs/fs-posix.c

2016-06-21 17:24:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c39000f)

    fs-posix: Added "dirs" parameter to enable explicit directory removal.


M	src/lib-fs/fs-posix.c

2016-06-21 16:49:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d5fbefd)

    fs-posix: Autodelete directories also when "prefix" parameter is used.


M	src/lib-fs/fs-posix.c

2016-06-20 15:10:55 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (ce3cb75)

    lib-storage: Add autoexpunge_max_mails configuration to autoexpunge

    Mails are expunged until mail count is at autoexpunge_max_mails or below.

    In below example, autoexpunge will expunge 1 mail when message count > 100 
    and *then* try to expunge mails that are still older than 2 minutes:

    namespace {
     ..
      mailbox Trash {
        autoexpunge = 2 mins
        autoexpunge_max_mails = 100
      }
    }

M	src/lib-storage/mail-autoexpunge.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2016-06-21 12:04:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8425e55)

    lib-dict: Explicitly specify used dict_vfuncs methods for drivers.

    This allows adding more methods without modifying all the existing drivers.

M	src/lib-dict/dict-cdb.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql.c

2016-06-08 16:41:04 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (1fb947e)

    lib-fts: add unit test to fts_tokenizer_delete_trailing_partial_char()


M	src/lib-fts/test-fts-tokenizer.c

2016-06-07 16:37:27 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (5406c10)

    lib-fts: allow hyphen character in domain part

    Allow hyphen character and remove possible trailing hyhpen character when
    email tokenization is done.

M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-common.c
M	src/lib-fts/test-fts-tokenizer.c

2016-06-07 15:58:38 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (fb237dd)

    lib-fts: remove trailing period character from email-address

    any trailing period character '.' should be removed when email tokenization
    is done.

M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-common.c
M	src/lib-fts/fts-tokenizer-common.h
M	src/lib-fts/test-fts-tokenizer.c

2016-06-07 16:01:03 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (9412c48)

    lib-test: add test_assert_failed_strcmp to expose strings.

    the macro is used to facilitate any test to show string comparision contents
    when they doesn't match.

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2016-06-20 21:38:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9a0dba9)

    Makefile: Added run-test-valgrind.supp to EXTRA_DIST


M	Makefile.am

2016-06-20 18:46:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (80951e8)

    Updated run-test-valgrind.supp


M	run-test-valgrind.supp

2016-06-20 17:52:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e28debf)

    lib: file_create_locked() - Unexpectedly deleted temp file is error.

    This shouldn't happen and we shouldn't be silently retrying if it does.

M	src/lib/file-create-locked.c

2016-06-20 14:29:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1ad12f8)

    Added valgrind suppression for OpenSSL <v1.0.2

    This one works at least for CentOS 6. Because the OpenSSL library is loaded
    as a plugin and unloaded before exit, valgrind sees only "???" as the
    addresses. That's why we're using "obj:*". But the number of obj:* lines is
    also important, so this may not work everywhere.

M	run-test-valgrind.supp

2016-06-20 13:37:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (344ac89)

    openssl: Use our own malloc()/realloc() that will die on out-of-memory.

    This is likely safer rather than caller thinking for example that some input 
    is invalid when it's only a temporary memory allocation problem.

M	src/lib-ssl-iostream/dovecot-openssl-common.c

2016-06-20 13:33:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f5e6b05)

    lib-dcrypt: Allow specifying crypto_device (OpenSSL engine).


M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt-private.h
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/dcrypt.h
M	src/lib-dcrypt/test-crypto.c
M	src/lib-dcrypt/test-stream.c

2016-06-20 13:33:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (44911be)

    lib-dcrypt: Added library dependencies to unit tests


M	src/lib-dcrypt/Makefile.am

2016-06-20 12:58:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bff052b)

    lib-dcrypt, lib-ssl-iostream: Share OpenSSL init/deinit code.


M	src/Makefile.am
M	src/lib-dcrypt/Makefile.am
M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-ssl-iostream/Makefile.am
A	src/lib-ssl-iostream/dovecot-openssl-common.c
A	src/lib-ssl-iostream/dovecot-openssl-common.h
M	src/lib-ssl-iostream/iostream-openssl-context.c

2016-06-20 13:05:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8fbcc7a)

    lib-dcrypt: Fix to backend module loading.

    Especially don't die if we fail to load the module.

M	src/lib-dcrypt/dcrypt.c

2016-06-19 21:31:10 +0200 Stephan Bosch <stephan@dovecot.fi> (f292589)

    lib-http: server: Created test program that tests error conditions.

    Currently it is very limited, but it is due to be extended soon towards
    testing most common error conditions.

M	src/lib-http/Makefile.am
A	src/lib-http/test-http-server-errors.c

2016-06-20 02:41:37 +0200 Stephan Bosch <stephan@dovecot.fi> (3da0c52)

    lib-http: Restructured Makefile.am to have less duplicated lines for the
    test suite.


M	src/lib-http/Makefile.am

2016-06-20 01:25:02 +0200 Stephan Bosch <stephan@dovecot.fi> (183ca5c)

    lib-http: server: Added settings to configure the connection's socket kernel
    buffer sizes.

    This is mainly useful for use in the lib-http test suite.

M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server.c
M	src/lib-http/http-server.h

2016-06-20 01:20:33 +0200 Stephan Bosch <stephan@dovecot.fi> (189b586)

    lib-http: server: Make sure provided connection FDs are non-blocking.


M	src/lib-http/http-server-connection.c

2016-06-20 01:15:18 +0200 Stephan Bosch <stephan@dovecot.fi> (d8570b2)

    lib-http: server: Wrap request payload in a timeout input stream.

    The server cannot reset the timeout properly while the payload is being read
    by the application. The HTTP client solved this same problem by identical
    means.

M	src/lib-http/http-server-connection.c

2016-06-19 22:31:18 +0200 Stephan Bosch <stephan@dovecot.fi> (83d3696)

    lib-http: server: Fixed handling of idle timeout when request just starts
    processing on the server.


M	src/lib-http/http-server-connection.c

2016-06-19 22:35:43 +0200 Stephan Bosch <stephan@dovecot.fi> (5ecd956)

    lib-http: server: Added more detailed debugging about when idle timeouts are
    started/stopped.


M	src/lib-http/http-server-connection.c

2016-06-17 16:59:37 +0200 Stephan Bosch <stephan@dovecot.fi> (8c0379c)

    lib-http: client: Added tests for manual handling of connection loss retries
    to test-http-client-errors.


M	src/lib-http/test-http-client-errors.c

2016-06-17 16:59:15 +0200 Stephan Bosch <stephan@dovecot.fi> (29d5559)

    lib-http: client: Implemented no_auto_retry setting that disables all
    automatic request retries.

    This currently only applies to requests sent over a connection that is
    subsequently lost before a response is received. Before, such requests were
    always implicitly resumbitted for a new connection, without the application
    knowing about it. By enabling the no_auto_retry client setting, the
    application is always notified of connection loss through the request's
    response callback. As a consequence, requests need to be retried explicitly
    using the http_client_request_try_retry().

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2016-06-17 15:39:36 +0200 Stephan Bosch <stephan@dovecot.fi> (ce91fd5)

    lib-http: client: Allow retrying requests that failed internally.


M	src/lib-http/http-client-request.c

2016-06-14 22:47:31 +0200 Stephan Bosch <stephan@dovecot.fi> (91ebc77)

    lib-http: client: Added test for http_client_request_delay_msecs() in
    test_http_client_errors.


M	src/lib-http/test-http-client-errors.c

2016-05-26 18:27:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (024ade6)

    lib-http: Improved error logging for net_set_*_buffer_size() failures.


M	src/lib-http/http-client-connection.c

2016-05-22 10:38:18 +0200 Stephan Bosch <stephan@dovecot.fi> (534195d)

    lib-http: client: Created test program that triggers most possible error
    conditions.


M	src/lib-http/Makefile.am
A	src/lib-http/test-http-client-errors.c

2016-05-24 03:11:07 +0200 Stephan Bosch <stephan@dovecot.fi> (ddb65fb)

    lib-http: test-http-payload: Added tests for the use of nested ioloops.


M	src/lib-http/test-http-payload.c

2016-05-23 21:57:18 +0200 Stephan Bosch <stephan@dovecot.fi> (9ae8eaf)

    lib-http: test-http-payload: Added cleanup code to make sure no child
    processes get orphaned at failures.

    Also handles SIGSEGV and SIGABRT.

M	src/lib-http/test-http-payload.c

2016-05-22 19:16:42 +0200 Stephan Bosch <stephan@dovecot.fi> (5ad09b0)

    lib-http: test-http-payload: Added -D option to easily enable debug mode.


M	src/lib-http/test-http-payload.c

2016-05-23 03:16:07 +0200 Stephan Bosch <stephan@dovecot.fi> (4c4ec17)

    lib-http: test-http-client: Callback is not called for explicitly aborted
    requests.

    Test request context was not freed in that case.

M	src/lib-http/test-http-client.c

2016-05-25 23:41:47 +0200 Stephan Bosch <stephan@dovecot.fi> (8d558a5)

    lib-http: client: Fixed bug in handling of lost connections while returning
    from another ioloop.

    At one instance the http_client_connection_is_ready() function could have
    destroyed the connection while the caller still depended on it. Renamed the
    http_client_connection_is_ready() function to
    http_client_connection_check_ready(). This now returns -1 when the
    connection got destroyed. Before it returned a bool that just indicated
    whether the connection was ready or not. So, there is no need anymore to
    preserve a connection reference while calling this function.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2016-05-23 02:38:49 +0200 Stephan Bosch <stephan@dovecot.fi> (07b6d2b)

    lib-http: client: Reworked connection close handling.

    Now, the peer is immediately notified of the lost connection. Before, this
    step was only taken when the connection was fully dereferenced. To prevent
    recursive notifications between peer and connection, handling the loss of a
    connection is deferred to the request handler. When a peer is freed, any
    associated lingering connections have conn->peer set to NULL.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2016-05-22 12:48:37 +0200 Stephan Bosch <stephan@dovecot.fi> (48e1753)

    lib-http: client: Prevent useless and unexpected request callbacks during
    http_client_deinit().

    Requests are now destroyed before queues, hosts, peers and connections. As a
    side-effect, requests are now removed from the client request list at
    http_client_request_destroy(), so that requests with lingering references
    will no longer make http_client_wait() hang.

M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c

2016-05-20 00:04:12 +0200 Stephan Bosch <stephan@dovecot.fi> (fff1784)

    lib-http: client: Added settings to configure the connection's socket kernel
    buffer sizes.

    This is mainly useful for use in the lib-http test suite.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2016-05-20 00:02:49 +0200 Stephan Bosch <stephan@dovecot.fi> (2b7757b)

    lib: Implemented net_set_send_buffer_size() and net_set_recv_buffer_size().

    These functions allow manipulating the kernel socket buffer sizes for a
    socket file descriptor.

M	src/lib/net.c
M	src/lib/net.h

2016-05-19 23:42:14 +0200 Stephan Bosch <stephan@dovecot.fi> (d63cb13)

    lib-http: client: Removed curiously duplicated code.

    Probably a patch got applied with sufficient fuzz that it duplicated this
    code fragment, while it actually already existed.

M	src/lib-http/http-client-request.c

2016-05-21 13:17:58 +0200 Stephan Bosch <stephan@dovecot.fi> (8d5c693)

    lib-http: client: peer: Improved debug message that shows the loss of a
    connection.


M	src/lib-http/http-client-peer.c

2016-05-21 00:16:21 +0200 Stephan Bosch <stephan@dovecot.fi> (0102e44)

    lib-http: client: Made peer object reference-counted to prevent invalid
    memory access in request handling routine.

    Resetting the peer->handling_requests flag risked triggering a segfault,
    since the peer object could be deleted from within the request handler loop.

M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c

2016-05-21 13:16:08 +0200 Stephan Bosch <stephan@dovecot.fi> (d2b6ff0)

    lib-http: client: Improved request reference counting in connection code.

    It should now always be clear when the connection object holds a reference
    to a request and when it is released. Only while the reference is held,
    req->conn points to a connection. This also makes the assertion in
    http_client_request_unref() more robust and clear.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c

2016-05-22 10:42:01 +0200 Stephan Bosch <stephan@dovecot.fi> (2cbef0f)

    lib-http: client: Fixed reference counting for requests that are aborted due
    to an early server response.

    An additional http_client_request_unref() is (now) unneccessary.

M	src/lib-http/http-client-connection.c

2016-05-19 23:40:26 +0200 Stephan Bosch <stephan@dovecot.fi> (adc4754)

    lib-http: client: Fixed reference counting for requests that are aborted due
    to having a broken outgoing payload stream.


M	src/lib-http/http-client-request.c

2016-05-18 19:40:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4a4f676)

    lib-http: Changed http_client_request_error to set request to NULL

    It's going to internally unreference it, so the caller should be aware of it 
    also.

    I also changed request state check to be an assert, since I don't think 
    there's any safe way this could work otherwise.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c

2016-05-21 00:16:38 +0200 Stephan Bosch <stephan@dovecot.fi> (e7a0878)

    lib-http: response parser: Added check for the range of the response status
    value.

    A value of 666 was accepted inappropriately.

M	src/lib-http/http-response-parser.c

2016-06-20 03:07:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a5bf9e6)

    lib-dict-extra: Compiler warning fix


M	src/lib-dict-extra/dict-fs.c

2016-06-13 17:10:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (adda15c)

    lib-dict: Added dict_switch_ioloop()


M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h
M	src/plugins/dict-ldap/dict-ldap.c

2016-06-02 00:57:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d05c72b)

    lib-dict: dict-client rewrite to support async operations


M	src/lib-dict/dict-client.c

2016-05-06 17:24:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7ebd546)

    lib: Added t_str_tabunescape()


M	src/lib/strescape.c
M	src/lib/strescape.h
M	src/lib/test-strescape.c

2016-06-20 02:25:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (81b96aa)

    lib-dcrypt: Use a more supported EC curve in unit test

    Fixes running the test on CentOS 6.

M	src/lib-dcrypt/test-crypto.c

2016-06-20 01:47:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c5bb8ef)

    lib-index: Don't break indexes on syscall failures during index refreshing.

    Especially mmap() failures due to out of memory could have triggered this. 
    We treated the open as successful, which meant that an empty index was 
    opened.

M	src/lib-index/mail-index-sync-update.c

2016-06-19 23:18:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a12763b)

    lib-dcrypt: Fixed running unit tests in build directory.


M	src/lib-dcrypt/Makefile.am
M	src/lib-dcrypt/test-stream.c

2016-06-19 20:23:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c702025)

    mailbox-alias: Fixed renaming mailboxes when the plugin is loaded.


M	src/plugins/mailbox-alias/mailbox-alias-plugin.c

2016-06-19 18:44:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6fd4b93)

    lib-dcrypt: Fixed memory leak in test-crypto unit test


M	src/lib-dcrypt/test-crypto.c

2016-06-19 18:38:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (97559e0)

    doveadm dump: Updated obox's oid output.


M	src/doveadm/doveadm-dump-index.c

2016-06-15 01:54:25 +0200 Stephan Bosch <stephan@dovecot.fi> (4889576)

    lib-http: client: Added more debug logging about the submission of delayed
    requests.


M	src/lib-http/http-client-queue.c

2016-06-15 01:53:44 +0200 Stephan Bosch <stephan@dovecot.fi> (cf757d6)

    time-util: Fixed usec comparison in timeval_cmp_margin().


M	src/lib/time-util.c

2016-06-14 22:42:09 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (d737445)

    lib-dcrypt: Fix error_r pointer verification.


M	src/lib-dcrypt/dcrypt.c

2016-06-14 22:32:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c365104)

    lib-fs: Added write_bytes to statistics


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2016-05-10 10:19:57 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (cf936f2)

    [LEN] to [static LEN] on some function parameters

    Also add STATIC_ARRAY macro to hide it in c++ compilation.

M	src/auth/mech-rpa.c
M	src/auth/passdb.c
M	src/auth/passdb.h
M	src/auth/userdb.c
M	src/auth/userdb.h
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-md5.h
M	src/lib/guid.c
M	src/lib/guid.h
M	src/lib/macros.h
M	src/lib/md4.c
M	src/lib/md4.h
M	src/lib/md5.c
M	src/lib/md5.h
M	src/lib/sha1.c
M	src/lib/sha1.h
M	src/lib/sha2.c
M	src/lib/sha2.h
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/pop3-migration/pop3-migration-plugin.h

2016-06-14 12:30:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (a63f6d2)

    dcrypt: Arm deinitialization code


M	src/lib-dcrypt/dcrypt.c

2016-06-14 12:08:49 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0901d3f)

    dcrypt: Add test for public key loading


M	src/lib-dcrypt/test-crypto.c

2016-06-14 12:08:34 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (920a34e)

    dcrypt-openssl: Pass pointer safely


M	src/lib-dcrypt/dcrypt-openssl.c

2016-06-14 10:49:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b4fe750)

    lib-index: Fixed test-mail-index-sync-ext


M	src/lib-index/test-mail-index-sync-ext.c

2016-06-14 01:14:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (acf2cc6)

    lib-index: Fixes to handling resized records.


M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-private.h
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-transaction-export.c

2016-06-13 20:16:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6aed775)

    dict: Increased max number of pipelined requests from 5 to 1000.

    The client is supposed to be the one throttling the requests. We mainly want
    to avoid accidental abuses. Using 1000 is hopefully "large enough" without
    being "too large".

M	src/dict/dict-connection.c

2016-06-13 17:59:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (68df459)

    dict: Avoid potentially using 100% CPU

    Continuing 65c570f18 fix.

M	src/dict/dict-connection.c

2016-06-13 17:11:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7e55f1e)

    lib-fs: Added fs_switch_ioloop()


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-dict.c
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-test.c
M	src/plugins/fs-compress/fs-compress.c

2016-06-13 17:31:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3986d36)

    lib-fs: Code cleanup for fs-sis: Use struct fs.parent


M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2016-06-13 12:49:19 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (07a0a18)

    lib-dcrypt: Use hex encoded public key ID in callback


M	src/lib-dcrypt/istream-decrypt.c
M	src/lib-dcrypt/istream-decrypt.h

2016-06-07 03:47:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dce4c1d)

    Fixed linking with OSX.


M	src/lib-dcrypt/Makefile.am
M	src/lib-ldap/Makefile.am

2016-06-13 12:44:09 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3f79377)

    lib-dcrypt: Use dcrypt_key_id_private when applicable


M	src/lib-dcrypt/istream-decrypt.c

2016-05-11 08:02:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (cecf8cf)

    ldap: Fix cyclic dependency


M	configure.ac
M	src/Makefile.am
M	src/lib-dict-extra/Makefile.am
M	src/plugins/Makefile.am
A	src/plugins/dict-ldap/Makefile.am
R100	src/lib-dict-extra/dict-ldap-settings.c	src/plugins/dict-ldap/dict-ldap-settings.c
R100	src/lib-dict-extra/dict-ldap-settings.h	src/plugins/dict-ldap/dict-ldap-settings.h
R100	src/lib-dict-extra/dict-ldap.c	src/plugins/dict-ldap/dict-ldap.c

2016-06-13 12:18:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dda8a31)

    dovecot-config: Add lib-dcrypt to LIBDOVECOT_INCLUDE

    Since lib-dcrypt is part of libdovecot.

M	dovecot-config.in.in

2016-05-19 11:14:46 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (2f83c2f)

    master: make setting listen empty an error


M	src/master/master-settings.c

2016-06-12 20:11:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7789356)

    lib-index: mail_index_ext_resize() was broken when record_size wasn't
    changed.


M	src/lib-index/mail-index-transaction-update.c

2016-06-12 18:57:10 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (fb252d6)

    lib-dcrypt: Fix various problems


M	src/lib-dcrypt/Makefile.am
M	src/lib-dcrypt/dcrypt-openssl.c
M	src/lib-dcrypt/dcrypt-private.h
M	src/lib-dcrypt/dcrypt.c
M	src/lib-dcrypt/dcrypt.h

2016-06-11 21:23:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1f2c248)

    lib-mail: Improved message-parser unit tests.


M	src/lib-mail/test-message-parser.c

2016-06-11 21:23:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (90c8dbd)

    lib-mail: Fixed message_parser_init_from_parts() with truncated MIME headers


M	src/lib-mail/message-parser.c

2016-06-11 21:20:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2a8dbe2)

    lib-mail: message-header-parser now keeps istream referenced.


M	src/lib-mail/message-header-parser.c

2016-06-11 20:50:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (62fc7d0)

    lib-storage: mail_set_cache_corrupted*() now sets internal error to storage.

    At least index_mail_set_message_parts_corrupted() assumed that this was 
    being done.

M	src/lib-storage/index/index-mail.c

2016-06-11 17:13:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5aa6645)

    cassandra: Try fallback_consistency also for write timeout failures.


M	src/lib-sql/driver-cassandra.c

2016-06-07 08:50:12 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (8fdb634)

    doveadm-server: Disable idle timeout for now


M	src/doveadm/client-connection-http.c

2016-06-07 03:25:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9a7dc91)

    lib-dcrypt: Fixed library dependencies

    _DEPENDENCIES needs an explicit paths, not "-lssl" and such. Fixes building 
    with e.g. OSX.

M	src/lib-dcrypt/Makefile.am

2016-06-07 03:04:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4a5eb0c)

    lib-lda: Don't assert-crash if home directory isn't set.


M	src/lib-lda/duplicate.c

2016-06-05 16:01:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (318974e)

    mbox: Code cleanup - use bool instead of int for tracking locked-status


M	src/lib-storage/index/mbox/mbox-lock.c

2016-05-02 18:27:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4441f95)

    quota: Differentiate between forced and non-forced quota recalc

    The "count" backend doesn't need to recalc quota unless an explicit "doveadm 
    quota recalc" command is called.

M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/quota.h

2016-05-02 18:16:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6ab59f3)

    quota: Skip reading mail sizes when quota backend doesn't need it.

    If quota backend is updating the quota internally, it's just going to ignore 
    the looked up size. The only reason for looking up the sizes is to check 
    with quota_try_alloc() whether user is going over quota.

M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2016-06-06 02:27:35 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3eb7503)

    fs-randomfail: Support failures after asynchronous commands have already
    finished.


M	src/lib-fs/fs-randomfail.c

2016-06-06 02:26:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (507292b)

    dict: Fixed hang when pipelining multiple commands.


M	src/dict/dict-connection.c

2016-06-06 00:07:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (be08677)

    lib-index: Extension record size resizing was still broken.

    Fixes assert-crash: Panic: file mail-index-util.c: line 143
    (mail_index_seq_array_add): assertion failed: (array->arr.element_size ==
    sizeof(seq) + aligned_record_size)

M	src/lib-index/mail-index-transaction-update.c

2016-06-05 16:51:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ff9e37d)

    lib-mail: Added comment about invalid timezones in message_date_parse()


M	src/lib-mail/message-date.c

2016-06-05 16:40:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3920a5f)

    director: Fixed error handling when directors support incompatible tags

    Connection should have been disconnected immediately, not after the next 
    command that would have produced "Incompatible protocol".

M	src/director/director-connection.c

2016-06-05 15:57:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (df0fe39)

    lib-dcrypt: Fixed error handling in dcrypt_key_id_public()


M	src/lib-dcrypt/dcrypt-openssl.c

2016-06-05 15:35:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ddc96f7)

    lib-storage: Fixed error handling in list=children checking


M	src/lib-storage/list/mailbox-list-iter.c

2016-06-05 15:32:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8035f93)

    fts-lucene: Fixed error handling when checking if settings had changed.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2016-06-05 15:31:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e6447ac)

    mailbox-alias plugin: Fixed error handling


M	src/plugins/mailbox-alias/mailbox-alias-plugin.c

2016-06-05 15:26:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3991807)

    lib-storage: Search args equalness checks didn't compare keywords correctly.

    This may have broken the search in some situations.

M	src/lib-storage/mail-search.c

2016-06-05 15:23:45 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c1e4cd3)

    mbox: Fixed expunging first mail with CRLF linefeeds.


M	src/lib-storage/index/mbox/mbox-sync-rewrite.c

2016-06-05 15:18:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6c65c2f)

    mdbox: Fix want_altpath flags/boolean mixup

    There was only a single flag, so this wasn't actually currently broken.

M	src/lib-storage/index/dbox-multi/mdbox-map.c

2016-06-05 15:11:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9cc085f)

    auth: Fixed error handling in passdb/userdb dict config parsing


M	src/auth/db-dict.c

2016-06-05 14:54:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (25349a4)

    director: Fixed ignoring an obsolete up/down change while host is desynced.


M	src/director/director-connection.c

2016-06-05 04:29:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9f8c464)

    lib-dcrypt: Fixed function return type.


M	src/lib-dcrypt/dcrypt-openssl.c

2016-06-04 03:47:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3a398ec)

    lazy-expunge: Fixed crash on error handling


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-06-03 20:14:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dab6a44)

    lib-index: Fix duplicate fields in mail_cache_register_fields()

    Broken by hash_table_insert() API change. The earlier code was also a bit 
    wrong by allocating a bit too much memory when there were duplicate fields 
    being registered.

M	src/lib-index/mail-cache-fields.c

2016-06-03 20:10:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a62105e)

    lib-index: Fixed extension resizing

    Broken by 8483af4ff.

M	src/lib-index/mail-index-sync-ext.c

2016-06-03 20:00:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8c8d706)

    lib-index: Added header-size asserts


M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c

2016-06-03 19:58:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8faaab5)

    lib-index: Fixed fsck handling extension with invalid header size

    Fixes:

    Panic: file mail-index-sync-ext.c: line 393 (mail_index_sync_ext_init_new):
    assertion failed: (hdr_buf->used == map->hdr.header_size)

M	src/lib-index/mail-index-fsck.c

2016-06-03 19:20:35 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4313f95)

    lib-storage: Detect duplicate mailbox GUIDs in guid-cache.

    Also fixes assert-crashing in hash_table_insert() when it happens.

M	src/lib-storage/mailbox-guid-cache.c

2016-06-03 19:18:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e2ec3d6)

    maildir: Detect duplicate keywords in dovecot-keywords file

    Use the first such keyword's index, not the last.

    Also fixes assert-crashing in hash_table_insert() when it happens.

M	src/lib-storage/index/maildir/maildir-keywords.c

2016-06-03 19:17:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ec2ee6f)

    maildir: Avoid extra memory usage on duplicate uidlist entries

    Also fixes assert-crashing in hash_table_insert() when it happens.

M	src/lib-storage/index/maildir/maildir-uidlist.c

2016-06-03 17:54:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e669666)

    lib-index: Allow growing ext record_size after mail_index_update_ext()

    The existing records will just get some zero-padding at the end of records.

M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-util.h

2016-06-03 17:52:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f2c6d9c)

    lib-index: Fixed changing extension record sizes.

    map needs to be cloned before any extension record size changes are done. 
    Otherwise the map cloning will crash or do something broken.

M	src/lib-index/mail-index-sync-ext.c

2016-06-03 17:40:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (47cbd0f)

    lib-index: Minor code cleanup - use better variable names


M	src/lib-index/mail-index-sync-ext.c

2016-05-18 14:42:21 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (fd3cdfd)

    lib-storage: add no_fts in struct mail_search_arg

    When flag is set, FTS will not be performed.

    fts plugin: handle no_fts flag

    No fts will be performed once flag is set. Original patch from Timo Sirainen
    <timo.sirainen@dovecot.fi>

M	src/lib-storage/mail-search.h
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-storage.c

2016-05-30 19:07:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8e07283)

    virtual: Moved virtual_mailbox_vfuncs to lib-storage.

    This allows implementing other virtual storage backends.

M	src/lib-storage/mail-storage-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2016-06-01 12:37:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5c44d09)

    master: Give a nicer error if unix/fifo_listener path is empty.

    The previous error was simply:

    unlink(/var/run/dovecot/) failed: Is a directory

M	src/master/master-settings.c

2016-06-02 16:06:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (406b8be)

    dict-sql: Improve error message for invalid value fields.

    It'll now show which map's pattern matched, making it easier to find from
    the config file.

M	src/lib-dict/dict-sql.c

2016-05-23 17:47:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (789f321)

    auth: Support %variable expansion for LDAP field names.

    For example this is now allowed:

    user_attrs = \
     =namespace/%{ldap:enabledNamespace}/enabled=yes \
     ...

M	src/auth/db-ldap.c

2016-05-18 21:41:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (169c886)

    lib-imap-storage: Don't sort uninitialized array on invalid header list.


M	src/lib-imap-storage/imap-msgpart.c

2016-05-18 14:24:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7283d40)

    lib-imap-storage: Minor error logging cleanup/fix.

    We read from input, not from mail_input. In theory it could have the actual 
    error instead of mail_input (although right now it couldn't).

M	src/lib-imap-storage/imap-msgpart.c

2016-05-18 18:41:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3a349ae)

    lib: ostream-escaped: Fixed setting offset


M	src/lib/ostream-escaped.c
M	src/lib/test-ostream-escaped.c

2016-05-16 19:16:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9aaf79f)

    lmtp: Fixed error logging when writing to temp file


M	src/lmtp/commands.c

2016-05-16 15:49:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (44069b0)

    global: Use [io]_stream_get_error() insted of %m


M	src/auth/mech-winbind.c
M	src/auth/userdb-passwd-file.c
M	src/director/director-connection.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-replicator.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-http/http-server-response.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/smtp-client.c
M	src/lib-master/anvil-client.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-service-settings.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib/json-parser.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile-update.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/fts-expunge-log.c

2016-05-10 20:37:55 +0200 Stephan Bosch <stephan@rename-it.nl> (b1254df)

    Added LIBDOVECOT_SQL_INCLUDE to dovecot-config and dovecot.m4.


M	dovecot-config.in.in
M	dovecot.m4

2016-05-11 05:19:14 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (804a551)

    dsync: Fixed potential crash

    This seems to be possible with dsync_mailbox_find_common_expunged_uid() -> 
    dsync_mailbox_common_uid_found() -> dsync_mailbox_rewind_search() ->
    following search doesn't find anything.

M	src/doveadm/dsync/dsync-mailbox-import.c

2016-05-03 19:42:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3def3a7)

    doveadm fetch: Translate commas to spaces in body|binary.<section> with

    This way we can do e.g.:

    doveadm fetch 'uid body.header.fields(from,to,subject)' ...

    Although in theory we could also change the parser to allow spaces as long 
    as they're inside (..), but this is probably too much extra effort.

M	src/doveadm/doveadm-mail-fetch.c

2016-05-03 19:39:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (48713ea)

    lib-imap-storage: Allow HEADER.FIELDS(..) without space before '('

    This is to allow doveadm fetch to use it. Attempting to do this without a 
    space in IMAP already fails elsewhere:

    x fetch 1 body.peek[header.fields(from to)] x BAD Error in IMAP command
    FETCH: Invalid characters in atom

M	src/lib-imap-storage/imap-msgpart.c

2016-05-03 14:58:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (334702e)

    doveadm fetch: Fixed logging errors for istream failures


M	src/doveadm/doveadm-mail-fetch.c

2016-05-03 14:54:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7ec76ff)

    doveadm fetch: Added body.<section> and binary.<section> fields

    These correspond to IMAP BODY[<section>].

M	src/doveadm/Makefile.am
M	src/doveadm/doveadm-mail-fetch.c

2016-04-20 14:33:57 +0300 Martti RannanjÃ¤rvi <martti.rannanjarvi@dovecot.fi> (2812b0e)

    doveadm: error to print formatted without format

    This changes the segfault of `doveadm -f formatted ...` to an error.

M	src/doveadm/doveadm-print-formatted.c

2016-04-30 14:22:21 +0200 Stephan Bosch <stephan@rename-it.nl> (273ed7a)

    lib-http: server: Fixed assert failure occurring when closing the connection
    while a request payload was still being read.


M	src/lib-http/http-server-connection.c

2016-04-30 15:26:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5c33861)

    .gitignore: Added *~


M	.gitignore

2016-04-26 19:26:34 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0fbf2c9)

    doveadm-server: Handle istream send error.


M	src/doveadm/client-connection-http.c

2016-04-29 21:36:31 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (a5658a1)

    lib-dict-extra: Avoid out of scope data stack usage.


M	src/lib-dict-extra/dict-ldap.c

2016-04-20 17:34:53 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (71e8344)

    lib: Add PKCS#5 pbkdf1 and 2


M	src/lib/Makefile.am
A	src/lib/pkcs5.c
A	src/lib/pkcs5.h
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-pkcs5.c

2016-04-27 09:14:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b89dd50)

    auth: Add PBKDF2 password scheme


M	src/auth/Makefile.am
A	src/auth/password-scheme-pbkdf2.c
M	src/auth/password-scheme.c
M	src/auth/password-scheme.h

2016-06-01 12:24:57 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (f6e1440)

    lib-fts: Improved stopword file reading.

    The reading tries to be a little bit stricter now. Only stopwords at the 
    start of a new line are accepted now. Changed fi stopwords accordingly. Also
    removed superfluous stack allocation in parsing.

M	src/lib-fts/Makefile.am
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/stopwords/stopwords_fi.txt
A	src/lib-fts/stopwords/stopwords_malformed.txt
M	src/lib-fts/test-fts-filter.c

2016-05-30 12:40:00 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (77c9af3)

    lib-fts: Add stopword files for more languages.


M	src/lib-fts/Makefile.am
A	src/lib-fts/stopwords/stopwords_da.txt
A	src/lib-fts/stopwords/stopwords_de.txt
A	src/lib-fts/stopwords/stopwords_es.txt
A	src/lib-fts/stopwords/stopwords_it.txt
A	src/lib-fts/stopwords/stopwords_nl.txt
A	src/lib-fts/stopwords/stopwords_pt.txt
A	src/lib-fts/stopwords/stopwords_ro.txt
A	src/lib-fts/stopwords/stopwords_ru.txt

2016-05-30 11:54:26 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (c7021f4)

    lib-fts: Move stopwords to subdirectory.

    All files incluided in dist are explicitly mentioned. The whole subdirectory
    'stopwords' could also be distributed, but that is more error prone.

M	src/lib-fts/Makefile.am
R100	src/lib-fts/stopwords_en.txt	src/lib-fts/stopwords/stopwords_en.txt
R100	src/lib-fts/stopwords_fi.txt	src/lib-fts/stopwords/stopwords_fi.txt
R100	src/lib-fts/stopwords_fr.txt	src/lib-fts/stopwords/stopwords_fr.txt
R100	src/lib-fts/stopwords_no.txt	src/lib-fts/stopwords/stopwords_no.txt
R100	src/lib-fts/stopwords_sv.txt	src/lib-fts/stopwords/stopwords_sv.txt

2016-06-02 00:52:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8b895d0)

    dict: Pipelined iteration replies may have been hanging.

    For example:
    - lookup start
    - iterate start
    - iterate finished, but can't reply yet
    - lookup finished
    - iterate reply can be sent now, but wasn't previously

M	src/dict/dict-commands.c

2016-06-02 00:51:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (72f0027)

    dict: Fixed crash when reaching max (5) pending commands.


M	src/dict/dict-connection.c

2016-06-01 18:11:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f67f6de)

    global: Use i_stream_get_max_buffer_size() wherever possible

    After 7be8ba0c0 it's no longer correct to access stream->max_buffer_size 
    directly. These changes fix using istream-chain with various wrapper 
    streams.

M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lz4.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c
M	src/lib-fs/istream-fs-file.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-test/test-common.c
M	src/lib/istream-concat.c
M	src/lib/istream.c

2016-06-01 18:09:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (41a18c1)

    lib: i_stream_get_max_buffer_size() checks also parents' max sizes

    This fixes i_stream_get_max_buffer_size() to work correctly with 
    istream-chain.

M	src/lib/istream.c
M	src/lib/istream.h

2016-06-01 18:03:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (51dcb33)

    lib: istream-chain didn't update its max_buffer_size

    I had this code at some point earlier, but looks like it got lost from the 
    final commit.

M	src/lib/istream-chain.c

2016-06-01 17:52:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6bd205f)

    lib-compression: istream.max_buffer_size == 0 isn't unlimited.


M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c

2016-06-01 17:18:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3ffc655)

    fs-metawrap: Removed unnecessary code.

    As mentioned in a0cf7d392, this can't happen.

M	src/lib-fs/fs-metawrap.c

2016-06-01 17:12:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1d29d49)

    lib-fs: Improved unit tests.


M	src/lib-fs/Makefile.am
A	src/lib-fs/fs-test-async.c
M	src/lib-fs/fs-test.c
M	src/lib-fs/fs-test.h
M	src/lib-fs/test-fs-metawrap.c

2016-06-01 17:12:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f412ee7)

    fs-metawrap: Removed unnecessary code.

    The caller already set success==FALSE if ostream was closed.

M	src/lib-fs/fs-metawrap.c

2016-06-01 17:11:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (90ec94c)

    lib-fs: Added more asserts


M	src/lib-fs/fs-api.c

2016-06-01 17:06:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d010574)

    lib-fs: Clarified fs_write_stream_abort() API and dropped its _async().

    We can't handle an abort after an async fs_write_stream_finish() is already 
    going.

M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2016-06-01 15:15:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5f4111f)

    lib-fs: Added fs_write_stream_abort_async()


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2016-05-14 22:49:53 +0200 Stephan Bosch <stephan@dovecot.fi> (a69f793)

    lib-mail: istream-qp-decoder: For efficiency, avoid copying data between
    decode buffer and stream buffer.

    Instead, use the decode buffer directly as stream buffer.

M	src/lib-mail/istream-qp-decoder.c

2016-05-04 18:24:03 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5b6559c)

    lib: istream's max_buffer_size=0 means 0, not unlimited.

    Make sure we don't grow the buffer size then.

M	src/lib/istream.c

2016-06-01 13:30:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3dafbab)

    lib: Fix to previous istream-chain max_buffer_size handling

    We were casting the wrong stream.

M	src/lib/istream-chain.c

2016-05-31 22:33:32 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9e7b4d6)

    fs-metawrap: Fixed buffer size while reading metadata header.

    It's not enough to have the buffer size set to "large enough" at the time of 
    the stream creation, because i_stream_set_max_buffer_size() could be called 
    afterwards.

M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/istream-metawrap.c

2016-05-31 22:19:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dc43757)

    lib: Fixed max_buffer_size handling in istream-chain

    The default max_buffer_size=256 was wrong in all situations.

    We're now assuming that the underlying istreams' max_buffer_size is always 
    correct. While gluing together two streams we're now allocating enough 
    memory to hold all of the wanted data (instead of assert-crashing as could 
    have happened earlier). This means that the max memory usage is actually the
    two streams' max_buffer_size summed together. Ideally this would be fixed to
    limit the max_buffer_size to maximum of the two, but that would require
    further changes.

M	src/lib/istream-chain.c

2016-06-01 08:43:23 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (936f81c)

    doveadm: Do not use INT64 with mail cmds yet


M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-mailbox.c

2016-06-01 02:01:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (eabf965)

    lib-dcrypt: Fixed check program dependencies


M	src/lib-dcrypt/Makefile.am

2016-06-01 00:19:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4ff22b5)

    lib-dcrypt: Fixed dcrypt_openssl_generate_keypair()


M	src/lib-dcrypt/dcrypt-openssl.c

2016-05-31 17:16:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (24a4e25)

    dict-client: Fixed idle_msecs setting.


M	src/lib-dict/dict-client.c

2016-05-31 17:06:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9b1bd5d)

    lib-fs: Don't duplicate backend name in fs_init() errors.

    fs_init() already adds the "backend: " prefix to the error_r, so the callers 
    shouldn't do it again.

M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2016-05-30 22:39:39 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d26c53c)

    lib-dcrypt: Use base64 encoded test samples


M	src/lib-dcrypt/Makefile.am
A	src/lib-dcrypt/sample-v1.asc
D	src/lib-dcrypt/sample-v1.bin
A	src/lib-dcrypt/sample-v2.asc
D	src/lib-dcrypt/sample-v2.bin
M	src/lib-dcrypt/test-stream.c

2016-05-30 22:33:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (fe60fa9)

    lib-dcrypt: Fix strict type-punning warning


M	src/lib-dcrypt/dcrypt-openssl.c

2016-05-30 22:30:31 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (7251106)

    lib-dcrypt: Fix various OpenSSL API usage issues


M	src/lib-dcrypt/dcrypt-openssl.c

2016-05-30 22:05:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (2c6877f)

    lib-dcrypt: Remove duplication of samples


M	src/lib-dcrypt/Makefile.am

2016-05-30 21:14:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (619830d)

    lib-dcrypt: Always allow error_r to be NULL.

    Especially dcrypt_openssl_private_to_public_key() was called with 
    error_r=NULL by the dcrypt.c itself.

M	src/lib-dcrypt/dcrypt-openssl.c

2016-05-30 19:38:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3dfcebb)

    lib-dcrypt: sample-v2.bin shouldn't be executable


M	src/lib-dcrypt/sample-v2.bin

2016-05-30 15:36:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a991c21)

    lib-dcrypt: Compiler warning fixes


M	src/lib-dcrypt/dcrypt-openssl.c

2016-05-27 22:18:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (69cf950)

    doveadm mailbox delete: Added --unsafe option.


M	src/doveadm/doveadm-mail-mailbox.c

2016-05-27 22:15:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5a5ddc2)

    lib-storage: Added MAILBOX_FLAG_DELETE_UNSAFE


M	src/lib-storage/mail-storage.h
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/quota/quota-storage.c

2016-05-06 00:29:16 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (220df28)

    configure: Include lib-dcrypt in core


M	configure.ac

2016-04-27 14:08:00 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (141f09f)

    lib-dcrypt: Initial implementation


M	configure.ac
M	src/Makefile.am
A	src/lib-dcrypt/Makefile.am
A	src/lib-dcrypt/dcrypt-gnutls.c
A	src/lib-dcrypt/dcrypt-iostream-private.h
A	src/lib-dcrypt/dcrypt-openssl.c
A	src/lib-dcrypt/dcrypt-private.h
A	src/lib-dcrypt/dcrypt.c
A	src/lib-dcrypt/dcrypt.h
A	src/lib-dcrypt/istream-decrypt.c
A	src/lib-dcrypt/istream-decrypt.h
A	src/lib-dcrypt/ostream-encrypt.c
A	src/lib-dcrypt/ostream-encrypt.h
A	src/lib-dcrypt/sample-v1.bin
A	src/lib-dcrypt/sample-v2.bin
A	src/lib-dcrypt/test-crypto.c
A	src/lib-dcrypt/test-stream.c
M	src/lib-storage/index/dbox-single/sdbox-file.c

2016-05-30 14:45:09 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (497b805)

    doveadm-director: Fix commands so that they compile


M	src/doveadm/doveadm-director.c

2016-05-27 11:29:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d7dfbe2)

    doveadm mailbox delete: Added -e parameter to delete only empty mailboxes.


M	src/doveadm/doveadm-mail-mailbox.c

2016-02-24 12:10:19 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e7f2fde)

    doveadm-director: Convert to ver2 infra


M	src/doveadm/doveadm-director.c

2016-05-27 21:55:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (336eedf)

    dbox: Revert cache changes if some save/copy fails but transaction is
    committed.


M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-save.c

2016-05-27 21:34:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (137dcd8)

    lazy-expunge: Don't fail expunge if mail was already expunged.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-05-27 21:32:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2896dfd)

    lazy-expunge: Fixed error logging.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-05-27 18:30:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e56b1f2)

    dsync: Debug logging improvement.


M	src/doveadm/dsync/dsync-mailbox-import.c

2016-05-27 14:38:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ec6e027)

    lib-fs: Fix to previous fs-metawrap commit

    Argh. I was sure I compiled this before pushing it.

M	src/lib-fs/istream-metawrap.c

2016-05-27 14:33:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f71e3eb)

    lib-fs: fs-metawrap: Improved error logging on corrupted files.


M	src/lib-fs/istream-metawrap.c

2016-05-26 19:13:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8baf234)

    doveadm: Fixed sending command -parameters to doveadm-server


M	src/doveadm/doveadm-mail.c

2016-05-26 21:40:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d1843ca)

    sdbox: Make sure we don't crash when altmove-flag is set but alt path is
    missing.


M	src/lib-storage/index/dbox-single/sdbox-file.c

2016-05-26 18:25:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a436e90)

    dict-sql: Fixed memory leak


M	src/lib-dict/dict-sql-settings.c

2016-05-25 22:29:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a2f4214)

    cassandra: Added metrics=path connect setting.

    Cassandra's metrics are written to the path in JSON format. It can be a file 
    or a FIFO. The path supports expanding the standard global %variables, such 
    as %{pid}

M	src/lib-sql/driver-cassandra.c

2016-05-25 22:08:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (17aed59)

    dict: Added missing main.h from previous commit


A	src/dict/main.h

2016-05-25 20:00:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cfc6d8e)

    dict: Show command statistics in process title.


M	src/dict/Makefile.am
M	src/dict/dict-commands.c
M	src/dict/dict-commands.h
M	src/dict/dict-connection.c
M	src/dict/dict-connection.h
M	src/dict/dict-settings.c
M	src/dict/dict-settings.h
M	src/dict/main.c

2016-05-25 19:56:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c9adb47)

    lib: Fixed crashes in timing_get_median() and timing_get_95th()

    These were writing outside allocated memory. They weren't actually used 
    anywhere yet though.

M	src/lib/test-timing.c
M	src/lib/timing.c

2016-05-25 19:45:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (801990c)

    lib: Added timing_reset()


M	src/lib/test-timing.c
M	src/lib/timing.c
M	src/lib/timing.h

2016-05-19 19:15:49 -0500 J. Nick Koston <nick@cpanel.net> (bde40af)

    dsync: race condition where done/finish is received after one side has
    closed

    We do not tell the remote we are closing if they have already told us
    because they close the connection after sending ITEM_FINISH or ITEM_DONE and
    will not be ever receive anything else from us unless it just happens to get
    combined into the same packet as a previous response and is already in the
    buffer.

M	src/doveadm/dsync/dsync-ibc-stream.c

2016-05-24 15:52:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bf5c1ac)

    lib-stats: Allow unregistering + re-registering stats.

    Fixes: Panic: stats_register() called after stats_alloc_size() was already
    called - this will break existing allocations

    This could have happened with doveadm HTTP API when using multiple commands 
    in same HTTP connection.

M	src/lib-stats/stats.c

2016-05-23 23:24:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3615752)

    lib-index: Fixed assert-crash caused by previous cache compression change.

    We can't call mail_cache_map() when cache file isn't open or we'll crash:

    Panic: file mail-cache.c: line 468 (mail_cache_map): assertion failed:
    (cache->need_compress_file_seq != 0 ||
    MAIL_INDEX_IS_IN_MEMORY(cache->index))

M	src/lib-index/mail-cache-compress.c

2016-05-23 18:46:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (26c937b)

    lib-index: Make sure cache compression doesn't clear the file unneededly.

    This probably never happened with current code, except when the cache file 
    was already broken.

    mail_cache_compress() unmapped cache when map_with_read==TRUE, but we never 
    mapped it back. This would cause cache copying code to think cache was 
    unusable and not copy anything.

M	src/lib-index/mail-cache-compress.c

2016-05-23 13:12:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (24234b1)

    lib-ldap: Use ldap_unbind_ext() instead of ldap_destroy()

    This allows it to compile with older LDAP libraries. Their behavior (at
    least in OpenLDAP) is identical as long as LDAP_OPT_CLIENT_CONTROLS haven't
    been changed, which we haven't.

M	src/lib-ldap/ldap-connection.c

2016-05-23 13:08:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (20e68d8)

    lib-ldap: Support libldap without LDAP_OPT_X_TLS_NEWCTX.


M	src/lib-ldap/ldap-connection.c

2016-05-20 15:55:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (153528a)

    doveadm backup: Fixed unnecessary mailbox deletion.

    Broken by 79490ec1a. The idea is to delete the mailbox early to avoid 
    unnecessary work, but we deleted it too early. If the last mail(s) were 
    deleted instead of just expunging them we deleted the whole mailbox.

M	src/doveadm/dsync/dsync-mailbox-import.c

2016-05-19 23:19:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (104a244)

    lib-mail: Fixed istream-header-filter calling callback(hdr=NULL)

    It should do it on the following parsings as well if there were any 
    callbacks that were called, or if the hdr==NULL callback added any headers.
    This is important because the hdr==NULL call could do some cleanups.

M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-05-16 11:34:05 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (dca0719)

    config: fix possible out-of-bound access in parsing function

    Add low-bound check when decreasing string pointer from tail.

M	src/config/config-parser.c

2016-05-18 22:26:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (81f0bc1)

    lib-fs: istream-metawrap can't have a readable fd currently


M	src/lib-fs/istream-metawrap.c

2016-05-18 14:56:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (06bd6c4)

    lib-mail: istream-header-filter - Don't return -2 too early

    We returned -2 after we already added the data to the buffer. We should have
    returned -2 only on the next read() call if nothing was skipped.

M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-05-18 18:51:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (580cfdf)

    lib-http: Fixed checking if istream or ostream needs waiting.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-server-response.c

2016-05-18 18:48:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (94e8a82)

    lib: If epoll_ctl() fails, panic instead of just fatal.

    This makes it easier to fix such bugs.

M	src/lib/ioloop-epoll.c

2016-05-18 09:33:15 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (e17d7f4)

    doveadm-mailbox-delete: Restore recursive parameter


M	src/doveadm/doveadm-mail-mailbox.c

2016-05-18 09:29:04 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (744fa5a)

    dict: Fix crash when no dictionaries defined


M	src/dict/dict-connection.c

2016-05-17 00:00:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f008446)

    imap: Include sync timing information in tagged command replies. Show it
    only when it's larger than 0 to avoid unnecessary output.


M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-sync.c

2016-05-17 23:31:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (9b496d9)

    doveadm-mailbox: Add update subcommand


M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-05-12 17:45:34 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (b6d4252)

    lib-ldap: Fixed assert-crash when killing LDAP connection.

    libldap may have already closed the fd, so with epoll io_remove() would try
    to remove it and crash with:

    Panic: epoll_ctl(del, 12) failed: Bad file descriptor

M	src/lib-ldap/ldap-connection.c

2016-02-08 18:32:10 +0200 Phil Carmody <phil@dovecot.fi> (72c1566)

    lib: istream - provide alternatives to i_stream_read_data()

    Providing as a parameter the number of bytes that you would be disappointed
    to receive was confusing compared to providing the number that you would be
    happy to receive. This lets us get rid of all the '-1's in the callers. The
    callers which used 0 as a parameter were so common that it's worth providing
    a separate API just to simplify their demands.

    Deep down, these are still the same underlying function. Currently we route
    the new API through the old one, but eventually, the old API can be routed
    through the new one, so that the friendlier interface has the simplest
    implementation.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/istream.h

2016-05-15 17:25:17 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3a02e96)

    lib-ldap: Do not create new context and lose settings


M	src/lib-ldap/ldap-connection.c

2016-05-15 01:17:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (015c15f)

    lib-ldap: Compiling fix - don't pass through void return


M	src/lib-ldap/ldap-client.c

2016-05-11 16:57:33 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (71bcaeb)

    lib-sql: Memory leak fix when freeing sql dbs from cache

    Normally happened only at deinit.

M	src/lib-sql/sql-db-cache.c

2016-05-06 13:42:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b35c903)

    dict-redis: Fixed memory leak in async commit


M	src/lib-dict/dict-redis.c

2016-05-13 14:22:40 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (26758de)

    imap: Set command start timestamps earlier.

    Previously timing statistics in taglines weren't shown commands that didn't 
    read any parameters.

    Also the timings now include the time speng reading command parameters from 
    client. For example:

    a list "" {1}
    + OK
    %
    * LIST (\HasNoChildren) "/" INBOX a OK List completed (0.001 + 1.214 secs).

M	src/imap/imap-client.c

2016-05-13 13:35:50 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (a0b127a)

    lib: Fixed istream_seekable.stat() to return correct size.

    It was supposed to read until end of the stream, but it did it only when 
    stat() was called while stream was still fully in memory.

M	src/lib/istream-seekable.c

2016-05-13 09:56:08 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (aae505b)

    lib-fs: Make sure fs-metawrap catches all write errors.

    The full istream may not have been written in case ostream only partially 
    wrote the data (e.g. out of disk space?)

M	src/lib-fs/fs-metawrap.c

2016-05-13 09:48:13 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (4132ed5)

    lib-fs: If fs-metawrap sees truncated header, it should return error.


M	src/lib-fs/istream-metawrap.c

2016-05-13 09:23:52 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (6bc001e)

    lib: Fixed potential crash in i_stream_stat() failures.

    We shouldn't have been copying parent's stream_errno here. Especially 
    because the parent can be NULL.

M	src/lib/istream.c

2016-05-12 15:10:47 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (f5f2a7a)

    lib-fs: Added FS_PROPERTY_FASTCOPY_CHANGED_METADATA


M	src/lib-fs/fs-api.h

2016-04-28 12:45:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d375835)

    lib-fs: Allow multiple fs_read_stream() calls to seekable istreams.

    This fixes for example calling fs_default_copy() for an istream which was 
    already opened:

    Panic: file fs-api.c: line 528 (fs_read_stream): assertion failed:
    (!file->istream_open)

M	src/lib-fs/fs-api.c

2016-04-28 12:47:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (826f16c)

    lib-fs: Fixed multiple concurrent fs_read_stream() calls

    Return a new limit-istream, so each istream can have its own independent 
    offset.

M	src/lib-fs/fs-api.c

2016-05-12 08:09:56 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (9f300ec)

    lib-http: Queue's delayed timeout handler wasn't removed after work was
    done.


M	src/lib-http/http-client-queue.c

2016-05-11 16:58:59 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (fa4f8f3)

    dict-sql: Cache reading settings files.

    The settings were read for every dict init, which was done for every new 
    dict connection. This was using a lot of CPU. There are usually only a 
    couple dict-sql settings files, so we cache all of the ones we read.

M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql-settings.h
M	src/lib-dict/dict-sql.c

2016-05-12 07:24:39 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (5aa6420)

    lib-fs: Minor code cleanup


M	src/lib-fs/fs-api.c

2016-05-12 07:23:51 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (fece801)

    lib-fs: Set fs error on fs_write_stream_abort()

    Probably would be nice for fs_write_stream_abort() to have an error string 
    parameter, which could be used instead of this generic error.

M	src/lib-fs/fs-api.c

2016-05-12 07:23:04 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (7bea15d)

    lib-fs: Added asserts to make sure async writes are finished before close


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2016-05-12 07:21:38 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (4c4a583)

    fs-metawrap: Minor code cleanup

    temp_output==NULL, so these calls are equal.

M	src/lib-fs/fs-metawrap.c

2016-05-12 07:18:49 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (69ced82)

    fs-metawrap: Propagate fs_write_stream_abort() to parent always

    It needed to be done also when temp_output==NULL, because we had already 
    started sending it to parent, but async parent wasn't being finished.

M	src/lib-fs/fs-metawrap.c

2016-05-12 07:15:41 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (a80011b)

    fs-randomfail: Set fs error always when injecting failure.

    It was done in some places, but not everywhere.

M	src/lib-fs/fs-randomfail.c

2016-05-10 17:35:43 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (ebf2e93)

    lib-ldap: Reverted previous commit for now.

    We don't have libdovecot built at at this stage. But we can't build it 
    earlier, because it needs lib-dict-extra, which needs lib-ldap. So we have 
    cyclical dependencies now.

M	src/lib-ldap/Makefile.am

2016-05-10 17:25:20 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (1b22887)

    lib-ldap: Add libdovecot dependency to libdovecot-ldap

    Required for linking to work on OSX.

M	src/lib-ldap/Makefile.am

2016-05-10 16:22:23 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (bd0bf12)

    lib: Fixed crash when closing a failed istream-concat

    i_stream_concat_seek() could have set cur_input==NULL and we still attempted
    to seek the cur_input at close time.

M	src/lib/istream-concat.c

2016-05-10 10:42:33 -0400 Timo Sirainen <timo.sirainen@dovecot.fi> (7c2d7b9)

    lib-index: "first saved UID of the day" wasn't updated right always.

    It was using the UID of the first append. But it may not have been the 
    lowest UID. Do this after the appends are first sorted by their UID.

M	src/lib-index/mail-index-transaction-finish.c

2016-05-10 00:42:51 +0200 Stephan Bosch <stephan@rename-it.nl> (99ce322)

    Added liblzma bug to Valgrind suppressions file.

    It caused `make test` to fail with valgrind. Occurred at least for Debian
    Jessie with liblzma package version 5.1.1alpha+20120614-2+b3.

M	run-test-valgrind.supp

2016-05-09 08:04:39 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5f59c92)

    README: Added missing supported RFCs


M	README

2016-05-06 00:17:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c2a17c8)

    lib-http: If connect fails, include attempt count and total time in error.

    This will produce errors such as: 9002 connect(1.2.3.4:801) failed:
    Connection timed out in 1.001 secs (4 attempts in 4.706 secs)

M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c

2016-05-06 17:35:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8dfa9cf)

    dict-client: Added idle_msecs=<n> parameter

    This can be useful when connected to dict-async server where extra idling 
    connections don't matter so much as with blocking dict servers.

M	src/lib-dict/dict-client.c

2016-05-06 22:24:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9f47b8c)

    imap: Avoid assert-crash after a failed mailbox sync.

    We didn't close the mailbox and we didn't update message counts, so we could 
    have crashed with:

    Panic: Message count decreased

M	src/imap/imap-sync.c

2016-05-05 21:26:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (99e6838)

    stats: Handle getrusage() errors better

    I'm not aware of these errors actually happening anywhere, but its error
    handling wouldn't have been correct if previous getrusage() calls had
    succeeded. Now if it fails, log an error once and just keep on using the
    last working rusage.

M	src/plugins/stats/mail-stats-fill.c

2016-05-05 21:23:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c8d8cb5)

    stats: Work around shrinking system CPU usage

    Happening at least in Debian's Linux kernel 4.3.0-1-amd64.

    getrusage() may returns ru_stime = 4000 or 8000, but later it drops to 0. 
    We'll just work around this by switching to the previous working ru_stime.

    This fixes errors like: Error: stats: session stats shrank: sys_cpu 0.0 <
    0.4000

M	src/plugins/stats/mail-stats-fill.c

2016-05-06 12:51:28 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (37f0b04)

    dict-ldap: Properly duplicate result


M	src/lib-dict-extra/dict-ldap.c

2016-05-03 17:43:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (fc0f22e)

    auth: Makefile dependency fix

    Hopefully fixes: mv: cannot stat '.deps/auth-stats.Tpo': No such file or
    directory

M	src/auth/Makefile.am

2016-05-06 14:34:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0e65dc9)

    lib: Added i_stream_get_disconnect_reason()


M	src/lib/istream.c
M	src/lib/istream.h

2016-05-06 14:22:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4a92e7a)

    lib: Improved connection_disconnect_reason()


M	src/lib/connection.c

2016-05-05 18:10:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (501231e)

    lazy-expunge: Handle mailbox create race conditions.

    Don't log an error if another process just created the lazy-expunge mailbox.

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-05-05 16:15:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2615930)

    lib-fs: Fixes to stats count tracking

    fs_exists(), fs_copy(), fs_rename() and fs_delete() could have increased the 
    count multiple times on async operations.

M	src/lib-fs/fs-api.c

2016-05-05 14:58:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bb3679a)

    stats: Fixed ADD-USER stats tracking (auth stats)


M	src/stats/mail-user.c

2016-05-04 18:34:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e36e974)

    lib-fs: fs-metawrap stat() error handling improvement.

    We can't just treat i_stream_get_size() returning 0 as the reason being 
    istream is async and not fully read. It might be, but it might also be 
    because of other reasons. And since we're closing the istream we couldn't 
    even properly finish up the async handling. So for now just return an error
    if we see this happening.

M	src/lib-fs/fs-metawrap.c

2016-05-03 20:28:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b0626c0)

    lib-mail: Fixed istream-header-filter unit test names


M	src/lib-mail/test-istream-header-filter.c

2016-05-03 20:20:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9233125)

    doveadm who: Fixed listing LMTP sessions


M	src/doveadm/doveadm-who.c

2016-05-02 23:43:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1c3f119)

    lib-storage: Make it easier to debug mail's unclosed istream


M	src/lib-storage/index/index-mail.c

2016-05-03 18:25:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (90c3923)

    lib-mail: istream-header-filter - fixed adding headers at eoh


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-05-03 17:38:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (71c09f6)

    lib-mail: istream-header-filter: Fixed stat() with HEADER_FILTER_HIDE_BODY


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-05-03 17:25:07 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7fd1292)

    lib-mail: istream-header-filter HEADER_FILTER_ADD_MISSING_EOH fixes

    When using HEADER_FILTER_CRLF_PRESERVE, add CR to the EOH if the previous 
    header line ended with CRLF.

    When header ends to a header without newline, add two newlines so we can get 
    the actual EOH added.

M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-05-03 17:08:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0394749)

    lib-mail: istream-header-filter: Fixed stat() with
    HEADER_FILTER_END_BODY_WITH_LF


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-05-03 16:54:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (81905b9)

    lib-mail: istream-header-filter - Check errors reading header

    This probably doesn't affect the results much, since the stream_errno is set 
    anyway. But it's better to abort early, just in case the broken state might 
    end up asserting later.

M	src/lib-mail/istream-header-filter.c

2016-05-03 15:27:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4497d28)

    lib-storage: Fixed potential crash in mailbox_sync_deinit() error handling

    If mailbox_sync*() was called before mailbox was opened, the automatic 
    mailbox opening could fail. mailbox_sync_deinit() would still try to access 
    box->view, which would be NULL.

M	src/lib-storage/index/index-sync.c

2016-05-02 17:31:30 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (47f2320)

    lib-ldap: Handle various LDAP failures correctly


M	src/lib-ldap/ldap-connection.c

2016-05-02 16:21:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (eb23941)

    lib-ldap: Do not retry with bad credentials


M	src/lib-ldap/ldap-connection.c

2016-05-04 15:36:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (139007f)

    imap: Set client_command_context.tagline_reply before syncing.

    Command post-hooks can't see it otherwise.

M	src/imap/imap-sync.c

2016-05-03 22:18:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5f50fec)

    dsync: Fixed assert-crash if mailbox_attribute_set() fails

    We shouldn't set importer->mail_error, because we're not going to fail the
    import.

    Fixes assert-crash: dsync-mailbox-import.c: line 2812
    (dsync_mailbox_import_deinit): assertion failed: (importer->failed ==
    (importer->mail_error != 0))

M	src/doveadm/dsync/dsync-mailbox-import.c

2016-05-02 15:20:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (527dad0)

    lib-ldap: Added initial connection pooling code.

    This is mainly about allowing multiple dict-ldaps to use the same 
    ldap-connection. In future we could support load balancing with multiple 
    concurrent LDAP connections.

M	src/lib-dict-extra/dict-ldap.c
M	src/lib-ldap/Makefile.am
M	src/lib-ldap/ldap-client.c
M	src/lib-ldap/ldap-client.h
A	src/lib-ldap/ldap-connection-pool.c
A	src/lib-ldap/ldap-connection-pool.h
M	src/lib-ldap/ldap-connection.c
M	src/lib-ldap/ldap-private.h

2016-05-02 14:35:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (90afb17)

    dict-ldap: Removed caching of ldap-clients

    With the previous per-username caching there could be a huge number of 
    dict-ldaps.

M	src/lib-dict-extra/dict-ldap.c

2016-05-02 14:21:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f3781e5)

    dict-ldap: Don't reuse dict for different usernames.

    Fixes doing priv/* lookups for multiple usernames.

    This currently also means that each username will create a separate LDAP 
    connection, which isn't ideal. But this is probably better fixed in lib-ldap
    code similar to how lib-sql does connection pooling.

M	src/lib-dict-extra/dict-ldap.c

2016-05-02 12:01:40 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6d1972d)

    imap: Added struct client_command_context.tagline_reply

    Can be used by plugins.

M	src/imap/imap-client.c
M	src/imap/imap-client.h

2016-05-02 10:14:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9ba5b7f)

    auth: Added %{auth_user/username/domain} variables


M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request-var-expand.h

2016-04-30 14:55:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (30c9ffa)

    lib-storage: Clear list error before mailbox_list_get_hierarchy_sep()

    With ACL plugin enabled the call could have triggered dovecot-acl-list 
    rebuild, which in turn could have set list errors if it didn't have 
    permissions to all the mailboxes. This caused IMAP logins to fail.

M	src/lib-storage/mailbox-list.c

2016-04-30 14:19:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0f6a26e)

    lib-mail: message-parser assert-crashfix

    Crashes when multipart MIME header is missing end-of-headers line and the 
    boundary begins with the same prefix as one of the parent boundaries. Broken
    by 7a12331c6

M	src/lib-mail/message-parser.c
M	src/lib-mail/test-message-parser.c

2016-04-30 01:27:27 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0192511)

    quota: Fix to earlier commit 62f2f6baf

    expunge_uids may become empty with prev_idx > 0

M	src/plugins/quota/quota-storage.c

2016-04-30 01:05:47 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b58c7f9)

    lib-fs: Fixed fs_get_metadata() with fs-metawrap

    If mail was already read to EOF.

M	src/lib-fs/fs-metawrap.c

2016-04-26 14:27:39 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (91ccea1)

    man: Add stub for doveadm-fs command


M	.gitignore
M	doc/man/Makefile.am
A	doc/man/doveadm-fs.1.in

2016-04-26 18:51:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (eb83d99)

    lmtp: Connect to anvil earlier while still running as root

    This was a problem only with lmtp_rcpt_check_quota=yes.

M	src/lmtp/commands.c

2016-04-28 22:33:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7f5d5ff)

    lib: Set timestamp part more accurately in guid_128_generate()

    Previously a long-running process would keep the timestamp close to its 
    original start time. This doesn't really matter as long as GUIDs are treated 
    opaque, but some pieces of code prefer to try to use the timestamp fields 
    since they're already there. This makes such code work more nicely.

M	src/lib/guid.c

2016-04-29 21:57:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (48526bf)

    lib-ldap: Make static analyzer happier

    Remove dead assignment.

M	src/lib-ldap/ldap-search.c

2016-04-29 20:23:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7f68a69)

    auth: Fixed final result in multiple userdbs

    We don't want to return the last result's success/failure, but the entire
    userdb chain's success/failure.

M	src/auth/auth-request.c

2016-04-29 19:59:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bbaeb01)

    auth: Session ID wasn't exported to auth workers.

    Most importantly this means that log messages didn't contain them.

M	src/auth/auth-request.c

2016-04-29 19:25:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ae96eaa)

    quota: Added quota_over_flag_lazy_check flag.

    By default the quota_over_flag is checked immediately at startup. With this 
    option the check is done only at a time when the quota is anyway being read.

M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/quota.h

2016-04-29 19:20:11 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (31a3bc9)

    quota: dict-quota was broken by 464db6d9d

    We can't assume that the quota_root given to quota_count() is 
    count_quota_root, because dict_quota_root also calls it.

M	src/plugins/quota/quota-count.c

2016-04-29 18:58:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1548608)

    quota: Cleanup - split quota_over_flag to init & run parts

    In preparation for the next change.

M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/quota.h

2016-04-29 18:55:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dcc6ade)

    quota: Fixed debug logging for quota_over_flag


M	src/plugins/quota/quota.c

2016-04-29 18:53:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b312048)

    quota: Fixed quota_over_flag handling when quota usage==limit

    It couldn't really work correctly otherwise. If we've reached the quota, we 
    want to start rejecting new mails.

M	src/plugins/quota/quota.c

2016-04-29 17:21:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b603798)

    quota-count: Cache quota usage within the same ioloop run.

    This mainly means that when both STORAGE and MESSAGES quota is looked up we 
    don't need to calculate them twice.

M	src/plugins/quota/quota-count.c

2016-04-29 17:20:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (316c00c)

    quota-count: Code cleanup - give consistent return value

    Although the callers didn't care if it returned 0 or 1.

M	src/plugins/quota/quota-count.c

2016-04-29 15:50:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (86d26af)

    global: Use buffer_get_writable_size() where possible

    With 09539f3db increasing buffer's init_size with +1 some fts-icu unit tests 
    started failing. And in general it's better to use the writable size since 
    that provides the true size that can be used.

M	src/lib-fts/test-fts-icu.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib/aqueue.c
M	src/lib/str.c

2016-04-29 15:42:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bd3f281)

    quota: Optimize handling a large number of expunges.

    This assumes that the mail_expunge() was called in the same order as 
    sync_notify(), which practically means that they were both done in ascending
    uid order. This is usually true.

M	src/plugins/quota/quota-storage.c

2016-04-29 14:30:46 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (a17f068)

    lib-ldap: Set minimum protocol if supported by library


M	src/lib-ldap/ldap-connection.c

2016-04-29 14:33:45 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ea3a3b6)

    imapc: Fixed EXPUNGE handling when imapc_features didn't have modseq


M	src/lib-storage/index/imapc/imapc-mailbox.c

2016-04-29 14:07:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (31a274e)

    lib-index: Use a bit larger initial records buffer size

    For example with a mailbox having 160k messages the buffer size is around 
    10MB. Adding just 1% more space to it allows a lot more appends before the 
    buffer needs to be realloced. This reduces CPU usage quite a lot.

M	src/lib-index/mail-index-map.c

2016-04-29 13:55:33 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9273e18)

    lib: buffer_create_dynamic() now adds +1 to init_size


M	src/lib/buffer.c

2016-04-29 12:55:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (83373a2)

    lib: Use p_malloc() explicitly in first buffer_alloc()

    Although there is now code in p_realloc() that it should be just as 
    efficient, this makes profiling somewhat nicer since it can better 
    distinguish between actual reallocs and initial allocs.

M	src/lib/buffer.c

2016-04-29 12:54:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (81bbb8e)

    lib: Implement i_realloc(mem==NULL) more efficiently

    Various parts of code use this to allocate the initial buffer. We can do
    this more efficiently by using calloc().

M	src/lib/mempool-system.c

2016-04-29 12:34:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (62219bb)

    lib-index: Memory allocation optimization


M	src/lib-index/mail-index-map.c

2016-04-29 12:44:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2dc8e2d)

    configure: Fixed (again) --with-ldap=plugin


M	configure.ac

2016-04-29 10:53:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (274031f)

    fts-lucene: Fixed crash on rescan

    Broken by af2564c7f9e05ad245a032efdfbc5abbb9b70f1e - rescan_ctx can be NULL.

M	src/plugins/fts-lucene/lucene-wrapper.cc

2016-04-28 14:03:41 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (46f0240)

    lib-charset: Do not use //IGNORE on non-GNU system


M	src/lib-charset/charset-iconv.c
M	src/lib-charset/test-charset.c

2016-04-29 02:33:58 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1885608)

    lib-storage: mailbox_set_subscribed() ignores duplicate changes now.


M	src/lib-storage/mail-storage.c

2016-04-28 15:21:41 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1258409)

    lib-storage: Added index_storage_list_index_has_changed_full()

    This allows the caller to use it to implement a slightly different 
    mailbox.list_index_has_changed()

M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync.c

2016-04-28 12:53:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (65e6f71)

    doveadm dump: Added more index ext records.

    "msgs" and "vsize" are now expanded.

M	src/doveadm/doveadm-dump-index.c

2016-04-27 23:58:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c05c1b4)

    lazy-expunge: Open the mailbox with ACLs ignored.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-04-27 23:47:09 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f184b31)

    lazy-expunge: Open mailbox with MAILBOX_FLAG_SAVEONLY flag.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-04-19 19:24:52 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (9243e07)

    man: Add more complete description of one-way sync


M	doc/man/doveadm-sync.1.in

2016-04-26 21:07:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4ad29d8)

    fts: Empty "fts" setting should be same as nonexistent.


M	src/plugins/fts/fts-storage.c

2016-04-26 17:12:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a82c823)

    stats: Support multiple FIFO listeners.


M	src/stats/fifo-input-connection.c
M	src/stats/fifo-input-connection.h
M	src/stats/main.c

2016-04-26 11:12:45 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9de3ff6)

    doveadm -u: Use mail_storage_service_all_init_mask()


M	src/doveadm/doveadm-mail.c

2016-04-26 11:11:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d5804a0)

    lib-storage: Added mail_storage_service_all_init_mask()

    This allows providing a usermask hint to the userdb iteration lookup. For
    example with LDAP this allows setting the base based on the @domain.

M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2016-04-26 11:10:35 +0300 Baofeng Wang <baofeng.wang@dovecot.fi> (c87684e)

    lib-storage: fixup the broken search result with \seen or \delete

    remove side effects of match_always flag during search.

M	src/lib-storage/index/index-search.c

2016-04-26 10:31:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6956285)

    lib-sql: Fixed building Cassandra as plugin


M	src/lib-sql/Makefile.am

2016-04-25 20:14:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (53d07fb)

    fts-lucene: Rescan skipped namespace roots.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2016-04-25 20:13:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (70d2103)

    fts-lucene: Cleanup - move code to a separate function


M	src/plugins/fts-lucene/lucene-wrapper.cc

2016-04-25 16:58:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ad09af2)

    lib-mail: More fixes to istream-header-filter with large input.

    Don't assume that when reading the header the second time we'll get exactly 
    the same header blocks as the first time.

    This commit also prevents the filter callback from switching the 
    matching-decision on non-first header line. This shouldn't be needed and it 
    could just cause confusion. (It also made it a bit easier to implement this 
    fix.)

M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-04-25 16:34:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5fdca8e)

    lib-mail: Improved istream-header-filter unit test.

    Existing code already assumes that the callback is called for all the header 
    data. So it's not used just for filtering headers but also parsing the 
    header contents. Make this assumption now explicit as a unit test.

M	src/lib-mail/test-istream-header-filter.c

2016-04-25 16:25:46 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d7524cf)

    lib-mail: istream-header-filter didn't limit memory usage.

    A large header was always added to hdr_buf, ignoring any max_buffer_size 
    limits.

M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-04-25 16:22:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (30ad986)

    lib-mail: Code cleanup to istream-header-filter unit test

    The exclude_headers arrays were used in a confusing way. The X-Drop header 
    wasn't actually even used in the exclude_headers.

M	src/lib-mail/test-istream-header-filter.c

2016-04-25 14:38:35 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7919e95)

    dsync: If state is invalid, exit with code 2 instead of tempfail.

    We'll have dsync_mailbox_import_*() just return success to everything until
    _deinit() is called. The _deinit() will return a failure and set "resync 
    needed"-flag, which caller will know how to handle.

M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2016-04-25 14:35:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (da0b62e)

    dsync: If full resync is requested, return empty state string.

    If the state is wrong, it's better to fully resync all the mailboxes rather 
    than just the one where a problem was noticed.

M	src/doveadm/dsync/dsync-brain.c

2016-04-25 14:08:37 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (69811d9)

    dsync: Improved detecting state state string.


M	src/doveadm/dsync/dsync-mailbox-import.c

2016-04-15 16:12:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c7ea86d)

    lib-storage: Don't use same session ID for multiple
    mail_storage_service_next() calls.

    dsync does multiple mail_storage_service_next() calls for the same 
    mail_storage_service_user. This causes stats plugin to send the same session
    ID to stats process, which complains about duplicates. Solved this in a
    generic way by having the following mail_storage_service_next() calls append
    :counter to session ID.

M	src/lib-storage/mail-storage-service.c

2016-04-11 17:25:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e534a82)

    fs-posix: If link() fails, preserve its errno through the following unlink()


M	src/lib-fs/fs-posix.c

2016-04-11 17:20:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b7d31e7)

    fs-posix: Minor code cleanup - removed unnecessary code.

    If success==TRUE, temp_path==NULL always also.

M	src/lib-fs/fs-posix.c

2016-04-22 19:37:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0bbaf39)

    cassandra: Added num_threads, connect_timeout and request_timeout settings.


M	src/lib-sql/Makefile.am
M	src/lib-sql/driver-cassandra.c

2016-04-21 19:18:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (4968bfa)

    lib-dovecot: Avoid duplication of listing *.la in both Makefile.am and
    configure


M	configure.ac
M	src/lib-dovecot/Makefile.am

2016-04-21 18:58:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2a81294)

    lib-dict: Moved dict-ldap to lib-dict-extra

    This also allows moving lib-ldap away from LIBDOVECOT_SUBDIRS in 
    src/Makefile.am, which was wrong because it's not really part of 
    libdovecot.la.

M	src/Makefile.am
M	src/lib-dict-extra/Makefile.am
R100	src/lib-dict/dict-ldap-settings.c	src/lib-dict-extra/dict-ldap-settings.c
R100	src/lib-dict/dict-ldap-settings.h	src/lib-dict-extra/dict-ldap-settings.h
R100	src/lib-dict/dict-ldap.c	src/lib-dict-extra/dict-ldap.c
M	src/lib-dict/Makefile.am

2016-04-21 18:51:57 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bfbb24b)

    Split parts of lib-dict into lib-dict-extra.

    Otherwise there's a circular dependency because lib-dict/dict-fs.c depends 
    on lib-fs, while lib-fs/fs-dict.c depends on lib-dict. This becomes a
    problem when compiling --without-shared-libs, although for some reason it
    works for me while linking the Dovecot core, but not when linking external
    plugins.

M	configure.ac
M	src/Makefile.am
A	src/lib-dict-extra/Makefile.am
R100	src/lib-dict/dict-fs.c	src/lib-dict-extra/dict-fs.c
R100	src/lib-dict/dict-register.c	src/lib-dict-extra/dict-register.c
M	src/lib-dict/Makefile.am
M	src/lib-dovecot/Makefile.am

2016-04-19 19:08:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cfb90f1)

    doveadm user: Added -e <value> parameter to expand %variables in <value>

    This allows expanding any %variable that the mail processes normally expand. 
    For example:

    % doveadm user -e "%u's home is %h" testuser@example.com 
    testuser@example.com's home is /var/mail/testuser@example.com

M	src/doveadm/doveadm-auth.c

2016-04-19 19:07:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ed2e2ac)

    doveadm user: Code cleanup - move field printing to its own function.

    No functional changes.

M	src/doveadm/doveadm-auth.c

2016-04-22 18:35:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c6f4412)

    lib-mail: Improved test-message-parser further


M	src/lib-mail/test-message-parser.c

2016-04-22 18:28:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8062281)

    lib-mail: Fixed inner MIME part boundary being a prefix of outer boundary.


M	src/lib-mail/message-parser.c
M	src/lib-mail/test-message-parser.c

2016-04-22 18:15:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (55a79cf)

    lib-mail: Fixed handling duplicate boundary prefixes.

    If inner MIME part had the same --boundary prefix as its parent(s) and the
    MIME part body started with the inner --boundary prefix, we didn't yet have
    it in the list of valid boundaries, so we thought that the outer boundary
    was found and the MIME headers were truncated. But due to an extra bug we
    still treated it as if it were the inner boundary, except the MIME part
    sizes/offsets were set wrong.

    This for example fixes a situation where FETCH [1.2.MIME] returns an extra 
    newline before the actual headers.

M	src/lib-mail/message-parser.c
M	src/lib-mail/test-message-parser.c

2016-04-22 16:39:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ff1f515)

    dsync: Fixed assert-crash in rename algorithm

    Fixes a crash: Panic: file dsync-mailbox-tree-sync.c: line 1308
    (sync_mailbox_child_dirs): assertion failed: (!node_is_existent(local_node))

M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2016-04-22 16:28:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (66da586)

    dsync: Determine better when rename-algorithm might have gotten stuck.

    A hardcoded value of 100 isn't necessarily enough if there are a lot of 
    mailboxes with a lot of renames. Base the max count on the total number of
    mailboxes on both local and remote. And just in case multiple it by 3. 
    Probably smaller number would be fine too.

M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2016-04-22 16:25:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (412fb67)

    dsync: Fixed crash when rename algorithm thinks it has gone to infinite
    loop.

    ctx->brain was NULL, so trying to access it crashed.

M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2016-04-21 17:55:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (973c6d6)

    lib-fs: fs-metawrap stat() and get_metadata(): use existing istream if
    possible

    This may reduce reads from parent fs, but it's at least required for the 
    following commit.

M	src/lib-fs/fs-metawrap.c

2016-04-21 17:54:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5c20139)

    lib-fs: Added initial fs-metawrap unit test.


M	src/lib-fs/Makefile.am
A	src/lib-fs/test-fs-metawrap.c

2016-04-21 17:52:44 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (bdff783)

    lib-fs: Added fs-test backend for helping with creation of fs-wrapper unit
    tests.


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
A	src/lib-fs/fs-test.c
A	src/lib-fs/fs-test.h

2016-04-20 23:01:45 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (06c3262)

    lib: var_expand() now expands %{nonexistent} to
    UNSUPPORTED_VARIABLE_nonexistent

    Earlier it was expanded to "nonexistent}", which looked more like a bug. 
    This change hopefully makes it clear enough to understand when a variable
    isn't supported.

M	src/lib/test-var-expand.c
M	src/lib/var-expand.c

2016-04-21 21:45:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (de73aa2)

    lib-ssl-iostream: Return stacked errors as single combined string.

    Instead of logging stacked errors as separate log lines, which don't provide 
    any context of what created them.

M	src/lib-ssl-iostream/iostream-openssl-common.c

2016-04-19 16:55:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2f1be1f)

    lib-http: Include information about number of request attempts and its
    timing in response reason.

    Because the reason is usually logged as part of the error string, this 
    causes all of the error messages to include the attempts count and how long 
    the requests took in total. This should make it easier to understand
    problems in error logs.

    http_client_request_set_preserve_exact_reason() can be used to disable 
    modifying the reason string. This may also apply to other reason 
    modifications that may be done in the future.

M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2016-04-22 16:00:36 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2335ab1)

    push-notification: Small optimization - don't lookup uidvalidity for each
    message.


M	src/plugins/push-notification/push-notification-txn-msg.c

2016-04-22 00:21:12 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (11c704a)

    imapc: Added support for imapc_features=modseq

    If the remote server supports CONDSTORE or QRESYNC extensions we'll use the 
    remote's MODSEQ and HIGHESTMODSEQ counts.

    There are some situations where the HIGHESTMODSEQ isn't updated exactly 
    correctly on an open mailbox, so this feature shouldn't be fully relied on. 
    It was primarily implemented for dsync+imapc support - both for preserving 
    modseqs and also for HIGHESTMODSEQ lookups.

M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2016-04-22 20:31:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (58e4e5b)

    lib: Fix to previous istream-timeout commit

    The one commit I didn't bother putting through all the automated testing 
    stages and I of course forgot to even compile after the last change :(

M	src/lib/istream-timeout.c

2016-04-22 20:10:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (81672c7)

    lib: Improved istream-timeout error message.

    We're supposed to check that timeout isn't triggered after a long-running 
    code, but it's not perfect. So provide the actual timing information we saw
    instead of the expected timeout.

M	src/lib/istream-timeout.c

2016-04-17 21:15:30 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ceefe5b)

    cassandra: Added support for user and password settings.


M	src/lib-sql/driver-cassandra.c

2016-04-21 21:41:23 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b9e1531)

    lib-ssl-iostream: Fixed reporting errors returned by OpenSSL.

    We were always logging all errors as "Stacked error" and then returning
    "Unknown error".

M	src/lib-ssl-iostream/iostream-openssl-common.c

2016-04-15 23:59:24 +0200 Stephan Bosch <stephan@dovecot.fi> (2a99688)

    lib-http: client: Implemented means to set request payload buffer rather
    than an input stream.

    This is not purely a convenience function: there have been bugs caused by
    allocating a data input stream from a datastack buffer. With this function,
    the buffer is copied to the request pool, so that it is durably allocated
    while the request exists. This prevents futher mishaps. The server already
    has an equivalent function for its response object.

M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2016-04-20 19:34:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (7ce6777)

    zlib: Compiling fix to a1630a3b3 - don't return a void function


M	src/plugins/zlib/zlib-plugin.c

2016-04-20 17:10:17 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a6a14c7)

    lazy-expunge: Fixed using a mailbox (instead of namespace) as lazy_expunge
    destination.

    The initial implementation in f2d7ae020bda762f78e8e639a69fb129230cbb7d was 
    completely broken.

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-04-20 02:23:31 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (61c30c7)

    lib-index: If opening a cache file fails, try again later.

    The previous code would never retry opening the cache file within the same 
    session.

M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache.c

2016-04-20 00:29:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (06bed4f)

    lib-index: Fixed calling mail_cache_open_and_verify() on an already open
    cache.

    This was done at least by index_index_rebuild_init().

    Either the currently open cache->fd was leaked, or if the cache file open() 
    failed we left the cache in an inconsistent state where cache->fd == -1, but 
    cache->hdr != NULL, so it caused MAIL_CACHE_IS_UNUSABLE() to also be TRUE.
    This could have ended up in an assert:

    Panic: file mail-index-lock.c: line 31 (mail_index_lock_fd): assertion
    failed: (MAIL_INDEX_IS_IN_MEMORY(index))

M	src/lib-index/mail-cache.c

2016-04-20 02:47:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (31349fd)

    zlib plugin: Make sure we don't keep mail istream referenced after mail is
    closed.


M	src/plugins/zlib/zlib-plugin.c

2016-04-14 19:04:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b1c7419)

    lazy-expunge: Allow lazy_expunge setting to point to a mailbox in any
    namespace.

    This way we can use an existing namespace without having to create a new one 
    just for a single lazy_expunge mailbox.

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-04-18 16:40:49 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8828071)

    lib: Implement utc_mktime() with timegm() if it exists.

    It should be more efficient than repeatedly calling gmtime() many times.

M	configure.ac
M	src/lib/utc-mktime.c

2016-04-19 11:55:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d1e4867)

    auth: Added passdb/userdb { auth_verbose } setting.

    If this is explicitly set to yes or no, it overrides the global auth_verbose 
    setting. However, auth_debug=yes overrides all of the auth_verbose settings.

M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h

2016-04-19 16:59:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6d85cb1)

    lib-storage: Added MAIL_STORAGE_CLASS_FLAG_NO_LIST_DELETES and
    MAILBOX_LIST_FLAG_NO_DELETES


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.h

2016-04-15 14:51:42 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (40e5747)

    stats plugin: stats_notify_path can now specify path to the stats-mail FIFO


M	src/plugins/stats/stats-plugin.c

2016-04-15 15:01:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (14e2d75)

    lib-stats: Handle better write() to stats process failing with EAGAIN

    It only means that the stats process is too busy and the FIFO is filled up. 
    Retrying the write later should work. We also don't want to log too much
    about the same warning, so do it only once per 30 seconds.

M	src/lib-stats/stats-connection.c

2016-04-13 23:12:00 +0200 Stephan Bosch <stephan@rename-it.nl> (6da64a8)

    lib-http: server: Prevent aborting finished or already aborted requests
    again.


M	src/lib-http/http-server-request.c

2016-04-13 17:19:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b025075)

    configure: Fixed building lib-ldap / dict-ldap --with-ldap=plugin


M	configure.ac

2016-04-13 17:17:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (c6f4485)

    lib-dict: Don't build dict-ldap if --with-ldap=no


M	src/lib-dict/Makefile.am

2016-04-13 13:47:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (ee73d96)

    doveconf: Improved the warning message about global setting not overriding a
    filter


M	src/config/config-parser.c

2016-04-13 11:22:12 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (45fee9d)

    lib-dict: Disable debug log unless debug enabled


M	src/lib-dict/dict-ldap.c

2016-04-13 11:01:29 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d3be014)

    lib-ldap: Allow disabling of TLS


M	src/lib-dict/dict-ldap-settings.c
M	src/lib-dict/dict-ldap-settings.h
M	src/lib-dict/dict-ldap.c
M	src/lib-ldap/ldap-client.h
M	src/lib-ldap/ldap-connection.c

2016-04-11 22:56:40 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (ccaab3d)

    lib-dict: Add option to enforce SSL


M	src/lib-dict/dict-ldap-settings.c
M	src/lib-dict/dict-ldap-settings.h
M	src/lib-dict/dict-ldap.c

2016-04-11 22:56:37 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (77475f6)

    lib-ldap: Hard fail when SSL is required


M	src/lib-ldap/ldap-connection.c

2016-04-11 20:44:41 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (0f01489)

    lib-ldap: Allow and warn insecure LDAP connection


M	src/lib-ldap/ldap-client.h
M	src/lib-ldap/ldap-connection.c

2016-04-11 20:32:55 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (5a48906)

    lib-ldap: Remove callback from connection_connect


M	src/lib-ldap/ldap-connection.c
M	src/lib-ldap/ldap-private.h

2016-04-11 17:29:35 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (dd8dbd1)

    lib-dict: Reuse LDAP connections


M	src/lib-dict/dict-ldap.c

2016-04-11 17:29:02 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (3b84023)

    lib-ldap: Max idle time is seconds


M	src/lib-dict/dict-ldap.c
M	src/lib-ldap/ldap-client.h
M	src/lib-ldap/ldap-connection.c

2016-04-11 17:27:31 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (d4a4ddf)

    lib-ldap: Do not call NULL callback


M	src/lib-ldap/ldap-connection.c

2016-04-12 21:22:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (76a58bc)

    lib: Moved enum iostream_rawlog_flags to public iostream-rawlog.h

    This allows using [io]stream-rawlog.h APIs directly.

M	src/lib/iostream-rawlog-private.h
M	src/lib/iostream-rawlog.h

2016-04-12 20:00:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (d1eec04)

    lib: Added ostream-null


M	src/lib/Makefile.am
A	src/lib/ostream-null.c
A	src/lib/ostream-null.h

2016-04-12 16:48:34 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (f7cc532)

    lib-storage: Fixed crash when using SEARCH INTHREAD

    mail_search_args_init() -> mail_search_args_simplify() -> .. -> 
    mail_search_arg_one_equals(), which assumed SEARCH_INTHREAD was already 
    initialized.

M	src/lib-storage/mail-search.c

2016-04-10 14:41:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (87404ea)

    doveconf: Log a warning if a global setting is updated after it was already
    set inside a filter

    For example:

    protocol imap {
     mail_plugins = $mail_plugins imap_quota
    } mail_plugins = $mail_plugins quota

    Will result in:

    doveconf: Warning: dovecot.conf line 4: Global setting mail_plugins won't 
    change the setting inside an earlier filter at dovecot.conf line 2

M	src/config/config-parser-private.h
M	src/config/config-parser.c

2016-04-10 14:39:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6347bb6)

    doveconf, config: Free all memory at deinit


M	src/config/config-parser.c
M	src/config/config-parser.h
M	src/config/doveconf.c
M	src/config/main.c

2016-04-06 14:45:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (06116e6)

    imapc: Mark most of the commands retriable.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c

2016-04-06 14:44:00 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (461bcfc)

    imapc: If root separator lookup fails, fail all further lookups.

    We already returned a potentially wrong separator (since there's no way to 
    return error), so we don't want to continue and possibly make things worse.

M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h

2016-04-06 14:43:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2a7a7f6)

    imapc: Added missing error handling to subscriptions list refreshing.


M	src/lib-storage/index/imapc/imapc-list.c

2016-04-06 14:41:16 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e74f4af)

    imapc: Fixed mailbox_exists() error handling.


M	src/lib-storage/index/imapc/imapc-storage.c

2016-04-06 14:24:21 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e4020d1)

    imapc: Support retrying after connect() failure.


M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2016-04-06 14:17:02 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (1e85b60)

    imapc: Support retrying after connect/authentication timeouts.


M	src/lib-imap-client/imapc-connection.c

2016-04-06 14:16:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3153bce)

    imapc: Support retrying for non-mailbox commands.


M	src/lib-imap-client/imapc-connection.c

2016-04-06 14:12:25 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (b60daa2)

    imapc: Prepare for non-mailbox command retrying: Set reconnect_command_count
    earlier

    This probably doesn't fix itself anything yet, but is needed for the 
    following changes.

M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2016-04-06 14:09:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5e02162)

    imapc: Fixed checking of whether same IMAP command keeps crashing server.

    reconnect_command_count was counting only the post-login commands, but we 
    were decreasing it also for pre-login commands. This caused it to shrink to 
    0 too early.

M	src/lib-imap-client/imapc-connection.c

2016-04-06 14:05:26 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (5ba8e64)

    imapc: Code cleanup - imapc_connection_reconnect() is now always called when
    reconnect is ok.


M	src/lib-imap-client/imapc-client.c

2016-04-06 14:03:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (8cd9a12)

    imapc: Code cleanup - Use a common function for checking/logging if we want
    to reconnect or disconnect


M	src/lib-imap-client/imapc-connection.c

2016-04-06 13:52:24 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0e2e526)

    lib-storage: Fixed error handling for mailbox_list_iter_init_namespaces()

    If iteration for the first namespace failed, we tried to copy the error 
    string to error_list, which was the same first namespace's list. This caused 
    the error string to be freed while it was being copied, so the end result 
    was that the error became either an empty or garbage string.

M	src/lib-storage/list/mailbox-list-iter.c

2016-04-06 12:41:38 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (03af8e5)

    dsync: Don't export header hashes if remote mailbox is empty.

    This avoids doing a lot of work of reading through all mails' headers and 
    hashing them, when the hashes aren't actually going to be used for anything.

M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h

2016-04-12 11:42:38 +0200 Stephan Bosch <stephan@rename-it.nl> (a1ffc40)

    lib-http: server: Fixed bug in request reference counting caused by earlier
    fix (390b600a6f7fdb4ccc65950527ee30129f49a6ac).

    The earlier change erroneously dropped two lines that unreferenced the
    request object after calling the callback.

M	src/lib-http/http-server-connection.c

2016-04-12 10:49:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a8f11f9)

    lib-master: Fixed assert-crash when HAProxy aborts connections.

    close() was called before io_remove(), which resulted in:

    Panic: epoll_ctl(del, 14) failed: Bad file descriptor

M	src/lib-master/master-service-haproxy.c

2016-04-11 12:24:59 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cc5493d)

    dict-ldap: Compiler warning fix


M	src/lib-dict/dict-ldap.c

2016-04-11 09:40:22 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (1af8b31)

    lib-dict: Add ldap driver


M	src/lib-dict/Makefile.am
A	src/lib-dict/dict-ldap-settings.c
A	src/lib-dict/dict-ldap-settings.h
A	src/lib-dict/dict-ldap.c

2016-04-11 09:38:27 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b4c47b7)

    configure: Add lib-ldap


M	configure.ac
M	src/Makefile.am

2016-04-11 09:37:39 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (844129d)

    lib-ldap: Add lib-ldap implementation


A	src/lib-ldap/Makefile.am
A	src/lib-ldap/ldap-client.c
A	src/lib-ldap/ldap-client.h
A	src/lib-ldap/ldap-compare.c
A	src/lib-ldap/ldap-connection.c
A	src/lib-ldap/ldap-entry.c
A	src/lib-ldap/ldap-iterator.c
A	src/lib-ldap/ldap-private.h
A	src/lib-ldap/ldap-search.c

2016-04-10 14:57:48 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9a69030)

    lib-master: Fixed memory leaks when failing to read settings.


M	src/lib-master/master-service-settings.c

2016-04-07 17:50:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e3367d7)

    virtual plugin: struct mail_vfuncs.close() wasn't implemented.

    This wasn't a problem normally, because the core code wouldn't try to call 
    this. It became a problem only after other plugins were trying to call it.

M	src/plugins/virtual/virtual-mail.c

2016-04-07 16:35:28 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (9f41af1)

    lib-master: Preserve LOG_STDERR_TIMESTAMP environment through doveconf exec.

    This should be needed only for standalone programs, so don't bother trying 
    to preserve it otherwise.

M	src/lib-master/master-service-settings.c

2016-04-05 20:14:15 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (aeea3db)

    lmtp: Use separate session ID suffixes for each RCPT TO delivery.

    Otherwise each delivery will use the same session ID when talking to stats 
    process, which results in errors like:

    Error: stats: FIFO input error: CONNECT: Duplicate session ID
    ME3ZHCi+A1dUDQAAvAUe3g for user foobar service lmtp Warning: stats: Couldn't
    find session ID: ME3ZHCi+A1dUDQAAvAUe3g

    (There was a DISCONNECT for the session ID between these two log lines.)

M	src/lmtp/client.h
M	src/lmtp/commands.c

2016-04-05 20:10:53 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6cb874b)

    lib-storage: Changed separator between session_id_prefix and unique part to
    be ':'

    Although '-' wasn't used by default either, it's much more likely that 
    custom session IDs might contain it. ':' is hopefully less likely to be
    used. This allows log parsers that actually want to find out the original
    session's all log lines to cut out everything after the initial ':'.

M	src/lib-storage/mail-storage-service.c

2016-04-06 22:43:52 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a50f8b9)

    lmtp: Changed default LMTP proxy timeout to 125 seconds.

    The main problem with LMTP proxy timing out too early is that it causes 
    duplicates if the backend actually finishes the mail delivery.

    The 30 seconds is bad, because there are various timeouts in backend set to
    30 seconds also. 125 seconds is hopefully large enough to hit most of the 2
    minute timeouts and we'll have a few extra seconds left to see the failure.

M	src/lmtp/commands.c

2016-04-06 22:12:54 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (53c4294)

    doveadm sync: -R parameter shouldn't switch to "doveadm backup -R" behavior.

    Just ignore the -R parameter for doveadm sync, unless -1 parameter is also 
    used. Alternatively we could also fail the command, but maybe that's 
    unnecessary extra work.

M	src/doveadm/doveadm-dsync.c

2016-04-06 22:08:14 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (eba17ec)

    doveadm: Reverted 7a3b52b8f - doveadm sync -1 -R is useful.


M	src/doveadm/doveadm-dsync.c

2016-04-06 20:19:04 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (2fb829d)

    dict-redis: When timeout was reached, we didn't actually stop but just
    continued waiting.


M	src/lib-dict/dict-redis.c

2016-04-04 21:05:44 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (b0b6999)

    doveadm-http: Fix mismatch in authorization

    The code advertizes X-Dovecot-API in WWW-Authenticate header, but expects
    X-Doveadm-API in Authorization header. This change makes it expect
    X-Dovecot-API.

M	src/doveadm/client-connection-http.c

2016-04-05 19:59:18 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e82efb3)

    imapc: If we get disconnected during SELECT/EXAMINE, retry it once.

    This seems to be happening especially with dsync migrations from IMAP 
    servers with small timeouts. The initial dsync run opens imapc connection 
    early to do a LIST + SELECT the first mailbox, but then dsync may spend a 
    while creating all the local mailboxes before it continues using the imapc 
    connection.

M	src/lib-imap-client/imapc-client.c
M	src/lib-storage/index/imapc/imapc-storage.c

2016-04-05 16:26:08 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (dca6152)

    fts-tika: Don't crash on 500 errors (caused by 146f6f85d)

    http_req=NULL here set by http_client_request_send_payload(). Even if it 
    wasn't, the payload wouldn't be there.

M	src/plugins/fts/fts-parser-tika.c

2016-04-05 12:05:15 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (76537b1)

    doveadm-proxy: Change to work with doveadm ver2


M	src/doveadm/doveadm-proxy.c

2016-04-04 12:22:06 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6fbc1a2)

    lib-storage: FS layout assert-crashed when trying to list with invalid UTF8
    pattern


M	src/lib-storage/list/mailbox-list-fs-iter.c

2016-04-04 11:11:13 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (05e8b3e)

    lib: Updated fdpass.h comments.


M	src/lib/fdpass.h

2016-04-03 22:54:17 +0200 Stephan Bosch <stephan@rename-it.nl> (d17a99d)

    istream-unix: Fixed handling of EOF from fd_read() (ret==0).

    This situation was ignored.

M	src/lib/istream-unix.c

2016-03-31 16:35:06 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (4adefdb)

    quota: Fix NetBSD build.


M	src/plugins/quota/quota-fs.c

2016-03-31 12:41:25 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (9ba5c49)

    doveadm-mail: Honor -u flag on v1 commands


M	src/doveadm/doveadm-mail.c

2016-03-30 16:24:56 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (a2fdfd2)

    doveadm-server: Register builtin dict drivers always at init

    This was already done for doveadm. Fixes using doveadm dict commands via 
    doveadm-server.

M	src/doveadm/main.c

2016-03-30 13:14:40 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (c3ffcb7)

    doveadm-mail: Initialize missing cmd context username

    Fixes assert-crash in doveadm_mail_single_user()

M	src/doveadm/doveadm-mail.c

2016-03-30 10:51:50 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (0be3a0d)

    lib-storage: Fixed memory leak when iterating attributes.


M	src/lib-storage/mailbox-attribute.c

2016-03-30 10:34:06 +0300 Aki Tuomi <aki.tuomi@dovecot.fi> (4af926f)

    doveadm-mail: Don't lose rip/lip/lport/rport in passdb lookups for doveadm
    TCP connections


M	src/doveadm/doveadm-mail.c

2016-03-30 08:24:51 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (002eaed)

    director: Avoid a potential assert-crash after removing a director from
    ring.

    This should fix the crash: Panic: director: file director-connection.c: line
    1926 (director_connection_init_out): assertion failed: (!host->removed)

    Also moved the last_network_failure timestamp reset a bit later, since 
    there's no need to reset the timestamp if we're not actually connecting to
    the server.

M	src/director/director-connection.c

2016-03-29 21:17:22 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (315aa3c)

    doveadm: Fixed reading USER environment for v1 commands.


M	src/doveadm/doveadm-mail.c

2016-03-29 20:38:19 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (969f57f)

    imapc: Don't try to FETCH uncommitted mails, because it would attempt to
    FETCH uid=0


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2016-03-29 15:17:29 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (e052c22)

    auth: Disable auth caching for passwd-file

    Its caching is usually unnecessary, because the passwd-files are efficiently 
    in memory already. It's also problematic, because extra_fields can contain
    %variables, which can be lookup-dependent. So for example if %{lport} is
    used in extra_fields, it would need to be included in the cache key. But
    because different variables can be used by different users' extra_fields,
    there's really no good way to include all of it in the cache key.

M	src/auth/passdb-passwd-file.c
M	src/auth/userdb-passwd-file.c

2016-03-29 15:04:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (3e25053)

    doveadm-batch: Fixed error message for an unknown subcommand.


M	src/doveadm/doveadm-mail-batch.c

2016-03-29 14:57:20 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (edbc6fe)

    doveadm: Fixed adding username header to commands iterating through multiple
    users.


M	src/doveadm/doveadm-mail.c

2016-03-29 14:17:01 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (32e1486)

    doveadm-server: v2 mail commands weren't doing a userdb lookup.


M	src/doveadm/doveadm-mail.c

2016-03-29 14:10:10 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (6a8c95b)

    doveadm-server: Fixed running multi-word commands.

    The problem with for example "mailbox status" command is that:
    - doveadm cli: argv[0] = "mailbox", argv[1] = "status"
    - doveadm-server: argv[0] = "mailbox status"

    So with doveadm cli we'll now instead just skip over words until argv[0] is
    the last word of the command ("status").

M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail-batch.c

2016-03-29 14:06:43 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (36a052b)

    doveadm: Code cleanup - always use const char *const[] type for argv.

    Needed to fix compiler warnings in the following patch.

M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm.c

2016-03-29 12:15:05 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (cbaac1e)

    login-proxy: When logging failures, include the client info prefix.


M	src/login-common/client-common-auth.c
M	src/login-common/login-proxy.c

2016-03-29 11:28:55 +0300 Timo Sirainen <timo.sirainen@dovecot.fi> (200b024)

    login-*: When logging about client certificate validity, include the client
    info prefix.


M	src/login-common/ssl-proxy-openssl.c

2016-03-25 03:01:00 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (090c9c2)

    auth: If user is unknown and there are more passdbs/userdb, log about it.


M	src/auth/auth-request.c

2016-03-25 02:48:55 +0900 Stephan Bosch <stephan@rename-it.nl> (173d538)

    lib-http: client: Fixed request timeout handling during pipelining.

    The timeout was not managed correctly. If an earlier request finished, it 
    would not restart the timeout for the next pending request.

    Also, filling the pipeline caused the timout to be reset inappropriately, 
    postponing its expiry.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2016-03-25 02:47:28 +0900 Stephan Bosch <stephan@rename-it.nl> (8cf6363)

    lib-http: client: Fixed handling of stalled connections that emerge when the
    client ioloop hasn't run for a long time.

    Inside the peer's request handler routine, the connections are verified 
    after the ioloop continues. If they turn out to be broken, they 
    self-destruct while the handler routine is active, leading to problems.

    Solved by referencing the connection and retrying the connection statistics 
    loop when a connection is lost in the process.

M	src/lib-http/http-client-peer.c

2016-03-25 00:45:54 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (4f9855b)

    Set postmaster_address=%d by default because imap now loads lda settings and
    it must be non-empty.

    We don't want imap to suddenly start failing because of the c15e8f33c 
    change. This isn't a perfect solution either, but should be ok enough.

M	src/lib-lda/lda-settings.c

2016-03-24 10:07:15 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (afbc622)

    director: Make sure freeing a user doesn't leak a timeout.


M	src/director/user-directory.c

2016-03-24 10:01:17 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (6f8d511)

    director: Fixed memory leak when killing a user.


M	src/director/director.c

2016-03-24 10:00:00 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (488d921)

    director: Make sure a long-delayed kill reply for user doesn't mess up the
    state.

    This should fix assert-crash:

    director: Panic: file director.c: line 690
    (director_user_kill_finish_delayed_to): assertion failed:
    (ctx->user->kill_state == USER_KILL_STATE_DELAY)

M	src/director/director.c

2016-03-24 09:43:43 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (5897c88)

    director: Small improvements to director-test.sh

    Test with a bigger director ring. Include microseconds in log timestamps to 
    make debugging easier. Changed the name of the info_log_path.

M	src/director/director-test.sh

2016-03-24 09:42:50 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (58b8a30)

    director: Don't re-send SYNC unnecessarily often.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h

2016-03-24 09:36:14 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (f8c57c3)

    director: Fixed user weakness getting stuck if multiple directors set user
    weak simultaneously


M	src/director/director-connection.c

2016-03-23 23:33:49 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (a986ef3)

    pop3-login: XCLIENT / XOIP no longer return -ERR for untrusted IP ranges.

    The command is simply ignored, similarly to imap-login ID.

M	src/pop3-login/client.c

2016-03-23 09:01:31 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (6199949)

    doveadm: Move getenv to correct place

    All getenv()s must be done after master_service_init() or the pointer will
    be corrupted with Linux and other OSes without setproctitle().

M	src/doveadm/doveadm.c

2016-03-22 01:16:26 +0100 Stephan Bosch <stephan@rename-it.nl> (c15e8f3)

    imap: Made LDA settings accessible from plugins.

    This way, plugins can also send mail.

M	src/imap/Makefile.am
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/main.c

2016-03-22 09:19:45 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fcb8a4a)

    doveadm-server: Fixed initializing username for mail commands.


M	src/doveadm/client-connection.c

2016-03-23 10:08:06 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (7b98fc3)

    doveadm: Getting user from USER environment wasn't done in the right place.

    doveadm_mail_cmdline_init() is also called when parsing commands from 
    doveadm-server. The USER environment is supposed to be read only from 
    doveadm command line.

M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm.c

2016-03-21 22:10:08 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (4a76960)

    lazy-expunge: Fixed crash if lazy_expunge-namespace was not found.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-03-21 21:51:49 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (65d8efa)

    lib: Avoid assert-crash in istream-concat at close.

    If stream was seeked to EOF, cur_input=NULL and closing the stream would
    cause i_stream_concat_skip() to crash. Fixed this by making sure cur_input
    is never NULL. This also adds a check to not allow seeking past EOF, but
    this shouldn't happen anyway.

M	src/lib/istream-concat.c

2016-03-21 21:46:47 +0900 Timo Sirainen <timo.sirainen@dovecot.fi> (4219733)

    lib: Small code cleanup to istream-concat - don't use a magic UINT_MAX value
    as error code


M	src/lib/istream-concat.c

2016-03-11 17:44:41 +1300 Timo Sirainen <timo.sirainen@dovecot.fi> (2586654)

    lib-storage: Support autoexpunging from wildcards mailbox names. For
    example:

    mailbox Trash {
     autoexpunge = 30d
    } mailbox Trash/* {
     autoexpunge = 30d
    }

M	src/lib-storage/mail-autoexpunge.c

2016-03-03 19:55:03 -0700 Michael M Slusarz <michael.slusarz@dovecot.fi> (20ad75b)

    doveadm: Fix typos in error messages


M	src/doveadm/client-connection-http.c

2016-03-11 18:01:33 +1300 Timo Sirainen <timo.sirainen@dovecot.fi> (8281cfd)

    lazy-expunge: If lazy_expunge is set to namespace root, save all mails to
    the root mailbox.

    So the difference is:

    namespace {
     prefix = expunged/
     ..
    } plugin {
     # Move expunged mails to expunged/INBOX, expunged/Trash, etc. mailboxes
     lazy_expunge = expunged/
     # Move all expunged mails to "expunged" mailbox, which is the namespace
    root.
     lazy_expunge = expunged
    }

M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-03-11 17:57:41 +1300 Timo Sirainen <timo.sirainen@dovecot.fi> (eade058)

    lazy-expunge: Code cleanup - move destination mailbox name generation to its
    own function


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2016-03-16 09:27:04 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (998395f)

    lib-fts: Fix unit tests for lib-fts.


M	src/lib-fts/test-fts-tokenizer.c

2016-03-16 16:34:32 +1100 Timo Sirainen <timo.sirainen@dovecot.fi> (7a3b52b)

    doveadm sync: Don't allow -R parameter.

    -R implicitly enabled doveadm backup mode, which wasn't supposed to happen.

M	src/doveadm/doveadm-dsync.c

2016-02-29 19:29:14 +0200 Phil Carmody <phil@dovecot.fi> (b22dcc3)

    plugins: fts-expunge-log - subtraction from and dumping of a flattened log

    This permits you to read a whole expunge log, remove records from the 
    in-memory copy of it, and write it back out to file.

    NOTE: Inefficiently implemented. The hash is effectively rebuilt, this time
    backed by a file, a record at a time, which implies O(n^2) possibilities.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-expunge-log.h

2016-03-12 01:56:55 +0100 Stephan Bosch <stephan@rename-it.nl> (ca270e3)

    lib-http: client: Improved test-http-payload to test partial reading of
    response payload.


M	src/lib-http/http-client-connection.c
M	src/lib-http/test-http-payload.c

2016-03-03 22:29:44 +0100 Stephan Bosch <stephan@rename-it.nl> (641ab76)

    lib-http: server: Improved test-http-payload to test partial reading of
    request payload.


M	src/lib-http/test-http-payload.c

2016-03-03 22:28:47 +0100 Stephan Bosch <stephan@rename-it.nl> (390b600)

    lib-http: server: Fixed handling of partially read request payload.

    This would sometimes cause the server to hang.

M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-request.c

2016-03-15 10:48:31 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (af177be)

    lib-fts: Limit maximum length of addresses found.

    The address tokenizer now takes a "maxlen" parameter, which defaults to 254
    bytes.

    Previously addresses, or something looking like it, could be of any length.
    This could cause trouble in fts backends.

M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/test-fts-tokenizer.c

2016-03-15 10:47:20 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (00544ad)

    lib-fts: Lift helper function out of generic tokenizer.


M	src/lib-fts/Makefile.am
A	src/lib-fts/fts-tokenizer-common.c
A	src/lib-fts/fts-tokenizer-common.h
M	src/lib-fts/fts-tokenizer-generic.c

2016-03-16 10:55:01 +1100 Timo Sirainen <timo.sirainen@dovecot.fi> (613d69e)

    virtual plugin: Fixed off-by-one in virtual_max_open_mailboxes check.


M	src/plugins/virtual/virtual-storage.c

2016-03-16 10:33:26 +1100 Timo Sirainen <timo.sirainen@dovecot.fi> (74bf1be)

    virtual plugin: Don't assert-crash if backend mailbox is recreated while
    virtual mailbox is open.


M	src/plugins/virtual/virtual-sync.c

2016-03-16 10:23:52 +1100 Timo Sirainen <timo.sirainen@dovecot.fi> (5b7ff90)

    virtual plugin: Handle backend mailbox deletion on backend open/sync


M	src/plugins/virtual/virtual-sync.c

2016-03-16 10:17:45 +1100 Timo Sirainen <timo.sirainen@dovecot.fi> (1ce59b0)

    virtual plugin: Code cleanup - remove confusing bbox_index_opened

    It was originally added because mailbox_open() was always called and we 
    wanted to know if the mailbox was open before it. But this code was already 
    removed.

M	src/plugins/virtual/virtual-sync.c

2016-03-16 10:04:32 +1100 Timo Sirainen <timo.sirainen@dovecot.fi> (76fd7aa)

    virtual plugin: If we detect backend box to be deleted, mark it permanently
    deleted.


M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c

2016-03-16 09:30:20 +1100 Timo Sirainen <timo.sirainen@dovecot.fi> (baa93d5)

    dbox: Fixed pop3.order caching for mails without no specified order.


M	src/lib-storage/index/dbox-common/dbox-mail.c

2016-03-11 19:03:34 +1300 Timo Sirainen <timo.sirainen@dovecot.fi> (11120ac)

    doveadm-auth: Added missing code forgotten from commit 208754367


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2016-03-11 18:43:57 +1300 Timo Sirainen <timo.sirainen@dovecot.fi> (6aafdd8)

    auth: Code cleanup - avoid using void *context

    auth_request_callback_t always uses struct auth_client/master_connection* in
    the context - no need to try to be too generic here.

M	src/auth/auth-master-connection.c
M	src/auth/auth-master-connection.h
M	src/auth/auth-request-handler.c
M	src/auth/auth-request-handler.h

2016-03-11 18:37:43 +1300 Timo Sirainen <timo.sirainen@dovecot.fi> (2087543)

    doveadm-auth: If auth_debug setting is enabled, send "debug" field to auth
    lookups.

    The idea is that you could enable auth_debug for specific requests with
    e.g.:

    doveadm -o auth_debug=yes user user@example.com

M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h

2016-03-11 18:37:04 +1300 Timo Sirainen <timo.sirainen@dovecot.fi> (d76a914)

    auth: If auth request contains "debug" field, enable auth_debug=yes for the
    request.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/db-ldap.c
M	src/auth/passdb-imap.c
M	src/auth/userdb-prefetch.c

2016-03-10 14:59:46 +1300 Timo Sirainen <timo.sirainen@dovecot.fi> (3b39022)

    lib-fs: Fixed fs-sis to work again


M	src/lib-fs/fs-posix.c

2016-03-04 16:40:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2839c7c)

    doveadm who: Don't require mask parameter.


M	src/doveadm/doveadm-who.c

2016-03-04 13:12:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e50a729)

    config: Escape regexps properly in settings-get.pl to avoid warnings with
    new Perl


M	src/config/settings-get.pl

2016-03-03 16:10:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (78d33b5)

    fts: Added "doveadm fts tokenize" command.


M	src/plugins/fts/doveadm-fts.c

2016-03-03 11:53:05 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ab00b5d)

    doveadm-http: Fixed crash when no authentication was configured.


M	src/doveadm/client-connection-http.c

2016-03-03 00:15:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5bd1c1d)

    lib-index: After MAIL_INDEX_OPEN_FLAG_SAVEONLY access cache's read_buf
    wasn't always reset.

    This could have caused at least errors like:

    Corrupted index cache file .../dovecot.index.cache: File too small

    I'm not sure if it might have also returned stale data sometimes.

    Easy way to reproduce this bug was: imaptest copy=100 copybox=Trash & 
    imaptest box=Trash append=0

M	src/lib-index/mail-cache.c

2016-03-01 22:11:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d6d9ee1)

    lib-index: Minor code cleanup - removed duplicate function prototype.


M	src/lib-index/mail-cache.h

2016-03-02 20:32:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6e15d56)

    doveadm: Don't treat doveadm_api_key differently when it's unset vs set to
    empty.


M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-settings.c

2016-03-02 17:45:18 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (6a87980)

    doveadm-http: Minor logging improvement - indicate error source


M	src/doveadm/client-connection-http.c

2016-03-02 17:38:40 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (25df2d3)

    doveadm-http: Drop surplus log prefix


M	src/doveadm/client-connection-http.c

2016-03-02 16:08:06 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (51338d9)

    doveadm-http: Set HTTP client's max idletime to 5 seconds


M	src/doveadm/client-connection-http.c

2016-03-02 16:07:51 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (b7c4fe8)

    doveadm-http: For each executed command, log the command name and the user
    parameter if given.


M	src/doveadm/client-connection-http.c

2016-03-02 15:36:38 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2642aad)

    doveadm-http: Improve authentication related code


M	src/doveadm/client-connection-http.c

2016-03-02 11:04:35 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0b36cf1)

    doveadm-http: Code cleanup - Move authorize to its own function


M	src/doveadm/client-connection-http.c

2016-03-02 10:58:37 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (4828337)

    doveadm-http: Add API calls and versioning for v1


M	src/doveadm/client-connection-http.c

2016-03-01 19:37:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e10461a)

    auth: Make password_scheme_encryption_rounds extern to allow plugins to read
    it.


M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.h

2016-03-01 16:07:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3ba6ab5)

    lib: Fixed memory leak io_add_istream()+io_remove() when the stream didn't
    have fd.


M	src/lib/ioloop.c

2016-02-29 22:10:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (153ed0f)

    lib: iostream-temp allows now calling o_stream_seek() on it.


M	src/lib/iostream-temp.c

2016-03-01 01:34:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2029c2c)

    doveadm: A bit nicer way to implement doveadm_cmd_param_array() returning
    C-string array

    So replacement of 4afc67eb9, which I accidentally pushed before remembering 
    about this other way.

M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h

2016-02-28 19:31:10 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (6eb1a7a)

    doveadm-kick: Rewrite to ver2 infra


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-kick.c

2016-02-28 19:25:46 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (633a1bf)

    doveadm-kick: Print kicked usernames via doveadm-print API


M	src/doveadm/doveadm-kick.c

2016-02-28 19:07:03 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (99819ad)

    doveadm-who: Rewrite to ver2 infra


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-who.c

2016-02-28 18:59:35 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a7fc192)

    doveadm kick: Don't show who command's help on duplicate network/username
    masks


M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-who.h

2016-02-28 18:48:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4afc67e)

    doveadm: Changed doveadm_cmd_param_array() to return C-string array instead
    of ARRAY()

    We could support both with separate functions, but perhaps this one is
    enough.

M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h

2016-02-29 17:25:31 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (19f0309)

    doveadm-dict: Use ver2 structures


M	src/doveadm/doveadm-dict.c

2016-02-29 17:13:32 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (aea3116)

    doveadm-dict: Remove i_fatal() usage


M	src/doveadm/doveadm-dict.c

2016-02-29 16:46:02 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (967bcc7)

    doveadm-fs: Use doveadm_print instead of printf


M	src/doveadm/doveadm-fs.c

2016-02-29 13:23:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a18da44)

    doveadm: Renamed long parameter names.


M	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-stats.c

2016-02-29 14:04:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (504f950)

    doveadm mailbox metadata list: Added missing mailbox parameter


M	src/doveadm/doveadm-mail-mailbox-metadata.c

2016-02-29 12:59:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (32223e1)

    lib-storage: Use getuid() instead of geteuid() for checking if we're running
    as root.

    This fixes running multiple doveadm commands for different users. Running 
    mail_storage_service_init() + _deinit() multiple times left euid non-root, 
    which dropped the MAIL_STORAGE_SERVICE_FLAG_TEMP_PRIV_DROP flag.

M	src/lib-storage/mail-storage-service.c

2016-02-29 13:02:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9990080)

    doveadm-server: Drop privileges only temporarily when running mail commands.

    This allows running mail commands for multiple users within the same doveadm 
    connection.

M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-29 10:31:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ec862f5)

    doveadm-http: Fixed crash on unknown commands.

    Also if command had already failed, don't override the existing method_err
    with 403.

M	src/doveadm/client-connection-http.c

2016-02-29 09:35:03 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a81dccf)

    doveadm-mail-index: Use integer parameter type


M	src/doveadm/doveadm-mail-index.c

2016-02-28 22:23:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (489301e)

    lib-storage: When cached mime.parts is detected to be inconsistent, log it
    as hex-encoded.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c
M	src/plugins/fts/fts-build-mail.c

2016-02-28 22:22:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4611418)

    lib-storage: If cached mime.parts is corrupted, log it hex-encoded.


M	src/lib-storage/index/index-mail.c

2016-02-28 22:08:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7cef815)

    lib-mail: message_search_msg() passes through
    message_parser_deinit_from_parts()'s error string


M	src/lib-mail/message-search.c
M	src/lib-mail/message-search.h
M	src/lib-storage/index/index-search.c

2016-02-28 21:07:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8b5b1f6)

    Use mail_set_cache_corrupted_reason() wherever possible.


M	src/imap/imap-fetch-body.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/istream-mail.c
M	src/plugins/fts/fts-build-mail.c

2016-02-28 21:05:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (79ec3f2)

    lib-storage: mail_set_cache_corrupted*() now logs also the mailbox name that
    was corrupted.


M	src/lib-storage/index/index-mail.c

2016-02-28 21:03:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (dd59c7a)

    lib-mail: Minor code cleanup to message_parser_deinit() calls.


M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c

2016-02-28 20:46:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3ef9cfc)

    lib-mail: Added message_parser_deinit_from_parts()

    The returned error strings could still be improved to give more details, 
    especially give an approximate offset of where the problem is.

M	src/lib-mail/message-parser.c
M	src/lib-mail/message-parser.h

2016-02-28 20:19:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6de6ec2)

    lib-storage: Added mail_set_cache_corrupted_reason()


M	src/lib-storage/fail-mail.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/plugins/virtual/virtual-mail.c

2016-02-28 19:57:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (85058e4)

    *-login: If verbose_ssl=yes, make sure all SSL errors are logged.

    They should already be logged in the client's disconnection line, but log 
    them also with debug level just to make sure no errors are lost or 
    overwritten.

M	src/login-common/ssl-proxy-openssl.c

2016-02-28 19:55:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cb999a7)

    lib-ssl-iostream: If verbose=TRUE, internally log all errors.


M	src/lib-ssl-iostream/iostream-openssl.c

2016-02-28 19:51:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (20905b8)

    lib-ssl-iostream: Log all SSL info lines with debug-level.

    They're not logged at all if verbose=FALSE, so they're really debug
    messages.

M	src/lib-ssl-iostream/iostream-openssl.c

2016-02-27 11:36:29 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5592b04)

    doveadm-fs: Use ver2 structures


M	src/doveadm/doveadm-fs.c

2016-02-27 11:13:24 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0746d8c)

    doveadm-cmd: Support non-strings in compat wrapper


M	src/doveadm/doveadm-cmd.c

2016-02-28 18:33:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fa6b2cb)

    doveadm-mail: Rename ctx to mctx to separate from cctx


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c

2016-02-28 18:27:35 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (aaa1b6b)

    doveadm: Changed v2 command APIs to be easier to use.


M	src/doveadm/client-connection-http.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm.c

2016-02-28 18:25:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cabf4c9)

    doveadm: Minor code cleanup - use arg-> instead of argv[i].


M	src/doveadm/doveadm-mail.c

2016-02-26 17:33:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3b75946)

    doveadm: Code cleanup - Removed unnecessary pointer checks.

    Originally for some reason added by e16cdc182.

M	src/doveadm/doveadm-cmd.c

2016-02-26 16:21:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6ab6a7d)

    doveadm: Fixed command parameter handling for doveadm-server.


M	src/doveadm/client-connection.c

2016-02-26 16:05:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8fdec34)

    doveadm: Add more consts to avoid a cast breaking strict-aliasing rules.


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail-batch.c

2016-02-26 15:33:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (da7c6d7)

    doveadm: Fixed parsing field/flag/file parameters.


M	src/doveadm/doveadm-mail.c

2016-02-26 15:25:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (96f35f2)

    doveadm-log: Fixed trimming empty prefixes.

    Too eager (long) cast removal from the original code broke it. Changed to a
    slightly simplified version now.

M	src/doveadm/doveadm-log.c

2016-02-26 14:58:33 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (50e49700)

    doveadm: Pass through mail_storage_service_input fields in
    doveadm_cmd_attributes


M	src/doveadm/client-connection-http.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-26 14:55:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (79bbb90)

    doveadm: Added struct doveadm_cmd_attributes, which is passed around instead
    of argc/argv


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm.c

2016-02-24 13:59:28 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7616a15)

    doveadm-penalty: Convert to ver2 infra


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-penalty.c

2016-02-26 14:38:46 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2d83aa5)

    doveadm-flags: Support giving flags as an array.


M	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail.c

2016-02-25 09:26:39 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (4ae632e)

    doveadm-copymove: Use ver2 structures


M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-26 09:37:06 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (db8b229)

    doveadm: Code cleanup - coding style fixes for doveadm_cmd_param*()
    accessors


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h

2016-02-26 09:33:25 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (79ec87e)

    doveadm-cmd: Add CMD_PARAM_IP


M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h

2016-02-25 12:30:45 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (1a40f0b)

    doveadm-mailbox-status: Fixed declaring and processing args


M	src/doveadm/doveadm-mail-mailbox-status.c

2016-02-25 12:30:33 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (76160a8)

    doveadm: Fully populate mail_cmd in ver2 wrapper


M	src/doveadm/doveadm-mail.c

2016-02-25 10:34:34 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e47f08b)

    doveadm-fts: Use ver2 structures


M	src/plugins/fts/doveadm-fts.c

2016-02-25 10:17:16 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (57a2881)

    doveadm-acl: Use ver2 structures


M	src/plugins/acl/doveadm-acl.c

2016-02-25 09:58:55 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (c874dcb)

    doveadm-search: Use ver2 structures


M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-25 09:54:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (949c397)

    doveadm-purge: Use ver2 structures


M	src/doveadm/doveadm-mail.c

2016-02-25 09:53:37 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f2c25ca)

    doveadm-force-resync: Use ver2 structures


M	src/doveadm/doveadm-mail.c

2016-02-25 09:46:40 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (ae8c89c)

    doveadm-import: Use ver2 structures


M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-25 09:44:04 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a893aaa)

    doveadm-flags: Use ver2 structures


M	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-25 09:39:55 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (977f08d)

    doveadm-expunge: Use ver2 structures


M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-25 09:30:41 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e1d08b1)

    doveadm-deduplicate: Use ver2 structures


M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-25 09:20:06 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (adff71f)

    doveadm-batch: Fixed it to work with ver2 commands.


M	src/doveadm/doveadm-mail-batch.c

2016-02-25 09:08:38 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (844929a)

    doveadm-altmove: Use ver2 structures


M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-24 11:19:11 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (cd75585)

    doveadm: Remove return value from ver2 cmd() - doveadm_exit_code is enough


M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-stats.c

2016-02-24 11:14:14 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fb85193)

    doveadm-cmd: Constify doveadm_cmd_param_*() usage


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h

2016-02-23 14:36:22 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0ed5452)

    doveadm-log: Use ver2 structure


M	src/doveadm/doveadm-log.c

2016-02-23 14:14:16 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (8fdbe2f)

    doveadm-log: Use doveadm_print() for output


M	src/doveadm/doveadm-log.c

2016-02-23 14:13:37 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (21e4a56)

    doveadm-print: Add "formatted" print formatter

    This allows using the header names as %{variables} in the format string.

M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-print-formatted.c
M	src/doveadm/doveadm-print-private.h
M	src/doveadm/doveadm-print.h
M	src/doveadm/doveadm.c

2016-02-24 19:13:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (42fcc70)

    *-login: Call client.auth_result() also when proxying


M	src/login-common/client-common-auth.c

2016-02-26 00:15:45 +0200 Stephan Bosch <stephan@rename-it.nl> (81ebac6)

    lib-http: client: Decreased request/connect timeout for test-http-client to
    10s.


M	src/lib-http/test-http-client.c

2016-02-26 00:15:17 +0200 Stephan Bosch <stephan@rename-it.nl> (5257840)

    lib-http: client: Gave request, connect and dns timeouts defaults that make
    more sense.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c

2016-02-25 22:46:11 +0100 Stephan Bosch <stephan@rename-it.nl> (1f1ba79)

    lib-http: client: Fixed crash happening when connection hits an error while
    handling a new request.

    At this point the connection dies within the peer request handler loop. 
    Before, the dying connection could free the peer when it ended up being 
    obsolete. But because it was still in the loop, a segfault occurred as the 
    loop continued. Fixed by deferring the the deallocation of the peer from the
    connection_lost() function to the request handler loop itself if it is 
    active.

M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2016-02-25 01:18:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b3c9a08)

    stats: Minor code cleaup - remove unnecessary includes and fix copyright
    year


M	src/stats/client-reset.c

2016-02-24 16:39:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2686ef8)

    lib: Added unit test to iostream-temp.


M	src/lib/Makefile.am
A	src/lib/test-iostream-temp.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2016-02-24 16:39:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e245fb1)

    lib: iostream-temp makes the internal fd visible now to o_stream_get_fd()

    Mainly for the following unit test.

M	src/lib/iostream-temp.c

2016-02-24 15:00:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (07448eb)

    lib-storage: Verify settings only after applying settings from userdb

    This is especially important to verify() functions that parse the settings 
    and store data permanently based on them, e.g. pop3_delete_flag or 
    imap_client_workarounds, which effectively couldn't be overwritten by
    userdb.

M	src/lib-storage/mail-storage-service.c

2016-02-23 23:41:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8a8a3b4)

    lib: Added iostream_temp_create_sized() to specify the max in-memory size


M	src/lib/iostream-temp.c
M	src/lib/iostream-temp.h

2016-02-23 18:41:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (87f4064)

    login-proxy: Use io_add_istream() for adding client_input io.

    This is required for non-fd istreams to work, e.g. ssl-iostream.

M	src/login-common/login-proxy.c

2016-02-23 01:48:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f1a9b58)

    lib-http: Fix to earlier http_client_connection_unref() change 1dead6

    Patch by Stephan Bosch

M	src/lib-http/http-client-connection.c

2016-02-22 22:23:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (17bfcf5)

    doveadm: Code cleanup - remove duplicate code


M	src/doveadm/client-connection-http.c

2016-02-22 22:10:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bef3447)

    doveadm: Fixed usage printing for ver2 commands


M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm.c

2016-02-22 22:02:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c45a841)

    doveadm: Define DOVEADM_CMD_MAIL_USAGE_PREFIX, which v2 commands use as
    their usage prefix.

    This allows implementing the next changeset without kludging.

M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-save.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-22 21:44:40 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7a8ef11)

    doveadm: Added doveadm_cmd_get_ver2() helper


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h

2016-02-22 14:18:04 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (71f4549)

    doveadm-index: Use ver2 structures


M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-22 13:30:12 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (3fd8086)

    doveadm-cmd: Add command flags


M	src/doveadm/doveadm-cmd.h

2016-02-22 21:39:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1e8a6a8)

    doveadm: Free istream parameters everywhere

    Based on patch by Aki Tuomi

M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h

2016-02-22 14:03:41 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e6e5687)

    quota: Use doveadm ver2 structures


M	src/plugins/quota/doveadm-quota.c

2016-02-22 21:28:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7d500ec)

    doveadm: Minor code cleanup - rename doveadm_cmd_find*() to
    doveadm_cmd_find_with_args*()


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm.c

2016-02-22 21:24:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3d27e11)

    doveadm: Code cleanup - remove unnecessary NULL sets and checks


M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-cmd.c

2016-02-22 21:17:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f9d2a1f)

    lib-http: Always set *_obj=NULL first in deinit functions (mainly for
    consistency)

    This doesn't usually matter, but in case deinit calls some callback they may 
    be trying to access the partially destroyed object.

M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client.c
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.c

2016-02-22 21:15:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (702ebfd)

    lib-http: http_server_connection_unref() now always sets *conn=NULL

    This makes its behavior consistent with other APIs in Dovecot.

M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server.h

2016-02-22 21:00:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8d33944)

    lib-http: Clarify http_server_response_*_payload() API and minor change to
    it

    Similar to the change in c3a4c93. Nothing used this API yet.

M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.h

2016-02-22 20:58:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (903f0b3)

    lib-http: http_server_request_unref() now always sets *req=NULL

    This makes its behavior consistent with other APIs in Dovecot.

M	src/lib-http/http-server-request.c
M	src/lib-http/http-server-response.c

2016-02-22 20:47:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c3a4c93)

    lib-http: Clarify http_client_request_*_payload() API and minor change to it

    The earlier behavior was pretty confusing, and potentially could have caused 
    double-freeing memory in some situations. Now it's clear that req is set to
    NULL always when the request is finished, regardless of whether it has any
    references left.

    Changed http_client_request_finish_payload() to return 0 on success instead
    of 1. This could have been left alone, but it's unlikely that there is any
    code outside Dovecot core that calls it and this way is cleaner.

M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h
M	src/plugins/fts-solr/solr-connection.c

2016-02-22 20:34:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d1f964d)

    lib-http: http_client_request_unref() now always sets *req=NULL

    This makes its behavior consistent with other APIs in Dovecot.

    Also http_client_request_finish() no longer sets req=NULL, because all of 
    its callers already keep a reference. Instead added an assert to make sure 
    the reference is there.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2016-02-22 20:14:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1dead6e)

    lib-http: http_client_connection_unref() now always sets *conn=NULL

    This makes its behavior consistent with other APIs in Dovecot.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h

2016-02-22 20:03:44 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (331d2de)

    doveadm-http: Close client input correctly


M	src/doveadm/client-connection-http.c
M	src/doveadm/client-connection.c

2016-02-22 20:00:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (346ce9e)

    doveadm-http: Return HTTP failure on unexpected JSON input


M	src/doveadm/client-connection-http.c

2016-02-22 19:56:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9cd71e2)

    doveadm-http: Handle invalid input better for arrays.


M	src/doveadm/client-connection-http.c

2016-02-20 23:16:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (394a873)

    doveadm-http: Handle istreams correctly

    Based on patch by Aki Tuomi

M	src/doveadm/client-connection-http.c

2016-02-17 10:24:24 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5ba6009)

    doveadm-save: Use ver2 command structure


M	src/doveadm/doveadm-mail-save.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-22 18:55:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0d55fdf)

    doveadm: Added support for "file" parameters


M	src/doveadm/doveadm-mail.c

2016-02-22 18:46:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (368ec06)

    doveadm: Fixed memory leak at deinit


M	src/doveadm/doveadm-cmd.c

2016-02-22 18:42:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bce90a4)

    doveadm: Fixed double-free when using -F parameter


M	src/doveadm/doveadm-mail.c

2016-02-22 18:42:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f8e3a08)

    doveadm: Fixed memory leaks when ver2 command parsing fails with invalid
    parameter.


M	src/doveadm/doveadm-mail.c

2016-02-22 13:59:14 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (1360790)

    doveadm-mail: Fixed common parameters to use correct names as in
    DOVEADM_CMD_MAIL_COMMON


M	src/doveadm/doveadm-mail.c

2016-02-17 09:19:01 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (89d3129)

    doveadm-fetch: Use ver2 structures


M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-22 18:20:59 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (778087c)

    doveadm: Add kludge to support field array to fieldstr conversion


M	src/doveadm/doveadm-mail.c

2016-02-15 15:14:25 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (676d560)

    doveadm-stats: Use ver2 structures


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm.c

2016-02-22 16:12:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d68a021)

    lib-index: If mail_transaction_log_lock_head() locking took long, include
    reason string in warning


M	src/lib-index/mail-transaction-log.c

2016-02-22 11:47:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (62958c5)

    mdbox: Use mail_index_sync_set_reason() to give better reason messages for
    lock wait warnings.


M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-map.h
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.h

2016-02-22 11:46:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5bced34)

    lib-index: Added mail_index_sync_set_reason() to improve lock wait log
    warnings


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index.h

2016-02-22 11:15:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6ded881)

    lib-index: Small improvements to logging the reason for long transaction log
    lock waits


M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mail-transaction-log.h
M	src/lib-index/test-mail-transaction-log-append.c

2016-02-22 10:25:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2d5fced)

    dovecot.service: Fixed PIDFile path - removed extra /dovecot/ directory from
    the middle.


M	dovecot.service.in

2016-02-21 19:01:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5dd21e1)

    lib: mempool-alloconly unit test improvement: verify that data stack isn't
    used by p_malloc()


M	src/lib/test-mempool-alloconly.c

2016-02-21 18:58:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (010341a)

    lib: Minor code cleanup to mempool-alloconly unit test - use
    test_begin/assert/end()


M	src/lib/test-mempool-alloconly.c

2016-02-21 18:38:24 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (b4a7ea6)

    doveadm-http: Correctly initialize parameters


M	src/doveadm/client-connection-http.c

2016-02-21 18:37:24 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (f169d42)

    doveadm: Fixed using array type parameters.


M	src/doveadm/doveadm-cmd.c

2016-02-21 18:36:19 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (9098289)

    doveadm: Fixed assert-crash when command with CMD_PARAM_FLAG_DO_NOT_EXPOSE
    was used.


M	src/doveadm/doveadm-cmd.c

2016-02-21 18:35:03 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (25f12bc)

    doveadm: Fixed support for --long-option arguments


M	src/doveadm/doveadm-cmd.c

2016-02-21 18:32:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c8d88cb)

    lib: Added [pt]_array_const_string_join()

    Based on patch by Aki Tuomi

M	src/lib/strfuncs.c
M	src/lib/strfuncs.h
M	src/lib/test-strfuncs.c

2016-02-21 18:32:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1a7f776)

    lib: Move code from t_strarray_join() into a more generic
    p_strarray_join_n()


M	src/lib/strfuncs.c

2016-02-21 18:31:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1f35f54)

    lib: Added unit test for t_strarray_join()


M	src/lib/test-strfuncs.c

2016-02-21 17:44:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (11c685e)

    quots-fs: Fixed compiling with HP/UX and Solaris


M	src/plugins/quota/quota-fs.c

2016-02-21 17:44:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bb5cede)

    doveadm: Compiler warning fix.


M	src/doveadm/client-connection.c

2016-02-21 03:40:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (950a6e6)

    lib-index: mail_index_sync_next() didn't always return expunges sorted

    Maildir and mbox formats were using index_sync_changes_read(), which assumed
    that they were sorted. So some of the intended expunges weren't actually
    always being done. This mainly affected when expunges were being done
    simultaneously by multiple processes or by pipelined commands. For example:

    printf "a select inbox\nb uid move 2 Trash\nc uid move 1 Trash\nd logout\n"
    | ./imap

M	src/lib-index/mail-index-sync.c

2016-02-16 18:05:59 +0100 manuel <manuel@mausz.at> (ce35092)

    imap-hibernate: send connect/disconnect events to anvil

    make doveadm who + mail_max_userip_connections work with hibernated
    connections.

M	src/imap-hibernate/imap-client.c
M	src/imap-hibernate/imap-client.h

2016-02-20 23:32:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (202b467)

    lib: json_parse_next_stream() wrongly returned -1 even when a stream was
    returned.


M	src/lib/json-parser.c
M	src/lib/test-json-parser.c

2016-02-20 19:47:58 +0200 Stephan Bosch <stephan@rename-it.nl> (dbbdcc1)

    uri-util: Fixed assertion failure for invalid character in path segment.


M	src/lib/uri-util.c

2016-02-20 19:35:12 +0200 Stephan Bosch <stephan@rename-it.nl> (c0a8031)

    lib-http: server: Implicitly free a request response structure when a new
    (failure) response is started.


M	src/lib-http/http-server-response.c

2016-02-20 13:40:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0755a3b)

    doveadm: Fix for previous attempt to make static analyzer happier.


M	src/doveadm/doveadm-cmd.c

2016-02-19 20:20:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4e96840)

    doveadm: Make static analyzer happier - cptr can't be NULL here.


M	src/doveadm/doveadm-cmd.c

2016-02-19 16:36:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (14102a0)

    doveadm: Use char type for short options instead of a string.

    The ":" = "has parameters" can be determined from the type. Also removed "?"
    checks since it wasn't actually used.

M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-19 16:34:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (05128fd)

    doveadm: Remove CMD_PARAM_NONE type, since it already defaulted to same as
    CMD_PARAM_BOOL


M	src/doveadm/client-connection-http.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h

2016-02-19 19:11:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (382d45f)

    lib-index: Fixed mail_index_lookup_ext_full()'s map_r with transaction-view.


M	src/lib-index/mail-index-transaction-view.c

2016-02-19 19:08:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ecb1ecd)

    lib-index: Code cleanup - moved code to tview_lookup_ext_update()

    No functional changes.

M	src/lib-index/mail-index-transaction-view.c

2016-02-19 16:13:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d09af09)

    Makefile: Added missing client-connection-private.h


M	src/doveadm/Makefile.am

2016-02-19 16:11:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (22d75d4)

    dovecot.service: Fixed PIDFile path


M	Makefile.am
M	dovecot.service.in

2016-02-19 16:03:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (721e0f8)

    doveadm: Use correct uoff_t type for printf


M	src/doveadm/client-connection-http.c

2016-02-19 15:39:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f5d30c9)

    dovecot.service: Disabled ProtectSystem=full for now

    It's not supported by RHEL7's systemd.

M	dovecot.service.in

2016-02-19 15:03:51 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0368f3b)

    doveadm: Use ver2 structures for all "doveadm mailbox *" commands.


M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2016-02-19 15:02:56 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (68cc278)

    doveadm: Use ver2 structures for stop & reload.


M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-master.c

2016-02-19 14:58:41 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (1e11a94)

    doveadm: Implement HTTP server API, slightly based on JMAP API


M	src/doveadm/Makefile.am
A	src/doveadm/client-connection-http.c
A	src/doveadm/client-connection-private.h
M	src/doveadm/client-connection.c
M	src/doveadm/client-connection.h
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/main.c

2016-02-19 14:40:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (629074c)

    doveadm: Code cleanup - moved code to client_connection_init()

    No functional changes.

M	src/doveadm/client-connection.c

2016-02-15 14:02:19 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (14af7be)

    doveadm: Add infrastructure for doveadm_cmd_ver2

    Version 2 commands have named parameters, which also have types. This is 
    especially useful for reading input from HTTP/JSON API. This also simplifies 
    the parameter parsing for command line input.

    For v2.3 the plan is to replace all the old doveadm_cmds with this new 
    version and get rid of the _ver2 suffixes. But for now we'll have two 
    versions of commands.

    For backwards compatibility with old commands we have also implemented 
    wrappers so that v2 structs can be defined and there's a function to convert 
    the named parameters to old v1 style args[] string, so the old command 
    handlers can still be run. This will also be removed in v2.3.

    This change also adds requirement for getopt_long(). It's already available 
    in all the Linuxes and BSDs, so this shouldn't be too big of a requirement. 
    Other systems can install it from an external library.

M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h

2016-02-18 15:49:03 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (35a2af0)

    doveadm: Add unit tests for i_strccdascmp


M	src/doveadm/Makefile.am
A	src/doveadm/test-doveadm-util.c

2016-02-18 15:48:21 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (a232108)

    doveadm: Add i_strccdascmp()

    This comparator considers camel case==camel-case==camelCase. This is to help
    with HTTP API to make it more flexible.

M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-util.h

2016-02-19 14:08:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (374fed5)

    doveadm: If user lookup fails, log an error but don't kill the process.


M	src/doveadm/doveadm-mail.c

2016-02-19 14:05:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (aa1561e)

    doveadm: Code cleanup - Removed passing through unnecessary argv parameter


M	src/doveadm/doveadm-mail.c

2016-02-18 09:27:10 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (1d68906)

    doveadm: Code cleanup - move code to doveadm_mail_cmd_exec()

    No functional changes.

M	src/doveadm/doveadm-mail.c

2016-02-15 13:55:41 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0c5fef3)

    lib-http: Add accessors for some response details


M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.h

2016-02-18 19:27:13 +0200 Aki Tuomi <aki.tuomi@dovecot.net> (53cc71c)

    dovecot: improve systemd support


M	Makefile.am
M	dovecot.service.in

2016-02-16 18:34:19 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ebcd7cf)

    fts: When searching data headers, don't expand search keys to all languages.

    For example "SEARCH HEADER Message-Id foo@example.com" works better the less
    expansion there is for "foo@example.com".

M	src/plugins/fts/fts-search-args.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/fts-user.h

2016-02-16 18:33:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4ac43ad)

    fts: Code cleanup - moved fts_header_has_language() to a global function


M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c

2016-02-16 17:50:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7fbc81a)

    lib-storage: Avoid duplicate work when a search query has multiple
    header/body keys.


M	src/lib-storage/index/index-search.c

2016-02-16 17:48:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (121f820)

    lib-mail: Added message_search_more_get_decoded()


M	src/lib-mail/Makefile.am
M	src/lib-mail/message-search.c
M	src/lib-mail/message-search.h
A	src/lib-mail/test-message-search.c

2016-02-11 13:25:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2d8f665)

    auth: Moved all passdb/userdb template handling to auth_passdb/userdb.

    This is because passdb_find() and userdb_find() attempts to avoid 
    duplicating passdbs and userdbs when they have identical driver+args. This
    deduplication is useful when using multiple protocol { .. } blocks that
    duplicate some passdb/userdb backends. For example we might want to have
    only a single SQL connection regardless of how the protocol-specific passdbs
    and userdbs are being set up. All the default/override_fields and result_*
    settings aren't relevant to the passdb/userdb backends, so removing them
    will again allow the deduplication to work correctly.

M	src/auth/auth-request.c
M	src/auth/auth.c
M	src/auth/auth.h
M	src/auth/passdb.c
M	src/auth/passdb.h
M	src/auth/userdb.c
M	src/auth/userdb.h

2016-02-11 13:21:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (74674a5)

    auth: Moved cache_key from passdb_module to auth_passdb.

    This is in preparation for the next changeset, which moves 
    default/override_fields also to auth_passdb.

M	src/auth/auth-request.c
M	src/auth/auth.c
M	src/auth/auth.h
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-pam.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/passdb.h
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/auth/userdb.h

2016-02-11 13:58:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e173fd3)

    lib-http: server: Error handling fix - avoid potential crash when request is
    already gone


M	src/lib-http/http-server-request.c

2016-02-10 22:02:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (60216d61)

    login-proxy: Preserve client's istream even after login.

    This eventually allows things like using lib-ssl-iostream, moving IMAP 
    COMPRESS handling to login process, etc.

M	src/login-common/login-proxy.c

2016-02-10 22:02:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (463f6ea)

    lib: Added i_stream_set_persistent_buffers()


M	src/lib/istream-private.h
M	src/lib/istream.c
M	src/lib/istream.h

2016-02-10 19:30:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4ff6d11)

    lib: Ignore ENOSYS errors from madvise() calls.

    For example Raspberry Pi kernels have removed this. We'll wrap all the 
    madvise() calls with my_madvise() to avoid extra checks all over the place.

M	src/lib/mmap-util.c
M	src/lib/mmap-util.h

2016-02-10 23:39:25 +0100 Stephan Bosch <stephan@rename-it.nl> (d5cdf90)

    lib-http: Created test program that tests payload exchange between client
    and server with various configurations.

    It recursively uses all files in the current directory as payload. It is
    currenrly not part of `make check', because it is a stress-testing tool that
    can run for a long time.

M	src/lib-http/Makefile.am
A	src/lib-http/test-http-payload.c

2016-02-10 22:32:46 +0100 Stephan Bosch <stephan@rename-it.nl> (201c3b9)

    lib-http: server: Implemented blocking request input stream.


M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server.h

2016-02-10 22:30:22 +0100 Stephan Bosch <stephan@rename-it.nl> (7c7117e)

    lib-http: server: Implemented blocking response output stream.


M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.h

2016-02-10 22:25:07 +0100 Stephan Bosch <stephan@rename-it.nl> (ee26330)

    lib-http: server: Created blocking http_server_response_send_payload() API
    that closely mimics the client equivalent.

    It allows sending response payload in several chunks in a blocking fashion.

M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.h

2016-02-10 22:19:27 +0100 Stephan Bosch <stephan@rename-it.nl> (2f64a4c)

    lib-http: server: Added some request debug logging.


M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c

2016-02-10 22:17:07 +0100 Stephan Bosch <stephan@rename-it.nl> (d7b94e1)

    lib-http: request parser: Added support for explicitly finishing payload of
    previous request.


M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h

2016-02-10 22:15:12 -0700 Michael M Slusarz <michael.slusarz@dovecot.fi> (e8434aa)

    lib-sql: Allow port to be configured for Cassandra cluster


M	src/lib-sql/driver-cassandra.c

2016-02-10 19:08:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (38dac30)

    lib-storage: Added missing %{userdb:*:default} handling


M	src/lib-storage/mail-storage-service.c

2016-02-10 19:06:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d23dfc3)

    lib-storage: Deduplicate %{userdb:*} handling for mail_user and
    mail_storage_service_user


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h
M	src/lib-storage/mail-user.c

2016-02-10 18:27:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6b107c6)

    *-login: Pass client_auth_reply to client.auth_result() whenever possible.

    This didn't matter normally, but some plugins might care about it.

M	src/login-common/client-common-auth.c

2016-02-10 16:54:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c436579)

    auth: Added "fail" parameter, which fails the passdb lookup.


M	src/auth/auth-request.c

2016-02-10 16:51:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (61c2b28)

    auth: Don't revert any previous failed=TRUE status if allow_nets check
    succeeds


M	src/auth/auth-request.c

2016-02-10 15:50:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ec39e55)

    Makefile: Added missing ostream-escaped.h


M	src/lib/Makefile.am

2016-02-10 15:39:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b9ee73a)

    lib-http: Fixed test-http-request-parser unit test

    Patch by Stephan Bosch

M	src/lib-http/test-http-request-parser.c

2016-02-08 16:22:34 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (662bb64)

    lib: Add ostream-escaped filter


M	src/lib/Makefile.am
M	src/lib/json-parser.c
M	src/lib/json-parser.h
A	src/lib/ostream-escaped.c
A	src/lib/ostream-escaped.h
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-ostream-escaped.c

2016-02-09 10:03:56 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (2d43af5)

    doveadm-print: Fix doveadm_print_json_print_stream


M	src/doveadm/doveadm-print-json.c

2016-02-08 22:57:13 +0100 Stephan Bosch <stephan@rename-it.nl> (9a07da0)

    lib-http: message parser: Made sure that payload stream is always destroyed
    (hence closed) when the next request is to be parsed.

    This makes sure that the connection input is always at the correct position 
    for the next request. Remaining references to the payload stream could 
    theoretically mess this up.

M	src/lib-http/http-message-parser.c

2016-02-08 22:55:09 +0100 Stephan Bosch <stephan@rename-it.nl> (489fb49)

    lib-http: server: Make sure that any pending request is aborted and
    destroyed before connection FDs are closed.

    This way, any payload io struct created from the request callback can be 
    freed before the associated FD becomes invalid. This would cause an assert 
    failure otherwise.

M	src/lib-http/http-server-connection.c

2016-02-08 22:53:50 +0100 Stephan Bosch <stephan@rename-it.nl> (14137be)

    lib-http: server: Sometimes a success response was sent before all payload
    from the client request was read.

    This can confuse clients, so this is supposed to be prevented.

M	src/lib-http/http-server-connection.c

2016-02-08 22:52:38 +0100 Stephan Bosch <stephan@rename-it.nl> (b498cc3)

    lib-http: server: Fixed memory problem reported by Valgrind, which was
    caused by the request being freed too early while sending a response.

    Fixed by referencing the request while it is being sent.

M	src/lib-http/http-server-connection.c

2016-02-08 22:51:14 +0100 Stephan Bosch <stephan@rename-it.nl> (01476c4)

    lib-http: server: Fixed datastack framing problem in error handling of
    response sending.

    The returned error string crossed a data stack frame, which wasn't handled
    correctly.

M	src/lib-http/http-server-response.c

2016-02-08 22:49:28 +0100 Stephan Bosch <stephan@rename-it.nl> (ba9528f)

    lib-http: request parser: Made sure that partially parsed requests never
    have stale string values.

    Due to the fact that we assign method and target fields early for proper 
    error messages, stale fields from previous requests could have ended up in a 
    partially parsed new request.

M	src/lib-http/http-request-parser.c

2016-02-08 22:47:30 +0100 Stephan Bosch <stephan@rename-it.nl> (e1d8d18)

    lib-http: client: Fixed pipelining bug: client sometimes sent new request
    while still waiting for 100-continue.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2016-02-08 22:45:54 +0100 Stephan Bosch <stephan@rename-it.nl> (79f8a20)

    lib-http: client: Make sure that any pending request is aborted and
    destroyed before connection FDs are closed.

    This way, any payload io struct created from the response callback can be
    freed before the associated FD becomes invalid. This would cause an assert
    failure otherwise.

M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2016-02-08 22:44:52 +0100 Stephan Bosch <stephan@rename-it.nl> (da30047)

    lib-http: Forgot to assign pointer parameter to NULL in request/response
    parser deinit functions.


M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c

2016-02-09 10:34:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (af3f70f)

    Makefile: Added missing auth-request-stats.h


M	src/auth/Makefile.am

2016-02-08 18:43:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1f1df2d)

    doveadm auth test/login: Added -M <master user> parameter.


M	src/doveadm/doveadm-auth.c

2016-02-08 16:21:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (38834f0)

    stats: Minor error message cleanup.

    FIFO stats can come from auth also, not just mail server.

M	src/stats/fifo-input-connection.c

2016-02-08 16:20:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (44cf91b)

    auth: If auth_stats=yes, send statistics to stats process.


M	src/auth/Makefile.am
A	src/auth/auth-request-stats.c
A	src/auth/auth-request-stats.h
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
A	src/auth/auth-stats.c
A	src/auth/auth-stats.h
M	src/auth/main.c
M	src/auth/passdb-cache.c

2016-02-05 11:36:32 -0700 Michael M Slusarz <michael.slusarz@dovecot.fi> (6cda5e1)

    man: document dsync -m and -R options


M	doc/man/doveadm-sync.1.in

2016-02-08 12:20:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2eed51b)

    lib-master: Fail if syslog_facility's value is unknown.


M	src/lib-master/master-service-settings.c

2016-02-08 12:04:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (dd5683e)

    acl: If acl_user is set, use it for ACL username checks. Overrides
    master_user.


M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-plugin.h
M	src/plugins/acl/acl-storage.c

2016-02-05 15:55:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (90cf976)

    auth: Small code cleanup to auth cache - deduplicate code.

    No functional changes.

M	src/auth/passdb-cache.c

2016-02-05 15:54:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5bb7c98)

    auth: Minor code cleanup - fix parameter type


M	src/auth/passdb-cache.c
M	src/auth/passdb-cache.h

2016-02-05 15:48:25 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6a6a995)

    auth: If auth cache lookup results in expired entry, it should be tracked in
    stats as a "miss"


M	src/auth/auth-cache.c

2016-02-05 15:26:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0432583)

    stats: Removed accidentally commited i_panic() in abb242da


M	src/stats/mail-session.c

2016-02-05 15:07:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (800787d)

    stats: Split stats-connection.[ch] to lib-stats/ and plugin's mail-specific
    parts.


M	src/lib-stats/Makefile.am
R056	src/plugins/stats/stats-connection.c	src/lib-stats/stats-connection.c
A	src/lib-stats/stats-connection.h
M	src/plugins/stats/Makefile.am
A	src/plugins/stats/mail-stats-connection.c
A	src/plugins/stats/mail-stats-connection.h
D	src/plugins/stats/stats-connection.h
M	src/plugins/stats/stats-plugin.c

2016-02-05 14:55:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b7a0a5c)

    stats: Added ADD-USER command to add stats to a user without having a
    session.

    This will be used by at least the auth process. Although the auth process 
    does have a session, it's a bit too early to start using it yet. At least
    the PID should be possible to change when the session moves to imap process. 
    Also the unsuccessful authentication sessions shouldn't really be added at 
    all.

M	src/stats/fifo-input-connection.c
M	src/stats/mail-user.c
M	src/stats/mail-user.h

2016-02-05 14:35:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e618403)

    stats: Renamed mail-server-connection to fifo-input-connection.


M	src/stats/Makefile.am
R067	src/stats/mail-server-connection.c	src/stats/fifo-input-connection.c
A	src/stats/fifo-input-connection.h
D	src/stats/mail-server-connection.h
M	src/stats/main.c
M	src/stats/stats-settings.c

2016-02-04 14:02:42 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (adb9044)

    lib-mail: Reading from istream-header-filter second time reverted callback's
    eoh change.


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2016-02-04 13:32:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f6497ac)

    lib: Fixed calling json_parse_skip_next() within arrays


M	src/lib/json-parser.c
M	src/lib/test-json-parser.c

2016-02-04 13:31:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a18503d)

    lib: If json-parser has JSON_PARSER_NO_ROOT_OBJECT set, return the ending
    root "]" and "}"


M	src/lib/json-parser.c
M	src/lib/test-json-parser.c

2016-02-03 17:56:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (52d50af)

    lib: Avoid typeof() if HAVE_TYPEOF isn't set, even if gcc version is high
    enough.

    This is mainly to test that we can compile without typeof().

M	src/lib/macros.h

2016-02-03 14:05:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2812f57)

    imap, pop3, imap-urlauth: Added -a <auth-master socket path> parameter


M	src/imap-urlauth/imap-urlauth.c
M	src/imap/main.c
M	src/pop3/main.c

2016-02-03 14:00:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (74ad0b9)

    *-login: Added -l parameter to specify the socket where to connect to after
    authentication


M	src/login-common/main.c

2016-02-03 13:56:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1c75bf2)

    imap: SETMETADATA shouldn't crash when value parameter is missing.


M	src/imap/cmd-setmetadata.c

2016-02-03 13:03:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5d08475)

    lib-sasl: Compiler warning fix for previous EXTERNAL change..


M	src/lib-sasl/mech-external.c

2016-02-03 12:29:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (66ce342)

    lib-sasl: Don't require authid for EXTERNAL mechanism, since we're not
    really authenticating.


M	src/lib-sasl/mech-external.c

2016-02-03 12:26:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (405d5f2)

    lib-sasl: Added support for EXTERNAL SASL mechanism


M	src/lib-sasl/Makefile.am
M	src/lib-sasl/dsasl-client-private.h
M	src/lib-sasl/dsasl-client.c
A	src/lib-sasl/mech-external.c

2016-02-02 22:06:38 +0200 Aki Tuomi <aki.tuomi@dovecot.net> (19d31b4)

    doveadm: Reset JSON formatter context before reuse

    This is needed to implement multicommand support in HTTP API.

M	src/doveadm/doveadm-print-json.c

2016-02-02 12:32:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5f8d497)

    pop3c: Compiler warning fixes to earlier change


M	src/lib-storage/index/pop3c/pop3c-mail.c

2016-02-01 23:32:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d78eb0a)

    imapc: Compare INBOX in STATUS case-insensitively.


M	src/lib-storage/index/imapc/imapc-storage.c

2016-02-01 22:48:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d1808f8)

    sdbox: Failing after saved mails' UIDs were already assigned caused
    unlink()ing garbage

    Mainly with dsync when it fails, the transaction is still committed and 
    mails are given UIDs. If the transaction commit still fails, it attempts to 
    rollback the saved mails by unlink()ing them, but at that point the path 
    pointed to an already freed memory. This caused unlink() errors with some 
    garbage strings as the path (and hopefully no actually valid paths).

    The easiest way to reproduce this was to fill up the filesystem with dsync.

M	src/lib-storage/index/dbox-single/sdbox-file.c

2016-02-01 22:40:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7ae6552)

    dsync: If mailbox importing fails, stop immediately without waiting for
    exporter to finish.


M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2016-02-01 20:30:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (71caf49)

    imap: Removed now-unused cmd_sync_callback(), which doesn't work very well.

    See commit message in b7b25e0 for more details.

M	src/imap/imap-sync.c
M	src/imap/imap-sync.h

2016-02-01 20:26:19 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b7b25e0)

    imap: Removed special EXPUNGE callback for an Outlook workaround.

    As the comment mentions, this workaround isn't needed if index files are 
    used.  Hopefully also the Outlook bug itself is gone nowadays.. In any case 
    the current callback code didn't work, because it was returning FALSE and 
    causing an assert in a pipelined EXPUNGE+APPEND combination after 6e9454f:

    Panic: file imap-client.c: line 862 (client_check_command_hangs): assertion 
    failed: (!have_wait_unfinished || unfinished_count > 0)

    It would probably be possible to fix this, but it would complicate the code 
    even further, so it's easier just to get rid of this feature. It was easily 
    triggered by running imaptest stress testing.

M	src/imap/cmd-expunge.c

2016-02-01 19:08:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a58963a)

    pop3-migration: Ignore mails returned as expunged by pop3c.

    Whether the -ERR actually meant they were expunged or not is another issue,
    but the answer to that belongs to pop3c code. MAIL_ERROR_EXPUNGED in any
    case can be safely handled this way here.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-02-01 19:07:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f268691)

    pop3c: If prefetch fails, treat it as if prefetching simply wasn't done.

    This avoids having error handling twice. Also in case the error was caused 
    by -ERR, this should retry the operation, which even might fix it in some 
    situations.

M	src/lib-storage/index/pop3c/pop3c-mail.c

2016-02-01 17:57:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (06fda71)

    pop3-migration: Use message_header_hash_more() instead of duplicating the
    code


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-02-01 17:56:49 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (988cb70)

    lib-mail: Changed message_header_hash_more() to support any hash algorithm


M	src/doveadm/dsync/dsync-mail.c
M	src/lib-mail/message-header-hash.c
M	src/lib-mail/message-header-hash.h
M	src/lib-mail/test-message-header-hash.c

2016-02-01 17:38:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f6ae9ae)

    lib: JSON parser can now optionally parse input that isn't an object.

    Based on patch by Aki Tuomi.

M	src/lib/json-parser.c
M	src/lib/json-parser.h
M	src/lib/test-json-parser.c

2016-02-01 17:30:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4bfa47e)

    lib: Fixed json-parser to correctly parse numbers at EOF.

    Numbers are a bit special compared to others, because they don't have any 
    clear character indicating that the number ends. So we can only assume that 
    the number is finished when EOF is reached, although even that isn't 
    necessarily correct in case the stream is terminated unexpectedly.

    This change is in prepartion for the next change. With current JSON parser 
    this issue could never happen because "}" was expected just before EOF.

M	src/lib/json-parser.c

2016-02-01 17:00:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (736b180)

    lib: Code cleanup to json-parser - assume less that the root is an object


M	src/lib/json-parser.c
M	src/lib/test-json-parser.c

2016-01-29 00:08:33 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1dc963a)

    lib-mail, dsync: Moved dsync_mail_hash_more() to
    lib-mail/message-header-hash.*


M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/lib-mail/Makefile.am
A	src/lib-mail/message-header-hash.c
A	src/lib-mail/message-header-hash.h
R090	src/doveadm/dsync/test-dsync-mail.c	src/lib-mail/test-message-header-hash.c

2016-02-01 14:44:11 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (0d0f620)

    lib-http: Add function to update HTTP response status


M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.h

2016-01-21 19:49:12 +0200 Aki Tuomi <aki.tuomi@dovecot.net> (3cd674e)

    doveadm: Add JSON formatter support


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-print-json.c
M	src/doveadm/doveadm-print-private.h
M	src/doveadm/doveadm-print.h
M	src/doveadm/doveadm.c
M	src/doveadm/main.c

2016-01-25 10:50:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (fe5fcad)

    doveadm-print: Add flag indicating number-only field


M	src/doveadm/doveadm-print.h

2016-01-29 17:47:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (589a288)

    Compiler warning fix to previous commit


M	src/lib-lda/smtp-client.c

2016-01-29 17:42:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7c92514)

    Replace host:port parsers with net_str2hostport().


M	src/director/director-host.c
M	src/doveadm/doveadm-util.c
M	src/lib-lda/smtp-client.c
M	src/lib/iostream-rawlog.c

2016-01-29 17:32:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8bb311a)

    lib: Added net_str2hostport()


M	src/lib/net.c
M	src/lib/net.h
M	src/lib/test-net.c

2016-01-29 16:23:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4209bd2)

    last-login: Added last_login_precision setting


M	src/plugins/last-login/last-login-plugin.c

2016-01-29 16:07:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (87066db)

    lib-sasl: Allow plugins to override the default SASL client mechanisms.


M	src/lib-sasl/dsasl-client.c

2016-01-29 15:09:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (931bc10)

    lib-imap: Write invalid Content-Transfer-Encoding value as "7bit" to
    BODY/BODYSTRUCTURE.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/test-imap-bodystructure.c

2016-01-29 10:29:05 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (d3a4304)

    lib: Add tests for str_is_float


M	src/lib/test-strnum.c

2016-01-29 10:28:53 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (e764092)

    lib: Add str_is_float check function


M	src/lib/strnum.c
M	src/lib/strnum.h

2016-01-28 20:47:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f0d1de4)

    dsync: Improved header hash v2 algorithm to remove repeated '?' chars.

    This is to help with Yahoo that replaces UTF-8 chars in headers with a 
    single '?' (instead of '?' per each 8bit byte).

M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
A	src/doveadm/dsync/test-dsync-mail.c

2016-01-28 20:23:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (96ca70b)

    lib-index: Memory leak fix for test-mail-index-map

    This failed when running make check with valgrind.

M	src/lib-index/test-mail-index-map.c

2016-01-28 20:16:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d430698)

    pop3-migration: Fix to 5407a86 - don't sync POP3 UIDLs when we don't need to


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-28 19:56:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e1bef59)

    dsync: Avoid finishing importer successfully on exporter failures.

    At least dsync_mailbox_import_changes_finish() could have been called when 
    exporter was already failed.

M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h

2016-01-28 19:55:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (79490ec)

    doveadm backup: If local mailbox has more mails than remote, detect and
    delete it earlier.


M	src/doveadm/dsync/dsync-mailbox-import.c

2016-01-28 19:51:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7d8603f)

    imapc: Don't mark the initial sync done if it wasn't successful.


M	src/lib-storage/index/imapc/imapc-sync.c

2016-01-28 19:49:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e1fb4dc)

    imapc: Handle disconnection when NOOP is sent to verify if mail is expunged.


M	src/lib-storage/index/imapc/imapc-mail.c

2016-01-28 19:48:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0cc566d)

    lib-index: Added unit test to mail_index_map_lookup_seq_range()


M	src/lib-index/Makefile.am
A	src/lib-index/test-mail-index-map.c

2016-01-28 17:53:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (46d4256)

    imapc: Don't ignore FETCH, SEARCH and EXPUNGE returning NO failures in
    syncing.

    Especially if the FETCH 1:* (FLAGS) didn't succeed, we expunged all the 
    mails from local index.

M	src/lib-storage/index/imapc/imapc-sync.c

2016-01-28 17:43:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (14fb3a2)

    imapc: If FETCH didn't send our wanted data, log the tagged FETCH reply
    text.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h

2016-01-28 17:29:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (740e369)

    imapc: Don't use fetch-fix-broken-mails for NO [LIMIT] FETCH replies


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2016-01-28 17:15:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b894793)

    imapc: Remove X-Message-Flag filtering if imapc_features has rfc822.size


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2016-01-28 17:03:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (956a62e)

    doveadm: All commands iterating mails stop now if doveadm has been killed.


M	src/doveadm/doveadm-mail-iter.c

2016-01-28 16:59:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (34fe9f3)

    doveadm: Enable SIGINT and SIGTERM signal handler for all doveadm mail
    commands.

    Most importantly this allows stopping dsync.

M	src/doveadm/doveadm-mail.c

2016-01-28 16:43:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (69f6407)

    doveadm backup: Detect and handle conflicts earlier.

    This avoids doing a lot of work, only for the next doveadm backup to just 
    delete the entire mailbox and start from the beginning.

M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2016-01-28 16:26:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a221d0d)

    imapc: Fixed assert-crash in mailbox syncing, if mailbox couldn't be opened.

    Usually meaning that syncing was attempted when IMAP server couldn't be 
    connected to. Fixes the assert:

    Panic: file imapc-client.c: line 439 (imapc_client_get_capabilities): 
    assertion failed: (conn != NULL)

M	src/lib-storage/index/imapc/imapc-sync.c

2016-01-28 15:36:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6e9454f)

    imap: Send all pending tagged command replies before APPEND is started.

    This probably doesn't matter a lot, but it's cleaner.

    One side effect of this change is that if multiple APPENDs are pipelined
    (without MULTIAPPEND) on the selected mailbox, this now performs a sync 
    between each APPEND and sends the EXISTS replies. This may be slightly lower
    in performance, but it's also slightly more correct behavior.

M	src/imap/imap-commands.c

2016-01-28 15:16:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bb869cc)

    lib: Added json_append_escaped_data() to escape non-NUL terminated input.


M	src/lib/json-parser.c
M	src/lib/json-parser.h
M	src/lib/test-json-parser.c

2016-01-28 15:05:38 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (10972f2)

    lib: json_append_escaped() doesn't need to escape the 8bit chars.

    We'll assume that the input is valid UTF-8.

M	src/lib/json-parser.c
M	src/lib/json-parser.h
M	src/lib/test-json-parser.c

2016-01-28 13:45:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4eccf53)

    lib-index: If transaction log was locked for at least 30 secs, log a warning
    (not at 3min)

    This is because we log a warning about it already when locking it took 30 
    seconds, so it's useful to see which process was actually keeping the lock.

M	src/lib-index/mail-transaction-log-file.c

2016-01-27 15:44:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5407a86)

    pop3-migration: Perform UIDL syncing a bit earlier to work around Yahoo IMAP
    bug.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-27 15:16:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6387343)

    imapc: Don't use fetch-fix-broken-mails for OK and NO [SERVERBUG] FETCH
    replies

    Hopefully no servers are actually returning OK without returning a FETCH 
    reply. If they are, maybe we need another workaround..

    In any case Yahoo IMAP sometimes loses state and starts returning OK without 
    FETCH replies to all UID FETCH requests (and BADs to FETCHes). It also may 
    return NO [UNAVAILABLE] for both permanent and temporary FETCH failures, so 
    we can't do anything with that.

    I added NO [SERVERBUG] because that's what Dovecot responds to temporary 
    failures. I'm not sure how useful that check is though.

M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h

2016-01-27 10:17:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c67f6d0)

    lib: Make static analyzer happier about istream-chain changes


M	src/lib/istream-chain.c

2016-01-27 02:04:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (84a5175)

    pop3c: Fixed assert-crash when prefetching a mail failed.


M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-storage.h

2016-01-27 01:12:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fd3d068)

    *-login: Add all returned passdb fields to struct
    client_auth_reply.all_fields

    These will be mainly useful to plugins.

M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h

2016-01-27 00:35:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f3b0efd)

    fts-solr: Changed default operator to AND to fix multi-word queries.

    Previously for example searching from:foo@example.com was expanded to foo OR
    example OR com. Now it's foo AND example AND com, which makes a lot more
    sense.

M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2016-01-26 23:51:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1ac936b)

    pop3c: Compiler warning fix for using wrong enum type


M	src/lib-storage/index/pop3c/pop3c-client.c

2016-01-26 22:10:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cfb351c)

    pop3-migration: If reading message header for hashing fails, fail
    immediately.

    This avoids flooding the log with a ton of errors in case the POP3 
    connection dies.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-26 19:56:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (45af477)

    dsync: When comparing headers' hashes to match messages, try to normalize
    the input.

    This is especially useful because some IMAP servers return different data 
    depending on whether we're fetching only specific header fields, all headers 
    or entire body. For now we're assuming that any non-ASCII is going to be 
    replaced with '?', which helps at least with Zimbra and Yahoo. The header 
    hashing algorithm is now versionable, so it can be modified more easily in 
    future.

    This change should make imapc_features=zimbra-workarounds setting obsolete.

M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h
M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-26 17:55:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ee33544)

    pop3-migration: Don't change TAB to '?' when calculating header hash.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-26 17:53:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (414d4ee)

    pop3-migration: Don't even try to match message sizes with
    pop3_migration_skip_size_check=yes

    This skipped the header check for mailboxes that had only a single mail.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-26 15:41:16 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (afc77c5)

    pop3c: Added support for TOP/RETR prefetching when PIPIELINING capability
    exists.


M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.h

2016-01-26 15:40:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (60d1fdf)

    pop3c: Added full support for running commands asynchronously (with
    PIPELINING)


M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-client.h
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c

2016-01-26 15:38:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9999b04)

    pop3c: Increased command timeout from 30s to 5mins.

    Possibly should be made configurable, but use this for now.

M	src/lib-storage/index/pop3c/pop3c-client.c

2016-01-26 15:22:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9abc6ac)

    pop3-migration: Cached header hashes weren't actually being used for imapc.

    We'll need to do the search twice: Once to find out the actual cached header 
    hashes and then second time do a search for the message headers excluding
    the emails whose hashes we already know. This allows prefetching to work for
    imapc without prefetching all the emails as it was doing.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-26 15:20:48 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5c92436)

    lib: istream-concat now seeks parent streams to correct offset.

    All of the streams' offsets were somewhat random.

M	src/lib/istream-concat.c
M	src/lib/test-istream-concat.c

2016-01-26 15:17:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0c3ec25)

    lib: Small istream-concat code cleanup in preperation for next change

    No actual changes, just moved some code into i_stream_concat_skip().

M	src/lib/istream-concat.c

2016-01-26 14:19:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (96af3e7)

    lib: Improved test-istream-seekable unit test to check for parent stream's
    offset at the end


M	src/lib/test-istream-seekable.c

2016-01-26 13:51:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3ab6729)

    lib: When closing istream-chain, make sure parent stream is seeked to
    correct offset.

    We were only seeking it earlier if it ended at EOF.

M	src/lib/Makefile.am
M	src/lib/istream-chain.c
A	src/lib/test-istream-chain.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2016-01-25 22:34:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (57e1fdc)

    pop3-migration: Add calculated header hashes to local cache.

    This allows faster resuming on failures if local pop3c indexes are used.

M	src/plugins/pop3-migration/Makefile.am
M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-25 22:33:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2676c97)

    pop3c: Preserve local cache even when server reorders messages.


M	src/lib-storage/index/pop3c/pop3c-sync.c

2016-01-25 21:57:35 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c06f45d)

    pop3c: Avoid unnecessarily email deletions from local index when mails have
    been deleted from remote POP3.


M	src/lib-storage/index/pop3c/pop3c-sync.c

2016-01-25 17:37:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (759a60c)

    imap: Finish all commands before starting IDLE.

    We don't want to send tagged command replies only after the DONE. Also this 
    fixes assert-crash:

    Panic: file imap-client.c: line 852 (client_check_command_hangs): assertion 
    failed: (!have_wait_unfinished || unfinished_count > 0)

    Which could be reproduced by:

    printf "0 SELECT INBOX\n1 NOOP\n2 IDLE\n"; read; printf "DONE\n"; read) |
    ./imap

M	src/imap/imap-commands.c

2016-01-25 10:26:17 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5085686)

    imapc: Prefetching shouldn't send FETCH requests for headers that are
    already cached.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h

2016-01-24 22:12:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b76737b)

    auth: Add any %variables in passdb/userdb { default_fields } to cache key.


M	src/auth/passdb.c
M	src/auth/userdb.c

2016-01-24 22:10:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (80e80d4)

    auth: Avoid unnecessary work if passdb/userdb { override_fields,
    default_fields } aren't set.


M	src/auth/passdb-template.c
M	src/auth/passdb-template.h
M	src/auth/userdb-template.c

2016-01-24 22:07:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2386f34)

    .gitignore: Added *.orig and *.rej

    They are created often enough to become annoying.

M	.gitignore

2016-01-24 22:06:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0fa40bf)

    config: Fixed '\' line continuation to work again.

    This had been broken for many years.

M	src/config/config-parser-private.h
M	src/config/config-parser.c
M	src/config/old-set-parser.c

2016-01-24 20:07:58 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (72020d0)

    imapc: If command times out, reconnect and retry if possible.


M	src/lib-imap-client/imapc-connection.c

2016-01-24 19:54:51 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (30f6ac0)

    pop3-migration: Fix to 2f19f8 - Don't convert LF also to '?' in header
    hashes.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-24 19:34:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5fa253b)

    pop3-migration: Filter out headers with invalid names.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-24 19:23:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2f19f8f)

    pop3-migration: Convert all non-ASCII in headers to '?'


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-24 18:15:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2ddc5ef)

    imapc: Added imapc_features=fetch-fix-broken-mails

    This allows ignoring a missing FETCH reply. It shouldn't be used normally, 
    but if there's a mail that the IMAP server simply won't serve, this can be 
    used to finish dsync successfully.

M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h

2016-01-24 17:41:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cff23ec)

    imapc: Added imapc_cmd_timeout setting to control the command wait timeouts.


M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2016-01-24 17:39:28 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (53841bd)

    imapc: Added imapc_features=fetch-msn-workarounds

    This can be used to work around broken servers that send invalid MSNs. This 
    avoids errors like:

    imapc: Mailbox 'INBOX' state corrupted: FETCH UID mismatch (78976 != 82589)

M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h

2016-01-24 17:38:39 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e9d659a)

    pop3-migration: If we matched all the IMAP (but not all POP3) messages, log
    about it.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-24 17:13:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c39c3d8)

    pop3-migration: Ignore X-Yahoo-Newman-Property: header

    This exists only for Yahoo IMAP mails, but not for Yahoo POP3 mails.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-24 16:55:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (12e3273)

    pop3-migration: When logging the first missing POP3 mail, it logged a wrong
    mail


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-24 16:28:29 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (af99ca8)

    pop3-migration: When failing because some messages couldn't be matched, show
    the first message's number and UIDL

    This was already being done for the warning message when 
    pop3_migration_ignore_missing_uidls was set, but not for the error message 
    when it wasn't set.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-24 16:27:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b215322)

    pop3-migration: Added pop3_migration_skip_size_check setting

    If we know that we're not going to be able to match any messages by sizes, 
    we might as well not ask for the messages' sizes. This is useful at least 
    with Yahoo.

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-24 16:25:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (35ef661)

    pop3-migration: Ignore Return-Path: header when matching UIDLs by header
    hashes

    This fixes matching between Yahoo IMAP and Yahoo POP3

M	src/plugins/pop3-migration/pop3-migration-plugin.c

2016-01-23 15:48:14 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b23317e)

    auth: Apply override_fields to userdb also when continuing to the next
    userdb.


M	src/auth/auth-request.c

2016-01-23 15:12:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (cc4723a)

    auth: If userdb result was found from cache, its result_* rules were
    ignored.


M	src/auth/auth-request.c

2016-01-23 14:05:19 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9fa4ac6)

    ldap auth: %variables in pass/user_attrs are now included in auth cache key.

    This makes sure that the result won't be cached too aggressively, for
    example if %{lport} or %{rip} was used as a field's value. Although each of
    these fields just makes the cache less effective, so it's a good idea to
    avoid variables entirely in the pass/user_attrs. An alternative is to use 
    passdb/userdb { override_fields }

M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2016-01-23 13:57:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e150cd7)

    auth: Apply passdb/userdb { override_fields } only after caching

    Now they're not be unnecessarily saved to cache to waste memory. More 
    importantly they will always override the cached fields, which is required 
    for %variables to work.

M	src/auth/auth-request.c

2016-01-22 19:06:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (57591c5)

    doveadm: Changed most print formatters to write to ostream.

    This allows all the formatters to be used when sending replies to the 
    upcoming doveadm HTTP server responses.

    The "table" formatter wasn't modified, because it writes to both stdout and 
    stderr.

M	src/doveadm/client-connection.c
M	src/doveadm/client-connection.h
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-print.h
M	src/doveadm/doveadm-server.h
M	src/doveadm/doveadm.c

2016-01-22 19:08:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (78a6431)

    director: "Host is being updated before previous update had finished" logs
    now details.


M	src/director/director-connection.c

2016-01-22 15:15:03 +0000 Alin Dobre <alin@dovecot.fi> (127d071)

    doveadm: Add plugins support for doveadm pw

    This simply tries to load all the auth plugins. The ones that aren't 
    password scheme plugins will most likely just fail. Hopefully this will work
    fine so we don't need to require any specific naming rules for the plugins.

    Signed-off-by: Alin Dobre <alin@dovecot.fi>

M	src/doveadm/Makefile.am
M	src/doveadm/doveadm-pw.c

2016-01-22 17:14:37 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (34a41fd)

    fts-solr: If Solr lookup returns missing or invalid UID, fail the search.

    We were previously logging the error but still returning success.

M	src/plugins/fts-solr/solr-connection.c

2016-01-22 16:48:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (82130fe)

    doveadm: Make sure all mail storage hooks are freed at deinit.


M	src/doveadm/doveadm-mail.c
M	src/lib-storage/mail-storage-hooks.c

2016-01-18 15:50:23 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (5b63d2b)

    master: Do not close stdout if going foreground

    This lets one to use /dev/stdout for logging. Mainly useful for testing
    purposes where we can generate log output to stdout and use tee to write it
    to a file for later examination.

M	src/master/main.c

2016-01-21 13:59:31 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7ab22fc)

    lib-auth: Error message typofix


M	src/lib-auth/auth-server-connection.c

2016-01-20 19:35:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8eac846)

    Makefile: Fixed ChangeLog generation with older git versions that don't
    support --since

    Changed the oldest changeset to be the v2.0.0 release commit.

M	Makefile.am

2016-01-20 13:30:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1fba10f)

    imap, pop3, lmtp: Enable MAIL_STORAGE_SERVICE_FLAG_AUTOEXPUNGE


M	src/imap/main.c
M	src/lmtp/main.c
M	src/pop3/main.c

2016-01-20 13:30:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8cca3b4)

    lib-storage: Enable autoexpunge only when
    MAIL_STORAGE_SERVICE_FLAG_AUTOEXPUNGE is set.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2016-01-20 13:22:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8c68d93)

    lib-storage: Fixed looking up MAILBOX_METADATA_FIRST_SAVE_DATE from mailbox
    list index.

    If the mailbox was cached as empty, we didn't check if it had since received 
    new messages. This caused the first-save-date to be returned as nonexistent, 
    which caused autoexpunging to not always work.

M	src/lib-storage/list/mailbox-list-index-status.c

2016-01-20 13:13:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ebeb528)

    lib-storage: Fixed updating first-saved-uid to mailbox list index when first
    mails were just expunged.


M	src/lib-storage/list/mailbox-list-index-status.c

2016-01-20 12:55:57 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ec0105e)

    lib-storage: Don't set internal error to storage when there's nothing to
    sync.

    This may also wrongly overwrite an existing error.

M	src/lib-storage/index/index-storage.c

2016-01-19 23:47:08 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (52fe791)

    imap-login: If LOGINDISABLED capability is advertised in banner, don't try
    to LOGIN without SSL/TLS.

    This avoids accidentally sending the password in plaintext. Also the server 
    should fail the LOGIN in any case.

M	src/imap-login/imap-login-client.h
M	src/imap-login/imap-proxy.c

2016-01-19 20:45:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (29ca4c8)

    lib: Don't crash if getenv() is called after process_title_deinit() with
    Linux/OSX PROCTITLE_HACK

    Right now the only known issue is GNUTLS's lib_deinit():

    e = getenv("GNUTLS_NO_EXPLICIT_INIT");

    But we likely never want that to be set. Alternative ways to solve this are 
    more annoying than our clearing the environment. Libraries probably
    shouldn't rely on it much anyway, because some parts of Dovecot clear the
    whole environment while running.

M	src/lib/process-title.c

2016-01-19 15:39:13 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0df899f)

    config: Improved error messages for wrong order of nested
    local/remote/protocol { .. } blocks


M	src/config/config-parser.c

2016-01-19 15:15:19 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d861bc0)

    quota-clone: Avoid leaving a dict transaction open for unnecessarily long.

    Even though the earlier change should fix the dict assert crash due to 
    opening multiple transactions when recursing back, this makes sure of it. It
    could also be helpful for some dict backends to not keep the transaction 
    open for unnecessarily long.

M	src/plugins/quota-clone/quota-clone-plugin.c

2016-01-19 15:11:44 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5da08ab)

    quota-clone: Fixed update-recursion crash when closing mailbox.

    We need to avoid recursing for all mailboxes that quota recalculation might
    open and close, not just the one that triggered the recalculation.

M	src/plugins/quota-clone/quota-clone-plugin.c

2016-01-19 02:30:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (934f04e)

    pop3c: If authentication fails, log if it was done with USER+PASS or AUTH
    PLAIN


M	src/lib-storage/index/pop3c/pop3c-client.c

2016-01-19 02:26:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (56b13d0)

    pop3c: Improve authentication debug log messages a bit.


M	src/lib-storage/index/pop3c/pop3c-client.c

2016-01-18 17:38:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (aabc4ae)

    auth: If passdbs are required, don't allow only master=yes passdbs.

    This fixes a crash:

    Panic: file auth-request.c: line 743 (auth_request_is_disabled_master_user): 
    assertion failed: (request->requested_login_user != NULL)

    Which would happen because request->passdb=NULL because there are only 
    master passdbs. Even if only master passdb is actually needed, there should 
    still be a non-master passdb for non-master logins to specify what happens 
    to them.

M	src/auth/auth.c

2016-01-18 17:08:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c21ce74)

    *-login: Typofix for login_plugins error messages.


M	src/login-common/main.c

2016-01-18 14:59:50 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (741a7e6)

    lib-fs: Added default implementations for fs_iter_*(), fs_copy() and
    fs_stat()

    The backends can now leave them as NULL, and the callers will get an error 
    that they're not supported.

M	src/lib-fs/fs-api.c

2016-01-18 14:57:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (1e6170b)

    lib-mail: istream-binary-converter lost last few chars from root-level
    binary content.


M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/test-istream-binary-converter.c

2016-01-18 14:56:47 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (498eecf)

    lib-mail: message-parser unit test now verifies that parsed block parts
    match input.


M	src/lib-mail/test-message-parser.c

2016-01-18 14:56:24 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (d45a4c7)

    lib-mail: Added message_header_line_write()


M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-header-parser.h

2016-01-15 14:11:34 +0200 Aki Tuomi <aki.tuomi@dovecot.net> (5c7c62f)

    ChangeLog: Generate mercurial style changelogs


M	Makefile.am
M	autogen.sh

2016-01-18 13:28:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (96c8008)

    lib-storage: Ignore ACLs when autoexpunging.


M	src/lib-storage/mail-autoexpunge.c

2016-01-18 12:31:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c80cf58)

    quota: Fixed namespace filtering for dict and count backends.


M	src/plugins/quota/quota-count.c

2016-01-16 21:47:53 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (47a53a8)

    lib-http: Assign an ID for each HTTP request and log it in debug lines.

    The ID stays the same when request is retried. Added a "Req" prefix so it's 
    easier to search for the IDs. Based on patch by Stephan Bosch.

M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2016-01-16 21:31:55 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bd06c77)

    imapc: Added support for PROXYAUTH command by setting imapc_features =
    proxyauth

    This can be useful when talking to Sun/Oracle IMAP server, which wants you 
    to use LOGIN+PROXYAUTH to perform master user logins, instead of supporting 
    the standard SASL PLAIN authentication.

M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2016-01-15 19:36:46 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f8567d8)

    stats: Added missing #include forgotten in 63393b70


M	src/stats/client.c

2016-01-12 09:47:43 +0200 Aki Tuomi <aki.tuomi@dovecot.net> (102af99)

    doveadm-stats: Add documentation about stats subcommand


M	.gitignore
M	doc/man/Makefile.am
A	doc/man/doveadm-stats.1.in
M	doc/man/doveadm.1.in

2016-01-11 15:46:35 +0200 Aki Tuomi <aki.tuomi@dovecot.net> (f970f2a)

    doveadm-stats: Add stats reset command line


M	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm.c

2016-01-11 15:46:28 +0200 Aki Tuomi <aki.tuomi@dovecot.net> (63393b7)

    stats: Add RESET call to stats client


M	src/stats/Makefile.am
A	src/stats/client-reset.c
A	src/stats/client-reset.h
M	src/stats/client.c

2016-01-11 15:46:05 +0200 Aki Tuomi <aki.tuomi@dovecot.net> (75b12af)

    lib-stats: Add stats_reset function


M	src/lib-stats/stats.c
M	src/lib-stats/stats.h

2016-01-07 11:09:50 +0200 Aki Tuomi <aki.tuomi@dovecot.fi> (7d4c804)

    lib-fts: Add lib-fts to CPPFLAGS as include dir

    Without this, VPATH builds fail because the includes cannot be found as they
    are not on same directory.

M	src/lib-fts/Makefile.am

2016-01-15 18:03:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9132f9d)

    *-login: Allow plugins to hook into client allocation and add
    module-specific contexts to client.


M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/login-common.h
M	src/login-common/main.c

2016-01-15 17:17:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ad24c03)

    dovecot-config: Added LIBDOVECOT_{AUTH/POP3/IMAP_LOGIN}_INCLUDE


M	dovecot-config.in.in
M	dovecot.m4

2016-01-15 16:51:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (98035bd)

    imap-login: Install imap-login-*.h headers so plugins can use them.


M	src/imap-login/Makefile.am

2016-01-15 16:49:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0af9ef2)

    imap-login: Renamed client.[ch] to imap-login-client.[ch]

    This allows installing the imap-login-client.h without conflicting.

M	src/imap-login/Makefile.am
M	src/imap-login/client-authenticate.c
R099	src/imap-login/client.c	src/imap-login/imap-login-client.c
R096	src/imap-login/client.h	src/imap-login/imap-login-client.h
M	src/imap-login/imap-proxy.c

2016-01-15 16:46:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ba7db1e)

    imap-login: Added API for registering/unregistering commands (for plugins).


M	src/imap-login/Makefile.am
M	src/imap-login/client.c
A	src/imap-login/imap-login-commands.c
A	src/imap-login/imap-login-commands.h

2016-01-15 16:07:32 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (4819488)

    *-login: Added login_plugins and login_plugin_dir settings.


M	src/login-common/Makefile.am
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h
M	src/login-common/main.c

2016-01-15 16:20:45 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7d8862f)

    Added v2.2.21 to NEWS.


M	NEWS

2016-01-15 15:55:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fa68ab2)

    *-login: Changed -D parameter to mean a more generic login_debug option.


M	src/login-common/login-common.h
M	src/login-common/main.c

2016-01-15 15:40:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (df596e3)

    imapc: Added imapc_features = no-examine


M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2016-01-15 15:12:30 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9d7f23f)

    dsync: Fixed syncing subscription state with doveadm backup.

    If DSYNC_MAILBOX_TREES_SYNC_TYPE_PRESERVE_REMOTE was set, we could still
    have preserved the local subscription state. Also cleaned up the code a bit
    to make it clearer.

M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2016-01-15 15:04:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (e21baa3)

    imapc: Fixed mailbox name escaping for STATUS


M	src/lib-storage/index/imapc/imapc-storage.c

2016-01-14 18:52:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6e2bb07)

    imapc: Fixed mailbox name escaping for CREATE, DELETE, RENAME, SUBSCRIBE,
    UNSUBSCRIBE


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c

2016-01-14 18:50:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f97b503)

    imapc: Fixed escaping/unescaping mailbox names.

    This fixes accessing mailbox names with '%' (the escape_char). It also fixes 
    local namespace separator being different from the remote separator.

M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2016-01-14 18:47:40 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a4e2101)

    lib-storage: Added mailbox_list_[un]escape_name_params()

    This allows calling the mailbox_list_[un]escape_name() with wanted
    parameters instead of taking them from mailbox_list.

M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2016-01-14 16:28:06 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (be3b937)

    imapc: Don't duplicate standard mailbox flags in LIST replies.

    We added the standard \NoSelect, \NonExistent, \NoInferiors and \Subscribed 
    to special_use string, which caused them to be sent duplicated.

M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/mailbox-list.h

2016-01-13 14:30:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (27f174f)

    virtual plugin: Added support for filtering mailboxes by METADATA entries.

    Usage:

    <mailbox patterns as usual>
    [-]/<metadata-entry-name>:<value-wildcard>

    There can be multiple metadata entries. All the entries must match.

    For example:

    *
    /private/vendor/vendor.dovecot/virtual:*
    -/private/vendor/vendor.dovecot/virtual:ignore

    This matches all mailboxes, which contain a virtual METADATA entry that has 
    any value except "ignore".

    Note that the current implementation requires still opening all the
    mailboxes before matching the METADATA entries. This could be avoided in
    v2.3 with some lib-storage API changes.

M	src/plugins/virtual/Makefile.am
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-storage.h

2016-01-13 14:22:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bffa23c)

    lib-imap-storage: imap_metadata_get*() returned 1 also when value wasn't
    found.


M	src/lib-imap-storage/imap-metadata.c

2016-01-13 13:46:33 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (28d6a9e)

    virtual plugin: Cleaned up behavior of '!' prefix with '+' and '-'

    It makes a bit more sense now. Mainly the difference is that "!foo*" means 
    to save mails to a mailbox called "foo*", instead of including mailboxes 
    matching "!foo*" pattern to the virtual mailbox. It's unlikely anyone was 
    relying on this behavior.

M	src/plugins/virtual/virtual-config.c

2016-01-13 13:41:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (77a2367)

    virtual plugin: Don't treat "+-box" as a negative entry.

    This was already documented by wiki to work as a mailbox named "-box", 
    although it didn't actually work that way. There wasn't any practical 
    difference between "+-box" and "-box", so this change is unlikely to break 
    anyone's config. It was mainly done as code cleanup.

M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-storage.h

2016-01-13 13:31:54 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (fb297df)

    virtual plugin: Minor cleanup/fix - find the namespace after we have
    processed special prefixes.

    We already skipped over them earlier, but the logic wasn't exactly the same 
    as when they were actually being processed, so there could have been some 
    unexpected mismatches.

M	src/plugins/virtual/virtual-config.c

2016-01-13 12:24:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (02c335c)

    global: freshen copyright

    git ls-files | xargs perl -p -i -e 's/(\d+)-201[0-5]/$1-2016/g;s/ (201[0-5])
    Dovecot/ $1-2016 Dovecot/'

M	doc/man/doveadm-acl.1.in
M	doc/man/doveadm-altmove.1.in
M	doc/man/doveadm-auth.1.in
M	doc/man/doveadm-batch.1.in
M	doc/man/doveadm-deduplicate.1.in
M	doc/man/doveadm-director.1.in
M	doc/man/doveadm-dump.1.in
M	doc/man/doveadm-exec.1.in
M	doc/man/doveadm-expunge.1.in
M	doc/man/doveadm-fetch.1.in
M	doc/man/doveadm-flags.1.in
M	doc/man/doveadm-force-resync.1.in
M	doc/man/doveadm-fts.1.in
M	doc/man/doveadm-help.1.in
M	doc/man/doveadm-import.1.in
M	doc/man/doveadm-index.1.in
M	doc/man/doveadm-instance.1.in
M	doc/man/doveadm-kick.1.in
M	doc/man/doveadm-log.1.in
M	doc/man/doveadm-mailbox.1.in
M	doc/man/doveadm-mount.1.in
M	doc/man/doveadm-move.1.in
M	doc/man/doveadm-penalty.1.in
M	doc/man/doveadm-proxy.1.in
M	doc/man/doveadm-purge.1.in
M	doc/man/doveadm-pw.1.in
M	doc/man/doveadm-quota.1.in
M	doc/man/doveadm-replicator.1.in
M	doc/man/doveadm-search-query.7
M	doc/man/doveadm-search.1.in
M	doc/man/doveadm-sync.1.in
M	doc/man/doveadm-user.1.in
M	doc/man/doveadm-who.1.in
M	doc/man/doveadm.1.in
M	doc/man/doveconf.1.in
M	doc/man/dovecot-lda.1.in
M	doc/man/dovecot.1.in
M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-fields.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-token.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-dict-cache-key.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-dovecot-token.c
M	src/auth/mech-external.c
M	src/auth/mech-plain.c
M	src/auth/mech-scram-sha1.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-template.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c
M	src/auth/test-auth-cache.c
M	src/auth/test-auth-request-var-expand.c
M	src/auth/test-db-dict.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-template.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-dict.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-batch.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-save.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-pw.c
M	src/doveadm/doveadm-replicator.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-deserializer.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox.c
M	src/doveadm/dsync/dsync-serializer.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/imap-hibernate/imap-client.c
M	src/imap-hibernate/imap-hibernate-client.c
M	src/imap-hibernate/imap-hibernate-settings.c
M	src/imap-hibernate/imap-master-connection.c
M	src/imap-hibernate/main.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-login-settings.c
M	src/imap-urlauth/imap-urlauth-login.c
M	src/imap-urlauth/imap-urlauth-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap-urlauth/imap-urlauth.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-genurlauth.c
M	src/imap/cmd-getmetadata.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-resetkey.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-setmetadata.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-urlfetch.c
M	src/imap/cmd-x-cancel.c
M	src/imap/cmd-x-state.c
M	src/imap/imap-client-hibernate.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-list.c
M	src/imap/imap-master-client.c
M	src/imap/imap-notify.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-state.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-settings.c
M	src/indexer/indexer-worker-settings.c
M	src/indexer/indexer-worker.c
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-pool.c
M	src/ipc/client.c
M	src/ipc/ipc-connection.c
M	src/ipc/ipc-group.c
M	src/ipc/ipc-settings.c
M	src/ipc/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-charset/test-charset.c
M	src/lib-compression/compression.c
M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lz4.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c
M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-lz4.c
M	src/lib-compression/ostream-lzma.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-compression/test-compression.c
M	src/lib-dict/dict-cdb.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-fs.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-register.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict-transaction-memory.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-dict.c
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/istream-fs-file.c
M	src/lib-fs/istream-fs-stats.c
M	src/lib-fs/istream-metawrap.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-fs/ostream-metawrap.c
M	src/lib-fts/fts-filter-contractions.c
M	src/lib-fts/fts-filter-english-possessive.c
M	src/lib-fts/fts-filter-lowercase.c
M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-icu.c
M	src/lib-fts/fts-language.c
M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/fts-tokenizer.c
M	src/lib-fts/test-fts-filter.c
M	src/lib-fts/test-fts-icu.c
M	src/lib-fts/test-fts-language.c
M	src/lib-fts/test-fts-tokenizer.c
M	src/lib-http/http-auth.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-date.c
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-header.c
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-parser.c
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-url.c
M	src/lib-http/test-http-auth.c
M	src/lib-http/test-http-client.c
M	src/lib-http/test-http-date.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-request-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-server.c
M	src/lib-http/test-http-transfer.c
M	src/lib-http/test-http-url.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-imap-storage/imap-metadata.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-keepalive.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-bodystructure.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-quote.c
M	src/lib-imap/test-imap-url.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/mail-html2text.c
M	src/lib-mail/mail-user-hash.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-binary-part.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-part.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-size.c
M	src/lib-mail/message-snippet.c
M	src/lib-mail/ostream-dot.c
M	src/lib-mail/qp-decoder.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-mail/test-istream-binary-converter.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-mail-html2text.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-message-part.c
M	src/lib-mail/test-message-snippet.c
M	src/lib-mail/test-ostream-dot.c
M	src/lib-mail/test-qp-decoder.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-mail/test-rfc822-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-haproxy.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service.c
M	src/lib-master/mountpoint-list.c
M	src/lib-master/syslog-util.c
M	src/lib-master/test-master-service-settings-cache.c
M	src/lib-sasl/dsasl-client.c
M	src/lib-sasl/mech-login.c
M	src/lib-sasl/mech-plain.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-sql/driver-cassandra.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-stats/stats-parser.c
M	src/lib-stats/stats.c
M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/fail-mail.c
M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-deleted-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-list-index.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-notify-tree.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-autoexpunge.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-args-cmdline.c
M	src/lib-storage/mail-search-args-imap.c
M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-attribute-internal.c
M	src/lib-storage/mailbox-attribute.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list-notify.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-recent-flags.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/mailbox-watch.c
M	src/lib-storage/test-mail-search-args-imap.c
M	src/lib-storage/test-mail-search-args-simplify.c
M	src/lib-storage/test-mailbox-get.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base32.c
M	src/lib/base64.c
M	src/lib/bits.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/compat.c
M	src/lib/connection.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fd-set-nonblock.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-create-locked.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/guid.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/hmac.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-temp.c
M	src/lib/iostream.c
M	src/lib/ipwd.c
M	src/lib/iso8601-date.c
M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-callback.c
M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-failure-at.c
M	src/lib/istream-file.c
M	src/lib/istream-hash.c
M	src/lib/istream-jsonstr.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/istream-sized.c
M	src/lib/istream-tee.c
M	src/lib/istream-timeout.c
M	src/lib/istream-unix.c
M	src/lib/istream.c
M	src/lib/json-parser.c
M	src/lib/json-tree.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/net.c
M	src/lib/nfs-workarounds.c
M	src/lib/numpack.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-failure-at.c
M	src/lib/ostream-file.c
M	src/lib/ostream-hash.c
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/primes.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/rand.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str-table.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base32.c
M	src/lib/test-base64.c
M	src/lib/test-bits.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-data-stack.c
M	src/lib/test-failures.c
M	src/lib/test-guid.c
M	src/lib/test-hash-format.c
M	src/lib/test-hash-method.c
M	src/lib/test-hash.c
M	src/lib/test-hex-binary.c
M	src/lib/test-ioloop.c
M	src/lib/test-iso8601-date.c
M	src/lib/test-istream-base64-decoder.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-failure-at.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-istream-unix.c
M	src/lib/test-istream.c
M	src/lib/test-json-parser.c
M	src/lib/test-json-tree.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-net.c
M	src/lib/test-numpack.c
M	src/lib/test-ostream-failure-at.c
M	src/lib/test-ostream-file.c
M	src/lib/test-primes.c
M	src/lib/test-printf-format-fix.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-str-table.c
M	src/lib/test-str.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-strnum.c
M	src/lib/test-time-util.c
M	src/lib/test-timing.c
M	src/lib/test-unichar.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/test-wildcard-match.c
M	src/lib/time-util.c
M	src/lib/timing.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/uri-util.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/doveadm-connection.c
M	src/log/log-connection.c
M	src/log/log-error-buffer.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/capabilities-posix.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile-update.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-global-file.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fs-compress/fs-compress.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser-tika.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search-args.c
M	src/plugins/fts/fts-search-serialize.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/xml2text.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/last-login/last-login-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-filter/istream-ext-filter.c
M	src/plugins/mail-filter/mail-filter-plugin.c
M	src/plugins/mail-filter/ostream-ext-filter.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/mailbox-alias/mailbox-alias-plugin.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-storage.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/pop3-migration/test-pop3-migration-plugin.c
M	src/plugins/push-notification/push-notification-driver-dlog.c
M	src/plugins/push-notification/push-notification-driver-ox.c
M	src/plugins/push-notification/push-notification-drivers.c
M	src/plugins/push-notification/push-notification-drivers.h
M	src/plugins/push-notification/push-notification-event-flagsclear.c
M	src/plugins/push-notification/push-notification-event-flagsclear.h
M	src/plugins/push-notification/push-notification-event-flagsset.c
M	src/plugins/push-notification/push-notification-event-flagsset.h
M	src/plugins/push-notification/push-notification-event-mailboxcreate.c
M	src/plugins/push-notification/push-notification-event-mailboxcreate.h
M	src/plugins/push-notification/push-notification-event-mailboxdelete.c
M	src/plugins/push-notification/push-notification-event-mailboxdelete.h
M	src/plugins/push-notification/push-notification-event-mailboxrename.c
M	src/plugins/push-notification/push-notification-event-mailboxrename.h
M	src/plugins/push-notification/push-notification-event-mailboxsubscribe.c
M	src/plugins/push-notification/push-notification-event-mailboxsubscribe.h
M	src/plugins/push-notification/push-notification-event-mailboxunsubscribe.c
M	src/plugins/push-notification/push-notification-event-mailboxunsubscribe.h
M	src/plugins/push-notification/push-notification-event-message-common.h
M	src/plugins/push-notification/push-notification-event-messageappend.c
M	src/plugins/push-notification/push-notification-event-messageappend.h
M	src/plugins/push-notification/push-notification-event-messageexpunge.c
M	src/plugins/push-notification/push-notification-event-messageexpunge.h
M	src/plugins/push-notification/push-notification-event-messagenew.c
M	src/plugins/push-notification/push-notification-event-messagenew.h
M	src/plugins/push-notification/push-notification-event-messageread.c
M	src/plugins/push-notification/push-notification-event-messageread.h
M	src/plugins/push-notification/push-notification-event-messagetrash.c
M	src/plugins/push-notification/push-notification-event-messagetrash.h
M	src/plugins/push-notification/push-notification-events-rfc5423.c
M	src/plugins/push-notification/push-notification-events-rfc5423.h
M	src/plugins/push-notification/push-notification-events.c
M	src/plugins/push-notification/push-notification-events.h
M	src/plugins/push-notification/push-notification-plugin.c
M	src/plugins/push-notification/push-notification-plugin.h
M	src/plugins/push-notification/push-notification-triggers.c
M	src/plugins/push-notification/push-notification-triggers.h
M	src/plugins/push-notification/push-notification-txn-mbox.c
M	src/plugins/push-notification/push-notification-txn-mbox.h
M	src/plugins/push-notification/push-notification-txn-msg.c
M	src/plugins/push-notification/push-notification-txn-msg.h
M	src/plugins/quota-clone/quota-clone-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-status.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota-util.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/test-quota-util.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/stats/mail-stats-fill.c
M	src/plugins/stats/mail-stats.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/replication/aggregator/aggregator-settings.c
M	src/replication/aggregator/aggregator.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/dsync-client.c
M	src/replication/replicator/notify-connection.c
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue-auth.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/stats/client-export.c
M	src/stats/client.c
M	src/stats/global-memory.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-server-connection.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.c
M	src/stats/mail-user.c
M	src/stats/main.c
M	src/stats/stats-settings.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2016-01-13 11:22:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (43bdd92)

    lib-storage: Fixed autoexpunge=yes to work with namespace's root mailbox.

    namespace { mailbox "" { autoexpunge = .. } }

M	src/lib-storage/mail-autoexpunge.c

2015-12-23 14:45:08 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (40bdcc2)

    lib-fts: Create library for development packages.


M	Makefile.am
M	src/lib-fts/Makefile.am

2016-01-11 19:00:07 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (46ce4d9)

    lib: i_stream_get_error() now returns "EOF" if stream_errno==0 and
    eof==TRUE.

    This can be used to replace a lot of code like:

    input->stream_errno == 0 ? "EOF" : i_stream_get_error(input)

    with simply:

    i_stream_get_error(input)

M	src/lib/istream.c
M	src/lib/istream.h

2016-01-09 22:55:15 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (513c911)

    Removed now-unused is-tagged.py


M	Makefile.am
D	is-tagged.py

2016-01-08 18:12:21 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (0102fd5)

    auth: Don't crash if passwd-file can't be opened


M	src/auth/db-passwd-file.c

2016-01-08 17:04:27 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (480a5af)

    lib-settings: If SET_UINT_OCT has invalid value, we ignored the error and
    returned garbage value.


M	src/lib-settings/settings-parser.c

2016-01-08 17:02:56 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (9404dc8)

    lib-settings: Fixed parsing '0' value for SET_UINT_OCT.

    This was used only by service { *_listener { mode } }

M	src/lib-settings/settings-parser.c

2016-01-08 13:24:32 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f148466)

    lib-mail: message-parser was counting body_size wrong for truncated MIME
    headers after 7d800c55


M	src/lib-mail/message-parser.c
M	src/lib-mail/test-message-parser.c

2016-01-07 22:14:59 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (5f35231)

    lib-storage: mailbox_exists() shouldn't return INBOX as nonexistent if it's
    not created yet.


M	src/lib-storage/mail-storage.c

2016-01-07 22:02:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bdf3c77)

    update-version.sh: Explicitly specify git directory.


M	update-version.sh

2016-01-05 11:17:26 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (6c510fa)

    pop3: Make sure pop3_lock_session=yes creates the lock's directory if it's
    missing.

    This happened at least with mbox if the root .imap/ didn't exist yet.

M	src/pop3/pop3-client.c

2016-01-05 11:08:01 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (e7ff41f)

    auth: Fixed allow_nets=local to work correctly with non-local remote IP


M	src/auth/auth-request.c

2016-01-05 11:01:26 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (7dea519)

    imap: Don't hang at ambiguous commands when they were pipelined already
    before login

    For example if all of these are sent in a single IP packet:

    a login user pass b select inbox c noop d unselect

M	src/imap/main.c

2016-01-04 14:34:01 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (ddffbb2)

    imap: Avoid crashing at deinit if mail_user_unref() triggers
    mail_storage_callbacks

    This could have happened with Maildir/mbox and autoexpunging.

M	src/imap/imap-client.c

2016-01-04 14:23:46 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (76e5f0f)

    lib-storage: Fixed autoexpunge for namespaces with non-empty prefix


M	src/lib-storage/mail-autoexpunge.c

2016-01-04 14:15:50 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (f53a1b9)

    auth: If allow_nets has an invalid value, don't attempt to compare it
    anymore.

    This fixes a potential crash because net_is_in_network() was called with 
    garbage net_ip.

M	src/auth/auth-request.c

2016-01-04 14:10:44 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (7375e38)

    lib: Added unit tests for net_is_in_network() about IPv4-mapped IPv6
    addresses


M	src/lib/net.h
M	src/lib/test-net.c

2016-01-04 14:00:19 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (3ad31bc)

    lib: Fixed assert-crash with net_is_in_network(family=ipv6, family=0, ..)


M	src/lib/net.c
M	src/lib/test-net.c

2016-01-04 20:51:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (f6d8250)

    dict: Avoid a crash when dict connection is already closed when async lookup
    finishes.


M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-connection.h

2016-01-04 13:12:18 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (f136b00)

    imap: Make sure pending input is handled when a pending command has input
    locked.

    This hopefully fixes the last assert-crash in client_check_command_hangs()

M	src/imap/imap-client.c

2016-01-04 12:40:39 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (c7801f8)

    imap: Fixed crash in IDLE if DONE is received while sending large output to
    client.

    Fixes assert-crash with backtrace:

M	src/imap/cmd-idle.c

2016-01-04 12:02:12 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (1a591db)

    lib-storage: mail_add_temp_wanted_fields() was reading already-freed memory.

    This mainly happened with mail_log plugin enabled.

M	src/lib-storage/index/index-mail.c

2016-01-04 11:47:24 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (2933174)

    imap: Don't assert-crash if hibernation resumes IDLE, which sends a lot of
    data to client.


M	src/imap/imap-state.c

2015-12-31 04:26:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6920cf9)

    mysql: Don't require connect setting to have host-parameter if option_file
    is set.

    The option_file could also specify the host.

M	src/lib-sql/driver-mysql.c

2015-12-30 08:21:46 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (a4392e9)

    lib-mail: message-parser wasn't returning hdr=NULL blocks after 078c2c8c


M	src/lib-mail/message-parser.c
M	src/lib-mail/test-message-parser.c

2015-12-30 08:21:24 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (4b99408)

    lib-mail: Small test-message-header-parser unit test update


M	src/lib-mail/test-message-header-parser.c

2015-12-28 06:49:29 -0500 Timo Sirainen <timo.sirainen@dovecot.fi> (19e161d)

    dsync: Don't restrict what mailbox names can be created (except basic sanity
    checks)

    The mailbox names already exist on the other side, so we don't want to add 
    arbitrary limits to them.

M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2015-12-23 11:48:12 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3e8c898)

    lib-http: Add more timing information to debug logs when HTTP connections
    get closed.


M	src/lib-http/http-client-connection.c

2015-12-17 05:52:03 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (28b34f3)

    imap: Make static analyzer happier.


M	src/imap/imap-client.c

2015-12-16 15:37:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (15307c2)

    imap: Fixed potential assert-crash with command pipelining.

    Should fix assert-crash: Panic: file imap-fetch.c: line 554: assertion
    failed: (ctx->client->output_cmd_lock == NULL ||
    ctx->client->output_cmd_lock == cmd)

M	src/imap/imap-client.c

2015-12-16 15:26:02 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (107659c)

    doveadm-server: Added -D parameter to enable debugging at startup.

    This mainly makes it show why plugin loads fail.

M	src/doveadm/main.c

2015-12-16 15:25:22 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c6be98b)

    doveadm-server: Fixed loading doveadm plugins that use
    doveadm_dump_register()


M	src/doveadm/Makefile.am
M	src/doveadm/main.c

2015-12-16 15:06:52 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (879dfd4)

    lib-compress: lz4 istream wasn't detected reliably in some situations.

    We requested too few bytes from istream, so there wasn't any guarantee that 
    the istream actually had all the bytes. This caused a problem for example 
    with mdbox when the previous mail was already fetched and the stream
    happened to end in the middle of the lz4 header.

M	src/lib-compression/compression.c

2015-12-16 14:11:04 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a2db811)

    configure: Changed version number to v2.2.devel.

    The actual version numbers live only on the release-branches from now on.

M	configure.ac

2015-12-16 11:59:41 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (c8e9fa2)

    imap: Fixed potential crash when logging about pending commands at logout.


M	src/imap/imap-client.c

2015-12-16 11:29:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3bc62ef)

    lib-dict: Improve EACCES error logging for dict-file.


M	src/lib-dict/dict-file.c

2015-12-15 17:32:09 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (7d800c5)

    lib-mail: message-parser didn't detect MIME part boundaries in the middle of
    MIME part headers.

    Instead the --boundary line was thought to be part of the header itself.

M	src/lib-mail/message-parser.c
M	src/lib-mail/test-message-parser.c

2015-12-15 17:29:11 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a556e29)

    lib-mail: message_header_parser_next() updates istream position immediately
    now.

    Earlier it updated the position only on the next call or at deinit. This was 
    because some earlier code kept pointers to the stream data and stored them 
    to the returned struct message_header_line, but we don't do this anymore.

    This allows more easily accessing the same istream for other purposes during 
    the header parsing.

M	src/lib-mail/message-header-parser.c

2015-12-14 17:42:34 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (2a8253e)

    lib: Avoid passing NULL to qsort() or bsearch() on empty array.

    This wouldn't normally matter because count=0 so it wouldn't be dereferenced 
    anyway. But it triggered a run-time warning from clang, so lets fix it.

M	src/lib/array.c

2015-12-14 12:36:23 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (aa8338d)

    imapc: Removed commented out code.

    It was probably accidentally committed debug code.

M	src/lib-storage/index/imapc/imapc-mailbox.c

2015-12-13 21:25:32 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (6971937)

    doveadm expunge: Using "all" parameter didn't work.


M	src/doveadm/doveadm-mail-expunge.c

2015-12-13 12:33:20 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (3a719a0)

    stats: Avoid assert-crash with dsync.

    dsync creates two mail_users and they're deinited at the same time. 
    stats_global_user isn't set after the first one is deinited, so the next 
    deinit crashed because it wasn't set.

    Fixes: Panic: file stats-plugin.c: line 324 (stats_user_deinit): assertion
    failed:
    (stats_global_user == user)

M	src/plugins/stats/stats-plugin.c

2015-12-11 17:40:36 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (88e0ac0)

    configure: Minor cleanup - avoid code duplication.


M	configure.ac

2015-12-11 17:39:05 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (db35cdb)

    dovecot-config: Fixed setting LIBDOVECOT_LIBFTS[_DEPS]


M	configure.ac
M	dovecot-config.in.in

2015-12-11 16:33:43 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (a93c909)

    director: Don't mark the host desynced if director is alone in ring.


M	src/director/director.c

2015-12-10 14:40:01 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (ed4a4d9)

    director: Don't trigger a ring resync if only last_updown_change has
    changed.


M	src/director/director-connection.c

2015-12-10 11:14:26 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (b567630)

    Makefile: Make ChangeLog depend on .git/index instead of .git/ORIG_HEAD
    ORIG_HEAD doesn't necessarily exist, so maybe index is good for this.


M	Makefile.am

2015-12-09 19:40:18 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (be16427)

    Switched .hgignore to .gitignore


R052	.hgignore	.gitignore

2015-12-09 19:40:10 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (bafa990)

    Removed .hgsigs and .hgtags


D	.hgsigs
D	.hgtags

2015-12-09 18:38:00 +0200 Timo Sirainen <timo.sirainen@dovecot.fi> (8232ca3)

    Makefile, update-version.sh: Switched from hg to git.


M	Makefile.am
M	update-version.sh

2015-12-09 17:37:13 +0200 Timo Sirainen <tss@iki.fi> (da1515d)

    TODO updated


M	TODO

2015-12-09 17:36:49 +0200 Timo Sirainen <tss@iki.fi> (bf04396)

    acl: Empty lines and comments in dovecot-acl files weren't handled
    correctly.


M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile.c

2015-12-09 15:31:37 +0200 Timo Sirainen <tss@iki.fi> (a18335e)

    virtual: Fixed assert-crash when opening virtual mailbox triggered backend
    mailbox autocreation. Fixes assert:

    Panic: file virtual-storage.c: line 335 (virtual_mailbox_opened_hook): 
    assertion failed: (!bbox->open_tracked)

M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2015-12-09 13:51:35 +0200 Timo Sirainen <tss@iki.fi> (6de0cbb)

    lib-storage: Fixed mail_search_args_simplify() with empty args. This fixes
    assert-crash in doveadm mailbox list.


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-09 13:02:46 +0200 Timo Sirainen <tss@iki.fi> (9058f30)

    director: If doveadm attempts to change tag for an existing host, return
    error.


M	src/director/doveadm-connection.c

2015-12-09 13:02:19 +0200 Timo Sirainen <tss@iki.fi> (e307e0f)

    doveadm director update: Tag can't be changed - don't allow -t parameter


M	src/doveadm/doveadm-director.c

2015-12-09 12:43:18 +0200 Timo Sirainen <tss@iki.fi> (1ddf959)

    imap: Added assert to make sure client_command_context isn't freed too
    early.


M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c

2015-12-09 10:49:22 +0200 Timo Sirainen <tss@iki.fi> (738bdc3)

    quota-fs: Fixed getting NFS rquota when the quota was disabled.


M	src/plugins/quota/quota-fs.c

2015-12-08 15:47:28 +0200 Timo Sirainen <tss@iki.fi> (b68472c)

    fts: When indexing header names with lib-fts, add them using "data"
    language.


M	src/plugins/fts/fts-build-mail.c

2015-12-08 13:28:01 +0200 Timo Sirainen <tss@iki.fi> (5ed7a7f)

    fts: Fixed searching for HEADER "" with lib-fts


M	src/plugins/fts/fts-search-args.c

2015-12-08 13:23:19 +0200 Timo Sirainen <tss@iki.fi> (c9099b0)

    lib-storage: mail_search_args_simplify() handles now ALL better.


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-08 13:13:24 +0200 Timo Sirainen <tss@iki.fi> (37ce8d4)

    lib-storage: mail_search_args_simplify() code cleanup - allow merging first
    arg


M	src/lib-storage/mail-search-args-simplify.c

2015-12-08 13:13:10 +0200 Timo Sirainen <tss@iki.fi> (1e167fb)

    lib-storage: Fix to a776ee107aa2 - merged-flag wasn't reset between all
    args.


M	src/lib-storage/mail-search-args-simplify.c

2015-12-08 12:55:40 +0200 Timo Sirainen <tss@iki.fi> (279c6b6)

    lib-storage: Code cleanup - moved BODY/TEXT "" optimization to
    mail_search_args_simplify()


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-08 12:24:42 +0200 Timo Sirainen <tss@iki.fi> (9139e17)

    lib-settings: Allow using comma as deflist separator. This means that when
    adding new block {}s via e.g. userdb or post-login script, the block names
    can now be set with block=a,b,c instead of "block=a b c". This is beneficial
    with e.g. passwd-file or userdb default_fields where spaces are used to
    separate parameters entirely.


M	src/lib-settings/settings-parser.c

2015-12-08 10:18:48 +0200 Timo Sirainen <tss@iki.fi> (47c4991)

    quota-fs: Recalculate relative quota rules when FS limit changes are
    detected.


M	src/plugins/quota/quota-fs.c

2015-12-08 10:17:10 +0200 Timo Sirainen <tss@iki.fi> (191a22e)

    lmtp: Memory leak fixes on handling some RCPT TO failures.


M	src/lmtp/commands.c

2015-12-07 21:09:47 +0200 Timo Sirainen <tss@iki.fi> (fae14d3)

    Added signature for changeset f833b8160e39


M	.hgsigs

2015-12-07 21:09:38 +0200 Timo Sirainen <tss@iki.fi> (08672b1)

    Added tag 2.2.20 for changeset f833b8160e39


M	.hgtags

2015-12-07 21:09:35 +0200 Timo Sirainen <tss@iki.fi> (5124ce6)

    Released v2.2.20.


M	NEWS
M	configure.ac

2015-12-07 16:06:15 +0200 Timo Sirainen <tss@iki.fi> (78c27af)

    lib-ssl-iostream, login-*: Hide unnecessary "EVP_PKEY_get1_EC_KEY:expecting
    a ec key" errors.


M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/login-common/ssl-proxy-openssl.c

2015-12-07 11:29:29 +0200 Timo Sirainen <tss@iki.fi> (975c2cd)

    doveadm: Fixed reseting getopt() with glibc when processing multiple
    commands in a single process. This means commands run with doveadm batch or
    multiple commands in a single doveadm-server connection.

    glibc's getopt() man page says that optind=1 should reset it for scanning a 
    new argument vector, but this doesn't actually seem to work. Setting 
    optind=0 does work though, so use it everywhere.

M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-mail-batch.c
M	src/doveadm/doveadm.c
M	src/lib/lib.c
M	src/lib/lib.h

2015-12-07 11:21:59 +0200 Timo Sirainen <tss@iki.fi> (bc31472)

    doveadm-server: Reset getopt() before calling non-mail commands. This fixes
    parsing their parameters when using multiple such commands within a single
    doveadm connection.


M	src/doveadm/client-connection.c

2015-12-06 20:48:55 +0200 Timo Sirainen <tss@iki.fi> (dea8bfa)

    lib-storage: mail_search_args_simplify() handles now "(a OR b) AND (a OR c)"
    -> "a OR (b AND c)"


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-06 20:46:52 +0200 Timo Sirainen <tss@iki.fi> (071543c)

    lib-storage: mail_search_args_simplify() refactoring Removed parent_arg from
    mail_search_args_simplify_extract_common_and() in preperation for the next
    changeset.


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-06 19:27:45 +0200 Timo Sirainen <tss@iki.fi> (8d3af18)

    lib-storage: mail_search_args_simplify() handles now "a AND (a OR b)" -> "a"


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-06 19:26:44 +0200 Timo Sirainen <tss@iki.fi> (c89cead)

    lib-storage: Make sure mail_sesarch_args_simplify_sub() is called enough
    times.


M	src/lib-storage/mail-search-args-simplify.c

2015-12-06 19:25:20 +0200 Timo Sirainen <tss@iki.fi> (387f9e3)

    lib-storage: Minor test-mail-search-args-simplify unit test improvements


M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-06 18:14:08 +0200 Timo Sirainen <tss@iki.fi> (6320188)

    lib-storage: mail_search_args_simplify() handles now "(a AND b) OR (a AND
    c)" -> "a AND (b OR c)"


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-06 18:12:24 +0200 Timo Sirainen <tss@iki.fi> (27e859c)

    lib-storage: mail_search_args_simplify() handles now "a OR (a AND b)" -> "a"


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-12-06 18:09:17 +0200 Timo Sirainen <tss@iki.fi> (78f8407)

    lib-storage: Made mail_search_arg_[one_]equals() public.


M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h

2015-12-06 18:08:20 +0200 Timo Sirainen <tss@iki.fi> (914e08a)

    lib-storage: mail_search_args_equal() ignored some differences.  - fuzzy
    flag  - MAIL_SEARCH_ARG_FLAG_USE_TZ  - INTHREAD thread type


M	src/lib-storage/mail-search.c

2015-12-06 18:06:45 +0200 Timo Sirainen <tss@iki.fi> (86da76e)

    lib-storage: mail_search_arg*_dup() didn't preserve fuzzy-flag.


M	src/lib-storage/mail-search.c

2015-12-06 16:46:30 +0200 Timo Sirainen <tss@iki.fi> (5d34221)

    lib-storage: SEARCH BODY "" wasn't properly being translated to SEARCH_ALL.
    Instead if the next parameter was "" this happened (which could have been an
    accidental space in doveadm search-query).


M	src/lib-storage/mail-search-register-imap.c

2015-12-06 16:09:55 +0200 Timo Sirainen <tss@iki.fi> (8abe00d)

    lib-storage: dovecot.index.pvt* ignored several settings. mmap_disable=yes,
    dotlock_use_excl=yes and nfs_flush_index=yes weren't used.


M	src/lib-storage/mail-storage.c

2015-12-06 15:39:53 +0200 Timo Sirainen <tss@iki.fi> (bcecb67)

    quota-fs: File count limits with NetBSD shouldn't be multiplied by DEV_BSIZE


M	src/plugins/quota/quota-fs.c

2015-12-06 15:10:10 +0200 Timo Sirainen <tss@iki.fi> (8a0ef83)

    lib-charset: Added UTF-7 state checking unit test. This was an idea of a way
    to test for a bug in FreeBSD iconv(), but nobody reported if it did
    anything. So lets add it here and see.


M	src/lib-charset/test-charset.c

2015-12-06 14:57:22 +0200 Timo Sirainen <tss@iki.fi> (170834e)

    lmtp: quota_full_tempfail=yes didn't work with lmtp_rcpt_check_quota=yes


M	src/lmtp/commands.c

2015-12-06 14:27:46 +0200 Timo Sirainen <tss@iki.fi> (9844994)

    sdbox: Fixed assert-crash when message with external attachments was copied
    between storages.


M	src/lib-storage/index/dbox-single/sdbox-copy.c

2015-12-04 14:17:45 +0200 Timo Sirainen <tss@iki.fi> (23b586b)

    fts: Fixed FTS search query generation after earlier per-language tokenizer
    changes.


M	src/plugins/fts/fts-search-args.c

2015-12-04 13:46:00 +0200 Timo Sirainen <tss@iki.fi> (231629a)

    lib-http: Give a better error message if request times out. Instead of just
    giving the configured timeout, log how long the timeout actually took for
    the oldest request in wait list. Also if the request was retried, log how
    many times the request was sent and how long the request took in total.


M	src/lib-http/http-client-connection.c

2015-12-04 13:27:28 +0200 Timo Sirainen <tss@iki.fi> (7c38d25)

    doveadm fts lookup/expand: Don't assert-crash if fts isn't configured.


M	src/plugins/fts/doveadm-fts.c

2015-12-04 12:29:12 +0200 Timo Sirainen <tss@iki.fi> (a8319b1)

    lib: Removed t_str_trim() for now due to collision in Pigeonhole v0.4.9


M	src/lib/strfuncs.c
M	src/lib/strfuncs.h
M	src/lib/test-strfuncs.c

2015-12-04 12:15:49 +0200 Timo Sirainen <tss@iki.fi> (89fd04f)

    imap: Fixed assert-crash if client disconnected at a specific command state.
    If there was a command with state=CLIENT_COMMAND_STATE_WAIT_SYNC and output
    stream was already detected to be closed, we crashed with:

    Panic: file imap-client.c: line 841 (client_check_command_hangs): assertion 
    failed: (!have_wait_unfinished || unfinished_count > 0)

M	src/imap/imap-client.c

2015-12-04 11:38:00 +0200 Timo Sirainen <tss@iki.fi> (6e1a910)

    lib-index: mail_transaction_log_file_map() didn't properly check
    start_offset If it was too high, it still returned successful mapping. This
    could have caused an assert-crash later on when the start_offset was
    actually attempted to be used.


M	src/lib-index/mail-transaction-log-file.c

2015-12-04 10:52:52 +0200 Timo Sirainen <tss@iki.fi> (c892cc1)

    lib-ssl-iostream: Fixed compiler warning when OpenSSL didn't support ECDH.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2015-12-04 09:52:26 +0200 Timo Sirainen <tss@iki.fi> (c5b6420)

    fts: Error handling fix for previous per-language tokenizer change.


M	src/plugins/fts/fts-search-args.c

2015-12-03 15:31:48 +0200 Timo Sirainen <tss@iki.fi> (63964d0)

    Added signature for changeset c35e62a9e710


M	.hgsigs

2015-12-03 15:31:41 +0200 Timo Sirainen <tss@iki.fi> (b96c3a9)

    Added tag 2.2.20.rc1 for changeset c35e62a9e710


M	.hgtags

2015-12-03 15:31:39 +0200 Timo Sirainen <tss@iki.fi> (732f68a)

    Released v2.2.20.rc1.


M	NEWS
M	configure.ac

2015-12-03 14:24:06 +0200 Timo Sirainen <tss@iki.fi> (dbf26a3)

    fts: Added support for per-language tokenizer settings. fts_tokenizer_<lang>
    now overrides fts_tokenizers setting. fts_tokenizer_<name>_<lang> now
    overrides fts_tokenizer_<name> setting.


M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-search-args.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/fts-user.h

2015-12-03 12:22:24 +0200 Timo Sirainen <tss@iki.fi> (0ebd830)

    lib-ssl-iostream: Moved openssl_iostream_*error() to -common.c login-common
    code only links with this file, so that's required for the previous changes
    to actually work.


M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c

2015-12-03 12:19:12 +0200 Timo Sirainen <tss@iki.fi> (cc6dfdf)

    login, lib-ssl-iostream: Clear errors caused by manual EC key selection when
    there was no EC key. EVP_PKEY_get1_EC_KEY() would return an error, which
    should be ignored instead of being logged later on.


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/login-common/ssl-proxy-openssl.c

2015-12-03 12:13:11 +0200 Timo Sirainen <tss@iki.fi> (2e492d0)

    lib-ssl-iostream: Check for SSL_CTX_set_ecdh_auto() failure. This shouldn't
    happen though.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2015-12-03 12:02:56 +0200 Timo Sirainen <tss@iki.fi> (8b5d186)

    login, lib-ssl-iostream: Deduplicate code with shared
    openssl_iostream_use_certificate_error()


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/login-common/ssl-proxy-openssl.c

2015-12-03 11:58:11 +0200 Timo Sirainen <tss@iki.fi> (771df0f)

    login-common: Use openssl_iostream_*error() to avoid code duplication.


M	src/login-common/ssl-proxy-openssl.c

2015-12-03 11:55:33 +0200 Timo Sirainen <tss@iki.fi> (1deb13e)

    lib-ssl-iostream: Fixes to error handling. Copy behavior from
    login-common/ssl-proxy-openssl.c:  - Handle stacked errors.  - Improve
    errors with ERR_TXT_STRING flag.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2015-12-03 11:41:58 +0200 Timo Sirainen <tss@iki.fi> (f82dcfb)

    lib-ssl-iostream: Don't ignore errors on SSL certificate loading. Patch by
    Sebastiaan Hoogeveen.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2015-12-01 17:31:08 +0200 Timo Sirainen <tss@iki.fi> (5b79409)

    mail-log: If uid field is used, make sure newly saved mails actually get an
    UID. With Maildir the UID is otherwise assigned on mail deliveries only if
    dovecot-uidlist happens to get locked.


M	src/plugins/mail-log/mail-log-plugin.c

2015-12-01 16:45:37 +0200 Timo Sirainen <tss@iki.fi> (1b7cb00)

    lib-mail: test-rfc822-parser unit test fix We didn't check that all the
    output was necessarily verified. Also this makes static analyzer happier.


M	src/lib-mail/test-rfc822-parser.c

2015-11-30 21:39:56 +0200 Timo Sirainen <tss@iki.fi> (0f9c908)

    director: Minor code cleanup - removed unnecessary code.


M	src/director/mail-host.c

2015-11-30 21:39:34 +0200 Timo Sirainen <tss@iki.fi> (d9218b8)

    director: Include tag also in the hosts_hash.


M	src/director/mail-host.c

2015-11-30 21:39:07 +0200 Timo Sirainen <tss@iki.fi> (764178e)

    director: Fixed recent tag reimplementation to actually work. We still just
    created one large vhosts pool for all tags containing all the hosts.


M	src/director/mail-host.c

2015-11-30 21:36:51 +0200 Timo Sirainen <tss@iki.fi> (75aae86)

    director: Don't treat empty hostname the same as having it. This could have
    caused "host not given" errors if an empty "host=" was sent to login
    process, even though hostip was also sent.

    Fixed this in two places, although either one should have been enough.

M	src/director/login-connection.c
M	src/director/mail-host.c

2015-11-30 21:32:26 +0200 Timo Sirainen <tss@iki.fi> (a99dcac)

    director: Fixed "doveadm director status user@domain" not to hang due to
    missing LF.


M	src/director/doveadm-connection.c

2015-11-30 13:15:44 +0200 Timo Sirainen <tss@iki.fi> (e99bcf6)

    lib-imap: Added unit tests for imap_append_[an]string()


M	src/lib-imap/test-imap-quote.c

2015-11-30 13:14:29 +0200 Timo Sirainen <tss@iki.fi> (efb00f1)

    lib-mail: rfc822_parse_content_param() was unescaping already unescaped
    parameters This caused all Content-* parameter parsing to be unescaped once
    too many times, resulting in somewhat broken BODY and BODYSTRUCTURE replies
    if any <\> characters were used. Also MIME boundaries were parsed in case
    <\> was used in them, but this probably didn't practically happen.


M	src/lib-mail/Makefile.am
M	src/lib-mail/rfc822-parser.c
A	src/lib-mail/test-rfc822-parser.c

2015-11-30 12:22:22 +0200 Timo Sirainen <tss@iki.fi> (7dd67cf)

    doveadm fetch: Added date.sent/received/saved.unixtime


M	src/doveadm/doveadm-mail-fetch.c

2015-11-28 23:50:14 +0200 Stephan Bosch <stephan@rename-it.nl> (f43734e)

    lib: Created t_str_trim() functions to trim characters from beginning and
    end of string.


M	src/lib/strfuncs.c
M	src/lib/strfuncs.h
M	src/lib/test-strfuncs.c

2015-11-28 13:36:14 +0200 Timo Sirainen <tss@iki.fi> (9de0231)

    Makefile: Added missing mail-autoexpunge.h


M	src/lib-storage/Makefile.am

2015-11-27 15:50:44 +0200 Timo Sirainen <tss@iki.fi> (c2cda8c)

    lib: Added extra assert to i_stream_read()


M	src/lib/istream.c

2015-11-27 15:49:58 +0200 Timo Sirainen <tss@iki.fi> (c051fa1)

    fts-solr: Fixed sending empty parameters. Solr probably doesn't do anything
    useful with them, but we shouldn't get 400 Bad Request errors.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2015-11-27 15:26:31 +0200 Timo Sirainen <tss@iki.fi> (422af31)

    Compiler warning fix for 32bit systems


M	src/lib-storage/mail-autoexpunge.c

2015-11-27 15:24:41 +0200 Timo Sirainen <tss@iki.fi> (ebcb8cc)

    fts-solr: Fixed escaping query parameters. Solr documentation says that
    "quoted string" would already work without escaping, but that doesn't seem
    to be true (we were also missing the \" escaping there). So we'll now escape
    all the special characters without quotes around it, which seems to work.
    Also added '/' to list of special characters, which is used by Solr 4.0.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2015-11-27 14:57:03 +0200 Timo Sirainen <tss@iki.fi> (ac99fac)

    zlib: Fixed copying causing cache corruption when zlib_save wasn't set.
    dovecot.index.cache entries were broken/missing if: - The zlib plugin is
    enabled; - The zlib_save/zlib_save_level options are NOT enabled; - The
    source message being copied is compressed; - The mail_log plugin is logging
    "copy" events; - The mail_log_fields setting includes at least one message
    header; - The destination mailbox folder has an index file that is recording
    the logged headers; - The source mailbox folder does NOT have an index file
    recording the logged headers.

    Found by Robert L Mathews.

M	src/plugins/zlib/zlib-plugin.c

2015-11-27 14:42:43 +0200 Timo Sirainen <tss@iki.fi> (a071ae7)

    lib: Fixed compiling unit test in systems where NULL isn't of type void* For
    example Solaris.


M	src/lib/test-ioloop.c

2015-11-27 14:39:32 +0200 Timo Sirainen <tss@iki.fi> (ae23bef)

    auth: Fixed test-auth-request-var-expand unit test on big endian CPUs


M	src/auth/test-auth-request-var-expand.c

2015-11-27 14:24:23 +0200 Timo Sirainen <tss@iki.fi> (a9934b1)

    Compiler warning fix for 32bit systems


M	src/lib-storage/list/mailbox-list-index-status.c

2015-11-27 14:11:57 +0200 Timo Sirainen <tss@iki.fi> (4e3bcf7)

    lib-storage: Don't add first_saved to mailbox list index unless autoexpunge
    is set.


M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/mail-storage-private.h

2015-11-27 14:01:14 +0200 Timo Sirainen <tss@iki.fi> (1001bda)

    imap: Free mail_user only after client is disconnected.


M	src/imap/imap-client.c

2015-11-27 13:59:22 +0200 Timo Sirainen <tss@iki.fi> (1ae5d61)

    Added mailbox { autoexpunge } setting. This can be used to automatically
    expunge mails from specified mailboxes after they're old enough. The
    expunges are done when the user is being deinitialized.
    mailbox_list_index=yes should be enabled to have the best performance with
    this setting.

    Example:

    namespace inbox {
     mailbox Spam {
       auto = create
       special_use = \Junk
       autoexpunge = 30d
     }
    }

M	src/lib-storage/Makefile.am
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index.h
A	src/lib-storage/mail-autoexpunge.c
A	src/lib-storage/mail-autoexpunge.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail-user.c

2015-11-27 13:06:01 +0200 Timo Sirainen <tss@iki.fi> (fe77956)

    imap: SETMETADATA didn't set ostream output handler back This caused hangs
    afterwards when receiving long replies (e.g. FETCH).


M	src/imap/cmd-setmetadata.c

2015-11-26 15:42:35 +0200 Timo Sirainen <tss@iki.fi> (8705e45)

    quota-clone: Avoid assert-crash when quota recalculation is triggered. Quota
    recalculation opened all mailboxes and got us back to quota_clone_flush(),
    which caused another dict transaction to be opened, which caused a crash
    with some dict backends.


M	src/plugins/quota-clone/quota-clone-plugin.c

2015-11-25 15:09:52 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (7c1ce38)

    lib-fts: Move ICU transliterator creation to fts-icu.h This allows others to
    use transliterators without so much code duplication. The transliterator
    still has to be destroyed by the user, with utrans_close().


M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-icu.c
M	src/lib-fts/fts-icu.h

2015-11-25 15:09:52 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (e467b29)

    lib-fts: Fix compilation for systems without libicu. The earlier patch,
    194e3622d5e6, did not consider both library dependencies.


M	src/lib-fts/test-fts-filter.c

2015-11-24 13:42:58 +0200 Timo Sirainen <tss@iki.fi> (850b419)

    imap: When logging command disconnection info, log the oldest command's info
    (not newest)


M	src/imap/imap-client.c

2015-11-24 13:41:58 +0200 Timo Sirainen <tss@iki.fi> (117bc06)

    imap: Added extra assert checks to make sure command states are consistent.


M	src/imap/imap-client.c
M	src/imap/imap-client.h

2015-11-24 13:40:12 +0200 Timo Sirainen <tss@iki.fi> (76c6c11)

    imap: IDLE may have called client_continue_pending_input() unnecessarily.


M	src/imap/cmd-idle.c

2015-11-24 12:56:35 +0200 Timo Sirainen <tss@iki.fi> (952148e)

    imap: Fixed crash at FETCH deinit caused by b638e19d3bd4 imap_fetch_free()
    would have been called twice, which caused problems.


M	src/imap/cmd-fetch.c

2015-11-24 11:50:15 +0200 Timo Sirainen <tss@iki.fi> (6116f4c)

    imap: Fixed hanging if a pipelined IMAP command was waiting for previous
    command to sync. ..And the previous command was waiting for the next command
    to finish before it would start syncing. For example FETCH+LOGOUT pipelined.


M	src/imap/imap-client.c

2015-11-24 11:15:47 +0200 Timo Sirainen <tss@iki.fi> (ae32667)

    director: Fixed backend selection when multiple tags were used. The previous
    algorithm was causing an uneven load for backends.

    This change breaks compatibility with older director servers that were using 
    tags because of the different selection algorithm. The new director code 
    refuses to run within a cluster with old directors if tags are used.

M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h
M	src/director/mail-host.c
M	src/director/mail-host.h

2015-11-23 19:47:08 +0200 Timo Sirainen <tss@iki.fi> (092f738)

    director: Code cleanup - renamed hosts_unsorted to vhosts_unsorted


M	src/director/mail-host.c

2015-11-23 19:44:50 +0200 Timo Sirainen <tss@iki.fi> (e3751d4)

    director: Code cleanup - rename tag to tag_name in mail_host_*() parameters.
    In preparation for the following changes.


M	src/director/mail-host.c
M	src/director/mail-host.h

2015-11-23 19:41:38 +0200 Timo Sirainen <tss@iki.fi> (093b42b)

    director: Code cleanup - access host->tag via mail_host_get_tag() In
    preparation for the following changes.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/mail-host.c
M	src/director/mail-host.h

2015-11-23 19:38:31 +0200 Timo Sirainen <tss@iki.fi> (87842f6)

    director: Code cleanup - make most mail_host_*() list parameters
    unnecessary.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/mail-host.c
M	src/director/mail-host.h

2015-11-23 19:35:03 +0200 Timo Sirainen <tss@iki.fi> (570153a)

    director: With director_consistent_hashing=yes hosts_hash wasn't always
    calculated right. If different servers had added hosts in different order,
    the hosts_hash would have become different, which caused errors and resyncs.


M	src/director/mail-host.c

2015-11-18 16:33:26 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (d965f1c)

    lib-fts: Fix compilation for systems without libstemmer.


M	src/lib-fts/test-fts-filter.c

2015-11-18 16:33:26 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (5455a91)

    fts: Remove default filters and tokenizers. There aren't any specially good
    defaults that work for all the languages, so it's better to just enforce
    explicit settings.


M	src/plugins/fts/fts-user.c

2015-11-19 17:43:47 +0200 Timo Sirainen <tss@iki.fi> (0b02856)

    fs-posix: Added mode=auto parameter to copy mode from parent directory if
    setgid-bit is set


M	src/lib-fs/fs-posix.c

2015-11-19 17:19:19 +0200 Timo Sirainen <tss@iki.fi> (3718da9)

    fs-posix: Code cleanup - don't store dir_mode permanently. Cleanup in
    preparation for mode=auto.


M	src/lib-fs/fs-posix.c

2015-11-19 17:39:46 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (83bd5fa)

    lib-fts: Silence clang warnings.


M	src/lib-fts/test-fts-filter.c
M	src/lib-fts/test-fts-language.c

2015-11-19 14:47:27 +0200 Timo Sirainen <tss@iki.fi> (31493ba)

    fts plugin: Install fts-storage.h


M	src/plugins/fts/Makefile.am

2015-11-19 14:46:54 +0200 Timo Sirainen <tss@iki.fi> (3d2d350)

    lib-fs: Added fs_stats_get_read/write_usecs() These can be easily used to
    sum up all the timings for read and write categories.


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2015-11-18 21:06:17 +0200 Timo Sirainen <tss@iki.fi> (3e3cc37)

    indexer-worker: Use provided session-id only as a prefix for a unique
    session ID. Fixes stats process's "Duplicate session ID" errors when LMTP
    delivers to multiple recipients.


M	src/indexer/master-connection.c

2015-11-18 21:03:41 +0200 Timo Sirainen <tss@iki.fi> (1959acc)

    lib-storage: Added mail_storage_service_input.session_id_prefix This should
    make it easier to pass through the original session_id to worker process
    sessions. Especially if these sessions are somewhat short-lived it can be
    useful to assign them a unique session ID while still being able to match it
    to the parent's session ID.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2015-11-18 20:50:55 +0200 Timo Sirainen <tss@iki.fi> (a5b6819)

    stats: Improved logging on invalid CONNECT input.


M	src/stats/mail-session.c

2015-11-18 19:15:36 +0200 Timo Sirainen <tss@iki.fi> (7059b9f)

    stats: Forced sending of UPDATE-SESSION every 5 minutes wasn't working. This
    caused stats process to forget about idling (imap) sessions if they didn't
    do anything for over 15 minutes.


M	src/plugins/stats/stats-plugin.c

2015-11-18 18:54:51 +0200 Timo Sirainen <tss@iki.fi> (abb242d)

    stats: When logging UPDATE-SESSION stats, log also the session ID.


M	src/stats/mail-session.c

2015-11-18 18:10:46 +0200 Timo Sirainen <tss@iki.fi> (c85e266)

    lib-storage: Create ioloop context for users even if log prefix changing is
    disabled. This fixes stats plugin to work with lmtp, imap-urlauth and
    doveadm-server.


M	src/lib-storage/mail-storage-service.c

2015-11-18 17:45:35 +0200 Timo Sirainen <tss@iki.fi> (03baa1c)

    lib-master: master_service_is_master_stopped() now returns FALSE if running
    standalone. The only caller of this function was stats plugin to see if it
    should send stats updates. So this fixes dovecot-lda, doveadm and other
    standalone tools to send stats updates.


M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2015-11-18 14:15:32 +0200 Timo Sirainen <tss@iki.fi> (ce4d4d7)

    lib-master: Fixed timeout leak at deinit when we couldn't connect to
    ipc-server


M	src/lib-master/ipc-server.c

2015-11-18 13:12:23 +0200 Timo Sirainen <tss@iki.fi> (ac5a1d0)

    pop3: When creating session lock file, prefer to write it to the index root
    dir. This is especially important for mail storage backends that don't have
    a mail root directory.


M	src/pop3/pop3-client.c

2015-11-18 13:08:57 +0200 Timo Sirainen <tss@iki.fi> (def5984)

    pop3: Send "OK Logged in" before reading mailbox. This way if the reading
    takes a long time, the client still sees that the login itself was
    successful. This is especially useful to avoid unnecessary errors logged by
    proxies.


M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h

2015-11-18 12:40:42 +0200 Timo Sirainen <tss@iki.fi> (2492912)

    imap: Disconnection log message incorrectly logged "input/output" even if
    only "input" was set.


M	src/imap/imap-client.c

2015-11-18 12:39:13 +0200 Timo Sirainen <tss@iki.fi> (848bc01)

    imap: When disconnected during FETCH, include the last byte counts in
    disconnection log message.


M	src/imap/cmd-fetch.c
M	src/imap/imap-client.c

2015-11-17 19:02:13 +0200 Timo Sirainen <tss@iki.fi> (fdd858a)

    lib-fs: Improved fs-metawrap's fs_stat() error message.


M	src/lib-fs/fs-metawrap.c

2015-11-17 19:01:29 +0200 Timo Sirainen <tss@iki.fi> (dbe1f7e)

    lib-fs: Fixed fs_stat() for fs-metawrap


M	src/lib-fs/istream-metawrap.c

2015-11-17 17:26:56 +0200 Timo Sirainen <tss@iki.fi> (8ce3071)

    *-login: Added postlogin_socket=path passdb extra field. By default e.g.
    "imap" or "pop3" is the post-login socket, but this can override it. This
    could be used for example for per-user debugging (e.g. setting executable to
    be run via strace or valgrind).


M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2015-11-17 17:23:31 +0200 Timo Sirainen <tss@iki.fi> (9498baa)

    lib-master: master_auth_request_full() now supports per-request path.


M	src/lib-master/master-auth.c
M	src/lib-master/master-auth.h

2015-11-17 17:11:05 +0200 Timo Sirainen <tss@iki.fi> (2d8e25b)

    lib-master: Added extensible master_auth_request_full() call. Only the API
    was changed, no changes to functionality.


M	src/lib-master/master-auth.c
M	src/lib-master/master-auth.h
M	src/login-common/sasl-server.c

2015-11-17 16:30:16 +0200 Timo Sirainen <tss@iki.fi> (3b4b517)

    lib-fs: Added asserts to fs_set_metadata() to make sure key and value are
    non-NULL Otherwise the bug would be noticed only much later when trying to
    dereference NULL pointer.


M	src/lib-fs/fs-api.c

2015-11-17 11:51:45 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (6dd785e)

    fts: Added fts_library_init() and _deinit() Replaces calling three different
    functions on init and deinit.


M	src/lib-fts/Makefile.am
A	src/lib-fts/fts-library.c
A	src/lib-fts/fts-library.h
M	src/plugins/fts/fts-plugin.c

2015-11-17 11:50:16 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (4b26f71)

    lib-fts: Added fts_language_register() to register more languages in
    plugins.


M	src/lib-fts/fts-language.c
M	src/lib-fts/fts-language.h
M	src/lib-fts/test-fts-language.c

2015-11-17 11:46:49 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (3e9ed17)

    dovecot-config: Added LIBFTS.


M	configure.ac
M	dovecot-config.in.in
M	dovecot.m4

2015-11-17 11:45:44 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (963e173)

    lib-fts: Explicitly state encoding used for stemming.


M	src/lib-fts/fts-filter-stemmer-snowball.c

2015-11-17 11:45:24 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (c6b75b7)

    lib-fts: Removed TODO comment. The call to uni_utf8_get_char_n() already
    does easy cases first. Adding more special code paths is not necessary.


M	src/lib-fts/fts-tokenizer-generic.c

2015-11-17 11:44:53 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (9c34a19)

    lib-fts: Minor code cleanup - Rename some internal functions. Maybe the
    names are more logical this way.


M	src/lib-fts/fts-tokenizer-generic.c

2015-11-17 11:44:19 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (3ec8b0d)

    lib-fts: Add Norwegian. Norwegian has two main dialects, Bokmal(nb) and
    Nynorsk(nn). They are detected separately by libexttextcat, but the stemmer
    only knows Norwegian. Thus they are treated as a single language, Norwegian
    (no). This might also make more sense in everyday use of mixed writing style
    Norwegian.

    Caveat: The default normalizer filter does not modify U+00F8
    (Latin Small Letter O with Stroke). In some configurations it might be
    desirable to rewrite it to e.g. o. Same goes for the upper case version.
    This can be done by passing a modified "id" setting to the normalizer
    filter.

M	src/lib-fts/Makefile.am
M	src/lib-fts/fts-language.c
A	src/lib-fts/stopwords_no.txt
M	src/lib-fts/test-fts-filter.c
M	src/lib-fts/test-fts-language.c

2015-11-17 11:43:58 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (48afa42)

    lib-fts: Add comment to language names. Languages are defined by their ISO
    639-1 code, which is a two letters. It is possible, that some languages with
    only a three letter code, ie. a ISO 639-2 code, could be added in the
    future.


M	src/lib-fts/fts-language.c

2015-11-17 11:43:28 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (c5effa0)

    lib-fts: Add Swedish (sv) to supported languages.


M	src/lib-fts/Makefile.am
M	src/lib-fts/fts-language.c
A	src/lib-fts/stopwords_sv.txt
M	src/lib-fts/test-fts-filter.c
M	src/lib-fts/test-fts-language.c

2015-11-17 11:42:59 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (fd15d61)

    lib-fts: Add l' contraction to French unit test.


M	src/lib-fts/test-fts-filter.c

2015-11-16 14:47:18 +0200 Timo Sirainen <tss@iki.fi> (687fd73)

    pop3-migration: Fixed memory leak in unit test.


M	src/plugins/pop3-migration/test-pop3-migration-plugin.c

2015-11-16 14:46:40 +0200 Timo Sirainen <tss@iki.fi> (0989e8b)

    lib-mail: Fixed istream-header-filter when callback excluded multiple
    headers. This only affected pop3-migration plugin.


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2015-11-16 14:16:00 +0200 Timo Sirainen <tss@iki.fi> (87c3028)

    dovecot.m4: Run valgrind with --trace-children=yes Some of the unit tests
    are run via shell and we want to check the unit tests instead of just the
    shell.


M	dovecot.m4

2015-11-16 14:15:02 +0200 Timo Sirainen <tss@iki.fi> (40569d0)

    Added Valgrind suppressions file for ignoring any bash memory leaks. Some of
    the unit tests are run via shell.


A	run-test-valgrind.supp

2015-11-16 12:40:22 +0200 Timo Sirainen <tss@iki.fi> (431eeba)

    dovecot.m4: Added --leak-check=full to valgrind


M	dovecot.m4

2015-11-16 12:29:51 +0200 Phil Carmody <phil@dovecot.fi> (19ed8f0)

    various - remove 8-bit characters from literal strings in test cases C has a
    portable way of expressing characters not in the basic character set, namely
    \xNN escaping. Otherwise, the interpretation of the raw utf-8 is
    implentation dependent. This has the benefit of making some tests' expected
    output more obvious, such as "=c3=a4" matching "\xC3\xA4", even if it
    hinders the readability of some natural-language-based tests.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-charset/test-charset.c
M	src/lib-fts/test-fts-filter.c
M	src/lib-fts/test-fts-tokenizer.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c

2015-11-16 12:29:21 +0200 Phil Carmody <phil@dovecot.fi> (087272d)

    lib: fix memory leak of iterator in str_table_deinit() The deinit function
    uses an iterator, but never cleared it up. Found by Valgrind.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/str-table.c

2015-11-16 12:29:09 +0200 Phil Carmody <phil@dovecot.fi> (fddfa13)

    lib: make test-istream-failure-at not leak memory This permits Valgrind to
    run without complaint.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-istream-failure-at.c

2015-11-16 12:27:03 +0200 Phil Carmody <phil@dovecot.fi> (2bee4c3)

    lib: fix memory leaks in failure-at streams The parent wasn't getting
    unref'ed, and would hang around for ever.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/istream-failure-at.c
M	src/lib/ostream-failure-at.c

2015-11-16 12:26:50 +0200 Phil Carmody <phil@dovecot.fi> (ded6d68)

    lib-master: stop tests from leaking memory This permits Valgrind to run
    without complaint.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-master/test-master-service-settings-cache.c

2015-11-16 12:26:32 +0200 Phil Carmody <phil@dovecot.fi> (5968fa8)

    lib-http: free resources used in the tests Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-request-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-transfer.c

2015-11-16 12:26:06 +0200 Phil Carmody <phil@dovecot.fi> (2696272)

    lib-http: ref/unref input stream in http message parser To prevent
    assidental disappearance of the stream while it's in use. Also, the caller
    can create and forget - we'll do the cleanup later.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-http/http-message-parser.c

2015-11-16 12:24:53 +0200 Timo Sirainen <tss@iki.fi> (0de8aaf)

    imapc: Treat literal8 input the same as regular literal. This is mainly for
    migrating away from broken servers (a patched Cyrus) that send literal8 if a
    (corrupted) message contains NULs.


M	src/lib-imap-client/imapc-connection.c

2015-11-12 18:27:54 +0200 Timo Sirainen <tss@iki.fi> (02889f5)

    imap: When client disconnects during a running command, log the command wait
    state.


M	src/imap/imap-client.c

2015-11-12 12:28:58 +0200 Timo Sirainen <tss@iki.fi> (53c1549)

    imap: If IDLE or FETCH notices a disconnection, log the running command
    statistics.


M	src/imap/cmd-fetch.c
M	src/imap/cmd-idle.c
M	src/imap/imap-client.c

2015-11-12 12:17:04 +0200 Timo Sirainen <tss@iki.fi> (56eaa07)

    imap: When client disconnects during a running command, log the IO
    input/output wait status. This is mainly useful for debugging to make sure
    that the hang isn't happening because of a bug (missing io) in Dovecot.


M	src/imap/imap-client.c

2015-11-12 12:14:20 +0200 Timo Sirainen <tss@iki.fi> (7f52e27)

    lib: Added io_loop_find_fd_conditions()


M	src/lib/ioloop.c
M	src/lib/ioloop.h
M	src/lib/test-ioloop.c

2015-11-12 11:29:29 +0200 Timo Sirainen <tss@iki.fi> (bb1c6e2)

    quota: When recalculating quota, don't try to access nonexistent
    autocreate-mailboxes. There's no need to physically create them, since
    they're empty anyway.


M	src/plugins/quota/quota-count.c

2015-11-11 17:40:23 +0200 Timo Sirainen <tss@iki.fi> (56dcb49)

    login proxy: If writing to ostream fails, log the ostream's error string.
    Although for now it's always just based on the errno anyway.


M	src/login-common/login-proxy.c

2015-11-11 17:35:10 +0200 Timo Sirainen <tss@iki.fi> (9940125)

    login proxy: Include some extra information in disconnect log lines.


M	src/login-common/login-proxy.c

2015-11-11 13:15:30 +0200 Timo Sirainen <tss@iki.fi> (fb3178a)

    auth: Added hardcoded 5 second timeout to LDAP connect() Although it doesn't
    look like the timeout is exactly 5 seconds always due to OpenSSL's internal
    workings, but this should be good enough.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2015-11-10 10:00:11 +0200 Timo Sirainen <tss@iki.fi> (2f57edb)

    push-notification: Removed unused code.


M	src/plugins/push-notification/push-notification-events.h

2015-11-09 14:49:26 +0200 Timo Sirainen <tss@iki.fi> (8f90ef6)

    virtual: Include mailbox name in "Backend mailbox added by another session."
    error.


M	src/plugins/virtual/virtual-sync.c

2015-11-09 14:11:12 +0200 Timo Sirainen <tss@iki.fi> (54a1b35)

    auth: Don't crash when trying to use CRYPT scheme when crypt() doesn't
    support DES


M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c

2015-11-09 13:16:50 +0200 Timo Sirainen <tss@iki.fi> (265cb53)

    lib-storage: Support %{userdb:*} variables in mail_home and mail_chroot
    settings.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c

2015-11-09 13:02:56 +0200 Timo Sirainen <tss@iki.fi> (1d562be)

    lib: Removed unnecessary includes from bits.h All of them are already in
    lib.h, and bits.h gets included from lib.h. This also solves a compiling
    problem for systems where stdint.h doesn't exist.


M	src/lib/bits.h

2015-11-09 09:31:48 +0200 Timo Sirainen <tss@iki.fi> (4544c7c)

    replicator: Send initial status notification to master before listing all
    users To avoid master process from killing us after 30 seconds if the user
    listing takes longer than that.


M	src/replication/replicator/replicator.c

2015-11-05 11:41:52 +0200 Timo Sirainen <tss@iki.fi> (c30bcc8)

    auth: Fixed crash when using %{passdb:} or %{userdb:} functions when
    escape_func was NULL Patch by Michael Slusarz.


M	src/auth/auth-request-var-expand.c

2015-11-04 11:39:58 +0200 Phil Carmody <phil@dovecot.fi> (8dd4464)

    lib: test-istream-crlf - fix expected output strings, add more coverage Fix
    an out-by-one which was missing trailing carriage returns in _lf mode.

    Debug: input = [19]:``...........N.N....R'' Debug: output=
    [19]:``...........N.N....R'' Debug: data  = [18]:``...........N.N....'' 
    test-istream-crlf.c:78: Assert(#20) failed: size == str_len(output)

    Add some randomised tests to get better coverage of all possibilities.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-istream-crlf.c

2015-10-27 21:54:26 -0600 Michael M Slusarz <michael.slusarz@dovecot.fi> (1265ab7)

    push-notification: Fix linking against notify plugin


M	src/plugins/push-notification/Makefile.am

2015-10-29 15:29:24 +0200 Timo Sirainen <tss@iki.fi> (1c1e591)

    imap: Fixed crash in NOTIFY when there were watched namespaces that didn't
    support NOTIFY.


M	src/imap/imap-notify.c

2015-10-29 15:06:16 +0200 Timo Sirainen <tss@iki.fi> (5b945a4)

    dsync: Fixed handling of deleted directories. We may still know about the
    directory node even if it doesn't exist, and we still want to delete it.


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2015-10-29 14:09:52 +0200 Timo Sirainen <tss@iki.fi> (d3b2c07)

    auth: Avoid a crash by not trying to save empty delayed credentials.


M	src/auth/auth-request.c

2015-10-29 12:55:20 +0200 Timo Sirainen <tss@iki.fi> (e293d46)

    acl: acl_object_list_*() now duplicates rights at init to avoid them
    changing during listing. Depending on the calling code the acl_object could
    have been refreshed during the listing and caused bugs/crashes.

    This fixes a crash at least in mailbox deletion during attribute deletion 
    where iter->idx was higher (2) than the number of rights at the time (0).

M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c

2015-10-28 12:28:12 +0200 Timo Sirainen <tss@iki.fi> (3cad7d3)

    auth: Typofix for error message.


M	src/auth/auth-master-connection.c

2015-10-28 12:25:08 +0200 Timo Sirainen <tss@iki.fi> (0401fa6)

    auth: nopassword field is specific to a single passdb, remove before next
    passdb is processed


M	src/auth/auth-request.c

2015-10-27 23:56:48 +0200 Timo Sirainen <tss@iki.fi> (00a50d6)

    lib-mail, fts: Put application/xhtml+xml MIME parts through html parser as
    well.


M	src/lib-mail/mail-html2text.h
M	src/lib-mail/message-snippet.c
M	src/lib-mail/test-message-snippet.c
M	src/plugins/fts/fts-parser-html.c

2015-10-26 17:20:49 +0200 Timo Sirainen <tss@iki.fi> (8c6884a)

    acl: If mailbox is autocreated, assume it already exists and don't require
    "create" ACL


M	src/plugins/acl/acl-mailbox.c

2015-10-26 16:28:51 +0200 Timo Sirainen <tss@iki.fi> (fca5548)

    acl: Fixed handling mailbox deletion when only "delete" right was available.
    So especially when there were no "lookup" or "read" rights.


M	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-mailbox.c

2015-10-23 15:21:15 +0300 Timo Sirainen <tss@iki.fi> (75b4cc3)

    auth: Fixed userdb changing username via auth-worker


M	src/auth/auth-worker-client.c
M	src/auth/userdb-blocking.c

2015-10-22 16:59:01 +0300 Timo Sirainen <tss@iki.fi> (2f56443)

    notify plugin: Don't access already freed memory. In the same changeset I
    even added a comment just above that it shouldn't be accessed..


M	src/plugins/notify/notify-storage.c

2015-10-22 13:55:27 +0300 Timo Sirainen <tss@iki.fi> (6b0e35b)

    quota-dict: Added "no-unset" parameter.


M	src/plugins/quota/quota-dict.c

2015-10-21 19:12:45 +0300 Timo Sirainen <tss@iki.fi> (4532784)

    LAYOUT=index: Fixed error handling in mailbox creation race condition. If
    two processes create the same mailbox, the other one ends up being deleted
    on failure. However, if the deletion itself also failed the state becomes a
    big ambiguous. We don't want to return MAIL_ERROR_EXISTS in that case,
    because the caller may try to open the mailbox with the inconsistent state
    and fail. So we'll instead return the original mailbox_delete() error to the
    caller.


M	src/lib-storage/list/mailbox-list-index-backend.c

2015-10-21 15:50:31 +0300 Timo Sirainen <tss@iki.fi> (e03c02d)

    login proxy: Separate admin kicks, director kicks and shutdowns in log
    messages.


M	src/login-common/login-proxy.c

2015-10-21 13:32:58 +0300 Timo Sirainen <tss@iki.fi> (ea6bcfd)

    ssl_options: Added support for no_ticket


M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl-settings.h
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-ssl.h
M	src/login-common/ssl-proxy-openssl.c

2015-10-20 21:23:03 +0300 Timo Sirainen <tss@iki.fi> (3d80595)

    doveadm fs: Log also the exact reason for "file doesn't exist"


M	src/doveadm/doveadm-fs.c

2015-10-20 20:15:20 +0300 Timo Sirainen <tss@iki.fi> (6477a2e)

    dict: Show number of clients in process title


M	src/dict/main.c

2015-10-20 18:43:32 +0300 Timo Sirainen <tss@iki.fi> (a7d68c0)

    lib-index: tail_offset wasn't updated as often as it should have been.
    ctx->last_tail_offset was being increased for every non-external transaction
    and at the end we checked if head was larger than it. This logic didn't
    really make any sense, since non-external transactions specifically were
    supposed to update the tail_offset.


M	src/lib-index/mail-index-sync.c

2015-10-20 18:22:53 +0300 Timo Sirainen <tss@iki.fi> (8da3322)

    lib-imap-storage: Mark METADATA transactions as external. We never write the
    metadata values to any storage backend, so they also don't need to be
    explicitly synced.


M	src/lib-imap-storage/imap-metadata.c

2015-10-20 17:07:20 +0300 Timo Sirainen <tss@iki.fi> (2d33429)

    mysql: Added connect/read/write_timeout settings. Default to 30s
    read/write_timeout.


M	src/lib-sql/driver-mysql.c

2015-10-20 16:57:34 +0300 Timo Sirainen <tss@iki.fi> (e180615)

    mysql: Fixed client_flags parameter


M	src/lib-sql/driver-mysql.c

2015-10-20 16:56:23 +0300 Timo Sirainen <tss@iki.fi> (9250f1b)

    mysql: Use the correct way of setting a connect timeout. I'm not sure if
    this didn't exist earlier, or if I just somehow missed it.


M	src/lib-sql/driver-mysql.c

2015-10-20 15:29:07 +0300 Timo Sirainen <tss@iki.fi> (14b1d2a)

    dsync: Added DSYNC_BRAIN_FLAG_NO_NOTIFY to enable
    MAILBOX_TRANSACTION_FLAG_NO_NOTIFY It's arguable that this should be enabled
    by default, but people might like to keep mail_log notifications for dsync.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2015-10-20 15:27:42 +0300 Timo Sirainen <tss@iki.fi> (8ccb1a0)

    lib-storage/notify: Added MAILBOX_TRANSACTION_FLAG_NO_NOTIFY This flag could
    potentially apply for other things as well, not just notify plugin. In
    general anything that could do external notifications shouldn't do anything
    for transactions with this flag.


M	src/lib-storage/mail-storage.h
M	src/plugins/notify/notify-storage.c

2015-10-20 13:12:24 +0300 Timo Sirainen <tss@iki.fi> (4ca910c)

    dict-sql: Fixed async iteration with MySQL and SQLite


M	src/lib-dict/dict-sql.c

2015-10-20 00:25:14 +0300 Timo Sirainen <tss@iki.fi> (5f7fcc5)

    lib-charset: Added UTF-7 iconv() unit test Possibly crashes on FreeBSD? Not
    verified yet. But a good test in any case.


M	src/lib-charset/test-charset.c

2015-10-20 00:23:56 +0300 Timo Sirainen <tss@iki.fi> (e9257b0)

    lib-charset: Run iconv unit tests by giving iconv() new data 1 byte at a
    time.


M	src/lib-charset/test-charset.c

2015-10-19 14:29:10 +0300 Timo Sirainen <tss@iki.fi> (d464e2e)

    imapc: Set storage's error to "internal error" if we detect mailbox state
    corruption. This fixes "unknown internal error" in at least syncing code
    when an expunged message reappears.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2015-10-19 14:05:26 +0300 Timo Sirainen <tss@iki.fi> (a03a29b)

    lib: net_gethostbyname() now supports [ipv6] style bracketed addresses.


M	src/lib/net.c

2015-10-19 14:04:46 +0300 Timo Sirainen <tss@iki.fi> (a05375f)

    director: Fix to previous change - mail_host_dup() wasn't strdup()ing
    hostname. This could have caused a crash at deinit.


M	src/director/mail-host.c

2015-10-19 13:49:54 +0300 Timo Sirainen <tss@iki.fi> (9de5eb9)

    director: Remember backends' hostnames and send them in login reply. This
    allows login processes to verify the remote server's hostname in SSL
    certificate.


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director-request.h
M	src/director/director.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/mail-host.h

2015-10-19 13:40:52 +0300 Timo Sirainen <tss@iki.fi> (c5279d5)

    director: Small code cleanup - make it easier to add parameters to HOST


M	src/director/director-connection.c

2015-10-19 13:37:25 +0300 Timo Sirainen <tss@iki.fi> (616c360)

    man: Changed "pattern" to "string" in doveamd-search-query(7)


M	doc/man/doveadm-search-query.7

2015-10-15 14:44:03 +0300 Phil Carmody <phil@dovecot.fi> (47dba7d)

    lib-mail: fix html2text parser Silly typo. Fixes bug reported on dovecot
    list by Akash on Oct 14.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-mail/mail-html2text.c

2015-10-14 17:34:23 +0300 Timo Sirainen <tss@iki.fi> (dad7254)

    dsync: If rename algorithm seems go to an infinite loop, log an error and
    stop. Ideally we would of course fix the algorithm (especially to not
    require this kind of looping).


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2015-10-14 17:28:11 +0300 Timo Sirainen <tss@iki.fi> (63a5701)

    imap/pop3-login: If LOGIN/USER is used with plaintext auth disabled,
    remember the username for logging. It's still useful to see the username
    that was sent in the logout message. This won't work for AUTHENTICATE PLAIN,
    but hopefully the clients that use it understand the LOGINDISABLED
    capability better.


M	src/imap-login/client-authenticate.c
M	src/pop3-login/client-authenticate.c

2015-10-14 14:06:35 +0300 Timo Sirainen <tss@iki.fi> (1128c11)

    cassandra: Added read/write/delete_fallback_consistency settings. The
    fallback is attempted if the primary consistency can't be satisfied. One
    useful use case for this is to have:

    write_consistency=each-quorum write_fallback_consistency=local-quorum

    Which means that during regular operation all writes go to all data centers 
    before they are finished, but if one of the data centers go down we'll 
    switch to just waiting for local data center writes to finish.

M	src/lib-sql/driver-cassandra.c

2015-10-14 13:32:02 +0300 Timo Sirainen <tss@iki.fi> (ce79dd4)

    dict-sql: dict_lookup_async() didn't call callback on query build failures.


M	src/lib-dict/dict-sql.c

2015-10-13 21:57:29 +0300 Timo Sirainen <tss@iki.fi> (4cce361)

    lib-storage: Support latest cache fields in struct
    mailbox_metadata.precache_fields


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-status.c

2015-10-13 21:40:33 +0300 Timo Sirainen <tss@iki.fi> (c24ef1e)

    imap: APPEND crashed if invalid keyword was given as parameter.


M	src/imap/cmd-append.c

2015-10-13 21:21:48 +0300 Timo Sirainen <tss@iki.fi> (9e56d74)

    auth ldap: If tls_* settings are used, pass them to LDAP library even if
    tls=no Most importantly this allows using the settings for ldaps URLs. And
    they hopefully won't hurt anything if neither STARTTLS nor ldaps are used.


M	src/auth/db-ldap.c

2015-10-13 20:41:36 +0300 Timo Sirainen <tss@iki.fi> (72fc989)

    lib: uri_parser_init() wasn't using pool parameter for anything. Now
    everything is allocated from it instead of from data stack.


M	src/lib/uri-util.c

2015-10-13 20:40:38 +0300 Timo Sirainen <tss@iki.fi> (b0c9213)

    dict-sql: Added support for value_type field, which deprecates
    value_hexblob. value_type=string|hexblob|uint are supported now.


M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql-settings.h
M	src/lib-dict/dict-sql.c

2015-10-13 20:39:50 +0300 Timo Sirainen <tss@iki.fi> (b096ecf)

    cassandra: Added support for returning "int" type values. It looks like we
    need to explicitly convert all types to strings.


M	src/lib-sql/driver-cassandra.c

2015-10-13 13:44:48 +0300 Timo Sirainen <tss@iki.fi> (fb1927d)

    auth: passwd-file now stat()s the file max once per second. It's quite
    unnecessary to do it more often.


M	src/auth/db-passwd-file.c
M	src/auth/db-passwd-file.h

2015-10-12 17:12:17 +0300 Timo Sirainen <tss@iki.fi> (1126bfe)

    fs-dict: Implemented hex-encoding for values.


M	src/lib-fs/fs-dict.c

2015-10-12 15:57:42 +0300 Timo Sirainen <tss@iki.fi> (9054b5f)

    director: Log a warning if directors' clocks are too much out of sync.


M	src/director/director-connection.c

2015-10-12 15:47:46 +0300 Timo Sirainen <tss@iki.fi> (abe2910)

    director: Detect if directors' hosts have become desynced by sending
    hosts_hash in SYNC parameter. Also fix up such a situation by resending all
    HOSTs.


M	src/director/director-connection.c
M	src/director/director-host.h
M	src/director/director.c
M	src/director/director.h

2015-10-12 15:41:55 +0300 Timo Sirainen <tss@iki.fi> (1574df6)

    director: Use mail_hosts_hash() to improve debug log messages.


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c

2015-10-12 15:41:25 +0300 Timo Sirainen <tss@iki.fi> (131cb59)

    director: Added mail_hosts_hash(), which identifies the current mail_hosts
    configuration.


M	src/director/mail-host.c
M	src/director/mail-host.h

2015-10-12 15:39:36 +0300 Timo Sirainen <tss@iki.fi> (4178857)

    director: Added another debug log message.


M	src/director/director-request.c

2015-10-11 18:45:58 +0300 Timo Sirainen <tss@iki.fi> (dd81d88)

    director: Small code cleanup - make it easier to add parameters to SYNC


M	src/director/director-connection.c

2015-10-10 18:32:56 +0300 Timo Sirainen <tss@iki.fi> (28789c7)

    director: Don't allow doveadm to update backend's state if the state is
    already being changed.


M	src/director/doveadm-connection.c

2015-10-10 18:32:06 +0300 Timo Sirainen <tss@iki.fi> (8752573)

    director: Don't become desynced if two directors change the same backend in
    incompatible ways. This would have caused "User hash .. is being redirected
    to two hosts" errors, which wouldn't easily go away as the directors have a
    different view of what hosts currently exist.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/mail-host.c
M	src/director/mail-host.h

2015-10-06 18:17:45 +0300 Timo Sirainen <tss@iki.fi> (fc61333)

    lib-http: Minor improvement to "disconnected during payload read" error
    message. The same error is also used for http-server for parsing client
    input, so the message shouldn't say anything about reading the input from
    server.


M	src/lib-http/http-message-parser.c

2015-10-06 18:14:05 +0300 Stephan Bosch <stephan@rename-it.nl> (7387c86)

    lib-http: client: Fixed handling of response timout if there is no payload
    going to the server.


M	src/lib-http/http-client-request.c

2015-10-04 21:52:29 +0300 Timo Sirainen <tss@iki.fi> (2988b4c)

    lib-index: Removed some unnecessary fields.


M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-write.c

2015-10-04 21:51:55 +0300 Timo Sirainen <tss@iki.fi> (1937094)

    lib-index: Fixed checking when we want to update dovecot.index This has been
    broken since 76f576fc28dc. After that dovecot.index was usually updated only
    when dovecot.index.log was being rotated.


M	src/lib-index/mail-index-sync.c

2015-10-04 21:49:08 +0300 Timo Sirainen <tss@iki.fi> (44d77d2)

    lib-index: When writing new index, rotate the log file first before writing
    it. This way the index contains the new log's seq+offset instead of having
    to recreate the index almost immediately afterwards.


M	src/lib-index/mail-index-write.c

2015-10-02 19:02:47 +0300 Timo Sirainen <tss@iki.fi> (568920f)

    Added signature for changeset d7e14d388a7e


M	.hgsigs

2015-10-02 19:02:43 +0300 Timo Sirainen <tss@iki.fi> (487191a)

    Added tag 2.2.19 for changeset d7e14d388a7e


M	.hgtags

2015-10-02 19:02:42 +0300 Timo Sirainen <tss@iki.fi> (bff2170)

    Released v2.2.19.


M	NEWS
M	configure.ac

2015-10-02 18:30:22 +0300 Timo Sirainen <tss@iki.fi> (d54067d)

    pop3: Fixed buffer overflow with handling pop3_deleted_flag setting. This
    has been broken since v2.2.10, although the setting wasn't working
    completely correctly before that version either. Afterwards it should have
    become obvious quickly enough that the setting is broken, because it started
    crashing POP3 sessions in normal use quite soon. So I doubt there are any
    installations that are accidentally exploitable.


M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h
M	src/pop3/pop3-commands.c

2015-10-02 12:23:22 +0300 Timo Sirainen <tss@iki.fi> (630c1df)

    push-notification: Use setting_get_time() parsing for cache_lifetime OX
    driver setting.


M	src/plugins/push-notification/Makefile.am
M	src/plugins/push-notification/push-notification-driver-ox.c

2015-10-02 12:16:11 +0300 Timo Sirainen <tss@iki.fi> (923e217)

    push-notification: Compiler warning fix.


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-10-02 12:10:41 +0300 Timo Sirainen <tss@iki.fi> (fe1fb4c)

    push-notification: Allow drivers to set only "key" without "=value" to
    parameters.


M	src/plugins/push-notification/push-notification-drivers.c

2015-10-02 12:09:30 +0300 Timo Sirainen <tss@iki.fi> (0f58da3)

    push-notification: Added timeout_msecs and max_retries parameters to OX
    driver. For configuring HTTP lookups.


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-10-02 11:46:30 +0300 Timo Sirainen <tss@iki.fi> (101becc)

    push-notification: Don't allocate cached metadata from memory pool in OX
    driver. It slowly keeps increasing memory usage over time.


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-10-02 11:17:53 +0300 Timo Sirainen <tss@iki.fi> (f61bbf7)

    push-notification: OX driver error handling fix - garbage metadata was
    returned on failure.


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-10-01 21:02:55 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (8b4073f)

    push-notification: Add cache lifetime config parameter to OX driver


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-10-01 20:49:20 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (41dc355)

    push-notification: OCD fix for lining up function parameters


M	src/plugins/push-notification/push-notification-plugin.c

2015-10-02 11:13:14 +0300 Timo Sirainen <tss@iki.fi> (33cbadf)

    push-notification: Removed optimization to init drivers only once. Different
    users may have different drivers. And the previous metadata-caching change
    especially isn't working without this change.


M	src/plugins/push-notification/push-notification-driver-ox.c
M	src/plugins/push-notification/push-notification-drivers.h
M	src/plugins/push-notification/push-notification-plugin.c

2015-10-01 13:48:24 +0300 Timo Sirainen <tss@iki.fi> (da24231)

    push-notification: Free all events at plugin deinit.


M	src/plugins/push-notification/push-notification-events-rfc5423.c
M	src/plugins/push-notification/push-notification-events-rfc5423.h
M	src/plugins/push-notification/push-notification-plugin.c

2015-10-01 13:45:17 +0300 Timo Sirainen <tss@iki.fi> (cad784f)

    push-notification: Allow OX driver to use "user" from METADATA only if
    user_from_metadata is set. Otherwise users could send push-notifications to
    each others' if imap_metadata=yes.


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-10-01 12:49:25 +0300 Timo Sirainen <tss@iki.fi> (dfebce6)

    push-notification: Cache the metadata lookup in OX driver.


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-10-01 12:34:43 +0300 Timo Sirainen <tss@iki.fi> (3e13cdf)

    push-notification: Don't crash at ox driver cleanup if init() hadn't been
    called.


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-09-30 18:22:52 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (e7e9ca3)

    push-notification: Improved struct naming of driver list data


M	src/plugins/push-notification/push-notification-drivers.h
M	src/plugins/push-notification/push-notification-plugin.c

2015-09-30 17:59:07 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (f6fb60c)

    push-notification: On-demand initialization of transaction data


M	src/plugins/push-notification/push-notification-drivers.h
M	src/plugins/push-notification/push-notification-plugin.c

2015-09-30 17:49:24 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (cf93f9d)

    push-notification: Fix infinite recursive loop in OX driver


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-09-30 17:45:49 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (3cbb235)

    push-notification: If other drivers triggered a non-MessageNew successful
    event, don't assert


M	src/plugins/push-notification/push-notification-driver-ox.c

2015-09-30 17:43:20 -0600 Michael Slusarz <michael.slusarz@dovecot.fi> (4ee5a85)

    push-notification: Fix distinguishing between IMAP APPEND and MTA deliveries


M	src/plugins/push-notification/push-notification-plugin.c

2015-09-30 18:50:09 +0300 Timo Sirainen <tss@iki.fi> (7d56dc7)

    doveadm fetch: Added "storageid" field.


M	src/doveadm/doveadm-mail-fetch.c

2015-09-30 18:49:39 +0300 Timo Sirainen <tss@iki.fi> (5eb85ec)

    lib-storage: Renamed MAIL_FETCH_UIDL_FILE_NAME to MAIL_FETCH_STORAGE_ID.
    Keep MAIL_FETCH_UIDL_FILE_NAME for backwards compatibility for now.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage.h
M	src/pop3/pop3-commands.c

2015-09-30 18:11:53 +0300 Timo Sirainen <tss@iki.fi> (b5f0024)

    dict-sql: Added support for "uint" field type.


M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql-settings.h
M	src/lib-dict/dict-sql.c

2015-09-30 17:38:12 +0300 Timo Sirainen <tss@iki.fi> (3e59d33)

    dict-sql: Added support for extensible field types.


M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql-settings.h
M	src/lib-dict/dict-sql.c

2015-09-29 21:02:37 +0300 Timo Sirainen <tss@iki.fi> (43da9b9)

    fts-solr: Removed Content-Type header from "select" requests to fix Solr
    v5.1.


M	src/plugins/fts-solr/solr-connection.c

2015-09-28 23:39:31 +0300 Timo Sirainen <tss@iki.fi> (36af6ff)

    lib: s/EDEADLOCK/EDEADLK/ It felt wrong since the beginning, but my first
    attempt at EDEADLCK didn't work and EDEADLOCK did. Of course, not
    everywhere.


M	src/lib/file-lock.c

2015-09-28 17:26:04 +0300 Timo Sirainen <tss@iki.fi> (d228839)

    Added signature for changeset 7a5726201e40


M	.hgsigs

2015-09-28 17:26:00 +0300 Timo Sirainen <tss@iki.fi> (93ca503)

    Added tag 2.2.19.rc2 for changeset 7a5726201e40


M	.hgtags

2015-09-28 17:25:59 +0300 Timo Sirainen <tss@iki.fi> (d664d6b)

    Released v2.2.19.rc2.


M	configure.ac

2015-09-28 16:37:37 +0300 Timo Sirainen <tss@iki.fi> (9d44fee)

    quota: Fix to previous commit - counting quota-disabled-storages may have
    returned random failures.


M	src/plugins/quota/quota-count.c

2015-09-28 16:20:02 +0300 Timo Sirainen <tss@iki.fi> (9e99739)

    quota: Fixed "count" backend to ignore storages that have quota disabled.
    For example virtual mailboxes shouldn't be counted in quota.


M	src/plugins/quota/quota-count.c

2015-09-28 16:17:13 +0300 Timo Sirainen <tss@iki.fi> (d46f8fb)

    quota: The new quota counting code was counting only the last mailbox.


M	src/plugins/quota/quota-count.c

2015-09-28 16:15:00 +0300 Timo Sirainen <tss@iki.fi> (adbaf36)

    virtual plugin: Fixed assert-crash on mailbox_status() if virtual mailbox
    wasn't opened yet. We no longer require that mailboxes must not be
    auto-opened.


M	src/plugins/virtual/virtual-storage.c

2015-09-28 16:13:00 +0300 Timo Sirainen <tss@iki.fi> (ca20303)

    virtual plugin: Fixed crash on mailbox_status() if virtual mailbox wasn't
    opened yet. mbox->backend_boxes is initialized only when mailbox is opened.


M	src/plugins/virtual/virtual-storage.c

2015-09-28 16:07:12 +0300 Timo Sirainen <tss@iki.fi> (ddd7c3b)

    quota: doveadm quota recalc works now for "count" backend by rebuilding
    vsize header.


M	src/plugins/quota/quota-count.c

2015-09-28 16:06:43 +0300 Timo Sirainen <tss@iki.fi> (88b0619)

    quota: Code cleanup - abstract out iteration of mailboxes related to a quota
    root.


M	src/plugins/quota/quota-count.c

2015-09-28 15:51:45 +0300 Timo Sirainen <tss@iki.fi> (8e0eb6a)

    lib: Using istream-timeout with timeout disabled caused excessive CPU usage.


M	src/lib/istream-timeout.c

2015-09-28 15:10:29 +0300 Timo Sirainen <tss@iki.fi> (c9ac179)

    lib-storage: Added assert - mailbox has to be open when starting vsize
    header update.


M	src/lib-storage/index/index-mailbox-size.c

2015-09-28 15:10:02 +0300 Timo Sirainen <tss@iki.fi> (07ddf7a)

    lib-storage: Don't try to update index vsize if syncing failed.


M	src/lib-storage/index/index-sync.c

2015-09-28 15:00:04 +0300 Timo Sirainen <tss@iki.fi> (1492e7c)

    lib-http: Don't silently truncate response payload if server disconnects
    during it.


M	src/lib-http/http-message-parser.c

2015-09-28 14:59:04 +0300 Timo Sirainen <tss@iki.fi> (8e7ea02)

    lib: Added i_stream_create_sized_with_callback(). The callback returns the
    wanted error string.


M	src/lib/istream-sized.c
M	src/lib/istream-sized.h

2015-09-28 14:41:15 +0300 Timo Sirainen <tss@iki.fi> (5e06074)

    lib: When destroying istream-sized stream, it seeks the parent input at the
    end offset. This is also how istream-limit works.


M	src/lib/istream-sized.c

2015-09-28 14:34:05 +0300 Timo Sirainen <tss@iki.fi> (d08e495)

    lib-http: When receiving unexpected input in HTTP response, include a longer
    snippet of it in the error.


M	src/lib-http/http-response-parser.c

2015-09-28 13:54:28 +0300 Timo Sirainen <tss@iki.fi> (e9228a3)

    lib-http: Added asserts to all refcount increments. These could catch
    situations where an already freed object's refcount is attempted to be
    increased.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-request.c

2015-09-28 13:53:22 +0300 Timo Sirainen <tss@iki.fi> (76beac2)

    lib-http: Avoid crashes when server is already disconnected. I'm not sure if
    this is the nicest fix, but seems to work for now at least.


M	src/lib-http/http-client-connection.c

2015-09-28 13:51:49 +0300 Timo Sirainen <tss@iki.fi> (e312e22)

    lib-http: Disconnection from HTTP server could have caused accessing already
    freed memory. Freeing a request could have freed the connection.


M	src/lib-http/http-client-connection.c

2015-09-28 12:33:33 +0300 Timo Sirainen <tss@iki.fi> (169b679)

    quota: Avoid crash in quota_root_iter_init() if mailbox has no quota
    enabled. This allows quota_get_mail_user_quota() to be called even when
    quota doesn't exist. Cleaned up all the code using it to now check for the
    NULL result.

    This fixes a crash in quota_clone plugin.

M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2015-09-28 12:19:20 +0300 Timo Sirainen <tss@iki.fi> (f39a06c)

    quota-clone: Memory leak fix when mailbox had no quota roots.


M	src/plugins/quota-clone/quota-clone-plugin.c

2015-09-27 21:48:34 +0300 Timo Sirainen <tss@iki.fi> (6b88b35)

    push-notification: Log about unexpectedly failing mailbox functions. Found
    by Coverity.


M	src/plugins/push-notification/push-notification-driver-ox.c
M	src/plugins/push-notification/push-notification-event-mailboxcreate.c

2015-09-27 21:42:17 +0300 Timo Sirainen <tss@iki.fi> (81623c8)

    Added NULL-check asserts to make static analyzer happier. These shouldn't be
    happening.


M	src/config/doveconf.c
M	src/plugins/push-notification/push-notification-driver-ox.c

2015-09-27 21:34:48 +0300 Timo Sirainen <tss@iki.fi> (a030246)

    lib-storage: Removed unnecessary code - nnode is never NULL at this point.
    Found by Coverity.


M	src/lib-storage/list/mailbox-list-index-notify.c

2015-09-27 21:33:30 +0300 Timo Sirainen <tss@iki.fi> (bd78cb1)

    dsync: Removed unnecessary code - cur_mail is never NULL at this point.
    Found by Coverity.


M	src/doveadm/dsync/dsync-mailbox-import.c

2015-09-27 21:30:56 +0300 Timo Sirainen <tss@iki.fi> (948b685)

    imapc: Fixed crash if imapc_host or imapc_password setting was missing.
    Instead of giving a nice error message about it. Found by Coverity.


M	src/lib-storage/index/imapc/imapc-list.c

2015-09-27 21:28:25 +0300 Timo Sirainen <tss@iki.fi> (7fb4bc0)

    dict-client: Avoid crash if server disconnects during transaction commit.
    Found by Coverity.


M	src/lib-dict/dict-client.c

2015-09-27 21:25:59 +0300 Timo Sirainen <tss@iki.fi> (a7d14da)

    *-login: Session ID generator wasn't encoding remote port number correctly
    to it. The upper 8bits of the port number were always written as 0. This
    could have lead to duplicate session ID strings in some rare cases. Found by
    Coverity.


M	src/login-common/client-common.c

2015-09-27 20:47:20 +0300 Timo Sirainen <tss@iki.fi> (37ed92c)

    lib-http: Avoid compiler warnings in printf() strings. Cast fields
    explicitly as long, which should be large enough.


M	src/lib-http/http-server-connection.c

2015-09-27 20:46:29 +0300 Timo Sirainen <tss@iki.fi> (a326f9d)

    Fixed compiler warnings in some systems. major() and minor() are unsigned
    ints nowadays, but in Solaris it's major_t. Cast them explicitly to avoid
    compiler warnings, and use unsigned longs instead of unsigned ints just in
    case.


M	src/imap-hibernate/imap-client.c
M	src/imap/imap-client-hibernate.c
M	src/imap/imap-master-client.c

2015-09-27 19:03:31 +0300 Timo Sirainen <tss@iki.fi> (648a603)

    Make static analyzer happier.


M	src/lib-mail/test-message-id.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/mail-namespace.c

2015-09-27 18:58:08 +0300 Timo Sirainen <tss@iki.fi> (9229d5e)

    lib-http: Removed "pure" attribute from http_header_field_find_unique().
    It's a bit questionable if returning a pointer via parameter is allowed for
    a pure function. Also having this attribute seems to confuse clang static
    analyzer, because it gives false positives for code using
    http_header_field_find_unique(). It's not important for performance anyway,
    so better to avoid using it.


M	src/lib-http/http-header.h

2015-09-25 18:16:56 +0300 Timo Sirainen <tss@iki.fi> (e7b5b71)

    dict-sql: If value isn't a hexblob as expected, log an error instead of
    killing the whole process.


M	src/lib-dict/dict-sql.c

2015-09-24 20:58:04 +0300 Timo Sirainen <tss@iki.fi> (be59f9a)

    cassandra: copy&paste mistake - use monotonic timestamp generator, not
    server side..


M	src/lib-sql/driver-cassandra.c

2015-09-24 20:51:16 +0300 Timo Sirainen <tss@iki.fi> (f9eee36)

    cassandra: Added "version" parameter to specify a protocol version. Mainly
    to avoid warnings logged when connecting to an older Cassandra server.


M	src/lib-sql/driver-cassandra.c

2015-09-24 20:28:51 +0300 Timo Sirainen <tss@iki.fi> (4d10133)

    doveconf: Don't if _password value is empty, don't hide it.


M	src/config/doveconf.c

2015-09-24 19:40:41 +0300 Timo Sirainen <tss@iki.fi> (f0e416a)

    cassandra: Use a local monotonic timestamp generator. Otherwise we run into
    race conditions on server side timestamps, which cause problems.


M	src/lib-sql/driver-cassandra.c

2015-09-24 19:27:10 +0300 Timo Sirainen <tss@iki.fi> (dd37e2f)

    virtual plugin: Auto-close mailboxes by hooking into backend's
    mailbox_open() This is a more reliable way of doing it. The earlier version
    had problems that all the backend mailboxes could be opened when doing a
    search on the virtual mailbox (for getting the GUID of the mailboxes).


M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c

2015-09-24 19:07:12 +0300 Timo Sirainen <tss@iki.fi> (9cb0fe2)

    virtual plugin: Fixed assert-crash when closing a virtual mailbox consisting
    of many real mailboxes.


M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2015-09-24 18:42:58 +0300 Timo Sirainen <tss@iki.fi> (38f5195)

    dict-client: Verify that the correct transaction ID is returned for commit
    reply.


M	src/lib-dict/dict-client.c

2015-09-24 18:41:48 +0300 Timo Sirainen <tss@iki.fi> (54a8bb6)

    quota: Avoid triggering quota recalc in dict transaction commit callback.
    This mainly causes trouble if it again does more dict accesses.


M	src/plugins/quota/quota-dict.c

2015-09-24 16:41:10 +0300 Timo Sirainen <tss@iki.fi> (ccd8afd)

    pgsql: Avoid crash in multi-command transaction if one of the queries
    couldn't be sent to server.


M	src/lib-sql/driver-pgsql.c

2015-09-24 16:30:23 +0300 Timo Sirainen <tss@iki.fi> (1693511)

    indexer: Use a slightly different session ID than the session that requested
    indexing. Required to avoid "duplicate session ID" errors in stats process.

    Alternative would have been to change the stats protocol a bit and always 
    send the service name along with session ID, and use those two together as 
    the primary key. Maybe this could be done in future if we get more of these 
    kind of processes.

M	src/indexer/master-connection.c

2015-09-24 16:16:43 +0300 Timo Sirainen <tss@iki.fi> (154ee35)

    doveconf: Unless -P parameter is used, hide all keys ending with "_password"
    A little bit ugly way, but implementing a proper SET_PASSWORD type was
    getting too difficult with the current config code. Then again as a bonus
    this also hides plugin { *_password } settings, if there are any, which
    wouldn't have been possible with SET_PASSWORD.


M	src/config/doveconf.c

2015-09-24 15:19:53 +0300 Timo Sirainen <tss@iki.fi> (f67a12c)

    lib: Fixed __builtin_object_size() usage in buffer.h With type=3 size for
    unknown objects is set to 0, which causes a compiler failure. With type=1
    it's (size_t)-1, which passes the check.


M	src/lib/buffer.h

2015-09-24 12:32:24 +0300 Timo Sirainen <tss@iki.fi> (f990dde)

    Don't try to pass through void function's return value I wish gcc or clang
    complained about these.


M	src/lib-dict/dict.c
M	src/lib-settings/settings-parser.c

2015-09-24 10:11:29 +0300 Timo Sirainen <tss@iki.fi> (9366a28)

    push-notification: Added missing newlines to end of files to prevent
    compiler warnings.


M	src/plugins/push-notification/push-notification-driver-dlog.c
M	src/plugins/push-notification/push-notification-drivers.c
M	src/plugins/push-notification/push-notification-event-flagsset.c
M	src/plugins/push-notification/push-notification-event-messageappend.c
M	src/plugins/push-notification/push-notification-event-messageexpunge.c
M	src/plugins/push-notification/push-notification-event-messageread.h
M	src/plugins/push-notification/push-notification-events-rfc5423.c
M	src/plugins/push-notification/push-notification-events.c

2015-09-24 01:13:36 +0300 Timo Sirainen <tss@iki.fi> (b087ad4)

    master: stdlib.h wasn't supposed to be removed from systemd's sd-daemon.c
    It's not using our lib.h


M	src/master/sd-daemon.c

2015-09-24 01:04:00 +0300 Timo Sirainen <tss@iki.fi> (d1a0845)

    pgsql: Fixed committing a single sql_update_get_rows() transaction. The rows
    weren't being set.


M	src/lib-sql/driver-pgsql.c

2015-09-24 01:02:32 +0300 Timo Sirainen <tss@iki.fi> (e8db44d)

    pgsql: Fixed committing multiple transactions. This code is quite horrible
    and could use a larger redesign. But it appears to be working for now..


M	src/lib-sql/driver-pgsql.c

2015-09-24 01:00:45 +0300 Timo Sirainen <tss@iki.fi> (191eb75)

    lib-sql: sqlpool needs to change transaction queries' transaction pointer
    Otherwise query->trans points to the sqlpool's transaction, while our
    backends want it to point to the backend's transaction.


M	src/lib-sql/driver-sqlpool.c

2015-09-23 23:01:27 +0300 Timo Sirainen <tss@iki.fi> (563b8bb)

    dict: Include PID in the log prefix.


M	src/dict/main.c

2015-09-23 23:00:30 +0300 Timo Sirainen <tss@iki.fi> (2333ef6)

    dict-client: Improved broken iterate reply logging.


M	src/lib-dict/dict-client.c

2015-09-23 22:59:55 +0300 Timo Sirainen <tss@iki.fi> (9e7a309)

    dict-client: If dict iteration was aborted, the rest of the connection state
    became broken. We never continued skipping over the rest of the iteration,
    instead the iteration replies were treated as replies to the following
    commands.


M	src/lib-dict/dict-client.c

2015-09-23 22:57:55 +0300 Timo Sirainen <tss@iki.fi> (7e74fad)

    dict-client: Catch more invalid protocol replies.


M	src/lib-dict/dict-client.c

2015-09-23 22:49:41 +0300 Timo Sirainen <tss@iki.fi> (feac4d8)

    dict-client: Disconnect from server on unexpected errors.


M	src/lib-dict/dict-client.c

2015-09-23 16:10:27 +0300 Timo Sirainen <tss@iki.fi> (76f6d8b)

    Added signature for changeset 60057d955db3


M	.hgsigs

2015-09-23 16:10:24 +0300 Timo Sirainen <tss@iki.fi> (18ceb7a)

    Added tag 2.2.19.rc1 for changeset 60057d955db3


M	.hgtags

2015-09-23 16:10:24 +0300 Timo Sirainen <tss@iki.fi> (782ad0e)

    Released v2.2.19.rc1.


M	NEWS
M	configure.ac

2015-09-23 16:09:47 +0300 Timo Sirainen <tss@iki.fi> (5043371)

    virtual: The virtual index may have sometimes been unnecessarily deleted.
    Due to uninitialized broken_r value.


M	src/plugins/virtual/virtual-sync.c

2015-09-23 16:08:33 +0300 Timo Sirainen <tss@iki.fi> (2d07c75)

    example-config: Added imap_hibernate_timeout


M	doc/example-config/conf.d/20-imap.conf

2015-09-23 14:52:45 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (814bf67)

    Remove now-unnecessary direct stdlib.h #includes.


M	src/anvil/anvil-connection.c
M	src/anvil/main.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-token.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/checkpassword-reply.c
M	src/auth/db-checkpassword.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-gssapi.c
M	src/auth/mech-scram-sha1.c
M	src/auth/mech-winbind.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-pam.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-scram.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-parser.c
M	src/config/doveconf.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/director/director-test.c
M	src/director/test-user-directory.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-pw.c
M	src/doveadm/doveadm-replicator.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c
M	src/imap-hibernate/imap-hibernate-settings.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/imap-proxy.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap-urlauth/imap-urlauth.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-select.c
M	src/imap/cmd-store.c
M	src/imap/imap-client.c
M	src/imap/imap-commands.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/main.c
M	src/indexer/indexer-client.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-compression/test-compression.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fts/test-fts-tokenizer.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/mail-send.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service.c
M	src/lib-master/test-master-service-settings-cache.c
M	src/lib-otp/otp-parse.c
M	src/lib-settings/settings-parser.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/sql-api.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/mailbox-watch.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/array.c
M	src/lib/backtrace-string.c
M	src/lib/compat.c
M	src/lib/data-stack.c
M	src/lib/env-util.c
M	src/lib/failures.c
M	src/lib/file-dotlock.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mmap-anon.c
M	src/lib/module-dir.c
M	src/lib/net.c
M	src/lib/process-title.c
M	src/lib/rand.c
M	src/lib/randgen.c
M	src/lib/restrict-access.c
M	src/lib/test-array.c
M	src/lib/test-base32.c
M	src/lib/test-base64.c
M	src/lib/test-buffer.c
M	src/lib/test-data-stack.c
M	src/lib/test-hash.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-llist.c
M	src/lib/test-numpack.c
M	src/lib/test-ostream-file.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-strfuncs.c
M	src/lib/test-strnum.c
M	src/lib/test-timing.c
M	src/lib/test-unichar.c
M	src/lib/timing.c
M	src/lib/unlink-old-files.c
M	src/lib/var-expand.c
M	src/lmtp/main.c
M	src/log/log-connection.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/master/main.c
M	src/master/sd-daemon.c
M	src/master/service-monitor.c
M	src/master/service-process.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-util.c
M	src/plugins/quota/quota.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-settings.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap.c

2015-09-23 14:52:44 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (d3fa9b6)

    lib: Include stdlib.h in lib.h. It's already included in so many files that
    we might as well include it in lib.h for everything. This is especially
    needed to be able to use sort.h, which currently is included in lib.h
    anyway.


M	src/lib/lib.h

2015-09-22 22:33:41 -0600 Michael M Slusarz <michael.slusarz@dovecot.fi> (51ed197)

    Added push-notification plugin


M	configure.ac
M	dovecot-config.in.in
M	src/plugins/Makefile.am
A	src/plugins/push-notification/Makefile.am
A	src/plugins/push-notification/push-notification-driver-dlog.c
A	src/plugins/push-notification/push-notification-driver-ox.c
A	src/plugins/push-notification/push-notification-drivers.c
A	src/plugins/push-notification/push-notification-drivers.h
A	src/plugins/push-notification/push-notification-event-flagsclear.c
A	src/plugins/push-notification/push-notification-event-flagsclear.h
A	src/plugins/push-notification/push-notification-event-flagsset.c
A	src/plugins/push-notification/push-notification-event-flagsset.h
A	src/plugins/push-notification/push-notification-event-mailboxcreate.c
A	src/plugins/push-notification/push-notification-event-mailboxcreate.h
A	src/plugins/push-notification/push-notification-event-mailboxdelete.c
A	src/plugins/push-notification/push-notification-event-mailboxdelete.h
A	src/plugins/push-notification/push-notification-event-mailboxrename.c
A	src/plugins/push-notification/push-notification-event-mailboxrename.h
A	src/plugins/push-notification/push-notification-event-mailboxsubscribe.c
A	src/plugins/push-notification/push-notification-event-mailboxsubscribe.h
A	src/plugins/push-notification/push-notification-event-mailboxunsubscribe.c
A	src/plugins/push-notification/push-notification-event-mailboxunsubscribe.h
A	src/plugins/push-notification/push-notification-event-message-common.h
A	src/plugins/push-notification/push-notification-event-messageappend.c
A	src/plugins/push-notification/push-notification-event-messageappend.h
A	src/plugins/push-notification/push-notification-event-messageexpunge.c
A	src/plugins/push-notification/push-notification-event-messageexpunge.h
A	src/plugins/push-notification/push-notification-event-messagenew.c
A	src/plugins/push-notification/push-notification-event-messagenew.h
A	src/plugins/push-notification/push-notification-event-messageread.c
A	src/plugins/push-notification/push-notification-event-messageread.h
A	src/plugins/push-notification/push-notification-event-messagetrash.c
A	src/plugins/push-notification/push-notification-event-messagetrash.h
A	src/plugins/push-notification/push-notification-events-rfc5423.c
A	src/plugins/push-notification/push-notification-events-rfc5423.h
A	src/plugins/push-notification/push-notification-events.c
A	src/plugins/push-notification/push-notification-events.h
A	src/plugins/push-notification/push-notification-plugin.c
A	src/plugins/push-notification/push-notification-plugin.h
A	src/plugins/push-notification/push-notification-triggers.c
A	src/plugins/push-notification/push-notification-triggers.h
A	src/plugins/push-notification/push-notification-txn-mbox.c
A	src/plugins/push-notification/push-notification-txn-mbox.h
A	src/plugins/push-notification/push-notification-txn-msg.c
A	src/plugins/push-notification/push-notification-txn-msg.h

2015-09-22 21:16:51 +0300 Stephan Bosch <stephan@rename-it.nl> (13bdd67)

    lib-http: client: Tunneled https peer addresses were not compared properly.
    The https_name field was ignored in that case.


M	src/lib-http/http-client-peer.c

2015-09-22 21:16:34 +0300 Stephan Bosch <stephan@rename-it.nl> (8192e6f)

    lib-http: client: Fixed bug that caused queues to be duplicated over time
    when host has multiple IPs. The peer address comparison did not account for
    the fact that the initial queue address has no IP assigned.


M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-request.c

2015-09-22 21:15:45 +0300 Stephan Bosch <stephan@rename-it.nl> (7b572cf)

    lib-http: client: Improved hash function for peer addresses.


M	src/lib-http/http-client-peer.c

2015-09-22 16:40:58 +0300 Timo Sirainen <tss@iki.fi> (c981098)

    lib-storage: If stats plugin is enabled, set
    fs_settings.enable_timings=TRUE.


M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/plugins/stats/stats-plugin.c

2015-09-22 16:38:59 +0300 Timo Sirainen <tss@iki.fi> (12d3198)

    lib-fs: debug and enable_timing settings weren't being permanently copied to
    fs->set


M	src/lib-fs/fs-api.c

2015-09-22 16:09:41 +0300 Timo Sirainen <tss@iki.fi> (df5b253)

    lib: Added timing_get_sum()


M	src/lib/test-timing.c
M	src/lib/timing.c
M	src/lib/timing.h

2015-09-22 14:33:33 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (bda082b)

    imap: Fix typo in error message.


M	src/imap/imap-state.c

2015-09-22 14:32:51 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (ab0eb4b)

    auth: Remove redundant if


M	src/auth/auth-request.c

2015-09-22 14:26:25 +0300 Timo Sirainen <tss@iki.fi> (9549f50)

    Make static analyzer happier.


M	src/lib/test-timing.c

2015-09-22 14:26:08 +0300 Timo Sirainen <tss@iki.fi> (68d7af0)

    quota: Make sure the limit return value is initialized when
    quota_get_resource() returns 0 Later on a debug log message in
    quota_over_flag_check_root() was accessing the limit, which wasn't
    necessarily initialized.

    Also initialized value return value just as well to be safe.

M	src/plugins/quota/quota.c

2015-09-22 13:53:47 +0300 Timo Sirainen <tss@iki.fi> (086daca)

    lib-master: Slightly improved "process_limit reached?" error message.


M	src/lib-master/master-auth.c

2015-09-22 13:50:08 +0300 Timo Sirainen <tss@iki.fi> (013c043)

    virtual plugin: Disable caching via mailbox list indexes. Otherwise e.g.
    STATUS can give stale replies.


M	src/plugins/virtual/virtual-storage.c

2015-09-22 01:05:09 +0300 Timo Sirainen <tss@iki.fi> (cb44fd2)

    lib-http: Optimized http_client_request_send_payload() fix Badly copy&pasted
    my original fix, instead of noticing that Stephan's fix was slightly
    different. Probably shouldn't have made actual difference other than for
    performance.


M	src/lib-http/http-client-request.c

2015-09-22 00:55:15 +0300 Timo Sirainen <tss@iki.fi> (47ff1ea)

    lib-http: Avoid crashes on failing http_client_request_send_payload() calls
    It HTTP server connection died, ioloop might not have anything to do
    anymore:

    Panic: file ioloop-epoll.c: line 187 (io_loop_handler_run_internal):
    assertion failed: (msecs >= 0)

M	src/lib-http/http-client-request.c

2015-09-22 00:40:14 +0300 Timo Sirainen <tss@iki.fi> (d9e3a94)

    Makefile: Added missing sort.h


M	src/lib/Makefile.am

2015-09-21 19:52:32 +0300 Phil Carmody <phil@dovecot.fi> (ec8eaca)

    lib: timings - added quantiles Just sub-sample the stream. On the assumption
    that the samples come from one distribution, then any randomly selected
    subset will share the same distribution. Therefore the quantiles should be
    at approximately the same value.

    However, that's a big assumption, as there will almost certainly be time 
    dependency, and periodicity (24hrs, 7 days).

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-timing.c
M	src/lib/timing.c
M	src/lib/timing.h

2015-09-21 19:51:05 +0300 Phil Carmody <phil@dovecot.fi> (2c886f0)

    lib: extract sort-helpers into separate sort.h file The macro definition was
    nothing to do with strings, and we can put trivial common-type comparators
    here. They didn't need to be static inline, as they can never be inlined
    anyway, being only used via function pointers, but that preserves the
    closest equivalent to the current code.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/list/mailbox-list-index-sync.c
A	src/lib/sort.h
M	src/lib/strfuncs.h
M	src/lib/test-timing.c
M	src/plugins/fts-squat/squat-uidlist.c

2015-09-21 17:03:19 +0300 Timo Sirainen <tss@iki.fi> (e716e8e)

    lib-storage: Forgot to add index-mailbox-size.h to e29d2f7fe53f


A	src/lib-storage/index/index-mailbox-size.h

2015-09-21 17:01:05 +0300 Timo Sirainen <tss@iki.fi> (a8dcd4e)

    fts: Send session ID to indexer and indexer-worker for logging purposes.


M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-queue.h
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-storage.c

2015-09-21 16:36:05 +0300 Timo Sirainen <tss@iki.fi> (c4db121)

    quota: Added "count" backend, which simply sums up mailboxes' vsizes. In a
    way this is similar to the simple "dirsize" backend, but much more
    efficient. As long as mailbox_list_index=yes, the quota can typically be
    looked up only by reading the dovecot.list.index* files.

    This backend enforces using quota_vsizes=yes setting to keep the performance 
    good, because physical sizes don't have a similar optimized vsize header. 
    There's also no especially good reason why this backend should support 
    physical sizes - they were originally mainly used to allow quickly stat()ing 
    Maildir files.

M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota.c

2015-09-21 16:32:27 +0300 Timo Sirainen <tss@iki.fi> (9963bef)

    lib-storage: Update mailbox vsize header on save/copy/expunge. This allows
    always efficiently looking up maiboxes' vsizes after they're initially
    calculated.

    The expunge handling is unfortunately done currently in quota handling code, 
    so it works only if quota is enabled. Ideally this would be solved in v2.3 
    with some lib-storage core changes.

M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/plugins/quota/quota-storage.c

2015-09-21 16:24:30 +0300 Timo Sirainen <tss@iki.fi> (93f1642)

    quota: Added quota_vsizes=yes setting to count quotas using virtual sizes
    instead of physical sizes. This doesn't work with all the quota backends.


M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2015-09-21 16:12:43 +0300 Timo Sirainen <tss@iki.fi> (93eb96e)

    quota: Commit expunge transaction instead of rolling back. This likely won't
    make much of a difference, since it should have accessed only expunged
    mails. But it's a bit cleaner this way.


M	src/plugins/quota/quota-storage.c

2015-09-21 16:09:37 +0300 Timo Sirainen <tss@iki.fi> (a4922fa)

    quota: Code cleanup - extract default init() handling to
    quota_root_default_init()


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2015-09-21 15:41:49 +0300 Timo Sirainen <tss@iki.fi> (c9b76ca)

    imap: If client disconnects, log the in-progress commands' input/output
    bytes.


M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c

2015-09-21 15:32:02 +0300 Timo Sirainen <tss@iki.fi> (fa5c3e6)

    imap: If client disconnects, log how long the in-progress commands were
    running.


M	src/imap/imap-client.c

2015-09-21 14:18:51 +0300 Timo Sirainen <tss@iki.fi> (f56f01d)

    Compiler warning fix.


M	src/imap/imap-commands.c

2015-09-21 14:02:47 +0300 Timo Sirainen <tss@iki.fi> (266d72b)

    imap: Improved command timing information reporting. We now report also the
    time we spent waiting on ioloop. Also fixed reporting command timing
    information when multiple commands were running in parallel (e.g. SEARCH +
    FETCH). If multiple commands are running in parallel they all report the
    same ioloop wait time, because there's no easy way to know which one of them
    caused the wait.


M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c

2015-09-21 13:59:41 +0300 Timo Sirainen <tss@iki.fi> (fb4bd85)

    lib: Added io_loop_get_wait_usecs()


M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2015-09-21 13:59:22 +0300 Timo Sirainen <tss@iki.fi> (b7c841f)

    imap: When running SEARCH on "background", run it through command_exec()
    Otherwise all the timing information isn't right and the pre/post hooks
    weren't being called so stats counting was also wrong.


M	src/imap/imap-search.c

2015-09-20 22:25:11 +0300 Timo Sirainen <tss@iki.fi> (5fb7f20)

    lib-index: Added mail_index_sync_have_any_expunges() This can be used to
    quickly check before mail_index_sync_begin() if there are likely to be any
    expunges that will be synced.


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index.h

2015-09-20 21:49:51 +0300 Stephan Bosch <stephan@rename-it.nl> (4ac2e38)

    auth: The mechanisms configured using the auth_mechanisms setting were not
    enforced. The login service would check whether the mechanism is supported
    by auth, but auth performed no such check of its own. This means that any
    implemented mechanism was accessible from a login, even though was
    presumably disabled.


M	src/auth/auth-request-handler.c
M	src/auth/mech.c
M	src/auth/mech.h

2015-09-20 01:04:50 +0300 Timo Sirainen <tss@iki.fi> (3d2fd38)

    lib: file_wait_lock*(): Improve the panic log message on EDEADLOCK.


M	src/lib/file-lock.c

2015-09-17 07:33:22 +0900 Timo Sirainen <tss@iki.fi> (48eb19f)

    lib-fs: Fixed compiling with some OSes


M	src/lib-fs/fs-api-private.h

2015-09-17 07:33:01 +0900 Timo Sirainen <tss@iki.fi> (db6fe1b)

    lib-fs: timing_deinit()s was called too late - fs was already freed.


M	src/lib-fs/fs-api.c

2015-09-17 07:26:49 +0900 Timo Sirainen <tss@iki.fi> (37e8420)

    cassandra: With debugging, log also how many rows were iterated.


M	src/lib-sql/driver-cassandra.c

2015-09-17 07:24:28 +0900 Timo Sirainen <tss@iki.fi> (2ccb478)

    cassandra: With debugging, log also how long result was used for before it
    was freed. This includes the time spent on SELECT query's iterator.


M	src/lib-sql/driver-cassandra.c

2015-09-17 07:20:32 +0900 Timo Sirainen <tss@iki.fi> (3e88424)

    cassandra: Don't crash if connection to Cassandra failed.


M	src/lib-sql/driver-cassandra.c

2015-09-17 07:07:57 +0900 Timo Sirainen <tss@iki.fi> (de5f478)

    cassandra: If log_level=debug, log also how long the queries take.


M	src/lib-sql/driver-cassandra.c

2015-09-16 10:46:44 +0900 Timo Sirainen <tss@iki.fi> (caa1546)

    lib: file_wait_lock_error() assert-crashes now on EDEADLOCK It's always a
    bug and a crash can help debug it.


M	src/lib/file-lock.c

2015-09-16 05:01:40 +0900 Timo Sirainen <tss@iki.fi> (1c244f6)

    lib-fs: Track operation timing statistics if enable_timing setting is set.


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
A	src/lib-fs/istream-fs-stats.c
A	src/lib-fs/istream-fs-stats.h

2015-09-16 04:44:37 +0900 Timo Sirainen <tss@iki.fi> (273a7cf)

    lib: Added a simple timing.h API for tracking min/max/avg for events.


M	src/lib/Makefile.am
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-timing.c
A	src/lib/timing.c
A	src/lib/timing.h

2015-09-15 15:20:08 +0900 Timo Sirainen <tss@iki.fi> (4db61af)

    cassandra: Added delete_consistency parameter.


M	src/lib-sql/driver-cassandra.c

2015-09-13 16:42:32 +0300 Timo Sirainen <tss@iki.fi> (33c7e05)

    lib: file_create_locked() may have leaked memory on some race conditions.


M	src/lib/file-create-locked.c

2015-09-12 13:00:58 +0300 Timo Sirainen <tss@iki.fi> (03ba849)

    doveadm mailbox metadata list: Fixed not giving the prefix parameter.


M	src/doveadm/doveadm-mail-mailbox-metadata.c

2015-09-11 14:02:21 +0300 Timo Sirainen <tss@iki.fi> (d993d49)

    doveadm mailbox attribute list: Prefix parameter was ignored.


M	src/doveadm/doveadm-mail-mailbox-metadata.c

2015-09-11 14:02:01 +0300 Timo Sirainen <tss@iki.fi> (42f2d98)

    lib-storage: Fixed iterating attribute prefix that matched the attribute
    itself. So if attribute key was "foo", iterating "foo" returned garbage
    because it skipped over the trailing \0.


M	src/lib-storage/mailbox-attribute.c

2015-09-11 01:20:28 +0300 Timo Sirainen <tss@iki.fi> (27f5066)

    master: systemd's sd_listen_fds() error handling was wrong.


M	src/master/service-listen.c

2015-09-09 11:31:41 +0300 Timo Sirainen <tss@iki.fi> (ec937f2)

    lib-storage: Fixed crash in mailbox list index notifying caused by
    fa979ccfa34c


M	src/lib-storage/list/mailbox-list-index-notify.c

2015-09-08 19:28:31 +0300 Phil Carmody <phil@dovecot.fi> (d6bbf85)

    lib: test-strnum - do not invite undetectable errors The very numbers which
    could cause a broken parser to over-run, the ones we are testing, are the
    ones which will be parsed as having a value similar to 'value', so check
    that no value was returned by using a number completely dissimilar to that.
    Otherwise, there might be an accidental mis-parse that overwrote value, but
    left its value the same.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-strnum.c

2015-09-08 19:12:26 +0300 Timo Sirainen <tss@iki.fi> (275cc4c)

    lib-storage: Replaced some unlink()s with i_unlink*()s where we could. This
    changes some mail_storage_set_critical() calls to i_error()s, but because
    these unlink() failures don't actually fail the operation it doesn't matter.


M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c

2015-09-08 19:11:45 +0300 Timo Sirainen <tss@iki.fi> (39087f5)

    lib-index: Replaced some unlink()s with i_unlink*()s where we could. This
    changes some mail_index_set_error() calls to i_error()s, but because these
    unlink() failures don't actually fail the operation it doesn't matter. In
    fact it may be even better that it doesn't overwrite the existing
    index->error if it exists.


M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.c

2015-09-08 19:07:02 +0300 Timo Sirainen <tss@iki.fi> (46b823a)

    Replaced unlink() calls with i_unlink*() wherever possible.


M	src/auth/auth-token.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/lda/main.c
M	src/lib-compression/test-compression.c
M	src/lib-fs/fs-posix.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-master/mountpoint-list.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib/file-copy.c
M	src/lib/file-create-locked.c
M	src/lib/file-dotlock.c
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-temp.c
M	src/lib/istream-seekable.c
M	src/lib/net.c
M	src/lib/safe-mkstemp.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-ostream-file.c
M	src/lib/unlink-old-files.c
M	src/lmtp/commands.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-listen.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/mail-filter/mail-filter-plugin.c
M	src/plugins/quota/quota-maildir.c
M	src/ssl-params/ssl-params.c

2015-09-08 18:49:00 +0300 Timo Sirainen <tss@iki.fi> (8dc04cf)

    lib: Added i_unlink() and i_unlink_if_exists() These log the error message
    on a failed unlink(). They also include the source code file and line number
    to make it easier to find which unlink() actually failed if the path itself
    doesn't already clearly identify it. This can be especially useful if the
    path is (null), "" or contains some corrupted garbage.


M	src/lib/lib.c
M	src/lib/lib.h

2015-09-08 18:45:57 +0300 Timo Sirainen <tss@iki.fi> (b141539)

    lib-storage: Mailbox deletion shouldn't fail when trying to delete read-only
    attributes.


M	src/lib-storage/index/index-storage.c

2015-09-08 18:45:28 +0300 Timo Sirainen <tss@iki.fi> (5e09e28)

    lib-storage: Use MAIL_ERROR_NOTPOSSIBLE if mailbox_attribute_*set() fails
    for read-only attribute. MAIL_ERROR_PARAMS indicates that there was
    something wrong with the parameters itself. But the caller can't know (at
    least with current APIs) if it's a read-only attribute it's trying to change
    before actually doing it.


M	src/lib-storage/mailbox-attribute.c

2015-09-08 13:41:21 +0300 Timo Sirainen <tss@iki.fi> (1228d57)

    lib-storage: If mail_attribute_dict is set, ignore non-authority rank
    internal attributes. This way dsync can still sync things like Sieve
    scripts, but it doesn't attempt to sync anything that actually requires
    dict.


M	src/lib-storage/mailbox-attribute.c

2015-09-08 13:30:21 +0300 Stephan Bosch <stephan@rename-it.nl> (6fef776)

    example-config: 10-mail.conf: Added example configuration for the new
    settings relating to IMAP METADATA.


M	doc/example-config/conf.d/10-mail.conf
M	doc/example-config/conf.d/15-mailboxes.conf

2015-09-08 13:27:41 +0300 Stephan Bosch <stephan@rename-it.nl> (bb353b0)

    example-config: Added more detailed documentation for mailbox settings.


M	doc/example-config/conf.d/10-mail.conf
M	doc/example-config/conf.d/15-mailboxes.conf

2015-09-08 13:26:38 +0300 Stephan Bosch <stephan@rename-it.nl> (87b4215)

    lib: strnum: Fixed test suite failure on 32 bit systems.


M	src/lib/test-strnum.c

2015-09-08 13:18:58 +0300 Timo Sirainen <tss@iki.fi> (0e731a1)

    acl: Log which ACL groups are enabled with mail_debug=yes


M	src/plugins/acl/acl-backend.c

2015-09-08 13:07:59 +0300 Timo Sirainen <tss@iki.fi> (64d895b)

    lib-charset: Fixed assert-crash with some iconv() versions. Older glibc
    iconv() versions seem to skip over invalid characters, at least with some
    charsets, while newer versions don't. We were assuming that the skipping
    never happened, so if the invalid character was at the end of the string we
    could have wrapped size to (size_t)-1 and caused a crash later on.


M	src/lib-charset/charset-iconv.c
M	src/lib-charset/test-charset.c

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (186c198)

    imap: METADATA: Implemented mailbox and server comment entries and the
    server admin entry.


M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mailbox-attribute-internal.c
M	src/lib-storage/mailbox-attribute-internal.h

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (1b0c120)

    imap: Implemented /private/specialuse METADATA entry for SPECIAL-USE
    capability.


M	src/lib-storage/Makefile.am
A	src/lib-storage/mailbox-attribute-internal.c
A	src/lib-storage/mailbox-attribute-internal.h
M	src/lib-storage/mailbox-attribute.c

2015-09-08 01:27:18 +0300 Stephan Bosch <stephan@rename-it.nl> (4a272f5)

    lib: Added some tests for the new strnum _hex() and _oct() function
    variants.


M	src/lib/test-strnum.c

2015-09-08 01:20:51 +0300 Timo Sirainen <tss@iki.fi> (0348cf6)

    lib: Added assert to Solaris sendfile() return value.


M	src/lib/sendfile-util.c

2015-09-08 00:51:30 +0300 Timo Sirainen <tss@iki.fi> (738e548)

    doveadm: Fixed hiding titles' tabs with tab formatter (-h -f tab)


M	src/doveadm/doveadm-print-tab.c

2015-09-08 00:46:11 +0300 Timo Sirainen <tss@iki.fi> (25f959d)

    Make static analyzer happier.


M	src/config/config-request.c
M	src/lib-storage/mail-search-args-simplify.c

2015-09-08 00:34:14 +0300 Timo Sirainen <tss@iki.fi> (0139e1e)

    lib-charset: Added more asserts to checking iconv() results.


M	src/lib-charset/charset-iconv.c

2015-09-08 00:33:21 +0300 Timo Sirainen <tss@iki.fi> (f929165)

    lib-charset: Updated test-charset unit test to check for iconv() E2BIG
    result


M	src/lib-charset/test-charset.c

2015-09-08 00:07:55 +0300 Timo Sirainen <tss@iki.fi> (9dd7c6f)

    lib-storage: Mailbox list notifications didn't work for INBOX. Because of
    some earlier optimizations that changes to INBOX aren't written to
    dovecot.list.index.log file.


M	src/lib-storage/list/mailbox-list-index-notify.c

2015-09-07 23:55:31 +0300 Timo Sirainen <tss@iki.fi> (e27db67)

    Mailbox list notify API changed to return multiple events at once. This
    fixes some issues where a single event could actually trigger multiple
    different kinds of events.


M	src/imap/imap-notify.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/mailbox-list-notify.h

2015-09-07 23:08:44 +0300 Timo Sirainen <tss@iki.fi> (8868edd)

    imap: NOTIFY (SUBSCRIPTIONS) assert-crashed when subscriptions hadn't been
    refreshed.


M	src/imap/cmd-notify.c
M	src/imap/imap-notify.h

2015-09-07 22:35:30 +0300 Timo Sirainen <tss@iki.fi> (25fb397)

    Various passthrough istreams didn't preserve readable_fd.


M	src/lib-storage/index/istream-mail.c
M	src/lib/istream-failure-at.c
M	src/lib/istream-hash.c
M	src/lib/istream-timeout.c

2015-07-16 14:41:24 +0200 Sebastian Wiedenroth <sebastian.wiedenroth@skylime.net> (158e0bc)

    lib: Fix hang in safe_sendfile on SmartOS The call to sendfile on SmartOS
    can fail with EOPNOTSUPP. This is a valid error code and documented in the
    man page. This error code needs to be handled or else dovecot will retry the
    sendfile call endlessly and hang.


M	src/lib/sendfile-util.c

2015-09-07 22:14:18 +0300 Timo Sirainen <tss@iki.fi> (5bf4e28)

    imap: Fixed assert-crash in NOTIFY when using multiple namespaces. I'm not
    sure why the original code was trying to add it to multiple namespaces. A
    single mailbox name should be matching only a single namespace (visible one
    at least). In any case we can't use mail_namespace_find() with only partial
    namespaces-list, because it'll assert-crash if it can't find a namespace for
    the mailbox.


M	src/imap/cmd-notify.c

2015-09-07 22:06:16 +0300 Timo Sirainen <tss@iki.fi> (4439a17)

    lib-storage: Fixed assert-crash when reading binary streams.


M	src/lib-storage/index/index-mail-binary.c

2015-09-07 21:54:20 +0300 Timo Sirainen <tss@iki.fi> (fb61683)

    doveadm: Added new "auth login" command to simulate an actual client login.
    This performs both passdb and userdb lookups and prints their results.


M	src/doveadm/doveadm-auth.c

2015-09-07 21:24:01 +0300 Timo Sirainen <tss@iki.fi> (d1d0467)

    auth: If userdb lookup was found from auth cache, don't clear the earlier
    userdb fields.


M	src/auth/auth-request.c

2015-09-07 21:02:51 +0300 Timo Sirainen <tss@iki.fi> (2373c84)

    auth: If multiple userdbs are used, default_fields was ignored for all but
    the first one.


M	src/auth/auth-request.c

2015-09-07 20:24:25 +0300 Timo Sirainen <tss@iki.fi> (3e10cd4)

    director: Added director_user_kick_delay setting. This replaces the
    hardcoded 2 seconds delay. This setting specifies how long to wait for after
    user has been kicked from all directors before letting the user login to the
    new server. This timeout should be large enough that the user's existing
    processes in the old backend should be finished.


M	src/director/director-settings.c
M	src/director/director-settings.h
M	src/director/director.c

2015-09-07 18:50:24 +0300 Timo Sirainen <tss@iki.fi> (c9d6858)

    login proxy: Added delayed disconnection of clients on server
    mass-disconnect. login_proxy_max_disconnect_delay setting (default 0 =
    disabled) controls for how long time period the disconnections are spread
    to. The idea behind this is to avoid load spikes due to client reconnections
    when a backend server dies or is restarted.


M	src/login-common/login-proxy-state.h
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h

2015-09-07 17:10:19 +0300 Timo Sirainen <tss@iki.fi> (3a3f0bb)

    auth: Ignore first passdbs that contain skip=unauthenticated. They can never
    match anything.


M	src/auth/auth.c

2015-09-07 16:39:28 +0300 Timo Sirainen <tss@iki.fi> (3c7dbe9)

    lib-storage: Added mailbox_attribute_register_internals() Just for making it
    easier to register multiple attributes.


M	src/lib-storage/mailbox-attribute.c
M	src/lib-storage/mailbox-attribute.h

2015-09-07 16:23:40 +0300 Timo Sirainen <tss@iki.fi> (e8f12bf)

    lib-storage: Allow MAIL_ATTRIBUTE_INTERNAL_RANK_DEFAULT to use get=NULL This
    is useful for registering internal attributes whose only purpose is to be
    able to set/get them via dict. (Because normally the dict access would be
    denied completely.)


M	src/lib-storage/mailbox-attribute.c

2015-09-07 16:22:11 +0300 Timo Sirainen <tss@iki.fi> (ab52699)

    lib-storage: Allow set/get for Dovecot-private attributes via internal
    attributes. This allows registering attributes with
    MAILBOX_ATTRIBUTE_PREFIX_DOVECOT_PVT prefix and having them be get/set via
    dict, instead of failing them.


M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mailbox-attribute.c

2015-09-07 16:38:24 +0300 Timo Sirainen <tss@iki.fi> (72baffa)

    lib-storage: Added MAIL_ATTRIBUTE_INTERNAL_FLAG_CHILDREN This also adds the
    key to get() and set() functions, so they can know exactly what key is
    wanted to be accessed.


M	src/lib-storage/mailbox-attribute.c
M	src/lib-storage/mailbox-attribute.h

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (bf79967)

    mail-storage: Added registration API for builtin mailbox attributes.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-attribute-private.h
M	src/lib-storage/mailbox-attribute.c
M	src/lib-storage/mailbox-attribute.h

2015-09-07 15:07:55 +0300 Timo Sirainen <tss@iki.fi> (326c86b)

    lib-storage: mail_user_init() wasn't always expanding %h correctly to
    settings. This mainly affected users autocreated for accessing shared
    mailboxes.


M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2015-09-07 15:06:40 +0300 Timo Sirainen <tss@iki.fi> (69e0311)

    lib-storage: Updated MAILBOX_ATTRIBUTE_KEY_IS_USER_ACCESSIBLE() to not allow
    private server attributes.


M	src/lib-storage/mailbox-attribute.h

2015-09-07 14:16:39 +0300 Timo Sirainen <tss@iki.fi> (ffe2ea0)

    dovecot.m4: Added LIBDOVECOT_ACL_INCLUDE


M	dovecot-config.in.in
M	dovecot.m4

2015-09-07 14:08:52 +0300 Timo Sirainen <tss@iki.fi> (8affeb8)

    auth: Fixed passdb skip_password_check / result_success=continue-fail
    handling If passdb returned success, but result_success=continue-fail, it
    means that the authentication didn't succeed. So we still want to check the
    password again and in general treat the request as unauthenticated
    (especially for the passdb { skip } setting).

    So the current logic means that there are 2 ways for the request to be 
    treated as authenticated and skipping any password checking:

    1) passdb lookup succeeding, with result_success=continue, continue-ok, 
    return or return-ok

    2) passdb lookup not succeeding, with result_failure=continue-ok or 
    return-ok

    It's a bit questionable though if 2) should be allowed.

M	src/auth/auth-request.c

2015-09-07 13:40:41 +0300 Timo Sirainen <tss@iki.fi> (c07fb22)

    imap: Don't allow IMAP METADATA to access Dovecot's private server
    attributes.


M	src/lib-imap-storage/imap-metadata.c

2015-09-07 11:40:08 +0300 Timo Sirainen <tss@iki.fi> (1310fa4)

    auth: Aborting auth request didn't abort a pending proxy DNS lookup.


M	src/auth/auth-request.c

2015-09-06 22:28:07 +0300 Timo Sirainen <tss@iki.fi> (691f802)

    lib-storage: Store pointer to mail_storage_service_user to mail_user if it
    exists.


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2015-09-06 22:27:29 +0300 Timo Sirainen <tss@iki.fi> (95dcc0f)

    lib-storage: Added mail_storage_service_user_get_service_ctx()


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2015-09-04 13:00:25 +0300 Timo Sirainen <tss@iki.fi> (7b31f9f)

    acl: Install most of the header files.


M	src/plugins/acl/Makefile.am

2015-09-04 13:00:14 +0300 Timo Sirainen <tss@iki.fi> (1f6186d)

    acl: acl_object_list_next() should return -1 if acl refreshing failed
    earlier.


M	src/plugins/acl/acl-api.c

2015-09-04 11:21:39 +0300 Timo Sirainen <tss@iki.fi> (8376616)

    dsync: If remote disconnects, log the last sent/recv state.


M	src/doveadm/dsync/dsync-ibc-stream.c

2015-09-04 11:17:30 +0300 Timo Sirainen <tss@iki.fi> (0443351)

    dsync: If we disconnect with I/O timeout, log the last sent/recv state.


M	src/doveadm/dsync/dsync-ibc-stream.c

2015-09-04 01:23:28 +0300 Timo Sirainen <tss@iki.fi> (d87f5ce)

    login proxy: Code cleanup - separate login_proxy_free_final()


M	src/login-common/login-proxy.c

2015-09-04 01:21:28 +0300 Timo Sirainen <tss@iki.fi> (772f054)

    login proxy: Always keep proxy->state_rec available.


M	src/login-common/login-proxy.c

2015-09-04 01:18:04 +0300 Timo Sirainen <tss@iki.fi> (623eaaf)

    login proxy: Added asserts to track that num_waiting_connections are
    correct.


M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c

2015-09-04 01:10:29 +0300 Timo Sirainen <tss@iki.fi> (40f7b31)

    login proxy: Small code cleanup


M	src/login-common/login-proxy.c

2015-09-03 22:12:14 +0300 Timo Sirainen <tss@iki.fi> (57c5e11)

    dsync: Assert-crashfix Fixes:

    Panic: file mail-storage.c: line 1897 (mailbox_save_alloc): assertion 
    failed: (!ctx->unfinished)

M	src/doveadm/dsync/dsync-mailbox-import.c

2015-09-03 21:37:09 +0300 Timo Sirainen <tss@iki.fi> (1fb5e50)

    cassandra: Handle async queries internally - don't use sql pooling code.
    There's no need to create multiple Cassandra instances, since the single
    instance is capable of doing multiple asynchronous requests in parallel.


M	src/lib-sql/driver-cassandra.c

2015-09-03 20:55:18 +0300 Timo Sirainen <tss@iki.fi> (9a02f48)

    lib-storage: Another fix to using index_storage_mailbox_close() without an
    opened view. Calling mail_index_close() without mail_index_open() caused it
    to assert-crash.


M	src/lib-storage/index/index-storage.c

2015-09-03 20:54:27 +0300 Timo Sirainen <tss@iki.fi> (ac00e30)

    dict: Various reference counting and other fixes related to using freed
    memory.


M	src/dict/dict-commands.c
M	src/dict/dict-commands.h
M	src/dict/dict-connection.c
M	src/dict/dict-connection.h

2015-09-03 19:59:16 +0300 Timo Sirainen <tss@iki.fi> (d206a49)

    dsync: Crashfix in certain situation.


M	src/doveadm/dsync/dsync-mailbox-import.c

2015-09-03 19:58:39 +0300 Timo Sirainen <tss@iki.fi> (40feca9)

    lib-storage: Allow index_storage_mailbox_close() to be called without an
    opened view. Some failing mailbox_open() call may leave it in such a state.


M	src/lib-storage/index/index-storage.c

2015-09-03 16:04:26 +0300 Timo Sirainen <tss@iki.fi> (a4502a7)

    doveadm director update command added. The difference to "doveadm director
    add" is that if the IP doesn't already exist, it's not added.


M	src/director/doveadm-connection.c
M	src/doveadm/doveadm-director.c

2015-09-03 14:10:36 +0300 Timo Sirainen <tss@iki.fi> (3ba70a3)

    Removed SET_IN_PORT_ZERO - SET_IN_PORT now always allows zeros as well. A
    zero in all the port settings means that the port is disabled, which is also
    the default. So it shouldn't be an error to explicitly set it to zero in the
    config file.


M	src/config/config-request.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings-parser.h
M	src/master/master-settings.c
M	src/replication/aggregator/aggregator-settings.c

2015-09-03 14:01:57 +0300 Phil Carmody <phil@dovecot.fi> (d5c4431)

    lib: strnum - simplify hex and oct overflow code uintmax_t is defined to
    have modulo-2^n semantics, and therefore the bottom bits of (uintmax_t) are
    guaranteed to be all set. Therefore the checking of the next character read
    is unnecessary, as it's already done in the loop control statement itself.
    (This is not true about the bottom digit base 10, which is why the check
    remains in the decimal case)

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/strnum.c

2015-08-31 22:31:19 +0000 Pascal Volk <user@localhost.localdomain.org> (7be9203)

    man: doveadm-sync.1: Added description for option `-T secs'.


M	doc/man/doveadm-sync.1.in

2015-09-02 20:30:07 +0300 Timo Sirainen <tss@iki.fi> (84b2c45)

    dict-sql: Fixed iteration with blob fields.


M	src/lib-dict/dict-sql.c

2015-09-02 19:46:36 +0300 Timo Sirainen <tss@iki.fi> (ac1e5c2)

    dict-sql: Implemented support for binary fields. Example:

    map {
     pattern = shared/blobtest/$key
     table = blobtest
     value_field = value
     value_hexblob = yes

      fields {
       key = ${hexblob:key}
     }
    }

    Now you can access both field and value as hex data. For example:

    doveadm dict set proxy::sqldict shared/blobtest/746573746b6579
    7465737476616c7565

    This adds "testkey" and "testvalue" to key and value fields blobs.

M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql-settings.h
M	src/lib-dict/dict-sql.c

2015-09-02 19:43:26 +0300 Timo Sirainen <tss@iki.fi> (b87761f)

    lib-sql: Implemented sql_escape_blob()


M	src/lib-sql/driver-cassandra.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api-private.h
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-api.h

2015-09-02 19:42:45 +0300 Timo Sirainen <tss@iki.fi> (61f39b0)

    cassandra: Implemented support for binary values.


M	src/lib-sql/driver-cassandra.c

2015-09-02 19:41:23 +0300 Timo Sirainen <tss@iki.fi> (efa1a91)

    doveadm dict iter: Added -V parameter to return only keys.


M	src/doveadm/doveadm-dict.c

2015-09-02 19:38:35 +0300 Timo Sirainen <tss@iki.fi> (ce06a50)

    dict-sql: Fixed iteration with DICT_ITERATE_FLAG_NO_VALUE


M	src/lib-dict/dict-sql.c

2015-09-02 18:42:01 +0300 Timo Sirainen <tss@iki.fi> (02a0277)

    dict-client: Prefix relative socket paths with base_dir.


M	src/lib-dict/dict-client.c

2015-09-02 17:51:23 +0300 Timo Sirainen <tss@iki.fi> (30d7635)

    dict: Added dict-async service. This allows running separate dict processes
    with separate settings for async and non-async backends.


M	src/dict/dict-settings.c

2015-09-02 17:37:16 +0300 Timo Sirainen <tss@iki.fi> (fa04cb1)

    dict-sql: Added support for async operations.


M	src/lib-dict/dict-sql.c

2015-09-02 17:36:47 +0300 Timo Sirainen <tss@iki.fi> (1a88371)

    dict: Use the new async APIs for everything. If the dict backend supports
    async operations, this means that dict service can now be configured with
    client_count>1.


M	src/dict/dict-commands.c
M	src/dict/dict-commands.h
M	src/dict/dict-connection.c
M	src/dict/dict-connection.h

2015-09-02 17:34:43 +0300 Timo Sirainen <tss@iki.fi> (d694b60)

    lib-dict: Added async API for lookup and iteration.


M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-fs.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h

2015-09-02 17:28:41 +0300 Timo Sirainen <tss@iki.fi> (32afa83)

    dict-sql: Code cleanup - added sql_dict_transaction_has_nonexistent()


M	src/lib-dict/dict-sql.c

2015-09-02 17:27:09 +0300 Timo Sirainen <tss@iki.fi> (dce02dc)

    dict-sql: Code cleanup - use a common sql_dict_transaction_free()


M	src/lib-dict/dict-sql.c

2015-09-02 17:26:08 +0300 Timo Sirainen <tss@iki.fi> (1f97851)

    dict-sql: Fixed memory leak when committing/rollbacking unchanged
    transaction.


M	src/lib-dict/dict-sql.c

2015-09-02 17:23:45 +0300 Timo Sirainen <tss@iki.fi> (743d400)

    dict-sql: Code cleanup - separated SQL query building function from sending
    it.


M	src/lib-dict/dict-sql.c

2015-09-02 17:21:06 +0300 Timo Sirainen <tss@iki.fi> (c02488b)

    lib-dict: Code cleanup - give name for enum dict_protocol_cmd/reply


M	src/lib-dict/dict-client.h

2015-09-02 17:20:02 +0300 Timo Sirainen <tss@iki.fi> (a916985)

    lib-sql: Mark Cassandra driver as pooled. Otherwise all the asynchronous
    operations will assert-crash, since all the auto-connecting code is in the
    sqlpool code.


M	src/lib-sql/driver-cassandra.c

2015-09-02 17:19:08 +0300 Timo Sirainen <tss@iki.fi> (1856c36)

    lib-sql: Debugging help - Added assert before clearing sql_result.callback.
    If result is unrefed too many times, this still allows accessing the
    callback from a debugger.


M	src/lib-sql/driver-cassandra.c
M	src/lib-sql/driver-pgsql.c

2015-09-02 17:16:41 +0300 Timo Sirainen <tss@iki.fi> (b457d2e)

    lib-sql: sql_result.free() should never be reached from the query callback.
    This code was probably added before sql_result refcounting.


M	src/lib-sql/driver-cassandra.c
M	src/lib-sql/driver-pgsql.c

2015-09-01 16:25:11 +0300 Timo Sirainen <tss@iki.fi> (f5d5b8a)

    lib-imap-client: If connect() fails immediately, log an error and retry the
    next IP. Only if all IPs fail return a full failure. This is mainly intended
    to skip IPv6 addresses when IPv6 connectivity doesn't work.


M	src/lib-imap-client/imapc-connection.c

2015-09-01 00:11:37 +0300 Timo Sirainen <tss@iki.fi> (ecc0126)

    auth: Added ":protected" suffix to passdb and userdb field names. This means
    that if the field is set only if it hasn't already been set. Usually an
    earlier passdb/userdb would have set the field and this is setting a default
    (e.g. per-user settings override per-domain settings).


M	src/auth/auth-request.c

2015-08-31 23:54:24 +0300 Timo Sirainen <tss@iki.fi> (6c0d8dc)

    lib-fs: Added "dict" backend, which is a wrapper to using lib-dict.


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
A	src/lib-fs/fs-dict.c

2015-08-31 23:46:05 +0300 Timo Sirainen <tss@iki.fi> (2bc963e)

    imap-hibernate: Use sockets' st_dev and st_ino to verify that the passed fd
    is correct.


M	src/imap-hibernate/imap-client.c
M	src/imap-hibernate/imap-client.h
M	src/imap-hibernate/imap-hibernate-client.c
M	src/imap/imap-client-hibernate.c
M	src/imap/imap-master-client.c

2015-08-31 23:25:12 +0300 Timo Sirainen <tss@iki.fi> (fa2e547)

    lib: Added str_to_ino()


M	src/lib/strnum.c
M	src/lib/strnum.h

2015-08-31 23:11:17 +0300 Timo Sirainen <tss@iki.fi> (11ea98b)

    imap: NOTIFY SET STATUS didn't send HIGHESTMODSEQ in STATUS reponses when
    needed.


M	src/imap/cmd-notify.c

2015-08-31 22:45:17 +0300 Timo Sirainen <tss@iki.fi> (ce0d9d3)

    *-login: mail_max_userip_connections=0 was broken by f8ab4f979e92


M	src/login-common/sasl-server.c

2015-08-31 22:25:57 +0300 Timo Sirainen <tss@iki.fi> (6ea145a)

    cassandra: Changed default consistency levels to local-quorum. It is a much
    safer default than "one".


M	src/lib-sql/driver-cassandra.c

2015-08-31 21:31:46 +0300 Timo Sirainen <tss@iki.fi> (ce74395)

    cassandra: Split consistency setting to read_consistency and
    write_consistency.


M	src/lib-sql/driver-cassandra.c

2015-08-31 20:23:32 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (87af299)

    lib-fts: Add missing "j'" to French contractions.


M	src/lib-fts/fts-filter-contractions.c
M	src/lib-fts/test-fts-filter.c

2015-08-31 14:24:54 +0300 Stephan Bosch <stephan@rename-it.nl> (0004409)

    Earlier in_port_t fix was ineffective due to one small detail. The new
    SET_IN_PORT_ZERO did not actually use the new net_str2port_zero() function.


M	src/lib-settings/settings-parser.c

2015-08-31 13:33:26 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (c8eaee2)

    lib-fts: Add UTF-8 unit test for lowercase filter.


M	src/lib-fts/test-fts-filter.c

2015-08-31 13:33:26 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (440b625)

    lib-fts: Add prefixing contraction filter. Filters away prefixing contracted
    words, e.g. "l'homme" -> "homme". Tokens to be filtered must be lower case.
    Only supports French in this initial version.


M	src/lib-fts/Makefile.am
A	src/lib-fts/fts-filter-contractions.c
M	src/lib-fts/fts-filter-private.h
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h
M	src/lib-fts/test-fts-filter.c

2015-08-30 01:00:30 +0300 Timo Sirainen <tss@iki.fi> (4d81149)

    aggregator: Allow replicator_port=0 setting (fix to previous in_port_t
    changes)


M	src/replication/aggregator/aggregator-settings.c

2015-08-30 00:46:32 +0300 Stephan Bosch <stephan@rename-it.nl> (8429654)

    Earlier in_port_t fix created problems with service listener configuration.
    Listeners are disabled with port=0, which was not allowed anymore.


M	src/config/config-request.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings-parser.h
M	src/lib/net.c
M	src/lib/net.h
M	src/master/master-settings.c

2015-08-30 00:42:16 +0300 Timo Sirainen <tss@iki.fi> (08c518f)

    lib-master: Compiler warning fix


M	src/lib-master/master-service.c

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (ede7507)

    http-client: Added support for using an HTTP proxy running on a unix socket.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2015-08-29 14:42:49 +0300 Stephan Bosch <stephan@rename-it.nl> (e48f289)

    Removed all invocations of strtoll() and friends.


M	configure.ac
M	src/anvil/anvil-connection.c
M	src/auth/checkpassword-reply.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/lib-dict/dict-file.c
M	src/lib-fs/fs-posix.c
M	src/lib-otp/otp-parse.c
M	src/lib-settings/settings-parser.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib/compat.c
M	src/lib/compat.h
M	src/lib/rand.c
M	src/lib/var-expand.c
M	src/log/log-connection.c
M	src/login-common/sasl-server.c
M	src/master/main.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-util.c
M	src/util/maildirlock.c

2015-08-29 14:31:51 +0300 Stephan Bosch <stephan@rename-it.nl> (7b58c08)

    strnum: Implemented many more numeric string parsing functions. Created
    macros for most of the implementation to avoid further code duplication.


M	src/lib/strnum.c
M	src/lib/strnum.h

2015-08-29 14:30:37 +0300 Stephan Bosch <stephan@rename-it.nl> (c93aca8)

    Removed all invocations of atoi().


M	src/auth/db-ldap.c
M	src/auth/mech-digest-md5.c
M	src/auth/passdb-blocking.c
M	src/dict/dict-connection.c
M	src/director/director-connection.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-who.c
M	src/imap-login/client.c
M	src/lib-dict/dict.h
M	src/lib-master/master-service.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-storage/mail-storage-service.c
M	src/lmtp/commands.c
M	src/login-common/client-common-auth.c
M	src/master/main.c
M	src/util/script.c

2015-08-29 14:26:30 +0300 Stephan Bosch <stephan@rename-it.nl> (009217a)

    Changed type of internet port values to in_port_t everywhere. Created
    special SET_IN_PORT setting type for internet port values. Created
    net_str2port() for parsing internet port values. Removed several atoi()
    invocations in the process.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/passdb-imap.c
M	src/config/config-request.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-host.h
M	src/director/director-settings.c
M	src/director/director-settings.h
M	src/director/director-test.c
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/main.c
M	src/doveadm/client-connection.h
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-util.h
M	src/doveadm/doveadm-zlib.c
M	src/doveadm/server-connection.c
M	src/imap-hibernate/imap-client.h
M	src/imap-hibernate/imap-hibernate-client.c
M	src/imap-login/client.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.h
M	src/imap/imap-client-hibernate.c
M	src/imap/imap-master-client.c
M	src/imap/imap-settings.c
M	src/imap/imap-settings.h
M	src/lib-auth/auth-client.h
M	src/lib-auth/auth-master.h
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-server-connection.c
M	src/lib-http/test-http-server.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-urlauth/imap-urlauth-private.h
M	src/lib-imap-urlauth/imap-urlauth.h
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h
M	src/lib-lda/smtp-client.c
M	src/lib-master/master-service-haproxy.c
M	src/lib-master/master-service.h
M	src/lib-master/service-settings.h
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings-parser.h
M	src/lib-sql/driver-mysql.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/pop3c/pop3c-client.h
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-settings.h
M	src/lib-storage/mail-storage-service.h
M	src/lib/connection.c
M	src/lib/connection.h
M	src/lib/fd-close-on-exec.c
M	src/lib/iostream-rawlog.c
M	src/lib/net.c
M	src/lib/net.h
M	src/lib/uri-util.c
M	src/lmtp/client.h
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.h
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h
M	src/login-common/login-common.h
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy-state.h
M	src/login-common/login-proxy.c
M	src/login-common/login-proxy.h
M	src/master/master-settings.c
M	src/master/service-listen.c
M	src/master/service.c
M	src/pop3-login/client.c
M	src/replication/aggregator/aggregator-settings.c
M	src/replication/aggregator/aggregator-settings.h
M	src/replication/aggregator/replicator-connection.c
M	src/replication/aggregator/replicator-connection.h

2015-08-29 14:21:27 +0300 Stephan Bosch <stephan@rename-it.nl> (b116c06)

    ioloop-epoll: Fix fatal epoll_wait() error occurring when there are only ios
    with no fd.


M	src/lib/ioloop-epoll.c

2015-08-29 14:20:57 +0300 Stephan Bosch <stephan@rename-it.nl> (62812c6)

    lib-http: client: Added proper handling of 408 response status. This is
    treated as a special server connection close event, rather than a response
    to the last issued request.


M	src/lib-http/http-client-connection.c

2015-08-28 15:44:34 +0200 Timo Sirainen <tss@iki.fi> (2315267)

    lib-storage: Added %{userdb:*} expansion to mail settings.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2015-08-28 15:43:45 +0200 Timo Sirainen <tss@iki.fi> (fd39949)

    lib-settings: Added settings_var_expand_with_funcs()


M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings-parser.h

2015-08-28 15:07:35 +0200 Timo Sirainen <tss@iki.fi> (654b460)

    lib: If var_expand_with_funcs() function returns NULL, it should be treated
    the same as "" The previous behavior was to return "%{foo:bar}" as
    "foo:bar}".


M	src/lib/test-var-expand.c
M	src/lib/var-expand.c

2015-08-28 14:43:35 +0200 Timo Sirainen <tss@iki.fi> (2dfd08e)

    *-login: Added %{passdb:*} fields to login_log_format_elements


M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2015-08-27 18:39:58 +0200 Timo Sirainen <tss@iki.fi> (89f9c7b)

    doveadm fs delete: Support giving multiple filename parameters.


M	src/doveadm/doveadm-fs.c

2015-08-27 17:38:12 +0200 Timo Sirainen <tss@iki.fi> (414b2d3)

    dsync: Include mailboxes' full path in debug messages.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2015-08-27 17:35:17 +0200 Timo Sirainen <tss@iki.fi> (d1d6887)

    imapc: Don't crash with mailbox_list_index=yes


M	src/lib-storage/list/mailbox-list-index.c

2015-08-27 17:34:52 +0200 Timo Sirainen <tss@iki.fi> (9b3565b)

    lib: Try fixing ec6e672a6e32 (ioloop timeout fixing) Previous code was
    broken at least when moving a timeout between ioloops. This is now tested
    and works.


M	src/lib/Makefile.am
M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
M	src/lib/test-ioloop.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2015-08-27 15:46:23 +0200 Timo Sirainen <tss@iki.fi> (36f8309)

    dsync: Fixed running with tcp/tcps destination.


M	src/doveadm/doveadm-dsync.c

2015-08-27 15:28:21 +0200 Timo Sirainen <tss@iki.fi> (66e5a5a)

    dsync: Fixed another crash with recent end-of-list changes.


M	src/doveadm/dsync/dsync-brain-mails.c

2015-08-27 15:07:35 +0200 Timo Sirainen <tss@iki.fi> (9c0c600)

    Reverted ec6e672a6e32 for now due to some bugs.


M	src/lib/Makefile.am
M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2015-08-27 13:38:44 +0200 Timo Sirainen <tss@iki.fi> (1a1d00f)

    dsync: Added -D parameter to disable mailbox renaming. The renaming logic is
    annoyingly complex and there are some bugs left in it. With this parameter
    renames are never even attempted, but instead a rename would be done
    (slowly) with mailbox delete + create + fill.

    Although with imapc protocol mailbox renames are rarely detected anyway.

M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2015-08-27 12:33:47 +0200 Timo Sirainen <tss@iki.fi> (8c2c9a8)

    dsync: Fixed again waiting for remote process wait to die. We can't rely on
    stderr getting closed. It doesn't happen if the remote process crashes. Now
    waiting for SIGCHLD in ioloop should solve this and still log all the error
    messages at exit.


M	src/doveadm/doveadm-dsync.c

2015-08-27 10:39:26 +0200 Stephan Bosch <stephan@rename-it.nl> (72a7c4f)

    ioloop: Delay actual start of a new normal timeout until the next
    io_loop_run() cycle. This makes sure that timeouts will not expire before
    they get a chance to run.


M	src/lib/Makefile.am
M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
A	src/lib/test-ioloop.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2015-08-26 17:00:55 +0200 Timo Sirainen <tss@iki.fi> (ae9b70a)

    imapc: Fixed handling escape-char The current code should now handle all
    kinds of mailbox names correctly, including:

    ~/foo
    %7e/bar

M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c

2015-08-26 16:59:47 +0200 Timo Sirainen <tss@iki.fi> (d3e5a14)

    lib-storage: mailbox_list_[un]escape_name() can now be called globally


M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2015-08-26 16:59:07 +0200 Timo Sirainen <tss@iki.fi> (33409f3)

    dsync: Earlier end-of-list change broke single-process dsync.


M	src/doveadm/dsync/dsync-brain-mails.c

2015-08-26 15:44:45 +0200 Timo Sirainen <tss@iki.fi> (c892c8b)

    dsync: Make sure we print all the stderr output from remote processes at
    deinit. Earlier the final messages may have been lost, especially if debug
    logging was enabled.


M	src/doveadm/doveadm-dsync.c

2015-08-26 15:19:27 +0200 Timo Sirainen <tss@iki.fi> (1ff3418)

    dsync: Added -T parameter to specify the I/O stall timeout.


M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h

2015-08-26 15:05:06 +0200 Timo Sirainen <tss@iki.fi> (7abb6c8)

    dsync: If mailbox export deinit failed, the failure state may not have
    reached mailbox importer. The "end of list" was sent to the importer side
    dsync before export noticed the failure. This could have caused import to
    complain about missing mails.


M	src/doveadm/dsync/dsync-brain-mails.c

2015-08-26 13:38:52 +0200 Timo Sirainen <tss@iki.fi> (189f639)

    dsync: Added assert to make sure end-of-list isn't sent when brain has
    already failed.


M	src/doveadm/dsync/dsync-brain-mails.c

2015-08-25 23:20:49 +0300 Timo Sirainen <tss@iki.fi> (83228b3)

    imap: If mailbox state couldn't be exported for hibernation, log also the
    mailbox name.


M	src/imap/imap-client-hibernate.c

2015-08-25 23:12:51 +0300 Timo Sirainen <tss@iki.fi> (c12d96f)

    login_log_format_elements: Added %{listener} variable to expand to the
    listener socket name.


M	src/login-common/client-common.c
M	src/login-common/client-common.h

2015-08-25 22:39:16 +0300 Timo Sirainen <tss@iki.fi> (e64b363)

    example-config: Updated mail_attribute_dict comment


M	doc/example-config/conf.d/10-mail.conf

2015-08-25 18:32:23 +0300 Timo Sirainen <tss@iki.fi> (f3fa33b)

    imap: Fail silently if selected mailbox format doesn't support GUIDs.


M	src/imap/imap-state.c

2015-08-25 18:27:44 +0300 Timo Sirainen <tss@iki.fi> (b4318af)

    imap: Fixed hibernation to work with non-TCP connections. Mainly meaning
    UNIX socket connections from login processes, which are proxying TLS
    connections.


M	src/imap/imap-client-hibernate.c

2015-08-25 17:03:19 +0300 Timo Sirainen <tss@iki.fi> (03435aa)

    lib-http: Added more debug logging. Patch by Stephan Bosch.


M	src/lib-http/http-client-peer.c

2015-08-25 16:57:57 +0300 Timo Sirainen <tss@iki.fi> (639ba5f)

    lib-imap-client: Allow reconnecting to IMAP server even if there had been no
    idle moments.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2015-08-25 16:55:00 +0300 Timo Sirainen <tss@iki.fi> (1e95710)

    lib-imap-client: Removed unused pending_box_command_count


M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-connection.c

2015-08-25 16:50:17 +0300 Timo Sirainen <tss@iki.fi> (14fd61e)

    imapc: If FETCH commands fail, have imapc_mail_fetch() always return
    failure. Earlier it may have returned success and imapc would later complain
    about a missing FETCH field.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.h

2015-08-25 01:07:04 +0300 Timo Sirainen <tss@iki.fi> (a350c75)

    lib: Fixed io_loop_extract_notify_fd() to compile with kqueue.


M	src/lib/ioloop-notify-kqueue.c

2015-08-24 18:06:42 +0300 Timo Sirainen <tss@iki.fi> (13f4d4d)

    lib-master: struct master_service_connection.name must never be NULL, use ""
    instead. Fixes crash at least in auth process when there are inet_listeners
    without names.


M	src/lib-master/master-service.c

2015-08-24 15:33:36 +0300 Timo Sirainen <tss@iki.fi> (472f3cb)

    dsync: Compiler warning fix to previous change.


M	src/doveadm/dsync/dsync-mailbox-import.c

2015-08-24 14:59:52 +0300 Timo Sirainen <tss@iki.fi> (eb72996)

    dsync: Fixed memory leaks when importing attributes whose values were in
    istreams.


M	src/doveadm/dsync/dsync-mailbox-import.c

2015-08-24 14:40:11 +0300 Timo Sirainen <tss@iki.fi> (f43b035)

    doveadm backup: Fixed assert-crash due to duplicate 'R' in getopt args.


M	src/doveadm/doveadm-dsync.c

2015-08-24 14:32:52 +0300 Timo Sirainen <tss@iki.fi> (8b9a69e)

    imap: Compiler warning fix to imap-hibernate commit


M	src/imap/imap-state.c

2015-08-24 14:13:02 +0300 Timo Sirainen <tss@iki.fi> (5ef28f6)

    Added imap-hibernate process for gathering IDLEing imap processes.
    imap_hibernate_timeout setting controls how quickly the connection is moved
    from imap process to imap-hibernate process.

    Some IMAP extensions like NOTIFY, SEARCH=CONTEXT and COMPRESS aren't 
    supported yet.

    There's also a new X-STATE command, which can be used to export the current 
    IMAP connection state to a string and later on imported to get back to the 
    original state (a quick resync feature for IMAP clients). However, this 
    command is disabled for now due to the current code being unoptimized for 
    untrusted input.

M	.hgignore
M	configure.ac
M	src/Makefile.am
A	src/imap-hibernate/Makefile.am
A	src/imap-hibernate/imap-client.c
A	src/imap-hibernate/imap-client.h
A	src/imap-hibernate/imap-hibernate-client.c
A	src/imap-hibernate/imap-hibernate-client.h
A	src/imap-hibernate/imap-hibernate-settings.c
A	src/imap-hibernate/imap-master-connection.c
A	src/imap-hibernate/imap-master-connection.h
A	src/imap-hibernate/main.c
M	src/imap/Makefile.am
M	src/imap/cmd-idle.c
A	src/imap/cmd-x-state.c
A	src/imap/imap-client-hibernate.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c
M	src/imap/imap-commands.h
M	src/imap/imap-common.h
A	src/imap/imap-master-client.c
A	src/imap/imap-master-client.h
M	src/imap/imap-settings.c
M	src/imap/imap-settings.h
A	src/imap/imap-state.c
A	src/imap/imap-state.h
M	src/imap/main.c
M	src/lib-storage/mail-user.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c

2015-08-24 14:14:59 +0300 Timo Sirainen <tss@iki.fi> (179d6df)

    lib-storage: Added mailbox_watch_extract_notify_fd()


M	src/lib-storage/mailbox-watch.c
M	src/lib-storage/mailbox-watch.h

2015-08-24 14:02:52 +0300 Timo Sirainen <tss@iki.fi> (dad206f)

    lib: Added io_loop_extract_notify_fd()


M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-kqueue.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop.h

2015-08-24 14:01:04 +0300 Timo Sirainen <tss@iki.fi> (b2fa9f1)

    lib-storage: Added mailbox_recent_flags_set_uid_forced() This allows adding
    recent flags to mails whose UID is lower than the existing recent mails.


M	src/lib-storage/mailbox-recent-flags.c
M	src/lib-storage/mailbox-recent-flags.h

2015-08-24 13:57:03 +0300 Timo Sirainen <tss@iki.fi> (192488b)

    lib-storage: mail_storage_service_user_free() needs to update log prefix if
    current user is freed.


M	src/lib-storage/mail-storage-service.c

2015-08-24 12:56:07 +0300 Timo Sirainen <tss@iki.fi> (872876c)

    lib-storage: mail_user_var_expand_table() may not have returned
    %{auth_username} correctly


M	src/lib-storage/mail-user.c

2015-08-24 12:14:40 +0300 Timo Sirainen <tss@iki.fi> (c5f9329)

    Use io_stream_get_disconnect_reason() instead of duplicating its code all
    over the place.


M	src/imap/imap-client.c
M	src/lib/connection.c
M	src/lmtp/client.c
M	src/login-common/client-common-auth.c
M	src/pop3/pop3-client.c

2015-08-24 12:10:08 +0300 Timo Sirainen <tss@iki.fi> (b554101)

    lib: Added io_stream_get_disconnect_reason() to iostream.h


M	src/lib/Makefile.am
M	src/lib/iostream-private.h
M	src/lib/iostream.c
A	src/lib/iostream.h

2015-08-24 12:04:55 +0300 Timo Sirainen <tss@iki.fi> (8d54ab9)

    lib: connection_disconnect_reason() now returns the full iostream error
    string.


M	src/lib/connection.c

2015-08-20 16:04:48 +0300 Timo Sirainen <tss@iki.fi> (ef81877)

    imap: Fixed memory leak in SELECT QRESYNC error handling path.


M	src/imap/cmd-select.c

2015-08-19 21:41:55 +0300 Timo Sirainen <tss@iki.fi> (695332d)

    imap: Code cleanup Keep client_add_input() functionality separate from
    client_create_from_input(). Also this way temporary buffer doesn't need to
    be created to add the input in login_client_connected().


M	src/imap/main.c

2015-08-19 21:31:56 +0300 Timo Sirainen <tss@iki.fi> (fefe9af)

    lib: Log notify IO leaks when ioloop is destroyed.


M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-kqueue.c

2015-08-19 21:24:50 +0300 Timo Sirainen <tss@iki.fi> (f684510)

    lib: io_add_notify() wasn't setting struct io.source_linenum


M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-kqueue.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop.h

2015-08-19 20:49:12 +0300 Timo Sirainen <tss@iki.fi> (495a74c)

    imap: If command has no imap_parser, don't crash when freeing the command.
    All the current commands have a parser though, so this doesn't actually fix
    anything.


M	src/imap/imap-client.c

2015-08-19 16:50:10 +0300 Timo Sirainen <tss@iki.fi> (85e2264)

    lib: inotify doesn't need to watch for IN_CLOSE This doesn't indicate that
    the file was modified. We don't care if some reader accessed a watched file.


M	src/lib/ioloop-notify-inotify.c

2015-08-19 15:12:09 +0300 Timo Sirainen <tss@iki.fi> (7e2671b)

    lib-storage: Moved index/index-mailbox-check.c code to mailbox-watch.c This
    changes the API, but adds backwards compatibility macros.


M	src/lib-storage/Makefile.am
M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/mail-storage-private.h
R051	src/lib-storage/index/index-mailbox-check.c	src/lib-storage/mailbox-watch.c
A	src/lib-storage/mailbox-watch.h

2015-08-19 14:47:51 +0300 Timo Sirainen <tss@iki.fi> (88e52b9)

    Removed support for dnotify. Everybody should be using inotify by now.


M	configure.ac
M	doc/example-config/conf.d/10-mail.conf
M	src/lib/Makefile.am
D	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/master/main.c

2015-08-19 14:33:09 +0300 Timo Sirainen <tss@iki.fi> (bb464f7)

    pop3: Added %{deleted_bytes} variable to pop3_logout_format


M	doc/example-config/conf.d/20-pop3.conf
M	src/pop3/pop3-client.c

2015-08-19 14:30:09 +0300 Timo Sirainen <tss@iki.fi> (febb892)

    pop3: If transcation commit failed at QUIT, don't log any messages as
    expunged.


M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h
M	src/pop3/pop3-commands.c

2015-08-19 13:41:54 +0300 Timo Sirainen <tss@iki.fi> (f373994)

    lib: kqueue notification should trigger also on file renames. For example if
    dovecot.index.log is renamed to dovecot.index.log.2, we should notice that
    since there's now a new dovecot.index.log containing new changes.


M	src/lib/ioloop-notify-kqueue.c

2015-08-19 13:40:35 +0300 Timo Sirainen <tss@iki.fi> (a24e140)

    lib-storage: Code cleanup - Don't keep a separate notify_ios list.


M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/index/index-storage.h

2015-08-19 12:56:55 +0300 Timo Sirainen <tss@iki.fi> (817d027)

    lib-storage: Moved most of the \Recent flag handling code to
    mailbox-recent-flags.c There are also some API changes, because functions
    were renamed and the recent_* fields were moved to struct mailbox. I'm not
    aware of any plugins using these though, except for
    index_mailbox_set_recent_seq() which for now is kept as a backwards
    compatibility macro.

    No changes were made to the actual code logic.

M	src/lib-storage/Makefile.am
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
A	src/lib-storage/mailbox-recent-flags.c
A	src/lib-storage/mailbox-recent-flags.h
M	src/plugins/virtual/virtual-sync.c

2015-08-19 11:34:36 +0300 Timo Sirainen <tss@iki.fi> (aeba69f)

    *-login: Removed dead assignment to make static analyzer happy.


M	src/login-common/main.c

2015-08-18 23:20:35 +0300 Timo Sirainen <tss@iki.fi> (2e51f50)

    fts-solr: Flush Solr indexing HTTP requests every 1000 mails. This avoids
    the HTTP request from becoming too huge.


M	src/plugins/fts-solr/fts-backend-solr.c

2015-08-18 23:20:07 +0300 Timo Sirainen <tss@iki.fi> (1a115c1)

    fts-solr: If HTTP request fails, log the status number as well.


M	src/plugins/fts-solr/solr-connection.c

2015-08-18 23:17:47 +0300 Timo Sirainen <tss@iki.fi> (0685853)

    fts-solr: Fix to previous memory leak fix - second request was failing.
    Duplicated data was sent to Solr because string wasn't truncated.


M	src/plugins/fts-solr/fts-backend-solr.c

2015-08-18 23:07:19 +0300 Timo Sirainen <tss@iki.fi> (5e19da1)

    fts-solr: Fixed memory leak when indexing multiple mailboxes in one update
    context.


M	src/plugins/fts-solr/fts-backend-solr.c

2015-08-18 23:02:01 +0300 Stephan Bosch <stephan@rename-it.nl> (3d1edb8)

    lib-http: client: Fixed handling of request timeout. It was inappropriately
    active when the client needed to take action. This showed particularly with
    large payloads sent using http_client_request_send_payload().


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2015-08-18 21:10:41 +0300 Timo Sirainen <tss@iki.fi> (acff3d8)

    lib-http: Previous test-http-client safe_memset() change broke in some
    systems. Since there's no easy way to fix this in Makefile.am, just do it by
    actually using safe_memset()..


M	src/lib-http/Makefile.am
M	src/lib-http/test-http-client.c

2015-08-18 20:59:25 +0300 Timo Sirainen <tss@iki.fi> (5c46ec7)

    lib-http: test-http-client may have failed to load SSL library plugin.
    safe_memset() wasn't necessarily compiled into test-http-client. This is a
    bit kludgy way of just adding it. Another possibility could have been to use
    -Wl,--whole-archive with GNU ld, but it's a bit tricky here.


M	src/lib-http/Makefile.am

2015-08-18 20:54:47 +0300 Timo Sirainen <tss@iki.fi> (6a62f58)

    lib-http: test-http-client double-freed memory


M	src/lib-http/test-http-client.c

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (4356563)

    lib-http: url: Implemented http_url_clone_authority() to clone authority
    part of existing HTTP URL.


M	src/lib-http/http-url.c
M	src/lib-http/http-url.h

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (92c2272)

    lib-http: url: Implemented functions to copy/clone URLs including the
    userinfo part (normally skipped).


M	src/lib-http/http-url.c
M	src/lib-http/http-url.h

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (d01c7c7)

    lib-http auth: Implemented cloning/copying of credentials struct.


M	src/lib-http/http-auth.c
M	src/lib-http/http-auth.h

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (4c4c4a7)

    lib-http client: Implemented proxy authentication using Basic scheme.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (91a4eaa)

    lib-http client: Added inline function to check whether request is directed
    at a proxy.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (30f35cf)

    lib-http client: Implemented simple authentication using Basic scheme.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h
M	src/lib-http/test-http-client.c

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (fb20981)

    lib-http client: Removed useless assignment of request->authority in
    http_client_request_redirect(). It is assigned again in
    http_client_request_do_submit().


M	src/lib-http/http-client-request.c

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (8aa91c0)

    lib-http client: Minor whitespace cleanups in struct http_client_request.


M	src/lib-http/http-client-private.h

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (af6baaa)

    lib-http: url: Make sure destination url struct is cleared in
    http_url_copy().


M	src/lib-http/http-url.c

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (79fa026)

    lib-http auth: Implemented client-side handling of basic authentication
    scheme.


M	src/lib-http/http-auth.c
M	src/lib-http/http-auth.h

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (68adc38)

    lib-http auth: Fixed assertion on the validity of the token68 encountered
    during conversion to string.


M	src/lib-http/http-auth.c

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (06c6330)

    lib-http auth: Made second argument of http_auth_create_challenges() const
    as it should be.


M	src/lib-http/http-auth.c
M	src/lib-http/http-auth.h

2015-08-18 20:39:24 +0300 Stephan Bosch <stephan@rename-it.nl> (77f3d7f)

    lib-http auth: Fixed segfault occurring in http_auth_challenge_copy() when
    there are no parameters.


M	src/lib-http/http-auth.c

2015-08-18 20:39:06 +0300 Timo Sirainen <tss@iki.fi> (8761992)

    lib-master: Added support for HAProxy protocol. Patch by Stephan Bosch -
    with some small changes.


M	src/lib-master/Makefile.am
A	src/lib-master/master-service-haproxy.c
M	src/lib-master/master-service-private.h
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
M	src/lib-master/master-service.c
M	src/lib-master/service-settings.h
M	src/master/master-settings.c
M	src/master/service-process.c

2015-08-18 20:23:45 +0300 Timo Sirainen <tss@iki.fi> (71056e0)

    master: Changed passing of listener settings from master to process to be
    more flexible. This is needed to allow adding new listener settings, such as
    `haproxy'. Patch by Stephan Bosch - with some small changes.


M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c
M	src/master/service-process.c

2015-06-15 18:50:53 +0200 Stephan Bosch <stephan@rename-it.nl> (a05fec1)

    lmtp, *-login: Use ip/port values from struct master_service_connection
    instead of from the socket. This way, a proxy protocol like HAProxy can
    transparently override these addresses with what is seen by the proxy.


M	src/lmtp/client.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/main.c

2015-06-15 18:50:53 +0200 Stephan Bosch <stephan@rename-it.nl> (72f2188)

    lib-master: Added local and real IP addresses and ports to struct
    master_service_connection.


M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2015-08-18 20:03:28 +0300 Timo Sirainen <tss@iki.fi> (8ab32a8)

    lib-master: Moved connection accepting code to its own functions. No
    functional changes.


M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c

2015-08-17 19:31:42 +0300 Timo Sirainen <tss@iki.fi> (4256224)

    lazy-expunge: If MAIL_FETCH_REFCOUNT fails because mail is expunged, ignore
    the error.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2015-08-17 19:28:55 +0300 Timo Sirainen <tss@iki.fi> (0f277a0)

    lazy-expunge: If MAIL_FETCH_REFCOUNT fails, log the storage error.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2015-08-17 14:25:59 +0300 Timo Sirainen <tss@iki.fi> (7b3f0e0)

    lib-fts: Minor cleanup - initialize err with U_ZERO_ERROR instead of 0.
    They're the same though.


M	src/lib-fts/fts-icu.c

2015-08-17 13:18:03 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (3a54211)

    lib-fts: Add Unicode TR29 rule WB5a setting to tokenizer. Splits prefixing
    contracted words from base word. E.g. "l'homme" -> "l" "homme". Together
    with a language specific stopword list unnecessary contractions can thus be
    filtered away.

    This is disabled by default and only works with the TR29 algorithm. Enable
    by "fts_tokenizer_generic = algorithm=tr29 wb5a=yes"

M	src/lib-fts/fts-common.h
M	src/lib-fts/fts-tokenizer-generic-private.h
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/test-fts-tokenizer.c

2015-08-17 13:15:11 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (bcc55b1)

    lib-fts: Add note about possible additional apostrophe.


M	src/lib-fts/fts-common.h

2015-08-17 13:14:44 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (d162310)

    lib-fts: Update comment on tr29 rules.


M	src/lib-fts/fts-tokenizer-generic.c

2015-08-17 12:56:25 +0300 Timo Sirainen <tss@iki.fi> (ff32ec7)

    indexer: Removed counting worker processes as service clients to prevent
    idle-kill. lib-master handles this internally now. Also if the max client
    count was reached, we assert-crashed:

    indexer: Panic: file master-service.c: line 672
    (master_service_client_connection_created): assertion failed:
    (service->master_status.available_count > 0)

M	src/indexer/worker-pool.c

2015-08-17 12:53:52 +0300 Timo Sirainen <tss@iki.fi> (2f94ca6)

    lib-master: If idle-die callback returns FALSE, notify master that we don't
    want to die. This avoids the master thinking that we're ignoring its
    idle-kill signal and logging an error.


M	src/lib-master/master-service.c

2015-08-17 12:51:43 +0300 Timo Sirainen <tss@iki.fi> (b17d7bb)

    lib-master: Code cleanup - split master_status_update() to two functions. No
    functional changes.


M	src/lib-master/master-service.c

2015-08-16 13:22:14 +0200 Timo Sirainen <tss@iki.fi> (a578aaf)

    lib-fs: Moved enum fs_op from fs-randomfail.c to fs-api-private.h These are
    useful for other purposes as well.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-randomfail.c

2015-08-16 13:17:06 +0200 Timo Sirainen <tss@iki.fi> (8f8858b)

    lib-fs: Fix to earlier write_stream_finish() commit 2f1378beeef6
    accidentally reversed == and != check.


M	src/lib-fs/fs-api.c

2015-08-16 13:14:11 +0200 Timo Sirainen <tss@iki.fi> (1445b15)

    lib-fs: fs_copy*() didn't update metadata_changed correctly. It was supposed
    to be (only) set when the copying actually finished.


M	src/lib-fs/fs-api.c

2015-08-16 13:10:48 +0200 Timo Sirainen <tss@iki.fi> (825e349)

    lib-fs: Small code cleanup for handling write_stream_finish()


M	src/lib-fs/fs-api.c

2015-08-16 13:07:21 +0200 Timo Sirainen <tss@iki.fi> (b76b97a)

    lib-fs: fs_write() didn't update stats.write_count correctly. If backend
    implemented asynchronous write(), the write_count was updated multiple
    times. If backend didn't implement write(), then it was counted twice.


M	src/lib-fs/fs-api.c

2015-08-15 12:14:35 +0200 Timo Sirainen <tss@iki.fi> (1132d30)

    dsync: Fixed syncing a recursive delete of mailbox with children. For
    example if 1/2/3 exists in both sides and then 1/2/3, 1/2 and 1 are deleted
    from one side, the next dsync would delete 1/2/3, but leave 1/2 and 1
    undeleted.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2015-08-15 12:05:34 +0200 Timo Sirainen <tss@iki.fi> (34256c0)

    dsync: If mailbox is already deleted locally, don't attempt to delete it
    again. This only caused an unnecessary desync warning / exit code.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2015-08-12 12:52:06 +0300 Timo Sirainen <tss@iki.fi> (3a63761)

    pop3: Added pop3_delete_type setting with values "default", "expunge" or
    "flag". This is related to pop3_deleted_flag setting. The main behefit here
    is that you can now hide messages from POP3 by setting pop3_deleted_flag,
    but without changing the actual deletion behavior by setting
    pop3_delete_type=expunge.


M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/pop3/pop3-settings.h

2015-08-11 14:27:01 +0300 Timo Sirainen <tss@iki.fi> (f1306b3)

    lib-fts: Install headers on make install.


M	src/lib-fts/Makefile.am

2015-08-10 15:39:50 +0300 Timo Sirainen <tss@iki.fi> (67e599e)

    rawlog: Removed unnecessary/duplicate 'o' from getopt_args This caused
    assert-crash at startup after ff17864ba6e0.


M	src/util/rawlog.c

2015-08-10 15:35:43 +0300 Timo Sirainen <tss@iki.fi> (809751b)

    lda: Removed unnecessary/duplicate 'k' from getopt_args This caused
    assert-crash at startup after ff17864ba6e0.


M	src/lda/main.c

2015-08-09 21:54:33 +0300 Timo Sirainen <tss@iki.fi> (48ed692)

    man: doveadm-import -s description updated The previously mentioned
    subscriptions-file is specific to Maildir format.


M	doc/man/doveadm-import.1.in

2015-08-07 15:32:28 +0300 Timo Sirainen <tss@iki.fi> (22b88a9)

    doveadm: Make sure we can't accidentally add duplicate getopt args.


M	src/doveadm/doveadm-mail.c

2015-08-07 15:32:14 +0300 Timo Sirainen <tss@iki.fi> (9b0f6b9)

    lib-master: Make sure we can't accidentally add duplicate getopt args.


M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2015-08-07 15:30:26 +0300 Timo Sirainen <tss@iki.fi> (2759d14)

    stats: Added session=<ID> filter to doveadm dump session|command


M	src/stats/client-export.c

2015-08-07 15:13:34 +0300 Timo Sirainen <tss@iki.fi> (7fbad92)

    dsync: Renamed -F parameter to -O to avoid a conflict doveadm mail commands
    already had a generic -F parameter.


M	src/doveadm/doveadm-dsync.c

2015-08-07 13:32:02 +0300 Timo Sirainen <tss@iki.fi> (e99ffa6)

    fts-solr: "highest UID for mailbox" lookup was actually returning "highest
    UID for user" If the default operator was OR instead of AND. This affected
    indexing mails in newly created mailboxes.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2015-08-07 12:58:30 +0300 Timo Sirainen <tss@iki.fi> (29cda2d)

    lib: istream-timeout could have triggered timeout too early after
    long-running code.


M	src/lib/istream-timeout.c

2015-08-07 11:31:29 +0300 Timo Sirainen <tss@iki.fi> (146f6f8)

    fts: If Tika returns 500, retry it a couple of times and then fallback to
    ignoring the problem.


M	src/plugins/fts/fts-parser-tika.c

2015-08-06 22:36:20 +0300 Timo Sirainen <tss@iki.fi> (6b757d0)

    lib-storage: Make sure tryagain_r is never randomly set in
    mailbox_search_next_nonblock() This infinite looping in some fts plugin
    failure situations.


M	src/lib-storage/mail-storage.c

2015-08-06 12:17:45 +0300 Timo Sirainen <tss@iki.fi> (38db726)

    stats: If process was used for multiple sessions, some of the fields weren't
    set correctly. For example the second user's disk_output was increased at
    startup by the same amount as what the previous user's last disk_output
    value was.


M	src/plugins/stats/stats-plugin.c

2015-08-04 11:31:17 +0300 Timo Sirainen <tss@iki.fi> (f0d09be)

    lib-storage: escape_char and broken_char settings weren't copied on
    mailbox_list_create()


M	src/lib-storage/mailbox-list.c

2015-07-20 10:33:39 +0300 Timo Sirainen <tss@iki.fi> (668f92a)

    lib-storage: Another fix for doing multiple changes via
    mailbox_attribute_set/unset


M	src/lib-storage/index/index-attribute.c

2015-07-19 16:45:23 +0300 Timo Sirainen <tss@iki.fi> (5199b57)

    lib-mail: Fixed message_part_to_idx()


M	src/lib-mail/message-part.c
M	src/lib-mail/test-message-part.c

2015-07-19 16:21:04 +0300 Timo Sirainen <tss@iki.fi> (cd889f5)

    pop3-migration: Compiling fix in some systems


M	src/plugins/pop3-migration/Makefile.am

2015-07-19 10:57:26 +0300 Timo Sirainen <tss@iki.fi> (4a9bbf8)

    lib-storage: Fixed doing multiple changes via mailbox_attribute_set/unset()
    Only the last change was committed and the earlier changes were just leaking
    memory.


M	src/lib-storage/index/index-attribute.c

2015-07-16 19:37:22 +0300 Timo Sirainen <tss@iki.fi> (b3070ac)

    pop3-migration: Fetch physical sizes instead of virtual sizes so pop3c uses
    LIST 4bebfbb32410 caused the fetching to break entirely.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2015-07-16 18:10:12 +0300 Timo Sirainen <tss@iki.fi> (7e8bfb5)

    pop3-migration: Use LIST instead of RETRs to get the messages' sizes.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2015-07-16 18:09:17 +0300 Timo Sirainen <tss@iki.fi> (bca734e)

    lib-mail: Updated test-message-header-parser unit test


M	src/lib-mail/test-message-header-parser.c

2015-07-16 18:08:40 +0300 Timo Sirainen <tss@iki.fi> (e18e909)

    pop3-migration: Truncate header if there's line containing only CR(s). This
    fixes matching IMAP <-> POP3 messages when the servers behave differently.


M	src/plugins/pop3-migration/Makefile.am
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/pop3-migration/pop3-migration-plugin.h
A	src/plugins/pop3-migration/test-pop3-migration-plugin.c

2015-07-14 15:08:24 +0200 Timo Sirainen <tss@iki.fi> (7faf475)

    pop3-migration: Show the first message's number and UIDL which wasn't found
    from IMAP.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2015-07-11 12:16:56 +0300 Timo Sirainen <tss@iki.fi> (e048e63)

    lib-storage: If mailboxes' vsizes are used, keep them updated also in
    mailbox list index. This allows looking them up quickly without opening the
    actual mailbox indexes.


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/list/mailbox-list-notify-tree.c

2015-07-11 12:14:48 +0300 Timo Sirainen <tss@iki.fi> (c16bf63)

    quota: Use MAILBOX_METADATA_PHYSICAL_SIZE for recalculating mailbox's size.


M	src/plugins/quota/quota-count.c

2015-07-11 12:11:48 +0300 Timo Sirainen <tss@iki.fi> (dae4244)

    lib-storage: Added MAILBOX_METADATA_PHYSICAL_SIZE If backend always uses the
    same virtual and physical sizes, this is implemented via the
    MAILBOX_METADATA_VIRTUAL_SIZE code. Otherwise it searches all the messages
    and sums up their physical sizes.


M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/mail-storage.h

2015-07-11 12:06:44 +0300 Timo Sirainen <tss@iki.fi> (382f235)

    lib-storage: Moved vsize_hdr_ext_id to struct mailbox for more global
    access.


M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/mail-storage-private.h

2015-07-11 12:03:56 +0300 Timo Sirainen <tss@iki.fi> (2c70086)

    lib-storage: Renamed struct index_vsize_header to struct mailbox_index_vsize
    Also moved the struct to mail-storage-private.h for more global access.


M	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/mail-storage-private.h

2015-07-11 12:00:38 +0300 Timo Sirainen <tss@iki.fi> (2c759e5)

    lib-storage: Moved mailbox vsize calculation code to its own file. No
    functional differences.


M	src/lib-storage/index/Makefile.am
A	src/lib-storage/index/index-mailbox-size.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.h

2015-07-03 13:55:17 +0300 Timo Sirainen <tss@iki.fi> (67d4da9)

    quota: Even if quota counting fails, commit the mailbox transaction. The
    only changes in the transaction are changes to dovecot.index.cache file and
    we don't want to rollback those.


M	src/plugins/quota/quota-count.c

2015-07-03 13:54:18 +0300 Timo Sirainen <tss@iki.fi> (e7c8048)

    quota: Fixed error handling in quota counting code. Errors weren't logged
    and some error checking was missing.


M	src/plugins/quota/quota-count.c

2015-07-02 11:06:04 +0200 Timo Sirainen <tss@iki.fi> (c5c244d)

    mdbox: Make sure rebuilding doesn't try to add a copy of the message too
    many times. Currently it just silently overflowed the 16bit refcount, which
    caused problems later.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2015-06-30 14:26:00 +0300 Timo Sirainen <tss@iki.fi> (5a3ff8d)

    istream-zlib: Don't overwrite parent istream's error on gz header/trailer
    read errors.


M	src/lib-compression/istream-zlib.c

2015-06-30 13:58:15 +0300 Timo Sirainen <tss@iki.fi> (c4d1cea)

    doveadm: Added doveadm_username to specify the username for authentication.
    The default is still "doveadm" and the server side doesn't currently support
    anything except "doveadm".


M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/server-connection.c

2015-06-30 12:18:08 +0300 Timo Sirainen <tss@iki.fi> (2c0f1cb)

    istream filters: If parent's i_stream_stat() fails, copy the stream_errno.
    This doesn't actually change any functionality yet, since most
    i_stream_stat() callers aren't using i_stream_get_error().


M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lz4.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c
M	src/lib-fs/istream-metawrap.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib/istream-limit.c
M	src/lib/istream-sized.c
M	src/lib/istream.c
M	src/plugins/mail-filter/istream-ext-filter.c

2015-06-30 12:17:35 +0300 Timo Sirainen <tss@iki.fi> (e17d72c)

    lib: istream_file.stat() fails, set stream_errno and error string. For now
    we'll also keep logging the error since everybody isn't using
    i_stream_get_error().


M	src/lib/istream-file.c

2015-06-30 11:26:47 +0300 Timo Sirainen <tss@iki.fi> (ffc2b01)

    master: When sending SIGTERM/SIGKILL to processes, log which services they
    were sent to.


M	src/master/service.c

2015-06-29 20:25:15 +0300 Timo Sirainen <tss@iki.fi> (0a9d52b)

    imap/pop3-login: If auth failure reason already begins with [resp-code],
    don't prefix it with another one.


M	src/imap-login/client-authenticate.c
M	src/pop3-login/client.c

2015-06-29 13:36:38 +0300 Timo Sirainen <tss@iki.fi> (5291b4f)

    lib: Fixed unit test with big-endian CPUs. Patch by Michal Hlavinka / Redhat


M	src/lib/test-net.c

2015-06-29 13:06:03 +0300 Timo Sirainen <tss@iki.fi> (55e8c2d)

    lib: Fixed read buffer overflow in wildcard_match*() Patch by Hanno BÃ¶ck.

    Note that input to wildard_match*() is always coming only from trusted 
    sources, like config file or doveadm commands.

M	src/lib/wildcard-match.c

2015-06-29 12:05:25 +0300 Timo Sirainen <tss@iki.fi> (29ffe70)

    indexer: Properly fix crashing at deinit when there are pending requests.


M	src/indexer/indexer-queue.c

2015-06-29 12:00:05 +0300 Timo Sirainen <tss@iki.fi> (d03ffc6)

    indexer: Reverted 5945ba000a45 - it didn't really help


M	src/indexer/indexer.c

2015-06-29 11:44:00 +0300 Timo Sirainen <tss@iki.fi> (1d69f58)

    indexer: Fixed crash at deinit if there were still queued requests.


M	src/indexer/indexer.c

2015-06-24 07:54:35 +0200 Timo Sirainen <tss@iki.fi> (2d0c822)

    imapc: Fixed check to see if prefix!="" in previous commit.


M	src/lib-storage/index/imapc/imapc-list.c

2015-06-23 11:31:21 +0200 Timo Sirainen <tss@iki.fi> (db3325d)

    lib-storage: Set MAILBOX_SELECT/NONEXISTENT for namespace prefix even if no
    flags are wanted. This fixes doveadm commands attempting to access such
    nonexistent mailbox prefixes.


M	src/lib-storage/list/mailbox-list-iter.c

2015-06-23 11:30:27 +0200 Timo Sirainen <tss@iki.fi> (7882e10)

    imapc: Don't return mailbox list entries that would result in name="". So
    basically don't return namespace prefix if imapc_list_prefix="".


M	src/lib-storage/index/imapc/imapc-list.c

2015-06-23 11:12:38 +0200 Timo Sirainen <tss@iki.fi> (9a717bf)

    imapc: If login is aborted at deinit, don't log an error.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2015-06-23 11:02:20 +0200 Timo Sirainen <tss@iki.fi> (c1a2ab4)

    imapc: Don't automatically login to IMAP server for list=no namespaces.


M	src/lib-storage/index/imapc/imapc-storage.c

2015-06-18 11:10:05 +0300 Timo Sirainen <tss@iki.fi> (2ff548b)

    lib-http: http_client_request_send() failure returned already-freed error
    string.


M	src/lib-http/http-client-request.c

2015-06-17 16:37:37 +0300 Timo Sirainen <tss@iki.fi> (976459a)

    fs-posix: Hide temporary files from fs_iter_*() Those could exist just
    because another process is just using them to create new files to the
    directory. Although they could also be older files caused by earlier
    crashes. It would probably be a good idea to have fs_iter_*() delete the old
    temporary files automatically.


M	src/lib-fs/fs-posix.c

2015-06-17 14:25:48 +0300 Timo Sirainen <tss@iki.fi> (96d85fb)

    virtual: virtual_uids weren't always set to all mails, causing missing mails
    and crashes in search.


M	src/plugins/virtual/virtual-sync.c

2015-06-17 14:24:06 +0300 Timo Sirainen <tss@iki.fi> (a5a4433)

    virtual: Added more asserts when DEBUG is enabled.


M	src/plugins/virtual/virtual-sync.c

2015-06-17 14:23:38 +0300 Timo Sirainen <tss@iki.fi> (cc7e2c3)

    virtual: Added more asserts.


M	src/plugins/virtual/virtual-storage.c

2015-06-17 14:04:42 +0300 Timo Sirainen <tss@iki.fi> (d4fbb33)

    fts-solr: Avoid sending too large queries to Solr due to listing wanted
    mailboxes. This is mainly a problem if there are a lot of mailboxes and "All
    Mails" virtual mailbox. For now hardcoded to send max 10 mailboxes in the
    query, afterwards it just returns matches in all the mailboxes and we'll
    filter out the unwanted mailboxes.


M	src/plugins/fts-solr/fts-backend-solr.c

2015-06-17 13:55:37 +0300 Timo Sirainen <tss@iki.fi> (57cefeb)

    fts-solr: Removed assert to fix indexing multiple mailboxes. fts plugin may
    want to do last-uid lookup for a new mailbox while we still have posting
    open for the previous one.


M	src/plugins/fts-solr/solr-connection.c

2015-06-17 13:12:37 +0300 Timo Sirainen <tss@iki.fi> (ae19dcf)

    fts-tika: Fixed crashes when indexing larger attachments with fts-solr. We
    were mixing ioloops without switching back to the original ioloop in the
    middle. Also io_remove() at deinit caused another timeout to be added, so
    this needs to be done while original ioloop is active or we'll just leak the
    just-added timeout in io_loop_destroy() and crash later.


M	src/plugins/fts/fts-parser-tika.c

2015-06-17 12:22:17 +0300 Timo Sirainen <tss@iki.fi> (30605b7)

    lib-fs: Removed redundant o_stream_nfinish() calls


M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-randomfail.c
M	src/lib-fs/fs-sis.c

2015-06-17 12:21:52 +0300 Timo Sirainen <tss@iki.fi> (4244105)

    lib-fs: Call o_stream_nfinish() automatically for all backends in
    fs_write_stream_finish() Otherwise each backend needs to do it internally.
    fs-metawrap for example was missing this and causing assert-crashes.


M	src/lib-fs/fs-api.c

2015-06-17 11:42:53 +0300 Phil Carmody <phil@dovecot.fi> (03e0be2)

    lib: test-data-stack - simplify #if-ing out of DEBUG-only fatal test With no
    canaries, nothing can be tested, so just reduce this to a trivial 1-line
    return on the non-DEBUG case.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-data-stack.c

2015-06-17 11:42:30 +0300 Phil Carmody <phil@dovecot.fi> (f4a8208)

    lib: test-data-stack - ensure t_push() and t_pop() are balanced in fatal
    tests If the t_pop() unexpectedly succeeds, we won't want to do another one
    upon entering the function again.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-data-stack.c

2015-06-17 11:31:02 +0300 Timo Sirainen <tss@iki.fi> (1cd5954)

    auth: Added allow_real_nets setting. The difference to allow_nets is that it
    matches against the connection's "real IP" rather than what the connection
    told was the original client's IP address (%{rip} vs %{real_rip})


M	src/auth/auth-request.c

2015-06-16 17:19:12 +0300 Timo Sirainen <tss@iki.fi> (4487c66)

    lib: Added unix_client_connect_msecs setting to connection API.


M	src/lib/connection.c
M	src/lib/connection.h

2015-06-16 16:56:08 +0300 Timo Sirainen <tss@iki.fi> (c1d9977)

    lib: Compiler warning fix for test-ostream-failure-at.


M	src/lib/test-ostream-failure-at.c

2015-06-16 16:40:29 +0300 Timo Sirainen <tss@iki.fi> (5a441a6)

    lib-fs: Added "randomfail" driver. Using this in front of fs drivers allows
    randomly injecting failures. For example:

    mail_attachment_fs = randomfail:all=10,read=30,read-range=2000-3000:sis
    posix

    This means that all FS operations have a 10% chance of failing, except reads 
    have a 30% chance of failing. If the read fails, it'll fail somewhere 
    between offsets 2000-3000 (the default is 0, so it'll fail at the start of 
    file).

    The supported operations are: wait metadata prefetch read write lock exists 
    stat copy rename delete iter. "all" applies to all of them.

    The supported ranges are: read-range, write-range, iter-range.

M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
A	src/lib-fs/fs-randomfail.c

2015-06-16 16:22:18 +0300 Timo Sirainen <tss@iki.fi> (9294b9a)

    lib: Added o_stream_create_failure_at() to inject EIO at given offset in
    ostream


M	src/lib/Makefile.am
A	src/lib/ostream-failure-at.c
A	src/lib/ostream-failure-at.h
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-ostream-failure-at.c

2015-06-16 16:21:56 +0300 Timo Sirainen <tss@iki.fi> (289bb39)

    lib: Added i_stream_create_failure_at() to inject EIO at given offset in
    istream.


M	src/lib/Makefile.am
A	src/lib/istream-failure-at.c
A	src/lib/istream-failure-at.h
A	src/lib/test-istream-failure-at.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2015-06-16 14:12:59 +0300 Timo Sirainen <tss@iki.fi> (85dd5fe)

    dsync: If we stop because of a signal, log a warning about it.


M	src/doveadm/doveadm-dsync.c

2015-06-16 14:12:33 +0300 Timo Sirainen <tss@iki.fi> (eff3452)

    doveadm: Added doveadm_killed_signo()


M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2015-06-16 00:29:07 +0300 Timo Sirainen <tss@iki.fi> (44ca764)

    fts: Avoid expanding mail_search_args multiple times (for optimization &
    crash-avoidance) Primarily this fixes the crash:

    index-search-result.c: line 132 (index_search_result_update_flags): 
    assertion failed: (result->search_args->args == &search_arg)

    It could be triggered by: a search return (update) body body seen b store 1
    +flags \seen c store 1 -flags \seen

M	src/lib-storage/mail-search.h
M	src/plugins/fts/fts-search-args.c

2015-06-16 00:16:42 +0300 Timo Sirainen <tss@iki.fi> (0084f25)

    fs-posix: fs_copy() didn't work with prefix= parameter


M	src/lib-fs/fs-posix.c

2015-06-15 14:55:03 +0300 Phil Carmody <phil@dovecot.fi> (15595e8)

    lib-stats: fix tristate-int vs. bool return value confusion -1 was being
    silently converted to true. However, this was an error condition.

    The callers don't need anything more complex than a bool, so kill the int.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-stats/stats.c

2015-06-15 14:55:01 +0300 Phil Carmody <phil@dovecot.fi> (085a87d)

    lib-fts: use NULL rather than 0 to shut up sparse Signed-off-by: Phil
    Carmody <phil@dovecot.fi>


M	src/lib-fts/fts-tokenizer.c

2015-06-15 14:54:58 +0300 Phil Carmody <phil@dovecot.fi> (ff060dc)

    director: explicitly mark _disconnect() helper static to match proto No
    functional change, compiler would not have exported the symbol, this just
    shuts up sparse.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/director/director-connection.c

2015-06-15 14:51:46 +0300 Timo Sirainen <tss@iki.fi> (b5439de)

    fs-metawrap: If written file unexpectedly shrinks, return error instead of
    assert-crash. This shouldn't be happening, but we can't fully control it so
    an error is better.


M	src/lib-fs/fs-metawrap.c

2015-06-15 14:49:46 +0300 Timo Sirainen <tss@iki.fi> (4107ad4)

    fs-metawrap: Don't assert-crash when writing an empty file.


M	src/lib-fs/fs-metawrap.c

2015-06-15 14:35:25 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (998e171)

    lib-fts: Fix comment in fts-filter.h


M	src/lib-fts/fts-filter.h

2015-06-15 14:31:19 +0300 Phil Carmody <phil@dovecot.fi> (8549b59)

    lib: test-failures - tests get/set handlers and the various log levels Also
    indirectoy tests the new lib-test test_expect* family.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/Makefile.am
A	src/lib/test-failures.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2015-06-15 14:31:19 +0300 Phil Carmody <phil@dovecot.fi> (1b3a9b9)

    lib-test: test_expect_error_string() to match a single known message This
    gives us very fine control over what is acceptable as an expected warning.
    Alas you have to do it for each message individually.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2015-06-15 14:31:19 +0300 Phil Carmody <phil@dovecot.fi> (7d442a6)

    lib-test: let tests invoke i_warning/i_error behaviour Error-handling paths
    should be testable too. Permit a test case to register that a known number
    of warnings/errors are to be expected, and to verify that those warnings did
    occur afterwards. Too many messages will fail the test exactly as it did in
    the past, they're unexpected messages. However, too few messages will also
    cause the test case to fail.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2015-06-15 14:31:19 +0300 Phil Carmody <phil@dovecot.fi> (04e7cfc)

    lib-test: flush test-assert failure messages Diagnostic output to stderr may
    overtake these stdout logs if the streams are combined by the shell or on
    the console. fflush() might help realign them.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c

2015-06-15 14:25:07 +0300 Phil Carmody <phil@dovecot.fi> (fdc4682)

    lib: array - permit array_swap with uninitialised arrays Before
    initialisation, all fields are blank, so the element_size field is not the
    actual size, and the i_assert would fire.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.h

2015-06-13 17:05:49 +0300 Timo Sirainen <tss@iki.fi> (ea91861)

    lib-index: Added mail_index_ext_register_resize_defaults()


M	src/lib-index/mail-index.c
M	src/lib-index/mail-index.h

2015-06-13 16:46:06 +0300 Timo Sirainen <tss@iki.fi> (b502347)

    cassandra: Commit failures returned an already freed error string.


M	src/lib-sql/driver-cassandra.c

2015-06-13 15:10:23 +0300 Timo Sirainen <tss@iki.fi> (98add73)

    lib-fts: Removed unnecessary data stack frames from test-fts-filter. They
    are already added by lib-test/test-common.c


M	src/lib-fts/test-fts-filter.c

2015-06-13 14:36:43 +0300 Timo Sirainen <tss@iki.fi> (0df5668)

    config: Added hook_config_parser_end for plugins.


M	src/config/config-parser-private.h
M	src/config/config-parser.c

2015-06-12 15:14:52 +0300 Timo Sirainen <tss@iki.fi> (28c669e)

    doveadm mailbox delete -r: Delete all mailboxes when empty mailbox name is
    given.


M	src/doveadm/doveadm-mail-mailbox.c

2015-06-12 13:02:08 +0300 Timo Sirainen <tss@iki.fi> (f07e311)

    lib-fts: Don't crash if fts_icu_*() are used after fts_icu_deinit()


M	src/lib-fts/fts-icu.c

2015-06-11 19:21:16 +0300 Timo Sirainen <tss@iki.fi> (b356019)

    lib-index: Avoid writing tail offset update to transaction log if it's not
    necessary. This should avoid extra writes that do nothing but update the
    tail offset. mdbox's map requires this behavior, so disable it for it. For
    others it might cause the next sync to read more data unnecessarily, but it
    should be worth the extra cost of write most of the times.


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index.h
M	src/lib-storage/index/dbox-multi/mdbox-map.c

2015-06-11 19:08:13 +0300 Timo Sirainen <tss@iki.fi> (e1ba963)

    doveadm fetch: Added "refcount" field.


M	src/doveadm/doveadm-mail-fetch.c

2015-06-11 16:19:05 +0300 Timo Sirainen <tss@iki.fi> (e22ec79)

    cassandra: Error handling cleanup. Probably doesn't fix any actual bugs.


M	src/lib-sql/driver-cassandra.c

2015-06-11 15:28:46 +0300 Timo Sirainen <tss@iki.fi> (6b4b3e5)

    cassandra: Minor code cleanup to make sure we don't try to access freed
    transaction memory.


M	src/lib-sql/driver-cassandra.c

2015-06-11 15:28:05 +0300 Timo Sirainen <tss@iki.fi> (b23a8d3)

    cassandra: Don't access freed memory when doing an assert-check.


M	src/lib-sql/driver-cassandra.c

2015-06-11 15:19:53 +0300 Timo Sirainen <tss@iki.fi> (01c4df2)

    doveadm fs delete -R: More fixes to handling errors without crashing.


M	src/doveadm/doveadm-fs.c

2015-06-10 20:29:35 +0300 Timo Sirainen <tss@iki.fi> (2010ab3)

    lmtp: Fixed assert-crash on anvil lookup failures. If anvil_client_query()
    fails, it immediately calls the callback and returns NULL. So we need to
    increase anvil_queries even before calling anvil_client_query()


M	src/lmtp/commands.c

2015-06-10 19:50:29 +0300 Timo Sirainen <tss@iki.fi> (2f9266a)

    doveadm fs delete -R: Fixed hang when some of the deletions failed.


M	src/doveadm/doveadm-fs.c

2015-06-10 16:18:10 +0300 Timo Sirainen <tss@iki.fi> (48ce7a3)

    cassandra: If log_level=debug/trace, log each query and its result.


M	src/lib-sql/driver-cassandra.c

2015-06-10 16:09:13 +0300 Timo Sirainen <tss@iki.fi> (b650f04)

    cassandra: Added extra asserts and sanity checks to make sure query errors
    are caught.


M	src/lib-sql/driver-cassandra.c

2015-06-10 16:08:28 +0300 Timo Sirainen <tss@iki.fi> (f0e811f)

    cassandra: Don't crash on failed queries.


M	src/lib-sql/driver-cassandra.c

2015-06-09 19:32:09 +0300 Timo Sirainen <tss@iki.fi> (bda46f9)

    dict-sql: Don't try to optimize finding a matching map by using the previous
    match. In some setups multiple maps can match and it's important that the
    matching is done in the same order always, otherwise the results could
    become somewhat random.


M	src/lib-dict/dict-sql.c

2015-06-05 16:37:24 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (091932d)

    man: doveadm-pw.1: Fix typo.


M	doc/man/doveadm-pw.1.in

2015-06-04 21:03:42 +0000 Pascal Volk <user@localhost.localdomain.org> (74befaa)

    man: doveadm-pw.1: Added a note about quoting password hashes.


M	doc/man/doveadm-pw.1.in

2015-06-04 21:57:32 +0300 Timo Sirainen <tss@iki.fi> (fe3f637)

    fts: lib-fts search arg expansion wasn't done for non-TEXT/BODY searches
    when fts_enforced=no


M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c

2015-06-04 00:45:11 +0300 Timo Sirainen <tss@iki.fi> (be1126e)

    fts: Added "doveadm fts expand" to show lib-fts search query expanded.


M	src/plugins/fts/doveadm-fts.c

2015-06-04 00:44:42 +0300 Timo Sirainen <tss@iki.fi> (9bafaf2)

    lib-storage: Added mail_search_args_to_cmdline() This isn't entirely correct
    yet, but it's only going to be used for debugging for now.


M	src/lib-storage/Makefile.am
A	src/lib-storage/mail-search-args-cmdline.c
M	src/lib-storage/mail-search.h

2015-06-03 23:56:32 +0300 Timo Sirainen <tss@iki.fi> (2e3e248)

    fts: Added "doveadm fts lookup" command. This is mainly useful for debugging
    lib-fts. It doesn't perform any of the lib-fts tokenization / filtering so
    you can do raw lookups.


M	src/plugins/fts/Makefile.am
M	src/plugins/fts/doveadm-fts.c

2015-06-03 22:39:52 +0300 Timo Sirainen <tss@iki.fi> (12952c1)

    lib-fts: fts_tokenizer_reset() didn't reset the entire state.


M	src/lib-fts/fts-tokenizer.c

2015-06-03 22:30:05 +0300 Timo Sirainen <tss@iki.fi> (2180957)

    indexer: Improved handling multiple indexing requests to the same mailbox.
    If a request arrives for a mailbox that we were already indexes, the
    previous code simply sent the indexing request to the existing worker
    process. This could have caused a lot of requests to be buffered to the same
    mailbox if the indexing took a long time, which could have taken a while to
    process even though they weren't really doing anything indexing work.

    The new code instead just keeps track in memory that when the earlier 
    indexing is finished, it's done again once to finish any pending changes.

M	src/indexer/indexer-queue.c
M	src/indexer/indexer-queue.h
M	src/indexer/indexer.c

2015-06-03 22:26:05 +0300 Timo Sirainen <tss@iki.fi> (be98c0c)

    indexer: Try to always flush as many requests from queue as possible. I
    don't think this changes the behavior much. It's mainly a code cleanup.


M	src/indexer/indexer.c

2015-06-03 22:25:28 +0300 Timo Sirainen <tss@iki.fi> (7fb611a)

    indexer: Use array.h API instead of writing our own. The space savings
    aren't worth the extra complexity.


M	src/indexer/indexer-queue.c
M	src/indexer/indexer-queue.h

2015-06-03 21:50:40 +0300 Timo Sirainen <tss@iki.fi> (4462eb8)

    fts: If mail indexing fails, don't log a "BUG: Unknown internal error"


M	src/plugins/fts/fts-storage.c

2015-06-03 21:49:52 +0300 Timo Sirainen <tss@iki.fi> (07fcb64)

    fts: If reading mail fails, log an error.


M	src/plugins/fts/fts-build-mail.c

2015-06-03 16:47:25 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (fcf9e8a)

    lib-lda: Fixed crash in mail_deliver_get_log_var_expand_table(). Discovered
    by clang static analyzer. This caused crashes with older versions of
    Pigeonhole.


M	src/lib-lda/mail-deliver.c

2015-06-03 01:04:49 +0300 Timo Sirainen <tss@iki.fi> (471167b)

    lib-fts: Added "english-possessive" filter.


M	src/lib-fts/Makefile.am
A	src/lib-fts/fts-filter-english-possessive.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h
M	src/lib-fts/test-fts-filter.c

2015-06-03 01:04:07 +0300 Timo Sirainen <tss@iki.fi> (e8ee7a2)

    lib-fts: Use UTF8_IS_START_SEQ()


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-03 01:03:52 +0300 Timo Sirainen <tss@iki.fi> (3b02371)

    lib: Added UTF8_IS_START_SEQ() helper macro


M	src/lib/unichar.h

2015-06-03 00:46:23 +0300 Timo Sirainen <tss@iki.fi> (be70859)

    lib-fts: fts-filter API changed to have a non-pointer vfuncs variable. The
    main benefit being that the fts-filter implementations can save a few lines
    of code.


M	src/lib-fts/fts-filter-lowercase.c
M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-private.h
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/fts-filter.c

2015-06-03 00:43:51 +0300 Timo Sirainen <tss@iki.fi> (9a5ff31)

    lib-fts: fts-lowercase can now use the default destroy function.


M	src/lib-fts/fts-filter-lowercase.c

2015-06-03 00:43:28 +0300 Timo Sirainen <tss@iki.fi> (bc180e6)

    lib-fts: Implemented default create/destory functions for fts-filters.


M	src/lib-fts/fts-filter.c

2015-06-03 00:39:11 +0300 Timo Sirainen <tss@iki.fi> (5a29101)

    lib-fts: Moved IS_APOSTROPHE() to fts-common.h


M	src/lib-fts/Makefile.am
A	src/lib-fts/fts-common.h
M	src/lib-fts/fts-tokenizer-generic.c

2015-06-02 23:46:28 +0300 Timo Sirainen <tss@iki.fi> (a1f6236)

    example-config: Updated deliver_log_format comments


M	doc/example-config/conf.d/10-logging.conf

2015-06-02 23:43:05 +0300 Timo Sirainen <tss@iki.fi> (eda4028)

    lib-lda: Added %{to_envelope} to deliver_log_format


M	src/lib-lda/mail-deliver.c

2015-06-02 23:35:23 +0300 Timo Sirainen <tss@iki.fi> (7a0d717)

    lib-fts: Compiling fix without libicu


M	src/lib-fts/fts-filter.c

2015-06-02 23:28:35 +0300 Timo Sirainen <tss@iki.fi> (266c879)

    lib-fts: Avoid compiler warning when building without libicu


M	src/lib-fts/fts-filter-lowercase.c

2015-06-02 22:47:21 +0300 Timo Sirainen <tss@iki.fi> (014cfdf)

    imapc: If auth fails due to connection failure, don't treat it the same as
    failed login.


M	src/lib-storage/index/imapc/imapc-storage.c

2015-06-02 22:20:03 +0300 Timo Sirainen <tss@iki.fi> (b5440e0)

    lib-fts: Fixed compiling without libicu


M	src/lib-fts/fts-filter-lowercase.c

2015-06-02 22:16:46 +0300 Timo Sirainen <tss@iki.fi> (0894188)

    lib-fts: Added more supported languages. This includes now all the ones that
    are currently supported by both snowball and exttextcat.


M	src/lib-fts/fts-language.c

2015-06-02 22:01:07 +0300 Timo Sirainen <tss@iki.fi> (1b8da09)

    lib-fts: Optimized truncation of partial trailing UTF-8 characters in
    tokenizers.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-02 21:56:29 +0300 Timo Sirainen <tss@iki.fi> (c8b49c0)

    lib-fts: Use fts_icu_lcase() for fts-filter-lowercase if possible.


M	src/lib-fts/fts-filter-lowercase.c

2015-06-02 21:56:03 +0300 Timo Sirainen <tss@iki.fi> (887b04f)

    lib-fts: Added string_t *token to struct fts_filter This makes the work a
    bit easier for simple filters that don't need any state but want to use a
    string_t.


M	src/lib-fts/fts-filter-private.h

2015-06-02 21:54:52 +0300 Timo Sirainen <tss@iki.fi> (37dfa89)

    lib-fts: Added fts_icu_lcase()


M	src/lib-fts/fts-icu.c
M	src/lib-fts/fts-icu.h
M	src/lib-fts/test-fts-icu.c

2015-06-02 21:49:46 +0300 Timo Sirainen <tss@iki.fi> (d3acad5)

    lib-fts: Do all the ICU cleanup in fts_icu_deinit().


M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-icu.c
M	src/lib-fts/fts-icu.h

2015-06-02 21:45:46 +0300 Timo Sirainen <tss@iki.fi> (3e46273)

    lib-fts: Include fts-filter.h in fts-filter-private.h This avoids having to
    always include them both.


M	src/lib-fts/fts-filter-lowercase.c
M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-private.h
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/fts-filter.c

2015-06-02 21:43:27 +0300 Timo Sirainen <tss@iki.fi> (8760747)

    lib-fts: Renamed variable. This is a lowercase-filter, not a normalizer.


M	src/lib-fts/fts-filter-lowercase.c

2015-06-02 21:41:46 +0300 Timo Sirainen <tss@iki.fi> (db451bd)

    lib-fts: Removed unnecessary array.h include from fts-filter.h


M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter.h

2015-06-02 20:50:23 +0300 Timo Sirainen <tss@iki.fi> (3448096)

    lib-fts: Fixed tr29 tokenizer to delete last character correctly when it's
    preceded by non-ASCII


M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/test-fts-tokenizer.c

2015-06-02 19:59:45 +0300 Timo Sirainen <tss@iki.fi> (cd97e99)

    pop3-login: Added support for Zimbra proxy's XOIP command.


M	src/pop3-login/client.c

2015-06-02 19:52:37 +0300 Timo Sirainen <tss@iki.fi> (c2c6342)

    fts: If we fail while indexing headers, return failure immediately.


M	src/plugins/fts/fts-build-mail.c

2015-06-02 19:52:15 +0300 Timo Sirainen <tss@iki.fi> (3d00e35)

    fts: Error logging fix. 1) We were logging the error after it was already
    freed from data stack. 2) We were logging uninitialized error string when
    fts indexing was the one that failed.


M	src/plugins/fts/fts-build-mail.c

2015-06-02 02:39:20 +0300 Timo Sirainen <tss@iki.fi> (6634e45)

    fts: Fixed memory leak at deinit when using multiple fts plugins at the same
    time using libfts.


M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts/fts-user.c

2015-06-02 02:26:44 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (88f5dbe)

    lib-fts: Correct comment in filter internal API.


M	src/lib-fts/fts-filter-private.h

2015-06-02 02:26:44 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (093e68f)

    lib-fts: Call libicu u_cleanup.


M	src/lib-fts/fts-filter.c

2015-06-01 22:16:19 +0300 Phil Carmody <phil@dovecot.fi> (6aadd1c)

    various: use new uni_utf8_get_char*() interface No need for additional
    uni_utf8_char_bytes() calls if you can parse and know the size with one
    call.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/str-sanitize.c
M	src/lib/unichar.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2015-06-01 22:14:19 +0300 Timo Sirainen <tss@iki.fi> (cf755ce)

    lib-fts: Use new uni_utf8_get_char*() interface


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 22:11:55 +0300 Timo Sirainen <tss@iki.fi> (2c8b34a)

    lib: Improved unit test for uni_utf8_get_char() return value check.


M	src/lib/test-unichar.c

2015-06-01 22:08:43 +0300 Phil Carmody <phil@dovecot.fi> (304a9d2)

    lib: API change - have uni_utf8_get_char*() return _char_bytes Often the two
    functions are called in close proximity (both ways round). As _get_char*()
    calls _char_bytes() early on the success path, we may as well return that
    value to the caller for immediate use.

    The callers which call _char_bytes() first are simply rejecting the
    truncated case quickly - all other invalid cases still call both functions,
    and all other valid cases (which should be the fast path) likewise call
    both.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/unichar.c
M	src/lib/unichar.h

2015-06-01 22:08:27 +0300 Phil Carmody <phil@dovecot.fi> (d69318e)

    fts-solr: laxer check of uni_utf8_get_char_n() return value If
    uni_utf8_get_char*() were changed to return the number of bytes in the
    character on success, then all we care about is it being > 0 (i.e. not
    error, not truncated).

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2015-06-01 22:07:44 +0300 Phil Carmody <phil@dovecot.fi> (7c1b72e)

    lib: test-unichar - test invalid utf8 encodings Chop trailing characters off
    valid encodings, and watch them fail. (There's no need to do this on most of
    the test characters, as they're truncated to the same byte sequence - only
    do 1 in 64.)

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-unichar.c

2015-06-01 22:06:44 +0300 Phil Carmody <phil@dovecot.fi> (5fea87f)

    lib: test-unichar - streamline the unichars test It's doing 2 kinds of
    tests, split them into separate test cases.

    And the first part has started to get expensive, so just make sure all code
    paths are tested by skipping most values. Only 3 from each set of 64 (lowest
    6 bits) are tested.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-unichar.c

2015-06-01 21:59:02 +0300 Timo Sirainen <tss@iki.fi> (83172e2)

    lib-fts: Added unit testing for unicode apostrophe handling.


M	src/lib-fts/test-fts-tokenizer.c

2015-06-01 21:58:30 +0300 Timo Sirainen <tss@iki.fi> (b6b0653)

    lib-fts: tokenizers - Fixed removal of trailing character in truncated
    tokens. If the token is truncated, we don't want to remove the trailing
    character since it's not actually there.

    Also we don't want to remove trailing apostrophes from a truncated word, 
    because they're not actually at the end of the (untruncated) token there. 
    This doesn't make a big difference, but it's slightly more correct.

M	src/lib-fts/fts-tokenizer-generic-private.h
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/test-fts-tokenizer.c

2015-06-01 21:51:33 +0300 Timo Sirainen <tss@iki.fi> (a2b6f7f)

    lib-fts: Optimize tokenizers - Rewrite of apostrophe handling. We parse
    through the UTF8 characters only once now, not twice.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:49:18 +0300 Timo Sirainen <tss@iki.fi> (67360bc)

    lib-fts: tr29 tokenizer - rename variable in preparation for the next patch


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:48:59 +0300 Timo Sirainen <tss@iki.fi> (202468f)

    lib-fts: tokenizers - don't include removed apostrophes as part of the token
    size


M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/test-fts-tokenizer.c

2015-06-01 21:35:39 +0300 Timo Sirainen <tss@iki.fi> (3fe4e25)

    lib-fts: simple tokenizer minor cleanup - removed unnecessary token length >
    0 check fts_tokenizer_generic_simple_current_token() will check it in any
    case.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:33:11 +0300 Timo Sirainen <tss@iki.fi> (0503150)

    lib-fts: tr29 tokenizer cleanup - Avoid unnecessary goto.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:28:42 +0300 Timo Sirainen <tss@iki.fi> (dfc9cfd)

    lib-fts: simple tokenizer optimization - don't check unicode word breaks for
    ASCII chars.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:27:09 +0300 Timo Sirainen <tss@iki.fi> (e3f8b4f)

    lib-fts: simple tokenizer cleanup - make prev_letter updating more explicit.
    It was now hidden inside one of the functions, which didn't make the
    prev_letter very consistent when a word break was found. It didn't actually
    matter what the prev_letter was at that point, but now the behavior is more
    consistent.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:19:47 +0300 Timo Sirainen <tss@iki.fi> (8acf0a8)

    lib-fts: simple tokenizer cleanup - removed unnecessary variables


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:16:35 +0300 Timo Sirainen <tss@iki.fi> (bf8b21a)

    lib-fts: tr29 cleanup - consistently call valid chars "token" and
    "non-token" chars. Instead of word/token/text.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:11:55 +0300 Timo Sirainen <tss@iki.fi> (afb62c7)

    lib-fts: tr29 cleanup - Avoid i++ in the for loop to avoid extra
    calculations


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:10:11 +0300 Timo Sirainen <tss@iki.fi> (3deb8a4)

    lib-fts: tr29 cleanup - token can never be empty by the time it's being
    returned.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 21:08:27 +0300 Timo Sirainen <tss@iki.fi> (b15ff90)

    lib-fts: Optimization for tr29 - we don't need to track last_size explicitly


M	src/lib-fts/fts-tokenizer-generic-private.h
M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 18:35:58 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (73e7fed)

    lib-fts: Correct internal helper function for tr29.


M	src/lib-fts/fts-tokenizer-generic.c

2015-06-01 18:35:58 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (fdf7041)

    lib-fts: Fix unit tests for TR29 full stop change.


M	src/lib-fts/test-fts-tokenizer.c

2015-06-01 18:35:58 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (65a2c8f)

    lib-fts: Change TR29 tokenizer to break at full stop (and others). Diverge
    from the TR29 rules and always break at MidNumLet letters. This fixes
    tokenizing first.last@domain.tld email addresses.


M	src/lib-fts/fts-tokenizer-generic-private.h
M	src/lib-fts/fts-tokenizer-generic.c

2015-05-29 21:39:33 +0300 Timo Sirainen <tss@iki.fi> (38ceb71)

    auth: Added %{passdb:field} and %{userdb:field} variables The field expands
    to either the passdb or userdb extra field.

    You can also use %{passdb:field:defaultvalue} where if field doesn't exist, 
    it's expanded to defaultvalue. Note that an empty value means that the field 
    still exists and it's not expanded to defaultvalue.

M	src/auth/Makefile.am
M	src/auth/auth-request-var-expand.c
M	src/auth/auth-request-var-expand.h
M	src/auth/auth-request.c
M	src/auth/db-checkpassword.c
M	src/auth/db-passwd-file.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-pam.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-template.c
M	src/auth/test-auth-request-var-expand.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-template.c

2015-05-29 20:56:13 +0300 Timo Sirainen <tss@iki.fi> (9b9db49)

    auth: Added unit test for auth %variable expansion.


M	src/auth/Makefile.am
A	src/auth/test-auth-request-var-expand.c

2015-05-29 20:55:58 +0300 Timo Sirainen <tss@iki.fi> (de2cba0)

    auth: Make sure %{mech} and %{session} is escaped in %var expansion. %{mech}
    is already very trusted and %{session} should be only from trusted sources
    as well, so this doesn't fix any actual security holes. They are also
    unlikely to have ever even been used in anything that requires escaping.


M	src/auth/auth-request-var-expand.c

2015-05-29 19:55:47 +0300 Timo Sirainen <tss@iki.fi> (4b7957c)

    auth: Moved var_expand() related code to its own file.


M	src/auth/Makefile.am
A	src/auth/auth-request-var-expand.c
A	src/auth/auth-request-var-expand.h
M	src/auth/auth-request.c
M	src/auth/auth-request.h

2015-05-29 19:11:50 +0300 Timo Sirainen <tss@iki.fi> (a1044a4)

    cassandra: Added log_level parameter to connect_string. Available values are
    critical, error, warn (default), info, debug and trace.


M	src/lib-sql/driver-cassandra.c

2015-05-29 18:22:17 +0300 Timo Sirainen <tss@iki.fi> (372a9dd)

    lib-fs: Updated fs_write_stream_*() comments related to ostream corking and
    nfinish.


M	src/lib-fs/fs-api.h

2015-05-29 17:51:21 +0300 Timo Sirainen <tss@iki.fi> (9750790)

    lib-fs: fs_write_stream_abort() now ignores missing o_stream_nfinish() call


M	src/lib-fs/fs-api.c

2015-05-29 11:50:18 +0300 Timo Sirainen <tss@iki.fi> (04f70d9)

    fts: If precaching fails, stop precaching the rest of the mails. If there
    are a lot of mails to be precached, this could mean that the precaching is
    attempted for a long time and every one of them fails the same way.


M	src/plugins/fts/fts-storage.c

2015-05-29 11:08:29 +0300 Timo Sirainen <tss@iki.fi> (2a0c3f9)

    dovecot.m4: If run-test.sh fails, print the failing command to stderr.
    Currently otherwise the way Dovecot tests are run it's not clearly visible.


M	dovecot.m4

2015-05-29 10:43:38 +0300 Timo Sirainen <tss@iki.fi> (68aaffc)

    dovecot.m4: If NOVALGRIND environment is set, don't run tests via valgrind
    in "make check"


M	dovecot.m4

2015-05-29 07:03:15 +0300 Timo Sirainen <tss@iki.fi> (af8e972)

    lib-fs: fs_write_stream() now automatically corks the ostream and uncorks at
    _finish().


M	src/lib-fs/fs-api.c

2015-05-29 05:43:25 +0300 Timo Sirainen <tss@iki.fi> (e7f8009)

    fts: If last-uid lookup fails, return "Internal error" instead of "BUG" to
    client.


M	src/plugins/fts/fts-storage.c

2015-05-25 11:50:48 -0400 Timo Sirainen <tss@iki.fi> (a6bb10d)

    lib: Avoid race conditions in mkdir*() if directory is being deleted at the
    same time. Mainly this allows the call to return failure silently without
    logging unnecessary errors.


M	src/lib/mkdir-parents.c

2015-05-25 11:35:53 -0400 Timo Sirainen <tss@iki.fi> (da3aebb)

    log: read() errors weren't logged.


M	src/log/log-connection.c

2015-05-25 14:27:22 +0000 Pascal Volk <user@localhost.localdomain.org> (fc4f535)

    systemd service: Fixed typos in the comment section. The settings for the
    file descriptor limit is LimitNOFILE. Removed quotes around the value
    infinity. Otherwise systemd will fail to parse that resource value.


M	dovecot.service.in

2015-05-17 11:54:42 +0000 Pascal Volk <user@localhost.localdomain.org> (b00fbdb)

    systemd: Small improvements to the unit configuration file:

       * Added Documentation URIs
      * Added ExecReload, to reload the config instead of restarting
      * Added a comment for modifying/extending the unit file.

M	dovecot.service.in

2015-05-24 17:55:33 -0400 Timo Sirainen <tss@iki.fi> (96df95e)

    doveadm user: Don't change privileges when looking up users. We don't need
    to and it might fail.


M	src/doveadm/doveadm-auth.c

2015-05-24 17:50:26 -0400 Timo Sirainen <tss@iki.fi> (b427713)

    lib-storage: If no namespaces were defined, the autocreated namespace
    settings were a bit wrong.


M	src/lib-storage/mail-namespace.c

2015-05-24 17:40:53 -0400 Timo Sirainen <tss@iki.fi> (d6601a0)

    lib-storage: If session_id isn't given, generate a new one. This is useful
    for tracking logs written by services that aren't directly related to any
    specific user session.


M	src/lib-storage/mail-storage-service.c

2015-05-24 16:13:57 -0400 Timo Sirainen <tss@iki.fi> (3079d05)

    lib-index: Unit test fix.


M	src/lib-index/test-mail-index-transaction-update.c

2015-05-24 13:40:46 -0400 Timo Sirainen <tss@iki.fi> (cac6b8b)

    lib: file_lock_try_update() comment updated. It should possibly be removed
    entirely from the API.


M	src/lib/file-lock.h

2015-05-24 13:24:19 -0400 Timo Sirainen <tss@iki.fi> (715fa0c)

    lib: file_create_locked() lock method is now configurable


M	src/lib/file-create-locked.c
M	src/lib/file-create-locked.h

2015-05-24 13:22:56 -0400 Timo Sirainen <tss@iki.fi> (799b19b)

    lib: file_create_locked() was leaking fds and locks.


M	src/lib/file-create-locked.c

2015-05-23 19:21:10 -0400 Timo Sirainen <tss@iki.fi> (6307daf)

    lib: file_create_locked() no longer logs an error if temp file is deleted
    under it.


M	src/lib/file-create-locked.c

2015-05-23 16:51:52 -0400 Timo Sirainen <tss@iki.fi> (d32fce8)

    lib: file_create_locked() wasn't deleting the temp file after successful
    link()


M	src/lib/file-create-locked.c

2015-05-23 16:41:34 -0400 Timo Sirainen <tss@iki.fi> (a63907c)

    lib: Added file_create_locked()


M	src/lib/Makefile.am
A	src/lib/file-create-locked.c
A	src/lib/file-create-locked.h

2015-05-22 19:07:56 -0400 Timo Sirainen <tss@iki.fi> (e9b6973)

    auth: Don't crash if trying to add password with TAB or LF to auth cache.
    This would happen only if the passwords were stored as plaintext in passdb
    and the valid password actually contained TAB or LF.


M	src/auth/auth-request.c

2015-05-22 16:37:07 -0400 Timo Sirainen <tss@iki.fi> (01e29d9)

    lib-index: Added asserts to make sure invalid extension records aren't
    written to log.


M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-update.c

2015-05-21 22:41:43 -0400 Timo Sirainen <tss@iki.fi> (2e5170d)

    fts: Fixed fts_enforced=yes when it has to wait for indexing to finish


M	src/plugins/fts/fts-storage.c

2015-05-21 22:20:10 -0400 Timo Sirainen <tss@iki.fi> (0211537)

    fts: Added fts_enforced setting to disable fallbacking to slow search on
    errors.


M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h

2015-05-21 22:03:10 -0400 Timo Sirainen <tss@iki.fi> (3e786e2)

    lib-fts: ICU normalization changes some characters to spaces - remove them.
    We don't really want to add spaces to our index. It would be nice if the
    words between spaces were actually split to different tokens, but that's
    more of the fts-tokenizer's job and at filter stage that's probably not
    wanted anymore.


M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/test-fts-filter.c

2015-05-21 08:38:56 -0400 Timo Sirainen <tss@iki.fi> (091a2de)

    lib: Cork connection output while handling input


M	src/lib/connection.c

2015-05-21 06:35:59 -0400 Timo Sirainen <tss@iki.fi> (72c4ef3)

    lib-fts: Fixed handling tokens that contain only apostrophes


M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/test-fts-tokenizer.c

2015-05-21 06:29:15 -0400 Teemu Huovila <teemu.huovila@dovecot.fi> (0c5854b)

    lib-fts: Fix simple tokenizer apostrophe handling. Apostrophes and quotation
    marks are now treated as word breaks, except U+0027 between non-wordbrek
    characters. The characters U+2019 and U+FF07 are transformed to U+0027
    before processing.


M	src/lib-fts/fts-tokenizer-generic-private.h
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/test-fts-tokenizer.c
M	src/lib-fts/word-properties.pl

2015-05-21 06:17:32 -0400 Teemu Huovila <teemu.huovila@dovecot.fi> (6018cfb)

    lib-fts: Fix tr29 tokenizer apostrophe handling. U+0027, which is called
    Single Quote in tr29, was not properly handled as a word boundary.


M	src/lib-fts/fts-tokenizer-generic.c

2015-05-18 14:53:52 +0300 Timo Sirainen <tss@iki.fi> (98ed0b2)

    lib-fts: Partially reverted d097a9779c37 - don't use lib_atexit() Because
    fts is loaded as plugin lib_atexit() is called after the plugin is already
    unloaded, so it crashes.


M	src/lib-fts/fts-filter-normalizer-icu.c

2015-05-18 07:49:15 -0400 Timo Sirainen <tss@iki.fi> (a5ddfd7)

    director: Added "up" vs "down" states and doveadm director up/down commands.
    These commands are intended to be used by automated watchdogs that detect if
    backends are up or down. This way the vhost count doesn't get forgotten
    after server goes down. It also means that admin can manually take down a
    server by setting its vhost count to 0 without the watchdog automatically
    bringing it back up.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/mail-host.c
M	src/director/mail-host.h
M	src/doveadm/doveadm-director.c

2015-05-18 13:56:07 +0300 Timo Sirainen <tss@iki.fi> (f3779c0)

    lib-charset: test-charset unit test - Don't use invalid UTF-8 text in source
    code


M	src/lib-charset/test-charset.c

2015-05-18 06:53:20 -0400 Timo Sirainen <tss@iki.fi> (b459855)

    lib-fts: Fixed memory leaks in test-fts-filter unit test


M	src/lib-fts/test-fts-filter.c

2015-05-18 06:51:24 -0400 Timo Sirainen <tss@iki.fi> (156027e)

    lib-fts: Call u_clean() at deinit to free up all of libicu's memory.


M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/test-fts-icu.c

2015-05-18 06:46:32 -0400 Timo Sirainen <tss@iki.fi> (5ae9745)

    lib-fts: test-fts-icu memory leak fix


M	src/lib-fts/test-fts-icu.c

2015-05-18 06:37:28 -0400 Timo Sirainen <tss@iki.fi> (6eca434)

    fts + lib-fts: Fixed crash with some search queries that contained
    uninitialized search args.


M	src/plugins/fts/fts-search-args.c

2015-05-18 06:36:56 -0400 Timo Sirainen <tss@iki.fi> (e614fad)

    lib-storage: Added mail_search_init/deinit_arg() For forcibly
    initializing/deinitializing search args.


M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h

2015-05-18 06:21:50 -0400 Timo Sirainen <tss@iki.fi> (8d5eb4f)

    lib-storage: Cleanup - separate search arg values that are set by
    mail_search_init()


M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search-args-imap.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h

2015-05-17 00:51:50 +0300 Timo Sirainen <tss@iki.fi> (2d7ec47)

    lib-mail: Make sure iconv state is reset between MIME parts.


M	src/lib-mail/message-decoder.c

2015-05-16 18:47:20 +0300 Timo Sirainen <tss@iki.fi> (bf698b9)

    lib-fts: Rewrite ICU handling functions. Some of the changes:  - Use buffers
    instead of allocating everything from data stack.  - Optimistically attempt
    to write the data directly to the buffers without first calculating their
    size. Grow the buffer if it doesn't fit first.  - Use u_strFromUTF8Lenient()
    instead of u_strFromUTF8(). Our input is already supposed to be valid UTF-8,
    although we don't check if all code points are valid, while u_strFromUTF8()
    does check them and return failures. We don't really care about if code
    points are valid or not and u_strFromUTF8Lenient() passes through
    everything.

    Added unit tests to make sure all the functions work as intended and all the 
    UTF-8 input passes through them successfully.

M	src/lib-fts/Makefile.am
M	src/lib-fts/fts-filter-normalizer-icu.c
A	src/lib-fts/fts-icu.c
A	src/lib-fts/fts-icu.h
M	src/lib-fts/test-fts-filter.c
A	src/lib-fts/test-fts-icu.c

2015-05-16 18:41:44 +0300 Timo Sirainen <tss@iki.fi> (e915ba8)

    lib: Added buffer_get_writable_size()


M	src/lib/buffer.c
M	src/lib/buffer.h

2015-05-16 18:20:08 +0300 Timo Sirainen <tss@iki.fi> (0983b24)

    fts: Avoid excessive data stack usage with lib-fts


M	src/plugins/fts/fts-build-mail.c

2015-05-16 13:50:48 +0300 Timo Sirainen <tss@iki.fi> (b1b3d99)

    lib-charset: Fixed compile warning caused by earlier commit. This
    UNICODE_REPLACEMENT_CHAR_UTF8 part of the change was actually supposed to be
    a separate commit..


M	src/lib-charset/charset-iconv.c

2015-05-16 13:20:22 +0300 Timo Sirainen <tss@iki.fi> (c8b84f0)

    lib: Added UNICODE_REPLACEMENT_CHAR_UTF8


M	src/lib/unichar.h

2015-05-16 12:51:08 +0300 Timo Sirainen <tss@iki.fi> (04e66ac)

    lib: Added p_memdup()


M	src/lib/strfuncs.c
M	src/lib/strfuncs.h

2015-05-16 12:46:38 +0300 Timo Sirainen <tss@iki.fi> (9366765)

    lib-charset: Added a minimal unit test


M	src/lib-charset/Makefile.am
M	src/lib-charset/charset-iconv.c
A	src/lib-charset/test-charset.c

2015-05-16 11:47:09 +0300 Timo Sirainen <tss@iki.fi> (461b1f9)

    imap: Fixed crash in FETCH RFC822* caused by earlier commit


M	src/imap/imap-fetch-body.c

2015-05-15 21:36:07 +0300 Timo Sirainen <tss@iki.fi> (5c4d9ba)

    replication plugin: s/transction/transaction/ in debug log messages


M	src/plugins/replication/replication-plugin.c

2015-05-15 16:50:27 +0300 Timo Sirainen <tss@iki.fi> (db8ca44)

    doveadm director flush: Unless -F parameter is used, do the flush by moving
    users. User moving causes the users to be properly kicked out of the old
    backends before new connections are made to the new backends. This way the
    user isn't accessed simultaneously by different backends.


M	src/doveadm/doveadm-director.c

2015-05-15 16:46:14 +0300 Timo Sirainen <tss@iki.fi> (8a1e199)

    lib-master: Added data stack frames to handling IPC input.


M	src/lib-master/ipc-client.c

2015-05-15 16:45:14 +0300 Timo Sirainen <tss@iki.fi> (7bccaec)

    director: Added HOST-RESET-USERS command to move users to their
    hash-assigned hosts.


M	src/director/doveadm-connection.c

2015-05-15 16:44:45 +0300 Timo Sirainen <tss@iki.fi> (5c1733e)

    director: Moving a user to another host sometimes caused the move to fail.
    It could have given "User hash .. is being redirected to two hosts" error
    and afterwards moved the user back to its original host.


M	src/director/director-connection.c
M	src/director/user-directory.h

2015-05-15 14:55:21 +0300 Timo Sirainen <tss@iki.fi> (760245e)

    imap: Added %{deleted}, %{expunged} and %{trashed} to imap_logout_format


M	doc/example-config/conf.d/20-imap.conf
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-store.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-expunge.c
M	src/imap/imap-expunge.h

2015-05-15 14:35:01 +0300 Timo Sirainen <tss@iki.fi> (defeb23)

    Added %{fetch_hdr/body_count/bytes} variables to imap_logout_format


M	doc/example-config/conf.d/20-imap.conf
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.h

2015-05-15 14:34:54 +0300 Timo Sirainen <tss@iki.fi> (bbb5807)

    lib-imap-storage: Added imap_msgpart_contains_body()


M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h

2015-05-15 14:03:02 +0300 Timo Sirainen <tss@iki.fi> (8065a71)

    Added signature for changeset 917d027836d0


M	.hgsigs

2015-05-15 14:02:58 +0300 Timo Sirainen <tss@iki.fi> (6673337)

    Added tag 2.2.18 for changeset 917d027836d0


M	.hgtags

2015-05-15 14:02:58 +0300 Timo Sirainen <tss@iki.fi> (f2a1dbe)

    Released v2.2.18.


M	NEWS
M	configure.ac

2015-05-15 13:55:46 +0300 Timo Sirainen <tss@iki.fi> (cf5533e)

    replication plugin: Fixed handling EAGAIN errors when writing to
    replication-pipe.


M	src/plugins/replication/replication-plugin.c

2015-05-15 13:54:49 +0300 Timo Sirainen <tss@iki.fi> (5b99436)

    replication plugin: Added debug logging when mail_debug=yes


M	src/plugins/replication/replication-plugin.c

2015-05-15 13:48:45 +0300 Timo Sirainen <tss@iki.fi> (c9ed5ca)

    replication plugin: A small optimization to check the user's "dsyncing"
    status only once.


M	src/plugins/replication/replication-plugin.c

2015-05-15 13:27:29 +0300 Timo Sirainen <tss@iki.fi> (af98c41)

    pgsql: Don't crash at disconnect/deinit if there's an unfinished query.


M	src/lib-sql/driver-pgsql.c

2015-05-15 13:07:27 +0300 Timo Sirainen <tss@iki.fi> (a99b64f)

    pgsql: Log a warning if DNS lookup takes too long. Don't include it in
    connect timeout.


M	src/lib-sql/driver-pgsql.c

2015-05-15 12:48:07 +0300 Timo Sirainen <tss@iki.fi> (a5563dc)

    Reverted d592417ec815 which added unnecessary code to Makefiles. The
    original problem it tried to solve was properly fixed by 46969c4cc57e. make
    will actually wait for processes to finish creating files before it
    continues to the next program that wants to access the file. As long as the
    dependencies are correct.


M	src/config/Makefile.am
M	src/lib-dict/Makefile.am
M	src/lib-fts/Makefile.am
M	src/lib-sql/Makefile.am
M	src/lib-storage/register/Makefile.am
M	src/lib/Makefile.am
M	src/plugins/quota/Makefile.am

2015-05-15 12:43:13 +0300 Timo Sirainen <tss@iki.fi> (06d1238)

    quota: Fixed dependency tracking in Makefile The earlier fix attempt was
    done by creating a .tmp file first, but that didn't really solve anything.


M	src/plugins/quota/Makefile.am

2015-05-15 11:15:50 +0300 Timo Sirainen <tss@iki.fi> (2a77044)

    sdbox: When hardlink-copying a mail in alt storage, keep it within the alt
    storage. Also make sure that the alt-flag is set correctly no matter where
    we copy the mail.


M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c

2015-05-14 23:49:12 +0300 Timo Sirainen <tss@iki.fi> (d4e8dbd)

    lib: Use /dev/zero instead of /dev/stderr in test-istream-unix unit test
    Some distros don't seem to allow opening stderr.


M	src/lib/test-istream-unix.c

2015-05-14 21:44:50 +0300 Timo Sirainen <tss@iki.fi> (4aeb50a)

    lib-imap: Fixed crash in IDLE for non-TCP connections.


M	src/lib-imap/imap-keepalive.c

2015-05-14 14:02:13 +0300 Timo Sirainen <tss@iki.fi> (e0d0e7f)

    lib-fts: Fixed test-fts-filter when building without libstemmer


M	src/lib-fts/test-fts-filter.c

2015-05-14 12:36:38 +0300 Matti Hamalainen <ccr@tnsp.org> (69b435c)

    configure: Use consistent quotation for AC_DEFINEs as per autoconf
    recommendations. Also fix one minor typo.


M	configure.ac

2015-05-14 13:33:59 +0300 Timo Sirainen <tss@iki.fi> (1d132fe)

    pgsql: Include connect state string on connect failure errors.


M	src/lib-sql/driver-pgsql.c

2015-05-14 11:27:04 +0300 Timo Sirainen <tss@iki.fi> (629cb30)

    lib-lda: Added missing include file. This fixes building Pigeonhole in some
    systems.


M	src/lib-lda/mail-deliver.h

2015-05-14 11:26:00 +0300 Timo Sirainen <tss@iki.fi> (973c8fc)

    director: UNIX auth sockets were wrongly detected as doveadm or ring
    sockets. A workaround would be to use login/director-auth socket name
    instead of login/director.


M	src/director/main.c

2015-05-13 21:35:56 +0300 Timo Sirainen <tss@iki.fi> (e5fcfef)

    fts-lucene: Removed dead code Found by Coverity


M	src/plugins/fts-lucene/fts-backend-lucene.c

2015-05-13 20:47:35 +0300 Timo Sirainen <tss@iki.fi> (b9495c9)

    lib-fts: Makefile compiling dependency fix


M	src/lib-fts/Makefile.am

2015-05-13 19:45:11 +0300 Timo Sirainen <tss@iki.fi> (642f95b)

    Added signature for changeset 166106aaefc5


M	.hgsigs

2015-05-13 19:45:07 +0300 Timo Sirainen <tss@iki.fi> (28ce7d8)

    Added tag 2.2.17 for changeset 166106aaefc5


M	.hgtags

2015-05-13 19:45:07 +0300 Timo Sirainen <tss@iki.fi> (17c41e5)

    Released v2.2.17.


M	NEWS
M	configure.ac

2015-05-13 19:36:29 +0300 Timo Sirainen <tss@iki.fi> (7fb35b3)

    lib-lda: Don't crash if postmaster_address is given as command line
    parameter.


M	src/lib-lda/lda-settings.c

2015-05-13 19:26:45 +0300 Timo Sirainen <tss@iki.fi> (f2b4fd3)

    mbox: If we notice our internal state is wrong, avoid further corruption by
    returning error.


M	src/lib-storage/index/mbox/mbox-sync-rewrite.c

2015-05-13 19:24:55 +0300 Timo Sirainen <tss@iki.fi> (fcc2880)

    mbox: Fixed corruption in some usage patterns. Something like:  - first mail
    is being expunged  - other mails are being rewritten and they get their
    space from the    expunged mail  - there's not enough space for the last
    mail to get space  - we add more space  - we'll now need to use up the
    space. We can't just decide to mark the    mails dirty.


M	src/lib-storage/index/mbox/mbox-sync.c

2015-05-13 17:16:21 +0300 Timo Sirainen <tss@iki.fi> (f7fa93f)

    fts-solr: Fixed memory leak at user deinit.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-solr/solr-connection.h

2015-05-13 16:54:27 +0300 Timo Sirainen <tss@iki.fi> (c9445d1)

    fts-solr: Crashfixes


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-solr/solr-connection.h

2015-05-13 16:46:14 +0300 Timo Sirainen <tss@iki.fi> (d2f1759)

    fts-solr: Don't update "last indexed UID" if we couldn't actually add the
    mails to Solr.


M	src/plugins/fts-solr/fts-backend-solr.c

2015-05-13 16:22:27 +0300 Timo Sirainen <tss@iki.fi> (db3b95d)

    director: Added "authreply" socket type. This allows defining a socket,
    which receives auth replies. Director then adds the "host" field to it if
    it's missing and returns back the original string. The idea is that
    eventually a director ring could be running independently from Dovecot
    proxies.


M	src/director/login-connection.c
M	src/director/login-connection.h
M	src/director/main.c

2015-05-13 15:59:48 +0300 Timo Sirainen <tss@iki.fi> (4ae5f4a)

    director: Removed accidentally committed debug log message


M	src/director/main.c

2015-05-13 15:47:14 +0300 Timo Sirainen <tss@iki.fi> (cf89092)

    lib-master: If executing doveconf, use master_service_settings_input.service
    for filter Instead of hardcoding to the master_service->name, which may be
    different. This fixes reading protocol sieve {} settings when if managesieve
    was reading settings via doveconf (= executed from command line).


M	src/lib-master/master-service-settings.c

2015-05-13 15:33:27 +0300 Timo Sirainen <tss@iki.fi> (6468191)

    director: Cleanup for director socket type configuration. It's now possible
    to use any type of a socket for inet listeners by specifying the name for
    the listener. The available types are: auth (default), userdb, ring (=
    director<->director connection), admin/doveadm. This change should be
    backwards compatible with previous configuration. This setting also
    deprecates director_doveadm_port setting.


M	src/director/main.c

2015-05-13 15:32:54 +0300 Timo Sirainen <tss@iki.fi> (7f1b897)

    lib-master: Added master_service_get_socket_name()


M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2015-05-13 13:57:24 +0300 Timo Sirainen <tss@iki.fi> (2cc34f3)

    director: Minor code cleanup - allow access to auth connection's ostream
    directly.


M	src/director/auth-connection.c
M	src/director/auth-connection.h
M	src/director/login-connection.c

2015-05-13 13:15:57 +0300 Timo Sirainen <tss@iki.fi> (2cd0459)

    director: Reverted previous e178413a905d commit after all - do it a bit
    differently.


M	src/director/auth-connection.c
M	src/director/auth-connection.h
M	src/director/login-connection.c

2015-05-13 12:24:02 +0300 Timo Sirainen <tss@iki.fi> (1f2f38f)

    Added quota-clone plugin.


M	NEWS
M	configure.ac
M	src/plugins/Makefile.am
A	src/plugins/quota-clone/Makefile.am
A	src/plugins/quota-clone/quota-clone-plugin.c
A	src/plugins/quota-clone/quota-clone-plugin.h

2015-05-13 05:34:16 +0300 Timo Sirainen <tss@iki.fi> (b816cad)

    lib-sql: sqlite and cassandra libs were mixed up in the Makefile


M	src/lib-sql/Makefile.am

2015-05-13 05:25:31 +0300 Timo Sirainen <tss@iki.fi> (0388fd5)

    director: Added a new DIRECTOR-LOOKUP command that auth connections can use.
    The parameters are the same as what auth lookup would receive from auth
    process. So the idea is that a proxy could do an auth lookup, then forward
    the reply to director, which would return back the updated reply with the
    host field added.


M	src/director/auth-connection.c
M	src/director/auth-connection.h
M	src/director/login-connection.c

2015-05-13 05:22:22 +0300 Timo Sirainen <tss@iki.fi> (336cdc9)

    director: Don't send DIRECTOR command infinitely in loop if that director
    got disconnected.


M	src/director/director-connection.c

2015-05-13 04:11:34 +0300 Timo Sirainen <tss@iki.fi> (ece0a20)

    director: Include useful statistics in process title.


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.h
M	src/director/main.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2015-05-13 04:10:53 +0300 Timo Sirainen <tss@iki.fi> (3411522)

    director: Fixed crash if director sent invalid data too early.


M	src/director/director-connection.c

2015-05-13 04:10:18 +0300 Timo Sirainen <tss@iki.fi> (d3ee83b)

    director: If we disconnect a director, pass the reason all the way to
    deinit's debug logging.


M	src/director/director-connection.c

2015-05-13 04:07:46 +0300 Timo Sirainen <tss@iki.fi> (447653a)

    director: Improved debug logging about connecting to another director.


M	src/director/director.c

2015-05-13 00:33:18 +0300 Timo Sirainen <tss@iki.fi> (ac393b4)

    Make static analyzer happier.


M	src/doveadm/doveadm-dict.c

2015-05-12 23:06:33 +0300 Timo Sirainen <tss@iki.fi> (0ac5243)

    Added signature for changeset 2c1ce55de520


M	.hgsigs

2015-05-12 23:06:30 +0300 Timo Sirainen <tss@iki.fi> (331e449)

    Added tag 2.2.17.rc2 for changeset 2c1ce55de520


M	.hgtags

2015-05-12 23:06:30 +0300 Timo Sirainen <tss@iki.fi> (adaa511)

    Released v2.2.17.rc2.


M	NEWS
M	configure.ac

2015-05-12 21:58:03 +0300 Timo Sirainen <tss@iki.fi> (cb3ab2f)

    lib: connection API: Added delayed_unix_client_connected_callback setting.
    092a51d80bad commit changed this functionality first to fix lib-http code,
    but it broke other code. 1fac17a2bc53 reversed the original behavior. This
    change allows either behavior optionally.


M	src/lib/connection.c
M	src/lib/connection.h

2015-05-12 21:52:07 +0300 Timo Sirainen <tss@iki.fi> (f79ba71)

    doveadm fs: Improved error message logging.


M	src/doveadm/doveadm-fs.c

2015-05-12 19:43:48 +0300 Timo Sirainen <tss@iki.fi> (90de164)

    doveadm dict iter: Added -1 parameter to enable DICT_ITERATE_FLAG_EXACT_KEY


M	src/doveadm/doveadm-dict.c

2015-05-12 19:43:25 +0300 Timo Sirainen <tss@iki.fi> (062ee00)

    dict-sql: Fixed non-recursive iteration. If path has e.g. "a/$var/b/$var2"
    and we're iterating "a/", we shouldn't return anything under "a/*/b/".


M	src/lib-dict/dict-sql.c

2015-05-12 19:14:13 +0300 Timo Sirainen <tss@iki.fi> (7fa451b)

    cassandra: Leave consistency to default if it's not specified in config.


M	src/lib-sql/driver-cassandra.c

2015-05-12 19:13:31 +0300 Timo Sirainen <tss@iki.fi> (038b90b)

    lib: connection API was unnecessarily delaying client_connected() calls for
    UNIX sockets.


M	src/lib/connection.c

2015-05-12 19:12:34 +0300 Timo Sirainen <tss@iki.fi> (eee3785)

    doveadm: Register builtin dict drivers always at init


M	src/doveadm/doveadm.c

2015-05-12 19:12:11 +0300 Timo Sirainen <tss@iki.fi> (8ed4757)

    lib-dict: Allow registering builtin dict drivers multiple times.


M	src/lib-dict/dict-register.c

2015-05-12 18:16:54 +0300 Timo Sirainen <tss@iki.fi> (e07677b)

    lib-sql: Don't crash in Cassandra if connection to it failed.


M	src/lib-sql/driver-cassandra.c

2015-05-12 16:44:45 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (bd69de6)

    lib-fts: ICU normalizer code cleanup.

    Fold some long lines. Rename the internal struct to be more aligned with the
    other filters.

M	src/lib-fts/fts-filter-normalizer-icu.c

2015-05-12 16:12:29 +0300 Phil Carmody <phil@dovecot.fi> (91d2e56)

    lib-fts: autogenerate C arrays using perl

    The sh script had bashisms, the awk script crashed mawk, so let's try
    perl...

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-fts/Makefile.am
D	src/lib-fts/word-boundary-data.sh
D	src/lib-fts/word-break-data.sh
A	src/lib-fts/word-properties.pl

2015-05-12 12:45:34 +0300 Timo Sirainen <tss@iki.fi> (37a2e36)

    fs-compress: Added NOPLUGIN_LDFLAGS to Makefile for helping with linking


M	src/plugins/fs-compress/Makefile.am

2015-05-12 12:30:40 +0300 Timo Sirainen <tss@iki.fi> (3756060)

    lib-fts: .sh scripts weren't executable - changed them to be run via bash
    directly. Better to avoid relying on the executable bit.


M	src/lib-fts/Makefile.am

2015-05-12 12:20:56 +0300 Timo Sirainen <tss@iki.fi> (5d8dad0)

    lib-fts: Reverted e80969ea8684 which replaced .sh scripts with awk Bugs in
    older awk versions (used at least by Debian squeeze & wheezy) caused awk to
    crash while processing the script.


M	src/lib-fts/Makefile.am
D	src/lib-fts/word-boundary-data.awk
A	src/lib-fts/word-boundary-data.sh
D	src/lib-fts/word-break-data.awk
A	src/lib-fts/word-break-data.sh

2015-05-11 22:38:38 +0300 Timo Sirainen <tss@iki.fi> (412bd45)

    Makefile: Fixed build concurrency issues with lib-fts


M	src/lib-fts/Makefile.am

2015-05-11 22:37:21 +0300 Timo Sirainen <tss@iki.fi> (644e991)

    lib-fts: Replaced word-boundary/break-data.sh with more portable awk scripts
    Patch by Michael Grimm.


M	src/lib-fts/Makefile.am
A	src/lib-fts/word-boundary-data.awk
D	src/lib-fts/word-boundary-data.sh
A	src/lib-fts/word-break-data.awk
D	src/lib-fts/word-break-data.sh

2015-05-11 21:55:42 +0300 Timo Sirainen <tss@iki.fi> (b772ddf)

    lib-sql: Added support for Cassandra CQL as lib-sql backend. Implemented
    using DataStax's cpp-driver.

    Many things are still unimplemented. Column name specific functionality 
    isn't even  supported by the Cassandra library. So this can currently mainly 
    be used as one of the dict backends for some simple functionality.

M	configure.ac
M	src/lib-sql/Makefile.am
A	src/lib-sql/driver-cassandra.c

2015-05-11 21:48:45 +0300 Timo Sirainen <tss@iki.fi> (2e53e08)

    dict-sql: If DICT_ITERATE_FLAG_EXACT_KEY is used, use only the first found
    map.


M	src/lib-dict/dict-sql.c

2015-05-11 19:12:45 +0300 Timo Sirainen <tss@iki.fi> (76b4207)

    lib-dict: Added DICT_ITERATE_FLAG_EXACT_KEY flag. This is mainly useful with
    SQL for iterating through a result that has multiple rows.


M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-fs.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.h

2015-05-11 16:01:13 +0300 Timo Sirainen <tss@iki.fi> (f5b6f11)

    lib-fts: Fixed/improved test-fts-filter unit tests for previous changes.


M	src/lib-fts/test-fts-filter.c

2015-05-11 16:00:53 +0300 Timo Sirainen <tss@iki.fi> (bb726ed)

    lib-fts: normalizer-icu no longer returns empty tokens.


M	src/lib-fts/fts-filter-normalizer-icu.c

2015-05-11 16:00:21 +0300 Timo Sirainen <tss@iki.fi> (4d44a03)

    lib-fts: Added assert to fts_filter_filter() to make sure input token isn't
    empty


M	src/lib-fts/fts-filter.c

2015-05-11 14:42:18 +0300 Timo Sirainen <tss@iki.fi> (759c112)

    lib-fts: Fixed assert-crash in fts-tokenizer-generic


M	src/lib-fts/fts-tokenizer-generic.c

2015-05-11 14:35:49 +0300 Timo Sirainen <tss@iki.fi> (b04e76c)

    lib-fts: Test trailing "number." for TR29 in test-fts-tokenizer


M	src/lib-fts/test-fts-tokenizer.c

2015-05-11 14:34:50 +0300 Timo Sirainen <tss@iki.fi> (62fc0b4)

    lib-fts: Improved test-fts-tokenizer to run multiple text inputs


M	src/lib-fts/test-fts-tokenizer.c

2015-05-11 14:22:05 +0300 Timo Sirainen <tss@iki.fi> (47fb62a)

    lmtp: Earlier compiler warning fix broke compiling completely..


M	src/lmtp/commands.c

2015-05-11 14:10:24 +0300 Timo Sirainen <tss@iki.fi> (9bbc624)

    lib-fts: Added asserts to make sure we don't return empty tokens.


M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-tokenizer.c

2015-05-11 12:28:58 +0300 Timo Sirainen <tss@iki.fi> (f87938e)

    Compiler warning fixes


M	src/imap-urlauth/imap-urlauth.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/pop3/main.c

2015-05-11 12:27:39 +0300 Timo Sirainen <tss@iki.fi> (de05e7b)

    lmtp: chdir() to base_dir shouldn't fail - log an error if it does


M	src/lmtp/commands.c

2015-05-10 12:28:09 +0300 Timo Sirainen <tss@iki.fi> (45b0d8d)

    lib-index: If header is corrupted after syncing, log the reason why.


M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-sync-update.c

2015-05-10 12:05:06 +0300 Timo Sirainen <tss@iki.fi> (9bee6ca)

    fts: Fixed crash when not using lib-fts


M	src/plugins/fts/fts-build-mail.c

2015-05-10 11:20:37 +0300 Timo Sirainen <tss@iki.fi> (0d7dc1d)

    lib-http: http-server now always creates a payload istream, even empty one.
    This simplifies the caller's logic so that it doesn't need to explicitly
    check if payload is NULL everywhere.


M	src/lib-http/http-server-connection.c

2015-05-09 21:22:50 +0300 Timo Sirainen <tss@iki.fi> (ba57ea2)

    pop3-migration: Added more debug and error logging.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2015-05-09 20:29:55 +0300 Timo Sirainen <tss@iki.fi> (8b9e2a7)

    Added signature for changeset da685736985a


M	.hgsigs

2015-05-09 20:29:52 +0300 Timo Sirainen <tss@iki.fi> (157db84)

    Added tag 2.2.17.rc1 for changeset da685736985a


M	.hgtags

2015-05-09 20:29:52 +0300 Timo Sirainen <tss@iki.fi> (44a0465)

    Released v2.2.17.rc1.


M	NEWS
M	configure.ac

2015-05-09 20:26:06 +0300 Timo Sirainen <tss@iki.fi> (ba40be5)

    Moved fs-compress to a separate plugin directory. Mainly because I couldn't
    figure out how to make automake dependencies work on "make install" stage.
    It was trying to link fs-compress.so using -ldovecot-storage, but
    libdovecot-storage.so was also concurrently being installed.


M	configure.ac
M	src/lib-compression/Makefile.am
M	src/plugins/Makefile.am
A	src/plugins/fs-compress/Makefile.am
R100	src/lib-compression/fs-compress.c	src/plugins/fs-compress/fs-compress.c

2015-05-09 19:58:59 +0300 Timo Sirainen <tss@iki.fi> (8409959)

    Make Coverity happier.


M	src/lib-http/http-server-connection.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-mail/ostream-dot.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/maildir/maildir-uidlist.c

2015-05-09 19:57:28 +0300 Timo Sirainen <tss@iki.fi> (9c0cd05)

    quota-dict: It wasn't possible to use multiple quota settings. Found by
    Coverity


M	src/plugins/quota/quota-dict.c

2015-05-09 19:50:14 +0300 Timo Sirainen <tss@iki.fi> (7f29b32)

    anvil: Penalty tracking was moving last checksums wrongly with memcpy().
    Depending on the OS/etc this could have caused the checksum tracking to go
    wrong. Found by Coverity.


M	src/anvil/penalty.c

2015-05-09 19:41:45 +0300 Timo Sirainen <tss@iki.fi> (90f9536)

    doveadm-server: Fixed potential crash if doveadm client disconnected Found
    by Coverity


M	src/doveadm/server-connection.c

2015-05-09 19:39:39 +0300 Timo Sirainen <tss@iki.fi> (e4ba52b)

    doveadm: Removed unused doveadm_mailbox_find_and_sync() function


M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2015-05-09 19:35:31 +0300 Timo Sirainen <tss@iki.fi> (cbccc33)

    imap: Don't crash if APPEND command is given with invalid parameters. Found
    by Coverity.


M	src/imap/cmd-append.c

2015-05-09 19:31:17 +0300 Timo Sirainen <tss@iki.fi> (9bc1a7f)

    lib-mail: Improved istream-attachment-extractor error logging.


M	src/lib-mail/istream-attachment-extractor.c

2015-05-09 19:31:05 +0300 Timo Sirainen <tss@iki.fi> (2be6479)

    lib-mail: Fixed crash in istream-attachment-extractor error handling path


M	src/lib-mail/istream-attachment-extractor.c

2015-05-09 19:28:46 +0300 Timo Sirainen <tss@iki.fi> (73a7078)

    indexer-worker: Don't crash if we failed to get mailbox path. Found by
    Coverity


M	src/indexer/master-connection.c

2015-05-09 19:26:01 +0300 Timo Sirainen <tss@iki.fi> (8b1a9a4)

    lib-fts: Changed fts_tokenizer_next/final() to return error string. The
    current tokenizers can't fail, but if we're doing tokenization via external
    services they could fail.


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/fts-tokenizer-private.h
M	src/lib-fts/fts-tokenizer.c
M	src/lib-fts/fts-tokenizer.h
M	src/lib-fts/test-fts-tokenizer.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-search-args.c

2015-05-09 19:21:45 +0300 Timo Sirainen <tss@iki.fi> (56a21d5)

    lib-fts: Minor code cleanup - avoid functions always returning same value
    Makes it clearer to see in the code that the function can't return any
    failures.


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-generic.c

2015-05-09 19:14:07 +0300 Timo Sirainen <tss@iki.fi> (a9b3887)

    lib-fts: fts_language_list_init() API changed to return errors.


M	src/lib-fts/fts-language.c
M	src/lib-fts/fts-language.h
M	src/lib-fts/test-fts-language.c
M	src/plugins/fts/fts-user.c

2015-05-09 19:04:11 +0300 Timo Sirainen <tss@iki.fi> (0eef579)

    virtual: Don't crash if trying to save mail to a virtual mailbox without
    configured save-mailbox. Found by Coverity


M	src/plugins/virtual/virtual-save.c

2015-05-09 19:00:36 +0300 Timo Sirainen <tss@iki.fi> (a052f29)

    lib-fs: Minor code cleanup Both temp_output and super_output are NULL so it
    doesn't matter which we use, but this change makes it use the intended
    variable.


M	src/lib-fs/fs-metawrap.c

2015-05-09 18:53:02 +0300 Timo Sirainen <tss@iki.fi> (bfcd430)

    lib-compression: Fixed dependency tracking in Makefile


M	src/lib-compression/Makefile.am

2015-05-09 15:29:21 +0000 Pascal Volk <user@localhost.localdomain.org> (e7f1247)

    man: Added description of option `-F file'.


M	doc/man/Makefile.am
M	doc/man/doveadm-acl.1.in
M	doc/man/doveadm-altmove.1.in
M	doc/man/doveadm-batch.1.in
M	doc/man/doveadm-deduplicate.1.in
M	doc/man/doveadm-expunge.1.in
M	doc/man/doveadm-fetch.1.in
M	doc/man/doveadm-flags.1.in
M	doc/man/doveadm-force-resync.1.in
M	doc/man/doveadm-fts.1.in
M	doc/man/doveadm-import.1.in
M	doc/man/doveadm-index.1.in
M	doc/man/doveadm-mailbox.1.in
M	doc/man/doveadm-move.1.in
M	doc/man/doveadm-purge.1.in
M	doc/man/doveadm-quota.1.in
M	doc/man/doveadm-search.1.in
M	doc/man/doveadm-sync.1.in
A	doc/man/option-F-file.inc
M	doc/man/option-u-user.inc
M	doc/man/sed.sh

2015-05-09 18:28:04 +0300 Timo Sirainen <tss@iki.fi> (568fec5)

    lib-fts: Various improvements to test-fts-tokenizer


M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 18:00:58 +0300 Timo Sirainen <tss@iki.fi> (16dd1fd)

    lib-fts: Added fts_tokenizer_final() as a convenience wrapper.


M	src/lib-fts/fts-tokenizer.c
M	src/lib-fts/fts-tokenizer.h
M	src/plugins/fts/fts-search-args.c

2015-05-09 17:34:59 +0300 Timo Sirainen <tss@iki.fi> (868aa94)

    lib-fts: Fixed token truncation.


M	src/lib-fts/fts-tokenizer-generic.c

2015-05-09 17:07:32 +0300 Timo Sirainen <tss@iki.fi> (4a692df)

    lib-fts: Fixed compiling without libicu


M	src/lib-fts/fts-filter-normalizer-icu.c

2015-05-09 17:06:42 +0300 Timo Sirainen <tss@iki.fi> (041cb02)

    lib-storage: Run each storage hook inside its own data stack frame.


M	src/lib-storage/mail-storage-hooks.c

2015-05-09 17:05:17 +0300 Timo Sirainen <tss@iki.fi> (fe0dff6)

    fts: Renamed filter and tokenizer specific setting keys. Having the plural
    in the name didn't make a lot of sense, so all the settings are now:

     fts_filters = name1 name2
    fts_filters_<lang> = name3 name 4
    fts_filter_<name> = key1=value1
    fts_filter_<lang>_<name> = key2=value2

     fts_tokenizers = name1 name2
    fts_tokenizer_<name> = key1=value1

    So this also removes the confusion in settings if there existed a filter 
    with one of the language names.

M	src/plugins/fts/fts-user.c

2015-05-09 17:00:12 +0300 Timo Sirainen <tss@iki.fi> (fac865b)

    fts: Simplify error messages a little bit to be more consistent with other
    such errors. Only the setting name is really important.


M	src/plugins/fts/fts-user.c

2015-05-09 16:58:09 +0300 Timo Sirainen <tss@iki.fi> (0ebeb18)

    fts: Use key=value instead of "key value" settings for tokenizers and
    filters.


M	src/plugins/fts/fts-user.c

2015-05-09 15:11:48 +0300 Timo Sirainen <tss@iki.fi> (07dabfd)

    fts: If fts_filters setting doesn't exist, use built-in defaults.


M	src/plugins/fts/fts-user.c

2015-05-09 15:10:17 +0300 Timo Sirainen <tss@iki.fi> (57dc966)

    fts: Prefer language-specific filter settings over global fts_filters
    setting.


M	src/plugins/fts/fts-user.c

2015-05-09 15:07:13 +0300 Timo Sirainen <tss@iki.fi> (2bb1ef0)

    lib-fts: Minor code cleanups


M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h
M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-generic-private.h
M	src/lib-fts/fts-tokenizer.c
M	src/lib-fts/fts-tokenizer.h

2015-05-09 15:06:45 +0300 Timo Sirainen <tss@iki.fi> (34c7e8b)

    lib-fts: fts-tokenizer-generic-private.h had content that didn't really
    belog there.


M	src/lib-fts/fts-tokenizer-generic-private.h
M	src/lib-fts/fts-tokenizer-generic.c

2015-05-09 15:00:28 +0300 Timo Sirainen <tss@iki.fi> (61eb91e)

    lib-fts: Removed supports() function from filter API I think the original
    idea was that this could be used to automatically create filters for many
    languages, but this probably won't be needed or wanted.


M	src/lib-fts/fts-filter-lowercase.c
M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-private.h
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c

2015-05-09 14:56:33 +0300 Timo Sirainen <tss@iki.fi> (f5c0d5c)

    lib-fts: Removed tokenizer name macros from fts-tokenizer.h The tokenizers
    can be directly accessed via their class structs.


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/fts-tokenizer.h
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 14:55:47 +0300 Timo Sirainen <tss@iki.fi> (a46abae)

    lib-fts: Store pointers to fts_tokenizer classes instead of copying the
    data. The same reason as for doing this for fts-filter.


M	src/lib-fts/fts-tokenizer.c

2015-05-09 14:53:46 +0300 Timo Sirainen <tss@iki.fi> (b196541)

    lib-fts: test-fts-tokenizer cleanup - moved tokenizers_init/deinit() to be
    done globally


M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 14:50:10 +0300 Timo Sirainen <tss@iki.fi> (a7d8afa)

    lib-fts: Removed filter name macros from fts-filter.h The filters can be
    directly accessed via their class structs.


M	src/lib-fts/fts-filter-lowercase.c
M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/fts-filter.h
M	src/lib-fts/test-fts-filter.c

2015-05-09 14:49:20 +0300 Timo Sirainen <tss@iki.fi> (1ef271d)

    lib-fts: Store pointers to fts_filter classes instead of copying the data.
    Doesn't really matter, but it's a bit cleaner when fts_filter_find() returns
    the same pointer as the fts_filter class originally was.


M	src/lib-fts/fts-filter.c

2015-05-09 14:41:05 +0300 Timo Sirainen <tss@iki.fi> (60ba197)

    fts: Lowecase non-human language input while indexing.


M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/fts-user.h

2015-05-09 14:26:42 +0300 Timo Sirainen <tss@iki.fi> (acfcf88)

    lib-fts: Added "lowercase" filter. For now it handles only ASCII characters,
    but that's enough for our use.


M	src/lib-fts/Makefile.am
A	src/lib-fts/fts-filter-lowercase.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h
M	src/lib-fts/test-fts-filter.c

2015-05-09 14:09:37 +0300 Timo Sirainen <tss@iki.fi> (eac88e3)

    lib-fts: Removed "simple" normalizer. It translated input to titlecase,
    which wasn't suitable for snowball stemming that wanted lowercase input.
    Since that doesn't work, there's probably no good for the existence of this
    (perhaps in future it's replaced by unicode-aware lowercaser).


M	src/lib-fts/Makefile.am
D	src/lib-fts/fts-filter-normalizer-simple.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h

2015-05-09 14:19:48 +0300 Timo Sirainen <tss@iki.fi> (5916f19)

    lib-fts: Minor unit test cleanups


M	src/lib-fts/test-fts-filter.c

2015-05-09 13:57:41 +0300 Timo Sirainen <tss@iki.fi> (5ea079c)

    fts: Reset tokenizers before using them This is mainly needed if the
    previous tokenization had failed.


M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-search-args.c

2015-05-09 13:52:37 +0300 Timo Sirainen <tss@iki.fi> (2730605)

    lib-fts: Added fts_tokenizer_reset()


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/fts-tokenizer-private.h
M	src/lib-fts/fts-tokenizer.c
M	src/lib-fts/fts-tokenizer.h
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 13:46:37 +0300 Timo Sirainen <tss@iki.fi> (c4b772b)

    lib-fts: fts-tokenizer-address didn't reset state properly when input ended.


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 13:31:14 +0300 Timo Sirainen <tss@iki.fi> (0c827d2)

    fts: When tokenizing a search word, give "search" parameter to all the
    tokenizers.


M	src/lib-fts/fts-tokenizer-generic.c
M	src/plugins/fts/fts-user.c

2015-05-09 13:30:41 +0300 Timo Sirainen <tss@iki.fi> (aaed9e3)

    fts: Don't crash if search arg string expands to empty token list.


M	src/plugins/fts/fts-search-args.c

2015-05-09 13:20:29 +0300 Timo Sirainen <tss@iki.fi> (505bba1)

    lib-fts: Use case-sensitive settings comparisons in fts-tokenizer Dovecot in
    general doesn't allow case-insensitive settings.


M	src/lib-fts/fts-tokenizer-generic.c

2015-05-09 13:19:21 +0300 Timo Sirainen <tss@iki.fi> (d1356a7)

    lib-fts: Minor unit test fix - use case sensitive checks for word
    comparison.


M	src/lib-fts/test-fts-filter.c

2015-05-09 13:15:43 +0300 Timo Sirainen <tss@iki.fi> (1cc4d4d)

    lib-storage: mail_search_arg_dup() is now a public function.


M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h

2015-05-09 13:15:09 +0300 Timo Sirainen <tss@iki.fi> (e4bf76a)

    lib-fts: Implemented "search" parameter to fts-tokenizer-address.


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 13:01:45 +0300 Timo Sirainen <tss@iki.fi> (98fe03e)

    fts: If filtering fails during search arg expansion, fail the fts search.


M	src/plugins/fts/fts-search-args.c

2015-05-09 12:50:54 +0300 Timo Sirainen <tss@iki.fi> (1d8bcf1)

    lib-fts: Compiler warning fix when building without libicu


M	src/lib-fts/fts-filter-normalizer-icu.c

2015-05-09 12:50:11 +0300 Timo Sirainen <tss@iki.fi> (3743d05)

    lib-fts: Minor fts-tokenizer-address cleanups


M	src/lib-fts/fts-tokenizer-address.c

2015-05-09 12:48:13 +0300 Timo Sirainen <tss@iki.fi> (908c417)

    lib-fts: Removed explicit no_parent setting from fts-address-tokenizer It
    was used only by unit tests and we can check it without the setting as well.


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 12:41:59 +0300 Timo Sirainen <tss@iki.fi> (12bc47b)

    lib-fts: Use rfc822-parser in fts-tokenizer-address instead of duplicating
    its code.


M	src/lib-fts/Makefile.am
M	src/lib-fts/fts-tokenizer-address.c

2015-05-09 12:39:21 +0300 Timo Sirainen <tss@iki.fi> (173d34a)

    lib-fts: Don't treat empty domains as valid addresses. This actually pretty
    much reverts the previous patch and just fixes the original code's
    chars_after_at() to work correctly. Also renamed the function to make it a
    bit clearer what was intended.


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 12:32:46 +0300 Timo Sirainen <tss@iki.fi> (81fd40d)

    lib-fts: Removed unnecessary code from fts-address-tokenizer.
    chars_after_at() was only used to check if local-part was empty, but it was
    checked at a state where it never could have been empty.


M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 12:01:42 +0300 Timo Sirainen <tss@iki.fi> (20f03fe)

    lib-fts: Various fixes and cleanups to stopwords filter. Most importantly
    words added to hash table needs to be allocated from the pool and not data
    stack.


M	src/lib-fts/fts-filter-stopwords.c

2015-05-09 12:04:56 +0300 Timo Sirainen <tss@iki.fi> (927f6e6)

    lib-fts: Assume that fts_language.name is always lowercased and has two
    letters. Anything else just unnecessarily complicates the code.


M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/fts-language.h
M	src/lib-fts/test-fts-filter.c

2015-05-09 11:57:40 +0300 Timo Sirainen <tss@iki.fi> (b58ad1c)

    lib-fts: Fixed test-fts-filter unit test to handle errors a bit better.


M	src/lib-fts/fts-filter.c
M	src/lib-fts/test-fts-filter.c

2015-05-09 11:46:09 +0300 Timo Sirainen <tss@iki.fi> (6111370)

    lib-fts: Changed filter's internal APIs to return error_r directly. It's not
    very safe to store strings allocated from data stack to any permanent
    structs.


M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-normalizer-simple.c
M	src/lib-fts/fts-filter-private.h
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h

2015-05-09 11:33:45 +0300 Timo Sirainen <tss@iki.fi> (c5c58fb)

    lib-fts: Snowball's sb_stemmer_stem() can only fail because it runs out of
    memory.


M	src/lib-fts/fts-filter-stemmer-snowball.c

2015-05-09 11:17:03 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (ade9b35)

    lib-fts: Improve using max_length in tr29 tokenizer


M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 11:16:22 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (78f87ea)

    lib-fts: Fixed using max_length setting in simple tokenizer


M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/test-fts-tokenizer.c

2015-05-09 11:15:50 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (50f659b)

    lib-fts: Default to simple tokenizer algorithm


M	src/lib-fts/fts-tokenizer-generic.c

2015-05-09 11:15:34 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (dfb9243)

    lib-fts: Delay stopwords filter full initialization until it's needed.


M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/test-fts-filter.c

2015-05-09 11:14:51 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (55be4b0)

    lib-fts: Delay snowball filter initialization until it's needed.


M	src/lib-fts/fts-filter-stemmer-snowball.c

2015-05-09 11:13:49 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (1d0f568)

    fts: Improve filter error handling.

    In lib-fts: Move error storage to the generic filter struct level. Change
    make_utf8 helper to void also.

    In fts: Add the error argument to _filter() calls.

M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-private.h
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h
M	src/lib-fts/test-fts-filter.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-search-args.c

2015-05-09 11:10:31 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (a53953d)

    lib-fts: Removed make_uchar() return value. It was already de facto
    meaningless, so best we remove it.


M	src/lib-fts/fts-filter-normalizer-icu.c

2015-05-09 11:09:37 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (f65a6ee)

    lib-fts: normalizer-icu now delays initialization of libicu. This way the
    normalizer can be quickly created even if it's never even used.


M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/test-fts-filter.c

2015-05-09 11:06:45 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (db090e2)

    fts: Change filter API to be able to return errors

    Modify fts_filter_filter() to return integer status codes. It returns 1 if a
    token was returned, 0 if it was filtered away and -1 on error.

M	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter-normalizer-simple.c
M	src/lib-fts/fts-filter-private.h
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/fts-filter-stopwords.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h
M	src/lib-fts/test-fts-filter.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-search-args.c

2015-05-09 11:05:04 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (3dc5a23)

    fts: Change tokenizer API to be able to return errors

    Modify fts_tokenizer_next() to return integer status codes. It returns 1 if
    a token was returned in *token_r, 0 if more input is needed and -1 on error.

M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer-generic.c
M	src/lib-fts/fts-tokenizer-private.h
M	src/lib-fts/fts-tokenizer.c
M	src/lib-fts/fts-tokenizer.h
M	src/lib-fts/test-fts-tokenizer.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-search-args.c

2015-05-09 11:03:21 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (957b0b4)

    fts: Replace '-' with '_' in tokenizer-specific fts_tokenizers_* settings


M	src/plugins/fts/fts-user.c

2015-05-09 11:02:22 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (4ef1f9f)

    fts: Create tokenizers differently

    Create tokenizers earlier. Create separate tokenizers for search and
    indexing. Enable configuration of tokenizers. Add some helpers in
    fts-tokenizer.h api. Change tokenizer unit tests to match those changes.

    lib-fts: Refactor lib-fts settings a bit

    Turned address tokenizer settings into "boolean" values. Changed have_parent
    to "no_parent" and added "search" setting. Added documentation in
    fts-tokenizer.h. Change unit tests accordingly.

M	src/lib-fts/fts-tokenizer-address.c
M	src/lib-fts/fts-tokenizer.c
M	src/lib-fts/fts-tokenizer.h
M	src/lib-fts/test-fts-tokenizer.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search-args.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/fts-user.h

2015-05-09 10:53:25 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (09aed88)

    fts: Create filters earlier

    This builds on the assumption that early initialization will be made less
    costly, in a coming change.

M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-search-args.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/fts-user.h

2015-05-08 16:00:16 +0300 Timo Sirainen <tss@iki.fi> (6f29823)

    fts: Fixed handling NOT when using lib-fts


M	src/plugins/fts/fts-search-args.c

2015-05-08 14:47:26 +0300 Timo Sirainen <tss@iki.fi> (344bb4a)

    dsync: Stop running if SIGINT/SIGTERM is received.


M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2015-05-08 10:44:18 +0300 Timo Sirainen <tss@iki.fi> (3ee40ec)

    Moved fs-compress from lib-fs to lib-compression. This solves build ordering
    issues.


M	src/lib-compression/Makefile.am
R100	src/lib-fs/fs-compress.c	src/lib-compression/fs-compress.c
M	src/lib-fs/Makefile.am

2015-05-07 20:35:23 +0300 Timo Sirainen <tss@iki.fi> (29b8c2b)

    lib-fs: Fixed fs-compress code to actually build and run. It's a plugin
    (because it depends on extra compression libraries). We want to register it
    only when it's explicitly attempted to be used, not before.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-compress.c

2015-05-07 20:25:44 +0300 Timo Sirainen <tss@iki.fi> (d0c3964)

    lib-fs: Added fs-compress wrapper. Future TODO could include automatically
    detecting the format of the input file, but this should be optional.


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
A	src/lib-fs/fs-compress.c

2015-05-07 18:21:35 +0300 Timo Sirainen <tss@iki.fi> (441f0e0)

    lib-storage: Fixed LAYOUT=imapdir to work again Patch by Jason Gunthorpe


M	src/lib-storage/list/mailbox-list-maildir.c

2015-05-07 18:04:33 +0300 Timo Sirainen <tss@iki.fi> (a56fcfa)

    director: Fixed "doveadm director status <user>" lookup to return "Current"
    correctly.


M	src/director/doveadm-connection.c

2015-05-07 17:29:55 +0300 Timo Sirainen <tss@iki.fi> (2f41b2c)

    example-config: s/Recipient:/Received:/


M	doc/example-config/conf.d/20-lmtp.conf

2015-05-07 17:29:00 +0300 Timo Sirainen <tss@iki.fi> (8f2af06)

    exmaple-config: Added lmtp_hdr_delivery_address setting.


M	doc/example-config/conf.d/20-lmtp.conf

2015-05-07 17:18:44 +0300 Timo Sirainen <tss@iki.fi> (f0ecd92)

    auth: Added assert to make sure previous change is correct.


M	src/auth/auth-worker-client.c

2015-05-07 11:27:55 +0300 Timo Sirainen <tss@iki.fi> (3db05c8)

    auth: Fixed credentials lookups via auth-workers when no actual password was
    returned. For example LDAP lookup with auth_bind=yes should still return any
    extra fields.


M	src/auth/auth-worker-client.c

2015-05-07 11:21:33 +0300 Timo Sirainen <tss@iki.fi> (0a66c12)

    ldap auth: If password is already verified (e.g. master user login), skip
    LDAP auth binding. This happens only if auth_bind_userdn isn't set, i.e. it
    only makes sense if the LDAP DN lookup also returns some extra fields.


M	src/auth/passdb-ldap.c

2015-05-07 00:01:16 +0300 Timo Sirainen <tss@iki.fi> (867c109)

    mbox: Added an extra assert


M	src/lib-storage/index/mbox/mbox-sync-rewrite.c

2015-05-07 00:01:08 +0300 Timo Sirainen <tss@iki.fi> (f76f483)

    mbox: Fixed crash/corruption in some situations when the first mail was
    expunged. This could be reproduced with default mbox settings, IMAP session
    that does  - STORE 1 +FLAGS \DELETED  - EXPUNGE

    With mbox containing:

    === From root@example.com  Tue Jan 13 10:18:16 2015

    a

    From root@example.com  Tue Jan 13 10:18:20 2015

    a

    ===

M	src/lib-storage/index/mbox/mbox-sync.c

2015-05-06 19:50:23 +0300 Timo Sirainen <tss@iki.fi> (6ba5d73)

    imap: Don't advertise SPECIAL-USE if there are no such mailboxes configured.


M	configure.ac
M	src/imap/imap-client.c

2015-05-06 16:16:11 +0300 Timo Sirainen <tss@iki.fi> (d12ea92)

    dsync: Don't try to rename namespace roots. It'll just cause an
    assert-crash.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2015-05-06 16:01:45 +0300 Timo Sirainen <tss@iki.fi> (24072b4)

    doveadm: Changed -U to -F Otherwise -U collides with doveadm sync -U
    parameter. -F isn't currently used by anything.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c

2015-05-06 15:45:43 +0300 Timo Sirainen <tss@iki.fi> (f714110)

    doveadm: Added -U <file> parameter for executing the command for all the
    users in the file. This is similar to -A parameter, but instead of getting
    the list of users from userdb they are read from the file. The file contains
    one username per line.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2015-05-06 15:42:31 +0300 Timo Sirainen <tss@iki.fi> (98e8f95)

    doveadm-server: Invalid parameters for some commands caused crash at deinit
    handlers. deinit() can be called even if init() was never called.


M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.h

2015-05-06 14:14:09 +0300 Timo Sirainen <tss@iki.fi> (95d41d2)

    script: Another comment update about protocol - the previous one was wrong.


M	src/util/script.c

2015-05-06 11:10:09 +0300 Timo Sirainen <tss@iki.fi> (7439b55)

    script: Updated comment to describe the current script protocol.


M	src/util/script.c

2015-05-05 23:07:03 +0300 Timo Sirainen <tss@iki.fi> (ab1e085)

    doveadm fs delete: Fixed function return type


M	src/doveadm/doveadm-fs.c

2015-05-05 16:24:07 +0300 Timo Sirainen <tss@iki.fi> (e0f57c5)

    lib-storage: After mailbox_list_init_fs() is finished, notify fs about it.
    Creating a separate fs_init_finish() would perhaps have been clearner, but
    it's a lot more work and usually isn't even necessary for most backends. So
    I simply chose to use fs_get_properties() which is a fast call in all fs
    backends and the few ones that actually care about the initialization finish
    can then do their work in there.


M	src/lib-storage/mailbox-list.c

2015-05-05 16:18:21 +0300 Timo Sirainen <tss@iki.fi> (c027359)

    fts-lucene: Removed lazy initialization code. This is no longer needed after
    the previous fts commit.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2015-05-05 16:17:14 +0300 Timo Sirainen <tss@iki.fi> (11f12ca)

    fts: Initialize fts backend in mail_namespaces_added(), not in
    mailbox_list_created() This way the storage has already been created by the
    time fts initialization starts, which simplifies things.


M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h

2015-05-05 16:14:07 +0300 Timo Sirainen <tss@iki.fi> (a41f6dd)

    lib-storage: mailbox_list_fs_get_list() shouldn't crash if fs wasn't created
    by mailbox_list_init_fs()


M	src/lib-storage/mailbox-list.c

2015-05-05 14:16:31 +0300 Timo Sirainen <tss@iki.fi> (917b4e1)

    auth: If passdb has non-matching allow_nets, don't fail the other passdb
    lookups also. We might want to use e.g.:

    passdb {
     driver = static
     args = password=secretmasterpass allow_nets=10.1.2.3
    } passdb {
     ...
    }

    If allow_nets didn't match in the first passdb, we should just ignore it and 
    continue to the next passdb.

M	src/auth/auth-request.c

2015-05-05 13:35:52 +0300 Timo Sirainen <tss@iki.fi> (f942b7b)

    doveadm fs delete: Another attempt at fixing recursive deletion. I'm not
    entirely sure anymore what the original infinite looping was, but this fixes
    all the potential problems that I see.


M	src/doveadm/doveadm-fs.c

2015-05-05 13:30:38 +0300 Timo Sirainen <tss@iki.fi> (f86f7ec)

    doveadm fs delete: Reverted last two patches - they were all completely
    wrong..


M	src/doveadm/doveadm-fs.c

2015-05-05 13:13:42 +0300 Timo Sirainen <tss@iki.fi> (f98a079)

    doveadm fs delete: Recent changes broke it completely.


M	src/doveadm/doveadm-fs.c

2015-05-04 23:27:42 +0300 Timo Sirainen <tss@iki.fi> (7f0fad6)

    lib-storage: Fixed setting/getting server metadata. Also added a
    MAILBOX_ATTRIBUTE_KEY_IS_USER_ACCESSIBLE() macro to make it a bit easier to
    check if a key should be accessible to a user or not.


M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/mailbox-attribute.h

2015-05-04 19:53:53 +0300 Stephan Bosch <stephan@rename-it.nl> (146f907)

    mail-storage: Moved mailbox attributes API to separate module.


M	src/lib-storage/Makefile.am
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
A	src/lib-storage/mailbox-attribute-private.h
A	src/lib-storage/mailbox-attribute.c
A	src/lib-storage/mailbox-attribute.h

2015-05-04 19:15:10 +0300 Timo Sirainen <tss@iki.fi> (70f202a)

    lib-fs: Forgot to initialize refcount in previous commit


M	src/lib-fs/fs-api.c

2015-05-04 19:06:11 +0300 Timo Sirainen <tss@iki.fi> (e853125)

    lib-fs: Added fs_ref() and fs_unref() for reference counting.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2015-05-04 18:44:29 +0300 Timo Sirainen <tss@iki.fi> (c01e993)

    imap: FETCH BODY.PEEK[HEADER.FIELDS (..)] didn't set wanted_headers
    optimization. Primarily this fixes imapc's prefetching.


M	src/imap/imap-fetch-body.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h

2015-05-04 18:31:27 +0300 Timo Sirainen <tss@iki.fi> (50ffc12)

    imapc: Various optimization fixes to fetching messages' virtual size.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c

2015-05-04 18:15:00 +0300 Timo Sirainen <tss@iki.fi> (7ac6e63)

    imapc: imapc-features=rfc822.size didn't work for fetching mail's virtual
    size. Physical and virtual sizes are the same for imapc.


M	src/lib-storage/index/imapc/imapc-mail.c

2015-05-04 12:07:16 +0300 Timo Sirainen <tss@iki.fi> (baf4695)

    configure: When compiling with sqlite3, don't forcibly link with zlib. Looks
    like -lz was originally added when it was copy&pasted from some other code.
    Hopefully this isn't actually needed by any (current) system.


M	configure.ac

2015-05-04 11:55:11 +0300 Timo Sirainen <tss@iki.fi> (c8c6f2f)

    man: Fixed -Dv parameter position in doveadm-sync.1


M	doc/man/doveadm-sync.1.in

2015-05-03 17:07:02 +0300 Timo Sirainen <tss@iki.fi> (e2e6f40)

    acl: Log more debug info with mail_debug=yes


M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-global-file.c
M	src/plugins/acl/acl-global-file.h

2015-05-03 16:26:46 +0300 Timo Sirainen <tss@iki.fi> (971f89b)

    lib-mail: Removed quoted_printable_decode*() quoted_printable_q_decode() was
    still left in quoted-printable.h, but maybe it should be moved to
    qp-decoder.c as well.


M	src/lib-mail/quoted-printable.c
M	src/lib-mail/quoted-printable.h
M	src/lib-mail/test-quoted-printable.c

2015-05-03 16:23:41 +0300 Timo Sirainen <tss@iki.fi> (1a6a2a1)

    lib-mail: Switched message-decoder to use qp-decoder. This probably doesn't
    fix any actual bugs, but allows getting rid of the
    quoted_printable_decode*()


M	src/lib-mail/Makefile.am
M	src/lib-mail/message-decoder.c
M	src/lib-mail/test-message-decoder.c

2015-05-03 16:22:55 +0300 Timo Sirainen <tss@iki.fi> (76adf79)

    lib-mail: Fixed various istream-qp-decoder bugs by switching to qp-decoder
    API


M	src/lib-mail/Makefile.am
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/test-istream-qp-decoder.c

2015-05-03 14:50:01 +0300 Timo Sirainen <tss@iki.fi> (7227027)

    lib-mail: Added qp-decoder, which is a rewritten quoted_printable_decode()
    The main benefit is that qp-decoder allows feeding data to it in smaller
    pieces. It can also give better error reporting.


M	src/lib-mail/Makefile.am
A	src/lib-mail/qp-decoder.c
A	src/lib-mail/qp-decoder.h
A	src/lib-mail/test-qp-decoder.c

2015-04-29 17:45:30 +0200 Timo Sirainen <tss@iki.fi> (f0d8efc)

    director: Log error if auth sends invalid lip/lport/port parameter. This
    also fixes compiler warnings.


M	src/director/login-connection.c

2015-04-29 17:43:13 +0200 Timo Sirainen <tss@iki.fi> (77f05ff)

    lib: Added unit test for net_ip2addr() and fixed net_is_in_network() test.


M	src/lib/test-net.c

2015-04-29 17:36:44 +0200 Timo Sirainen <tss@iki.fi> (68ae5d6)

    lib: Renamed test-network to test-net Since network.c had been renamed to
    net.c some time ago.


M	src/lib/Makefile.am
M	src/lib/test-lib.c
M	src/lib/test-lib.h
R098	src/lib/test-network.c	src/lib/test-net.c

2015-04-29 17:35:18 +0200 Timo Sirainen <tss@iki.fi> (d1e20cd)

    lib: net_addr2ip() sets the family now only after address is successfully
    converted.


M	src/lib/net.c

2015-04-29 17:19:34 +0200 Timo Sirainen <tss@iki.fi> (3fbc12d)

    lib-imap: imap_utf7_to_utf8() returns failure now for encoded NULs. All the
    callers change the string to NUL-terminated string, so the earlier behavior
    was just truncating the string at the encoded NUL. It's a bit safer to just
    return failure so in future if the callers didn't convert the string to
    NUL-terminated string it wouldn't be handled inconsistently in different
    places.


M	src/lib-imap/imap-utf7.c

2015-04-29 11:33:21 +0200 Timo Sirainen <tss@iki.fi> (0dc7298)

    director: Implemented director_proxy_maybe passdb extra field. This allows
    running director and backend in the same Dovecot instance. It was
    implemented into director instead of login-common to allow doveadm and lmtp
    proxying to work as well (although currently lmtp can't handle mixed
    proxying and non-proxying destinations, which makes this a bit less useful).


M	src/auth/auth-request.c
M	src/director/login-connection.c

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (7a545ed)

    uri-util: Added the possibility of only checking the URI without parsing any
    of the data.


M	src/lib/uri-util.c
M	src/lib/uri-util.h

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (bcd6c13)

    uri-util: Improve errors about invalid characters in URI by reporting the
    component where the offending character is located.


M	src/lib-http/http-url.c
M	src/lib-imap/imap-url.c
M	src/lib/uri-util.c

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (f3cf2f0)

    uri-util: Allow empty host name in the generic URI syntax as specified in
    RFC 3986.


M	src/lib-http/http-url.c
M	src/lib-imap/imap-url.c
M	src/lib/uri-util.c

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (8c80cd4)

    lib-http: client: Fixed memory leak in CONNECT tunnel support. Forgot to
    dereference streams once tunnel was completed and passed to the new
    connection object.


M	src/lib-http/http-client-connection.c

2015-04-25 11:42:06 +0200 Stephan Bosch <stephan@rename-it.nl> (6793538)

    lib: connection: Connect to unix socket asynchronously if connected callback
    is set. Prevents problems in lib-http unix socket support.


M	src/lib/connection.c

2015-04-29 10:34:33 +0200 Timo Sirainen <tss@iki.fi> (afbd176)

    fts: Do not deinit uncreated fts context Fixes crash with fts-lucene and
    fts-solr when lib-fts wasn't used. Patch by Teemu Huovila


M	src/plugins/fts/fts-user.c

2015-04-29 10:27:50 +0200 Timo Sirainen <tss@iki.fi> (bcdf3ba)

    trash plugin: Count more correctly the number of bytes/messages needed to
    get under quota. If there already were some messages saved, those weren't
    counted when figuring out how many/much mails are still needed to be
    expunged.

    Patch by Alexei Gradinari

M	src/plugins/trash/trash-plugin.c

2015-04-29 10:22:26 +0200 Timo Sirainen <tss@iki.fi> (50e7732)

    trash plugin: Fixed handling unlimited quota limits. Patch by Alexei
    Gradinari


M	src/plugins/trash/trash-plugin.c

2015-04-29 10:13:19 +0200 Timo Sirainen <tss@iki.fi> (4c7e360)

    quota: Don't assume mail is too large if a quota root has mail count limit
    but not size limit. Based on patch by Alexei Gradinari


M	src/plugins/quota/quota.c

2015-04-28 14:20:39 +0200 Timo Sirainen <tss@iki.fi> (82705ac)

    lib-mail: Fixed modifying headers with i_stream_header_filter_add() If the
    stream was read twice, the second time the callback wasn't called and the
    header wasn't modified.


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2015-04-28 11:27:04 +0200 Timo Sirainen <tss@iki.fi> (ebf6313)

    *-login: Don't try to flush SSL output if SSL handshake fails. This fixes a
    crash on failed handshakes on some OpenSSL builds.


M	src/login-common/ssl-proxy-openssl.c

2015-04-25 12:16:07 +0300 Timo Sirainen <tss@iki.fi> (efc70d0)

    Forgot to include year 2015 in earlier new files' Copyright lines.


M	src/lib-imap/imap-keepalive.c
M	src/lib/istream-unix.c

2015-04-25 12:07:44 +0300 Timo Sirainen <tss@iki.fi> (ffafd76)

    log: Don't confuse process sending a partial log line to process sending
    logs too fast. If it's a partial line we don't want to show the "service too
    fast" error in ps title.


M	src/log/log-connection.c

2015-04-25 11:52:02 +0300 Timo Sirainen <tss@iki.fi> (b78d8db)

    lib: Fixed crash in connection API if input streams aren't used (only input
    fd).


M	src/lib/connection.c

2015-04-25 11:40:23 +0300 Timo Sirainen <tss@iki.fi> (4c1a936)

    lib: Fixed test-istream-unix to not send uninitialized bytes. Fixes Valgrind
    errors in make check.


M	src/lib/test-istream-unix.c

2015-04-25 11:27:17 +0300 Timo Sirainen <tss@iki.fi> (9805f50)

    imap: Code cleanup: Moved IDLE keepalive timer calculation to lib-imap.


M	src/imap/cmd-idle.c
M	src/lib-imap/Makefile.am
A	src/lib-imap/imap-keepalive.c
A	src/lib-imap/imap-keepalive.h

2015-04-25 11:23:00 +0300 Timo Sirainen <tss@iki.fi> (bf132be)

    lib: Added istream-unix for reading fd sockets via istream.


M	src/lib/Makefile.am
A	src/lib/istream-file-private.h
M	src/lib/istream-file.c
A	src/lib/istream-unix.c
A	src/lib/istream-unix.h
A	src/lib/test-istream-unix.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2015-04-25 11:22:39 +0300 Timo Sirainen <tss@iki.fi> (e88b20c)

    lib: Added numpack_decode32()


M	src/lib/numpack.c
M	src/lib/numpack.h

2015-04-24 16:03:51 +0300 Timo Sirainen <tss@iki.fi> (eeb0343)

    fts: Fixed infinite looping at deinit. fts_mail_user_deinit() was calling
    itself. Now the fts backend is responsible for calling it at deinit.


M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/fts-user.h

2015-04-24 15:45:42 +0300 Timo Sirainen <tss@iki.fi> (46241d8)

    doveadm fs delete -R: Fixed infinite looping when deleting a lot of files
    with some backends. After file was deleted, we closed it. Then later on we
    tried to delete it all over again.


M	src/doveadm/doveadm-fs.c

2015-04-24 15:41:55 +0300 Timo Sirainen <tss@iki.fi> (f9ca41e)

    doveadm fs delete -R: When deleting directories, include "/" suffix in the
    name.


M	src/doveadm/doveadm-fs.c

2015-04-24 15:13:59 +0300 Timo Sirainen <tss@iki.fi> (1ac7b69)

    lmtp: Added lmtp_hdr_delivery_address=final|original|none setting. This
    controls what username is used for logging Delivered-To: header and the "for
    user@domain" in Received: header. The default "final" is the regular
    username as earlier, "original" logs the RFC822 address received via ORCPT
    parameter or fallbacks to username, "none" logs nothing.


M	src/lmtp/commands.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h

2015-04-24 14:47:43 +0300 Timo Sirainen <tss@iki.fi> (5525775)

    doveadm-server: Fixed returning command input stream when its data was
    already in the input stream.


M	src/doveadm/doveadm-mail.c

2015-04-24 14:25:06 +0300 Timo Sirainen <tss@iki.fi> (1e60d51)

    fts-solr: fts_solr=use_libfts send data to Solr via space-separated tokens.
    In this case Solr should be configured to not do any kind of filtering and
    use only WhitespaceTokenizerFactory.


M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/fts-solr-plugin.h

2015-04-24 14:08:51 +0300 Timo Sirainen <tss@iki.fi> (a32b055)

    fts: Minor error messagage prefix change.


M	src/plugins/fts/fts-build-mail.c

2015-04-24 14:08:39 +0300 Timo Sirainen <tss@iki.fi> (4ba3717)

    fts: Don't always try to initialize lib-fts. Require backend to explictly do
    it now.


M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-user.c
M	src/plugins/fts/fts-user.h

2015-04-24 14:03:01 +0300 Timo Sirainen <tss@iki.fi> (3672322)

    fts: Install fts-user.h header


M	src/plugins/fts/Makefile.am

2015-04-24 13:10:17 +0300 Timo Sirainen <tss@iki.fi> (4c61d6b)

    fts: Replace '-' with '_' in filter-specific fts_filters_* settings. So for
    example using fts_filters_normalizer_icu instead of
    fts_filters_normalizer-icu.


M	src/plugins/fts/fts-user.c

2015-04-24 13:08:16 +0300 Timo Sirainen <tss@iki.fi> (e059347)

    lib-fs: Use the new t_str_replace() instead of doing it ourself.


M	src/lib-fs/fs-api.c

2015-04-24 13:07:39 +0300 Timo Sirainen <tss@iki.fi> (be1749e)

    lib: Added t_str_replace() to replace one character with another one


M	src/lib/strfuncs.c
M	src/lib/strfuncs.h
M	src/lib/test-strfuncs.c

2015-04-23 21:32:43 +0300 Timo Sirainen <tss@iki.fi> (ad0131e)

    dict: Fixed unescaping strings from lib-dict. This may potentially break
    backwards compatibility with someone, but it's probably pretty rare that
    anybody is yet using dict proxy with multi-line fields. Also even though the
    current behavior happens to work, it's very much non-ideal and can be
    potentially dangerous.


M	src/dict/dict-commands.c

2015-04-23 21:26:50 +0300 Timo Sirainen <tss@iki.fi> (51d7baa)

    auth: Don't assert-crash if master user login attempts to use empty login
    username.


M	src/auth/auth-request.c

2015-04-23 21:19:54 +0300 Timo Sirainen <tss@iki.fi> (cc935af)

    lib-storage: mail_search_args_simplify() handles now
    SEARCH_HEADER*/TEXT/BODY These are especially useful with lib-fts, where
    stemming and other filtering can produce duplicates. There's some internal
    deduplication, but it doesn't catch all of these.


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-04-23 21:00:43 +0300 Timo Sirainen <tss@iki.fi> (f5e8a76)

    lib-storage: mail_search_args_simplify() handles now SEARCH_SMALLER/LARGER


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-04-23 20:50:23 +0300 Timo Sirainen <tss@iki.fi> (d6a7cb1)

    lib-storage: mail_search_args_simplify() handles now SEARCH_BEFORE/ON/SINCE


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-04-23 20:16:54 +0300 Timo Sirainen <tss@iki.fi> (7000810)

    lib-storage: mail_search_args_simplify() merges now seqsets and uidsets.


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-04-23 19:49:49 +0300 Timo Sirainen <tss@iki.fi> (fb79b36)

    lib-storage: If mail_search_args_simplify() merges flags, check again if any
    SUBs can be removed. The subquery may have been replaced with a single
    SEARCH_FLAGS parameter.


M	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/test-mail-search-args-simplify.c

2015-04-23 19:42:13 +0300 Timo Sirainen <tss@iki.fi> (7827831)

    lib-storage: Makefile fixes for previous test programs


M	src/lib-storage/Makefile.am

2015-04-23 19:37:25 +0300 Timo Sirainen <tss@iki.fi> (45a3ea3)

    imapc: Don't write SEARCH YOUNGER/OLDER queries if server doesn't support
    WITHIN extension


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/imapc-search.c

2015-04-23 19:29:43 +0300 Timo Sirainen <tss@iki.fi> (f8740ac)

    lib-storage: Moved mail_search_args_simplify() to its own file and added
    unit tests. No functional changes.


M	src/lib-storage/Makefile.am
A	src/lib-storage/mail-search-args-simplify.c
M	src/lib-storage/mail-search.c
A	src/lib-storage/test-mail-search-args-simplify.c

2015-04-23 19:28:04 +0300 Timo Sirainen <tss@iki.fi> (ae1b2f5)

    imapc: Use mail_search_arg_to_imap() to write IMAP SEARCH parameters. This
    also fixes a few bugs, since some of the search parameters weren't written
    entirely correctly.


M	src/lib-storage/index/imapc/imapc-search.c

2015-04-23 19:24:50 +0300 Timo Sirainen <tss@iki.fi> (9b92e79)

    lib-storage: Added mail_search_args_to_imap() Useful for writing IMAP SEARCH
    parameters from struct mail_search_arg.


M	src/lib-storage/Makefile.am
A	src/lib-storage/mail-search-args-imap.c
M	src/lib-storage/mail-search.h
A	src/lib-storage/test-mail-search-args-imap.c

2015-04-23 19:20:00 +0300 Timo Sirainen <tss@iki.fi> (4fe4f6e)

    lib-storage: Added mail_thread_type_to_str()


M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-thread.h

2015-04-23 19:19:10 +0300 Timo Sirainen <tss@iki.fi> (120dd01)

    lib-imap: Added imap_to_date()


M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-date.h

2015-04-23 16:33:19 +0300 Timo Sirainen <tss@iki.fi> (2848ed0)

    lib-storage: Fixed assert-crash with mailbox_list_index=yes if root mailbox
    name was empty. This happened if the index was used for a non-listable
    namespace whose prefix started with the namespace separator (e.g.
    prefix="/expunged/")


M	src/lib-storage/list/mailbox-list-index-iter.c

2015-04-23 13:37:22 +0300 Timo Sirainen <tss@iki.fi> (a7348c7)

    imapc: After auth failed, return failure immediately when opening a mailbox.
    Instead of trying to re-authenticate which again will most likely fail.
    Based on patch by Michael M Slusarz


M	src/lib-storage/index/imapc/imapc-storage.c

2015-04-23 13:27:17 +0300 Timo Sirainen <tss@iki.fi> (471eed3)

    lib-storage: Small code cleanup for index_mail_get_binary_stream() stream_r
    is always non-NULL here. Also move unreferencing cache istream to be last in
    case it might fix data.stream=NULL being here in some situations.


M	src/lib-storage/index/index-mail-binary.c

2015-04-23 13:01:50 +0300 Timo Sirainen <tss@iki.fi> (7515786)

    lib: Fixed reference counting in iostream-rawlog if either i/ostream wasn't
    used.


M	src/lib/iostream-rawlog.c

2015-04-23 11:40:03 +0300 Timo Sirainen <tss@iki.fi> (fc64b2b)

    lib: iostream_rawlog_create_from_stream() now allows input or output to be
    NULL.


M	src/lib/iostream-rawlog.c

2015-04-23 11:20:53 +0300 Timo Sirainen <tss@iki.fi> (59eba6f)

    lib-storage: Fixed subscription file reading when file was (nearly) empty.
    Broken by the earlier changes.


M	src/lib-storage/list/subscription-file.c

2015-04-22 18:17:10 +0300 Timo Sirainen <tss@iki.fi> (4b11f96)

    lib-storage: Added support for subscriptions file version 2 format. The v2
    format's main benefit is that it doesn't write the hierarchy separator to
    the subscriptions file, which allows the separator to be changed without
    breaking subscriptions. This mainly affects LAYOUT=INDEX, which doesn't have
    a native hardcoded separator.

    The plan is to start writing v2 subscription files in Dovecot v2.3. So for 
    now we simply read such files and if we find v2 file we also modify it in v2 
    format, but we never create new v2 format files or convert v0 to v2.

M	src/lib-storage/list/subscription-file.c

2015-04-21 23:00:08 +0300 Timo Sirainen <tss@iki.fi> (36716ba)

    fts-lucene: Fix to earlier commit: Header names must be indexed without
    libfts, not with.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2015-04-21 21:29:42 +0300 Timo Sirainen <tss@iki.fi> (4f4daf7)

    fts-lucene: Optionally use lib-fts instead of CLucene's own analyzers.
    fts_lucene = use_libfts enables this.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc

2015-04-21 21:28:41 +0300 Timo Sirainen <tss@iki.fi> (76cb5c2)

    fts: If backend has FTS_BACKEND_FLAG_TOKENIZED_INPUT set, index also the
    header name. We were sending the hdr_name to the backend without tokenizing
    it or filtering it, so the backend couldn't have done anything useful about
    it.


M	src/plugins/fts/fts-build-mail.c

2015-04-21 20:59:48 +0300 Timo Sirainen <tss@iki.fi> (0c509a3)

    lib-fs: Fixed fs-posix to work with fs_iter_init(path="") when fs prefix
    wasn't set.


M	src/lib-fs/fs-posix.c

2015-04-21 20:16:36 +0300 Timo Sirainen <tss@iki.fi> (ec930ce)

    lib-fts: Added normalizer-simple for doing normalization without libicu.


M	src/lib-fts/Makefile.am
A	src/lib-fts/fts-filter-normalizer-simple.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h

2015-04-21 19:40:42 +0300 Timo Sirainen <tss@iki.fi> (2f2faa9)

    lib-fts: Fixed test-fts-filter to work again after previous normalizer
    changes.


M	src/lib-fts/test-fts-filter.c

2015-04-21 19:36:27 +0300 Timo Sirainen <tss@iki.fi> (63713f1)

    lib-fts: Renamed normalizer to icu-normalizer, including the source code.


M	src/lib-fts/Makefile.am
R078	src/lib-fts/fts-filter-normalizer.c	src/lib-fts/fts-filter-normalizer-icu.c
M	src/lib-fts/fts-filter.c
M	src/lib-fts/fts-filter.h

2015-04-21 19:31:14 +0300 Timo Sirainen <tss@iki.fi> (cb6f6ef)

    configure: s/normalizer/libicu/ since we it could be used for something else
    as well.


M	configure.ac
M	src/lib-fts/Makefile.am
M	src/lib-fts/fts-filter-normalizer.c

2015-04-21 17:01:39 +0300 Timo Sirainen <tss@iki.fi> (e298a33)

    lmtp proxy: Include in log messages how long it took to deliver the mail. In
    multi-RCPT TO sessions it's a bit unreliable to split the single DATA
    reply's times to multiple lines, so instead each line just says "(2/3 at 123
    ms)" meaning that the second mail was delivered at the time when 123
    milliseconds had elapsed since the delivery was started.


M	src/lmtp/lmtp-proxy.c

2015-04-21 16:54:51 +0300 Timo Sirainen <tss@iki.fi> (da0420f)

    lib-lda: Assume that the caller sets delivery_time_started This is required
    because parts of the delivery time may be done at the time the user is being
    initialized, so it needs to be set before the user init is done.


M	src/lda/main.c
M	src/lib-lda/mail-deliver.c
M	src/lmtp/commands.c

2015-04-21 16:52:59 +0300 Timo Sirainen <tss@iki.fi> (0783364)

    lib-lda: mail_deliver_log() now updates the %{delivery_time} instead of
    using the first cached value. The first time the cached values are set the
    transaction isn't committed and the mailbox isn't synced.


M	src/lib-lda/mail-deliver.c

2015-04-21 16:50:43 +0300 Timo Sirainen <tss@iki.fi> (5072e50)

    lib-lda: Added lmtp-client to track timestamps when various events happen.


M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h

2015-04-21 14:08:12 +0300 Timo Sirainen <tss@iki.fi> (cb29b57)

    imap: Finishing previous commit by removing now-unnecessary code.


M	src/imap/cmd-select.c

2015-04-21 14:06:41 +0300 Timo Sirainen <tss@iki.fi> (115cf03)

    imap: Removed separate time counting from SELECT and SEARCH commands.


M	src/imap/cmd-select.c
M	src/imap/imap-search.c
M	src/imap/imap-search.h

2015-04-21 14:06:22 +0300 Timo Sirainen <tss@iki.fi> (8808ae6)

    imap: Include in tagged reply how much running time each IMAP command takes.
    The running time doesn't include time spent waiting for the client on
    ioloop.


M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c

2015-04-21 14:03:52 +0300 Timo Sirainen <tss@iki.fi> (900cbc1)

    imap: Small code cleanup. Removed all the checks of
    CLIENT_COMMAND_STATE_DONE to command_exec() itself.


M	src/imap/cmd-append.c
M	src/imap/imap-client.c
M	src/imap/imap-commands.c

2015-04-21 13:19:24 +0300 Timo Sirainen <tss@iki.fi> (6b6011c)

    lda, lmtp: Added delivery_time and session_time variables to
    deliver_log_format session_time is meaningful only with LMTP. The
    delivery_time is separate for each mail delivery. The results are in
    milliseconds now. If needed we could add a new %modifier that converts it
    into secs.millisecs.


M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h
M	src/lmtp/client.h
M	src/lmtp/commands.c

2015-04-21 11:13:51 +0300 Timo Sirainen <tss@iki.fi> (dbd7b5e)

    stats: num_cmds was always 0 in global stats


M	src/stats/mail-command.c

2015-04-21 09:59:32 +0300 Timo Sirainen <tss@iki.fi> (e162baa)

    lib-fts: Added udhr_fra.txt to EXTRA_DIST


M	src/lib-fts/Makefile.am

2015-04-20 19:57:37 +0300 Timo Sirainen <tss@iki.fi> (4bf6941)

    lib-fts: Added PropList.txt to EXTRA_DIST


M	src/lib-fts/Makefile.am

2015-04-20 18:08:56 +0300 Timo Sirainen <tss@iki.fi> (82eadbc)

    lib-fts requires libexttextcat actually - don't even try to use textcat for
    it. I'm also not sure yet if some libexttextcats are too old for it.


M	configure.ac
M	src/lib-fts/fts-language.c

2015-04-20 18:02:31 +0300 Timo Sirainen <tss@iki.fi> (0ebe498)

    lib-fts: Updated Finnish/French stopword lists from Lucene code. Most
    importantly they added the licensing info to the files.


M	src/lib-fts/stopwords_fi.txt
M	src/lib-fts/stopwords_fr.txt

2015-04-20 17:45:32 +0300 Timo Sirainen <tss@iki.fi> (556c189)

    lib-fts: Fixed using FTS_NORMALIZER_CFLAGS/LIBS.


M	src/lib-fts/Makefile.am

2015-04-20 17:44:21 +0300 Timo Sirainen <tss@iki.fi> (632d218)

    lib-fts: Don't crash in test-fts-filter if libstemmer support isn't built in


M	src/lib-fts/test-fts-filter.c

2015-04-20 17:43:32 +0300 Timo Sirainen <tss@iki.fi> (ec976e5)

    lib-fts: Fixed some wrong macro name checks. Forgot to change these ones
    while renaming them..


M	src/lib-fts/fts-filter-normalizer.c
M	src/lib-fts/fts-filter-stemmer-snowball.c
M	src/lib-fts/test-fts-filter.c

2015-04-20 17:40:12 +0300 Timo Sirainen <tss@iki.fi> (9cff78f)

    lib-fts: Added missing stopwords_fi.txt


M	src/lib-fts/Makefile.am
A	src/lib-fts/stopwords_fi.txt

2015-04-20 17:33:09 +0300 Timo Sirainen <tss@iki.fi> (4e07da7)

    lib-fts: Fixed test-fts-language to use TEXTCAT_DATADIR This may still make
    too many assumptions about what data exists where.. So we may need to remove
    this test from "make check". But for now leave it there.


M	src/lib-fts/Makefile.am
M	src/lib-fts/test-fts-language.c

2015-04-20 17:24:37 +0300 Timo Sirainen <tss@iki.fi> (30106a5)

    configure: Fixed building without textcat.


M	configure.ac

2015-04-20 17:08:42 +0300 Timo Sirainen <tss@iki.fi> (44f6dba)

    configure: Added Debian Wheezy workaround for finding textcat.h


M	configure.ac

2015-04-20 17:01:12 +0300 Timo Sirainen <tss@iki.fi> (a6f1ded)

    lib-fts: Fixed default textcat datadir paths.


M	configure.ac
M	src/lib-fts/fts-language.c

2015-04-20 16:34:31 +0300 Timo Sirainen <tss@iki.fi> (fb32aea)

    configure: Fixed linking with libexttextcat when it was found via pkg-config


M	configure.ac

2015-04-20 16:22:36 +0300 Timo Sirainen <tss@iki.fi> (1537d20)

    fts: Added FTS_BACKEND_FLAG_TOKENIZED_INPUT, which is implemented via
    lib-fts.


M	src/plugins/fts/Makefile.am
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-plugin.c
A	src/plugins/fts/fts-search-args.c
A	src/plugins/fts/fts-search-args.h
M	src/plugins/fts/fts-storage.c
A	src/plugins/fts/fts-user.c
A	src/plugins/fts/fts-user.h

2015-04-20 16:19:07 +0300 Timo Sirainen <tss@iki.fi> (c865b0e)

    Initial import for lib-fts. Parts of what this code does was already
    implemented internally by fts-lucene. lib-fts is intended to be usable for
    all the FTS backends. The APIs are still going to change a bit, but
    hopefully not after v2.2.17 release.

    Mostly written by Teemu Huovila.

M	.hgignore
M	configure.ac
M	src/Makefile.am
A	src/lib-fts/Makefile.am
A	src/lib-fts/fts-filter-normalizer.c
A	src/lib-fts/fts-filter-private.h
A	src/lib-fts/fts-filter-stemmer-snowball.c
A	src/lib-fts/fts-filter-stopwords.c
A	src/lib-fts/fts-filter.c
A	src/lib-fts/fts-filter.h
A	src/lib-fts/fts-language.c
A	src/lib-fts/fts-language.h
A	src/lib-fts/fts-tokenizer-address.c
A	src/lib-fts/fts-tokenizer-generic-private.h
A	src/lib-fts/fts-tokenizer-generic.c
A	src/lib-fts/fts-tokenizer-private.h
A	src/lib-fts/fts-tokenizer.c
A	src/lib-fts/fts-tokenizer.h
A	src/lib-fts/stopwords_en.txt
A	src/lib-fts/stopwords_fr.txt
A	src/lib-fts/test-fts-filter.c
A	src/lib-fts/test-fts-language.c
A	src/lib-fts/test-fts-tokenizer.c
A	src/lib-fts/udhr_fra.txt
A	src/lib-fts/word-boundary-data.sh
A	src/lib-fts/word-break-data.sh

2015-04-20 15:27:02 +0300 Timo Sirainen <tss@iki.fi> (5f92315)

    configure: Fixed/improved finding and using libexttextcat. libexttextcat
    wasn't actually being used at all by fts-lucene. Now we'll first prefer
    finding it via pkg-config, next finding exttextcat and only last look up
    textcat.


M	configure.ac
M	src/plugins/fts-lucene/Makefile.am
M	src/plugins/fts-lucene/lucene-wrapper.cc

2015-04-20 15:12:14 +0300 Timo Sirainen <tss@iki.fi> (db9ad8c)

    configure: Stemmer and textcat checks are now done even if CLucene isn't
    used. They'll be useful for other FTS backends as well. This patch doesn't
    change any actual functionality.


M	configure.ac
M	src/plugins/fts-lucene/Makefile.am
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/lucene-wrapper.cc

2015-04-20 15:02:04 +0300 Timo Sirainen <tss@iki.fi> (fed97f5)

    fts: Code cleanup to do all index updates via fts_build_data() This doesn't
    actually change the behavior.


M	src/plugins/fts/fts-build-mail.c

2015-04-17 11:52:24 +0300 Timo Sirainen <tss@iki.fi> (ab0475b)

    doveadm fs delete -R: Don't add extra '/' chars in the middle of paths


M	src/doveadm/doveadm-fs.c

2015-04-17 11:20:23 +0300 Timo Sirainen <tss@iki.fi> (ead160b)

    dovecot-config: Added lib-stats to LIBDOVECOT_INCLUDE


M	dovecot-config.in.in

2015-04-16 18:20:15 +0300 Timo Sirainen <tss@iki.fi> (60eda49)

    lib-fs: fs_class_register() can now be called externally.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2015-04-16 14:19:51 +0300 Timo Sirainen <tss@iki.fi> (c17957c)

    doveadm mailbox metadata: The keys must always be lowercased. The keys need
    to be case-insensitive in IMAP, so the IMAP code always also lowercases
    them.


M	src/doveadm/doveadm-mail-mailbox-metadata.c

2015-04-16 12:59:05 +0300 Timo Sirainen <tss@iki.fi> (7c7e4ee)

    stats: Fixed compiling with some OSes. struct timeval wasn't necessarily
    already defined by existing includes.


M	src/stats/mail-stats.h

2015-04-16 11:46:22 +0300 Phil Carmody <phil@dovecot.fi> (8b814df)

    lib: test-array build warnings on Solaris 10 Solaris cc doesn't think I've
    read N1570 6.7.9p11, 6.5.16.1p2, and 6.3.1.3p2, and wants to save me from
    myself.

    Reported-by: Juergen Obermann
    <http://www.dovecot.org/list/dovecot/2015-April/100427.html> Signed-off-by:
    Phil Carmody <phil@dovecot.fi>

M	src/lib/test-array.c

2015-04-15 21:01:11 +0300 Timo Sirainen <tss@iki.fi> (eb1365e)

    imapc: Added imapc_features=zimbra-workarounds Zimbra (at least
    v5.0.18_GA_3011.RHEL4_64) can return different headers depending on whether
    the whole message body was fetched or only (partial) headers. This probably
    happens only for invalid characters that are translated into '?'. With this
    workaround enabled we don't use FETCH BODY.PEEK[], but we do FETCH
    (BODY.PEEK[HEADER] BODY.PEEK[TEXT]) and merge the results together. This way
    the results are always consistent and headers don't suddenly change.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h

2015-04-14 09:58:01 +0300 Timo Sirainen <tss@iki.fi> (1f36661)

    dict-file: Use tabescaping for keys and values to allow LFs in them.
    Although this makes the format slightly incompatible, it's doubtful anybody
    is using dict values containing \001 characters.


M	src/lib-dict/dict-file.c

2015-04-13 20:38:10 +0300 Timo Sirainen <tss@iki.fi> (b523ce6)

    auth: If passdb/userdb changes the username, add the changed username also
    to the cache.


M	src/auth/auth-request.c

2015-04-13 20:37:48 +0300 Timo Sirainen <tss@iki.fi> (87c4b77)

    auth: Setting userdb fields from cache didn't set handle any special fields.
    The special fields were relatively rarely used though.


M	src/auth/auth-request.c

2015-04-13 10:04:47 +0300 Timo Sirainen <tss@iki.fi> (d8128f6)

    replication plugin: Don't crash for users who don't have replication
    enabled.


M	src/plugins/replication/replication-plugin.c

2015-04-08 13:55:35 +0900 Timo Sirainen <tss@iki.fi> (31e6dbe)

    lib: Added json-tree API for parsing JSON input into a tree structure. This
    makes it easier to access complicated JSON structs that can fit into memory.


M	src/lib/Makefile.am
A	src/lib/json-tree.c
A	src/lib/json-tree.h
A	src/lib/test-json-tree.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2015-04-06 12:07:32 +0900 Timo Sirainen <tss@iki.fi> (1f4f81b)

    lib-index: Added reason_r parameter to mail_transaction_log_view_set() This
    is used to improve some of the error messages about index corruption.


M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.h
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/test-mailbox-get.c

2015-04-06 11:39:34 +0900 Timo Sirainen <tss@iki.fi> (189c53b)

    rawlog: Flush output to disk every second instead of only when buffer is
    full.


M	src/util/rawlog.c

2015-04-03 08:53:45 +0900 Timo Sirainen <tss@iki.fi> (e94ce0c)

    configure: Added --with-textcat parameter


M	configure.ac

2015-04-02 08:12:41 +0900 Timo Sirainen <tss@iki.fi> (eef4547)

    dsync: Improved error message when remote dsync-server couldn't be started.


M	src/doveadm/doveadm-dsync.c

2015-04-01 01:16:57 +0900 Timo Sirainen <tss@iki.fi> (a166cdf)

    dsync: Don't try to use the new "finish" state with old dsync versions.


M	src/doveadm/dsync/dsync-ibc-stream.c

2015-03-28 01:23:47 +0200 Timo Sirainen <tss@iki.fi> (8b7e479)

    Makefile: Build lib-dovecot before lib-compression Because lib-compression
    depends on it.


M	src/Makefile.am

2015-03-27 23:39:30 +0200 Timo Sirainen <tss@iki.fi> (9871c4b)

    quota: Added debug information for quota_over_flag handling.


M	src/plugins/quota/quota.c

2015-03-25 10:11:35 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (50e06c0)

    configure: Add missing (auto) to autodetected options.


M	configure.ac

2015-03-27 18:04:51 +0200 Timo Sirainen <tss@iki.fi> (54f93d2)

    lib-compression: Use libdovecot.so as dependency. Don't include liblib.a
    itself!


M	src/lib-compression/Makefile.am

2015-03-27 15:12:50 +0200 Timo Sirainen <tss@iki.fi> (603cfcf)

    imapc: Don't assert-crash when trying to sync a mailbox with
    MAILBOX_FLAG_SAVEONLY. We can just skip the sync, because we don't do
    anything except save mails.


M	src/lib-storage/index/imapc/imapc-sync.c

2015-03-27 14:31:01 +0200 Timo Sirainen <tss@iki.fi> (e265563)

    quota: When reporting quota value/limit in kilobytes, round the value
    upwards. Most importantly this doesn't truncate <1024 values to 0, which
    also in quota limit means unlimited.


M	src/plugins/quota/quota.c

2015-03-27 11:02:18 +0200 Timo Sirainen <tss@iki.fi> (e5d6ec3)

    auth: Don't add original_user or auth_user to passdb reply if they already
    exist. This allows passdb to override their values cleanly.


M	src/auth/auth-request-handler.c

2015-03-24 11:27:26 +0200 Timo Sirainen <tss@iki.fi> (4ce25b6)

    imapc: Fix to previous change - labels are strings and not atoms. Allow also
    atoms just in case


M	src/lib-storage/index/imapc/imapc-mailbox.c

2015-03-24 10:14:58 +0100 Timo Sirainen <tss@iki.fi> (dce8b33)

    imapc: Ignore \Muted GMail label


M	src/lib-storage/index/imapc/imapc-mailbox.c

2015-03-22 20:54:29 +0200 Timo Sirainen <tss@iki.fi> (697ff56)

    lib-storage: Added mailbox_list_fs_get_list() Using mailbox_list_init_fs()
    now sets the mailbox_list pointer to root fs, which allows the fs backends
    to lookup the list. Although this can't be done in the init() function since
    the list is set only afterwards.


M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2015-03-22 20:52:56 +0200 Timo Sirainen <tss@iki.fi> (ea19bfd)

    lib-fs: Added support for module_contexts in fs. They could also be added to
    fs_file if needed, but for now I didn't bother adding it.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2015-03-22 20:52:16 +0200 Timo Sirainen <tss@iki.fi> (0bf2d57)

    lib-fs: When autoloading fs plugins with '-' in the name, translate them to
    '_' It's not possible for the function names to contain '-' in any case.
    Also Dovecot in general uses '-' instead of '_' in the configuration names.
    This change actually allows using either of them.


M	src/lib-fs/fs-api.c

2015-03-22 18:59:51 +0200 Timo Sirainen <tss@iki.fi> (11e8e38)

    Cleanup for libcharset's iconv linking. Linking libcharset.la now
    automatically links with the necessary iconv libraries.


M	src/lib-charset/Makefile.am
M	src/lib-dovecot/Makefile.am
M	src/lib-mail/Makefile.am

2015-03-20 21:58:16 +0200 Timo Sirainen <tss@iki.fi> (4898b00)

    lib: Fixed potential build error when building without modules.


M	src/lib/module-dir.c

2015-03-20 21:13:21 +0200 Timo Sirainen <tss@iki.fi> (4d65df3)

    lib-dict: Fixed crash when transaction failed due to dict server
    disconnection.


M	src/lib-dict/dict-client.c

2015-03-20 21:01:08 +0200 Timo Sirainen <tss@iki.fi> (93936b4)

    lib: o_stream_create_rawlog_from_stream() should preserve the output stream
    fd. ostream-rawlog is just a passthrough stream after all.


M	src/lib/ostream-rawlog.c

2015-03-20 20:46:52 +0200 Timo Sirainen <tss@iki.fi> (ce96196)

    doveadm: Added -h parameter to hide header line from tab and table formatter
    output.


M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-print.h
M	src/doveadm/doveadm.c

2015-03-20 13:27:00 +0200 Timo Sirainen <tss@iki.fi> (4a14ae5)

    Removed mountpoint checking and updating code. After a few years it seems
    like it has just caused more problems than it has actually fixed. The only
    thing it's been used for is to make sure that Dovecot can't create empty
    user directories when the user's mail filesystem isn't mounted. But that's
    supposed to be normally prevented already if the mount root directory
    permissions are only writable by root.

    For now the mountpoint listing code and doveadm mount code still exists just 
    in case people have some scripts using those. Those could be removed in
    v2.3.

    If we somehow figured out which mountpoints existed (not so easy because 
    they could be only visible in userdb lookups for different users), we could 
    maybe create some kind of a script that checks the permissions at startup. 
    This would work with Linux at least:

    mkdir test mount / -o bind test ls -ld test/var/mail # assuming /var/mail
    mountpoint umount test

M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/lib-storage/mailbox-list.c
M	src/master/main.c

2015-03-19 10:01:18 +0200 Timo Sirainen <tss@iki.fi> (28d084c)

    dsync: Fixed returning wrong mail_error in some remote dsync.


M	src/doveadm/dsync/dsync-ibc-stream.c

2015-03-19 01:24:32 +0200 Timo Sirainen <tss@iki.fi> (535646a)

    imapc: Don't wait for login to succeed at mailbox list creation. The failure
    will be visible in the next command. This wait was here mainly for imap, but
    cbdfca7d24a6 implements the wait in imap process directly. Other (current)
    protocols don't need such wait at all.

    Most importantly this change allows doveadm to handle imapc login failures 
    by seeing them as MAIL_ERROR_PERM errors when listing mailboxes or opening a 
    mailbox. This allows it to return a different exit code from temporary 
    failure (which it is not).

M	src/lib-storage/index/imapc/imapc-list.c

2015-03-19 01:21:20 +0200 Timo Sirainen <tss@iki.fi> (4733d37)

    imapc: Don't crash in mailbox_is_inconsistent() with unopened mailbox.


M	src/lib-storage/index/imapc/imapc-storage.c

2015-03-19 01:20:38 +0200 Timo Sirainen <tss@iki.fi> (58ab5b9)

    imap: If mailbox list is unusable at startup, return failure immediately.
    This is currently used only by imapc when login fails.


M	src/imap/main.c

2015-03-19 00:41:19 +0200 Timo Sirainen <tss@iki.fi> (ce0e25f)

    dsync: Use storage's mail_error to choose the doveadm exit code. Instead of
    always assuming that all errors are EX_TEMPFAIL.


M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-private.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2015-03-19 00:38:01 +0200 Timo Sirainen <tss@iki.fi> (ce7c209)

    imapc: If authentication fails, preserve the error message as storage/list
    error. This isn't very helpful yet, because the mailbox list creation itself
    fails.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2015-03-19 00:32:44 +0200 Timo Sirainen <tss@iki.fi> (d3d2e50)

    lib-storage: mailbox_list_mailbox() now copies the mailbox_exists() error.
    Instead of assuming it has to be an internal error.


M	src/lib-storage/mailbox-list.c

2015-03-18 17:10:23 +0200 Phil Carmody <phil@dovecot.fi> (0248b1c)

    lib: buffer - paranoid compile-time check for struct sizes At the moment,
    nothing guarantees that the public struct is big enough to contain the
    private struct.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/buffer.c

2015-03-18 17:10:03 +0200 Phil Carmody <phil@dovecot.fi> (6268418)

    lib: bits - improve bits_required to recurse downwards, not sideways Ooops.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/bits.h

2015-03-18 17:09:30 +0200 Phil Carmody <phil@dovecot.fi> (db10156)

    lib: bits - Add macro for '1 << i' It's used all over the place. It feels
    weird not having access to such a macro.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/bits.h

2015-03-18 13:43:35 +0200 Timo Sirainen <tss@iki.fi> (70fc76b)

    fts: Fixed assert-crash if fts-parser was created for a body part that
    backend didn't want to index.


M	src/plugins/fts/fts-build-mail.c

2015-03-17 17:30:33 +0200 Timo Sirainen <tss@iki.fi> (cd58b6b)

    auth ldap: Crashfixes for earlier changes. Hopefully works correctly now


M	src/auth/db-ldap.c

2015-03-17 10:49:20 +0200 Timo Sirainen <tss@iki.fi> (cc3cbea)

    auth ldap: Fixed crash when handling invalid SSL option.


M	src/auth/db-ldap.c

2015-03-17 09:58:03 +0200 Timo Sirainen <tss@iki.fi> (e3c4102)

    auth ldap: Fixed assert-crash when both passdb ldap and userdb ldap was used


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2015-03-16 23:25:34 +0200 Timo Sirainen <tss@iki.fi> (99363ae)

    auth ldap: Start LDAP connection only after auth process initialization is
    finished. This way even if connecting to LDAP takes a while it won't cause
    the master process to kill the auth process due to it not sending the
    startup "I'm ok" notification early enough.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2015-03-16 23:21:05 +0200 Timo Sirainen <tss@iki.fi> (67d650c)

    auth ldap: Make sure config file path is included in all fatal error
    messages.


M	src/auth/db-ldap.c

2015-03-16 23:17:39 +0200 Timo Sirainen <tss@iki.fi> (d492e2f)

    auth ldap: If any tls_* settings are given when they're not supported, fail
    with fatal instead of just warning. These may be important for intended
    security, especially tls_cipher_suite. We shouldn't allow setting them and
    then somewhat silently just ignore them.


M	src/auth/db-ldap.c

2015-03-16 23:14:49 +0200 Timo Sirainen <tss@iki.fi> (e885bb2)

    auth ldap: Call ldap_init*() already at db_ldap_init(). ldap_init*() doesn't
    start connecting yet, but this way we can verify that all the settings are
    correct.


M	src/auth/db-ldap.c

2015-03-16 23:03:10 +0200 Timo Sirainen <tss@iki.fi> (6332ef7)

    auth ldap: More concentration of i_fatal() calls to db_ldap_init()


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2015-03-16 22:55:47 +0200 Timo Sirainen <tss@iki.fi> (41e360a)

    auth ldap: Moved more LDAP fatal checks to db_ldap_init()


M	src/auth/db-ldap.c

2015-03-16 22:48:39 +0200 Timo Sirainen <tss@iki.fi> (22513df)

    auth ldap: Improved ldap_initialize() failure's error logging.


M	src/auth/db-ldap.c

2015-03-16 22:46:16 +0200 Timo Sirainen <tss@iki.fi> (f2dda28)

    auth ldap: Include LDAP config path in all fatal errors. Also moved all such
    error checks to db_ldap_init().


M	src/auth/db-ldap.c

2015-03-16 13:54:50 +0200 Timo Sirainen <tss@iki.fi> (8e8795e)

    stats: Don't allow stats_refresh setting to be set too large.


M	src/plugins/stats/stats-plugin.c

2015-03-16 13:53:54 +0200 Timo Sirainen <tss@iki.fi> (9445ac0)

    stats: Initial stats refresh timeout callback wasn't set. This broke after
    the ioloop change that caused stats_io_deactivate() not to be called
    immediately anymore.


M	src/plugins/stats/stats-plugin.c

2015-03-13 20:08:34 +0200 Timo Sirainen <tss@iki.fi> (24bd831)

    dsync: Added an extra "finish" state to allow slave-dsync to report error to
    master-dsync. I'm not sure if that's actually necessary, but just trying to
    follow the different possibilities on how dsync run can finish made me
    unsure about it. This should make it at least clear that if a slave-dsync
    has a failure flag set at deinit master-dsync will know about it before it
    returns success.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-private.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-ibc.h

2015-03-13 20:05:03 +0200 Timo Sirainen <tss@iki.fi> (b0a06fd)

    dsync: Added an extra assert.


M	src/doveadm/dsync/dsync-mailbox-export.c

2015-03-13 20:03:27 +0200 Timo Sirainen <tss@iki.fi> (f4fdc28)

    imapc: If reconnect fails during syncing, don't treat all mails as expunged
    in error handling code.


M	src/lib-storage/index/imapc/imapc-mail.c

2015-03-13 16:28:31 +0200 Timo Sirainen <tss@iki.fi> (051c44c)

    lib-imap-client: If we get disconnected and reconnect, log it as warning
    instead of as error.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c

2015-03-13 16:12:37 +0200 Timo Sirainen <tss@iki.fi> (657f76e)

    fts: fts-parser doesn't need to be asked about all the known-plaintext
    content-types.


M	src/plugins/fts/fts-parser.c

2015-03-13 16:04:10 +0200 Timo Sirainen <tss@iki.fi> (88b90ce)

    fts-tika, fts-solr: Added timeouts to requests so they aren't attempted
    infinitely.


M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts/fts-parser-tika.c

2015-03-13 16:04:01 +0200 Timo Sirainen <tss@iki.fi> (5518182)

    fts: If fts-parser fails, stop indexing instead of ignoring the error and
    continuing. This is especially important in case there's just some temporary
    error.


M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser-tika.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-parser.h

2015-03-13 15:06:10 +0200 Timo Sirainen <tss@iki.fi> (ca20a10)

    Makefile: Avoid make race conditions when generating files that are used as
    dependencies. The file creation needs to be atomic, otherwise another
    process can start trying to use an unfinished file. So we first create .tmp
    file and then mv it into the final one.


M	src/config/Makefile.am
M	src/lib-dict/Makefile.am
M	src/lib-sql/Makefile.am
M	src/lib-storage/register/Makefile.am
M	src/lib/Makefile.am
M	src/plugins/quota/Makefile.am

2015-03-12 19:39:03 +0200 Timo Sirainen <tss@iki.fi> (3818c2a)

    lib-mail: Added HEADER_FILTER_CRLF_PRESERVE flag to istream-header-filter.


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-header-filter.h

2015-03-12 17:41:09 +0200 Timo Sirainen <tss@iki.fi> (c999c1f)

    Added signature for changeset 0f8f0d8ee607


M	.hgsigs

2015-03-12 17:41:05 +0200 Timo Sirainen <tss@iki.fi> (c512970)

    Added tag 2.2.16 for changeset 0f8f0d8ee607


M	.hgtags

2015-03-12 17:41:05 +0200 Timo Sirainen <tss@iki.fi> (c087194)

    Released v2.2.16.


M	NEWS
M	configure.ac

2015-03-12 15:50:59 +0200 Timo Sirainen <tss@iki.fi> (55171d0)

    rawlog: Updated -i -> -I also in usage string.


M	src/util/rawlog.c

2015-03-12 15:50:07 +0200 Timo Sirainen <tss@iki.fi> (49f88c9)

    rawlog: Changed -i to -I parameter We can't use -i, because it's handled by
    lib-master for instance selection.


M	src/util/rawlog.c

2015-03-12 15:42:31 +0200 Timo Sirainen <tss@iki.fi> (ac4ec9d)

    dict: cdb support should be available only to dict process. Because
    otherwise we need to link libcdb into pretty much all Dovecot binaries,
    which is part of what having the dict proxy tries to avoid.

    We could implement the direct linking optionally as well, but that would 
    need to be done in a bit more generic way rather than just hardcoding it
    only to cdb support.

M	configure.ac
M	src/lib-dict/Makefile.am

2015-03-12 15:33:13 +0200 Timo Sirainen <tss@iki.fi> (2aa4877)

    doveadm: Fixed table formatter for UTF-8 output. Based on patch by Hardy
    Flor


M	src/doveadm/doveadm-print-table.c

2015-03-12 12:32:54 +0200 Timo Sirainen <tss@iki.fi> (78199a8)

    fts: Added missing error logging/setting.


M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-storage.c

2015-03-12 12:32:30 +0200 Timo Sirainen <tss@iki.fi> (6a262c9)

    doveadm: Added several missing error logging calls.


M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c

2015-03-11 23:05:34 +0200 Timo Sirainen <tss@iki.fi> (13a7cda)

    imapc: Prefetching wasn't done for headers if there weren't also other
    fields.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2015-03-11 20:38:52 +0200 Timo Sirainen <tss@iki.fi> (60df088)

    lib-master: Crashfix to earlier anvil query timeout change.


M	src/lib-master/anvil-client.c

2015-03-11 20:02:20 +0200 Timo Sirainen <tss@iki.fi> (de26c21)

    imapc: Added throttling settings to imapc_features=throttle:a:b:c This
    change could be reverted once good settings are found.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2015-03-11 19:44:48 +0200 Timo Sirainen <tss@iki.fi> (8557c3b)

    lib-imap-client: Implemented a bit more complicated [THROTTLING] behavior.
    The throttling is now more continuous and decreases more slowly.


M	src/lib-imap-client/imapc-connection.c

2015-03-11 18:30:19 +0200 Timo Sirainen <tss@iki.fi> (71417d4)

    imapc: If imapc_features has gmail-migration, fetch X-GM-MSGID at startup
    and cache it. This works only if index files haven't been disabled.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2015-03-11 17:54:27 +0200 Timo Sirainen <tss@iki.fi> (eda6471)

    imapc: Use GUIDs from cache.


M	src/lib-storage/index/imapc/imapc-mail.c

2015-03-11 17:54:21 +0200 Timo Sirainen <tss@iki.fi> (3e546c4)

    imapc: Add prefetched GUIDs to cache.


M	src/lib-storage/index/imapc/imapc-mail.c

2015-03-11 17:29:12 +0200 Timo Sirainen <tss@iki.fi> (4f75b5b)

    imapc: Removed Exchange-workaround for ignoring missing BODY[] replies. This
    causes data loss if server was actually returning a NO temporary error that
    would have succeeded later on.


M	src/lib-storage/index/imapc/imapc-mail.c

2015-03-11 16:40:05 +0200 Timo Sirainen <tss@iki.fi> (2c16769)

    lib-master: Timeout anvil queries after 5 seconds.


M	src/lib-master/anvil-client.c

2015-03-11 16:39:24 +0200 Timo Sirainen <tss@iki.fi> (34f7d3a)

    lib-master: If write() to anvil fails, reconnect to it.


M	src/lib-master/anvil-client.c

2015-03-11 14:39:52 +0200 Timo Sirainen <tss@iki.fi> (b43d7e2)

    imapc: Don't flush prefetch FETCH command before it has mail_prefetch_count
    number of mails.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2015-03-11 14:39:26 +0200 Timo Sirainen <tss@iki.fi> (2a1d9dd)

    imapc: Make sure we don't flush prefetch FETCH command unneededly.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.h

2015-03-11 13:28:24 +0200 Timo Sirainen <tss@iki.fi> (8514040)

    doveadm: Initialize logging. Most importantly so that LOG_STDERR_TIMESTAMP
    can be used to prefix each line with a timestamp.


M	src/doveadm/doveadm.c

2015-03-11 13:27:49 +0200 Timo Sirainen <tss@iki.fi> (e52f55c)

    lib-master: Get log timestamp prefix from LOG_STDERR_TIMESTAMP environment.


M	src/lib-master/master-service.c

2015-03-09 21:27:51 +0200 Timo Sirainen <tss@iki.fi> (a7b2e5e)

    lib-fs: Optimized fs_stat() for fs-metawrap after writing a file.


M	src/lib-fs/fs-metawrap.c

2015-03-09 20:33:13 +0200 Timo Sirainen <tss@iki.fi> (876cc43)

    fs-posix: Don't close fd after successful write. 5bd6e2eee650 should have
    been done only on failures.


M	src/lib-fs/fs-posix.c

2015-03-09 20:26:50 +0200 Timo Sirainen <tss@iki.fi> (664bf3e)

    fs-posix: Implement fs_stat() with fstat() if fd is already open.


M	src/lib-fs/fs-posix.c

2015-03-09 19:29:04 +0200 Timo Sirainen <tss@iki.fi> (b82a8dd)

    fs-posix: Don't try to unlink() the temp file twice after failure.


M	src/lib-fs/fs-posix.c

2015-03-09 17:36:11 +0200 Timo Sirainen <tss@iki.fi> (737c222)

    lib: And another module_dir_load() bugfix..


M	src/lib/module-dir.c

2015-03-09 17:15:03 +0200 Timo Sirainen <tss@iki.fi> (4d9cd7a)

    lib: Small error logging improvements for module_dir_load()


M	src/lib/module-dir.c

2015-03-09 17:14:35 +0200 Timo Sirainen <tss@iki.fi> (a870ffe)

    lib: Recent module_dir_load() changes broke error logging. If there was a
    required list of modules, the error was properly returned. But when loading
    all plugins, the errors weren't logged.


M	src/lib/module-dir.c

2015-03-09 16:17:08 +0200 Timo Sirainen <tss@iki.fi> (2e429f7)

    indexer-worker: Added missing error logging.


M	src/indexer/master-connection.c

2015-03-09 15:32:23 +0200 Timo Sirainen <tss@iki.fi> (46e227c)

    lib-imap-client: Fixed GMail [THROTTLED] detection. It's not a
    resp-text-code, but appended at the end of line.


M	src/lib-imap-client/imapc-connection.c

2015-03-09 15:26:45 +0200 Timo Sirainen <tss@iki.fi> (08f429b)

    fs-posix: Don't close file fd after its writing is finished. This allows
    reading the file after writing without having to re-open the file (which in
    turn might fail in some situations).


M	src/lib-fs/fs-posix.c

2015-03-09 15:26:01 +0200 Timo Sirainen <tss@iki.fi> (6ff4d08)

    fs-posix: Make sure the file isn't attempted to be opened for reading while
    it's being written. Also if the write failed, the read should fail.


M	src/lib-fs/fs-posix.c

2015-03-06 17:47:38 +0200 Timo Sirainen <tss@iki.fi> (cc8bf5e)

    Added signature for changeset a3c27cec4112


M	.hgsigs

2015-03-06 17:47:34 +0200 Timo Sirainen <tss@iki.fi> (50ed842)

    Added tag 2.2.16.rc1 for changeset a3c27cec4112


M	.hgtags

2015-03-06 17:47:34 +0200 Timo Sirainen <tss@iki.fi> (3dad5b1)

    Released v2.2.16.rc1.


M	NEWS
M	configure.ac

2015-03-06 17:46:26 +0200 Timo Sirainen <tss@iki.fi> (846adf6)

    lib-mail: Unit test fix to make static analyzer happier


M	src/lib-mail/test-message-part.c

2015-03-06 16:37:07 +0200 Timo Sirainen <tss@iki.fi> (f24f2b5)

    lmtp: Fixed lmtp_user_concurrency_limit=0 to actually mean unlimited


M	src/lmtp/commands.c

2015-03-06 16:33:23 +0200 Timo Sirainen <tss@iki.fi> (d25877a)

    lda/lmtp: Added a hardcoded LDA_SUBMISSION_TIMEOUT_SECS=30 timeout for SMTP
    client. Maybe we could have a new setting if needed later on, but we've been
    working pretty successfully without any timeout for a long time..


M	src/lda/main.c
M	src/lib-lda/mail-deliver.h
M	src/lib-lda/mail-send.c
M	src/lmtp/commands.c

2015-03-06 16:32:05 +0200 Timo Sirainen <tss@iki.fi> (0d4483b)

    lib-lda: Added smtp_client_deinit_timeout() to give a session timeout.


M	src/lib-lda/smtp-client.c
M	src/lib-lda/smtp-client.h

2015-03-06 16:30:55 +0200 Timo Sirainen <tss@iki.fi> (18dad02)

    lib-lda: lmtp client now supports checking for timeouts internally. The
    default is still to have no timeout.


M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h

2015-03-06 11:55:45 +0200 Timo Sirainen <tss@iki.fi> (c793a28)

    lib-fs: struct fs_stats comment updates


M	src/lib-fs/fs-api.h

2015-03-06 11:51:55 +0200 Timo Sirainen <tss@iki.fi> (4dfd8a7)

    lib-fs: Minor code cleanup: Merge read_counted & prefetch_counted into
    read_or_prefetch_counted


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2015-03-06 02:23:56 +0200 Timo Sirainen <tss@iki.fi> (87845ba)

    lib-master: Added anvil_client_query_abort()


M	src/lib-master/anvil-client.c
M	src/lib-master/anvil-client.h

2015-03-06 02:10:02 +0200 Timo Sirainen <tss@iki.fi> (42abccd)

    lmtp: Added lmtp_user_concurrency_limit setting. This allows limiting the
    number of concurrent deliveries to a single user. Useful in case one user is
    receiving a lot of mails and causing other deliveries to be delayed. If the
    limit is reached, Dovecot returns temporary failure error at DATA stage.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h
M	src/lmtp/main.c
M	src/lmtp/main.h

2015-03-06 02:06:10 +0200 Timo Sirainen <tss@iki.fi> (b02e7ba)

    lmtp: Changed rcpt_to array to contain pointers to struct mail_recipient
    This allow storing the pointers so they don't change.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2015-03-06 01:01:28 +0200 Timo Sirainen <tss@iki.fi> (9ab3395)

    pop3-login: Disconnect client on 3rd invalid command (not 11th).


M	src/pop3-login/client.c

2015-03-06 00:41:14 +0200 Timo Sirainen <tss@iki.fi> (52b61e1)

    lib: Minor improvement to test-wildcard-match unit test.


M	src/lib/test-wildcard-match.c

2015-03-06 00:40:46 +0200 Timo Sirainen <tss@iki.fi> (666286d)

    quota: If overquota-flag in userdb is wrong, execute a configured script.
    The idea here is that a quota_warning script could set user's overquota-flag
    to e.g. LDAP where MTA could reject mails already at RCPT TO stage. The
    quota_warning scripts however have race conditions that are difficult (or
    impossible) to fix, so sometimes the overquota-flag could become wrong and
    might require manual intervention to fix it. This feature is supposed to
    solve the issue by comparing the overquota-flag's status to the actual
    current quota usage and execute a script to fix up the situation if needed.
    This script is of course racy as well, but there's always the next login
    that can fix the situation. Also it's pretty rare that user's quota is
    jumping just around the limit.

    The overquota-flag name in userdb must be "quota_over_flag". There are two 
    settings to configure what to do:

    plugin {
     # If quota_over_flag=TRUE, the overquota-flag is enabled. Otherwise not.
     quota_over_flag_value = TRUE

      # Any non-empty value for quota_over_flag means user is over quota.
     # Wildcards can be used in a generic way, e.g. "*yes" or "*TRUE*"
     #quota_over_flag_value = *

      # Service script to execute if overquota-flag is wrong. Configured the
     # same as quota_warning scripts. The current quota_over_flag's value is
     # appended as the last parameter.
     quota_over_script = quota-warning mismatch %u
    }

M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/quota.h

2015-03-05 23:02:48 +0200 Timo Sirainen <tss@iki.fi> (379175c)

    stats process/plugin redesign to be more modular. The visible functionality
    doesn't actually change with this patch yet, but it allows other
    plugins/services to add their own fields to stats process. For example auth
    process could send auth success/failures or auth cache hits/misses.


M	configure.ac
M	src/Makefile.am
M	src/lib-dovecot/Makefile.am
A	src/lib-stats/Makefile.am
A	src/lib-stats/stats-parser.c
A	src/lib-stats/stats-parser.h
A	src/lib-stats/stats.c
A	src/lib-stats/stats.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/plugins/imap-stats/Makefile.am
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/stats/Makefile.am
A	src/plugins/stats/mail-stats-fill.c
A	src/plugins/stats/mail-stats.c
A	src/plugins/stats/mail-stats.h
M	src/plugins/stats/stats-connection.c
M	src/plugins/stats/stats-connection.h
M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h
M	src/stats/Makefile.am
M	src/stats/client-export.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-domain.h
M	src/stats/mail-ip.c
M	src/stats/mail-ip.h
M	src/stats/mail-server-connection.c
M	src/stats/mail-session.c
M	src/stats/mail-session.h
M	src/stats/mail-stats.c
M	src/stats/mail-stats.h
M	src/stats/mail-user.c
M	src/stats/mail-user.h
M	src/stats/main.c

2015-03-05 22:19:02 +0200 Timo Sirainen <tss@iki.fi> (bebc9fe)

    lib: Don't call ioloop context deactivate() if activate() hasn't been called
    yet. This could have happened immediately after the callback was registered.


M	src/lib/ioloop-private.h
M	src/lib/ioloop.c

2015-03-05 22:18:04 +0200 Timo Sirainen <tss@iki.fi> (302167a)

    lib-fs: Track how many different operations have been done on the fs.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2015-03-05 22:17:09 +0200 Timo Sirainen <tss@iki.fi> (4c827a0)

    lib-fs: Added fs_get_parent() and fs_get_driver() These can be used to
    iterate through fs wrappers and see what they are.


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2015-03-03 19:48:23 +0200 Timo Sirainen <tss@iki.fi> (bcd946a)

    doveadm backup: Try to avoid crashing on unexpected destination changes.
    It's a bit difficult to reproduce this bug.. But at least this change should
    change the assert, if nothing else.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2015-03-03 19:34:59 +0200 Timo Sirainen <tss@iki.fi> (f771d4d)

    dsync: Open mailboxes with readonly-flag whenever possible. There shouldn't
    be any actual functional difference though.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2015-03-03 19:32:28 +0200 Timo Sirainen <tss@iki.fi> (de3175a)

    doveadm backup -R: Open the mailbox as readonly, so with imapc EXAMINE is
    used.


M	src/doveadm/dsync/dsync-brain-mailbox.c

2015-03-03 17:25:33 +0200 Timo Sirainen <tss@iki.fi> (3f50c13)

    lib-imap-client: Get capabilities again after reconnection to server. This
    is needed most importantly if we're not using plaintext authentication to
    log in.


M	src/lib-imap-client/imapc-connection.c

2015-03-03 01:05:49 +0200 Timo Sirainen <tss@iki.fi> (a0d0650)

    lib-fs: Added FS_ITER_FLAG_NOCACHE


M	src/lib-fs/fs-api.h

2015-03-02 21:14:55 +0200 Timo Sirainen <tss@iki.fi> (ddc8fe2)

    rawlog: Removed double '.' chars from log filenames


M	src/util/rawlog.c

2015-03-02 15:07:20 +0200 Timo Sirainen <tss@iki.fi> (640d320)

    dict-redis: Added support for changing the Redis database. Adding :db=N to
    the dict string specifies the database.


M	src/lib-dict/dict-redis.c

2015-03-02 14:41:11 +0200 Timo Sirainen <tss@iki.fi> (d907b51)

    lib: Added assert to i_stream_create_seekable*() to have non-zero
    max_buffer_size. This size is used for the created fd istream and it can't
    be zero.


M	src/lib/istream-seekable.c

2015-03-02 14:36:15 +0200 Timo Sirainen <tss@iki.fi> (ac6bba6)

    lib: Give a name for istream-seekable's temporary fd istream.


M	src/lib/istream-seekable.c

2015-03-01 22:14:01 +0200 Timo Sirainen <tss@iki.fi> (1bf1a24)

    lib-storage: Allow up to 255 chars in a single mailbox hierarchy name. This
    also reduces the max number of hierarchy levels, but 16 should still be
    enough for normal uses.


M	src/lib-storage/mailbox-list.c

2015-02-27 14:29:10 +0200 Timo Sirainen <tss@iki.fi> (be5a825)

    fts-lucene: Fixed lookups from virtual mailboxes with over 32 physical
    mailboxes.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2015-02-26 20:24:16 +0200 Timo Sirainen <tss@iki.fi> (5dc8572)

    dsync: If we get disconnected from remoset server, exit with EX_TEMPFAIL
    Instead of 1000, which gets truncated to 232.


M	src/doveadm/doveadm-dsync.c

2015-02-25 18:58:50 +0200 Timo Sirainen <tss@iki.fi> (1bea995)

    lib-index: Added an assert. It seems to be triggering later on, but not sure
    how it's happening.


M	src/lib-index/mail-transaction-log-file.c

2015-02-25 15:06:29 +0200 Timo Sirainen <tss@iki.fi> (68801da)

    doveadm: If command going through multiple users fails with user-specific
    error, don't stop.


M	src/doveadm/doveadm-mail-server.c

2015-02-25 15:05:22 +0200 Timo Sirainen <tss@iki.fi> (83b7b79)

    lib-auth: auth_master_pass/user_lookup() now returns -2 for user-specific
    errors. Compared to -1 which are about a more generic error with auth
    process communication. If -2 is returned the lookup could still succeed for
    another user.


M	src/doveadm/doveadm-auth.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h

2015-02-24 18:42:43 +0200 Timo Sirainen <tss@iki.fi> (b78bed7)

    expire plugin: If expire_cache=yes, cache the dict db value in dovecot.index
    file. This avoids all of the dict lookups when mails are being saved to a
    mailbox that is tracked for expiring. The only downside is that if the dict
    is externally modified, the changes won't reflect the cached value. This
    isn't normally a problem (except maybe in initial testing stages).


M	src/plugins/expire/expire-plugin.c

2015-02-21 11:40:40 +0200 Timo Sirainen <tss@iki.fi> (98935c8)

    dsync: Debug logging was attempting to read already freed memory.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2015-02-20 14:04:28 +0200 Timo Sirainen <tss@iki.fi> (8d56694)

    LAYOUT=index: Reversed d977a746819d - use storage's list_index_*() callbacks
    after all. Just because we have all the mailbox information in the mailbox
    list index doesn't mean that we necessarily trust the folder mail counts and
    such to be correct. Setting mailbox_list_index_very_dirty_syncs=yes pretty
    much reverts to the earlier behavior.


M	src/lib-storage/list/mailbox-list-index-backend.c

2015-02-20 12:56:43 +0200 Timo Sirainen <tss@iki.fi> (399a7f6)

    dsync: Added more debug output for mailbox renaming.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2015-02-19 19:31:49 +0200 Timo Sirainen <tss@iki.fi> (1497234)

    lib-storage: Index rebuilding (for [sm]dbox) caused it to reset
    dovecot.index.cache file Although in some situations this might be wanted,
    usually it's not needed and simply makes the performance worse. If caching
    is explicitly unwanted the dovecot.index.cache file can be deleted manually
    for now. Perhaps there could be a separate doveadm force-resync parameter to
    do it as well.


M	src/lib-storage/index/index-rebuild.c

2015-02-19 13:45:23 +0200 Timo Sirainen <tss@iki.fi> (5dcaffa)

    Makefile: Added run-test.sh to be cleaned by distclean


M	Makefile.am

2015-02-19 13:05:49 +0200 Timo Sirainen <tss@iki.fi> (d47bd66)

    lib: Make static analyzer happier


M	src/lib/test-istream.c

2015-02-19 13:05:31 +0200 Timo Sirainen <tss@iki.fi> (96f75b4)

    lib: Another test_assert() -> i_assert() change to avoid static analyzer
    warnings.


M	src/lib/test-data-stack.c

2015-02-19 13:03:46 +0200 Timo Sirainen <tss@iki.fi> (98c5951)

    lib: Replaced two test_assert()s checking for NULLs with i_assert()s These
    can never happen anyway, and keeping them as test_assert()s cause static
    analyzer to give warnings.


M	src/lib/test-data-stack.c
M	src/lib/test-printf-format-fix.c

2015-02-19 12:00:11 +0200 Timo Sirainen <tss@iki.fi> (1183340)

    fs-posix: Removed the FS_PROPERTY_DIRECTORIES after all. We could have kept
    it if we removed the auto-rmdir()-parents feature in fs_delete(), but SIS
    code already somewhat relies on it so it's better not to change it for now
    at least.

    The downside here though is that directories are rmdir()ed only if 
    fs_settings.root_dir is set. So for example "doveadm fs delete -R" doesn't 
    ever rmdir() any directories. But that's probably not a real problem.

M	src/lib-fs/fs-posix.c

2015-02-19 10:24:09 +0200 Timo Sirainen <tss@iki.fi> (abf9eb2)

    Makefile: Removed run-test.sh from EXTRA_DIST since it's now generated by
    configure


M	Makefile.am

2015-02-17 23:13:22 +0200 Timo Sirainen <tss@iki.fi> (e545e42)

    lib-fs: fs-posix needs to return FS_PROPERTY_DIRECTORIES


M	src/lib-fs/fs-posix.c

2015-02-17 23:13:00 +0200 Timo Sirainen <tss@iki.fi> (95c13a2)

    doveadm fs delete -R: Delete the root directory also.


M	src/doveadm/doveadm-fs.c

2015-02-17 23:07:00 +0200 Timo Sirainen <tss@iki.fi> (aab0e25)

    doveadm fs delete: When recursively deleting files, delete directories with
    "/" prefix. Some backends require this to properly delete the file. Those
    that don't can ignore it easily.


M	src/doveadm/doveadm-fs.c

2015-02-17 22:06:14 +0200 Timo Sirainen <tss@iki.fi> (fb10881)

    doveadm fetch: Removed unused code.


M	src/doveadm/doveadm-mail-fetch.c

2015-02-17 20:43:57 +0200 Timo Sirainen <tss@iki.fi> (41843bd)

    lib-fs: Added FS_METADATA_OBJECTID macro.


M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-metawrap.c

2015-02-17 20:42:59 +0200 Timo Sirainen <tss@iki.fi> (8656b62)

    lib-fs: Added flag for iteration returning object IDs. The flag is only
    allowed to be used if FS_PROPERTY_OBJECTIDS is set (to avoid writing extra
    code for backends that don't support this).


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2015-02-17 16:02:49 +0200 Timo Sirainen <tss@iki.fi> (acfdd1b)

    imapc: Fixed STATUS_FIRST_RECENT_UID to return the (mostly) correct UID.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2015-02-15 10:11:01 +0200 Timo Sirainen <tss@iki.fi> (e617d6e)

    doveadm: Added "save" command to directly save mail to specified mailbox.
    The mail is read from stdin.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-mail-save.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2015-02-15 10:09:19 +0200 Timo Sirainen <tss@iki.fi> (32c779d)

    doveadm: Added support for mail commands to read an input stream (from
    stdin) This is done by calling doveadm_mail_get_input() from the command's
    init() function. Currently it reads the entire input into a seekable istream
    with hardcoded 5 minute timeout. The input stream sending works also through
    doveadm proxying.

    This could probably be used by dsync at some point to support proxying over 
    doveadm proxies, but that would require some more work. Especially a flag 
    for commands to specify that they allow non-blocking input streams.

M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/server-connection.c
M	src/doveadm/server-connection.h

2015-02-15 10:03:10 +0200 Timo Sirainen <tss@iki.fi> (83773f7)

    lib-mail: ostream-dot API changes The dot-line sending is now done when
    o_stream_flush() is called. This should be used instead of relying on
    close() doing it, because it still needs to write a few bytes and there are
    no guarantees that the parent stream allows sending them.

    Also added force_extra_crlf parameter, which specifies whether CRLF should 
    always be written before the dot-line, even when it already contained CRLF. 
    This is useful if the input is read with 
    i_stream_create_dot(send_last_lf=FALSE), since it allows sending a stream 
    that doesn't have to end with LF.

M	src/lib-mail/ostream-dot.c
M	src/lib-mail/ostream-dot.h
M	src/lib-mail/test-ostream-dot.c

2015-02-15 09:55:56 +0200 Timo Sirainen <tss@iki.fi> (f7355a5)

    lib-mail: istream-dot should have immediately returned error if dot-line was
    missing at EOF.


M	src/lib-mail/istream-dot.c

2015-02-15 09:55:05 +0200 Timo Sirainen <tss@iki.fi> (fb50249)

    lib: If i_stream_read() sets stream_errno even if it didn't return -1, make
    sure we set eof=TRUE


M	src/lib/istream.c

2015-02-15 09:54:45 +0200 Timo Sirainen <tss@iki.fi> (b8c009e)

    lib: If istream-seekable's parent stream returns error, make sure we set
    eof=TRUE


M	src/lib/istream-seekable.c

2015-02-14 09:47:41 +0200 Timo Sirainen <tss@iki.fi> (77706d1)

    lib-imap-client: Improved error message a bit if server disconnects.


M	src/lib-imap-client/imapc-connection.c

2015-02-13 16:39:30 +0200 Timo Sirainen <tss@iki.fi> (fc63bad)

    configure: Removed unnecessary lines left by the previous commit.


M	configure.ac

2015-02-13 16:38:35 +0200 Timo Sirainen <tss@iki.fi> (e42dd71)

    Link all libstorage.la dependencies into the library itself instead. Instead
    of keeping a lot of different libraries in LIBDOVECOT_STORAGE, which have
    circular dependencies and may cause linking issues.


M	configure.ac
M	src/lib-storage/Makefile.am

2015-02-13 14:35:54 +0200 Timo Sirainen <tss@iki.fi> (a76bcf8)

    dovecot-config: Added DOVECOT_INSTALLED parameter. Also added
    dovecot_installed_moduledir to dovecot.m4

    These can be used by external plugins to access some headers and libraries 
    that don't already have existing DOVECOT_* parameters in dovecot-config.

M	Makefile.am
M	dovecot.m4

2015-02-12 14:38:18 +0200 Timo Sirainen <tss@iki.fi> (bd5b580)

    dovecot-config: Added LIBDOVECOT_NOTIFY_INCLUDE


M	dovecot-config.in.in
M	dovecot.m4

2015-02-12 13:29:23 +0200 Timo Sirainen <tss@iki.fi> (076cc77)

    dovecot-config: Added lib-storage/index/imapc also to
    LIBDOVECOT_IMAPC_INCLUDE


M	dovecot-config.in.in

2015-02-12 12:42:39 +0200 Timo Sirainen <tss@iki.fi> (0d2a67d)

    dovecot-config: Added LIBDOVECOT_IMAPC_INCLUDE and LIBDOVECOT_FTS_INCLUDE


M	dovecot-config.in.in
M	dovecot.m4

2015-02-12 10:49:28 +0200 Timo Sirainen <tss@iki.fi> (432dd1f)

    fts: Fixed memory leak in HTML parsing


M	src/plugins/fts/fts-parser-html.c

2015-02-11 11:56:59 +0200 Timo Sirainen <tss@iki.fi> (0226f0f)

    fts: Fixed error printing if fts wasn't enabled for user's default
    namespace.


M	src/plugins/fts/doveadm-fts.c

2015-02-10 17:29:31 +0200 Timo Sirainen <tss@iki.fi> (fd2ede3)

    dovecot-config: Added lib-sasl path into LIBDOVECOT_INCLUDE.


M	dovecot-config.in.in

2015-02-10 13:12:42 +0200 Timo Sirainen <tss@iki.fi> (cd244bb)

    dovecot.m4: External plugins can now more easily run their tests via
    Valgrind. DC_DOVECOT macro automatically adds RUN_TEST variable to
    Makefiles, which can be used to call any test programs. If valgrind exists,
    the tests are run through it. This is done by writing run-test.sh to the
    build directory, so the original run-test.sh in hg is no longer needed.


M	.hgignore
M	configure.ac
M	dovecot.m4
D	run-test.sh

2015-02-10 12:31:12 +0200 Phil Carmody <phil@dovecot.fi> (212a34c)

    lib: istream create helpers for common cases Several clients want to create
    streams from buffer_t and string_t, we may as well make it easy for them

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/istream.h

2015-02-09 21:58:13 +0200 Timo Sirainen <tss@iki.fi> (7676a04)

    dsync: Don't try to rename namespace prefixes.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2015-02-09 21:45:04 +0200 Timo Sirainen <tss@iki.fi> (84a1abe)

    dsync: Fixed assert-crash when the two mailbox trees differed only by their
    directory names.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2015-02-09 15:38:42 +0200 Timo Sirainen <tss@iki.fi> (68b3865)

    doveadm copy/move/import: Delay initializing source user until run() This
    fixes using them with doveadm proxying.


M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-import.c

2015-02-09 15:21:55 +0200 Timo Sirainen <tss@iki.fi> (4268189)

    doveadm: Added comments to struct doveadm_mail_cmd_vfuncs


M	src/doveadm/doveadm-mail.h

2015-02-09 13:03:47 +0200 Timo Sirainen <tss@iki.fi> (a03f222)

    doveadm: Reverted changeset 3b89f2f4ffb3, which avoided calling init() for
    proxied commands. The init() is required for all commands that print
    something, because otherwise the doveadm_print_header*() isn't called and
    the commands crash.

    The reason for the original change was that some commands' init() attempted 
    to do too much work on the proxy, which ended up failing. So looks like the 
    proper fix is to just remove this kind of extra work from init().

M	src/doveadm/doveadm-mail.c

2015-02-09 04:03:12 +0200 Timo Sirainen <tss@iki.fi> (f2880c3)

    log: If too much logging data is sent, show it in process title.


M	src/log/log-connection.c
M	src/log/log-connection.h
M	src/log/main.c
M	src/master/service-process.c

2015-02-07 18:39:05 +0200 Timo Sirainen <tss@iki.fi> (aed2118)

    log: Log a warning if some connection is logging faster than we can write.


M	src/log/log-connection.c

2015-02-07 18:23:58 +0200 Timo Sirainen <tss@iki.fi> (f45d907)

    log: Don't spend more than 100 msecs at a time logging one connection.


M	src/log/log-connection.c

2015-02-07 18:17:59 +0200 Timo Sirainen <tss@iki.fi> (f684939)

    log: Small cleanup: Include log connection prefix when logging read()
    errors.


M	src/log/log-connection.c

2015-02-07 18:14:53 +0200 Timo Sirainen <tss@iki.fi> (452455b)

    log: Minor cleanup: Update ioloop_timeval whenever reading input from log
    client.


M	src/log/log-connection.c

2015-02-06 19:03:20 +0200 Timo Sirainen <tss@iki.fi> (842a57e)

    lib: Accidentally committed a nonexistent function call in previous commit.


M	src/lib/module-dir.c

2015-02-06 18:18:19 +0200 Timo Sirainen <tss@iki.fi> (351668a)

    lib-storage: Use module_dir_try_load_missing() to load user plugins.


M	src/lib-storage/mail-storage-service.c

2015-02-06 18:18:10 +0200 Timo Sirainen <tss@iki.fi> (e05a7d1)

    lib: Added module_dir_try_load_missing() that returns error instead of
    logging it. Also module_names now can be given for it without i_fatal()
    being called.


M	src/lib/module-dir.c
M	src/lib/module-dir.h

2015-02-06 18:17:10 +0200 Timo Sirainen <tss@iki.fi> (a48ccad)

    lib-storage: Previous log prefix changing code started accessing freed
    memory.


M	src/lib-storage/mail-storage-service.c

2015-02-06 17:06:36 +0200 Timo Sirainen <tss@iki.fi> (39f5c2b)

    lib-storage: Set the user log prefix earlier when initializing user. So the
    full prefix with session and other useful information is included in the log
    message as early as possible. Some fatal/panic errors wouldn't even have
    shown the username.


M	src/lib-storage/mail-storage-service.c

2015-02-06 17:04:52 +0200 Timo Sirainen <tss@iki.fi> (d894bcd)

    lib: Added i_get_failure_prefix()


M	src/lib/failures.c
M	src/lib/failures.h

2015-02-05 19:40:25 +0200 Timo Sirainen <tss@iki.fi> (ed6d4c2)

    dsync: Fixed crash in earlier patch if node didn't have a namespace. This
    shouldn't have happened except in test-dsync-mailbox-tree-sync, but easier
    and safer to fix it here.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2015-02-05 19:36:29 +0200 Timo Sirainen <tss@iki.fi> (5a470af)

    dsync: Added assert to make sure namespace prefix isn't attempted to be
    renamed. This can happen, I'm just not sure how exactly.. The previous
    behavior caused assert-crashes also, this change just makes it happen
    earlier.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2015-02-05 19:20:17 +0200 Timo Sirainen <tss@iki.fi> (6a47938)

    dsync: Don't assert-crash in configs where INBOX doesn't have a parent
    namespace. The inbox=yes namespace of course exists, but if there is no
    prefix="" or prefix=INBOX/ namespace, then INBOX doesn't clearly belong to
    any namespace.


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2015-02-03 20:27:49 +0200 Timo Sirainen <tss@iki.fi> (a46162e)

    dsync: Make sure when fixing mailbox names we don't try to change the
    namespace prefix. Although in normal installations this it wouldn't have
    happened in any case.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c

2015-02-03 20:23:52 +0200 Timo Sirainen <tss@iki.fi> (a590a80)

    lib-storage: Avoid assert-crashing on mailbox_verify_*_name() with invalid
    namespace prefix.


M	src/lib-storage/mail-storage.c

2015-02-03 18:47:54 +0200 Timo Sirainen <tss@iki.fi> (4d2e65d)

    imapc: Fixed modseq search for previous imapc_features=search change


M	src/lib-storage/index/imapc/imapc-search.c

2015-02-03 18:33:12 +0200 Timo Sirainen <tss@iki.fi> (6e1cac3)

    imapc: Added imapc_features=search support for sending SEARCH commands.
    Currently requires the remote server to support ESEARCH (but this would be
    easy to avoid). This is only minimally tested for now, so bugs may exist
    (especially related to sub-queries).


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-mailbox.c
A	src/lib-storage/index/imapc/imapc-search.c
A	src/lib-storage/index/imapc/imapc-search.h
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2015-02-03 10:15:38 +0200 Timo Sirainen <tss@iki.fi> (190e48d)

    lib-imap-client: Implemented support for GMail [THROTTLED] resp-text-code.
    If we receive it, start throttling future commands by waiting exponentially
    longer until we no longer receive [THROTTLED]. Max wait time is currently 16
    seconds.


M	src/lib-imap-client/imapc-connection.c

2015-02-02 23:48:30 +0200 Stephan Bosch <stephan@rename-it.nl> (5e4cdaa)

    lib-http: client: Fixed double unref of request when error occurs during
    http_client_request_try_retry(). Much like when the request is first
    submitted, any errors that occur while attempting a retry from within the
    callback are now delayed in a zero timer.


M	src/lib-http/http-client-request.c

2015-02-02 10:26:44 +0200 Phil Carmody <phil@dovecot.fi> (cca8abd)

    lib: array - test count/isempty/nonepty Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/lib/test-array.c

2015-02-02 10:24:42 +0200 Phil Carmody <phil@dovecot.fi> (fbb7047)

    lib: array - two helpers to avoid wasteful array_count There's no need to
    dereference array->element_size and perform a division when all you care
    about is the boolean isempty/nonempty predicate:

    $ git grep 'array_count(.*) > 0' | wc -l 77
    $ git grep 'array_count(.*) == 0' | wc -l 95

    Changing 6 of them has the following impact on the code:

    $ size src/lib-imap-client/imapc-connection.o
      text    data     bss     dec     hex filename
     20879       0       4   20883    5193
    src/lib-imap-client/imapc-connection.o
    $ size src/lib-imap-client/imapc-connection.o
      text    data     bss     dec     hex filename
     20796       0       4   20800    5140
    src/lib-imap-client/imapc-connection.o

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.h

2015-01-31 01:10:56 +0200 Timo Sirainen <tss@iki.fi> (6b70a71)

    replicator: Previous "last successful sync" timestamp change wrote data
    wrong to replicator.db Patch by Matthew Via / Rackspace


M	src/replication/replicator/replicator-queue.c

2015-01-30 12:29:25 +0200 Timo Sirainen <tss@iki.fi> (a1a7935)

    imap: If GETMETADATA fails for some mailbox, don't send the error message
    mixed in the METADATA reply line.


M	src/imap/cmd-getmetadata.c

2015-01-30 12:19:58 +0200 Timo Sirainen <tss@iki.fi> (e05ccef)

    imap: Dynamic capabilities weren't being added correctly when
    imap_capability setting was used. They were supposed to be added when '+'
    prefix was used in imap_capability and not added when it wasn't. But the
    behavior was exactly the opposite.


M	src/imap/imap-client.c

2015-01-30 11:53:12 +0200 Timo Sirainen <tss@iki.fi> (e054714)

    lib: str_sanitize*() max_len parameter renamed to max_bytes to describe it
    more accurately.


M	src/lib/str-sanitize.c
M	src/lib/str-sanitize.h

2015-01-30 11:52:33 +0200 Timo Sirainen <tss@iki.fi> (5a43bb5)

    lib: Various fixes to str_sanitize*()  - UTF-8 sequences could have been
    truncated to become partial sequences  - Truncation may not have happened at
    all to text containing UTF-8  - str_sanitize_append() might have truncated
    string beyond what we were    appending, although that happened only if
    max_len was very small


M	src/lib/str-sanitize.c
M	src/lib/test-str-sanitize.c

2015-01-30 03:12:37 +0200 Timo Sirainen <tss@iki.fi> (69c92cb)

    replicator: Remember last successful sync and show it in "doveadm replicator
    status" Patch by Matthew Via / Rackspace


M	src/doveadm/doveadm-replicator.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-queue.h

2015-01-29 18:43:15 +0200 Timo Sirainen <tss@iki.fi> (eefcf71)

    lib-ssl-iostream: Don't set EPIPE/ECONNRESET error to istream when
    connection is closed. Several istream users verify at EOF that
    stream_errno=0 and fail if it isn't.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/istream-openssl.c

2015-01-27 02:19:01 +0200 Timo Sirainen <tss@iki.fi> (a5f7c7c)

    fts: When indexing address headers, don't add MISSING_MAILBOX or
    MISSING_DOMAIN.


M	src/plugins/fts/fts-build-mail.c

2015-01-27 02:07:10 +0200 Timo Sirainen <tss@iki.fi> (1d3ee23)

    fts: Added back fts_expunge_log_uid_count() This was accidentally removed by
    commit 5091f03d70e1


M	src/plugins/fts/fts-expunge-log.c

2015-01-25 10:37:35 -0800 Timo Sirainen <tss@iki.fi> (da273d3)

    lib-mail: Test program wasn't linked with libiconv, causing linking
    failures.


M	src/lib-mail/Makefile.am

2015-01-24 02:15:45 +0200 Phil Carmody <phil@dovecot.fi> (9a6250a)

    lib: array - helper to swap array buffer ownership Currently there's no
    simple way to create a replacement for an array, and then atomically switch
    in that replacement. With this helper, you can just exchange ownership of
    the two lists and then free the new list (which now contains the old
    buffer).

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.h
M	src/lib/test-array.c

2015-01-23 23:19:24 +0200 Timo Sirainen <tss@iki.fi> (f424c15)

    imapc: Merged gmail-pop3 and gmail-labels-keyword features into a single
    gmail-migration feature There's really no other reason to use them except
    for migration.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-sync.c

2015-01-23 23:18:01 +0200 Timo Sirainen <tss@iki.fi> (2813037)

    imapc: With gmail-labels-keyword feature add the $GMailHaveLabels only to
    \All mailbox This is primarily intended for migration, and with this
    behavior dsync can be run just once so it's faster.


M	src/lib-storage/index/imapc/imapc-sync.c

2015-01-21 02:21:35 +0200 Timo Sirainen <tss@iki.fi> (9fd6f70)

    sdbox: Fixed assert-crash when copying mails due to earlier change.


M	src/lib-storage/index/dbox-single/sdbox-copy.c

2015-01-21 01:53:34 +0200 Phil Carmody <phil@dovecot.fi> (6b2f82c)

    plugins/fts: use common guid_128 helpers Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/plugins/fts/fts-expunge-log.c

2015-01-21 01:52:59 +0200 Phil Carmody <phil@dovecot.fi> (5433d56)

    plugins/fts: expunge-log - query function to lookup GUID/UID Constant time
    hash lookup for GUID. Log time lookup in seq_range array.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-expunge-log.h

2015-01-21 01:51:46 +0200 Phil Carmody <phil@dovecot.fi> (8d4428c)

    plugins/fts: expunge-log - create flattened in-RAM log with no backing
    storage Combine each record in a source expunge log. This source log does
    not get deleted afterwards.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-expunge-log.h

2015-01-21 01:48:00 +0200 Phil Carmody <phil@dovecot.fi> (2282944)

    plugins/fts: expunge-log - pull mailbox finding/creating into a helper There
    will be more clients than just this one.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts/fts-expunge-log.c

2015-01-21 01:47:25 +0200 Phil Carmody <phil@dovecot.fi> (2442c23)

    plugins/fts: expunge-log - permit append helpers to have no log to write to
    This is for creating an in-RAM, later queriable, structure which you do not
    want to be written to backing storage. As when you've finished with one,
    there's no concept of a "commit", provide an alternative "abort" way out.
    These are identical apart from the call to the write() routine, so refactor
    the two.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-expunge-log.h

2015-01-21 01:46:13 +0200 Phil Carmody <phil@dovecot.fi> (87b5c1f)

    plugins/fts: expung-log - add the concept of not unlinking at the end No
    behavioural differences, the default is to unlink.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts/fts-expunge-log.c

2015-01-21 01:44:31 +0200 Phil Carmody <phil@dovecot.fi> (ba66ac5)

    lib: seq-range-array - add range changes Pull the _add_range() guts into a
    private helper function, and add a new _add_range_count() helper which also
    returns the number of SEQs added.

    Expand the tests to test this new functionality.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/seq-range-array.c
M	src/lib/seq-range-array.h
M	src/lib/test-seq-range-array.c

2015-01-21 01:42:01 +0200 Phil Carmody <phil@dovecot.fi> (50c05dd)

    lib: data-stack - fix pointer arithmetic compiler warning Clang's
    -fsanitize=unsigned-integer-overflow barfs as follows:

    data-stack.c:477:29: runtime error: negation of 8 cannot be represented in
    type 'unsigned long' data-stack.c:495:15: runtime error: negation of 8
    cannot be represented in type 'unsigned long'

    Which is of course complete bollocks. There is no 8, there's only an 8ul,
    and the negation of 8ul is 0xfffffff8ul (or a wider equivalent). That's the
    law.

    However, the pointer arithmetic which follows the negation, whilst almost 
    certainly working in practice, is probably bogus, so just make the thing 
    signed before the negation, and both problems go away.

    Reported-by: Teemu Huovila <teemu.huovila@dovecot.fi> Signed-off-by: Phil
    Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2015-01-21 00:19:17 +0200 Timo Sirainen <tss@iki.fi> (9a9f331)

    master: Fixed a check to see if login directory has any unix listeners.


M	src/master/master-settings.c

2015-01-20 21:54:58 +0200 Timo Sirainen <tss@iki.fi> (6b23e5a)

    imapc: Implemented imapc_features=gmail-pop3 that also migrates
    pop3_deleted_flag. This also caused gmail-pop3-uidl feature to be renamed to
    simply gmail-pop3, which includes both the features.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2015-01-20 21:49:04 +0200 Timo Sirainen <tss@iki.fi> (2d49958)

    lib-imap-client: Added imapc_command_get_tag()


M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c

2015-01-20 05:41:23 +0200 Timo Sirainen <tss@iki.fi> (e2b63d4)

    imapc: Added imapc_features=gmail-pop3-uidl This allows imapc to generate
    GMail POP3 compatible UIDL so that pop3-migration plugin isn't needed.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h

2015-01-20 04:46:51 +0200 Timo Sirainen <tss@iki.fi> (46a9a33)

    dsync: Allow -m parameter to specify \Special-use mailboxes. Similarly to
    how -x parameter allows them.


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2015-01-20 04:46:26 +0200 Timo Sirainen <tss@iki.fi> (845bac8)

    dsync: Crashfix to -F parameter handling.


M	src/doveadm/dsync/dsync-mailbox-import.c

2015-01-20 04:30:27 +0200 Timo Sirainen <tss@iki.fi> (3394dcb)

    imapc: Added imapc_features=gmail-labels-keyword This is a bit kludgy
    feature mainly intended for migrations from GMail. Unfortunately I couldn't
    figure out any nicer way to do this for now. GMail's "All Mail" folder
    contains all messages in all folders, but it also contains some messages
    that don't exist in other folders. For migrations we want to copy only those
    messages that don't exist elsewhere. This can now be achieved with something
    like:

    doveadm -o imapc_features='gmail-labels-keyword ...' \
     backup -F '-$GmailHaveLabels' mdbox:~/mdbox

    Note that dsync can't handle inserting mails into folders, so if doveadm 
    backup is already run once and one of the existing mails loses all labels, 
    doveadm backup will delete the whole folder and start again.

M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-sync.c

2015-01-20 04:07:09 +0200 Timo Sirainen <tss@iki.fi> (2e652d2)

    dsync: Added -F parameter to sync only mails with[out] specific flag.


M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2015-01-20 03:23:29 +0200 Timo Sirainen <tss@iki.fi> (70df8f3)

    dsync: If same GUID already exists in storage, try to copy it instead of
    recreating the mail. This way most mailbox backends can reduce disk space by
    only doing a reference count update.

    This feature isn't enabled by default. A virtual "All Mails" mailbox needs 
    to be configured using the virtual plugin. Then you need to give this 
    mailbox as -a parameter, e.g.: doveadm sync -a "Virtual/All Mails" ...

    Currently this is implemented by reading through all the GUIDs in the 
    virtual mailbox. This of course isn't very efficient for things like 
    incremental replication. An upcoming conversation plugin will keep track of 
    all the mails' GUIDs, so in future replication should be able to have this 
    functionality efficiently as well.

M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2015-01-20 03:14:37 +0200 Timo Sirainen <tss@iki.fi> (d85a1a9)

    virtual plugin: Read virtual index header when opening virtual mailbox. This
    allows doing some mailbox accessing without actually syncing the mailbox.
    For example MAIL_FETCH_MAILBOX_NAME can be used without crashing.


M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c

2015-01-20 00:20:27 +0200 Timo Sirainen <tss@iki.fi> (da215fe)

    dsync: Added more debug logging.


M	src/doveadm/dsync/dsync-mailbox-import.c

2015-01-19 23:43:37 +0200 Timo Sirainen <tss@iki.fi> (3561c7b)

    dsync: Added -t <timestamp> parameter to save only mails newer than
    <timestamp> If one side has old mails that don't exist on the other side,
    they are ignored (not synced and not deleted).


M	src/doveadm/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2015-01-19 23:40:27 +0200 Timo Sirainen <tss@iki.fi> (d81bbb6)

    lib-storage: Added mail_parse_human_timestamp() to parse human-writable
    timestamps. This isn't really the ideal location for the function, but since
    it uses both lib-settings and lib-imap, there's not any good location for it
    that I can think of..


M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2015-01-19 22:24:42 +0200 Timo Sirainen <tss@iki.fi> (bb25bed)

    doveadm: Added missing error handling to various mail commands. This fixes
    assert-crash that happened when the commands failed, because they hadn't set
    any exit_code.


M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/doveadm-mailbox-list-iter.c

2015-01-19 22:12:58 +0200 Timo Sirainen <tss@iki.fi> (4947cf0)

    lib-storage: Comment updates to mailbox_list_iter_*()


M	src/lib-storage/mailbox-list-iter.h

2015-01-19 22:11:29 +0200 Timo Sirainen <tss@iki.fi> (ded274d)

    doveadm: If mailbox list iteration fails, log the error reason.


M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c

2015-01-19 22:10:17 +0200 Timo Sirainen <tss@iki.fi> (1682046)

    imap-urlauth: If mailbox list iteration fails, log the error.


M	src/lib-imap-urlauth/imap-urlauth-backend.c

2015-01-19 22:09:14 +0200 Timo Sirainen <tss@iki.fi> (a5056d1)

    virtual plugin: If mailbox list iteration fails, log the error.


M	src/plugins/virtual/virtual-config.c

2015-01-19 21:58:19 +0200 Timo Sirainen <tss@iki.fi> (6358619)

    lib-storage: Removed caching body snippet while message is being saved. This
    broke saving mails with dbox, because it attempts to open the mails too
    early. Also the generation was a bit costly operation to do if it wasn't
    actually wanted to be cached.

    So in future we'd first want to check if body snippet is actually wanted. If 
    it is, then generate the potential snippets while the message is being 
    parsed (always generate the snippet for the best found MIME part, replacing 
    existing snippets when needed). This requires the message_snippet_generate() 
    API to support sending input as partial message_blocks.

M	src/lib-storage/index/index-mail-headers.c

2015-01-19 21:53:00 +0200 Timo Sirainen <tss@iki.fi> (e4d0547)

    lib-storage: MAIL_FETCH_BODY_SNIPPET should seek the mail stream back to
    original position.


M	src/lib-storage/index/index-mail.c

2015-01-19 21:52:21 +0200 Timo Sirainen <tss@iki.fi> (cc0a651)

    dbox: Added asserts to make sure the mail body isn't tried to be read too
    early while saving. If the mail headers are still being written, the opening
    will just fail thinking the mail is corrupted.


M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-file.h
M	src/lib-storage/index/dbox-single/sdbox-save.c

2015-01-19 21:11:29 +0200 Timo Sirainen <tss@iki.fi> (9456cdb)

    fts: Fixed assert-crash in HTML parsing, broken by the earlier changes.


M	src/plugins/fts/fts-parser-html.c

2015-01-17 04:14:58 +0200 Timo Sirainen <tss@iki.fi> (76d4ff1)

    lib: iostream-rawlog now writes to ostreams instead of directly to fds.


M	src/lib/iostream-rawlog-private.h
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-rawlog.h
M	src/lib/istream-rawlog.c
M	src/lib/istream-rawlog.h
M	src/lib/ostream-rawlog.c
M	src/lib/ostream-rawlog.h

2015-01-17 04:14:09 +0200 Timo Sirainen <tss@iki.fi> (981139b)

    lib: Added o_stream_create_passthrough() for creating simple wrapper
    ostreams


M	src/lib/ostream.c
M	src/lib/ostream.h

2015-01-17 04:13:13 +0200 Timo Sirainen <tss@iki.fi> (eb98a03)

    lib: Added o_stream_add_destroy_callback()


M	src/lib/iostream-private.h
M	src/lib/iostream.c
M	src/lib/istream.c
M	src/lib/ostream.c
M	src/lib/ostream.h

2015-01-17 02:40:11 +0200 Timo Sirainen <tss@iki.fi> (7d26aee)

    auth: Changed passdb { continue-ok } handling for credentials lookups. If
    the last passdb after it doesn't return credentials, use the first passdb's
    credentials. This allows implementing plugins that modify the passdb result
    without actually changing the credentials.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/passdb.c

2015-01-17 02:31:24 +0200 Timo Sirainen <tss@iki.fi> (1701b35)

    lib-storage: Added mail_user_init_fs_settings() Also changed
    mailbox_list_init_fs() to use it internally.


M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/lib-storage/mailbox-list.c

2015-01-17 01:19:42 +0200 Timo Sirainen <tss@iki.fi> (26d0966)

    doveadm user: If username is changed by userdb lookup, return it.


M	src/doveadm/doveadm-auth.c

2015-01-17 00:32:10 +0200 Timo Sirainen <tss@iki.fi> (ed897f9)

    doveadm fetch: Added body.snippet field.


M	src/doveadm/doveadm-mail-fetch.c

2015-01-17 00:31:35 +0200 Timo Sirainen <tss@iki.fi> (52fbebc)

    lib-storage: Added MAIL_FETCH_BODY_SNIPPET.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/mail-storage.h

2015-01-17 00:24:36 +0200 Timo Sirainen <tss@iki.fi> (ed9f9fe)

    fts: Parse HTML MIME parts using lib-mail's mail-html2text.


M	src/plugins/fts/Makefile.am
M	src/plugins/fts/fts-parser-html.c
D	src/plugins/fts/html-entities.h

2015-01-17 00:23:36 +0200 Timo Sirainen <tss@iki.fi> (7f7be2c)

    lib-mail: Added message_snippet_generate() to produce a short text snippet
    of a mail.


M	src/lib-mail/Makefile.am
A	src/lib-mail/message-snippet.c
A	src/lib-mail/message-snippet.h
A	src/lib-mail/test-message-snippet.c

2015-01-17 00:15:44 +0200 Timo Sirainen <tss@iki.fi> (c914112)

    lib-mail: Added mail-html2text API What makes it mail-specific is that it
    allows skipping over data inside <blockquote>. This code probably doesn't
    parse HTML perfectly, but hopefully good enough for HTML emails.


M	src/lib-mail/Makefile.am
A	src/lib-mail/html-entities.h
A	src/lib-mail/mail-html2text.c
A	src/lib-mail/mail-html2text.h
A	src/lib-mail/test-mail-html2text.c

2015-01-15 01:26:02 +0200 Timo Sirainen <tss@iki.fi> (b4d14c2)

    lib-mail: Forgot to commit .h file for
    message_decoder_current_content_type() change.


M	src/lib-mail/message-decoder.h

2015-01-15 01:22:04 +0200 Timo Sirainen <tss@iki.fi> (01eef06)

    lib-mail: Added message_decoder_current_content_type()


M	src/lib-mail/message-decoder.c
M	src/lib-mail/test-message-decoder.c

2015-01-15 01:11:34 +0200 Timo Sirainen <tss@iki.fi> (d60a561)

    lib-mail: message-decoder now always sets output->size=0 when headers are
    returned.


M	src/lib-mail/message-decoder.c
M	src/lib-mail/test-message-decoder.c

2015-01-15 01:10:11 +0200 Timo Sirainen <tss@iki.fi> (c389f8b)

    lib-mail: Fixed crash in message-decoder with unknown charsets. Caused by
    earlier changes.


M	src/lib-mail/message-decoder.c

2015-01-15 01:08:00 +0200 Timo Sirainen <tss@iki.fi> (2c70dc3)

    lib-mail: Replaced MAX_TRANSLATION_BUF_SIZE with the new
    CHARSET_MAX_PENDING_BUF_SIZE


M	src/lib-mail/message-decoder.c

2015-01-15 01:05:36 +0200 Timo Sirainen <tss@iki.fi> (63f7632)

    lib-charset: Added CHARSET_MAX_PENDING_BUF_SIZE macro and asserts for it.


M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-charset/charset-utf8.h

2015-01-15 01:05:13 +0200 Timo Sirainen <tss@iki.fi> (d62d6e7)

    lib-charset: Added charset_utf8_to_utf8_begin() wrapper function. It's never
    supposed to fail, so it makes it nicer for the callers who need to use it.


M	src/lib-charset/charset-utf8.c
M	src/lib-charset/charset-utf8.h

2015-01-15 01:03:58 +0200 Timo Sirainen <tss@iki.fi> (32ae620)

    lib: Fixed NUL-handling in uni_utf8_*strlen*() uni_utf8_strlen() could have
    skipped over the ending NUL byte and caused read buffer overflows with
    invalid input.

    uni_utf8_strlen_n() and uni_utf8_partial_strlen_n() now allow NUL bytes in 
    the input and they're treated as regular control characters. Previously the 
    size was actually treated as max_size with early NUL byte termination. 
    Technically this is an API change, but I'm not aware of anything using these 
    functions in an incompatible way.

M	src/lib/test-unichar.c
M	src/lib/unichar.c
M	src/lib/unichar.h

2015-01-15 00:10:56 +0200 Timo Sirainen <tss@iki.fi> (ce763c8)

    lib-storage: Added "oldestonly" search arg to stop searching after the first
    non-match. This parameter works only for doveadm search queries. It's not
    fully exact currently, because if mailbox.search_next_update_seq() skips
    over non-matching messages we don't stop if the next message matches. So
    this parameter is mainly useful for optimization of commands like:

    doveadm expunge -u user@domain mailbox inbox savedsince 30d oldestonly

    Where the timestamps should be ascending all the time anyway and there's no 
    point in continuing to search for more mails after the first timestamp is 
    too high.

M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-build.h
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search.h

2015-01-10 04:32:42 +0200 Timo Sirainen <tss@iki.fi> (47e90cc)

    lib-mail: message-decoder no longer skips lib-charset for UTF8 -> UTF8
    translations. With the previous lib-charset fix this makes message-decoder
    handle partial UTF-8 text in input blocks correctly.


M	src/lib-mail/Makefile.am
M	src/lib-mail/message-decoder.c
M	src/lib-mail/test-message-decoder.c

2015-01-10 04:30:40 +0200 Timo Sirainen <tss@iki.fi> (f66c893)

    lib: Added uni_utf8_partial_strlen_n()


M	src/lib/test-unichar.c
M	src/lib/unichar.c
M	src/lib/unichar.h

2015-01-10 04:25:21 +0200 Timo Sirainen <tss@iki.fi> (7ed3861)

    lib-charset: UTF-8 -> UTF-8 translation was never returning
    CHARSET_RET_INCOMPLETE_INPUT Instead the incomplete input was just being
    modified into broken output.


M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-charset/charset-utf8.h

2015-01-08 23:07:54 +0200 Timo Sirainen <tss@iki.fi> (fdf8020)

    lib-imap-client: Compiler warning fixes


M	src/lib-imap-client/imapc-connection.c

2015-01-08 22:52:11 +0200 Timo Sirainen <tss@iki.fi> (c603307)

    imapc: Added imapc_sasl_mechanisms setting The first supported SASL
    mechanism is used, otherwise the login fails entirely.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/Makefile.am
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/mail-storage.c

2015-01-08 22:32:20 +0200 Timo Sirainen <tss@iki.fi> (2f35127)

    lib-imap-client: Use lib-sasl to perform the AUTHENTICATE command handling.


M	src/lib-imap-client/Makefile.am
M	src/lib-imap-client/imapc-connection.c

2015-01-07 00:37:50 +0200 Timo Sirainen <tss@iki.fi> (fea5323)

    lib: Defined array type for guid_128_t


M	src/lib/guid.h

2015-01-06 03:15:11 +0200 Timo Sirainen <tss@iki.fi> (fb655ad)

    lib: Remove OpenBSD workaround in i_getpw*() Originally added in
    801714cba91b. It was requested to be removed now that 1) it's fixed in
    OpenBSD v5.6+ and 2) The workaround caused nonexistent users to not work
    correctly (process running out of memory I guess?)


M	src/lib/ipwd.c

2015-01-05 15:48:55 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (38a79b5)

    fts: Correct returned value to match type signature.


M	src/plugins/fts/fts-parser.c

2015-01-05 22:20:10 +0200 Phil Carmody <phil@dovecot.fi> (7cb128d)

    global: freshen copyright Robomatically:   git ls-files | xargs perl -p -i
    -e 's/(\d+)-201[0-4]/$1-2015/g;s/ (201[0-4]) Dovecot/ $1-2015 Dovecot/'

    Happy 2015 everyone!

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	doc/man/doveadm-acl.1.in
M	doc/man/doveadm-altmove.1.in
M	doc/man/doveadm-auth.1.in
M	doc/man/doveadm-batch.1.in
M	doc/man/doveadm-deduplicate.1.in
M	doc/man/doveadm-director.1.in
M	doc/man/doveadm-dump.1.in
M	doc/man/doveadm-exec.1.in
M	doc/man/doveadm-expunge.1.in
M	doc/man/doveadm-fetch.1.in
M	doc/man/doveadm-flags.1.in
M	doc/man/doveadm-force-resync.1.in
M	doc/man/doveadm-fts.1.in
M	doc/man/doveadm-help.1.in
M	doc/man/doveadm-import.1.in
M	doc/man/doveadm-index.1.in
M	doc/man/doveadm-instance.1.in
M	doc/man/doveadm-kick.1.in
M	doc/man/doveadm-log.1.in
M	doc/man/doveadm-mailbox.1.in
M	doc/man/doveadm-mount.1.in
M	doc/man/doveadm-move.1.in
M	doc/man/doveadm-penalty.1.in
M	doc/man/doveadm-proxy.1.in
M	doc/man/doveadm-purge.1.in
M	doc/man/doveadm-pw.1.in
M	doc/man/doveadm-quota.1.in
M	doc/man/doveadm-replicator.1.in
M	doc/man/doveadm-search-query.7
M	doc/man/doveadm-search.1.in
M	doc/man/doveadm-sync.1.in
M	doc/man/doveadm-user.1.in
M	doc/man/doveadm-who.1.in
M	doc/man/doveadm.1.in
M	doc/man/doveconf.1.in
M	doc/man/dovecot-lda.1.in
M	doc/man/dovecot.1.in
M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-fields.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-token.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-dict-cache-key.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-dovecot-token.c
M	src/auth/mech-external.c
M	src/auth/mech-plain.c
M	src/auth/mech-scram-sha1.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-template.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c
M	src/auth/test-auth-cache.c
M	src/auth/test-db-dict.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-template.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-cmd.c
M	src/doveadm/doveadm-dict.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dsync.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-batch.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-pw.c
M	src/doveadm/doveadm-replicator.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-deserializer.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox.c
M	src/doveadm/dsync/dsync-serializer.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-login-settings.c
M	src/imap-urlauth/imap-urlauth-login.c
M	src/imap-urlauth/imap-urlauth-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap-urlauth/imap-urlauth.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-genurlauth.c
M	src/imap/cmd-getmetadata.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-resetkey.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-setmetadata.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-urlfetch.c
M	src/imap/cmd-x-cancel.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-list.c
M	src/imap/imap-notify.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-settings.c
M	src/indexer/indexer-worker-settings.c
M	src/indexer/indexer-worker.c
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-pool.c
M	src/ipc/client.c
M	src/ipc/ipc-connection.c
M	src/ipc/ipc-group.c
M	src/ipc/ipc-settings.c
M	src/ipc/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-compression/compression.c
M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lz4.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c
M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-lz4.c
M	src/lib-compression/ostream-lzma.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-compression/test-compression.c
M	src/lib-dict/dict-cdb.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-fs.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-register.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict-transaction-memory.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/istream-fs-file.c
M	src/lib-fs/istream-metawrap.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-fs/ostream-metawrap.c
M	src/lib-http/http-auth.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-date.c
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-header.c
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-parser.c
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-url.c
M	src/lib-http/test-http-auth.c
M	src/lib-http/test-http-client.c
M	src/lib-http/test-http-date.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-request-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-server.c
M	src/lib-http/test-http-transfer.c
M	src/lib-http/test-http-url.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-imap-storage/imap-metadata.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-bodystructure.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-quote.c
M	src/lib-imap/test-imap-url.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/mail-user-hash.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-binary-part.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-part.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-size.c
M	src/lib-mail/ostream-dot.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-mail/test-istream-binary-converter.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-message-part.c
M	src/lib-mail/test-ostream-dot.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service.c
M	src/lib-master/mountpoint-list.c
M	src/lib-master/syslog-util.c
M	src/lib-master/test-master-service-settings-cache.c
M	src/lib-sasl/dsasl-client.c
M	src/lib-sasl/mech-login.c
M	src/lib-sasl/mech-plain.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/fail-mail.c
M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-deleted-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-list-index.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-notify-tree.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list-notify.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/test-mailbox-get.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base32.c
M	src/lib/base64.c
M	src/lib/bits.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/compat.c
M	src/lib/connection.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fd-set-nonblock.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/guid.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/hmac.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-temp.c
M	src/lib/iostream.c
M	src/lib/ipwd.c
M	src/lib/iso8601-date.c
M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-callback.c
M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/istream-hash.c
M	src/lib/istream-jsonstr.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/istream-sized.c
M	src/lib/istream-tee.c
M	src/lib/istream-timeout.c
M	src/lib/istream.c
M	src/lib/json-parser.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/net.c
M	src/lib/nfs-workarounds.c
M	src/lib/numpack.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream-hash.c
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/primes.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/rand.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str-table.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base32.c
M	src/lib/test-base64.c
M	src/lib/test-bits.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-data-stack.c
M	src/lib/test-guid.c
M	src/lib/test-hash-format.c
M	src/lib/test-hash-method.c
M	src/lib/test-hash.c
M	src/lib/test-hex-binary.c
M	src/lib/test-iso8601-date.c
M	src/lib/test-istream-base64-decoder.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-istream.c
M	src/lib/test-json-parser.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-network.c
M	src/lib/test-numpack.c
M	src/lib/test-ostream-file.c
M	src/lib/test-primes.c
M	src/lib/test-printf-format-fix.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-str-table.c
M	src/lib/test-str.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-strnum.c
M	src/lib/test-time-util.c
M	src/lib/test-unichar.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/test-wildcard-match.c
M	src/lib/time-util.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/uri-util.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/doveadm-connection.c
M	src/log/log-connection.c
M	src/log/log-error-buffer.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/capabilities-posix.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile-update.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-global-file.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser-tika.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search-serialize.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/xml2text.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/last-login/last-login-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-filter/istream-ext-filter.c
M	src/plugins/mail-filter/mail-filter-plugin.c
M	src/plugins/mail-filter/ostream-ext-filter.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/mailbox-alias/mailbox-alias-plugin.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-storage.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-status.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota-util.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/test-quota-util.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/replication/aggregator/aggregator-settings.c
M	src/replication/aggregator/aggregator.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/dsync-client.c
M	src/replication/replicator/notify-connection.c
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue-auth.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/stats/client-export.c
M	src/stats/client.c
M	src/stats/global-memory.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-server-connection.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.c
M	src/stats/mail-user.c
M	src/stats/main.c
M	src/stats/stats-settings.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2015-01-05 22:16:59 +0200 Phil Carmody <phil@dovecot.fi> (33750ba)

    lib: guid - centralise a 'reset to the empty value' helper function This
    helper just ensures that the caller never has to get the sizeof() right.
    (Were a guid passed as a function parameter, mistakes could happen.)

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/guid.h
M	src/lib/test-guid.c

2015-01-05 22:15:31 +0200 Phil Carmody <phil@dovecot.fi> (518781a)

    lib: guid - declare some functions as pure As the functions aren't inline,
    the compiler can't know if they can be optimised away, so give it a helping
    hand.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/guid.h

2015-01-05 22:15:07 +0200 Phil Carmody <phil@dovecot.fi> (fe08c73)

    lib: array - explain implications of ARRAY_TYPE() in comment If you use
    ARRAY_TYPE() to pass an array around, then you must also use ARRAY_TYPE() to
    define the array itself, ARRAY() will no longer do.

    Reported-by: Arnt Gulbrandsen <arnt@gulbrandsen.priv.no> Signed-off-by: Phil
    Carmody <phil@dovecot.fi>

M	src/lib/array.h

2015-01-05 22:13:59 +0200 Phil Carmody <phil@dovecot.fi> (bf38d57)

    lib: test-array - test new lsearch helper Just piggy-back on to the current
    reverse test, as that's got an array nicely set up for us already.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-array.c

2015-01-05 22:12:48 +0200 Phil Carmody <phil@dovecot.fi> (c029156)

    lib: array - new linear search helper There are large numbers of
    array_foreach loops which do nothing but search for the first element which
    matches some key. This can be abstracted out into a helper.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.c
M	src/lib/array.h

2014-12-26 17:28:30 +0200 Timo Sirainen <tss@iki.fi> (6613ff7)

    configure: Don't break when using --without-shared-libs and CC with '/'
    chars.


M	configure.ac

2014-12-17 14:43:30 +0100 Timo Sirainen <tss@iki.fi> (6af1407)

    auth: Don't crash if master user login is attempted without master=yes
    passdbs


M	src/auth/auth-request.c

2014-12-17 13:39:57 +0100 Timo Sirainen <tss@iki.fi> (acab9b2)

    lib: Small optimization / unnecessary code removal from array_*() functions.


M	src/lib/array.c

2014-12-05 05:50:19 +0200 Timo Sirainen <tss@iki.fi> (823af4a)

    lib-storage: Mail prefetching was still not working right. I wonder if it
    ever actually worked (except for SEARCH TEXT).


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c

2014-12-05 04:39:11 +0200 Timo Sirainen <tss@iki.fi> (8b7feed)

    doveadm: Avoid calling init() in doveadm binary if the command is sent to
    doveadm-server. The init() is still always called when -A or -u *wildcards*
    are used though. I'm not sure if that can be delayed. At least all commands
    should be verified that they don't rely on the current init() location.


M	src/doveadm/doveadm-mail.c

2014-12-05 03:53:02 +0200 Timo Sirainen <tss@iki.fi> (ae36914)

    doveadm: Support changing proxy destination username with "user" and
    "destuser" passdb field.


M	src/doveadm/doveadm-mail-server.c

2014-12-05 03:38:08 +0200 Timo Sirainen <tss@iki.fi> (ba342e3)

    auth: Don't allow changing username to an empty string. This is most likely
    always accidental and Dovecot in general hasn't been designed to support
    empty usernames.


M	src/auth/auth-request.c

2014-12-05 03:11:14 +0200 Timo Sirainen <tss@iki.fi> (5f4f58c)

    fts: Install some of the header files that other external plugins might want
    to use.


M	src/plugins/fts/Makefile.am

2014-12-05 03:10:32 +0200 Timo Sirainen <tss@iki.fi> (16db137)

    fts: Compiler warning fix when using fts-indexer.h directly


M	src/plugins/fts/fts-indexer.h

2014-12-02 00:29:13 -0800 Timo Sirainen <tss@iki.fi> (c935c44)

    dict-redis: Use timeout_msecs parameter also for transaction commit waits.


M	src/lib-dict/dict-redis.c

2014-12-02 00:26:24 -0800 Timo Sirainen <tss@iki.fi> (5890b14)

    dict-redis: Use EXPIRE also after INCRBY commands.


M	src/lib-dict/dict-redis.c

2014-12-01 22:43:33 +0200 Phil Carmody <phil@dovecot.fi> (4f3374c)

    lib: test-array - really really really stop gcc optimising away fatal tests
    Gcc 4.6 also was determined to optimise away the calls that should crash. We
    therefore have to do *something*, no matter how stupid, with the return
    values. This should do it. (please, oh please, oh please, ...)

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-array.c

2014-12-01 12:11:54 -0800 Timo Sirainen <tss@iki.fi> (3f75831)

    quota: Added "hidden" option to hide the quota root from IMAP GETQUOTAROOT
    command.


M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c
M	src/plugins/quota/quota.h

2014-11-28 10:57:43 +0200 Phil Carmody <phil@dovecot.fi> (842f5a5)

    lib: array - array_foreach_idx is just a generic ptr_to_idx helper
    Signed-off-by: Phil Carmody <phil@dovecot.fi>


M	src/lib/array.h

2014-11-28 10:57:43 +0200 Phil Carmody <phil@dovecot.fi> (173b125)

    lib: test-array - remove possibility to optimise out tests (void) on a call
    to a "pure" function was causing some compilers (gcc 4.8) to not reach the
    assert within the pure function. Technically it's not a pure function, as
    (in the assert fail case) it has effects other than its return value.
    However, simply removing the void cast (and then actually using the return
    value) also prevents this optimisation.

    An additional fatal test was added - there's a difference between an access 
    outside the allocated range and outside the initialised range.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.h
M	src/lib/test-array.c

2014-11-28 10:57:43 +0200 Phil Carmody <phil@dovecot.fi> (16c9a74)

    lib-test: more delicate *assert() behaviour when doing fatal tests We
    shouldn't be i_asserting ourselves when we're in the state of wanting a test
    to fail. Therefore instead test_assert to get the assert message, and ensure
    that the success flag is cleared to get the FAILED at the end.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c

2014-11-25 03:48:42 +0200 Phil Carmody <phil@dovecot.fi> (70c380a)

    lib: array - additional compile-time checks to array_append The new
    two-array helper macro works in this context too.

    Note: array_copy doesn't have any protection currently, it isn't obvious how
    to wrap that with some safety without breaking interfaces. It only seems to
    have one internal user, lib/aqueue.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.h

2014-11-25 03:45:35 +0200 Phil Carmody <phil@dovecot.fi> (5d017bb)

    lib: test-array - fix off-by-one in test_reverse i is not used as an index,
    but as a count. Therefore, it can attain the array size in the loop without
    causing any buffer overflows.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-array.c

2014-11-25 03:44:55 +0200 Phil Carmody <phil@dovecot.fi> (824809e)

    lib: test-array - fatal tests Tests both of the i_asserts which aren't
    already protected by TYPEOF compile-time checks.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-array.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-11-25 03:44:31 +0200 Phil Carmody <phil@dovecot.fi> (a7e3651)

    lib: test-array - new equality testers One using strings that get
    dereferenced, the other using the context pointer to pass in external data.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-array.c

2014-11-25 03:43:02 +0200 Phil Carmody <phil@dovecot.fi> (0f111dd)

    lib: array - element-wise comparison via callback 2 are provided - with and
    without a context pointer.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.c
M	src/lib/array.h

2014-11-25 03:43:02 +0200 Phil Carmody <phil@dovecot.fi> (afb48f8)

    lib: test-array - test array_cmp() Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/lib/test-array.c

2014-11-25 03:31:34 +0200 Phil Carmody <phil@dovecot.fi> (efaa127)

    lib: guid - turn uint8_t * parameters into guid_128_t As we expose the
    type's internals, there's no concrete difference between the two, but it
    might help static code checkers to detect misuse of the library, or sloppy
    typing.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/guid.c
M	src/lib/guid.h

2014-11-25 03:12:25 +0200 Timo Sirainen <tss@iki.fi> (2480bdc)

    dict-redis: Small error handling fix to previous change.


M	src/lib-dict/dict-redis.c

2014-11-25 03:10:41 +0200 Timo Sirainen <tss@iki.fi> (e85a0da)

    dict-redis: Added support for expire_secs=n parameter. It performs EXPIRE
    command for the added keys immediately after the SET.


M	src/lib-dict/dict-redis.c

2014-11-25 02:56:37 +0200 Timo Sirainen <tss@iki.fi> (96a410e)

    lib-storage: Don't fetch wanted_fields for messages that don't match the
    search query. For example "doveadm fetch text subject foo" was opening all
    the mails, even though only a few matched the subject (that was hopefully
    already in cache file).

    The behavior still isn't perfect though. The wanted_fields should probably 
    be split into search_wanted_fields and fetch_wanted_fields, but the current 
    behavior is likely good enough for now.

M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c

2014-11-21 18:17:00 +0900 Timo Sirainen <tss@iki.fi> (0dc719a)

    lmtp: Added TLS security information to Received: header when STARTTLS was
    used.


M	src/lmtp/commands.c

2014-11-20 22:03:25 +0900 Timo Sirainen <tss@iki.fi> (3217ecd)

    stats: Removed extra TAB from global stats exporting.


M	src/stats/client-export.c

2014-11-20 15:15:20 +0900 Timo Sirainen <tss@iki.fi> (e1ad2d1)

    lib-index: If transaction log is unexpectedly recreated while it was locked,
    log a nice error. Instead of just assert-crashing.


M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.c

2014-11-20 05:40:55 +0900 Timo Sirainen <tss@iki.fi> (416b11a)

    auth: Increase timeout for multi-line auth-worker replies to 30 minutes.
    This should help with running long-running doveadm -A commands.


M	src/auth/auth-worker-server.c

2014-11-19 17:37:57 +0900 Timo Sirainen <tss@iki.fi> (3063bd8)

    mbox: Added more (and earlier) detection for errors in mbox istreams.


M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/istream-raw-mbox.h
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-private.h
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync.c

2014-11-19 17:37:18 +0900 Timo Sirainen <tss@iki.fi> (1cf25eb)

    mbox: istream_raw_mbox_seek() needs to reset all corruption errors. We now
    reset all errors, but it doesn't really matter.


M	src/lib-storage/index/mbox/istream-raw-mbox.c

2014-11-15 03:26:16 +0200 Timo Sirainen <tss@iki.fi> (11a418b)

    lib-fs: Added FS_PROPERTY_ASYNC.


M	src/lib-fs/fs-api.h

2014-11-15 02:39:04 +0200 Stephan Bosch <stephan@rename-it.nl> (75f7e42)

    Added support for base32 encode/decode.


M	src/lib/Makefile.am
A	src/lib/base32.c
A	src/lib/base32.h
A	src/lib/test-base32.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-11-15 02:37:45 +0200 Stephan Bosch <stephan@rename-it.nl> (836e690)

    Implemented dot output stream. This outputs data in the dot-escaped format
    needed for the SMTP data command. The sequence CRLF.CRLF is sent upon
    closing the stream.


M	src/lib-mail/Makefile.am
A	src/lib-mail/ostream-dot.c
A	src/lib-mail/ostream-dot.h
A	src/lib-mail/test-ostream-dot.c

2014-11-15 02:37:03 +0200 Stephan Bosch <stephan@rename-it.nl> (c9421d6)

    lib-http: client: Removed connection code that is already in
    src/lib/connection.c.


M	src/lib-http/http-client-connection.c

2014-11-15 02:36:22 +0200 Stephan Bosch <stephan@rename-it.nl> (4388ddf)

    lib: connection: Now uses io_add_istream() instead of io_add().


M	src/lib/connection.c

2014-11-15 02:27:27 +0200 Stephan Bosch <stephan@rename-it.nl> (8ccdf19)

    lib-imap-storage: Created new METADATA API.


M	dovecot-config.in.in
M	src/imap/Makefile.am
M	src/imap/cmd-getmetadata.c
M	src/imap/cmd-setmetadata.c
D	src/imap/imap-metadata.c
D	src/imap/imap-metadata.h
M	src/lib-imap-storage/Makefile.am
A	src/lib-imap-storage/imap-metadata.c
A	src/lib-imap-storage/imap-metadata.h

2014-11-15 02:22:56 +0200 Timo Sirainen <tss@iki.fi> (9a1ab94)

    lib-fs: Added fs_lookup_metadata() wrapper to fs_get_metadata()


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2014-11-15 00:30:06 +0200 Timo Sirainen <tss@iki.fi> (c53dd9a)

    lib-master: Don't even attempt to initialize SSL context if ssl=no


M	src/lib-master/master-service-ssl.c

2014-11-15 00:27:27 +0200 Timo Sirainen <tss@iki.fi> (40ba79b)

    lib-ssl-iostream: Close the plain iostreams when ssl-iostream is destroyed.


M	src/lib-ssl-iostream/iostream-openssl.c

2014-11-15 00:14:20 +0200 Phil Carmody <phil@dovecot.fi> (887e05e)

    lib: array/hash - enable typof checks for more compilers We have a
    HAVE_TYPEOF macro from autoconf, we may as well make use of it.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.h
M	src/lib/hash.h

2014-11-15 00:06:09 +0200 Phil Carmody <phil@dovecot.fi> (fcb19f9)

    lib: array/hash - protect macro parameters If a pointer parameter p is ``ptr
    + offset'', then sizeof(*p) becomes sizeof(*ptr + offset), which isn't what
    was wanted. sizeof(*(p)) is the safe expression to use instead. Ditto for
    just ``*data'' in array.h.

    The macros in hash.h which have been changed have been reindented for better
    readability and consistency.

    The bracketting of elem in (elem)++ in both of the array_foreach* macros 
    isn't actually useful, as elem participates in token-pasting elsewhere. 
    However, the two macros have been made more similar to each other for better
    parallelism.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/array.h
M	src/lib/hash.h

2014-11-14 00:59:57 -0800 Timo Sirainen <tss@iki.fi> (5005322)

    imap: namespace { order } parameter now specifies the order returned in
    NAMESPACE reply. This is relevant only if there are multiple visible
    namespaces with the same type. The default order depends primarily on the
    length of the prefix because of internal sorting (the order of equal length
    prefixes can't really be relied on).


M	src/imap/cmd-namespace.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2014-11-14 02:29:27 +0200 Timo Sirainen <tss@iki.fi> (94b4104)

    imap: Added client_disconnect_if_inconsistent() to remove code duplication.
    Based on patch by Stephan Bosch


M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h

2014-11-13 22:55:59 -0800 Timo Sirainen <tss@iki.fi> (22d87bd)

    doveadm: If passdb lookup returns port, use it to override the doveadm_port
    setting.


M	src/doveadm/doveadm-mail-server.c

2014-11-14 02:00:12 +0200 Timo Sirainen <tss@iki.fi> (2ff3757)

    lib-fs: fs-metawrap now supports adding more metadata fields while file is
    being saved. This potentially adds yet another temporary file write though.


M	src/lib-fs/fs-metawrap.c

2014-11-14 01:19:37 +0200 Timo Sirainen <tss@iki.fi> (2f4f603)

    lib: Added iostream_temp_create_named()


M	src/lib/iostream-temp.c
M	src/lib/iostream-temp.h

2014-11-13 11:29:41 +0200 Timo Sirainen <tss@iki.fi> (26b0075)

    lib-index: Make sure dovecot.index.cache parsing doesn't go to infinite
    loop. Although we guarantee this only for files generated with Dovecot v2.2+
    because it's too much trouble to check for older versions.


M	src/lib-index/mail-cache-fields.c

2014-11-13 11:14:08 +0200 Timo Sirainen <tss@iki.fi> (8901f94)

    lib-storage: If storage creation fails, destroy all the already created
    namespaces/storages.


M	src/lib-storage/mail-namespace.c

2014-11-13 10:57:07 +0200 Timo Sirainen <tss@iki.fi> (6a275b8)

    lib-storage: Fixed crash if mail_namespaces_init_add() failed due to invalid
    settings. Normally the invalid settings were caught by config process
    already.


M	src/lib-storage/mail-namespace.c

2014-11-13 10:09:28 +0200 Timo Sirainen <tss@iki.fi> (3d77cc0)

    lib: ostream.stream_errno is now exactly the same as last_failed_errno.
    There's a lot of code that checks only for stream_errno instead of
    last_failed_errno at the flush time where the stream_errno might have
    already been cleared.

    I'm not sure why these were separated in the first place. I don't think 
    there are any stream errors which just correctly go away by retrying the 
    operation. Perhaps some code could have attempted seeking and try to handle 
    the ESPIPE error, but that kind of code paths are rare and they could clear 
    the errors themselves if needed.

M	src/lib/ostream.c

2014-11-13 10:01:37 +0200 Timo Sirainen <tss@iki.fi> (42b087d)

    lib: ostream-file checks "sendfile() not supported" a bit better. There are
    other reasons why stream_errno=EINVAL could have been set, at least in
    theory.


M	src/lib/ostream-file.c

2014-11-13 09:53:35 +0200 Timo Sirainen <tss@iki.fi> (645d76b)

    lib-storage: Added "creator" for mail_user. This allows fixing stats plugin
    to update stats also for shared mailboxes. That's a bit complicated change
    though, so I'm not sure how soon it'll happen. But at least this change
    makes it possible more easily later on. Might have other uses too.


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-user.h

2014-11-13 09:39:24 +0200 Timo Sirainen <tss@iki.fi> (7a77b94)

    lib: Never implicitly clear istream's stream_errno. I'm not really sure why
    these were added in the first place. At some point the stream_errno was
    cleared in more places, such as just before reading, but those were also
    removed already. I don't see any benefit for these, just potential problems.


M	src/lib/istream.c

2014-11-13 09:35:59 +0200 Timo Sirainen <tss@iki.fi> (e5b48cb)

    lib-mail: message_search_msg() shouldn't clear istream's stream_errno. If
    the input stream failed, retrying the operation without cached message_parts
    is unlikely to help. This also loses the original error message.


M	src/lib-mail/message-search.c

2014-11-13 09:12:38 +0200 Timo Sirainen <tss@iki.fi> (ac51b12)

    dsync: Set MAILBOX_TRANSACTION_FLAG_SYNC also for exporter. This doesn't
    really do much because exporter shouldn't be writing anything, but it allows
    plugins to find out if transactions is coming from dsync.


M	src/doveadm/dsync/dsync-mailbox-export.c

2014-11-13 03:58:51 +0200 Timo Sirainen <tss@iki.fi> (38f624b)

    lmtp: Added support for DSN ORCPT parameter. If the parameter is specified,
    it's used as the original recipient address in Sieve. The ORCPT parameter is
    also proxied to destination LMTP server if used (without checking if it
    supports it). We don't currently advertise DSN extension, so this feature
    won't be enabled automatically.


M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h
M	src/lmtp/client.h
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-proxy.h

2014-11-13 02:48:22 +0200 Timo Sirainen <tss@iki.fi> (fa8fbd8)

    imap-stats: Fixed truncation of command args.


M	src/plugins/imap-stats/imap-stats-plugin.c

2014-11-13 02:39:51 +0200 Timo Sirainen <tss@iki.fi> (cf07b67)

    stats: Use the same session ID string for stats tracking as everywhere else.
    Generate a new ID only if there is no session ID assigned.


M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h
M	src/stats/client-export.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.h

2014-11-13 02:37:39 +0200 Timo Sirainen <tss@iki.fi> (b5f58ca)

    ssl-params: Removed duplicate lib-ssl-iostream.la linking


M	src/ssl-params/Makefile.am

2014-11-13 02:28:46 +0200 Timo Sirainen <tss@iki.fi> (31b5f26)

    stats: Use the new str-table API to reduce memory usage for service strings.
    There are only a couple of services, while there can be a lot of sessions.


M	src/stats/mail-session.c
M	src/stats/mail-stats.h

2014-11-13 02:24:46 +0200 Timo Sirainen <tss@iki.fi> (6395873)

    lib: Added str-table API for keeping reference counted strings in a hash
    table.


M	src/lib/Makefile.am
A	src/lib/str-table.c
A	src/lib/str-table.h
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-str-table.c

2014-11-13 01:41:07 +0200 Timo Sirainen <tss@iki.fi> (89ca3ba)

    stats: Added support for "global" stats type.


M	src/stats/client-export.c
M	src/stats/mail-domain.c
M	src/stats/mail-stats.c
M	src/stats/mail-stats.h
M	src/stats/main.c

2014-11-12 06:58:37 +0200 Timo Sirainen <tss@iki.fi> (0906030)

    director: Added support for backend cluster "tags". This allows using a
    single director ring for multiple backend clusters. By default everything
    has an empty tag. A passdb lookup can return "director_tag" field containing
    the wanted tag name. If there aren't any backend servers with the wanted
    tag, it's treated the same as if there aren't any backend servers available
    (= wait for 30 secs for a backend and then return temporary failure).

    Tags can be added to configuration by adding @tag suffix to IPs/hosts. For 
    example:

    director_mail_servers = 10.0.0.100-10.0.0.110@name1 10.0.0.120@name2

    "doveadm director add" can also add tags either with @tag suffix or with -t 
    parameter. "doveadm director status user@domain" requires giving the user's 
    correct tag with -t parameter or the results won't be correct (empty tag's 
    results are shown). Tags can't currently be changed for an existing host 
    without removing it first.

M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director-request.h
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/mail-host.h
M	src/director/main.c
M	src/doveadm/doveadm-director.c

2014-11-12 06:46:45 +0200 Timo Sirainen <tss@iki.fi> (5b4d189)

    director: Don't restart request timeout when director state changes. If the
    state keeps changing all the time we'll never return timeouts for the
    requests.


M	src/director/main.c

2014-11-12 03:29:04 +0200 Timo Sirainen <tss@iki.fi> (eb209d1)

    director: Added director_consistent_hashing setting. This should have been
    the default since the beginning. I didn't thik it was worth the trouble
    originally because in theory it shouldn't matter much if users jump between
    multiple backends. But this makes caching behavior worse, especially for
    systems which are using local cache files.


M	src/director/director-connection.c
M	src/director/director-settings.c
M	src/director/director-settings.h
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/mail-host.c
M	src/director/mail-host.h

2014-11-12 02:04:14 +0200 Timo Sirainen <tss@iki.fi> (56c69b4)

    director: When logging a warning about ring being synced again, log how many
    seconds it took


M	src/director/director.c

2014-11-12 01:59:48 +0200 Timo Sirainen <tss@iki.fi> (8420ca2)

    director: Always log a message when director handshake finishes.


M	src/director/director-connection.c

2014-11-12 01:51:29 +0200 Timo Sirainen <tss@iki.fi> (ad404d2)

    doveadm director ring status shows now more information


M	src/director/director-connection.c
M	src/director/director-connection.h
M	src/director/doveadm-connection.c
M	src/doveadm/doveadm-director.c

2014-11-12 01:26:04 +0200 Timo Sirainen <tss@iki.fi> (d65cc33)

    lmtp: Show more information in process title. Most importantly show the
    username while messages are being delivered.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2014-11-12 01:06:02 +0200 Timo Sirainen <tss@iki.fi> (45ead23)

    doveadm: Support running non-mail commands via doveadm server. There are
    still some commands that print their output via printf though, so they need
    to be fixed separately.


M	src/doveadm/Makefile.am
M	src/doveadm/client-connection.c
M	src/doveadm/main.c

2014-11-12 01:04:27 +0200 Timo Sirainen <tss@iki.fi> (55accf4)

    doveadm: Moved commands related code to doveadm-cmd.[ch] Commands are
    already split for command line-only commands and commands that can be run
    via doveadm-server also.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-cmd.c
A	src/doveadm/doveadm-cmd.h
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h

2014-11-12 00:52:44 +0200 Timo Sirainen <tss@iki.fi> (d4c6c04)

    doveadm who: If parameters are invalid, print help text for who command
    instead of the whole doveadm usage.


M	src/doveadm/doveadm-who.c

2014-11-12 00:20:40 +0200 Timo Sirainen <tss@iki.fi> (e16cdc1)

    doveadm: Code cleanups to prepare server code for non-mail commands.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm.c

2014-11-11 05:06:09 +0200 Timo Sirainen <tss@iki.fi> (a8b37b6)

    lib: Compiler warning fix in 32bit systems to previous change


M	src/lib/file-lock.c

2014-11-11 03:13:16 +0200 Timo Sirainen <tss@iki.fi> (4eb4188)

    lib: file_wait/try_lock() treats EINTR differently now for timeouts and for
    actual signals.


M	src/lib/file-lock.c

2014-10-31 04:27:27 +0200 Timo Sirainen <tss@iki.fi> (31a8f59)

    lib-storage: Mailbox list index now detects duplicate mailbox names. With
    LAYOUT=index the duplicates are renamed.


M	src/lib-storage/list/mailbox-list-index.c

2014-11-05 13:00:14 +0200 Timo Sirainen <tss@iki.fi> (bb1a7da)

    doveadm: Removed duplicate subcommands from list of commands. For example
    don't show "mailbox ..|metadata|metadata|metadata|.."


M	src/doveadm/doveadm.c

2014-11-04 14:49:44 +0200 Timo Sirainen <tss@iki.fi> (730f825)

    imap: If GETMETADATA with wildcards can't open some mailbox, don't
    assert-crash. Just send an untagged NO for the mailbox.


M	src/imap/cmd-getmetadata.c

2014-10-31 17:05:31 -0700 Timo Sirainen <tss@iki.fi> (bc7c48e)

    ssl-params: Use lib-ssl-iostream's ssl_iostream_generate_params() instead of
    OpenSSL directly


M	src/ssl-params/Makefile.am
D	src/ssl-params/ssl-params-openssl.c
M	src/ssl-params/ssl-params.c
M	src/ssl-params/ssl-params.h

2014-10-31 17:04:58 -0700 Timo Sirainen <tss@iki.fi> (7ef7f34)

    lib-ssl-iostream: Added dh_length parameter to
    ssl_iostream_generate_params() This is an API change, but nobody was
    actually using this function.


M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl-private.h
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/iostream-ssl.h

2014-10-31 16:54:07 -0700 Timo Sirainen <tss@iki.fi> (c5b7a90)

    lib-ssl-iostream: Support non-1024bit DH parameters in ssl-parameters.dat.


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.h

2014-10-30 22:02:52 +0200 Timo Sirainen <tss@iki.fi> (0aaded8)

    lib-ssl-iostream: Destroy SSL module later in the atexit-callbacks.


M	src/lib-ssl-iostream/iostream-ssl.c

2014-10-30 22:00:14 +0200 Timo Sirainen <tss@iki.fi> (cd7cecf)

    lib: Added lib_atexit_priority()


M	src/lib/lib.c
M	src/lib/lib.h

2014-10-30 04:41:11 +0200 Timo Sirainen <tss@iki.fi> (84e4f27)

    *-login: Also increase MASTER_AUTH_MAX_DATA_SIZE and add a check to make
    sure it's large enough.


M	src/imap-login/client.c
M	src/lib-master/master-auth.h

2014-10-30 04:36:50 +0200 Timo Sirainen <tss@iki.fi> (82fb1ea)

    *-login: And actually make the previous changes work.


M	src/imap-login/client.c
M	src/login-common/client-common.h
M	src/pop3-login/client.c

2014-10-29 18:33:46 -0700 Timo Sirainen <tss@iki.fi> (85cbbbe)

    imap-login: Added "x-session-ext-id" parameter for ID command. It's exactly
    the same as "x-session-id", but this one can be safely used by external
    software without having to worry about causing error messages in older
    versions about too long session-id.


M	src/imap-login/client.c

2014-10-29 18:32:36 -0700 Timo Sirainen <tss@iki.fi> (4041506)

    lib-master: Removed fixed length limit for session-id.


M	src/lib-master/master-login.c
M	src/lib-master/master-login.h

2014-10-29 11:46:50 -0700 Timo Sirainen <tss@iki.fi> (959eca7)

    lib: connection_switch_ioloop() should switch also input stream's ioloop.


M	src/lib/connection.c

2014-10-29 09:58:01 -0700 Timo Sirainen <tss@iki.fi> (4fbf595)

    lmtp: Added support for STARTTLS command.


M	src/lmtp/Makefile.am
M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c
M	src/lmtp/commands.h
M	src/lmtp/main.c

2014-10-28 17:15:31 -0700 Timo Sirainen <tss@iki.fi> (83db24d)

    lib-http: Make sure we don't access already freed client connection in
    payload-destroyed callback.


M	src/lib-http/http-client-connection.c

2014-10-28 17:07:21 -0700 Timo Sirainen <tss@iki.fi> (fde8872)

    lib: io_remove() should finish closing the io before unreferencing its
    istream. This is because the istream unreferencing may close the fd.


M	src/lib/ioloop.c

2014-10-28 16:12:09 -0700 Stephan Bosch <stephan@rename-it.nl> (85c41e0)

    lib-http: client: Fixed assertion failure in http_client_queue_fail(). Don't
    explicitly clear the request array after looping through all requests, since
    new requests may be added during the loop, not only removed.


M	src/lib-http/http-client-queue.c

2014-10-27 21:48:29 -0700 Timo Sirainen <tss@iki.fi> (decdff0)

    lib: istream-timeout logs how long the stream was open if parent read fails
    with ECONNRESET/EPIPE.


M	src/lib/istream-timeout.c

2014-10-27 21:43:10 -0700 Timo Sirainen <tss@iki.fi> (ac3d5a1)

    lib-http: If there's an error reading chunked http stream, set the error to
    the istream. Previously the error string was set, but it was never read by
    anything.


M	src/lib-http/http-transfer-chunked.c

2014-10-28 05:45:59 +0200 Timo Sirainen <tss@iki.fi> (cb091e2)

    dsync: Fixed notifying replicator (-U parameter) if it didn't answer
    instantly.


M	src/doveadm/doveadm-dsync.c

2014-10-27 23:29:39 +0200 Timo Sirainen <tss@iki.fi> (5ef6906)

    lib: Make sure ostream.last_failed_errno is always set when stream_errno is
    set.


M	src/lib/ostream.c

2014-10-27 23:26:10 +0200 Timo Sirainen <tss@iki.fi> (d08e08a)

    lib: o_stream_uncork() could also cause write errors. Make sure
    last_failed_errno is updated. This caused some write errors not to be
    detected, such as in code like:

    o_stream_cork() o_stream_nsend(..) o_stream_uncork() if (o_stream_nfinish()
    < 0) {
     // error not detected because last_failed_errno was 0
    }

M	src/lib/ostream.c

2014-10-27 22:05:27 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (f45aa66)

    lib-index: Remove assert that can never happen.


M	src/lib-index/mail-index-sync-update.c

2014-10-27 20:24:34 +0200 Timo Sirainen <tss@iki.fi> (451391a)

    master: Don't send broken BYE notifications to log process.


M	src/master/service-log.c

2014-10-27 20:14:47 +0200 Timo Sirainen <tss@iki.fi> (d695286)

    log: Don't crash if master sends a negative service_fd number.


M	src/log/log-connection.c

2014-10-27 20:10:19 +0200 Timo Sirainen <tss@iki.fi> (46ad586)

    master: Added an assert to catch duplicate fork() PIDs. This really
    shouldn't be happening, but apparently it does sometimes. This should make
    it easier to debug.


M	src/master/service-process.c

2014-10-27 17:05:52 +0200 Timo Sirainen <tss@iki.fi> (34b858a)

    lib-storage: Recent change broke deleting mailboxes with LAYOUT=index


M	src/lib-storage/list/mailbox-list-index-backend.c

2014-10-26 18:43:57 +0200 Stephan Bosch <stephan@rename-it.nl> (659ab82)

    lib-http: server: Fixed a hang occurring sometimes when response is sent for
    a request that had payload. Forgot to always trigger sending response when
    processing request payload finishes.


M	src/lib-http/http-server-connection.c

2014-10-26 18:43:57 +0200 Stephan Bosch <stephan@rename-it.nl> (bf1134c)

    lib-http: client: Removed asssert in http_client_connection_is_ready().
    There is no reason why the input stream couldn't be full.


M	src/lib-http/http-client-connection.c

2014-10-26 18:43:57 +0200 Stephan Bosch <stephan@rename-it.nl> (4e1039a)

    lib-http: client: The asserts recently added to http_connection_check_idle()
    are bogus.


M	src/lib-http/http-client-connection.c

2014-10-26 02:03:22 +0300 Timo Sirainen <tss@iki.fi> (fc52573)

    fs-posix: fs_copy() no longer fails if destination exists and
    FS_OPEN_MODE_REPLACE is used


M	src/lib-fs/fs-posix.c

2014-10-26 01:59:05 +0300 Timo Sirainen <tss@iki.fi> (3f6a395)

    lib-http server: If i/ostream fails, don't return wrong "stream input size
    changed" error. Also handle the real case in a bit nicer way.


M	src/lib-http/http-server-response.c

2014-10-25 22:18:07 +0000 Pascal Volk <user@localhost.localdomain.org> (2e10491)

    man: Global options includes: Added back the newline at end of files.

    They were accidentally removed in the previous commit.

M	doc/man/global-options-formatter.inc
M	doc/man/global-options.inc

2014-10-25 21:24:06 +0000 Pascal Volk <user@localhost.localdomain.org> (57552b0)

    man: Global options includes: Added description of `-o setting=value'.


M	doc/man/global-options-formatter.inc
M	doc/man/global-options.inc

2014-10-26 01:00:36 +0300 Timo Sirainen <tss@iki.fi> (b80c329)

    lib: If i_stream_seek() works by reading forward and read() fails, don't
    override the error message.


M	src/lib/istream.c

2014-10-26 00:08:05 +0300 Timo Sirainen <tss@iki.fi> (a03a9aa)

    master: Don't start new processes while shutting down.


M	src/master/service-monitor.c

2014-10-25 22:53:35 +0300 Timo Sirainen <tss@iki.fi> (a3e96a9)

    dsync: Added debug logging for attribute importing


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-25 06:57:25 +0300 Timo Sirainen <tss@iki.fi> (9803c76)

    Added signature for changeset e8b793f2c409


M	.hgsigs

2014-10-25 06:57:11 +0300 Timo Sirainen <tss@iki.fi> (1234a3f)

    Added tag 2.2.15 for changeset e8b793f2c409


M	.hgtags

2014-10-25 06:57:11 +0300 Timo Sirainen <tss@iki.fi> (6ba458d)

    Released v2.2.15.


M	NEWS
M	configure.ac

2014-10-25 06:40:03 +0300 Timo Sirainen <tss@iki.fi> (1845823)

    lmtp: Use mail_log_prefix while mails are being delivered.


M	src/lmtp/commands.c

2014-10-25 06:37:35 +0300 Timo Sirainen <tss@iki.fi> (baca4c4)

    lmtp: Added missing session_id to mail_user


M	src/lmtp/commands.c

2014-10-25 06:19:41 +0300 Timo Sirainen <tss@iki.fi> (bb2471f)

    lib-storage: LAYOUT=index now first creates the backend mailbox and only
    then adds it to list index. This avoids any race conditions with mailbox
    creation and opening it.


M	src/lib-storage/list/mailbox-list-index-backend.c

2014-10-25 06:18:45 +0300 Timo Sirainen <tss@iki.fi> (7f0ad4a)

    lib-storage: Don't update mailbox list index status fields when deleting a
    mailbox.


M	src/lib-storage/list/mailbox-list-index-status.c

2014-10-25 06:18:06 +0300 Timo Sirainen <tss@iki.fi> (b63c064)

    lib-storage: When mailbox is deleted, reset its cached paths. If mailbox is
    still later on recreated, the paths may have changed.


M	src/lib-storage/mail-storage.c

2014-10-25 06:16:47 +0300 Timo Sirainen <tss@iki.fi> (8739d6b)

    lib-storage: Fully unreference indexes when deleting mailboxes.


M	src/lib-storage/index/index-storage.c

2014-10-25 02:56:42 +0300 Timo Sirainen <tss@iki.fi> (458b283)

    lib-index: Don't assert-crash if expunge event handling finds that
    everything is already expunged.


M	src/lib-index/mail-index-sync-update.c

2014-10-25 02:53:55 +0300 Timo Sirainen <tss@iki.fi> (73ac4a4)

    quota: Fixed including the right system quota.h with NetBSD Patch by Manuel
    Bouyer.

    I guess the quota.h could be renamed to something at some point..

M	src/plugins/quota/quota-fs.h

2014-10-25 02:52:50 +0300 Timo Sirainen <tss@iki.fi> (5f83be0)

    quota: Fixed NetBSD quota I guess it's because quota is refreshed only at
    quota_open() time. Based on patch by Manuel Bouyer


M	src/plugins/quota/quota-fs.c

2014-10-25 02:42:47 +0300 Timo Sirainen <tss@iki.fi> (bbdd683)

    auth: Some unsuccessful passdb lookups weren't returned as failures to
    passdb lookups. These lookups were only being done internally, so it usually
    didn't matter. Also this only affected things like allow_nets checking and
    some non-common passdb {Â result_* } settings.


M	src/auth/auth-master-connection.c

2014-10-25 02:39:00 +0300 Timo Sirainen <tss@iki.fi> (42e23ab)

    auth: allow_nets=local matches now connections without any IP address


M	src/auth/auth-request.c

2014-10-25 02:13:36 +0300 Timo Sirainen <tss@iki.fi> (ce930f9)

    virtual plugin: Fixed assert-crash when backend mailbox was auto-closed
    while it had pending expunges.


M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c

2014-10-25 01:38:43 +0300 Stephan Bosch <stephan@rename-it.nl> (1a2ce9e)

    lib-http: client: Handle situation in which server sends response before
    request payload is fully sent.


M	src/lib-http/http-client-connection.c

2014-10-25 01:38:42 +0300 Stephan Bosch <stephan@rename-it.nl> (30ccfe4)

    lib-http: client: Fixed handling of requests aborted while still sending
    payload to server.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h

2014-10-25 01:38:42 +0300 Stephan Bosch <stephan@rename-it.nl> (9145c8b)

    lib-http: client: Fixed conflict between request abort and request delayed
    error.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2014-10-25 01:38:42 +0300 Stephan Bosch <stephan@rename-it.nl> (7e5ead0)

    lib-http: client: Fixed cleanup of remaining waiting requests at connection
    destroy. Forgot to dereference the requests for the reference that the
    connection itself holds for each waiting request.


M	src/lib-http/http-client-connection.c

2014-10-25 01:38:42 +0300 Stephan Bosch <stephan@rename-it.nl> (23f432e)

    lib-http: client: Aborted requests were not counted as finished in the
    connection's response receive loop. This caused a hang.


M	src/lib-http/http-client-connection.c

2014-10-24 23:00:56 +0300 Timo Sirainen <tss@iki.fi> (46453c7)

    lib-fs: Improved error logging


M	src/lib-fs/fs-api.c

2014-10-24 22:18:29 +0300 Timo Sirainen <tss@iki.fi> (b5351cf)

    Use i_stream_get_error() wherever possible instead of %m


M	src/director/notify-connection.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-settings/settings-parser.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-storage.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-script.c

2014-10-24 22:11:50 +0300 Timo Sirainen <tss@iki.fi> (8dccbdb)

    lib-storage: Added data stack frames for most calls. So neither the callers
    nor the implementations need to worry about those so much.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail.c

2014-10-24 22:10:25 +0300 Timo Sirainen <tss@iki.fi> (9e406b0)

    lib: Added "istream-seekable: " error message prefixes.


M	src/lib/istream-seekable.c

2014-10-24 04:24:40 +0300 Timo Sirainen <tss@iki.fi> (299451d)

    dsync: Added some debugging output for mailbox trees.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2014-10-24 03:58:35 +0300 Timo Sirainen <tss@iki.fi> (49c7e0a)

    dsync: Removed in/out state from debugging. This was initially added for
    debugging hangs, but those haven't existed for a long time now. Maybe we
    should eventually make debug categories configurable, but for now nobody
    wants to see these messages.


M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c

2014-10-24 03:54:21 +0300 Timo Sirainen <tss@iki.fi> (f0101f9)

    login proxy: If proxy_timeout is set, try to reconnect until the timeout is
    reached. This allows quickly restarting/upgrading backend servers without
    returning login failures.


M	src/login-common/login-proxy.c

2014-10-23 06:38:20 +0300 Timo Sirainen <tss@iki.fi> (2c57ebc)

    doveadm: Added metadata set/unset/get/list commands.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-mail-mailbox-metadata.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2014-10-23 06:37:48 +0300 Timo Sirainen <tss@iki.fi> (7fbd5e7)

    doveadm fetch: Use doveadm_print_istream()


M	src/doveadm/doveadm-mail-fetch.c

2014-10-23 06:37:30 +0300 Timo Sirainen <tss@iki.fi> (80bc6f4)

    doveadm: Added doveadm_print_istream() for easily printing istreams.


M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-print.h

2014-10-23 05:55:51 +0300 Stephan Bosch <stephan@rename-it.nl> (0d24f15)

    lib-http: client: Fixed proxied client connect timeout. Timeout didn't cause
    requests to be aborted with error.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h

2014-10-23 05:55:51 +0300 Stephan Bosch <stephan@rename-it.nl> (94d1b08)

    lib-http: client: Implemented maximum for connection backoff time. Without a
    maximum, the backoff time grows exponentially to enormous values, because it
    isn't reset until the connection succeeds. This causes recovery from
    connection failures to become very slow. Current maximum is one minute.


M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2014-10-23 05:55:51 +0300 Stephan Bosch <stephan@rename-it.nl> (a830458)

    lib-http: client: Assertion in http_client_queue_fail() was wrong. It is not
    guaranteed that all queue lists are empty, because new requests can be
    submitted from the callbacks. Changed this into a proper invariant check,
    which asserts tbat the number of requests in sub-queues add up to the total
    number in the main queue.


M	src/lib-http/http-client-queue.c

2014-10-23 05:55:51 +0300 Stephan Bosch <stephan@rename-it.nl> (5e3c6e9)

    lib-http: client: Clear req->conn when request is finished. This prevents a
    spurious assert failure.


M	src/lib-http/http-client-connection.c

2014-10-23 05:04:37 +0300 Timo Sirainen <tss@iki.fi> (537598e)

    lib-index: Detect broken log_file_tail_offset updates without
    assert-crashing.


M	src/lib-index/mail-transaction-log-file.c

2014-10-23 04:16:48 +0300 Timo Sirainen <tss@iki.fi> (ab841a2)

    dsync: Fixed assert-crash / memory leak on error handling path.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-23 03:10:12 +0300 Timo Sirainen <tss@iki.fi> (483268a)

    lib-storage: Make sure mailbox names are valid UTF-8 with LAYOUT=index


M	src/lib-storage/list/mailbox-list-index.c

2014-10-22 14:15:23 -0700 Timo Sirainen <tss@iki.fi> (10732e0)

    replication plugin: Use low priority for mail copying operations.


M	src/plugins/replication/replication-plugin.c

2014-10-22 05:40:44 +0300 Timo Sirainen <tss@iki.fi> (3bb59b4)

    lib: Added unit tests for guid_128_*()


M	src/lib/Makefile.am
A	src/lib/test-guid.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-10-22 02:59:22 +0300 Timo Sirainen <tss@iki.fi> (8562f8d)

    lib: Added guid_128_copy()


M	src/lib/guid.h

2014-10-21 23:34:50 +0300 Stephan Bosch <stephan@rename-it.nl> (4aaec94)

    lib-http: client: If peer is unlinked from queue and no other links remain,
    close any pending connections. Those pending connections would no longer
    serve any purpose.


M	src/lib-http/http-client-peer.c

2014-10-21 05:46:22 +0300 Timo Sirainen <tss@iki.fi> (3a177db)

    lib-storage: LAYOUT=index no longer keeps list index locked while creating
    mailbox. Mailbox opening can be slow and complicated and could even try to
    lock the list index again. So it's a bit more racy now, but all mailbox
    formats can already handle races with mailbox creation.


M	src/lib-storage/list/mailbox-list-index-backend.c

2014-10-21 05:44:09 +0300 Timo Sirainen <tss@iki.fi> (330865e)

    lib-storage: Partially reverted previous change. Added
    mailbox_list_index_sync_delete() instead.


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index-sync.h

2014-10-21 03:58:56 +0300 Timo Sirainen <tss@iki.fi> (c44f776)

    lib-storage: Added mailbox_list_index_delete_entry()


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index-sync.h

2014-10-21 02:48:20 +0300 Timo Sirainen <tss@iki.fi> (74fe10b)

    lib: test-buffer was randomly crashing with SIGFPE


M	src/lib/test-buffer.c

2014-10-20 08:54:27 -0700 Stephan Bosch <stephan@rename-it.nl> (a991cfe)

    lib-http: client: Created list of all submitted requests. Currently only
    needed to improve debugging of hanging requests.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c

2014-10-20 08:54:27 -0700 Stephan Bosch <stephan@rename-it.nl> (8d5b571)

    lib-http: client: Fixed behavior of connection backoff timer when multiple
    IPs are returned for hostname. Peer backoff data was lost because peer was
    destroyed quickly. Now the peer object is retained during the backoff
    period, so that new connection attempts adhere to the backoff period.


M	src/lib-http/http-client-peer.c

2014-10-20 08:54:27 -0700 Stephan Bosch <stephan@rename-it.nl> (7238341)

    lib-http: client: Connection erroneously indicated that it was ready while
    SSL handshake was not yet completed.


M	src/lib-http/http-client-connection.c

2014-10-20 08:54:27 -0700 Stephan Bosch <stephan@rename-it.nl> (e4e4b85)

    lib-http: client: Fixed behavior for max_connect_attempts with fewer IPs
    than attempts. This was broken by earlier 'fix'.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c

2014-10-20 08:54:26 -0700 Stephan Bosch <stephan@rename-it.nl> (60381d3)

    lib-http: client: Fixed handling of connection timeouts. A timeout caused an
    assert failure, because the connection status was altered before the
    peer_connection_failure handler was called.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h

2014-10-19 19:29:34 +0000 Pascal Volk <user@localhost.localdomain.org> (da2555e)

    man: Reworked some formatting requests.

    On some systems, for example SunOS 5.10, the example commands were cut off.

M	doc/man/doveadm-altmove.1.in
M	doc/man/doveadm-auth.1.in
M	doc/man/doveadm-batch.1.in
M	doc/man/doveadm-deduplicate.1.in
M	doc/man/doveadm-expunge.1.in
M	doc/man/doveadm-flags.1.in
M	doc/man/doveadm-mailbox.1.in
M	doc/man/doveadm-move.1.in
M	doc/man/doveadm-search.1.in
M	doc/man/doveadm-sync.1.in
M	doc/man/doveconf.1.in

2014-10-19 11:24:12 -0700 Timo Sirainen <tss@iki.fi> (e9c0bb1)

    imap, pop3, lmtp: If client gets disconnected due to iostream error, log the
    full error.


M	src/imap/imap-client.c
M	src/lmtp/client.c
M	src/pop3/pop3-client.c

2014-10-18 02:13:30 +0300 Timo Sirainen <tss@iki.fi> (9f7a3d6)

    doveadm fetch: If istream reading fails, log a better error message.


M	src/doveadm/doveadm-mail-fetch.c

2014-10-18 02:12:47 +0300 Timo Sirainen <tss@iki.fi> (6a268ef)

    lib-storage: When logging about corrupted cached message size, log the
    filename also.


M	src/lib-storage/index/istream-mail.c

2014-10-18 01:55:02 +0300 Timo Sirainen <tss@iki.fi> (b5188ce)

    lib-storage: If we detect a broken cached message size, log more information
    about it. Also try to include one of the cached headers in the message,
    which could allow detecting if the cached data pointed to a completely
    different message.


M	src/lib-storage/index/istream-mail.c

2014-10-17 10:02:54 -0700 Timo Sirainen <tss@iki.fi> (aa21a54)

    lib-lda: And fixed the earlier commit.


M	src/lib-lda/duplicate.c

2014-10-17 09:59:21 -0700 Timo Sirainen <tss@iki.fi> (ad31667)

    lib-lda: duplicate_flush() now unlocks the duplicate database even if
    nothing had changed.


M	src/lib-lda/duplicate.c

2014-10-16 08:19:03 -0700 Timo Sirainen <tss@iki.fi> (f3391d6)

    lib-storage: LAYOUT=index doesn't reserve '~' as internal separator anymore.
    The index doesn't reserve any character as hierarchy separator, so the
    internal separator can change at any time. Use the namespace's configured
    hierarchy separator as the internal separator to avoid reserving any
    characters. If namespace separator isn't configured, fallback to the
    original '~' so this change shouldn't break anything.


M	src/lib-storage/list/mailbox-list-index-backend.c

2014-10-16 07:25:17 -0700 Timo Sirainen <tss@iki.fi> (136ba0e)

    doveconf: Changed _doveconf_comment symbol suffix to _doveconf_banner That
    describes its behavior better.


M	src/config/doveconf.c

2014-10-15 07:37:05 -0700 Timo Sirainen <tss@iki.fi> (4fcf9b5)

    doveconf: Allow settings plugins to print comments to the output header. If
    plugin contains <plugin name>_doveconf_comment string, it's written as part
    of the doveconf output. The idea mainly being that the major plugins (such
    as Pigeonhole) could print their version number there to avoid having to ask
    for it separately.


M	src/config/doveconf.c

2014-10-14 16:57:13 -0700 Timo Sirainen <tss@iki.fi> (910a516)

    imap-zlib: Removed check for disallowing COMPRESS to be used with TLS
    compression. Clients shouldn't be doing this in any case, and this check
    doesn't work properly with proxies.

    We could solve the check properly for Dovecot proxies by having them send 
    the TLS compression state to backends, but it would still leave non-Dovecot 
    proxies broken. Although we could just not advertise COMPRESS=DEFLATE 
    extension if TLS compression is enabled and non-Dovecot proxies at least 
    wouldn't cause failures. Still, overall seems like a lot of work for such a 
    small and probably unnecessary extra check.

M	src/plugins/imap-zlib/imap-zlib-plugin.c

2014-10-14 12:17:36 -0700 Timo Sirainen <tss@iki.fi> (1b22566)

    lib-ssl-iostream: Allow commas also in ssl_protocols setting.


M	src/lib-ssl-iostream/iostream-openssl-common.c

2014-10-14 12:14:14 -0700 Timo Sirainen <tss@iki.fi> (3cd3140)

    Compiling fix for some systems.


M	src/lib-storage/list/mailbox-list-index.h

2014-10-14 10:17:26 -0700 Timo Sirainen <tss@iki.fi> (d4f80a4)

    auth: Minor fix to previous commit.


M	src/auth/auth-request.c

2014-10-14 10:16:03 -0700 Timo Sirainen <tss@iki.fi> (1323ac1)

    auth: Check for empty username after doing all the username changes.


M	src/auth/auth-request.c

2014-10-14 19:49:58 +0300 Timo Sirainen <tss@iki.fi> (d6ecafb)

    Added signature for changeset 6dad1f6e8930


M	.hgsigs

2014-10-14 19:49:55 +0300 Timo Sirainen <tss@iki.fi> (9d12825)

    Added tag 2.2.14 for changeset 6dad1f6e8930


M	.hgtags

2014-10-14 19:49:55 +0300 Timo Sirainen <tss@iki.fi> (0ec69c4)

    Released v2.2.14.


M	NEWS
M	configure.ac

2014-10-14 09:39:50 -0700 Timo Sirainen <tss@iki.fi> (bacd4f6)

    lib-storage: Added X-REAL-UID search parameter.


M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h

2014-10-14 09:36:15 -0700 Timo Sirainen <tss@iki.fi> (74c09ac)

    Compiler warning fix


M	src/lib-http/http-client.h

2014-10-14 09:22:40 -0700 Timo Sirainen <tss@iki.fi> (89c8d5f)

    lib: i_stream_read_next_line() now sets a better error message if line is
    too long.


M	src/lib/istream.c

2014-10-13 09:13:53 -0700 Timo Sirainen <tss@iki.fi> (228eff7)

    auth: Fix to earlier commit: Don't try to resume already finished user
    iteration.


M	src/auth/auth-worker-server.c

2014-10-13 08:50:44 -0700 Timo Sirainen <tss@iki.fi> (aa938ae)

    lib-index: Automatically grow header size on header updates. This fixes
    assert-crashes when it didn't happen.

    For example an old Maildir index could have had a header size 24. Dovecot 
    crashed then when trying to update it, because the new header size is 36 and 
    there wasn't an explicit mail_index_ext_resize_hdr() call.

M	src/lib-index/mail-index-transaction-export.c

2014-10-13 06:55:15 -0700 Timo Sirainen <tss@iki.fi> (2e29c58)

    Compile fix for systems without dlopen()


M	src/lib/module-dir.c

2014-10-12 08:58:40 -0700 Stephan Bosch <stephan@rename-it.nl> (fca6888)

    lib-http: client: Moved delayed failed requests from host to client object.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c

2014-10-12 08:58:40 -0700 Stephan Bosch <stephan@rename-it.nl> (501d0f9)

    lib-http: client: With the recent addition of a connection attempt limit,
    connection failures weren't always handled correctly.


M	src/lib-http/http-client-queue.c

2014-10-12 08:58:40 -0700 Stephan Bosch <stephan@rename-it.nl> (68fb5a7)

    lib-http: client: Fixed segfault caused by earlier change.


M	src/lib-http/http-client-connection.c

2014-10-11 00:02:00 +0300 Timo Sirainen <tss@iki.fi> (47b5ef7)

    auth: Make sure userdb iteration is destroyed if worker connection
    disconnects.


M	src/auth/auth-master-connection.c
M	src/auth/auth-master-connection.h

2014-10-11 00:01:09 +0300 Timo Sirainen <tss@iki.fi> (f26b9bb)

    auth: Userdb iteration optimization. Don't keep re-creating the timeout
    after iterating each user.


M	src/auth/auth-worker-server.c

2014-10-11 00:43:38 +0300 Stephan Bosch <stephan@rename-it.nl> (f1b04cf)

    lib-dns: The dns_lookup() call caused a crash upon a connect error, because
    dns_client_disconnect() can indirectly call itself recursively. Solved by
    dropping the list of lookups from the client object before the lookups are
    destroyed.


M	src/lib-dns/dns-lookup.c

2014-10-10 23:59:52 +0300 Timo Sirainen <tss@iki.fi> (f3c4f76)

    auth: If userdb iteration client disconnects early, make sure we don't get
    stuck.


M	src/auth/userdb-blocking.c

2014-10-10 18:11:58 +0300 Timo Sirainen <tss@iki.fi> (834dcbc)

    maildir: Don't limit uidlist line lengths to 4096 bytes. Although this
    always indicates corruption, the current code doesn't handle that very
    nicely. One fix would be to just ignore such long lines, but this is easier
    to implement..


M	src/lib-storage/index/maildir/maildir-uidlist.c

2014-10-10 00:46:15 +0300 Stephan Bosch <stephan@rename-it.nl> (840abb8)

    lib-http: client: Fixed assert crash occurring when DNS lookup fails
    immediately during request submission. In that situation, the request was
    not dropped from the queue immediately, triggering the assert crash.


M	src/lib-http/http-client-request.c

2014-10-09 21:23:08 +0300 Timo Sirainen <tss@iki.fi> (1837e13)

    lib-lda: Compiler warning fix


M	src/lib-lda/smtp-client.c

2014-10-09 21:22:45 +0300 Timo Sirainen <tss@iki.fi> (474da74)

    mbox: Removed obsolete code that also wasn't compiling because of previous
    commit.


M	src/lib-storage/index/mbox/mbox-lock.c

2014-10-09 18:19:03 +0000 Pascal Volk <user@localhost.localdomain.org> (411ae69)

    man: doveadm-acl.1: Corrected description of default output formatter.


M	doc/man/doveadm-acl.1.in

2014-10-09 20:46:31 +0300 Timo Sirainen <tss@iki.fi> (cfadd9a)

    lib-index: Removed dovecot.index locking related code, which is no longer
    used.


M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.c

2014-10-09 18:41:06 +0300 Timo Sirainen <tss@iki.fi> (d77fb3b)

    lib: Updated comment to o_stream_send_istream()


M	src/lib/ostream.h

2014-10-09 18:40:54 +0300 Timo Sirainen <tss@iki.fi> (63866b7)

    lib: Fixed assert-crash in o_stream_send_istream() if input stream was the
    one that failed.


M	src/lib/ostream.c

2014-10-09 18:27:14 +0300 Timo Sirainen <tss@iki.fi> (f6ae400)

    lib-index: Added mail_index_sync_no_warning() to prevent "long transaction
    lock" warnings. Use it with Maildir to prevent double-warning.


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index.h
M	src/lib-storage/index/maildir/maildir-sync-index.c

2014-10-09 18:26:05 +0300 Timo Sirainen <tss@iki.fi> (2f8da04)

    lib-index: Include reason string in warnings about keeping transaction log
    locked for too long.


M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mail-transaction-log.h
M	src/lib-index/test-mail-transaction-log-append.c

2014-10-09 18:23:41 +0300 Timo Sirainen <tss@iki.fi> (da43760)

    lib-index: Replaced some automatic transaction log unlocks with asserts.
    Some earlier Dovecot versions were read-locking transaction logs and this
    was useful there. But now we only do exclusive locking for the log head, so
    it's an error not to explicitly unlock the files.


M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.c

2014-10-09 18:20:56 +0300 Timo Sirainen <tss@iki.fi> (94cb054)

    lib-index: If locking transaction log times out, show the PID which has it
    locked.


M	src/lib-index/mail-transaction-log-file.c

2014-10-09 18:19:11 +0300 Timo Sirainen <tss@iki.fi> (565790b)

    maildir: Use MAIL_TRANSACTION_LOG_LOCK_WARN_SECS as threshold for logging a
    "long sync" warning. This is because the index syncing keeps the log locked,
    and other processes trying to lock the log will start logging warnings as
    well.


M	src/lib-storage/index/maildir/maildir-sync.h

2014-10-09 18:17:26 +0300 Timo Sirainen <tss@iki.fi> (e307c82)

    lib-index: Moved MAIL_TRANSACTION_LOG_LOCK_WARN_SECS as part of public API.


M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-private.h

2014-10-09 18:14:43 +0300 Timo Sirainen <tss@iki.fi> (a34d06a)

    lib: o_stream_send_istream() shouldn't ignore EINTRs for file ostreams. Also
    added extra asserts to make sure that either we return an error or we write
    everything from input stream to output stream. This should make it safe to
    write to files using just:

    if (o_stream_send_istream(ostream, istream) < 0) {
     // failed
    } else {
     // everything in istream was written to ostream
    }

M	src/lib/ostream-file.c

2014-10-09 18:12:46 +0300 Timo Sirainen <tss@iki.fi> (db3ebf6)

    lib: o_stream_send_istream() should return -1 if there was an error reading
    input stream.


M	src/lib/ostream.c

2014-10-09 18:12:14 +0300 Timo Sirainen <tss@iki.fi> (1107c86)

    lib: Added file_lock_find() to find which process has a file locked.


M	src/lib/file-lock.c
M	src/lib/file-lock.h

2014-10-09 16:51:22 +0300 Timo Sirainen <tss@iki.fi> (e19e36f)

    lib-storage: Small comment update


M	src/lib-storage/mail-storage.h

2014-10-09 16:42:01 +0300 Timo Sirainen <tss@iki.fi> (073f965)

    lib-storage: If uncached header unfolding fails, panic instead of returning
    error. This really shouldn't be happening. This also makes it clear that
    return value -1 means some kind of I/O error instead of corruption.


M	src/lib-storage/index/index-mail-headers.c

2014-10-09 16:41:23 +0300 Timo Sirainen <tss@iki.fi> (8b12e7b)

    lib-storage: Fixed header parsing when there were multiple same header
    names. For example if a mail had:

    Name1: a Name1: b Name2: c

    If the Name1: was initially added to cache and Name2: not, but later on both 
    were attempted to be added to cache, the Name2: lookup would have been added 
    with "b" instead of "c" value.

M	src/lib-storage/index/index-mail-headers.c

2014-10-09 12:02:21 +0300 Timo Sirainen <tss@iki.fi> (0f48313)

    lib-lda: Added smtp_client_abort()


M	src/lib-lda/smtp-client.c
M	src/lib-lda/smtp-client.h

2014-10-08 22:10:34 +0300 Timo Sirainen <tss@iki.fi> (1ee1a73)

    lda, lmtp: Use mail_deliver_context.tempfail_error first if it exists
    (instead of storage error).


M	src/lda/main.c
M	src/lmtp/commands.c

2014-10-08 16:28:40 +0300 Timo Sirainen <tss@iki.fi> (f2841ed)

    lib: Compiling fix for FreeBSD Patch by Eero HÃ¤nninen


M	src/lib/net.c

2014-10-08 11:34:05 +0300 Timo Sirainen <tss@iki.fi> (b056d19)

    lib-storage: LAYOUT=index small code cleanup


M	src/lib-storage/list/mailbox-list-index-backend.c

2014-10-08 11:33:50 +0300 Timo Sirainen <tss@iki.fi> (28f7485)

    lib-storage: Fixed earlier LAYOUT=index change to refresh index before
    opening a view to it. Fixes an assert-crash.


M	src/lib-storage/list/mailbox-list-index-backend.c

2014-10-07 22:24:21 +0000 Pascal Volk <user@localhost.localdomain.org> (6ae7a38)

    man: Added doveadm-proxy.1.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-proxy.1.in
M	doc/man/doveadm.1.in

2014-10-07 21:35:44 +0300 Timo Sirainen <tss@iki.fi> (f663bdd)

    lib-storage: Fixed some race condition crashes with LAYOUT=index


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2014-10-07 20:29:16 +0300 Timo Sirainen <tss@iki.fi> (ca31523)

    lib-storage: Fixed assert-crash when BODYSTRUCTURE parsing fails due to
    broken mail size.


M	src/lib-storage/index/index-mail.c

2014-10-07 20:28:06 +0300 Timo Sirainen <tss@iki.fi> (02d8f34)

    lib-mail: Added asserts


M	src/lib-mail/message-parser.c

2014-10-07 20:13:36 +0300 Timo Sirainen <tss@iki.fi> (425cbce)

    lib-index: Fixed assert-crash in some cache locking race conditions. If
    mail_index_map() is being called, we can't refresh the index or it'll crash.
    It wouldn't help anyway, since the index was just refreshed.


M	src/lib-index/mail-cache.c

2014-10-07 19:48:34 +0300 Phil Carmody <phil@dovecot.fi> (6a53a51)

    lib-fs: struct fs_file's write_pending is a flag Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/lib-fs/fs-api-private.h

2014-10-07 19:07:16 +0300 Timo Sirainen <tss@iki.fi> (0f833d1)

    lib-index: Delay unlocking cache compression until changes to transaction
    log are committed. This should fix race condition with two processes
    compressing the file at the same time with same file_seq and becoming
    confused.


M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.h
M	src/lib-index/mail-index-sync.c
M	src/lib-storage/index/index-rebuild.c

2014-10-07 19:04:36 +0300 Timo Sirainen <tss@iki.fi> (06fc580)

    lib-index: Added path parameter to mail_index_create_tmp_file() This allows
    using it for creating any kind of a new index file with proper file
    permissions.

    Some of the old code should probably be changed to use this. Maybe even move 
    this function to public mail-index.h

M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c

2014-10-07 18:58:01 +0300 Timo Sirainen <tss@iki.fi> (cfd0e35)

    lib-index: Try to minimize race conditions while compressing cache. There
    are some unavoidable race conditions, but try to keep their time window as
    small as possible.


M	src/lib-index/mail-cache-compress.c

2014-10-07 18:47:09 +0300 Timo Sirainen <tss@iki.fi> (ab70f55)

    lib-index: mail_cache_lock() partial rewrite. require_same_reset_id is no
    longer needed, if it ever was. If we're locking the cache file, we always
    want the latest one. The logic of locking in general was somewhat confusing
    and it probably didn't always successfully lock when it should have, because
    the reset_id happened to match an old file.


M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c

2014-10-07 02:54:35 +0300 Timo Sirainen <tss@iki.fi> (620b5ed)

    lib-index: Code cleanup - avoid code duplication.


M	src/lib-index/mail-cache.c

2014-10-07 02:35:41 +0300 Timo Sirainen <tss@iki.fi> (e4b2426)

    lib-index: Fixed cache file creation race condition. If two processes are
    creating the index files at the same time, don't have one of them delete the
    dovecot.index.cache that the other one just created. This means we never
    should be calling mail_cache_create(), so it was removed entirely.


M	src/lib-index/mail-cache.c
M	src/lib-index/mail-cache.h
M	src/lib-index/mail-index.c

2014-10-07 02:33:03 +0300 Timo Sirainen <tss@iki.fi> (2219015)

    lib-index: Don't keep cache file locked for as long while syncing index. The
    earlier code was required for updating the cache offsets, but this code no
    longer exists. Now we just need to update the record counts in the header,
    which can be done quickly at the end of the sync.


M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c

2014-10-06 20:50:34 +0000 Pascal Volk <user@localhost.localdomain.org> (80bd97a)

    man: Fixed broken syntax in doveadm-sync.1.


M	doc/man/doveadm-sync.1.in

2014-10-06 22:12:01 +0300 Timo Sirainen <tss@iki.fi> (c85f661)

    lib-dict: Fixed race condition in mkdir()ing dict file's parent directory.


M	src/lib-dict/dict-file.c

2014-10-06 21:15:31 +0300 Timo Sirainen <tss@iki.fi> (a4828c4)

    sdbox: Fixed race condition when two processes mkdir() the same directory


M	src/lib-storage/index/dbox-single/sdbox-file.c

2014-10-06 20:17:19 +0300 Timo Sirainen <tss@iki.fi> (482c0b9)

    Minor code cleanup to previous change. No need to have a data stack frame
    here.


M	src/lib/failures.c

2014-10-06 20:16:07 +0300 Timo Sirainen <tss@iki.fi> (d4f0041)

    log_timestamp setting supports now %{usecs} This is mainly useful for
    debugging.


M	src/lib/failures.c
M	src/lib/failures.h
M	src/log/log-connection.c

2014-10-05 23:36:10 +0000 Pascal Volk <user@localhost.localdomain.org> (af59148)

    man: Added doveadm-replicator.1.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-replicator.1.in
M	doc/man/doveadm.1.in

2014-10-05 23:25:48 +0000 Pascal Volk <user@localhost.localdomain.org> (1c84269)

    man: Forgot to update doveadm.1 in previous commit (fec91a386bb0).


M	doc/man/doveadm.1.in

2014-10-05 20:18:20 +0000 Pascal Volk <user@localhost.localdomain.org> (b0bc86d)

    man: Reworked dsync.1 and renamed it to doveadm-sync.1.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-backup.1
A	doc/man/doveadm-sync.1.in
A	doc/man/dsync.1
D	doc/man/dsync.1.in

2014-10-06 13:17:00 +0300 Timo Sirainen <tss@iki.fi> (34422d8)

    dsync: Debug logging improvements and comment clarifications.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-06 13:13:04 +0300 Timo Sirainen <tss@iki.fi> (f484259)

    dsync: Fixed potential crash when deleting mailbox.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2014-10-06 13:15:10 +0300 Timo Sirainen <tss@iki.fi> (f6a50ab)

    doveadm backup: Don't unnecessarily delete mailbox when handling expunges


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-06 12:21:52 +0300 Timo Sirainen <tss@iki.fi> (2176c7c)

    doveadm backup: Local mailbox was deleted also when there were just new
    messages.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-06 12:21:24 +0300 Timo Sirainen <tss@iki.fi> (f502a54)

    doveadm backup: When deleting a mailbox, log a warning, not just a debug
    message. Because we're also returning temporary failure in any case, so
    there needs to be some kind of a warning/error logged.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-05 20:56:39 +0300 Timo Sirainen <tss@iki.fi> (01a486e)

    dsync: Fixed linking with some systems.


M	src/doveadm/dsync/Makefile.am

2014-10-05 13:24:02 +0300 Timo Sirainen <tss@iki.fi> (75fe5f1)

    doveadm sync/backup: Updated usage string


M	src/doveadm/doveadm-dsync.c

2014-10-04 17:48:03 +0300 Stephan Bosch <stephan@rename-it.nl> (efbecef)

    lib: Added support for connecting UDP sockets.


M	src/lib/net.c
M	src/lib/net.h

2014-10-04 17:32:48 +0300 Stephan Bosch <stephan@rename-it.nl> (22215c2)

    lib-http: Fixed detecting disconnection when ioloop is running only
    intermittently. This fix only applies to ioloops created and run by lib-http
    itself.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2014-10-04 17:32:48 +0300 Stephan Bosch <stephan@rename-it.nl> (b66def5)

    lib-http: client: Added support for absolute request timeout. Requests
    cannot survive beyond this deadline.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2014-10-04 17:31:38 +0300 Stephan Bosch <stephan@rename-it.nl> (de01812)

    lib-http: client: Added support for delaying requests in milliseconds.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2014-10-04 17:31:38 +0300 Stephan Bosch <stephan@rename-it.nl> (06d1b65)

    lib-http: client queue: Start using new timeval_cmp_margin function for
    delay handling.


M	src/lib-http/http-client-queue.c

2014-10-04 17:31:38 +0300 Stephan Bosch <stephan@rename-it.nl> (b3ba8f6)

    lib: Fixed io_loop_move_timeout() to retain the next_run time, so that the
    timeout is not implicitly reset. This problem became with
    timeout_add_absolute(), since resetting an absolute timeout causes it to
    fire immediately (msecs == 0).


M	src/lib/ioloop.c

2014-10-04 17:31:14 +0300 Stephan Bosch <stephan@rename-it.nl> (dad72f9)

    lib: ioloop: Fixed absolute timeout removal. Absolute timeouts fire only
    once, so the timeout should be removed from the priority queue once it
    fires.


M	src/lib/ioloop.c

2014-10-04 17:30:54 +0300 Stephan Bosch <stephan@rename-it.nl> (9f4f359)

    lib-http: client: Fixed problem occuring when a nested ioloop was run inside
    a request callback using the same client. If requests in the nested ioloop
    would use the same connection as the one that called the callback, the
    requests would (in the best scenario) all be doomed to time out.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h

2014-10-04 00:29:30 +0300 Timo Sirainen <tss@iki.fi> (792737e)

    fs-posix: Compile fix for systems without flock()


M	src/lib-fs/fs-posix.c

2014-10-03 22:44:31 +0300 Timo Sirainen <tss@iki.fi> (c64840e)

    Make static analyzer happier


M	src/auth/passdb-static.c
M	src/doveadm/doveadm-dict.c
M	src/plugins/virtual/virtual-config.c

2014-10-03 22:39:53 +0300 Timo Sirainen <tss@iki.fi> (924af2a)

    lib-lda: smtp client may have crashed if remote returned a permanent error.


M	src/lib-lda/smtp-client.c

2014-10-03 18:18:44 +0300 Timo Sirainen <tss@iki.fi> (8abfdb7)

    Added signature for changeset 34e52cbeb837


M	.hgsigs

2014-10-03 18:18:41 +0300 Timo Sirainen <tss@iki.fi> (823190e)

    Added tag 2.2.14.rc1 for changeset 34e52cbeb837


M	.hgtags

2014-10-03 18:18:41 +0300 Timo Sirainen <tss@iki.fi> (4c808c4)

    Released v2.2.14.rc1.


M	NEWS
M	configure.ac

2014-10-03 17:36:11 +0300 Timo Sirainen <tss@iki.fi> (c939930)

    example-config: Added ssl_options setting.


M	doc/example-config/conf.d/10-ssl.conf

2014-10-03 17:11:58 +0300 Timo Sirainen <tss@iki.fi> (5d78627)

    imap: GETMETADATA was returning mailbox name as UTF-8 instead of mUTF-7


M	src/imap/cmd-getmetadata.c

2014-10-03 16:57:39 +0300 Timo Sirainen <tss@iki.fi> (b6c48e7)

    fs-posix: Added prefix parameter that is prefixed to all paths.


M	src/lib-fs/fs-posix.c

2014-10-03 16:31:33 +0300 Timo Sirainen <tss@iki.fi> (2d9b6a3)

    lib-lda, lmtp: Separate internal errors from remote errors. LMTP proxy
    shouldn't log remote errors with error level, because the proxy itself
    didn't have any failure.

    This is an API change, but I'm not aware of any plugins actually using the 
    lmtp-client.h directly.

M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h
M	src/lib-lda/smtp-client.c
M	src/lmtp/lmtp-proxy.c

2014-10-03 16:04:06 +0300 Timo Sirainen <tss@iki.fi> (0f430e0)

    master: If log process crashes, restart it immediately. The regular
    service_monitor_listen_start() doesn't work for it, because the log fds
    aren't in the listeners.


M	src/master/service-monitor.c

2014-10-02 19:43:25 +0300 Timo Sirainen <tss@iki.fi> (61f258f)

    dsync: Debug message fix


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-02 19:43:09 +0300 Timo Sirainen <tss@iki.fi> (f182955)

    lib-storage: Added %{session} to mail_user_var_expand_table()


M	src/lib-storage/mail-user.c

2014-10-02 13:15:22 +0300 Timo Sirainen <tss@iki.fi> (de39002)

    dsync: Improved debug logging.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-02 12:56:30 +0300 Timo Sirainen <tss@iki.fi> (3df1930)

    dsync: Added more debug logging.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-02 12:48:00 +0300 Timo Sirainen <tss@iki.fi> (5327026)

    doveadm backup: Fix to earlier commit - don't try to delete an already empty
    mailbox.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-02 12:31:34 +0300 Timo Sirainen <tss@iki.fi> (2faaca2)

    doveadm backup: Locally expunged mails weren't always added back.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-10-01 10:33:49 +0300 Stephan Bosch <stephan@rename-it.nl> (a40a555)

    lib-http: client: Fixed recovery after connection failure. If a parallel
    already connected connection was active, the queue wasn't notified of the
    failure. Only pending connections should be considered in this case and not
    established ones.


M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2014-10-01 10:33:39 +0300 Stephan Bosch <stephan@rename-it.nl> (aab7256)

    lib-http: client: Fixed aborting request in the middle of sending payload.
    If the request payload is so big that it cannot be sent all at once, the
    caller may at some point abort the request when it is still being sent. The
    bug occurred when the request finally finished sending. It erroneously
    advanced the state to WAITING rather than remaining ABORTED, thus 'reviving'
    the request unexpectedly.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c

2014-10-01 00:17:09 +0300 Timo Sirainen <tss@iki.fi> (9aa6561)

    lib: Fixed earlier timeout_add_absolute() commit. I removed too much from
    Stephan's patch.


M	src/lib/ioloop.c

2014-10-01 00:13:36 +0300 Stephan Bosch <stephan@rename-it.nl> (e28b88e)

    lib: Created timeval_cmp_margin(). It's identical to timeval_cmp(), except
    that it ignores tv_usec differences smaller than a specified margin.


M	src/lib/time-util.c
M	src/lib/time-util.h

2014-10-01 00:06:19 +0300 Stephan Bosch <stephan@rename-it.nl> (2753f93)

    lib: Added support for adding milliseconds to struct timeval time values.


M	src/lib/time-util.h

2014-10-01 00:03:17 +0300 Stephan Bosch <stephan@rename-it.nl> (43a2fa0)

    lib: Added support for setting timeouts at absolute time, rather than
    relative to current time.


M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2014-09-30 23:49:52 +0300 Stephan Bosch <stephan@rename-it.nl> (0d30ec5)

    lib-http: client: The http_client_queue_fail() function aborted requests in
    an unsafe manner. Copied queues before freeing the requests, because the
    destroyed requests modify the queue.


M	src/lib-http/http-client-queue.c

2014-09-30 23:49:45 +0300 Stephan Bosch <stephan@rename-it.nl> (16eb9a7)

    lib-http: client: Fixed crash occurring sometimes when delay timeout
    expired. Forgot to drop destroyed requests from delay queue.


M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c

2014-09-30 23:49:35 +0300 Stephan Bosch <stephan@rename-it.nl> (f176777)

    lib-sasl: Added reference counting to lib-sasl initialization.


M	src/lib-sasl/dsasl-client.c

2014-09-29 22:44:03 +0300 Timo Sirainen <tss@iki.fi> (5024c47)

    lib: Improved istream-file's failing read()/pread() error message.


M	src/lib/istream-file.c

2014-09-29 22:43:44 +0300 Timo Sirainen <tss@iki.fi> (73b9c24)

    lib: If i_stream_default_seek_nonseekable() can't seek, set a more readable
    error message.


M	src/lib/istream.c

2014-09-29 15:56:02 +0300 Timo Sirainen <tss@iki.fi> (ccb0406)

    lib-lda: smtp_client_deinit() may have returned NULL error strings.


M	src/lib-lda/smtp-client.c

2014-09-29 14:57:42 +0300 Timo Sirainen <tss@iki.fi> (b501407)

    lib-http: Fixed assert-crash when http_client_connection_disconnect() is
    called multiple times.


M	src/lib-http/http-client-connection.c

2014-09-29 14:16:06 +0300 Timo Sirainen <tss@iki.fi> (d519a04)

    dsync: Added DSYNC_BRAIN_FLAG_NO_MAIL_PREFETCH to avoid opening mails
    unnecessarily.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h
M	src/doveadm/dsync/dsync-mailbox-import.c

2014-09-26 00:32:03 +0300 Timo Sirainen <tss@iki.fi> (232ee7c)

    lib-storage: Don't assume that we must read the whole message to get its
    virtual size. This is true only with mbox format. All the other formats have
    various metadata available where it's stored.


M	src/lib-storage/index/index-mail.c

2014-09-25 19:43:28 +0300 Timo Sirainen <tss@iki.fi> (eec75bd)

    imap: die-callback didn't set log prefixes correctly for client handlers
    Calling mail_storage_service_io_activate_user() unfortunately doesn't set
    the ioloop context itself, so timeouts weren't inheriting it. It seemed a
    bit difficult to change this, so for now I just moved the call to the
    timeout handler.


M	src/imap/main.c

2014-09-25 15:50:03 +0300 Timo Sirainen <tss@iki.fi> (b5ff746)

    lib: If file_wait_lock*() fails, try to include the current pid holding the
    lock in error message. This is currently supported via fcntl(F_GETLK) and
    also via Linux /proc/locks.


M	src/lib/file-lock.c

2014-09-25 15:37:48 +0300 Timo Sirainen <tss@iki.fi> (2df651a)

    imap, pop3: Show user's proper log prefix when deinitializing users at exit.


M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/main.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h

2014-09-25 15:37:01 +0300 Timo Sirainen <tss@iki.fi> (85779ec)

    lib-storage: Allow calling storage service's ioloop activate/deactivate
    functions manually.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2014-09-25 15:15:20 +0300 Timo Sirainen <tss@iki.fi> (85b1455)

    lib: Code cleanup - check io_loop_context_add/remove_callbacks() callback
    parameters.


M	src/lib-storage/mail-storage-service.c
M	src/lib/ioloop.c
M	src/lib/ioloop.h
M	src/plugins/stats/stats-plugin.c

2014-09-25 13:40:54 +0300 Timo Sirainen <tss@iki.fi> (45324f1)

    Mark more memory pools as growing


M	src/lib-http/http-server-request.c
M	src/lib-index/mail-cache-lookup.c

2014-09-25 13:38:09 +0300 Timo Sirainen <tss@iki.fi> (1b81b28)

    auth: Mark memory pools as growing and use the same sizes for all
    mechanisms. Mainly to have DEBUG log fewer warnings.


M	src/auth/auth-request.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-apop.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-dovecot-token.c
M	src/auth/mech-external.c
M	src/auth/mech-gssapi.c
M	src/auth/mech-login.c
M	src/auth/mech-ntlm.c
M	src/auth/mech-otp.c
M	src/auth/mech-plain.c
M	src/auth/mech-rpa.c
M	src/auth/mech-scram-sha1.c
M	src/auth/mech-skey.c
M	src/auth/mech-winbind.c

2014-09-25 13:28:39 +0300 Timo Sirainen <tss@iki.fi> (33bd898)

    Avoid logging warnings about increasing memory pool/data stack with DEBUG
    on. These could have a minor effect on memory usage, but shouldn't be much.


M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/doveconf.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-service-settings.c
M	src/lib-settings/settings-parser.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c
M	src/master/service.c

2014-09-25 13:26:20 +0300 Timo Sirainen <tss@iki.fi> (0dc7891)

    lib: Added file_wait_lock_error() and file_try_lock_error()


M	src/lib/file-lock.c
M	src/lib/file-lock.h

2014-09-25 02:55:34 +0300 Timo Sirainen <tss@iki.fi> (96c5e55)

    fs-posix: fs_read_stream() now returns an istream that can live even after
    the fs_file is closed.


M	src/lib-fs/fs-posix.c

2014-09-25 01:13:12 +0300 Timo Sirainen <tss@iki.fi> (5463358)

    lib-storage: Added mailbox_get_index_path() and caching of the index path.
    This solves some potential assert-crashes on race conditions when opening a
    mailbox while it's being deleted.


M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2014-09-25 00:42:56 +0300 Timo Sirainen <tss@iki.fi> (70612e0)

    lib-storage: Headers were sometimes added to dovecot.index.cache with wrong
    line number value. This happened if the header parsing was done multiple
    times for the same mail. The end result being that when fetching multiple
    headers as a stream, the headers could have been returned in the wrong
    order. This messed up at least dsync's header hash comparisons.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.h

2014-09-25 00:41:15 +0300 Timo Sirainen <tss@iki.fi> (ad9403d)

    imapc: Fixed potential crash when trying to send NOOP before mailbox was
    fully opened.


M	src/lib-storage/index/imapc/imapc-storage.c

2014-09-25 00:40:48 +0300 Timo Sirainen <tss@iki.fi> (bf684c5)

    imapc: If connection isn't in selected state when deleting mailbox, don't
    try to UNSELECT it.


M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-list.c

2014-09-24 20:01:46 +0000 Pascal Volk <user@localhost.localdomain.org> (269cd8a)

    man: Added doveadm-fts.1.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-fts.1.in
M	doc/man/doveadm.1.in

2014-09-24 19:50:37 +0000 Pascal Volk <user@localhost.localdomain.org> (ca5b7ce)

    man: Added doveadm-acl.1.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-acl.1.in
M	doc/man/doveadm.1.in

2014-09-23 16:58:59 +0300 Timo Sirainen <tss@iki.fi> (45c763d)

    imap: Don't send MODSEQ in untagged FETCH reply if IMAP client didn't enable
    CONDSTORE/QRESYNC. We should have been checking client->enabled_features,
    not mailbox_get_enabled_features(). The former contains the features enabled
    by the IMAP client, while the latter contains also some automatically added
    features.


M	src/imap/imap-sync.c

2014-09-22 16:08:25 +0300 Timo Sirainen <tss@iki.fi> (1cf8b6d)

    lib-master: Increased instances file's dotlock timeout to 2 seconds. The 1
    second would have been enough, except the current dotlocking code uses
    second-level precision in checking timeouts, so it could end up trying the
    lock only once.

    A better fix would be to fix the dotlocking code to use millisecond-level 
    precision (internally), but since this is the only user so far where it 
    would have mattered, it's not really worth the effort (yet).

M	src/lib-master/master-instance.c

2014-09-22 15:56:31 +0300 Phil Carmody <phil@dovecot.fi> (1f0b3ea)

    lib: bsearch - make BINARY_NUMBER_SEARCH more widely usable This template is
    more widely usable if we do not hard-code into it the method of accessing
    the value being compared. For the default case we already use, this accessor
    is just a simple array dereferencing macro.

    As rewriting with the array access happens in the preprocessor, the code
    generated is completely unchanged.

    Expected future use:

    :  #define MY_GETTER(array, index) ((array)[(index)].index_field)
    :  #define MY_BINARY_SEARCH(data, count, value, idx_r)                  \
    :          BINARY_NUMERIC_SEARCH(MY_GETTER, data, count, value, idx_r);

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/bsearch-insert-pos.h

2014-09-18 17:46:18 +0200 Timo Sirainen <tss@iki.fi> (02a38d8)

    lib-dict: dict-fs implements now minimal iteration support.


M	src/lib-dict/dict-fs.c

2014-09-18 17:39:49 +0200 Timo Sirainen <tss@iki.fi> (8b03b93)

    doveadm dict iter: Use recursion flag only if -R parameter is specified.


M	src/doveadm/doveadm-dict.c

2014-09-18 02:19:32 +0200 Timo Sirainen <tss@iki.fi> (2944942)

    fs-posix: When deleting a directory, automatically fallback to rmdir()ing it


M	src/lib-fs/fs-posix.c

2014-09-16 23:22:59 +0300 Timo Sirainen <tss@iki.fi> (7bdd29c)

    virtual: Using modseq-based syncing while mailbox was open didn't handle
    expunges correctly. The expunges were handled only after EXPUNGE command was
    given, which should have been done only for mails that no longer matched the
    search query but still existed.


M	src/plugins/virtual/virtual-sync.c

2014-09-16 20:59:48 +0300 Timo Sirainen <tss@iki.fi> (5be5d87)

    quota: Quota recalculation didn't include INBOX in some configurations. If
    one inbox=yes and another inbox=no namespace shared the same mail location,
    and the inbox=no namespace was first, only it was used to list all
    mailboxes.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2014-09-16 20:29:04 +0300 Phil Carmody <phil@dovecot.fi> (260faea)

    lib: test-var-expand - disambiguate tests Two test cases had the same name.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-var-expand.c

2014-09-16 20:29:04 +0300 Phil Carmody <phil@dovecot.fi> (c971768)

    lib: hash-format - fix leak on _init() failure path If any of the
    analysis/parse helpers return failure, then the whole pool will leak.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/hash-format.c

2014-09-16 15:43:42 +0300 Timo Sirainen <tss@iki.fi> (fbf0acc)

    lib-storage: SEARCH_MAILBOX* value is now also compared to to the (virtual)
    mailbox name. This fixes for example "doveadm fetch uid mailbox virtual/all"


M	src/lib-storage/index/index-search.c

2014-09-16 15:23:51 +0300 Timo Sirainen <tss@iki.fi> (263d455)

    doveadm fts rescan: For virtual namespaces just mark the last indexed UID to
    0.


M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c

2014-09-16 14:32:20 +0300 Timo Sirainen <tss@iki.fi> (d06e111)

    fts: dovecot-expunges.log wasn't closed at deinit


M	src/plugins/fts/fts-expunge-log.c

2014-09-16 14:03:52 +0300 Phil Carmody <phil@dovecot.fi> (b800cda)

    lib: test-strnum - fix format size mismatch Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/lib/test-strnum.c

2014-09-16 13:38:30 +0300 Phil Carmody <phil@dovecot.fi> (629e96c)

    lib: test-strnum - add size-oblivious str_to/parse_uintmax tests Test a
    value of every bit-length. Also test the 10/9*MAX corner case. And due to
    crappy helper functions, test lots of leading zeroes too!

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-strnum.c

2014-09-16 13:38:30 +0300 Phil Carmody <phil@dovecot.fi> (bee4935)

    lib: remove uintmax tests from uint64 tests These log a warning on OSX with
    clang.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-strnum.c

2014-09-16 13:38:30 +0300 Phil Carmody <phil@dovecot.fi> (f1fab6f)

    lib: strnum - ensure str_to_uintmax doesn't return a value on error It was
    clobbering the _r parameter even though the spec says it shouldn't.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/strnum.c

2014-09-16 12:32:09 +0300 Timo Sirainen <tss@iki.fi> (54f559f)

    dsync: Moved doveadm-specific code to doveadm directory.


M	src/doveadm/Makefile.am
R099	src/doveadm/dsync/doveadm-dsync.c	src/doveadm/doveadm-dsync.c
R100	src/doveadm/dsync/doveadm-dsync.h	src/doveadm/doveadm-dsync.h
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/Makefile.am

2014-09-16 12:04:07 +0300 Timo Sirainen <tss@iki.fi> (56cf7fc)

    fs-metawrap: Fixed iteration wrapping, broken by earlier changes.


M	src/lib-fs/fs-metawrap.c

2014-09-16 01:12:21 +0300 Timo Sirainen <tss@iki.fi> (a7f818f)

    Makefile: Fixed linking libdovecot-dsync


M	src/doveadm/dsync/Makefile.am

2014-09-16 01:09:53 +0300 Timo Sirainen <tss@iki.fi> (c32552e)

    Compiler warning fix


M	src/lib-storage/mail-namespace.c

2014-09-16 00:43:36 +0300 Timo Sirainen <tss@iki.fi> (f89e493)

    lib-fs: fs-metawrap now fully wraps fs_iter_* to fix tracking struct
    fs.iters


M	src/lib-fs/fs-metawrap.c

2014-09-16 00:21:52 +0300 Timo Sirainen <tss@iki.fi> (9080427)

    lib-storage: Added mail_namespaces_init_add/finish() to manually
    initializing namespaces.


M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h

2014-09-16 00:21:13 +0300 Timo Sirainen <tss@iki.fi> (1e40531)

    lib-storage: Added mail_user_dup()


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2014-09-16 00:01:33 +0300 Timo Sirainen <tss@iki.fi> (e13e798)

    lib-fs: Keep track of all fs_iters in fs.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2014-09-15 23:57:45 +0300 Timo Sirainen <tss@iki.fi> (5804ddd)

    lib-fs: Added wait_ioloop/prev_ioloop helpers to struct fs.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2014-09-15 18:04:20 +0300 Timo Sirainen <tss@iki.fi> (faeca02)

    Install libdovecot-dsync.so library, which can be used separately.


M	Makefile.am
M	configure.ac
M	dovecot-config.in.in
M	dovecot.m4
M	src/doveadm/Makefile.am
M	src/doveadm/dsync/Makefile.am

2014-09-15 18:02:02 +0300 Timo Sirainen <tss@iki.fi> (0219a05)

    dsync: Moved all doveadm-specific code to doveadm-dsync.c


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-mailbox-tree.c

2014-09-15 11:19:50 +0300 Stephan Bosch <stephan@rename-it.nl> (711e8e4)

    lib-http: server: Fixed connection reference counting. Connection often
    still got destroyed too early. Particularly submitting responses would
    potentially destroy the connection, which is often unexpected. Sending
    responses is now postponed until handled by the stream output handler, which
    is explicitly triggered when necessary.


M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c

2014-09-14 11:29:35 +0300 Timo Sirainen <tss@iki.fi> (e84429c)

    fs-posix: Fixed fs_iter_deinit() when opendir() had failed.


M	src/lib-fs/fs-posix.c

2014-09-13 23:42:17 +0300 Timo Sirainen <tss@iki.fi> (6f6b74f)

    lib-http server: Keep output stream referenced to avoid accessing it after
    destroy.


M	src/lib-http/http-server-response.c

2014-09-13 22:15:35 +0300 Timo Sirainen <tss@iki.fi> (98ac702)

    fs-metawrap: Add FS_PROPERTY_COPY_METADATA property for wrapped fs backends.
    This is because if we simply use the parent copy the metadata gets copied as
    well.


M	src/lib-fs/fs-metawrap.c

2014-09-13 22:14:09 +0300 Timo Sirainen <tss@iki.fi> (bda58ae)

    fs-posix: Fixed memory leak in fs_iter_deinit()


M	src/lib-fs/fs-posix.c

2014-09-12 12:55:12 +0300 Timo Sirainen <tss@iki.fi> (6efdbea)

    lib-master: Earlier config file path fix broke reusing existing config
    socket lookups.


M	src/lib-master/master-service-private.h
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service.c

2014-09-11 18:15:04 +0300 Timo Sirainen <tss@iki.fi> (7fc0ca6)

    virtual: Recent optimizations had broken fast mailbox syncing. We wrongly
    assumed that all_mails array could have been accessed using vseqs. Broken by
    8abf7eea2966


M	src/plugins/virtual/virtual-sync.c

2014-09-11 16:40:00 +0300 Timo Sirainen <tss@iki.fi> (9514798)

    lib-mail: Message decoder now runs normalizer also for unknown charsets.


M	src/lib-mail/message-decoder.c

2014-09-11 16:14:24 +0300 Timo Sirainen <tss@iki.fi> (2646299)

    fts-lucene: No .. the rebuilding warning was still in the wrong place.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-09-11 16:12:38 +0300 Timo Sirainen <tss@iki.fi> (e1f07b9)

    fts-lucene: Include the mailbox name also in the rebuilding warning.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2014-09-11 16:11:37 +0300 Timo Sirainen <tss@iki.fi> (bfb05d2)

    fts-lucene: Log a warning when rebuilding index because of settings changes


M	src/plugins/fts-lucene/fts-backend-lucene.c

2014-09-10 18:41:39 +0300 Timo Sirainen <tss@iki.fi> (f1f877d)

    man: Forgot to remove XXX prefixes from doveadm-director.1.in


M	doc/man/doveadm-director.1.in

2014-09-10 16:05:32 +0300 Timo Sirainen <tss@iki.fi> (0799033)

    replication plugin: Actually, use empty mail_replica as "replication is
    disabled".


M	src/plugins/replication/replication-plugin.c

2014-09-10 15:54:58 +0300 Timo Sirainen <tss@iki.fi> (42882b9)

    replication plugin: Added replication_disabled setting.


M	src/plugins/replication/replication-plugin.c

2014-09-10 14:48:58 +0300 Pascal Volk <user@localhost.localdomain.org> (5bfb64d)

    man: doveadm-director man page updated


M	doc/man/doveadm-director.1.in

2014-09-10 14:42:34 +0300 Pascal Volk <user@localhost.localdomain.org> (96e19b9)

    man: doveadm-auth man page updated


M	doc/man/doveadm-auth.1.in

2014-09-10 14:37:50 +0300 Pascal Volk <user@localhost.localdomain.org> (66ac9ae)

    man: doveadm-dump man page updated


M	doc/man/doveadm-dump.1.in

2014-09-10 14:08:58 +0300 Phil Carmody <phil@dovecot.fi> (b85ff8f)

    lib-test: don't use 0 for old size in realloc call We have the real size,
    use it.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c

2014-09-10 14:08:58 +0300 Phil Carmody <phil@dovecot.fi> (8fcf84e)

    lib-index: test suite memory leak cleanup So that memory leak checkers can
    be active while running the test suites, ensure that the suite itself
    doesn't leak.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c

2014-09-10 14:08:58 +0300 Phil Carmody <phil@dovecot.fi> (9f5db9c)

    lib: test-seq-range-array - clean up array after use Removes noise when
    memory-leak debugging during unit tests.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-seq-range-array.c

2014-09-10 14:08:58 +0300 Phil Carmody <phil@dovecot.fi> (bf1683b)

    lib: test-aqueue - clean up the test queue each time round the loop Helps
    keep noise out of memory leak debugging during unit tests.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-aqueue.c

2014-09-10 14:08:58 +0300 Phil Carmody <phil@dovecot.fi> (0abffe9)

    lib: test-istream-concat - clean up our test-istreams This reduces noise
    when memory leak debugging the unit tests.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-istream-concat.c

2014-09-10 13:59:31 +0300 Timo Sirainen <tss@iki.fi> (b38866d)

    dsync: Reset I/O timeout every time when receiving input. This could have
    caused unwanted I/O timeouts when receiving large mails.


M	src/doveadm/dsync/dsync-ibc-stream.c

2014-09-09 17:26:52 -0600 Michael M Slusarz <slusarz@curecanti.org> (e540115)

    pop3: Optimize POP3 UIDL processing when duplicate renaming is not active.


M	src/pop3/pop3-commands.c

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (fe2b0e3)

    lib-http: client: Implemented support for connection failure backoff.


M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (9d746c6)

    lib-http: client: Added support for attempting a single IP several times.
    Also limits the number of attempts when there are many IPs.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (e432292)

    lib-http: client: Tunnel connection failure would cause segfault. That
    happened because it tried to retry waiting requests, which makes no sense
    for a CONNECT tunnel.


M	src/lib-http/http-client-connection.c

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (564e117)

    lib-http: server: Added support for authentication.


M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.h

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (0b5bdb5)

    lib-http: Implemented HTTP auth (RFC 7235).


M	src/lib-http/Makefile.am
A	src/lib-http/http-auth.c
A	src/lib-http/http-auth.h
M	src/lib-http/http-parser.c
M	src/lib-http/http-parser.h
A	src/lib-http/test-http-auth.c

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (394006e)

    lib-http: server: Added assert to connect callback which makes sure request
    is either responded to or referenced. Earlier change added this only to
    callback for normal requests, but CONNECT should be handled the same in this
    respect.


M	src/lib-http/http-server-connection.c

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (22b6576)

    lib-http: server: Fixed delayed request destruction. Destruction was
    actually delayed indefinitely, because the delay flag was not reset.
    Obviously, this caused a memory leak.


M	src/lib-http/http-server-connection.c

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (9f8cef4)

    lib-http: server: Made sure destroy callback is called only once.


M	src/lib-http/http-server-request.c

2014-09-10 13:39:37 +0300 Stephan Bosch <stephan@rename-it.nl> (0998d8a)

    lib-http: server: Fixed segfault occurring in connection input handler.
    Request handlers could close and destroy the connection early. Fixed by
    holding a reference in the input handler.


M	src/lib-http/http-server-connection.c

2014-09-10 13:39:36 +0300 Stephan Bosch <stephan@rename-it.nl> (1ec91e0)

    lib-http: server: Fixed handling of disconnection while request is being
    handled. This would cause an assert failure.


M	src/lib-http/http-server-connection.c

2014-09-09 17:09:30 +0300 Timo Sirainen <tss@iki.fi> (553f96f)

    lib-master: Fixed -c & -i command line parameters when config socket was
    readable. The config socket was always being read, even if another config
    file was attempted to be used.


M	src/lib-master/master-service-settings.c

2014-09-08 18:11:31 +0300 Timo Sirainen <tss@iki.fi> (aec1d6f)

    pop3c: Added missing support for pop3c_ssl=starttls


M	src/lib-storage/index/pop3c/pop3c-client.c

2014-09-08 13:39:25 +0300 Timo Sirainen <tss@iki.fi> (0917a1b)

    COPYING.LGPL: Updated FSF mailing address. Also some whitespace and line
    wrapping changes. Used the same file as
    http://www.gnu.org/licenses/lgpl-2.1.txt


M	COPYING.LGPL

2014-09-08 10:14:42 +0300 Timo Sirainen <tss@iki.fi> (7a88e72)

    pop3c: If base_dir isn't set, lookup pop3c_host with regular blocking DNS
    lookup.


M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-storage.c

2014-09-03 07:29:25 -0700 Timo Sirainen <tss@iki.fi> (d74a412)

    lib-storage: Compile fix to previous change The original patch was correct,
    my copy&pasting by hand just sucked. :)


M	src/lib-storage/mail-storage-settings.c

2014-09-03 06:29:52 -0700 Timo Sirainen <tss@iki.fi> (4c0e20d)

    lib-storage: Fixed off-by-one memory allocation in dynamic settings
    allocation code. This didn't actually affect normal Dovecot builds, because
    there were always some storages with get_setting_parser_info=NULL that added
    the necessary padding.

    Patch by Michael M Slusarz

M	src/lib-storage/mail-storage-settings.c

2014-08-29 13:22:11 +0900 Timo Sirainen <tss@iki.fi> (ad396be)

    fs layout: Absolute paths as mailbox names shouldn't return index with
    INDEX=MEMORY


M	src/lib-storage/list/mailbox-list-fs.c

2014-08-29 02:14:43 +0900 Timo Sirainen <tss@iki.fi> (f90cbe5)

    lib-index, lib-storage: Fixed race conditions with deleting mailbox. Now
    only one process can successfully finish mailbox_mark_index_deleted().


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2014-08-29 00:41:07 +0900 Timo Sirainen <tss@iki.fi> (92093e6)

    lib-fs: Keep a linked list of all files within fs to help debugging.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2014-08-28 23:52:46 +0900 Timo Sirainen <tss@iki.fi> (aaaa6e0)

    Added UNLINK_EISDIR() helper macro.


M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib/compat.h

2014-08-28 23:50:25 +0900 Timo Sirainen <tss@iki.fi> (77d122b)

    maildir: Handle unlink()=EPERM failure the same as EISDIR. EPERM is POSIX,
    while EISDIR is Linux-specific.


M	src/lib-storage/index/maildir/maildir-sync-index.c

2014-08-28 22:44:18 +0900 Timo Sirainen <tss@iki.fi> (f1177d2)

    lib-fs: Fixed metawrap_fs.copy() to work with FS_PROPERTY_COPY_METADATA
    backends. This is done by simply copying the entire file with the metadata
    included instead of rewriting it.


M	src/lib-fs/fs-metawrap.c

2014-08-28 22:10:25 +0900 Timo Sirainen <tss@iki.fi> (9346506)

    Replaced dict_init() with dict_init_full() in various places.


M	src/lib-storage/index/index-attribute.c
M	src/plugins/last-login/last-login-plugin.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota.c

2014-08-28 21:57:34 +0900 Timo Sirainen <tss@iki.fi> (a6a6ad1)

    lib-dict: file backend now expands ~/ paths if home_dir setting is set.


M	src/lib-dict/dict-file.c
M	src/lib-dict/dict.h

2014-08-28 21:56:41 +0900 Timo Sirainen <tss@iki.fi> (39ea571)

    lib-dict: Changed dict.init() API to take struct dict_settings and added
    dict_init_full(). This allows giving more settings to dict in future as
    needed. Unfortunately it also breaks the internal dict API, but there aren't
    really any plugins widely using it, so it's not a big problem.


M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-fs.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h

2014-08-28 22:06:29 +0900 Timo Sirainen <tss@iki.fi> (4d8d947)

    dict: Renamed struct dict_settings to dict_server_settings.


M	src/dict/dict-settings.c
M	src/dict/dict-settings.h

2014-08-27 07:53:39 +0300 Timo Sirainen <tss@iki.fi> (5308e1a)

    auth ldap: Compile fix to previous change.. Looks like on my local build
    system ldap wasn't enabled..


M	src/auth/passdb-ldap.c

2014-08-27 13:38:53 +0900 Timo Sirainen <tss@iki.fi> (3f647ff)

    auth ldap: Don't require password field to exist for passdb lookups when
    auth_bind=yes. This should fix lmtp/doveadm proxy lookups with auth_bind=yes


M	src/auth/passdb-ldap.c

2014-08-26 16:00:37 +0900 Timo Sirainen <tss@iki.fi> (42630b2)

    lib-http: Added http_client_request_get_method()


M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2014-08-26 14:50:15 +0900 Timo Sirainen <tss@iki.fi> (d5091e5)

    auth: Allow passdb credentials lookup also with auth_bind=yes Although we
    probably can't lookup the password itself, we're also doing passdb lokups
    for proxying and other purposes. These lookups will still work as long as
    pass_attrs & pass_filter is specified.


M	src/auth/passdb-ldap.c

2014-08-21 20:56:40 +0200 Timo Sirainen <tss@iki.fi> (cc52f19)

    doveadm exec: Show help if binary name wasn't given.


M	src/doveadm/doveadm.c

2014-08-21 20:54:46 +0200 Timo Sirainen <tss@iki.fi> (0c9ba05)

    doveadm ring status: Help text was shown for wrong command.


M	src/doveadm/doveadm-director.c

2014-08-21 15:52:14 +0300 Timo Sirainen <tss@iki.fi> (8d14b5f)

    fts-lucene: Compiling fix for earlier change.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-08-21 14:51:11 +0200 Timo Sirainen <tss@iki.fi> (a02d497)

    fts-lucene: Don't crash when index building fails but we were still planning
    to optimize the index.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2014-08-21 14:49:34 +0200 Timo Sirainen <tss@iki.fi> (61435a5)

    fts-lucene: When deleting corrupted lucene-indexes/ directory, don't rmdir
    it. This at least avoids errors with NFS when some of the files are still
    open inside it by other processes.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-08-21 14:48:41 +0200 Timo Sirainen <tss@iki.fi> (4d72a99)

    fts-lucene: Automatically close index after 2 minutes of idling.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-08-21 14:46:47 +0200 Timo Sirainen <tss@iki.fi> (e8d5561)

    fts-lucene: Make sure Lucene indexes are always closed at deinit to avoid
    memory leaks. At least optimize leaked memory.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-08-21 11:40:51 +0200 Timo Sirainen <tss@iki.fi> (ba9ec88)

    redis: Added support for path=/unix/socket/path parameter instead of
    host/port.


M	src/lib-dict/dict-redis.c

2014-08-20 15:35:43 +0200 Timo Sirainen <tss@iki.fi> (f7b1126)

    pop3: Fixed potential assert-crash on disconnect.


M	src/pop3/pop3-client.c

2014-08-20 15:32:15 +0200 Timo Sirainen <tss@iki.fi> (ee77aba)

    lmtp: Put back the deduplication code. Too dangerous after all to change it
    in the middle of v2.2.x. It's also not causing that much trouble even when
    it breaks..


M	src/lmtp/client.h
M	src/lmtp/commands.c

2014-08-20 14:35:27 +0200 Timo Sirainen <tss@iki.fi> (b8a6abf)

    auth: protocol-specific username settings weren't used for userdb lookups.
    The username was set before the service-specific settings were looked up, so
    global settings were always used. This affected auth_default_realm,
    auth_username_translation and auth_username_format settings.


M	src/auth/auth-master-connection.c
M	src/auth/auth-postfix-connection.c

2014-08-20 14:22:28 +0300 Timo Sirainen <tss@iki.fi> (aadd92e)

    fts-lucene: If whitespace_chars was set, we may have ended up indexing some
    garbage words. The final \0 was replaced with space, so everything beyond
    that was also being indexed.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-08-20 12:47:10 +0200 Timo Sirainen <tss@iki.fi> (5c5e738)

    lib-dict: Hide internal ioloop from async commit callbacks. (Redis &
    memcached fix)


M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-redis.c

2014-08-20 12:36:37 +0200 Timo Sirainen <tss@iki.fi> (8aa049f)

    last-login plugin: Added ABI version check.


M	src/plugins/last-login/last-login-plugin.c

2014-08-20 12:35:27 +0200 Timo Sirainen <tss@iki.fi> (4770821)

    last-login: Fixed timeout leak at user deinit.


M	src/plugins/last-login/last-login-plugin.c

2014-08-20 12:07:19 +0200 Timo Sirainen <tss@iki.fi> (b6c6c4f)

    lib-storage: Added data stack frame to mail_prefetch().


M	src/lib-storage/mail.c

2014-08-20 11:19:15 +0200 Timo Sirainen <tss@iki.fi> (7103d82)

    doveconf: local and remote net/bits addresses were printed with /bits twice.


M	src/config/doveconf.c

2014-08-20 11:09:27 +0200 Timo Sirainen <tss@iki.fi> (3d4648e)

    Several services weren't enforcing their process_limit=1 requirement.


M	src/indexer/indexer-settings.c
M	src/ipc/ipc-settings.c
M	src/replication/replicator/replicator-settings.c
M	src/stats/stats-settings.c

2014-08-19 23:53:18 +0200 Timo Sirainen <tss@iki.fi> (5a9c736)

    lib: Added unit tests for wildcard_match()


M	src/lib/Makefile.am
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-wildcard-match.c

2014-08-19 23:51:14 +0200 Timo Sirainen <tss@iki.fi> (6bde03b)

    lib: wildcard_match() should have matched "*" wildcard against an empty ""
    string also. This fixes global ACL "*" matching the root namespace when
    creating new mailboxes.


M	src/lib/wildcard-match.c

2014-08-18 22:39:56 +0200 Timo Sirainen <tss@iki.fi> (9ffd3c8)

    director: Log a warning when using "director host flush" for all hosts.


M	src/director/doveadm-connection.c

2014-08-18 10:43:59 +0200 Timo Sirainen <tss@iki.fi> (935a243)

    istream-chain: Fixed crash caused by earlier io_add_stream() support change.


M	src/lib/istream-chain.c

2014-08-15 16:00:07 +0300 Timo Sirainen <tss@iki.fi> (1bb6281)

    lib-http server: Use io_add_istream() to wait for the payload istream. This
    way the stream doesn't necessarily have to have a fd.


M	src/lib-http/http-server-response.c

2014-08-15 15:59:17 +0300 Timo Sirainen <tss@iki.fi> (f07090a)

    lib-http: Added asserts to make sure CR or LF can't be added accidentally to
    HTTP headers.


M	src/lib-http/http-server-response.c

2014-08-15 15:22:46 +0300 Timo Sirainen <tss@iki.fi> (d295cff)

    istream-chain: Support using io_add_istream() for the chain stream. The
    callback is notified whenever new streams are added to the chain.

    It's currently not possible to have nonblocking istreams added to the chain 
    and the callback being called when they have new data, but it would be 
    possible to implement as well if needed at some point.

M	src/lib/istream-chain.c

2014-08-15 15:19:24 +0300 Timo Sirainen <tss@iki.fi> (cc80e45)

    io_add_istream(): Allow the istream to be added even if it doesn't have fd.


M	src/lib/ioloop.c

2014-08-15 15:02:59 +0300 Phil Carmody <phil@dovecot.fi> (a9d6c2e)

    pop3: satisfy some strict parsing rules in RFC 1939 "Commands in the POP3
    consist of a case-insensitive keyword, possibly  followed by one or more
    arguments.  All commands are terminated by a  CRLF pair.  Keywords and
    arguments consist of printable ASCII  characters.  Keywords and arguments
    are each separated by a single  SPACE character."

    "A server MUST respond to an unrecognized, unimplemented, or
    syntactically invalid command by responding with a negative status
    indicator."

    Therefore the following commands must be rejected: LIST 2600Hz LIST 99 red
    balloons TOP 1 2 buckle-my-shoe

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/pop3/pop3-commands.c

2014-08-15 15:02:59 +0300 Phil Carmody <phil@dovecot.fi> (797dc45)

    pop3: fix msgnum/size parsers The outer if()s are completely unnecessary,
    and permit `num' to remain uninitialised. Spotted by clang's static
    analysis.

    Bug introduced in changeset: 17563:2ed2ab04b63d

    Note that the lack of a parameter from a broken client is no longer treated
    as "0". Before the bug was introduced:
     DELE
     -ERR There's no message 0. After this patch:
     DELE
     -ERR Invalid message number:

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/pop3/pop3-commands.c

2014-08-15 14:48:08 +0300 Timo Sirainen <tss@iki.fi> (a69dfb7)

    Compiling fix for previous change..


M	src/lib-storage/mail-error.h

2014-08-15 14:41:03 +0300 Timo Sirainen <tss@iki.fi> (2ed2459)

    Handle "out of disk space" and "out of user quota" as separate cases. "Out
    of disk space" is a temporary error that should be logged as error and the
    failure should be sent to user as "Internal server error".

    Obsolete the use of MAIL_ERROR_NOSPACE and MAIL_ERRSTR_NO_SPACE. Use the 
    clearer MAIL_ERROR_NOQUOTA and MAIL_ERRSTR_NO_QUOTA instead.

M	src/doveadm/doveadm-mail.c
M	src/imap/imap-commands-util.c
M	src/lda/main.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-error.h
M	src/lib/compat.h
M	src/lmtp/commands.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/snarf/snarf-plugin.c
M	src/pop3/pop3-client.c

2014-08-15 14:05:21 +0300 Timo Sirainen <tss@iki.fi> (749f6ac)

    ldap: Treat "No such object" errors to search the same as if no results were
    returned. Trying to look up a nonexistent base returns this error.


M	src/auth/db-ldap.c

2014-08-15 13:58:47 +0300 Timo Sirainen <tss@iki.fi> (e867081)

    auth: Internal passdb failures were always failing the request even if
    another passdb succeeded later.


M	src/auth/auth-request.c

2014-08-13 13:34:22 +0300 Phil Carmody <phil@dovecot.fi> (833bed9)

    lib-http: server_request/connection - improve encapsulation It just feels a
    bit dirty having the request mess around with the connection's internals,
    have the connection manage its linked lists itself. No functional changes.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c

2014-08-13 12:51:41 +0300 Timo Sirainen <tss@iki.fi> (66b9c9a)

    virtual plugin: Optimized memory allocation. Patch by Teemu Huovila.


M	src/plugins/virtual/virtual-sync.c

2014-08-12 19:30:37 +0300 Timo Sirainen <tss@iki.fi> (33326db)

    Compiler warning fix


M	src/lib-storage/mail-storage.c

2014-08-12 19:24:10 +0300 Timo Sirainen <tss@iki.fi> (e5536fd)

    virtual plugin: Handle physical mailbox deletion while virtual mailbox is
    open.


M	src/plugins/virtual/virtual-sync.c

2014-08-12 19:12:04 +0300 Timo Sirainen <tss@iki.fi> (139e39b)

    mailbox_list_index=yes: Make sure storage error doesn't change when updating
    STATUS info.


M	src/lib-storage/list/mailbox-list-index-status.c

2014-08-12 19:05:14 +0300 Timo Sirainen <tss@iki.fi> (97ae336)

    lib-storage: Added mail_storage_last_error_push/pop()


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2014-08-12 18:48:03 +0300 Timo Sirainen <tss@iki.fi> (5948e3e)

    virtual plugin: Optimized syncing a large number of physical mailboxes.
    Especially when the number of mails was large the old code took a lot of CPU
    time. Based on patch by Teemu Huovila.


M	src/plugins/virtual/virtual-sync.c

2014-08-12 14:44:11 +0300 Timo Sirainen <tss@iki.fi> (80587a0)

    stats: Added num_connected_sessions for domains and IPs.


M	src/stats/client-export.c
M	src/stats/mail-domain.c
M	src/stats/mail-domain.h
M	src/stats/mail-ip.c
M	src/stats/mail-ip.h
M	src/stats/mail-session.c
M	src/stats/mail-stats.h
M	src/stats/mail-user.c
M	src/stats/mail-user.h

2014-08-12 13:12:01 +0300 Timo Sirainen <tss@iki.fi> (14bd241)

    lib-http server: Delay calling the request's destroy callback until
    handle_request() callback is finished. This simplifies the code in the
    handle_request() so it doesn't need to keep track of whether the response is
    already submitted or not.


M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c

2014-08-12 12:39:46 +0300 Timo Sirainen <tss@iki.fi> (a078043)

    fts-lucene: If lucene-indexes dir is unexpectedly lost, rescan when expunge
    log update fails. This mainly fixes a repeating error about failing to open
    the expunge log. It should happen only if dovecot.index thinks that the
    mailbox is indexed while in reality the entire lucene-indexes directory
    doesn't exist.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2014-08-11 19:30:15 +0300 Timo Sirainen <tss@iki.fi> (9929820)

    ostream-buffer: Allow modifying the buffer outside ostream, unless
    o_stream_seek() is used. Now we'll just append to the end of the buffer
    instead of forcibly trying to write at the offset where the last ostream
    write ended.


M	src/lib/ostream-buffer.c

2014-08-11 19:19:45 +0300 Timo Sirainen <tss@iki.fi> (3b4374e)

    istream-callback: Added i_stream_callback_get_buffer().


M	src/lib/istream-callback.c
M	src/lib/istream-callback.h

2014-08-11 17:43:25 +0300 Timo Sirainen <tss@iki.fi> (605ebd4)

    lib: Added istream-callback API


M	src/lib/Makefile.am
A	src/lib/istream-callback.c
A	src/lib/istream-callback.h

2014-08-11 16:08:44 +0300 Timo Sirainen <tss@iki.fi> (36ec5b3)

    Compiler warning fix


M	src/lib/ostream-file.c

2014-08-11 15:55:03 +0300 Timo Sirainen <tss@iki.fi> (bbda51e)

    lib-http server: Comment updates


M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server.h

2014-08-11 15:54:43 +0300 Timo Sirainen <tss@iki.fi> (46631c1)

    lib: io_stream_copy() no longer attempts to read full block sizes from
    input. Although that may be more efficient for writing (to files), it causes
    unnecessary work for the input stream. The writing part should also be
    optimized anyway if the caller corks the output stream.


M	src/lib/iostream-temp.c
M	src/lib/ostream-file.c
M	src/lib/ostream-private.h
M	src/lib/ostream.c

2014-08-11 15:47:57 +0300 Timo Sirainen <tss@iki.fi> (93ed696)

    lib-http server: Added http_server_request_is_finished() This is intended
    mainly to be used in asserts and such checks.


M	src/lib-http/http-server-request.c
M	src/lib-http/http-server.h

2014-08-11 15:46:29 +0300 Timo Sirainen <tss@iki.fi> (91a4824)

    lib-http: Call the destroy callback also when request is aborted.


M	src/lib-http/http-server-request.c

2014-08-11 15:45:21 +0300 Timo Sirainen <tss@iki.fi> (50ba4fe)

    lib-http: Don't leak memory if HTTP client disconnects unexpectedly.
    http_server_connection_disconnect() has several cleanup calls, which weren't
    done because closed=TRUE was set explicitly and that skipped the cleanup.


M	src/lib-http/http-server-connection.c

2014-08-11 14:18:53 +0300 Timo Sirainen <tss@iki.fi> (faa8995)

    lib-http server: Call request destroy callback immediately after response is
    finished sending. Regardless of any other references to the request.


M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server.h

2014-08-11 13:32:06 +0300 Timo Sirainen <tss@iki.fi> (ace2d83)

    lib-mail: Added comments to message-parser.h


M	src/lib-mail/message-parser.h

2014-08-11 13:30:25 +0300 Timo Sirainen <tss@iki.fi> (7b61cb2)

    lib-mail: Message parser now always returns block->data=NULL when it's not
    supposed to be used.


M	src/lib-mail/message-parser.c

2014-08-09 10:10:34 +0300 Timo Sirainen <tss@iki.fi> (4d981bc)

    doveadm fs put: Added -h <hash> parameter to specify the file's hash. The
    hash (in hex) is automatically detected to be either MD5 or SHA256 based on
    its size. If the fs backend doesn't support the hash it'll fail. Otherwise
    it'll make sure that the written file matches the given hash.


M	src/doveadm/doveadm-fs.c

2014-08-08 16:27:40 +0300 Timo Sirainen <tss@iki.fi> (a693adf)

    fts: fts_no_autofuzzy shouldn't disable fuzzying when FUZZY search parameter
    is set.


M	src/plugins/fts/fts-storage.c

2014-08-08 16:20:31 +0300 Timo Sirainen <tss@iki.fi> (117fb8c)

    fts: Added fts_no_autofuzzy setting to require exact matches for found
    results. This is done by using the FTS search results as only filters on
    which the regular non-FTS search is done.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-api.h
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h

2014-08-08 15:15:03 +0300 Timo Sirainen <tss@iki.fi> (212a8a2)

    doveadm search: If mailbox GUID lookup fails, print an error.


M	src/doveadm/doveadm-mail-search.c

2014-08-08 14:54:46 +0300 Timo Sirainen <tss@iki.fi> (762d8af)

    virtual: Allow "*" to match inbox=yes namespace if there's otherwise no
    prefix="" namespace.


M	src/plugins/virtual/virtual-config.c

2014-08-08 14:54:20 +0300 Timo Sirainen <tss@iki.fi> (676a42c)

    virtual: Make sure virtual mailbox doesn't try to access itself as a backend
    mailbox.


M	src/plugins/virtual/virtual-config.c

2014-08-08 13:46:05 +0300 Timo Sirainen <tss@iki.fi> (dac7e6a)

    lib-storage: mailbox_get_*status(STATUS_HIGHESTMODSEQ) now enables CONDSTORE
    feature. This makes sure that the highestmodseq is added to the mailbox list
    index if not already there.


M	src/lib-storage/mail-storage.c

2014-08-08 13:32:08 +0300 Timo Sirainen <tss@iki.fi> (074055d)

    virtual: Make sure modseqs are always enabled for backend mailboxes.
    mailbox_get_status() wasn't adding a missing highestmodseq otherwise to the
    mailbox list index.


M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c

2014-08-06 16:39:27 +0300 Timo Sirainen <tss@iki.fi> (78d1160)

    auth: passdb static assumed that missing "password" field meant empty
    password Missing password should be an error unless nopassword is set. If an
    empty password is wanted then "password=" can be used.


M	src/auth/passdb-static.c

2014-08-05 20:23:32 +0200 Stephan Bosch <stephan@rename-it.nl> (b37e11d)

    lib-http: server: Fixed server waiting for payload of already failed
    request.


M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c

2014-08-05 17:43:31 +0200 Timo Sirainen <tss@iki.fi> (738561f)

    lib-http server: Require handle_request() to either send a response or
    reference the request. This should make it more difficult to accidentally
    forget to send a response and cause a hang.

    Currently this assert-crashes, although it would have been possible to make 
    it return some internal error instead also.

M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server.h

2014-08-05 17:37:25 +0200 Timo Sirainen <tss@iki.fi> (1e9296d)

    lib-http server: Made http_server_request_[un]ref() public. Also
    http_server_request_unref() now returns if this was the last reference or
    not.


M	src/lib-http/http-server-private.h
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server.h

2014-08-05 16:28:15 +0200 Timo Sirainen <tss@iki.fi> (b979376)

    lib-http server: Create a new data stack frame for all the callbacks.


M	src/lib-http/http-server-connection.c

2014-08-05 16:22:43 +0200 Timo Sirainen <tss@iki.fi> (85f3bd5)

    lib-http server: Added http_server_request_get_response() Also make sure
    that only a single response can be created for a request.


M	src/lib-http/http-server-request.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.h

2014-08-05 16:09:44 +0200 Timo Sirainen <tss@iki.fi> (14c0ef1)

    lib-http server: Removed extra "return;" that was never called.


M	src/lib-http/http-server-connection.c

2014-08-05 16:07:25 +0200 Timo Sirainen <tss@iki.fi> (95e0b82)

    lib-http server: Removed "bool close" parameters in favor of _close()
    functions. Most callers don't want to close the connection so it's an extra
    parameter usually. Also it's difficult to remember what the TRUE/FALSE means
    so it's easy to cause bugs by copy&pasting the code.

    http_server_request_fail() will also now forcibly close the connection if 
    conn->input_broken is set.

M	src/lib-http/http-server-connection.c
M	src/lib-http/http-server-request.c
M	src/lib-http/http-server-response.c
M	src/lib-http/http-server.h

2014-08-04 14:05:51 +0200 Timo Sirainen <tss@iki.fi> (8779127)

    expire plugin: Fixed crash at deinit if expire_dict initialization failed.


M	src/plugins/expire/expire-plugin.c

2014-08-01 17:17:53 +0300 Timo Sirainen <tss@iki.fi> (9008dae)

    imap-urlauth: Error message typofix. Patch by Jelmer Vernooij


M	src/imap-urlauth/imap-urlauth-worker.c

2014-07-31 15:58:18 +0300 Timo Sirainen <tss@iki.fi> (f53915d)

    lib-mail: rfc822_parse_dot_atom() didn't return error if "." wasn't followed
    by ATEXT It simply skipped over the invalid character and continued.


M	src/lib-mail/rfc822-parser.c

2014-07-30 15:01:29 +0300 Phil Carmody <phil@dovecot.fi> (ee2298f)

    lib: test-data-stack - add some fatal tests. Extra caution is necessary as
    data-stack is such a fundamental component. All of the brokenness that we
    add must be undone as soon as possible, or there will be an endless loop of
    catastrophic errors. In order to avoid that, at least try to detect some
    issues, and abort as quickly as possible.

    Alas, due to the reliance of these tests on DEBUG code, if that's not set, 
    this test is a no-op.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-data-stack.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-07-30 15:01:29 +0300 Phil Carmody <phil@dovecot.fi> (8bec197)

    lib: test fatal cases for printf_format_fix Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/lib/test-lib.c
M	src/lib/test-lib.h
M	src/lib/test-printf-format-fix.c

2014-07-30 15:01:29 +0300 Phil Carmody <phil@dovecot.fi> (8b28396)

    lib: test-lib - add a real fatal test for mempool-alloconly Crazily huge
    memory allocation must fail.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-lib.c
M	src/lib/test-lib.h
M	src/lib/test-mempool-alloconly.c

2014-07-30 15:01:29 +0300 Phil Carmody <phil@dovecot.fi> (a4e0dc5)

    lib-test: permit tests of fatal conditions Some functions have no mechanism
    of reporting an error, and mustn't continue, so fatality is the only way
    out. (E.g. memory allocation failures.)

    This addition is for those situations. Semantics of failure tests are very 
    different from normal tests:

    - The test function must have the following prototype:
      enum fatal_test_state test_fatal_things(int index);
    - The index it will be called with starts at 0, and increments each time.
    - It must call test_start() at the start of its first call.
    - Apart from its final call, it must call a function it expects to trap the
      fatal error handler. If that fails to trap, it must return
    FATAL_TEST_FAILURE
    - After returning FATAL_TEST_FAILURE, it will continue to be called as
    normal.
    - When there are no more tests to perform, it must clean up, call test_end()
      and return FATAL_TEST_FINISHED. It will not be called again.
    - If it detects errors in this protocol, it must not i_assert(), as that
    will
      be treated as an expected fatal, it must return FATAL_TEST_ABORT. It will
      then not be called again. It must not call test_end() in this case.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2014-07-29 17:27:24 +0300 Timo Sirainen <tss@iki.fi> (79ce5b0)

    quota: Avoid assert-crash in Maildir++ quota if backend doesn't support
    control dirs. We'll delay looking up the control dir until we've checked
    that the storage is Maildir.


M	src/plugins/quota/quota-maildir.c

2014-07-29 14:27:49 +0300 Timo Sirainen <tss@iki.fi> (531b963)

    libressl fix: Fixed compiling with SSL compression disabled. Patch by Pascal
    Stumpf


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/login-common/ssl-proxy-openssl.c

2014-07-29 14:25:13 +0300 Timo Sirainen <tss@iki.fi> (5ea089e)

    libressl fix: Check for SSL_CTRL_SET_ECDH_AUTO macro instead of OpenSSL
    version number Patch by Hanno BÃ¶ck


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/login-common/ssl-proxy-openssl.c

2014-07-29 13:58:10 +0300 Timo Sirainen <tss@iki.fi> (0033858)

    mbox: Fixed infinite looping and other incorrectness in istream-raw-mbox.
    This was caused by the recent istream invalidation checks in
    i_stream_get_data().


M	src/lib-storage/index/mbox/istream-raw-mbox.c

2014-07-29 12:47:47 +0300 Timo Sirainen <tss@iki.fi> (bf35449)

    last-login plugin: Added missing configure and Makefile entries.


M	configure.ac
M	src/plugins/Makefile.am

2014-07-28 16:50:47 +0300 Phil Carmody <phil@dovecot.fi> (c35c0f7)

    lib-http: http-server-connection - don't resume closed connections
    Signed-off-by: Phil Carmody <phil@dovecot.fi>


M	src/lib-http/http-server-connection.c

2014-07-28 16:49:47 +0300 Phil Carmody <phil@dovecot.fi> (4de9950)

    lib-imap: imap-utf7 - only encode in-range 7-bit values 0x01-0x1F and
    0x7f-... must be mBASE64 encoded.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/imap-utf7.c

2014-07-28 16:49:47 +0300 Phil Carmody <phil@dovecot.fi> (585017c)

    lib-imap: imap-utf7 - reject encoded simple ASCII "Modified BASE64 MUST NOT
    be used to represent any printing US-ASCII character which can represent
    itself."

    "The character "&" (0x26) is represented by the two-octet sequence "&-""

    Therefore any mBASE64 sequence containing any character between 0x20 and 
    0x7e is invalid.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/imap-utf7.c

2014-07-28 16:49:47 +0300 Phil Carmody <phil@dovecot.fi> (807d831)

    lib-imap: imap-utf7 - reject bogus characters in the mUTF7 Only 0x20..0x7e
    are permitted, as "All other characters (octet values 0x00-0x1f and
    0x7f-0xff) are represented in modified BASE64, ...".

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/imap-utf7.c

2014-07-28 16:49:47 +0300 Phil Carmody <phil@dovecot.fi> (50052bc)

    lib-imap: test-imap-utf7 - comprehensive test suite Several MUST NOTs or
    other standards violations were not being trapped.

    test_imap_utf7_unnecessary() tests:
     Modified BASE64 MUST NOT be used to represent any printing US-ASCII
     character which can represent itself.

    test_imap_utf7_bad_ascii() tests:
     All other characters (octet values 0x00-0x1f and 0x7f-0xff) are
     represented in modified BASE64, ...

    test_imap_utf7_non_utf16() tests that data containing a single straggling 
    octet is trapped.

    test_imap_utf7_by_example() and test_imap_utf7_ucs4_cases() are just the
    previous test suite split into 2 smaller tests.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/test-imap-utf7.c

2014-07-28 16:49:47 +0300 Phil Carmody <phil@dovecot.fi> (68828bd)

    lib-imap: test-imap-utf7 - migrate to test_assert_idx Signed-off-by: Phil
    Carmody <phil@dovecot.fi>


M	src/lib-imap/test-imap-utf7.c

2014-07-28 16:49:47 +0300 Phil Carmody <phil@dovecot.fi> (83060e2)

    lib: test-str-sanitize - tighten tests Check that the identical string is
    returned in the no-change case, not just a copy.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-str-sanitize.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (0db47f1)

    lib-test: make internal helpers static These functions should only be called
    from within test_run(), as some of the test-suite sanity checks can be
    subvirted if these are exposed.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (c447f89)

    lib-test: quieten the random seed printfs We only need to know the seed
    once.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (0a568c1)

    lib: compile time checks for buffer creation Ensure the data buffer has as
    much space as the size parameter claims. This uses the strictest test GCC
    provides - the smallest containing object, and returning 0 for unknown size.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/buffer.c
M	src/lib/buffer.h

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (61dd0a2)

    lib: data-stack - start sentry checks immediately after the reserved buffer
    Our sentries are written with byte-precision, no need to round up before
    doing the checks.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (c538e7f)

    lib: data-stack - add DEBUG size and sentry updating to t_try_realloc
    Without this, t_pop() will report errors.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (f9a1f7b)

    lib: test-data-stack - add realloc tests These will fail noisily with a
    DEBUG build until the realloc/DEBUG bug is fixed.


M	src/lib/test-data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (6f8cb38)

    lib: data-stack - fix incorrect pointer comparison in t_try_realloc in DEBUG
    builds When trying to work out if it's a valid realloc, we need to remember
    that in DEBUG builds, we have hidden a size value (in a MEM_ALIGNED space)
    before the pointer we return.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (50a0a88)

    lib: data-stack - fix realloc/lowwater bug If DEBUG is enabled, then it can
    try to look past the low-water mark as the low-water mark wasn't moved
    during successful reallocs. This condition is detected, and causes a panic.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (8aa1afd)

    lib: data-stack - t_try_realloc get alloc size right in DEBUG builds Also
    introduce a helper variable for the common expression for readability.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (395a730)

    lib: data-stack - helper for last alloc ends at block.data+(size-left) Less
    to read, and less noisy.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (f9bee08)

    lib: data-stack - add vital sanity-preserving assert to t_pop If something
    has re-ordered those two offsets, the following memset will explode.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (f0a98b3)

    lib: data-stack - pull common code out of if/else branches in t_malloc_real
    Once the new block is set up nicely empty for use, it can be used exactly
    like an old block that has enough space - so just merge the code paths.
    (This changeset best viewed ignoring whitespace.)

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (8dabb70)

    lib: data-stack - reorder full current block code Make the "enough space"
    and "block is full" branches in t_malloc_real have the same code structure
    for parallelism. The 'block' variable is only needed very locally, so shrink
    its scope, and avoid its use once it is assigned to current_block, use that
    instead. Compacter readable expressions have been favoured at the expense of
    longer lines (which will soon shrink).

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (e964357)

    lib: data-stack - helper macro for requested/allocated size Rather than
    #if/#else/#endif around such calculations, or even having the possibility to
    mistype such expressions, just extract the calculation into a helper macro
    defined appropriately for the DEBUG mode.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (d9d576a)

    lib: data-stack - disambiguate sizes in t_pop_verify In DEBUG mode, the
    allocated size is bigger than the requested size, so rename the variable to
    reflect its real meaning, and move it into a tighter scope in the process.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (992a172)

    lib: test-data-stack - too important a library not to be thrashed hard OK,
    it's thrashed a bit by other tests such as aqueue, str, etc., but these
    tests attempt to probe all corner cases given detailed knowledge of the
    limits of the block/frame implementation.

    At the moment, no realloc functionality is tested, as with DEBUG builds they
    would fail very noisily.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/Makefile.am
A	src/lib/test-data-stack.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (801d6aa)

    lib: data-stack - simplify expressions in data_stack_last_buffer_reset Noisy
    expression used more than once, give it a meaningful name.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (437d3c4)

    lib: data-stack - enable tighter sanity checks on stack_block allocations
    The canary doesn't have to be NULL. That's only effective if it will be read
    and dereferenced as a pointer. If used as an integer, it's a perfectly
    boring one, and not likely to draw attention to itself.

    Once the canary is in place, at least in debug mode, we can check it in 
    every function as a sanity check.

    Make our poison stand out from other poison used elsewhere in the code.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (5517afe)

    lib: cosmetic - whitespace cleanup in allocator/memory-related code
    Indentation used spaces. Some trailing whitespace found.

    $ git diff -w
    $

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c
M	src/lib/data-stack.h
M	src/lib/imem.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-system.c
M	src/lib/mempool.h

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (eb8d311)

    lib: add rudementary statistics gathering to data-stack debugging These
    currently just enhance the overly-large alloc_size warning message in
    t_malloc_real() to show what the history of allocations is. New warnings
    look like this:  Warning: Growing data stack by 32768 as 'test_run_funcs'
    reaches 16416 bytes from 202 allocations.

    Future possible directions: t_malloc_real() could be further modified to
    identify badly-behaved regions of code that allocate lots of smaller blocks
    as it happens
    (which might be noisy). t_pop() could be modified to detect such code after
    it exits its block (so just one warning per instance of misbehaviour).

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (053e605)

    lib: add markers to data-stack debug prints Only the DEBUG code will have
    access to the frame's marker.


M	src/lib/data-stack.c

2014-07-28 16:45:33 +0300 Phil Carmody <phil@dovecot.fi> (33b0119)

    lib: add identifying markers to data-stack frames Add a string parameter to
    t_push() so that in DEBUG mode, misbehaviour inside a stack level can be
    blamed on someone.

    Default the T_BEGIN macro to automatigally use __FUNCTION__ or
    __FILE__:__LINE__ as that identifier, therefore no clients of those macros
    need to change.

    ioloop used t_push() directly as it wanted customised diagnostic strings. To
    preserve this friendliness, also introduce a t_push_named() which takes a
    format string with paramters.

    Apart from the unused paramter, a non-DEBUG build should see no changes.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/data-stack.c
M	src/lib/data-stack.h
M	src/lib/ioloop.c

2014-07-28 16:40:25 +0300 Timo Sirainen <tss@iki.fi> (26f14cd)

    doveadm: Added dict commands to access lib-dict via command line. For
    debugging and data dumping purposes.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-dict.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h

2014-07-28 15:14:17 +0300 Timo Sirainen <tss@iki.fi> (625042f)

    lib-storage: Don't allow '/' for filesystem based mailbox list backends if
    their internal separator isn't '/'. Basically this means that Maildir++
    shouldn't be allowed to create mailboxes with '/' in the name.


M	src/lib-storage/mailbox-list.c

2014-07-25 14:10:04 +0300 Timo Sirainen <tss@iki.fi> (3008b30)

    last-login plugin added. It updates user's login timestamp to configured
    dict. Example config:

    plugin {
     last_login_dict = redis:host=127.0.0.1:port=6379
     #last_login_key = last-login/%u # default
    }

A	src/plugins/last-login/Makefile.am
A	src/plugins/last-login/last-login-plugin.c
A	src/plugins/last-login/last-login-plugin.h

2014-07-25 13:35:57 +0300 Timo Sirainen <tss@iki.fi> (330096f)

    lib-storage: Set mail_user->session_id before calling mail_user_init()


M	src/lib-storage/mail-storage-service.c

2014-07-21 11:00:59 +0300 Timo Sirainen <tss@iki.fi> (ee60381)

    lib-http: Fixed linking test programs.


M	src/lib-http/Makefile.am

2014-07-21 10:54:05 +0300 Stephan Bosch <stephan@rename-it.nl> (3fcb3d2)

    lib-http: Added initial support for server-side HTTP API.


M	TODO
M	src/lib-http/Makefile.am
A	src/lib-http/http-server-connection.c
A	src/lib-http/http-server-private.h
A	src/lib-http/http-server-request.c
A	src/lib-http/http-server-response.c
A	src/lib-http/http-server.c
A	src/lib-http/http-server.h

2014-07-21 10:53:19 +0300 Timo Sirainen <tss@iki.fi> (abdb482)

    rawlog: Added -i parameter to include the remote IP address in the filename.


M	src/util/rawlog.c

2014-07-11 16:49:35 +0300 Timo Sirainen <tss@iki.fi> (2222892)

    mailbox_list_index=yes: Don't update INBOX's STATUS information to index.
    This should reduce disk I/O


M	src/lib-storage/list/mailbox-list-index-status.c

2014-07-11 14:27:52 +0300 Timo Sirainen <tss@iki.fi> (3febd15)

    auth: If userdb prefetch is configured wrong, return temporary failure
    instead of "user not known"


M	src/auth/userdb-prefetch.c

2014-07-11 14:17:17 +0300 Timo Sirainen <tss@iki.fi> (31fa529)

    lib-http: Debug log now includes where HTTP requests spent their time on.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2014-07-11 12:10:02 +0300 Timo Sirainen <tss@iki.fi> (255c47a)

    lib: Added fd=-1 assert to i_close_fd() macro. This way we'll see clearly
    where it fails, instead of just seeing assert in close_keep_errno() without
    an easy way to see where it crashed.


M	src/lib/macros.h

2014-07-11 11:14:41 +0300 Timo Sirainen <tss@iki.fi> (9097014)

    lib: ioloop-epoll didn't correctly check if there were any IO events.
    Alternatively we could have checked for array_count(&ctx->events) >
    ctx->deleted_count, but this code is a bit more understandable.

    This change doesn't actually fix any proper bugs, it just causes the process 
    to crash instead of going to infinite wait loop.

M	src/lib/ioloop-epoll.c

2014-07-11 00:20:41 +0300 Timo Sirainen <tss@iki.fi> (301b152)

    lib: file_*_lock() with flock() timeouts should have returned errno=EAGAIN
    (Instead of EINTR.)


M	src/lib/file-lock.c

2014-07-10 18:31:10 +0300 Timo Sirainen <tss@iki.fi> (a192134)

    lmtp: Remove <> from Delivered-To: header. This annoyingly changes Dovecot
    behavior in the middle of v2.2.x series, but the earlier value was
    definitely wrong.. Perhaps we still need to provide a setting for this, but
    that's pretty annoying as well.


M	src/lmtp/commands.c

2014-07-10 18:17:44 +0300 Timo Sirainen <tss@iki.fi> (2290eca)

    lib: Compiler warning fixes for 32bit systems


M	src/lib/test-istream-tee.c

2014-07-10 15:59:53 +0300 Phil Carmody <phil@dovecot.fi> (755a39d)

    lib: test-istream-tee - randomise which tee stream lags behind the others
    Just in case there's something special about the start or the end of the
    list of children, make each file be the one that lags behind the others.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-istream-tee.c

2014-07-10 15:59:53 +0300 Phil Carmody <phil@dovecot.fi> (5e82118)

    lib: test-istream-tee - more randomisation to the tests Signed-off-by: Phil
    Carmody <phil@dovecot.fi>


M	src/lib/test-istream-tee.c

2014-07-10 15:59:53 +0300 Phil Carmody <phil@dovecot.fi> (0539ac5)

    lib: test-istream-tee - verify _read returns correct values after
    _set_size() Previously, only an increase of 1 in the size was tested. This
    ensures that 0 and numbers > 1 are also tested.

    Also add _idx to the asserts, so we know where in the loop it failed.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-istream-tee.c

2014-07-10 15:59:53 +0300 Phil Carmody <phil@dovecot.fi> (1d020f1)

    lib: test-istream-concat - add simultanious limit streams back into the mix
    Return to the previous complex nested stream-type case.

    1 time in 10, it tests the simple case of:

    test_stream \ test_stream -}- concat_stream test_stream /
    (2-11 of these)

    9 times in 10, it tests this configuration instead:

    test_stream \                  / limit_stream test_stream -}- concat_stream
    {- limit_stream test_stream /                  \ limit_stream
    (2-11 of these)                 (1-9 of these)

    Since 31efe2d04793 lib: istream-concat read() returned -2 too early., all
    tests pass every time.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-istream-concat.c

2014-07-10 15:59:53 +0300 Phil Carmody <phil@dovecot.fi> (a028ac7)

    lib: test-istream-concat - test only concat, not simultanious limit streams
    Test just concat functionality in this unit test. Simultanious access of
    limit streams can be tested elsewhere.

    Without the fix in:
     31efe2d04793 lib: istream-concat read() returned -2 too early. The failure
    previously seen in test-istream-concat would be still reproducable: 
    test-istream-concat.c:84: Assert failed: size >= TEST_MAX_BUFFER_SIZE 
    istream concat random ................................................ :
    FAILED test: random seed #1 was 1403118493

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-istream-concat.c

2014-07-10 15:40:08 +0300 Timo Sirainen <tss@iki.fi> (392538e)

    lib-fs: Added FS_PROPERTY_COPY_METADATA and fs_set_metadata() tracking.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2014-07-09 15:55:59 +0300 Timo Sirainen <tss@iki.fi> (02cc285)

    lib-fs: Added username and session_id to struct fs directly.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2014-07-09 15:24:21 +0300 Timo Sirainen <tss@iki.fi> (11538e7)

    lib-fs: Added fs_settings.username and .session_id


M	src/lib-fs/fs-api.h
M	src/lib-storage/mailbox-list.c

2014-07-09 15:20:59 +0300 Timo Sirainen <tss@iki.fi> (bff6061)

    lib-storage: Added struct mail_user.session_id


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.h

2014-07-09 10:55:27 +0300 Stephan Bosch <stephan@rename-it.nl> (abc8180)

    lib-http: Made sure that connections that are still connecting to the server
    aren't marked as idle.


M	src/lib-http/http-client-connection.c

2014-07-07 16:21:08 +0300 Timo Sirainen <tss@iki.fi> (082e827)

    lib-index: Don't update log_file_tail_offset unnecessarily. Update it only
    if we're already writing to transaction log anyway or if we're required to
    update the offset because mail_index_sync_commit() has increased it past
    non-external transactions (this is especially important with mdbox map
    index).


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.h
M	src/lib-index/test-mail-transaction-log-append.c

2014-07-07 13:24:22 +0300 Timo Sirainen <tss@iki.fi> (a09ff38)

    lib-storage: Minor code cleanup to istream-mail. eof=TRUE shouldn't be
    possible with ret=-2, so this just makes it clearer what the code's
    intention is.


M	src/lib-storage/index/istream-mail.c

2014-07-07 13:15:33 +0300 Timo Sirainen <tss@iki.fi> (66dc739)

    lib: i_stream_read_copy_from_parent() needs to update access counter also
    when returning -2 This finishes the 467a4d19f873 fix.


M	src/lib/istream.c

2014-07-06 19:08:59 +0300 Timo Sirainen <tss@iki.fi> (d979c11)

    virtual: Fixed assert-crashes where trying to open an already opened backend
    mailbox.


M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-storage.c

2014-07-04 15:33:12 +0300 Timo Sirainen <tss@iki.fi> (5033274)

    lib: istream-tee wasn't returning data correctly always. This fixes an
    assert-crash in istream-tee.c. (Hopefully it was always assert-crashing
    instead of returning corrupted data.)


M	src/lib/istream-tee.c

2014-07-04 14:48:44 +0300 Phil Carmody <phil@dovecot.fi> (e9baf40)

    lib: failures - cosmetic write_full cleanup Error message should have a
    trailing newline. Use the POSIX macro for stderr's file number, rather than
    its numeric value.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/failures.c

2014-07-04 14:18:25 +0300 Phil Carmody <phil@dovecot.fi> (f34e5fb)

    config: parser - trivial error message typo Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/config/config-parser.c

2014-07-04 14:17:54 +0300 Timo Sirainen <tss@iki.fi> (0c7087c)

    lmtp: Small code cleanup


M	src/lmtp/client.h
M	src/lmtp/commands.c

2014-07-04 14:16:16 +0300 Timo Sirainen <tss@iki.fi> (adde698)

    imap: If FETCH fails because mail has already been expunged, don't log an
    error.


M	src/imap/imap-fetch-body.c

2014-07-04 14:15:41 +0300 Timo Sirainen <tss@iki.fi> (eed20b2)

    lib-storage: Bodystructure parsing flags weren't updated correctly on error
    conditions. This fixes an assert-crash sometimes when mail parsing failed.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c

2014-07-04 14:14:21 +0300 Timo Sirainen <tss@iki.fi> (bc15c69)

    lib-storage: istream-mail updates mail->expunged if it notices ENOENT from
    parent stream.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/istream-mail.c

2014-07-04 14:01:53 +0300 Timo Sirainen <tss@iki.fi> (d052dcf)

    lib-storage: Log mail istream read failures in one place. Also handle ENOENT
    errors by checking if the mail has already been expunged, and if so don't
    log an error, just return "mail is already expunged" error to client.


M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2014-07-04 13:16:59 +0300 Timo Sirainen <tss@iki.fi> (b3f4c31)

    When creating istream-error, give an error string whenever possible.


M	src/lib-fs/fs-posix.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib/iostream-temp.c

2014-07-04 13:16:01 +0300 Timo Sirainen <tss@iki.fi> (3a06d97)

    lib-storage: If mail body reading failed, the error message may have
    contained only minimal errno string. Even though the istream could have had
    a much better internal error message. So show it.


M	src/lib-storage/index/index-mail.c

2014-07-04 11:48:27 +0300 Timo Sirainen <tss@iki.fi> (62ff600)

    lib-dict: Removed NFS flushing from dict-file backend.


M	src/lib-dict/dict-file.c

2014-07-03 22:24:05 +0300 Timo Sirainen <tss@iki.fi> (99e11ae)

    mbox: If GUID lookup fails because mbox_min_index_size skipped indexes, say
    so in error message.


M	src/lib-storage/index/mbox/mbox-storage.c

2014-07-03 22:17:49 +0300 Timo Sirainen <tss@iki.fi> (fa96f61)

    acl: Global ACLs now support "patterns with spaces inside quotes"


M	src/plugins/acl/acl-global-file.c

2014-07-03 22:16:48 +0300 Timo Sirainen <tss@iki.fi> (8d834fd)

    acl: Oops, ignore_acls check was reversed.


M	src/plugins/acl/acl-mailbox.c

2014-07-03 21:55:31 +0300 Timo Sirainen <tss@iki.fi> (b045cb4)

    lib-compression: Compression ostreams may have caused parent ostream to use
    too much memory.


M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-lzma.c
M	src/lib-compression/ostream-zlib.c

2014-07-03 21:54:52 +0300 Timo Sirainen <tss@iki.fi> (d691782)

    lib: Added o_stream_flush_parent_if_needed() for wrapper ostreams.


M	src/lib/ostream-private.h
M	src/lib/ostream.c

2014-07-03 20:42:08 +0300 Timo Sirainen <tss@iki.fi> (7d6d788)

    acl: Create struct acl_mailbox also for shared root namespace mailboxes.
    This fixes crashes where imap_acl code attempts to access ACLs for
    nonexistent mailboxes inside shared root namespace. Alternatively the
    imap_acl plugin could have checked the nonexistence of ACLs but this is
    probably easier and more guaranteed to work.


M	src/plugins/acl/acl-mailbox.c

2014-07-03 20:28:16 +0300 Timo Sirainen <tss@iki.fi> (c61164c)

    lmtp: Removed code that attempts to deduplicate mail files by copying them
    between user mailboxes. This sometimes started failing if the mail that was
    being used for copying was deleted by the user. There's no good way for lmtp
    code to fix that situation.

    If deduplication is needed, it could be implemented in a more generic way 
    inside mailbox_copy() where after initial copy it would store the 
    destination struct mail to src_mail->last_copy_dest_mail. If another mail is 
    copied, the last_copy_dest_mail could be attempted to be used for the 
    copying and if that doesn't work it would fallback to regular copying. This 
    should probably be attempted only for lda/lmtp processes as it would just 
    cause extra overhead for others.

M	src/lmtp/client.h
M	src/lmtp/commands.c

2014-07-03 19:34:57 +0300 Timo Sirainen <tss@iki.fi> (7103db8)

    Compile fix for old systems without SSL_OP_NO_COMPRESSION


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/login-common/ssl-proxy-openssl.c

2014-07-03 19:27:45 +0300 Timo Sirainen <tss@iki.fi> (761078b)

    fts-lucene: Delay initialization to fix assert-crash with mbox


M	src/plugins/fts-lucene/fts-backend-lucene.c

2014-07-03 19:17:16 +0300 Phil Carmody <phil@dovecot.fi> (9864489)

    openssl: optionally disable TLS compression Make ssl compression optional,
    but enabled by default. Other ssl options might be tweakable in the future,
    so have a single ssl_options string, and explode it into individual flags.
    (Compare postfix configuration.) Based on an idea by Andreas Schulze
    <sca@andreasschulze.de>

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl-settings.h
M	src/lib-master/master-service-ssl.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-ssl.h
M	src/login-common/ssl-proxy-openssl.c

2014-07-03 19:12:02 +0300 Timo Sirainen <tss@iki.fi> (14b5511)

    lib-storage: Added mail_namespace_is_shared_user_root() and used it where
    useful. Most importantly this should fix a crash in ACL plugin where
    type=shared namespace was used without any kind of per-user prefix/location
    (i.e. it probably should have been a type=public namespace instead).


M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h
M	src/plugins/acl/acl-mailbox.c

2014-07-03 19:10:33 +0300 Timo Sirainen <tss@iki.fi> (e66e79e)

    acl: Compile fix caused by previous change


M	src/plugins/acl/acl-shared-storage.c

2014-07-03 19:03:59 +0300 Timo Sirainen <tss@iki.fi> (1a5573e)

    lib-storage: Move "shared" storage name to mail-storage-private.h where it
    can be used.


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/index/shared/shared-storage.h
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-storage-private.h

2014-07-03 19:00:46 +0300 Timo Sirainen <tss@iki.fi> (5b8dcdc)

    lib-storage: Minor parsing fix to namespace types: Use strcmp() instead of
    strncmp().


M	src/lib-storage/mail-namespace.c

2014-07-03 17:44:32 +0300 Timo Sirainen <tss@iki.fi> (212e9e4)

    virtual: Never keep more than specified number of physical mailboxes open.
    This should make virtual mailboxes work for users who have a a ton of
    mailboxes with a ton of mails. Earlier code would likely have failed either
    with "Too many open files" or crashed with "Out of memory".

    You can change the max number of open mailboxes with:

    plugin {
     virtual_max_open_mailboxes = 64
    }

    The default is 64.

M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c

2014-07-03 17:40:37 +0300 Timo Sirainen <tss@iki.fi> (0bd15af)

    lib-index: Fixed error handling in mail_index_open()


M	src/lib-index/mail-index.c

2014-07-03 17:29:58 +0300 Timo Sirainen <tss@iki.fi> (0cfdf8b)

    lib-index: Index cache could have kept too many indexes open. If a lot of
    indexes were allocated and then later on they were opened and closed, the
    alloc-cache simply kept all the indexes open even after they should have
    been closed.


M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-alloc-cache.h
M	src/lib-index/mail-index.c

2014-07-03 16:07:09 +0300 Timo Sirainen <tss@iki.fi> (1139a1f)

    lib: DLLIST*_REMOVE*() no longer breaks the linked list if we try to remove
    item that doesn't exist there. Hopefully there wasn't any code that actually
    did this, but it's safer this way anyway. Perhaps it could be even made to
    assert-crash if it happens.


M	src/lib/llist.h
M	src/lib/test-llist.c

2014-07-03 15:26:32 +0300 Timo Sirainen <tss@iki.fi> (7ebb549)

    lib-storage: mailbox_get_metadata() now opens the mailbox only if it's
    necessary.


M	src/lib-storage/index/index-status.c

2014-07-03 14:54:43 +0300 Timo Sirainen <tss@iki.fi> (15b5076)

    virtual: Recent flags dropping wasn't working as intended. In the old code
    '+' meant that \Recent flags were dropped also when the virtual mailbox was
    EXAMINEd. SELECTing a mailbox always dropped \Recent flags regardless of the
    '+' flag.

    What should have happened (and does in new code) is that the \Recent flags 
    are dropped only on SELECT and only if '+' flag is set.

M	src/plugins/virtual/virtual-storage.c

2014-07-03 14:37:08 +0300 Timo Sirainen <tss@iki.fi> (9afa8af)

    fts: If we detect corrupted fts expunge log, unlink it. This avoids the same
    error repeating forever.


M	src/plugins/fts/fts-expunge-log.c

2014-07-03 12:44:50 +0300 Phil Carmody <phil@dovecot.fi> (289ce12)

    lib-imap: test-imap-url - cosmetic whitespace cleanup Only whitespace
    changes. All trailing space removed, reindented:  $ grep '[[:space:]]$'
    src/lib-imap/test-imap-url.c  $ git diff -w  $

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/test-imap-url.c

2014-07-03 12:42:11 +0300 Phil Carmody <phil@dovecot.fi> (e87b254)

    lib-imap: test-imap-url - quieten successful sub-tests Every sub-component
    of a URL doesn't need its own successful log, so use the only-print-on-error
    test_out_quiet() function instead. All failures are just as explicit as
    before.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/test-imap-url.c

2014-07-03 12:42:11 +0300 Phil Carmody <phil@dovecot.fi> (00a34f8)

    lib-test: test-common - add test_out_quiet() to reduce verbosity Like
    test_out() but only prints anything if success is false. This makes it quite
    much like test_assert(), except that it doesn't print the code fragment, it
    prints a custom string. However, it still counts as a test in the total
    count, unlike test_assert*()s.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2014-07-03 12:42:11 +0300 Phil Carmody <phil@dovecot.fi> (5363079)

    lib-imap: test_imap_url didn't compare port numbers It only compare them
    when they were unset, and defaulting both to 0.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/test-imap-url.c

2014-07-03 11:37:07 +0300 Timo Sirainen <tss@iki.fi> (1774ab4)

    quota: Quota count tracking still was still incorrect in over-quota
    conditions.


M	src/plugins/quota/quota-util.c
M	src/plugins/quota/test-quota-util.c

2014-07-02 23:41:10 +0300 Timo Sirainen <tss@iki.fi> (00cc12d)

    lib-index: Recent idx->seq change in strmap forgot to initialize
    uid_lookup_seq in one place.


M	src/lib-index/mail-index-strmap.c

2014-07-02 20:53:46 +0300 Timo Sirainen <tss@iki.fi> (c35e049)

    test-quota-util: Link to quota-util.lo instead of .o Hopefully fixes
    dependency tracking to work correctly?


M	src/plugins/quota/Makefile.am

2014-07-02 20:36:49 +0300 Timo Sirainen <tss@iki.fi> (de02255)

    quota: Fixed quota_transaction_is_over() to handle "user is already over
    quota" case. If size=0 we didn't return failure. This change also fixes
    various potential integer overflows in the check. Added unit test for the
    function.


M	src/plugins/quota/Makefile.am
M	src/plugins/quota/quota-util.c
A	src/plugins/quota/test-quota-util.c

2014-07-02 20:34:43 +0300 Timo Sirainen <tss@iki.fi> (b863b7e)

    quota: Moved some functions to quota-util.c


M	src/plugins/quota/Makefile.am
M	src/plugins/quota/quota-private.h
A	src/plugins/quota/quota-util.c
M	src/plugins/quota/quota.c

2014-07-02 20:13:35 +0300 Timo Sirainen <tss@iki.fi> (cbc01fc)

    lib: Added UINT64_SUM_OVERFLOWS() Maybe the unit tests are kind of
    unnecessary since the macro is so simple, but at least it's now a well
    tested simple macro :)


M	src/lib/bits.h
M	src/lib/test-bits.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (8ce2019)

    pop3: pop3-commands - harden integer parsers against integer overflow In
    get_msgnum(), the invalid input "4772185884" (2^32*10/9) would be parsed as
    being valid.

    In get_size(), the invalid input "204963823041217240178" (2^64*10/9) would
    be parsed as being valid.

    We have helpers now, so use them.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/pop3/pop3-commands.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (7943dd0)

    lib: strnum - add permissive str_parse_uint() helper Signed-off-by: Phil
    Carmody <phil@dovecot.fi>


M	src/lib/strnum.c
M	src/lib/strnum.h

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (0e70271)

    lib: uri-util - hardern uri_parse_dec_octet() against overflow Invalid input
    284 (2^8*10/9) is incorrectly parsed as valid. 28 * 10 + 4 = 284 == 28 (mod
    2^8), so the wrap detection fails.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/uri-util.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (bf3dbfd)

    lib-http: test-http-url - add some tricky invalid numeric hostname URLs Try
    to get the numeric octet parser to fail. The RFCs specify that we should
    fall back onto parsing them as domain names instead, and hence the
    unexpected legitimacy of out-of-range numbers.

    NOTE: This causes make check to report the following error: http url valid
    [11]: http_url_parse(http://127.0.0.284/this/also/reverts/to/DNS)  : ok 
    test-http-url.c:328: Assert failed: urlp->have_host_ip == urlt->have_host_ip 
    http url valid [11] .................................................. :
    FAILED

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-http/test-http-url.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (601eea4)

    lib: uri-util - harden uri_parse_port against overflow The invalid input
    72817 (2^16*10/9) is parsed as a valid value. 7281 * 10 + 7 = 72817 == 7281
    (mod 2^16), so the prev check fails.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/uri-util.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (ffb2949)

    lib-http: test-http-url - make port number test cases harder Exploit common
    parser weakeneses - out by one, and overflow detection failure.

    NOTE: causes make check to fail with the following error: http url invalid
    [13]: parse http://example.com:72817/index.html ..... : FAILED http url
    invalid [13] ................................................ : FAILED

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-http/test-http-url.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (94e6665)

    imap: harden read_uoff_t() against overflow Invalid strings like
    "20496382304121724029" (2^64*10/9) can be parsed as valid. Use the new
    helper.

    Change in error behaviour - previously overflows, if they were detected, 
    caused *p to point to the digit causing the overflow. Now it's undefined. 
    Current clients don't care about this difference, they just bail.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/imap/imap-fetch-body.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (dbebc3b)

    lib: strnum - add a permissive uoff_t parser Functions like these are so
    cookie-cutter, we may as well use a macro. Note that signed helpers, if they
    ever appear, will need more care.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/strnum.c
M	src/lib/strnum.h

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (47ca7a8)

    lib: test-strnum - tests for the new partial-string parser We can simplify
    the main tests by always testing whether an appended non-digit causes
    parsing to fail at the same time that we test it doesn't fail with the new
    more permissive helpers.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-strnum.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (0d73aae)

    lib: strnum - add permissive partial-string integer parser Not all strings
    we want to parse are already strtok'ed into separate pieces. Therefore add
    helpers which will read the integer, and return a pointer past the parsed
    integer.

    The previous helpers can be considered a special case which just follows up 
    with a check that the '\0' has been reached.

    Showing a preference for const pointers generally, this does not try to 
    mimic the non-const interface of strto{l,ul,ll,ull}().

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/strnum.c
M	src/lib/strnum.h

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (662b2a7)

    lib-imap: number parsing simplification and hardenning The invalid string
    "4772185884" (2^32*10/9) will be misparsed as being valid. In uint32_t's,
    477218588 * 10 + 4 = 477218588 Many large ranges have this issue,
    477218588x-858993459x, 954437176x-...

    We have helper functions - use them.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/imap-url.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (bfdca13)

    lib: strnum - harden str_to_uintmax against overflows The invalid number
    "20496382304121724020" (2^64*10/9) will be parsed as valid.
    2049638230412172402 * 10 does not noticably wrap, it becomes
    2049638230412172404

    Do not perform operations which might wrap, and then try to detect the
    issue, just compare with the known fixed bounds before doing the
    multiplication.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/strnum.c

2014-07-02 18:21:24 +0300 Phil Carmody <phil@dovecot.fi> (42826d9)

    lib: test-lib - add unit tests for str_to_*() helpers This doesn't test all
    the helpers, but ensures both signed and unsigned are tested, as are 32-bit
    and 64-bit cases. All the other helpers fall back onto using one of those
    cases. Unless uintmax_t is larger than 64 bits, in which case this needs a
    revisit.

    NOTE: This causes the following make check errors: test-strnum.c:35:
    Assert(#7) failed: ret == u64tests[i].ret test-strnum.c:35: Assert(#10)
    failed: ret == u64tests[i].ret test-strnum.c:37: Assert(#10) failed: val ==
    u64tests[i].val str_to_uint64
    ........................................................ : FAILED

    Corresponding to test cases:
    [7] = INVALID(18446744073709551616), This does not wrap-past-0 (become
    smaller) on multiply, but wraps-past-0 on addition.
    [10]= INVALID(20496382304121724020), This wraps-past-n (becomes larger) on
    multiply.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/Makefile.am
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-strnum.c

2014-07-02 18:21:23 +0300 Phil Carmody <phil@dovecot.fi> (552a9b0)

    lib: test-var-expand - use test_assert_idx() inside loops It helps narrow
    down which test has failed.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-var-expand.c

2014-07-02 00:10:16 +0300 Stephan Bosch <stephan@rename-it.nl> (6ee9ce5)

    lib-http: Updated comments to RFC7230/RFC7231.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-date.c
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-parser.c
M	src/lib-http/http-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-url.c

2014-07-01 23:24:08 +0300 Stephan Bosch <stephan@rename-it.nl> (aefccdd)

    lib-http: Fixed bug in parsing of quoted string with escape sequences.


M	src/lib-http/http-parser.c

2014-07-01 16:04:20 +0300 Timo Sirainen <tss@iki.fi> (e3734a6)

    doveadm fs delete: Added -n to usage text.


M	src/doveadm/doveadm-fs.c

2014-07-01 00:10:21 +0300 Timo Sirainen <tss@iki.fi> (b2a3fbf)

    lib-http: Added http_client_request_get_target() This can be useful in error
    message logging without having to duplicate the string.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2014-06-30 17:25:02 +0300 Timo Sirainen <tss@iki.fi> (c6e0d6a)

    fts-tika: Hiden "Unsupported Media Type" errors. Log HTTP status code on
    errors.


M	src/plugins/fts/fts-parser-tika.c

2014-06-30 16:41:32 +0300 Timo Sirainen <tss@iki.fi> (a666438)

    fts-tika: Fixed crash if Tika returned 200 reply without payload.


M	src/plugins/fts/fts-parser-tika.c

2014-06-30 14:35:32 +0300 Timo Sirainen <tss@iki.fi> (62dbc0f)

    lib-storage: Shrink "mailbox is being deleted" timeout from 5 mins to 30
    secs. Even 30s may be too much since normally a few seconds would be enough,
    but keep it high enough just in case.


M	src/lib-storage/mail-storage.c

2014-06-30 14:34:00 +0300 Timo Sirainen <tss@iki.fi> (b67f674)

    lib-storage: When deleting mailbox, finish the expunges before marking
    mailbox deleted. This decreases the amount of time the mailbox is visible
    but not accessible.


M	src/lib-storage/index/index-storage.c

2014-06-30 14:31:47 +0300 Timo Sirainen <tss@iki.fi> (a3de33a)

    lib-storage: mailbox_delete() now handled "mailbox is being deleted"
    explicitly. Earlier we just treated it as \NoSelect mailbox and failed
    later.


M	src/lib-storage/mail-storage.c

2014-06-30 14:30:43 +0300 Timo Sirainen <tss@iki.fi> (fae21eb)

    lib-storage: Added index_storage_mailbox_delete_pre/post(). This avoids
    reimplementing the whole index_storage_mailbox_delete() for storage backends
    that need to do more work in the middle.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h

2014-06-30 14:29:26 +0300 Timo Sirainen <tss@iki.fi> (e63b559)

    imap: If we disconnect client because mailbox is inconsistent, send the
    error message before BYE.


M	src/imap/imap-commands-util.c

2014-06-30 14:28:31 +0300 Timo Sirainen <tss@iki.fi> (4e1f733)

    imap: Don't disconnect due to inconsistent mailbox unless the mailbox is the
    selected mailbox.


M	src/imap/imap-commands-util.c

2014-06-27 17:39:52 +0300 Stephan Bosch <stephan@rename-it.nl> (62aa683)

    imap-url: Fixed handling of ipath-empty syntax (basically empty relative
    URLs). This also normalizes Mailbox/ to Mailbox. Initial indication reported
    by Coverity.


M	src/lib-imap/imap-url.c
M	src/lib-imap/test-imap-url.c
M	src/lib/uri-util.c

2014-06-27 17:37:56 +0300 Timo Sirainen <tss@iki.fi> (8bb7d85)

    auth: Added assert to make sure sysconf() returns what we expect. userdb nss
    shouldn't even be used though. So this is mainly to silence Coverity.


M	src/auth/userdb-nss.c

2014-06-27 16:29:18 +0300 Timo Sirainen <tss@iki.fi> (a095363)

    lib: istream-concat read() returned -2 too early.


M	src/lib/istream-concat.c

2014-06-27 16:20:25 +0300 Phil Carmody <phil@dovecot.fi> (fc7474a)

    lib: rand - force reseeding with known seed from environment Use
    DOVECOT_SRAND=12345 as an environmental variable to force seeding to that
    number.

    The logic behind the logging is that the subsequent calls will almost 
    certainly be from random_fill_weak() which expects to have been seeded from
    a CSPRNG - not a constant! Having this environmental variable set in a
    production system that expects CSPRNG seeding should be flagging 
    diagnostics.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/rand.c

2014-06-27 16:17:50 +0300 Phil Carmody <phil@dovecot.fi> (dd8a856)

    lib: remove unwanted srand()s from unit tests We'll get better coverage
    without them.

    Note: this change causes the following test case failure occasionally: 
    test-istream-concat.c:88: Assert failed: size >= TEST_MAX_BUFFER_SIZE 
    istream concat random ................................................ :
    FAILED test: random seed #1 was 1403027537

    (The seed may vary, obviously.)

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-buffer.c
M	src/lib/test-istream-concat.c

2014-06-27 16:17:07 +0300 Phil Carmody <phil@dovecot.fi> (a2818f9)

    lib-test: use the new srand() tracking helpers to aid debugging We can only
    be sure we know the entirity of the stream of numbers returned by rand if
    rand_set_seed has been called precisely once, as after that we can't be sure
    when it was called a 2nd or further time. However, at least we can know that
    that has happened. (Likewise, any calls to srand() will disturb the flow.)

    Most unit test cases should be simple enough that there should be only one 
    seeding.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c

2014-06-27 16:16:16 +0300 Phil Carmody <phil@dovecot.fi> (02da7bc)

    lib: use new srand() wrapper in lib Of course, multiple seeding calls make
    it harder to know exactly what numbers have been generated. But this is
    better than nothing.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/lib.c
M	src/lib/randgen.c

2014-06-27 16:15:24 +0300 Phil Carmody <phil@dovecot.fi> (1b139ee)

    lib: add rand helper library Initially, just wrap srand() so that we can
    find out what the last-used seed was. In situations where srand() is called
    only once (via this helper) this lets us reproduce exactly the same stream
    of random data again in order to reproduce rare crashes.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/Makefile.am
M	src/lib/lib.h
A	src/lib/rand.c
A	src/lib/rand.h

2014-06-27 16:13:37 +0300 Phil Carmody <phil@dovecot.fi> (5a3ed55)

    lib: two quite literally random little cleanups file-dotlock.c does not use
    randgen.h, remove the #include test-buffer.c random() has been used rather
    than rand()

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/file-dotlock.c
M	src/lib/test-buffer.c

2014-06-27 16:13:09 +0300 Phil Carmody <phil@dovecot.fi> (1dcf22e)

    lib: make printf_format_fix safer against shadowed %m behaviour If there's a
    %m followed by a %n or %m, then the %n or %m won't be seen. For %m, that's
    mostly harmless, but for %n it's potentially kaboom.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/printf-format-fix.c

2014-06-27 16:12:40 +0300 Phil Carmody <phil@dovecot.fi> (1d940af)

    lib: test printf_format_fix() Signed-off-by: Phil Carmody <phil@dovecot.fi>


M	src/lib/Makefile.am
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-printf-format-fix.c

2014-06-27 16:11:40 +0300 Phil Carmody <phil@dovecot.fi> (95be1d8)

    lib: test-istream-concat - early abort test loop on failure No point in
    continuing past the first failure.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-istream-concat.c

2014-06-27 16:10:27 +0300 Phil Carmody <phil@dovecot.fi> (dad57bb)

    lib-test: Enable looped tests to abort early on first failure Give them the
    ability to query the current failure state.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2014-06-27 14:23:46 +0300 Timo Sirainen <tss@iki.fi> (75e2c45)

    lmtp: Reduce corking so we get command replies more quickly even if they are
    pipelined. This may help avoid some LMTP client timeouts.


M	src/lmtp/client.c
M	src/lmtp/commands.c

2014-06-27 14:06:56 +0300 Timo Sirainen <tss@iki.fi> (39cfd16)

    lmtp proxy: Make sure DATA stream size doesn't change unexpectedly.


M	src/lmtp/lmtp-proxy.c

2014-06-27 14:06:08 +0300 Timo Sirainen <tss@iki.fi> (9320cc2)

    lib-lda: If DATA input stream read fails, return error instead of truncating
    the mail.


M	src/lib-lda/lmtp-client.c

2014-06-26 20:48:13 +0300 Timo Sirainen <tss@iki.fi> (f8e6e85)

    lib: Moved rawlog dir stat()s to iostream_rawlog_create() internally. This
    is required to allow TCP rawlogs to actually work.


M	src/lib-http/http-client-connection.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib/iostream-rawlog.c

2014-06-26 20:46:21 +0300 Timo Sirainen <tss@iki.fi> (f9b6b5e)

    lib: iostream-rawlog now supports TCP target with "tcp:host:port" as the
    path. We'll use blocking sockets, so a slow rawlog server causes performance
    problems also for Dovecot while it's waiting on rawlog writes.


M	src/lib/iostream-rawlog.c

2014-06-26 17:50:57 +0300 Timo Sirainen <tss@iki.fi> (463d6c3)

    lib-storage: BODYSTRUCTURE parsing failures weren't treated correctly. We
    still assumed that the parsing succeeded and assert-crashed later or maybe
    returned invalid results. (This could have happened only if there was a
    problem reading the mail stream.)


M	src/lib-storage/index/index-mail.c

2014-06-26 17:27:31 +0300 Timo Sirainen <tss@iki.fi> (faca9429)

    dsync: Fixed infinite looping on error condition.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-06-26 17:27:22 +0300 Timo Sirainen <tss@iki.fi> (bcc25e5)

    dbox: mail_get_special() may have returned MAIL_FETCH_POP3_ORDER allocated
    from data stack. Although this seems to have worked for now, it shouldn't
    have been done.


M	src/lib-storage/index/dbox-common/dbox-mail.c

2014-06-25 16:16:02 +0300 Timo Sirainen <tss@iki.fi> (89221f7)

    lib-test: Fixed "Trying to allocate 0 bytes" assert-crash caused by recent
    test-istream changes.


M	src/lib-test/test-common.c

2014-06-20 12:18:32 +0300 Timo Sirainen <tss@iki.fi> (87ddb4d)

    lib: fd_recv() no longer checks for msghdr.msg_controllen It doesn't work at
    least in OpenBSD and Tru64, and apparently it shouldn't really be needed
    anyway, so don't bother with it. We'll still keep checking the cmsghdr since
    that appears to work everywhere now.


M	src/lib/fdpass.c

2014-06-19 17:16:24 +0300 Timo Sirainen <tss@iki.fi> (11f743d)

    mbox: istream-tee wasn't being used as expected with the new changes,
    causing crashes/hangs. After wondering about this for a while I decided this
    was the only fully reliable way of doing this. Although it would have been
    possible to change the istream-tee code to support this:

    child1 and child2 are tee-istream children:
    - i_stream_read(child1)
    - i_stream_read(child2)
    - i_stream_get_data(child1)

    Because reading from the parent istream-tee updates all of its childrens' 
    buffer, there's no big problem (other than access_counter currently messing 
    up). But if one of the children weren't a direct child of tee-istream, but 
    there was a wrapper istream, the wrapper's buffer wouldn't have been updated 
    by the istream-tee read. So rather than spending time figuring out to fix 
    the access_counter it's probably better to have it clearly fail as the use 
    case can't be fully safe anyway.

M	src/lib-storage/index/mbox/mbox-save.c

2014-06-19 15:50:40 +0300 Timo Sirainen <tss@iki.fi> (a07bc60)

    lmtp: Create all proxy DATA streams before reading from them. I'm not sure
    if this actually fixes anything or not, but it's still safer to do it this
    way.


M	src/lmtp/lmtp-proxy.c

2014-06-19 15:15:24 +0300 Timo Sirainen <tss@iki.fi> (c6b6ac7)

    lib: i_stream_read_copy_from_parent() now directly updates the access
    counter This fixes a bug in istream-mail where it called i_stream_get_data()
    after it and reset the stream's skip/pos.


M	src/lib/istream.c

2014-06-19 14:58:26 +0300 Timo Sirainen <tss@iki.fi> (4106a25)

    lib: i_stream_get_data() should also reset eof=FALSE if it truncates the
    output.


M	src/lib/istream.c
M	src/lib/istream.h

2014-06-19 14:34:54 +0300 Timo Sirainen <tss@iki.fi> (5dcdc15)

    lib-mail: Fixed istream-dot unit test to work with the istream-test changes.


M	src/lib-mail/test-istream-dot.c

2014-06-19 14:02:56 +0300 Timo Sirainen <tss@iki.fi> (aaa5d94)

    Compiler warning fix


M	src/lib/istream.c

2014-06-19 13:52:36 +0300 Timo Sirainen <tss@iki.fi> (f5982bb)

    lib: If two istreams share one parent, i_stream_get_data() may have returned
    corrupted data to another. This happened only for istreams that used
    parent's buffer directly instead of having their own buffer. For now at
    least we've solved this by truncating the other stream's buffer so it needs
    to be read again. Hopefully this is good enough.

    Added also unit test to check this functionality.

M	src/lib/Makefile.am
M	src/lib/istream.c
A	src/lib/test-istream.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-06-19 12:38:11 +0300 Timo Sirainen <tss@iki.fi> (ce8daf8)

    lib-test: Improved test-istream to catch more bugs


M	src/lib-test/test-common.c

2014-06-19 12:32:45 +0300 Timo Sirainen <tss@iki.fi> (0983196)

    lib: Fixed read buffer overflow in istream-base64-decoder error handling


M	src/lib/istream-base64-decoder.c

2014-06-19 12:31:55 +0300 Timo Sirainen <tss@iki.fi> (b1b8ac3)

    lib: Fixed potential read buffer overflow in JSON parser.


M	src/lib/json-parser.c

2014-06-16 19:52:11 +0300 Timo Sirainen <tss@iki.fi> (c51644e)

    login proxy: Added login_source_ips setting. The setting contains a list of
    IPs/hosts. The setting may be prefixed with "?" character to indicate that
    only those IPs should be used that exist in the current server (allowing the
    same config to be shared by multiple servers).

    The IPs are used round robin as the source IP address when proxy creates TCP 
    connections. This becomes useful when there are a ton of connections from 
    the proxy to the same destination IP, because TCP ports run out after ~64k 
    connections.

M	src/login-common/client-common-auth.c
M	src/login-common/login-common.h
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h
M	src/login-common/main.c

2014-06-16 19:21:36 +0300 Timo Sirainen <tss@iki.fi> (d694a52)

    login proxy: If passdb returns "source_ip" extra field, use it for outgoing
    connections.


M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h
M	src/login-common/login-proxy.c
M	src/login-common/login-proxy.h

2014-06-16 18:01:58 +0300 Timo Sirainen <tss@iki.fi> (1765460)

    lib: Use __attribute__((returns_nonnull)) for the common memory/string
    functions. Also added a couple of missing ATTR_MALLOCs.


M	src/lib/data-stack.h
M	src/lib/imem.h
M	src/lib/macros.h
M	src/lib/mempool.h
M	src/lib/strfuncs.h

2014-06-16 17:40:51 +0300 Timo Sirainen <tss@iki.fi> (3b36468)

    lib: Changed mempool.h to use inline functions instead of macros. This way
    we can also mark p_malloc() with ATTR_MALLOC.


M	src/lib/mempool.h

2014-06-16 16:27:12 +0300 Timo Sirainen <tss@iki.fi> (ffcf7f9)

    doveadm who: Don't crash if server happens to send broken input (second
    try). Found by Coverity


M	src/doveadm/doveadm-who.c

2014-06-16 16:26:09 +0300 Timo Sirainen <tss@iki.fi> (fcb584b)

    doveadm dump: Avoid crashes with corrupted log files


M	src/doveadm/doveadm-dump-log.c

2014-06-16 15:47:12 +0300 Timo Sirainen <tss@iki.fi> (bb33d47)

    doveadm dump log: Fixed potential crash when log header size was corrupted.


M	src/doveadm/doveadm-dump-log.c

2014-06-16 15:42:39 +0300 Timo Sirainen <tss@iki.fi> (b36b8c9)

    Added (void) prefix for ignoring return values we don't care about.
    Hopefully this quiets down Coverity warnings also of them?


M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/login-common/ssl-proxy-openssl.c

2014-06-16 15:41:52 +0300 Timo Sirainen <tss@iki.fi> (cee99a1)

    Check for syscall errors that are quite unlikely to happen. Flagged by
    Coverity.


M	src/doveadm/doveadm-dump-log.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/master/main.c
M	src/util/maildirlock.c

2014-06-16 15:35:07 +0300 Timo Sirainen <tss@iki.fi> (de1ba3e)

    xml2text: Check for read()/write() failures and exit if they fail.


M	src/plugins/fts/xml2text.c

2014-06-16 13:12:40 +0300 Timo Sirainen <tss@iki.fi> (d579412)

    lmtp: Proxying now logs successful and failed deliveries after DATA.


M	src/lmtp/lmtp-proxy.c

2014-06-16 13:03:31 +0300 Timo Sirainen <tss@iki.fi> (5b946df)

    lmtp: Removed some unnecessary code


M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-proxy.h

2014-06-15 11:03:32 +0300 Timo Sirainen <tss@iki.fi> (b43bbd3)

    auth: Fixed wrong assert added by recent commit.


M	src/auth/auth-request.c

2014-06-14 11:58:57 +0300 Phil Carmody <phil@dovecot.fi> (c1dbcb6)

    trivial variable-non-use fixes Flagged by coverity. In one, as we're
    printing an error message, we can actually put the string to use, which
    might aid debugging. In the other, the variable can just be killed.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-storage/list/mailbox-list-subscriptions.c

2014-06-13 16:12:27 +0300 Phil Carmody <phil@dovecot.fi> (6e4f745)

    fts-lucene: Fix SnowballAnalyzer constructors Coverity found the
    uninitialised pointers in the latter constructor (which is never used - kill
    it?). In comparing the other constructor, the lack of strdup() jumped out at
    me.

    In fixing them both I migrated them to actual C++ initialisers, rather than 
    dumb assignments to uninitialised members. Also migrated to dovecot's i_* 
    functions. Also fixed indentation for the 3 functions touched.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/plugins/fts-lucene/Snowball.cc

2014-06-13 15:14:44 +0300 Timo Sirainen <tss@iki.fi> (fd05c47)

    Added several asserts to make sure duplicates aren't inserted into hash
    table. The previous commit hopefully fixed the problem causing auth and
    login processes to sometimes die with "key not found from hash" error, but
    if not maybe one of these will catch it.


M	src/lib-auth/auth-server-connection.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login-auth.c
M	src/lib-settings/settings-parser.c
M	src/login-common/ssl-proxy-openssl.c

2014-06-13 15:13:26 +0300 Timo Sirainen <tss@iki.fi> (788a914)

    lib-master: Fixed caching settings where both local_name and local_ip was
    specified. Since cache_find() didn't use local_ip for a lookup when
    local_name existed, cache_add() shouldn't add both of them either, otherwise
    it could be inserting duplicate values to the cache hash and cause crashes.


M	src/lib-master/master-service-settings-cache.c

2014-06-13 11:35:40 +0300 Timo Sirainen <tss@iki.fi> (f6d7988)

    Make sure we don't shift signed integers left by 24. They should be
    unsigned.


M	src/lib-index/mailbox-log.c
M	src/lib/hmac-cram-md5.c

2014-06-13 11:21:07 +0300 Timo Sirainen <tss@iki.fi> (54c4c55)

    dbox: Fixed potential infinite looping when scanning a broken dbox file.


M	src/lib-storage/index/dbox-common/dbox-file-fix.c

2014-06-13 10:25:22 +0300 Timo Sirainen <tss@iki.fi> (d65adb9)

    auth: Fixed handling userdb_userdb_import passdb extra field. Looks like
    some hg merging went wrong. Found by Coverity


M	src/auth/auth-request.c

2014-06-13 10:22:49 +0300 Timo Sirainen <tss@iki.fi> (59bc0bc)

    lib-http: Removed unnecessary for loop. Found by Coverity


M	src/lib-http/http-transfer-chunked.c

2014-06-13 03:09:26 +0300 Timo Sirainen <tss@iki.fi> (a59b103)

    dbox: Added asserts to dbox file fixing to make sure it doesn't go to
    infinite loop. There apparently is a bug in here that will trigger this
    assert.


M	src/lib-storage/index/dbox-common/dbox-file-fix.c

2014-06-13 02:54:21 +0300 Timo Sirainen <tss@iki.fi> (5952b84)

    imap, pop3: Remove the client from clients-list at the very end of the
    destroy function. Especially with imap code the process title could have
    been refreshed too early.


M	src/imap/imap-client.c
M	src/pop3/pop3-client.c

2014-06-13 02:34:19 +0300 Timo Sirainen <tss@iki.fi> (0abbd16)

    Compiler warning fix


M	src/lib/ioloop-notify-inotify.c

2014-06-13 02:19:15 +0300 Timo Sirainen <tss@iki.fi> (bace943)

    Use the new [io]_stream_create_fd_*autoclose() functions wherever possible.


M	src/auth/mech-winbind.c
M	src/auth/userdb-passwd-file.c
M	src/config/config-parser.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-replicator.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/lib-compression/test-compression.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-lda/smtp-client.c
M	src/lib-master/master-instance.c
M	src/lib-master/mountpoint-list.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/list/subscription-file.c
M	src/lib/iostream-temp.c
M	src/lib/istream-seekable.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/zlib/zlib-plugin.c
M	src/replication/replicator/replicator-queue.c
M	src/ssl-params/main.c
M	src/util/rawlog.c

2014-06-13 02:18:53 +0300 Timo Sirainen <tss@iki.fi> (43834f8)

    lib: Added [io]_stream_create_fd_*autoclose() These make it clearer that the
    fd parameter will be closed automatically when the stream is closed.

    Eventually (in v2.3) we'll want to get rid of the autoclose boolean 
    parameter in [io]_stream_create_fd().

M	src/lib/istream-file.c
M	src/lib/istream.h
M	src/lib/ostream-file.c
M	src/lib/ostream.h

2014-06-13 02:04:12 +0300 Timo Sirainen <tss@iki.fi> (bd16363)

    doveadm stats top: Fixed double-close()ing stats connection


M	src/doveadm/doveadm-stats.c

2014-06-13 02:01:55 +0300 Timo Sirainen <tss@iki.fi> (fb2fb0e)

    director-test: Fixed double-close() on admin connection deinit


M	src/director/director-test.c

2014-06-13 01:57:04 +0300 Timo Sirainen <tss@iki.fi> (48325ad)

    Added various asserts to try to silence Coverity false positives.


M	src/auth/auth-request.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-settings/settings.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib/connection.c
M	src/lib/ioloop-notify-inotify.c
M	src/master/main.c

2014-06-13 01:52:13 +0300 Timo Sirainen <tss@iki.fi> (86b2982)

    lib-mail: message_parser_parse_next_block() now fully clears block_r to be
    safe case. I'm not away of this hitting any bugs, but better to be safe.


M	src/lib-mail/message-parser.c

2014-06-13 01:35:13 +0300 Timo Sirainen <tss@iki.fi> (b383c91)

    Added "fall through" comments to switch statements where break is
    intentionally missing. This should make Coverity quiet about these..


M	src/doveadm/doveadm-dump-index.c
M	src/lib-http/http-request-parser.c
M	src/lib/iso8601-date.c

2014-06-13 01:30:14 +0300 Timo Sirainen <tss@iki.fi> (f8c53b7)

    lib-storage: Fixed parsing corrupted mailbox list index header. Duplicate
    IDs should have caused an error instead of being silently ignored. Found by
    Coverity


M	src/lib-storage/list/mailbox-list-index.c

2014-06-13 01:26:14 +0300 Timo Sirainen <tss@iki.fi> (2d72e84)

    imap-urlauth: Fatal failure error handling wasn't done correctly. Found by
    Coverity


M	src/imap-urlauth/imap-urlauth-worker.c

2014-06-13 01:22:23 +0300 Timo Sirainen <tss@iki.fi> (ca321ff)

    replication plugin: Synchronous notification timeout error wasn't logged as
    intended. Found by Coverity


M	src/plugins/replication/replication-plugin.c

2014-06-13 01:20:25 +0300 Timo Sirainen <tss@iki.fi> (d19412e)

    lib-otp: OTP_MAX_WORD_LEN wasn't actually enforced, any word lengths could
    have been used. Doesn't look like this could have caused any real problems.
    Found by Coverity


M	src/lib-otp/otp-parse.c

2014-06-13 01:11:24 +0300 Timo Sirainen <tss@iki.fi> (739f4f2)

    fts: Improved doveadm fts dump for corrupted expunge log Although we may
    still be trying to allocate up to 2 GB of memory, but at least no more than
    that now. Found by Coverity


M	src/plugins/fts/doveadm-dump-fts-expunge-log.c

2014-06-13 01:02:48 +0300 Timo Sirainen <tss@iki.fi> (6b5b3d9)

    lib: Fixed
    file_dotlock_replace(flags=DOTLOCK_REPLACE_FLAG_VERIFY_OWNER|DOTLOCK_REPLACE_FLAG_DONT_CLOSE_FD)
    The verification check failed because fd was already set to -1 by that time.
    Found by Coverity


M	src/lib/file-dotlock.c

2014-06-13 00:57:06 +0300 Timo Sirainen <tss@iki.fi> (456f3c7)

    director: Fixed crash if master_user_separator is set, but we didn't do a
    proxy lookup. Found by Coverity


M	src/director/login-connection.c

2014-06-13 00:51:44 +0300 Timo Sirainen <tss@iki.fi> (2d2d7c4)

    imapc: Avoid crashing if server happens to send invalid resp-text-codes. If
    [KEY VALUE] is missing the VALUE, just set it to "" instead of NULL. Found
    by Coverity


M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-mailbox.c

2014-06-13 00:46:34 +0300 Timo Sirainen <tss@iki.fi> (0b9392b)

    fts: Minor code cleanup: Don't increment NULL pointer.


M	src/plugins/fts/doveadm-dump-fts-expunge-log.c

2014-06-13 00:45:43 +0300 Timo Sirainen <tss@iki.fi> (7be1a55)

    Removed pointless NULL checks. Found by Coverity


M	src/director/director.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/lib-index/mail-index.c
M	src/plugins/acl/doveadm-acl.c

2014-06-13 00:30:27 +0300 Timo Sirainen <tss@iki.fi> (48b28b9)

    auth: Invalid userdb passwd-file and userdb templates may have caused
    crashes. Using just "key" parameter instead of "key=value" usually worked,
    but for some keys the code assumed that there was a value and it
    dereferenced NULL. We'll solve this by just using value="" instead of
    value=NULL. Found by Coverity


M	src/auth/auth-request.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-template.c

2014-06-13 00:15:47 +0300 Timo Sirainen <tss@iki.fi> (29a8262)

    auth: passdb/userdb dict settings file parsing didn't handle errors
    correctly. Found by Coverity


M	src/auth/db-dict.c

2014-06-13 00:09:23 +0300 Timo Sirainen <tss@iki.fi> (bed2cec)

    lib: Changed net_geterror() to return errno instead of -1 if getsockopt()
    fails. None of the callers were actually checking for the -1 error value but
    instead just passing it to strerror(). Since this error should just about
    never happen it's better to just return a usable return value than try to
    remember to handle errors that can't normally even happen. Found by Coverity


M	src/lib/net.c

2014-06-13 00:05:16 +0300 Timo Sirainen <tss@iki.fi> (bdb5cc2)

    doveadm sis deduplicate: Error handling fix if open() fails. Found by
    Coverity.


M	src/doveadm/doveadm-sis.c

2014-06-13 00:03:11 +0300 Timo Sirainen <tss@iki.fi> (8f80d2d)

    lib: Added (void) prefixes to some setsockopt() calls which we don't care if
    they fail.


M	src/lib/net.c

2014-06-13 00:00:31 +0300 Timo Sirainen <tss@iki.fi> (0c8f8dc)

    dsync: Fixed potential crash when debug logging was enabled. Found by
    Coverity.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2014-06-12 23:51:28 +0300 Timo Sirainen <tss@iki.fi> (956af71)

    mbox: X-Delivery-ID: and X-IMAP: headers weren't dropped from incoming
    mails. Because of a missing comma.. Found by Coverity.


M	src/lib-storage/index/mbox/mbox-storage.c

2014-06-12 23:47:55 +0300 Timo Sirainen <tss@iki.fi> (c03f712)

    doveadm who: Don't crash if server happens to send broken input. Found by
    Coverity.


M	src/doveadm/doveadm-who.c

2014-06-12 23:16:40 +0300 Timo Sirainen <tss@iki.fi> (7042d92)

    configure: Don't actually run the test to see if inotify works. It's
    definitely no longer needed in modern Linux systems and the test itself can
    also unintentionally fail sometimes.


M	configure.ac

2014-06-12 12:51:34 +0300 Timo Sirainen <tss@iki.fi> (c04da04)

    lib: Changed hash_table_remove() "key not found" panic to be in a macro
    itself. This makes it much easier to find out where such crashes are coming
    from. Since this breaks the ABI in such a many places the ABI version number
    was increased immediately..


M	configure.ac
M	src/lib/hash.c
M	src/lib/hash.h

2014-06-10 17:49:45 +0200 Phil Carmody <phil@dovecot.fi> (147dbf5)

    lib: test-bits - fix nearest_power for 32-bit size_t The test blindly went
    up to b=63, and the function correctly asserted.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/test-bits.c

2014-06-10 16:40:46 +0200 Timo Sirainen <tss@iki.fi> (552487e)

    rawlog: Buffer writing to rawlog files to improve performance.


M	src/util/rawlog.c

2014-06-09 23:08:18 +0300 Timo Sirainen <tss@iki.fi> (53895e4)

    lib-fs: Fixed crash in fs-sis if hard linking failed. (For example because
    there were too many hard links.) Pointed out by Pavel Stano


M	src/lib-fs/fs-sis.c

2014-06-09 23:02:52 +0300 Phil Carmody <phil@dovecot.fi> (a6050e8)

    lib: fix numpack overflow checking As on broken input, bits may grow without
    limit, so << bits becomes Undefined Behaviour. Add a simple check to the
    while loop to prevent this.

    Also, the (presumably) final byte adds something to the bit length, so
    include that in the tally. If we didn't get to a final byte due to the above
    while() condition, then this extra addition does no harm

    Now we can precisely check for overflow conditions. Note that 64 bits is
    perfectly OK, only 65+ is an overflow.

    Note - no longer moving *p if there was a decode error.

    Expand the test suite to check for overflow cases. Also checked for 
    short-input cases too, while I was there.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/numpack.c
M	src/lib/test-numpack.c

2014-06-09 23:02:52 +0300 Phil Carmody <phil@dovecot.fi> (9fe0778)

    lib: unit tests for lib/bits Signed-off-by: Phil Carmody <phil@dovecot.fi>


M	src/lib/Makefile.am
A	src/lib/test-bits.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-06-09 23:02:52 +0300 Phil Carmody <phil@dovecot.fi> (aebf030)

    lib-test: test_assert helper for loops If you're repeatedly testing the same
    expression in a loop, it's good to know where you are in the loop. Add an
    additional parameter for these cases.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-test/test-common.c
M	src/lib-test/test-common.h

2014-06-09 23:02:52 +0300 Phil Carmody <phil@dovecot.fi> (3637a2a)

    lib: bit twiddles bits_requiredXX() gives the number of bits required to
    store an unsigned integer. Here, XX is 8, 16, 32, 64, reperesenting the size
    of the operand. It belongs in the same file as nearest_power(), which makes
    most sense in a separate bit twiddles file. Universal enough to stay in
    lib.h by inclusion.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/Makefile.am
A	src/lib/bits.c
A	src/lib/bits.h
M	src/lib/lib.c
M	src/lib/lib.h

2014-06-09 22:59:59 +0300 Phil Carmody <phil@dovecot.fi> (7df0ae5)

    lib: Fix MEM_ALIGN to cope with huge allocations Attempting to allocate
    2^32+1 bytes will look like it succeeds, as MEM_ALIGN will set alloc_size =
    8. The caller will then think it's got 4 gig to play with.

    e.g. t_malloc0 will wipe vast areas of memory before segfaulting, which
    might include useful information we'd like in a corefile.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/macros.h

2014-06-09 22:53:16 +0300 Timo Sirainen <tss@iki.fi> (4f8f6d6)

    lib-index: modseq -> {log file, offset} lookup often ignored
    dovecot.index.log.2 This caused the code to think that the modseq was too
    old and fall back into slower sync.

    So this change should fix the dsync "Modseq .. nom longer in transaction 
    log" warnings as well as improve IMAP QRESYNC efficiency.

M	src/lib-index/mail-index-modseq.c

2014-06-09 18:15:51 +0300 Timo Sirainen <tss@iki.fi> (44af44e)

    lib: Added some kind of a unit test for hash table. Just try out some
    insert+deletes randomly. Mainly I wrote this to check if there is some
    obvious problem, but looks like not.


M	src/lib/Makefile.am
A	src/lib/test-hash.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-06-09 15:11:50 +0300 Timo Sirainen <tss@iki.fi> (31df48d)

    lib-ssl-iostream: Implement get_used_size() method. Previously we were
    always returning that we didn't have anything buffered, which could have
    caused huge memory usage (or malloc failures) with its users (e.g. dsync).


M	src/lib-ssl-iostream/ostream-openssl.c

2014-06-09 13:41:59 +0300 Timo Sirainen <tss@iki.fi> (a117008)

    login-common: Fixed potential crash at client disconnect. Broken by recent
    change


M	src/login-common/client-common.c

2014-06-09 12:14:42 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (2529a04)

    login-common: Fixed infinite loop in ssl proxy flushing.


M	src/login-common/ssl-proxy-openssl.c

2014-06-09 12:12:58 +0300 Timo Sirainen <tss@iki.fi> (d065c1e)

    login proxy: Fixed connection hanging due to wrong ostream cork pairing


M	src/login-common/login-proxy.c

2014-06-05 13:43:11 +0300 Timo Sirainen <tss@iki.fi> (b09c165)

    lib-storage: Mailbox list index updating didn't check properly if modseq
    tracking is enabled. mail_index_modseq_enable() can be enabled (e.g. by
    virtual plugin) without enabling MAILBOX_FEATURE_CONDSTORE.

    (Actually the MAILBOX_FEATURE_* probably should be removed from lib-storage 
    entirely. They're too much of an IMAP feature.)

M	src/lib-storage/list/mailbox-list-index-status.c

2014-06-05 13:38:36 +0300 Timo Sirainen <tss@iki.fi> (83b777d)

    maildir: Mailbox list index refreshing shouldn't check cur/new dirs with
    maildir_very_dirty_syncs=yes The recent mailbox_list_index_very_dirty_syncs
    change broke this. Just because maildir_very_dirty_syncs=yes, it doesn't
    mean that mailbox_list_index_very_dirty_syncs=yes also.


M	src/lib-storage/index/maildir/maildir-sync-index.c

2014-06-05 11:30:19 +0300 Timo Sirainen <tss@iki.fi> (0270e64)

    *-login: Flush SSL output when logging out. The BYE and LOGOUT replies
    weren't being sent when they were sent from imap-login process (before
    logging in).


M	src/login-common/client-common.c
M	src/login-common/ssl-proxy-openssl.c

2014-06-04 00:35:27 +0300 Timo Sirainen <tss@iki.fi> (d4b03b1)

    doveadm fs delete: When doing recursive deletion, delete also the
    directories if needed.


M	src/doveadm/doveadm-fs.c

2014-06-03 23:52:39 +0300 Timo Sirainen <tss@iki.fi> (0218e28)

    dsync: Fixed renaming duplicate mailbox GUIDs. We were trying to use only
    the last part of the hierarchical name instead of the full name.


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2014-06-02 23:58:26 +0300 Timo Sirainen <tss@iki.fi> (6e95258)

    lib-ssl-iostream: Use SSL_MODE_RELEASE_BUFFERS if it exists to reduce memory
    usage.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (030e247)

    mail-index: make uid_lookup_idx hold a sequence number, not a 0-based C
    array index Rename it to _seq, and make it hold values 1.. rather than 0.. .
    Several uses of the value are simplified by this change, and none are made
    more confusing, so I think it helps improve maintainability of the code.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-strmap.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (7604ee7)

    mail-index: use _REC_AT_SEQ not _MAP_IDX in view_sync_get_log_lost_changes
    Shifting i and j up by one to use in the new macro means we don't need the
    +1's in the calls to view_sync_apply_lost_changes and
    mail_index_map_lookup_keywords. Rename them as seq variables too.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-view-sync.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (c308d70)

    mail-index: use _REC_AT_SEQ not _MAP_IDX in backward loops [seq-1 .. 0]
    becomes [seq .. 1]

    Don't pre-decrement, and terminate before you process seq=0.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-view.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (be8c847)

    mail-index: use _REC_AT_SEQ not _MAP_IDX in loops from [seq1..seq2]
    [seq1-1..seq2) becomes [seq1..seq2]

    Don't decrement before starting, and include the upper bound.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (2f16d2e)

    mail-index: use _REC_AT_SEQ not _MAP_IDX in loops over every record Just
    change the loop bounds from [0..count) to [1..count], and make the loop
    variale explicitly a seq.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-update.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (1df5269)

    mail-index: trivial robomatic migration from _MAP_IDX to new helper All
    users which have a '-1' in their MAIL_INDEX_MAP_IDX have been changed to the
    new mail_index_rec_at_seq() helper using this sed script:

    $ sed -ie 's/MAIL_INDEX_MAP_IDX(\([^,]*[^)]*[^ ]\) \?-
    \?1)/MAIL_INDEX_REC_AT_SEQ(\1)/' src/lib-index/*.[ch]

    No other users have been changed.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (f5e06b9)

    mail-index: new helper macro with more user-friendly semantics As the record
    ids range from 1..records_count, but the data is stored as if in a C-style
    0-based array, current clients of MAIL_INDEX_MAP_IDX() must subtract 1 from
    the index themselved.

    New MAIL_INDEX_REC_AT_SEQ() macro does the subtraction for you, it gives you
    (the address of) the record from a seq number.

    Uglified users of the former will be migrated to the latter.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-private.h

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (53e0e68)

    mail-index: optimise memmoves in expunge, only move each region once Rather
    than shifting things back and back and back with potentially O(N^2) (more
    precisely O(count*rec_count')) work factor, move each slice of memory only
    once, directly where we want it to end up (O(rec_count') work factor).

    Based on draft patch by Timo Sirainen.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-sync-update.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (4e6629c)

    mail-index: trivial paranoia check in expunge loop We will later be moving
    the zone between the current seqs and the (end of the) previous seqs - this
    check ensures that the range is indeed monotonic, and thus that zone is
    positive in size. It can be zero right at the start, if the first seqs is
    (1,...)

    Based on draft patch by Timo Sirainen.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-sync-update.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (aba9cc9)

    mail-index: Preparatory HACK - reverse the loop order in the expunge This is
    the final step before the actual optimisation of the memmoves.

    HACK, as it it de-optimises the moves so as much as possible gets moved as
    many times as possible. It clears the path for a later patch which optimises
    them far better.

    Based on draft patch by Timo Sirainen.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-sync-update.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (070df93)

    mail-index: hoist initialisation of mail index map out of expunge loop Based
    on draft patch by Timo Sirainen.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-sync-update.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (89b7d6c)

    mail-index: explicitly inline contents of sync_expunge() To later optimise
    the memmoves, we will need to be aware of previous seqs. It's easier to just
    have the guts inlined, so too much state doesn't need to be passed around.

    For review, this change is best viewed with a whitespace-insensitive diff, 
    to verify that the new contents of the loop are identical to the contents of 
    the now-absorbed function.

    Based on draft patch by Timo Sirainen.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-sync-update.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (74896b8)

    mail-index: call all expunge handlers first Firstly, the init checking only
    needs to be done once. More importantly, moving this preparatory stage into
    its own per-seqs loop means there's less to juggle when we optimise the
    memmoving loop in subequent patches.

    Based on draft patch by Timo Sirainen.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-sync-update.c

2014-06-02 14:50:34 +0300 Phil Carmody <phil@dovecot.fi> (b32de04)

    mail-index: move expunge handler init into helper function Preparatory for
    later optimisation patches where the call to this will be lifted out of the
    expunge(seq1,seq2) inner function and done once for the whole range of seqs
    in one go.

    Based on draft patch by Timo Sirainen.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-index/mail-index-sync-update.c

2014-06-02 04:16:08 +0300 Timo Sirainen <tss@iki.fi> (36e091d)

    director: If we detect that a user is being proxied to multiple backends,
    disconnect wrong connections. Especially IMAP connections can otherwise stay
    alive for a long time and cause problems.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h
M	src/login-common/login-proxy.c

2014-06-02 04:00:19 +0300 Timo Sirainen <tss@iki.fi> (550d2fe)

    doveadm director kick command added. The kick gets sent to all the proxies
    within the director ring.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/doveadm/doveadm-director.c

2014-05-28 18:17:52 +0300 Timo Sirainen <tss@iki.fi> (b886421)

    lib-index: Fixed somewhat random assert-crashes during extension resizes.


M	src/lib-index/mail-index-transaction-export.c

2014-05-28 15:53:58 +0300 Timo Sirainen <tss@iki.fi> (dfdd228)

    lib-index: Optimize removing large number of expunges.


M	src/lib-index/mail-index-sync-update.c

2014-05-28 04:20:58 +0300 Timo Sirainen <tss@iki.fi> (884228e)

    lib-storage: "Message has no NUL characters" flag was being set wrong to
    cache file. Only the first MIME part was checked for its existence.

    When this flag was wrong, IMAP FETCH may have returned NUL characters 
    instead of converting them to 0x80 character. This apparently caused Outlook 
    to hang.

M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2014-05-27 23:11:07 +0300 Timo Sirainen <tss@iki.fi> (ffcd975)

    Compiler warning fix


M	src/stats/main.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (9d47b3d)

    auth: checkpassword callback callback type bike-shedding This change doesn't
    change the compiler's (gcc) view on the correctness of the code. It moves
    sparse's attention of where the potential issues are though. Sparse used to
    complain about dodgy function pointer conversions on both the way out
    (passing the callback function pointer), and on the way in (entering the
    callback). Making the callback not lie about what it receives gets rid of
    the way in warnings, but adds warnings as we pass the new function pointer
    out. However, it already complains about that call anyway. So it complains
    about 6 things in 3 functions rather than 6 things in 6 functions.

    Of dubious worth, but it at least reduces the number of lines you need to 
    inspect to verify correctness.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/auth/passdb-checkpassword.c
M	src/auth/userdb-checkpassword.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (fbb631c)

    imap: exit imap_fetch_binary_init() identically on all failures This changes
    the behaviour, as -1 is TRUE as a boolean.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/imap/imap-fetch-body.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (bbd5d73)

    imap: use human-readable helper macro in remote_ip_is_usable More readable,
    but helpfully shuts up sparse which complained about some constants being
    long.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/imap/cmd-idle.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (ed7b5bc)

    imap: cmd_getmetadata_stream_continue returns bool, not int The behaviour is
    unchanged, but we shouldn't pretend that -1 is different from TRUE in a
    boolean context. Its only caller only cares about whether it's 0 or not.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/imap/cmd-getmetadata.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (71e32f9)

    indexer: fix indexer_queue_cancel_all behaviour -1 is TRUE. Presumably -1
    was intended to be passed to the callbacks via
    indexer_queue_request_status_int(), not 100.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/indexer/indexer-queue.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (6094fe2)

    auth: master-connection - bail on malformed list If master is not
    communicating to us in a syntax we understand, just ask for it to be
    unplugged. This changes the behaviour in this error case.

    Previously, we returned -1, which is TRUE when converted to a boolean, and 
    thus this changes the error semantics, and may be horribly wrong. However, 
    the i_error()s in auth_master_input_line follow the same pattern.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/auth/auth-master-connection.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (cc363c8)

    auth: set_credentials callback being passed an enum, not a bool This changes
    the behaviour, as the error case is now mapped onto FALSE. All non-zero
    values of course get squashed into true. Found by sparse.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/auth/auth-request.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (8e018b1)

    lib-otp: cast to the correct type of function pointer sparse complains about
    the result of the F() cast being the wrong type for the initialisation,
    which is true. So just cast to the right type in the first place.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-otp/otp-hash.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (42149f4)

    imap: fix missing-command check It's impossible for the command's pointer to
    be NULL at this point. Previously, the command_find() would have returned
    NULL, but this check presumably short-circuits that search in the trivial
    case, so has some real use.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/imap/imap-client.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (dc78180)

    lib-imap: API change - add const to imap_url *base parameter We do not
    change what's there, therefore we can promise to not change what is there.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-url.h

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (36f63d7)

    auth: sparse static cleanup, and some const cleanup All the consts that are
    added to pointers represent deep const semantics. There are other shallow
    consts that I've not added, as sometimes it's better to not be const than
    have something you rely on change when you think it won't.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/auth/auth.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (c2d3982)

    various - 'static' sparse cleanup Signed-off-by: Phil Carmody
    <phil@dovecot.fi>


M	src/anvil/anvil-connection.c
M	src/config/config-connection.c
M	src/indexer/indexer-client.c
M	src/pop3-login/client-authenticate.c
M	src/ssl-params/main.c
M	src/stats/mail-stats.c
M	src/stats/main.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (5a09d08)

    lib-mail: tests - trivial sparse cleanups One static const, and one more
    obviously not-an-int integer.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-message-date.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (e9c433c)

    lib-imap: tests - trivial static and const sparse cleanups Signed-off-by:
    Phil Carmody <phil@dovecot.fi>


M	src/lib-imap/test-imap-url.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (ba592dc)

    lib-http: trivial sparse cleanups - statics and explicit NULLs
    Signed-off-by: Phil Carmody <phil@dovecot.fi>


M	src/lib-http/test-http-date.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-request-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-server.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (ba5c8b0)

    various - trivial NULL-related sparse cleanups These zero-alikes are all
    pointers, so should explicitly be NULL.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/config/sysinfo-get.c
M	src/director/user-directory.c
M	src/doveadm/doveadm-mail.c
M	src/imap/imap-sync.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-sql/driver-sqlite.c
M	src/util/script-login.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (da7f1a0)

    treewide - mass cleanup of 0 used to end a settings list This also includes
    a change to the perl script which generates the all-settings.c file.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/anvil/anvil-settings.c
M	src/auth/auth-settings.c
M	src/config/config-settings.c
M	src/config/settings-get.pl
M	src/dict/dict-settings.c
M	src/director/director-settings.c
M	src/dns/dns-client-settings.c
M	src/doveadm/doveadm-settings.c
M	src/imap-login/imap-login-settings.c
M	src/imap-urlauth/imap-urlauth-login-settings.c
M	src/imap-urlauth/imap-urlauth-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap/imap-settings.c
M	src/indexer/indexer-settings.c
M	src/indexer/indexer-worker-settings.c
M	src/ipc/ipc-settings.c
M	src/lmtp/lmtp-settings.c
M	src/log/log-settings.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3/pop3-settings.c
M	src/replication/aggregator/aggregator-settings.c
M	src/replication/replicator/replicator-settings.c
M	src/ssl-params/ssl-params-settings.c
M	src/stats/stats-settings.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (fa4da02)

    lib: pair VA_COPY with va_end A va_copy creates a initialised va_list, as if
    a va_start had been done on it. Therefore, pedantically, a va_end should
    also be done on it. On most platforms this is a no-op, and for those where
    it isn't, the pairing is important.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib/str.c
M	src/lib/strfuncs.c
M	src/master/main.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (9432f88)

    fts: parser-html - parser can fail on attributes='with values in single
    quotes' If that value were to contain an odd number of double quotes, then
    the HTML_STATE_TAG_(D)QUOTED state would be entered and not exited.

    The two quoting types behave basically the same, so just add two new cases 
    and duplicate the state transition code.

M	src/plugins/fts/fts-parser-html.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (c6fea6c)

    fts: parser-html - parse_tag_name returns wrong value for comments This
    function returns 1 more than the number of additional characters to be
    swallowed up by the state transition.


M	src/plugins/fts/fts-parser-html.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (aef3f28)

    fts: parser-html - parse_tag_name really does return an integer not a bool
    It seems to return 1 more than the number of additional characters (after
    '<') are swallowed up by the state change, not a bool. This would imply that
    '3' is wrong.


M	src/plugins/fts/fts-parser-html.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (915bb15)

    lib-storage: functions returning bool actually return ints Their return
    values are compared as if they are at least tri-state (-ve, 0, +ve), so
    really aren't bools at all.

    Note - this should cause the code to change in behaviour, and thus might 
    introduce regressions as previously all non-zeroes would have been mapped to
    1.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-storage/index/mbox/mbox-mail.c

2014-05-27 21:17:34 +0300 Phil Carmody <phil@dovecot.fi> (a9a3687)

    lib-storage: context's dotlock_last_stale really is bool It's only ever read
    as if it's a bool, so it really is a bool. Fix a write treating it as an
    int.

    Signed-off-by: Phil Carmody <phil@dovecot.fi>

M	src/lib-storage/index/mbox/mbox-lock.c

2014-05-27 17:01:15 +0300 Stephan Bosch <stephan@rename-it.nl> (d3d941c)

    lib-http: Fixed assertion failure in http_client_request_send_payload()
    caused by inappropriate retry attempt.


M	src/lib-http/http-client-request.c

2014-05-26 04:26:01 +0300 Timo Sirainen <tss@iki.fi> (3bbc503)

    virtual: Crashfix: Don't deinitialize search args that haven't been
    initialized.


M	src/plugins/virtual/virtual-storage.c

2014-05-26 04:05:34 +0300 Timo Sirainen <tss@iki.fi> (5b59856)

    lib-storage: Avoid refreshing mailbox list index too often.


M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2014-05-26 03:58:16 +0300 Timo Sirainen <tss@iki.fi> (64c615d)

    lib-storage: Optimize mailbox_exists() with mailbox_list_index=yes We can
    return the existence from the index itself to avoid stat()s.


M	src/lib-storage/list/mailbox-list-index-status.c

2014-05-21 18:12:05 -0700 Timo Sirainen <tss@iki.fi> (53cc097)

    lib-storage: Added mailbox_list_index_very_dirty_syncs setting. This setting
    assumes that the mailbox list index is up to date and uses it without
    stat()ing backend mailbox files/dirs. (As a possible future TODO it might be
    useful to still do the stat()ing, but only rarely.)


M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/mbox/mbox-sync-list-index.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2014-05-21 06:28:36 -0700 Timo Sirainen <tss@iki.fi> (b36a03e)

    imap: If we're waiting for client to read data, show in process title how
    many bytes are buffered.


M	src/imap/imap-client.c
M	src/imap/main.c

2014-05-21 06:21:16 -0700 Timo Sirainen <tss@iki.fi> (10ff47d)

    lib: Added o_stream_is_corked().


M	src/lib/ostream.c
M	src/lib/ostream.h

2014-05-15 23:41:55 +0300 Timo Sirainen <tss@iki.fi> (aac7ed9)

    lib-imap: Use case-insensitive comparisons everywhere for imap_id_send
    setting parsing. "os" and "os-version" were case-sensitive while others were
    not. Patch by Apple.


M	src/lib-imap/imap-id.c

2014-05-15 13:26:40 +0300 Timo Sirainen <tss@iki.fi> (7ab6219)

    virtual: If backend mailbox hasn't changed, we still need to build its
    uidmap.


M	src/plugins/virtual/virtual-sync.c

2014-05-14 12:46:25 +0300 Timo Sirainen <tss@iki.fi> (bd7fe09)

    imap: Fixed enabling METADATA if imap_capability string was explicitly set


M	src/imap/imap-client.c

2014-05-14 12:28:17 +0300 Timo Sirainen <tss@iki.fi> (5e9e9f0)

    lib-fs: Make sure we don't leak data stack.


M	src/lib-fs/fs-api.c

2014-05-13 15:46:01 +0200 Timo Sirainen <tss@iki.fi> (917f7f4)

    lib-storage: Don't leak memory if mailbox_save_set_flags() is used multiple
    times for keywords. This affected only some external plugins.


M	src/lib-storage/mail-storage.c

2014-05-12 13:21:28 +0300 Timo Sirainen <tss@iki.fi> (70058d2)

    dsync: If incremental sync fails because of desync, log the reason why


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/dsync-transaction-log-scan.h

2014-05-12 12:51:50 +0300 Timo Sirainen <tss@iki.fi> (9f240e2)

    dsync: mailbox_metadata.cache_fields must be copied to permanent memory. Any
    other call to mailbox_get_metadata() would have cleared the memory.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c

2014-05-12 12:18:46 +0300 Timo Sirainen <tss@iki.fi> (82038c5)

    acl: Empty negative rights list should be the same as NULL negative rights
    list. There may be other places where this should be fixed, but this at
    least fixes errors with dsync where "-user" entry without any rights was
    attempted to be synced in dovecot-acl (although such entry shouldn't really
    have existed in the first place).


M	src/plugins/acl/acl-api.c

2014-05-11 22:52:30 +0300 Timo Sirainen <tss@iki.fi> (948a14d)

    lib-mail: Compiler warning fix


M	src/lib-mail/message-header-encode.c

2014-05-11 22:33:21 +0300 Timo Sirainen <tss@iki.fi> (4a723b1)

    Added signature for changeset c55c660d6e9d


M	.hgsigs

2014-05-11 22:33:08 +0300 Timo Sirainen <tss@iki.fi> (37e437f)

    Added tag 2.2.13 for changeset c55c660d6e9d


M	.hgtags

2014-05-11 22:33:08 +0300 Timo Sirainen <tss@iki.fi> (dc95c51)

    Released v2.2.13.


M	NEWS
M	configure.ac

2014-05-11 22:32:19 +0300 Timo Sirainen <tss@iki.fi> (2d310b6)

    lib-mail: test-message-header-decoder unit test fixed


M	src/lib-mail/test-message-header-decode.c

2014-05-11 22:31:54 +0300 Timo Sirainen <tss@iki.fi> (e701ffe)

    lib-mail: Fix to previous message_header_encode() commit


M	src/lib-mail/message-header-encode.c

2014-05-11 22:19:15 +0300 Timo Sirainen <tss@iki.fi> (ff2619b)

    doveadm penalty: Fixed using -a parameter


M	src/doveadm/doveadm-penalty.c

2014-05-11 22:15:08 +0300 Timo Sirainen <tss@iki.fi> (a7dcd5b)

    lib-mail: message_header_encode() now preserves folding whitespace This
    function could still use some cleaning up, but good enough for now..

    Also it should try to minimize the encoded words, not necessarily encoding 
    everything between the first and the last words that have to be encoded.

M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-encode.h
M	src/lib-mail/test-message-header-encode.c

2014-05-11 21:08:51 +0300 Timo Sirainen <tss@iki.fi> (5b6e0b6)

    lib-mail: message_header_encode_[bq]() now explicitly takes the first line
    length parameter. So this change partially reverts the previous change,
    because message_header_encode() was actually internally relying on this
    behavior. The explicit parameter makes it clearer.


M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-encode.h
M	src/lib-mail/test-message-header-encode.c

2014-05-11 18:28:03 +0300 Timo Sirainen <tss@iki.fi> (63007f6)

    lib-mail: message_header_encode() no longer tries to lookup the first line's
    length from output string. This function is used only by Pigeonhole, which
    only uses it for empty output strings, so it's not useful there. Also that
    behavior is somewhat unexpected and confusing.


M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-encode.h

2014-05-08 18:07:30 +0300 Timo Sirainen <tss@iki.fi> (2be0260)

    Added signature for changeset 791ec610422c


M	.hgsigs

2014-05-08 18:07:23 +0300 Timo Sirainen <tss@iki.fi> (afde22a)

    Added tag 2.2.13.rc1 for changeset 791ec610422c


M	.hgtags

2014-05-08 18:07:23 +0300 Timo Sirainen <tss@iki.fi> (c4d59dc)

    Released v2.2.13.rc1.


M	Makefile.am
M	NEWS
M	configure.ac

2014-05-08 15:53:27 +0300 Phil Carmody <phil@dovecot.fi> (8d35582)

    treewide - use of explicit NULL in pointer comparisons rather than 0-alikes

    Found by sparse.

M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/lib-imap/imap-url.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/mail-search-build.c

2014-05-08 17:01:26 +0300 Phil Carmody <phil@dovecot.fi> (aac0287)

    lib-storage: maildir - don't use a bool to store a char


M	src/lib-storage/index/maildir/maildir-mail.c

2014-05-08 15:56:25 +0300 Phil Carmody <phil@dovecot.fi> (b49aa34)

    lib-storage: pop3c - fix invalid blank password check

    The pointer will never be NULL, as it's initialised pointing to an empty 
    string, and can only be overridden by setting it to another string. So the
    test always failed. Instead, check the 1st character of the password.

M	src/lib-storage/index/pop3c/pop3c-storage.c

2014-05-08 17:02:19 +0300 Timo Sirainen <tss@iki.fi> (7da0a15)

    lib-storage: Removed unnecessary code. mailbox_dir_name is never NULL, and
    when it's empty it can be handled exactly the same as when it's non-empty.


M	src/lib-storage/list/mailbox-list-index-backend.c

2014-05-08 15:11:26 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (0161576)

    Removed unnecessary #includes.


M	src/lda/main.c
M	src/lib-lda/smtp-client.h

2014-05-08 14:57:56 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (99399f0)

    run-tests.sh: Add support for reading valgrind suppressions if they exist.


M	run-test.sh

2014-05-08 14:34:39 +0300 Timo Sirainen <tss@iki.fi> (07c2fc4)

    lib: fd_read() didn't check the msg.msg_controllen size correctly


M	src/lib/fdpass.c

2014-05-06 12:44:38 +0300 Phil Carmody <phil@dovecot.fi> (ff0dc0d)

    lib: cosmetic - rename parameters so that .h and .c files match

    These functions were flagging sparse warnings, but those warnings are 
    trivially (robotically) dismissable if the parameters are identically named
    in the two contexts. Opted for whichever name seemed to be more meaningful
    or sensible. e.g. char** became p rather than s, as it's a pointer more than
    a string.

M	src/lib/strfuncs.c
M	src/lib/strfuncs.h

2014-05-08 11:20:36 +0300 Phil Carmody <phil@dovecot.fi> (f71ebf2)

    lib: wildcard-match - use NULL not 0 for pointers

    Flagged by sparse.

M	src/lib/wildcard-match.c

2014-05-07 16:52:22 +0300 Phil Carmody <phil@dovecot.fi> (df831ed)

    lib: a couple of trivial sparse cleanups

    The #include isn't needed on modern linux, as the macros are already defined 
    The compiler seems to silently ignore redefinitions in system header files, 
    so didn't throw a warning, but probably should have, as redefinitions can
    lead to insanity.

    The cast just makes it explicit that we're changing the prototype.

M	src/lib/file-set-size.c
M	src/lib/istream.c

2014-05-08 14:11:46 +0300 Timo Sirainen <tss@iki.fi> (274c54a)

    lib-storage: Make struct fail_storage/mailbox/mail_vfuncs properly extern.
    These could be useful when implementing some new dummy storage backends.


M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/fail-mail-storage.h
M	src/lib-storage/fail-mail.c

2014-05-06 18:10:55 +0300 Phil Carmody <phil@dovecot.fi> (0b3e92b)

    treewide sparse cleanup - make single-unit-only data static

    Helps keep the global namespace clean. Not all the things suggested by 
    sparse have been moved. All DOVECOT_ABI_VERSION strings, and anything 
    replicated in all-settings.c by src/config/settings-get.pl has been left
    untouched. Some of the latter could be moved, but the script would need to
    be modified to replicate the 'static' (it outputs 'extern').

M	src/lib-index/mail-index-strmap.c
M	src/lib-lda/mail-send.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib/child-wait.c
M	src/lib/hash-method.c
M	src/login-common/client-common.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser.c

2014-05-08 13:45:37 +0300 Timo Sirainen <tss@iki.fi> (64e75f0)

    lib-storage: Code cleanups and potential crashfix. Usually in
    blocks_count_lines() the full_input stream reading doesn't return eof=true
    in the last read but only on the next. If this had changed for some reason
    the code would have crashed in the assert checks.


M	src/lib-storage/index/index-mail-binary.c

2014-05-08 13:27:43 +0300 Timo Sirainen <tss@iki.fi> (543879e)

    fts-tika: Removed lib-http kludgy workaround, which is no longer needed.


M	src/plugins/fts/fts-parser-tika.c

2014-05-08 12:39:10 +0300 Timo Sirainen <tss@iki.fi> (d8fc51f)

    Make static analyzer happier


M	src/lib-mail/test-message-part.c

2014-05-08 11:29:34 +0300 Timo Sirainen <tss@iki.fi> (258fd0e)

    Fixed compiling when building without SSL support.


M	src/login-common/ssl-proxy.c

2014-05-08 10:21:56 +0300 Timo Sirainen <tss@iki.fi> (497803a)

    run-test.sh: Valgrind version check was broken for v3.10+, removed it
    entirely. RHEL 5.9 has valgrind v3.5 already, so there shouldn't really be
    any important OSes using old valgrind that we need to support.


M	run-test.sh

2014-05-07 23:32:28 +0300 Timo Sirainen <tss@iki.fi> (ea918d5)

    dsync: Make static analyzer happier (hopefully)


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-05-07 23:26:57 +0300 Timo Sirainen <tss@iki.fi> (0d238ce)

    lib-mail: Added asserts to make static analyzer happier


M	src/lib-mail/message-parser.c

2014-05-07 23:25:50 +0300 Timo Sirainen <tss@iki.fi> (1b6228f)

    Fixed compiling on systems without MAP_ANONYMOUS For example OSX.


M	src/lib/test-hash-method.c

2014-05-07 23:22:13 +0300 Timo Sirainen <tss@iki.fi> (a8672a7)

    auth: Minor code cleanup


M	src/auth/mech-rpa.c

2014-05-07 20:24:05 +0300 Timo Sirainen <tss@iki.fi> (55bfe6c)

    auth: LDAP errors may have crashed the auth process.


M	src/auth/db-ldap.c

2014-05-07 20:21:02 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (ac4f179)

    lib-index: Fixed detecting broken strmap index file (thread index).


M	src/lib-index/mail-index-strmap.c

2014-05-07 20:18:39 +0300 Teemu Huovila <teemu.huovila@dovecot.fi> (8208398)

    pop3: Remove dead assignment detected by scan-build.


M	src/pop3/pop3-commands.c

2014-05-07 20:14:32 +0300 Timo Sirainen <tss@iki.fi> (42b6ab2)

    doveadm: table formatter printed header unaligned if it had hidden titles.
    This was broken by the previous table formatter change.


M	src/doveadm/doveadm-print-table.c

2014-05-07 19:47:12 +0300 Timo Sirainen <tss@iki.fi> (7e428af)

    lib-imap: IMAP parser didn't parse atoms correctly that started with '~'
    character. literal8 begins only after "~{", not immediately after "~" which
    is a valid ATOM-CHAR.


M	src/lib-imap/imap-parser.c

2014-05-07 18:39:23 +0300 Phil Carmody <phil@dovecot.fi> (c9c20b2)

    lib: fix md4/md5 buffer read overrun

    uint_fast32_t may be 64 bits and read too many bytes at the end of the
    buffer. This didn't actually break anything as long as there was 32 bits of
    readable memory past the buffer.

M	src/lib/md4.c
M	src/lib/md5.c

2014-05-07 19:34:42 +0300 Timo Sirainen <tss@iki.fi> (acc72c4)

    fts-lucene: Don't mix definite + maybe queries for now, since it returns
    broken results.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-05-07 17:26:21 +0300 Timo Sirainen <tss@iki.fi> (6da2d4f)

    *-login: SSL connections didn't get closed when the client got destroyed.


M	src/login-common/client-common.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.h

2014-05-07 17:12:19 +0300 Timo Sirainen <tss@iki.fi> (3b65d5b)

    acl: Global ACL file used only the first matching rights line, not merging
    all the matches.


M	src/plugins/acl/acl-global-file.c

2014-05-07 16:41:34 +0300 Timo Sirainen <tss@iki.fi> (0737a4f)

    lib-storage: Fixed assert-crash when looking up private flags for a mail
    being saved.


M	src/lib-storage/index/index-mail.c

2014-05-07 16:36:54 +0300 Timo Sirainen <tss@iki.fi> (48d8312)

    mdbox: Fixed race condition when creating a new mailbox and another process
    getting its GUID.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.h
M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2014-05-07 13:02:29 +0300 Timo Sirainen <tss@iki.fi> (b0114f9)

    liblib: Added unit test for hash methods to make sure they don't do read
    access beyond buffer. This currently fails for MD4 and MD5, so they need to
    be fixed/replaced..


M	src/lib/Makefile.am
A	src/lib/test-hash-method.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2014-05-07 13:01:17 +0300 Timo Sirainen <tss@iki.fi> (443fd76)

    lib-compression: Added some unit testing for lib-compression. Not perfect in
    any way, but at least tests if things are completely broken.


M	src/lib-compression/Makefile.am
A	src/lib-compression/test-compression.c

2014-05-07 12:27:36 +0300 Timo Sirainen <tss@iki.fi> (e01414d)

    lib-compression: gz compression didn't handle multiple flushes correctly.


M	src/lib-compression/ostream-zlib.c

2014-05-07 12:26:58 +0300 Timo Sirainen <tss@iki.fi> (f6a21db)

    lib-compression: istream-lz4 shouldn't crash when closing the stream
    multiple times.


M	src/lib-compression/istream-lz4.c

2014-05-07 12:26:38 +0300 Timo Sirainen <tss@iki.fi> (38ec64f)

    lib-compression: Fixed LZMA compression. The code now looks more like the
    doc/examples/01_compress_easy.c distributed with xz-utils. Most importantly
    this changes LZMA_OK to be allowed as a result for lzma_code(zs,
    LZMA_FINISH).


M	src/lib-compression/ostream-lzma.c

2014-05-06 15:34:00 +0300 Timo Sirainen <tss@iki.fi> (d97801e)

    pop3: Fixed assert-crash with some settings when there are 0 mails.


M	src/pop3/pop3-commands.c

2014-05-05 18:37:16 +0300 Timo Sirainen <tss@iki.fi> (d8d50ed)

    mkdir_parents(): Handle mkdir() EEXIST errors that may happen during race
    conditions. We don't care about EEXIST errors that happen when trying to
    mkdir() parent directories, only if it happens when mkdir()ing the last
    directory.


M	src/lib/mkdir-parents.c

2014-05-05 16:24:53 +0300 Timo Sirainen <tss@iki.fi> (3d14f45)

    auth: If authentication fails, never send back "nologin" field. This only
    causes confusion.


M	src/auth/auth-request-handler.c

2014-05-05 16:02:48 +0300 Timo Sirainen <tss@iki.fi> (edd3573)

    message_header_decode_utf8() wasn't used correctly with NULL instead of
    FALSE parameter.


M	src/doveadm/doveadm-mail-fetch.c
M	src/lib-storage/index/index-sort.c

2014-05-05 16:01:58 +0300 Timo Sirainen <tss@iki.fi> (66f9709)

    lib-storage: mail_get_headers_utf8() now replaces NULs with spaces. Perhaps
    there should also be another API function which actually allows returning
    strings with NULs in them.


M	src/lib-storage/index/index-mail-headers.c

2014-05-05 16:00:52 +0300 Timo Sirainen <tss@iki.fi> (b5ad250)

    doveadm mail fetch: Use mail_get_headers_utf8() when fetching hdr.*.utf8
    This doesn't really matter but may allow minor optimizations later.


M	src/doveadm/doveadm-mail-fetch.c

2014-05-05 15:39:58 +0300 Timo Sirainen <tss@iki.fi> (a5f1628)

    lib-mail: Added message_header_encode_data() to support encoding also NUL
    characters.


M	src/lib-mail/Makefile.am
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-encode.h
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c

2014-05-05 15:05:20 +0300 Timo Sirainen <tss@iki.fi> (513928e)

    liblib: Added str_append_data(), which is simply a wrapper to
    buffer_append() This is intended for appending data that may contain NUL
    characters that are wanted to be added to the string.


M	src/lib/str.c
M	src/lib/str.h

2014-05-05 15:09:27 +0300 Phil Carmody <phil@dovecot.fi> (36f6145)

    lib: quell sparse "warning: Using plain integer as NULL pointer"

    The first element of the structure is a pointer, make that explicit.

M	src/lib/array-decl.h

2014-05-05 14:57:13 +0300 Timo Sirainen <tss@iki.fi> (fb69cdf)

    lib-mail: message_header_encode() needs to encode control characters as
    well.


M	src/lib-mail/message-header-encode.c
M	src/lib-mail/test-message-header-encode.c

2014-05-05 14:28:33 +0300 Timo Sirainen <tss@iki.fi> (fc5f51f)

    auth: Added %{orig_user}, %{orig_username} and %{orig_domain} variables


M	src/auth/auth-request.c
M	src/auth/auth-request.h

2014-05-05 14:18:31 +0300 Timo Sirainen <tss@iki.fi> (7da99e9)

    imap: Brought back the original SEARCH PARTIAL code with the minor fix that
    it actually needed. The new code in v2.2.11 was completely wrong. The code
    in previous commit was broken with SORT. The original code was correct
    otherwise, except it couldn't handle partial1 pointing past the valid range.


M	src/imap/imap-search.c

2014-05-05 14:02:58 +0300 Timo Sirainen <tss@iki.fi> (e0bca7e)

    imap: Fixed SEARCH PARTIAL to work correctly with UIDs and with SORT
    results.


M	src/imap/imap-search.c

2014-05-05 14:02:16 +0300 Timo Sirainen <tss@iki.fi> (199566f)

    Added seq_range_array_remove_nth()


M	src/lib/seq-range-array.c
M	src/lib/seq-range-array.h
M	src/lib/test-seq-range-array.c

2014-05-02 19:31:49 +0300 Timo Sirainen <tss@iki.fi> (464e829)

    dsync: If we notice that incremental sync won't work, don't continue doing
    it.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c

2014-05-02 15:43:30 +0300 Timo Sirainen <tss@iki.fi> (27712ff)

    imap: Allow longer ID command parameters without disconnecting the client.


M	src/imap-login/client.c
M	src/imap-login/client.h
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-id.h
M	src/lib-master/master-auth.h

2014-05-02 13:48:36 +0300 Timo Sirainen <tss@iki.fi> (9559586)

    maildir: Maildir S=size fixing now works also with zlib etc. plugins that
    modify the files.


M	src/lib-storage/index/maildir/maildir-mail.c

2014-05-02 13:36:00 +0300 Timo Sirainen <tss@iki.fi> (fe0d192)

    maildir: Returning mail's received/saved date or refcount was sometimes
    broken with zlib plugin. If the value wasn't already cached and the same
    transaction also accessed the message body, i_stream_stat() was used, which
    ended up to i_stream_seekable_stat() due to caching the file, which didn't
    again fstat() the actual maildir file but just used some internal values.


M	src/lib-storage/index/maildir/maildir-mail.c

2014-05-02 13:21:18 +0300 Timo Sirainen <tss@iki.fi> (61114b4)

    kqueue: Changed all i_fatal() calls to i_panic()s to make debugging them
    possible.


M	src/lib/ioloop-kqueue.c

2014-05-02 12:11:54 +0300 Timo Sirainen <tss@iki.fi> (c5bf07c)

    lib-index: Fixed crash when header fields count was too high in cache file.


M	src/lib-index/mail-cache-fields.c

2014-05-02 11:58:52 +0300 Timo Sirainen <tss@iki.fi> (15bfe73)

    lib-storage: mailbox_settings_find() now takes namespace parameter instead
    of user. This fixes an infinite (until stack gets full) loop with shared
    mailboxes: mail_namespace_find() -> mailbox_list_get_storage() ->
    mailbox_settings_find() -> mail_namespace_find() -> ...


M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-list.c

2014-05-02 11:40:05 +0300 Timo Sirainen <tss@iki.fi> (bddb1ba)

    auth: Fixed userdb extra fields handling in passdb failure. userdb prefetch
    -flag wasn't correctly set, causing the prefetch userdb in some situations
    incorrectly either to be called or not be called.

    This also fixes a crash when using userdb static and multiple passdbs. The 
    userdb_reply was set to NULL, which caused a crash later.

M	src/auth/auth-request.c
M	src/auth/auth-request.h

2014-05-02 11:12:58 +0300 Timo Sirainen <tss@iki.fi> (be48f0e)

    imap: Make sure we don't return empty "* n FETCH ()" reply, which violates
    RFC 3501 ABNF. It happened only during error conditions, and it would be a
    bit too much trouble to try to remove the reply entirely, so just append the
    message UID there.


M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2014-05-02 11:06:27 +0300 Timo Sirainen <tss@iki.fi> (6165a82)

    imap: If FETCH BINARY fails because of invalid MIME part data, return
    [UNKNOWN-CTE] error.


M	src/imap/cmd-fetch.c
M	src/imap/imap-fetch-body.c

2014-05-02 10:40:12 +0300 Timo Sirainen <tss@iki.fi> (2a5d68c)

    example-config: Removed mail_nfs_* settings, since they shouldn't be used
    anyway.


M	doc/example-config/conf.d/10-mail.conf

2014-05-02 10:35:05 +0300 Timo Sirainen <tss@iki.fi> (5d2c897)

    lib-storage: Mailbox list indexes didn't use mail_fsync setting.


M	src/lib-storage/list/mailbox-list-index.c

2014-05-02 09:29:05 +0300 Timo Sirainen <tss@iki.fi> (a406615)

    virtual: Fixed assert-crash when doing changes to backend mailbox via the
    virtual mailbox. Caused by the recent lazy mailbox opening changes.


M	src/plugins/virtual/virtual-sync.c

2014-04-30 18:46:55 +0300 Timo Sirainen <tss@iki.fi> (9456a4a)

    lib-storage: mail_never_cache_fields=* means now to disable all caching.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-private.h

2014-04-30 17:37:43 +0300 Timo Sirainen <tss@iki.fi> (ceac44e)

    lib-storage: Partially reverted the mail.get_real_mail() API change for
    backwards compatibility. I hadn't realized Pigeonhole was also using it. (I
    thought it was using only the mail_get_real_mail() public API.) This fixes
    Pigeonhole v0.4.2 to work again.


M	src/lib-storage/fail-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail.c
M	src/plugins/virtual/virtual-mail.c

2014-04-30 06:08:46 +0300 Timo Sirainen <tss@iki.fi> (8bc87e2)

    dsync: saved-date doesn't need to be looked up until mail body is being
    read. This should improve the performance when the saved-date isn't already
    cached or otherwise quickly accessible.

    This change also makes dsync slightly incompatible with earlier versions. 
    When using dsync with an earlier version the saved-dates aren't synced. It 
    would be too much trouble to try to preserve full backwards compatibility, 
    especially because saved-date doesn't matter so much and isn't even visible 
    to IMAP clients.

M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c

2014-04-30 06:03:56 +0300 Timo Sirainen <tss@iki.fi> (9f09d08)

    maildir: Make sure the filename contains S=size and W=size even if GUID
    doesn't.


M	src/lib-storage/index/maildir/maildir-save.c

2014-04-29 16:44:58 +0300 Timo Sirainen <tss@iki.fi> (5192589)

    maildir: Make sure we don't replace correct mail sizes with broken ones when
    preserving GUID.


M	src/lib-storage/index/maildir/maildir-save.c

2014-04-29 16:14:14 +0300 Timo Sirainen <tss@iki.fi> (108340f)

    lib-mail: test-istream-attachment updated


M	src/lib-mail/test-istream-attachment.c

2014-04-29 16:15:09 +0300 Timo Sirainen <tss@iki.fi> (dce10c2)

    lib-mail: istream-attachment-extractor didn't correctly handle increasing
    base64 line length. Based on patch by Pavel Stano


M	src/lib-mail/istream-attachment-extractor.c

2014-04-29 16:03:17 +0300 Timo Sirainen <tss@iki.fi> (ba8c3c7)

    lib-mail: istream-attachment-extractor handled mixed LFs vs CRLFs correctly.
    Unless all the lines have the same newlines, the attachment can't be
    recreated back exactly the same.


M	src/lib-mail/istream-attachment-extractor.c

2014-04-29 13:57:44 +0300 Timo Sirainen <tss@iki.fi> (a7c8901)

    lib-mail: Added more tests to test-istream-dot.


M	src/lib-mail/test-istream-dot.c

2014-04-29 13:35:06 +0300 Timo Sirainen <tss@iki.fi> (ba8ff75)

    lib-storage: Fixed crash if mailbox_save_cancel() was called in
    save_finish()/copy() method.


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2014-04-29 13:10:28 +0300 Timo Sirainen <tss@iki.fi> (b9ec044)

    lib-index: Small code cleanup


M	src/lib-index/mail-index-sync-update.c

2014-04-29 12:35:05 +0300 Timo Sirainen <tss@iki.fi> (a0261d4)

    istream-lf: Cleanup & performance improvement. memchr() is faster than
    lopping through the data ourself.


M	src/lib/istream-crlf.c

2014-04-29 00:53:01 +0300 Timo Sirainen <tss@iki.fi> (fd4eaea)

    dsync: Yet another fix to working with old versions.


M	src/doveadm/dsync/dsync-ibc-stream.c

2014-04-29 00:50:08 +0300 Timo Sirainen <tss@iki.fi> (b8cf3be)

    lib-lda: More smtp-client.h API changes to support multiple destination
    addresses.


M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-lda/smtp-client.h

2014-04-29 00:48:54 +0300 Timo Sirainen <tss@iki.fi> (816fa4d)

    dsync: Fixed new dsync versions to work again with older versions.


M	src/doveadm/dsync/dsync-ibc-stream.c

2014-04-28 20:14:03 +0300 Timo Sirainen <tss@iki.fi> (40440c0)

    dsync: If incremental dsync finds that its state is stale, retry (later)
    with full sync. This works only when the master itself notices such changes
    locally. Remote changes aren't noticed, because the master doesn't send the
    state to remote dsync and the master is also the one that decides which
    mailboxes are synced. The fix to this probably means sending the state
    string to remote dsync and have it check if the state is still valid (=
    protocol change).


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-transaction-log-scan.c

2014-04-28 20:10:56 +0300 Timo Sirainen <tss@iki.fi> (7d31528)

    dsync: Include messages_count in the mailbox states. This allows detecting
    that stateful dsync can't be done when message count is suddenly wrong.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-state.h

2014-04-28 19:12:01 +0300 Timo Sirainen <tss@iki.fi> (089acbf)

    dsync: Finished previous change to actually compile


M	src/doveadm/dsync/dsync-brain-private.h

2014-04-28 18:34:27 +0300 Timo Sirainen <tss@iki.fi> (f59c166)

    doveadm replicator add <user mask> command added. This allows quickly adding
    users from userdb that don't exist in replicator. For example "doveadm
    replicator add '*'" adds all the new users from userdb.

    This isn't really necessary though. Users will be automatically added as 
    soon as their mailboxes change in some way and replicator gets notified 
    about them.

M	src/doveadm/doveadm-replicator.c
M	src/replication/replicator/Makefile.am
M	src/replication/replicator/doveadm-connection.c
A	src/replication/replicator/replicator-queue-auth.c
M	src/replication/replicator/replicator-queue.h
M	src/replication/replicator/replicator.c

2014-04-28 18:24:04 +0300 Timo Sirainen <tss@iki.fi> (466d1b7)

    dsync: If dsync was started via doveadm-server, show the remote client's IP
    address in ps output.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h

2014-04-27 19:05:38 +0300 Stephan Bosch <stephan@rename-it.nl> (b36e026)

    lib-http: http-client: Prevented http_client_request_continue_payload() from
    segfaulting when the callback sets the request pointer to NULL.


M	src/lib-http/http-client-request.c

2014-04-27 19:05:35 +0300 Stephan Bosch <stephan@rename-it.nl> (0d5c9a8)

    lib-http: http-client: Forgot to switch dns-client io_loop in
    http_client_request_continue_payload() in ealier change (6c3bd941e153).


M	src/lib-http/http-client-request.c

2014-04-26 22:40:14 +0300 Stephan Bosch <stephan@rename-it.nl> (880230b)

    lib-http: Fixed problem with connections idling indefinitely. Forgot to
    check for idle connections when request finished after waiting for payload
    to be read by application.


M	src/lib-http/http-client-connection.c

2014-04-25 19:01:09 +0300 Timo Sirainen <tss@iki.fi> (ea2c9ff)

    lib-http: Better error handling fix for payload read/write failures


M	src/lib-http/http-client-request.c

2014-04-25 18:55:31 +0300 Timo Sirainen <tss@iki.fi> (5777eef)

    lib-http: Failed payload read/write error was handled wrongly as "stream
    input size changed".


M	src/lib-http/http-client-request.c

2014-04-25 18:03:36 +0300 Timo Sirainen <tss@iki.fi> (d5e839a)

    iostream-temp: Improved stream naming.


M	src/lib/iostream-temp.c

2014-04-25 17:29:18 +0300 Timo Sirainen <tss@iki.fi> (cd8a262)

    Compiler warning fixes


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-04-25 17:28:39 +0300 Timo Sirainen <tss@iki.fi> (e475db8)

    dsync: Added more debug output


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain.c

2014-04-25 16:35:51 +0300 Timo Sirainen <tss@iki.fi> (eac7ab8)

    doveadm dump: Added support for mobox extensions in dovecot.index.


M	src/doveadm/doveadm-dump-index.c

2014-04-25 16:18:09 +0300 Timo Sirainen <tss@iki.fi> (290ef51)

    lib-lda: Use the new smtp_client_init(), not _open()


M	src/lib-lda/mail-send.c

2014-04-25 16:15:20 +0300 Timo Sirainen <tss@iki.fi> (829b29f)

    lib-lda: When non-RCPT/DATA command fails permanently, translate it
    internally to temporary failure. We shouldn't be answering permanent
    failures to RCPT/DATA command when the failure really had nothing to do with
    the recipient/content itself. Most likely it's just some server
    misconfiguration, which should be treated as temporary error.


M	src/lib-lda/lmtp-client.c

2014-04-25 15:57:03 +0300 Timo Sirainen <tss@iki.fi> (b78d055)

    lib-lda: mail_send_rejection() logs permanent rejections now with info
    level. There's no need to log an error when return-path is invalid.


M	src/lib-lda/mail-send.c

2014-04-25 15:54:49 +0300 Timo Sirainen <tss@iki.fi> (d9424f3)

    lib-lda: Added new smtp_client_init/deinit() APIs The new API allows better
    error handling.


M	src/lib-lda/smtp-client.c
M	src/lib-lda/smtp-client.h

2014-04-25 15:52:37 +0300 Timo Sirainen <tss@iki.fi> (2262531)

    safe_memset(size=0) triggered read access to data[0], possibly crashing.


M	src/lib/safe-memset.c

2014-04-25 15:46:20 +0300 Timo Sirainen <tss@iki.fi> (b754056)

    lib-http: Added more information to "stream input size changed" error


M	src/lib-http/http-client-request.c

2014-04-25 15:31:08 +0300 Timo Sirainen <tss@iki.fi> (3a61b68)

    lib-lda: Removed unused mail_send_forward()


M	src/lib-lda/mail-send.c
M	src/lib-lda/mail-send.h

2014-04-25 10:49:45 +0300 Timo Sirainen <tss@iki.fi> (66f7fc5)

    dsync: If a parent \Noselect gets autocreated, don't fail later when trying
    to re-create it.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2014-04-24 18:18:42 +0300 Timo Sirainen <tss@iki.fi> (3ef4aca)

    dsync: Fixed high data stack memory usage


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-04-24 13:49:25 +0300 Timo Sirainen <tss@iki.fi> (f20e7fb)

    i_stream_read_next_line(): Set also errno=ENOBUFS on too large line. Some
    callers assume that errno is set to same as istream->stream_errno


M	src/lib/istream.c

2014-04-23 23:26:49 +0300 Timo Sirainen <tss@iki.fi> (ab779ef)

    director: Fixed handling weak users when there were exactly 2 director
    servers in the ring.


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c
M	src/director/director.h

2014-04-23 22:33:48 +0300 Timo Sirainen <tss@iki.fi> (e256ae4)

    doveadm director map -u: Don't connect to director socket, it's not needed.


M	src/doveadm/doveadm-director.c

2014-04-23 22:30:28 +0300 Timo Sirainen <tss@iki.fi> (3957200)

    doveadm director map: Added -h and -u parameters to quickly map between
    username and hash.


M	src/doveadm/doveadm-director.c

2014-04-23 22:15:28 +0300 Timo Sirainen <tss@iki.fi> (cac1959)

    doveadm director map: Show also the username hash.


M	src/doveadm/doveadm-director.c

2014-04-23 22:13:08 +0300 Timo Sirainen <tss@iki.fi> (6d568a2a)

    director: When logging about request timeout, log also the username hash.


M	src/director/director-request.c

2014-04-23 20:55:04 +0300 Timo Sirainen <tss@iki.fi> (f57e4c0)

    doveadm replicator replicate: Added -f parameter to force a full sync for
    user.


M	src/doveadm/doveadm-replicator.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue.h

2014-04-23 20:53:55 +0300 Timo Sirainen <tss@iki.fi> (cb9d0f3)

    doveadm replicator replicate: -p parameter wasn't working correctly. We were
    just replicating the "-p" as the username.


M	src/doveadm/doveadm-replicator.c

2014-04-23 19:21:40 +0300 Timo Sirainen <tss@iki.fi> (5b59eec)

    dsync: Added assert


M	src/doveadm/dsync/dsync-ibc-stream.c

2014-04-23 19:20:23 +0300 Timo Sirainen <tss@iki.fi> (dc4f9e0)

    dsync: When initializing via doveadm-server, change the iostream buffer
    sizes to unlimited.


M	src/doveadm/dsync/doveadm-dsync.c

2014-04-23 19:19:24 +0300 Timo Sirainen <tss@iki.fi> (556f950)

    Added o_stream_get_max_buffer_size()


M	src/lib/ostream.c
M	src/lib/ostream.h

2014-04-23 16:45:10 +0300 Timo Sirainen <tss@iki.fi> (a385399)

    virtual: Fixed assert-crash in IDLE caused by earlier changes. This change
    negates all the improvements of the earlier changes when IDLE is used. This
    could be fixed by using mailbox-list-notify.h API.


M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c

2014-04-23 16:31:36 +0300 Timo Sirainen <tss@iki.fi> (3e1d945)

    virtual: Delay initializing search args until the mailbox is actually
    opened. Fixes assert-crash caused by recent changes when virtual mailbox
    search args contained e.g. keywords.


M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c

2014-04-22 13:15:21 +0300 Timo Sirainen <tss@iki.fi> (b13a8e1)

    safe_memset() wasn't safe with modern compilers anymore. Another try based
    on David Jacobson's code in
    https://www.mail-archive.com/openssl-dev@openssl.org/msg34134.html :

    """ Since vs points to a volatile, the load in the while clause actually has
    to be done. That forces the compiler to actually store c into at least the
    byte that is tested, in practice byte zero. But the fact that the index is 
    volatile zero, and since it is volatile it could spontaneously change to 
    anything, the compiler has to store c into all bytes.

    The key observation is that while you can't pass a volatile to memset (you 
    get a warning and the volatile gets stripped away), you can use a volatile 
    in a test that could go the wrong way if the memset were elided.
    """

M	src/lib/safe-memset.c

2014-04-19 11:23:18 +0200 Stephan Bosch <stephan@rename-it.nl> (67e0afe)

    connection: Added support for creating a stream from input/output stream
    pair.


M	src/lib/connection.c
M	src/lib/connection.h

2014-04-19 11:21:47 +0200 Timo Sirainen <tss@iki.fi> (856ae2a)

    lib-http: Fixed resource leaks in http_client_wait() occurring a dns_client
    is used. If all DNS lookups finished before the end of the wait cycle, the
    dns_client would not be switched back to the original ioloop.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client.c
M	src/lib-http/test-http-client.c

2014-04-19 11:21:19 +0200 Timo Sirainen <tss@iki.fi> (994a2b0)

    lib-dns: Added dns_client_switch_ioloop().


M	src/lib-dns/dns-lookup.c
M	src/lib-dns/dns-lookup.h

2014-04-19 11:07:45 +0200 Timo Sirainen <tss@iki.fi> (7cb40f2)

    ioloop: Fixed segfault crash in io_loop_call_pending(). When a callback
    called io_set_pending(), the io_loop_call_pending() loop crossed the end of
    the ioloop->io_files list.

    Based on patch by Stephan Bosch

M	src/lib/ioloop.c

2014-04-17 16:42:02 +0200 Timo Sirainen <tss@iki.fi> (57b523e)

    fts-lucene: Added mime_parts parameter to index MIME parts as separate
    documents. This is in preparation for being able to actually read such
    information and show it to clients via some new IMAP extension.

    Also it might be better to index some MIME parts together to avoid wasting 
    disk space, but for now this is all or nothing. For example anything that is
    "message body" could probably be indexed without the part number at all.

M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h

2014-04-17 16:35:05 +0200 Timo Sirainen <tss@iki.fi> (ad39515)

    fts-lucene: Fixed "doveadm dump" crash when built with stemmer


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-04-17 16:18:02 +0200 Timo Sirainen <tss@iki.fi> (3e7c452)

    lib-mail: Compile fix for last change..


M	src/lib-mail/message-part.c

2014-04-17 16:12:00 +0200 Timo Sirainen <tss@iki.fi> (69111aa)

    fts: Added message_part to fts_backend_build_key. This allows FTS backends
    to index MIME parts separately from each others.


M	src/plugins/fts/fts-api.h
M	src/plugins/fts/fts-build-mail.c

2014-04-17 16:09:52 +0200 Timo Sirainen <tss@iki.fi> (6b8d5b8)

    lib-mail: Added support for struct message_part <-> index number
    translations.


M	src/lib-mail/Makefile.am
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
A	src/lib-mail/message-part.c
M	src/lib-mail/message-part.h
A	src/lib-mail/test-message-part.c

2014-04-17 16:04:13 +0200 Timo Sirainen <tss@iki.fi> (f684e87)

    lib-mail: Moved struct message_part to a separate message-part.h


M	src/lib-mail/Makefile.am
M	src/lib-mail/message-parser.h
A	src/lib-mail/message-part.h

2014-04-17 14:24:18 +0200 Timo Sirainen <tss@iki.fi> (544a727)

    auth: If passdb/userdb has a name, use it for the log prefix instead of the
    driver name.


M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/auth/auth.c

2014-04-17 14:21:55 +0200 Timo Sirainen <tss@iki.fi> (6135260)

    auth: Use special AUTH_SUBSYS_DB/MECH parameters as auth_request_log*()
    subsystem. This avoids hardcoded strings all over the place and also allows
    assigning the correct passdb/userdb name for log messages generated by
    generic passdb/userdb code, which doesn't know exactly where it was called
    from.


M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/db-checkpassword.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-apop.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-dovecot-token.c
M	src/auth/mech-external.c
M	src/auth/mech-gssapi.c
M	src/auth/mech-login.c
M	src/auth/mech-ntlm.c
M	src/auth/mech-otp.c
M	src/auth/mech-plain.c
M	src/auth/mech-rpa.c
M	src/auth/mech-scram-sha1.c
M	src/auth/mech-skey.c
M	src/auth/mech-winbind.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-pam.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sia.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c

2014-04-17 12:26:46 +0200 Timo Sirainen <tss@iki.fi> (214fc90)

    imapc: Fixed fetching specific headers without imapc_features=fetch-headers


M	src/lib-storage/index/imapc/imapc-mail.c

2014-04-17 10:29:10 +0200 Timo Sirainen <tss@iki.fi> (ce87b64)

    fts: Added fts-parser support for Tika It can be enabled by setting:

    plugin {
     fts_tika = http://localhost:9998/tika/
    }

M	src/plugins/fts/Makefile.am
A	src/plugins/fts/fts-parser-tika.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-parser.h

2014-04-17 10:27:43 +0200 Timo Sirainen <tss@iki.fi> (4682f86)

    fts: Never put text/plain contents through fts-parsers.


M	src/plugins/fts/fts-parser.c

2014-04-17 10:26:11 +0200 Timo Sirainen <tss@iki.fi> (3ad5714)

    fts: Added unload() method to fts-parsers to allow them to cleanup before
    plugin unload.


M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-parser.h
M	src/plugins/fts/fts-plugin.c

2014-04-17 10:17:09 +0200 Timo Sirainen <tss@iki.fi> (a0613a6)

    lib-http: http_client_request_finish_payload() no longer waits for the
    entire result payload. The caller can now read it instead, or just discard
    it by not reading it.


M	src/lib-http/http-client-request.c

2014-04-17 09:45:55 +0200 Timo Sirainen <tss@iki.fi> (f8e6a12)

    fts: Free fts-parser on failures.


M	src/plugins/fts/fts-build-mail.c

2014-04-16 18:19:57 +0200 Timo Sirainen <tss@iki.fi> (c61a85e)

    doveadm replicator dsync-status: Show replication type as "-" for
    non-working dsyncs.


M	src/replication/replicator/doveadm-connection.c

2014-04-16 16:05:12 +0200 Timo Sirainen <tss@iki.fi> (0dfacbe)

    maildir: Added maildir_empty_new setting to avoid keeping mails in new/
    directory. This is useful for example when using an external MDA that calls
    "doveadm index" and the user hasn't opened the mailbox for a long time.

    Also this removes the delay that user may see when opening a rarely accessed 
    mailbox, which renames a ton of files to cur/ while the user is waiting.

M	doc/example-config/conf.d/10-mail.conf
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-settings.h
M	src/lib-storage/index/maildir/maildir-sync.c

2014-04-16 15:44:46 +0200 Timo Sirainen <tss@iki.fi> (b20018e)

    fts-solr: Removed unnecessary code


M	src/plugins/fts-solr/solr-connection.c

2014-04-16 10:40:28 +0200 Timo Sirainen <tss@iki.fi> (8af300d)

    replicator: Improve logging import/export errors.


M	src/replication/replicator/replicator-queue.c

2014-04-16 00:13:42 +0200 Timo Sirainen <tss@iki.fi> (d48fcf2)

    fts-lucene: Fix to previous change. We allocated way too little memory.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-04-16 00:04:29 +0200 Timo Sirainen <tss@iki.fi> (4c0aff9)

    lib-storage: Further changes to mailbox_alloc_guid() caching. We'll now
    cache the GUIDs forever and force invalidation after mailbox rename or when
    mailbox GUIDs have been updated. This is what dsync needs, especially for
    good performance, and currently there aren't any other users for this API.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-list-private.h

2014-04-15 23:44:54 +0200 Timo Sirainen <tss@iki.fi> (d649995)

    lib-storage: mailbox_alloc_guid() shouldn't refresh GUID cache on every
    nonexistent GUID. Refresh it only if we know it has had some changes (made
    by our process) or timestamp has changed. This should handle the cases that
    are currently important (=single dsync run).


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-list-private.h

2014-04-15 23:41:50 +0200 Timo Sirainen <tss@iki.fi> (debafc3)

    dsync: Fix to previous commit to actually compile..


M	src/doveadm/dsync/dsync-brain.c

2014-04-15 23:23:37 +0200 Timo Sirainen <tss@iki.fi> (a4667f4)

    replicator: Fixed crash caused by "doveadm replicator dsync-status" in some
    situations.


M	src/replication/replicator/doveadm-connection.c

2014-04-15 23:02:11 +0200 Timo Sirainen <tss@iki.fi> (f038c71)

    dsync: Fixed giving -n "" followed by other -n parameters.


M	src/doveadm/dsync/dsync-brain.c

2014-04-15 22:28:26 +0200 Timo Sirainen <tss@iki.fi> (37e5638)

    fts-lucene: Don't allocate large amounts of memory from stack. This probably
    only happened for huge header values.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-04-15 18:24:31 +0200 Timo Sirainen <tss@iki.fi> (2e08b12)

    replicator: Added "doveadm replicator dsync-status" command.


M	src/doveadm/doveadm-replicator.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/doveadm-connection.h
M	src/replication/replicator/dsync-client.c
M	src/replication/replicator/dsync-client.h
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-brain.h
M	src/replication/replicator/replicator.c

2014-04-15 17:42:31 +0200 Timo Sirainen <tss@iki.fi> (079951c)

    dsync: If remote command fails, show the full command in the error message.


M	src/doveadm/dsync/doveadm-dsync.c

2014-04-15 17:33:12 +0200 Timo Sirainen <tss@iki.fi> (46d352b)

    doveadm-server: Using any command line parameters caused crashes due to
    missing getopt() reset.


M	src/doveadm/client-connection.c

2014-04-15 17:20:02 +0200 Timo Sirainen <tss@iki.fi> (18a41cb)

    virtual: Delay opening the backend mailboxes until it's really necessary.
    This should improve the performance a lot with mailbox_list_index=yes when
    opening virtual mailboxes whose backend mailboxes are mostly unchanged.


M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c

2014-04-15 17:08:34 +0200 Timo Sirainen <tss@iki.fi> (d8615e0)

    Replaced mail_get_real_mail() callers with mail_get_backend_mail()


M	src/imap/imap-fetch.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2014-04-15 17:06:57 +0200 Timo Sirainen <tss@iki.fi> (541b251)

    lib-storage: Replaced mail_get_real_mail() with mail_get_backend_mail() that
    can fail. For now the mail_get_real_mail() can still be used for backwards
    compatibility.


M	src/lib-storage/fail-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/plugins/virtual/virtual-mail.c

2014-04-15 16:37:26 +0200 Timo Sirainen <tss@iki.fi> (9e6bc7e)

    Removed unused code.


M	src/lib/primes.c

2014-04-15 15:21:37 +0200 Timo Sirainen <tss@iki.fi> (aaf162d)

    lib-storage: Don't open mailbox on mailbox_get_status() if we have no status
    items left to get.


M	src/lib-storage/index/index-status.c

2014-04-15 15:13:28 +0200 Timo Sirainen <tss@iki.fi> (faad8ea)

    lib-storage: Avoid rebuilding the whole mailbox list index when one mailbox
    changes.


M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index.h

2014-04-09 23:19:29 +0300 Timo Sirainen <tss@iki.fi> (92878b8)

    lazy_expunge: If setting is empty, disable the plugin. Instead of assuming
    that we want to use prefix="" as the lazy_expunge namespace, which is highly
    unlikely anyone will ever want to do.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2014-04-09 23:17:09 +0300 Timo Sirainen <tss@iki.fi> (a303625)

    lazy_expunge: If lazy-expunge mailbox open/create fails, show the mailbox
    name in error message.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2014-04-09 18:14:33 +0300 Timo Sirainen <tss@iki.fi> (1240586)

    doveadm backup: Another attempt at fixing assert-crashes when deleting
    mailboxes. Only two-way syncs really care about the mailbox deletion logs
    which set existence=DELETED. So actually the log reading could be skipped
    entirely for doveadm backup to speed things up.

    In any case the code currently relies that after 
    sync_tree_sort_and_delete_mailboxes() the tree no longer has nodes with 
    existence=DELETED and mailbox_guid!=0, because that assert-crashes in 
    sync_create_mailboxes(). The assert() could probably simply be changed into 
    an if(), but might as well keep the code as it was originally intended and 
    not have the sync/backup behave more differently than needed.

M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2014-04-09 17:05:12 +0300 Timo Sirainen <tss@iki.fi> (b9de28c)

    maildir: If GUID can't be preserved in filename due to size change, set it
    in dovecot-uidlist This fixes problems with dsync when zlib is used and
    filenames/GUIDs don't contain (correct) S=sizes.


M	src/lib-storage/index/maildir/maildir-save.c

2014-04-08 17:07:31 +0200 Timo Sirainen <tss@iki.fi> (93ae7fc)

    liblib: Fixed crash using str_c() in different stack frame with str_new(0)
    allocated string.


M	src/lib/str.c
M	src/lib/test-str.c

2014-04-08 08:49:53 +0200 Timo Sirainen <tss@iki.fi> (a14a28a)

    Compiler warning fix


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2014-04-08 00:20:57 +0300 Timo Sirainen <tss@iki.fi> (4885489)

    doveadm backup: Fix to handling mailbox deletions.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2014-04-08 00:09:03 +0300 Timo Sirainen <tss@iki.fi> (a1fff89)

    liblib: Added unit test for t_strsplit(data="")


M	src/lib/strfuncs.h
M	src/lib/test-strfuncs.c

2014-04-08 00:08:21 +0300 Timo Sirainen <tss@iki.fi> (e569900)

    dsync: Fixed using -n "" parameter


M	src/doveadm/dsync/dsync-brain.c

2014-04-04 01:23:29 +0300 Timo Sirainen <tss@iki.fi> (6d9ce72)

    maildir: If istream_opened is set by a plugin, don't try to fix S=size by
    renaming. Although this could be fixed in a nicer way by actually
    calculating the correct S=size and using that for renaming.


M	src/lib-storage/index/maildir/maildir-mail.c

2014-04-04 01:03:17 +0300 Timo Sirainen <tss@iki.fi> (911d873)

    lib-imap-storage: Don't waste effort getting mail's physical size if it
    can't be done quickly.


M	src/lib-imap-storage/imap-msgpart.c

2014-04-04 00:53:34 +0300 Timo Sirainen <tss@iki.fi> (a30fd27)

    lib-imap-storage: Reverted previous change. It broke FETCH BODY
    [n.HEADER.FIELDS ..]


M	src/lib-imap-storage/imap-msgpart.c

2014-04-04 00:30:11 +0300 Timo Sirainen <tss@iki.fi> (d669119)

    lib-imap-storage: Minor code cleanup


M	src/lib-imap-storage/imap-msgpart.c

2014-04-04 00:14:42 +0300 Timo Sirainen <tss@iki.fi> (7e65229)

    maildir: If istream_opened hook is set, don't return stat()ed file size as
    physical size. That's pretty much always wrong. The hook is set with e.g.
    zlib and mail-filter and similar plugins that modify the mail stream.


M	src/lib-storage/index/maildir/maildir-mail.c

2014-04-04 00:13:35 +0300 Timo Sirainen <tss@iki.fi> (e9a1821)

    lib-storage: When trying to get body size quickly, make sure we don't end up
    reading the mail body.


M	src/lib-storage/index/index-mail.c

2014-04-03 23:38:17 +0300 Timo Sirainen <tss@iki.fi> (522925f)

    maildir: Fixed auto-creating INBOX that was missing tmp/ directory (but not
    cur/)


M	src/lib-storage/index/maildir/maildir-storage.c

2014-04-03 19:59:30 +0300 Timo Sirainen <tss@iki.fi> (37703e8)

    Use io_add_istream() wherever possible. This shouldn't fix anything, but
    might make some functionality easier to implement in future.


M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/imap/cmd-append.c
M	src/imap/cmd-idle.c
M	src/imap/imap-client.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c
M	src/lib-http/test-http-client.c
M	src/pop3/pop3-client.c

2014-04-03 19:56:47 +0300 Timo Sirainen <tss@iki.fi> (9937dfc)

    lib-http: Wrap response payload istream into a istream-timeout.


M	src/lib-http/http-client-connection.c
M	src/plugins/fts-solr/solr-connection.c

2014-04-03 19:54:27 +0300 Timo Sirainen <tss@iki.fi> (87da941)

    lib-ssl-iostream: Make sure I/O input event is triggered after ostream-ssl
    has read some data to buffer.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/istream-openssl.c

2014-04-03 19:53:13 +0300 Timo Sirainen <tss@iki.fi> (854b407)

    Added istream-timeout, which triggers I/O event and fails with ETIMEDOUT
    after the timeout.


M	src/lib/Makefile.am
A	src/lib/istream-timeout.c
A	src/lib/istream-timeout.h

2014-04-03 19:51:52 +0300 Timo Sirainen <tss@iki.fi> (4c09661)

    Added io_add_istream() and related functionality for combining the
    ioloop/istream. The idea here is that it's possible to implement
    asynchronous istreams when there isn't a file descriptor that can be used to
    reliably receive updates.


M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
M	src/lib/ioloop.h
M	src/lib/istream-private.h
M	src/lib/istream.c
M	src/lib/istream.h

2014-04-03 19:47:49 +0300 Timo Sirainen <tss@iki.fi> (f922eca)

    ioloop: Added io_set_pending()


M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-kqueue.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-private.h
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2014-04-03 18:21:39 +0300 Timo Sirainen <tss@iki.fi> (22c646f)

    dsync: Don't assert-crash if we have the same mailbox name in conflicting
    namespaces.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c

2014-04-03 14:41:25 +0300 Timo Sirainen <tss@iki.fi> (710129a)

    DEBUG: Make sure errno isn't changed by vsnprintf()/malloc()/free()
    implementations. They shouldn't, so this should only be a sanity check when
    running with devel-checks. Various parts in the code rely on errno not being
    changed by *_strdup_printf() calls.


M	src/lib/data-stack.c
M	src/lib/mempool-system.c
M	src/lib/strfuncs.c

2014-04-03 12:54:18 +0300 Timo Sirainen <tss@iki.fi> (a2738cd)

    i_stream_read(): If stream_errno is set, fail immediately. Previously the
    stream_errno was reset to 0, but this required the istream implementation to
    correctly set the stream_errno back, which wasn't often done.


M	src/lib/istream.c

2014-04-03 12:50:43 +0300 Timo Sirainen <tss@iki.fi> (3866190)

    lib-ssl-iostream: Error handling fix. Don't set last_error="(null)" when the
    connection was simply disconnected.


M	src/lib-ssl-iostream/istream-openssl.c

2014-03-29 22:45:16 +0200 Timo Sirainen <tss@iki.fi> (91c58af)

    fts-sorl: Skip returned duplicate results. Similar to bugfix d63b209737be in
    fts-lucene.

    This caused assert-crash at least when searching from virtual mailbox 
    because the score array was larger than the actual number of results.

M	src/plugins/fts-solr/solr-connection.c

2014-03-28 15:59:48 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (ba67225)

    pop3: Fixed off-by-one bug in the sequence number fix of d20059f7d3a1.


M	src/pop3/pop3-commands.c

2014-03-28 15:31:06 +0200 Timo Sirainen <tss@iki.fi> (bf2760c)

    lib-fs: posix backend now names the istreams with the file's path.


M	src/lib-fs/fs-posix.c

2014-03-28 15:29:53 +0200 Timo Sirainen <tss@iki.fi> (c449e0b)

    lib-fs: ostream-metawrap shouldn't count metadata header as part of the
    stream offsets.


M	src/lib-fs/ostream-metawrap.c

2014-03-27 16:00:49 +0100 Timo Sirainen <tss@iki.fi> (ec13aa1)

    lib-fs: ostream-metawrap didn't update the output stream's offset


M	src/lib-fs/ostream-metawrap.c

2014-03-27 14:57:44 +0100 Timo Sirainen <tss@iki.fi> (890217a)

    dovecot.m4: Minor message improvement.


M	dovecot.m4

2014-03-27 15:39:33 +0200 Timo Sirainen <tss@iki.fi> (d0f9c91)

    lib-fs: Fixes to posix backend's FS_OPEN_MODE_CREATE_UNIQUE_128 handling.


M	src/lib-fs/fs-posix.c

2014-03-27 14:37:10 +0100 Timo Sirainen <tss@iki.fi> (fae3091)

    mdbox: Don't hoard file descriptors when saving mails that are larger than
    mdbox_rotate_size.


M	src/lib-storage/index/dbox-multi/mdbox-map.c

2014-03-27 13:25:12 +0100 Timo Sirainen <tss@iki.fi> (bb4045c)

    dsync: Optimization for a large number of mails with the same GUID. Still
    not ideal, but better than before.


M	src/doveadm/dsync/dsync-mailbox-import.c

2014-03-27 10:02:08 +0100 Timo Sirainen <tss@iki.fi> (e1550f6)

    doveadm director move/map: Use director_username_hash setting for
    calculating hashes.


M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h

2014-03-26 16:17:34 +0100 Timo Sirainen <tss@iki.fi> (028a1c8)

    lib-http: Fixed a hang Patch by Stephan Bosch


M	src/lib-http/http-client-queue.c

2014-03-26 14:41:05 +0100 Timo Sirainen <tss@iki.fi> (ee3c2fb)

    lib-http: Added debug logging.


M	src/lib-http/http-client-queue.c

2014-03-25 19:59:24 +0200 Timo Sirainen <tss@iki.fi> (d487aa8)

    dsync: Support multiple -n parameters.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h

2014-03-24 19:07:03 +0100 Timo Sirainen <tss@iki.fi> (e160527)

    dsync: Fixed matching namespace for the namespace prefix itself.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c

2014-03-21 17:52:50 +0200 Timo Sirainen <tss@iki.fi> (7586eb9)

    imapc: Cache LIST replies for a while to be able to immediately ask for
    mailbox flags/existence. Besides giving better performance, this will fix
    bugs in some servers where LISTing a single mailbox doesn't necessarily
    return it. (In this case a mailbox named "in" wasn't returned, but I think
    Dovecot has had bugs related to this also.)


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
M	src/lib-storage/index/imapc/imapc-sync.c

2014-03-20 17:07:32 +0200 Timo Sirainen <tss@iki.fi> (07c8b1b)

    dsync: Avoid unnecessary data stack memory usage.


M	src/doveadm/dsync/dsync-mailbox-export.c

2014-03-20 17:00:31 +0200 Timo Sirainen <tss@iki.fi> (fda7b36)

    imapc: Avoid hanging when running into server problems.
    imapc_mail_fetch_flush() caused imail->fetch_count to drop to 0, but
    imapc_mailbox_run() still started imapc_client_run() which was doing
    nothing.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2014-03-20 16:15:24 +0200 Timo Sirainen <tss@iki.fi> (b7a6726)

    imapc: Fixed crash when FETCH command immediately failed due to connection
    error.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2014-03-19 15:42:42 +0200 Timo Sirainen <tss@iki.fi> (65c7451)

    passdb-imap: Fixed reference counting.


M	src/auth/passdb-imap.c

2014-03-19 09:45:15 +0200 Timo Sirainen <tss@iki.fi> (eb2091a)

    lib-dns: Fixed handling failed DNS lookups.


M	src/lib-dns/dns-lookup.c

2014-03-18 16:49:10 +0200 Timo Sirainen <tss@iki.fi> (f567e9a)

    maildir: Fixed looking up physical size for a mail while it's being saved.
    Based on patch by Teemu Huovila.


M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-storage.h

2014-03-18 14:39:15 +0200 Timo Sirainen <tss@iki.fi> (30fe81b)

    auth: Added login_user extra field to change the username in master passdb.


M	src/auth/auth-request.c

2014-03-17 16:57:36 +0200 Timo Sirainen <tss@iki.fi> (1bc529e)

    test-var-expand: Added more unit tests for %variable offsets/lengths.


M	src/lib/test-var-expand.c

2014-03-17 16:57:21 +0200 Timo Sirainen <tss@iki.fi> (6eb191b)

    liblib: Added negative %variable lengths to count backwards from the end of
    the value. For example %0.-2 for "12345" returns "123". Patch by Norbert
    Weinhold / Open-Xchange.


M	src/lib/var-expand.c

2014-03-12 14:09:14 +0200 Timo Sirainen <tss@iki.fi> (65af923)

    auth: Don't disconnect auth-worker during long-running user iterations.


M	src/auth/auth-worker-server.c

2014-03-12 12:26:09 +0200 Timo Sirainen <tss@iki.fi> (d6bffcd)

    auth worker: Log a warning if master disconnects us while handling a long
    request.


M	src/auth/auth-worker-client.c

2014-03-12 12:19:09 +0200 Timo Sirainen <tss@iki.fi> (c0757c7)

    auth worker: Log a warning if master disconnects us while handling a long
    request.


M	src/auth/auth-worker-client.c

2014-03-12 11:53:49 +0200 Timo Sirainen <tss@iki.fi> (f08c6da)

    auth: If auth-worker lookup times out, log a bit more details about it.


M	src/auth/auth-worker-server.c
M	src/auth/auth-worker-server.h
M	src/auth/passdb-blocking.c
M	src/auth/userdb-blocking.c

2014-03-11 13:26:33 +0200 Timo Sirainen <tss@iki.fi> (49c848c)

    fts-lucene: Skip returned duplicate results. This caused assert-crash at
    least when searching from virtual mailbox because the score array was larger
    than the actual number of results.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2014-03-11 00:39:27 +0200 Timo Sirainen <tss@iki.fi> (8776322)

    mdbox: Added mdbox_purge_preserve_alt setting to keep the file within alt
    storage during purge. Perhaps it would be better for this setting to be the
    default in v2.3 and maybe be removed entirely? Not a good idea to change
    during v2.2.x anyway, so for now this is a setting.


M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.h

2014-03-04 17:11:49 +0200 Timo Sirainen <tss@iki.fi> (28099d0)

    lib-storage: Fixed assert-crash in mailbox rename with layout=index


M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2014-02-24 12:30:51 -0600 Timo Sirainen <tss@iki.fi> (6f59bc9)

    lib-storage: Fixed support for list=no prefix="" listing. This behavior
    works with e.g. Outlook where it's allowed to CREATE and LIST the
    Sent/Trash/etc mailboxes to root level, even though the primary namespace
    has a prefix.


M	src/lib-storage/list/mailbox-list-iter.c

2014-02-24 11:29:52 -0600 Timo Sirainen <tss@iki.fi> (432f2b6)

    imap: Return SPECIAL-USE flags for LSUB command.


M	src/imap/cmd-list.c

2014-02-19 14:54:16 -0800 Timo Sirainen <tss@iki.fi> (7cc2591)

    auth: Don't crash if passdb passwd-file is used without any userdbs.


M	src/auth/db-passwd-file.c

2014-02-15 10:41:29 +0900 Timo Sirainen <tss@iki.fi> (5794def)

    lib-index: Minor code cleanup The previous calculation was correct also
    though.


M	src/lib-index/mail-cache-fields.c

2014-02-13 23:36:14 +0200 Timo Sirainen <tss@iki.fi> (1d099cf)

    Added signature for changeset 8e4433702920


M	.hgsigs

2014-02-13 23:36:09 +0200 Timo Sirainen <tss@iki.fi> (fc1dcbf)

    Added tag 2.2.12 for changeset 8e4433702920


M	.hgtags

2014-02-13 23:36:03 +0200 Timo Sirainen <tss@iki.fi> (c98761c)

    Released v2.2.12.


M	NEWS
M	configure.ac

2014-02-13 05:33:13 +0200 Teemu Huovila <teemu.huovila@dovecot.fi> (905320d)

    pop3: Access sequence numbers correctly.


M	src/pop3/pop3-commands.c

2014-02-12 00:51:17 +0200 Timo Sirainen <tss@iki.fi> (d5e2885)

    Added signature for changeset 6b96eb75ded2


M	.hgsigs

2014-02-12 00:51:10 +0200 Timo Sirainen <tss@iki.fi> (d693a42)

    Added tag 2.2.11 for changeset 6b96eb75ded2


M	.hgtags

2014-02-12 00:51:10 +0200 Timo Sirainen <tss@iki.fi> (bd38792)

    Released v2.2.11.


M	NEWS
M	configure.ac

2014-02-12 07:14:58 +0900 Timo Sirainen <tss@iki.fi> (f87daf8)

    acl: Recent changes caused global ACL filenames to be looked up with real
    mailbox names, not vnames.


M	src/plugins/acl/acl-backend-vfile.c

2014-02-07 15:53:54 -0500 Timo Sirainen <tss@iki.fi> (3190f12)

    auth: Allow auth_verbose_passwords=yes as an alias for "plain".


M	src/auth/auth-settings.c

2014-02-07 15:53:32 -0500 Timo Sirainen <tss@iki.fi> (a5bcc9f)

    auth: Fixed crash/NULL error if auth_verbose_passwords had an invalid value.


M	src/auth/auth-settings.c

2014-02-07 15:44:10 -0500 Timo Sirainen <tss@iki.fi> (29ba468)

    lib-http: Fixed test-http-url not to crash with some libcs Those that crash
    when %s attempts to print NULL.


M	src/lib-http/test-http-url.c

2014-02-07 15:36:15 -0500 Timo Sirainen <tss@iki.fi> (22e7404)

    acl: Fixed assert-crash when using the new global ACL file.


M	src/plugins/acl/acl-backend-vfile.c

2014-02-07 15:03:33 -0500 Timo Sirainen <tss@iki.fi> (d4867da)

    pop3: Use POP3 order sorting only when directly listing UIDLs. "Message
    ordering changed unexpectedly" errors can be completely avoided by using
    either pop3_lock_session=yes or adding %u to pop3_logout_format.


M	src/pop3/pop3-commands.c

2014-02-07 14:24:44 -0500 Timo Sirainen <tss@iki.fi> (58f5b46)

    doveadm fetch: Added pop3.order field.


M	src/doveadm/doveadm-mail-fetch.c

2014-02-07 17:17:25 +0200 Timo Sirainen <tss@iki.fi> (2c73831)

    doveadm user: Don't crash if multiple mask parameters are given with at
    least one wildcard.


M	src/doveadm/doveadm-auth.c

2014-02-05 11:57:35 -0500 Timo Sirainen <tss@iki.fi> (c9c7624)

    Copyright updated to 2014 in two more places


M	src/doveadm/doveadm-mail-batch.c
M	src/lib/test-str.c

2014-02-04 18:17:35 -0500 Teemu Huovila <teemu.huovila@dovecot.fi> (efd203f)

    lib-compression: Add assert for LZ4_compress return value. Make certain we
    detect if compressed data overflows the allocated space.


M	src/lib-compression/ostream-lz4.c

2014-02-04 16:23:22 -0500 Timo Sirainen <tss@iki.fi> (a8c5a86)

    Updated copyright notices to include year 2014.


M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-fields.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-token.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-dict-cache-key.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-dovecot-token.c
M	src/auth/mech-external.c
M	src/auth/mech-plain.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-template.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c
M	src/auth/test-auth-cache.c
M	src/auth/test-db-dict.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-template.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-pw.c
M	src/doveadm/doveadm-replicator.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-deserializer.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox.c
M	src/doveadm/dsync/dsync-serializer.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-login-settings.c
M	src/imap-urlauth/imap-urlauth-login.c
M	src/imap-urlauth/imap-urlauth-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap-urlauth/imap-urlauth.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-genurlauth.c
M	src/imap/cmd-getmetadata.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-resetkey.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-setmetadata.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-urlfetch.c
M	src/imap/cmd-x-cancel.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-list.c
M	src/imap/imap-metadata.c
M	src/imap/imap-notify.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-settings.c
M	src/indexer/indexer-worker-settings.c
M	src/indexer/indexer-worker.c
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-pool.c
M	src/ipc/client.c
M	src/ipc/ipc-connection.c
M	src/ipc/ipc-group.c
M	src/ipc/ipc-settings.c
M	src/ipc/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-compression/compression.c
M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.c
M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-lzma.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-dict/dict-cdb.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-fs.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-register.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict-transaction-memory.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/istream-fs-file.c
M	src/lib-fs/istream-metawrap.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-fs/ostream-metawrap.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-date.c
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-header.c
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-parser.c
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-url.c
M	src/lib-http/test-http-client.c
M	src/lib-http/test-http-date.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-request-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-server.c
M	src/lib-http/test-http-transfer.c
M	src/lib-http/test-http-url.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-bodystructure.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-quote.c
M	src/lib-imap/test-imap-url.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/mail-user-hash.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-binary-part.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-size.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-mail/test-istream-binary-converter.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service.c
M	src/lib-master/mountpoint-list.c
M	src/lib-master/syslog-util.c
M	src/lib-sasl/dsasl-client.c
M	src/lib-sasl/mech-login.c
M	src/lib-sasl/mech-plain.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/fail-mail.c
M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-deleted-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-list-index.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-notify-tree.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list-notify.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/test-mailbox-get.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base64.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/compat.c
M	src/lib/connection.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fd-set-nonblock.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/guid.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-temp.c
M	src/lib/iostream.c
M	src/lib/ipwd.c
M	src/lib/iso8601-date.c
M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/istream-hash.c
M	src/lib/istream-jsonstr.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/istream-sized.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/json-parser.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/net.c
M	src/lib/nfs-workarounds.c
M	src/lib/numpack.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream-hash.c
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/primes.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base64.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-hash-format.c
M	src/lib/test-hex-binary.c
M	src/lib/test-iso8601-date.c
M	src/lib/test-istream-base64-decoder.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-json-parser.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-network.c
M	src/lib/test-numpack.c
M	src/lib/test-ostream-file.c
M	src/lib/test-primes.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-time-util.c
M	src/lib/test-unichar.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/time-util.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/uri-util.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/doveadm-connection.c
M	src/log/log-connection.c
M	src/log/log-error-buffer.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/capabilities-posix.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search-serialize.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/xml2text.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-filter/istream-ext-filter.c
M	src/plugins/mail-filter/mail-filter-plugin.c
M	src/plugins/mail-filter/ostream-ext-filter.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/mailbox-alias/mailbox-alias-plugin.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-storage.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-status.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/replication/aggregator/aggregator-settings.c
M	src/replication/aggregator/aggregator.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/dsync-client.c
M	src/replication/replicator/notify-connection.c
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-openssl.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/stats/client-export.c
M	src/stats/client.c
M	src/stats/global-memory.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-server-connection.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.c
M	src/stats/mail-user.c
M	src/stats/main.c
M	src/stats/stats-settings.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2014-02-03 12:42:13 -0500 Timo Sirainen <tss@iki.fi> (2b70e45)

    imap: SEARCH/SORT PARTIAL reponses may have been too large.


M	src/imap/imap-search.c

2014-02-03 12:04:19 -0500 Timo Sirainen <tss@iki.fi> (f38430b)

    imapc: Fixed assert-crash when listing INBOX and imapc_list_prefix was set.


M	src/lib-storage/index/imapc/imapc-list.c

2014-02-03 11:50:49 -0500 Timo Sirainen <tss@iki.fi> (aea7f72)

    doveadm backup: Fixed assert-crash when syncing mailbox deletion.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2014-02-03 11:50:10 -0500 Timo Sirainen <tss@iki.fi> (bf43cf3)

    dsync: Added extra asserts


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2014-02-03 11:38:40 -0500 Timo Sirainen <tss@iki.fi> (32142dc)

    test-istream-concat unit test improved. Still pretty ugly to test with
    randomness, but at least it caught the bug in v2.1.


M	src/lib/test-istream-concat.c

2014-02-03 10:53:59 -0500 Timo Sirainen <tss@iki.fi> (2200ade)

    pop3-migration: If UIDLs can't be set, fail unless
    pop3_migration_ignore_missing_uidls=yes.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2014-02-03 10:49:03 -0500 Timo Sirainen <tss@iki.fi> (8c3872c)

    pop3-migration: Convert NULs to 0x80 chars in header when hashing. This
    should help at least with Dovecot and I think also with UW-IMAP/POP3.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2014-02-03 10:47:31 -0500 Timo Sirainen <tss@iki.fi> (31fd39a)

    pop3-migration: Work around IMAP/POP3 server bugs which truncate the header
    too early.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2014-01-31 02:12:30 +0100 Timo Sirainen <tss@iki.fi> (dc27f5f)

    doveadm auth cache flush: Fixed broken default auth-master path. Broken by
    c41700c4a9bb. Patch by Chris Moules.


M	src/doveadm/doveadm-auth.c

2014-01-30 22:03:40 +0100 Timo Sirainen <tss@iki.fi> (e3d5744)

    net_transmit() may have wrongly returned EPIPE error. If errno was EPIPE
    before net_transmit() was called and sendto() didn't change it, we still
    returned error.

    Also removed the unlikely() call which isn't all that unlikely for 
    non-blocking code.

M	src/lib/net.c

2014-01-30 03:38:57 +0100 Teemu Huovila <teemu.huovila@dovecot.fi> (6649668)

    lib-compression: Fixed LZ4 maximum output buffer size


M	src/lib-compression/ostream-lz4.c

2014-01-27 16:35:46 +0200 Timo Sirainen <tss@iki.fi> (4c15840)

    acl plugin: Added an alternative global ACL file that can contain mailbox
    patterns. Instead of pointing the global ACL path to a directory use a file
    instead. The file format is "<mailbox pattern> <normal ACL line>". Most
    importantly this can be used to specify default ACLs for namespaces.

    The mailbox pattern uses "*" and "?" wildcards currently. I'm not sure if I 
    should still change them to IMAP "*" and "%" wildcards. That would make the 
    behavior more complex ("%" depends on hierarchy separator), slightly slower 
    and quota code is already also using the */? wildcards..

M	src/plugins/acl/Makefile.am
M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-api.h
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend-vfile.h
A	src/plugins/acl/acl-global-file.c
A	src/plugins/acl/acl-global-file.h

2014-01-27 14:25:03 +0200 Timo Sirainen <tss@iki.fi> (131b0d2)

    lib-compression: Assert-crashfix to handling EOF in LZ4 compression


M	src/lib-compression/istream-lz4.c

2014-01-17 17:36:29 -0500 Timo Sirainen <tss@iki.fi> (7196629)

    acl: Minor macro naming cleanup


M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend-vfile.h

2014-01-17 17:33:47 -0500 Timo Sirainen <tss@iki.fi> (086c52e)

    acl: Moved acl_rights array from vfile-specific code to generic struct
    acl_object.


M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile-update.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend-vfile.h

2014-01-17 16:23:49 -0500 Timo Sirainen <tss@iki.fi> (15f43b1)

    acl: More code cleanups.


M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile-update.c
M	src/plugins/acl/acl-backend-vfile.c

2014-01-17 16:10:56 -0500 Timo Sirainen <tss@iki.fi> (cc287b8)

    acl: Code cleanup by moving around the code and renaming functions.


M	src/plugins/acl/Makefile.am
M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
A	src/plugins/acl/acl-backend-vfile-update.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend-vfile.h

2014-01-15 16:44:04 -0500 Timo Sirainen <tss@iki.fi> (6b35ba7)

    liblib: Added str_unescape_next()


M	src/lib/strescape.c
M	src/lib/strescape.h
M	src/lib/test-strescape.c

2014-01-15 15:57:50 -0500 Timo Sirainen <tss@iki.fi> (77bd459)

    stats plugin: Fixed updating clock_time


M	src/plugins/stats/stats-plugin.c

2014-01-15 15:54:14 -0500 Timo Sirainen <tss@iki.fi> (12af04a)

    stats: Also export the clock_time to doveadm.


M	src/stats/client-export.c

2014-01-15 15:50:38 -0500 Timo Sirainen <tss@iki.fi> (6013161)

    stats: Track clock time as well as user/sys CPU time.


M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h
M	src/stats/mail-stats.c
M	src/stats/mail-stats.h

2014-01-15 22:11:22 +0200 Timo Sirainen <tss@iki.fi> (ef4d0ea)

    lib-index: Keep track of views and transactions in linked lists. This makes
    debugging easier.


M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-view-private.h
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index.c

2014-01-15 15:07:50 -0500 Timo Sirainen <tss@iki.fi> (c3ad163)

    imap-proxy: Fixed resetting proxy state after failed login.


M	src/imap-login/imap-proxy.c

2014-01-15 15:03:22 -0500 Timo Sirainen <tss@iki.fi> (41783dc)

    imap-proxy: Recent changes caused CAPABILITY repeating with pipelining
    disabled.


M	src/imap-login/client.h
M	src/imap-login/imap-proxy.c

2014-01-15 03:49:42 +0200 Timo Sirainen <tss@iki.fi> (463d529)

    Makefile: Added missing iostream-lz4.h


M	src/lib-compression/Makefile.am

2014-01-15 00:57:59 +0200 Timo Sirainen <tss@iki.fi> (a49d1c2)

    lib-compression: Added initial support for LZ4 There's no standard file
    format for LZ4, so we created our own. The code has had only minimal testing
    currently, so there may be bugs.


M	configure.ac
M	src/lib-compression/Makefile.am
M	src/lib-compression/compression.c
A	src/lib-compression/iostream-lz4.h
A	src/lib-compression/istream-lz4.c
M	src/lib-compression/istream-zlib.h
A	src/lib-compression/ostream-lz4.c
M	src/lib-compression/ostream-zlib.h

2014-01-15 00:28:35 +0200 Timo Sirainen <tss@iki.fi> (84740b0)

    lib-http: Added http_client_request_remove_header()


M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2014-01-15 00:28:20 +0200 Timo Sirainen <tss@iki.fi> (4928761)

    lib-http: Allow calling http_client_request_add_header() when retrying
    requests.


M	src/lib-http/http-client-request.c

2014-01-14 03:33:35 +0200 Timo Sirainen <tss@iki.fi> (dd620bc)

    *-login: Fix to previous commit: Default auth_user to original_user


M	src/login-common/client-common.c

2014-01-14 03:24:47 +0200 Timo Sirainen <tss@iki.fi> (2f90189)

    auth, login, mail: Added %{auth_user}, %{auth_username} and %{auth_domain}
    They expand to the SASL authentication ID. So if master user login is done,
    it expands to the master user. If username changes during authentication, it
    expands to the original username. Otherwise %{user} and %{auth_user} are
    equal.


M	src/auth/auth-request-handler.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2014-01-14 02:43:09 +0200 Timo Sirainen <tss@iki.fi> (0693f78)

    auth: Send original_user to auth client also when there aren't any extra
    fields.


M	src/auth/auth-request-handler.c

2014-01-13 15:58:13 -0500 Timo Sirainen <tss@iki.fi> (7756f8e)

    dbox: Removed unused code.


M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-multi/mdbox-file.c

2014-01-13 22:44:34 +0200 Timo Sirainen <tss@iki.fi> (fb176cd)

    iostream-temp: Support o_stream_pwrite()


M	src/lib/iostream-temp.c

2014-01-13 20:57:12 +0200 Timo Sirainen <tss@iki.fi> (244d1dd)

    doveadm fs delete: Fixed non-recursive deletion broken by previous commit


M	src/doveadm/doveadm-fs.c

2014-01-10 15:00:39 -0500 Stephan Bosch <stephan@rename-it.nl> (b4d90cf)

    http: Improved HTTP header parser state machine and error messages.


M	src/lib-http/http-header-parser.c

2014-01-10 15:00:28 -0500 Stephan Bosch <stephan@rename-it.nl> (e0cf44f)

    lib-http: Added option to the header parser to make it lenient towards
    illegal characters in header field content. The offending characters are
    then skipped without error. This is required for the http client as a
    workaround for bugs in certain HTTP servers. This behavior is explicitly not
    enabled for the http-request-parser as used by our own HTTP server
    implementation.


M	src/lib-http/http-header-parser.c
M	src/lib-http/http-header-parser.h
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-message-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-response-parser.c

2014-01-10 21:59:15 +0200 Timo Sirainen <tss@iki.fi> (e479250)

    lib-master: Added unit test for master_service_settings_cache_read()


M	src/lib-master/Makefile.am
A	src/lib-master/test-master-service-settings-cache.c

2014-01-10 13:00:39 -0500 Timo Sirainen <tss@iki.fi> (3bc9d91)

    imap proxy: Avoid duplicate CAPABILITY reply when backend is Dovecot. This
    happened if the client sent a CAPABILITY command to the proxy.


M	src/imap-login/imap-proxy.c

2014-01-10 00:19:19 +0200 Timo Sirainen <tss@iki.fi> (c58f467)

    doveadm fs delete: Added -n parameter to asynchronously delete multiple
    files at once.


M	src/doveadm/doveadm-fs.c

2014-01-08 11:24:36 -0500 Timo Sirainen <tss@iki.fi> (d93b1c6)

    lib-storage: Implemented get_metadata() for fail-mailbox. This fixes a crash
    when a nonexistent mailbox was allocated and accessed (via LAYOUT=index).


M	src/lib-storage/fail-mailbox.c

2014-01-07 14:33:29 -0500 Timo Sirainen <tss@iki.fi> (737d994)

    imap proxy: Set proxy_state correctly also with proxy_nopipelining.


M	src/imap-login/imap-proxy.c

2013-12-23 15:30:31 +0200 Timo Sirainen <tss@iki.fi> (ab281fc)

    imap proxy: Added proxy_nopipelining passdb setting to work around other
    servers' bugs.


M	src/imap-login/imap-proxy.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h

2013-12-20 19:59:22 +0200 Timo Sirainen <tss@iki.fi> (cc4bac5)

    mdbox: When purging writes new data, flush them to disk before locking the
    map index.


M	src/lib-storage/index/dbox-multi/mdbox-purge.c

2013-12-20 04:57:25 +0200 Timo Sirainen <tss@iki.fi> (18b13ba)

    Added signature for changeset 614bd6600011


M	.hgsigs

2013-12-20 04:57:19 +0200 Timo Sirainen <tss@iki.fi> (4cfd0f6)

    Added tag 2.2.10 for changeset 614bd6600011


M	.hgtags

2013-12-20 04:57:19 +0200 Timo Sirainen <tss@iki.fi> (16af02a)

    Released v2.2.10.


M	NEWS
M	configure.ac

2013-12-20 04:25:17 +0200 Timo Sirainen <tss@iki.fi> (9abf4d9)

    Compiler warning fix. Older libmysqlclient uses const char * as the arg.


M	src/lib-sql/driver-mysql.c

2013-12-20 04:23:04 +0200 Timo Sirainen <tss@iki.fi> (e5dca7e)

    imap-quota: SETQUOTA supports now also user@domain:quotaroot name.


M	src/plugins/imap-quota/imap-quota-plugin.c

2013-12-20 01:06:02 +0200 Timo Sirainen <tss@iki.fi> (a5c1051)

    imap: GETMETADATA should return nonexistent entries also with NIL values.


M	src/imap/cmd-getmetadata.c

2013-12-19 23:54:28 +0200 Timo Sirainen <tss@iki.fi> (4f93b5a)

    auth: If LDAP server returns LDAP_OPERATIONS_ERROR, reconnect. Apparently
    the server somehow lost the bind.


M	src/auth/db-ldap.c

2013-12-19 23:43:54 +0200 Timo Sirainen <tss@iki.fi> (e66cd20)

    quota-status: Allow mail to go over quota up to quota_grace.


M	src/plugins/quota/quota-status.c
M	src/plugins/quota/quota.c

2013-12-19 23:09:45 +0200 Timo Sirainen <tss@iki.fi> (08b0192)

    imap: Minor comment update: Horde uses wildcards, not Kolab.


M	src/imap/cmd-getmetadata.c

2013-12-19 23:08:03 +0200 Timo Sirainen <tss@iki.fi> (b6709d9)

    imap: Allow wildcards in GETMETADATA mailbox-name. RFC 5464 doesn't specify
    this, but its earlier draft did, and Kolab uses it.


M	src/imap/cmd-getmetadata.c

2013-12-19 23:07:15 +0200 Timo Sirainen <tss@iki.fi> (77b4e72)

    imap: GETMETADATA wasn't working correctly if options parameter wasn't
    specified.


M	src/imap/cmd-getmetadata.c

2013-12-19 23:04:55 +0200 Timo Sirainen <tss@iki.fi> (8855b8b)

    imap: SETMETADATA shouldn't assert-crash when entry name is invalid


M	src/imap/cmd-setmetadata.c

2013-12-19 21:37:28 +0200 Timo Sirainen <tss@iki.fi> (0ff8b7f)

    imap: If any FETCH/STORE tries to access modseqs when NOMODSEQ was returned,
    return BAD.


M	src/imap/cmd-fetch.c
M	src/imap/cmd-store.c
M	src/imap/imap-fetch.c

2013-12-19 21:31:57 +0200 Timo Sirainen <tss@iki.fi> (167da1a)

    imap: Ignore QRESYNC parameters for SELECT when returning NOMODSEQ.


M	src/imap/cmd-select.c

2013-12-19 21:25:43 +0200 Timo Sirainen <tss@iki.fi> (b866325)

    fs-sis: Memory leak fix.


M	src/lib-fs/fs-sis.c

2013-12-19 21:25:28 +0200 Timo Sirainen <tss@iki.fi> (5cdb246)

    pop3c: Memory leak fixes


M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-storage.c

2013-12-19 21:25:08 +0200 Timo Sirainen <tss@iki.fi> (5971498)

    imap: if mailbox has non-permanent modseqs, never send
    HIGHESTMODSEQ/MODSEQs.


M	src/imap/cmd-select.c
M	src/imap/imap-client.h
M	src/imap/imap-sync.c

2013-12-19 21:21:39 +0200 Timo Sirainen <tss@iki.fi> (792afd1)

    Compiler warning fix.


M	src/imap/cmd-getmetadata.c

2013-12-19 04:18:30 +0200 Timo Sirainen <tss@iki.fi> (050acc3)

    pop3c: If POP3 server doesn't support UIDLs, don't advertise GUID support.


M	src/lib-storage/index/pop3c/pop3c-storage.c

2013-12-19 04:05:52 +0200 Timo Sirainen <tss@iki.fi> (5f4e547)

    pop3c: Added pop3c_quick_received_date setting. With this enabled dsync no
    longer requires calling TOP for each message to get the metadata.


M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-settings.h

2013-12-19 04:01:58 +0200 Timo Sirainen <tss@iki.fi> (e130bb8)

    pop3c: Use UIDLs as GUIDs.


M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-storage.c

2013-12-17 21:33:32 +0200 Timo Sirainen <tss@iki.fi> (f9b1266)

    mail-filter: If filter returns 0 bytes, treat it as EIO error.


M	src/plugins/mail-filter/istream-ext-filter.c
M	src/plugins/mail-filter/ostream-ext-filter.c

2013-12-14 14:40:13 +0200 Timo Sirainen <tss@iki.fi> (1c0462c)

    Compiler warning fix


M	src/lib-master/master-auth.c

2013-12-13 13:44:32 +0200 Timo Sirainen <tss@iki.fi> (e153e12)

    ldap: Added blocking=yes setting to use auth-workers.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2013-12-12 18:21:49 +0200 Timo Sirainen <tss@iki.fi> (f9ee758)

    lib-master: Show better error message when process_limit is reached.


M	src/lib-master/master-auth.c

2013-12-12 18:08:25 +0200 Timo Sirainen <tss@iki.fi> (bb5464b)

    auth: Previous userdb changes caused userdb prefetch to be used always.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/userdb-prefetch.c

2013-12-12 17:59:28 +0200 Timo Sirainen <tss@iki.fi> (74fb6b5)

    auth: Don't crash when userdb hasn't been specified at all.


M	src/auth/auth-settings.c
M	src/auth/auth.c

2013-12-12 16:37:37 +0200 Timo Sirainen <tss@iki.fi> (62c05ba)

    lzma: Reading until EOF without seeing LZMA_STREAM_END isn't an error.


M	src/lib-compression/istream-lzma.c

2013-12-11 19:39:12 +0200 Timo Sirainen <tss@iki.fi> (639079e)

    login-*: Make sure "need to write more" flag doesn't get stuck during
    handshake. This should prevent busy-looping in SSL_accept(). (Second attempt
    at doing this, first one was in e95479f439aa.)


M	src/login-common/ssl-proxy-openssl.c

2013-12-11 18:39:36 +0200 Timo Sirainen <tss@iki.fi> (14b495a)

    auth: Use refcounting for LDAPMessage to make sure it always gets freed
    correctly. This may fix some memory leaks in some (error?) cases.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2013-12-11 18:39:08 +0200 Timo Sirainen <tss@iki.fi> (550d748)

    auth: ldap with auth_bind=yes leaked memory Existing LDAP search request
    can't just be converted into bind request before the search request is
    freed. So just create a new request.


M	src/auth/passdb-ldap.c

2013-12-09 18:41:30 +0200 Timo Sirainen <tss@iki.fi> (bac5d8c)

    master: Include used protocols in the "starting up" log message.


M	src/master/main.c

2013-12-09 15:42:20 +0200 Timo Sirainen <tss@iki.fi> (9ff8e48)

    quota: Fix to previous wildcard change


M	src/plugins/quota/quota.c

2013-12-09 00:02:58 +0200 Timo Sirainen <tss@iki.fi> (09d0ffb)

    mysql: Added ssl_verify_server_cert=no|yes parameter. To make sure we don't
    break existing installations, default to "no". For v2.3 it should default to
    "yes".

    Patch by Gareth Palmer

M	configure.ac
M	doc/example-config/dovecot-sql.conf.ext
M	src/lib-sql/driver-mysql.c

2013-12-08 23:41:33 +0200 Timo Sirainen <tss@iki.fi> (35df1d3)

    lib-http: Don't try to automatically retry requests whose payload was
    already lost. Patch by Stephan Bosch.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c

2013-12-08 23:26:40 +0200 Timo Sirainen <tss@iki.fi> (0c572d4)

    stats: Workaround opening /proc/self/io in processes that have only
    temporarily dropped root privileges.


M	src/plugins/stats/stats-plugin.c

2013-12-08 23:04:18 +0200 Timo Sirainen <tss@iki.fi> (81e4bda)

    quota: Allow mailbox names in quota_rules to contain "*" and "?" wildcards.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2013-12-08 22:30:10 +0200 Timo Sirainen <tss@iki.fi> (ed4caf5)

    fts: Fixed crash with some search queries in empty mailbox.


M	src/plugins/fts/fts-search.c

2013-12-08 22:21:40 +0200 Timo Sirainen <tss@iki.fi> (7fc91e2)

    master: Finished the previous DEBUG_OUTOFMEM -> CORE_OUTOFMEM and CORE_ERROR
    change.


M	src/master/master-settings.c
M	src/master/service-process.c

2013-12-08 22:20:12 +0200 Timo Sirainen <tss@iki.fi> (e173d24)

    Renamed DEBUG_OUTOFMEM environment to CORE_OUTOFMEM. Added CORE_ERROR to
    dump core on the first error.


M	src/lib/failures.c

2013-12-08 21:26:29 +0200 Timo Sirainen <tss@iki.fi> (2521fd0)

    quota: Added support for SETQUOTA IMAP command. The configuration is done
    via quota_set setting. Currently only dict backend is supported. For
    example:

    plugin {
     quota_set = dict:file:/var/lib/dovecot/quota/%u
    } The SETQUOTA command is available only for the "admin" user (userdb lookup 
    must return admin=y).

M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2013-12-08 21:24:10 +0200 Timo Sirainen <tss@iki.fi> (c6e8f89)

    imap-quota: Admin user can (again) use GETQUOTA for other users' quota
    roots.


M	src/plugins/imap-quota/imap-quota-plugin.c

2013-12-08 21:22:38 +0200 Timo Sirainen <tss@iki.fi> (5a9912d)

    lib-storage: Added mail_user->admin flag. The previous admin-flag used to
    mix up "admin user" and "admin tool", while this new purpose only means
    "admin user".


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.h

2013-12-08 21:13:22 +0200 Timo Sirainen <tss@iki.fi> (9686ada)

    lib-dict: Added "fs" wrapper dict backend, which uses lib-fs. Each dict key
    is a separate file where the file's contents are the dict value.


M	src/lib-dict/Makefile.am
A	src/lib-dict/dict-fs.c
M	src/lib-dict/dict-private.h
A	src/lib-dict/dict-register.c
M	src/lib-dict/dict.c

2013-12-08 20:48:03 +0200 Timo Sirainen <tss@iki.fi> (cd75c36)

    auth: Added userdb result_success/failure/tempfail and skip settings,
    similar to passdb's.


M	src/auth/auth-master-connection.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/auth/auth-worker-client.c
M	src/auth/auth.c
M	src/auth/auth.h
M	src/auth/userdb-blocking.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-vpopmail.c

2013-12-08 19:02:12 +0200 Timo Sirainen <tss@iki.fi> (fb55257)

    lib-storage: Don't crash in mailbox_is_inconsistent() if mailbox hasn't been
    opened.


M	src/lib-storage/index/index-storage.c

2013-12-08 19:00:31 +0200 Timo Sirainen <tss@iki.fi> (79042f8)

    auth: passdb/userdb dict rewrite to support more complex configuration. See
    the new doc/example-config/dovecot-dict-auth.conf.ext for explanation how it
    works. The old configuration format will also stay functional.


M	doc/example-config/dovecot-dict-auth.conf.ext
M	src/auth/Makefile.am
A	src/auth/db-dict-cache-key.c
M	src/auth/db-dict.c
M	src/auth/db-dict.h
M	src/auth/passdb-dict.c
A	src/auth/test-db-dict.c
M	src/auth/userdb-dict.c

2013-12-03 21:31:59 +0200 Timo Sirainen <tss@iki.fi> (5e22b51)

    lib-imap: imap_envelope_parse() added extra "," after address group. This
    function wasn't actually used by Dovecot anywhere anymore. Patch by Potapov
    Sergey.


M	src/lib-imap/imap-envelope.c

2013-12-03 17:29:38 +0200 Timo Sirainen <tss@iki.fi> (08837f5)

    imap: If SELECT fails with "mailbox is inconsistent", disconnect client.
    (Plus related cleanups.) The inconsistency can also be used to indicate that
    something is badly wrong and nothing useful can be done before client
    reconnects.


M	src/imap/cmd-append.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-getmetadata.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-resetkey.c
M	src/imap/cmd-select.c
M	src/imap/cmd-setmetadata.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h
M	src/imap/imap-search.c

2013-12-03 17:17:03 +0200 Timo Sirainen <tss@iki.fi> (a0cfe97)

    lib-http: Removed assert Time can't be relied on exactly.


M	src/lib-http/http-client-queue.c

2013-12-03 01:33:18 +0200 Timo Sirainen <tss@iki.fi> (a646daf)

    imap: Don't send [NOMODSEQ] on SELECT/EXAMINE reply when condstore hasn't
    been enabled yet. This is definitely the better behavior and was also
    clearly intended by the CONDSTORE RFC, although with some mixed language.


M	src/imap/cmd-select.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/mail-storage.h

2013-12-02 18:47:52 +0200 Timo Sirainen <tss@iki.fi> (5769639)

    pop3: Handle UIDL failures by disconnecting the client instead of killing
    the whole process.


M	src/pop3/pop3-commands.c

2013-11-26 21:10:23 +0100 Timo Sirainen <tss@iki.fi> (7b6bca4)

    replicator: Give a better error message with path when replicator.db is
    corrupted.


M	src/replication/replicator/replicator-queue.c

2013-11-25 01:24:35 +0200 Timo Sirainen <tss@iki.fi> (42afa2a)

    Added signature for changeset 2852a7c55fc7


M	.hgsigs

2013-11-25 01:24:32 +0200 Timo Sirainen <tss@iki.fi> (308457e)

    Added tag 2.2.9 for changeset 2852a7c55fc7


M	.hgtags

2013-11-25 01:24:32 +0200 Timo Sirainen <tss@iki.fi> (c552ee5)

    Released v2.2.9.


M	NEWS
M	configure.ac

2013-11-25 00:46:40 +0200 Timo Sirainen <tss@iki.fi> (5ce940d)

    Makefile: Added missing \


M	src/plugins/mail-filter/Makefile.am

2013-11-25 00:44:21 +0200 Timo Sirainen <tss@iki.fi> (24fb580)

    Makefile: Added missing header files


M	src/plugins/mail-filter/Makefile.am

2013-11-24 23:02:13 +0200 Timo Sirainen <tss@iki.fi> (12983e9)

    lib-compression: Added support for liblzma (xz) Annoyingly this is mainly
    copy&pasted [io]stream-bzlib, but I'm not sure if it's worth the effort to
    try to create common functions for them.


M	configure.ac
M	src/lib-compression/Makefile.am
M	src/lib-compression/compression.c
A	src/lib-compression/istream-lzma.c
M	src/lib-compression/istream-zlib.h
A	src/lib-compression/ostream-lzma.c
M	src/lib-compression/ostream-zlib.h

2013-11-24 20:19:48 +0000 Pascal Volk <user@localhost.localdomain.org> (23a0a2f)

    man: doveadm-mailbox.1: Added -g's description for mailbox create.


M	doc/man/doveadm-mailbox.1.in

2013-11-24 21:41:06 +0200 Timo Sirainen <tss@iki.fi> (bd8b391)

    Fixed sscanf() error handling. Patch by Jann Horn.


M	src/lib-dns/dns-lookup.c
M	src/lib-settings/settings.c

2013-11-24 19:58:45 +0000 Pascal Volk <user@localhost.localdomain.org> (f56b8ae)

    man: doveadm-log.1: Added description for option -s.


M	doc/man/doveadm-log.1.in

2013-11-24 18:29:55 +0000 Pascal Volk <user@localhost.localdomain.org> (3c61da0)

    man: doveadm-import.1: Added description for option -s.


M	doc/man/doveadm-import.1.in

2013-11-24 18:02:40 +0000 Pascal Volk <user@localhost.localdomain.org> (d6043f1)

    man: doveadm-expunge.1: Added option -d also to section synopsis.


M	doc/man/doveadm-expunge.1.in

2013-11-24 20:41:42 +0200 Timo Sirainen <tss@iki.fi> (263df40)

    Data stack has now an extra NULL pointer padding before its actual data
    starts. This is just an extra safety measure against buffer overflows. Patch
    by Jann Horn.


M	src/lib/data-stack.c

2013-11-24 20:27:27 +0200 Timo Sirainen <tss@iki.fi> (2b81994)

    auth: Fixed (non-exploitable) buffer overflow in DIGEST-MD5 data parsing.
    Found by Jann Horn.


M	src/auth/mech-digest-md5.c

2013-11-23 23:22:09 +0000 Pascal Volk <user@localhost.localdomain.org> (9a6262e)

    man: doveadm-move.1: Fixed syntax errors, escaped some dashes.


M	doc/man/doveadm-move.1.in

2013-11-23 19:35:09 +0000 Pascal Volk <user@localhost.localdomain.org> (ac3614a)

    man: doveadm-index.1: Added description for options -n and -q.


M	doc/man/doveadm-index.1.in

2013-11-23 21:18:30 +0200 Timo Sirainen <tss@iki.fi> (3415e31)

    fts: Renamed fts_autoindex_on_save to fts_autoindex


M	src/plugins/fts/fts-storage.c

2013-11-23 21:13:26 +0200 Timo Sirainen <tss@iki.fi> (deab624)

    replicator: Memory leak fix for previous commit


M	src/replication/replicator/dsync-client.c

2013-11-23 21:12:39 +0200 Timo Sirainen <tss@iki.fi> (36757b4)

    replicator: Added replication_dsync_parameters setting to pass "doveadm
    sync" parameters. -f and -s parameters are added automatically when needed.


M	src/replication/replicator/dsync-client.c
M	src/replication/replicator/dsync-client.h
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator-settings.h

2013-11-23 18:24:24 +0000 Pascal Volk <user@localhost.localdomain.org> (b9bf635)

    man: doveadm-move.1: Added description for 'user source_user'.


M	doc/man/doveadm-move.1.in

2013-11-23 19:28:48 +0200 Timo Sirainen <tss@iki.fi> (735259c)

    fts: Added plugin { fts_autoindex_on_save } setting. When enabled and a mail
    is saved/copied, the indexer process is requested to index the changed
    mailbox.

    fts_autoindex_max_recent_msgs setting can also be used to skip indexing 
    mailboxes that have too many \Recent messages (implying that the mailbox is 
    never actually accessed). This corresponds to doveadm index -n parameter.

M	src/plugins/fts/fts-storage.c

2013-11-23 16:28:04 +0000 Pascal Volk <user@localhost.localdomain.org> (3c9e500)

    man: doveadm-user.1: Added description for the -u option.


M	doc/man/doveadm-user.1.in

2013-11-23 18:35:08 +0200 Timo Sirainen <tss@iki.fi> (30f128c)

    lib-dns: If existing dns connection dies in write(), retry connect once.


M	src/lib-dns/dns-lookup.c

2013-11-23 12:19:49 +0200 Timo Sirainen <tss@iki.fi> (19db4c5)

    lib-http: Compiler warning fix


M	src/lib-http/http-client-request.c

2013-11-23 00:38:41 +0200 Timo Sirainen <tss@iki.fi> (b7c7a04)

    lib-storage: Non-crashing way of avoiding fs lookups for storages without
    mail root.


M	src/lib-storage/mailbox-list.c

2013-11-23 00:00:43 +0200 Timo Sirainen <tss@iki.fi> (267923f)

    lib-http: Fixed request hang on connect() timeout.


M	src/lib-http/http-client-connection.c

2013-11-22 23:52:37 +0200 Timo Sirainen <tss@iki.fi> (758d8b4)

    lib-storage: Don't do filesystem permission lookups if storage has no
    mailbox root dir.


M	src/lib-storage/mailbox-list.c

2013-11-22 23:31:36 +0200 Timo Sirainen <tss@iki.fi> (7eff21e)

    dns: Don't idle-disconnect clients It's the job for the clients.


M	src/dns/dns-client.c

2013-11-22 23:15:07 +0200 Timo Sirainen <tss@iki.fi> (0564370)

    lib-dns: Fixed handling write() failure to dns-lookup server process.


M	src/lib-dns/dns-lookup.c

2013-11-22 22:12:08 +0200 Stephan Bosch <stephan@rename-it.nl> (93cc87b)

    http: Implemented delayed requests scheduling. Requests can now be
    (re)submitted with a delay. The request is not sent until the delay time
    expires. This facilitates handling the Retry-After header in responses. This
    can either be performed automatically if the indicated delay is not too long
    or explicitly by the code using lib-http.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-11-22 22:08:44 +0200 Stephan Bosch <stephan@rename-it.nl> (7af70f7)

    http: Preparse Retry-After header if response status is 503 or 3xx.


M	src/lib-http/http-response-parser.c
M	src/lib-http/http-response.h

2013-11-22 22:08:20 +0200 Stephan Bosch <stephan@rename-it.nl> (129596c)

    http-client: Improved handing of delayed request errors. Originally each
    request would have its own zero timeout, but now only one timeout is put in
    the host object.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2013-11-22 22:07:41 +0200 Stephan Bosch <stephan@rename-it.nl> (de96afe)

    http-client: Changed struct http_client_host_port into a struct
    http_client_queue object. Peer and request objects now reference the queue
    object directly rather than the host object. This way, there is no need to
    find the matching host:port in the host anymore. This makes the queueing
    structure more intuitive and more efficient. This is a first step towards
    support for connecting to HTTP services through unix sockets or directing
    requests at specific hosts (so not from the URL). This patch also fixes a
    potential timeout leak (to_connect) in http_client_host_port (now
    http_client_queue) and makes sure it is moved during switch_ioloop().
    Finally it updates the structure comment at the top of http-client.c.


M	src/lib-http/Makefile.am
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
A	src/lib-http/http-client-queue.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c

2013-11-22 22:05:52 +0200 Timo Sirainen <tss@iki.fi> (b367011)

    iostream-rawlog: Timestamp prefix is now optional.


M	src/lib/iostream-rawlog-private.h
M	src/lib/iostream-rawlog.c

2013-11-22 19:39:13 +0200 Timo Sirainen <tss@iki.fi> (49d54c7)

    Added mail-filter plugin.


M	configure.ac
M	src/plugins/Makefile.am
A	src/plugins/mail-filter/Makefile.am
A	src/plugins/mail-filter/istream-ext-filter.c
A	src/plugins/mail-filter/istream-ext-filter.h
A	src/plugins/mail-filter/mail-filter-plugin.c
A	src/plugins/mail-filter/mail-filter-plugin.h
A	src/plugins/mail-filter/ostream-ext-filter.c
A	src/plugins/mail-filter/ostream-ext-filter.h

2013-11-22 19:32:06 +0200 Timo Sirainen <tss@iki.fi> (02076e0)

    doveadm acl debug: Improved output


M	src/plugins/acl/doveadm-acl.c

2013-11-22 13:47:36 +0200 Timo Sirainen <tss@iki.fi> (9a48c22)

    ostream: Don't mark the stream closed too early after all. Use another flag
    instead to avoid losing the last data written to the stream before closing.


M	src/lib/ostream-private.h
M	src/lib/ostream.c

2013-11-21 23:02:33 +0200 Timo Sirainen <tss@iki.fi> (c905571)

    lib-storage: Improved EACCES error messages for some stat() calls


M	src/lib-storage/mailbox-list.c

2013-11-20 23:29:13 +0200 Timo Sirainen <tss@iki.fi> (a601cdf)

    doveadm: Added "fs metadata" command


M	src/doveadm/doveadm-fs.c

2013-11-20 22:20:06 +0200 Timo Sirainen <tss@iki.fi> (8601cb6)

    dsync: Fix to 128bit GUID syncing


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-11-20 21:25:19 +0200 Timo Sirainen <tss@iki.fi> (cce2c66)

    dsync: have_only_guid128 was never actually being set.


M	src/doveadm/dsync/dsync-brain-mailbox.c

2013-11-20 15:07:26 +0200 Timo Sirainen <tss@iki.fi> (d8a7046)

    lib-storage: mail_get_headers*() returned only the first header from cache.


M	src/lib-storage/index/index-mail-headers.c

2013-11-20 14:50:53 +0200 Timo Sirainen <tss@iki.fi> (e3411c4)

    lib-storage: mail_get_*header*() still didn't handle cached values
    correctly. If header ends with ":", the ":" shouldn't be returned as part of
    the value.


M	src/lib-storage/index/index-mail-headers.c

2013-11-20 14:38:55 +0200 Timo Sirainen <tss@iki.fi> (d48ab23)

    lib-storage: mail_get_*header*() were unnecessarily looking up the headers
    twice.


M	src/lib-storage/index/index-mail-headers.c

2013-11-20 14:37:44 +0200 Timo Sirainen <tss@iki.fi> (2188b93)

    lib-storage: mail_get_*header*() didn't remove leading whitespace for
    headers from cache. But it was removed when the headers were found by
    parsing the full header.


M	src/lib-storage/index/index-mail-headers.c

2013-11-19 23:18:11 +0200 Timo Sirainen <tss@iki.fi> (2651a7e)

    Added signature for changeset 095a777edc26


M	.hgsigs

2013-11-19 23:18:01 +0200 Timo Sirainen <tss@iki.fi> (75e6aea)

    Added tag 2.2.8 for changeset 095a777edc26


M	.hgtags

2013-11-19 23:18:01 +0200 Timo Sirainen <tss@iki.fi> (4d66e42)

    Released v2.2.8.


M	NEWS
M	configure.ac

2013-11-19 23:17:07 +0200 Timo Sirainen <tss@iki.fi> (92bb5db)

    auth: Fixed potential crash.


M	src/auth/auth-request-handler.c

2013-11-19 17:21:21 +0200 Timo Sirainen <tss@iki.fi> (0cb5466)

    lmtp: Make sure output is flushed before disconnection.


M	src/lmtp/client.c

2013-11-19 16:13:12 +0200 Timo Sirainen <tss@iki.fi> (58840b6)

    lib-storage: Error handling fix for layout=index when mailbox creation
    fails.


M	src/lib-storage/list/mailbox-list-index-backend.c

2013-11-18 16:26:31 +0200 Timo Sirainen <tss@iki.fi> (a92681c)

    doveadm user: Fixed now printing with a non-default formatter


M	src/doveadm/doveadm-auth.c

2013-11-18 16:23:42 +0200 Timo Sirainen <tss@iki.fi> (5fb679b)

    doveadm user: Fixed printing multiple users


M	src/doveadm/doveadm-auth.c

2013-11-18 16:18:53 +0200 Timo Sirainen <tss@iki.fi> (4a0d2f7)

    doveadm auth/user: Fixes to auth_socket_path handling. doveadm user (without
    -u parameter) was ignoring "-a" parameter entirely. Others weren't using
    auth_socket_path setting.


M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h

2013-11-18 16:15:38 +0200 Timo Sirainen <tss@iki.fi> (50b9773)

    lib-storage: Added mail_storage_service_set_auth_conn()


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2013-11-18 15:46:46 +0200 Timo Sirainen <tss@iki.fi> (f887b3f)

    doveadm user: Fixed looking up multiple users when they had different UIDs


M	src/doveadm/doveadm-auth.c

2013-11-17 16:58:20 +0000 Pascal Volk <user@localhost.localdomain.org> (1fc71c0)

    man: Added doveadm-batch.1.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-batch.1.in
M	doc/man/doveadm.1.in

2013-11-17 17:59:05 +0200 Timo Sirainen <tss@iki.fi> (d1e843e)

    dsync: Support syncing storages with 128bit GUIDs <-> string GUIDs.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h
M	src/doveadm/dsync/dsync-mailbox.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2013-11-17 17:15:42 +0200 Timo Sirainen <tss@iki.fi> (b9da8d5)

    lib-storage: Fixed memory leak in mail_add_temp_wanted_fields()


M	src/lib-storage/index/index-mail.c

2013-11-17 16:59:33 +0200 Timo Sirainen <tss@iki.fi> (1a878b9)

    imapc: Merge identical FETCH commands together (only updating UID range)


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2013-11-17 16:58:42 +0200 Timo Sirainen <tss@iki.fi> (c954cd9)

    dsync: Tell search that we want to fetch mail streams so prefetching works.


M	src/doveadm/dsync/dsync-mailbox-export.c

2013-11-17 16:11:31 +0200 Timo Sirainen <tss@iki.fi> (95de574)

    dsync: Set wanted_fields/headers for the whole search request when possible.


M	src/doveadm/dsync/dsync-mailbox-export.c

2013-11-17 15:13:58 +0200 Timo Sirainen <tss@iki.fi> (c12ee34)

    imapc: Avoid sending unnecessary IDLEs that are immediately aborted.


M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-storage/index/imapc/imapc-sync.c

2013-11-17 15:03:31 +0200 Timo Sirainen <tss@iki.fi> (d29abd3)

    lib-imap-client: Don't reset timeout while waiting for IDLE DONE reply.


M	src/lib-imap-client/imapc-connection.c

2013-11-17 14:04:22 +0200 Timo Sirainen <tss@iki.fi> (2bcc41a)

    lib-imap-client: Make sure command timeout is used also for IDLE DONE.


M	src/lib-imap-client/imapc-connection.c

2013-11-17 01:04:50 +0200 Timo Sirainen <tss@iki.fi> (888e0f4)

    Added io_loop_add/remove_switch_callback() to call a callback when ioloop is
    changed.


M	src/lib/ioloop.c
M	src/lib/ioloop.h

2013-11-17 01:01:50 +0200 Timo Sirainen <tss@iki.fi> (e5327a8)

    lib-imap-client: Don't send NOOP if we're still waiting for a command reply.


M	src/lib-imap-client/imapc-connection.c

2013-11-17 00:59:39 +0200 Timo Sirainen <tss@iki.fi> (cbc5a26)

    lib-imap-client: Make sure command timeout is always set.


M	src/lib-imap-client/imapc-connection.c

2013-11-17 00:41:23 +0200 Timo Sirainen <tss@iki.fi> (d81b80b)

    imapc: Fixes to imapc_feature fetch-headers


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c

2013-11-16 21:58:31 +0200 Timo Sirainen <tss@iki.fi> (7f5ddd0)

    lib-index: Recent change broke cache transactions for more than 1 mail.


M	src/lib-index/mail-cache-transaction.c

2013-11-16 21:20:31 +0200 Timo Sirainen <tss@iki.fi> (35f3b7e)

    Use io_loop_set_current() instead of directly setting it.


M	src/doveadm/client-connection.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib/ioloop.c

2013-11-16 21:17:56 +0200 Timo Sirainen <tss@iki.fi> (f97c983)

    dsync: Give hints to lib-storage about what fields we're going to fetch.


M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c

2013-11-16 20:10:27 +0200 Timo Sirainen <tss@iki.fi> (d02af96)

    imapc: When sending FETCH, always request also missing wanted_fields. This
    avoids sending multiple FETCH commands when prefetch hadn't already fetched
    everything.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2013-11-16 20:09:19 +0200 Timo Sirainen <tss@iki.fi> (bf611d4)

    imapc: Avoid FETCH INTERNALDATE for getting save_date when we already know
    received_date.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c

2013-11-16 20:06:34 +0200 Timo Sirainen <tss@iki.fi> (ffb886e)

    imapc: Don't send FETCHes for data that is already in cache.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h

2013-11-16 19:41:07 +0200 Timo Sirainen <tss@iki.fi> (0f641fb)

    imapc: Crashfix for previous change


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2013-11-16 19:36:40 +0200 Timo Sirainen <tss@iki.fi> (b8eb60a)

    imapc: Added imapc_feature fetch-header. It uses FETCH
    BODY.PEEK[HEADER.FIELDS (...)] whenever possible instead of fetching the
    entire header.


M	TODO
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h

2013-11-16 19:35:10 +0200 Timo Sirainen <tss@iki.fi> (0d29e73)

    lib-storage: API comment update


M	src/lib-storage/mail-storage.h

2013-11-16 19:34:57 +0200 Timo Sirainen <tss@iki.fi> (91496fd)

    lib-index: Support a small in-memory cache even with INDEX=MEMORY


M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-transaction.c

2013-11-16 19:20:10 +0200 Timo Sirainen <tss@iki.fi> (127f99a)

    lib-index: mail_cache_lookup*() can now finds also the latest
    mail_cache_add()ed data.


M	src/lib-index/mail-cache-transaction.c

2013-11-16 17:46:10 +0200 Timo Sirainen <tss@iki.fi> (83e7db7)

    auth: Don't crash if passwd-file is used for authentication but it has no
    passwords.


M	src/auth/passdb-passwd-file.c

2013-11-16 14:06:32 +0000 Pascal Volk <user@localhost.localdomain.org> (bc5edef)

    man: Added description for command `doveadm copy`.


M	doc/man/Makefile.am
A	doc/man/doveadm-copy.1
M	doc/man/doveadm-move.1.in
M	doc/man/doveadm.1.in

2013-11-08 17:48:54 +0200 Timo Sirainen <tss@iki.fi> (fffb543)

    mail_attachment_*: Fixed "stream doesn't support seeking backwards" panic
    Caused by recent changes.


M	src/lib-storage/index/index-attachment.c

2013-11-08 17:44:25 +0200 Timo Sirainen <tss@iki.fi> (e529827)

    lib-fs: Don't crash if istream-fs-file is closed without never being read.


M	src/lib-fs/istream-fs-file.c

2013-11-08 16:40:13 +0100 Timo Sirainen <tss@iki.fi> (0e94016)

    mdbox_deleted: Index was synced with wrong flags.


M	src/lib-storage/index/dbox-multi/mdbox-deleted-storage.c

2013-11-08 16:39:52 +0100 Timo Sirainen <tss@iki.fi> (08a4f93)

    lib-storage: Give name to attachments-connector istream.


M	src/lib-storage/index/index-attachment.c

2013-11-08 16:12:32 +0100 Timo Sirainen <tss@iki.fi> (b854588)

    zlib: Give a name to zlib istreams


M	src/plugins/zlib/zlib-plugin.c

2013-11-08 14:44:57 +0100 Timo Sirainen <tss@iki.fi> (2df92c5)

    doveadm mailbox create: Added back -s parameter that was recently
    accidentally removed.


M	src/doveadm/doveadm-mail-mailbox.c

2013-11-06 23:00:58 +0200 Timo Sirainen <tss@iki.fi> (52de839)

    lib-storage: Moved more of dbox attachments code to generic code.


M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-attachment.h
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-attachment.h

2013-11-06 21:10:22 +0200 Timo Sirainen <tss@iki.fi> (14900b2)

    dbox: Use lib-fs API also for reading the attachments.


M	src/lib-storage/index/dbox-common/dbox-attachment.c

2013-11-06 21:08:42 +0200 Timo Sirainen <tss@iki.fi> (9393445)

    lib-storage: Added mailbox_list_init_fs() to easily initialize fs. Use it
    for dbox's attachment_fs.


M	src/lib-storage/Makefile.am
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2013-11-06 21:06:15 +0200 Timo Sirainen <tss@iki.fi> (5f55903)

    lib-fs: Added istream-fs-file to lazily read from fs_file.


M	src/lib-fs/Makefile.am
A	src/lib-fs/istream-fs-file.c
A	src/lib-fs/istream-fs-file.h

2013-11-06 21:05:51 +0200 Timo Sirainen <tss@iki.fi> (5f31517)

    istream: Added i_stream_init_parent() to lazily initialize the parent
    stream.


M	src/lib/istream-private.h
M	src/lib/istream.c

2013-11-06 19:03:10 +0200 Timo Sirainen <tss@iki.fi> (dde7156)

    lib-http: Use [io]_stream_get_error() instead of just errno strings.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c
M	src/lib-http/test-http-client.c

2013-11-06 17:13:53 +0200 Timo Sirainen <tss@iki.fi> (0afe75c)

    dsync: Use i_stream_get_error() instead of just errno in stream error
    messages.


M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-import.c

2013-11-06 16:33:37 +0200 Timo Sirainen <tss@iki.fi> (5a5f832)

    replicator: Database should be exported (not imported!) every 15 mins.


M	src/replication/replicator/replicator.c

2013-11-06 15:30:15 +0200 Timo Sirainen <tss@iki.fi> (d6d4d8b)

    mdbox: Fixed race condition when mailbox GUID was looked up before mailbox
    create was finished.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2013-11-06 13:00:13 +0200 Timo Sirainen <tss@iki.fi> (8594bb9)

    lib-imap-storage: Fixed leaking istream on error conditions. Caught by
    Tomasz PotÄ™ga


M	src/lib-imap-storage/imap-msgpart.c

2013-11-06 12:53:58 +0200 Timo Sirainen <tss@iki.fi> (7d85bf5)

    imap: Fixed potential crash if client disconnected during APPEND.


M	src/imap/cmd-append.c

2013-11-05 20:11:11 +0200 Timo Sirainen <tss@iki.fi> (17c2990)

    lib-mail: Fixed infinite loop in message-parser if message ends with
    --boundary+CR Thanks to Tomasz Potega for finding this.


M	src/lib-mail/message-parser.c

2013-11-05 13:12:25 +0200 Timo Sirainen <tss@iki.fi> (12b4dbf)

    lib-storage: Added FULLDIRNAME=name to mail_location. The difference to
    DIRNAME is that the name is used also for index and control directories.


M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2013-11-04 09:47:17 +0200 Timo Sirainen <tss@iki.fi> (a4bb333)

    ssl-params: Compiler warning fix when building without OpenSSL


M	src/ssl-params/ssl-params.c

2013-11-03 23:27:15 +0200 Timo Sirainen <tss@iki.fi> (59e26ff)

    ostream: Mark stream closed before handling its callback to avoid infinite
    loops. The callback could call o_stream_copy_error_from_parent(), which in
    turn would try to close the same ostream again.


M	src/lib/ostream.c

2013-11-03 22:04:53 +0200 Timo Sirainen <tss@iki.fi> (b5b10e2)

    Added signature for changeset b5b118701aa8


M	.hgsigs

2013-11-03 22:04:50 +0200 Timo Sirainen <tss@iki.fi> (1942cd7)

    Added tag 2.2.7 for changeset b5b118701aa8


M	.hgtags

2013-11-03 22:04:50 +0200 Timo Sirainen <tss@iki.fi> (2cb0477)

    Released v2.2.7.


M	NEWS
M	configure.ac

2013-11-03 21:48:24 +0200 Timo Sirainen <tss@iki.fi> (d34f3cc)

    Make static analyzer happier


M	src/lib-http/test-http-response-parser.c

2013-11-03 21:47:46 +0200 Timo Sirainen <tss@iki.fi> (b7dabf8)

    Make static analyzer happier.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2013-11-03 21:45:37 +0200 Timo Sirainen <tss@iki.fi> (a355fad)

    auth-worker: Potential crashfix at deinit


M	src/auth/auth-worker-client.c

2013-11-03 21:44:06 +0200 Timo Sirainen <tss@iki.fi> (56ffe7c)

    auth: Crashfix to "doveadm auth cache flush" when auth cache was disabled


M	src/auth/auth-master-connection.c

2013-11-03 21:42:47 +0200 Timo Sirainen <tss@iki.fi> (4981c1d)

    auth: Potential crashfix


M	src/auth/auth-request-handler.c

2013-11-03 20:56:25 +0200 Timo Sirainen <tss@iki.fi> (4178954)

    Call lib_atexit() callbacks before destroying the lib-master ioloop.


M	src/lib-master/master-service.c
M	src/lib/lib.c
M	src/lib/lib.h

2013-11-03 01:12:24 +0200 Timo Sirainen <tss@iki.fi> (333b1f3)

    lib-imap: imap_arg_get_atom() should also treat NIL as valid atom.


M	src/lib-imap/imap-arg.c

2013-11-02 22:57:27 +0200 Timo Sirainen <tss@iki.fi> (2ec1157)

    lib-storage: Fixed parsing NILs in search parameters.


M	src/lib-storage/mail-search-parser-imap.c

2013-11-02 22:42:32 +0200 Timo Sirainen <tss@iki.fi> (1dc33c5)

    lib-imap: Fixed NIL astring to not lose its case-sensitivity.


M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-parser.c

2013-11-02 22:32:23 +0200 Timo Sirainen <tss@iki.fi> (1e430b6)

    lib-imap: When writing "NIL" as astring, write it always as a "quoted".


M	src/lib-imap/imap-quote.c

2013-11-02 22:31:14 +0200 Timo Sirainen <tss@iki.fi> (954bbe7)

    imap: Fixed GETMETADATA NIL to treat it as "NIL"


M	src/imap/cmd-getmetadata.c

2013-11-02 22:30:42 +0200 Timo Sirainen <tss@iki.fi> (c469930)

    lib-imap: NIL as astring is the same as "NIL" This is a bit klugdy but works
    as long as all callers use imap_arg_get_astring() instead of trying to
    handle it themselves.


M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-arg.h

2013-11-02 21:29:39 +0200 Timo Sirainen <tss@iki.fi> (02c75e0)

    imap: Added initial support for METADATA extension. For now this is enabled
    only when imap_metadata=yes setting is used. The setting will go away once
    the feature is complete. Also mail_attribute_dict must be set.

    TODO:
    - Metadata doesn't work for public namespaces. There should probably be a
      mail_attribute_public_dict setting for that.
    - There isn't any kind of quota or other limits
    - After ENABLE METADATA start sending untagged METADATA entries to clients
    - /shared/admin should probably return postmaster_address URL
    - Check if we handle ACLs correctly
    - RFC says that it SHOULD be possible to set METADATA entries to \NoSelect
      mailboxes. We probably will never allow this though.

M	src/imap/Makefile.am
A	src/imap/cmd-getmetadata.c
A	src/imap/cmd-setmetadata.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c
M	src/imap/imap-commands.h
A	src/imap/imap-metadata.c
A	src/imap/imap-metadata.h
M	src/imap/imap-settings.c
M	src/imap/imap-settings.h

2013-11-02 20:09:28 +0200 Timo Sirainen <tss@iki.fi> (d0c9d43)

    lib-imap: Added IMAP_PARSE_FLAG_STOP_AT_LIST for stopping after '('


M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-parser.h

2013-11-02 20:05:08 +0200 Timo Sirainen <tss@iki.fi> (f7464ce)

    lib-imap: IMAP protocol parser was parsing NIL case-sensitively. Luckily no
    commands currently actually use NILs.


M	src/lib-imap/imap-parser.c

2013-11-02 15:30:47 +0200 Timo Sirainen <tss@iki.fi> (0e6fcf8)

    ssl-params: Don't fail completely if 512 bit DH parameters generation fails.


M	src/ssl-params/ssl-params-openssl.c

2013-11-02 15:27:28 +0200 Timo Sirainen <tss@iki.fi> (923e40f)

    ssl-params: Added ssl_dh_parameters_length & removed
    ssl_parameters_regenerate setting. ssl_parameters_regenerate was based on
    some text from GNUTLS documentation a long time ago, but there's really not
    much point in doing it.

    Ideally we should also support "openssl dhparam" input files, but for now 
    there's the ssl_dh_parameters_length setting that can be used to specify the 
    wanted DH parameters length. If the current ssl-parameters.dat has a 
    different length, it's regenerated.

    We should probably at some point support also built-in DH parameters which 
    are returned while the ssl-params runs.

M	doc/example-config/conf.d/10-ssl.conf
M	src/login-common/ssl-proxy-openssl.c
M	src/ssl-params/ssl-params-openssl.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params-settings.h
M	src/ssl-params/ssl-params.c
M	src/ssl-params/ssl-params.h

2013-11-02 15:18:15 +0200 Timo Sirainen <tss@iki.fi> (e5dab0f)

    ssl-params: Fixed closing listener fds for regeneration process.


M	src/ssl-params/ssl-params.c

2013-11-02 14:19:23 +0200 Timo Sirainen <tss@iki.fi> (3e7a6ba)

    dsync: Don't track too new changes from transaction log. This mattered only
    during race conditions while there were changes being done to the mailbox
    during syncing.


M	src/doveadm/dsync/dsync-transaction-log-scan.c

2013-11-02 13:52:30 +0200 Timo Sirainen <tss@iki.fi> (e3ea9f8)

    auth: Added %{session_pid} variable for userdb lookups in login requests.
    session_pid is now always sent to auth process. A new request_auth_token
    parameter was added to specify if auth_token should be returned or not.


M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/lib-master/master-login-auth.c

2013-11-02 13:34:17 +0200 Timo Sirainen <tss@iki.fi> (b632844)

    maildir: If filename begins with ':', rename it immediately instead of
    causing errors.


M	src/lib-storage/index/maildir/maildir-sync.c

2013-11-02 13:14:16 +0200 Timo Sirainen <tss@iki.fi> (c3e771b)

    mbox: Added assert to try to catch corruption.


M	src/lib-storage/index/mbox/mbox-sync.c

2013-11-02 12:46:08 +0200 Timo Sirainen <tss@iki.fi> (580ba11)

    auth: passdb shadow supports now lookup_credentials() API


M	src/auth/passdb-shadow.c

2013-11-02 12:42:55 +0200 Timo Sirainen <tss@iki.fi> (04f792b)

    auth: Return a reason string if PASS lookup fails because passdbs don't
    support it.


M	src/auth/auth-master-connection.c

2013-11-02 12:37:10 +0200 Timo Sirainen <tss@iki.fi> (1e8cc7b)

    auth: passdb passwd supports now lookup_credentials() API It's not very
    useful, but at least it allows the lookup itself to succeed.


M	src/auth/passdb-passwd.c

2013-11-02 12:25:09 +0200 Timo Sirainen <tss@iki.fi> (9ac3627)

    mdbox: When mail's refcount is too high, don't prevent shrinking the
    refcount.


M	src/lib-storage/index/dbox-multi/mdbox-map.c

2013-11-02 12:14:17 +0200 Timo Sirainen <tss@iki.fi> (d0388a4)

    doveadm import: Fixed translating different source and dest hierarchy
    separators in mailbox names.


M	src/doveadm/doveadm-mail-import.c

2013-11-01 16:44:25 +0200 Timo Sirainen <tss@iki.fi> (c7db4d0)

    lib-storage: If hook is forced, don't bother checking if it's in user's
    mail_plugins.


M	src/lib-storage/mail-storage-hooks.c

2013-11-01 16:43:53 +0200 Timo Sirainen <tss@iki.fi> (56a2254)

    lib-storage: Hooks weren't called exactly in the order they were intended.
    The comparison didn't skip the paths, so the "lib" prefix skipping didn't
    work.


M	src/lib-storage/mail-storage-hooks.c

2013-10-30 12:11:54 +0200 Timo Sirainen <tss@iki.fi> (4e88d2b)

    module-dir: Allow plugins to have deinit() function without init() function


M	src/lib/module-dir.c

2013-10-29 21:16:05 +0200 Timo Sirainen <tss@iki.fi> (daaf390)

    Compiling fix for old GCC


M	src/lib-http/test-http-server.c

2013-10-29 21:11:10 +0200 Timo Sirainen <tss@iki.fi> (3fe2850)

    lib-storage: Allow storage name to contain '_'


M	src/lib-storage/mail-storage.c

2013-10-29 21:10:33 +0200 Timo Sirainen <tss@iki.fi> (ed9535b)

    configure: Added mdbox_deleted storage.


M	configure.ac

2013-10-29 21:08:07 +0200 Timo Sirainen <tss@iki.fi> (b90c23a)

    mdbox: Added "mdbox_deleted" storage, which can be used to access messages
    with refcount=0 For example: doveadm import mdbox_deleted:~/mdbox "" mailbox
    inbox subject oops


M	src/lib-storage/index/dbox-multi/Makefile.am
A	src/lib-storage/index/dbox-multi/mdbox-deleted-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-map.h
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.h

2013-10-29 21:07:28 +0200 Timo Sirainen <tss@iki.fi> (561049f)

    lib-index: Don't mix index struct caching for in-memory vs. disk indexes.


M	src/lib-index/mail-index-alloc-cache.c

2013-10-29 20:26:33 +0200 Timo Sirainen <tss@iki.fi> (1edfe8b)

    mbox: Added extra assert


M	src/lib-storage/index/mbox/mbox-sync-rewrite.c

2013-10-29 19:42:14 +0200 Timo Sirainen <tss@iki.fi> (b5d2b15)

    imapc: Added a Courier-workaround for not returning UIDNEXT on SELECT.


M	src/lib-storage/index/imapc/imapc-storage.c

2013-10-29 18:59:20 +0200 Timo Sirainen <tss@iki.fi> (8536cd4)

    virtual: If virtual mailbox has no config file, assume it's just
    nonexistent. Most importantly if the virtual namespace root doesn't have the
    config, it should fail with MAIL_ERROR_NOTFOUND rather than
    MAIL_ERROR_NOTPOSSIBLE.


M	src/plugins/virtual/virtual-config.c

2013-10-29 17:32:42 +0200 Timo Sirainen <tss@iki.fi> (a952a44)

    lib-http: Added http_url_escape_path()


M	src/lib-http/http-url.c
M	src/lib-http/http-url.h

2013-10-28 11:50:40 +0200 Timo Sirainen <tss@iki.fi> (e67a891)

    doveadm-server: Minor error message improvement.


M	src/doveadm/client-connection.c

2013-10-28 11:50:14 +0200 Timo Sirainen <tss@iki.fi> (678376d)

    doveadm-server: ioloop change caused assert-crashes if outgoing data was
    buffered at the end.


M	src/doveadm/client-connection.c

2013-10-26 19:11:34 +0300 Timo Sirainen <tss@iki.fi> (e0e2c93)

    auth: Refuse to run checkpassword script insecurely by default


M	src/auth/checkpassword-reply.c
M	src/auth/db-checkpassword.c

2013-10-26 18:59:52 +0300 Timo Sirainen <tss@iki.fi> (c215ca0)

    fts-solr: Fixed support for multiple Solr hosts when same process handles
    multiple users. E.g. indexer-worker was always using only the first user's
    Solr host.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/fts-solr-plugin.h
M	src/plugins/fts-solr/solr-connection.c

2013-10-26 18:59:03 +0300 Timo Sirainen <tss@iki.fi> (81558ac)

    lib-http: Recent DNS change caused lib-http to access uninitialized memory.


M	src/lib-http/http-client-host.c

2013-10-26 18:31:16 +0300 Timo Sirainen <tss@iki.fi> (75f28ef)

    dsync: Fixed crashes at deinit when -r rawlog parameter was used.


M	src/doveadm/dsync/doveadm-dsync.c

2013-10-26 18:07:45 +0300 Timo Sirainen <tss@iki.fi> (f6f302e)

    auth: Fixed crash with auth_verbose_passwords!=no and non-plaintext auth


M	src/auth/auth-request.c

2013-10-26 18:06:26 +0300 Timo Sirainen <tss@iki.fi> (a3e719e)

    auth: Fixed assert-crash with auth_verbose_passwords!=no and 32bit systems.
    t_strndup() assert-crashed with size=UINT_MAX parameter.


M	src/auth/auth-request.c

2013-10-24 16:21:10 +0300 Timo Sirainen <tss@iki.fi> (280503e)

    *-login: Send the auth reply back corked.


M	src/login-common/client-common-auth.c

2013-10-24 16:08:23 +0300 Timo Sirainen <tss@iki.fi> (e911b23)

    login proxy: Use corking when writing data.


M	src/login-common/client-common-auth.c
M	src/login-common/login-proxy.c

2013-10-24 14:59:03 +0300 Timo Sirainen <tss@iki.fi> (d31c77e)

    auth: Cache master user logins also.


M	src/auth/auth-cache.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/passdb-cache.c

2013-10-24 11:25:41 +0300 Timo Sirainen <tss@iki.fi> (bada940)

    doveadm mailbox create: Added -g <guid> parameter to create mailbox with
    specific GUID.


M	src/doveadm/doveadm-mail-mailbox.c

2013-10-23 16:51:55 +0300 Timo Sirainen <tss@iki.fi> (c10d7b0)

    doveadm copy: Don't require the extra mailbox+extra parameter checks as
    expunge/move requires. Perhaps they wouldn't be necessary even with move.


M	src/doveadm/doveadm-mail-copymove.c

2013-10-23 16:50:57 +0300 Timo Sirainen <tss@iki.fi> (50d16f6)

    doveadm expunge: Improved the error hint message about using something else
    besides MAILBOX.


M	src/doveadm/doveadm-mail-expunge.c

2013-10-23 16:33:43 +0300 Timo Sirainen <tss@iki.fi> (e7a3ba6)

    lib-master: Fix to previous commit. It broke doveadm-server's "does client
    need authentication?" check.


M	src/lib-master/master-service.c

2013-10-23 16:23:23 +0300 Timo Sirainen <tss@iki.fi> (6de8a4d)

    stats: Hide warnings about old autocreated sessions having gotten lost.


M	src/stats/mail-session.c

2013-10-23 16:10:30 +0300 Timo Sirainen <tss@iki.fi> (9217d24)

    lib-master: If service_count=1, close the listener before starting to handle
    the connection. This way if the connection handling takes a long time and
    the service doesn't notice that master dies, it can keep running without
    keeping the listener fds open and preventing a restart.


M	src/lib-master/master-service.c

2013-10-23 15:36:02 +0300 Timo Sirainen <tss@iki.fi> (7195a14)

    replication plugin: Hide write(fifo) EPIPE errors, which just mean a server
    restart.


M	src/plugins/replication/replication-plugin.c

2013-10-23 15:26:35 +0300 Timo Sirainen <tss@iki.fi> (6ac32bf)

    dict-redis: Don't crash if we get disconnected during an open transaction.


M	src/lib-dict/dict-redis.c

2013-10-23 15:16:52 +0300 Timo Sirainen <tss@iki.fi> (c3f0584)

    dict-redis: Don't crash when receiving invalid input instead of expected
    $size.


M	src/lib-dict/dict-redis.c

2013-10-23 14:59:57 +0300 Timo Sirainen <tss@iki.fi> (b91b14d)

    doveadm-server: Fixed hangs caused by previous commit


M	src/doveadm/doveadm-mail-server.c

2013-10-23 14:35:07 +0300 Timo Sirainen <tss@iki.fi> (ecc0cf8)

    io_loop_run() now assert-crashes if it's attempted to be used recursively
    for the same ioloop.


M	src/lib/ioloop-private.h
M	src/lib/ioloop.c

2013-10-23 14:34:35 +0300 Timo Sirainen <tss@iki.fi> (06c303e)

    doveadm-server: Don't call io_loop_run() recursively for the same ioloop.
    This breaks things more or less badly, especially ioloop-kqueue really
    didn't like it.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail-server.c

2013-10-23 11:47:10 +0300 Timo Sirainen <tss@iki.fi> (a3ed53b)

    lib-auth: auth_master_cache_flush() always waited for timeout before
    finishing.


M	src/lib-auth/auth-master.c

2013-10-23 11:40:26 +0300 Timo Sirainen <tss@iki.fi> (f205e13)

    auth: Don't crash with "doveadm auth cache flush" when cache is disabled.


M	src/auth/auth-master-connection.c

2013-10-23 11:38:07 +0300 Timo Sirainen <tss@iki.fi> (1d00bd0)

    ioloop-kqueue: Added extra assert.


M	src/lib/ioloop-kqueue.c

2013-10-22 19:12:38 +0300 Timo Sirainen <tss@iki.fi> (28715ad)

    lib-dns: Fixed busy looping when dns-client disconnected.


M	src/lib-dns/dns-lookup.c

2013-10-22 15:36:07 +0300 Timo Sirainen <tss@iki.fi> (4f825be)

    lib-fs: Added dns_client to fs_settings.


M	src/lib-fs/fs-api.h

2013-10-22 15:35:27 +0300 Timo Sirainen <tss@iki.fi> (7944646)

    lib-http: Support DNS lookups via the new dns-client API.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-10-22 15:34:55 +0300 Timo Sirainen <tss@iki.fi> (ba54c71)

    lib-dns: Added alternative API for doing longer connections to dns-client
    process.


M	src/lib-dns/dns-lookup.c
M	src/lib-dns/dns-lookup.h

2013-10-21 21:38:17 +0300 Timo Sirainen <tss@iki.fi> (be2bc56)

    doveadm backup: If -D parameter is given, log the reason why mailbox gets
    deleted.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.h
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2013-10-21 20:47:53 +0300 Timo Sirainen <tss@iki.fi> (ec0dffd)

    imap: COPY allows transaction commit now to fail with "some messages were
    expunged".


M	src/imap/cmd-copy.c

2013-10-16 20:16:45 +0300 Timo Sirainen <tss@iki.fi> (66bc85d)

    imap: Don't assert-crash on FETCH BODY[MIME] (return BAD instead)


M	src/lib-imap-storage/imap-msgpart.c

2013-10-12 11:11:04 +0300 Stephan Bosch <stephan@rename-it.nl> (e47c2f1)

    lib-http: http-client: Added support for tunneling SSL conntections through
    proxy.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-10-12 11:05:08 +0300 Stephan Bosch <stephan@rename-it.nl> (a62fe4b)

    lib-http: Added support for creating CONNECT tunnels through HTTP.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-response-parser.h
M	src/lib-http/http-response.h

2013-10-12 11:00:15 +0300 Stephan Bosch <stephan@rename-it.nl> (4219de1)

    lib-http: http-client: Implemented proxy support.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-10-12 10:58:04 +0300 Stephan Bosch <stephan@rename-it.nl> (d82ad71)

    lib-http: Implemented functions for cloning and copying HTTP URLs and for
    constructing partial URLs.


M	src/lib-http/http-url.c
M	src/lib-http/http-url.h

2013-10-12 10:57:05 +0300 Stephan Bosch <stephan@rename-it.nl> (50d1446)

    lib-http: http-client: Added request error code for broken payload input
    stream. This error is triggered when reading from the provided payload input
    stream fails while sending the request. Previously this would yield the same
    error code as for a failure to write to the connection output.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2013-10-12 10:55:38 +0300 Stephan Bosch <stephan@rename-it.nl> (ad03049)

    lib-http: Added support for disabling automatic redirects.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-10-12 10:54:50 +0300 Stephan Bosch <stephan@rename-it.nl> (6c6915f)

    lib-http: http-client: Made requests release payload input stream as early
    as possible. This prevents deadlock conditions when used for the HTTP proxy.


M	src/lib-http/http-client-request.c

2013-10-12 10:54:10 +0300 Stephan Bosch <stephan@rename-it.nl> (0252ab9)

    lib-http: http-client: When client request is retried based on a response
    received from server, return full response to caller if retry is not
    possible. Before, it would construct a dummy-response that basically retains
    only the status and reason elements. This is currently only relevant for the
    way a 417 Expectation Failed response from the server is handled.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2013-10-12 10:53:16 +0300 Stephan Bosch <stephan@rename-it.nl> (c9779bb)

    lib-http: http-client: Made dummy response for returning internal errors
    more complete by filling in the version number and a proper date.


M	src/lib-http/http-response.c
M	src/lib-http/http-response.h

2013-10-12 10:52:35 +0300 Stephan Bosch <stephan@rename-it.nl> (1faa520)

    lib-http: Added more tests for the http_request_parser.


M	src/lib-http/test-http-request-parser.c

2013-10-11 21:36:21 +0300 Timo Sirainen <tss@iki.fi> (1b75b34)

    lib-dns: Close dns-client fd before calling callback. Just in case the
    callback is slow and keeps the fd unnecessarily long open.


M	src/lib-dns/dns-lookup.c

2013-10-11 20:03:06 +0300 Timo Sirainen <tss@iki.fi> (6db058e)

    lib-lda: lmtp_client_connect_tcp() shouldn't immediately call callbacks if
    dns lookup fails.


M	src/lib-lda/lmtp-client.c

2013-10-11 19:27:39 +0300 Timo Sirainen <tss@iki.fi> (b6540ed)

    imap: Improved "EOF while appending" disconnect log message.


M	src/imap/cmd-append.c

2013-10-11 19:17:10 +0300 Timo Sirainen <tss@iki.fi> (2d2ebe9)

    liblib: If parent ostream closes itself on error, close our ostream as well.
    This avoids a situation where ostream is basically unusable with
    last_failed_errno set, but it's not marked as closed. The current code often
    checks ostream->closed but doesn't check last_failed_errno. ostream-file
    also autocloses the stream, but filter ostreams without this patch don't
    autoclose, so this caused problems with e.g. IMAP COMPRESSION extension
    where the zlib-ostream didn't get marked as closed, although the problem was
    only logging "BUG: Unknown internal error" instead of "Disconnected" as the
    client's disconnect reason.


M	src/lib/ostream.c

2013-10-11 18:54:36 +0300 Timo Sirainen <tss@iki.fi> (ca31fc1)

    LAYOUT=index: Fixed race condition during mailbox creation.


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.h

2013-10-11 12:31:48 +0300 Timo Sirainen <tss@iki.fi> (e1cf5b2)

    lib-storage: If search finds a match to a cached header, don't open the body
    stream.


M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search.c

2013-10-11 12:22:56 +0300 Timo Sirainen <tss@iki.fi> (3f41cfa)

    lib-storage: Header+body searches might not have searched the body in some
    cases. Only the header was requested for the search stream, which with imapc
    and pop3c could have caused the body not to be in the stream, although it
    usually was because of the "fetch body" hint.


M	src/lib-storage/index/index-search.c

2013-10-10 20:50:10 +0300 Timo Sirainen <tss@iki.fi> (28482af)

    master: host.domain lookups weren't cached, they were done at the worst
    possible time. This fixes "net_connect_unix(imap) failed: Resource
    temporarily unavailable" and various other issues where processes weren't
    being created fast enough if the host.domain lookup was slow (e.g. done via
    external DNS).


M	src/master/service-process.c

2013-10-08 16:48:04 +0300 Timo Sirainen <tss@iki.fi> (4addfd2)

    auth: Added ability to truncate values logged by auth_verbose_passwords.


M	doc/example-config/conf.d/10-logging.conf
M	src/auth/auth-request.c
M	src/auth/auth-settings.c

2013-10-08 10:04:55 +0300 Timo Sirainen <tss@iki.fi> (b99130e)

    lib-http: Added setting for User-Agent header.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-10-06 13:21:15 +0300 Timo Sirainen <tss@iki.fi> (34de499)

    lib-http: Fixed linking with some compilers Inline functions in
    http-header.h still required linking http-header.lo with e.g. Sun Studio


M	src/lib-http/Makefile.am

2013-10-05 13:29:26 +0300 Timo Sirainen <tss@iki.fi> (60fe2f1)

    lib-fs: Added FS_OPEN_FLAG_ASYNC_NOQUEUE


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2013-10-03 14:56:23 +0300 Timo Sirainen <tss@iki.fi> (0a1ef4d)

    dsync: Added missing alarm(0) This didn't really cause any problems normally
    since the process was usually just about to die anyway.


M	src/doveadm/dsync/doveadm-dsync.c

2013-10-03 11:34:48 +0300 Timo Sirainen <tss@iki.fi> (077ab44)

    If DEBUG_OUTOFMEM environment is set, abort() on "out of memory" errors.


M	src/lib/failures.c
M	src/master/master-settings.c
M	src/master/service-process.c

2013-10-03 11:20:09 +0300 Timo Sirainen <tss@iki.fi> (5973d49)

    dsync: Removed periodic commits while importing. The problem is that the
    current algorithm doesn't handle it correctly. If there already are some
    mails that exist locally, or remote has duplicate mails, the messages may
    not be saved in the UID order, and if there's a commit between such wrong
    ordering, the UIDs get renumbered.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-10-02 11:48:31 +0300 Timo Sirainen <tss@iki.fi> (5f92936)

    mailbox_list_index: Fixed assert-crash sometimes when deleting a mailbox.


M	src/lib-storage/list/mailbox-list-index.c

2013-09-30 15:28:04 +0300 Timo Sirainen <tss@iki.fi> (ca096c5)

    doveadm fs delete: Added -R parameter for recursive deletion.


M	src/doveadm/doveadm-fs.c

2013-09-30 09:04:43 +0300 Timo Sirainen <tss@iki.fi> (a31d634)

    lib-storage: Fail with an error instead of crash with namespace
    prefix=inbox/


M	src/lib-storage/mail-storage.c

2013-09-26 05:51:43 +0200 Timo Sirainen <tss@iki.fi> (f2767c7)

    Panic if io_remove() fails with EBADF. It's a bug that shouldn't really be
    ignored. Panicing will give a debuggable core dump.


M	src/lib/ioloop-epoll.c

2013-09-26 04:55:59 +0200 Timo Sirainen <tss@iki.fi> (fe145bd)

    lib-http: 32bit system fix.


M	src/lib-http/http-header-parser.c

2013-09-25 10:06:19 +0300 Timo Sirainen <tss@iki.fi> (4036973)

    Added signature for changeset 1de9a494cb25


M	.hgsigs

2013-09-25 10:06:08 +0300 Timo Sirainen <tss@iki.fi> (dd4eafd)

    Added tag 2.2.6 for changeset 1de9a494cb25


M	.hgtags

2013-09-25 10:06:08 +0300 Timo Sirainen <tss@iki.fi> (ca287f3)

    Released v2.2.6.


M	NEWS
M	TODO
M	configure.ac

2013-09-23 04:25:16 +0300 Timo Sirainen <tss@iki.fi> (5d4c793)

    master: Added reuse_port setting to inet_listeners, which enables
    SO_REUSEPORT if available. After forking a new service process, a new
    listener socket is created for each such inet_listener. Linux v3.9+ added
    SO_REUSEPORT feature, which should distribute clients more uniformly to the
    processes. I'm not sure if this makes any difference in BSDs.

    At least in Linux v3.9 there was still a bug that if the number of listening 
    processes changed, some TCP handshakes might not finish. I don't see if this 
    has already been fixed, so this is probably safe to use only for services 
    whose process count doesn't change (e.g. process_min_avail is set high 
    enough).

M	src/imap-login/imap-login-settings.c
M	src/lib-master/service-settings.h
M	src/master/master-settings.c
M	src/master/service-listen.c
M	src/master/service-listen.h
M	src/master/service-process.c
M	src/master/service.h
M	src/pop3-login/pop3-login-settings.c

2013-09-23 04:06:08 +0300 Timo Sirainen <tss@iki.fi> (b270c58)

    lib: Added net_listen_full() with a flag to set SO_REUSEPORT on the socket
    if available.


M	src/lib/net.c
M	src/lib/net.h

2013-09-22 07:43:31 +0300 Timo Sirainen <tss@iki.fi> (d15b2fc)

    imapc: Don't crash if imapc_password is missing.


M	src/lib-storage/index/imapc/imapc-list.c

2013-09-22 07:40:01 +0300 Timo Sirainen <tss@iki.fi> (435a577)

    maildir: Autocreate missing cur/ new/ tmp/ directories only with Maildir++
    and imapdir. \Noselect mailboxes aren't possible with those layouts, but
    with other layouts they are and they shouldn't get automatically created
    just by selecting them.


M	src/lib-storage/index/maildir/maildir-storage.c

2013-09-22 07:24:26 +0300 Timo Sirainen <tss@iki.fi> (835f2fc)

    i_getpw*(): Added OpenBSD workaround.


M	src/lib/ipwd.c

2013-09-22 07:20:12 +0300 Timo Sirainen <tss@iki.fi> (0899748)

    istream-attachment-connector: Add base64 parameters to stream name for error
    messages.


M	src/lib-mail/istream-attachment-connector.c

2013-09-22 07:19:39 +0300 Timo Sirainen <tss@iki.fi> (825111a)

    istream-sized: Fail read() also when the stream is larger than it should
    have been.


M	src/lib/istream-sized.c

2013-09-22 06:30:47 +0300 Timo Sirainen <tss@iki.fi> (fb10095)

    mbox: Fixed assert-crash due to wrong transaction_count handling. This
    happened only when messages had been expunged by another session just before
    saving a new message.


M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/mail-storage.c

2013-09-22 04:41:50 +0300 Timo Sirainen <tss@iki.fi> (6516e7c)

    lib-fs: Improved fs_write_*() error messages.


M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2013-09-22 04:40:02 +0300 Timo Sirainen <tss@iki.fi> (9ba3ecf)

    lib-storage: Improve error message logging when attachment writing fails


M	src/lib-storage/index/index-attachment.c

2013-09-22 04:39:35 +0300 Timo Sirainen <tss@iki.fi> (f4735bf)

    lib: Added [io]_stream_create_error_str()


M	src/lib/iostream-private.h
M	src/lib/iostream.c
M	src/lib/istream.c
M	src/lib/istream.h
M	src/lib/ostream.c
M	src/lib/ostream.h

2013-09-22 04:24:29 +0300 Timo Sirainen <tss@iki.fi> (904ca86)

    ostream-errno: last_failed_errno wasn't set, causing problems with some
    functions.


M	src/lib/ostream.c

2013-09-22 04:14:23 +0300 Timo Sirainen <tss@iki.fi> (0482d89)

    Fixes and improvements to istream-attachment-extractor error handling. If an
    attachment saving failed, the mail was still saved to disk, just without the
    attachments.


M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-attachment-extractor.h
M	src/lib-mail/test-istream-attachment.c
M	src/lib-storage/index/index-attachment.c

2013-09-22 03:40:14 +0300 Timo Sirainen <tss@iki.fi> (49b3aba)

    acl: Hide non-listable mailboxes from a shared subscriptions file.


M	src/plugins/acl/acl-mailbox-list.c

2013-09-22 03:17:12 +0300 Timo Sirainen <tss@iki.fi> (10666ea)

    example-config: Fixed login_log_format comment.


M	doc/example-config/conf.d/10-logging.conf

2013-09-22 02:44:21 +0300 Timo Sirainen <tss@iki.fi> (780f1d9)

    auth: If auth_verbose_passwords is set, log the password also for unknown
    users.


M	src/auth/auth-request.c

2013-09-22 02:32:05 +0300 Timo Sirainen <tss@iki.fi> (ed3c4fa)

    auth: Use a common auth_request_log_unknown_user() for logging "unknown
    user" entries.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/db-passwd-file.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-pam.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-vpopmail.c

2013-09-22 02:24:05 +0300 Timo Sirainen <tss@iki.fi> (731238b)

    net_listen_unix(): If path is too long, return EOVERFLOW instead of EINVAL.


M	src/lib/net.c

2013-09-22 02:23:30 +0300 Timo Sirainen <tss@iki.fi> (72e0939)

    If EOVERFLOW errno isn't defined by system, fallback to ERANGE instead of
    EINVAL. ERANGE is used by other functions as well, such as getpwnam_r().


M	src/lib/compat.h

2013-09-22 02:20:09 +0300 Timo Sirainen <tss@iki.fi> (f974134)

    Added ssl_prefer_server_ciphers setting.


M	doc/example-config/conf.d/10-ssl.conf
M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl-settings.h
M	src/lib-master/master-service-ssl.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl.h
M	src/login-common/ssl-proxy-openssl.c

2013-09-22 02:07:16 +0300 Timo Sirainen <tss@iki.fi> (fad2e08)

    mbox: Fixed mailbox_list_index=yes to work with non-Dovecot mbox changes.


M	src/lib-storage/index/mbox/Makefile.am
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-storage.h
A	src/lib-storage/index/mbox/mbox-sync-list-index.c
M	src/lib-storage/index/mbox/mbox-sync-private.h

2013-09-22 01:40:11 +0300 Timo Sirainen <tss@iki.fi> (c7eb1ff)

    *-login: Added %{orig_user}, %{orig_username} and %{orig_domain} variables.
    The original username is what the client sent to server before any
    translations.


M	src/auth/auth-request-handler.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2013-09-22 01:09:32 +0300 Timo Sirainen <tss@iki.fi> (d0ff92b)

    dsync: Added -P parameter to do a purge for the remote storage after
    syncing.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c

2013-09-21 23:33:42 +0300 Timo Sirainen <tss@iki.fi> (6f970b9)

    lib-storage: Fixed listescape when escape_char was the same as namespace
    separator.


M	src/lib-storage/mailbox-list.c

2013-09-21 05:28:45 +0300 Timo Sirainen <tss@iki.fi> (a471e03)

    imap: Send * OK [CLOSED] always before tagged SELECT reply.


M	src/imap/cmd-select.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h

2013-09-21 05:05:22 +0300 Timo Sirainen <tss@iki.fi> (d2ca20a)

    lib-storage: Don't create a settings cache for initial global settings read.
    This fixes at least doveadm -A so that it doesn't connect to config process
    for each user.


M	src/lib-storage/mail-storage-service.c

2013-09-21 05:03:03 +0300 Timo Sirainen <tss@iki.fi> (5afc76d)

    auth: Fixed user iteration hang due to earlier stream corking changes. Also
    fixed process title updating for auth-worker process during LIST.


M	src/auth/auth-master-connection.c
M	src/auth/auth-worker-client.c

2013-09-21 04:48:52 +0300 Timo Sirainen <tss@iki.fi> (e262b92)

    lib-auth: Fixed infinite looping if user listing failed because auth process
    disconnected.


M	src/lib-auth/auth-master.c

2013-09-21 04:02:51 +0300 Timo Sirainen <tss@iki.fi> (bdb454d)

    lib-auth: Recent cleanup commit was actually cleaning up too much.


M	src/lib-auth/auth-master.c

2013-09-21 03:49:22 +0300 Timo Sirainen <tss@iki.fi> (16cd2c1)

    doveadm sync: When -1 parameter is used, ignore missing mailboxes in source.
    Previously the syncs finished with "Mailbox changes caused a desync." and
    exit code 2. This was especially common when the destination server had new
    autocreated mailboxes and user logged in after the first dsync.


M	src/doveadm/dsync/dsync-brain-mailbox.c

2013-09-21 03:40:46 +0300 Timo Sirainen <tss@iki.fi> (311cbd9)

    dsync: Added more consistency when debug logging about changes during sync.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-mailbox-import.c

2013-09-21 03:29:09 +0300 Timo Sirainen <tss@iki.fi> (31d32d3)

    dsync: Added some more debug logging.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-09-21 02:55:27 +0300 Timo Sirainen <tss@iki.fi> (4f2fa2e5)

    imapc: Don't log unnecessary errors at deinit about aborted hiearchy
    separator lookup. The lookup is done asynchronously at startup. It doesn't
    matter if we never get around to finishing it.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2013-09-20 10:45:22 +0300 Timo Sirainen <tss@iki.fi> (dfbd56c)

    director: Detect lost director restarts and reset last_sync_seq.


M	src/director/director-connection.c

2013-09-20 10:35:34 +0300 Timo Sirainen <tss@iki.fi> (88cb159)

    director: Make sure director restart notifications go to everyone in the
    ring.


M	src/director/director-connection.c

2013-09-20 10:12:24 +0300 Timo Sirainen <tss@iki.fi> (84304ca)

    director: Directors weren't always marked as restarted when they were.


M	src/director/director-connection.c

2013-09-20 10:11:45 +0300 Timo Sirainen <tss@iki.fi> (9d2575d)

    director: Fix & improvement to debug logging.


M	src/director/director-connection.c

2013-09-20 10:00:48 +0300 Timo Sirainen <tss@iki.fi> (7e656f6)

    director: Added more debug logging.


M	src/director/director-connection.c

2013-09-20 09:46:31 +0300 Timo Sirainen <tss@iki.fi> (44875c8)

    director: Don't assert-crash if PASS lookup fails.


M	src/director/login-connection.c

2013-09-20 04:27:29 +0300 Timo Sirainen <tss@iki.fi> (754943e)

    dsync: Don't log "Mailbox changes caused a desync" warning when running via
    doveadm-server.


M	src/doveadm/dsync/doveadm-dsync.c

2013-09-20 04:20:22 +0300 Timo Sirainen <tss@iki.fi> (586ad46)

    ssl-params: Long-running ssl-params process shouldn't cause Dovecot restart
    to fail.


M	src/ssl-params/ssl-params.c

2013-09-20 04:01:10 +0300 Timo Sirainen <tss@iki.fi> (3136f1b)

    lib-ssl-iostream: Give better error message if CA settings are missing.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2013-09-20 03:54:31 +0300 Timo Sirainen <tss@iki.fi> (f605df8)

    dbox: Fixed "UIDVALIDITY=0" error race condition. If session 1 had mkdir()ed
    but not yet created the initial index, while session 2 attempted to open the
    mailbox, it would create an empty index and log the error.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.h
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.h
M	src/lib-storage/index/dbox-single/sdbox-sync.c

2013-09-20 03:41:51 +0300 Timo Sirainen <tss@iki.fi> (1f0da9f)

    master: Make sure new processes aren't created after stop signal is
    received.


M	src/master/main.c

2013-09-20 02:38:53 +0300 Timo Sirainen <tss@iki.fi> (fc22ecb)

    mbox: Handle correctly if MAIL_FETCH_HEADER_MD5 lookup fails because mail is
    already expunged.


M	src/lib-storage/index/mbox/mbox-mail.c

2013-09-20 02:28:45 +0300 Timo Sirainen <tss@iki.fi> (d5b3665)

    lib-auth: Don't leave stale pointers to stack lying around in memory.


M	src/lib-auth/auth-master.c

2013-09-20 00:59:36 +0300 Timo Sirainen <tss@iki.fi> (3eb142b)

    ioloop-kqueue: Added assert


M	src/lib/ioloop-kqueue.c

2013-09-20 00:22:15 +0300 Timo Sirainen <tss@iki.fi> (6a67bcb)

    imap: If FETCH fails, log the stream's error string instead of errno.


M	src/imap/cmd-append.c
M	src/imap/cmd-urlfetch.c
M	src/imap/imap-fetch-body.c

2013-09-20 00:20:19 +0300 Timo Sirainen <tss@iki.fi> (2c42748)

    istream-chain/concat/seekable: When child stream fails, copy its error to
    ourself.


M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-seekable.c

2013-09-20 00:14:11 +0300 Timo Sirainen <tss@iki.fi> (9f131c8)

    istream-file: Assert-crash if read() fails with EBADF. Something's already
    wrong at that point and it may not be safe to continue. Also crashing makes
    it easier to debug such situation.


M	src/lib/istream-file.c

2013-09-20 00:12:45 +0300 Timo Sirainen <tss@iki.fi> (1c6f6f5)

    iostreams: Set stream error string when it provides extra information.


M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-zlib.c
M	src/lib-fs/istream-metawrap.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib/istream-base64-decoder.c
M	src/lib/istream-concat.c
M	src/lib/istream-file.c
M	src/lib/istream-hash.c
M	src/lib/istream-jsonstr.c
M	src/lib/istream-mmap.c
M	src/lib/istream-sized.c
M	src/lib/ostream-file.c

2013-09-20 00:00:49 +0300 Timo Sirainen <tss@iki.fi> (862ec87)

    iostream: Added ability to set/get error strings for streams.


M	src/lib/iostream-private.h
M	src/lib/iostream.c
M	src/lib/istream.c
M	src/lib/istream.h
M	src/lib/ostream.c
M	src/lib/ostream.h

2013-09-19 22:44:20 +0300 Timo Sirainen <tss@iki.fi> (cf4a4a3)

    doveadm: Added "auth lookup" command to do a passdb lookup.


M	src/doveadm/doveadm-auth.c

2013-09-19 22:43:45 +0300 Timo Sirainen <tss@iki.fi> (1479a68)

    auth: Fixed non-auth passdb lookup when password had ".<encoding>" suffix.


M	src/auth/passdb.c

2013-09-19 22:20:56 +0300 Timo Sirainen <tss@iki.fi> (9a7f22e)

    imapc: Abort pending commands before any deinitialization to avoid crashes.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c

2013-09-18 23:24:30 +0300 Stephan Bosch <stephan@rename-it.nl> (1096236)

    lib-http: Created tests for http_request_parser.


M	src/lib-http/Makefile.am
A	src/lib-http/test-http-request-parser.c

2013-09-18 23:24:22 +0300 Stephan Bosch <stephan@rename-it.nl> (ded5763)

    uri-util: Improved authority 'host' parse error.


M	src/lib/uri-util.c

2013-09-18 23:24:11 +0300 Stephan Bosch <stephan@rename-it.nl> (1490e4e)

    lib-http: http-url: Fixed return of proper error message in case of a
    failure to parse request target Host header. Assigned the error to the
    parser object rather than returning it directly.


M	src/lib-http/http-url.c

2013-09-18 23:24:02 +0300 Stephan Bosch <stephan@rename-it.nl> (e74d620)

    lib-http: Fixed handling of limits=NULL parameter for
    http_request_parser_init. Got messed up in patch queue.


M	src/lib-http/http-request-parser.c

2013-09-18 00:00:05 +0300 Timo Sirainen <tss@iki.fi> (329c218)

    dsync: Don't attempt to access mailbox contents with -g "" or -m ""
    parameter.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2013-09-17 23:32:57 +0300 Timo Sirainen <tss@iki.fi> (3a37fbe)

    lib-storage: Added a separate prefix for server metadata that aren't deleted
    with INBOX.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage.h

2013-09-17 23:12:03 +0300 Timo Sirainen <tss@iki.fi> (ec047a9)

    dsync: Improved debug/error logging for changes during sync.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-mailbox-import.c

2013-09-17 21:57:48 +0300 Stephan Bosch <stephan@rename-it.nl> (1e653c7)

    lib-http: Added (non-default) support for parsing user:pasword from HTTP
    URL.


M	src/lib-http/http-url.c
M	src/lib-http/http-url.h
M	src/lib-http/test-http-url.c

2013-09-17 21:57:14 +0300 Stephan Bosch <stephan@rename-it.nl> (4c8646c)

    lib-imap: imap-url: Forgot to check for the presence of ':' in userinfo,
    which is not allowed.


M	src/lib-imap/imap-url.c
M	src/lib-imap/test-imap-url.c

2013-09-16 10:05:24 +0300 Timo Sirainen <tss@iki.fi> (47f00ff)

    imap: Fixed/improved error logging for FETCH


M	src/imap/imap-fetch-body.c

2013-09-17 02:40:17 +0300 Stephan Bosch <stephan@rename-it.nl> (87c121a)

    lib-http: http-client: Allow overriding all implicitly generated special
    headers. Which are: Connection, Content-Length, Date, Expect, Host, and
    Transfer-Encoding.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2013-09-16 13:17:52 +0300 Timo Sirainen <tss@iki.fi> (3ec5378)

    Fixed uri_parse_slashslash_authority() to skip over "//".


M	src/lib/uri-util.c

2013-09-16 01:02:03 +0300 Stephan Bosch <stephan@rename-it.nl> (2e6f9d3)

    lib-http: http-client: Fixed segfault caused by earlier improvement of
    connection output locking. Segfault was triggered when an aborted request
    received a response.


M	src/lib-http/http-client-connection.c

2013-09-15 03:56:47 +0300 Stephan Bosch <stephan@rename-it.nl> (2ccb0bc)

    lib-http: http-client: Implemented explicit HTTP/1.0 support.


M	src/lib-http/http-client-request.c

2013-09-15 03:56:25 +0300 Stephan Bosch <stephan@rename-it.nl> (81498cf)

    lib-http: Added support for handling HTTP/1.0 messages explicitly. This
    means that default connection persistence semantics are inverted for
    HTTP/1.0 and keep-alive Connection option is recognized.


M	src/lib-http/http-message-parser.c

2013-09-15 03:55:57 +0300 Stephan Bosch <stephan@rename-it.nl> (22b47ec)

    lib-http: Added support for parsing Expect: header (currently only accepts
    `100-continue').


M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h
M	src/lib-http/http-request.h

2013-09-15 03:55:11 +0300 Stephan Bosch <stephan@rename-it.nl> (b8a1b8e)

    lib-http: http-request-parser: Added function to test whether payload from
    previous request is still being parsed. This is needed in the server
    implementation to check whether a request is completely read.


M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h

2013-09-15 03:54:04 +0300 Stephan Bosch <stephan@rename-it.nl> (fa4d00f)

    lib-http: Implemented limits on request method and target length.


M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h
M	src/lib-http/http-request.h
M	src/lib-http/test-http-server.c

2013-09-15 03:52:01 +0300 Stephan Bosch <stephan@rename-it.nl> (1175415)

    lib-http: Added support for enforcing a payload limit for incoming HTTP
    messages.


M	src/lib-http/http-message-parser.c
M	src/lib-http/http-message-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-transfer.h
M	src/lib-http/test-http-transfer.c

2013-09-15 03:50:08 +0300 Stephan Bosch <stephan@rename-it.nl> (208dcaf)

    lib-http: Adjusted message and request parsers to return an error code.


M	src/lib-http/http-message-parser.c
M	src/lib-http/http-message-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h
M	src/lib-http/http-response-parser.c
M	src/lib-http/test-http-server.c

2013-09-15 03:47:54 +0300 Stephan Bosch <stephan@rename-it.nl> (abd1c1f)

    lib-http: Adjusted request parser to pre-parse the request target and host
    header into a proper target url.


M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request.h
M	src/lib-http/test-http-server.c

2013-09-15 03:47:29 +0300 Stephan Bosch <stephan@rename-it.nl> (e641c9f)

    lib-http: Added support for parsing request target URLs.


M	src/lib-http/http-request.h
M	src/lib-http/http-url.c
M	src/lib-http/http-url.h

2013-09-15 03:46:25 +0300 Stephan Bosch <stephan@rename-it.nl> (101e78a)

    lib-http: Improved display of invalid characters in parse error messages.


M	src/lib-http/http-request-parser.c
M	src/lib-http/http-response-parser.c

2013-09-15 03:46:12 +0300 Stephan Bosch <stephan@rename-it.nl> (feba5e5)

    lib-http: Implemented limits on overall HTTP header size, size of individual
    header fields and the number of fields in the header.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-header-parser.h
M	src/lib-http/http-header.h
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-message-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-response-parser.h
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-server.c

2013-09-15 03:44:42 +0300 Stephan Bosch <stephan@rename-it.nl> (e8f1e51)

    lib-http: Unified http-request.h and http-response.h headers. Renamed struct
    http_response_header to struct http_header_field, encapsulated the array in
    struct http_header and put it all in http-header.h/c Added inline utility
    functions for header querying and getting response/request payload size.


M	src/lib-http/Makefile.am
M	src/lib-http/http-client-request.c
A	src/lib-http/http-header.c
A	src/lib-http/http-header.h
M	src/lib-http/http-message-parser.c
M	src/lib-http/http-message-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h
A	src/lib-http/http-request.c
A	src/lib-http/http-request.h
M	src/lib-http/http-response-parser.c
A	src/lib-http/http-response.c
M	src/lib-http/http-response.h

2013-09-15 03:39:45 +0300 Stephan Bosch <stephan@rename-it.nl> (9e7bf91)

    lib-http: Improved message header and body parsing for better RFC
    compliance. Added pre-parsed transfer-encoding and connection header content
    (array) to parsed message struct. Fixed message body handling for when both
    transfer-encoding and content-length headers are missing. Now duplicates of
    unique important message headers yield an error.


M	src/lib-http/http-message-parser.c
M	src/lib-http/http-message-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-response.h
M	src/lib-http/http-transfer.h

2013-09-15 03:37:59 +0300 Stephan Bosch <stephan@rename-it.nl> (233a967)

    lib-http: Added support for parsing HTTP word syntax, which includes
    quoted-string.


M	src/lib-http/http-parser.c
M	src/lib-http/http-parser.h

2013-09-15 03:36:44 +0300 Stephan Bosch <stephan@rename-it.nl> (6dad088)

    lib-http: Adjusted message parser to accept pool from caller.


M	src/lib-http/http-message-parser.c
M	src/lib-http/http-message-parser.h
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h
M	src/lib-http/http-response-parser.c
M	src/lib-http/test-http-server.c

2013-09-15 03:36:18 +0300 Stephan Bosch <stephan@rename-it.nl> (6a90041)

    lib-http: Adjusted response and request parsers to accept a request/response
    object to fill with data, rather than have it return one.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-request-parser.c
M	src/lib-http/http-request-parser.h
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-response-parser.h
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-server.c

2013-09-15 03:35:04 +0300 Stephan Bosch <stephan@rename-it.nl> (a4e186e)

    lib-http: Added support for asynchronous payload for requests. This means
    that the payload stream passed to the request can be a non-blocking socket
    stream from some other connection (e.g. proxy client connection).


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2013-09-15 03:34:06 +0300 Stephan Bosch <stephan@rename-it.nl> (df70bf8)

    uri-util: Added support for parsing bare authority URI component (for use in
    HTTP).


M	src/lib-http/http-url.c
M	src/lib-imap/imap-url.c
M	src/lib/uri-util.c
M	src/lib/uri-util.h

2013-09-15 03:33:44 +0300 Stephan Bosch <stephan@rename-it.nl> (6d57319)

    lib-http: http-client: Requests now automatically generate a Date header.
    The used date value is normally the submission time of the request, but it
    can be set explicitly.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2013-09-15 03:33:04 +0300 Stephan Bosch <stephan@rename-it.nl> (930a232)

    lib-http: Fixed client connection and peer log labels to show proper IPv6
    peers. The labels did not put IPv6 addresses in square brackets.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-09-15 03:32:11 +0300 Stephan Bosch <stephan@rename-it.nl> (3fe9224)

    lib-http: Removed useless prev,next fields from struct http_client_request.


M	src/lib-http/http-client-private.h

2013-09-15 03:31:51 +0300 Stephan Bosch <stephan@rename-it.nl> (188297b)

    lib-http: Fixed handling of non-standard CRLF at end of request.


M	src/lib-http/http-request-parser.c

2013-09-15 03:31:28 +0300 Stephan Bosch <stephan@rename-it.nl> (fc94140)

    lib-http: http-client: Fixed request scheduling and connection management.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-09-15 03:29:03 +0300 Stephan Bosch <stephan@rename-it.nl> (2742107)

    lib-http: http-client: Fixed leak of ostream when request was resubmitted
    upon 417 response regarding 100-continue. This would only occur when the
    server refuses Expect: 100-continue with a 417 response. The payload_output
    stream would be overwritten without being freed first.


M	src/lib-http/http-client-request.c

2013-09-15 03:28:21 +0300 Stephan Bosch <stephan@rename-it.nl> (fde2e39)

    lib-http: http-client: Connection was using wrong request index in
    request_wait_list to continue sending outgoing payload.


M	src/lib-http/http-client-connection.c

2013-09-15 03:27:31 +0300 Stephan Bosch <stephan@rename-it.nl> (858a13d)

    lib-http: http-client: Fixed pipelining when payload synchronizatio
    (100-continue) is used. Forgot to lock the connection output, which meant
    that new requests would enqueued for the connection while waiting for 100
    Continue. This would cause an assert failure.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-request.c

2013-09-14 00:26:58 +0300 Timo Sirainen <tss@iki.fi> (b4a7dbf)

    Comment update.


M	src/lib/connection.h

2013-09-14 00:26:45 +0300 Timo Sirainen <tss@iki.fi> (b6ecc96)

    lib-fs: If backend doesn't implement exists(), emulate it with stat().


M	src/lib-fs/fs-api.c

2013-09-12 03:52:01 +0300 Timo Sirainen <tss@iki.fi> (7bf0bc5)

    doveadm: Don't refer to old doveadm_proxy_port setting name in error
    message.


M	src/doveadm/doveadm-mail-server.c

2013-09-12 02:58:51 +0300 Timo Sirainen <tss@iki.fi> (202a345)

    istream-hash: Data was hashed multiple times in some situations


M	src/lib/istream-hash.c

2013-09-12 02:33:01 +0300 Timo Sirainen <tss@iki.fi> (66d84e6)

    istream: Improved "stream not seekable" panic message.


M	src/lib/istream.c

2013-09-12 02:32:47 +0300 Timo Sirainen <tss@iki.fi> (cbb79ea)

    istream-hash: Allow seeking, but only after reading the hash.


M	src/lib/istream-hash.c

2013-09-12 01:38:54 +0300 Timo Sirainen <tss@iki.fi> (6523f54)

    auth: auth-client socket should be owned by $default_internal_user It's
    mostly the same as auth-login, which is also owned by it.


M	src/auth/auth-settings.c

2013-09-10 04:11:03 +0300 Timo Sirainen <tss@iki.fi> (9c45f33)

    lib-fs: Added support for asynchronous fs iteration.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2013-09-10 00:27:12 +0300 Timo Sirainen <tss@iki.fi> (67a163f)

    lib-fs: Added support for giving a hash of the written data to be verified
    by storage.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2013-09-09 04:34:58 +0300 Timo Sirainen <tss@iki.fi> (3157f61)

    liblib: Added istream-hash, similar to ostream-hash.


M	src/lib/Makefile.am
A	src/lib/istream-hash.c
A	src/lib/istream-hash.h

2013-09-09 04:34:45 +0300 Timo Sirainen <tss@iki.fi> (61f018f)

    Minor code cleanup.


M	src/lib/ostream-hash.h

2013-09-08 19:20:39 +0300 Timo Sirainen <tss@iki.fi> (d8361cc)

    hmac: Fixed crashes on CPUs that don't allow unaligned memory access.


M	src/lib/hmac-cram-md5.c
M	src/lib/hmac.c
M	src/lib/hmac.h

2013-09-06 18:30:54 +0300 Timo Sirainen <tss@iki.fi> (1c1ded8)

    auth: Removed unnecessary NULL check.


M	src/auth/auth-request.c

2013-09-06 18:28:59 +0300 Timo Sirainen <tss@iki.fi> (8236d57)

    imapc: Don't crash if server sends EXISTS while mailbox isn't selected.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2013-09-06 18:26:48 +0300 Timo Sirainen <tss@iki.fi> (de3466d)

    fts-lucene: Fixed crash in doveadm dumping lucene index.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2013-09-06 02:39:56 +0300 Timo Sirainen <tss@iki.fi> (72e15c6)

    Avoid doing side effects in assert.


M	src/lib-imap-client/imapc-connection.c

2013-09-06 02:39:16 +0300 Timo Sirainen <tss@iki.fi> (ee24825)

    lib-index: Minor fix to regenerating missing transaction log parts.


M	src/lib-index/mail-index-view-sync.c

2013-09-05 21:06:50 +0300 Timo Sirainen <tss@iki.fi> (16a92d0)

    lib-lda: Fixed passing through error message when mailbox couldn't be
    opened.


M	src/lib-lda/mail-deliver.c

2013-09-04 22:43:47 +0300 Timo Sirainen <tss@iki.fi> (5e93930)

    And removed accidentally committed nbsp.


M	src/lib-storage/mailbox-uidvalidity.c

2013-09-04 22:41:42 +0300 Timo Sirainen <tss@iki.fi> (af8b124)

    Fixed file descriptor leaks in rather unimportant places. Found by Coverity
    scan.


M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/lib-master/master-service-settings.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib/unix-socket-create.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/zlib/zlib-plugin.c
M	src/ssl-params/ssl-params.c

2013-09-04 22:16:02 +0300 Timo Sirainen <tss@iki.fi> (76959d3)

    lib-index: Fixed modseq updates when modseq was over 32bits long


M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-transaction-log-file.c

2013-09-04 22:13:01 +0300 Timo Sirainen <tss@iki.fi> (93dbad4)

    i_close_fd() didn't handle errors correctly with gcc.


M	src/lib/macros.h

2013-09-04 21:23:33 +0300 Timo Sirainen <tss@iki.fi> (2a325b9)

    Fixed off-by-one buffer overflows (practically non-exploitable). Found by
    Coverity scan.


M	src/doveadm/doveadm-master.c
M	src/master/main.c

2013-09-02 17:44:39 +0300 Timo Sirainen <tss@iki.fi> (0de730a)

    master: Fix to previous pre-forking change.


M	src/master/service-monitor.c

2013-09-02 17:37:47 +0300 Timo Sirainen <tss@iki.fi> (e7a4c77)

    master: Pre-fork processes only while master doesn't have more important
    things to do.


M	src/master/service-monitor.c
M	src/master/service-process.c
M	src/master/service.h

2013-09-02 17:06:49 +0300 Timo Sirainen <tss@iki.fi> (b52230a)

    lib-master: If net_connect_unix() fails with EAGAIN, point to a wiki link
    for reasons.


M	src/lib-master/master-auth.c
M	src/lib-master/master-login.c

2013-08-29 16:42:55 +0300 Timo Sirainen <tss@iki.fi> (6bcbea7)

    lib-ssl-iostream: Don't assert-crash if stream buffer gets full.


M	src/lib-ssl-iostream/istream-openssl.c

2013-08-29 00:57:13 +0300 Timo Sirainen <tss@iki.fi> (8cadc80)

    lib-storage: Auto-create dovecot-uidvalidity's missing parent directory


M	src/lib-storage/mailbox-uidvalidity.c

2013-08-29 00:53:30 +0300 Timo Sirainen <tss@iki.fi> (30a5cfa)

    Fixed compiling with old gcc.


M	src/log/log-error-buffer.c

2013-08-27 04:06:43 +0300 Timo Sirainen <tss@iki.fi> (dacb791)

    dbox: When fixing a broken file, try harder to find only valid
    message/metadata positions. The previous method sometime broke with
    compressed mail content, because the magic blocks were so short.


M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.h

2013-08-21 23:30:07 +0300 Timo Sirainen <tss@iki.fi> (ce28ada)

    director: Reset last-seen-sync-sequence after remote director restarts.


M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-host.h

2013-08-21 20:03:13 +0300 Timo Sirainen <tss@iki.fi> (2f1853d)

    lib-storage: When doing a fast sync, refresh index to see if it had any
    changes. I'm pretty sure this used to be done earlier, but probably some
    optimizations dropped it at some point.


M	src/lib-storage/index/index-sync.c

2013-08-21 19:40:54 +0300 Timo Sirainen <tss@iki.fi> (96581b0)

    imap: Fixed potential assert crash in APPEND.


M	src/imap/cmd-append.c

2013-08-17 15:01:25 +0000 Pascal Volk <user@localhost.localdomain.org> (d6eb3cf)

    man: doveadm-pw.1: Option -p can also be used with -t.


M	doc/man/doveadm-pw.1.in

2013-08-15 20:25:12 +0300 Timo Sirainen <tss@iki.fi> (fe30a45)

    director: Previous change caused legitimate SYNC resends to be ignored.


M	src/director/director-connection.c

2013-08-13 21:02:04 +0300 Timo Sirainen <tss@iki.fi> (32efae1)

    lmtp: Make it clear that the lda_settings is unexpanded in struct client.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2013-08-13 20:59:39 +0300 Timo Sirainen <tss@iki.fi> (7a4ba2c)

    Minor change to prevent invalid code changes.


M	src/auth/auth-request.c
M	src/auth/auth-request.h

2013-08-13 20:58:56 +0300 Timo Sirainen <tss@iki.fi> (4612f64)

    lib-lda: Default postmaster_address wasn't being set. This broke after it
    was set to allow %variables.


M	src/lib-lda/lda-settings.c

2013-08-13 20:57:41 +0300 Timo Sirainen <tss@iki.fi> (c9b225d)

    lib-lda: Don't alow %variables for hostname setting after all. I was
    thinking maybe %d could be used there, but with LMTP the hostname is used
    already in the greeting message before any RCPT TO is even done.


M	src/lib-lda/lda-settings.c

2013-08-12 19:02:07 +0300 Timo Sirainen <tss@iki.fi> (f2bb070)

    auth: Added %{domain_first} and %{domain_last} variables. They are both
    equal to %d normally, but differ when there are multiple '@' characters in
    the domain.


M	src/auth/auth-request.c
M	src/auth/auth-request.h

2013-08-12 17:24:05 +0300 Timo Sirainen <tss@iki.fi> (f24202d)

    lib-storage: If dovecot.index.thread corruption is noticed, delete the file.


M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-strmap.h
M	src/lib-storage/index/index-thread.c

2013-08-12 15:44:51 +0300 Timo Sirainen <tss@iki.fi> (d50ebf5)

    lib-lda: submission_host, sendmail_path and hostname settings can now
    contain %variables


M	src/lib-lda/lda-settings.c

2013-08-12 15:44:39 +0300 Timo Sirainen <tss@iki.fi> (4a510b3)

    lib-lda: sendmail_path setting can contain parameters now.


M	src/lib-lda/smtp-client.c

2013-08-11 22:54:32 +0300 Timo Sirainen <tss@iki.fi> (72b3eaf)

    lib-storage: Improved error message in threading code's lost message-id.


M	src/lib-storage/index/index-thread.c

2013-08-10 16:31:27 +0300 Timo Sirainen <tss@iki.fi> (7ec4907)

    lib-http: Removed more code duplication


M	src/lib-http/http-client-request.c

2013-08-10 15:00:36 +0300 Timo Sirainen <tss@iki.fi> (8608ffb)

    lib-http: Removed duplicated code


M	src/lib-http/http-client-request.c

2013-08-08 22:37:35 +0300 Timo Sirainen <tss@iki.fi> (39622d4)

    lmtp: Don't write extra ([]) to Received: line for mails via UNIX socket.


M	src/lmtp/commands.c

2013-08-07 19:47:17 +0300 Timo Sirainen <tss@iki.fi> (a23cb9e)

    imap: Fixed memory leak on APPEND error conditions.


M	src/imap/cmd-append.c

2013-08-07 19:40:16 +0300 Timo Sirainen <tss@iki.fi> (36ce71e)

    dsync: We didn't send the new protocol version in handshake. This caused
    problems when syncing mailbox formats that didn't support saving GUIDs.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-08-07 19:26:29 +0300 Timo Sirainen <tss@iki.fi> (e04e2ca)

    dsync: Avoid assert-crash after an error.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-08-07 18:00:32 +0300 Timo Sirainen <tss@iki.fi> (385fd14)

    ssl: Fixed compiling with older OpenSSL libraries.


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/login-common/ssl-proxy-openssl.c

2013-08-07 17:20:10 +0300 Timo Sirainen <tss@iki.fi> (61b0eeb)

    Compiler warning fixes.


M	src/director/director-connection.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/login-common/ssl-proxy-openssl.c

2013-08-07 16:09:29 +0300 Timo Sirainen <tss@iki.fi> (9b61a6d)

    quota: Improved init() failure error logging.


M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2013-08-06 18:44:37 +0000 Pascal Volk <user@localhost.localdomain.org> (dc6a2a9)

    master: Added --hostdomain to the help message.


M	src/master/main.c

2013-08-06 18:35:02 +0000 Pascal Volk <user@localhost.localdomain.org> (3813074)

    man: dovecot.1: Added description of option --hostdomain.


M	doc/man/dovecot.1.in

2013-08-06 18:28:31 +0300 Timo Sirainen <tss@iki.fi> (98bdd7c)

    doveadm: If server connection gets disconnected, log the reason.


M	src/doveadm/server-connection.c

2013-08-06 17:16:58 +0300 Timo Sirainen <tss@iki.fi> (cf91aa1)

    dsync: Stream disconnection error message improvement


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-08-06 17:06:50 +0300 Timo Sirainen <tss@iki.fi> (ecd14e4)

    doveadm-server: Error message logging improvements.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail-server.c

2013-08-06 16:54:33 +0300 Timo Sirainen <tss@iki.fi> (1d082a4)

    doveadm-server: Include client's IP address in logs.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2013-08-06 16:32:03 +0300 Timo Sirainen <tss@iki.fi> (1f61b0a)

    dsync: Don't leak iostreams when running via doveadm-server


M	src/doveadm/dsync/doveadm-dsync.c

2013-08-06 16:28:08 +0300 Timo Sirainen <tss@iki.fi> (f5fa1c5)

    dsync: Memory leak fix at deinit.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-08-06 16:07:50 +0300 Timo Sirainen <tss@iki.fi> (b4f4552)

    lib-ssl-iostream: Deinitialization fixes.


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl-private.h
M	src/lib-ssl-iostream/iostream-ssl.c

2013-08-06 15:11:14 +0300 Timo Sirainen <tss@iki.fi> (956b8ee)

    doveadm: If we get disconnected from server, log the reason.


M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/server-connection.c
M	src/doveadm/server-connection.h

2013-08-06 14:53:23 +0300 Timo Sirainen <tss@iki.fi> (91a5808)

    net_ip2addr() changed to return "" instead of NULL on failure. Pretty much
    everything in the code assumed that it would never fail, which it normally
    doesn't except if the ip_addr was created for UNIX sockets.


M	src/auth/auth-request.c
M	src/auth/passdb-pam.c
M	src/auth/passdb-vpopmail.c
M	src/lib/net.c
M	src/lib/net.h
M	src/lib/uri-util.c
M	src/lmtp/client.c
M	src/login-common/main.c

2013-08-06 14:46:36 +0300 Timo Sirainen <tss@iki.fi> (fb28d08)

    dsync: After reading remote hostname, use it for the log messages instead of
    IP.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-08-06 14:36:25 +0300 Timo Sirainen <tss@iki.fi> (c6c0865)

    master: Added --hostdomain setting to show the current hostdomain.


M	src/master/main.c

2013-08-06 14:25:49 +0300 Timo Sirainen <tss@iki.fi> (02ab29a)

    dsync: Name remote connections better.


M	src/doveadm/client-connection.c
M	src/doveadm/dsync/doveadm-dsync.c

2013-08-06 12:48:15 +0300 Timo Sirainen <tss@iki.fi> (e7d7571)

    replicator: Fixed assert-crash if dsync server disconnected.


M	src/replication/replicator/dsync-client.c

2013-08-05 22:22:51 +0300 Timo Sirainen <tss@iki.fi> (1e0df4f)

    Added signature for changeset 71f0696749ab


M	.hgsigs

2013-08-05 22:22:47 +0300 Timo Sirainen <tss@iki.fi> (c50e67f)

    Added tag 2.2.5 for changeset 71f0696749ab


M	.hgtags

2013-08-05 22:22:47 +0300 Timo Sirainen <tss@iki.fi> (29b63e9)

    Released v2.2.5.


M	NEWS
M	configure.ac

2013-08-05 22:21:29 +0300 Timo Sirainen <tss@iki.fi> (430d256)

    Make static analyzer happier.


M	src/director/user-directory.c
M	src/lib-http/test-http-response-parser.c

2013-08-05 22:16:02 +0300 Timo Sirainen <tss@iki.fi> (49621bf)

    lib-storage: Use a separate auth-userdb connection for iterating through
    users. This is required because the auth-userdb connection is also wanted in
    the middle of the iteration to do USER lookups.


M	src/lib-storage/mail-storage-service.c

2013-08-05 22:15:08 +0300 Timo Sirainen <tss@iki.fi> (769dea7)

    lib-auth: Previous changes didn't set the current ioloop correctly, causing
    problems.


M	src/lib-auth/auth-master.c

2013-08-05 22:13:28 +0300 Timo Sirainen <tss@iki.fi> (57434d8)

    doveadm: Minor memory leak fixes at deinit.


M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c

2013-08-05 21:47:11 +0300 Timo Sirainen <tss@iki.fi> (3d422a9)

    lib-auth: auth_master_user_list_*() shouldn't create ioloop if it already
    exists.


M	src/lib-auth/auth-master.c

2013-08-05 20:45:42 +0300 Timo Sirainen <tss@iki.fi> (f600530)

    maildir: mailbox_create() was returning 1 instead of 0 on success. This
    broke acl plugin's check to copy the ACLs to the newly created mailbox.


M	src/lib-storage/index/maildir/maildir-storage.c

2013-08-05 20:33:01 +0300 Timo Sirainen <tss@iki.fi> (c8ef5fc)

    dns: Use EAI_NONAME, not EAI_ADDRFAMILY to indicate "no addresses".


M	src/dns/dns-client.c
M	src/lib/net.h

2013-08-05 20:27:09 +0300 Timo Sirainen <tss@iki.fi> (a97a3ce)

    mbox: Don't use file_set_size() to grow mbox file size. posix_fallocate()
    apparently grows file size in 4kB blocks in GFS2 causing extra NULs to be
    written. The mbox file rarely needs to grow so much that there's any point
    in using any optimizations for it.

    Besides, this was the last place where file_set_size() was used. If no 
    further use can be found for it, it could be removed entirely.

M	src/lib-storage/index/mbox/mbox-sync.c

2013-08-05 20:12:10 +0300 Timo Sirainen <tss@iki.fi> (0c26faa)

    lib-auth: Another crashfix to auth_master_user_list_*()


M	src/lib-auth/auth-master.c

2013-08-05 15:52:52 +0000 Pascal Volk <user@localhost.localdomain.org> (cae8439)

    man: Added doveadm-exec.1.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-exec.1.in
M	doc/man/doveadm.1.in
M	doc/man/sed.sh

2013-08-05 17:38:13 +0300 Timo Sirainen <tss@iki.fi> (1e9ea95)

    lib-storage: Fixed listing INBOX's children with LAYOUT=fs and non-mbox
    format.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2013-08-05 16:59:21 +0300 Timo Sirainen <tss@iki.fi> (68e8c4a)

    net_gethosterror(): Never return NULL.


M	src/lib/net.c

2013-08-05 16:58:01 +0300 Timo Sirainen <tss@iki.fi> (ebbb3d4)

    lib-dns, dns: Don't use IPv4-only error codes


M	src/dns/dns-client.c
M	src/lib-dns/dns-lookup.c
M	src/lib/net.h

2013-08-05 14:06:23 +0300 Timo Sirainen <tss@iki.fi> (23079bf)

    lib-index: Replaced assert-crash with "index corrupted" error.


M	src/lib-index/mail-index-sync-update.c

2013-08-05 13:46:37 +0300 Timo Sirainen <tss@iki.fi> (5efcaaa)

    lib-index: Silently ignore next_uid shrinking without treating them as
    errors.


M	src/lib-index/mail-index-sync-update.c

2013-08-04 20:33:05 +0300 Timo Sirainen <tss@iki.fi> (069def4)

    lib-http: Fixed redirect request target encoding and NULL target. Patch by
    Stephan Bosch.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-url.c
M	src/lib-http/http-url.h

2013-08-04 18:34:43 +0300 Timo Sirainen <tss@iki.fi> (fd1317a)

    imap: Various APPEND/CATENATE error handling bugfixes. Found using Apple's
    catenate.pl test script.


M	src/imap/cmd-append.c

2013-08-04 14:03:54 +0300 Timo Sirainen <tss@iki.fi> (9a449fb)

    lib-http: Ignore trailing whitespace in headers. Patch by Stephan Bosch.


M	src/lib-http/http-header-parser.c
M	src/lib-http/test-http-header-parser.c

2013-08-04 12:16:09 +0300 Timo Sirainen <tss@iki.fi> (cddbedd)

    lib-http: Don't crash when receiving 304 or a redirect without Location:
    header. Patch by Stephan Bosch


M	src/lib-http/http-client-connection.c

2013-08-03 21:33:25 +0300 Timo Sirainen <tss@iki.fi> (690ed6a)

    man: Fixed doveadm-deduplicate.1 Patch by Pascal Volk


M	doc/man/doveadm-deduplicate.1.in

2013-08-03 15:26:58 +0300 Timo Sirainen <tss@iki.fi> (2f45711)

    Makefile: Fixed previous commit.


M	doc/man/Makefile.am

2013-08-02 19:03:32 +0000 Pascal Volk <user@localhost.localdomain.org> (0610b6d)

    man: Added doveadm-deduplicate.1 and doveadm-flags.1.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-deduplicate.1.in
A	doc/man/doveadm-flags.1.in
M	doc/man/doveadm.1.in

2013-08-02 16:20:08 +0300 Timo Sirainen <tss@iki.fi> (209335f)

    doveadm flags: Fixed help text for subcommands.


M	src/doveadm/doveadm-mail-flags.c

2013-08-02 15:19:22 +0300 Timo Sirainen <tss@iki.fi> (d28a4f3)

    quota-status: Added quota_status_toolarge message for mails larger than
    user's quota limit. Based on patch by Ulrich Zehl


M	src/plugins/quota/quota-status.c

2013-08-02 15:14:39 +0300 Timo Sirainen <tss@iki.fi> (cf0184b)

    quota-status: Removed extra newlines from default quota_status_overquota
    message. Patch by Ulrich Zehl


M	src/plugins/quota/quota-status.c

2013-08-01 15:35:35 +0300 Timo Sirainen <tss@iki.fi> (af4cf95)

    ssl: Log SSL "close notify" alerts as debug messages, not warnings. They are
    clean shutdown messages after all.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/login-common/ssl-proxy-openssl.c

2013-08-01 15:00:59 +0300 Timo Sirainen <tss@iki.fi> (9a30df5)

    quota: Don't log errors about missing namespaces for autocreated shared
    mail_users.


M	src/plugins/quota/quota-storage.c

2013-08-01 14:23:33 +0300 Timo Sirainen <tss@iki.fi> (20dca96)

    lib-storage: Improved seteuid() error messages a bit.


M	src/lib-storage/mail-storage-service.c

2013-08-01 14:18:24 +0300 Timo Sirainen <tss@iki.fi> (49fd8c9)

    lib-storage: If settings can't be read because of permission denied, restart
    process.


M	src/lib-storage/mail-storage-service.c

2013-08-01 14:18:00 +0300 Timo Sirainen <tss@iki.fi> (cfa178a)

    lib-master: Added master_service_settings_output.permission_denied error
    flag.


M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h

2013-08-01 13:51:57 +0300 Timo Sirainen <tss@iki.fi> (1f73636)

    lib-master: If config socket closes, retry connecting to it automatically.


M	src/lib-master/master-service-settings.c

2013-08-01 13:42:51 +0300 Timo Sirainen <tss@iki.fi> (b7b9d4b)

    lib-master: If MASTER_SERVICE_FLAG_KEEP_CONFIG_OPEN is set, open the config
    socket before dropping privileges.


M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2013-08-01 13:31:25 +0300 Timo Sirainen <tss@iki.fi> (1cb0655)

    lib-storage: Ignore MAIL_STORAGE_SERVICE_FLAG_TEMP_PRIV_DROP if service user
    isn't root.


M	src/lib-storage/mail-storage-service.c

2013-07-30 13:26:40 +0300 Timo Sirainen <tss@iki.fi> (c5acac1)

    quota-status: Keep the config connection open.


M	src/plugins/quota/quota-status.c

2013-07-30 13:26:07 +0300 Timo Sirainen <tss@iki.fi> (984e5c9)

    lib-storage: With temporary privilege dropping, switch to root before doing
    config lookup. This fixes the problem of not having enough permissions to
    connect to the config socket.


M	src/lib-storage/mail-storage-service.c

2013-07-30 13:09:52 +0300 Timo Sirainen <tss@iki.fi> (28abd7c)

    lib-auth: Don't crash in auth_master_user_list_*() if socket can't be
    connected to.


M	src/lib-auth/auth-master.c

2013-07-29 23:22:46 +0300 Timo Sirainen <tss@iki.fi> (468c28d)

    director: Avoid infinite SYNC loops if the originating director goes away
    for a long time.


M	src/director/director-connection.c
M	src/director/director-host.h
M	src/director/director.c
M	src/director/director.h

2013-07-29 22:49:17 +0300 Timo Sirainen <tss@iki.fi> (8621be3)

    director: Update existing users' timestamps during handshake.


M	src/director/director-connection.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2013-07-29 22:19:03 +0300 Timo Sirainen <tss@iki.fi> (c9b3bbf)

    director: Fixes to director-test.


M	src/director/director-test.c
M	src/director/director-test.sh

2013-07-29 22:11:46 +0300 Timo Sirainen <tss@iki.fi> (c6a5305)

    director: Fixes to handling users near expiration.


M	src/director/director-connection.c

2013-07-29 22:10:01 +0300 Timo Sirainen <tss@iki.fi> (06fc824)

    director: Log director disconnection errno correctly.


M	src/director/director-connection.c

2013-07-29 22:08:26 +0300 Timo Sirainen <tss@iki.fi> (2dcf09e)

    director: Expire users a bit more correctly. Also make sure that the "user
    near expiring" interval is at least 3 seconds in case director_user_expire
    is very low.


M	src/director/user-directory.c

2013-07-29 22:06:13 +0300 Timo Sirainen <tss@iki.fi> (935960e)

    director: Don't allow director_user_expire to be less than 10 seconds.


M	src/director/director-settings.c

2013-07-17 10:23:21 +0300 Timo Sirainen <tss@iki.fi> (88df77e)

    liblib: connection_disconnect() didn't close fd_out if it was different from
    fd_in.


M	src/lib/connection.c

2013-07-12 03:06:26 +0300 Timo Sirainen <tss@iki.fi> (df6c729)

    director: Don't log an error if login connection gets closed with
    ECONNRESET.


M	src/director/login-connection.c

2013-07-12 03:01:31 +0300 Timo Sirainen <tss@iki.fi> (c87221e)

    auth: With multiple passdbs the previous passdb's userdb_* fields weren't
    cleared.


M	src/auth/auth-request.c
M	src/auth/auth-request.h

2013-07-12 02:43:43 +0300 Timo Sirainen <tss@iki.fi> (a138ac1)

    auth: If blocking passdb returned only NULLs for userdb_ fields, use userdb
    prefetch anyway.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-worker-client.c

2013-07-12 02:29:00 +0300 Timo Sirainen <tss@iki.fi> (1ce47e4)

    auth: Use fewer syscalls for sending user list.


M	src/auth/auth-master-connection.c
M	src/auth/auth-worker-client.c

2013-07-12 02:26:44 +0300 Timo Sirainen <tss@iki.fi> (0f4fb03)

    lib-auth: auth_master_user_list_*() no longer reads the entire user list
    into memory.


M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h

2013-07-12 02:17:31 +0300 Timo Sirainen <tss@iki.fi> (4dc81fe)

    lib-storage: mail_storage_service_all_init() no longer returns total number
    of users. In preperation for removing the count functionality, since it
    requires reading all the users into memory for it to work.

    This also required removing the /total from verbosity counter with doveadm
    -A.

M	src/doveadm/doveadm-mail.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2013-07-12 01:57:45 +0300 Timo Sirainen <tss@iki.fi> (3340fc9)

    auth: Avoid wasting data stack when iterating users.


M	src/auth/auth-worker-client.c

2013-07-12 01:39:47 +0300 Timo Sirainen <tss@iki.fi> (be240f6)

    man: Updated doveadm-director man page.


M	doc/man/doveadm-director.1.in

2013-07-12 01:36:41 +0300 Timo Sirainen <tss@iki.fi> (e3ffd73)

    lib-ssl-iostream: Crashfix for recent change.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2013-07-11 14:29:05 +0300 Timo Sirainen <tss@iki.fi> (7e59e4f)

    lib-http: Added a very dummy test-http-server


M	src/lib-http/Makefile.am
A	src/lib-http/test-http-server.c

2013-07-11 14:18:42 +0300 Timo Sirainen <tss@iki.fi> (b72c336)

    lib-http: Implemented http-request-parser for HTTP servers. Moved code
    common with it and http-response-parser to http-message-parser.


M	src/lib-http/Makefile.am
A	src/lib-http/http-message-parser.c
A	src/lib-http/http-message-parser.h
A	src/lib-http/http-request-parser.c
A	src/lib-http/http-request-parser.h
M	src/lib-http/http-response-parser.c

2013-07-11 12:54:02 +0300 Timo Sirainen <tss@iki.fi> (1920ef8)

    lib-http: Moved struct http_response* to http-response.h Also http-client.h
    now #includes only http-response.h


M	src/lib-http/Makefile.am
M	src/lib-http/http-client.h
M	src/lib-http/http-response-parser.h
A	src/lib-http/http-response.h

2013-07-11 10:25:32 +0300 Timo Sirainen <tss@iki.fi> (bfb3d8c)

    lib-http: Minor change to make sure http_response_header.size is always
    correct. The current http-header-parser already guaranteed that it is, but
    this change just adds extra guarantees that it won't break in future.
    Besides, this change improves the performance slightly by avoiding strlen().


M	src/lib-http/http-response-parser.c

2013-07-11 10:19:43 +0300 Timo Sirainen <tss@iki.fi> (db37e13)

    lib-http: Minor fix/cleanup to detecting stream errors when skipping
    payload.


M	src/lib-http/http-response-parser.c

2013-07-11 10:17:49 +0300 Timo Sirainen <tss@iki.fi> (2934956)

    lib-http: Updated test-http-response-parser


M	src/lib-http/test-http-response-parser.c

2013-07-11 09:33:13 +0300 Timo Sirainen <tss@iki.fi> (d1f1ad0)

    lib-http: test-http-header-parser makes sure the parser works one byte at a
    time.


M	src/lib-http/test-http-header-parser.c

2013-07-11 09:29:36 +0300 Timo Sirainen <tss@iki.fi> (7d21477)

    lib-http: Fixed previous test-http-response-parser change.


M	src/lib-http/test-http-response-parser.c

2013-07-11 09:25:53 +0300 Timo Sirainen <tss@iki.fi> (e904d47)

    lib-http: Fixed handling responses whose header arrives in smaller pieces.


M	src/lib-http/http-response-parser.c
M	src/lib-http/test-http-response-parser.c

2013-07-11 09:23:14 +0300 Timo Sirainen <tss@iki.fi> (1bc12a5)

    lib-http: Simplify http response status-line parsing code. Also by not using
    a temporary string buffer the istream can at least in theory limit the
    maximum status-line length (=max memory usage).


M	src/lib-http/http-response-parser.c

2013-07-11 00:30:28 +0300 Timo Sirainen <tss@iki.fi> (0ffbb28)

    lib-http: Http requests weren't freed when connection was aborted. Patch by
    Stephan Bosch.


M	src/lib-http/http-client-connection.c

2013-07-11 00:28:54 +0300 Timo Sirainen <tss@iki.fi> (d53c849)

    lib-ssl-iostream: Compiler warning fix


M	src/lib-ssl-iostream/iostream-openssl-context.c

2013-07-10 10:01:26 +0300 Timo Sirainen <tss@iki.fi> (cc293ff)

    lib-ssl-iostreams: ssl_protocols setting supports now TLSv1.1 and TLSv1.2
    values.


M	src/lib-ssl-iostream/iostream-openssl-common.c

2013-07-10 09:43:19 +0300 Timo Sirainen <tss@iki.fi> (002442c)

    auth: Fixed crash for some lookups that didn't specify service name.


M	src/auth/auth.c

2013-07-10 09:37:06 +0300 Timo Sirainen <tss@iki.fi> (52ec61a)

    Maildir++ quota: When recreating, don't use maildirsize.lock file. The point
    was never to even try to lock it, it just used to be an easier API to create
    the file. Nowadays safe_mkstemp_hostpid_group() works just as easily. This
    normally doesn't matter, but apparently Exim+CPanel leaves maildirsize.lock
    files lying around, causing Dovecot to not update maildirsize.


M	src/plugins/quota/quota-maildir.c

2013-07-10 08:58:36 +0300 Timo Sirainen <tss@iki.fi> (231a59c)

    lib-ssl-iostream: Added support for ECDH/ECDHE cipher suites Based on the
    login-common patch by David Hicks.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2013-07-10 08:47:49 +0300 Timo Sirainen <tss@iki.fi> (1a193d2)

    login-common: Compiler warning fix with OpenSSL v1.0.2+


M	src/login-common/ssl-proxy-openssl.c

2013-07-10 08:42:09 +0300 Timo Sirainen <tss@iki.fi> (524d89a)

    lib-http: Minor comment update.


M	src/lib-http/http-client-private.h

2013-07-06 14:46:16 +1000 David Hicks <david@hicks.id.au> (8137a5d)

    login-common: Add support for ECDH/ECDHE cipher suites

    ECDH temporary key parameter selection must be performed during OpenSSL 
    context initialisation before ECDH and ECDHE cipher suites can be used.

    OpenSSL >= 1.0.2 automatically handles ECDH temporary key parameter
    selection. For OpenSSL < 1.0.2 we must manually specify a named elliptic
    curve that Dovecot will use to generate an ephemeral key pair. By default we
    try to use the same named curve as that used in the server's private EC key
    file. If this attempt fails, a fall back curve of NIST P-384 (secp384r1) is
    used instead.

    RFC 6460 states that NIST P-384 MUST be used for cipher suites that include 
    AES-256. For cipher suites that include AES-128, RFC 6460 states that NIST 
    P-256 MUST be used. No matter which curve is used as a fall back option, 
    Dovecot will be non-compliant. The reason for selecting NIST P-384 as a fall 
    back curve is to ensure that the non-compliance is in the form of providing 
    too great a level of security for AES-128 cipher suites rather than too
    little security for AES-256 cipher suites.

M	src/login-common/ssl-proxy-openssl.c

2013-07-10 06:54:57 +0300 Timo Sirainen <tss@iki.fi> (8e1dbcb)

    imapc: Reorganize code so that imapc_list works without imapc_storage. Most
    importantly fixes crashes when imapc_list is trying to lookup hierarchy
    separator before storage is created.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2013-07-10 06:05:20 +0300 Timo Sirainen <tss@iki.fi> (9bc2993)

    imapc: Code cleanup: Don't access imapc settings via storage.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h

2013-07-10 05:57:36 +0300 Timo Sirainen <tss@iki.fi> (4ee385f)

    imapc: Minor code cleanup.


M	src/lib-storage/index/imapc/imapc-storage.c

2013-07-10 05:37:01 +0300 Timo Sirainen <tss@iki.fi> (190ba2e)

    auth: If passdb ldap returned no values for userdb_ fields, use userdb
    prefetch anyway.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2013-07-10 05:29:45 +0300 Timo Sirainen <tss@iki.fi> (b4f35fa)

    auth: If passdb sql returned only NULLs for userdb_ fields, use userdb
    prefetch anyway.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/passdb-sql.c

2013-07-10 05:19:22 +0300 Timo Sirainen <tss@iki.fi> (b8394a3)

    pop3: Avoid assert-crash if client disconnects during LIST.


M	src/pop3/pop3-commands.c

2013-07-10 03:27:52 +0300 Timo Sirainen <tss@iki.fi> (b3289b6)

    lib-http: Fix/cleanup to handling connect failures. There was some kind of
    double-error handling which messed up things.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-07-10 02:50:04 +0300 Timo Sirainen <tss@iki.fi> (e0bbc29)

    lib-http: Fixed tracking number of pending connections to host-port.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-07-10 02:31:05 +0300 Timo Sirainen <tss@iki.fi> (6d2a126)

    lib-http: Don't assert-crash in case of somewhat unexpected failing
    connections.


M	src/lib-http/http-client-host.c

2013-07-10 01:44:40 +0300 Timo Sirainen <tss@iki.fi> (1a64096)

    lib-http: Always try to connect to host's all IPs when connections fail.
    Previously this was done only when the new connections started from the
    first IP.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h

2013-06-28 19:48:37 +0300 Timo Sirainen <tss@iki.fi> (d29c3ac)

    dns, lib-dns: Added support for async DNS PTR lookups.


M	src/dns/dns-client.c
M	src/lib-dns/dns-lookup.c
M	src/lib-dns/dns-lookup.h

2013-06-28 19:48:15 +0300 Timo Sirainen <tss@iki.fi> (684b658)

    Added net_gethostbyaddr() for DNS PTR lookups. This code assumes we have
    IPv6 capability. Perhaps we should just require it everywhere already..


M	src/lib/net.c
M	src/lib/net.h

2013-06-27 23:07:20 +0300 Timo Sirainen <tss@iki.fi> (edbfc21)

    lib-http: Added more debug messages.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c

2013-06-27 22:49:50 +0300 Timo Sirainen <tss@iki.fi> (798915d)

    lib-http: When successfully connected to a peer, don't drop the peer's
    pending connections. They could have been intentionally created for other
    urgent requests.


M	src/lib-http/http-client-host.c

2013-06-27 20:37:46 +0300 Timo Sirainen <tss@iki.fi> (270f75e)

    lib-http: Don't crash if payload stream is referenced by caller after its
    connection is freed.


M	src/lib-http/http-client-connection.c

2013-06-27 20:32:01 +0300 Timo Sirainen <tss@iki.fi> (06b1ec1)

    lib-http: Remove request timeout from being used during payload read. The
    reading is done by the lib-http caller, which should have its own timeouts.


M	src/lib-http/http-client-connection.c

2013-06-27 20:28:51 +0300 Timo Sirainen <tss@iki.fi> (fe681e6)

    lib-http: Call request's destroy callback always, not just on success.


M	src/lib-http/http-client-request.c

2013-06-27 20:27:57 +0300 Timo Sirainen <tss@iki.fi> (fd0ec0a)

    lib-http: If connection times out, set the stream's errno to ETIMEDOUT in
    case it's used.


M	src/lib-http/http-client-connection.c

2013-06-27 20:26:50 +0300 Timo Sirainen <tss@iki.fi> (8615a72)

    lib-http: When connection is freed, abort also the pending request.


M	src/lib-http/http-client-connection.c

2013-06-27 20:26:13 +0300 Timo Sirainen <tss@iki.fi> (92908d7)

    lib-http: Timeouts were being handled wrong/leaked by ioloop switching.


M	src/lib-http/http-client-connection.c

2013-06-27 20:24:45 +0300 Timo Sirainen <tss@iki.fi> (6a33d63)

    lib-http: Minor code cleanup.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-06-27 18:04:04 +0300 Timo Sirainen <tss@iki.fi> (659e3b4)

    lib-http: Fixed hang when many connections were being created and closed.


M	src/lib-http/http-client-peer.c

2013-06-27 18:03:38 +0300 Timo Sirainen <tss@iki.fi> (17cd0e0)

    lib-http: Added http_client_get_pending_request_count()


M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-06-26 22:23:20 +0300 Timo Sirainen <tss@iki.fi> (fc5b80d)

    dsync: Recent changes broke remote dsync


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-06-26 21:35:37 +0300 Timo Sirainen <tss@iki.fi> (bc4cb06)

    config: Give a somewhat better warning for when using protocols=imaps or
    pop3s.


M	src/config/old-set-parser.c

2013-06-26 20:53:01 +0300 Timo Sirainen <tss@iki.fi> (36723cf)

    dsync: Added -1 parameter to do a "one way sync" without reverting changes.
    This can be useful during migration when you don't want to delete any mails,
    but you also don't want to send changes to the old server either.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c

2013-06-26 20:03:26 +0300 Timo Sirainen <tss@iki.fi> (f6da39b)

    dsync: Send DSYNC_BRAIN_FLAG_NO_MAIL_SYNC via ibc-stream to slave brain.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-06-26 19:47:40 +0300 Timo Sirainen <tss@iki.fi> (1ee74d7)

    pop3c: Fixed mail saving to fail nicely, not assert-crash.


M	src/lib-storage/index/pop3c/pop3c-storage.c

2013-06-26 19:33:38 +0300 Timo Sirainen <tss@iki.fi> (34b8b14)

    dsync: Fixed syncing when one of the backends supported GUIDs.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-06-26 15:44:08 +0300 Timo Sirainen <tss@iki.fi> (2e708f3)

    pop3c: Return error instead of crashing when trying to save a mail.


M	src/lib-storage/index/pop3c/pop3c-storage.c

2013-06-26 15:29:43 +0300 Timo Sirainen <tss@iki.fi> (173fc9e)

    dsync: Fixed handling expunges when GUIDs aren't supported by the
    backend(s).


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-06-26 14:37:34 +0300 Timo Sirainen <tss@iki.fi> (de754cb)

    lib-sasl: Use dsasl_ prefix so we don't conflict with Cyrus SASL library.


M	src/imap-login/imap-proxy.c
M	src/lib-sasl/Makefile.am
A	src/lib-sasl/dsasl-client-private.h
A	src/lib-sasl/dsasl-client.c
A	src/lib-sasl/dsasl-client.h
M	src/lib-sasl/mech-login.c
M	src/lib-sasl/mech-plain.c
D	src/lib-sasl/sasl-client-private.h
D	src/lib-sasl/sasl-client.c
D	src/lib-sasl/sasl-client.h
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/main.c
M	src/pop3-login/pop3-proxy.c

2013-06-25 16:03:04 +0300 Timo Sirainen <tss@iki.fi> (0d439f2)

    dsync: Don't log index errors if modseq points beyond the current view.


M	src/doveadm/dsync/dsync-transaction-log-scan.c

2013-06-25 15:48:24 +0300 Timo Sirainen <tss@iki.fi> (fa8d22c)

    mdbox: Resize mdbox index header if necessary also when rebuilding indexes.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2013-06-25 15:47:48 +0300 Timo Sirainen <tss@iki.fi> (3b8a191)

    lib-index: Assert-crash instead of writing a broken transaction with too
    large ext header update.


M	src/lib-index/mail-index-transaction-export.c

2013-06-25 15:46:50 +0300 Timo Sirainen <tss@iki.fi> (c3cb859)

    lib-index: Don't write a broken transaction if extension resize is done at
    first use.


M	src/lib-index/mail-index-transaction-export.c

2013-06-25 02:23:02 +0300 Timo Sirainen <tss@iki.fi> (579bd26)

    Added signature for changeset 4b3c9c3e4fb8


M	.hgsigs

2013-06-25 02:22:59 +0300 Timo Sirainen <tss@iki.fi> (940095f)

    Added tag 2.2.4 for changeset 4b3c9c3e4fb8


M	.hgtags

2013-06-25 02:22:58 +0300 Timo Sirainen <tss@iki.fi> (483b379)

    Released v2.2.4.


M	NEWS
M	configure.ac

2013-06-25 01:24:51 +0300 Timo Sirainen <tss@iki.fi> (3605fb8)

    Make static analyzer happier.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c

2013-06-25 01:23:17 +0300 Timo Sirainen <tss@iki.fi> (fad1d96)

    doveadm deduplicate: Fixed error handling.


M	src/doveadm/doveadm-mail-deduplicate.c

2013-06-25 00:10:39 +0300 Timo Sirainen <tss@iki.fi> (bc278f2)

    quota: Fixed quota_rule with non-uppercase INBOX.


M	src/plugins/quota/quota.c

2013-06-24 23:33:59 +0300 Timo Sirainen <tss@iki.fi> (5324117)

    imap-login: If CAPABILITY is already in server banner, don't ask for it
    again.


M	src/imap-login/imap-proxy.c

2013-06-24 23:14:35 +0300 Timo Sirainen <tss@iki.fi> (723f7be)

    dsync: Fixed "export:/count" value in verbose_proctitle=yes


M	src/doveadm/dsync/dsync-mailbox-export.c

2013-06-24 23:10:20 +0300 Timo Sirainen <tss@iki.fi> (4780c03)

    mbox: Avoid assert-crashing by too optimistically upgrading a lock to
    write-lock.


M	src/lib-storage/index/mbox/mbox-lock.c

2013-06-24 23:06:45 +0300 Timo Sirainen <tss@iki.fi> (08bbf28)

    dsync: Don't crash at deinit when dsync fails early.


M	src/doveadm/dsync/dsync-brain.c

2013-06-24 22:25:47 +0300 Timo Sirainen <tss@iki.fi> (3c73d88)

    dsync: Don't try to find mailboxes from unwanted namespaces.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h

2013-06-24 16:37:48 +0300 Timo Sirainen <tss@iki.fi> (4725569)

    dsync: If verbose_proctitle=yes, show the current state in it.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2013-06-24 16:36:32 +0300 Timo Sirainen <tss@iki.fi> (e7ee145)

    dsync: State names were wrong in debug/error messages.


M	src/doveadm/dsync/dsync-brain.c

2013-06-18 18:56:15 +0300 Timo Sirainen <tss@iki.fi> (4809537)

    lib-storage: Fixed crash with some autocreated (e.g. shared) namespaces.


M	src/lib-storage/mailbox-list.c

2013-06-18 18:54:20 +0300 Timo Sirainen <tss@iki.fi> (1127f3e)

    sdbox: If sdbox header is corrupted, resize it to make sure its size is
    correct.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2013-06-18 17:05:20 +0300 Timo Sirainen <tss@iki.fi> (138495d)

    doveadm: Added deduplicate command. By default it deduplicates only by
    GUIDs. With -m parameter it deduplicates by Message-Id: header.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-mail-deduplicate.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2013-06-18 15:14:42 +0300 Timo Sirainen <tss@iki.fi> (6eb7938)

    doveadm: Added "flags" command to modify messages' flags.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-mail-flags.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2013-06-18 13:00:23 +0300 Timo Sirainen <tss@iki.fi> (a81f34a)

    mdbox: If mdbox header is corrupted, resize it to make sure its size is
    correct.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2013-06-18 12:59:17 +0300 Timo Sirainen <tss@iki.fi> (0b2d462)

    lib-index: Don't bother tracking if header/records were changed. They aren't
    really needed. When mail_index_write() is called, we already know we want to
    update the index.


M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-write.c

2013-06-18 12:56:27 +0300 Timo Sirainen <tss@iki.fi> (8c6cb4d)

    lib-index: If error is found from transaction log, update dovecot.index so
    it won't be read again.


M	src/lib-index/mail-index-sync.c

2013-06-18 12:15:50 +0300 Timo Sirainen <tss@iki.fi> (d581fad)

    lib-sasl: API usage comment update


M	src/lib-sasl/sasl-client.h

2013-06-18 11:59:21 +0300 Timo Sirainen <tss@iki.fi> (26681e7)

    imap/pop3 proxy: Master user logins were broken by lib-sasl change.


M	src/imap-login/imap-proxy.c
M	src/pop3-login/pop3-proxy.c

2013-06-17 16:37:46 +0300 Timo Sirainen <tss@iki.fi> (4e4c916)

    pop3: Fixed crash at deinit


M	src/pop3/pop3-client.c

2013-06-17 14:39:59 +0300 Timo Sirainen <tss@iki.fi> (4dccd20)

    dsync: Minor fixes to checking if namespace is wanted to be synced.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c

2013-06-17 00:03:16 +0300 Timo Sirainen <tss@iki.fi> (d229d26)

    Make static analyzer happier.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c
M	src/imap-login/imap-proxy.c
M	src/pop3-login/pop3-proxy.c

2013-06-17 00:31:22 +0300 Timo Sirainen <tss@iki.fi> (e6eefac)

    Added signature for changeset 5d9f52c9a287


M	.hgsigs

2013-06-17 00:31:18 +0300 Timo Sirainen <tss@iki.fi> (8bdb49c)

    Added tag 2.2.3 for changeset 5d9f52c9a287


M	.hgtags

2013-06-17 00:31:18 +0300 Timo Sirainen <tss@iki.fi> (dc4d207)

    Released v2.2.3.


M	NEWS
M	TODO
M	configure.ac

2013-06-16 23:56:28 +0300 Timo Sirainen <tss@iki.fi> (737ddab)

    mdbox: Minor fix to handling corrupted mdbox header.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2013-06-16 21:25:39 +0300 Timo Sirainen <tss@iki.fi> (917f556)

    fts-lucene: Fixed building without libstemmer


M	src/plugins/fts-lucene/lucene-wrapper.cc

2013-06-16 21:15:42 +0300 Timo Sirainen <tss@iki.fi> (6b94ad2)

    lib-imap: Fixed parsing literal8 in some situations.


M	src/lib-imap/imap-parser.c

2013-06-16 21:08:40 +0300 Timo Sirainen <tss@iki.fi> (a373635)

    istream-attachment-extractor: Fixed handling attachment as the message body
    without MIME. Don't crash at the end after parsing the base64 data.


M	src/lib-mail/istream-attachment-extractor.c

2013-06-16 20:15:42 +0300 Timo Sirainen <tss@iki.fi> (b9dc21a)

    lib-storage: mail_storage_service_lookup() ignored input->service.


M	src/lib-storage/mail-storage-service.c

2013-06-14 02:14:09 +0300 Timo Sirainen <tss@iki.fi> (d39ea6e)

    Compiler warning fix.


M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2013-06-14 00:23:45 +0300 Timo Sirainen <tss@iki.fi> (28542ff)

    dsync: Fixed syncing renaming mailboxes with children. So that the
    childrens' rename timestamps are at least as high as their parents'.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2013-06-14 00:16:58 +0300 Timo Sirainen <tss@iki.fi> (b67692d)

    dsync: Don't try to delete nonexistent mailbox directories.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2013-06-14 00:16:14 +0300 Timo Sirainen <tss@iki.fi> (c32a2a9)

    dsync: Avoid wasting data stack on larger renames.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2013-06-13 23:31:00 +0300 Timo Sirainen <tss@iki.fi> (c8fff8f)

    quota-status: Fixed log prefix.


M	src/plugins/quota/quota-status.c

2013-06-13 23:22:20 +0300 Timo Sirainen <tss@iki.fi> (b966acd)

    lib-storage: Fixed crash with listing shared mailboxes.


M	src/lib-storage/index/shared/shared-list.c

2013-06-13 18:54:07 +0300 Timo Sirainen <tss@iki.fi> (0cb7298)

    fts-solr: Do only soft commits. Use a cronjob to do hard commits.


M	src/plugins/fts-solr/fts-backend-solr.c

2013-06-13 18:53:22 +0300 Timo Sirainen <tss@iki.fi> (2127988)

    solr-schema.xml: More updates for Solr v4.x and hopefully with better
    filters.


M	doc/solr-schema.xml

2013-06-13 17:55:24 +0300 Timo Sirainen <tss@iki.fi> (3ea055b)

    solr-schema.xml: Replaced EnglishPorterFilterFactory with
    SnowballPorterFilterFactory


M	doc/solr-schema.xml

2013-06-13 06:07:54 +0300 Timo Sirainen <tss@iki.fi> (d6b3cfd)

    Call master_service_init_finish() only after all of the initialization is
    done. This way if the init crashes, the master process will throttle a buggy
    service.


M	src/anvil/main.c
M	src/auth/main.c
M	src/dict/main.c
M	src/director/director-test.c
M	src/director/main.c
M	src/doveadm/main.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap/main.c
M	src/indexer/indexer-worker.c
M	src/indexer/indexer.c
M	src/ipc/main.c
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/lmtp/main.c
M	src/log/main.c
M	src/plugins/quota/quota-status.c
M	src/pop3/main.c
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c
M	src/stats/main.c
M	src/util/script.c

2013-06-13 05:29:07 +0300 Timo Sirainen <tss@iki.fi> (1729508)

    imapc: Fixed list iteration when namespace and backend separators differed.


M	src/lib-storage/index/imapc/imapc-list.c

2013-06-13 05:27:30 +0300 Timo Sirainen <tss@iki.fi> (cf05592)

    mailbox_list_index=yes: Fixed list iteration when namespace and backend
    separators differed.


M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index.h

2013-06-13 04:35:06 +0300 Timo Sirainen <tss@iki.fi> (8ad7aa4)

    doveadm: Pass through the exit code from doveadm-server to client.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/server-connection.c
M	src/doveadm/server-connection.h

2013-06-13 04:33:41 +0300 Timo Sirainen <tss@iki.fi> (a0ebe2a)

    dsync: Don't try to access mailboxes with no_mail_sync flag enabled.


M	src/doveadm/dsync/dsync-brain-mailbox.c

2013-06-13 03:26:22 +0300 Timo Sirainen <tss@iki.fi> (237a621)

    Memory leak fixes.


M	src/doveadm/client-connection.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/main.c
M	src/lib-fs/fs-api.c

2013-06-12 23:01:26 +0300 Timo Sirainen <tss@iki.fi> (70b67fc)

    zlib: Enable only for storages that support
    MAIL_STORAGE_CLASS_FLAG_BINARY_DATA


M	src/plugins/zlib/zlib-plugin.c

2013-06-12 22:58:42 +0300 Timo Sirainen <tss@iki.fi> (d46a1e3)

    lib-storage: Added MAIL_STORAGE_CLASS_FLAG_BINARY_DATA flag for classes.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h

2013-06-12 22:45:43 +0300 Timo Sirainen <tss@iki.fi> (1c3dc4c)

    pop3-migration: struct mailbox must be freed before mail_storage is
    destroyed. Fixes a memory leak where the user wasn't destroyed at all
    because the mailbox still caused the user to be referenced.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2013-06-12 22:03:07 +0300 Timo Sirainen <tss@iki.fi> (29dcd13)

    lib-dict: Error handling fixes to asynchronous transactions.


M	src/lib-dict/dict-client.c

2013-06-12 21:41:09 +0300 Timo Sirainen <tss@iki.fi> (8f948b8)

    Moved "INBOX can't be deleted" check from lib-storage to IMAP-specific code.
    Especially "doveadm backup" should be able to delete the INBOX if needed.


M	src/imap/cmd-delete.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2013-06-12 21:25:09 +0300 Timo Sirainen <tss@iki.fi> (3568ea0)

    lib-storage: Don't crash if backend doesn't have subscriptions file.


M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-subscriptions.c

2013-06-12 21:16:06 +0300 Timo Sirainen <tss@iki.fi> (39a97e8)

    pop3c: Don't assert-crash if we can't do DNS lookup.


M	src/lib-storage/index/pop3c/pop3c-client.c

2013-06-12 16:43:41 +0300 Timo Sirainen <tss@iki.fi> (d2cf652)

    pop3c: Return Date: header's date also as received and saved date. Mainly to
    get dsync to not fail.


M	src/lib-storage/index/pop3c/pop3c-mail.c

2013-06-12 16:29:17 +0300 Timo Sirainen <tss@iki.fi> (5d4a0da)

    pop3c: Allow mailbox_update() for Dovecot's internal fields.


M	src/lib-storage/index/pop3c/pop3c-storage.c

2013-06-12 16:27:47 +0300 Timo Sirainen <tss@iki.fi> (82af96b)

    pop3c: Don't assert-crash when trying to list subscriptions.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2013-06-12 16:20:19 +0300 Timo Sirainen <tss@iki.fi> (cf35bb0)

    pop3c: Give GUID to the INBOX to avoid crashes with dsync.


M	src/lib-storage/index/pop3c/pop3c-storage.c

2013-06-12 04:44:11 +0300 Timo Sirainen <tss@iki.fi> (fa2ac46)

    zlib plugin: Removed explicit checks for maildir/sdbox/mdbox.


M	src/plugins/zlib/zlib-plugin.c

2013-06-09 21:06:49 +0300 Timo Sirainen <tss@iki.fi> (4d0230c)

    man: Recent change accidentally changed LGPLv2.1 -> LGPLv2.2, reverted.


M	doc/man/dovecot.1.in

2013-06-09 14:56:36 +0300 Timo Sirainen <tss@iki.fi> (5a6cbb6)

    acl: Crashfix


M	src/plugins/acl/acl-backend-vfile.c

2013-06-09 14:53:31 +0300 Timo Sirainen <tss@iki.fi> (fedb7a1)

    lib-storage: Fixed crashes caused by recent "multiple storages per
    namespace" change.


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-namespace.c

2013-06-09 06:03:34 +0300 Timo Sirainen <tss@iki.fi> (1093de3)

    imap/pop3-login: Use libsasl for authenticating to remote IMAP/POP3 server.
    Also passdb lookup can return "proxy_mech" extra field to specify which SASL
    mechanism to use.


M	src/imap-login/Makefile.am
M	src/imap-login/client.h
M	src/imap-login/imap-proxy.c
M	src/login-common/Makefile.am
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/main.c
M	src/pop3-login/Makefile.am
M	src/pop3-login/pop3-proxy.c

2013-06-09 06:02:14 +0300 Timo Sirainen <tss@iki.fi> (78919bf)

    Added initial libsasl for implementing client side SASL library. Initially
    supports PLAIN and LOGIN mechanisms.


M	configure.ac
M	src/Makefile.am
M	src/lib-dovecot/Makefile.am
A	src/lib-sasl/Makefile.am
A	src/lib-sasl/mech-login.c
A	src/lib-sasl/mech-plain.c
A	src/lib-sasl/sasl-client-private.h
A	src/lib-sasl/sasl-client.c
A	src/lib-sasl/sasl-client.h

2013-06-09 03:10:43 +0300 Timo Sirainen <tss@iki.fi> (f26ef7a)

    fts-lucene: Support normalize setting also without snowball. Added
    no_snowball setting. Snowball seems to be converting / breaking words down
    rather annoyingly.


M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc

2013-06-09 02:49:48 +0300 Timo Sirainen <tss@iki.fi> (d674515)

    man pages: Updated v2.1 -> v2.2


M	doc/man/doveadm-altmove.1.in
M	doc/man/doveadm-auth.1.in
M	doc/man/doveadm-director.1.in
M	doc/man/doveadm-dump.1.in
M	doc/man/doveadm-expunge.1.in
M	doc/man/doveadm-fetch.1.in
M	doc/man/doveadm-force-resync.1.in
M	doc/man/doveadm-help.1.in
M	doc/man/doveadm-import.1.in
M	doc/man/doveadm-index.1.in
M	doc/man/doveadm-instance.1.in
M	doc/man/doveadm-kick.1.in
M	doc/man/doveadm-log.1.in
M	doc/man/doveadm-mailbox.1.in
M	doc/man/doveadm-mount.1.in
M	doc/man/doveadm-move.1.in
M	doc/man/doveadm-penalty.1.in
M	doc/man/doveadm-purge.1.in
M	doc/man/doveadm-pw.1.in
M	doc/man/doveadm-quota.1.in
M	doc/man/doveadm-search-query.7
M	doc/man/doveadm-search.1.in
M	doc/man/doveadm-user.1.in
M	doc/man/doveadm-who.1.in
M	doc/man/doveadm.1.in
M	doc/man/doveconf.1.in
M	doc/man/dovecot-lda.1.in
M	doc/man/dovecot.1.in
M	doc/man/dsync.1.in

2013-06-09 02:46:50 +0300 Timo Sirainen <tss@iki.fi> (70505f4)

    lib-http: Added soft_connect_timeout_msecs setting to connect to multiple
    IPs in parallel. Based on patch by Stephan Bosch.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-06-09 02:08:24 +0300 Timo Sirainen <tss@iki.fi> (6ce13ae)

    lib-http: If connect to peer failed, don't recreate a new connection to
    handle pending requests. The new connection would very likely fail as well.
    Another peer for the host should pick up the requests.


M	src/lib-http/http-client-peer.c

2013-06-09 00:48:14 +0300 Timo Sirainen <tss@iki.fi> (d2e74f2)

    lib-storage: Added mailbox { driver } setting to specify which storage to
    use.


M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mailbox-list.c

2013-06-09 00:46:06 +0300 Timo Sirainen <tss@iki.fi> (47ede56)

    lib-storage: Added support for multiple storages per namespace.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2013-06-09 00:42:36 +0300 Timo Sirainen <tss@iki.fi> (af466fd)

    imapc: imapc_storage no longer requires imapc_mailbox_list.


M	src/lib-storage/index/imapc/imapc-storage.c

2013-06-09 00:06:42 +0300 Timo Sirainen <tss@iki.fi> (ec49140)

    auth: If worker request has been queued for 60 secs, abort it.


M	src/auth/auth-worker-server.c

2013-06-07 22:06:24 +0300 Timo Sirainen <tss@iki.fi> (6604370)

    auth: Don't crash in non-plaintext auth if master user login is tried
    without master passdbs.


M	src/auth/auth-request.c

2013-06-07 20:12:15 +0300 Timo Sirainen <tss@iki.fi> (08195ad)

    imap-login: If PLAIN mechanism is disabled, advertise LOGINDISABLED always.


M	src/imap-login/client.c

2013-06-06 16:43:01 +0300 Timo Sirainen <tss@iki.fi> (5ef75c8)

    var_expand(): Fixed initializing variable to %N


M	src/lib/var-expand.c

2013-06-06 12:42:34 +0300 Timo Sirainen <tss@iki.fi> (2e01cfa)

    var_expand*(): Added small unit tests for %H and %N


M	src/lib/test-var-expand.c

2013-06-06 12:36:30 +0300 Timo Sirainen <tss@iki.fi> (9217571)

    var_expand*(): Fixed %N to work the same with little and big endian CPUs.
    Also use 64bit integer to do the MOD from, which should give somewhat better
    value distribution than with 32bit.


M	src/lib/var-expand.c

2013-06-06 12:24:27 +0300 Timo Sirainen <tss@iki.fi> (ffcdddd)

    lib-imap-client: When switching ioloops, do it also for the DNS lookup.


M	src/lib-imap-client/imapc-connection.c

2013-06-06 12:21:14 +0300 Timo Sirainen <tss@iki.fi> (c1a1abf)

    lib-imap-client: Make sure DNS lookups get aborted at disconnect.


M	src/lib-imap-client/imapc-connection.c

2013-06-06 12:20:54 +0300 Timo Sirainen <tss@iki.fi> (9dee78c)

    lib-imap-client: Don't start another DNS lookup if there's already one
    ongoing.


M	src/lib-imap-client/imapc-connection.c

2013-06-06 11:40:27 +0300 Timo Sirainen <tss@iki.fi> (949fa97)

    Avoid using mail_namespace.storage directly.


M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-shared-storage.c

2013-06-06 11:16:05 +0300 Timo Sirainen <tss@iki.fi> (8709b2f)

    lib-storage: Renamed mailbox_list_get_closest_storage() to
    ..._get_default_storage() This function wasn't previously used by anyone.


M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2013-06-06 10:55:27 +0300 Timo Sirainen <tss@iki.fi> (5c69525)

    imapc: Minor code cleanup


M	src/lib-storage/index/imapc/imapc-list.c

2013-06-06 10:52:14 +0300 Timo Sirainen <tss@iki.fi> (3ec969c)

    imapc: If imapc isn't the inbox=yes namespace, do the login and initial LIST
    in background.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2013-06-06 09:47:39 +0300 Timo Sirainen <tss@iki.fi> (cd467fe)

    lib-imap-client: When server sends BYE before disconnection, log it as the
    reason.


M	src/lib-imap-client/imapc-connection.c

2013-06-06 08:57:13 +0300 Timo Sirainen <tss@iki.fi> (d95ad2a)

    imapc: When deleting a mailbox, unselect the current one just in case
    they're the same.


M	src/lib-storage/index/imapc/imapc-list.c

2013-06-06 08:56:19 +0300 Timo Sirainen <tss@iki.fi> (719e8f8)

    lib-imap-client: Added support for UNSELECT capability.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h

2013-06-06 08:56:07 +0300 Timo Sirainen <tss@iki.fi> (1dde213)

    lib-imap-client: If SELECT/EXAMINE fails, set the connection as not being
    selected.


M	src/lib-imap-client/imapc-connection.c

2013-06-06 06:55:34 +0300 Timo Sirainen <tss@iki.fi> (d80391d)

    imapc: Index dirs were being wrongly deleted when imapc_list_prefix was set.


M	src/lib-storage/index/imapc/imapc-list.c

2013-06-06 06:32:58 +0300 Timo Sirainen <tss@iki.fi> (381a4bd)

    lib-http: Treat connect() timeouts as retryable errors.


M	src/lib-http/http-client-connection.c

2013-06-06 05:58:16 +0300 Timo Sirainen <tss@iki.fi> (1e9def6)

    lib-http: Fixed previous patch setting connection connected only after SSL
    handshake. This just caused crashes. The main point was anyway to include
    the SSL handshake as part of the connect_timeout_msecs. Apparently the
    easiest way is to set it immediately connected and delay removing the
    timeout.


M	src/lib-http/http-client-connection.c

2013-06-05 18:21:55 +0300 Timo Sirainen <tss@iki.fi> (ea4d4da)

    dsync: Set broken_char to a control char, so invalid mailbox names are
    handled properly. The dsync will now fail if there are invalid mailbox names
    (e.g. valid UTF8 when they should have been mUTF7), instead of simply
    printing "mailbox doesn't exist" error and exiting with 0.


M	src/doveadm/dsync/doveadm-dsync.c

2013-06-05 18:15:22 +0300 Timo Sirainen <tss@iki.fi> (1f4399a)

    lib-storage: mailbox_list_settings.broken_char wasn't escaping 8bit chars
    correctly.


M	src/lib-storage/mailbox-list.c

2013-06-05 17:49:46 +0300 Timo Sirainen <tss@iki.fi> (ba0ca24)

    lib-imap: Make sure imap_utf7_to_utf8() doesn't access invalid input string
    out of bounds.


M	src/lib-imap/imap-utf7.c

2013-06-05 17:48:48 +0300 Timo Sirainen <tss@iki.fi> (fba71f7)

    lib-imap: Added imap_utf7_is_valid()


M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-utf7.h
M	src/lib-imap/test-imap-utf7.c

2013-06-05 17:14:49 +0300 Timo Sirainen <tss@iki.fi> (f40c798)

    dsync: If unexpected changes happened during sync, log a warning and exit
    with code 2. This was done by v2.1 dsync, but the code got temporarily lost
    in v2.2.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h

2013-06-05 16:40:01 +0300 Timo Sirainen <tss@iki.fi> (515bb2b)

    lib-http: After peer has received 100 response, don't add ambiguity timeout
    anymore. The server should be sending the 100 responses then, and long
    delays shouldn't be confused with them being missing.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h

2013-06-05 16:28:16 +0300 Timo Sirainen <tss@iki.fi> (eca9a97)

    lib-http: When receiving 1xx response while waiting for 100, don't restart
    timeout. The 100 response is missing only from HTTP/1.0 requests, which also
    didn't allow any 1xx responses. So if a 1xx response is returned, a 100
    response is definitely also coming.


M	src/lib-http/http-client-connection.c

2013-06-05 16:19:38 +0300 Timo Sirainen <tss@iki.fi> (a8c4e79)

    lib-http: Added connect and request timeout settings.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-06-05 15:43:42 +0300 Timo Sirainen <tss@iki.fi> (4cadfab)

    lib-http: Mark the HTTP connection connected only after SSL handshake is
    finished.


M	src/lib-http/http-client-connection.c

2013-06-05 15:08:59 +0300 Timo Sirainen <tss@iki.fi> (035dfd7)

    lib-http: Don't create a new HTTP connection when there is already one
    connecting.


M	src/lib-http/http-client-peer.c

2013-06-01 17:17:47 +0300 Timo Sirainen <tss@iki.fi> (b9dce65)

    lda/lmtp: If mail delivery fails with tempfail, don't fallback to saving to
    INBOX.


M	src/lda/main.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h
M	src/lmtp/commands.c

2013-06-01 17:11:55 +0300 Timo Sirainen <tss@iki.fi> (4860b87)

    lib-index: Avoid memcpy()ing data over itself.


M	src/lib-index/mail-index-transaction-finish.c

2013-06-01 17:08:19 +0300 Timo Sirainen <tss@iki.fi> (1424de6)

    lib-fs: If fs_default_copy() fails, close the copy stream immediately. The
    stream's origin may already be freed by the time the fs_file_close() is
    trying to close the stream.


M	src/lib-fs/fs-api.c

2013-06-01 15:33:58 +0300 Timo Sirainen <tss@iki.fi> (ed74f11)

    lmtp: Give the DATA input stream a name, so the raw mailbox gets a name and
    doesn't fail.


M	src/lmtp/commands.c

2013-06-01 04:17:40 +0300 Timo Sirainen <tss@iki.fi> (53e8881)

    imapc: If imapc_list_prefix is set, don't skip it in filesystem paths. Most
    importantly this fixes the index path when accessing the imapc_list_prefix
    mailbox itself (so the indexes won't be in the mail root dir, where they
    don't get deleted when mailbox is deleted).


M	src/lib-storage/index/imapc/imapc-list.c

2013-06-01 04:06:48 +0300 Timo Sirainen <tss@iki.fi> (a04d894)

    lib-storage: If mailbox autocreate fails with "already exists", ignore the
    error. This check was supposed to have been already there, but it was
    checking for the wrong error.


M	src/lib-storage/mail-storage.c

2013-06-01 03:48:07 +0300 Timo Sirainen <tss@iki.fi> (cb3a595)

    imapc: Return correct mailbox list flags for the imapc prefix mailbox
    itself.


M	src/lib-storage/index/imapc/imapc-list.c

2013-06-01 03:37:21 +0300 Timo Sirainen <tss@iki.fi> (d9a4e66)

    imapc: Allow accessing the imapc_list_prefix itself.


M	src/lib-storage/index/imapc/imapc-list.c

2013-06-01 03:20:15 +0300 Timo Sirainen <tss@iki.fi> (58ba0fe)

    imapc: Fixed mailbox deletion.


M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-private.h

2013-06-01 03:06:54 +0300 Timo Sirainen <tss@iki.fi> (44bce57)

    imapc: Don't assert-crash when trying to access imapc_list_prefix itself.


M	src/lib-storage/index/imapc/imapc-list.c

2013-06-01 02:56:57 +0300 Timo Sirainen <tss@iki.fi> (0662597)

    lib-imap-client: Ask CAPABILITY again after STARTTLS


M	src/lib-imap-client/imapc-connection.c

2013-06-01 02:56:25 +0300 Timo Sirainen <tss@iki.fi> (64ee811)

    lib-storage: Empty mailbox name isn't valid.


M	src/lib-storage/mailbox-list.c

2013-06-01 02:25:54 +0300 Timo Sirainen <tss@iki.fi> (ac48442)

    Make sure errno is preserved in non-delayed signal handlers. The current
    code didn't have any signal handlers that modified errno, so this doesn't
    fix any bugs.


M	src/lib/lib-signals.c

2013-05-31 17:36:45 +0300 Timo Sirainen <tss@iki.fi> (281c0a6)

    imapc: Changed imapc_user setting's default to empty.


M	src/lib-storage/index/imapc/imapc-settings.c

2013-05-31 17:36:19 +0300 Timo Sirainen <tss@iki.fi> (0bf0c44)

    imapc: Empty imapc_user expands to namespace's owner, or with public
    namespaces to user itself. The main idea is that with shared namespaces it
    now expands to the shared username, allowing shared mailbox access via
    imapc.


M	src/lib-storage/index/imapc/imapc-storage.c

2013-05-31 17:05:13 +0300 Timo Sirainen <tss@iki.fi> (9f3b630)

    lib-imap-client: Connect and command timeouts are now configurable. Also use
    the same connect timeout for the DNS lookup's timeout.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c

2013-05-31 02:29:49 +0300 Stephan Bosch <stephan@rename-it.nl> (d3a3d31)

    imap: URLFETCH's URL callback would prematurely uncork the output stream
    when called for a local URL.


M	src/imap/cmd-urlfetch.c

2013-05-30 22:44:54 +0300 Timo Sirainen <tss@iki.fi> (e4d51d2)

    imap: URLFETCH's tagged reply wasn't sent while TCP corked.


M	src/imap/cmd-urlfetch.c

2013-05-30 22:27:57 +0300 Timo Sirainen <tss@iki.fi> (2e97f87)

    auth: Fixed error handling for proxy host dns_lookup()


M	src/auth/auth-request.c

2013-05-30 22:27:23 +0300 Timo Sirainen <tss@iki.fi> (3874d5d)

    Reverted previous wrong commit.


M	src/auth/auth-worker-server.c

2013-05-30 22:26:14 +0300 Timo Sirainen <tss@iki.fi> (604235b)

    auth: Fixed error handling for proxy host dns_lookup()


M	src/auth/auth-worker-server.c

2013-05-30 21:45:13 +0300 Timo Sirainen <tss@iki.fi> (1da5113)

    layout=index: Allow mailbox create/delete/rename during mailbox list
    iteration.


M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2013-05-30 19:03:05 +0300 Timo Sirainen <tss@iki.fi> (8ea491a)

    lib-index: Fixed a broken assert.


M	src/lib-index/mail-index-transaction-export.c

2013-05-30 18:04:58 +0300 Stephan Bosch <stephan@rename-it.nl> (b22a040)

    lib-imap-urlauth: Added API for using the fetch interface with an already
    parsed IMAP URL object.


M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.h

2013-05-30 18:04:52 +0300 Stephan Bosch <stephan@rename-it.nl> (620b603)

    imap: Fixed segfault in URLFETCH command. Command would be cleaned up while
    requests were still pending, causing a segfault once a request finished.
    Added API determining whether the URLAUTH fetch interface still has pending
    requests.


M	src/imap/cmd-urlfetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.h

2013-05-30 18:04:17 +0300 Stephan Bosch <stephan@rename-it.nl> (69c5fffb)

    lib-imap-urlauth: Fixed handling of URLAUTH service connection resume after
    pending local request. This was erroneously removed in an earlier commit.


M	src/lib-imap-urlauth/imap-urlauth-fetch.c

2013-05-30 18:04:10 +0300 Stephan Bosch <stephan@rename-it.nl> (636e3a4)

    lib-imap-urlauth: Fixed pending_request counter difference between locally
    and remotely fetched URLAUTHs.


M	src/lib-imap-urlauth/imap-urlauth-fetch.c

2013-05-30 18:03:53 +0300 Stephan Bosch <stephan@rename-it.nl> (a103139)

    lib-imap-urlauth: Fixed URLAUTH fetch reference counting for when requests
    are aborted at deinit.


M	src/lib-imap-urlauth/imap-urlauth-fetch.c

2013-05-30 18:03:46 +0300 Stephan Bosch <stephan@rename-it.nl> (7cf7900)

    lib-imap-urlauth: Fixed URLAUTH connection resume after error.


M	src/lib-imap-urlauth/imap-urlauth-connection.c

2013-05-30 18:03:38 +0300 Stephan Bosch <stephan@rename-it.nl> (76e3f37)

    lib-imap-urlauth: Made sure callbacks from URLAUTH service connection are
    executed only once.


M	src/lib-imap-urlauth/imap-urlauth-connection.c

2013-05-30 17:45:27 +0300 Timo Sirainen <tss@iki.fi> (e95bc84)

    var_expand(): Added %N, which is the same as %H except based on MD5. This
    gives a better distribution of values than %H.


M	src/lib/var-expand.c

2013-05-29 16:40:50 +0300 Timo Sirainen <tss@iki.fi> (d8ce48f)

    lib-imap: imap_append_string_for_humans() returned broken output for
    whitespace-only input. This returned broken IMAP ENVELOPEs, especially for
    subjects that contained only whitespace. Since the broken output returned a
    huge literal, it basically caused the IMAP client to hang.


M	src/lib-imap/Makefile.am
M	src/lib-imap/imap-quote.c
A	src/lib-imap/test-imap-quote.c

2013-05-29 12:44:15 +0300 Timo Sirainen <tss@iki.fi> (0572847)

    lib-settings: Support also "seconds" and "minutes" (instead of just
    secs/mins)


M	src/lib-settings/settings-parser.c

2013-05-29 12:33:17 +0300 Timo Sirainen <tss@iki.fi> (4fac477)

    dsync: Fixed dsync handshaking since recent change.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-05-29 03:47:38 +0300 Timo Sirainen <tss@iki.fi> (6d80824)

    lib-index: Fixed mail_cache_lookup_headers() when fields were still in
    memory buffer.


M	src/lib-index/mail-cache-lookup.c

2013-05-29 03:27:09 +0300 Timo Sirainen <tss@iki.fi> (5c95939)

    lib-storage: If INDEX=MEMORY, return index root dir as nonexistent instead
    of as "".


M	src/lib-storage/mailbox-list.c

2013-05-29 03:26:41 +0300 Timo Sirainen <tss@iki.fi> (3d027f3)

    lib-storage: Reverted previous change after all.


M	src/lib-storage/mailbox-list.c

2013-05-29 03:23:40 +0300 Timo Sirainen <tss@iki.fi> (2d8d76a)

    lib-storage: Don't try to mkdir() empty directory with INDEX=MEMORY


M	src/lib-storage/mailbox-list.c

2013-05-29 03:18:04 +0300 Timo Sirainen <tss@iki.fi> (f154234)

    Fixed compiling with gcc v3.3 and older. Perhaps the check needs to be also
    for somewhat newer versions?..


M	src/lib/macros.h

2013-05-28 18:18:45 +0300 Timo Sirainen <tss@iki.fi> (eaa9884)

    auth ldap: If ldap debug_level>0, log how long initialization took.


M	src/auth/db-ldap.c

2013-05-28 17:30:42 +0300 Timo Sirainen <tss@iki.fi> (30cca82)

    auth: Keep auth_request referenced during DNS lookup. If the underlying auth
    connection gets closed, there's nothing else referencing the auth_request.


M	src/auth/auth-request.c

2013-05-28 17:10:03 +0300 Timo Sirainen <tss@iki.fi> (b372fc2)

    doveadm-server: Pass local/remote_ip/port to passdb lookups so proxy_maybe
    works.


M	src/doveadm/client-connection.c
M	src/doveadm/client-connection.h
M	src/doveadm/doveadm-mail-server.c

2013-05-28 16:30:38 +0300 Timo Sirainen <tss@iki.fi> (7606d44)

    auth: Fixed caching empty userdb result.


M	src/auth/auth-request.c

2013-05-28 16:30:19 +0300 Timo Sirainen <tss@iki.fi> (5c25372)

    auth: If blocking userdb returns no fields, don't crash when trying to cache
    the result.


M	src/auth/userdb-blocking.c

2013-05-28 01:03:58 +0300 Timo Sirainen <tss@iki.fi> (75a2a83)

    lib-fs: Added fs_get_root_driver()


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2013-05-27 21:03:14 +0300 Timo Sirainen <tss@iki.fi> (9865d9e)

    dbox: Don't cache pop3.uidl|order unless index header indicates there are
    those. They exist only when doing a migration, so it's pretty wasteful
    storing "doesn't exist" for all other installations.


M	src/doveadm/doveadm-dump-index.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-save.h
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.h
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.h
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.h
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c

2013-05-27 20:45:08 +0300 Timo Sirainen <tss@iki.fi> (c7fc043)

    lib-index: Added mail_index_ext_resize_hdr()


M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index.h

2013-05-27 20:44:56 +0300 Timo Sirainen <tss@iki.fi> (5e1dafd)

    lib-index: Fixed resizing header when old&new sizes were the same when
    aligned.


M	src/lib-index/mail-index-sync-ext.c

2013-05-27 20:44:05 +0300 Timo Sirainen <tss@iki.fi> (930d6db)

    lib-index: Create ext-intro records using the latest sizes, not initial
    sizes.


M	src/lib-index/mail-index-transaction-export.c

2013-05-27 20:18:35 +0300 Timo Sirainen <tss@iki.fi> (ab8e5f7)

    dbox: Return cached pop3.order=0 as empty string instead to fix sorting
    problems.


M	src/lib-storage/index/dbox-common/dbox-mail.c

2013-05-26 21:57:36 +0300 Timo Sirainen <tss@iki.fi> (fd32c46)

    dsync: Added -x parameter to exclude mailboxes from sync. Multiple -x
    parameters can be added. Giving \flag as parameter means that the mailbox
    with the given SPECIAL-USE \flag is skipped. For example:

    doveadm sync -x '\All' -x '\Flagged' -x '\Important' mdbox:~/mdbox

M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2013-05-26 21:44:50 +0300 Timo Sirainen <tss@iki.fi> (495c296)

    imapc: Fixed assert-crash when copying messages.


M	src/lib-storage/index/imapc/imapc-save.c

2013-05-26 21:20:47 +0300 Timo Sirainen <tss@iki.fi> (f1a5b3a)

    dsync: Small code cleanup.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h

2013-05-26 21:07:09 +0300 Timo Sirainen <tss@iki.fi> (2b0fe86)

    imapc: Pass through SPECIAL-USE LIST flags if imapc is in INBOX namespace.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/mailbox-list.h

2013-05-26 19:14:21 +0300 Timo Sirainen <tss@iki.fi> (147a788)

    dbox: Added support for POP3 message order.


M	src/doveadm/doveadm-dump-dbox.c
M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2013-05-26 19:04:00 +0300 Timo Sirainen <tss@iki.fi> (d33fc6c)

    lib-index: mail_cache_lookup*() can now return fields recently added with
    mail_cache_add() Previously it was returning them if they had already been
    written to dovecot.index.cache, but not if they were still in the in-memory
    buffer. This avoids caching/parsing the same field multiple times when
    messages aren't accessed in ascending order (e.g. when sorting messages).


M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-transaction.c

2013-05-23 17:36:54 +0300 Timo Sirainen <tss@iki.fi> (35e962a)

    lib-http: Added ssl_cert|key|key_password settings to be passed to
    ssl-iostream. These are used for sending client's SSL certificate.


M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-05-22 15:59:38 +0300 Timo Sirainen <tss@iki.fi> (9e3b104)

    *-login: If ssl=required, don't list any SASL mechanisms before STARTTLS.


M	src/login-common/sasl-server.c

2013-05-22 15:57:13 +0300 Timo Sirainen <tss@iki.fi> (e2ce858)

    *-login: ssl=required should imply disable_plaintext_auth=yes


M	src/imap-login/client.c
M	src/login-common/client-common-auth.c

2013-05-22 15:44:05 +0300 Timo Sirainen <tss@iki.fi> (79c8622)

    lib-storage: Optimize SEARCH_MODSEQ query if it's higher than HIGHESTMODSEQ.


M	src/lib-storage/index/index-search.c

2013-05-22 15:16:22 +0300 Timo Sirainen <tss@iki.fi> (f5d3670)

    dsync: Fixed unsubscribing from mailbox within same session as the mailbox's
    deletion.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c

2013-05-22 14:56:41 +0300 Timo Sirainen <tss@iki.fi> (5e925f6)

    dsync: Don't notify replicator process about successful dsync if the dsync
    failed.


M	src/doveadm/dsync/doveadm-dsync.c

2013-05-21 22:57:06 +0300 Timo Sirainen <tss@iki.fi> (63e3767)

    *-login: If auth failed with a specified reason, the reason wasn't actually
    shown to client.


M	src/login-common/client-common-auth.c

2013-05-21 22:55:23 +0300 Stephan Bosch <stephan@rename-it.nl> (659f431)

    lib-imap-urlauth: Fixed deinitialization of the URLAUTH fetch handler. Added
    reference counting to make sure callbacks will not deinitialize the handler
    prematurely.


M	src/imap/cmd-urlfetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.h

2013-05-21 22:55:17 +0300 Stephan Bosch <stephan@rename-it.nl> (df97665)

    lib-imap-urlauth: Fixed resuming in URLAUTH fetch handler. Fixed URLAUTH
    fetch handler to properly resume the URLAUTH connection, even when it is
    deinitialized.


M	src/lib-imap-urlauth/imap-urlauth-fetch.c

2013-05-21 22:55:12 +0300 Stephan Bosch <stephan@rename-it.nl> (96fbbe9)

    lib-imap-urlauth: Fixed local URLAUTH fetches that didn't immediately finish
    handling content. Local requests are now also properly counted.


M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.h

2013-05-21 17:09:37 +0300 Timo Sirainen <tss@iki.fi> (80ef919)

    auth: Fixed crash if LDAP query returned multiple results.


M	src/auth/db-ldap.c

2013-05-20 18:26:16 +0300 Timo Sirainen <tss@iki.fi> (7b904cc)

    dsync: Previous have_save_guids change somewhat broke compatibility with
    earlier dsync versions.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-05-20 17:30:23 +0300 Timo Sirainen <tss@iki.fi> (985acc0)

    dsync: Fixed unsubscribing from an already deleted mailbox.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2013-05-20 02:25:26 +0300 Timo Sirainen <tss@iki.fi> (2194c73)

    Added signature for changeset 7aa929edd551


M	.hgsigs

2013-05-20 02:25:23 +0300 Timo Sirainen <tss@iki.fi> (2235f9b)

    Added tag 2.2.2 for changeset 7aa929edd551


M	.hgtags

2013-05-20 02:25:23 +0300 Timo Sirainen <tss@iki.fi> (3da6df0)

    Released v2.2.2.


M	NEWS
M	configure.ac

2013-05-20 02:01:02 +0300 Timo Sirainen <tss@iki.fi> (14f6fe5)

    dsync: Don't try to sync with GUIDs if we can't set them on the needed side.
    With two-way syncing both sides need to have writable GUIDs. With one-way
    syncing only the writing side needs to have writable GUIDs.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox.h

2013-05-20 01:52:25 +0300 Timo Sirainen <tss@iki.fi> (9a107de)

    maildir: If we notice an unexpectedly inserted file, retry the sync to fix
    it. Without this doveadm force-resync would just ignore the inserted files.


M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-sync.h

2013-05-20 01:39:52 +0300 Timo Sirainen <tss@iki.fi> (001ec60)

    maildir: Reverted most of changeset c92ebbedc6f9. If dovecot-uidlist file is
    recreated, it gets a new inode number, and we should recognize by that alone
    that it has changed. More importantly this forced re-reading of
    dovecot-uidlist clears out the RACING flag, making it impossible to handle
    reappearing maildir files.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2013-05-19 23:42:29 +0300 Timo Sirainen <tss@iki.fi> (9847ec5)

    lib-storage: Added mailbox_status.have_save_guids.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2013-05-19 23:21:20 +0300 Timo Sirainen <tss@iki.fi> (aeab213)

    mbox: Previous change broke index updates to successful saves.


M	src/lib-storage/index/mbox/mbox-save.c

2013-05-19 22:36:36 +0300 Christian Wiese <christian.wiese@securepoint.de> (5f39ad0)

    example-config: Added missing auth-dict.conf.ext to distribution


M	doc/example-config/conf.d/Makefile.am

2013-05-19 22:30:52 +0300 Timo Sirainen <tss@iki.fi> (6f76710)

    http_url_escape_param(): Added more characters to be escaped. Most
    importantly '+', which encodes a space normally. The others may not be
    strictly necessary, but safer to escape them just in case.


M	src/lib-http/http-url.c

2013-05-19 19:55:41 +0300 Timo Sirainen <tss@iki.fi> (04d9ab8)

    lib-http: Fixed assert-crash when host had multiple IPs and first one had
    failed.


M	src/lib-http/http-client-host.c

2013-05-19 19:51:34 +0300 Timo Sirainen <tss@iki.fi> (dfc3a20)

    imap-urlfetch: Don't leak memory on error. Use TCP corking when sending
    data.


M	src/imap/cmd-urlfetch.c

2013-05-15 17:18:29 +0300 Timo Sirainen <tss@iki.fi> (c42c256)

    mbox: Fixed committing transaction after a previous save had failed.


M	src/lib-storage/index/mbox/mbox-save.c

2013-05-15 17:10:28 +0300 Timo Sirainen <tss@iki.fi> (d6a8078)

    mbox: If save's input stream fails, fail saving instead of ignoring the
    error.


M	src/lib-storage/index/mbox/mbox-save.c

2013-05-15 17:09:36 +0300 Timo Sirainen <tss@iki.fi> (a734925)

    layout=fs: Always return INBOX uppercased when listing mailboxes.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2013-05-15 16:10:48 +0300 Timo Sirainen <tss@iki.fi> (9fbb551)

    lib-storage: Don't lose INBOX's \Subscribed flag when returning it is
    delayed.


M	src/lib-storage/list/mailbox-list-iter.c

2013-05-15 15:35:10 +0300 Timo Sirainen <tss@iki.fi> (a29b327)

    imap: Return how long SELECT or EXAMINE command took to answer. Could be
    useful to know sometimes if there's a large maildir where a lot files need
    to be rename()d.


M	src/imap/cmd-select.c

2013-05-15 15:26:47 +0300 Timo Sirainen <tss@iki.fi> (aa8b823)

    maildir: Fixed handling over 26 keywords in a mailbox.


M	src/lib-storage/index/maildir/maildir-sync-index.c

2013-05-15 15:06:24 +0300 Timo Sirainen <tss@iki.fi> (25480af)

    Added asserts to binary searches to make sure we don't go to infinite loop.
    Using idx=left+(right-left)/2 would have worked also to allow 4GB sizes, but
    since none of the places in the code are likely to reach 2GB we might as
    well just add an assert. (Also if they do reach 2GB, it could be possible
    that they could reach also above 4GB and cause problems. Better to see an
    early error.)


M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/bsearch-insert-pos.h
M	src/lib/seq-range-array.c

2013-05-15 14:28:04 +0300 Timo Sirainen <tss@iki.fi> (b8164b5)

    quota-status: If quota_status_* settings are set, don't free them before
    using.


M	src/plugins/quota/quota-status.c

2013-05-15 13:44:01 +0300 Timo Sirainen <tss@iki.fi> (e24f97a)

    lib-storage: Allow mail_*cache_fields settings to specify any hdr.* fields.
    Also the fields were previously set only once globally, so if the process
    served multiple users, it wouldn't have been possible to use per-user values
    for these fields.


M	src/lib-storage/index/index-storage.c

2013-05-15 13:36:43 +0300 Timo Sirainen <tss@iki.fi> (c2d7c8a)

    lib-index: Don't mark field decisions dirty when registering initial cache
    fields.


M	src/lib-index/mail-cache-fields.c

2013-05-15 13:34:59 +0300 Timo Sirainen <tss@iki.fi> (a16d9a6)

    lib-index: Fixed mail_cache_register_fields() decision updates. Normally
    this shouldn't matter, except when mail_*cache_fields settings have been
    used.


M	src/lib-index/mail-cache-fields.c

2013-05-15 13:20:43 +0300 Timo Sirainen <tss@iki.fi> (872d122)

    lib-storage: Added mail_always_cache_fields setting.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2013-05-11 17:08:12 +0200 Florian Zeitz <florob@babelmonkeys.de> (9281d38)

    liblib: Fix Unicode decomposition


M	src/lib/test-unichar.c
M	src/lib/unichar.c
M	src/lib/unicodemap.pl

2013-05-15 12:52:29 +0300 Timo Sirainen <tss@iki.fi> (cb95df2)

    example-config: Added comment how all *.conf.ext files are accessed
    typically.


M	doc/example-config/dovecot-dict-auth.conf.ext
M	doc/example-config/dovecot-dict-sql.conf.ext
M	doc/example-config/dovecot-ldap.conf.ext
M	doc/example-config/dovecot-sql.conf.ext

2013-05-15 12:50:29 +0300 Timo Sirainen <tss@iki.fi> (b3b55a8)

    Makefile: Removed dovecot-db.conf.ext


M	doc/example-config/Makefile.am

2013-05-15 12:50:03 +0300 Timo Sirainen <tss@iki.fi> (a71c824)

    example-config: Removed dovecot-db.conf.ext since Berkeley DB support is
    never built in.


D	doc/example-config/dovecot-db.conf.ext

2013-05-15 12:48:21 +0300 Timo Sirainen <tss@iki.fi> (84ddb91)

    example-config: auth-*.conf.ext should say they're included by 10-auth.conf


M	doc/example-config/conf.d/auth-checkpassword.conf.ext
M	doc/example-config/conf.d/auth-deny.conf.ext
M	doc/example-config/conf.d/auth-dict.conf.ext
M	doc/example-config/conf.d/auth-ldap.conf.ext
M	doc/example-config/conf.d/auth-master.conf.ext
M	doc/example-config/conf.d/auth-passwdfile.conf.ext
M	doc/example-config/conf.d/auth-sql.conf.ext
M	doc/example-config/conf.d/auth-static.conf.ext
M	doc/example-config/conf.d/auth-system.conf.ext
M	doc/example-config/conf.d/auth-vpopmail.conf.ext

2013-05-14 23:34:38 +0300 Timo Sirainen <tss@iki.fi> (daabad6)

    auth passwd-file: If we fail to open passwd-file, log a request error
    directly. Instead of one error message and another info message.


M	src/auth/db-passwd-file.c

2013-05-14 22:23:27 +0300 Timo Sirainen <tss@iki.fi> (a7b0916)

    Avoid strict aliasing warnings.


M	src/lib/hash.h
M	src/plugins/fts-lucene/lucene-wrapper.cc

2013-05-14 16:46:08 +0300 Timo Sirainen <tss@iki.fi> (cf04ab5)

    example-config: Moved imap_* and pop3_* settings outside protocol section.
    There's no need to keep them inside protocol {}, and in case of
    pop3_uidl_format=%m setting it's actually harmful.


M	doc/example-config/conf.d/20-imap.conf
M	doc/example-config/conf.d/20-pop3.conf

2013-05-14 16:32:30 +0300 Timo Sirainen <tss@iki.fi> (f64b66f)

    pop3: Added pop3_deleted_flag setting.


M	doc/example-config/conf.d/20-pop3.conf
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/pop3/pop3-settings.h

2013-05-14 14:14:16 +0300 Timo Sirainen <tss@iki.fi> (4f0ea8d)

    configure: Fixed checking for struct sockpeercred with OpenBSD <5.3


M	configure.ac

2013-05-14 14:02:36 +0300 Timo Sirainen <tss@iki.fi> (eeeedfd)

    login-proxy: If login fails with timeout, log what the proxying state was.


M	src/login-common/login-proxy.c

2013-05-14 14:00:21 +0300 Timo Sirainen <tss@iki.fi> (6a438f1)

    login-proxy: Don't crash if connect() succeeds but login fails with timeout.


M	src/login-common/login-proxy-state.h
M	src/login-common/login-proxy.c

2013-05-13 23:06:31 +0200 Dennis Schridde <devurandom@gmx.net> (ea954a6)

    Fix out of source build of manpages


M	doc/man/Makefile.am

2013-05-06 23:59:41 +0300 Timo Sirainen <tss@iki.fi> (89334d8)

    lib-index: Previous commit sometimes broke scanning transaction log view. If
    min_file_seq+offset pointed to the end of the previous file that no longer
    existed, we didn't just skip over it.


M	src/lib-index/mail-transaction-log-view.c

2013-05-06 20:21:27 +0300 Timo Sirainen <tss@iki.fi> (5c8a42e)

    imap: URLFETCH sometimes failed thinking it didn't receive all of the
    message data.


M	src/imap/cmd-urlfetch.c

2013-05-06 20:20:43 +0300 Timo Sirainen <tss@iki.fi> (7b6cc2b)

    imap: URLFETCH leaked istream on failures.


M	src/imap/cmd-urlfetch.c

2013-05-06 20:15:58 +0300 Timo Sirainen <tss@iki.fi> (d2dd9b7)

    imap: Fixed URLFETCH assert-crashes due to output_cmd_lock not being
    cleared.


M	src/imap/cmd-urlfetch.c

2013-05-06 19:51:07 +0300 Timo Sirainen <tss@iki.fi> (f036539)

    imap: Don't eat away the next command if CATENATE fails.


M	src/imap/cmd-append.c

2013-05-06 19:49:55 +0300 Timo Sirainen <tss@iki.fi> (693e839)

    imap: Fixed assert-crash on invalid APPEND parameters.


M	src/imap/cmd-append.c

2013-05-06 19:49:18 +0300 Timo Sirainen <tss@iki.fi> (fa0e8ff)

    imap: Don't hang in APPEND when giving it invalid parameters.


M	src/imap/cmd-append.c

2013-05-06 19:48:32 +0300 Timo Sirainen <tss@iki.fi> (ba9f57d)

    lib-imap: imap_parser_read_args() shouldn't append multiple EOLs when
    calling multiple times.


M	src/lib-imap/imap-parser.c

2013-05-06 18:35:36 +0300 Timo Sirainen <tss@iki.fi> (8e5d894)

    lib-imap-urlauth: Don't try to access garbage memory on error handling
    paths.


M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth.c

2013-05-06 17:30:07 +0300 Timo Sirainen <tss@iki.fi> (68a3f1b)

    doveadm: If search query attempts to access nonexistent mailbox, just ignore
    it. Most importantly running a query for multiple users wouldn't be an error
    if the mailbox existed only for some users. It's probably cleaner to then
    always just ignore the nonexistent mailboxes.


M	src/doveadm/doveadm-mail-iter.c

2013-05-06 17:27:36 +0300 Timo Sirainen <tss@iki.fi> (c57ba17)

    doveadm_mail_iter_init(): Removed unnecessarily returning transaction. If
    it's needed in future just add a new doveadm_mail_iter_get_transaction().


M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-iter.h
M	src/doveadm/doveadm-mail-search.c

2013-05-06 16:43:29 +0300 Timo Sirainen <tss@iki.fi> (dcf4c70)

    lib-index: The previous assert-crashfix didn't actually fix the problem.


M	src/lib-index/mail-transaction-log-view.c

2013-05-06 15:17:49 +0300 Timo Sirainen <tss@iki.fi> (48cfcd3)

    maildir++: Fixed mail_shared_explicit_inbox=no


M	src/lib-storage/list/mailbox-list-maildir-iter.c

2013-05-06 15:04:57 +0300 Timo Sirainen <tss@iki.fi> (392cdea)

    namespace { prefix="" list=no } should never be listed.


M	src/lib-storage/list/mailbox-list-iter.c

2013-05-06 14:59:27 +0300 Timo Sirainen <tss@iki.fi> (515d649)

    acl: Optionally get default ACL's for private/shared namespaces from user's
    INBOX. This probably should be the default always, but better not break
    anyone's existing setup until v2.3.0. So for now there's a setting for this:
    plugin { acl_defaults_from_inbox = yes }


M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c

2013-05-06 14:58:55 +0300 Timo Sirainen <tss@iki.fi> (9199a16)

    acl: Mailbox creation ignored ACLs (due to API changes in v2.2). The created
    mailbox couldn't have been accessed however.


M	src/plugins/acl/acl-mailbox.c

2013-05-03 17:17:15 +0300 Timo Sirainen <tss@iki.fi> (c958941)

    quota-status: Return 554 instead of 552 on quota failures. This is because
    RFC 5321/2821 recommends that 552 is treated the same as 452.


M	src/plugins/quota/quota-status.c

2013-05-02 18:32:47 +0300 Timo Sirainen <tss@iki.fi> (7a151ea)

    lib-imap-urlauth: Don't try to access garbage memory on error handling path.


M	src/lib-imap-urlauth/imap-urlauth.c

2013-05-02 18:29:50 +0300 Timo Sirainen <tss@iki.fi> (2d8ff6c)

    imap-urlauth-worker: Fixed a crash (by removing unnecessary code)


M	src/imap-urlauth/imap-urlauth-worker.c

2013-05-02 18:18:26 +0300 Timo Sirainen <tss@iki.fi> (047f632)

    imap: Don't allow empty CATENATE () list.


M	src/imap/cmd-append.c

2013-05-02 18:11:56 +0300 Timo Sirainen <tss@iki.fi> (6c3a5f0)

    imap: Fixed using literals for URLs in CATENATE.


M	src/imap/cmd-append.c

2013-05-02 16:20:02 +0300 Timo Sirainen <tss@iki.fi> (e3d7df2)

    example-config: Typofix


M	doc/example-config/dovecot.conf

2013-04-23 21:32:24 +0300 Timo Sirainen <tss@iki.fi> (61f78d8)

    stats plugin: Don't try to send notifications to already dead stats process.


M	src/plugins/stats/Makefile.am
M	src/plugins/stats/stats-connection.c

2013-04-23 21:31:52 +0300 Timo Sirainen <tss@iki.fi> (5739718)

    lib-master: Added master_service_is_master_stopped()


M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2013-04-23 21:08:31 +0300 Timo Sirainen <tss@iki.fi> (3b09ea6)

    hash_table_clear(): Added a comment about API usage.


M	src/lib/hash.h

2013-04-23 21:06:34 +0300 Timo Sirainen <tss@iki.fi> (208028f)

    maildir: Crashfix after dovecot-keywords file was re-read.


M	src/lib-storage/index/maildir/maildir-keywords.c

2013-04-23 21:06:00 +0300 Timo Sirainen <tss@iki.fi> (f6f5717)

    lib-storage: Fixed crash with mailbox_list_index=yes after re-reading index.


M	src/lib-storage/list/mailbox-list-index.c

2013-04-23 20:53:53 +0300 Timo Sirainen <tss@iki.fi> (6e5abd4)

    istream-[b]zlib: Don't break if parent stream gets seeked in the middle of
    reads.


M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-zlib.c

2013-04-23 20:51:34 +0300 Timo Sirainen <tss@iki.fi> (8cdef63)

    dbox: Close file's fd only after its istream is destroyed. For example zlib
    plugin keeps the stream open as a cache even after the dbox_file has been
    destroyed.


M	src/lib-storage/index/dbox-common/dbox-file.c

2013-04-23 17:21:46 +0300 Timo Sirainen <tss@iki.fi> (be51dfe)

    istream-seekable: Don't crash when seeking forwards past the data we haven't
    read yet.


M	src/lib/istream-seekable.c

2013-04-23 16:20:48 +0300 Timo Sirainen <tss@iki.fi> (ec383c7)

    lib-http: Makefile fix


M	src/lib-http/Makefile.am

2013-04-23 13:47:46 +0300 Timo Sirainen <tss@iki.fi> (c9af020)

    fts-solr: Don't crash if fts_solr setting is invalid.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2013-04-23 13:33:12 +0300 Timo Sirainen <tss@iki.fi> (066595d)

    master: Fixed warning log message.


M	src/master/master-settings.c

2013-04-23 13:28:17 +0300 Timo Sirainen <tss@iki.fi> (8920919)

    OpenBSD compile fix: include sys/socket.h when checking for struct
    sockpeercred.


M	configure.ac

2013-04-22 21:51:01 +0300 Timo Sirainen <tss@iki.fi> (f9b31ae)

    stats plugin: Use nonblocking open() for stats fifo. This fixes hangs in it.
    Alternative would be to use alarm().


M	src/plugins/stats/stats-connection.c

2013-04-22 18:45:04 +0300 Timo Sirainen <tss@iki.fi> (0c99179)

    zlib: Keep the last read mail cached uncompressed in a temp file. This fixes
    performance problems with partial IMAP FETCH commands.


M	src/plugins/zlib/zlib-plugin.c

2013-04-20 21:57:47 +0300 Timo Sirainen <tss@iki.fi> (4a254eb)

    lib-storage: Avoid wasting data stack during searches.


M	src/lib-storage/index/index-search.c

2013-04-20 21:02:30 +0300 Timo Sirainen <tss@iki.fi> (96b8965)

    Fixed a memory leak.


M	src/lib-mail/istream-attachment-connector.c

2013-04-20 20:58:06 +0300 Timo Sirainen <tss@iki.fi> (e285484)

    stats plugin: Fixed memory leak.


M	src/plugins/stats/stats-plugin.c

2013-04-19 14:29:23 +0300 Timo Sirainen <tss@iki.fi> (0124311)

    Compiling fix for Sun compilers. I wish gcc/clang warned about these as
    well, as sometimes they indicate bugs.


M	src/imap-urlauth/imap-urlauth-worker.c
M	src/lib/ioloop.c

2013-04-19 00:38:05 +0300 Timo Sirainen <tss@iki.fi> (03a5062)

    Added signature for changeset 6fcf060b50f1


M	.hgsigs

2013-04-19 00:38:00 +0300 Timo Sirainen <tss@iki.fi> (16b2777)

    Added tag 2.2.1 for changeset 6fcf060b50f1


M	.hgtags

2013-04-19 00:38:00 +0300 Timo Sirainen <tss@iki.fi> (c4d85d3)

    Released v2.2.1.


M	NEWS
M	TODO
M	configure.ac

2013-04-18 18:49:55 +0300 Timo Sirainen <tss@iki.fi> (90a2c5f)

    layout=index: Fixed listing subscriptions.


M	src/lib-storage/list/mailbox-list-index-backend.c

2013-04-18 17:54:29 +0300 Timo Sirainen <tss@iki.fi> (92bf0ad)

    lib-storage: Set virtual/physical size in dest_mail when copying, if
    possible. Ideally lib-index would be fixed so this wouldn't be necessary.
    The lib-index way of fixing it would also be useful for more than just quota
    plugin.


M	src/lib-storage/index/index-storage.c

2013-04-18 17:48:38 +0300 Timo Sirainen <tss@iki.fi> (a90616a)

    lib-storage: mailbox_copy() didn't always copy all the cached fields to
    destination. If the destination mailbox's cache file wasn't already opened,
    the default cache decisions were used.


M	src/lib-storage/index/index-storage.c

2013-04-17 18:47:36 +0300 Stephan Bosch <stephan@rename-it.nl> (e3ca6e9)

    liblib: Added DLLIST2_INSERT_AFTER_FULL() For inserting a new element in a
    doubly-linked list after an existing element.


M	src/lib/llist.h

2013-04-17 18:44:52 +0300 Stephan Bosch <stephan@rename-it.nl> (f82dfbd)

    lib-imap-urlauth: Fixed connection error handling to abort all pending
    requests.


M	src/lib-imap-urlauth/imap-urlauth-connection.c

2013-04-17 16:19:42 +0300 Timo Sirainen <tss@iki.fi> (8110bad)

    lib-storage: mailbox_save_finish() internally does one final
    mailbox_save_continue()


M	src/imap/cmd-append.c
M	src/lib-storage/mail-storage.c

2013-04-17 16:08:26 +0300 Timo Sirainen <tss@iki.fi> (6766440)

    doveadm fs: Set base_dir.


M	src/doveadm/doveadm-fs.c

2013-04-16 20:08:18 +0300 Timo Sirainen <tss@iki.fi> (511a7cc)

    mbox: Handle broken Status: and X-Status: headers without sync errors.


M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-private.h
M	src/lib-storage/index/mbox/mbox-sync-update.c

2013-04-16 16:20:30 +0300 Timo Sirainen <tss@iki.fi> (a6a9e53)

    auth: Fixed multiple master passdbs.


M	src/auth/auth-request.c

2013-04-16 15:54:05 +0300 Timo Sirainen <tss@iki.fi> (1235bbd)

    maildir: Fixed crash in some rare situations.


M	src/lib-storage/index/maildir/maildir-util.c

2013-04-15 21:40:35 +0300 Timo Sirainen <tss@iki.fi> (96c1fc9)

    zlib: Don't crash when trying to use zlib_save for handler that isn't
    compiled in.


M	src/plugins/zlib/zlib-plugin.c

2013-04-15 17:22:06 +0300 Timo Sirainen <tss@iki.fi> (9d25716)

    lib-mail: Don't assert-crash when multipart doesn't actually have any parts.


M	src/lib-mail/message-parser.c

2013-04-14 21:27:29 +0300 Timo Sirainen <tss@iki.fi> (f497d84)

    lib-storage: mailbox_list_index=yes was still broken.


M	src/lib-storage/mail-namespace.c

2013-04-14 20:40:47 +0300 Timo Sirainen <tss@iki.fi> (eed1ec3)

    Linking error fix.


M	src/doveadm/doveadm-mail.h

2013-04-12 21:19:38 +0300 Timo Sirainen <tss@iki.fi> (c92163a)

    Added tag 2.2.0 for changeset 1c8e7a295d4b


M	.hgtags

2013-04-11 22:38:59 +0300 Timo Sirainen <tss@iki.fi> (e81127c)

    Added signature for changeset e2cd03cc9c69


M	.hgsigs

2013-04-11 22:38:54 +0300 Timo Sirainen <tss@iki.fi> (604fa82)

    Released v2.1.0.


M	NEWS
M	configure.ac
A	doc/example-config/conf.d/11-object-storage.conf

2013-04-11 19:06:25 +0300 Timo Sirainen <tss@iki.fi> (94785d5)

    lib-storage: mailbox_list_index=yes was broken by previous change. Reverted
    the previous change and fixed it the right way.


M	src/lib-storage/list/mailbox-list-index.c

2013-04-11 18:50:25 +0300 Timo Sirainen <tss@iki.fi> (10ccd0e)

    Removed ambiguous mail_user.admin flag. dsync shouldn't sync mailboxes
    without +r ACL.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/lib-storage/mail-user.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-attributes.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/quota/quota.c

2013-04-11 17:35:31 +0300 Timo Sirainen <tss@iki.fi> (8c072aa)

    doveadm: Don't use MAILBOX_LIST_ITER_RAW_LIST when listing mailboxes. That
    skips ACLs and mailbox list. There's really no good reason to use that by
    default.


M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail.c

2013-04-11 16:54:53 +0300 Timo Sirainen <tss@iki.fi> (6d84b0f)

    lib-storage: mailbox_list_index=yes wasn't working with ACLs.


M	src/lib-storage/list/mailbox-list-index.c

2013-04-11 16:19:35 +0300 Timo Sirainen <tss@iki.fi> (1409230)

    lib-storage: mail_update_pvt_modseq() shouldn't crash if there is no private
    index.


M	src/lib-storage/index/index-mail.c

2013-04-11 13:38:16 +0300 Timo Sirainen <tss@iki.fi> (43262d1)

    net_getunixcred(): Fix to previous NetBSD<5 support: return pid as -1.


M	src/lib/net.c

2013-04-11 13:15:39 +0300 Timo Sirainen <tss@iki.fi> (921d4dd)

    net_getunixcred() support for NetBSD <v5.0. Fixed also building with other
    NetBSDs. Patch by Emmanuel Dreyfus


M	src/lib/net.c

2013-04-11 13:13:14 +0300 Timo Sirainen <tss@iki.fi> (5fb8092)

    Fixed getmntinfo() usage with NetBSD. Patch by Emmanuel Dreyfus


M	src/lib/mountpoint.c

2013-04-10 22:31:53 +0300 Timo Sirainen <tss@iki.fi> (2a7f967)

    Added signature for changeset d7f29af73468


M	.hgsigs

2013-04-10 22:31:41 +0300 Timo Sirainen <tss@iki.fi> (81e86d1)

    Added tag 2.2.rc7 for changeset d7f29af73468


M	.hgtags

2013-04-10 22:31:41 +0300 Timo Sirainen <tss@iki.fi> (c21978a)

    Released v2.2.rc7.


M	NEWS
M	TODO
M	configure.ac

2013-04-10 22:11:33 +0300 Timo Sirainen <tss@iki.fi> (03f2a18)

    imapc: If APPEND to selected mailbox doesn't send EXISTS, try if NOOP sends
    it. This makes Dovecot behave better with Courier.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2013-04-10 22:05:36 +0300 Timo Sirainen <tss@iki.fi> (1c3e5f6)

    iostream-ssl: Don't hang if ostream's max buffer size is set to 0.


M	src/lib-ssl-iostream/ostream-openssl.c

2013-04-10 21:18:07 +0300 Timo Sirainen <tss@iki.fi> (0b32a8d)

    lib-fs: Added fs_file_close() to explicitly close all streams that the file
    has open.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2013-04-10 18:48:54 +0300 Timo Sirainen <tss@iki.fi> (dc39158)

    lib-index: Fixed failing unit test


M	src/lib-index/test-mail-transaction-log-view.c

2013-04-10 18:00:12 +0300 Timo Sirainen <tss@iki.fi> (0f37e68)

    lib-http: Don't double-free request memory when aborting them.


M	src/lib-http/http-client-connection.c

2013-04-10 17:53:24 +0300 Timo Sirainen <tss@iki.fi> (c649425)

    lib-http: http_client_deinit() calls any pending delayed failure callbacks.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-request.c

2013-04-10 16:50:34 +0300 Timo Sirainen <tss@iki.fi> (23c502c)

    lib-index: Assert-crashfix on some rare situations.
    mail_index_modseq_get_next_log_offset() might have returned e.g. (seq=4,
    offset=40) to point to the beginning of a next file. The view itself could
    still have been pointing to seq=3 end of file. Now calling
    mail_transaction_log_view_set() with these two positions (that are basically
    the same) should result in an empty view instead of assert crash.


M	src/lib-index/mail-transaction-log-view.c

2013-04-10 14:52:17 +0300 Timo Sirainen <tss@iki.fi> (e062a4b)

    lib-fs: Add data stack frames to most API calls, so the backends/callers
    don't need to.


M	src/lib-fs/fs-api.c

2013-04-10 14:51:37 +0300 Timo Sirainen <tss@iki.fi> (ccd968b)

    lib-http: Added data stack frame to avoid unnecessary data stack wasting.


M	src/lib-http/http-client-request.c

2013-04-10 14:17:41 +0300 Timo Sirainen <tss@iki.fi> (e1ac2af)

    lib-storage: Fixed mailbox list index crashes with shared mailboxes.


M	src/lib-storage/list/mailbox-list-index.c

2013-04-10 14:13:51 +0300 Timo Sirainen <tss@iki.fi> (311d3dd)

    lib-storage: Added mail_namespaces_added hook.


M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-hooks.h
M	src/lib-storage/mail-user.c

2013-04-10 14:00:47 +0300 Timo Sirainen <tss@iki.fi> (43487bb)

    lib-storage: Make sure index root dir is created when mailbox list index is
    created.


M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2013-04-10 13:40:57 +0300 Timo Sirainen <tss@iki.fi> (719123a)

    dsync: Don't fail the sync if attribute couldn't be set. It's probably a
    system configuration mismatch where some/all attributes don't work in one
    system but do on another. This might or might not be a problem, so it
    deserves an error message, but probably doesn't deserve failing entirely.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-04-10 00:14:09 +0300 Timo Sirainen <tss@iki.fi> (7ee45b0)

    lib-storage: Fixed crash with mailbox_list_index=yes and out-of-date index.


M	src/lib-storage/list/mailbox-list-index-status.c

2013-04-09 23:54:52 +0300 Timo Sirainen <tss@iki.fi> (8451cf6)

    istream-seekable: Fixed handling "buffer full" i_stream_read() result from
    underlying streams.


M	src/lib/istream-seekable.c

2013-04-09 14:17:56 +0300 Timo Sirainen <tss@iki.fi> (933e663)

    dsync: Fixed assert-crash caused by previous change


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-04-08 18:14:32 +0300 Timo Sirainen <tss@iki.fi> (ec0cc8f)

    dsync: Commit large transactions every 100 new messages. This way if the
    dsync crashes or transaction fails in the middle, the next run can finish
    faster. Also the rollbacking finishes faster.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-04-08 17:10:14 +0300 Timo Sirainen <tss@iki.fi> (b6d4436)

    dsync: If saving mails fail, stop trying to save more of them and flooding
    logs.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-04-08 15:33:23 +0300 Timo Sirainen <tss@iki.fi> (2e657dc)

    dsync: -U parameter never updated replicator's full_sync state.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h

2013-04-08 15:13:39 +0300 Timo Sirainen <tss@iki.fi> (aaebcf0)

    quota: dsync shouldn't trigger quota warnings They would probably just be
    duplicates that were already triggered by the other replica.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2013-04-08 14:53:31 +0300 Timo Sirainen <tss@iki.fi> (2d66fbf)

    dsync: If dsync fails due to lock timeout, give a better error message.


M	src/doveadm/dsync/dsync-brain.c

2013-04-08 14:49:07 +0300 Timo Sirainen <tss@iki.fi> (3ba55a6)

    lib-master: Ignore mountpoints with type cgroup.


M	src/lib-master/mountpoint-list.c

2013-04-08 14:43:09 +0300 Timo Sirainen <tss@iki.fi> (a1ac79f)

    doveadm replicator: Fixed showing over 1h old timestamps.


M	src/doveadm/doveadm-replicator.c

2013-04-08 14:38:30 +0300 Timo Sirainen <tss@iki.fi> (b5ffdf7)

    replicator: doveadm commands and user list export may have skipped some
    users. The users were exported from the queue, but they are temporarily
    removed from there while the user is being replicated. The users always
    exist in the hash table though.


M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-queue.h

2013-04-08 13:25:18 +0300 Timo Sirainen <tss@iki.fi> (a74bc46)

    checkpasword: Don't set AUTH_PASSWORD environment.


M	src/auth/db-checkpassword.c

2013-04-08 13:09:52 +0300 Timo Sirainen <tss@iki.fi> (1d80017)

    restrict_process_count(): Don't die if process count can't be changed.
    SELinux has hard limits and doesn't allow root to increase them. The admin
    should fix the error one way or another, but it's not a total failure just
    leaving it.


M	src/lib/restrict-process-size.c

2013-04-08 13:03:12 +0300 Timo Sirainen <tss@iki.fi> (9a50449)

    lib-http: If remote SSL cert is invalid, treat it as non-retryable error.


M	src/lib-http/http-client-connection.c

2013-04-08 13:02:27 +0300 Timo Sirainen <tss@iki.fi> (71b6084)

    lib-ssl-iostream: Added ssl_iostream_has_handshake_failed()


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl-private.h
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/iostream-ssl.h

2013-04-08 02:06:29 +0300 Timo Sirainen <tss@iki.fi> (b09cf31)

    Added signature for changeset ae4341d0e83b


M	.hgsigs

2013-04-08 02:06:25 +0300 Timo Sirainen <tss@iki.fi> (f6ce79f)

    Added tag 2.2.rc6 for changeset ae4341d0e83b


M	.hgtags

2013-04-08 02:06:25 +0300 Timo Sirainen <tss@iki.fi> (0d511a2)

    Released v2.2.rc6.


M	NEWS
M	configure.ac

2013-04-08 01:56:25 +0300 Timo Sirainen <tss@iki.fi> (c3e0f0a)

    dsync: Fixed crashes with dsync-server -U parameter


M	src/doveadm/dsync/doveadm-dsync.c

2013-04-08 00:18:56 +0300 Timo Sirainen <tss@iki.fi> (9ec1ecb)

    fs-posix: Set file's fd to -1 after closing it


M	src/lib-fs/fs-posix.c

2013-04-07 23:56:01 +0300 Timo Sirainen <tss@iki.fi> (bdff675)

    istream-qp-decoder: Fixed assert-crashes caused by recent forced-CRLF q-p
    change.


M	src/lib-mail/istream-qp-decoder.c

2013-04-07 23:26:52 +0300 Timo Sirainen <tss@iki.fi> (a78468f)

    lib-fs: posix fs backend now closes the fd after reads are finished. This
    allows keeping more fs_file structs open than there are available fds.


M	src/lib-fs/fs-posix.c

2013-04-07 23:17:37 +0300 Timo Sirainen <tss@iki.fi> (1a0ece3)

    istream API change: Added support for multiple destroy callbacks.


M	src/lib-http/http-client-connection.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-storage/index/index-mail.c
M	src/lib/iostream-private.h
M	src/lib/iostream-temp.c
M	src/lib/iostream.c
M	src/lib/istream.c
M	src/lib/istream.h
M	src/lib/json-parser.c

2013-04-07 22:55:42 +0300 Timo Sirainen <tss@iki.fi> (b60ba68)

    ostream-metawrap: ..and compile fix to previous commit.


M	src/lib-fs/ostream-metawrap.c

2013-04-07 22:54:48 +0300 Timo Sirainen <tss@iki.fi> (6759ba3)

    ostream-metawrap: Copy parent ostream's errors.


M	src/lib-fs/ostream-metawrap.c

2013-04-07 20:32:37 +0300 Timo Sirainen <tss@iki.fi> (eb376eb)

    example-config: Added ssl_client_ca_file


M	doc/example-config/conf.d/10-ssl.conf

2013-04-07 20:28:31 +0300 Timo Sirainen <tss@iki.fi> (56d1345)

    Added ssl_client_ca_file to specify the CA certs as a file instead of as a
    dir. This is required for Redhat-based systems where there isn't a CA
    directory like in Debian/Ubuntu.


M	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/dsync/doveadm-dsync.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h
M	src/lib-http/test-http-client.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-ssl.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-client.h
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2013-04-07 20:06:42 +0300 Timo Sirainen <tss@iki.fi> (713a54f)

    doveadm fs: Enable fs debug if doveadm -D parameter is given.


M	src/doveadm/doveadm-fs.c

2013-04-07 20:06:28 +0300 Timo Sirainen <tss@iki.fi> (1c31ad9)

    lib-fs: Added debug setting.


M	src/lib-fs/fs-api.h

2013-04-07 19:50:29 +0300 Timo Sirainen <tss@iki.fi> (51f750d)

    Moved lib-fs/fs-test to "doveadm fs" command.


M	.hgignore
M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-fs.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h
M	src/lib-fs/Makefile.am
D	src/lib-fs/fs-test.c

2013-04-07 18:50:31 +0300 Timo Sirainen <tss@iki.fi> (a0b32e0)

    lib-storage: mailbox list index didn't get its permissions from the root
    dir.


M	src/lib-storage/list/mailbox-list-index.c

2013-04-07 18:49:32 +0300 Timo Sirainen <tss@iki.fi> (db7ca28)

    lib-storage: dovecot.mailbox.log should have used file permissions, not dir
    Although this didn't actually make any difference since 0666 mask was used.


M	src/lib-storage/mailbox-list.c

2013-04-07 18:33:21 +0300 Timo Sirainen <tss@iki.fi> (3cca212)

    example-config: Added mailbox_list_index.


M	doc/example-config/conf.d/10-mail.conf

2013-04-07 18:01:52 +0300 Timo Sirainen <tss@iki.fi> (ee8d619)

    Added "doveadm replicator remove" command to remove users from replicator
    queue.


M	src/doveadm/doveadm-replicator.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-queue.h

2013-04-07 17:47:16 +0300 Timo Sirainen <tss@iki.fi> (51a237c)

    dsync: Fixed -U to send the notification on the remote server, not local.


M	src/doveadm/doveadm-settings.c
M	src/doveadm/dsync/doveadm-dsync.c

2013-04-07 16:36:00 +0300 Timo Sirainen <tss@iki.fi> (b593b79)

    lib-storage: If transaction commit fails, don't try to access garbage
    memory.


M	src/lib-storage/mail-storage.c

2013-04-07 15:36:35 +0300 Timo Sirainen <tss@iki.fi> (b8e6e31)

    dsync: Fixed talking to earlier dsync without mailbox attribute support.
    Most importantly it can now be used as an example how to add more features
    to dsync.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-private.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-ibc.h

2013-04-07 15:10:36 +0300 Timo Sirainen <tss@iki.fi> (e25c9a5)

    connection_disconnect(): Explicitly close input/output stream. This makes
    sure that if the ostream has some data pending and is still referenced, the
    io_remove() won't be called after fd is already closed.


M	src/lib/connection.c

2013-04-07 15:03:36 +0300 Timo Sirainen <tss@iki.fi> (9e10978)

    test-http-client: Allow invalid SSL certs in tests.


M	src/lib-http/test-http-client.c

2013-04-07 15:02:46 +0300 Timo Sirainen <tss@iki.fi> (9d0aee9)

    lib-http: ssl_crypto_device and ssl_allow_invalid_cert settings were
    ignored.


M	src/lib-http/http-client.c

2013-04-07 14:56:19 +0300 Timo Sirainen <tss@iki.fi> (bf48ae1)

    lib-http: Fixed receiving 100-continue reply after we already timed out
    waiting for it.


M	src/lib-http/http-client-connection.c

2013-04-07 14:46:45 +0300 Timo Sirainen <tss@iki.fi> (6b7e1df)

    replicator: Have remote dsync notify the replicator that the user was just
    synced. This way the replicators are roughly in sync.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/dsync-client.c

2013-04-06 21:01:41 +0300 Timo Sirainen <tss@iki.fi> (b1aa228)

    replicator: Don't create replicator-doveadm socket by default. Also removed
    the service replicator { process_min_avail=1 } requirement. This new way
    allows replicator to give a flag to dsync so it will try to notify the
    replicator process when user gets synced, which can be silently ignored even
    if it fails (replica server doesn't need to have replicator or even Dovecot
    itself running).


M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator.c

2013-04-06 20:44:38 +0300 Timo Sirainen <tss@iki.fi> (35e4905)

    lib-index: Added missing NUL separator to attribute-update transaction log
    record.


M	src/lib-index/mail-index-transaction-export.c

2013-04-05 21:57:11 +0300 Timo Sirainen <tss@iki.fi> (bd9e740)

    fs-metawrap: Fixed fs_copy_finish_async() wrapping


M	src/lib-fs/fs-metawrap.c

2013-04-05 21:03:20 +0300 Timo Sirainen <tss@iki.fi> (30a1278)

    Added signature for changeset 9446df6da5a8


M	.hgsigs

2013-04-05 21:03:16 +0300 Timo Sirainen <tss@iki.fi> (c367727)

    Added tag 2.2.rc5 for changeset 9446df6da5a8


M	.hgtags

2013-04-05 21:03:16 +0300 Timo Sirainen <tss@iki.fi> (ed93076)

    Released v2.2.rc5.


M	NEWS
M	configure.ac

2013-04-05 19:27:41 +0300 Timo Sirainen <tss@iki.fi> (14a9f01)

    example-config: Added ssl_client_ca_dir setting.


M	doc/example-config/conf.d/10-ssl.conf

2013-04-05 19:03:05 +0300 Timo Sirainen <tss@iki.fi> (636d0f4)

    lib-http: Fixed moving delayed request error timeouts between ioloops.


M	src/lib-http/http-client.c

2013-04-05 16:37:45 +0300 Timo Sirainen <tss@iki.fi> (2388124)

    lib-index: Add timestamps and value lengths to attribute change records in
    transaction log. The timestamps will be useful for dsync, and value lengths
    will be useful for metadata quota.


M	src/doveadm/doveadm-dump-log.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index.h
M	src/lib-storage/index/index-attribute.c
M	src/plugins/acl/acl-mailbox.c

2013-04-05 15:44:32 +0300 Timo Sirainen <tss@iki.fi> (fd81c8f)

    imap: Fixed RESETKEY command to not return failure when it actually
    succeeded.


M	src/imap/cmd-resetkey.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c

2013-04-05 15:17:30 +0300 Timo Sirainen <tss@iki.fi> (791fb70)

    Make static analyzer happier.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/lib-http/http-client-request.c
M	src/lib/test-json-parser.c

2013-04-05 14:05:54 +0300 Timo Sirainen <tss@iki.fi> (ba0d533)

    doveadm batch: Fixed handling subcommand parameters and errors.


M	src/doveadm/doveadm-mail-batch.c

2013-04-05 13:19:17 +0300 Timo Sirainen <tss@iki.fi> (2a80aa6)

    quota-status: Unknown recipients caused a crash.


M	src/plugins/quota/quota-status.c

2013-04-05 12:26:57 +0300 Timo Sirainen <tss@iki.fi> (dfc96c4)

    layout=index: Don't crash on mailbox_update() if the mailbox path couldn't
    be found.


M	src/lib-storage/list/mailbox-list-index-backend.c

2013-04-05 12:25:29 +0300 Timo Sirainen <tss@iki.fi> (23d0992)

    dsync: Fixes to location parameter handling.


M	src/doveadm/dsync/doveadm-dsync.c

2013-04-05 00:24:39 +0300 Timo Sirainen <tss@iki.fi> (d25c1c3)

    Added signature for changeset 92c88eca562d


M	.hgsigs

2013-04-05 00:24:36 +0300 Timo Sirainen <tss@iki.fi> (92170d8)

    Added tag 2.2.rc4 for changeset 92c88eca562d


M	.hgtags

2013-04-05 00:24:36 +0300 Timo Sirainen <tss@iki.fi> (89d992b)

    Released v2.2.rc4.


M	NEWS
M	TODO
M	configure.ac

2013-04-05 00:13:16 +0300 Timo Sirainen <tss@iki.fi> (47cf35b)

    Merged changes from v2.1 tree.


2013-04-05 00:08:40 +0300 Timo Sirainen <tss@iki.fi> (284aa55)

    Added signature for changeset 582108c190f8


M	.hgsigs

2013-04-05 00:08:37 +0300 Timo Sirainen <tss@iki.fi> (8be1363)

    Added tag 2.1.16 for changeset 582108c190f8


M	.hgtags

2013-04-05 00:08:36 +0300 Timo Sirainen <tss@iki.fi> (e062b1a)

    Released v2.1.16.


M	NEWS
M	configure.in

2013-04-04 23:58:47 +0300 Timo Sirainen <tss@iki.fi> (2169e77)

    quota-status: Removed duplicate "action=" text from overquota messages.


M	src/plugins/quota/quota-status.c

2013-04-04 23:56:55 +0300 Timo Sirainen <tss@iki.fi> (dc03cb9)

    quota-status: Added quota_status_(success|nouser|overquota) settings.


M	src/plugins/quota/quota-status.c

2013-04-04 23:35:27 +0300 Timo Sirainen <tss@iki.fi> (8761e72)

    replicator: If replicator is unconfigured, fail at startup.


M	src/replication/replicator/replicator.c

2013-04-04 23:35:08 +0300 Timo Sirainen <tss@iki.fi> (d4845c4)

    lib-master: Added master_service_get_process_min_avail()


M	src/lib-master/master-interface.h
M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/master/service-process.c

2013-04-04 23:03:47 +0300 Timo Sirainen <tss@iki.fi> (89e94dc)

    dsync: Mailbox name fixing didn't work when namespace prefixes were used.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c

2013-04-04 23:03:30 +0300 Timo Sirainen <tss@iki.fi> (607bca7)

    imapc: Don't assert-crash when ACL plugin tries to lookup "" mailbox.


M	src/lib-storage/index/imapc/imapc-list.c

2013-04-04 23:03:06 +0300 Timo Sirainen <tss@iki.fi> (6eeb3fd)

    imapc: Give an early error message if imapc_list_prefix ends with separator.


M	src/lib-storage/index/imapc/imapc-storage.c

2013-04-04 22:49:38 +0300 Timo Sirainen <tss@iki.fi> (7b64db3)

    lib-storage: Crashfixes for handling shared mailboxes for nonexistent users.


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-user.c

2013-04-04 22:09:02 +0300 Timo Sirainen <tss@iki.fi> (1a3254b)

    istream-chain: Final fixes to handling merged streams.


M	src/lib/istream-chain.c

2013-04-04 21:46:59 +0300 Timo Sirainen <tss@iki.fi> (76f0cc0)

    istream-chain: More fixes to handling merged streams.


M	src/lib/istream-chain.c

2013-04-04 21:23:49 +0300 Timo Sirainen <tss@iki.fi> (5d3e31c)

    istream-chain: Fixed memory leak.


M	src/lib/istream-chain.c

2013-04-04 21:18:59 +0300 Timo Sirainen <tss@iki.fi> (3aa0384)

    lib-imap-urlauth: Don't memcpy() data over itself.


M	src/lib-imap-urlauth/imap-urlauth-backend.c

2013-04-04 21:18:45 +0300 Timo Sirainen <tss@iki.fi> (7af4788)

    i_stream_read(): Added assert.


M	src/lib/istream.c

2013-04-04 21:18:28 +0300 Timo Sirainen <tss@iki.fi> (d730192)

    istream-chain: Fixed handling small streams that get merged into same
    buffer.


M	src/lib/istream-chain.c

2013-04-04 20:32:28 +0300 Timo Sirainen <tss@iki.fi> (5acace5)

    ldap auth: Don't access freed memory.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2013-04-04 20:05:37 +0300 Timo Sirainen <tss@iki.fi> (8b8227e)

    lib-storage: Add \Noinferiors flag to INBOX when such namespace config is
    used.


M	src/lib-storage/list/mailbox-list-iter.c

2013-04-04 19:45:28 +0300 Timo Sirainen <tss@iki.fi> (82315b2)

    auth: If passdb wasn't used, don't preserve its extra fields in auth
    request.


M	src/auth/auth-request.c

2013-04-04 19:18:22 +0300 Timo Sirainen <tss@iki.fi> (e8ee955)

    lib-mail: quoted_printable_decode*() now returns all newlines as CRLF. This
    is required by BINARY fetches, since the original data had CRLFs.


M	src/lib-mail/quoted-printable.c
M	src/lib-mail/quoted-printable.h
M	src/lib-mail/test-quoted-printable.c

2013-04-04 19:03:26 +0300 Timo Sirainen <tss@iki.fi> (d549ec5)

    lib-storage: Fixed searching with multiple parameters and prefetching.


M	src/lib-storage/mail-search.c

2013-04-04 18:18:50 +0300 Timo Sirainen <tss@iki.fi> (3553848)

    imapc, pop3c: Don't hide SSL handshake errors.


M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/pop3c/pop3c-client.c

2013-04-04 18:10:04 +0300 Timo Sirainen <tss@iki.fi> (b4d850a)

    lib-ssl-iostream: Simplified certificate validation. Also give better error
    messages.


M	src/doveadm/server-connection.c
M	src/lib-http/http-client-connection.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/iostream-ssl.h
M	src/lib-storage/index/pop3c/pop3c-client.c

2013-04-04 17:40:30 +0300 Timo Sirainen <tss@iki.fi> (3da95d0)

    lib-http: Crashfix for previous change.


M	src/lib-http/http-client-peer.c

2013-04-04 17:39:17 +0300 Timo Sirainen <tss@iki.fi> (3b4bd18)

    lib-ssl-iostream: Added support for TLS SNI, which caused some API changes.


M	src/doveadm/server-connection.c
M	src/lib-http/http-client-connection.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-master/master-service-ssl.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl-private.h
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/iostream-ssl.h
M	src/lib-storage/index/pop3c/pop3c-client.c

2013-04-04 17:34:23 +0300 Timo Sirainen <tss@iki.fi> (e1f9521)

    lib-http: Prepare for TLS SNI support.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-04-04 16:53:08 +0300 Timo Sirainen <tss@iki.fi> (d47b9f1)

    lib-ssl: If debug=TRUE, set also SSL verbose=TRUE


M	src/lib-http/http-client.c

2013-04-04 15:40:08 +0300 Timo Sirainen <tss@iki.fi> (9709107)

    lib-ssl-iostream: If handshake callback fails, close the iostreams
    immediately. This way the callback itself doesn't have to do it. Also fixes
    errors caused by it, since they didn't close the ostream.


M	src/doveadm/server-connection.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-storage/index/pop3c/pop3c-client.c

2013-04-04 15:21:52 +0300 Timo Sirainen <tss@iki.fi> (52ccd52)

    lib-http: Removed last traces of http_client_connection_error()


M	src/lib-http/http-client-connection.c

2013-04-04 15:21:00 +0300 Timo Sirainen <tss@iki.fi> (ac645fe)

    lib-ssl-iostream: ssl_iostream_set_handshake_callback() API changed. The
    callback can now return the error message to caller instead of having to log
    it itself.


M	src/doveadm/server-connection.c
M	src/lib-http/http-client-connection.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl-private.h
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/iostream-ssl.h
M	src/lib-storage/index/pop3c/pop3c-client.c

2013-04-04 14:58:00 +0300 Timo Sirainen <tss@iki.fi> (2a889fc)

    lib-http: Pass connect failures all the way to request callback's error
    string.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-04-04 14:55:03 +0300 Timo Sirainen <tss@iki.fi> (f5386ad)

    lib-http: Reorder http_client_connection deinit code just to be safe. I'm
    not sure if this fixes any actual bugs, but just in case request callbacks
    cause the connection to be accessed/modified in some way abort the requests
    before doing anything else.


M	src/lib-http/http-client-connection.c

2013-04-04 14:51:20 +0300 Timo Sirainen <tss@iki.fi> (9c8d244)

    lib-http: Fixed double-free on delayed connect() failures caused by recent
    change.


M	src/lib-http/http-client-connection.c

2013-04-04 14:41:06 +0300 Timo Sirainen <tss@iki.fi> (32b6d86)

    lib-http: If SSL init/handshake fails for connection, destroy it.


M	src/lib-http/http-client-connection.c

2013-04-04 14:30:41 +0300 Timo Sirainen <tss@iki.fi> (436c529)

    lib-http: If connect() fails, destroy the http_client_connection. Fixes
    hanging requests when a peer has multiple connections.


M	src/lib-http/http-client-connection.c

2013-04-04 14:18:38 +0300 Timo Sirainen <tss@iki.fi> (a321ac5)

    lib-http: Simplify error handling by delaying connect() failures.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-04-04 14:11:10 +0300 Timo Sirainen <tss@iki.fi> (6bc9fb4)

    lib-http: If http_client_request_submit() fails, don't immediately call the
    callback. This simplifies the caller's error handling since there is now
    only one error code path instead of two.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2013-04-04 13:21:42 +0300 Timo Sirainen <tss@iki.fi> (692ab2d)

    lib-http: Removed unused code.


M	src/lib-http/http-client-peer.c

2013-04-04 13:20:59 +0300 Timo Sirainen <tss@iki.fi> (ba1c847)

    lib-ssl-iostream: API changes to return error strings if init() functions
    fail. This also fixed a couple of broken error handlings.


M	src/doveadm/client-connection.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/server-connection.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service-ssl.h
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl-private.h
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/iostream-ssl.h
M	src/lib-storage/index/pop3c/pop3c-client.c

2013-04-04 13:12:26 +0300 Timo Sirainen <tss@iki.fi> (111a251)

    lib-ssl-iostream: Removed unused iostream-ssl-none.c


D	src/lib-ssl-iostream/iostream-ssl-none.c

2013-04-04 12:48:52 +0300 Timo Sirainen <tss@iki.fi> (415e16c)

    lib-http: Each peer doesn't need a separate ssl context, enough to have one
    for http_client. Also removed #ifdefs for building with SSL support.
    lib-ssl-iostream nowadays dynamically loads the SSL library when needed, and
    also handles failures if Dovecot was built without SSL support.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c

2013-04-04 12:21:04 +0300 Timo Sirainen <tss@iki.fi> (18d2775)

    lib-http: Pass DNS lookup error message to caller instead of logging it.


M	src/lib-http/http-client-host.c

2013-04-03 11:36:56 +0300 Timo Sirainen <tss@iki.fi> (29658a7)

    dovecot.m4: Reverted last change with added comments.


M	dovecot.m4

2013-04-02 23:32:10 +0300 Timo Sirainen <tss@iki.fi> (f54e601)

    lib-master: If fifo isn't accepted, don't double-destroy the connection.


M	src/lib-master/master-service.c

2013-04-02 23:29:43 +0300 Timo Sirainen <tss@iki.fi> (30d917b)

    lib-http: Added ssl_ca setting to specify the CA certificate directly.


M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h

2013-04-02 23:11:30 +0300 Timo Sirainen <tss@iki.fi> (805c767)

    dovecot.m4: Removed --without-dovecot-install-dirs from distcheck configure
    flags. Perhaps the whole feature should be designed some other way. Some
    plugins require the dovecot_* variables to point to their real paths.


M	dovecot.m4

2013-04-02 11:52:36 +0300 Timo Sirainen <tss@iki.fi> (f8b73b7)

    quota-status: If size parameter is given, use it to check quota.


M	src/plugins/quota/quota-status.c

2013-04-02 11:32:24 +0300 Timo Sirainen <tss@iki.fi> (94100e1)

    lib-index: Backported MAIL_TRANSACTION_ATTRIBUTE_UPDATE from v2.2


M	src/doveadm/doveadm-dump-log.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-transaction-log.h

2013-04-02 11:22:52 +0300 Timo Sirainen <tss@iki.fi> (49fc09f)

    auth: Fixed also DOVECOT-TOKEN (=URLAUTH) and NTLM/GSS-SPNEGO (via winbind)
    to work.


M	src/auth/mech-dovecot-token.c
M	src/auth/mech-winbind.c

2013-04-02 11:18:45 +0300 Timo Sirainen <tss@iki.fi> (0c7ccf0)

    auth: Fixed ANONYMOUS mechanism to work again.


M	src/auth/mech-anonymous.c

2013-03-31 19:02:32 +0300 Timo Sirainen <tss@iki.fi> (b8a4aab)

    quota: Added more debug logs about quota_grace


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2013-03-31 18:43:13 +0300 Timo Sirainen <tss@iki.fi> (789cb16)

    dsync: Fixed syncing without GUIDs.


M	src/doveadm/dsync/dsync-mailbox-export.c

2013-03-31 18:35:13 +0300 Timo Sirainen <tss@iki.fi> (1e06f30)

    dsync: Don't crash if second user initialization fails.


M	src/doveadm/dsync/doveadm-dsync.c

2013-03-31 18:24:54 +0300 Timo Sirainen <tss@iki.fi> (9e99239)

    dsync: If remote doesn't send some mails, don't exit with code 0.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-03-31 18:15:00 +0300 Timo Sirainen <tss@iki.fi> (4307e3a)

    auth: nodelay and nopassword fields weren't handled correctly.


M	src/auth/auth-request.c

2013-03-31 18:03:50 +0300 Timo Sirainen <tss@iki.fi> (1fa2054)

    auth: Implemented userdb_import and userdb_userdb_import fields.


M	src/auth/auth-request.c

2013-03-31 17:47:52 +0300 Timo Sirainen <tss@iki.fi> (f96f042)

    auth: Fixed passdb_import not to crash when =value isn't given.


M	src/auth/auth-request.c

2013-03-31 17:44:34 +0300 Timo Sirainen <tss@iki.fi> (0fbf1f8)

    auth: Renamed userdb_userdb_import to passdb_import, since that's what it
    really is.


M	src/auth/auth-request.c

2013-03-31 17:40:12 +0300 Timo Sirainen <tss@iki.fi> (6ca88ca)

    auth: Allow using userdb_userdb_import in passdb query to set multiple
    userdb fields.


M	src/auth/auth-request.c

2013-03-31 17:25:10 +0300 Timo Sirainen <tss@iki.fi> (44320b3)

    virtual plugin: Fixed saving/copying messages to virtual mailbox.


M	src/lib-storage/mail-storage.c
M	src/plugins/virtual/virtual-save.c

2013-03-31 17:24:35 +0300 Timo Sirainen <tss@iki.fi> (75b6f32)

    lib-storage: mailbox_get_status() no longer forces mailbox to be synced.
    This fixes copying messages with keywords to a virtual mailbox, where
    syncing happened too late and caused assert-crash (status was only used to
    lookup list of keywords).

    The crash could have been solved another way too, but it's probably better 
    if automatic syncing isn't always performed. doveadm index -n parameter 
    handling also relies on this behavior.

M	src/lib-storage/index/index-status.c
M	src/lib-storage/mail-storage.h

2013-03-31 16:46:45 +0300 Timo Sirainen <tss@iki.fi> (9bc71fc)

    lib-storage: Don't reset mail_save_context.copying|moving|copying_via_save
    too early.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage.c

2013-03-31 16:46:11 +0300 Timo Sirainen <tss@iki.fi> (e908168)

    lib-storage: Create a default namespace for auto-created shared mail_users.
    Some code nowadays requires user to have prefix="" namespace.


M	src/lib-storage/index/shared/shared-storage.c

2013-03-31 11:23:42 +0300 Timo Sirainen <tss@iki.fi> (4ab5a44)

    lib-master: Ignore mountpoints under /tmp and /var/tmp by default.


M	src/lib-master/mountpoint-list.c

2013-03-28 11:37:07 +0200 Timo Sirainen <tss@iki.fi> (ad0fe43)

    maildir++ quota: Fixed relative quota_grace when taking limit from
    maildirsize file


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2013-03-27 21:10:35 +0200 Timo Sirainen <tss@iki.fi> (0fa25bd)

    maildir: If maildir_broken_filename_sizes=yes, don't try to fix sizes in
    filenames.


M	src/lib-storage/index/maildir/maildir-mail.c

2013-03-27 14:45:14 +0200 Timo Sirainen <tss@iki.fi> (c4e3c99)

    lib-fs: Always keep the error in the parentmost fs. This fixes problems with
    getting the correct error message when wrapper filesystems are used.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-metawrap.c

2013-03-27 12:53:35 +0200 Timo Sirainen <tss@iki.fi> (9181786)

    dsync: Use i_fatal() for invalid parameters, like the rest of doveadm
    commands. Probably the parse_arg() API should be changed to allow reporting
    errors.


M	src/doveadm/dsync/doveadm-dsync.c

2013-03-27 12:51:02 +0200 Timo Sirainen <tss@iki.fi> (cf50828)

    lib-index: Removed obsolete 16bit size check asserts from
    mail_index_update_header_ext()


M	src/lib-index/mail-index-transaction-update.c

2013-03-27 09:16:56 +0200 Timo Sirainen <tss@iki.fi> (401bacb)

    dsync: Don't access uninitialized variable


M	src/doveadm/dsync/doveadm-dsync.c

2013-03-27 09:16:42 +0200 Timo Sirainen <tss@iki.fi> (faccb8e)

    Compiler warning fix


M	src/replication/replication-common.h

2013-03-26 22:41:43 +0200 Timo Sirainen <tss@iki.fi> (c161661)

    lib-storage: Added assert.


M	src/lib-storage/mail.c

2013-03-26 22:41:32 +0200 Timo Sirainen <tss@iki.fi> (ecdf46d)

    dsync: Allow doveadm plugins to override local_location at run().


M	src/doveadm/dsync/doveadm-dsync.c

2013-03-26 22:40:57 +0200 Timo Sirainen <tss@iki.fi> (7ea46e7)

    dsync: Allow syncing same mail root dirs if indexes are different. Fixes
    dsyncing with storages that have no mail root dirs.


M	src/doveadm/dsync/doveadm-dsync.c

2013-03-26 22:39:38 +0200 Timo Sirainen <tss@iki.fi> (a189358)

    dsync: Crashfix when importing from storage without GUIDs.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-03-26 14:38:30 +0200 Timo Sirainen <tss@iki.fi> (8d8dc14)

    ldap: Another fix to sub-dn-lookup.


M	src/auth/db-ldap.c

2013-03-26 10:36:49 +0200 Timo Sirainen <tss@iki.fi> (b6df44e)

    ldap: Crashfix


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2013-03-26 10:35:38 +0200 Timo Sirainen <tss@iki.fi> (872521e)

    ldap: Compiling fix to previous change


M	src/auth/db-ldap.c

2013-03-26 10:25:50 +0200 Timo Sirainen <tss@iki.fi> (f30ab1a)

    ldap: Improved sub-dn-lookup error message.


M	src/auth/db-ldap.c

2013-03-25 18:10:16 +0200 Timo Sirainen <tss@iki.fi> (f2f40b6)

    ldap: Various crashfixes


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/userdb-ldap.c

2013-03-25 17:56:53 +0200 Timo Sirainen <tss@iki.fi> (068afb0)

    ldap: Don't crash if attributes have no @subrequests.


M	src/auth/db-ldap.c

2013-03-25 17:02:15 +0200 Timo Sirainen <tss@iki.fi> (9f99b5c)

    doveadm sync/backup: Added -g <guid> to sync only the specified mailbox (by
    GUID) Similar to -m <mailbox name>.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2013-03-25 16:19:54 +0200 Timo Sirainen <tss@iki.fi> (5685e60)

    doveadm: Added "batch" command to run multiple mail commands. This only
    makes sense when the commands are run with -A or -u <usermask>, so that the
    commands are run for the same user before moving onto the next user.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-mail-batch.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2013-03-25 14:18:20 +0200 Timo Sirainen <tss@iki.fi> (861f4c6)

    dsync: Fixed syncing attribute streams.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-03-25 13:55:41 +0200 Timo Sirainen <tss@iki.fi> (b32b237)

    imap: Fixed more URL escaping in URLFETCH replies.


M	src/imap/cmd-urlfetch.c

2013-03-24 19:04:15 +0200 Timo Sirainen <tss@iki.fi> (96d12aa)

    mysql/pgsql: Don't bother logging about having connected to the database.
    There's probably no good reason to have them? Errors are of course still
    logged.


M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c

2013-03-24 18:58:20 +0200 Timo Sirainen <tss@iki.fi> (01fde39)

    doveadm-server: Don't continue handling commands if input stream is already
    closed. This fixes trying to handle extra input from previous dsync command.


M	src/doveadm/client-connection.c

2013-03-24 18:48:28 +0200 Timo Sirainen <tss@iki.fi> (e98e8ba)

    imap: GENURLAUTH and URLFETCH didn't escape URL parameters when needed.


M	src/imap/cmd-genurlauth.c
M	src/imap/cmd-urlfetch.c

2013-03-24 18:14:11 +0200 Timo Sirainen <tss@iki.fi> (5ca40db)

    doveadm replicator status: Without <usermask> parameter show overview
    status.


M	src/doveadm/doveadm-replicator.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-queue.h

2013-03-24 18:13:53 +0200 Timo Sirainen <tss@iki.fi> (0fa3852)

    doveadm: Table formatter now hides the titles if all of them are marked
    hidden.


M	src/doveadm/doveadm-print-table.c

2013-03-24 17:48:17 +0200 Timo Sirainen <tss@iki.fi> (4bed69a)

    doveadm: Added "replicator replicate" command to force replication of
    user(s).


M	src/doveadm/doveadm-replicator.c
M	src/replication/replicator/doveadm-connection.c

2013-03-24 17:23:33 +0200 Timo Sirainen <tss@iki.fi> (34d73a1)

    replication_full_sync_interval default changed from 12h -> 24h This allows
    doing full resyncs only at nights.


M	src/replication/replicator/replicator-settings.c

2013-03-24 17:21:49 +0200 Timo Sirainen <tss@iki.fi> (f3e77a0)

    replicator: If sync fails, retry it in 5 minutes.


M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-queue.h
M	src/replication/replicator/replicator.c

2013-03-24 17:04:22 +0200 Timo Sirainen <tss@iki.fi> (a6355f0)

    replicator: Replicator queue export/import at exit/startup wasn't really
    working.


M	src/replication/replicator/replicator-queue.c

2013-03-24 16:53:32 +0200 Timo Sirainen <tss@iki.fi> (f723965)

    doveadm replicator status: Show sync time as "-" for "never".


M	src/doveadm/doveadm-replicator.c

2013-03-24 16:52:39 +0200 Timo Sirainen <tss@iki.fi> (ce0aa35)

    doveadm replicator status: Fixed user mask to work.


M	src/doveadm/doveadm-replicator.c
M	src/replication/replicator/doveadm-connection.c

2013-03-24 16:48:53 +0200 Timo Sirainen <tss@iki.fi> (d069559)

    doveadm: Added "replicator status" command.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-replicator.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h

2013-03-24 16:48:29 +0200 Timo Sirainen <tss@iki.fi> (99a9e14)

    replicator: Added doveadm socket for communicating with "doveadm
    replicator".


M	src/replication/replication-common.h
M	src/replication/replicator/Makefile.am
A	src/replication/replicator/doveadm-connection.c
A	src/replication/replicator/doveadm-connection.h
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-queue.h
M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator.c

2013-03-24 16:04:37 +0200 Timo Sirainen <tss@iki.fi> (7683701)

    lib-storage: Fixed listing subscribed namespace prefixes.


M	src/lib-storage/list/mailbox-list-iter.c

2013-03-24 15:33:36 +0200 Timo Sirainen <tss@iki.fi> (a184ef4)

    lib-storage: If INBOX isn't subscribed, don't return it in subscriptions
    list.


M	src/lib-storage/list/mailbox-list-iter.c

2013-03-22 19:45:52 +0200 Timo Sirainen <tss@iki.fi> (e36574d)

    lib-storage: Compiling fix


M	src/lib-storage/mailbox-list.c

2013-03-22 17:43:52 +0200 Timo Sirainen <tss@iki.fi> (74ebeb3)

    lib-storage: Fixed crash if shared namespace had subscriptions=yes


M	src/lib-storage/index/shared/shared-list.c

2013-03-22 17:30:36 +0200 Timo Sirainen <tss@iki.fi> (ae2b61a)

    lib-storage: Added mailbox_list_get_settings()


M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2013-03-22 12:48:21 +0200 Timo Sirainen <tss@iki.fi> (44a529c)

    dsync: Use fcntl() locking instead of flock().


M	src/doveadm/dsync/dsync-brain.c

2013-03-22 11:17:14 +0200 Timo Sirainen <tss@iki.fi> (5e32f3d)

    Compiler warning fix


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-03-22 10:29:12 +0200 Timo Sirainen <tss@iki.fi> (2721a77)

    acl: Don't crash when rebuilding acl dict for "unusable" namespaces.


M	src/plugins/acl/acl-lookup-dict.c

2013-03-21 23:51:16 +0200 Timo Sirainen <tss@iki.fi> (f0d9376)

    login proxy: Set a default 30s timeout.


M	src/login-common/client-common-auth.c

2013-03-21 23:50:53 +0200 Timo Sirainen <tss@iki.fi> (fff19af)

    login proxy: Stop proxy_timeout only after successfully logged in (not after
    connected).


M	src/login-common/login-proxy.c

2013-03-21 14:48:33 +0200 Timo Sirainen <tss@iki.fi> (f48fdb5)

    dsync: -m '' parameter now syncs mailbox list, but no actual mails.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h

2013-03-20 22:06:06 +0200 Timo Sirainen <tss@iki.fi> (adc4038)

    Added signature for changeset 11bd79bf4866


M	.hgsigs

2013-03-20 22:05:53 +0200 Timo Sirainen <tss@iki.fi> (33158cf)

    Added tag 2.2.rc3 for changeset 11bd79bf4866


M	.hgtags

2013-03-20 22:05:53 +0200 Timo Sirainen <tss@iki.fi> (e33ff07)

    Released v2.2.rc3.


M	NEWS
M	configure.ac

2013-03-20 21:44:48 +0200 Timo Sirainen <tss@iki.fi> (afaf4f2)

    Merged changes from v2.1 tree.


2013-03-20 21:13:20 +0200 Timo Sirainen <tss@iki.fi> (e6debde)

    doveadm pw -t: Don't ask for password if -p is also specified. Patch by Paul
    Wallingford.


M	src/doveadm/doveadm-pw.c

2013-03-20 21:04:29 +0200 Timo Sirainen <tss@iki.fi> (e3677df)

    mbox: Moved .subscriptions back to control_dir/ root instead of
    control_dir/.imap/


M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/list/mailbox-list-subscriptions.c

2013-03-20 20:56:58 +0200 Timo Sirainen <tss@iki.fi> (177295e)

    layout=fs: Fixed crash with mbox when control dir was enabled.


M	src/lib-storage/list/mailbox-list-fs.c

2013-03-20 20:47:46 +0200 Timo Sirainen <tss@iki.fi> (3d651cf)

    dsync: Fixed retrying a search when GUIDs aren't available.


M	src/doveadm/dsync/dsync-mailbox-export.c

2013-03-20 20:47:14 +0200 Timo Sirainen <tss@iki.fi> (2fdcbdc)

    dsync: Avoid a creating a lot of searches for each synced mailbox.


M	src/doveadm/dsync/dsync-brain-mails.c

2013-03-20 20:24:31 +0200 Timo Sirainen <tss@iki.fi> (d8bdf55)

    dsync: Don't crash when requested mail doesn't have a GUID.


M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c

2013-03-20 20:17:15 +0200 Timo Sirainen <tss@iki.fi> (420809e)

    layout=fs: Fixed assert-crash when mail root doesn't exist (pop3c).


M	src/lib-storage/list/mailbox-list-fs-iter.c

2013-03-20 19:18:01 +0200 Timo Sirainen <tss@iki.fi> (d6dc20a)

    imap: Don't crash with invalid FETCH BODY[sections]


M	src/imap/imap-fetch-body.c
M	src/lib-imap-storage/imap-msgpart.c

2013-03-20 18:52:51 +0200 Timo Sirainen <tss@iki.fi> (b46eb14)

    example-config: Removed a warning about mail_attachment_dir not being
    tested.


M	doc/example-config/conf.d/10-mail.conf

2013-03-20 18:46:10 +0200 Timo Sirainen <tss@iki.fi> (db0fb9e)

    fts: Fixed crash when searching virtual mailboxes and fts backend without
    lookup_multi(). Patch by Mike Abbott / Apple


M	src/plugins/fts/fts-api.c

2013-03-20 18:24:21 +0200 Timo Sirainen <tss@iki.fi> (de3328e)

    lib-lda: Send QUIT after DATA replies have been received.


M	src/lib-lda/lmtp-client.c

2013-03-20 18:09:46 +0200 Timo Sirainen <tss@iki.fi> (8d9540a)

    acl: Put ACL files to control dir if storage doesn't have a mail directory.


M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c

2013-03-20 17:59:32 +0200 Timo Sirainen <tss@iki.fi> (d71d05c)

    layout=index: Fixed mailbox_exists()


M	src/lib-storage/list/mailbox-list-index-backend.c

2013-03-20 17:54:52 +0200 Timo Sirainen <tss@iki.fi> (005eb7a)

    imap: Fixed RESETKEY assert-crashing


M	src/imap/cmd-resetkey.c

2013-03-20 17:44:07 +0200 Timo Sirainen <tss@iki.fi> (bdf6608)

    layout=index: Don't return a path for \Noselect mailboxes.


M	src/lib-storage/list/mailbox-list-index-backend.c

2013-03-20 17:43:32 +0200 Timo Sirainen <tss@iki.fi> (06faee1)

    lib-storage: mailbox_rename() shouldn't require source mailbox to exist.
    \Noselect mailboxes may not exist. The nonexistence will be noticed
    eventually in the backend code.


M	src/lib-storage/mail-storage.c

2013-03-20 17:10:47 +0200 Timo Sirainen <tss@iki.fi> (3010259)

    lib-fs: Fixed fs_default_copy() to work with async writes.


M	src/lib-fs/fs-api.c

2013-03-20 12:04:39 +0200 Timo Sirainen <tss@iki.fi> (cc116e6)

    replicator: Renamed doveadm-connection to dsync-client.


M	src/replication/replicator/Makefile.am
D	src/replication/replicator/doveadm-connection.c
D	src/replication/replicator/doveadm-connection.h
A	src/replication/replicator/dsync-client.c
A	src/replication/replicator/dsync-client.h
M	src/replication/replicator/replicator-brain.c

2013-03-20 09:59:27 +0200 Timo Sirainen <tss@iki.fi> (ab3c52c)

    dsync: Fixed attribute value comparisons.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-03-19 23:31:41 +0200 Timo Sirainen <tss@iki.fi> (3b1f449)

    Compiler warning fix.


M	src/doveadm/dsync/dsync-mailbox.c

2013-03-19 19:08:17 +0200 Timo Sirainen <tss@iki.fi> (e563b8a)

    lib-storage: Added a way to create plugins that forcibly hook into mail
    storage. Mostly meant for doveadm_sieve plugin.


M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-hooks.h
M	src/lib-storage/mail-storage-private.h

2013-03-19 19:05:27 +0200 Timo Sirainen <tss@iki.fi> (41e51b9)

    lib-storage: Mailbox attributes can now be accessed via istreams. The idea
    is to use istreams for larger values.


M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox.c
M	src/doveadm/dsync/dsync-mailbox.h
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/plugins/acl/acl-attributes.c

2013-03-19 18:52:39 +0200 Timo Sirainen <tss@iki.fi> (d995d22)

    dsync: Fixed sending mailbox attributes with stream ibc.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-03-19 18:50:55 +0200 Timo Sirainen <tss@iki.fi> (4292c8c)

    dsync: Mail requests were lost when attributes were being synced.


M	src/doveadm/dsync/dsync-brain-mails.c

2013-03-19 18:48:47 +0200 Timo Sirainen <tss@iki.fi> (c2fa1f8)

    acl: Don't iterate ACL attributes if prefix has no chance of matching them.


M	src/plugins/acl/acl-attributes.c

2013-03-19 14:00:49 +0200 Timo Sirainen <tss@iki.fi> (ed96771)

    acl: Preserve dovecot-acl file's mtime when dsyncing.


M	src/plugins/acl/acl-api.h
M	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-backend-vfile.c

2013-03-19 14:00:21 +0200 Timo Sirainen <tss@iki.fi> (2d567b0)

    acl: Don't unnecessarily rewrite dovecot-acl file when re-adding the same
    ACL.


M	src/plugins/acl/acl-backend-vfile.c

2013-03-19 13:59:22 +0200 Timo Sirainen <tss@iki.fi> (9307e4f)

    dsync: Set last_change timestamp for unset attributes.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-03-19 13:59:02 +0200 Timo Sirainen <tss@iki.fi> (d261a38)

    lib-storage: Allow mailbox_attribute_set() to also unset values. This allows
    giving the last_change timestamp also when unsetting.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2013-03-19 13:34:12 +0200 Timo Sirainen <tss@iki.fi> (6cc4cce)

    lib-storage: mailbox_attribute_set() now uses struct mail_attribute_value.
    This allows settig the last_change value, as well as using streams and
    setting other flags in future.


M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-storage.h

2013-03-19 12:39:43 +0200 Timo Sirainen <tss@iki.fi> (32a1beb)

    net_is_in_network(): Don't assert-crash with invalid IP. It's probably
    better to do the check here instead of remembering for caller to do the
    check.


M	src/lib/net.c
M	src/lib/net.h

2013-03-19 12:18:25 +0200 Timo Sirainen <tss@iki.fi> (2d6c6f1)

    test-json-parser: Fixed failing test with some non-gcc/clang compilers.


M	src/lib/test-json-parser.c

2013-03-19 12:13:33 +0200 Timo Sirainen <tss@iki.fi> (6264b5e)

    ldap auth: Removed base() wrapper around @dn values. The idea was to provide
    extensibility, but it can better be done with LDAP URLs.


M	src/auth/db-ldap.c

2013-03-19 11:52:15 +0200 Timo Sirainen <tss@iki.fi> (b433ae5)

    lib-fs: fs-test now sets the ssl_client_set.ca_dir


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-test.c

2013-03-19 11:42:51 +0200 Timo Sirainen <tss@iki.fi> (16cb5d6)

    Moved ssl_client_ca_dir and ssl_crypto_device to mail_storage_settings.
    Probably could also be moved to master_service_settings, but that makes
    accessing them a bit more tricky with the current code.


M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/dsync/doveadm-dsync.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-settings.h
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2013-03-19 11:39:07 +0200 Timo Sirainen <tss@iki.fi> (c4a629c)

    lib-fs: Allow passing through SSL client settings via struct fs_settings.


M	src/lib-fs/fs-api.h

2013-03-18 21:31:34 +0200 Timo Sirainen <tss@iki.fi> (626a206)

    ldap auth: "!ldapField" now requests the given field, but doesn't return it
    directly. It's only useful for listing fields that %{ldap_ptr} can
    potentially access.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2013-03-18 21:23:54 +0200 Timo Sirainen <tss@iki.fi> (a9b698e)

    ldap auth: Added %{ldap_ptr:realAttr} to get the value from the realAttr.
    For example:

    password_attrs = \
     =proxy=y, \
     =host=%{ldap_ptr:activeHost}, \
     primaryHost, secondaryHost

    Where activeHost's value is either "primaryHost" or "secondaryHost".

M	src/auth/db-ldap.c

2013-03-18 21:20:54 +0200 Timo Sirainen <tss@iki.fi> (c2bae70)

    ldap auth: Fix to previous change.


M	src/auth/db-ldap.c

2013-03-18 20:51:33 +0200 Timo Sirainen <tss@iki.fi> (3fb1531)

    ldap auth: Support field values containing DNs to other LDAP records and
    getting them. For example:

    user_attrs = \
     =user=%{ldap:uid}, \
     @mail=base(%{ldap:mailDN}), \
     =uid=%{ldap:uidNumber@mail}, \
     =gid=%{ldap:gidNumber@mail}, \
     =home=%{ldap:rootPath@mail}/%d/%n

    This first does the regular lookup, and then does another lookup using 
    mailDN's value as the new lookup's base. The other lookup's filter is 
    currently hardcoded to "no filter".

M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2013-03-18 16:51:58 +0200 Timo Sirainen <tss@iki.fi> (068ac10)

    auth: Return "nologin" and "proxy" fields to login process without "=value".


M	src/auth/auth-fields.c
M	src/auth/auth-fields.h
M	src/auth/auth-request-handler.c

2013-03-18 15:59:40 +0200 Timo Sirainen <tss@iki.fi> (31a9637)

    Compiling fix for Solaris


M	src/lib-master/master-service.h

2013-03-18 15:47:14 +0200 Timo Sirainen <tss@iki.fi> (512962b)

    istream-qp-decoder: Fixed assert-crashing with buffer size allocations. The
    original implementation was copy&pasted from istream-base64-decoder without
    enough thinking..


M	src/lib-mail/istream-qp-decoder.c

2013-03-18 15:46:16 +0200 Timo Sirainen <tss@iki.fi> (d5ecc28)

    quoted-printable decoding: Don't add CR if it wasn't in input. This
    guarantees that the decoded Q-P won't be larger than its input.


M	src/lib-mail/quoted-printable.c
M	src/lib-mail/test-quoted-printable.c

2013-03-15 21:58:51 +0100 Timo Sirainen <tss@iki.fi> (9c6a09a)

    lib-master: include unistd.h for master_getopt() users.


M	src/lib-master/master-service.h

2013-03-15 21:55:40 +0100 Timo Sirainen <tss@iki.fi> (90814c0)

    Compile fix on non-gcc/clang.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2013-03-15 20:49:39 +0100 Timo Sirainen <tss@iki.fi> (9a5980c)

    Compile fix on non-gcc/clang.


M	src/lib/istream-chain.c

2013-03-14 15:41:39 +0200 Timo Sirainen <tss@iki.fi> (eb4d4f5)

    acl: Added ACL checks for attributes. Added ACL <-> mailbox attribute
    mapping. The ACL checks will be useful once IMAP METADATA extension is
    finished. The mapping is used by dsync to sync ACLs via generic attribute
    syncing.


M	src/plugins/acl/Makefile.am
M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-api.h
A	src/plugins/acl/acl-attributes.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.h
M	src/plugins/acl/acl-storage.h
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/imap-acl/imap-acl-plugin.c

2013-03-14 15:41:09 +0200 Timo Sirainen <tss@iki.fi> (55d33f8)

    dsync: Added support for syncing mailbox attributes.


M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-private.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h
A	src/doveadm/dsync/dsync-mailbox.c
M	src/doveadm/dsync/dsync-mailbox.h
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/dsync-transaction-log-scan.h

2013-03-14 15:32:14 +0200 Timo Sirainen <tss@iki.fi> (50c6177)

    lib-storage: Changed mailbox_attribute_get/set() APIs to have a transaction
    and update index. The _get() doesn't currently actually use the transaction.
    It was mainly put there for future use where it could be useful. It's also
    possible that _iter() will need a transaction also. For now these decisions
    seem good enough.


M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2013-03-14 15:29:18 +0200 Timo Sirainen <tss@iki.fi> (fee561b)

    lib-index: mail_index_attribute_[un]set() adds changed attributes' keys to
    transaction log. This provides them both a modseq (so their changes become
    visible) as well as an efficient way to see what attributes have changed by
    reading the transaction log. The values themselves aren't written to the
    log, because they could be large.


M	src/doveadm/doveadm-dump-log.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.h

2013-03-14 15:24:48 +0200 Timo Sirainen <tss@iki.fi> (6303f32)

    lib-master: Added version_string_verify_full()


M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2013-03-14 15:25:07 +0200 Timo Sirainen <tss@iki.fi> (b3bf71e)

    istream-dot unit test updated.


M	src/lib-mail/test-istream-dot.c

2013-03-13 22:11:39 +0200 Timo Sirainen <tss@iki.fi> (e2ce8d4)

    iostreams: Added close_parent flag to close() handler and clarified
    close/destroy APIs. This makes it unambiguous how things work: Unless you
    explicitly call [io]_stream_close(), the parent streams won't be closed.
    This is what most (hopefully all!) of the existing code expects.

    I was wondering a bit if [io]_stream_destroy() should simply have been 
    removed and replaced with [io]_stream_unref() calls, since they would have 
    worked basically everywhere, but there might be some places where it's 
    better to have explicitly closed the stream (and where closing the parent 
    stream doesn't matter).

M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-zlib.c
M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib/iostream-private.h
M	src/lib/iostream-temp.c
M	src/lib/iostream.c
M	src/lib/istream-concat.c
M	src/lib/istream-file.c
M	src/lib/istream-mmap.c
M	src/lib/istream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/istream.h
M	src/lib/ostream-file.c
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/ostream.h

2013-03-13 15:05:05 +0200 Timo Sirainen <tss@iki.fi> (8c30a8e)

    lda, lmtp: postmaster_address = postmaster@%d works now.


M	doc/example-config/conf.d/15-lda.conf
M	src/lda/main.c
M	src/lib-lda/lda-settings.c
M	src/lmtp/commands.c

2013-03-11 17:25:46 +0200 Timo Sirainen <tss@iki.fi> (42d2fdf)

    lib-fs: Fixed fs_delete() API description.


M	src/lib-fs/fs-api.h

2013-03-11 14:44:48 +0200 Timo Sirainen <tss@iki.fi> (16d8e47)

    acl: Delay initializing default backend ACLs. This fixes a crash with
    LAYOUT=index.


M	src/plugins/acl/acl-backend.c

2013-03-10 20:52:10 +0200 Timo Sirainen <tss@iki.fi> (293b45b)

    fts-solr: Removed unnecessary code.


M	src/plugins/fts-solr/solr-connection.c

2013-03-10 20:49:51 +0200 Timo Sirainen <tss@iki.fi> (ab4bd2a)

    lib-http: Don't crash if request callback manages to get the connection
    destroyed.


M	src/lib-http/http-client-connection.c

2013-03-10 20:38:35 +0200 Timo Sirainen <tss@iki.fi> (667de5c)

    lib-http: Added assert.


M	src/lib-http/http-client-request.c

2013-03-10 20:37:41 +0200 Timo Sirainen <tss@iki.fi> (6c768e0)

    lib-http: Callback can now request a retry with
    http_client_request_try_retry() This can be useful for handling "try again"
    errors from HTTP servers.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2013-03-10 20:34:49 +0200 Timo Sirainen <tss@iki.fi> (91547f2)

    lib-http: Removed unnecessary code from test-http-client


M	src/lib-http/test-http-client.c

2013-03-10 19:55:45 +0200 Timo Sirainen <tss@iki.fi> (d66ad81)

    lib-http: Free peer if it can't be connected to and it has no pending
    requests.


M	src/lib-http/http-client-peer.c

2013-03-10 19:54:51 +0200 Timo Sirainen <tss@iki.fi> (4d4f0ac)

    lib-http: If host can't be connected to, don't keep retrying with more than
    one connection. This also fixes infinitely trying to reconnect to host and
    retry.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-03-10 18:37:46 +0200 Timo Sirainen <tss@iki.fi> (a477aae)

    lib-http: If SSL connection gets lost, log the last SSL error.


M	src/lib-http/http-client-connection.c

2013-03-10 18:37:10 +0200 Timo Sirainen <tss@iki.fi> (ceddfbe)

    lib-ssl-iostream: Enable SSL_MODE_ENABLE_PARTIAL_WRITE


M	src/lib-ssl-iostream/iostream-openssl-context.c

2013-03-10 18:36:40 +0200 Timo Sirainen <tss@iki.fi> (b1faf59)

    lib-ssl-iostream: Fixed "bad write retry" errors when output had to be
    buffered.


M	src/lib-ssl-iostream/ostream-openssl.c

2013-03-10 18:16:28 +0200 Timo Sirainen <tss@iki.fi> (6a9bd9f)

    iostream-rawlog: Pass through close() to parent input/output stream.


M	src/lib/istream-rawlog.c
M	src/lib/ostream-rawlog.c

2013-03-10 17:19:14 +0200 Timo Sirainen <tss@iki.fi> (296ad15)

    lib-http: Fixed hangs with urgent requests.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-peer.c

2013-03-10 17:17:47 +0200 Timo Sirainen <tss@iki.fi> (1d048c5)

    lib-http: Allow caller to find out what state a request is in.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2013-03-08 20:25:12 +0200 Timo Sirainen <tss@iki.fi> (dd61a73)

    lib-http: Send Content-Length whenever payload is specified, even if its
    size is 0.


M	src/lib-http/http-client-request.c

2013-03-06 11:39:43 +0200 Timo Sirainen <tss@iki.fi> (2e5d419)

    Added ostream-hash for calculating a hash from data going through ostream.


M	src/lib/Makefile.am
A	src/lib/ostream-hash.c
A	src/lib/ostream-hash.h

2013-03-05 21:44:07 +0200 Timo Sirainen <tss@iki.fi> (92e0112)

    lib-http: Avoid hanging on urgent requests. Patch by Timo & Stephan. There
    are still some problems though, all urgent requests don't seem to get a new
    connection.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h

2013-03-05 16:32:12 +0200 Timo Sirainen <tss@iki.fi> (f21b0af)

    lib-http: Fixed crash caused by previous change.


M	src/lib-http/http-client-connection.c

2013-03-05 14:32:03 +0200 Timo Sirainen <tss@iki.fi> (99feb65)

    lib-http: If we get disconnected, say exactly what the error was.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c

2013-03-05 14:31:43 +0200 Timo Sirainen <tss@iki.fi> (d48e40d)

    connection: Give input/output streams a name.


M	src/lib/connection.c

2013-03-05 14:31:29 +0200 Timo Sirainen <tss@iki.fi> (00b706a)

    connection_list_deinit(): Set disconnect_reason correctly to
    CONNECTION_DISCONNECT_DEINIT


M	src/lib/connection.c

2013-03-05 12:20:41 +0200 Timo Sirainen <tss@iki.fi> (dc189cb)

    lib-fs: istream-metawrap supports now seeking before reading the metadata.


M	src/lib-fs/istream-metawrap.c

2013-03-05 11:45:26 +0200 Timo Sirainen <tss@iki.fi> (1a9a35a)

    lib-http: Fixed http_client_wait() assert.


M	src/lib-http/http-client.c

2013-03-05 11:45:10 +0200 Timo Sirainen <tss@iki.fi> (090489d)

    Added io_loop_have_immediate_timeouts()


M	src/lib/ioloop.c
M	src/lib/ioloop.h

2013-03-05 11:24:46 +0200 Timo Sirainen <tss@iki.fi> (e1339aa)

    lib-http: If connection was refused to a host, retry again on next request.
    Instead of never retrying again for the host.


M	src/lib-http/http-client-host.c

2013-03-04 16:27:16 +0200 Timo Sirainen <tss@iki.fi> (1e83f68)

    tcpwrap: Fixed crash at startup.


M	src/util/tcpwrap.c

2013-03-04 15:53:42 +0200 Timo Sirainen <tss@iki.fi> (dcf4259)

    dbox: Crashfix on some failed save error conditions.


M	src/lib-storage/index/dbox-common/dbox-save.c

2013-03-04 15:18:08 +0200 Timo Sirainen <tss@iki.fi> (e0bfe93)

    lib-settings: Improved error messages when config server disconnects too
    early.


M	src/lib-settings/settings-parser.c

2013-03-04 15:12:17 +0200 Timo Sirainen <tss@iki.fi> (8dc39d6)

    lib-storage: raw storage allows opening mails with absolute paths again.
    Fixed dovecot-lda -p parameter.


M	src/lib-storage/index/raw/raw-storage.c

2013-03-04 14:59:13 +0200 Timo Sirainen <tss@iki.fi> (be2d356)

    Fixed compiling without zlib.


M	src/doveadm/doveadm-zlib.c
M	src/lib-compression/compression.c

2013-02-27 18:00:29 +0200 Timo Sirainen <tss@iki.fi> (79a9e6b)

    doveadm: Fixed connecting to UNIX sockets.


M	src/doveadm/doveadm-util.c

2013-02-27 14:26:28 +0200 Timo Sirainen <tss@iki.fi> (3bbd5fd)

    acl: Don't assert-crash on storages that have no root directory.


M	src/plugins/acl/acl-backend-vfile-acllist.c

2013-02-27 13:07:35 +0200 Timo Sirainen <tss@iki.fi> (3d92258)

    message-decode: Minor fix to previous change. The == condition should
    probably never happen, but handle it anyway.


M	src/lib-mail/message-decoder.c

2013-02-27 13:05:40 +0200 Timo Sirainen <tss@iki.fi> (2e0fa95)

    message-decoder: Fixed assert-crash when trying to decode partial character
    twice.


M	src/lib-mail/message-decoder.c

2013-02-27 12:34:18 +0200 Timo Sirainen <tss@iki.fi> (4ddc84f)

    timeout_add_short(1) may have caused infinite looping.


M	src/lib/ioloop.c

2013-02-27 12:34:00 +0200 Timo Sirainen <tss@iki.fi> (ea245d7)

    dsync: If I/O gets stalled, log the state in which it happened.


M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-private.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-ibc.h

2013-02-27 12:07:06 +0200 Timo Sirainen <tss@iki.fi> (4697a41)

    dsync: Fixed running dsync for multiple users within same command.


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-27 12:00:03 +0200 Timo Sirainen <tss@iki.fi> (63420a1)

    dsync: When changing duplicate mailbox GUIDs, choose the same mailbox on
    both sides.


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2013-02-27 11:47:08 +0200 Timo Sirainen <tss@iki.fi> (8af1efb)

    dsync: Don't unnecessarily try to create all the mailboxes when they already
    exist.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2013-02-27 11:21:48 +0200 Timo Sirainen <tss@iki.fi> (e3df4d9)

    dsync: Change duplicate local mailbox GUIDs if they're found.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree.h
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2013-02-27 11:04:14 +0200 Timo Sirainen <tss@iki.fi> (0e9e7dc)

    dsync: Skip mailbox aliases (symlinks) for now.


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2013-02-26 17:44:34 +0200 Timo Sirainen <tss@iki.fi> (4948718)

    lib-fs: If fs_read_stream() creates a seekable stream, keep it open for
    future reads.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2013-02-26 17:18:18 +0200 Timo Sirainen <tss@iki.fi> (c99c242)

    istream-seekable: Don't forcibly close underlying streams when stream is
    destroyed. The underlying streams may still have references and be reused
    for other purposes.


M	src/lib/istream-seekable.c

2013-02-26 17:16:33 +0200 Timo Sirainen <tss@iki.fi> (1ce834a)

    istream-metawrap: Support seeking if underlying stream supports seeking


M	src/lib-fs/istream-metawrap.c

2013-02-26 17:16:18 +0200 Timo Sirainen <tss@iki.fi> (459b434)

    fs-api: Fixed fs_copy() generic implementation's error messages


M	src/lib-fs/fs-api.c

2013-02-26 15:55:16 +0200 Timo Sirainen <tss@iki.fi> (9dc01e0)

    lib-http: Track peers using a linked list also. Mainly because this makes it
    much easier to debug using gdb. The overhead isn't that much extra either.


M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c

2013-02-26 15:53:30 +0200 Timo Sirainen <tss@iki.fi> (141890e)

    lib-fs: fs-metawrap should prefetch using the same file as it uses for
    reading.


M	src/lib-fs/fs-metawrap.c

2013-02-26 13:04:50 +0200 Timo Sirainen <tss@iki.fi> (42174e5)

    lib-http: Assert-crash in http_client_wait() if it's waiting without doing
    anything.


M	src/lib-http/http-client.c

2013-02-26 13:04:09 +0200 Timo Sirainen <tss@iki.fi> (a4b14aa)

    Added io_loop_have_ios()


M	src/lib/ioloop.c
M	src/lib/ioloop.h

2013-02-26 13:03:30 +0200 Timo Sirainen <tss@iki.fi> (aacf2a6)

    lib-http: Track list of hosts using a linked list also.
    http_client_switch_ioloop() is done very often, and scanning a few entries
    in a linked list is much faster than going through a hash table.


M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client.c

2013-02-26 11:30:11 +0200 Timo Sirainen <tss@iki.fi> (a8dcdc2)

    lib-storage: Write dovecot.mailbox.log entries using virtual names, not
    storage names. This file is used only by dsync, and the new dsync design
    uses only virtual names everywhere. This of course means that now it's not
    easily possible to use different virtual names for the same user, but nobody
    really did that before anyway. The only other fully working solution would
    be to send both the virtual and the storage names in dsync, but that's a bit
    of a waste.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mailbox-list.c

2013-02-26 10:54:09 +0200 Timo Sirainen <tss@iki.fi> (6a33ecc)

    doveadm: Improved deciding whether to use TCP or UNIX socket for a given
    name.


M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-util.h

2013-02-26 10:37:19 +0200 Timo Sirainen <tss@iki.fi> (f437d8f)

    lib-storage: If namespace has disabled=yes, don't verify alias_for validity.


M	src/lib-storage/mail-storage-settings.c

2013-02-26 10:30:15 +0200 Timo Sirainen <tss@iki.fi> (b06633c)

    lib-storage: Never auto-remove the auto-created prefix="" namespace.


M	src/lib-storage/mail-user.c

2013-02-26 09:05:09 +0200 Timo Sirainen <tss@iki.fi> (1b8220e)

    scram-sha1: Support authzid field. Check fields' correctness better.


M	src/auth/mech-scram-sha1.c

2013-02-26 09:05:09 +0200 Timo Sirainen <tss@iki.fi> (f888f30)

    scram-sha1: Support authzid field. Check fields' correctness better.


M	src/auth/mech-scram-sha1.c

2013-02-25 20:40:15 +0200 Timo Sirainen <tss@iki.fi> (d687a91)

    Added signature for changeset e62fa121f4a2


M	.hgsigs

2013-02-25 20:40:12 +0200 Timo Sirainen <tss@iki.fi> (0b04c19)

    Added tag 2.2.rc2 for changeset e62fa121f4a2


M	.hgtags

2013-02-25 20:40:09 +0200 Timo Sirainen <tss@iki.fi> (1653d12)

    Released v2.2.rc2.


M	NEWS
M	configure.ac

2013-02-25 20:20:18 +0200 Timo Sirainen <tss@iki.fi> (e27c711)

    lib-storage: Still more fixing to listing subscriptions.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2013-02-25 20:09:52 +0200 Timo Sirainen <tss@iki.fi> (e130602)

    lib-storage: Fixed up previous subscription list change.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2013-02-25 20:04:10 +0200 Timo Sirainen <tss@iki.fi> (8b5c520)

    login: Don't fail at startup by trying to load SSL plugin.


M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/login-common/main.c

2013-02-25 19:52:40 +0200 Timo Sirainen <tss@iki.fi> (a485cb1)

    lib-storage: Fixed listing subscriptions for namespaces with prefix.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2013-02-25 19:37:53 +0200 Timo Sirainen <tss@iki.fi> (9bb59af)

    configure: Fixed plugins when compiling --with-shared-libs


M	configure.ac

2013-02-25 17:33:16 +0200 Timo Sirainen <tss@iki.fi> (8bbd9bb)

    Added signature for changeset 508d46f85815


M	.hgsigs

2013-02-25 17:33:13 +0200 Timo Sirainen <tss@iki.fi> (8212f94)

    Added tag 2.2.rc1 for changeset 508d46f85815


M	.hgtags

2013-02-25 17:33:02 +0200 Timo Sirainen <tss@iki.fi> (c03f054)

    Released v2.2.rc1.


M	NEWS
M	configure.ac

2013-02-25 17:29:28 +0200 Timo Sirainen <tss@iki.fi> (94b62be)

    Merged changes from v2.1 tree.


2013-02-25 17:25:10 +0200 Timo Sirainen <tss@iki.fi> (3e15508)

    TODO updated


M	TODO

2013-02-25 17:23:25 +0200 Timo Sirainen <tss@iki.fi> (a2667c4)

    Fixed checking UTF8 input validity.


M	src/lib/unichar.c

2013-02-25 17:23:25 +0200 Timo Sirainen <tss@iki.fi> (6db7f0b)

    Fixed checking UTF8 input validity.


M	src/lib/unichar.c

2013-02-25 17:07:55 +0200 Timo Sirainen <tss@iki.fi> (bad3690)

    dsync-server: Don't crash if connection didn't come from doveadm-server


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-25 17:07:38 +0200 Timo Sirainen <tss@iki.fi> (7cd527f)

    dsync: Minor code cleanup.


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-25 16:58:02 +0200 Timo Sirainen <tss@iki.fi> (c0ea3df)

    dsync: Don't close stdin/stdout when not supposed to.


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-25 16:44:57 +0200 Timo Sirainen <tss@iki.fi> (e0719fc)

    maildir: Preserve [SW]=sizes when renaming a maildir duplicate file.


M	src/lib-storage/index/maildir/maildir-sync.c

2013-02-25 16:12:49 +0200 Timo Sirainen <tss@iki.fi> (e37aed0)

    Reverted the recent hash.h changes. Instead use
    -Wno-duplicate-decl-specifier with clang. The modified version required hash
    table users to know the structs' contents, which isn't otherwise necessary.


M	configure.ac
M	src/lib/hash-decl.h
M	src/lib/hash.h
M	src/lib/macros.h

2013-02-25 15:55:06 +0200 Timo Sirainen <tss@iki.fi> (8c5d195)

    dsync: Added tcps (TCP+SSL) target.


M	src/doveadm/doveadm-server.h
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/server-connection.c
M	src/doveadm/server-connection.h

2013-02-25 15:54:01 +0200 Timo Sirainen <tss@iki.fi> (1172b60)

    doveadm-server: Added support for ssl listeners.


M	src/doveadm/Makefile.am
M	src/doveadm/client-connection.c
M	src/doveadm/client-connection.h
M	src/doveadm/main.c

2013-02-25 15:52:00 +0200 Timo Sirainen <tss@iki.fi> (8969b39)

    lib-storage: Replaced pop3c_ssl_ca_dir and imapc_ssl_ca_dir with generic
    ssl_client_ca_dir.


M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-settings.h
M	src/lib-storage/index/pop3c/pop3c-storage.c

2013-02-25 15:51:16 +0200 Timo Sirainen <tss@iki.fi> (5a63431)

    lib-master: If ssl settings are used, initialize ssl context automatically.


M	src/lib-master/master-service.c

2013-02-25 15:50:50 +0200 Timo Sirainen <tss@iki.fi> (08a8e93)

    lib-ssl-iostream: Support wildcard certificates when verifying hostname.


M	src/lib-ssl-iostream/iostream-openssl-common.c

2013-02-25 14:00:10 +0200 Timo Sirainen <tss@iki.fi> (07ce366)

    dsync: Use iostreams instead of fd when receiving connection from
    doveadm-server.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/server-connection.c
M	src/doveadm/server-connection.h

2013-02-25 13:00:40 +0200 Timo Sirainen <tss@iki.fi> (7f50258)

    MODULE_LIBS is now part of LIBDOVECOT. No need to explicitly link it
    everywhere.


M	Makefile.am
M	configure.ac
M	dovecot-config.in.in
M	src/anvil/Makefile.am
M	src/auth/Makefile.am
M	src/config/Makefile.am
M	src/dict/Makefile.am
M	src/dns/Makefile.am
M	src/doveadm/Makefile.am
M	src/imap-urlauth/Makefile.am
M	src/imap/Makefile.am
M	src/indexer/Makefile.am
M	src/ipc/Makefile.am
M	src/lda/Makefile.am
M	src/lib-compression/Makefile.am
M	src/lib-sql/Makefile.am
M	src/lib-storage/Makefile.am
M	src/lmtp/Makefile.am
M	src/plugins/quota/Makefile.am
M	src/pop3/Makefile.am
M	src/replication/aggregator/Makefile.am
M	src/replication/replicator/Makefile.am
M	src/stats/Makefile.am
M	src/util/Makefile.am

2013-02-25 09:12:06 +0200 Timo Sirainen <tss@iki.fi> (1d58007)

    configure: Fix previous commit & implement AC_C_TYPEOF ourself. RHEL5's
    autoconf was old enough to not have AC_C_TYPEOF.


M	configure.ac

2013-02-25 09:07:13 +0200 Timo Sirainen <tss@iki.fi> (a55ac83)

    configure: Removed accidentally enabled clang -fsanitize options for now.


M	configure.ac

2013-02-24 19:48:55 +0200 Timo Sirainen <tss@iki.fi> (916c2e0)

    imap: Handle UID commands without a wrapper UID command. This avoids calling
    command hooks once for UID command and again for the real command.


M	src/imap/Makefile.am
D	src/imap/cmd-uid.c
M	src/imap/imap-client.c
M	src/imap/imap-commands.c

2013-02-24 19:39:52 +0200 Timo Sirainen <tss@iki.fi> (0a9cb42)

    dsync: Added tcp:host[:port] target for syncing via doveadm-server.


M	src/doveadm/client-connection.c
M	src/doveadm/client-connection.h
M	src/doveadm/doveadm-mail.h
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/server-connection.c
M	src/doveadm/server-connection.h

2013-02-24 19:38:27 +0200 Timo Sirainen <tss@iki.fi> (10a2457)

    doveadm: If doveadm-server sends broken input, disconnect.


M	src/doveadm/server-connection.c

2013-02-24 19:37:45 +0200 Timo Sirainen <tss@iki.fi> (250a06c)

    doveadm: When connecting to doveadm socket without :port, use doveadm_port
    setting.


M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-util.h
M	src/doveadm/server-connection.c

2013-02-24 19:35:39 +0200 Timo Sirainen <tss@iki.fi> (1e09e09)

    doveadm: Renamed doveadm_proxy_port setting to doveadm_port. There's still
    an alias for doveadm_proxy_port.


M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h

2013-02-24 18:19:40 +0200 Timo Sirainen <tss@iki.fi> (2ba9851)

    lmtp: Log a bit nicer message when client QUITs. I did think about removing
    the connect and successful disconnect messages entirely, but these may be
    useful when debugging problems with MTA.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2013-02-24 18:02:25 +0200 Timo Sirainen <tss@iki.fi> (d707f37)

    dsync: Always skip alias namespaces.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c

2013-02-24 16:43:28 +0200 Timo Sirainen <tss@iki.fi> (4a34131)

    lazy-expunge: If lazy_expunge_only_last_instance is set, copy only last
    instances of mails. Requires storage backend to support refcounts.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2013-02-24 16:33:24 +0200 Timo Sirainen <tss@iki.fi> (03de962)

    lib-storage: Added MAIL_FETCH_REFCOUNT for getting mail's reference count.
    This is useful only for backends where mailbox_copy() increases the
    refcount. With maildir&sdbox it can be looked up from the file's link count.
    With mdbox the refcount is stored in the map index. Other formats don't
    currently implement this.


M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/mail-storage.h

2013-02-24 16:15:23 +0200 Timo Sirainen <tss@iki.fi> (edb47cf)

    lib-settings: Parse block names {} case-insensitively. This fixes namespace
    { mailbox foo { .. } } settings when they go through environment and get
    uppercased.


M	src/lib-settings/settings-parser.c

2013-02-24 16:02:47 +0200 Timo Sirainen <tss@iki.fi> (4f993cf)

    imap: Don't leak mailboxes on CATENATE errors.


M	src/imap/cmd-append.c

2013-02-24 15:52:57 +0200 Timo Sirainen <tss@iki.fi> (2926f11)

    lib-storage: Fixed setting \Recent flags for sessions that didn't drop them.
    If another session wasn't dropping the \Recent flags, no new mails were
    getting them unless the mailbox was reopened.


M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync.c

2013-02-24 15:50:26 +0200 Timo Sirainen <tss@iki.fi> (d1661d9)

    lib-storage: Fixed \Recent flag race conditions. The \Recent flags should
    only be set while locked within mail_index_sync_begin()..commit(). The
    following view syncing syncs only up to how far the index was synced, so it
    won't see any new messages that haven't yet been assigned a \Recent flag.


M	src/lib-storage/index/index-status.c

2013-02-24 15:26:53 +0200 Timo Sirainen <tss@iki.fi> (3e3045f)

    Compiler warning fix.


M	src/lib-storage/index/index-mail.c

2013-02-24 15:02:44 +0200 Timo Sirainen <tss@iki.fi> (e0ec844)

    o_stream_send_istream(): Fixed copying when [io]streams neither have usable
    fds.


M	src/lib/ostream-file.c

2013-02-24 15:00:13 +0200 Timo Sirainen <tss@iki.fi> (81152df)

    Avoid unsigned integer overflows.


M	src/imap/imap-commands-util.c
M	src/lib-index/mail-index-util.c

2013-02-24 14:59:54 +0200 Timo Sirainen <tss@iki.fi> (a5799aa)

    imap: Added assert+comment to give easier to understand error.


M	src/imap/cmd-append.c

2013-02-24 14:58:32 +0200 Timo Sirainen <tss@iki.fi> (73960a1)

    lib-storage: If mail saving is cancelled, don't check that all the input was
    read.


M	src/lib-storage/index/index-mail.c

2013-02-24 11:58:46 +0200 Timo Sirainen <tss@iki.fi> (1384fac)

    Avoid under/overflows in unsigned integer calculations.


M	src/lib/str-find.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/time-util.c

2013-02-24 11:55:07 +0200 Timo Sirainen <tss@iki.fi> (a18e252)

    test-json-parser: Don't access memory out of bounds.


M	src/lib/test-json-parser.c

2013-02-24 11:54:00 +0200 Timo Sirainen <tss@iki.fi> (4082d5b)

    seq_range_array_add(): Fixed handling sequence ranges that contain zeros.


M	src/lib/seq-range-array.c
M	src/lib/test-seq-range-array.c

2013-02-24 10:50:35 +0200 Timo Sirainen <tss@iki.fi> (dc21f1d)

    Avoid overflow error from clang -fsanitize=integer.


M	src/lib/istream-crlf.c

2013-02-24 10:49:38 +0200 Timo Sirainen <tss@iki.fi> (de7df9e)

    lib-index: Don't unnecessarily update dovecot.index again after log
    rotation.


M	src/lib-index/mail-index-sync.c

2013-02-24 09:16:31 +0200 Timo Sirainen <tss@iki.fi> (8ae72ad)

    Replaced all -1U and (unsigned int)-1 with UINT_MAX. It's somewhat clearer
    this way. Also clang's -fsanitize=integer gives runtime errors about -1U
    (but not about explicit casts, so no need to change (type)-1 casts).


M	configure.ac
M	src/anvil/anvil-settings.c
M	src/auth/db-ldap.c
M	src/config/doveconf.c
M	src/director/director-settings.c
M	src/director/doveadm-connection.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-stats.c
M	src/lib-auth/auth-master.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-http/http-client-peer.c
M	src/lib-imap/imap-envelope.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.h
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-mail/test-message-address.c
M	src/lib-master/master-service.c
M	src/lib-settings/settings-parser.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage.c
M	src/lib/istream-concat.c
M	src/lib/priorityq.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-base64.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-seq-range-array.c
M	src/lmtp/commands.c
M	src/log/log-settings.c
M	src/master/service-monitor.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/quota/quota.c
M	src/replication/replicator/replicator-settings.c
M	src/stats/stats-settings.c

2013-02-24 08:58:03 +0200 Timo Sirainen <tss@iki.fi> (71fbc9a)

    Compiler warning fix.


M	src/doveadm/doveadm-mail-fetch.c

2013-02-24 08:54:58 +0200 Timo Sirainen <tss@iki.fi> (71ad5d5)

    Previous "duplicate const" fix accidentally deleted some checking code
    instead of fixing it.


M	src/lib/hash.h

2013-02-24 08:46:28 +0200 Timo Sirainen <tss@iki.fi> (6d803d2)

    Fixed "duplicate const" warnings with new clang.


M	src/lib/hash-decl.h
M	src/lib/hash.h
M	src/lib/macros.h

2013-02-24 08:43:34 +0200 Timo Sirainen <tss@iki.fi> (025e4df)

    Minor code cleanup


M	src/lib-storage/mail-search-register-human.c

2013-02-24 08:44:27 +0200 Timo Sirainen <tss@iki.fi> (d00f983)

    Use proper HAVE_TYPEOF check instead of checking with gcc versions.


M	configure.ac
M	src/lib/macros.h

2013-02-24 08:06:59 +0200 Timo Sirainen <tss@iki.fi> (cd62b99)

    Compiler warning fix.


M	src/lib/test-json-parser.c

2013-02-24 08:06:51 +0200 Timo Sirainen <tss@iki.fi> (1f90fa6)

    dsync: Don't log about remote dsync status if we're not doing a remote sync.


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-22 16:42:23 +0200 Timo Sirainen <tss@iki.fi> (6b754cb)

    auth_debug_passwords: Add a warning to AUTH/CONT lines about them having
    sensitive data.


M	src/auth/auth-client-connection.c

2013-02-22 16:21:20 +0200 Timo Sirainen <tss@iki.fi> (afb5de6)

    pop3: Fixed infinite looping


M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h

2013-02-22 16:03:00 +0200 Timo Sirainen <tss@iki.fi> (26ada76)

    quota-fs: Support NetBSD 6.0 libquota. Patch by Emmanuel Dreyfus.


M	configure.ac
M	src/plugins/quota/Makefile.am
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-fs.h

2013-02-22 15:49:35 +0200 Timo Sirainen <tss@iki.fi> (2dadd5d)

    lib-index: Fixed assert-crash on some error conditions.


M	src/lib-index/mail-transaction-log-file.c

2013-02-22 15:34:59 +0200 Timo Sirainen <tss@iki.fi> (e8c5da6)

    doveadm user: Write an error if user doesn't exist.


M	src/doveadm/doveadm-auth.c

2013-02-22 15:24:01 +0200 Timo Sirainen <tss@iki.fi> (4114cc5)

    doveconf: Discourage using plain "doveconf" by recommending -n parameter in
    the output.


M	src/config/doveconf.c

2013-02-22 15:14:19 +0200 Timo Sirainen <tss@iki.fi> (82f71aa)

    auth: userdb passwd iteration no longer skips shells. Some systems are using
    passwd for mail users with shell set to nologin. Maybe first_valid_uid check
    is good enough alone?


M	src/auth/userdb-passwd.c

2013-02-22 14:49:27 +0200 Timo Sirainen <tss@iki.fi> (5ad4895)

    fts-solr: Truncate header if it's over 1 MB. Previously we just warned about
    it.


M	src/plugins/fts-solr/fts-backend-solr.c

2013-02-22 13:51:02 +0200 Timo Sirainen <tss@iki.fi> (79b0f6e)

    lib-dict: Fixed hang if async commit's callback did more dict access.
    Specifically this fixes a hang with dict-quota plugin when user didn't exist
    and quota was changed before calculating it.


M	src/lib-dict/dict-client.c

2013-02-22 13:21:09 +0200 Timo Sirainen <tss@iki.fi> (3ad4568)

    mail_shared_explicit_inbox: Switched the default from "yes" to "no".


M	NEWS
M	doc/example-config/conf.d/10-mail.conf
M	src/lib-storage/mail-storage-settings.c

2013-02-22 13:05:21 +0200 Timo Sirainen <tss@iki.fi> (1df1abc)

    auth: Use real_lip for proxy_maybe checks.


M	src/auth/auth-request.c

2013-02-22 13:04:45 +0200 Timo Sirainen <tss@iki.fi> (325d17c)

    auth: Added real_[lr]ip, real_[lr]port variables. The unreal ones differ
    when a trusted proxy overrides them.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/main.c
M	src/login-common/sasl-server.c

2013-02-22 12:42:26 +0200 Timo Sirainen <tss@iki.fi> (9508ac4)

    proxying cleanup: Send TTL=1 (instead of TTL=0) as "no more proxying".


M	src/imap-login/imap-proxy.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/login-common/login-proxy.c
M	src/pop3-login/pop3-proxy.c

2013-02-22 12:19:36 +0200 Timo Sirainen <tss@iki.fi> (2a43c6f)

    lib-lda: Give a better error message if dotlocking duplicate db fails.


M	src/lib-lda/duplicate.c

2013-02-22 12:12:26 +0200 Timo Sirainen <tss@iki.fi> (9d12bcb)

    dict-sql: Iterating with multiple SQL queries didn't free all the queries.


M	src/lib-dict/dict-sql.c

2013-02-22 10:42:40 +0200 Timo Sirainen <tss@iki.fi> (5cba8fd)

    indexer-worker: Fixed keeping config connection open before dropping root
    privileges. The initial settings reading doesn't really do anything, since
    the real settings are again read by mail-storage-service.


M	src/indexer/indexer-worker.c

2013-02-22 10:32:05 +0200 Timo Sirainen <tss@iki.fi> (196124a)

    lib-storage: Make sure mailbox_get_open_status() can't be used with items
    that can fail.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2013-02-22 10:31:38 +0200 Timo Sirainen <tss@iki.fi> (c337f1e)

    doveadm, indexer: Don't crash if STATUS_LAST_CACHED_SEQ lookup fails. (I'm
    sure I did this change already once, where did it go?..)


M	src/doveadm/doveadm-mail-index.c
M	src/indexer/master-connection.c

2013-03-24 12:09:39 +0200 Timo Sirainen <tss@iki.fi> (bdb026e)

    "Mailbox doesn't exist" error mixed up using storage and virtual mailbox
    names. This could have allowed a user to figure out existence of a mailbox
    without having lookup ACL.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mailbox-list-private.h
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/virtual/virtual-config.c

2013-02-22 10:31:38 +0200 Timo Sirainen <tss@iki.fi> (7e7c61c)

    doveadm, indexer: Don't crash if STATUS_LAST_CACHED_SEQ lookup fails. (I'm
    sure I did this change already once, where did it go?..)


M	src/doveadm/doveadm-mail-index.c
M	src/indexer/master-connection.c

2013-02-22 10:17:14 +0200 Timo Sirainen <tss@iki.fi> (e623126)

    fts: Don't send binary MIME parts to backend through UTF8 text conversion.
    Based on patch by Mike Abbott / Apple.


M	src/plugins/fts/fts-build-mail.c

2013-02-22 10:09:19 +0200 Timo Sirainen <tss@iki.fi> (cf4354e)

    lib-storage: Fixed assert-crash when saving mails if UIDs weren't assigned.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2013-02-22 10:01:06 +0200 Timo Sirainen <tss@iki.fi> (2f705f3)

    mdbox: If m.X file has no mails, don't try to fix it infinitely in storage
    rebuild.


M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c

2013-02-22 09:43:59 +0200 Timo Sirainen <tss@iki.fi> (2a3a069)

    mdbox: Don't try to undelete any mailboxes in storage rebuild to avoid
    assert-crashes.


M	src/lib-storage/mail-storage.c

2013-02-22 07:37:18 +0200 Timo Sirainen <tss@iki.fi> (53febe0)

    quota-status: Fixed compiling with older autotools.


M	src/plugins/quota/Makefile.am

2013-02-21 19:58:39 +0200 Timo Sirainen <tss@iki.fi> (94cd1e3)

    imap: Allocate LIST patterns from command pool so they don't get corrupted
    in long runs.


M	src/imap/cmd-list.c

2013-02-21 19:30:38 +0200 Timo Sirainen <tss@iki.fi> (4d3b139)

    mailbox_list_index=yes: Don't crash if destroying list before its init
    finished.


M	src/lib-storage/list/mailbox-list-index.c

2013-02-21 17:09:08 +0200 Timo Sirainen <tss@iki.fi> (ffa3290)

    Added signature for changeset 018de2aa893a


M	.hgsigs

2013-02-21 17:09:02 +0200 Timo Sirainen <tss@iki.fi> (e87dcdb)

    Added tag 2.2.beta2 for changeset 018de2aa893a


M	.hgtags

2013-02-21 17:07:55 +0200 Timo Sirainen <tss@iki.fi> (784762b)

    Released v2.2.beta1.


M	configure.ac

2013-02-21 17:06:27 +0200 Stephan Bosch <stephan@rename-it.nl> (c367bee)

    lib-http: Fixed hanging on errors


M	src/lib-http/http-client-connection.c

2013-02-21 14:16:45 +0200 Timo Sirainen <tss@iki.fi> (0f5bce9)

    Removed dead assignments.


M	src/lib-http/test-http-transfer.c
M	src/lib-storage/list/mailbox-list-fs-iter.c

2013-02-21 14:15:15 +0200 Timo Sirainen <tss@iki.fi> (99fedfc)

    dsync: Fixed hiding the "remote command returned error" message when it was
    unnecessary.


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-21 13:27:42 +0200 Timo Sirainen <tss@iki.fi> (96f7cae)

    quota-status: Fixed compiling


M	src/plugins/quota/Makefile.am

2013-02-21 13:22:33 +0200 Timo Sirainen <tss@iki.fi> (7bf25e7)

    TODO updated


M	TODO

2013-02-21 13:21:18 +0200 Timo Sirainen <tss@iki.fi> (09baabc)

    Merged changes from v2.1 tree.


2013-02-21 10:23:08 +0200 Stephan Bosch <stephan@rename-it.nl> (5b23fb7)

    lib-http: Minor improvements.


M	src/lib-http/http-client-peer.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/test-http-client.c

2013-02-21 10:21:31 +0200 Timo Sirainen <tss@iki.fi> (fb02594)

    lib-http: Fixed hangs/crashes with chunked ostream. Based on patch by
    Stephan Bosch.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-transfer-chunked.c

2013-02-21 07:55:24 +0200 Timo Sirainen <tss@iki.fi> (3a53aff)

    Added quota plugin's headers to LIBDOVECOT_STORAGE_INCLUDE. This allows
    creating external plugins that depend on the quota plugin (similar to trash
    plugin).


M	dovecot-config.in.in
M	src/plugins/quota/Makefile.am

2013-02-21 06:22:40 +0200 Timo Sirainen <tss@iki.fi> (ab98519)

    lib-storage: Fixed crash with mailbox_list_index=no


M	src/lib-storage/list/mailbox-list-index.c

2013-02-20 19:34:51 +0200 Stephan Bosch <stephan@rename-it.nl> (57e1401)

    lib-http: Fixed hang with failed DNS lookups


M	src/lib-http/http-client-host.c

2013-02-20 16:58:45 +0200 Timo Sirainen <tss@iki.fi> (7f5c66e)

    quota-status: Load plugins after all. They may be needed for user
    initialization to work (e.g. virtual plugin) or maybe even for quota itself
    to work (external quota backend plugin).


M	src/plugins/quota/Makefile.am
M	src/plugins/quota/quota-status.c

2013-02-20 16:49:14 +0200 Timo Sirainen <tss@iki.fi> (f6e1166)

    mailbox_list_index: Delay allocating the index so mbox can override the
    index path.


M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2013-02-20 16:03:53 +0200 Timo Sirainen <tss@iki.fi> (bd5825f)

    mbox: Fixed mailbox_update() to not shrink uidnext.


M	src/lib-storage/index/mbox/mbox-sync.c

2013-02-20 15:56:56 +0200 Timo Sirainen <tss@iki.fi> (0e79d0c)

    acl: Skip ACLs if admin user flag is set (especially dsync).


M	src/plugins/acl/acl-api.c

2013-02-20 15:49:46 +0200 Timo Sirainen <tss@iki.fi> (6695fbf)

    acl: If copy() doesn't have enough permissions, free mail_save_context
    properly.


M	src/plugins/acl/acl-mailbox.c

2013-02-20 15:49:06 +0200 Timo Sirainen <tss@iki.fi> (f3d17e9)

    lib-storage: Added more asserts to catch missing mail_save_context frees.
    Arguably mail_save_context could already freed at this time, but some other
    code relies on this as well. These could be removed later if this is no
    longer true.


M	src/lib-storage/mail-storage.c

2013-02-20 15:41:17 +0200 Timo Sirainen <tss@iki.fi> (3a34692)

    lib-storage: If mailbox is deleted, mailbox_save_begin() should cancel
    mail_save_context.


M	src/lib-storage/mail-storage.c

2013-02-20 15:40:16 +0200 Timo Sirainen <tss@iki.fi> (47eeadb)

    lib-storage: Reset saving/moving/copying_via_save flag between
    mail_save_context uses.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage.c

2013-02-20 12:24:36 +0200 Timo Sirainen <tss@iki.fi> (85b5b20)

    test-http-client: Added POST functionality also.


M	src/lib-http/test-http-client.c

2013-02-20 11:58:34 +0200 Timo Sirainen <tss@iki.fi> (fc3ac5b)

    test-http-client: If given a parameter, GET it.


M	src/lib-http/test-http-client.c

2013-02-20 11:57:55 +0200 Timo Sirainen <tss@iki.fi> (fb1be3d)

    lib-http: Avoid hanging in http_client_wait() while there's nothing to do.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c

2013-02-20 11:18:59 +0200 Timo Sirainen <tss@iki.fi> (069b28a)

    lib-http: Minor API change: Added http_client_request_finish_payload()


M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h
M	src/plugins/fts-solr/solr-connection.c

2013-02-20 10:58:02 +0200 Timo Sirainen <tss@iki.fi> (9edd88a)

    mailbox_list_index: Removed race conditions from index updates.


M	src/lib-storage/list/mailbox-list-index-status.c

2013-02-20 10:57:13 +0200 Timo Sirainen <tss@iki.fi> (a42fa06)

    lib-index: Added assert.


M	src/lib-index/mail-index-sync.c

2013-02-19 17:36:59 +0200 Timo Sirainen <tss@iki.fi> (c0699d9)

    Added quota-status service for asking if user is over quota. Implemented
    Postfix-compatible policy server protocol initially. Usage:

    service quota-status {
     executable = quota-status -p postfix
     unix_listener /var/spool/postfix/private/quota-status {
       user = postfix
     }
     client_limit = 1
    }

    Postfix:

    smtpd_recipient_restrictions =
     ...
     check_policy_service unix:private/quota-status

M	.hgignore
M	src/plugins/quota/Makefile.am
A	src/plugins/quota/quota-status.c

2013-02-19 15:52:21 +0200 Timo Sirainen <tss@iki.fi> (90d105d)

    hostpid_init() should die if hostname is invalid. This was accidentally
    changes during last commit.


M	src/lib/hostpid.c

2013-02-19 13:43:42 +0200 Timo Sirainen <tss@iki.fi> (1deffbb)

    lib-index: Give a better error message if index is readonly and log is tried
    to be locked.


M	src/lib-index/mail-transaction-log-file.c

2013-02-19 13:18:38 +0200 Timo Sirainen <tss@iki.fi> (68b968a)

    LAYOUT=index: Index is the only source for mailbox info, don't try any
    syncing with storage.


M	src/lib-storage/list/mailbox-list-index-backend.c

2013-02-19 13:17:42 +0200 Timo Sirainen <tss@iki.fi> (3a2f2ad)

    lib-storage: Fixed mailbox_update() when using mailbox_list_index=yes


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2013-02-19 13:17:05 +0200 Timo Sirainen <tss@iki.fi> (40ac30b)

    Added guid_128_equals() helper function.


M	src/lib/guid.c
M	src/lib/guid.h

2013-02-19 11:25:21 +0200 Timo Sirainen <tss@iki.fi> (241c0b8)

    auth: Fix to previous change.


M	src/auth/userdb-passwd-file.c

2013-02-19 11:22:57 +0200 Timo Sirainen <tss@iki.fi> (f003421)

    auth: userdb passwd-file iteration now skips passdb-only entries if there
    are other userdbs.


M	src/auth/userdb-passwd-file.c

2013-02-19 11:08:49 +0200 Timo Sirainen <tss@iki.fi> (d24f5d5)

    dsync: Added more debug logging.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2013-02-19 10:38:51 +0200 Timo Sirainen <tss@iki.fi> (953e717)

    auth: If user in passwd-file has no userdb info, userdb lookup now returns
    it as nonexistent.


M	src/auth/db-passwd-file.c
M	src/auth/userdb-passwd-file.c

2013-02-19 10:14:04 +0200 Timo Sirainen <tss@iki.fi> (9ed42a5)

    dsync: Improved debug output.


M	src/doveadm/dsync/dsync-brain-mailbox.c

2013-02-19 09:45:12 +0200 Timo Sirainen <tss@iki.fi> (2e86ce0)

    dsync: Assert-crashfix for handling conflicting private flags.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-19 09:35:10 +0200 Timo Sirainen <tss@iki.fi> (9b47801)

    replicator plugin: And crashfix for the previous change..


M	src/plugins/replication/replication-plugin.c

2013-02-19 09:32:11 +0200 Timo Sirainen <tss@iki.fi> (152a374)

    replication plugin: Notify replicator also for changes in public mailboxes.


M	src/plugins/replication/replication-plugin.c

2013-02-19 08:54:32 +0200 Timo Sirainen <tss@iki.fi> (ad58254)

    lib-storage: Copy initial private message flags from shared flags for public
    mailboxes.


M	src/lib-storage/index/index-sync-pvt.c

2013-02-19 08:35:57 +0200 Timo Sirainen <tss@iki.fi> (4cb8546)

    replicator: Use -N parameter for dsync (replicate all visible namespaces).


M	src/replication/replicator/doveadm-connection.c

2013-02-19 08:35:23 +0200 Timo Sirainen <tss@iki.fi> (4fa4166)

    dsync: Renamed -a parameter to -N. It also now skips invisible namespaces.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c

2013-02-19 08:27:40 +0200 Timo Sirainen <tss@iki.fi> (e2d268e)

    lib-storage: Saving/copying no longer discards private message flags.


M	src/lib-storage/index/index-sync-private.h
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/virtual/virtual-save.c

2013-02-19 08:17:50 +0200 Timo Sirainen <tss@iki.fi> (ea26d34)

    log: Recent log parser change started logging "Invalid log line" errors
    unintentionally.


M	src/log/log-connection.c

2013-02-18 15:14:05 +0200 Timo Sirainen <tss@iki.fi> (93ded1a)

    log: Don't crash if log client sends line with pid=0.


M	src/log/log-connection.c

2013-02-18 15:12:26 +0200 Timo Sirainen <tss@iki.fi> (9c50c41)

    my_hostname was broken because of recent change.


M	src/lib/hostpid.c

2013-02-18 08:46:06 +0200 Timo Sirainen <tss@iki.fi> (6272a4a)

    doveconf: Added -H parameter to check for hostname hash duplicates.


M	src/config/doveconf.c

2013-02-18 08:45:54 +0200 Timo Sirainen <tss@iki.fi> (af49da6)

    Added guid_128_host_hash_get().


M	src/lib/guid.c
M	src/lib/guid.h

2013-02-18 07:20:03 +0200 Timo Sirainen <tss@iki.fi> (a8aec60)

    Master looks up system hostdomain now and sends it to child processes via
    environment. This avoids doing a gethostbyname() lookup at startup for each
    process that needs it.


M	src/lib/hostpid.c
M	src/lib/hostpid.h
M	src/master/service-process.c

2013-02-18 07:12:44 +0200 Timo Sirainen <tss@iki.fi> (16e1bc9)

    master: Don't close stderr. If log process fails at startup, the errors are
    logged there.


M	src/master/main.c

2013-02-18 06:49:57 +0200 Timo Sirainen <tss@iki.fi> (9e0a2ab)

    Free my_hostdomain at deinit.


M	src/lib/hostpid.c
M	src/lib/hostpid.h
M	src/lib/lib.c

2013-02-18 06:35:41 +0200 Timo Sirainen <tss@iki.fi> (45b9cab)

    example-config: Updated hostname setting's comments.


M	doc/example-config/conf.d/15-lda.conf

2013-02-18 06:31:51 +0200 Timo Sirainen <tss@iki.fi> (49985fd)

    dsync: Fix to checking which side should do the locking.


M	src/doveadm/dsync/dsync-brain.c

2013-02-17 12:03:06 +0200 Timo Sirainen <tss@iki.fi> (8e817ed)

    mbox: If namespace prefix is used, don't show <prefix>/inbox mailbox.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2013-02-17 11:48:16 +0200 Timo Sirainen <tss@iki.fi> (8b3a483)

    dsync: Fixes to handling local changes during dsync.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-17 11:47:32 +0200 Timo Sirainen <tss@iki.fi> (9d8f243)

    dsync: Fail if changing mailbox GUID update doesn't work.


M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c

2013-02-17 11:46:14 +0200 Timo Sirainen <tss@iki.fi> (f828be2)

    mbox: Fixed mailbox_update() for changing mailbox GUID.


M	src/lib-storage/index/mbox/mbox-storage.c

2013-02-17 10:47:40 +0200 Timo Sirainen <tss@iki.fi> (795aeec)

    lib-index: Make sure unused_old_sync_* fields are cleared in header in old
    inedx files.


M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index.h

2013-02-17 10:15:04 +0200 Timo Sirainen <tss@iki.fi> (add74aa)

    dsync: Fixed infinite loop in importer.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-17 10:14:49 +0200 Timo Sirainen <tss@iki.fi> (9bbfe7f)

    dsync: Improved unexpected error logging.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-17 10:11:20 +0200 Timo Sirainen <tss@iki.fi> (20cf8d1)

    maildir: Don't try to preserve old filename when saving if uidlist couldn't
    be locked.


M	src/lib-storage/index/maildir/maildir-save.c

2013-02-17 10:10:45 +0200 Timo Sirainen <tss@iki.fi> (6f1936d)

    maildir: If we see old maildir file reappear, re-read uidlist before logging
    error. Sometimes the old file gets added back intentionally and the
    dovecot-uidlist is recreated (if necessary) to give it a new UID. Existing
    processes should handle this situation.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2013-02-17 08:50:18 +0200 Timo Sirainen <tss@iki.fi> (0cffbb3)

    dsync: If locking fails, fail instead of continuing.


M	src/doveadm/dsync/dsync-brain.c

2013-02-17 07:05:08 +0200 Timo Sirainen <tss@iki.fi> (564aa83)

    dsync: Use full hostname+domain when comparing if hosts are different in
    locking.


M	src/doveadm/dsync/dsync-brain.c

2013-02-16 19:06:18 +0200 Timo Sirainen <tss@iki.fi> (44aaf30)

    login-common: Updated obsolete login_process_size setting in error log
    message.


M	src/login-common/ssl-proxy-openssl.c

2013-02-16 18:57:33 +0200 Timo Sirainen <tss@iki.fi> (c3fcfca)

    Merged changes from v2.1 tree.


2013-02-16 18:24:28 +0200 Timo Sirainen <tss@iki.fi> (4927162)

    NEWS file updated.


M	NEWS

2013-02-16 18:22:23 +0200 Timo Sirainen <tss@iki.fi> (99fca73)

    pop3_lock_session: Use a separate dovecot-pop3-session.lock file instead of
    mailbox lock. This changes the behavior in a way that it's now possible for
    IMAP sessions to expunge mails during a POP3 session. But now it's no longer
    possible for POP3 sessions to hang new mail deliveries.


M	doc/example-config/conf.d/20-pop3.conf
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h

2013-02-16 17:58:20 +0200 Timo Sirainen <tss@iki.fi> (279ac7e)

    pop3: Minor code cleanup


M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h

2013-02-16 17:54:57 +0200 Timo Sirainen <tss@iki.fi> (348d897)

    pop3: Use RFC 3206 [SYS/*] and [AUTH] response codes.


M	README
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/client.h
M	src/pop3/main.c
M	src/pop3/pop3-capability.h
M	src/pop3/pop3-client.c

2013-02-16 17:33:27 +0200 Timo Sirainen <tss@iki.fi> (7268a99)

    pop3: Code cleanup: INBOX always exists, no need to check for it here.


M	src/pop3/pop3-client.c

2013-02-16 17:17:14 +0200 Timo Sirainen <tss@iki.fi> (3442174)

    dsync: Merge last-common-* values from both local and remote when they
    differ.


M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox-state.h

2013-02-16 16:47:40 +0200 Timo Sirainen <tss@iki.fi> (0e03baa)

    dsync: -l parameter locking is now done on the server with "lower" hostname.
    This allows running multi-master replication on two servers without two
    dsyncs mixing up changes by running at the same time.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h

2013-02-16 16:45:47 +0200 Timo Sirainen <tss@iki.fi> (264c6bd)

    dsync: If unexpected changes happen during sync, return a safe
    last-common-uid for state.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-16 16:44:13 +0200 Timo Sirainen <tss@iki.fi> (54b50eb)

    dsync: Don't hide the final error messages from remote.


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-16 14:51:50 +0200 Timo Sirainen <tss@iki.fi> (c3aebe3)

    dsync: Fixed last-common-uid lookup when local UID was expunged but remote
    wasn't.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-16 14:09:42 +0200 Timo Sirainen <tss@iki.fi> (fadb1a3)

    dsync: Assert-crashfix for previous importer changes.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-16 13:58:14 +0200 Timo Sirainen <tss@iki.fi> (03860f6)

    lib-index: Avoid getting expunged-status in index lookups when not
    necessary. This especially improves dsync performance.


M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-transaction.c

2013-02-16 13:51:05 +0200 Timo Sirainen <tss@iki.fi> (03010db)

    mdbox, mbox, virtual: Avoid getting expunged-status in index lookups when
    not necessary. This especially improves dsync performance with mdbox.


M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-sync.c

2013-02-16 13:38:10 +0200 Timo Sirainen <tss@iki.fi> (e49e973)

    lib-index: Don't lookup mail's expunge-state in transaction log view if
    caller doesn't care. This was especially bad with dsync, which could trigger
    sorting of the expunges array each time after processing a mail (=
    potentially tens of thousands of sorts).


M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-view.c

2013-02-16 13:34:13 +0200 Timo Sirainen <tss@iki.fi> (b09eaeb)

    lib-storage: Assert-crash if mailbox_save_context isn't properly freed
    before reusing.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2013-02-16 13:32:57 +0200 Timo Sirainen <tss@iki.fi> (385b27e)

    mdbox: mailbox_copy() didn't properly free the save context.


M	src/lib-storage/index/dbox-multi/mdbox-save.c

2013-02-16 13:32:57 +0200 Timo Sirainen <tss@iki.fi> (08df28a)

    mdbox: mailbox_copy() didn't properly free the save context.


M	src/lib-storage/index/dbox-multi/mdbox-save.c

2013-02-16 13:31:37 +0200 Timo Sirainen <tss@iki.fi> (0c47c20)

    dsync: Various importer fixes.


M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2013-02-16 08:09:41 +0200 Timo Sirainen <tss@iki.fi> (0b39c7b)

    fts-solr: Don't assert-crash on failures.


M	src/plugins/fts-solr/solr-connection.c

2013-02-16 08:01:10 +0200 Timo Sirainen <tss@iki.fi> (d52f5dc)

    dsync: Avoid possibly long function recursion.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-16 08:00:51 +0200 Timo Sirainen <tss@iki.fi> (ba98350)

    dsync: Don't log "remote failed with 75" if we already logged an error from
    remote. This reduces number of log lines when dsync fails.


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-16 07:59:44 +0200 Timo Sirainen <tss@iki.fi> (d42cfc2)

    dsync: Don't log a redundant "importing mailbox failed" error.


M	src/doveadm/dsync/dsync-brain-mails.c

2013-02-16 07:53:17 +0200 Timo Sirainen <tss@iki.fi> (7a6136f)

    dsync: Don't log read() failed: EOF when remote intentionally fails early.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-02-16 07:15:55 +0200 Timo Sirainen <tss@iki.fi> (d9b9687)

    dsync: Various importer fixes. Handle unexpectedly wrong mailbox state
    better.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2013-02-16 07:12:18 +0200 Timo Sirainen <tss@iki.fi> (1bf8e5a)

    dsync: Wait for child process to close only after closing the stdin/out/err
    to it. Otherwise the ssh process doesn't shutdown.


M	src/doveadm/dsync/doveadm-dsync.c

2013-02-13 12:43:34 +0200 Timo Sirainen <tss@iki.fi> (26b9962)

    fs layout: Don't assert-crash if namespace prefix begins with the separator.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2013-02-13 11:27:32 +0100 Timo Sirainen <tss@iki.fi> (50ecf65)

    Renamed quota_last_extra to quota_grace.


M	NEWS
M	doc/example-config/conf.d/90-quota.conf
M	src/plugins/quota/quota.c

2013-02-13 12:22:22 +0200 Timo Sirainen <tss@iki.fi> (ac1c78c)

    auth: When receiving SIGUSR2 log also about current cache usage.


M	src/auth/auth-cache.c

2013-02-11 03:13:45 +0200 Timo Sirainen <tss@iki.fi> (57c78fc)

    NEWS, example-config: Add a note about quota_last_extra


M	NEWS
M	doc/example-config/conf.d/90-quota.conf

2013-02-11 03:07:24 +0200 Timo Sirainen <tss@iki.fi> (a2f5f69)

    quota: Use quota_last_extra only for LDA/LMTP (not for IMAP).


M	src/plugins/quota/quota.c

2013-02-11 03:03:12 +0200 Timo Sirainen <tss@iki.fi> (342a501)

    lib-lda: Assert-crashfix when sending a rejection mail failed.


M	src/lib-lda/smtp-client.c

2013-02-11 03:02:49 +0200 Timo Sirainen <tss@iki.fi> (bc7a4cf)

    quota: Added quota_last_extra setting, which defaults to 10% This can be
    used to save the last message when user is almost over quota. So by default
    the last message can bring the quota over 10% of the total quota limit. The
    setting allows also explicit values. Setting it to 0 brings it back to
    previous behavior.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2013-02-11 02:03:43 +0200 Timo Sirainen <tss@iki.fi> (7b9197b)

    lib-imap-urlauth: Use MAILBOX_ATTRIBUTE_PREFIX_DOVECOT for the imap-urlauth
    key.


M	src/lib-imap-urlauth/imap-urlauth-backend.c

2013-02-11 02:03:13 +0200 Timo Sirainen <tss@iki.fi> (440b8b6)

    lib-storage: Added MAILBOX_ATTRIBUTE_DOVECOT_PREFIX macro.


M	src/lib-storage/mail-storage.h

2013-02-11 01:43:25 +0200 Stephan Bosch <stephan@rename-it.nl> (2d7df79)

    fts-solr: Use built-in lib-http instead of libcurl. Removed libcurl
    dependency.


M	configure.ac
M	src/plugins/fts-solr/Makefile.am
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-solr/solr-connection.h

2013-02-11 01:22:51 +0200 Timo Sirainen <tss@iki.fi> (8576eb5)

    dsync: Minor fix to deciding when to use GUIDs vs. header hashes.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-02-11 01:10:57 +0200 Timo Sirainen <tss@iki.fi> (975a784)

    dsync: Fixes for syncing without GUIDs.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2013-02-11 01:07:53 +0200 Timo Sirainen <tss@iki.fi> (ccaaf18)

    dsync: When doing a header-based sync, convert all linefeeds to LFs. Fixes
    syncing where one side used CRLFs and the other side used LFs.


M	src/doveadm/dsync/dsync-mail.c

2013-02-11 00:29:40 +0200 Timo Sirainen <tss@iki.fi> (30c795b)

    i_stream_sync() for file should reset eof flag immediately.


M	src/lib/istream-file.c

2013-02-11 00:28:28 +0200 Timo Sirainen <tss@iki.fi> (979d89c)

    dsync: Automatically figure out which mailboxes can sync with message GUIDs.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mailbox.h

2013-02-11 00:26:15 +0200 Timo Sirainen <tss@iki.fi> (8b31f96)

    lib-storage: Added mailbox_status.have_guids flag


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2013-02-11 00:25:29 +0200 Timo Sirainen <tss@iki.fi> (fee8ee5)

    lib-storage: Minor code cleanup


M	src/lib-storage/fail-mailbox.c

2013-02-11 00:24:56 +0200 Timo Sirainen <tss@iki.fi> (f0efc5a)

    lib-storage: Don't unnecessarily clear mailbox_status multiple times.


M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/list/mailbox-list-index-status.c

2013-02-11 00:23:07 +0200 Timo Sirainen <tss@iki.fi> (458e154)

    lib-storage: mailbox_status.nonpermanent_modseqs is now only set with
    STATUS_HIGHESTMODSEQ


M	src/lib-storage/index/index-status.c

2013-02-10 23:27:49 +0200 Timo Sirainen <tss@iki.fi> (271ba0b)

    dsync: When looking up header hashes, use only Date: and Message-Id: headers
    This makes it more efficient, at least in future when imapc backend
    optimizes this.


M	src/doveadm/dsync/dsync-mail.c

2013-02-10 23:11:52 +0200 Timo Sirainen <tss@iki.fi> (887a9fb)

    dsync: Renamed "guid_requests" to "mail_requests" The mails aren't
    necessarily requested by their GUID.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c

2013-02-10 23:09:55 +0200 Timo Sirainen <tss@iki.fi> (c267b52)

    dsync: Removed unused DSYNC_MAILBOX_IMPORT_FLAG_MAILS_HAVE_GUIDS flag.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2013-02-10 23:05:46 +0200 Timo Sirainen <tss@iki.fi> (266fdb2)

    dsync: Fixed mailbox tree sync with some backends (imapc)


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2013-02-08 16:42:21 +0200 Timo Sirainen <tss@iki.fi> (183aac2)

    mdbox: Crashfix for storage rebuild


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2013-02-08 15:05:40 +0200 Timo Sirainen <tss@iki.fi> (9aac330)

    Added signature for changeset fc75811f3c08


M	.hgsigs

2013-02-08 15:05:37 +0200 Timo Sirainen <tss@iki.fi> (154dd25)

    Added tag 2.1.15 for changeset fc75811f3c08


M	.hgtags

2013-02-08 15:05:36 +0200 Timo Sirainen <tss@iki.fi> (b2aa4ea)

    Released v2.1.15.


M	NEWS
M	configure.in

2013-02-06 19:00:52 +0200 Timo Sirainen <tss@iki.fi> (386fe82)

    lib-storage: Convert INBOX to uppercase also when namespace has inbox=no.
    This fixes assert-crash in mailbox_check_mismatching_separators().


M	src/lib-storage/mail-storage.c

2013-02-06 18:29:22 +0200 Timo Sirainen <tss@iki.fi> (4f7fea3)

    lib-index: Avoid assert-crashing later if mmap(dovecot.index.cache) fails.


M	src/lib-index/mail-cache.c

2013-02-05 16:48:29 +0200 Timo Sirainen <tss@iki.fi> (30fc0b1)

    lmtp: If verbose_proctitle=yes, update the process state in the title.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2013-02-05 03:53:40 +0200 Timo Sirainen <tss@iki.fi> (9c32eb2)

    lib-storage: Changed mailbox_attribute_get() to return a struct for value.
    This allows returning flags for the values in future. Mainly readonly-flag
    for internal attributes and when restricted by ACL plugin.


M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2013-02-05 03:37:47 +0200 Timo Sirainen <tss@iki.fi> (d11111f)

    lib-fs: Changed FS_OPEN_FLAG_UNIMPORTANT to a reversed FS_OPEN_FLAG_FSYNC.
    This explains its behavior better.


M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-posix.c
M	src/lib-storage/index/index-attachment.c

2013-02-05 03:30:01 +0200 Timo Sirainen <tss@iki.fi> (6772f52)

    fs-metawrap: Don't duplicate work if fs_get_metadata() is called multiple
    times.


M	src/lib-fs/fs-metawrap.c
M	src/lib-fs/istream-metawrap.c

2013-02-05 03:24:45 +0200 Timo Sirainen <tss@iki.fi> (a4d7969)

    cydir, dbox, maildir: Don't leak the stream if mail.istream_opened() fails


M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/maildir/maildir-mail.c

2013-02-05 03:23:59 +0200 Timo Sirainen <tss@iki.fi> (67641f4)

    lib-index: Memory leak fix


M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/test-mail-index-transaction-update.c

2013-02-05 03:23:46 +0200 Timo Sirainen <tss@iki.fi> (0e6e2c5)

    fs-metawrap: Memory leak fixes


M	src/lib-fs/fs-metawrap.c

2013-02-05 03:23:30 +0200 Timo Sirainen <tss@iki.fi> (ef064b2)

    lib-fs: Avoid memory leaks if file was closed before fs_read()/fs_copy() was
    finished.


M	src/lib-fs/fs-api.c

2013-02-05 01:16:48 +0200 Timo Sirainen <tss@iki.fi> (26aa7d1)

    fs-metawrap: Set underlying file async only for fs_read_stream() lookups.


M	src/lib-fs/fs-metawrap.c

2013-02-04 22:15:59 +0200 Timo Sirainen <tss@iki.fi> (c096257)

    iostream-temp: Set a name for the returned istream.


M	src/lib/iostream-temp.c

2013-02-04 22:07:14 +0200 Timo Sirainen <tss@iki.fi> (4521d35)

    lib-http: If http_client_request_set_payload() fails to get stream size, log
    an error.


M	src/lib-http/http-client-request.c

2013-02-04 22:03:10 +0200 Timo Sirainen <tss@iki.fi> (e44028b)

    iostream-temp: Don't try to dup() the stream fd if it's already closed.


M	src/lib/iostream-temp.c

2013-02-04 22:02:42 +0200 Timo Sirainen <tss@iki.fi> (deed044)

    fs-metawrap: Delay writing the metadata headers until first data is written.
    Also some other read/write fixes.


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-metawrap.c
A	src/lib-fs/ostream-metawrap.c
A	src/lib-fs/ostream-metawrap.h

2013-02-04 20:18:22 +0200 Timo Sirainen <tss@iki.fi> (a06af8e)

    lib-fs: Added FS_OPEN_FLAG_SEEKABLE. Globally handle fs_read_stream()
    seekability and waits.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-metawrap.c

2013-02-04 20:17:14 +0200 Timo Sirainen <tss@iki.fi> (05d8038)

    fs-metawrap: Fixed stat() to work when parent file's input stream didn't
    have a parent.


M	src/lib-fs/fs-metawrap.c

2013-02-04 20:15:32 +0200 Timo Sirainen <tss@iki.fi> (5ca0738)

    fs-metawrap: Error handling fixes


M	src/lib-fs/fs-metawrap.c

2013-02-04 20:14:16 +0200 Timo Sirainen <tss@iki.fi> (b2c16f3)

    i_stream_create(): Copy stream_errno/eof immediately from the parent stream.
    This makes wrapper istream behavior more reliable when the original istream
    is an istream-error.


M	src/lib/istream.c

2013-02-04 20:13:26 +0200 Timo Sirainen <tss@iki.fi> (d5b3f66)

    istream: Fail in the default stat() implementation if stream_errno is set.


M	src/lib/istream.c

2013-02-04 20:12:10 +0200 Timo Sirainen <tss@iki.fi> (2a8b891)

    istream-seekable: Fail stat() if stream_errno is set.


M	src/lib/istream-seekable.c

2013-02-04 20:10:59 +0200 Timo Sirainen <tss@iki.fi> (4124beb)

    lib-http: Added http_client_request_set_destroy_callback() This is useful
    for io_remove()ing the payload stream's fd at the right time.


M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.h

2013-02-04 18:17:21 +0200 Timo Sirainen <tss@iki.fi> (c911297)

    lib-http: Added http_url_escape_param()


M	src/lib-http/http-url.c
M	src/lib-http/http-url.h

2013-02-04 17:06:40 +0200 Timo Sirainen <tss@iki.fi> (97144a3)

    lib-index: Bug in cache file size verification caused the whole cache file
    to be mapped.


M	src/lib-index/mail-cache.c

2013-02-04 16:10:50 +0200 Timo Sirainen <tss@iki.fi> (722a8fc)

    lib-storage: If message parser's input stream is closed early, don't treat
    it as error. This seems to happen sometimes during message saving(?),
    although I'm not exactly sure why. In any case it shouldn't log an error
    about it. This behavior is probably better than failing. The caller should
    be the one to figure out if saving has failed or not.


M	src/lib-storage/index/index-mail.c

2013-02-04 16:03:54 +0200 Timo Sirainen <tss@iki.fi> (e41e4ac)

    imap: Set [io]stream name for imap client connections.


M	src/imap/imap-client.c

2013-02-04 15:59:50 +0200 Timo Sirainen <tss@iki.fi> (d3e02d9)

    istream-tee: Copy the parent stream's name to child streams.


M	src/lib/istream-tee.c

2013-02-04 15:59:12 +0200 Timo Sirainen <tss@iki.fi> (8f28cbe)

    i_stream_close(): Set stream_errno to EPIPE instead of ENOENT.


M	src/lib/istream.c

2013-02-03 21:53:24 +0200 Timo Sirainen <tss@iki.fi> (baf346e)

    iostream-temp: Avoid copying data if IOSTREAM_TEMP_FLAG_TRY_FD_DUP is set.


M	src/lib/iostream-temp.c
M	src/lib/iostream-temp.h

2013-02-03 21:52:48 +0200 Timo Sirainen <tss@iki.fi> (d14e62b)

    i_stream_create_error() should have set eof=TRUE immediately.


M	src/lib/istream.c

2013-02-03 21:52:19 +0200 Timo Sirainen <tss@iki.fi> (f6754d9)

    lib-fs: fs_write_stream_finish(file, NULL) is now alias to
    fs_write_stream_finish_async(file) This makes wrapper implementations
    easier.


M	src/lib-fs/fs-api.c

2013-02-03 21:51:40 +0200 Timo Sirainen <tss@iki.fi> (1c9cfe7)

    lib-fs: fs-posix now allows reading from the same file that was created.


M	src/lib-fs/fs-posix.c

2013-02-03 21:48:58 +0200 Timo Sirainen <tss@iki.fi> (0e1b468)

    lib-fs: istream-metawrap is a bit more flexible now, allowing stat()ing and
    reading from fd


M	src/lib-fs/istream-metawrap.c

2013-02-02 22:21:36 +0200 Timo Sirainen <tss@iki.fi> (5b7cf8d)

    fts-solr: Compile warning fix


M	src/plugins/fts-solr/fts-solr-plugin.c

2013-02-02 17:02:55 +0200 Timo Sirainen <tss@iki.fi> (5a580c3)

    Oops :) Update copyrights to 2013 without breaking all .c files.


M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-fields.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-token.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-dovecot-token.c
M	src/auth/mech-external.c
M	src/auth/mech-plain.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-template.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c
M	src/auth/test-auth-cache.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-template.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-pw.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-deserializer.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-serializer.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-login-settings.c
M	src/imap-urlauth/imap-urlauth-login.c
M	src/imap-urlauth/imap-urlauth-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap-urlauth/imap-urlauth.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-genurlauth.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-resetkey.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-uid.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-urlfetch.c
M	src/imap/cmd-x-cancel.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-list.c
M	src/imap/imap-notify.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-settings.c
M	src/indexer/indexer-worker-settings.c
M	src/indexer/indexer-worker.c
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-pool.c
M	src/ipc/client.c
M	src/ipc/ipc-connection.c
M	src/ipc/ipc-group.c
M	src/ipc/ipc-settings.c
M	src/ipc/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-compression/compression.c
M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-zlib.c
M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict-transaction-memory.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-test.c
M	src/lib-fs/istream-metawrap.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-date.c
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-url.c
M	src/lib-http/test-http-client.c
M	src/lib-http/test-http-date.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-transfer.c
M	src/lib-http/test-http-url.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-bodystructure.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-url.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/mail-user-hash.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-binary-part.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-size.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-mail/test-istream-binary-converter.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service.c
M	src/lib-master/mountpoint-list.c
M	src/lib-master/syslog-util.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl-none.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/fail-mail.c
M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-notify-tree.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list-notify.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/test-mailbox-get.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base64.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/compat.c
M	src/lib/connection.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fd-set-nonblock.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/guid.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-temp.c
M	src/lib/iostream.c
M	src/lib/iso8601-date.c
M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/istream-jsonstr.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/istream-sized.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/json-parser.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/net.c
M	src/lib/nfs-workarounds.c
M	src/lib/numpack.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/primes.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base64.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-hash-format.c
M	src/lib/test-hex-binary.c
M	src/lib/test-iso8601-date.c
M	src/lib/test-istream-base64-decoder.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-json-parser.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-network.c
M	src/lib/test-numpack.c
M	src/lib/test-ostream-file.c
M	src/lib/test-primes.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-time-util.c
M	src/lib/test-unichar.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/time-util.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/uri-util.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/doveadm-connection.c
M	src/log/log-connection.c
M	src/log/log-error-buffer.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/capabilities-posix.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search-serialize.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/xml2text.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/mailbox-alias/mailbox-alias-plugin.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-storage.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/replication/aggregator/aggregator-settings.c
M	src/replication/aggregator/aggregator.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/notify-connection.c
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-openssl.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/stats/client-export.c
M	src/stats/client.c
M	src/stats/global-memory.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-server-connection.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.c
M	src/stats/mail-user.c
M	src/stats/main.c
M	src/stats/stats-settings.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2013-02-02 17:01:07 +0200 Timo Sirainen <tss@iki.fi> (cca4ba2)

    Updated copyright notices to include year 2013.


M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-fields.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-token.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-dovecot-token.c
M	src/auth/mech-external.c
M	src/auth/mech-plain.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-template.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c
M	src/auth/test-auth-cache.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-dict.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-template.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-pw.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-zlib.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-deserializer.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-serializer.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-login-settings.c
M	src/imap-urlauth/imap-urlauth-login.c
M	src/imap-urlauth/imap-urlauth-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap-urlauth/imap-urlauth.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-genurlauth.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-notify.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-resetkey.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-uid.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-urlfetch.c
M	src/imap/cmd-x-cancel.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-list.c
M	src/imap/imap-notify.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-settings.c
M	src/indexer/indexer-worker-settings.c
M	src/indexer/indexer-worker.c
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-pool.c
M	src/ipc/client.c
M	src/ipc/ipc-connection.c
M	src/ipc/ipc-group.c
M	src/ipc/ipc-settings.c
M	src/ipc/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-compression/compression.c
M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-zlib.c
M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict-transaction-memory.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-test.c
M	src/lib-fs/istream-metawrap.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-date.c
M	src/lib-http/http-header-parser.c
M	src/lib-http/http-parser.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-url.c
M	src/lib-http/test-http-client.c
M	src/lib-http/test-http-date.c
M	src/lib-http/test-http-header-parser.c
M	src/lib-http/test-http-response-parser.c
M	src/lib-http/test-http-transfer.c
M	src/lib-http/test-http-url.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-bodystructure.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-url.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/mail-user-hash.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-binary-part.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-size.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-mail/test-istream-binary-converter.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service.c
M	src/lib-master/mountpoint-list.c
M	src/lib-master/syslog-util.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl-none.c
M	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/fail-mail.c
M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-notify-tree.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list-notify.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/test-mailbox-get.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base64.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/compat.c
M	src/lib/connection.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fd-set-nonblock.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/guid.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-temp.c
M	src/lib/iostream.c
M	src/lib/ipwd.c
M	src/lib/iso8601-date.c
M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/istream-jsonstr.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/istream-sized.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/json-parser.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/net.c
M	src/lib/nfs-workarounds.c
M	src/lib/numpack.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/primes.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base64.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-hash-format.c
M	src/lib/test-hex-binary.c
M	src/lib/test-iso8601-date.c
M	src/lib/test-istream-base64-decoder.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-json-parser.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-network.c
M	src/lib/test-numpack.c
M	src/lib/test-ostream-file.c
M	src/lib/test-primes.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-time-util.c
M	src/lib/test-unichar.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/time-util.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/uri-util.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/doveadm-connection.c
M	src/log/log-connection.c
M	src/log/log-error-buffer.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/capabilities-posix.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search-serialize.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/xml2text.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/mailbox-alias/mailbox-alias-plugin.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-storage.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/replication/aggregator/aggregator-settings.c
M	src/replication/aggregator/aggregator.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/notify-connection.c
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-settings.c
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-openssl.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/stats/client-export.c
M	src/stats/client.c
M	src/stats/global-memory.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-server-connection.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.c
M	src/stats/mail-user.c
M	src/stats/main.c
M	src/stats/stats-settings.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2013-02-02 16:52:23 +0200 Timo Sirainen <tss@iki.fi> (683d9f2)

    fts-solr: Deinit solr connection at plugin unload.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/fts-solr-plugin.h

2013-02-02 00:31:44 +0200 Timo Sirainen <tss@iki.fi> (f3ef965)

    dbox: Fail if trying to create a mailbox that already exists.


M	src/lib-storage/index/dbox-common/dbox-storage.c

2013-02-01 02:25:18 +0200 Timo Sirainen <tss@iki.fi> (d62bcaa)

    fts-solr: Reverted previous change, it only crashes. The plugin is already
    unloaded at lib_atexit() time.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2013-02-01 02:18:54 +0200 Timo Sirainen <tss@iki.fi> (cdabead)

    fts-solr: Free the solr_connection at exit.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2013-02-01 01:39:41 +0200 Stephan Bosch <stephan@rename-it.nl> (eb325a5)

    lib-http: Various bugfixes


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-host.c
M	src/lib-http/http-client-peer.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-client.c
M	src/lib-http/http-client.h
M	src/lib-http/test-http-client.c

2013-02-01 01:03:05 +0200 Timo Sirainen <tss@iki.fi> (f01eb1f)

    auth: first/last_valid_uid settings shouldn't have had auth_ prefix.


M	src/auth/auth-settings.c
M	src/auth/auth-settings.h

2013-01-31 22:59:13 +0200 Timo Sirainen <tss@iki.fi> (4881b4b)

    ostream: If stream is closed with stream_errno=0, set it to EPIPE.


M	src/lib/ostream.c

2013-01-31 22:58:24 +0200 Timo Sirainen <tss@iki.fi> (d78be92)

    ostream: Default seek&write_at implementations should fail with ESPIPE, not
    EPIPE.


M	src/lib/ostream.c

2013-01-31 22:14:12 +0200 Timo Sirainen <tss@iki.fi> (ea664cc)

    replicator: Don't try to reuse doveadm connections (and have them
    immediately fail)


M	src/replication/replicator/doveadm-connection.c

2013-01-31 22:13:36 +0200 Timo Sirainen <tss@iki.fi> (e3b36e4)

    replicator plugin: Use non-blocking open for the replicator fifo. This fixes
    an infinite hang if the replicator process isn't running.


M	src/plugins/replication/replication-plugin.c

2013-01-31 21:49:00 +0200 Timo Sirainen <tss@iki.fi> (5c88745)

    replicator: Use locking when running dsync.


M	src/replication/replicator/doveadm-connection.c

2013-01-31 21:01:09 +0200 Timo Sirainen <tss@iki.fi> (3edcc1d)

    replicator: Crashfix at deinit


M	src/replication/replicator/replicator-brain.c

2013-01-31 19:58:34 +0200 Timo Sirainen <tss@iki.fi> (5446576)

    dsync: More fixes to merging flag/keyword changes.


M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-31 19:45:50 +0200 Timo Sirainen <tss@iki.fi> (5e46f82)

    doveadm fetch: Added "modseq" field.


M	src/doveadm/doveadm-mail-fetch.c

2013-01-31 19:45:33 +0200 Timo Sirainen <tss@iki.fi> (252f5c6)

    dsync: Fixed syncing message keywords. "add" and "final" can't be mixed
    together always without causing keywords to be added back unintentionally.


M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-31 19:44:28 +0200 Timo Sirainen <tss@iki.fi> (cf84825)

    dsync: If both local and remote have the same message flags, don't go
    changing them.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-31 19:05:55 +0200 Timo Sirainen <tss@iki.fi> (53c384b)

    dsync: When we know that remote does a flag update, try to guess the
    remote's new modseq and set it


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-31 18:47:20 +0200 Timo Sirainen <tss@iki.fi> (4aefbee)

    dsync: If mailbox UIDVALIDITY is 0, sync it to assign it instead of
    assert-crashing.


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2013-01-31 18:39:44 +0200 Timo Sirainen <tss@iki.fi> (59bf1df)

    dsync: Fixed syncing keyword removals.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-31 18:27:22 +0200 Timo Sirainen <tss@iki.fi> (a5f2ad4)

    lib-ssl-iostream: Pass the plain istream's fd to ssl_istream.


M	src/lib-ssl-iostream/istream-openssl.c

2013-01-31 18:17:10 +0200 Timo Sirainen <tss@iki.fi> (3878058)

    iostream-rawlog: Ignore 0 byte writes instead of assert-crashing.


M	src/lib/iostream-rawlog.c

2013-01-31 17:03:16 +0200 Timo Sirainen <tss@iki.fi> (6c3293c)

    dsync: Increased "remote cmd exit wait" from 5 to 30 seconds.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-31 17:01:46 +0200 Timo Sirainen <tss@iki.fi> (d097ad3)

    dsync: Ignore GUID mismatch on expunged message pair.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-31 00:27:17 +0200 Timo Sirainen <tss@iki.fi> (3bdc090)

    auth: Removed assert-checks, allowing plugins to set skip_password_check.


M	src/auth/auth-request.c

2013-01-31 00:14:28 +0200 Timo Sirainen <tss@iki.fi> (5bac469)

    dsync: If remote command child process doesn't die at exit, kill -9 it.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-30 23:45:10 +0200 Timo Sirainen <tss@iki.fi> (70d732b)

    Added signature for changeset b314c97d4bbf


M	.hgsigs

2013-01-30 23:45:06 +0200 Timo Sirainen <tss@iki.fi> (4b1041c)

    Added tag 2.1.14 for changeset b314c97d4bbf


M	.hgtags

2013-01-30 23:45:06 +0200 Timo Sirainen <tss@iki.fi> (e9cbc79)

    Released v2.1.14.


M	NEWS
M	configure.in

2013-01-30 23:24:20 +0200 Timo Sirainen <tss@iki.fi> (8521def)

    auth: Fixed compiling GSSAPI after recent changes.


M	src/auth/mech-gssapi.c

2013-01-30 22:44:48 +0200 Timo Sirainen <tss@iki.fi> (559f278)

    auth: Added passdb { result_* and skip } settings.

    passdb { skip = never | authenticated | unauthenticated } can be used to 
    skip over a passdb lookup based on previous passdb lookups.

    passdb { result_success, result_failure, result_internalfail } can be used 
    to specify what to do on those conditions. Choices as continue, continue-ok,
    continue-fail, return, return-ok, return-fail. The -ok and
    -fail variants update the current "success" flag, while continue/return uses 
    the current flag. The authentication succeeds only if the success flag is 
    set after the last lookup. The continue variants continue to the next 
    passdb, while return variants finish the lookup immediately.

M	src/auth/auth-fields.c
M	src/auth/auth-fields.h
M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/auth/auth-worker-client.c
M	src/auth/auth.c
M	src/auth/auth.h
M	src/auth/mech-gssapi.c
M	src/auth/passdb-blocking.c

2013-01-30 22:23:09 +0200 Timo Sirainen <tss@iki.fi> (c3e50b8)

    auth: Code cleanup: Renamed some fields used in internal communication with
    worker.


M	src/auth/auth-request.c

2013-01-30 22:19:13 +0200 Timo Sirainen <tss@iki.fi> (83d2e37)

    auth: Auth requests' flag fields were never passed to worker processes.


M	src/auth/auth-worker-client.c

2013-01-30 22:18:09 +0200 Timo Sirainen <tss@iki.fi> (420d037)

    auth: Fixed login USER reply broken by recent changes.


M	src/auth/auth-request-handler.c

2013-01-30 21:08:58 +0200 Timo Sirainen <tss@iki.fi> (31633d6)

    auth: Cleaned up flags in auth request. Removed those that already exist in
    extra_fields. It's now slightly slower to check for those flags in
    extra_fields, but it's going to be easier to make commit/rollback feature to
    extra_fields.


M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-worker-client.c
M	src/auth/db-checkpassword.c
M	src/auth/mech-gssapi.c
M	src/auth/passdb-dict.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-sql.c

2013-01-30 20:06:43 +0200 Timo Sirainen <tss@iki.fi> (32e0da4)

    auth: Allocate auth-fields array lazily. Also some naming cleanups.


M	src/auth/auth-fields.c
M	src/auth/auth-fields.h

2013-01-30 19:57:20 +0200 Timo Sirainen <tss@iki.fi> (ee6df95)

    auth: Code cleanup: Renamed auth-stream to auth-fields.


M	src/auth/Makefile.am
M	src/auth/auth-client-connection.c
R052	src/auth/auth-stream.c	src/auth/auth-fields.c
A	src/auth/auth-fields.h
M	src/auth/auth-master-connection.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
D	src/auth/auth-stream.h
M	src/auth/auth-worker-client.c
M	src/auth/db-checkpassword.c
M	src/auth/passdb-blocking.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb.h

2013-01-30 19:46:58 +0200 Timo Sirainen <tss@iki.fi> (2f35a2f)

    auth: Code cleanup: Merged extra_cache_fields into extra_fields. They are
    separated using a hidden-flag in the extra field. This required a new
    implementation for auth-streams.


M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-stream.c
M	src/auth/auth-stream.h
M	src/auth/auth-worker-client.c
M	src/auth/db-checkpassword.c
M	src/auth/userdb-blocking.c

2013-01-30 19:11:30 +0200 Timo Sirainen <tss@iki.fi> (273b7c4)

    auth: Code cleanup: Minor auth_stream API simplifications.


M	src/auth/auth-stream.c
M	src/auth/auth-stream.h

2013-01-30 19:08:00 +0200 Timo Sirainen <tss@iki.fi> (eb7b885)

    auth: Code cleanup: Avoid using auth_stream_reply as temporary strings.


M	src/auth/auth-client-connection.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-master-connection.h
M	src/auth/auth-request-handler.c
M	src/auth/auth-request-handler.h
M	src/auth/auth-request.c
M	src/auth/auth-request.h

2013-01-30 18:40:49 +0200 Timo Sirainen <tss@iki.fi> (cd5a70b)

    auth: Code cleanup: Removed unnecessary userdb_ prefix checks. The userdb_
    fields are nowadays placed to userdb_reply immediately.


M	src/auth/auth-request-handler.c
M	src/auth/auth-request.h

2013-01-30 18:35:02 +0200 Timo Sirainen <tss@iki.fi> (b0e9375)

    auth: Code cleanup: Removed unnecessary auth_stream_reply usage from
    auth-worker communication.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-stream.c
M	src/auth/auth-stream.h
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth-worker-server.h
M	src/auth/passdb-blocking.c
M	src/auth/userdb-blocking.c

2013-01-30 18:12:23 +0200 Timo Sirainen <tss@iki.fi> (7926d22)

    auth: Code cleanup - removed auth_stream_split()


M	src/auth/auth-request.c
M	src/auth/auth-stream.c
M	src/auth/auth-stream.h

2013-01-29 17:55:20 +0200 Timo Sirainen <tss@iki.fi> (b14bdce)

    lib-index: Fixed invalidating buffered cache file with map_with_read.


M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache.c

2013-01-29 13:31:05 +0200 Timo Sirainen <tss@iki.fi> (c2a800e)

    README: Added RFC 6851


M	README

2013-01-28 14:37:59 +0200 Timo Sirainen <tss@iki.fi> (b66f5d5)

    lib-storage: Allow mail_storage_copy_error() with the same source and dest.
    If it was used without checking it would try to free the error string and
    after that strdup() it.


M	src/lib-storage/mail-storage.c

2013-01-28 13:56:24 +0200 Timo Sirainen <tss@iki.fi> (f5d3d7a)

    dsync: When syncing locally, mailbox_copy() the mail to attempt a fast copy.


M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-28 13:48:09 +0200 Timo Sirainen <tss@iki.fi> (620be64)

    dsync: Fixed syncing locally when GUIDs weren't available.


M	src/doveadm/dsync/dsync-ibc-pipe.c

2013-01-24 16:30:33 +0200 Timo Sirainen <tss@iki.fi> (f9c0883)

    lib-storage: Fixed mailbox_exists() for LAYOUT=index.


M	src/lib-storage/index/index-storage.c

2013-01-22 16:53:52 +0200 Timo Sirainen <tss@iki.fi> (9bd08aa)

    lib-index: Fixes to handling broken cache records that point outside file.
    Especially try to avoid failing by trying to allocate gigabytes of memory.


M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache.c

2013-01-22 16:31:17 +0200 Timo Sirainen <tss@iki.fi> (49be238)

    lib-storage: Catch input stream errors when parsing mail.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2013-01-22 12:59:32 +0200 Timo Sirainen <tss@iki.fi> (63f01d5)

    dsync: Error handling crashfix


M	src/doveadm/dsync/dsync-brain-mailbox.c

2013-01-22 12:59:22 +0200 Timo Sirainen <tss@iki.fi> (6bb1283)

    imapc: Handle mailbox_update() when possible, instead of always just
    failing.


M	src/lib-storage/index/imapc/imapc-storage.c

2013-01-22 12:58:56 +0200 Timo Sirainen <tss@iki.fi> (14e45b9)

    imapc: Return INTERNALDATE as save-date (better than error).


M	src/lib-storage/index/imapc/imapc-mail.c

2013-01-22 12:49:04 +0200 Timo Sirainen <tss@iki.fi> (40c0aad)

    imapc: Avoid unnecessarily selecting a mailbox when looking up its GUID.


M	src/lib-storage/index/imapc/imapc-storage.c

2013-01-21 19:45:13 +0200 Timo Sirainen <tss@iki.fi> (16349f1)

    Increased initial memory pool sizes.


M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/lib-storage/index/index-status.c

2013-01-21 19:43:39 +0200 Timo Sirainen <tss@iki.fi> (9eef11d)

    dsync: Added a quick way to debug unexpected changes.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-21 19:41:24 +0200 Timo Sirainen <tss@iki.fi> (0393617)

    dsync: Fixes to handling storage formats that don't use 128bit GUIDs.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-21 18:33:55 +0200 Timo Sirainen <tss@iki.fi> (f86f5b0)

    dict-cdb: Handle cdb_read() errors.


M	src/lib-dict/dict-cdb.c

2013-01-21 18:31:08 +0200 Timo Sirainen <tss@iki.fi> (09b15d7)

    dict: Added support for cdb backend. Based on patch by Hleb Valoshka.


M	configure.ac
M	src/dict/main.c
M	src/lib-dict/Makefile.am
A	src/lib-dict/dict-cdb.c
M	src/lib-dict/dict-private.h

2013-01-21 18:12:41 +0200 Timo Sirainen <tss@iki.fi> (c9dcbfe)

    dsync: Fixed infinite loop when message suddenly got expunged.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-21 18:12:12 +0200 Timo Sirainen <tss@iki.fi> (1731683)

    lib-index: Fixed sorting appended messages when some were assigned new UIDs.


M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c

2013-01-21 17:57:18 +0200 Timo Sirainen <tss@iki.fi> (1c95b84)

    dsync: If remote doesn't send some message bodies, log an error about each
    one separately.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-21 17:56:36 +0200 Timo Sirainen <tss@iki.fi> (471a6b2)

    dsync backup: Old unwanted messages weren't deleted as they should have.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-21 17:45:18 +0200 Timo Sirainen <tss@iki.fi> (1e16e4f)

    lib-index: mail_transaction_log_view_set_all() didn't necessarily scan
    .log.2 file.


M	src/lib-index/mail-transaction-log-view.c

2013-01-21 17:44:16 +0200 Timo Sirainen <tss@iki.fi> (45ce71b)

    dsync: GUIDs weren't set properly to expunge records, causing non-optimal
    behavior.


M	src/doveadm/dsync/dsync-transaction-log-scan.c

2013-01-21 16:57:49 +0200 Timo Sirainen <tss@iki.fi> (89f0ab8)

    dsync: Fixed crashes when sending already expunged messages.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-21 16:52:49 +0200 Timo Sirainen <tss@iki.fi> (cd70f7a)

    dsync: Verify messages' GUIDs better.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-21 16:44:33 +0200 Timo Sirainen <tss@iki.fi> (a0b769a)

    dsync: Fixed syncing to non-remote locations.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-21 14:43:09 +0200 Timo Sirainen <tss@iki.fi> (84669c7)

    lib-fs: Added "metawrap" wrapper to implement metadata as headers in the
    file content.


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
A	src/lib-fs/fs-metawrap.c
A	src/lib-fs/istream-metawrap.c
A	src/lib-fs/istream-metawrap.h

2013-01-21 14:42:10 +0200 Timo Sirainen <tss@iki.fi> (c0b1543)

    i_stream_read_next_line() should have also set eof=TRUE on ENOBUFS errors.


M	src/lib/istream.c

2013-01-21 14:19:21 +0200 Timo Sirainen <tss@iki.fi> (3dcb9fd)

    lib-fs: fs_file_path() is now a virtual function. This fixes it returning
    the correct filename when file was created using
    FS_OPEN_MODE_CREATE_UNIQUE_128 and a wrapper fs.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2013-01-21 11:40:38 +0200 Timo Sirainen <tss@iki.fi> (63e94e8)

    lib-fs: Added flags to iteration, and FS_ITER_FLAG_DIRS as the first flag.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/fs-test.c

2013-01-17 09:00:54 +0200 Timo Sirainen <tss@iki.fi> (2a15ce3)

    doveadm: Compiling fix


M	src/doveadm/doveadm-mail.h

2013-01-16 12:02:18 +0200 Timo Sirainen <tss@iki.fi> (badb675)

    sdbox: Fixed rebuilding index when UIDVALIDITY is missing.


M	src/lib-storage/index/dbox-single/sdbox-sync.c

2013-01-16 09:15:38 +0200 Timo Sirainen <tss@iki.fi> (c97431c)

    sdbox: next-uid may have been set wrong when rebuilding indexes for empty
    mailbox.


M	src/lib-storage/index/index-rebuild.c

2013-01-16 08:01:40 +0200 Timo Sirainen <tss@iki.fi> (dc71027)

    dsync_remote_cmd: The -l parameter no longer exists.


M	src/doveadm/doveadm-settings.c

2013-01-15 08:39:30 +0200 Timo Sirainen <tss@iki.fi> (4a49e25)

    lib-index: Newly added messages weren't always sorted by UIDs.


M	src/lib-index/mail-index-transaction-update.c

2013-01-15 08:30:57 +0200 Timo Sirainen <tss@iki.fi> (612c477)

    dovecot-config: Removed unnecessary/duplicate ssl library links.


M	Makefile.am
M	configure.ac

2013-01-15 08:30:03 +0200 Timo Sirainen <tss@iki.fi> (8e4a702)

    buffer: Always keep +1 byte available for str_c()'s NUL.


M	src/lib/Makefile.am
M	src/lib/buffer.c
M	src/lib/str.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-str.c

2013-01-14 18:24:19 +0200 Timo Sirainen <tss@iki.fi> (4b6ec04)

    lib-index: Added asserts.


M	src/lib-index/mail-index-transaction-finish.c

2013-01-14 17:58:09 +0200 Timo Sirainen <tss@iki.fi> (e925f00)

    lib-index: Fixed marking transaction log file corrupted due to added
    O_APPEND flag.


M	src/lib-index/mail-transaction-log-file.c

2013-01-14 13:01:33 +0200 Timo Sirainen <tss@iki.fi> (f6aaa31)

    doveadm acl: Added "recalc" command to rebuild acl_lookup_dict for the user.


M	src/plugins/acl/doveadm-acl.c

2013-01-14 12:56:09 +0200 Timo Sirainen <tss@iki.fi> (c952f36)

    doveadm user: Avoid initializing the user as much as possible.


M	src/doveadm/doveadm-auth.c

2013-01-14 08:38:36 +0200 Timo Sirainen <tss@iki.fi> (29a6405)

    example-config: Added mail_attribute_dict


M	doc/example-config/conf.d/10-mail.conf

2013-01-14 08:01:47 +0200 Timo Sirainen <tss@iki.fi> (f5d8b6d)

    Several fixes to handling "istream input line too long" conditions.


M	src/auth/db-passwd-file.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/server-connection.c
M	src/lib-lda/lmtp-client.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-script.c

2013-01-14 07:57:39 +0200 Timo Sirainen <tss@iki.fi> (a0b6b44)

    i_stream_read_next_line() now sets stream_errno=ENOBUFS if input buffer gets
    full. Previously the caller couldn't easily separate this condition from
    "more data needed", potentially causing infinite loops.


M	src/lib/istream.c
M	src/lib/istream.h

2013-01-13 19:15:37 +0200 Timo Sirainen <tss@iki.fi> (44d5bf8)

    doveadm: Increased doveadm client's max command line length.


M	src/doveadm/client-connection.c

2013-01-11 06:18:36 +0200 Timo Sirainen <tss@iki.fi> (90b2203)

    lib-imap-storage: Removed broken optimization for seeking to partial offset.
    The optimization worked only when physical_start=0. It would have been
    possible to fix it by finding the message_part where its header of body
    offset is physical_start and only then start decreasing virtual_skip, but
    probably too much complexity to be worth the trouble, especially since
    clients rarely would benefit from this optimization.


M	src/lib-imap-storage/imap-msgpart.c

2013-01-11 03:59:50 +0200 Timo Sirainen <tss@iki.fi> (e689e77)

    lib-imap-storage: Added imap_msgpart_get_partial_size() missing from
    previous commit.


M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h

2013-01-11 03:58:54 +0200 Timo Sirainen <tss@iki.fi> (00ad194)

    imap: Improved unexpected FETCH error messages.


M	src/imap/imap-fetch-body.c

2013-01-10 14:20:07 +0200 Timo Sirainen <tss@iki.fi> (aa7a400)

    dsync: Added "remoteprefix:" destination, which is same as "remote:" except
    sends "username\n" prefix.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-10 14:00:10 +0200 Timo Sirainen <tss@iki.fi> (437421e)

    dsync: Wait for remote command to finish before shutting down. This makes
    sure that any error messages during deinit stage are logged. Also non-zero
    exit codes are logged.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-10 13:56:59 +0200 Timo Sirainen <tss@iki.fi> (b991ad9)

    dsync server: Fixed crash at deinit


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-10 12:12:50 +0200 Timo Sirainen <tss@iki.fi> (f476a2a)

    dsync: Close mail streams earlier on failures to avoid assert-crashing


M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-private.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-ibc.h

2013-01-10 11:52:27 +0200 Timo Sirainen <tss@iki.fi> (a58e63b)

    lib-storage: Maildir++ layout shouldn't disallow "cur", "new" or "tmp"
    mailbox names.


M	src/lib-storage/mailbox-list.c

2013-01-10 10:23:44 +0200 Timo Sirainen <tss@iki.fi> (dbc8674)

    lib-storage: Improved "Using permissions" debug message.


M	src/lib-storage/mailbox-list.c

2013-01-10 10:21:27 +0200 Timo Sirainen <tss@iki.fi> (4306246)

    dsync: Added support back for dsync locking. Only the source directory is
    now locked to avoid deadlocks when both source and destination are locked.
    This of course now means that both source and destination is allowed to run
    dsync at the same time, which isn't ideal either..


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-10 10:02:47 +0200 Timo Sirainen <tss@iki.fi> (113ad88)

    dsync: Attempt to preserve \Recent flag as well


M	src/doveadm/dsync/dsync-mailbox-export.c

2013-01-10 09:33:19 +0200 Timo Sirainen <tss@iki.fi> (875d530)

    dsync: Handle syncing mailboxes with same name but different GUIDs.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2013-01-10 08:07:19 +0200 Timo Sirainen <tss@iki.fi> (183b3fb)

    dsync: Removed unnecessary -n parameter from dsync-server. The setting is
    sent within dsync protocol.


M	src/doveadm/doveadm-settings.c
M	src/doveadm/dsync/doveadm-dsync.c

2013-01-10 07:54:39 +0200 Timo Sirainen <tss@iki.fi> (593bf2d)

    replicator: Use stateful dsyncing whenever possible.


M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/doveadm-connection.h
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue.c
M	src/replication/replicator/replicator-queue.h

2013-01-10 07:53:26 +0200 Timo Sirainen <tss@iki.fi> (97ad3ca)

    replicator: doveadm connections weren't reset properly


M	src/replication/replicator/doveadm-connection.c

2013-01-10 07:39:02 +0200 Timo Sirainen <tss@iki.fi> (200c474)

    dsync: Fixed parsing state string.


M	src/doveadm/dsync/dsync-mailbox-state.c

2013-01-10 07:31:51 +0200 Timo Sirainen <tss@iki.fi> (a305415)

    mdbox: Crashfix for storage rebuild


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2013-01-10 06:52:37 +0200 Timo Sirainen <tss@iki.fi> (7c3df7b)

    dsync: Fixed printing output state when running via doveadm-server.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-10 06:51:19 +0200 Timo Sirainen <tss@iki.fi> (9269bbf)

    doveadm: Added assert.


M	src/doveadm/doveadm-print.c

2013-01-09 11:03:43 +0200 Timo Sirainen <tss@iki.fi> (a5f297a)

    dsync: Another fix to handling expunges from the end of mailbox.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-09 09:11:09 +0200 Timo Sirainen <tss@iki.fi> (c45baa0)

    dsync: Mailbox syncing fix


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-09 07:53:53 +0200 Timo Sirainen <tss@iki.fi> (91ec3b7)

    dsync: Error handling fix.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-09 07:02:28 +0200 Timo Sirainen <tss@iki.fi> (6319136)

    Merged changes from v2.1 tree.


2013-01-09 07:01:41 +0200 Timo Sirainen <tss@iki.fi> (8a743d6)

    mdbox rebuild: Update to previous commit


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2013-01-09 06:59:51 +0200 Timo Sirainen <tss@iki.fi> (b707e09)

    mdbox rebuild: Don't always duplicate messages that have conflicting GUIDs.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2013-01-09 06:57:34 +0200 Timo Sirainen <tss@iki.fi> (054e0cc)

    mdbox rebuild: Use mail size instead of record size when guessing if the
    mails are the same.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2013-01-09 05:43:09 +0200 Timo Sirainen <tss@iki.fi> (14460e2)

    dsync: Fixed handling UID renumbering when new mail was saved during dsync.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-09 05:42:03 +0200 Timo Sirainen <tss@iki.fi> (307ec6c)

    dsync: Don't wrongly log errors about missing message bodies. Also added
    some debug logging related to it.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2013-01-09 05:35:20 +0200 Timo Sirainen <tss@iki.fi> (553cf4f)

    mdbox: Allow reflink-copying a mail when wanted GUID matches the current
    GUID.


M	src/lib-storage/index/dbox-multi/mdbox-save.c

2013-01-09 05:33:32 +0200 Timo Sirainen <tss@iki.fi> (817b0fc)

    lib-storage: dest_mail wasn't reset if previous save was aborted. This could
    have happened only with dsync.


M	src/lib-storage/index/index-mail.c

2013-01-09 05:30:06 +0200 Timo Sirainen <tss@iki.fi> (b0e62f0)

    dbox: Give a name to the file's output stream (for improved error logging).


M	src/lib-storage/index/dbox-common/dbox-file.c

2013-01-09 05:28:58 +0200 Timo Sirainen <tss@iki.fi> (4561272)

    o_stream_send_istream(): Fixed copying within same file, when istream's size
    is unknown. This fixes copying a mail from mdbox's m.* file to the end of
    the same file.


M	src/lib/ostream-file.c

2013-01-09 05:29:13 +0200 Timo Sirainen <tss@iki.fi> (d488609)

    lib-index: Comment update


M	src/lib-index/mail-index.h

2013-01-09 05:38:13 +0200 Timo Sirainen <tss@iki.fi> (61279c3)

    Merged changes from v2.1 tree.


2013-01-08 16:24:20 +0200 Timo Sirainen <tss@iki.fi> (4e5f5ed)

    dsync: Make remote's stderr fd nonblocking to avoid hanging.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-08 10:57:34 +0200 Timo Sirainen <tss@iki.fi> (151a807)

    dsync: Fixes to printing remote's stderr output.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-08 10:25:21 +0200 Timo Sirainen <tss@iki.fi> (9d3025f)

    dsync: Print remote's stderr line-buffered. Especially when debugging is
    enabled there can be a lot of output, which makes this useful.


M	src/doveadm/dsync/doveadm-dsync.c

2013-01-08 07:43:29 +0200 Timo Sirainen <tss@iki.fi> (66088eb)

    dsync: Fixes to handling output stream buffering.


M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-private.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.c
M	src/doveadm/dsync/dsync-ibc.h

2013-01-08 07:42:38 +0200 Timo Sirainen <tss@iki.fi> (c596b18)

    replicator: Send only one sync command to doveadm-server per connection.
    This fixes setuid()/setgid() problems when multiple UIDs are used.


M	src/replication/replicator/doveadm-connection.c

2013-01-08 06:41:56 +0200 Timo Sirainen <tss@iki.fi> (4e5b49c)

    dsync: Minor fix for talking with remote dsync.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-01-08 05:37:43 +0200 Timo Sirainen <tss@iki.fi> (bfdef55)

    DEBUG: buffer_verify_pool() crashed with empty buffer.


M	src/lib/buffer.c

2013-01-08 05:23:06 +0200 Timo Sirainen <tss@iki.fi> (d8504a5)

    dsync: Crashfix for handling expunges from end of mailbox.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-08 05:19:37 +0200 Timo Sirainen <tss@iki.fi> (f3053c3)

    dsync: Fixed syncing expunge for last mail in mailbox.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-08 04:58:08 +0200 Timo Sirainen <tss@iki.fi> (ccd7b4e)

    dsync: Avoid updating modseqs unnecessarily. lib-index perhaps should do
    this automatically as well.


M	src/doveadm/dsync/dsync-mailbox-import.c

2013-01-08 04:33:01 +0200 Timo Sirainen <tss@iki.fi> (b16de4d)

    dsync: Avoid infinite looping.


M	src/doveadm/dsync/dsync-brain-mails.c

2013-01-08 04:00:04 +0200 Timo Sirainen <tss@iki.fi> (a5bf218)

    dsync: Assert-crashfix for handling keywords.


M	src/doveadm/dsync/dsync-mailbox-export.c

2013-01-08 03:44:14 +0200 Timo Sirainen <tss@iki.fi> (6e37fcb)

    DEBUG: buffer_verify_pool() crashed with static sized buffers.


M	src/lib/buffer.c

2013-01-08 03:39:34 +0200 Timo Sirainen <tss@iki.fi> (650441d)

    lib-index: Fixed failing transaction log test.


M	src/lib-index/test-mail-transaction-log-append.c

2013-01-08 03:31:36 +0200 Timo Sirainen <tss@iki.fi> (e54a0fb)

    test-imap-bodystructure: Fixed the test to pass with new imap-quote logic.


M	src/lib-imap/test-imap-bodystructure.c

2013-01-08 03:25:55 +0200 Timo Sirainen <tss@iki.fi> (54073bf)

    run-test.sh didn't exit with failure code when the test failed


M	run-test.sh

2013-01-08 03:25:55 +0200 Timo Sirainen <tss@iki.fi> (9570664)

    run-test.sh didn't exit with failure code when the test failed


M	run-test.sh

2013-01-08 03:19:14 +0200 Timo Sirainen <tss@iki.fi> (cd19bab)

    net_connect_unix(): If path is too long, return ENAMETOOLONG if it's
    available.


M	src/lib/network.c

2013-01-08 03:03:21 +0200 Timo Sirainen <tss@iki.fi> (49beae1)

    Makefile: Removed test-http-client from "make check". Not really a good idea
    to connect to remote servers (that might fail) during a normal make check.


M	src/lib-http/Makefile.am

2013-01-07 12:25:01 +0200 Timo Sirainen <tss@iki.fi> (3f8cd75)

    Added signature for changeset 86bccdf46d17


M	.hgsigs

2013-01-07 12:24:58 +0200 Timo Sirainen <tss@iki.fi> (2bf81fc)

    Added tag 2.2.beta1 for changeset 86bccdf46d17


M	.hgtags

2013-01-07 12:24:58 +0200 Timo Sirainen <tss@iki.fi> (1b48b91)

    Released v2.2.beta1.


M	configure.ac

2013-01-07 12:24:29 +0200 Timo Sirainen <tss@iki.fi> (65c0e43)

    lib-http: Various fixes Patch by Stephan Bosch.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/test-http-client.c

2013-01-07 10:55:27 +0200 Timo Sirainen <tss@iki.fi> (6fa505b)

    Added signature for changeset cf9d62fd0b14


M	.hgsigs

2013-01-07 10:55:17 +0200 Timo Sirainen <tss@iki.fi> (4a8d76f)

    Added tag 2.1.13 for changeset cf9d62fd0b14


M	.hgtags

2013-01-07 10:55:17 +0200 Timo Sirainen <tss@iki.fi> (8c46dcd)

    Released v2.1.13.


M	NEWS
M	configure.in

2013-01-05 01:14:11 +0200 Timo Sirainen <tss@iki.fi> (70a2782)

    Merged changes from v2.1 tree.


2013-01-05 00:50:04 +0200 Timo Sirainen <tss@iki.fi> (d1a27d8)

    auth: Fixed handling usernames with the same name as userdb extra fields.
    This is a bit kludgy fix, but pretty much guaranteed not to break anything.
    v2.2 has a cleaner fix, but it's a bit more invasive.


M	src/auth/auth-request.c
M	src/auth/auth-stream.c
M	src/auth/auth-stream.h

2013-01-05 00:37:26 +0200 Timo Sirainen <tss@iki.fi> (548193b)

    auth: Don't keep username duplicated in userdb_reply string. This fixes bugs
    where userdb_reply is accessed via auth_stream_*() functions that
    remove/replace existing fields, which may have ended up removing/replacing
    the username.


M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c

2013-01-05 00:12:54 +0200 Timo Sirainen <tss@iki.fi> (f2b491e)

    lazy_expunge: Allow expunging from lazy_expunge namespace via virtual
    mailbox. (Instead of copying the message all over again to the lazy_expunge
    namespace.)


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2013-01-04 23:59:42 +0200 Timo Sirainen <tss@iki.fi> (1f5670b)

    quota: Don't crash if shared namespace's owner doesn't have quota enabled
    (but you have).


M	src/plugins/quota/quota-storage.c

2013-01-04 23:24:26 +0200 Timo Sirainen <tss@iki.fi> (86763e4)

    uni_utf8_*(): Treat overlong UTF8 sequences as invalid.


M	src/lib/Makefile.am
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-unichar.c
M	src/lib/unichar.c

2013-01-04 21:39:07 +0200 Timo Sirainen <tss@iki.fi> (4578f6a)

    example-config: Added a note about protocol/local/remote {} sections.


M	doc/example-config/dovecot.conf

2013-01-04 05:49:33 +0200 Timo Sirainen <tss@iki.fi> (2bfa4f4)

    configure: Use pkg-config with clucene if available.


M	configure.ac
M	src/plugins/fts-lucene/Makefile.am

2013-01-04 05:29:25 +0200 Timo Sirainen <tss@iki.fi> (8813889)

    acl: Treat empty plugin { acl } setting the same as if it didn't exist. This
    allows using -o plugin/acl= to disable ACLs.


M	src/plugins/acl/acl-storage.c

2013-01-04 03:50:35 +0200 Timo Sirainen <tss@iki.fi> (0cc3ea4)

    DEBUG: Call buffer_verify_pool() on str_c*()


M	src/lib/str.c

2013-01-04 03:50:18 +0200 Timo Sirainen <tss@iki.fi> (a94f166)

    Added buffer_verify_pool()


M	src/lib/buffer.c
M	src/lib/buffer.h

2013-01-04 01:43:59 +0200 Timo Sirainen <tss@iki.fi> (13e130c)

    lib-storage: Bypass virtual storage when copying mail to allow
    optimizations. As a side effect this also causes all plugins to see the
    backend mail instead of the virtual mail. This probably isn't bad in most
    situations, but for those where it's unwanted mail_private.vmail can be used
    to access the virtual mail. mail_log plugin does this to log the original
    virtual mailbox name for copy operations.


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/virtual/virtual-mail.c

2013-01-04 01:13:05 +0200 Timo Sirainen <tss@iki.fi> (6abf66a)

    dsync: Use private modseqs to support syncing private flags in shared
    mailboxes.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-mail.c
M	src/doveadm/dsync/dsync-mail.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-export.h
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-state.h
M	src/doveadm/dsync/dsync-mailbox.h
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/dsync-transaction-log-scan.h

2013-01-04 01:12:24 +0200 Timo Sirainen <tss@iki.fi> (f46885a)

    lib-storage: Added support for "private modseqs" for INDEXPVT index. Used by
    dsync (next commit).


M	src/lib-storage/fail-mail.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/plugins/virtual/virtual-mail.c

2013-01-03 22:53:18 +0200 Timo Sirainen <tss@iki.fi> (33738cc)

    dsync: Fixed parsing mailbox state from remote dsync.


M	src/doveadm/dsync/dsync-ibc-stream.c

2013-01-03 07:30:54 +0200 Timo Sirainen <tss@iki.fi> (45d47bc)

    virtual storage: get_first_header() always returned "doesn't exist",
    breaking SORT/THREAD.


M	src/plugins/virtual/virtual-mail.c

2012-12-28 17:02:18 +0200 Timo Sirainen <tss@iki.fi> (c5c51de)

    configure: Use -lrt for check_gettime() only if needed.


M	configure.ac

2012-12-19 23:34:21 +0200 Timo Sirainen <tss@iki.fi> (a45c5bb)

    lib-http: Compile fix for previous change.


M	src/lib-http/http-client-host.c

2012-12-19 14:41:01 +0200 Timo Sirainen <tss@iki.fi> (f06cc4c)

    json-parser: Fixed infinite looping in some situations.


M	src/lib/json-parser.c

2012-12-19 14:39:55 +0200 Timo Sirainen <tss@iki.fi> (86bd046)

    lib-http: Host entries were added to hash table using wrong hostname
    pointer.


M	src/lib-http/http-client-host.c

2012-12-18 18:56:59 +0200 Timo Sirainen <tss@iki.fi> (0cc875d)

    auth: When auto-loading auth mechanisms from plugins, generate the name
    better.


M	src/auth/mech.c

2012-12-18 18:55:00 +0200 Timo Sirainen <tss@iki.fi> (57962a9)

    lib-http: Fixed a crash when http_client_request_submit() failed immediately


M	src/lib-http/http-client-request.c

2012-12-18 18:54:31 +0200 Timo Sirainen <tss@iki.fi> (787d28c)

    uri-util: Control characters weren't properly escaped. e.g. "%0a" is
    correct, "% a" is not.


M	src/lib/uri-util.c

2012-12-18 10:44:28 +0200 Timo Sirainen <tss@iki.fi> (e67ccfb)

    lib-storage: Fixed assert-crash when trying to fetch a binary section for
    empty message.


M	src/lib-storage/index/index-mail-binary.c

2012-12-15 15:33:12 +0200 Timo Sirainen <tss@iki.fi> (9f542af)

    lib-storage: Refresh private index before syncing to make sure we see latest
    changes.


M	src/lib-storage/index/index-sync-pvt.c

2012-12-15 14:37:20 +0200 Timo Sirainen <tss@iki.fi> (69e0316)

    maildir: Fixed a crash caused by previous mailbox_update() change


M	src/lib-storage/index/maildir/maildir-storage.c

2012-12-15 14:27:56 +0200 Timo Sirainen <tss@iki.fi> (94f6821)

    dsync: Minor (probably unnecessary) fix for i_stream_read() API usage. Avoid
    the first read returning -2.


M	src/doveadm/dsync/dsync-ibc-stream.c

2012-12-15 14:24:41 +0200 Timo Sirainen <tss@iki.fi> (a1543aa)

    dsync: Fixed hang when sending mail stream to remote dsync.


M	src/doveadm/dsync/dsync-ibc-stream.c

2012-12-15 13:56:16 +0200 Timo Sirainen <tss@iki.fi> (bca1c5f)

    dsync: Fixed remote syncing due to recent changes


M	src/doveadm/dsync/dsync-ibc-stream.c

2012-12-15 13:55:33 +0200 Timo Sirainen <tss@iki.fi> (1d54bf8)

    dsync: Set doveadm exit codes properly on errors.


M	src/doveadm/dsync/doveadm-dsync.c

2012-12-15 13:48:22 +0200 Timo Sirainen <tss@iki.fi> (6556f02)

    i_stream_close(): Set stream_errno to EPIPE instead of ENOENT. ENOENT
    implies that this stream pointed to a file that never existed. EPIPE isn't
    perfect either, but probably clearer than the alternatives.


M	src/lib/istream.c

2012-12-15 13:43:44 +0200 Timo Sirainen <tss@iki.fi> (df16c7e)

    i_stream_next_line(): Don't reset stream_errno if stream is already closed.


M	src/lib/istream.c

2012-12-15 13:31:31 +0200 Timo Sirainen <tss@iki.fi> (c7be65f)

    dsync: Don't start reading a mailbox until we know we actually need to sync
    it.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h

2012-12-15 13:30:02 +0200 Timo Sirainen <tss@iki.fi> (e69a4b1)

    mbox: Removed assert that caused dsync to crash. This is valid:

    1. dsync opened an internal transaction and locked mbox 2. dsync opened an
    external transaction, which didn't lock mbox 3. dsync committed internal
    transaction
    <assert crash fixed> 4. dsync locks mbox with external transaction

M	src/lib-storage/index/mbox/mbox-storage.c

2012-12-15 13:28:04 +0200 Timo Sirainen <tss@iki.fi> (3028a91)

    mbox: Mailbox GUID generation re-opened the mailbox using wrong name,
    possibly crashing.


M	src/lib-storage/index/mbox/mbox-storage.c

2012-12-15 13:26:48 +0200 Timo Sirainen <tss@iki.fi> (1aaed98)

    mbox: Mailbox GUID lookup unnecessarily always synced mbox.


M	src/lib-storage/index/mbox/mbox-storage.c

2012-12-15 13:25:49 +0200 Timo Sirainen <tss@iki.fi> (0f0e729)

    mbox: If mailbox_update() doesn't affect the mbox file, don't sync it.


M	src/lib-storage/index/mbox/mbox-storage.c

2012-12-15 13:25:34 +0200 Timo Sirainen <tss@iki.fi> (4913193)

    maildir: If mailbox_update() doesn't affect dovecot-uidlist file, don't lock
    it.


M	src/lib-storage/index/maildir/maildir-storage.c

2012-12-15 13:01:09 +0200 Timo Sirainen <tss@iki.fi> (707f172)

    dsync: Added back support for syncing only one mailbox (-m parameter)


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-pipe.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2012-12-15 12:31:56 +0200 Timo Sirainen <tss@iki.fi> (e0c10ab)

    dsync: Error handling fix when mailbox is unexpectedly lost.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-ibc-stream.c

2012-12-14 15:34:56 +0200 Timo Sirainen <tss@iki.fi> (ec66a68)

    dsync: Added -a parameter to sync all namespaces, not just the default one.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c

2012-12-14 15:34:00 +0200 Timo Sirainen <tss@iki.fi> (ad85975)

    dsync: Mark mailbox tree memory pool as "growing" to avoid warnings.


M	src/doveadm/dsync/dsync-mailbox-tree.c

2012-12-14 15:32:43 +0200 Timo Sirainen <tss@iki.fi> (805f510)

    dsync: Fixes to creating/renaming mailboxes This gets rid of unnecessary
    mailbox renames when they should have simply been created. The algorithm
    appears to work, but again really should be fully thought out later to
    figure out why exactly it works. I only wanted to get it working now for
    other tests..


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2012-12-14 12:03:55 +0200 Timo Sirainen <tss@iki.fi> (a99b87c)

    dsync: Never try to create INBOX via temporary name and rename.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2012-12-14 11:45:54 +0200 Timo Sirainen <tss@iki.fi> (9d4c027)

    lib-storage: Fixed vname -> storage name conversion for some nonexistent
    mailbox names. For example prefix=INBOX/ name=INBOX-foo would have converted
    the name to "" instead of keeping "INBOX-foo".


M	src/lib-storage/mailbox-list.c

2012-12-14 11:20:04 +0200 Timo Sirainen <tss@iki.fi> (5332128)

    dsync: Added debugging and rawlogging support.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h

2012-12-14 11:17:19 +0200 Timo Sirainen <tss@iki.fi> (e65600b)

    dsync: Fixed hangs with remote dsyncing


M	src/doveadm/dsync/dsync-ibc-stream.c

2012-12-13 12:24:32 +0200 Timo Sirainen <tss@iki.fi> (9345a14)

    dbox: dbox-alt-root symlink now points to the alt root directory, not to
    mailboxes dir. Existing mailboxes/ symlinks are silently changed to new
    ones. This also means that accessing the dbox with an older version will log
    a warning about the change.


M	src/lib-storage/index/dbox-common/dbox-storage.c

2012-12-12 15:21:45 +0200 Timo Sirainen <tss@iki.fi> (02da50e)

    lib-http: Fixed sending HTTP request's payload.


M	src/lib-http/http-client-request.c

2012-12-12 11:34:09 +0200 Stephan Bosch <stephan@rename-it.nl> (50a6d26)

    lib-http: Added support for chunked input/output streams and some bugfixes.


M	src/lib-http/http-client-connection.c
M	src/lib-http/http-client-private.h
M	src/lib-http/http-client-request.c
M	src/lib-http/http-response-parser.c
M	src/lib-http/http-transfer-chunked.c
M	src/lib-http/http-transfer.h
M	src/lib-http/test-http-client.c
M	src/lib-http/test-http-transfer.c

2012-12-11 08:08:12 +0200 Timo Sirainen <tss@iki.fi> (406ea4e)

    quota: Fixed quota calculation with mailbox_move().


M	src/plugins/quota/quota-storage.c

2012-12-08 09:37:21 +0200 Timo Sirainen <tss@iki.fi> (201437e)

    layout=index: If MAILBOX_LIST_FLAG_NO_MAIL_FILES is set, don't try to delete
    any mail files.


M	src/lib-storage/list/mailbox-list-index-backend.c

2012-12-08 09:36:54 +0200 Timo Sirainen <tss@iki.fi> (bba5900)

    lib-storage: Copy MAIL_STORAGE_CLASS_FLAG_NO_ROOT to
    MAILBOX_LIST_FLAG_NO_MAIL_FILES


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.h

2012-12-08 09:18:43 +0200 Timo Sirainen <tss@iki.fi> (e298b83)

    lib-fs: Added FS_PROPERTY_DIRECTORIES. This is a hint for fs API users if
    they should call fs_delete() for directories.


M	src/lib-fs/fs-api.h

2012-12-07 08:50:35 +0400 lion@ubuntu.ubuntu-domain <lion@ubuntu.ubuntu-domain> (d95065a)

    lib-index: Optimized single sequence lookup of newly created mails in
    transaction view.


M	src/lib-index/mail-index-transaction-view.c

2012-12-07 08:50:35 +0400 lion@ubuntu.ubuntu-domain <lion@ubuntu.ubuntu-domain> (90d0778)

    lib-index: Fixed sequence lookup of newly created mails in transaction view.


M	src/lib-index/mail-index-transaction-view.c

2012-12-19 15:00:45 +0200 Timo Sirainen <tss@iki.fi> (de9b2ee)

    lib-index: If map_with_read gets disabled, reset the cache buffers properly.


M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache.c

2012-12-18 22:13:48 +0200 Timo Sirainen <tss@iki.fi> (5028f44)

    auth: Added CLEAR as yet another alias to PLAIN/CLEARTEXT password scheme.
    This apparently is used by Sun LDAP server.


M	src/auth/password-scheme.c

2012-12-18 22:07:36 +0200 Timo Sirainen <tss@iki.fi> (dad1d7b)

    lib-index: MAIL_INDEX_OPEN_FLAG_SAVEONLY was buggy when reading data near
    end of dovecot.index.cache. We assumed that we read as much as we requested,
    even if the file was smaller.


M	src/lib-index/mail-cache.c

2012-12-18 22:05:55 +0200 Timo Sirainen <tss@iki.fi> (05d1312)

    lib-index: Make sure a corrupted mail_cache_header_fields.size doesn't cause
    crashes.


M	src/lib-index/mail-cache-fields.c

2012-12-18 21:45:08 +0200 Timo Sirainen <tss@iki.fi> (b512e56)

    raw storage: Make sure "from envelope" isn't returned as NULL.


M	src/lib-storage/index/raw/raw-mail.c

2012-12-18 21:37:57 +0200 Timo Sirainen <tss@iki.fi> (1af33d3)

    config: Notify process creation success to master only after parsing config
    file


M	src/config/main.c

2012-12-18 21:20:38 +0200 Timo Sirainen <tss@iki.fi> (c5c509a)

    example-config: Added missing dovecot-dict-auth.conf.ext


M	doc/example-config/Makefile.am

2012-12-18 21:15:19 +0200 Timo Sirainen <tss@iki.fi> (4bed2aa)

    lib-index: If sure mail_index_alloc_cache_destroy_unrefed() closes indexes
    it alone keeps open. This makes sure that all index files are closed within
    process when mailbox is deleted.


M	src/lib-index/mail-index-alloc-cache.c

2012-12-18 20:48:36 +0200 Timo Sirainen <tss@iki.fi> (cc3baa5)

    indexer-worker: Don't assert-crash with some mailbox names in some
    configurations. Virtual mailbox name shouldn't be accessed directly using
    mailbox_list_*() functions, since they expect a storage name. In some
    configurations this could have caused assert-crashes with mailbox names that
    contained invalid characters.


M	src/indexer/master-connection.c

2012-12-18 18:57:41 +0200 Timo Sirainen <tss@iki.fi> (665bb23)

    auth: When auto-loading auth mechanisms from plugins, generate the name
    better.


M	src/auth/mech.c

2012-12-13 12:14:57 +0200 Timo Sirainen <tss@iki.fi> (97943a3)

    dict-file: Automatically mkdir missing parent directories if they don't
    exist.


M	src/lib-dict/dict-file.c

2012-12-13 12:14:03 +0200 Timo Sirainen <tss@iki.fi> (2eb22de)

    lib-storage: Use stat_first_parent() instead of doing it ourself.


M	src/lib-storage/mailbox-list.c

2012-12-13 12:13:42 +0200 Timo Sirainen <tss@iki.fi> (766814d)

    Added stat_first_parent() helper function.


M	src/lib/mkdir-parents.c
M	src/lib/mkdir-parents.h

2012-12-11 20:04:10 +0200 Timo Sirainen <tss@iki.fi> (8a524e8)

    virtual plugin: Don't fail if mailbox patterns don't match anything.


M	src/plugins/virtual/virtual-config.c

2012-12-08 11:13:51 +0200 Timo Sirainen <tss@iki.fi> (62dc0ce)

    lib-master: Ignore /Volumes and /private/tmp mountpoints with OSX (only).


M	src/lib-master/mountpoint-list.c

2012-12-08 11:12:10 +0200 Timo Sirainen <tss@iki.fi> (22f3ce8)

    lib-master: Ignore mountpoints under /Volumes by default.


M	src/lib-master/mountpoint-list.c

2012-12-08 10:48:23 +0200 Timo Sirainen <tss@iki.fi> (69b728c)

    doveadm: table formatter supports now writing by streaming. This fixes it to
    work with doveadm server, which sometimes may use streaming.


M	src/doveadm/doveadm-print-table.c

2012-12-08 10:43:21 +0200 Timo Sirainen <tss@iki.fi> (1973c7c)

    imap: If mailbox doesn't have read ACL, hide APPENDUID/COPYUID resp-codes.


M	src/imap/cmd-append.c
M	src/imap/cmd-copy.c
M	src/lib-storage/mail-storage.h
M	src/plugins/acl/acl-mailbox.c

2012-12-08 09:35:33 +0200 Timo Sirainen <tss@iki.fi> (dafbec2)

    fts-solr: Fixed memory leak


M	src/plugins/fts-solr/solr-connection.c

2012-12-07 05:53:53 +0200 Timo Sirainen <tss@iki.fi> (b7eccb9)

    ostream-buffer: Fixed o_stream_sendv() with multiple iovs. Patch by Stephan
    Bosch


M	src/lib/ostream-buffer.c

2012-12-05 07:57:35 +0200 Timo Sirainen <tss@iki.fi> (267aae3)

    lib-http: Parser didn't always fully skip over the previous request's
    payload.


M	src/lib-http/http-response-parser.c

2012-12-04 14:10:34 +0200 Timo Sirainen <tss@iki.fi> (e4f1a5f)

    lib-mail: Detect errors in quoted-printable input.


M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/quoted-printable.h
M	src/lib-mail/test-istream-qp-decoder.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-quoted-printable.c

2012-12-04 13:04:59 +0200 Timo Sirainen <tss@iki.fi> (d186b3a)

    imap: Don't crash in IDLE if remote IP isn't known (PREAUTH)


M	src/imap/cmd-idle.c

2012-12-04 13:02:22 +0200 Timo Sirainen <tss@iki.fi> (56b1347)

    imap: Fixed handling FETCH BINARY for broken content.


M	src/doveadm/doveadm-mail.c
M	src/imap/cmd-fetch.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-fetch-body.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/mail-error.h

2012-12-04 11:40:35 +0200 Timo Sirainen <tss@iki.fi> (c7e810d)

    lib-mail: quoted-printable decoder istream shouldn't treat trailing "=" as
    error.


M	src/lib-mail/istream-qp-decoder.c

2012-12-04 11:33:16 +0200 Timo Sirainen <tss@iki.fi> (07725ea)

    lib-storage: Set name for the "binary istream".


M	src/lib-storage/index/index-mail-binary.c

2012-12-04 07:18:03 +0200 Timo Sirainen <tss@iki.fi> (251457b)

    lib-fs: Added a default fs_read() implementation using the fs_read_stream().


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2012-12-04 07:04:54 +0200 Timo Sirainen <tss@iki.fi> (03c4172)

    lib-http: Increased initial memory pool size


M	src/lib-http/http-response-parser.c

2012-12-04 07:04:32 +0200 Timo Sirainen <tss@iki.fi> (0fb5804)

    lib-fs: Added a default fs_write() implementation using the
    fs_write_stream*().


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c

2012-12-04 05:39:36 +0200 Timo Sirainen <tss@iki.fi> (8bfb2ec)

    lib-fs: Comment update


M	src/lib-fs/fs-api.h

2012-12-03 02:21:54 +0200 Timo Sirainen <tss@iki.fi> (3a916a3)

    Makefile: Added missing \


M	src/Makefile.am

2012-12-02 02:35:05 +0200 Timo Sirainen <tss@iki.fi> (32f0278)

    Makefile: Reordered directories to fix build failure


M	src/Makefile.am

2012-12-01 06:56:02 +0200 Timo Sirainen <tss@iki.fi> (89a43b2)

    lib-fs: Added fs-test to easily test FS API calls.


M	.hgignore
M	src/lib-fs/Makefile.am
A	src/lib-fs/fs-test.c

2012-12-01 06:54:55 +0200 Timo Sirainen <tss@iki.fi> (4ca2ccd)

    Added json_append_escaped()


M	src/lib/json-parser.c
M	src/lib/json-parser.h

2012-12-01 02:41:34 +0200 Timo Sirainen <tss@iki.fi> (9a5fadf)

    lib-http: Don't free connection immediately in payload-destroyed callback.
    This caused a crash in http_client_connection_return_response() after the
    stream was unrefed.


M	src/lib-http/http-client-connection.c

2012-11-30 08:56:55 +0200 Timo Sirainen <tss@iki.fi> (37de9a0)

    Added signature for changeset 75bfda4a7c6c


M	.hgsigs

2012-11-30 08:56:44 +0200 Timo Sirainen <tss@iki.fi> (d5aeb2b)

    Added tag 2.1.12 for changeset 75bfda4a7c6c


M	.hgtags

2012-11-30 08:56:44 +0200 Timo Sirainen <tss@iki.fi> (ab932cc)

    Released v2.1.12.


M	NEWS
M	configure.in

2012-11-30 03:14:10 +0200 Timo Sirainen <tss@iki.fi> (a8281b7)

    expire plugin: Don't crash when doveadm is run with proxying


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.h
M	src/plugins/expire/doveadm-expire.c

2012-11-29 12:43:54 +0200 Timo Sirainen <tss@iki.fi> (5c11e02)

    Makefile: dovecot-config was missing quotes in LIBDOVECOT_LOGIN


M	Makefile.am

2012-11-29 10:29:19 +0200 Timo Sirainen <tss@iki.fi> (86bdb64)

    JSON parser: Added support for arrays. The parser should be complete now.


M	src/lib/json-parser.c
M	src/lib/json-parser.h
M	src/lib/test-json-parser.c

2012-11-29 09:38:34 +0200 Timo Sirainen <tss@iki.fi> (2eccb26)

    JSON parser: Added json_parse_skip_next() to skip over unwanted values.


M	src/lib/json-parser.c
M	src/lib/json-parser.h
M	src/lib/test-json-parser.c

2012-11-29 08:41:28 +0200 Timo Sirainen <tss@iki.fi> (41c6bfa)

    Added signature for changeset 741d800a192f


M	.hgsigs

2012-11-29 08:41:21 +0200 Timo Sirainen <tss@iki.fi> (e976194)

    Added tag 2.1.11 for changeset 741d800a192f


M	.hgtags

2012-11-29 08:41:21 +0200 Timo Sirainen <tss@iki.fi> (efdf7a0)

    Released v2.1.11.


M	NEWS
M	configure.in

2012-11-29 08:35:51 +0200 Timo Sirainen <tss@iki.fi> (80fbf23)

    doveadm: Don't truncate printed output that contain NUL bytes. doveadm fetch
    text output especially could have been truncated.


M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-tab.c

2012-11-29 07:52:51 +0200 Timo Sirainen <tss@iki.fi> (7877db7)

    JSON parser: Added support for reading string value as istream.


M	src/lib/Makefile.am
A	src/lib/istream-jsonstr.c
A	src/lib/istream-jsonstr.h
M	src/lib/json-parser.c
M	src/lib/json-parser.h
M	src/lib/test-json-parser.c

2012-11-29 07:30:23 +0200 Timo Sirainen <tss@iki.fi> (4e8e7a9)

    JSON parser fixes


M	src/lib/json-parser.c
M	src/lib/test-json-parser.c

2012-11-29 06:26:29 +0200 Timo Sirainen <tss@iki.fi> (ae9691f)

    JSON parser supports now nested objects and parsing from non-blocking input
    stream.


M	src/auth/db-dict.c
M	src/lib/Makefile.am
M	src/lib/json-parser.c
M	src/lib/json-parser.h
A	src/lib/test-json-parser.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2012-11-29 02:30:15 +0200 Timo Sirainen <tss@iki.fi> (58833e2)

    uri-util.h always requires net.h to compile, #include it


M	src/lib/uri-util.h

2012-11-29 02:12:54 +0200 Timo Sirainen <tss@iki.fi> (9f8559a)

    lib-http: http-url.h always requires net.h to compile, #include it


M	src/lib-http/http-url.h

2012-11-29 02:01:56 +0200 Timo Sirainen <tss@iki.fi> (63caffb)

    lib-http: http_url_parse() didn't allocate all strings from the given pool.


M	src/lib-http/http-url.c

2012-11-29 01:57:40 +0200 Timo Sirainen <tss@iki.fi> (d45ab3f)

    lib-http: http_url_parse() now returns the http_url allocated from given
    memory pool.


M	src/lib-http/http-client-request.c
M	src/lib-http/http-url.c
M	src/lib-http/http-url.h
M	src/lib-http/test-http-url.c

2012-11-28 09:14:33 +0200 Timo Sirainen <tss@iki.fi> (1d40278)

    dsync: Don't crash when syncing multiple namespaces.


M	src/doveadm/dsync/dsync-mailbox-tree.c

2012-11-28 07:25:18 +0200 Timo Sirainen <tss@iki.fi> (2d05af5)

    lib-storage: Notify about \Seen flag changes in private index. Some earlier
    "don't send unnecessary flag changes" optimizations caused this.


M	src/lib-storage/index/index-sync-private.h
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync.c

2012-11-28 07:24:01 +0200 Timo Sirainen <tss@iki.fi> (4cff388)

    lib-storage: When updating flags in private index and nothing changes, don't
    increase modseq.


M	src/lib-storage/index/index-mail.c

2012-11-28 06:51:16 +0200 Timo Sirainen <tss@iki.fi> (764ba36)

    lib-storage: Fixed assert-crash with private indexes when looking for first
    unseen msg.


M	src/lib-storage/index/index-status.c

2012-11-28 06:43:55 +0200 Timo Sirainen <tss@iki.fi> (0bb5699)

    Make static analyzer happier


M	src/imap-urlauth/imap-urlauth-worker.c
M	src/lib-index/mail-transaction-log-file.c

2012-11-28 06:42:40 +0200 Timo Sirainen <tss@iki.fi> (daf0035)

    lib-index: Fixed randomly failing to write to dovecot.index.cache file


M	src/lib-index/mail-cache-transaction.c

2012-11-28 04:29:58 +0200 Timo Sirainen <tss@iki.fi> (27c534a)

    stats: Log username and service for invalid UPDATE-SESSIONs


M	src/stats/mail-session.c

2012-11-28 04:21:03 +0200 Timo Sirainen <tss@iki.fi> (14d7b92)

    stats: Fixed crash when handling multiple users within same process.


M	src/plugins/stats/stats-plugin.c

2012-11-28 03:56:06 +0200 Timo Sirainen <tss@iki.fi> (9af06b7)

    lib-index: Fixed assert-crash caused by recent cache file changes.


M	src/lib-index/mail-cache.c

2012-11-28 03:55:25 +0200 Timo Sirainen <tss@iki.fi> (122ee3c)

    lib-index: Fixed memory leak with MAIL_INDEX_OPEN_FLAG_SAVEONLY


M	src/lib-index/mail-cache.c

2012-11-28 03:32:31 +0200 Timo Sirainen <tss@iki.fi> (cd8bd47)

    doveadm: Log better errors for failing passdb proxy lookups.


M	src/doveadm/doveadm-mail-server.c

2012-11-28 03:32:01 +0200 Timo Sirainen <tss@iki.fi> (89fda66)

    lib-auth: Added auth_master_get_socket_path()


M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h

2012-11-28 02:35:37 +0200 Timo Sirainen <tss@iki.fi> (3f7b9d0)

    ostream-rawlog: Make sure rawlog logs only the data that got actually sent.


M	src/lib/ostream-rawlog.c

2012-11-28 02:35:15 +0200 Timo Sirainen <tss@iki.fi> (949b368)

    iostream-rawlog: Buffered output kept logging the same data over and over
    again.


M	src/lib/iostream-rawlog.c

2012-11-28 01:52:32 +0200 Timo Sirainen <tss@iki.fi> (91dad1e)

    lib-storage: Don't assert-crash when fetching BINARY contents for empty
    body.


M	src/lib-storage/index/index-mail-binary.c

2012-11-28 01:44:53 +0200 Timo Sirainen <tss@iki.fi> (898e991)

    lib-fs: Don't crash when trying to initialize nonexistent fs driver.


M	src/lib-fs/fs-api.c

2012-11-28 01:43:24 +0200 Timo Sirainen <tss@iki.fi> (9db5ade)

    i_stream_default_stat(): If we can't know the size, return -1 instead of
    assert crash. This fixes a crash saving to mdbox when input stream's size
    wasn't known.


M	src/lib/istream.c

2012-11-27 23:06:38 +0200 Timo Sirainen <tss@iki.fi> (52a16a4)

    fts-solr: XML-encode non-body fields as well


M	src/plugins/fts-solr/fts-backend-solr.c

2012-11-27 10:49:41 +0200 Timo Sirainen <tss@iki.fi> (8722fa5)

    lib-storage: Handle better when attempting to access shared mailboxes for
    nonexistent users.


M	src/lib-storage/index/shared/shared-storage.c

2012-11-27 10:49:18 +0200 Timo Sirainen <tss@iki.fi> (4961845)

    lib-storage: Added struct mail_user.nonexistent flag, which is filled by
    userdb lookup.


M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2012-11-27 10:48:11 +0200 Timo Sirainen <tss@iki.fi> (4e22f1e)

    fts_parser: Minor error logging improvement


M	src/plugins/fts/fts-parser-script.c

2012-11-27 10:39:26 +0200 Timo Sirainen <tss@iki.fi> (c50bf33)

    mdbox: When rebuilding storage, fsck the map index first to make sure it's
    valid. This fixes assert-crash when the map index contained records with
    UIDs in wrong order.


M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2012-11-27 10:02:59 +0200 Timo Sirainen <tss@iki.fi> (f67c2a7)

    mailbox-alias plugin: Error handling fix.


M	src/plugins/mailbox-alias/mailbox-alias-plugin.c

2012-11-27 10:00:42 +0200 Timo Sirainen <tss@iki.fi> (691759a)

    NEWS updated


M	NEWS

2012-11-27 09:53:33 +0200 Timo Sirainen <tss@iki.fi> (285e73e)

    lib-index: Added v2.2+ forwards compatibility to dovecot.index.cache


M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-transaction.c

2012-11-27 09:13:57 +0200 Timo Sirainen <tss@iki.fi> (fbe2c18)

    login: Reverted previous fix attempt for SSL_accept() busy-looping.
    Apparently didn't work. Probably this patch doesn't help anything then, so
    just remove the extra complexity.


M	src/login-common/ssl-proxy-openssl.c

2012-11-27 08:43:15 +0200 Timo Sirainen <tss@iki.fi> (fd7a591)

    auth: userdb passwd lookups should have been done via worker processes by
    default.


M	src/auth/userdb-passwd.c

2012-11-27 08:08:50 +0200 Timo Sirainen <tss@iki.fi> (636f1fc)

    fts-solr: Removed deprecated waitFlush parameter from commit.


M	src/plugins/fts-solr/fts-backend-solr.c

2012-11-27 07:50:06 +0200 Timo Sirainen <tss@iki.fi> (c51afc0)

    Reversed recent "short utf8" changes. Solr code needs to parse the UTF8
    input explicitly anyway to encode the XML characters. And all the character
    checks were already done in it.


M	src/lib/unichar.c
M	src/lib/unichar.h
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-parser.h

2012-11-27 06:21:18 +0200 Timo Sirainen <tss@iki.fi> (5a26150)

    doveadm-server: Reset headers in print output between running commands.


M	src/doveadm/client-connection.c

2012-11-27 06:20:44 +0200 Timo Sirainen <tss@iki.fi> (47e89f0)

    doveadm-server: Avoid eating CPU when client disconnects before
    authentication is done.


M	src/doveadm/client-connection.c

2012-11-27 06:19:57 +0200 Timo Sirainen <tss@iki.fi> (ceae307)

    doveadm: Don't disconnect from server too early while there are still
    commands.


M	src/doveadm/server-connection.c

2012-11-27 06:19:10 +0200 Timo Sirainen <tss@iki.fi> (ab53000)

    doveadm: Include username in internal errors and "no such user" errors when
    running via server.


M	src/doveadm/doveadm-mail-server.c

2012-11-27 03:49:36 +0200 Timo Sirainen <tss@iki.fi> (ba28af0)

    fts-solr: Marked as FTS_BACKEND_FLAG_BUILD_SHORT_UTF8


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2012-11-27 03:49:25 +0200 Timo Sirainen <tss@iki.fi> (119cbc0)

    fts: Added FTS_BACKEND_FLAG_BUILD_SHORT_UTF8 to require sending only short
    UTF8 data to backend.


M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-parser.h

2012-11-27 03:48:15 +0200 Timo Sirainen <tss@iki.fi> (cb0b320)

    liblib: Added uni_utf8_short_*() for handling UTF8 data where [56]-byte
    sequences are invalid.


M	src/lib/unichar.c
M	src/lib/unichar.h

2012-11-27 02:41:53 +0200 Timo Sirainen <tss@iki.fi> (95d50c6)

    quota: mailbox_get_status(STATUS_CHECK_OVER_QUOTA) returned wrong value on
    success. This fixes lmtp_rcpt_check_quota=yes


M	src/plugins/quota/quota-storage.c

2012-11-27 02:20:37 +0200 Timo Sirainen <tss@iki.fi> (4eda07e)

    man: Added -d parameter to doveadm expunge. Patch by Pascal Volk.


M	doc/man/doveadm-expunge.1.in

2012-11-27 00:44:34 +0200 Timo Sirainen <tss@iki.fi> (87c1c4f)

    dovecot-config: LIBDOVECOT_INCLUDE was missing path to lib-http


M	dovecot-config.in.in

2012-11-27 00:43:53 +0200 Timo Sirainen <tss@iki.fi> (6e8fce0)

    lib-fs: Automatically try to load missing driver as plugin.


M	src/lib-fs/Makefile.am
M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2012-11-27 00:43:23 +0200 Timo Sirainen <tss@iki.fi> (9d78abd)

    liblib: Added lib_atexit() to register process deinit callbacks.


M	src/lib/lib.c
M	src/lib/lib.h

2012-11-27 00:31:40 +0200 Timo Sirainen <tss@iki.fi> (73cf221)

    liblib: Added module_dir_find()


M	src/lib/module-dir.c
M	src/lib/module-dir.h

2012-11-26 23:24:48 +0200 Timo Sirainen <tss@iki.fi> (1be4d77)

    doveadm dump: Added support for "obox" index records.


M	src/doveadm/doveadm-dump-index.c

2012-11-26 23:23:52 +0200 Timo Sirainen <tss@iki.fi> (9b0284e)

    lib-imap-storage: When returning an error istream, give it a useful name.


M	src/lib-imap-storage/imap-msgpart.c

2012-11-26 23:20:59 +0200 Timo Sirainen <tss@iki.fi> (2954318)

    lib-storage: Fixes to LAYOUT=index backend.


M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mailbox-list-private.h

2012-11-26 23:19:04 +0200 Timo Sirainen <tss@iki.fi> (d9a129b)

    lib-storage: Comment update for mail_prefetch()


M	src/lib-storage/mail-storage-private.h

2012-11-26 23:18:30 +0200 Timo Sirainen <tss@iki.fi> (0aa9422)

    lib-storage: If MAIL_STORAGE_CLASS_FLAG_NO_ROOT is set, don't even try to
    mkdir it.


M	src/lib-storage/mail-storage.c

2012-11-26 23:16:41 +0200 Timo Sirainen <tss@iki.fi> (6eb0981)

    lib-storage: Don't crash when trying to sync private index, if syncing had
    already failed.


M	src/lib-storage/index/index-sync.c

2012-11-26 23:16:00 +0200 Timo Sirainen <tss@iki.fi> (c6227d7)

    sdbox: Verify that mail_attachment_fs backend supports RENAME property. This
    isn't needed by mdbox.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2012-11-26 23:15:01 +0200 Timo Sirainen <tss@iki.fi> (0001f76)

    lib-storage: Code cleanup: dbox_save_context.cur_file doesn't need to be in
    dbox-common.


M	src/lib-storage/index/dbox-common/dbox-save.h
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-save.c

2012-11-26 23:12:29 +0200 Timo Sirainen <tss@iki.fi> (bf5015e)

    Added libhttp to libdovecot.so


M	configure.ac
M	src/lib-dovecot/Makefile.am

2012-11-26 23:11:57 +0200 Timo Sirainen <tss@iki.fi> (905fb74)

    lib-http: Removed explicit safe-memset.lo links At least in all my systems
    they just complain about duplicates..


M	src/lib-http/Makefile.am

2012-11-26 23:09:25 +0200 Timo Sirainen <tss@iki.fi> (884cc4c)

    lib-dns: Added DNS_CLIENT_SOCKET_NAME macro for the default socket name.


M	src/lib-dns/dns-lookup.h

2012-11-26 23:08:50 +0200 Timo Sirainen <tss@iki.fi> (eed08ce)

    unlink_directory(): Added UNLINK_DIRECTORY_FLAG_FILES_ONLY


M	src/lib/unlink-directory.c
M	src/lib/unlink-directory.h

2012-11-26 23:08:10 +0200 Timo Sirainen <tss@iki.fi> (cf636af)

    Added iostream-temp for easily creating a temporary istream (to
    memory/file).


M	src/lib/Makefile.am
A	src/lib/iostream-temp.c
A	src/lib/iostream-temp.h

2012-11-26 23:06:24 +0200 Timo Sirainen <tss@iki.fi> (f0a386b)

    liblib: Added assert-check to epoll code to make sure we don't wait
    infinitely with no events.


M	src/lib/ioloop-epoll.c

2012-11-26 23:03:09 +0200 Timo Sirainen <tss@iki.fi> (1680fed)

    lib-fs: Added a temp_dir setting that the caller can specify.


M	src/lib-fs/fs-api.h

2012-11-26 23:02:51 +0200 Timo Sirainen <tss@iki.fi> (8804300)

    lib-fs: Added ITER and RELIABLEITER properties for backends.


M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-posix.c

2012-11-26 23:01:53 +0200 Timo Sirainen <tss@iki.fi> (6937ddd)

    lib-fs: Fixed iteration with POSIX backend.


M	src/lib-fs/fs-posix.c

2012-11-26 23:01:28 +0200 Timo Sirainen <tss@iki.fi> (a58b73c)

    lib-fs: Iterating a nonexistent directory should be the same as iterating an
    empty directory.


M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-posix.c

2012-11-26 22:59:37 +0200 Timo Sirainen <tss@iki.fi> (2766f1d)

    lib-fs: fs_wait_async() can now return an error.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c

2012-11-24 00:32:56 +0200 Timo Sirainen <tss@iki.fi> (216455c)

    lib-http: Compiler warning fixes


M	src/lib-http/Makefile.am
M	src/lib-http/http-client-host.c
D	src/lib-http/test-http-responses.c

2012-11-24 00:30:14 +0200 Stephan Bosch <stephan@rename-it.nl> (7384b4e)

    lib-http: Added initial HTTP client implementation.


M	src/lib-http/Makefile.am
A	src/lib-http/http-client-connection.c
A	src/lib-http/http-client-host.c
A	src/lib-http/http-client-peer.c
A	src/lib-http/http-client-private.h
A	src/lib-http/http-client-request.c
A	src/lib-http/http-client.c
A	src/lib-http/http-client.h
A	src/lib-http/http-header-parser.c
A	src/lib-http/http-header-parser.h
A	src/lib-http/http-parser.c
A	src/lib-http/http-parser.h
A	src/lib-http/http-response-parser.c
A	src/lib-http/http-response-parser.h
A	src/lib-http/http-transfer-chunked.c
A	src/lib-http/http-transfer.h
A	src/lib-http/test-http-client.c
M	src/lib-http/test-http-header-parser.c
A	src/lib-http/test-http-response-parser.c
A	src/lib-http/test-http-responses.c
A	src/lib-http/test-http-transfer.c

2012-11-23 23:49:39 +0200 Timo Sirainen <tss@iki.fi> (c61b8f9)

    bsdauth: Use "auth-<service>" as the auth type.


M	src/auth/passdb-bsdauth.c

2012-11-23 08:52:06 +0200 Timo Sirainen <tss@iki.fi> (d765b8e)

    login: Try to avoid busy-looping on SSL_accept() when client doesn't behave
    nicely.


M	src/login-common/ssl-proxy-openssl.c

2012-11-23 08:32:13 +0200 Timo Sirainen <tss@iki.fi> (74d5f3c)

    auth: Added a way to set default values for nonexistent LDAP attributes.
    %{ldap:attrName:default_value} expands to default_value if attrName doesn't
    exist.


M	src/auth/db-ldap.c

2012-11-16 17:39:25 +0200 Timo Sirainen <tss@iki.fi> (3d24361)

    lib-imap: imap_append_string_for_humans() was broken for empty input string.


M	src/lib-imap/imap-quote.c

2012-11-09 00:31:07 +0200 Timo Sirainen <tss@iki.fi> (fe91058)

    iostream-rawlog: Don't assert-crash if trying to write 0 bytes.


M	src/lib/iostream-rawlog.c

2012-11-07 18:14:20 +0200 Timo Sirainen <tss@iki.fi> (4240acc)

    auth: Give a better error message for "client doesn't have lookup
    permissions".


M	src/auth/auth-master-connection.c

2012-11-07 17:44:32 +0200 Timo Sirainen <tss@iki.fi> (aafdd20)

    Makefile: Add -lssl to installed dovecot-config's LIBDOVECOT_LOGIN if
    needed.


M	Makefile.am

2012-11-07 17:37:16 +0200 Timo Sirainen <tss@iki.fi> (3fc62f5)

    var_expand*(): Don't use a data stack frame when expanding long %{variables}
    This avoids potential crashes if the destination string is also allocated
    from data stack and requires growing.


M	src/lib/var-expand.c

2012-11-07 17:05:47 +0200 Timo Sirainen <tss@iki.fi> (3c40cf4)

    mdbox: Don't leave extra records to dovecot.map.index if mailbox index
    locking fails. Fixes errors such as: Corrupted dbox file /mdbox/storage/m.1
    (around offset=2652): EOF reading msg header (got 0/30 bytes)


M	src/lib-storage/index/dbox-multi/mdbox-save.c

2012-11-06 23:53:11 +0200 Timo Sirainen <tss@iki.fi> (1a108b2)

    module_dir_unload(): Don't dlclose() modules if GDB environment is set.


M	src/lib/module-dir.c

2012-11-06 23:49:57 +0200 Timo Sirainen <tss@iki.fi> (d8e5493)

    lib-ssl-iostream: Unload ssl_iostream_openssl plugin at exit.


M	src/lib-ssl-iostream/iostream-ssl.c

2012-11-06 23:49:24 +0200 Timo Sirainen <tss@iki.fi> (6ca79db)

    module_dir_deinit(): If no modules were actually initialized, avoid doing
    memory allocation. This allows calling module_dir_unload() with atexit(), as
    long as the module doesn't need to call deinit().


M	src/lib/module-dir.c

2012-11-06 23:23:19 +0200 Timo Sirainen <tss@iki.fi> (d39da67)

    auth: Require auth-token-secret.dat owner to be auth process's uid, not
    necessarily root.


M	src/auth/auth-token.c

2012-11-06 22:15:51 +0200 Timo Sirainen <tss@iki.fi> (270f00a)

    imap: Various fixes for handling expunges in mailbox sync.


M	src/imap/imap-sync.c

2012-11-06 22:13:13 +0200 Timo Sirainen <tss@iki.fi> (591cdcb)

    imap: Avoid sending multiple unnecessary VANISHED lines when sync had lots
    of changes.


M	src/imap/imap-sync.c

2012-11-06 17:40:34 +0200 Timo Sirainen <tss@iki.fi> (8d56f33)

    istream-seekable: Underlying stream errors weren't handled correctly.


M	src/lib/istream-seekable.c

2012-11-06 14:20:00 +0200 Timo Sirainen <tss@iki.fi> (37938a0)

    lib-ssl-iostream: Compiler warning fix when compiling without ssl


M	src/lib-ssl-iostream/iostream-ssl.c

2012-11-06 02:33:38 +0200 Timo Sirainen <tss@iki.fi> (4e94106)

    Makefile: Build lib-ssl-iostream before lib-http


M	src/Makefile.am

2012-11-06 01:40:17 +0200 Timo Sirainen <tss@iki.fi> (bc64a79)

    Makefile: Fixed building libdovecot.so


M	src/lib-dovecot/Makefile.am

2012-11-06 01:16:20 +0200 Timo Sirainen <tss@iki.fi> (c75dd2d)

    dovecot-config: Removed LIBDOVECOT_SSL, which is no longer needed.


M	dovecot-config.in.in

2012-11-06 01:11:03 +0200 Timo Sirainen <tss@iki.fi> (0db4226)

    Reverted 269104a0821b (Build imapc and pop3c always as plugins.) This is no
    longer needed now that lib-ssl-iostream can be linked without linking
    openssl.


M	configure.ac
M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
D	src/lib-storage/index/imapc/imapc-plugin.c
D	src/lib-storage/index/imapc/imapc-plugin.h
D	src/lib-storage/index/imapc/imapc-setting-storage.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/pop3c/Makefile.am
D	src/lib-storage/index/pop3c/pop3c-plugin.c
D	src/lib-storage/index/pop3c/pop3c-plugin.h
D	src/lib-storage/index/pop3c/pop3c-setting-storage.c
M	src/lib-storage/index/pop3c/pop3c-settings.h
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.h

2012-11-06 01:04:24 +0200 Timo Sirainen <tss@iki.fi> (3faa104)

    lib-ssl-iostream now dynamically loads openssl library instead of linking to
    it. This allowed removing the separate libdovecot-ssl library. In future if
    GnuTLS/NSS support is added it would also allow switching between them
    dynamically.


M	configure.ac
M	src/auth/Makefile.am
M	src/lib-dovecot/Makefile.am
M	src/lib-master/Makefile.am
M	src/lib-ssl-iostream/Makefile.am
A	src/lib-ssl-iostream/iostream-openssl-common.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
A	src/lib-ssl-iostream/iostream-ssl-private.h
A	src/lib-ssl-iostream/iostream-ssl.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/login-common/Makefile.am

2012-11-05 18:16:56 +0200 Timo Sirainen <tss@iki.fi> (6f5a72c)

    lib-ssl-iostream: Call all of the OpenSSL deinit functions at exit


M	src/lib-ssl-iostream/iostream-openssl-context.c

2012-11-05 14:28:24 +0200 Timo Sirainen <tss@iki.fi> (19ebf93)

    lib-ssl-iostream: [io]streams were added an unnecessary reference, causing
    memory leaks.


M	src/lib-ssl-iostream/iostream-openssl.c

2012-11-05 14:27:52 +0200 Timo Sirainen <tss@iki.fi> (942dc91)

    lib-ssl-iostream: [io]streams were added an unnecessary reference, causing
    memory leaks.


M	src/lib-ssl-iostream/iostream-openssl.c

2012-11-04 20:04:21 +0200 Timo Sirainen <tss@iki.fi> (c018030)

    lib-ssl-iostream: Fixed potential assert-crash when reading.


M	src/lib-ssl-iostream/istream-openssl.c

2012-11-04 19:16:59 +0200 Timo Sirainen <tss@iki.fi> (adbca48)

    lib-ssl-iostream: Copy the original istream's fd to the ssl istream.


M	src/lib-ssl-iostream/istream-openssl.c

2012-11-04 17:26:24 +0200 Timo Sirainen <tss@iki.fi> (bba52ec)

    lib-index: MAIL_INDEX_OPEN_FLAG_SAVEONLY may have caused stale data to be
    read from cache.


M	src/lib-index/mail-cache.c

2012-11-03 20:25:17 +0200 Timo Sirainen <tss@iki.fi> (f0ff961)

    lib-index: Replaced cache's deleted_space with deleted_record_count. This
    way when expunging messages we don't need to actually read through the cache
    file and calculate how many bytes will be freed, we can simply increase the
    deleted_record_count by 1. We'll still compress the cache file approximately
    after 20% of the space (records) has been deleted.

    This also converts the old "hole offset" header field to tracking the number 
    of records in the cache file. Otherwise we'd have to assume that all of the 
    messages in mailbox have a cache record, but that isn't true for users who 
    have only temporary cache fields. This "hole offset" cannot be trusted 
    completely, because nothing prevents old Dovecot version from simply writing 
    a hole offset there and messing up the record counts. Because of this there 
    are a couple of extra sanity checks for it. (Unfortunately there wasn't any 
    easy way to simply add a new field to header without breaking backwards 
    compatibility.)

M	src/doveadm/doveadm-dump-index.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c

2012-11-03 19:37:47 +0200 Timo Sirainen <tss@iki.fi> (920b9f0)

    lib-index: Added minor version to dovecot.index.cache file header.


M	src/doveadm/doveadm-dump-index.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.c

2012-11-03 19:35:54 +0200 Timo Sirainen <tss@iki.fi> (330d54e)

    lib-index: If a cache record is larger than 64 kB, don't add it to cache
    file. This shouldn't affect anything except mails that probably shouldn't
    exist in the first place.


M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-transaction.c

2012-11-03 19:25:35 +0200 Timo Sirainen <tss@iki.fi> (131b073)

    lib-index: Cache record linking is now while writing new records, not later
    with pwrite(). This should make performance somewhat better. It also means
    that now the only overwrites to cache file are to the file header and the
    fields header. This means that we no longer have to invalidate file_cache
    (with mmap_disable=yes) except when reading the headers, which is always
    done anyway.

    It would be nice to move the overwritten fields in the headers to a cache 
    header in dovecot.index file, but this is a bit tricky currently. When 
    writing these headers the cache file needs to be locked to avoid race 
    conditions. To avoid deadlocks the transaction log would have to be locked 
    before the cache. The code to do all this would still be a bit complex, and 
    to keep backwards compatibility with old Dovecot versions it would still 
    have to do the overwriting until the backwards compatibility code is 
    disabled.

M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c

2012-11-03 19:13:24 +0200 Timo Sirainen <tss@iki.fi> (3ef21e8)

    lib-index: Transaction view shouldn't return ext records if the ext was
    already reset.


M	src/lib-index/mail-index-transaction-view.c

2012-11-03 18:43:00 +0200 Timo Sirainen <tss@iki.fi> (6008489)

    lib-index: Recent cache file changes broke writing.


M	src/lib-index/mail-cache.c

2012-11-03 18:43:00 +0200 Timo Sirainen <tss@iki.fi> (c028c93)

    lib-index: Recent cache file changes broke writing.


M	src/lib-index/mail-cache.c

2012-11-03 14:11:29 +0200 Timo Sirainen <tss@iki.fi> (6494ec1)

    lib-storage: Crashfix when doing userdb lookup.


M	src/lib-storage/mail-storage-service.c

2012-11-03 13:47:55 +0200 Timo Sirainen <tss@iki.fi> (bd503f1)

    lib-index: Write to transaction log using O_APPEND flag. Most OSes should do
    the writes atomically so that reads won't see partially written data. We
    don't currently rely on this, but it would be possible in future to remove
    locking entirely from writing to transaction log.


M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.h

2012-11-01 12:32:30 +0200 Timo Sirainen <tss@iki.fi> (a21489e)

    lib-storage: Error logging fixes.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-pvt.c

2012-10-31 14:44:24 +0200 Timo Sirainen <tss@iki.fi> (0a77b33)

    hostpid_init(): Don't allow gethostname() to fail. Be more strict about what
    chars it can contain.


M	src/lib/hostpid.c

2012-10-31 13:34:52 +0200 Timo Sirainen <tss@iki.fi> (97155df)

    lib-storage: Don't require mailbox to be synced for MAILBOX_METADATA_GUID
    lookup None of the mailbox formats currently require it, and lib-lda code
    assert-crashes with it since syncing is done with a transaction already
    open.


M	src/lib-storage/mail-storage.h

2012-10-31 13:29:16 +0200 Timo Sirainen <tss@iki.fi> (3371db2)

    lib-storage: When mailbox_get_status/metadata() auto-syncs mailbox, use
    MAILBOX_SYNC_FLAG_FAST


M	src/lib-storage/index/index-status.c

2012-10-31 13:24:49 +0200 Timo Sirainen <tss@iki.fi> (4b51bda)

    Makefile: Add -lssl to installed dovecot-config's LIBDOVECOT_STORAGE if
    needed.


M	Makefile.am

2012-10-31 13:12:22 +0200 Stephan Bosch <stephan@rename-it.nl> (96e3a90)

    lib-dns: Added dns_lookup_switch_ioloop()


M	src/lib-dns/dns-lookup.c
M	src/lib-dns/dns-lookup.h

2012-10-31 13:11:11 +0200 Timo Sirainen <tss@iki.fi> (a98f0fc)

    auth: Don't assert-crash in auth-token writing if process isn't running as
    root.


M	src/auth/auth-token.c

2012-10-30 15:05:45 +0200 Timo Sirainen <tss@iki.fi> (f69cd5c)

    lib-lda: Avoid doing a costly mailbox sync when delivering mail to multiple
    recipients.


M	src/lib-lda/mail-deliver.c
M	src/lib-storage/index/index-sync.c

2012-10-29 23:03:59 +0200 Timo Sirainen <tss@iki.fi> (9d60b2e)

    doveadm sync/backup: Added -s parameter to usage string.


M	src/doveadm/dsync/doveadm-dsync.c

2012-10-29 22:47:35 +0200 Timo Sirainen <tss@iki.fi> (12b1956)

    Added signature for changeset f5941f3ac762


M	.hgsigs

2012-10-29 22:47:32 +0200 Timo Sirainen <tss@iki.fi> (be061d4)

    Added tag 2.2.alpha1 for changeset f5941f3ac762


M	.hgtags

2012-10-29 22:47:32 +0200 Timo Sirainen <tss@iki.fi> (5ae069c)

    Released v2.2.alpha1.


M	NEWS
M	TODO
M	configure.ac

2012-10-29 22:42:28 +0200 Timo Sirainen <tss@iki.fi> (0ed3607)

    anvil: Added a comment to remind what the anvil checksums are all about.


M	src/anvil/penalty.c

2012-10-29 22:03:25 +0200 Timo Sirainen <tss@iki.fi> (9b706b3)

    If prefix="" namespace isn't defined, autocreate it as an unusable
    namespace. This avoids having to handle mail_namespace_find() errors all
    over the place. Instead now the mailbox accesses will simply fail.


M	configure.ac
M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain.c
M	src/imap/cmd-list.c
M	src/imap/imap-commands-util.c
M	src/indexer/master-connection.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-lda/mail-deliver.c
M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h
M	src/lib-storage/mail-storage.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/pop3/pop3-client.c

2012-10-29 21:54:51 +0200 Timo Sirainen <tss@iki.fi> (c396c5c)

    lib-storage: Use const pointers for mail_namespace.(set|unexpanded_set)


M	src/lib-storage/mail-namespace.h
M	src/plugins/autocreate/autocreate-plugin.c

2012-10-29 21:42:32 +0200 Timo Sirainen <tss@iki.fi> (955f066)

    autocreate plugin logs now a "deprecated" warning at startup


M	src/plugins/autocreate/autocreate-plugin.c

2012-10-29 21:31:39 +0200 Timo Sirainen <tss@iki.fi> (c73415e)

    Make static analyzer happier.


M	src/lib-dict/dict-file.c
M	src/lib-index/mail-transaction-log.c

2012-10-29 21:28:45 +0200 Timo Sirainen <tss@iki.fi> (4c05697)

    iostream-rawlog: Avoid crashing more if write() to rawlog fails.


M	src/lib/iostream-rawlog.c

2012-10-29 20:48:08 +0200 Timo Sirainen <tss@iki.fi> (c1b9c45)

    Make static analyzer happier.


M	src/director/director-connection.c
M	src/director/director-test.c
M	src/imap/cmd-urlfetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-mail/message-parser.c

2012-10-29 20:45:41 +0200 Timo Sirainen <tss@iki.fi> (ce8244c)

    maildir: Fixed potential crash when maildir suddenly loses some directories.


M	src/lib-storage/index/maildir/maildir-util.c

2012-10-29 20:42:00 +0200 Timo Sirainen <tss@iki.fi> (31159b5)

    layout=index: Fixed a crash in mailbox_rename() race condition.


M	src/lib-storage/list/mailbox-list-index-backend.c

2012-10-29 20:34:31 +0200 Timo Sirainen <tss@iki.fi> (640c1f9)

    iostream-rawlog: Avoid crashing if write() to rawlog fails.


M	src/lib/iostream-rawlog.c

2012-10-29 20:17:07 +0200 Timo Sirainen <tss@iki.fi> (13eb655)

    imap: imap_id_send default changed to send name=Dovecot to client.


M	src/imap-login/imap-login-settings.c
M	src/imap/imap-settings.c

2012-10-29 20:09:42 +0200 Timo Sirainen <tss@iki.fi> (eb22514)

    doveadm user: Removed -m parameter and made it default. Added -u for old
    functionality. -u meaning "userdb lookup only".


M	src/doveadm/doveadm-auth.c

2012-10-29 20:07:13 +0200 Timo Sirainen <tss@iki.fi> (45d2975)

    doveadm user -m: Show all returned userdb fields.


M	src/doveadm/doveadm-auth.c

2012-10-29 20:06:53 +0200 Timo Sirainen <tss@iki.fi> (3482fee)

    lib-storage: Added mail_storage_service_save_userdb_fields()


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2012-10-29 19:54:50 +0200 Timo Sirainen <tss@iki.fi> (1f1ee8d)

    lib-storage: Renamed mail_storage_set_index_error() to
    mailbox_set_index_error()


M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/plugins/virtual/virtual-sync.c

2012-10-29 19:52:21 +0200 Timo Sirainen <tss@iki.fi> (8c909e4)

    Replaced *_INDEX_PREFIX macros with a common MAIL_INDEX_PREFIX.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-storage.h
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.h
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-storage.h
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.h
M	src/lib-storage/mail-storage-private.h
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2012-10-29 19:04:36 +0200 Timo Sirainen <tss@iki.fi> (fb541fd)

    login proxy: For connect() failures log also the used local IP:port if
    available.


M	src/login-common/login-proxy.c

2012-10-29 18:32:40 +0200 Timo Sirainen <tss@iki.fi> (2d06f52)

    master: Ignore service {} blocks with empty executable settings.


M	src/master/master-settings.c
M	src/master/service.c

2012-10-29 18:29:07 +0200 Timo Sirainen <tss@iki.fi> (b203ee2)

    master: Removed unnecessary code duplication. The settings parsing already
    does this.


M	src/master/service.c

2012-10-29 18:01:54 +0200 Timo Sirainen <tss@iki.fi> (52ef4fc)

    Renamed configure.in to configure.ac. Apparently automakes in future won't
    support configure.in anymore.


M	TODO
R100	configure.in	configure.ac

2012-10-29 17:55:35 +0200 Timo Sirainen <tss@iki.fi> (c25dfa9)

    Merged changes from v2.1 tree.


2012-10-29 16:51:46 +0200 Timo Sirainen <tss@iki.fi> (2a45e92)

    lib-fs: Compile fix for OSes that don't support
    posix_fadvise(POSIX_FADV_WILLNEED)


M	src/lib-fs/fs-posix.c

2012-10-29 16:36:59 +0200 Timo Sirainen <tss@iki.fi> (b529524)

    lib-dict: Abort async transaction commits if client gets disconnected from
    dict server.


M	src/lib-dict/dict-client.c

2012-10-29 15:32:44 +0200 Timo Sirainen <tss@iki.fi> (aa767db)

    TODO updated


M	TODO

2012-10-29 15:30:59 +0200 Timo Sirainen <tss@iki.fi> (1453e7c)

    lib-storage: Handle better when attempting to access shared mailboxes for
    nonexistent users.


M	src/lib-storage/index/shared/shared-storage.c

2012-10-29 15:29:52 +0200 Timo Sirainen <tss@iki.fi> (117a55d)

    lib-storage: Added struct mail_user.nonexistent flag, which is filled by
    userdb lookup.


M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2012-10-29 15:18:34 +0200 Timo Sirainen <tss@iki.fi> (9fd2181)

    lib-storage: Fixes to handling separation of private/shared attributes.


M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2012-10-29 15:17:17 +0200 Timo Sirainen <tss@iki.fi> (4253a4a)

    lib-index: Fixes to replacing message's keywords.


M	src/lib-index/mail-index-transaction.c

2012-10-29 15:13:54 +0200 Timo Sirainen <tss@iki.fi> (045e41d)

    lib-storage: Crashfix to previous stream error checking change.


M	src/lib-storage/index/index-mail-headers.c

2012-10-29 14:50:11 +0200 Timo Sirainen <tss@iki.fi> (c6afd72)

    lib-storage: Moved mail attribute dict to struct mail_storage. This also
    means that index_storage_destroy() must always be called, so removed now
    unnecessary mail_storage.destroy=NULL checks.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-attribute.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/virtual/virtual-storage.c

2012-10-29 14:31:04 +0200 Timo Sirainen <tss@iki.fi> (e68fc7d)

    Treat modseq updates explicitly instead of as if they were flag changes.


M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index.h
M	src/lib-storage/index/index-sync.c

2012-10-29 14:19:53 +0200 Timo Sirainen <tss@iki.fi> (5376aea)

    lib-storage: Mailbox list indexes are now enabled also for shared/public
    mailboxes.


M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c

2012-10-29 14:19:24 +0200 Timo Sirainen <tss@iki.fi> (0440855)

    lib-storage: Allow calling mailbox_get_private_flags_mask() without mailbox
    being open. Most importantly used by mailbox list indexes to determine if it
    can optimize a STATUS (UNSEEN) call.


M	src/lib-storage/mail-storage.c

2012-10-29 14:16:02 +0200 Timo Sirainen <tss@iki.fi> (7891195)

    imap: Commit temporary mail's transaction before finishing sync. Fixes
    assert-crash with mailbox list indexes.


M	src/imap/imap-sync.c

2012-10-29 14:17:40 +0200 Timo Sirainen <tss@iki.fi> (88cc315)

    lib-storage: Avoid assert-crashing when updating mailbox list index.


M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index.h

2012-10-29 13:23:30 +0200 Timo Sirainen <tss@iki.fi> (50de467)

    lib-storage: Check and log stream errors when parsing/searching messages.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c

2012-10-29 13:01:37 +0200 Timo Sirainen <tss@iki.fi> (a81d416)

    lib-storage: Make sure mailbox was synced at least once when getting
    status/metadata.


M	src/lib-storage/index/index-status.c
M	src/lib-storage/mail-storage.h

2012-10-29 13:00:36 +0200 Timo Sirainen <tss@iki.fi> (2956f45)

    dsync: Make sure we're not trying to use uidvalidity=0 for existing
    mailboxes.


M	src/doveadm/dsync/dsync-mailbox-tree-fill.c

2012-10-29 12:44:43 +0200 Timo Sirainen <tss@iki.fi> (c889df3)

    lib-index: MAIL_INDEX_TRANSACTION_FLAG_AVOID_FLAG_UPDATES didn't work well
    enough for keywords. Removed the code that attempted to optimize some CPU
    usage at the cost of writing too many changes.


M	src/lib-index/mail-index-transaction-update.c

2012-10-29 12:43:29 +0200 Timo Sirainen <tss@iki.fi> (b90e089)

    lib-index: Avoid assert-crashing when syncing an old "keyword reset" from
    transaction log.


M	src/lib-index/mail-index-transaction-update.c

2012-10-29 12:40:14 +0200 Timo Sirainen <tss@iki.fi> (a9dbce6)

    acl: Avoid assert-crashing when trying to access shared namespace root
    "mailboxes".


M	src/plugins/acl/acl-mailbox.c

2012-10-26 13:05:43 +0300 Timo Sirainen <tss@iki.fi> (170db28)

    lib-storage: Fixed listing layout=fs when namespace prefix part included
    wildcards.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-10-26 12:09:03 +0300 Timo Sirainen <tss@iki.fi> (7b8f9e3)

    stats: Refresh user statistics during long maildir syncs.


M	src/plugins/stats/stats-plugin.c

2012-10-26 11:43:05 +0300 Timo Sirainen <tss@iki.fi> (ab1e5b1)

    lib-index: Optimize cache file reads with MAIL_INDEX_OPEN_FLAG_SAVEONLY


M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache.c

2012-10-26 11:37:07 +0300 Timo Sirainen <tss@iki.fi> (f818017)

    lib-index: After recent cache changes, cache was often wrongly being thought
    of as unusable


M	src/lib-index/mail-cache.c

2012-10-26 11:34:25 +0300 Timo Sirainen <tss@iki.fi> (58f931f)

    lib-index: If cache file unexpectedly shrinks in header lookup, log an
    error.


M	src/lib-index/mail-cache-lookup.c

2012-10-26 11:33:22 +0300 Timo Sirainen <tss@iki.fi> (20536ef)

    Increased initial memory pool size


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-10-26 11:17:51 +0300 Timo Sirainen <tss@iki.fi> (4dc26d9)

    lib-storage: Listing multiple mailbox patterns may have returned duplicates
    with fs layout.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-10-26 11:12:36 +0300 Timo Sirainen <tss@iki.fi> (66a1eb6)

    dbox: Log a better error if we have external attachments, but
    mail_attachment_dir is unset.


M	src/lib-storage/index/dbox-common/dbox-attachment.c

2012-10-26 11:07:43 +0300 Timo Sirainen <tss@iki.fi> (6322eca)

    doveadm backup: Don't assert-crash trying to delete noselect-mailboxes too
    early.


M	src/doveadm/dsync/dsync-mailbox-tree-sync.c

2012-10-26 10:36:43 +0300 Timo Sirainen <tss@iki.fi> (93d08c3)

    lib-index: mail_index_transaction_lookup_latest_keywords() didn't work
    properly. It wasn't actually looking up the latest keywords.


M	src/lib-index/mail-index-transaction.c

2012-10-24 15:05:40 +0300 Timo Sirainen <tss@iki.fi> (efeb133)

    doveadm backup: Revert all local changes.


M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-import.h

2012-10-24 15:05:15 +0300 Timo Sirainen <tss@iki.fi> (818b051)

    dsync: Crashfix for scanning keyword changes in transaction log.


M	src/doveadm/dsync/dsync-transaction-log-scan.c

2012-10-24 13:04:38 +0300 Timo Sirainen <tss@iki.fi> (01e3a9b)

    NEWS updated


M	NEWS

2012-10-24 12:47:34 +0300 Timo Sirainen <tss@iki.fi> (0bf2554)

    lib-storage: When mkdir()ing home, copy permissions from parent if it has
    setgid-bit and we're using %h/~. When using %d/%n instead of %h in the
    location directories, use the earlier methods.


M	src/lib-storage/mailbox-list.c

2012-10-24 12:23:36 +0300 Timo Sirainen <tss@iki.fi> (2cb0a04)

    lib-storage: When creating user directory under domain, set its setgid-bit
    on. The previous mkdir_parents_chown() change changed this behavior. I'm not
    entirely sure if the setgid-bit is a good idea or not in here, but we'll
    just continue the existing behavior.


M	src/lib-storage/mailbox-list.c

2012-10-24 12:15:19 +0300 Timo Sirainen <tss@iki.fi> (a3e3650)

    mkdir_parents_chown(): If gid is set, make sure setgid-bit isn't copied from
    parent.


M	src/lib/mkdir-parents.c
M	src/lib/mkdir-parents.h

2012-10-24 11:52:14 +0300 Timo Sirainen <tss@iki.fi> (744543d)

    raw storage: Don't set NAMESPACE_FLAG_INBOX_USER for the created namespace.


M	src/lib-storage/index/raw/raw-storage.c

2012-10-24 11:30:09 +0300 Timo Sirainen <tss@iki.fi> (eea128b)

    lib-imap: Replaced last traces of imap_quote*() with
    imap_append_string_for_humans() Also the imap_append_*string() functions now
    decide whether to use quoted-string or literal based on the output string
    length (if both would work).


M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-quote.h

2012-10-24 11:28:38 +0300 Timo Sirainen <tss@iki.fi> (2ef24f8d)

    lib-imap: ENVELOPE parsing/writing no longer strips whitespace from machine
    readable fields.


M	src/lib-imap/imap-envelope.c

2012-10-24 11:22:28 +0300 Timo Sirainen <tss@iki.fi> (1a197a6)

    lib-imap: bodystructure parsing now uses imap_append_string() instead of
    imap_quote*() Some of the fields are parsed through rfc822_*() which
    guarantees that they contain proper clean input. Other fields are also
    machine-readable and don't benefit from having whitespace compressed or of
    any other things that imap_quote*(fix_text=TRUE) did.

    None of the fields in

M	src/lib-imap/imap-bodystructure.c

2012-10-24 10:14:17 +0300 Timo Sirainen <tss@iki.fi> (44f93ba)

    Use imap_append_astring() instead of imap_append_string() where possible.


M	src/imap/cmd-list.c
M	src/imap/cmd-notify.c
M	src/imap/imap-fetch.c
M	src/imap/imap-notify.c
M	src/imap/imap-status.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c

2012-10-24 10:08:06 +0300 Timo Sirainen <tss@iki.fi> (0b19294)

    lib-imap: Added imap_append_astring()


M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-quote.h

2012-10-24 10:05:37 +0300 Timo Sirainen <tss@iki.fi> (73592a4)

    lib-imap: Changed public IS_ATOM*() macros to match RFC 3501 exactly. Move
    the imap-parser specific "atom plus some more" parsing macro inside
    imap-parser.c so it's not used by anyone else.


M	src/lib-imap/imap-arg.h
M	src/lib-imap/imap-parser.c
M	src/lib-storage/mailbox-keywords.c

2012-10-24 09:39:52 +0300 Timo Sirainen <tss@iki.fi> (686ad6d)

    Use imap_append_*string() instead of imap_quote_append*() where possible.
    This makes it clearer what types of output should be sent.


M	src/imap-login/imap-proxy.c
M	src/imap/cmd-list.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-notify.c
M	src/imap/imap-fetch.c
M	src/imap/imap-notify.c
M	src/imap/imap-search.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/lib-imap/imap-id.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c

2012-10-24 09:38:06 +0300 Timo Sirainen <tss@iki.fi> (169d60e)

    lib-imap: Added imap_append_string() and imap_append_nstring()


M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-quote.h

2012-10-24 09:21:46 +0300 Timo Sirainen <tss@iki.fi> (2ca9d7b)

    lib-imap: Renamed imap_dquote_append() to imap_append_quoted()


M	src/imap/imap-fetch-body.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-quote.h

2012-10-24 09:21:00 +0300 Timo Sirainen <tss@iki.fi> (dde0593)

    imap: Avoid double-quoting non-atom header field


M	src/imap/imap-fetch-body.c

2012-10-23 20:46:35 +0300 Timo Sirainen <tss@iki.fi> (553ad92)

    mailbox_list_index=yes: Fixed refreshing list index after mailbox was
    created.


M	src/lib-storage/list/mailbox-list-index.c

2012-10-23 20:46:12 +0300 Timo Sirainen <tss@iki.fi> (2f5256b)

    maildir: Don't assert-crash on mailbox creation.


M	src/lib-storage/index/maildir/maildir-storage.c

2012-10-23 20:30:41 +0300 Timo Sirainen <tss@iki.fi> (000361b)

    imap: Another fix for handling partial FETCHes.


M	src/lib-imap-storage/imap-msgpart.c

2012-10-23 20:15:36 +0300 Timo Sirainen <tss@iki.fi> (e53ab6c)

    imap: URLFETCH BINARY BODYPARTSTRUCTURE returns binary-decoded line counts.


M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-mail/message-binary-part.c
M	src/lib-mail/message-binary-part.h
M	src/lib-storage/fail-mail.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c

2012-10-23 20:09:35 +0300 Timo Sirainen <tss@iki.fi> (81b1d14)

    istream-seekable: When read() reaches EOF, unreference underlying streams.
    This was already done when the stream was kept in memory, but not when when
    the stream was written to temporary file.


M	src/lib/istream-seekable.c

2012-10-23 20:07:06 +0300 Timo Sirainen <tss@iki.fi> (84a31dd)

    imap: URLFETCH error handling fixes.


M	src/imap/cmd-urlfetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.h

2012-10-23 12:59:41 +0300 Timo Sirainen <tss@iki.fi> (a618726)

    connection API: Track the number of connections.


M	src/lib/connection.c
M	src/lib/connection.h

2012-10-23 12:34:42 +0300 Timo Sirainen <tss@iki.fi> (3e6903a)

    dsync: Use mailbox_move() to reassign UIDs instead of copy+expunge.


M	src/doveadm/dsync/dsync-mailbox-import.c

2012-10-22 18:59:20 +0300 Timo Sirainen <tss@iki.fi> (ec7a751)

    auth: Log a nicer message if client timeouts authentication in the middle.


M	src/auth/auth-request-handler.c

2012-10-22 18:35:56 +0300 Timo Sirainen <tss@iki.fi> (dfd2974)

    decode2text.sh: Assume xmlunzip exists in the same directory as this script.
    This avoids hardcoding /usr/local/libexec/dovecot/ path in it.


M	src/plugins/fts/decode2text.sh

2012-10-22 15:35:59 +0300 Timo Sirainen <tss@iki.fi> (1df39b8)

    director: -D parameter now enables extensive debug logging.


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c
M	src/director/director.h
M	src/director/main.c

2012-10-22 15:32:04 +0300 Timo Sirainen <tss@iki.fi> (a6c2d3d)

    director: Don't remove user's weak flag from notify connection. If notify
    connection worked properly, the weak flag should never have been set in the
    first place. And if it's just suddenly removed, it won't finish the pending
    requests properly.


M	src/director/notify-connection.c

2012-10-22 15:30:01 +0300 Timo Sirainen <tss@iki.fi> (38eee54)

    director: Minor code cleanup


M	src/director/director-connection.c

2012-10-22 15:29:27 +0300 Timo Sirainen <tss@iki.fi> (d40c98b)

    director: If user's weak-flag appears to have gotten stuck, unset it.


M	src/director/director-request.c
M	src/director/user-directory.c

2012-10-22 15:23:25 +0300 Timo Sirainen <tss@iki.fi> (98811ad)

    director: Log more clearly why a request timeouts.


M	src/director/director-request.c

2012-10-22 15:20:57 +0300 Timo Sirainen <tss@iki.fi> (3ee8a7e)

    director: Don't handle pending requests from all around the code. I'm not
    sure if this actually fixes any bugs, but it definitely makes the state
    cleaner.


M	src/director/director.c
M	src/director/director.h

2012-10-22 15:17:39 +0300 Timo Sirainen <tss@iki.fi> (d3211a8)

    director: Fixed previous broken change for handling USER-WEAK commands.


M	src/director/director-connection.c

2012-10-21 12:20:30 +0300 Timo Sirainen <tss@iki.fi> (c307328)

    doveadm sync/backup: Added -s <state> parameter to do a fast stateful sync.
    Initially use an empty string for the input state. The output state is
    written to stdout.


M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
D	src/doveadm/dsync/dsync-mailbox-state-export.h
M	src/doveadm/dsync/dsync-mailbox-state.c
M	src/doveadm/dsync/dsync-mailbox-state.h
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree.h

2012-10-21 10:01:54 +0300 Timo Sirainen <tss@iki.fi> (e831268)

    doveadm: "backup" command is working again.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-ibc.h
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree.h
M	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2012-10-21 08:22:20 +0300 Timo Sirainen <tss@iki.fi> (ed15753)

    lib-storage: Fixed deleting mailbox when mail_attribute_dict wasn't set.


M	src/lib-storage/index/index-attribute.c

2012-10-21 07:29:04 +0300 Timo Sirainen <tss@iki.fi> (ba88676)

    lib-fs: Fixes to async APIs.


M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h

2012-10-21 07:13:44 +0300 Timo Sirainen <tss@iki.fi> (9e04a4a)

    redis dict: Log an error if we get disconnected unexpectedly.


M	src/lib-dict/dict-redis.c

2012-10-18 06:58:01 +0300 Timo Sirainen <tss@iki.fi> (aa92329)

    lib-imap-urlauth: Minor fix to avoiding timing attacks against mailbox
    existence. random_fill() is slightly slower than random_fill_weak().
    Probably even better way to handle timing attacks would be to always add a
    short random pause before returning verification failure.


M	src/lib-imap-urlauth/imap-urlauth.c

2012-10-18 06:55:04 +0300 Timo Sirainen <tss@iki.fi> (70375a5)

    Moved random_init() from lib-imap-urlauth to imap/imap-urlauth main(). This
    way if the processes are chrooted they are still able to open /dev/urandom.


M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap/main.c
M	src/lib-imap-urlauth/imap-urlauth.c

2012-10-18 06:45:39 +0300 Timo Sirainen <tss@iki.fi> (bb86f8f)

    lib-index: Crashfix for MAIL_INDEX_OPEN_FLAG_SAVEONLY change.


M	src/lib-index/mail-cache.c

2012-10-18 06:21:25 +0300 Timo Sirainen <tss@iki.fi> (da62041)

    login_log_format_elements: Added %{real_rip} variable. It differs from %r
    when Dovecot proxy sends an updated client IP address. Patch by Jack Bates.


M	src/login-common/client-common.c
M	src/login-common/client-common.h

2012-10-18 06:00:18 +0300 Timo Sirainen <tss@iki.fi> (4fcee75)

    lib-index: Fixed handling of finding a duplicate dovecot.index.log file_seq
    Previously we assumed that the already opened file was always the wrong one,
    but more common was that the newly opened file was .log.2 which should have
    been deleted.


M	src/lib-index/mail-transaction-log-file.c

2012-10-18 05:55:30 +0300 Timo Sirainen <tss@iki.fi> (b222354)

    lib-index: Handle better race condition there dovecot.index.log and .log.2
    are the same link.


M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c

2012-10-18 05:23:27 +0300 Timo Sirainen <tss@iki.fi> (8f76fdf)

    lib-storage: Open index with MAIL_INDEX_OPEN_FLAG_SAVEONLY if mailbox has
    MAILBOX_FLAG_SAVEONLY


M	src/lib-storage/index/index-storage.c

2012-10-18 05:22:36 +0300 Timo Sirainen <tss@iki.fi> (18d92db)

    lib-index: Added MAIL_INDEX_OPEN_FLAG_SAVEONLY to do only minimal reads from
    cache file.


M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index.h

2012-10-18 05:16:54 +0300 Timo Sirainen <tss@iki.fi> (8ac6622)

    lib-index: Code cleanup: Removed mail_cache.data


M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.c

2012-10-18 05:10:29 +0300 Timo Sirainen <tss@iki.fi> (82ed697)

    lib-index: mail_cache_map() API cleanup


M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c

2012-10-16 03:34:51 +0300 Timo Sirainen <tss@iki.fi> (048e40f)

    dict quota: Fixed a potential crash if quota recalculation was triggered at
    deinit.


M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c

2012-10-16 03:08:21 +0300 Timo Sirainen <tss@iki.fi> (4511a1f)

    lib-master: Fixed -i <instance name> parameter handling. It previously
    worked only if the default config socket wasn't usable.


M	src/lib-master/master-service.c

2012-10-13 04:30:17 +0300 Timo Sirainen <tss@iki.fi> (8bad545)

    lib-storage: Added missing file from previous mailbox attribute commit.


A	src/lib-storage/index/index-attribute.c

2012-10-13 04:28:09 +0300 Timo Sirainen <tss@iki.fi> (4abdade)

    imap-urlauth: Store urlauth keys to the new mailbox attributes.


M	doc/example-config/conf.d/20-imap.conf
M	src/imap-urlauth/imap-urlauth-worker-settings.c
M	src/imap-urlauth/imap-urlauth-worker-settings.h
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap/imap-client.c
M	src/imap/imap-settings.c
M	src/imap/imap-settings.h
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-backend.h
M	src/lib-imap-urlauth/imap-urlauth-private.h
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-imap-urlauth/imap-urlauth.h

2012-10-13 04:27:14 +0300 Timo Sirainen <tss@iki.fi> (62041df)

    lib-storage: Added support to get/set/iterate mailbox attributes. The
    attributes are stored in a dict specified by mail_attribute_dict setting.
    The idea is to use this as storage for extensions that require per-mailbox
    key=value pairs, such as METADATA.


M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/plugins/virtual/virtual-storage.c

2012-10-13 04:18:26 +0300 Timo Sirainen <tss@iki.fi> (6b3c7d7)

    dict: If DICT_ITERATE_FLAG_NO_VALUE is set, don't send values to dict
    client.


M	src/dict/dict-commands.c
M	src/dict/dict-connection.h

2012-10-13 04:17:45 +0300 Timo Sirainen <tss@iki.fi> (63b9388)

    lib-dict: Added DICT_ITERATE_FLAG_NO_VALUE This allows iterating dictionary
    without wasting extra time on returning values that aren't needed.


M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.h

2012-10-13 01:57:24 +0300 Timo Sirainen <tss@iki.fi> (d49214c)

    imap-urlauth: Use mailbox GUID instead of mailbox name for dict keys


M	src/imap/cmd-resetkey.c
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-imap-urlauth/imap-urlauth-backend.h
M	src/lib-imap-urlauth/imap-urlauth.c

2012-10-13 01:38:48 +0300 Timo Sirainen <tss@iki.fi> (c02db5c)

    example-config: Added imap_urlauth_* settings


M	doc/example-config/conf.d/20-imap.conf

2012-10-13 01:36:13 +0300 Timo Sirainen <tss@iki.fi> (ca16588)

    imap urlauth: Don't autofill imap_urlauth_host. Use "*" value to mean "any
    host".


M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap/imap-client.c
M	src/lib-imap-urlauth/imap-urlauth.c

2012-10-13 01:09:37 +0300 Timo Sirainen <tss@iki.fi> (eca3895)

    lib-dict: dict_init() now returns error string instead of logging it


M	src/auth/db-dict.c
M	src/dict/dict-connection.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql-settings.h
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/quota/quota-dict.c

2012-10-13 01:03:13 +0300 Timo Sirainen <tss@iki.fi> (803197a)

    lib-settings: settings_read*() now returns an error string instead of
    logging itself


M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-sql.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-settings/settings.c
M	src/lib-settings/settings.h

2012-10-13 00:40:41 +0300 Timo Sirainen <tss@iki.fi> (4605cab)

    Moved doveadm zlib commands from zlib plugin to doveadm directly. Previously
    it was a plugin, because the istream-zlib existed only in zlib plugin. Now
    there's a lib-compression that implements it.


M	src/doveadm/Makefile.am
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-dump.h
R090	src/plugins/zlib/doveadm-zlib.c	src/doveadm/doveadm-zlib.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h
M	src/plugins/zlib/Makefile.am

2012-10-13 00:32:34 +0300 Timo Sirainen <tss@iki.fi> (439dd06)

    istream: Added internal try_alloc_limit to limit size returned by
    i_stream_try_alloc() This was required by the previous SSL change.


M	src/lib/istream-private.h
M	src/lib/istream.c

2012-10-13 00:24:47 +0300 Timo Sirainen <tss@iki.fi> (739125f)

    lib-ssl-iostream: Make the input buffering behave the same as in
    file-istream Previously i_stream_read(ssl_input) could have still left some
    data buffered into the underlying file-istream, which meant that I/O loop
    didn't detect any new input from the fd and the connection got stuck.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/istream-openssl.c

2012-10-12 23:18:58 +0300 Timo Sirainen <tss@iki.fi> (7020f56)

    config: Added lib-master's settings parsers back to config's knowledge


M	src/config/settings-get.pl

2012-10-12 23:05:43 +0300 Timo Sirainen <tss@iki.fi> (309107e)

    configure: Make sure MYSQL_LIBS has -lmysqlclient even if it's not
    explicitly found.


M	configure.in

2012-10-12 08:48:25 +0300 Timo Sirainen <tss@iki.fi> (5a2b30e)

    lib-storage: Fixed crash when attempting to remove subscriptions for
    nonexistent shared users.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2012-10-12 08:39:31 +0300 Timo Sirainen <tss@iki.fi> (b71e087)

    lib-index: dovecot.index file is no longer overwritten, so it doesn't need
    to be locked.


M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index.c

2012-10-12 08:31:15 +0300 Timo Sirainen <tss@iki.fi> (b886e3d)

    lib-index: Log a warning if locking transaction log takes longer than 30
    secs.


M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c

2012-10-12 07:58:17 +0300 Timo Sirainen <tss@iki.fi> (d817aa1)

    maildir: If INDEXPVT is set, assume private \Seen flags even if
    dovecot-shared doesn't exist.


M	src/lib-storage/index/maildir/maildir-storage.c

2012-10-12 05:45:42 +0300 Timo Sirainen <tss@iki.fi> (69af83d)

    lib-storage: Added support for "broken_char" setting for escaping invalid
    mailbox names. This is currently enabled only for imapc backend, where '~'
    character is used for it.

    Most importantly this allows migrating mailboxes from other IMAP servers 
    that contain mailbox names that Dovecot's imapc backend couldn't otherwise 
    access.

M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2012-10-12 03:47:41 +0300 Timo Sirainen <tss@iki.fi> (917498e)

    lib-storage: Added optional mailbox_list.init(), which can check for
    failure. "index" backend now gives a nice error message instead of crashing
    when mailbox_list_index=no


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2012-10-12 03:17:56 +0300 Timo Sirainen <tss@iki.fi> (83b97bc)

    Build imapc and pop3c always as plugins. This avoids having to link openssl
    library to all binaries that use lib-storage. It appears that simply by
    linking with openssl causes each such process to use 100-200 kB of more
    memory. With 10k imap processes this is 1-2 GB of wasted memory.

    The imapc and pop3c are still registered as stubs, and their plugins are 
    automatically loaded when needed.

M	configure.in
M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
A	src/lib-storage/index/imapc/imapc-plugin.c
A	src/lib-storage/index/imapc/imapc-plugin.h
A	src/lib-storage/index/imapc/imapc-setting-storage.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/pop3c/Makefile.am
A	src/lib-storage/index/pop3c/pop3c-plugin.c
A	src/lib-storage/index/pop3c/pop3c-plugin.h
A	src/lib-storage/index/pop3c/pop3c-setting-storage.c
M	src/lib-storage/index/pop3c/pop3c-settings.h
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-storage.h

2012-10-12 03:12:19 +0300 Timo Sirainen <tss@iki.fi> (87ca4b2)

    lib-storage: Added mail_user_get_storage_class(), which auto-loads storage
    plugins. The auto-loading is done only if there's already a stub storage
    registered.


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2012-10-12 03:09:27 +0300 Timo Sirainen <tss@iki.fi> (ad8fdcb)

    Makefile: Added cc-wrapper.sh.in missing from last commit


M	Makefile.am

2012-10-12 03:08:13 +0300 Timo Sirainen <tss@iki.fi> (d80a9e1)

    --without-shared-libs: Link Dovecot libraries with --whole-archive flag for
    binaries. This removes the need for the ugly unused_objects lists for
    binaries, which were needed to avoid plugins from failing because they were
    missing some functions.

    Apparently there's no easy way to use --whole-archive properly with libtool, 
    so there's now a rather ugly cc-wrapper.sh that does it. Also this is done 
    only when GNU ld is deted. Most people are going to use --with-shared-libs 
    though, so I don't think any of this is going to be a real problem.

M	.hgignore
A	cc-wrapper.sh.in
M	configure.in
M	src/doveadm/Makefile.am
M	src/indexer/Makefile.am
M	src/lda/Makefile.am
M	src/lmtp/Makefile.am
M	src/pop3/Makefile.am

2012-10-12 02:59:59 +0300 Timo Sirainen <tss@iki.fi> (7e22696)

    config: Don't include lib-master/*.c files in all-settings.c lib-master is
    already being linked to the binaries anyway.


M	configure.in

2012-10-12 01:21:30 +0300 Timo Sirainen <tss@iki.fi> (14ee25b)

    imap: Don't waste data stack memory at startup.


M	src/imap/main.c

2012-10-12 01:17:05 +0300 Timo Sirainen <tss@iki.fi> (ce9a7b1)

    hostpid_init(): Don't waste memory from data stack. Even though it's only a
    few bytes, it was being wasted permanently for all processes.


M	src/lib/hostpid.c

2012-10-12 01:06:13 +0300 Timo Sirainen <tss@iki.fi> (ca4526e)

    i_set_failure_prefix() now takes printf-like parameters. This avoids using
    t_strdup_printf() with it, which was done very commonly.


M	src/doveadm/doveadm-mail.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service.c
M	src/lib-storage/mail-storage-service.c
M	src/lib/failures.c
M	src/lib/failures.h
M	src/lmtp/commands.c
M	src/log/log-connection.c
M	src/master/main.c

2012-10-12 01:03:49 +0300 Timo Sirainen <tss@iki.fi> (c58c357)

    lib-index: Error handling fix to cache transaction flushing.


M	src/lib-index/mail-cache-transaction.c

2012-10-12 00:51:41 +0300 Timo Sirainen <tss@iki.fi> (bd63b5b)

    Plugin ABI version checking improvements. Previously the plugin version was
    checked against the version string returned by the currently running Dovecot
    master process, not necessarily the same as the binary. Also
    version_ignore=yes setting skipped the version check entirely.

    Now there's a new DOVECOT_ABI_VERSION macro that can (at least in theory) be 
    updated only when the ABI actually changes. The version is in format
    "2.2.ABIv1(2.2.15)", where the (2.2.15) would be the actual Dovecot version 
    number that gets ignored when comparing the strings.

    Also now the plugin version is compared to the actually running binary's 
    ABI, not the master's version, and it can't be ignored with a setting.

M	configure.in
M	src/auth/main.c
M	src/config/config-parser.c
M	src/dict/main.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-util.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c
M	src/lib-storage/mail-storage-service.c
M	src/lib/module-dir.c
M	src/lib/module-dir.h
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mailbox-alias/mailbox-alias-plugin.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/plugins/zlib/zlib-plugin.c

2012-10-12 00:30:23 +0300 Timo Sirainen <tss@iki.fi> (abceedf)

    sdbox: Make sure mail_attachment_fs=sis-queue isn't attempted to be used. It
    could be fixed, but nobody seems to have used it so far..


M	src/lib-storage/index/dbox-common/dbox-storage.c

2012-10-12 00:29:41 +0300 Timo Sirainen <tss@iki.fi> (c94d8d6)

    sdbox: Class didn't have MAIL_STORAGE_CLASS_FLAG_FILE_PER_MSG set This
    currently only meant that mail_prefetch_count setting wasn't working.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2012-10-12 00:22:19 +0300 Timo Sirainen <tss@iki.fi> (c59b9c2)

    lib-fs API cleanups and improvements


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-common.h
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/index-attachment.c

2012-10-11 23:01:13 +0300 Timo Sirainen <tss@iki.fi> (2b01d76)

    Compiler warning fix.


M	src/lib-http/http-url.c

2012-10-10 23:59:12 +0300 Stephan Bosch <stephan@rename-it.nl> (1bd20e2)

    Add HTTP date parsing support.


M	src/lib-http/Makefile.am
A	src/lib-http/http-date.c
A	src/lib-http/http-date.h
A	src/lib-http/test-http-date.c
A	src/lib-http/test-http-header-parser.c

2012-10-10 23:57:56 +0300 Stephan Bosch <stephan@rename-it.nl> (5394bed)

    Adds HTTP URL parse support.


M	configure.in
M	src/Makefile.am
A	src/lib-http/Makefile.am
A	src/lib-http/http-url.c
A	src/lib-http/http-url.h
A	src/lib-http/test-http-url.c

2012-10-10 23:56:01 +0300 Stephan Bosch <stephan@rename-it.nl> (17c29e3)

    Adjust IMAP URL parser to changes in uri-util.


M	src/lib-imap/imap-url.c
M	src/lib-imap/test-imap-url.c

2012-10-10 23:55:21 +0300 Stephan Bosch <stephan@rename-it.nl> (05262e3)

    uri-util: Fix handling of '..' and '.' segments in URI paths. As specified
    by RFC 3986


M	src/lib/uri-util.c

2012-10-08 08:53:54 +0300 Timo Sirainen <tss@iki.fi> (3654618)

    master: If service { protocol } is set and not included in "protocols",
    ignore its settings


M	src/master/master-settings.c

2012-10-08 03:14:12 +0300 Timo Sirainen <tss@iki.fi> (854255e)

    fts-lucene: doveadm fts rescan crashed with mailbox_list_index=yes


M	src/plugins/fts-lucene/lucene-wrapper.cc

2012-10-08 00:48:55 +0300 Timo Sirainen <tss@iki.fi> (b07cb60)

    fts-lucene: Compile fix for previous unlink_directory() change


M	src/plugins/fts-lucene/lucene-wrapper.cc

2012-10-08 00:00:55 +0300 Timo Sirainen <tss@iki.fi> (e85a9aa)

    unlink_directory(): Added UNLINK_DIRECTORY_FLAG_SKIP_DOTFILES flag.


M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-directory.h

2012-10-05 00:15:01 +0300 Timo Sirainen <tss@iki.fi> (5ae75c7)

    lib-storage: Don't crash when searching multiple keywords. Fixed by simply
    removing the keyword merging code. mail_search_args_simplify() is called
    before mail_search_args_init(), so the keywords are still NULL and merging
    can't be done. Alternative fix would have been to add string array to
    mail_search_arg.value containing the keywords, but all of this is a pretty
    unnecessary optimization.


M	src/lib-storage/mail-search.c

2012-10-04 02:34:53 +0300 Timo Sirainen <tss@iki.fi> (289064e)

    lib-index: Simplified writing to dovecot.index.cache file. The old method
    was basically:  - write max. 32 kB to internal buffer  - flush it by writing
    to reserved areas (with no locks)

    The reserved areas were acquired by doing (whenever needed):
    - lock dovecot.index.cache
    - reserve data from dovecot.index.cache for writing, potentially increasing
      the file size by writing 0 bytes. the reserved area size varies.
    - unlock dovecot.index.cache

    This worked, but if multiple processes were writing to the cache file it 
    could have left incomplete reserved areas as holes. The holes were attempted 
    to be filled if they were large enough.

    The new method is:
    - write max. 256 kB to internal buffer
    - lock dovecot.index.cache
    - append the buffer to dovecot.index.cache
    - unlock dovecot.index.cache

    No reserved areas, holes or anything else weird going on.

    Ideally no data would be overwritten in the dovecot.index.cache file, only 
    appended. Unfortunately currently some data is still overwritten:
    - mail_cache_header.{deleted_space,continued_record_count}
    - mail_cache_header_fields.next_offset when writing a new one
    - mail_cache_header_fields.{last_used,decision}
    - mail_cache_record.prev_offset

    The changing headers could eventually be moved to dovecot.index. This 
    however is a backwards-incompatible change. The record's prev_offset could 
    maybe simply just not be written in those (somewhat rare) problematic 
    situations.

M	src/doveadm/doveadm-dump-index.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c

2012-10-04 02:08:23 +0300 Timo Sirainen <tss@iki.fi> (330206f)

    dbox: Index rebuilding didn't open dovecot.index.backup file. Recent changes
    broke it, and it was attemting to use dovecot.index/.backup file instead.


M	src/lib-storage/index/index-rebuild.c

2012-10-04 00:56:14 +0300 Timo Sirainen <tss@iki.fi> (12d535f)

    Added/updated some copyright comments.


M	AUTHORS
M	src/doveadm/doveadm-pw.c
M	src/lib-imap/test-imap-url.c
M	src/lib-sql/driver-sqlite.c
M	src/lib/ioloop-epoll.c
M	src/lib/iso8601-date.c
M	src/lib/primes.c
M	src/lib/test-iso8601-date.c
M	src/master/capabilities-posix.c
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-storage.c

2012-10-03 18:17:26 +0300 Timo Sirainen <tss@iki.fi> (bdd36cf)

    Renamed network.[ch] to net.[ch]. The function prefixes already started with
    net_ instead of network_. And icecap wants to use network.h for other
    purpose. :)


M	src/auth/auth-client-connection.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.h
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/db-ldap.c
M	src/auth/main.c
M	src/auth/passdb-pam.c
M	src/config/config-filter.h
M	src/config/settings-get.pl
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.h
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.h
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/server-connection.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.h
M	src/imap-urlauth/imap-urlauth-client.c
M	src/imap-urlauth/imap-urlauth-login.c
M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-urlfetch.c
M	src/imap/imap-client.c
M	src/lib-auth/auth-client.h
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h
M	src/lib-auth/auth-server-connection.c
M	src/lib-dict/dict-client.c
M	src/lib-dns/dns-lookup.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c
M	src/lib-imap/imap-url.c
M	src/lib-imap/test-imap-url.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-auth.h
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-service-settings.h
M	src/lib-master/master-service.h
M	src/lib-settings/settings-parser.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/mail-storage-service.h
M	src/lib-storage/mail-user.c
M	src/lib/Makefile.am
M	src/lib/connection.c
M	src/lib/connection.h
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/istream-file.c
R099	src/lib/network.c	src/lib/net.c
R099	src/lib/network.h	src/lib/net.h
M	src/lib/ostream-file.c
M	src/lib/sendfile-util.c
M	src/lib/test-network.c
M	src/lib/unix-socket-create.c
M	src/lib/uri-util.c
M	src/lmtp/client.h
M	src/lmtp/lmtp-proxy.h
M	src/login-common/access-lookup.c
M	src/login-common/client-common.h
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.h
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/master/master-settings.c
M	src/master/service-listen.c
M	src/master/service.h
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/quota/quota.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/pop3-login/client.h
M	src/pop3/pop3-client.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/stats/client-export.c
M	src/stats/mail-stats.h
M	src/util/rawlog.c

2012-10-03 16:57:28 +0300 Timo Sirainen <tss@iki.fi> (32fabcf)

    auth: More error checking and cleanups to SCRAM-SHA-1.


M	src/auth/mech-scram-sha1.c
M	src/auth/password-scheme-scram.c
M	src/auth/password-scheme.h

2012-10-03 05:43:27 +0300 Timo Sirainen <tss@iki.fi> (3f360d0)

    lib-storage: Fixed potential memory leak when
    mailbox_transaction_commit_get_changes() failed


M	src/lib-storage/mail-storage.c

2012-10-03 05:42:55 +0300 Timo Sirainen <tss@iki.fi> (a00b7f4)

    lib-storage: When configuring mailbox INBOX {}, make sure INBOX is
    uppercased.


M	src/lib-storage/mailbox-list-iter.c

2012-10-03 05:41:46 +0300 Timo Sirainen <tss@iki.fi> (ffb79ef)

    lib-index: Fix for handling view syncing for already deleted transaction
    logs. The sync changes' hidden-flag was set randomly, which could have
    caused flag changes to get lost.


M	src/lib-index/mail-index-view-sync.c

2012-10-03 05:20:29 +0300 Timo Sirainen <tss@iki.fi> (ca26874)

    imap: LIST (SPECIAL-USE) shouldn't send INBOX reply.


M	src/imap/cmd-list.c

2012-10-03 05:15:11 +0300 Timo Sirainen <tss@iki.fi> (7e418de)

    maildir: Fixed crash with mailbox_list_index=yes


M	src/lib-storage/index/maildir/maildir-sync-index.c

2012-10-03 04:14:33 +0300 Timo Sirainen <tss@iki.fi> (8f2eb1e)

    lib-dict: Fixed error handling on initialization.


M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c

2012-10-03 04:09:23 +0300 Timo Sirainen <tss@iki.fi> (d9515a2)

    lib-master: Fixed crashing with -i <instance> parameter handling.


M	src/lib-master/master-service.c

2012-10-03 04:01:59 +0300 Timo Sirainen <tss@iki.fi> (97cb20e)

    Typofix: s/TRANSCATION/TRANSACTION/


M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c

2012-10-03 01:38:20 +0300 Timo Sirainen <tss@iki.fi> (9a790c9)

    sdbox: Fix to handling transactions with partially failed saves.


M	src/lib-storage/index/dbox-single/sdbox-save.c

2012-10-03 01:26:42 +0300 Timo Sirainen <tss@iki.fi> (60f5757)

    mdbox: Fix to handling transactions with partially failed saves.


M	src/lib-storage/index/dbox-common/dbox-file.c

2012-10-03 01:20:22 +0300 Timo Sirainen <tss@iki.fi> (1e5c037)

    lib-storage: mailbox_save_cancel() now makes sure that dest_mail is reset.
    This fixes e.g. doveadm import, which continues import even though some
    messages couldn't be saved.


M	src/lib-storage/mail-storage.c

2012-10-03 01:19:19 +0300 Timo Sirainen <tss@iki.fi> (4906414)

    lib-storage: struct mail.close() now clears all of its data.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2012-10-03 01:12:13 +0300 Timo Sirainen <tss@iki.fi> (c3d9da3)

    dbox: Small code cleanup.


M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-save.c

2012-10-02 23:24:10 +0300 Timo Sirainen <tss@iki.fi> (231f124)

    lib-storage: When index mkdir() fails with EPERM, create the dir anyway with
    0700 mode. This avoids failing entirely when /var/mail/user has 0660
    permissions and we don't have access to the group. The error message is
    still logged.


M	src/lib-storage/mailbox-list.c

2012-10-02 23:12:07 +0300 Timo Sirainen <tss@iki.fi> (0b617d3)

    lib-master: Fixed crashes with settings cache.


M	src/lib-master/master-service-settings-cache.c

2012-10-02 22:37:49 +0300 Timo Sirainen <tss@iki.fi> (da5bcae)

    doveadm: Fixed printing large input from doveadm-server.


M	src/doveadm/server-connection.c

2012-10-02 21:56:09 +0300 Timo Sirainen <tss@iki.fi> (a7e1fd4)

    mbox: Fixed getting filesystem permissions when parent dir has setgid-bit
    enabled.


M	src/lib-storage/mailbox-list.c

2012-10-02 21:36:43 +0300 Timo Sirainen <tss@iki.fi> (a00cebf)

    lmtp: Fixed hanging on proxying if remote server was down. Patch by Jack
    Bates.


M	src/lmtp/lmtp-proxy.c

2012-09-28 15:12:28 +0300 Timo Sirainen <tss@iki.fi> (a092650)

    Compiling fix for HURD


M	src/lib/compat.h

2012-09-28 15:11:30 +0300 Timo Sirainen <tss@iki.fi> (cf9abf1)

    Avoid using PATH_MAX.


M	src/lib-storage/index/dbox-common/dbox-storage.c

2012-09-28 15:07:11 +0300 Timo Sirainen <tss@iki.fi> (63998e4)

    Avoid using PATH_MAX.


M	src/lib-master/master-instance.c
M	src/lib-storage/index/dbox-common/dbox-storage.c

2012-09-27 02:55:14 +0300 Timo Sirainen <tss@iki.fi> (0c4eca8)

    mdbox: Don't crash in storage rebuild if mail's "original mailbox" metadata
    is missing.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2012-09-27 00:19:41 +0300 Timo Sirainen <tss@iki.fi> (ab406f5)

    doveadm altmove: Make sure all storages get purged (and not more than once)


M	src/doveadm/doveadm-mail-altmove.c

2012-09-26 21:14:23 +0300 Timo Sirainen <tss@iki.fi> (9a1a4c2)

    i_getpwnam(): Ignore EINVAL errors silently. At least FreeBSD returns it
    when attempting to lookup user@domain.


M	src/lib/ipwd.c

2012-09-26 21:12:37 +0300 Timo Sirainen <tss@iki.fi> (a94f37b)

    lazy-expunge: Fixed handling non-default namespace separator.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2012-09-24 17:03:42 +0300 Timo Sirainen <tss@iki.fi> (be83284)

    auth ldap: Previous change broke %$ variable.


M	src/auth/auth-request.c
M	src/auth/db-ldap.c

2012-09-24 16:49:29 +0300 Timo Sirainen <tss@iki.fi> (4bbc8a4)

    ldap auth: Update %variables after each field update. The previous behavior
    was a bit confusing. "uid=user" at the beginning updated the %u variable,
    but if it was after templates it didn't update it. Also "=user=%{uid}" that
    was supposed to be equivalent wasn't. Now the behavior is consistent across
    all ways to set the fields.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/db-ldap.c

2012-09-24 14:42:38 +0300 Timo Sirainen <tss@iki.fi> (360123b)

    lib-storage: Added ALTNOCHECK option to mail_location. By default Dovecot
    verifies that $rootdir/dbox-alt-root symlink matches the ALT directory
    location, and logs an error if not. This is mainly to avoid accidents during
    initial configuration when for example alt dir was set in global
    mail_location but was forgotten to be set in userdb reply's mail_location.
    The ALTNOCHECK setting simply doesn't check or create this symlink, giving a
    (very) small performance improvement.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2012-09-24 14:33:52 +0300 Timo Sirainen <tss@iki.fi> (02e8b5f)

    lmtp: Added lmtp_rcpt_check_quota setting to check quota already on RCPT TO.


M	doc/example-config/conf.d/20-lmtp.conf
M	src/lmtp/commands.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h

2012-09-24 14:31:16 +0300 Timo Sirainen <tss@iki.fi> (9357960)

    lib-storage: Added STATUS_CHECK_OVER_QUOTA for checking if user is over
    quota.


M	src/lib-storage/mail-storage.h
M	src/plugins/quota/quota-storage.c

2012-09-24 14:24:58 +0300 Timo Sirainen <tss@iki.fi> (812c65b)

    imapc: And another compile fix.. Using the macro would have required
    config/all-settings.c to include imapc-client.h, which is a bit too much
    trouble just for this.


M	src/lib-storage/index/imapc/imapc-settings.c

2012-09-24 14:22:40 +0300 Timo Sirainen <tss@iki.fi> (25351f4)

    imapc: Compile fix for previous change.


M	src/lib-storage/index/imapc/imapc-settings.c

2012-09-24 14:16:41 +0300 Timo Sirainen <tss@iki.fi> (b5bdc43)

    auth: passdb imap assert-crashed always


M	src/auth/passdb-imap.c

2012-09-24 14:16:32 +0300 Timo Sirainen <tss@iki.fi> (bf5a238)

    imapc: Added IMAPC_DEFAULT_MAX_IDLE_TIME macro.


M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/imapc-settings.c

2012-09-22 19:23:15 +0300 Timo Sirainen <tss@iki.fi> (eaccbf3)

    lib-lda: After auto-creating mailbox only open it, don't bother syncing it.


M	src/lib-lda/mail-deliver.c

2012-09-21 11:44:17 +0200 Timo Sirainen <tss@iki.fi> (c684835)

    mdbox: Delay getting permissions for map/message files. This avoids a stat()
    if no mailbox is opened.


M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-map-private.h
M	src/lib-storage/index/dbox-multi/mdbox-map.c

2012-09-21 09:26:10 +0200 Timo Sirainen <tss@iki.fi> (a795ff0)

    lmtp: After successful proxying RCPT TO, the second one to nonexistent user
    gave tempfail error. Instead of "unknown user" it gave "Can't handle mixed
    proxy/non-proxy destinations".


M	src/lmtp/commands.c

2012-09-21 09:23:58 +0200 Timo Sirainen <tss@iki.fi> (e8694bd)

    lmtp: RSET/LHLO should reset any pending proxy connections.


M	src/lmtp/client.c

2012-09-21 09:22:54 +0200 Timo Sirainen <tss@iki.fi> (059b4bb)

    config: Don't ignore invalid network/mask in local/remote blocks


M	src/config/config-parser.c

2012-09-19 03:13:39 +0200 Florian Zeitz <florob@babelmonkeys.de> (8455d9a)

    auth: Add and use SCRAM-SHA-1 password scheme


M	src/auth/Makefile.am
M	src/auth/mech-scram-sha1.c
A	src/auth/password-scheme-scram.c
M	src/auth/password-scheme.c
M	src/auth/password-scheme.h

2012-10-03 03:20:57 +0300 Timo Sirainen <tss@iki.fi> (11db8fc)

    imap: If CLOSE/EXPUNGE fails with "permission denied", return tagged OK
    anyway.


M	src/imap/cmd-close.c
M	src/imap/cmd-expunge.c

2012-10-03 03:20:15 +0300 Timo Sirainen <tss@iki.fi> (742230f)

    acl: Don't silently ignore permission error on expunge.


M	src/plugins/acl/acl-mailbox.c

2012-10-03 03:19:20 +0300 Timo Sirainen <tss@iki.fi> (24491cf)

    imap: Removed unnecessary code.


M	src/imap/cmd-expunge.c
M	src/imap/imap-client.h
M	src/imap/imap-sync.c

2012-10-03 02:29:02 +0300 Timo Sirainen <tss@iki.fi> (8c5eeb1)

    imap: Fixed partial FETCHes.


M	src/lib-imap-storage/imap-msgpart.c

2012-10-03 02:28:44 +0300 Timo Sirainen <tss@iki.fi> (714611c)

    lib-mail: Moved message_skip_virtual() to message-size.[ch] and changed API


M	src/lib-mail/Makefile.am
D	src/lib-mail/message-send.c
D	src/lib-mail/message-send.h
M	src/lib-mail/message-size.c
M	src/lib-mail/message-size.h

2012-10-03 02:28:31 +0300 Timo Sirainen <tss@iki.fi> (9e1d2c8)

    imap: Removed unnecessary #includes


M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c

2012-09-30 19:11:55 +0300 Timo Sirainen <tss@iki.fi> (0c1835a)

    Added [io]_stream_create_error() for creating streams that always fail
    reads/writes.


M	src/lib/istream.c
M	src/lib/istream.h
M	src/lib/ostream.c
M	src/lib/ostream.h

2012-10-03 00:41:18 +0300 Timo Sirainen <tss@iki.fi> (e31bf60)

    auth: Don't add proxy/pass fields when we're only authenticating (not
    logging in). For example SMTP server doesn't need these fields when doing
    SMTP AUTH.


M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h

2012-09-18 21:42:34 +0300 Timo Sirainen <tss@iki.fi> (3f1d004)

    Added signature for changeset 1a6c3b4e92e4


M	.hgsigs

2012-09-18 21:42:27 +0300 Timo Sirainen <tss@iki.fi> (54955c2)

    Added tag 2.1.10 for changeset 1a6c3b4e92e4


M	.hgtags

2012-09-18 21:42:27 +0300 Timo Sirainen <tss@iki.fi> (01ebee3)

    Released v2.1.10.


M	NEWS
M	configure.in

2012-09-18 20:53:50 +0300 Timo Sirainen <tss@iki.fi> (ff057a4)

    fts-lucene: Compiling fix for previous change


M	src/plugins/fts-lucene/lucene-wrapper.cc

2012-09-18 20:48:25 +0300 Timo Sirainen <tss@iki.fi> (3f902db)

    director: Fixed weak-user handling when there is only one director.


M	src/director/director-request.c

2012-09-18 20:09:03 +0300 Timo Sirainen <tss@iki.fi> (6dbe040)

    fts-lucene: Added "normalize" option to put data through user's normalizer
    function.


M	src/plugins/fts-lucene/Snowball.cc
M	src/plugins/fts-lucene/SnowballAnalyzer.h
M	src/plugins/fts-lucene/SnowballFilter.h
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc

2012-09-18 20:07:21 +0300 Timo Sirainen <tss@iki.fi> (d74c954)

    Backported parts of normalizer_func_t changes from v2.2 tree.


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/lib/unichar.h

2012-09-18 20:06:56 +0300 Timo Sirainen <tss@iki.fi> (65cca83)

    lib-storage: Compiling fix for previous alias symlink change


M	src/lib-storage/mailbox-list.c

2012-09-18 19:57:48 +0300 Timo Sirainen <tss@iki.fi> (eefd884)

    auth: userdb static used auth caching wrong when verifying user existence
    with passdb lookup. Cache entries were being looked/added for userdbs
    instead of passdbs. This caused problems at least with:

    a) Multiple userdbs (where static userdb was the last). Passdb results were 
    added as cache entries to the first userdbs, possibly causing some
    confusion.

    b) Multiple passdbs, because the first passdb result was added to cache and 
    used for the rest of the passdbs.

M	src/auth/userdb-static.c

2012-09-18 19:16:04 +0300 Timo Sirainen <tss@iki.fi> (d7babe0)

    quota: Allow negative percentage rules up to -99%


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2012-09-18 18:44:46 +0300 Timo Sirainen <tss@iki.fi> (7313101)

    Added mailbox-alias plugin. Aliases can be created like:

    plugin {
     mailbox_alias_old = Sent
     mailbox_alias_new = Sent Messages
     mailbox_alias_old2 = Sent
     mailbox_alias_new2 = Sent Items
    }

    When creating an alias, the original mailbox is also created. The alias 
    itself is a symlink to the original. Deleting an alias deletes the symlink. 
    The original mailbox can't be deleted or renamed while it has aliases. 
    Aliases cannot be renamed. Aliases are skipped when recalculating quota.

    If a mailbox with the alias's name was already created before the aliasing 
    was enabled, it's not treated as alias until it's first deleted.

M	configure.in
M	src/plugins/Makefile.am
A	src/plugins/mailbox-alias/Makefile.am
A	src/plugins/mailbox-alias/mailbox-alias-plugin.c
A	src/plugins/mailbox-alias/mailbox-alias-plugin.h

2012-09-18 18:41:01 +0300 Timo Sirainen <tss@iki.fi> (9dfd7d4)

    fts-solr: Skip alias symlinks when rescanning.


M	src/plugins/fts-solr/fts-backend-solr.c

2012-09-18 18:40:46 +0300 Timo Sirainen <tss@iki.fi> (09b4a50)

    quota: Skip alias symlinks when calculating quota


M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-maildir.c

2012-09-18 18:40:17 +0300 Timo Sirainen <tss@iki.fi> (77b5fd5)

    lib-storage: MAILBOX_LIST_ITER_SKIP_ALIASES now skips also "alias symlinks"
    An "alias symlink" is a symlink that points to the same directory. These can
    safely be skipped when iterating through all mails in all mailboxes (unlike
    other symlinks that may point to external storages).


M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2012-09-14 20:51:02 +0300 Timo Sirainen <tss@iki.fi> (fcb5f4c)

    pop3c: Fetching message size could have returned wrong value


M	src/lib-storage/index/pop3c/pop3c-mail.c

2012-09-12 00:20:47 +0300 Timo Sirainen <tss@iki.fi> (dff32d1)

    director: Improved logging related to disconnections.


M	src/director/director-connection.c
M	src/director/director-connection.h
M	src/director/director.c
M	src/director/director.h

2012-09-12 00:04:34 +0300 Timo Sirainen <tss@iki.fi> (33e3cf3)

    director: Already seen USER-WEAK command caused director to disconnect.


M	src/director/director-connection.c

2012-09-11 20:45:38 +0300 Timo Sirainen <tss@iki.fi> (002858d)

    imapc: Fixed parsing "text" input after OK/NO/BAD/BYE.


M	src/lib-imap-client/imapc-connection.c

2012-09-11 20:44:37 +0300 Timo Sirainen <tss@iki.fi> (0bd9fac)

    lib-imap: Added IMAP_PARSE_FLAG_SERVER_TEXT that fixes parsing input from
    IMAP server.


M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-parser.h

2012-09-11 19:14:09 +0300 Dafan Zhai <dafan.zhai@securepoint.de> (55a2e57)

    lib-storage: Fixed memory leak getting MAILBOX_METADATA_VIRTUAL_SIZE
    Function virtual_size_add_new forgets to free the 'search_args' object after
    it searches the mails. ---  src/lib-storage/index/index-status.c |    1 +  1
    files changed, 1 insertions(+), 0 deletions(-)


M	src/lib-storage/index/index-status.c

2012-09-11 18:42:05 +0300 Timo Sirainen <tss@iki.fi> (2984b6b)

    Decrease minimum memory allocations. This is mainly to avoid wasting
    settings-related memory for IMAP processes. Probably something more radical
    should be done at some point.


M	src/lib-imap/imap-parser.c
M	src/lib-settings/settings-parser.c
M	src/lib-storage/mail-storage-service.c
M	src/lib/hash.c

2012-09-11 18:26:33 +0300 Timo Sirainen <tss@iki.fi> (1439ac8)

    lib-master: Decrease initial memory pool size


M	src/lib-master/master-service-settings-cache.c

2012-09-11 17:13:51 +0300 Timo Sirainen <tss@iki.fi> (ee2f574)

    acl: Don't add sameuser -> sameuser entries to ACL dict.


M	src/plugins/acl/acl-lookup-dict.c

2012-09-06 16:50:00 +0300 Timo Sirainen <tss@iki.fi> (f2a1955)

    doveadm: Added exec command to easily execute commands from libexec_dir. For
    example: doveadm exec imap -u user@domain


M	src/doveadm/Makefile.am
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/doveadm.c

2012-09-04 17:18:08 +0300 Timo Sirainen <tss@iki.fi> (12976f0)

    lib-storage: Added "disabled" setting for namespaces.


M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2012-09-02 16:06:45 +0300 Timo Sirainen <tss@iki.fi> (9a312bf)

    Various fixes to listing mailboxes. Some of these are a bit kludgy, v2.2 has
    a larger rewrite of the code to implement them more nicely.


M	src/imap/cmd-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-08-31 16:19:21 +0300 Timo Sirainen <tss@iki.fi> (e5c3a80)

    mbox: Fix to previous public namespace location detection crashfix.


M	src/lib-storage/index/mbox/mbox-storage.c

2012-08-31 16:17:23 +0300 Timo Sirainen <tss@iki.fi> (860e6dd)

    lib-storage: Don't crash when trying to detect public namespace's
    mail_location. Public namespaces have no owner.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c

2012-08-30 21:56:43 +0300 Timo Sirainen <tss@iki.fi> (4396b62)

    layout=fs mailbox listing: Fix to prefix=INBOX/ handling


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-08-30 00:43:56 +0200 Florian Zeitz <florob@babelmonkeys.de> (0a3769a)

    lib: Generalize hmac to be hash independent


M	src/auth/auth-token.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-scram-sha1.c
M	src/auth/password-scheme.c
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-ntlm/ntlm-encrypt.c
M	src/lib/Makefile.am
A	src/lib/hmac-cram-md5.c
A	src/lib/hmac-cram-md5.h
D	src/lib/hmac-md5.c
D	src/lib/hmac-md5.h
D	src/lib/hmac-sha1.c
D	src/lib/hmac-sha1.h
A	src/lib/hmac.c
A	src/lib/hmac.h

2012-10-02 22:45:34 +0300 Timo Sirainen <tss@iki.fi> (54fa2c9)

    lib-imap: Minor fix to imap_url_parse()


M	src/lib-imap/imap-url.c

2012-09-28 15:11:54 +0300 Timo Sirainen <tss@iki.fi> (cf637d2)

    Compiler warning fix for previous change


M	src/lib-storage/index/dbox-common/dbox-storage.c

2012-09-28 15:07:11 +0300 Timo Sirainen <tss@iki.fi> (afc8d11)

    Avoid using PATH_MAX.


M	src/lib-master/master-instance.c
M	src/lib-storage/index/dbox-common/dbox-storage.c

2012-09-28 02:19:07 +0300 Timo Sirainen <tss@iki.fi> (8820df7)

    maildir: Directories were created without execute-permissions Broken by
    recent changes.


M	src/lib-storage/index/maildir/maildir-storage.c

2012-09-28 00:11:19 +0300 Timo Sirainen <tss@iki.fi> (e0aff4c)

    lib-storage: Added initial implementation for layout=index. The idea is that
    all of the mailbox names only exist in the mailbox list index. Storage
    directories use mailbox GUIDs. This avoids all kinds of race conditions with
    mailbox renames. mailbox_list_index=yes is required for this layout to work.

    There are probably still some race conditions within the indexing code 
    itself. Also error recovery is missing.

M	configure.in
M	src/lib-storage/list/Makefile.am
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-delete.h
M	src/lib-storage/list/mailbox-list-fs.c
A	src/lib-storage/list/mailbox-list-index-backend.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
A	src/lib-storage/list/mailbox-list-index-storage.h
M	src/lib-storage/list/mailbox-list-index-sync.c
A	src/lib-storage/list/mailbox-list-index-sync.h
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/list/mailbox-list-maildir.c

2012-09-28 00:03:12 +0300 Timo Sirainen <tss@iki.fi> (8e85339)

    lib-storage: Do mailbox autocreation elsewhere also besides just
    mailbox_open()


M	src/lib-storage/mail-storage.c

2012-09-28 00:00:16 +0300 Timo Sirainen <tss@iki.fi> (68664df)

    lib-storage: If trying to rename mailbox over itself, fail early.


M	src/lib-storage/mail-storage.c

2012-09-27 23:58:54 +0300 Timo Sirainen <tss@iki.fi> (bb6301e)

    doveadm dump -t index: Added support for mailbox list index records.


M	src/doveadm/doveadm-dump-index.c

2012-09-26 20:50:08 +0300 Timo Sirainen <tss@iki.fi> (9fc97c8)

    lib-storage: mailbox_get_path() and friends can now return an error. An
    upcoming "index" mailbox_list backend uses mailbox GUIDs as the directory
    names. Doing a name => GUID lookup may fail, so the path lookup may fail.

    This is a somewhat annoying change and perhaps it can be removed in future, 
    but for now it looks like it can't be avoided.

M	src/doveadm/dsync/doveadm-dsync.c
M	src/indexer/master-connection.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/mailbox-alias/mailbox-alias-plugin.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota.c

2012-09-26 18:01:01 +0300 Timo Sirainen <tss@iki.fi> (fca7aa8)

    Merged changes from v2.1 tree.


2012-09-26 17:17:08 +0300 Timo Sirainen <tss@iki.fi> (25ad65a)

    lib-storage: Cleanup, use the new mailbox_*() instead of mailbox_list_*()
    when possible.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage.c

2012-09-26 17:11:22 +0300 Timo Sirainen <tss@iki.fi> (94f84d1)

    lib-storage: Cleanups to mailbox mkdir() related functions.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/fts-lucene/fts-backend-lucene.c

2012-09-26 02:31:33 +0300 Timo Sirainen <tss@iki.fi> (67131ca)

    lib-storage: Make sure permissions are refreshed after creating mailbox
    directory.


M	src/lib-storage/index/index-storage.c

2012-09-26 01:47:21 +0300 Timo Sirainen <tss@iki.fi> (3d5d5a2)

    lib-storage: Fixed creating selectable mailbox when it was already \Noselect


M	src/lib-storage/index/index-storage.c

2012-09-26 01:38:59 +0300 Timo Sirainen <tss@iki.fi> (76b91ba)

    lib-storage: mailbox_list_get_root_permissions() now returns struct
    mailbox_permissions.


M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-map-private.h
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/lib-storage/mailbox-uidvalidity.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/quota/quota-maildir.c

2012-09-26 00:56:08 +0300 Timo Sirainen <tss@iki.fi> (6c75379)

    lib-storage: Invalid subscription entries weren't removed always with
    subscriptions=no namespaces.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2012-09-26 00:38:45 +0300 Timo Sirainen <tss@iki.fi> (569a849)

    lib-storage: Allow mailbox name to begin with separator if
    mail_full_filesystem_access=yes


M	src/lib-storage/mail-storage.c

2012-09-26 00:35:10 +0300 Timo Sirainen <tss@iki.fi> (3d6fdaf)

    lib-storage: Removed mailbox_list.create_mailbox_dir() virtual function. It
    really didn't need to be virtual. Some storages didn't care about it, others
    wanted it to work basically the same.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/plugins/acl/acl-mailbox-list.c

2012-09-26 00:25:21 +0300 Timo Sirainen <tss@iki.fi> (da1c31e)

    maildir: Minor fixes and code cleanup to mailbox creation.


M	src/lib-storage/index/maildir/maildir-storage.c

2012-09-26 00:23:02 +0300 Timo Sirainen <tss@iki.fi> (48ce034)

    lib-storage: Improved mailbox_list_mkdir() error handling.


M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2012-09-25 23:38:14 +0300 Timo Sirainen <tss@iki.fi> (e2f29d0)

    lib-storage: Create "maildirfolder" file only with maildir storage.
    Previously it was created for all storages, as long as they used
    LAYOUT=maildir++. The file is mainly meant for MDAs that want to update
    maildirsize quota, but that's only available for Maildir storage.


M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/list/mailbox-list-maildir.c

2012-09-25 23:23:53 +0300 Timo Sirainen <tss@iki.fi> (a71cf79)

    lib-storage: Removed unused MAILBOX_DIR_CREATE_TYPE_ONLY_NOSELECT


M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mailbox-list-private.h

2012-09-25 22:53:36 +0300 Timo Sirainen <tss@iki.fi> (e9df0f2)

    Various cleanups to checking if mailbox name is valid.


M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-backend-vfile.c

2012-09-25 22:51:46 +0300 Timo Sirainen <tss@iki.fi> (753f22d)

    lib-storage: Fixed shared namespace autocreation after previous mailbox list
    changes. mailbox_list_is_valid_existing_name() no longer goes all the way
    through to shared-list backend, but mailbox_list_join_refpattern() does.


M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-subscriptions.c

2012-09-25 22:40:55 +0300 Timo Sirainen <tss@iki.fi> (c9160ac)

    lib-fs: Fix to previous change


M	src/lib-fs/fs-api.c

2012-09-25 21:45:00 +0300 Timo Sirainen <tss@iki.fi> (442b4c6)

    lib-storage: Removed mailbox list backend-specific mailbox name/pattern
    validation. The virtual name validity is independent of the backend. The
    physical name is always used for paths in filesystem, so it can also be
    verified with common code. Backend's mailbox_dir and storage's internal
    directories can also be checked. There's nothing else left really.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-fs.h
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-maildir.h
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2012-09-25 21:31:41 +0300 Timo Sirainen <tss@iki.fi> (1f14933)

    lib-storage: Removed unused mailbox_list_create_dir()


M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2012-09-25 21:27:30 +0300 Timo Sirainen <tss@iki.fi> (d508ab8)

    lib-storage: If list escape_char is set, allow ".", ".." and "dbox-Mails"
    mailbox names.


M	src/lib-storage/mailbox-list.c

2012-09-25 20:51:07 +0300 Timo Sirainen <tss@iki.fi> (dd98481)

    lib-storage: Added asserts to make sure mailbox_open() is called early
    enough.


M	src/lib-storage/mail-storage.c

2012-09-25 20:15:58 +0300 Timo Sirainen <tss@iki.fi> (feaa6a3)

    lib-storage: Added mailbox_get_path_to() wrapper for
    mailbox_list_get_path(). Changed the code to use as much of
    mailbox_get_path_to() and mailbox_get_path() as possible.


M	src/indexer/Makefile.am
M	src/indexer/master-connection.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/index-rebuild.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/quota/quota-fs.c

2012-09-25 17:44:37 +0300 Timo Sirainen <tss@iki.fi> (4630728)

    lib-fs: Minor code cleanup


M	src/lib-fs/fs-api.c

2012-09-25 17:42:44 +0300 Timo Sirainen <tss@iki.fi> (268b721)

    lib-storage: Added mail_storage_copy_error()


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2012-09-25 17:41:58 +0300 Timo Sirainen <tss@iki.fi> (5921647)

    lib-index: Transaction log creation crashed if required extension name
    length wasn't divisible by 4.


M	src/lib-index/mail-transaction-log-file.c

2012-09-25 17:37:55 +0300 Timo Sirainen <tss@iki.fi> (27635b9)

    lib-storage: Moved dbox-sync-rebuild API to more generic index-rebuild.


M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/dbox-common/Makefile.am
D	src/lib-storage/index/dbox-common/dbox-sync-rebuild.h
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
R078	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c	src/lib-storage/index/index-rebuild.c
A	src/lib-storage/index/index-rebuild.h

2012-09-25 17:31:15 +0300 Timo Sirainen <tss@iki.fi> (755abfa)

    dbox: Renamed dbox_sync_rebuild_verify_alt_storage() to
    dbox_verify_alt_storage()


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.h
M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.h
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c

2012-09-24 16:33:07 +0300 Timo Sirainen <tss@iki.fi> (cf1b789)

    doveadm: Install doveadm-settings.h header


M	src/doveadm/Makefile.am

2012-09-22 19:23:15 +0300 Timo Sirainen <tss@iki.fi> (bd5ef33)

    lib-lda: After auto-creating mailbox only open it, don't bother syncing it.


M	src/lib-lda/mail-deliver.c

2012-09-22 19:21:58 +0300 Timo Sirainen <tss@iki.fi> (498c6be)

    imapc: Fixed crash when saving/copying messages.


M	src/lib-storage/index/imapc/imapc-save.c

2012-09-20 01:01:20 +0300 Timo Sirainen <tss@iki.fi> (3b3a709)

    config: Fixes to previous module change.


M	src/config/config-connection.c
M	src/config/config-request.c
M	src/config/doveconf.c

2012-09-19 18:07:46 +0300 Timo Sirainen <tss@iki.fi> (3c932c0)

    lib-storage: Verify that the shared library's version matches the binary's
    version.


M	src/lib-storage/mail-storage-service.c

2012-09-19 17:49:28 +0300 Timo Sirainen <tss@iki.fi> (8391619)

    imap: Fixed crashing in QRESYNC SELECT.


M	src/imap/cmd-fetch.c
M	src/imap/cmd-select.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h
M	src/imap/imap-search-args.c
M	src/imap/imap-search-args.h

2012-09-19 15:34:00 +0300 Timo Sirainen <tss@iki.fi> (32b78da)

    Read SSL settings only if service has SSL sockets or
    MASTER_SERVICE_FLAG_USE_SSL_SETTINGS.


M	src/auth/auth-settings.c
M	src/lib-master/master-service-private.h
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
M	src/lib-master/master-service-ssl-settings.c
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/lib-storage/mail-storage-service.c
M	src/lmtp/lmtp-settings.c
M	src/login-common/login-settings.c
M	src/login-common/main.c

2012-09-19 15:33:10 +0300 Timo Sirainen <tss@iki.fi> (633a3da)

    config: Support looking up config for multiple modules at the same time.


M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-filter.h
M	src/config/config-parser-private.h
M	src/config/config-parser.c
M	src/config/config-parser.h
M	src/config/config-request.c
M	src/config/config-request.h
M	src/config/doveconf.c
M	src/config/main.c

2012-09-18 05:12:28 +0300 Timo Sirainen <tss@iki.fi> (533bf07)

    lib-fs: Fix to previous API change


M	src/lib-fs/fs-api.c

2012-09-17 18:13:32 +0300 Timo Sirainen <tss@iki.fi> (d4c3d55)

    lib-fs: fs_init() API changed to allow returning an error.


M	src/lib-fs/fs-api-private.h
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-api.h
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-storage/index/dbox-common/dbox-storage.c

2012-09-17 17:51:03 +0300 Timo Sirainen <tss@iki.fi> (20d7236)

    sdbox: Removed unnecessary code line.


M	src/lib-storage/index/dbox-single/sdbox-storage.h

2012-09-16 16:48:48 +0300 Timo Sirainen <tss@iki.fi> (1c522e0)

    Makefile: Fixed building fts-squat


M	src/plugins/fts-squat/Makefile.am

2012-09-16 16:42:25 +0300 Timo Sirainen <tss@iki.fi> (7912306)

    Makefile: Again changes to handling test program dependencies. .la libraries
    need to link .lo files, .a libraries need to link .o files. Changed dsync to
    be .la library for consistency.


M	src/doveadm/Makefile.am
M	src/doveadm/dsync/Makefile.am
M	src/lib-dict/Makefile.am
M	src/lib-imap/Makefile.am
M	src/lib-index/Makefile.am
M	src/lib-mail/Makefile.am
M	src/lib-storage/Makefile.am
M	src/plugins/fts/Makefile.am

2012-09-16 16:31:32 +0300 Timo Sirainen <tss@iki.fi> (a8fe899)

    Removed all the "enum foo;" declarations. They didn't seem to be very
    standard. Old gcc versions warn about them and C++ code doesn't like them.


M	src/auth/passdb-cache.h
M	src/config/config-request.h
M	src/config/old-set-parser.h
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.h
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/doveadm-mailbox-list-iter.h
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/imap/cmd-list.c
M	src/imap/cmd-notify.c
M	src/imap/imap-notify.c
M	src/lib-imap/imap-util.h
M	src/lib-index/mail-index-modseq.h
M	src/lib-lda/mail-deliver.h
M	src/lib-storage/Makefile.am
M	src/lib-storage/index/imapc/imapc-sync.h
M	src/lib-storage/index/maildir/maildir-sync.h
M	src/lib-storage/list/mailbox-list-delete.h
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/list/mailbox-list-subscriptions.h
A	src/lib-storage/mailbox-list-iter.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.h
M	src/plugins/notify/notify-plugin.h
M	src/plugins/quota/quota-count.c
M	src/plugins/virtual/virtual-config.c

2012-09-16 16:12:03 +0300 Timo Sirainen <tss@iki.fi> (f561fba)

    Compiler warning fixes for 32bit systems.


M	src/director/user-directory.c
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib/json-parser.c

2012-09-16 16:08:18 +0300 Timo Sirainen <tss@iki.fi> (f0cd1d0)

    Fixed compiling with OSes where NULL isn't defined as void pointer (e.g.
    Solaris).


M	src/anvil/main.c
M	src/auth/auth-request-handler.c
M	src/auth/userdb-passwd.c
M	src/director/director-test.c
M	src/imap/imap-fetch-body.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-storage/index/index-search.c
M	src/lib/lib-signals.c
M	src/replication/replicator/replicator.c

2012-09-16 16:02:22 +0300 Stephan Bosch <stephan@rename-it.nl> (4fa772e)

    imap-urlauth: Fixed crashes when destroying client


M	src/imap-urlauth/imap-urlauth-worker.c

2012-09-16 16:02:18 +0300 Stephan Bosch <stephan@rename-it.nl> (ecc3dad)

    imap-urlauth: Treat internal errors in URL fetching differently from invalid
    URLs.


M	src/imap-urlauth/imap-urlauth-worker.c
M	src/lib-imap-urlauth/imap-urlauth-fetch.c

2012-09-16 16:02:15 +0300 Stephan Bosch <stephan@rename-it.nl> (6541da9)

    imap-urlauth: Fixes to handling anonymous user


M	src/imap-urlauth/imap-urlauth-worker.c
M	src/imap/imap-client.c
M	src/lib-imap-urlauth/imap-urlauth-private.h
M	src/lib-imap-urlauth/imap-urlauth.c
M	src/lib-imap-urlauth/imap-urlauth.h

2012-09-16 16:02:11 +0300 Stephan Bosch <stephan@rename-it.nl> (dc599de)

    lib-dict: Previous API change broke dict_init()


M	src/lib-dict/dict-file.c

2012-09-16 15:40:10 +0300 Timo Sirainen <tss@iki.fi> (41e6163)

    Makefile: Fixed test program dependencies Explicit dependencies on .o or .lo
    files didn't seem to work properly and with high enough make -j value the
    build failed. Depending on the entire library guarantees that all the
    individual .o files have been built.


M	src/anvil/Makefile.am
M	src/auth/Makefile.am
M	src/director/Makefile.am
M	src/doveadm/dsync/Makefile.am
M	src/lib-dict/Makefile.am
M	src/lib-imap/Makefile.am
M	src/lib-index/Makefile.am
M	src/lib-mail/Makefile.am
M	src/lib-storage/Makefile.am
M	src/plugins/fts-squat/Makefile.am
M	src/plugins/fts/Makefile.am

2012-09-16 04:16:07 +0300 Timo Sirainen <tss@iki.fi> (8204c6a)

    Makefile: Link libdovecot-ssl with libdovecot. This fixes linking with e.g.
    OSX.


M	src/lib-dovecot/Makefile.am

2012-09-16 04:05:13 +0300 Timo Sirainen <tss@iki.fi> (5ee7c64)

    Makefile: Fixed dependencies for imap-urlauth


M	src/imap-urlauth/Makefile.am

2012-09-16 01:08:11 +0300 Timo Sirainen <tss@iki.fi> (22186f0)

    Makefile: Fixed imap-urlauth library dependencies


M	src/imap-urlauth/Makefile.am

2012-09-16 01:06:04 +0300 Timo Sirainen <tss@iki.fi> (c6addce)

    lib-imap-storage: imap_msgpart_size() should return size as uoff_t, not
    size_t


M	src/imap/imap-fetch-body.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h

2012-09-16 01:02:10 +0300 Timo Sirainen <tss@iki.fi> (53ba38f)

    imap: Assert-crashfix for URLFETCH command.


M	src/imap/imap-client.c

2012-09-16 00:56:51 +0300 Timo Sirainen <tss@iki.fi> (d03a871)

    Renamed str_tabescape_write() to str_append_tabescaped()


M	src/anvil/connect-limit.c
M	src/anvil/penalty.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-stream.c
M	src/auth/checkpassword-reply.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/dsync/dsync-ibc-stream.c
M	src/doveadm/dsync/dsync-serializer.c
M	src/imap-urlauth/imap-urlauth-client.c
M	src/indexer/worker-connection.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-master.c
M	src/lib-imap-urlauth/imap-urlauth-connection.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-login.c
M	src/lib/strescape.c
M	src/lib/strescape.h
M	src/log/doveadm-connection.c
M	src/master/service-process.c
M	src/plugins/replication/replication-plugin.c
M	src/plugins/stats/stats-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/replicator-queue.c
M	src/stats/client-export.c
M	src/util/script-login.c

2012-09-16 00:52:39 +0300 Timo Sirainen <tss@iki.fi> (1039955)

    dict_init() API changed to return int.


M	src/auth/db-dict.c
M	src/dict/dict-connection.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h
M	src/lib-imap-urlauth/imap-urlauth-backend.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/quota/quota-dict.c

2012-09-15 23:57:08 +0300 Stephan Bosch <stephan@rename-it.nl> (f9511e6)

    Added support for IMAP URLAUTH and URLAUTH=BINARY extensions

    Extends imap service with URLAUTH and URLAUTH=BINARY support:
     - Adds new commands URLFETCH, GENURLAUTH and RESETKEY.

    Creates imap-urlauth service in src/imap-urlauth.

    Functionality common to both the imap and imap-urlauth services is located 
    in src/lib-imap-urlauth.

    TODO:
    - use mailbox GUIDs instead of names
    - doveadm command to delete stale urlauth entries?
    - add delay when attempting to access nonexistent user
    - create urlauth-worker queue, similar to how indexer-worker works
      (could we share code?..)

M	.hgignore
M	README
M	configure.in
M	src/Makefile.am
A	src/imap-urlauth/Makefile.am
A	src/imap-urlauth/imap-urlauth-client.c
A	src/imap-urlauth/imap-urlauth-client.h
A	src/imap-urlauth/imap-urlauth-common.h
A	src/imap-urlauth/imap-urlauth-login-settings.c
A	src/imap-urlauth/imap-urlauth-login-settings.h
A	src/imap-urlauth/imap-urlauth-login.c
A	src/imap-urlauth/imap-urlauth-settings.c
A	src/imap-urlauth/imap-urlauth-settings.h
A	src/imap-urlauth/imap-urlauth-worker-settings.c
A	src/imap-urlauth/imap-urlauth-worker-settings.h
A	src/imap-urlauth/imap-urlauth-worker.c
A	src/imap-urlauth/imap-urlauth.c
M	src/imap/Makefile.am
A	src/imap/cmd-genurlauth.c
A	src/imap/cmd-resetkey.c
A	src/imap/cmd-urlfetch.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c
M	src/imap/imap-commands.h
M	src/imap/imap-settings.c
M	src/imap/imap-settings.h
M	src/imap/main.c
A	src/lib-imap-urlauth/Makefile.am
A	src/lib-imap-urlauth/imap-urlauth-backend.c
A	src/lib-imap-urlauth/imap-urlauth-backend.h
A	src/lib-imap-urlauth/imap-urlauth-connection.c
A	src/lib-imap-urlauth/imap-urlauth-connection.h
A	src/lib-imap-urlauth/imap-urlauth-fetch.c
A	src/lib-imap-urlauth/imap-urlauth-fetch.h
A	src/lib-imap-urlauth/imap-urlauth-private.h
A	src/lib-imap-urlauth/imap-urlauth.c
A	src/lib-imap-urlauth/imap-urlauth.h

2012-09-15 21:00:54 +0300 Timo Sirainen <tss@iki.fi> (109de6b)

    lib-imap-storage: imap_msgpart_bodypartstructure() returned freed data.


M	src/lib-imap-storage/imap-msgpart.c

2012-09-15 19:56:47 +0300 Timo Sirainen <tss@iki.fi> (7c33226)

    lib-index: Removed MAIL_INDEX_SYNC_TYPE_APPEND. No backend cares about it.


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index.h
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-sync-changes.c
M	src/plugins/virtual/virtual-sync.c

2012-09-15 19:54:21 +0300 Timo Sirainen <tss@iki.fi> (724b7fc)

    lib-index: Changed mail_index_set_fsync_mode() to use a separate enum for
    the mask.


M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-index.h
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.c

2012-09-15 19:12:04 +0300 Timo Sirainen <tss@iki.fi> (0c6b584)

    lib-imap: Fixed Content-Language parsing from BODYSTRUCTURE


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/test-imap-bodystructure.c

2012-09-15 19:08:55 +0300 Timo Sirainen <tss@iki.fi> (ebe49ef)

    imap-bodystructure.h comment fix


M	src/lib-imap/imap-bodystructure.h

2012-09-15 19:08:11 +0300 Timo Sirainen <tss@iki.fi> (a32e425)

    imap-bodystructure.h comment update


M	src/lib-imap/imap-bodystructure.h

2012-09-15 19:06:37 +0300 Timo Sirainen <tss@iki.fi> (7717e3c)

    lib-imap: Updated test-imap-bodystructure


M	src/lib-imap/test-imap-bodystructure.c

2012-09-15 19:00:32 +0300 Timo Sirainen <tss@iki.fi> (d651847)

    lib-imap-storage: Added support for getting BODYPARTSTRUCTURE Based on patch
    by Stephan Bosch.


M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart-url.h
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h

2012-09-15 18:58:48 +0300 Timo Sirainen <tss@iki.fi> (4056152)

    lib-imap: Added support for parsing IMAP BODYSTRUCTURE and writing out a
    modified version.


M	src/lib-imap/Makefile.am
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
A	src/lib-imap/test-imap-bodystructure.c

2012-09-15 16:13:02 +0300 Timo Sirainen <tss@iki.fi> (0000bf8)

    imap_body_parse_from_bodystructure() now returns the error instead of
    logging it.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-bodystructure.h
M	src/lib-storage/index/index-mail.c

2012-09-15 15:46:01 +0300 Timo Sirainen <tss@iki.fi> (5f44975)

    lib-storage: Moved index_mail.data_pool to mail_private.data_pool


M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/plugins/virtual/virtual-mail.c

2012-09-15 03:49:23 +0300 Timo Sirainen <tss@iki.fi> (88b9f9e)

    fts-lucene: Added "normalize" option to put data through normalize().


M	src/plugins/fts-lucene/Snowball.cc
M	src/plugins/fts-lucene/SnowballAnalyzer.h
M	src/plugins/fts-lucene/SnowballFilter.h
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc

2012-09-15 03:12:20 +0300 Timo Sirainen <tss@iki.fi> (d9076f5)

    Replaced "decomposed titlecase" conversions with more generic normalizer
    function. Plugins can now change mail_user.default_normalizer. Specific
    searches can also use different normalizers by changing
    mail_search_context.normalizer.


M	src/doveadm/doveadm-mail-fetch.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-charset/charset-utf8.h
M	src/lib-imap/imap-base-subject.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-decoder.h
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-decode.h
M	src/lib-mail/message-search.c
M	src/lib-mail/message-search.h
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/lib/unichar.h
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c

2012-09-15 03:09:57 +0300 Timo Sirainen <tss@iki.fi> (3412b62)

    uni_utf8_to_decomposed_titlecase(): Require input length to be exact now.
    Most of the callers did that already anyway


M	src/lib-storage/index/index-sort.c
M	src/lib/unichar.c
M	src/lib/unichar.h

2012-09-14 23:11:27 +0300 Timo Sirainen <tss@iki.fi> (46ec598)

    Use "tokenlogin" socket name (instead of "token-login") after all. Auth code
    has special checks for '-', which breaks "token-login" and fixing it is
    rather annoying.


M	src/auth/auth-settings.c
M	src/login-common/login-common.h

2012-09-14 22:10:49 +0300 Timo Sirainen <tss@iki.fi> (5b89f4d)

    auth: Auth workers don't need to read token secret.


M	src/auth/main.c

2012-09-14 21:48:45 +0300 Stephan Bosch <stephan@rename-it.nl> (ab90f70)

    Added support to perform token-based service process authentication.

    Creates hidden SASL method DOVECOT-TOKEN. This method is not available on 
    the normal auth login socket and thus never presented to clients.

    Creates new auth socket type 'tokenlogin'. This otherwise normal login 
    socket only offers authentication using the DOVECOT-TOKEN mechanism.

    Creates new token-login directory in base_dir to separate token logins from 
    normal logins. This directory is otherwise completely identical to the 
    normal login dir, i.e. it contains sockets for the service backends, used to
    chroot login processes to, etc.

    Makes default login socket configurable.

    Performs some minor changes to src/login-common to build very sparse 
    protocols, e.g. avoid the need to implement methods that are not needed.

M	src/auth/Makefile.am
M	src/auth/auth-client-connection.c
M	src/auth/auth-client-connection.h
M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request-handler.h
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-settings.c
A	src/auth/auth-token.c
A	src/auth/auth-token.h
M	src/auth/main.c
A	src/auth/mech-dovecot-token.c
M	src/auth/mech.h
M	src/imap/main.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login-auth.h
M	src/lib-master/master-login.c
M	src/lib-master/master-login.h
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.h
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-common.h
M	src/login-common/main.c
M	src/master/master-settings.c

2012-09-14 21:31:45 +0300 Timo Sirainen <tss@iki.fi> (8d9c486)

    hmac_sha1_init(): Use void pointer for the key.


M	src/lib/hmac-sha1.c
M	src/lib/hmac-sha1.h

2012-09-14 21:11:42 +0300 Stephan Bosch <stephan@rename-it.nl> (a22f62e)

    lib-imap-storage: Changed imap_msgpart_url API.

    Adds enum mail_error return value to imap_msgpart_url_open_mailbox().

    Now parses msgpart at the beginning and adds function to access underlying 
    imap_msgpart object directly.

M	src/imap/cmd-append.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart-url.h

2012-09-14 21:04:01 +0300 Stephan Bosch <stephan@rename-it.nl> (cc77966)

    Fixes IMAP LOGIN REFERRAL to properly encode IMAP URL.


M	src/imap-login/client-authenticate.c

2012-09-14 21:02:23 +0300 Stephan Bosch <stephan@rename-it.nl> (4d955db)

    Added support for creating IMAP URLs.


M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-url.h
M	src/lib-imap/test-imap-url.c
M	src/lib/uri-util.c
M	src/lib/uri-util.h

2012-09-13 17:12:59 +0300 Timo Sirainen <tss@iki.fi> (1a18848)

    lib-storage: Message size/sent date could have been set as 0 in some cases.
    It doesn't look like it ever happened with the current storage backends or
    use cases.


M	src/lib-storage/index/index-mail.c

2012-09-13 12:01:08 +0300 Timo Sirainen <tss@iki.fi> (cf17972)

    lib-storage: Allow #including mailbox-list-private.h from C++ code


M	src/lib-storage/mailbox-list-private.h

2012-09-13 11:05:10 +0300 Timo Sirainen <tss@iki.fi> (f2ce195)

    dovecot-config: Added lib-storage/list to be in LIBDOVECOT_STORAGE_INCLUDE


M	dovecot-config.in.in

2012-09-13 10:53:38 +0300 Timo Sirainen <tss@iki.fi> (f318b3d)

    lib-storage API change to allow using it from C++ code


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/notify/notify-storage.c

2012-09-13 10:52:52 +0300 Timo Sirainen <tss@iki.fi> (7a2d487)

    lib-storage: Moved mail_storage_settings_to_index_flags to
    mail-storage-private.h This is mainly to allow #including
    mail-storage-settings.h from C++ code without having to #include
    mail-index.h from mail-storage-settings.h


M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail-storage.c

2012-09-11 18:56:07 +0300 Timo Sirainen <tss@iki.fi> (c8555d0)

    i_get(pw|gr)(nam|uid): Use small initial buffer sizes. For processes that
    need to do only a single lookup there's no point in wasting a lot of memory
    for the maximum buffer size.


M	src/lib/ipwd.c

2012-09-10 17:19:43 +0300 Timo Sirainen <tss@iki.fi> (71e88fa)

    lib-storage: Removed rename_children parameter from mailbox_rename() The
    children are now always renamed. The only reason this feature was added in
    the first place was to make dsync's job easier, but this is no longer
    needed.


M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
M	src/imap/cmd-rename.c
M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-list-private.h
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/notify/notify-plugin-private.h
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-plugin.h
M	src/plugins/notify/notify-storage.c
M	src/plugins/replication/replication-plugin.c

2012-09-07 16:43:44 +0300 Timo Sirainen <tss@iki.fi> (a85473f)

    dsync: Renamed "slave" to "ibc" (= inter-brain communicator)


M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
A	src/doveadm/dsync/dsync-ibc-pipe.c
A	src/doveadm/dsync/dsync-ibc-private.h
R057	src/doveadm/dsync/dsync-slave-stream.c	src/doveadm/dsync/dsync-ibc-stream.c
A	src/doveadm/dsync/dsync-ibc.c
A	src/doveadm/dsync/dsync-ibc.h
D	src/doveadm/dsync/dsync-slave-pipe.c
D	src/doveadm/dsync/dsync-slave-private.h
D	src/doveadm/dsync/dsync-slave.c
D	src/doveadm/dsync/dsync-slave.h

2012-09-07 16:19:35 +0300 Timo Sirainen <tss@iki.fi> (81b97c0)

    dsync: Renamed "io" slave to "stream".


M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/doveadm-dsync.c
R082	src/doveadm/dsync/dsync-slave-io.c	src/doveadm/dsync/dsync-slave-stream.c
M	src/doveadm/dsync/dsync-slave.h

2012-09-06 01:25:23 +0300 Timo Sirainen <tss@iki.fi> (39ee82d)

    dsync: Rewritten syncing for mailbox renames. A few things didn't go as I
    originally intended in the algorithm, but it appears to give consistent
    results now. :) But the algorithm should probably be looked at more closely
    at some point.


M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-private.h
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-mailbox-tree.h
M	src/doveadm/dsync/dsync-slave-io.c
A	src/doveadm/dsync/test-dsync-mailbox-tree-sync.c

2012-09-06 01:13:03 +0300 Timo Sirainen <tss@iki.fi> (3281669)

    Renamed buffer_create_*data() to buffer_create_from_*data() for consistency.
    Especially i_stream_create_from_data() was a very similar function, which
    made it difficult to remember which one should have "from" and which one
    shouldn't.


M	src/auth/auth-master-connection.c
M	src/auth/mech-digest-md5.c
M	src/imap/main.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-qp-decoder.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-otp/otp-parse.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/mail.c
M	src/lib/askpass.c
M	src/lib/buffer.c
M	src/lib/buffer.h
M	src/lib/guid.c
M	src/lib/iostream-rawlog.c
M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
M	src/lib/str.c
M	src/login-common/sasl-server.c
M	src/plugins/fts-lucene/Snowball.cc
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts/fts-expunge-log.c
M	src/pop3-login/client.c
M	src/pop3/main.c

2012-09-06 01:04:57 +0300 Timo Sirainen <tss@iki.fi> (49d9165)

    buffer_create_data(): Clear the memory area immediately.


M	src/lib/buffer.c

2012-09-06 01:04:28 +0300 Timo Sirainen <tss@iki.fi> (743c3ba)

    str_*printfa(): Avoid (harder!) growing underlying buffer if possible. The
    previous change for this didn't work properly.


M	src/lib/str.c

2012-09-04 19:58:59 +0300 Timo Sirainen <tss@iki.fi> (33e9f5b)

    doveadm dump -t mailboxlog: Added support for MAILBOX_LOG_RECORD_CREATE_DIR


M	src/doveadm/doveadm-dump-mailboxlog.c

2012-09-04 19:05:44 +0300 Timo Sirainen <tss@iki.fi> (9a6409b)

    TODO updated


M	TODO

2012-09-04 19:05:18 +0300 Timo Sirainen <tss@iki.fi> (98bd9a8)

    NOTIFY: Fixed "subscribed" mailbox filter to actually work.


M	src/imap/cmd-notify.c
M	src/imap/imap-notify.c

2012-09-04 19:04:52 +0300 Timo Sirainen <tss@iki.fi> (eef3caf)

    lib-storage: Added mailbox_is_subscribed()


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2012-09-04 18:51:43 +0300 Timo Sirainen <tss@iki.fi> (24acd68)

    NOTIFY: Implemented SubscriptionChange


M	src/imap/imap-notify.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/mailbox-list-notify.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-tree.h

2012-09-04 17:26:37 +0300 Timo Sirainen <tss@iki.fi> (ec1b0f9)

    lib-storage: Log mailbox directory creations to mailbox log.


M	src/lib-index/mailbox-log.h
M	src/lib-storage/mailbox-list.c

2012-09-04 17:18:08 +0300 Timo Sirainen <tss@iki.fi> (57b819d)

    lib-storage: Added "disabled" setting for namespaces.


M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2012-09-04 17:13:47 +0300 Timo Sirainen <tss@iki.fi> (7ffa9e9)

    lmtp proxying: Don't auto-set mail_max_lock_timeout higher than it was.


M	src/lmtp/commands.c

2012-09-04 17:12:21 +0300 Timo Sirainen <tss@iki.fi> (544a946)

    lib-storage: Added mail_storage_service_user_get_mail_set()


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2012-09-04 16:37:55 +0300 Timo Sirainen <tss@iki.fi> (f68a856)

    mailbox_list_index=yes: Fixed listing nonexistent subscribed mailboxes


M	src/lib-storage/list/mailbox-list-index-iter.c

2012-09-04 16:23:12 +0300 Timo Sirainen <tss@iki.fi> (edb39c4)

    Minor code cleanup


M	src/lib-mail/istream-attachment-extractor.c

2012-09-04 16:22:14 +0300 Timo Sirainen <tss@iki.fi> (abed243)

    imap: Fixed LIST (SPECIAL-USE RECURSIVEMATCH) to actually return CHILDINFOs.


M	src/lib-storage/list/mailbox-list-iter.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h
M	src/lib-storage/mailbox-list.h

2012-09-04 16:06:29 +0300 Timo Sirainen <tss@iki.fi> (d059131)

    LIST: Fixes to handling subscriptions


M	src/imap/cmd-list.c
M	src/lib-storage/list/mailbox-list-iter.c

2012-09-04 16:05:26 +0300 Timo Sirainen <tss@iki.fi> (70eaa48)

    lib-storage: Moved mailbox-list-iter.c to list/


M	src/lib-storage/Makefile.am
M	src/lib-storage/list/Makefile.am
R100	src/lib-storage/mailbox-list-iter.c	src/lib-storage/list/mailbox-list-iter.c

2012-09-04 15:03:17 +0300 Timo Sirainen <tss@iki.fi> (f7eeb7b)

    mailbox_list_index: Assert-crashfix when seeing a new mailbox with children.


M	src/lib-storage/list/mailbox-list-index-sync.c

2012-09-04 14:56:13 +0300 Timo Sirainen <tss@iki.fi> (74b0ef7)

    quota: Removed quota_ignore_save_errors setting and made it enabled always.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2012-09-03 13:20:32 +0300 Timo Sirainen <tss@iki.fi> (e5d8091)

    lib-imap-client: Added support for NAMESPACE capability Required by previous
    imapc commit


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h

2012-09-02 19:52:31 +0300 Timo Sirainen <tss@iki.fi> (d6c0673)

    lib-storage: Added MAILBOX_METADATA_BACKEND_NAMESPACE


M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/index-status.c
M	src/lib-storage/mail-storage.h

2012-09-02 19:32:55 +0300 Timo Sirainen <tss@iki.fi> (3a85bb8)

    Comment update.


M	src/lib-storage/mail-storage.h

2012-09-02 19:22:13 +0300 Timo Sirainen <tss@iki.fi> (3e0bae4)

    Renamed enum namespace_type to enum mail_namespace_type


M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/imap/cmd-list.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-notify.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/virtual/virtual-config.c

2012-09-02 18:16:06 +0300 Timo Sirainen <tss@iki.fi> (caa2f73)

    imap: MOVE didn't send EXPUNGE when delay-newmail workaround was enabled.


M	src/imap/cmd-copy.c

2012-09-02 17:18:41 +0300 Timo Sirainen <tss@iki.fi> (d2930bd)

    imap-msgpart-url: Attempt to reuse selected mailbox instead of reallocating
    a new one. Besides giving slightly better performace, this also fixes
    CATENATE for mbox when source and destination mailboxes are the same.


M	src/lib-imap-storage/imap-msgpart-url.c

2012-09-02 17:15:09 +0300 Timo Sirainen <tss@iki.fi> (a81f332)

    Moved mailbox_equals() to lib-storage.


M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2012-09-02 16:48:25 +0300 Timo Sirainen <tss@iki.fi> (86c6b25)

    mbox: Added support for copy/move/catenate within same mailbox.


M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-lock.h
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-storage.h

2012-08-31 15:25:20 +0300 Timo Sirainen <tss@iki.fi> (4afd508)

    istream-chain/concat: Various fixes. Also made the chain code look more like
    concat code. They should be merged at some point.


M	src/lib/istream-chain.c
M	src/lib/istream-concat.c

2012-08-31 14:14:50 +0300 Timo Sirainen <tss@iki.fi> (30ffa7c)

    lib-storage: Fixed listing list=children namespaces that had child
    namespaces.


M	src/lib-storage/mailbox-list-iter.c

2012-08-30 22:05:02 +0300 Timo Sirainen <tss@iki.fi> (d163fac)

    Merged changes from v2.1 tree.


2012-08-30 21:12:23 +0300 Timo Sirainen <tss@iki.fi> (7174e94)

    Moved most of the IMAP LIST code to lib-storage. Also removed
    MAILBOX_LIST_ITER_SHOW_EXISTING_PARENT flag, since there wasn't any clearly
    good way to handle it. Some clients got confused when they saw that foo/
    mailbox was returned with \Noselect flag. Either they thought that the
    mailbox was named foo/ or that foo was \Noselect. Pretty much the only sane
    way to handle this would be to not make return \Noselect and to treat foo
    and foo/ as equivalent in all commands, but that might cause trouble with
    ACLs and similar checks..


M	src/imap/cmd-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list.h

2012-08-30 18:44:43 +0300 Timo Sirainen <tss@iki.fi> (5d84dfb)

    imap: Fixed MULTIAPPEND CATENATE that contained only URLs


M	src/imap/cmd-append.c

2012-08-29 23:16:05 +0300 Timo Sirainen <tss@iki.fi> (f16414d)

    Minor code cleanup


M	src/imap/cmd-append.c

2012-08-29 23:15:56 +0300 Timo Sirainen <tss@iki.fi> (82908da)

    imap: Don't hang with zero size CATENATE TEXT parts.


M	src/imap/cmd-append.c

2012-08-29 23:13:56 +0300 Timo Sirainen <tss@iki.fi> (7f4a494)

    imap-parser: Fixed imap_parser_read_last_literal() to work again


M	src/lib-imap/imap-parser.c

2012-08-29 22:42:26 +0300 Timo Sirainen <tss@iki.fi> (63ea4ca)

    NEWS updated


M	NEWS

2012-08-29 21:08:08 +0300 Timo Sirainen <tss@iki.fi> (14195da)

    imap: Allow very long MULTIAPPEND CATENATE lines that contain only URLs.


M	src/imap/cmd-append.c

2012-08-29 21:04:45 +0300 Timo Sirainen <tss@iki.fi> (24d1366)

    imap-parser: Allow calling imap_parser_read_args() multiple times with
    larger count parameter.


M	src/lib-imap/imap-parser.c

2012-08-29 21:04:09 +0300 Timo Sirainen <tss@iki.fi> (1b86c77)

    imap-parser: Removed filling missing parameters with NILs. No code was
    relying on this behavior.


M	src/lib-imap/imap-parser.c

2012-08-29 20:16:13 +0300 Timo Sirainen <tss@iki.fi> (29d6ddd)

    imap: Fixed crashes in THREAD=ORDEREDSUBJECT


M	src/imap/cmd-thread.c

2012-08-29 20:00:03 +0300 Timo Sirainen <tss@iki.fi> (7d3aac4)

    imap: CATENATE fix


M	src/imap/cmd-append.c

2012-08-29 19:59:42 +0300 Timo Sirainen <tss@iki.fi> (5afe997)

    istream-chain: Unreference also the last stream when it reaches EOF.


M	src/lib/istream-chain.c

2012-08-29 19:07:47 +0300 Timo Sirainen <tss@iki.fi> (59fde98)

    imap: More APPEND error handling fixes.


M	src/imap/cmd-append.c

2012-08-29 18:34:43 +0300 Timo Sirainen <tss@iki.fi> (ce85eb2)

    imap: Send BAD replies with client_send_command_error()


M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-uid.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-status.c

2012-08-29 18:32:13 +0300 Timo Sirainen <tss@iki.fi> (2db714b)

    imap: Various fixes to APPEND error handling.


M	src/imap/cmd-append.c

2012-08-29 18:32:01 +0300 Timo Sirainen <tss@iki.fi> (945b6f8)

    imap: Added asserts to make sure a tagline isn't sent twice to the same
    command.


M	src/imap/imap-client.c
M	src/imap/imap-client.h

2012-08-29 17:15:34 +0300 Timo Sirainen <tss@iki.fi> (1b6c4fd)

    dbox: Don't try to finish saving attachments if saving has already failed.
    Fixes an assert crash with failed CATENATE.


M	src/lib-storage/index/dbox-common/dbox-save.c

2012-08-29 16:55:33 +0300 Timo Sirainen <tss@iki.fi> (87b9e37)

    imap CATENATE: Do one more mailbox_save_continue() after adding EOF to
    stream. Fixes a crash with external mail attachments (mail_attachment_dir).


M	src/imap/cmd-append.c

2012-08-29 16:45:25 +0300 Timo Sirainen <tss@iki.fi> (6e2ec95)

    iostream_rawlog_create_path(): Avoid double-closing the rawlog fd


M	src/lib/iostream-rawlog.c

2012-08-29 16:18:56 +0300 Timo Sirainen <tss@iki.fi> (f1ed4fa)

    iostream-rawlog: Added possibility to save input/output to the same file.


M	src/lib/iostream-rawlog-private.h
M	src/lib/iostream-rawlog.c
M	src/lib/iostream-rawlog.h
M	src/lib/istream-rawlog.c
M	src/lib/istream-rawlog.h
M	src/lib/ostream-rawlog.c
M	src/lib/ostream-rawlog.h

2012-08-29 16:12:08 +0300 Timo Sirainen <tss@iki.fi> (22c1ec4)

    str_*printfa(): Avoid growing underlying buffer if possible.


M	src/lib/str.c

2012-08-29 08:56:40 +0300 Timo Sirainen <tss@iki.fi> (60626b5)

    Reverted some of the last hash table changes. They caused hash table
    operations to dereference pointers, which caused a compiler error if the
    type wasn't known.


M	src/lib/hash-decl.h
M	src/lib/hash.h

2012-08-28 22:40:57 +0300 Timo Sirainen <tss@iki.fi> (01f4ee4)

    i_stream_stat() API changed. This fixes also one missing error check.


M	src/lib-compression/istream-bzlib.c
M	src/lib-compression/istream-zlib.c
M	src/lib-fs/fs-sis.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/list/subscription-file.c
M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-file.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-private.h
M	src/lib/istream-seekable.c
M	src/lib/istream-sized.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/istream.h

2012-08-28 22:20:17 +0300 Timo Sirainen <tss@iki.fi> (0fe713f)

    o_stream_send_istream(): Get input stream size with i_stream_get_size()
    instead of _stat().


M	src/lib/ostream-file.c

2012-08-28 22:15:57 +0300 Timo Sirainen <tss@iki.fi> (6f0d9b2)

    istream-chain: Removed default get_size() implementation and panicing on
    stat() This works around crashes in mdbox/quota code. Patch by Stephan
    Bosch.


M	src/lib/istream-chain.c

2012-08-28 22:15:49 +0300 Timo Sirainen <tss@iki.fi> (46908da)

    mdbox: Replaced non-error-checking i_stream_stat() with potentially faster
    i_stream_get_size().


M	src/lib-storage/index/dbox-multi/mdbox-save.c

2012-08-28 19:06:01 +0300 Timo Sirainen <tss@iki.fi> (aecc59f)

    imapc: If imapc_list_prefix=INBOX, don't treat INBOX/INBOX as the INBOX
    itself.


M	src/lib-storage/index/imapc/imapc-list.c

2012-08-28 18:53:30 +0300 Timo Sirainen <tss@iki.fi> (3350b29)

    dict file: Fixed corruption with large values. Patch by Ewald Dieterich.


M	src/lib-dict/dict-file.c

2012-08-28 15:57:22 +0300 Timo Sirainen <tss@iki.fi> (bd389fd)

    imapc: max_idle_time setting didn't actually work.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c

2012-08-28 14:46:16 +0300 Timo Sirainen <tss@iki.fi> (a566d9f)

    lmtp proxy: Forward proxy_timeout to backend and set mail_max_lock_timeout
    based on it. This automatically avoids duplicate mail deliveries caused by
    long lock waits.


M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h
M	src/lmtp/client.h
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c

2012-08-28 13:23:37 +0300 Timo Sirainen <tss@iki.fi> (eaa33f0)

    lmtp proxy: Include session ID string in timeout reply text.


M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-proxy.h

2012-08-26 19:23:48 +0300 Timo Sirainen <tss@iki.fi> (531ddc8)

    dict-redis: Fixed infinite looping


M	src/lib-dict/dict-redis.c

2012-08-25 12:05:34 +0300 Timo Sirainen <tss@iki.fi> (548d8f6)

    istream-concat: Bugfix


M	src/lib/istream-concat.c

2012-08-24 19:44:43 +0000 Pascal Volk <user@localhost.localdomain.org> (fcf3527)

    imap IDLE: Added back fc00::/7 (RFC 4193) to private networks. This time the
    check is done correctly.


M	src/imap/cmd-idle.c

2012-08-24 09:41:55 +0300 Timo Sirainen <tss@iki.fi> (3c42e7c)

    imap IDLE: Reverted the IPv6 change, it doesn't work like that.


M	src/imap/cmd-idle.c

2012-08-23 23:20:57 +0000 Pascal Volk <user@localhost.localdomain.org> (8534886)

    imap IDLE: Add also fc00::/7 (RFC 4193) to private networks.


M	src/imap/cmd-idle.c

2012-08-23 23:50:55 +0300 Timo Sirainen <tss@iki.fi> (f03e38b)

    imap IDLE: Add also 172.168/12 to private networks.


M	src/imap/cmd-idle.c

2012-08-23 21:49:15 +0300 Timo Sirainen <tss@iki.fi> (9511f74)

    imap IDLE: Time "still here" packet sends based on client IP address if
    possible.


M	src/imap/cmd-idle.c

2012-08-23 15:29:43 +0300 Timo Sirainen <tss@iki.fi> (98950c9)

    Compiler warning fix


M	src/lib/istream-concat.c

2012-08-23 11:54:46 +0300 Timo Sirainen <tss@iki.fi> (99695d9)

    lib-storage: Moved per-mail data in struct mail_save_context to separate
    struct. This fixes previous save leaking metadata to the next save.


M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/zlib/zlib-plugin.c

2012-08-23 11:26:13 +0300 Timo Sirainen <tss@iki.fi> (c6f6445)

    Increased initial memory pool size


M	src/lib-mail/istream-attachment-extractor.c

2012-08-22 16:55:27 +0300 Timo Sirainen <tss@iki.fi> (2e533fb)

    Made PKG_STATEDIR configurable with state_dir setting. Based on patch by
    Chris Webb.

    Normally this isn't needed, since the data in the state_dir can be shared 
    across multiple Dovecot instances, but in some specific use cases this may 
    be useful (e.g. users running their own Dovecots).

M	src/config/Makefile.am
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/doveadm.c
M	src/lib-master/master-instance.h
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
M	src/lib-master/master-service-ssl.c
M	src/lib-master/master-service.c
M	src/login-common/ssl-proxy-openssl.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/master-settings.h
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c

2012-08-22 15:19:19 +0300 Timo Sirainen <tss@iki.fi> (dc9bac0)

    lib-storage: Added mail_save_copy_default_metadata()


M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-copy.h

2012-08-22 15:18:39 +0300 Timo Sirainen <tss@iki.fi> (13984f1)

    istream-base64: Fixed returning -2 too early.


M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c

2012-08-22 15:13:21 +0300 Timo Sirainen <tss@iki.fi> (a91f2c4)

    istream-concat bugfixes


M	src/lib/istream-concat.c

2012-08-22 11:44:46 +0300 Timo Sirainen <tss@iki.fi> (e869616)

    Added a test for istream-attachment-extractor hash size


M	src/lib-mail/test-istream-attachment.c

2012-08-22 11:43:15 +0300 Timo Sirainen <tss@iki.fi> (97c8ebb)

    istream-attachment-extractor didn't return hash strings correctly.


M	src/lib-mail/istream-attachment-extractor.c

2012-08-22 10:18:44 +0300 Timo Sirainen <tss@iki.fi> (f5f8bd0)

    istream-attachment-connector: Avoid seeking in the base stream, it may not
    be seekable.


M	src/lib-mail/istream-attachment-connector.c

2012-08-22 10:18:08 +0300 Timo Sirainen <tss@iki.fi> (bdcb001)

    Added i_stream_create_range()


M	src/lib/istream-limit.c
M	src/lib/istream.h

2012-08-21 10:18:38 +0300 Timo Sirainen <tss@iki.fi> (5a7acd6)

    imap: Fixed command output locking.


M	src/imap/cmd-idle.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-fetch.c
M	src/imap/imap-sync.c
M	src/imap/main.c

2012-08-21 10:02:44 +0300 Timo Sirainen <tss@iki.fi> (2d9019d)

    dict redis: Fixed dict_lookup() to skip all previous pending replies.


M	src/lib-dict/dict-redis.c

2012-08-24 15:12:32 +0300 Timo Sirainen <tss@iki.fi> (b825901)

    auth: Don't add "master" to passdb reply if the passdb itself already added
    it.


M	src/auth/auth-request-handler.c

2012-08-24 12:25:55 +0300 Timo Sirainen <tss@iki.fi> (d85f713)

    auth: Make it clearer in debug messages if the replies are passdb or userdb.


M	src/auth/auth-client-connection.c
M	src/auth/auth-master-connection.c

2012-08-23 23:46:15 +0300 Timo Sirainen <tss@iki.fi> (cdfdb67)

    doveadm copy/move: Added "user" parameter to specify the source user.


M	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2012-08-23 22:56:56 +0300 Timo Sirainen <tss@iki.fi> (2c8dd01)

    imap: Fixes to handling UTF-8 namespace prefixes


M	src/imap/cmd-list.c
M	src/imap/cmd-namespace.c
M	src/imap/imap-commands-util.c

2012-08-23 22:33:23 +0300 Timo Sirainen <tss@iki.fi> (938fbc3)

    lib-storage: Verify that namespace prefix is valid UTF8 string.


M	src/lib-storage/mail-storage-settings.c

2012-08-23 22:21:42 +0300 Timo Sirainen <tss@iki.fi> (d92ef0c)

    mbox: Fixed listing mailboxes under INBOX directory.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-08-23 21:29:40 +0300 Timo Sirainen <tss@iki.fi> (01cb291)

    doveadm: Added "copy" command.


M	src/doveadm/Makefile.am
R073	src/doveadm/doveadm-mail-move.c	src/doveadm/doveadm-mail-copymove.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2012-08-23 11:56:56 +0300 Timo Sirainen <tss@iki.fi> (619828b)

    lib-storage: Make sure a save context doesn't leak metadata to the next
    save.


M	src/lib-storage/index/index-storage.c

2012-08-22 17:42:06 +0300 Timo Sirainen <tss@iki.fi> (23e54e2)

    configure: Removed OpenBSD /dev/arandom checking. Patch by Brad Smith

    "The use of arandom was never a requirement for Dovecot and I had submitted 
    the use of arandom due to ports policy to do so anyway."

M	configure.in

2012-08-22 15:17:53 +0300 Timo Sirainen <tss@iki.fi> (fcc905a)

    istream-concat bugfixes


M	src/lib/istream-concat.c

2012-08-22 07:49:55 +0300 Timo Sirainen <tss@iki.fi> (81419a8)

    auth: Unregister SCRAM-SHA-1 at deinit.


M	src/auth/mech.c

2012-08-21 10:02:44 +0300 Timo Sirainen <tss@iki.fi> (97d5d23)

    dict redis: Fixed dict_lookup() to skip all previous pending replies.


M	src/lib-dict/dict-redis.c

2012-08-20 16:13:49 +0300 Timo Sirainen <tss@iki.fi> (c395e7d)

    i_stream_create_seekable_path() created memory corruption


M	src/lib/istream-seekable.c

2012-08-20 11:09:42 +0300 Timo Sirainen <tss@iki.fi> (59153e6)

    Merged changes from v2.1 tree.


2012-08-20 10:54:04 +0300 Timo Sirainen <tss@iki.fi> (08e9fec)

    Simplified hash table union now that it again works only with pointers.


M	TODO
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/dsync-transaction-log-scan.h
M	src/lib/hash-decl.h
M	src/lib/hash.h

2012-08-20 10:19:57 +0300 Timo Sirainen <tss@iki.fi> (b171ffe)

    Fixed some aliasing warnings with hash table API.


M	src/lib/hash.h

2012-08-20 10:01:03 +0300 Timo Sirainen <tss@iki.fi> (7444cc5)

    imap: Allow fetching [x.MIME] for message/rfc822 again. It's not clear which
    is the correct behavior.


M	src/lib-imap-storage/imap-msgpart.c

2012-08-20 09:47:28 +0300 Timo Sirainen <tss@iki.fi> (a75d470)

    Reverted "support for non-pointers" part of the hash table API changes.
    Originally I wrote it using clang, which didn't give as many warnings as gcc
    did. I guess this way is safer anyway..


M	src/anvil/connect-limit.c
M	src/auth/auth-request-handler.c
M	src/auth/db-checkpassword.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/director/director-test.c
M	src/director/user-directory.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/dsync-transaction-log-scan.h
M	src/imap/imap-client.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-auth/auth-server-connection.h
M	src/lib-dict/dict-file.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.c
M	src/lib-lda/duplicate.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login-auth.c
M	src/lib-settings/settings-parser.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib/child-wait.c
M	src/lib/hash.c
M	src/lib/hash.h
M	src/log/log-connection.c
M	src/login-common/ssl-proxy-openssl.c
M	src/master/service-monitor.c
M	src/master/service-process.c
M	src/master/service.c
M	src/master/service.h
M	src/plugins/acl/acl-cache.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts/fts-expunge-log.c
M	src/pop3/pop3-commands.c
M	src/replication/aggregator/replicator-connection.c

2012-08-20 08:31:00 +0300 Timo Sirainen <tss@iki.fi> (ab750f2)

    Compiler error fix due to hash table changes.


M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/dsync-transaction-log-scan.h

2012-08-19 16:17:32 +0300 Timo Sirainen <tss@iki.fi> (27a44fc)

    Removed CONTEXT_TYPE_SAFETY macro and reimplemented its functionality
    better. gcc/clang now gives a compiler error in many places if callback
    isn't exactly what was expected. It's also now much easier to add more of
    these checks.


M	src/anvil/anvil-connection.c
M	src/auth/auth-request-handler.h
M	src/auth/db-dict.c
M	src/auth/db-ldap.c
M	src/auth/db-sql.c
M	src/config/config-connection.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm.c
M	src/imap/imap-fetch.h
M	src/indexer/indexer-client.c
M	src/lib-dns/dns-lookup.c
M	src/lib-dns/dns-lookup.h
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-index/mail-index-util.c
M	src/lib-lda/mail-send.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-header-filter.h
M	src/lib-mail/message-header-parser.h
M	src/lib-mail/message-parser.h
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-master/master-service.c
M	src/lib-settings/settings.c
M	src/lib-settings/settings.h
M	src/lib-sql/sql-api.h
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/mail-search.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-header.c
M	src/lib/array.h
M	src/lib/bsearch-insert-pos.c
M	src/lib/bsearch-insert-pos.h
M	src/lib/child-wait.h
M	src/lib/connection.c
M	src/lib/ioloop.h
M	src/lib/istream.h
M	src/lib/macros.h
M	src/lib/module-dir.c
M	src/lib/ostream.h
M	src/lib/strfuncs.c
M	src/lib/strfuncs.h
M	src/lib/test-bsearch-insert-pos.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/pop3-migration/pop3-migration-plugin.c

2012-08-19 14:21:37 +0300 Timo Sirainen <tss@iki.fi> (4ee0053)

    Array API changed: ARRAY_DEFINE(name, type) -> ARRAY(type) name Easy way to
    update your existing code: perl -i -pe 's:ARRAY_DEFINE\(([^,]+),
    *([^)]+)\);:ARRAY($2) $1;:' **/*.[ch]


M	src/auth/auth-request-handler.c
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-ldap.h
M	src/auth/main.c
M	src/auth/passdb-template.c
M	src/auth/passdb.c
M	src/auth/userdb-template.c
M	src/auth/userdb.c
M	src/config/config-parser-private.h
M	src/config/config-parser.c
M	src/dict/dict-connection.h
M	src/dict/dict-settings.h
M	src/director/director-test.c
M	src/director/director.h
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/user-directory.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-server.h
M	src/doveadm/doveadm-settings.h
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-tree-private.h
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-slave-pipe.c
M	src/imap/cmd-list.c
M	src/imap/imap-client.h
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h
M	src/imap/imap-notify.h
M	src/imap/imap-search.h
M	src/indexer/worker-connection.c
M	src/ipc/ipc-connection.h
M	src/ipc/ipc-group.c
M	src/lib-auth/auth-server-connection.h
M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql-settings.h
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict-transaction-memory.h
M	src/lib-dict/dict.c
M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-private.h
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-view-private.h
M	src/lib-index/mail-transaction-log-view-private.h
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.h
M	src/lib-mail/istream-attachment-connector.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/test-istream-attachment.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/mountpoint-list.c
M	src/lib-settings/settings-parser.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api-private.h
M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-multi/mdbox-map-private.h
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.h
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search-private.h
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/mbox/mbox-sync-private.h
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail-user.h
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-tree.c
M	src/lib/array-decl.h
M	src/lib/array.h
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-kqueue.c
M	src/lib/ioloop-private.h
M	src/lib/lib.h
M	src/lib/module-context.h
M	src/lib/priorityq.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/var-expand.c
M	src/lmtp/client.h
M	src/lmtp/lmtp-proxy.c
M	src/log/log-connection.c
M	src/master/service-listen.c
M	src/master/service-process-notify.c
M	src/master/service.h
M	src/plugins/acl/acl-backend-vfile.h
M	src/plugins/acl/acl-cache.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-storage.h
M	src/plugins/pop3-migration/pop3-migration-plugin.c
M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.h
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h
M	src/replication/replicator/replicator-brain.c
M	src/replication/replicator/replicator-queue.c
M	src/ssl-params/main.c

2012-08-19 14:01:15 +0300 Timo Sirainen <tss@iki.fi> (ad044cd)

    Added missing hash-decl.h


M	src/lib/Makefile.am
A	src/lib/hash-decl.h

2012-08-19 13:55:34 +0300 Timo Sirainen <tss@iki.fi> (678d046)

    Hash table API is now (mostly) type safe.


M	src/anvil/connect-limit.c
M	src/anvil/penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-request-handler.c
M	src/auth/db-checkpassword.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-passwd-file.h
M	src/auth/mech-otp-skey-common.c
M	src/config/config-request.c
M	src/director/director-test.c
M	src/director/user-directory.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm-who.h
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/doveadm/dsync/dsync-mailbox-tree-private.h
M	src/doveadm/dsync/dsync-mailbox-tree-sync.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/doveadm/dsync/dsync-transaction-log-scan.h
M	src/indexer/indexer-queue.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-auth/auth-server-connection.h
M	src/lib-dict/dict-file.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.c
M	src/lib-lda/duplicate.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-settings/settings-parser.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-filename.h
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib/child-wait.c
M	src/lib/guid.c
M	src/lib/guid.h
M	src/lib/hash.c
M	src/lib/hash.h
M	src/lib/lib.h
M	src/lib/macros.h
M	src/log/log-connection.c
M	src/login-common/login-proxy-state.c
M	src/login-common/ssl-proxy-openssl.c
M	src/master/service-monitor.c
M	src/master/service-process.c
M	src/master/service.c
M	src/master/service.h
M	src/plugins/acl/acl-cache.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts/fts-expunge-log.c
M	src/pop3/pop3-commands.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/replicator-queue.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-session.c
M	src/stats/mail-user.c

2012-08-19 12:53:06 +0300 Timo Sirainen <tss@iki.fi> (30f8c62)

    replicator: Crashfix


M	src/replication/aggregator/replicator-connection.c

2012-08-19 07:20:13 +0300 Timo Sirainen <tss@iki.fi> (7536dca)

    hash_table_create(): Removed table_pool parameter. Every single caller was
    using default_pool there, so there's no point in having it.


M	src/anvil/connect-limit.c
M	src/anvil/penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-request-handler.c
M	src/auth/db-checkpassword.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/mech-otp-skey-common.c
M	src/config/config-request.c
M	src/director/director-test.c
M	src/director/user-directory.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/indexer/indexer-queue.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-dict/dict-file.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index.c
M	src/lib-lda/duplicate.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-settings/settings-parser.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib/child-wait.c
M	src/lib/hash.c
M	src/lib/hash.h
M	src/log/log-connection.c
M	src/login-common/login-proxy-state.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/master/service.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts/fts-expunge-log.c
M	src/pop3/pop3-commands.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/replicator-queue.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-session.c
M	src/stats/mail-user.c

2012-08-18 17:05:59 +0300 Timo Sirainen <tss@iki.fi> (6967fa4)

    Added i_stream_create_seekable_path()


M	src/lib/istream-seekable.c
M	src/lib/istream-seekable.h

2012-08-18 15:56:30 +0300 Timo Sirainen <tss@iki.fi> (a2ecf3b)

    ostream-file: Fixed writing with zero buffer size.


M	src/lib/ostream-file.c

2012-08-18 10:31:19 +0300 Timo Sirainen <tss@iki.fi> (a21f618)

    connection API: Allow calling connection_input_default() for buffered input.


M	src/lib/connection.c

2012-08-17 19:01:03 +0300 Timo Sirainen <tss@iki.fi> (3a8c3cd)

    doveadm: Improved "passdb lookup failed" error message.


M	src/doveadm/doveadm-mail-server.c

2012-08-17 11:15:21 +0300 Timo Sirainen <tss@iki.fi> (0169161)

    Makefile: Install the useful doveadm*.h headers.


M	src/doveadm/Makefile.am

2012-08-17 09:17:48 +0300 Timo Sirainen <tss@iki.fi> (116ba2e)

    doveadm backup: Fixed "is source empty" check. In POP3 boxes there is only
    INBOX, and it's possible that source becomes empty while backup has mails.
    The check is now "has source always been empty?"


M	src/doveadm/dsync/dsync-brain.c

2012-08-17 08:46:22 +0300 Timo Sirainen <tss@iki.fi> (3c7dfbb)

    imap: FETCH[x.MIME] for message/rfc822 should produce empty result


M	src/lib-imap-storage/imap-msgpart.c

2012-08-17 07:47:16 +0300 Timo Sirainen <tss@iki.fi> (b5a37df)

    imap: Added more tests to return empty data when FETCHing invalid MIME
    parts.


M	src/lib-imap-storage/imap-msgpart.c

2012-08-16 14:57:55 +0300 Timo Sirainen <tss@iki.fi> (8ac890c)

    dovecot-config: Added LIBDOVECOT_DOVEADM_INCLUDE


M	dovecot-config.in.in
M	dovecot.m4

2012-08-16 14:25:21 +0300 Timo Sirainen <tss@iki.fi> (d7a405c)

    Makefile: iostream-*ssl.h wasn't being installed.


M	src/lib-ssl-iostream/Makefile.am

2012-08-16 06:09:22 +0300 Timo Sirainen <tss@iki.fi> (7db7fbe)

    connection API: Fixed connected() callback to actually allow detecting
    failed connects.


M	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-redis.c
M	src/lib/connection.c
M	src/lib/connection.h

2012-08-16 05:41:57 +0300 Timo Sirainen <tss@iki.fi> (3d95a75)

    dict memcached-ascii bugfixes


M	src/lib-dict/dict-memcached-ascii.c

2012-08-15 16:56:17 +0300 Timo Sirainen <tss@iki.fi> (75bb836)

    lib-dict: Added memcached_ascii backend.


M	src/lib-dict/Makefile.am
A	src/lib-dict/dict-memcached-ascii.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c

2012-08-15 16:55:44 +0300 Timo Sirainen <tss@iki.fi> (8bf42ce)

    lib-dict: Moved "in-memory transaction" code from dict-file to more generic
    API.


M	src/lib-dict/Makefile.am
M	src/lib-dict/dict-file.c
A	src/lib-dict/dict-transaction-memory.c
A	src/lib-dict/dict-transaction-memory.h

2012-08-15 13:43:16 +0300 Timo Sirainen <tss@iki.fi> (cdac586)

    imap: Implemented THREAD=ORDEREDSUBJECT extension.


M	configure.in
M	src/imap/cmd-thread.c
M	src/lib-storage/mail-thread.c

2012-08-15 12:37:34 +0300 Timo Sirainen <tss@iki.fi> (6f69174)

    lib-storage: MAX_SORT_PROGRAM_SIZE was too small


M	src/lib-storage/mail-storage.h

2012-08-15 12:05:28 +0300 Timo Sirainen <tss@iki.fi> (3f8303b)

    istream-limit: Move parent stream to expected offset also at EOF.


M	src/lib/istream-limit.c

2012-08-15 09:35:39 +0300 Timo Sirainen <tss@iki.fi> (bfa8734)

    dict server: Implemented APPEND command.


M	src/dict/dict-commands.c

2012-08-15 09:35:21 +0300 Timo Sirainen <tss@iki.fi> (e4f236f)

    imap: Fixed assert-crash on FETCH error disconnections.


M	src/imap/imap-client.c

2012-08-14 23:09:44 +0300 Timo Sirainen <tss@iki.fi> (cee5068)

    imapc: Added imapc_max_idle_time setting to force activity on connection.
    Reducing this from the default 29 minutes should help when there's a
    stateful firewall between imapc and the backend server.


M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2012-08-14 10:02:14 +0300 Timo Sirainen <tss@iki.fi> (d368aab)

    connection: connection_disconnect_reason() didn't handle non-errors
    correctly.


M	src/lib/connection.c

2012-08-14 06:22:44 +0300 Timo Sirainen <tss@iki.fi> (2aed6c2)

    dict: Implemented dict_append()


M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-client.h
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict-redis.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/dict.h

2012-08-14 03:03:26 +0300 Timo Sirainen <tss@iki.fi> (af4fbe4)

    fs layout: Kludge to show INBOX/INBOX mailbox when necessary. This happens
    with one prefix="" namespace and another prefix=INBOX/ namespace when the
    INBOX mailbox itself has children.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-08-14 03:02:02 +0300 Timo Sirainen <tss@iki.fi> (e58f291)

    lib-storage: mailbox_list_get_storage_name() shouldn't treat INBOX specially
    in inbox=no namespaces.


M	src/lib-storage/mailbox-list.c

2012-08-14 03:01:07 +0300 Timo Sirainen <tss@iki.fi> (7fd51f7)

    lib-storage: If alias_for references inbox=yes namespace, copy the inbox=yes
    to the alias ns. So even though this still doesn't allow giving multiple
    inbox=yes settings in configuration file, it's now possible for multiple
    namespaces to have them. They just need to point to the exact same INBOX.


M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h

2012-08-14 01:54:34 +0300 Timo Sirainen <tss@iki.fi> (1b302c5)

    imap LIST: Don't set \haschildren flag for namespace prefix if it has
    list=no


M	src/imap/cmd-list.c

2012-08-13 15:23:32 +0300 Timo Sirainen <tss@iki.fi> (51cbc45)

    imap: Implemented NOTIFY extension. Requires mailbox_list_index=yes to work
    (and to show up in capabilities). SubscriptionChange event is still
    unimplemented.


M	src/imap/Makefile.am
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
A	src/imap/cmd-notify.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-sort.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands.c
M	src/imap/imap-commands.h
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h
A	src/imap/imap-list.c
A	src/imap/imap-list.h
A	src/imap/imap-notify.c
A	src/imap/imap-notify.h
M	src/imap/imap-search.c
M	src/imap/imap-search.h
M	src/imap/imap-sync.c
M	src/imap/main.c

2012-08-13 15:20:33 +0300 Timo Sirainen <tss@iki.fi> (8854395)

    lib-storage: Added mailbox-list-notify API for tracking changes in all
    mailboxes. Requires mailbox_list_index=yes to work.


M	src/lib-storage/Makefile.am
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/Makefile.am
M	src/lib-storage/list/mailbox-list-fs.c
A	src/lib-storage/list/mailbox-list-index-notify.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
A	src/lib-storage/list/mailbox-list-notify-tree.c
A	src/lib-storage/list/mailbox-list-notify-tree.h
A	src/lib-storage/mailbox-list-notify.c
A	src/lib-storage/mailbox-list-notify.h
M	src/lib-storage/mailbox-list-private.h

2012-08-13 15:15:07 +0300 Timo Sirainen <tss@iki.fi> (1ed9669)

    mailbox_list_index=yes: Don't log an error when verifying existence of
    already deleted mailbox.


M	src/lib-storage/index/index-sync.c

2012-08-13 15:12:41 +0300 Timo Sirainen <tss@iki.fi> (afd0d07)

    lib-index: Added mail_index_view_dup_private()


M	src/lib-index/mail-index-view-private.h
M	src/lib-index/mail-index-view.c

2012-08-13 15:09:30 +0300 Timo Sirainen <tss@iki.fi> (aa55faf)

    imap: If imap_capability setting is set explicitly, don't automatically add
    SEARCH=FUZZY.


M	src/imap/imap-client.c

2012-08-13 15:03:46 +0300 Timo Sirainen <tss@iki.fi> (6ea7b0e)

    Added MOVE extension to capabilities. I guess the draft is close enough to
    being ready now.


M	configure.in

2012-08-13 14:23:26 +0300 Timo Sirainen <tss@iki.fi> (b8f8671)

    mailbox_list_index=yes: Don't use indexes when iterating with
    MAILBOX_LIST_ITER_RAW_LIST.


M	src/lib-storage/list/mailbox-list-index-iter.c

2012-08-13 07:28:40 +0300 Timo Sirainen <tss@iki.fi> (6f84506)

    Memory leak fixes


M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c

2012-08-13 07:26:25 +0300 Timo Sirainen <tss@iki.fi> (eb493a9)

    Memory leak fix


M	src/lib/ioloop.c

2012-08-13 05:45:35 +0300 Timo Sirainen <tss@iki.fi> (fbd671a)

    Compiler warning fixes


M	src/config/config-parser.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/master/main.c

2012-08-13 02:57:37 +0300 Timo Sirainen <tss@iki.fi> (85ee28d)

    imap: Code cleanup


M	src/imap/imap-sync.c

2012-08-13 02:51:09 +0300 Timo Sirainen <tss@iki.fi> (e82e363)

    imap: FETCH API updated to allow using the same parsed FETCH in multiple
    mailboxes. This is in preparation for NOTIFY extension.


M	src/imap/cmd-fetch.c
M	src/imap/cmd-select.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2012-08-13 02:41:08 +0300 Timo Sirainen <tss@iki.fi> (3cca614)

    imap_msgpart_parse() doesn't really need a mailbox parameter.


M	src/imap/imap-fetch-body.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h

2012-08-13 01:47:54 +0300 Timo Sirainen <tss@iki.fi> (d10a370)

    imap: FETCH API cleanup: keep fetch state in a separate struct.


M	src/imap/cmd-fetch.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2012-08-13 01:25:12 +0300 Timo Sirainen <tss@iki.fi> (4f5f48f)

    imap: Made STATUS handling API more flexible.


M	src/imap/cmd-list.c
M	src/imap/cmd-status.c
M	src/imap/imap-status.c
M	src/imap/imap-status.h

2012-08-13 00:36:38 +0300 Timo Sirainen <tss@iki.fi> (89cda47)

    lib-storage: Mailbox tree API supports now including extra data in the
    nodes.


M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-tree.h

2012-08-13 00:33:47 +0300 Timo Sirainen <tss@iki.fi> (0fa8427)

    lib-index: Support clearing the whole log view with
    mail_transaction_log_view_clear(0)


M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.h

2012-08-13 00:31:40 +0300 Timo Sirainen <tss@iki.fi> (8f41f99)

    lib-index: Removed duplicate ext-intro checking code.


M	src/lib-index/mail-index-sync-update.c

2012-08-13 00:29:38 +0300 Timo Sirainen <tss@iki.fi> (cf05507)

    lib-index: Verify validity of ext-intro records in transaction log.


M	src/lib-index/mail-transaction-log-view.c

2012-08-13 00:27:07 +0300 Timo Sirainen <tss@iki.fi> (0557021)

    Verify that mailbox_idle_check_interval setting isn't 0.


M	src/lib-storage/mail-storage-settings.c

2012-08-12 09:57:20 +0300 Timo Sirainen <tss@iki.fi> (689d163)

    lib-ssl-iostream: Avoid assert-crash when reading a closed stream.


M	src/lib-ssl-iostream/iostream-openssl.c

2012-08-12 08:36:06 +0300 Timo Sirainen <tss@iki.fi> (b009e7e)

    lib-ssl-iostream: Don't crash if protocols setting is NULL.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2012-08-12 08:35:29 +0300 Timo Sirainen <tss@iki.fi> (f1f61d8)

    ssl-params socket was missing from login/ directory


M	src/ssl-params/ssl-params-settings.c

2012-08-12 08:05:49 +0300 Timo Sirainen <tss@iki.fi> (a159e0b)

    lib-index: Message flag syncing was broken due to wrong struct cast.


M	src/lib-index/mail-index-sync.c

2012-08-12 07:21:00 +0300 Timo Sirainen <tss@iki.fi> (d775ed0)

    lib-storage: Update private index before updating saved search results.


M	src/lib-storage/index/index-sync.c

2012-08-12 06:26:35 +0300 Timo Sirainen <tss@iki.fi> (6f08b98)

    Added i_stream_last_line_crlf()


M	src/lib/istream-private.h
M	src/lib/istream.c
M	src/lib/istream.h

2012-08-12 05:42:14 +0300 Timo Sirainen <tss@iki.fi> (4e7b41f)

    lib-imap: imap_quote() was broken when called with a datastack pool.


M	src/lib-imap/imap-quote.c

2012-08-12 05:21:35 +0300 Timo Sirainen <tss@iki.fi> (b09e282)

    FETCH BINARY fix.


M	src/lib-storage/index/index-mail-binary.c

2012-08-12 04:54:54 +0300 Timo Sirainen <tss@iki.fi> (0d20bb8)

    imap: More fixes to fetching messages.


M	src/lib-imap-storage/imap-msgpart.c

2012-08-12 03:28:26 +0300 Timo Sirainen <tss@iki.fi> (d408884)

    lib-storage: Fixed assert-crash on subscribtion change that didn't change
    anything.


M	src/lib-storage/list/subscription-file.c

2012-08-12 02:26:12 +0300 Timo Sirainen <tss@iki.fi> (6202c9d)

    lib-storage: mail_get_header_stream() now always returns end-of-headers LF.


M	src/lib-storage/index/index-mail-headers.c

2012-08-12 02:24:54 +0300 Timo Sirainen <tss@iki.fi> (3c07b14)

    istream-header-filter: Allow adding more headers at the end of headers
    callback.


M	src/lib-mail/istream-header-filter.c

2012-08-12 02:08:30 +0300 Timo Sirainen <tss@iki.fi> (eb138bd)

    imap: Fixed fetching partial ranges from non-BODY[]


M	src/lib-imap-storage/imap-msgpart.c

2012-08-12 01:38:51 +0300 Timo Sirainen <tss@iki.fi> (a317854)

    imap: (non-UID) MOVE command didn't always send EXPUNGE for the moved
    message.


M	src/imap/cmd-copy.c

2012-08-12 01:29:16 +0300 Timo Sirainen <tss@iki.fi> (efb83f1)

    dbox: Crashfixes


M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-save.c

2012-08-11 08:10:32 +0300 Timo Sirainen <tss@iki.fi> (402e999)

    Renamed struct mailbox_info.name to vname.


M	TODO
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-move.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/dsync/dsync-mailbox-tree-fill.c
M	src/imap/cmd-list.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/virtual/virtual-config.c

2012-08-11 08:03:05 +0300 Timo Sirainen <tss@iki.fi> (fc0b202)

    imap: Fixed FETCHing nonexistent parts.


M	src/lib-imap-storage/imap-msgpart.c

2012-08-11 07:48:04 +0300 Timo Sirainen <tss@iki.fi> (83fb4a1)

    Added BINARY to IMAP capabilities.


M	configure.in

2012-08-11 07:47:29 +0300 Timo Sirainen <tss@iki.fi> (6e8f003)

    lib-storage: Added caching for mail_get_binary_size()


M	src/lib-mail/Makefile.am
A	src/lib-mail/message-binary-part.c
A	src/lib-mail/message-binary-part.h
M	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/mail.c

2012-08-11 07:46:42 +0300 Timo Sirainen <tss@iki.fi> (3f73764)

    liblib: Added "number packing" API.


M	src/lib/Makefile.am
A	src/lib/numpack.c
A	src/lib/numpack.h
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-numpack.c

2012-08-11 05:47:03 +0300 Timo Sirainen <tss@iki.fi> (2803c51)

    imap: Send FETCH BINARY output using literal8.


M	src/imap/imap-fetch-body.c
M	src/lib-imap-storage/imap-msgpart.c

2012-08-11 05:31:46 +0300 Timo Sirainen <tss@iki.fi> (306b3f4)

    IMAP BINARY extension supports now FETCH BINARY command.


M	src/doveadm/doveadm-mail.c
M	src/imap/cmd-fetch.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h
M	src/lib-storage/fail-mail.c
M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/imapc/imapc-mail.c
A	src/lib-storage/index/index-mail-binary.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-error.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/plugins/virtual/virtual-mail.c

2012-08-11 05:29:05 +0300 Timo Sirainen <tss@iki.fi> (f2b95f6)

    istream-seekable: Reverted unnecessary/broken changes from the previous
    patch.


M	src/lib/istream-seekable.c

2012-08-11 05:19:58 +0300 Timo Sirainen <tss@iki.fi> (4e2d7dd)

    lib-mail: Added message_decoder_parse_cte()


M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-decoder.h

2012-08-11 05:17:58 +0300 Timo Sirainen <tss@iki.fi> (4d33a31)

    Added istreams_merge(), which forces istream-seekable to be created.


M	src/lib/istream-seekable.c
M	src/lib/istream-seekable.h

2012-08-11 05:17:19 +0300 Timo Sirainen <tss@iki.fi> (a6f281d)

    istream-seekable: When we reach EOF, unreference all the input streams.


M	src/lib/istream-seekable.c

2012-08-11 05:15:00 +0300 Timo Sirainen <tss@iki.fi> (5702c81)

    istream-seekable: Minor code cleanup. stream->buffer and sstream->buffer
    being two different things was a bit confusing.


M	src/lib/istream-seekable.c

2012-08-11 04:09:41 +0300 Timo Sirainen <tss@iki.fi> (a0f8e90)

    imap: FETCH BODY[n] shouldn't include MIME headers


M	src/lib-imap-storage/imap-msgpart.c

2012-08-11 03:14:43 +0300 Timo Sirainen <tss@iki.fi> (f7ec15a)

    istream-header-filter: Added i_stream_header_filter_add() to add extra
    headers.


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-header-filter.h
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/mbox/mbox-save.c

2012-08-11 02:53:49 +0300 Timo Sirainen <tss@iki.fi> (8b24778)

    Added o_stream_get_fd().


M	src/lib-compression/ostream-bzlib.c
M	src/lib-compression/ostream-zlib.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream-private.h
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/ostream.h

2012-08-11 02:16:07 +0300 Timo Sirainen <tss@iki.fi> (89d8953)

    Makefile: Removed mountpoint.o from unused_objects, since it's now included
    via lib-master.


M	src/doveadm/Makefile.am
M	src/imap/Makefile.am
M	src/indexer/Makefile.am
M	src/lda/Makefile.am
M	src/lmtp/Makefile.am
M	src/pop3/Makefile.am

2012-08-10 07:32:14 +0300 Timo Sirainen <tss@iki.fi> (5dc71fc)

    Added istream-qp-decoder


M	src/lib-mail/Makefile.am
A	src/lib-mail/istream-qp-decoder.c
A	src/lib-mail/istream-qp.h
A	src/lib-mail/test-istream-qp-decoder.c

2012-08-10 07:31:28 +0300 Timo Sirainen <tss@iki.fi> (9b74311)

    quoted-printable decode didn't ignore whitespace at the end of soft line
    break.


M	src/lib-mail/quoted-printable.c
M	src/lib-mail/test-quoted-printable.c

2012-08-10 07:31:28 +0300 Timo Sirainen <tss@iki.fi> (2f67f2f)

    quoted-printable decode didn't ignore whitespace at the end of soft line
    break.


M	src/lib-mail/quoted-printable.c
M	src/lib-mail/test-quoted-printable.c

2012-08-10 07:01:34 +0300 Timo Sirainen <tss@iki.fi> (12467c3)

    Previous istream-base64 changes broke compilation


M	src/lib-mail/istream-attachment-connector.c

2012-08-10 07:00:20 +0300 Timo Sirainen <tss@iki.fi> (36a50bc)

    Various fixes to istream-base64-encoder/decoder


M	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
M	src/lib/test-istream-base64-encoder.c

2012-08-10 06:45:25 +0300 Timo Sirainen <tss@iki.fi> (3700eab)

    Added istream-base64-decoder.


M	src/lib/Makefile.am
A	src/lib/istream-base64-decoder.c
M	src/lib/istream-base64-encoder.c
R071	src/lib/istream-base64-encoder.h	src/lib/istream-base64.h
A	src/lib/test-istream-base64-decoder.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2012-08-10 06:03:11 +0300 Timo Sirainen <tss@iki.fi> (72a16ae)

    istreams: When reading invalid data, fail with EINVAL instead of EIO. EINVAL
    was already used more.


M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-storage/index/istream-mail.c
M	src/lib/istream-sized.c
M	src/lib/istream-sized.h

2012-08-10 05:55:13 +0300 Timo Sirainen <tss@iki.fi> (10f6041)

    istream-base64-encoder: Minor fix to require only 3 bytes instead of 4 per
    input block. Base64 encoder reads 3 bytes and outputs 4 bytes, so it's ok to
    read only 3 bytes.


M	src/lib/istream-base64-encoder.c

2012-08-10 05:34:35 +0300 Timo Sirainen <tss@iki.fi> (637f988)

    ioloop-epoll: Fix for running with zero I/Os.


M	src/lib/ioloop-epoll.c

2012-08-10 05:27:45 +0300 Timo Sirainen <tss@iki.fi> (6c94ba9)

    doveadm: Renamed "auth" command to "auth test".


M	src/doveadm/doveadm-auth.c

2012-08-10 05:24:07 +0300 Timo Sirainen <tss@iki.fi> (1d2c463)

    Merged changes from v2.1 tree.


2012-08-10 04:56:56 +0300 Timo Sirainen <tss@iki.fi> (0a35e44)

    TODO updated


M	TODO

2012-08-10 02:34:34 +0300 Timo Sirainen <tss@iki.fi> (2df335f)

    Removed accidentally committed debug code


M	src/lib-master/master-service-settings-cache.c

2012-08-10 02:33:19 +0300 Timo Sirainen <tss@iki.fi> (f098053)

    lib-master: Another settings parser cache fix


M	src/lib-master/master-service-settings-cache.c

2012-08-10 00:16:08 +0300 Timo Sirainen <tss@iki.fi> (cf64e39)

    lib-storage: Don't save text/* MIME parts to external attachments even if
    they're big enough.


M	src/lib-storage/index/index-attachment.c

2012-08-09 18:50:31 +0300 Timo Sirainen <tss@iki.fi> (8c8f7ac)

    Added file_lock_method_to_str()


M	src/lib/file-lock.c
M	src/lib/file-lock.h

2012-08-08 23:57:29 +0300 Timo Sirainen <tss@iki.fi> (a327d93)

    connection API: Don't do error handling by default on output stream. For
    connections the error handling is almost never wanted.


M	src/lib/connection.c

2012-08-08 23:46:48 +0300 Timo Sirainen <tss@iki.fi> (f02a1a3)

    master: If service's protocol isn't in enabled protocols, don't verify its
    settings.


M	src/master/master-settings.c

2012-08-08 23:41:40 +0300 Timo Sirainen <tss@iki.fi> (24fed8a)

    Added libtest to libdovecot.so


M	configure.in
M	dovecot-config.in.in
M	src/Makefile.am
M	src/lib-dovecot/Makefile.am

2012-08-08 23:40:37 +0300 Timo Sirainen <tss@iki.fi> (eff0f02)

    ioloop-epoll: Allow running ioloop even without any I/Os (only timeouts).


M	src/lib/ioloop-epoll.c

2012-08-08 01:13:10 +0300 Timo Sirainen <tss@iki.fi> (af5fc8c)

    Compiler warning fixes


M	src/lib-mail/istream-attachment-extractor.h
M	src/lib-mail/test-istream-attachment.c

2012-08-08 00:44:27 +0300 Timo Sirainen <tss@iki.fi> (ca87934)

    fts-solr: Optimized expunging messages: delete more than one ID per request.


M	src/plugins/fts-solr/fts-backend-solr.c

2012-08-07 17:56:24 +0300 Timo Sirainen <tss@iki.fi> (dbeedae)

    lib-master: Settings cache crashed after config_cache_size was reached. This
    affected login processes when local {} and/or remote {} blocks were
    specified. Also fixed the cache behavior to be MRU.


M	src/lib-master/master-service-settings-cache.c

2012-08-06 17:00:47 +0300 Timo Sirainen <tss@iki.fi> (3f878e1)

    login: s/succesful/successful/


M	src/login-common/client-common.c

2012-08-03 17:39:54 +0300 Timo Sirainen <tss@iki.fi> (0e7d5ff)

    pop3-migration: Avoid disconnection from POP3 server due to idling.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2012-08-03 14:19:03 +0300 Timo Sirainen <tss@iki.fi> (49d0c4c)

    Makefile: Fixed -ldovecot-compression name


M	Makefile.am

2012-08-02 23:56:09 +0300 Timo Sirainen <tss@iki.fi> (95eb893)

    Makefile: Added missing headers


M	src/lib-compression/Makefile.am

2012-08-02 23:38:30 +0300 Timo Sirainen <tss@iki.fi> (1ece673)

    Makefile: Added missing headers to tarball


M	src/lib-ssl-iostream/Makefile.am

2012-08-01 23:14:19 +0300 Timo Sirainen <tss@iki.fi> (8da18b8)

    doveadm-server: Make sure another command isn't started before previous one
    is finished.


M	src/doveadm/client-connection.c

2012-08-01 22:43:45 +0300 Timo Sirainen <tss@iki.fi> (f3bed88)

    fts: Fixed a crash if virtual mailbox search couldn't be optimized by
    backend.


M	src/plugins/fts/fts-api.c

2012-08-01 22:39:57 +0300 Timo Sirainen <tss@iki.fi> (d05e9a7)

    fts: Fixed crash on error handling


M	src/plugins/fts/fts-search.c

2012-08-01 21:14:30 +0300 Timo Sirainen <tss@iki.fi> (7a3d164)

    auth: Minor code cleanup


M	src/auth/auth-cache.c

2012-08-01 20:37:05 +0300 Timo Sirainen <tss@iki.fi> (d527055)

    Added signature for changeset bc86680293d2


M	.hgsigs

2012-08-01 20:36:53 +0300 Timo Sirainen <tss@iki.fi> (39d4d5f)

    Added tag 2.1.9 for changeset bc86680293d2


M	.hgtags

2012-08-01 20:36:53 +0300 Timo Sirainen <tss@iki.fi> (b070884)

    Released v2.1.9.


M	NEWS
M	configure.in

2012-08-01 20:25:26 +0300 Timo Sirainen <tss@iki.fi> (2219b37)

    auth: Support empty ldap base (for ldap servers that support it).


M	src/auth/db-ldap.c

2012-08-01 20:24:58 +0300 Timo Sirainen <tss@iki.fi> (a9c3b57)

    auth: winbind mechanism supports now spaces in filenames.


M	src/auth/mech-winbind.c

2012-08-01 20:24:00 +0300 Timo Sirainen <tss@iki.fi> (2022c25)

    fts: Fixed crash in fts_lookup_multi() for backends that can't handle it
    (fts-squat)


M	src/plugins/fts/fts-api.c

2012-08-01 18:53:52 +0300 Timo Sirainen <tss@iki.fi> (98a73e1)

    o_stream_ignore_last_errors() / o_stream_nfinish() now marks parent streams
    also as checked.


M	src/lib/ostream.c

2012-08-01 18:33:14 +0300 Timo Sirainen <tss@iki.fi> (6850575)

    Removed duplicate libdovecot-ssl


M	src/lib-dovecot/Makefile.am
M	src/lib-ssl-iostream/Makefile.am

2012-08-01 18:30:40 +0300 Timo Sirainen <tss@iki.fi> (f052a44)

    Moved zlib/bzlib code to lib-compression library.


M	Makefile.am
M	configure.in
M	dovecot-config.in.in
M	dovecot.m4
M	src/Makefile.am
A	src/lib-compression/Makefile.am
A	src/lib-compression/compression.c
A	src/lib-compression/compression.h
R100	src/plugins/zlib/istream-bzlib.c	src/lib-compression/istream-bzlib.c
R100	src/plugins/zlib/istream-zlib.c	src/lib-compression/istream-zlib.c
R100	src/plugins/zlib/istream-zlib.h	src/lib-compression/istream-zlib.h
R100	src/plugins/zlib/ostream-bzlib.c	src/lib-compression/ostream-bzlib.c
R100	src/plugins/zlib/ostream-zlib.c	src/lib-compression/ostream-zlib.c
R100	src/plugins/zlib/ostream-zlib.h	src/lib-compression/ostream-zlib.h
M	src/plugins/imap-zlib/Makefile.am
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/zlib/Makefile.am
M	src/plugins/zlib/zlib-plugin.c
M	src/plugins/zlib/zlib-plugin.h

2012-08-01 14:13:40 +0300 Timo Sirainen <tss@iki.fi> (46eecdf)

    lib-storage: Fixed attempting to delete a non-symlink with Solaris Also
    fixed error message to say it's about unlink(), not stat().


M	src/lib-storage/list/mailbox-list-delete.c

2012-07-31 23:10:53 +0300 Timo Sirainen <tss@iki.fi> (cd2fc7d)

    fts-solr: Compiler warning fix


M	src/plugins/fts-solr/solr-connection.c

2012-07-31 23:02:22 +0300 Timo Sirainen <tss@iki.fi> (b09f510)

    imapc: Fixed crashes during mailbox close.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2012-07-31 22:33:21 +0300 Timo Sirainen <tss@iki.fi> (9fc96ee)

    lib-storage: Improved missing namespace error messages.


M	src/lib-storage/mail-namespace.c

2012-07-31 22:30:19 +0300 Timo Sirainen <tss@iki.fi> (b5b44e6)

    script: Don't add an empty parameter to executed command line Also fixed an
    error check


M	src/util/script.c

2012-07-31 22:03:00 +0300 Timo Sirainen <tss@iki.fi> (df1713b)

    fts-solr: Log a better error if Solr sends invalid XML input.


M	src/plugins/fts-solr/solr-connection.c

2012-07-31 20:59:22 +0300 Timo Sirainen <tss@iki.fi> (4e68f62)

    auth: if passwd-file isn't the only userdb, don't complain about missing
    userdb fields


M	src/auth/db-passwd-file.c
M	src/auth/db-passwd-file.h

2012-07-31 19:32:03 +0300 Timo Sirainen <tss@iki.fi> (812f2e9)

    lib-storage: Fixes to handling private message flag indexes.


M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync.c

2012-07-31 18:34:53 +0300 Timo Sirainen <tss@iki.fi> (30bbe0d)

    imap: Fixed LIST handling with reference parameter. For example "LIST
    shared/ %" failed to list shared/user namespace prefix.


M	src/imap/cmd-list.c

2012-07-31 18:33:45 +0300 Timo Sirainen <tss@iki.fi> (9de71a9)

    lib-storage: Avoid creating shared user for an empty username.


M	src/lib-storage/index/shared/shared-list.c

2012-07-31 02:46:21 +0300 Timo Sirainen <tss@iki.fi> (4351efd)

    imap: CATENATE command fixes. Patch by Stephan Bosch


M	src/imap/cmd-append.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib/uri-util.c

2012-07-31 02:45:23 +0300 Timo Sirainen <tss@iki.fi> (fde095c)

    lib-master: Assert-crashfix


M	src/lib-master/master-service-ssl.c

2012-07-30 19:49:43 +0300 Timo Sirainen <tss@iki.fi> (35856ec)

    auth: EXTERNAL mechanism didn't use auth_username_* settings.


M	src/auth/mech-external.c

2012-07-30 15:56:00 +0300 Timo Sirainen <tss@iki.fi> (96f89d5)

    Added "connection" API for handling client/server connections more easily.


M	src/lib/Makefile.am
A	src/lib/connection.c
A	src/lib/connection.h

2012-07-30 15:55:39 +0300 Timo Sirainen <tss@iki.fi> (01c05d9)

    Makefile: Fixed libdovecot-ssl to actually contain libssl-iostream


M	src/lib-dovecot/Makefile.am

2012-07-30 15:06:29 +0300 Timo Sirainen <tss@iki.fi> (6434726)

    dovecot.m4: Export also LIBDOVECOT_IMAP_INCLUDE


M	dovecot.m4

2012-07-28 21:55:14 +0300 Timo Sirainen <tss@iki.fi> (b244040)

    lib-master: Check ssl_cert/ssl_key only when running in config/doveconf.
    Also if Dovecot isn't built with SSL, default to ssl=no


M	src/lib-master/master-service-ssl-settings.c

2012-07-28 20:31:30 +0300 Timo Sirainen <tss@iki.fi> (40ec8af)

    lib-storage: When saving a mail, set date.save to cache immediately.


M	src/lib-storage/index/index-mail.c

2012-07-28 20:31:13 +0300 Timo Sirainen <tss@iki.fi> (f081cca)

    lib-storage: When copying a mail, use a new timestamp for date.save instead
    of preserving it.


M	src/lib-storage/index/index-storage.c

2012-07-28 20:00:32 +0300 Timo Sirainen <tss@iki.fi> (3f8926a)

    fts-lucene: Fixed handling non-lowercase SEARCH HEADER
    FROM/TO/SUBJECT/CC/BCC Based on patch by Matthew Powell.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2012-07-28 19:57:10 +0300 Timo Sirainen <tss@iki.fi> (a7bff77)

    verbose_ssl=yes: Log debug messages with debug level instead of as info...


M	src/login-common/ssl-proxy-openssl.c

2012-07-28 19:56:07 +0300 Timo Sirainen <tss@iki.fi> (c09d07e)

    verbose_ssl=yes: Log debug messages with debug level instead of as warnings.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/login-common/ssl-proxy-openssl.c

2012-07-28 19:33:14 +0300 Timo Sirainen <tss@iki.fi> (df27677)

    lib-charset: Removed unnecessary buffer size increases, which only caused
    out-of-memory errors.


M	src/lib-charset/charset-iconv.c

2012-07-28 18:03:25 +0300 Timo Sirainen <tss@iki.fi> (0f43a3e)

    dovecot.m4: Updates from Pigeonhole


M	dovecot.m4

2012-07-28 17:55:46 +0300 Timo Sirainen <tss@iki.fi> (cf3894a)

    Added libdovecot-ssl for creating SSL servers more easily using
    lib-ssl-iostream.


M	Makefile.am
M	configure.in
M	dovecot-config.in.in
M	dovecot.m4
M	src/Makefile.am
M	src/lib-dovecot/Makefile.am
M	src/lib-master/Makefile.am
A	src/lib-master/master-service-ssl.c
A	src/lib-master/master-service-ssl.h

2012-07-28 17:54:19 +0300 Timo Sirainen <tss@iki.fi> (f297568)

    Moved ssl_* settings from login-common to lib-master. This allows creating
    other SSL servers more easily.


M	src/config/config-parser.c
M	src/lib-master/Makefile.am
M	src/lib-master/master-service-private.h
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
A	src/lib-master/master-service-ssl-settings.c
A	src/lib-master/master-service-ssl-settings.h
M	src/lib-master/master-service.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/login-common.h
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h
M	src/login-common/main.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/login-common/ssl-proxy.h
M	src/master/service-process.c

2012-07-28 17:47:34 +0300 Timo Sirainen <tss@iki.fi> (aec5f17)

    lib-master: Added base_dir to master_service_settings.


M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h

2012-07-28 17:45:47 +0300 Timo Sirainen <tss@iki.fi> (9d002e7)

    lib-master: Added and used MASTER_SERVICE_INTERNAL_SET_PARSERS macro.


M	src/auth/auth-settings.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
M	src/lib-storage/mail-storage-service.c
M	src/lmtp/lmtp-settings.c
M	src/login-common/login-settings.c

2012-07-28 17:37:19 +0300 Timo Sirainen <tss@iki.fi> (a80b995)

    ssl-params: Create also base_dir/ssl-params socket.


M	src/ssl-params/ssl-params-settings.c

2012-07-28 17:36:53 +0300 Timo Sirainen <tss@iki.fi> (513ca3e)

    login: Use lib-ssl-iostream code to handle ssl_protocols setting.


M	src/login-common/ssl-proxy-openssl.c

2012-07-28 17:36:27 +0300 Timo Sirainen <tss@iki.fi> (6a4212e)

    lib-ssl-iostream: Added protocols setting.


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/iostream-ssl.h

2012-07-28 17:34:11 +0300 Timo Sirainen <tss@iki.fi> (2244ec1)

    lib-ssl-iostream: Name SSL iostreams based on parent streams.


M	src/lib-ssl-iostream/iostream-openssl.c

2012-07-28 17:33:45 +0300 Timo Sirainen <tss@iki.fi> (130fadd)

    lib-ssl-iostream: Inherit output stream's error handling from parent.


M	src/lib-ssl-iostream/iostream-openssl.c

2012-07-28 17:32:14 +0300 Timo Sirainen <tss@iki.fi> (38f1423)

    lib-ssl-iostream: Added ssl_iostream_destroy() to do a clean SSL shutdown.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl-none.c
M	src/lib-ssl-iostream/iostream-ssl.h

2012-07-28 16:29:22 +0300 Timo Sirainen <tss@iki.fi> (1ab2295)

    config: Added support for plugins to contain multiple service settings. For
    example:

    const struct service_settings *foo_settings_service_settings_array[] = {
    &foo1_settings_service_settings,
    &foo2_settings_service_settings,
    NULL
    };

M	src/config/config-parser.c

2012-07-28 15:34:28 +0300 Timo Sirainen <tss@iki.fi> (04e768a)

    imap: MOVE command's COPYUID reply was missing a space


M	src/imap/cmd-copy.c

2012-07-25 19:31:28 +0300 Timo Sirainen <tss@iki.fi> (c24ef53)

    i_stream_read(): Added assert to make sure EOF isn't returned too early.


M	src/lib/istream.c

2012-07-25 19:30:59 +0300 Timo Sirainen <tss@iki.fi> (c48b861)

    Comment update.


M	src/lib-mail/istream-attachment-connector.h

2012-07-25 19:30:55 +0300 Timo Sirainen <tss@iki.fi> (95ba0bc)

    istream-attachment-extractor: Fixed read() returning EOF too early.


M	src/lib-mail/istream-attachment-extractor.c

2012-07-25 15:39:14 +0300 Timo Sirainen <tss@iki.fi> (a67b39a)

    pop3c: If POP3 server doesn't support CAPA command, try to use UIDL anyway.


M	src/lib-storage/index/pop3c/pop3c-client.c

2012-07-23 21:43:39 +0300 Timo Sirainen <tss@iki.fi> (fefd62f)

    lib-dict: Added memcached backend using its binary protocol.


M	src/lib-dict/Makefile.am
A	src/lib-dict/dict-memcached.c
M	src/lib-dict/dict-private.h
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c

2012-07-23 17:24:13 +0300 Timo Sirainen <tss@iki.fi> (1c7df2f)

    redis dict: Added support for set/unset/atomic_inc. This allows using Redis
    as dict quota backend.


M	src/lib-dict/dict-redis.c

2012-07-23 17:23:37 +0300 Timo Sirainen <tss@iki.fi> (e323798)

    lib-dict: Allow backends to have iteration methods as NULL if they don't
    support it.


M	src/lib-dict/dict.c

2012-07-23 14:23:32 +0300 Timo Sirainen <tss@iki.fi> (6f42ea2)

    quota: Added quota_ignore_save_errors plugin setting. If mail is being saved
    but current quota usage lookup fails with internal error, save the mail
    anyway instead of failing.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2012-07-17 16:20:20 +0300 Timo Sirainen <tss@iki.fi> (b1f02ea)

    auth: Fixed error handling in GSSAPI when __gss_userok() was used. An
    invalid username would have been treated as successful and auth process
    probably would have crashed.


M	src/auth/mech-gssapi.c

2012-07-17 16:17:40 +0300 Timo Sirainen <tss@iki.fi> (0da7ec7)

    auth: GSSAPI RFC compliancy fixes. Patch by Ben Morrow:

    The first problem is that, because of the way the client invokes libsasl, it
    sends a GSSAPI request which does not ask for mutual authentication. This
    means that on the server gss_accept_sec_context returns GSS_S_COMPLETE with
    a zero-length output token. Dovecot currently sends this to the client as a
    zero-length continuation response, but this is incorrect according to RFC
    4752: what it ought to do instead is proceed straight to the security layer
    negotiations, and send a gss_wrap packet.

    The second is that Cyrus sends an empty authz identity; that is, the 
    security layer negotiation packet, when gss_unwrapped, is exactly 4 bytes
    long. Dovecot objects to this, but in RFC 4422 this is explicitly allowed,
    and means the authz identity is identical to the authn identity.

M	src/auth/mech-gssapi.c

2012-07-17 16:03:43 +0300 Jan Friesse <jfriesse@gmail.com> (3fccae8)

    quota: Support for fs hard limit Support for hard limit is implemented for
    NFS, but sadly not for other filesystems. If softlimit is not set (it's 0),
    hardlimit should be used. ---  src/plugins/quota/quota-fs.c |   31
    +++++++++++++++++++++++++++++++  1 files changed, 31 insertions(+), 0
    deletions(-)


M	src/plugins/quota/quota-fs.c

2012-07-17 15:44:36 +0300 Timo Sirainen <tss@iki.fi> (384034c)

    config: Fixed error reporting when reloading settings for master process
    fails.


M	src/config/config-connection.c
M	src/lib-settings/settings-parser.c

2012-07-17 15:31:03 +0300 Timo Sirainen <tss@iki.fi> (f88134b)

    doc: Install mkcert.sh, dovecot-openssl.cnf and solr-schema.xml files.


M	doc/Makefile.am

2012-07-17 15:28:24 +0300 Timo Sirainen <tss@iki.fi> (6a9e034)

    login: Don't allow STARTTLS if ssl=no in client's settings, even if ssl=yes
    globally.


M	src/imap-login/client.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/pop3-login/client-authenticate.c

2012-07-17 15:21:32 +0300 Timo Sirainen <tss@iki.fi> (efa98cb)

    lib-master: Updated default mountpoint ignore prefix list.


M	src/lib-master/mountpoint-list.c

2012-07-17 15:14:21 +0300 Timo Sirainen <tss@iki.fi> (df27aa7)

    director: Changed director_username_hash setting's default from %u to %Lu
    This allows potential trouble when username isn't always lowercased.


M	src/director/director-settings.c

2012-07-17 15:13:21 +0300 Timo Sirainen <tss@iki.fi> (76e1aae)

    example-config: Added director_username_hash setting.


M	doc/example-config/conf.d/10-director.conf

2012-07-17 15:10:35 +0300 Timo Sirainen <tss@iki.fi> (d4a575a)

    lib-mail: mail_user_hash() has now a faster code path for format=%Lu


M	src/lib-mail/mail-user-hash.c

2012-07-17 14:57:44 +0300 Timo Sirainen <tss@iki.fi> (bc0e8c4)

    master: "/X is no longer mounted" warning now points to wiki page.


M	src/master/main.c

2012-07-16 23:15:19 +0300 Timo Sirainen <tss@iki.fi> (93b19ec)

    doveconf: When looking up specific settings, ignore errors found by check
    functions.


M	src/config/doveconf.c

2012-07-16 20:41:51 +0300 Timo Sirainen <tss@iki.fi> (a4b1620)

    imap: Updated MOVE implementation.


M	src/imap/cmd-copy.c
M	src/imap/imap-commands.c
M	src/imap/imap-commands.h

2012-07-16 18:24:53 +0300 Timo Sirainen <tss@iki.fi> (981b94d)

    master: Create missing /var/lib/dovecot/ with world-read-exec permissions.
    There's really nothing secret in the directory and in some setups this
    change had to be done manually anyway.


M	src/master/master-settings.c

2012-07-16 18:00:21 +0300 Timo Sirainen <tss@iki.fi> (766115d)

    quota: ns=PREFIX setting was ignored when accessing other users' shared
    mailboxes.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2012-07-16 17:40:45 +0300 Timo Sirainen <tss@iki.fi> (f914243)

    lib-storage: %h variable didn't necessarily expand correctly for shared
    users' settings.


M	src/lib-storage/mail-user.c

2012-07-16 16:59:51 +0300 Timo Sirainen <tss@iki.fi> (c8750d1)

    lib-storage: Search crashfix.


M	src/lib-storage/index/index-search.c

2012-07-16 16:49:16 +0300 Timo Sirainen <tss@iki.fi> (e5a9801)

    login: If ssl_key parsing fails, log the reason.


M	src/login-common/ssl-proxy-openssl.c

2012-07-11 19:15:03 +0200 Timo Sirainen <tss@iki.fi> (bfe4a97)

    mail-log: Log mailbox names with UTF-8 everywhere (instead of mUTF-7)


M	src/plugins/mail-log/mail-log-plugin.c

2012-07-11 09:32:18 +0200 Timo Sirainen <tss@iki.fi> (f90c6ff)

    Debian names libtextcat as libexttextcat. Patch by Stephan Bosch.


M	configure.in
M	src/plugins/fts-lucene/Makefile.am
M	src/plugins/fts-lucene/lucene-wrapper.cc

2012-07-08 10:28:38 +0300 Timo Sirainen <tss@iki.fi> (378e158)

    pop3c: pop3c_master_user setting broke down non-master logins.


M	src/lib-storage/index/pop3c/pop3c-client.c

2012-07-08 09:18:46 +0300 Timo Sirainen <tss@iki.fi> (aa8e630)

    redis: Fixed connection handling.


M	src/lib-dict/dict-redis.c
M	src/lib/connection.c
M	src/lib/connection.h

2012-07-08 09:00:57 +0300 Timo Sirainen <tss@iki.fi> (31257b4)

    lib-dict: Added initial version of Redis support. The code is a bit ugly and
    doesn't handle anything except key lookups.


M	src/lib-dict/Makefile.am
M	src/lib-dict/dict-private.h
A	src/lib-dict/dict-redis.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c

2012-07-08 08:59:52 +0300 Timo Sirainen <tss@iki.fi> (bc151e6)

    Added "connection" API for handling client/server connections more easily.


M	src/lib/Makefile.am
A	src/lib/connection.c
A	src/lib/connection.h

2012-07-08 07:45:17 +0300 Timo Sirainen <tss@iki.fi> (2028d80)

    auth: Added "dict" passdb/userdb.


A	doc/example-config/conf.d/auth-dict.conf.ext
A	doc/example-config/dovecot-dict-auth.conf.ext
M	src/auth/Makefile.am
A	src/auth/db-dict.c
A	src/auth/db-dict.h
M	src/auth/main.c
A	src/auth/passdb-dict.c
M	src/auth/passdb.c
A	src/auth/userdb-dict.c
M	src/auth/userdb.c

2012-07-08 07:37:28 +0300 Timo Sirainen <tss@iki.fi> (e0ba54c)

    Added a simple JSON parser for parsing an object.


M	src/lib/Makefile.am
A	src/lib/json-parser.c
A	src/lib/json-parser.h

2012-07-07 16:27:59 +0300 Timo Sirainen <tss@iki.fi> (0d6ae58)

    pop3c: Don't get size of TOP output and cache it as message's virtual size.


M	src/lib-storage/index/pop3c/pop3c-mail.c

2012-07-05 16:11:00 +0300 Timo Sirainen <tss@iki.fi> (e771c83)

    lib-storage: Minor code cleanup


M	src/lib-storage/index/index-search.c

2012-07-05 16:08:07 +0300 Timo Sirainen <tss@iki.fi> (c185be2)

    lib-storage: Fixed searching message flags on mailboxes without private
    index.


M	src/lib-storage/index/index-search.c

2012-07-05 10:51:42 +0300 Timo Sirainen <tss@iki.fi> (39aaa66)

    imap: Fixed crashes on some FETCH commands


M	src/lib-imap-storage/imap-msgpart.c

2012-07-04 13:13:56 +0300 Timo Sirainen <tss@iki.fi> (be87105)

    lib-storage: Private index needs to be synced also when messages have been
    expunged.


M	src/lib-storage/index/index-sync-pvt.c

2012-07-04 12:37:02 +0300 Timo Sirainen <tss@iki.fi> (ee0a502)

    lib-storage: Don't try to sync private index files if syncing already
    failed. This fixes a crash when opening a mailbox failed.


M	src/lib-storage/index/index-sync.c

2012-07-04 11:19:44 +0300 Timo Sirainen <tss@iki.fi> (497e3c2)

    lib-master: i_close_fd() change caused environment variables to be used as
    settings.


M	src/lib-master/master-service-settings.c

2012-07-04 11:02:58 +0300 Timo Sirainen <tss@iki.fi> (277c552)

    doveadm auth cache flush usage string updated


M	src/doveadm/doveadm-auth.c

2012-07-07 14:37:54 +0300 Timo Sirainen <tss@iki.fi> (fdb7661)

    file_preallocate() returned wrong value on success with OSX.


M	src/lib/file-set-size.c

2012-07-07 05:51:37 +0300 Timo Sirainen <tss@iki.fi> (ee3dc52)

    pop3: Fixed assert crash when doing UIDL on empty mailbox on some setups.


M	src/pop3/pop3-commands.c

2012-07-04 10:57:40 +0300 Timo Sirainen <tss@iki.fi> (a431459)

    doveadm: Added "auth cache flush" command.


M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h

2012-07-04 10:56:53 +0300 Timo Sirainen <tss@iki.fi> (39dcbe1)

    auth: Added CACHE-FLUSH command to flush some/all users from auth cache.


M	src/auth/auth-cache.c
M	src/auth/auth-cache.h
M	src/auth/auth-master-connection.c
M	src/auth/auth-request.h
M	src/auth/auth.c
M	src/auth/test-auth-cache.c

2012-07-03 05:15:14 +0300 Timo Sirainen <tss@iki.fi> (8b4bc12)

    Added signature for changeset 7e5f36fd989d


M	.hgsigs

2012-07-03 05:15:04 +0300 Timo Sirainen <tss@iki.fi> (953c20f)

    Added tag 2.1.8 for changeset 7e5f36fd989d


M	.hgtags

2012-07-03 05:15:04 +0300 Timo Sirainen <tss@iki.fi> (4f1789f)

    Released v2.1.8.


M	NEWS
M	configure.in

2012-07-03 04:23:03 +0300 Timo Sirainen <tss@iki.fi> (e7b1f9d)

    lmtp: Added lmtp_address_translate setting. The idea is that if you need
    userdb lookup to be done with a special kind of a username like
    user:domain@extrainfo, you can set lmtp_address_translate=%n:%d@ which
    translates the address to user@domain after the userdb lookup is done.


M	src/lmtp/commands.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h

2012-07-03 03:27:52 +0300 Timo Sirainen <tss@iki.fi> (0aaea09)

    lib-sql db cache: Reaching max_unused_connections caused a crash later.


M	src/lib-sql/sql-db-cache.c

2012-07-03 02:59:53 +0300 Timo Sirainen <tss@iki.fi> (2d1892a)

    doveadm server: Keep config socket open while running.


M	src/doveadm/main.c

2012-07-03 01:52:00 +0300 Timo Sirainen <tss@iki.fi> (c180e9d)

    layout=fs, mail_shared_explicit_inbox=no: Fixed listing nonexistent
    mailboxes in root.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-07-03 01:06:24 +0300 Timo Sirainen <tss@iki.fi> (7d87a87)

    imap-quota: GETQUOTAROOT command used UTF-8 instead of mUTF-7 encoding for
    mailbox name.


M	src/plugins/imap-quota/imap-quota-plugin.c

2012-07-03 01:06:10 +0300 Timo Sirainen <tss@iki.fi> (ec5fec7)

    imap-acl: MYRIGHTS command used UTF-8 instead of mUTF-7 encoding for mailbox
    name.


M	src/plugins/imap-acl/imap-acl-plugin.c

2012-07-02 14:54:33 +0300 Timo Sirainen <tss@iki.fi> (a4f2e42)

    imap: Mailbox names in STATUS replies were sent as UTF-8 instead of mUTF-7.


M	src/imap/cmd-list.c
M	src/imap/cmd-status.c
M	src/imap/imap-status.c
M	src/imap/imap-status.h

2012-07-02 10:12:59 +0300 Timo Sirainen <tss@iki.fi> (d9b1522)

    lmtp: Fixed previous change to make sure it doesn't crash on error handling.


M	src/lmtp/lmtp-proxy.c

2012-07-02 10:09:15 +0300 Timo Sirainen <tss@iki.fi> (fb340f9)

    lmtp: Don't idle-timeout LMTP client while proxying waits for DATA replies.


M	src/lmtp/commands.c

2012-07-02 10:05:46 +0300 Timo Sirainen <tss@iki.fi> (4287654)

    lmtp proxy: Reset timeout each time receiving a reply lin for DATA. This
    avoids timing out when there are a lot of RCPT TOs.


M	src/lmtp/lmtp-proxy.c

2012-07-02 08:06:19 +0300 Timo Sirainen <tss@iki.fi> (3f780bf)

    config: Fixed IPv6 address handling for parsing v1.x style listen/ssl_listen
    settings.


M	src/config/old-set-parser.c

2012-07-02 05:14:22 +0300 Timo Sirainen <tss@iki.fi> (3bd3e8e)

    lib-storage: Fixed searching message flags with private flags index.


M	src/lib-storage/index/index-search-private.h
M	src/lib-storage/index/index-search.c

2012-07-02 05:14:02 +0300 Timo Sirainen <tss@iki.fi> (7e5cba6)

    lib-storage: Fixed STATUS_FIRST_UNSEEN_SEQ lookup with private flags index.


M	src/lib-storage/index/index-status.c

2012-06-30 22:27:34 +0300 Timo Sirainen <tss@iki.fi> (ceb43cc)

    o_stream_nsend() comment update


M	src/lib/ostream.h

2012-06-29 09:15:26 +0300 Timo Sirainen <tss@iki.fi> (5df8396)

    istreams: Added default stat() implementation for filter streams.


M	src/lib-mail/istream-attachment-extractor.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-storage/index/istream-mail.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-crlf.c
M	src/lib/istream-limit.c
M	src/lib/istream-private.h
M	src/lib/istream-rawlog.c
M	src/lib/istream-sized.c
M	src/lib/istream.c

2012-06-29 09:01:56 +0300 Timo Sirainen <tss@iki.fi> (032964c)

    istreams: Added default seek() implementation for seekable streams.


M	src/lib-storage/index/istream-mail.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-limit.c
M	src/lib/istream-private.h
M	src/lib/istream-seekable.c
M	src/lib/istream-sized.c
M	src/lib/istream.c

2012-06-29 08:05:08 +0300 Timo Sirainen <tss@iki.fi> (9a68dcd)

    lib-storage: External mail attachment parsing didn't handle CRLF linefeeds
    correctly. This simply meant that if mail_save_crlf=yes was used,
    base64-encoded attachments weren't saved base64-decoded.


M	src/lib-storage/index/index-attachment.c

2012-06-29 08:01:08 +0300 Timo Sirainen <tss@iki.fi> (338088f)

    lib-storage: Use the new istream-attachment-* APIs to handle external mail
    attachments.


M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/index-attachment.c

2012-06-29 08:00:19 +0300 Timo Sirainen <tss@iki.fi> (8aeae03)

    lib-mail: Added istream-attachment-[connector|extractor].
    istream-attachment-extractor can be used to parse messages and extract
    attachment MIME parts from them to wanted output streams. The attachments
    are base64-decoded if they can be later re-encoded to original input without
    any changes.

    istream-attachment-connector does the reverse by taking the base istream and 
    attachment istreams and merging them together to create the original 
    istream.

M	src/lib-mail/Makefile.am
A	src/lib-mail/istream-attachment-connector.c
A	src/lib-mail/istream-attachment-connector.h
A	src/lib-mail/istream-attachment-extractor.c
A	src/lib-mail/istream-attachment-extractor.h
A	src/lib-mail/test-istream-attachment.c

2012-06-29 07:56:02 +0300 Timo Sirainen <tss@iki.fi> (9a75593)

    istreams: Set (file), (fd) or (buffer) as default name for those input
    streams.


M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/ostream-buffer.c

2012-06-29 06:14:51 +0300 Timo Sirainen <tss@iki.fi> (ec0e150)

    dbox: Fixed a potential crash when building message stream from external
    attachments.


M	src/lib-storage/index/dbox-common/dbox-attachment.c

2012-06-28 09:28:05 +0300 Timo Sirainen <tss@iki.fi> (571fd6f)

    Fixed ostream's new error handling not to always assert-crash.


M	src/lib/ostream.c

2012-06-28 06:32:00 +0300 Timo Sirainen <tss@iki.fi> (807332e)

    imap: If selected mailbox is DELETEd, disconnect client.


M	src/imap/cmd-delete.c

2012-06-28 03:20:34 +0300 Timo Sirainen <tss@iki.fi> (ddd1adf)

    hash-format object can now be reset to build multiple hashes.


M	src/lib/hash-format.c
M	src/lib/hash-format.h

2012-06-28 03:18:55 +0300 Timo Sirainen <tss@iki.fi> (c7acd38)

    Added i_stream_alloc()


M	src/lib-mail/istream-binary-converter.c
M	src/lib/istream-private.h
M	src/lib/istream.c

2012-06-28 01:30:50 +0300 Timo Sirainen <tss@iki.fi> (dd2df6a)

    istreams: Renamed i_stream_get_buffer_space() to i_stream_try_alloc()


M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-chain.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-file.c
M	src/lib/istream-private.h
M	src/lib/istream.c

2012-06-28 01:01:58 +0300 Timo Sirainen <tss@iki.fi> (c00c716)

    Renamed istream-attachment to istream-sized. The code didn't really assume
    anything about the input being an attachment, so this allows reusing the
    stream for other purposes.


M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/dbox-common/dbox-attachment.c
D	src/lib-storage/index/istream-attachment.h
M	src/lib/Makefile.am
R052	src/lib-storage/index/istream-attachment.c	src/lib/istream-sized.c
A	src/lib/istream-sized.h

2012-06-28 00:27:13 +0300 Timo Sirainen <tss@iki.fi> (4307c88)

    Changed i_close_fd() API to set the fd to -1 after closing.


M	src/auth/db-checkpassword.c
M	src/auth/db-passwd-file.c
M	src/auth/mech-winbind.c
M	src/config/config-parser.c
M	src/config/sysinfo-get.c
M	src/director/director-test.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-slave-io.c
M	src/imap/main.c
M	src/lda/main.c
M	src/lib-dict/dict-file.c
M	src/lib-dns/dns-lookup.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-lda/smtp-client.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/mountpoint-list.c
M	src/lib-settings/settings-parser.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib/askpass.c
M	src/lib/failures.c
M	src/lib/fdatasync-path.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-kqueue.c
M	src/lib/iostream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/lib.c
M	src/lib/lib.h
M	src/lib/macros.h
M	src/lib/network.c
M	src/lib/nfs-workarounds.c
M	src/lib/randgen.c
M	src/lib/safe-mkstemp.c
M	src/lib/test-ostream-file.c
M	src/lib/unlink-directory.c
M	src/lmtp/commands.c
M	src/login-common/access-lookup.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/master/main.c
M	src/master/service-listen.c
M	src/master/service-monitor.c
M	src/master/service.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3/main.c
M	src/ssl-params/ssl-params.c
M	src/util/gdbhelper.c
M	src/util/rawlog.c

2012-06-27 12:29:42 +0300 Timo Sirainen <tss@iki.fi> (0ca3b9c)

    pop3c: Added pop3c_master_user setting.


M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-settings.h
M	src/lib-storage/index/pop3c/pop3c-storage.c

2012-06-27 12:25:05 +0300 Timo Sirainen <tss@iki.fi> (b21b2d5)

    doveadm mailbox status -A -t: Reset vsize counter between users.


M	src/doveadm/doveadm-mail-mailbox-status.c

2012-06-27 12:12:52 +0300 Timo Sirainen <tss@iki.fi> (b28fc85)

    lib-storage: Fixed handling failures when autocreating mailboxes.


M	src/lib-storage/mail-storage.c

2012-06-27 12:03:51 +0300 Timo Sirainen <tss@iki.fi> (00ef253)

    gssapi: Allow logging in as users listed in "k5principals" extra field. This
    also enables other passdb extra fields for gssapi mechanism.

    Based on patch by Sam Morris.

M	src/auth/mech-gssapi.c

2012-06-27 04:24:53 +0300 Timo Sirainen <tss@iki.fi> (4e8d6d0)

    Try to avoid (void) casts by adding more ATTR_NOWARN_UNUSED_RESULT.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-search.c
M	src/lib-mail/rfc822-parser.h
M	src/lib-storage/index/index-attachment.c
M	src/lib/hash.c
M	src/lib/md4.c
M	src/lib/md5.c
M	src/lib/ostream.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-parser-script.c

2012-06-25 19:40:24 +0300 Timo Sirainen <tss@iki.fi> (63fa2c5)

    imapc: Fixed crash on saving/copying if remote IMAP server didn't support
    UIDPLUS.


M	src/lib-storage/index/imapc/imapc-save.c

2012-06-25 03:21:25 +0300 Timo Sirainen <tss@iki.fi> (b66d803)

    Avoid using (void)s by adding ATTR_NOWARN_UNUSED_RESULT attributes and other
    ways.


M	src/auth/auth-worker-server.h
M	src/auth/passdb-blocking.c
M	src/auth/userdb-blocking.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-slave-pipe.c
M	src/doveadm/dsync/dsync-slave.c
M	src/doveadm/dsync/dsync-slave.h
M	src/doveadm/dsync/dsync-transaction-log-scan.c
M	src/imap-login/client.c
M	src/imap/cmd-append.c
M	src/imap/imap-client.c
M	src/imap/imap-common.h
M	src/imap/imap-search.c
M	src/imap/imap-sync.c
M	src/imap/imap-sync.h
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-file.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/rfc2231-parser.h
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-lock.h
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-list.h
M	src/lib-test/test-common.c
M	src/lib/bsearch-insert-pos.h
M	src/lib/file-dotlock.c
M	src/lib/file-dotlock.h
M	src/lib/iostream-rawlog.h
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-data.c
M	src/lib/istream-private.h
M	src/lib/istream.c
M	src/lib/network.h
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h
M	src/login-common/login-proxy.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/pop3/pop3-client.c

2012-06-25 02:52:33 +0300 Timo Sirainen <tss@iki.fi> (cb78bd2)

    Replaced (void)close(fd) and close_keep_errno() with i_close_fd().
    i_close_fd() preserves the errno and logs an error if the close() fails.


M	src/auth/db-checkpassword.c
M	src/auth/db-passwd-file.c
M	src/auth/mech-winbind.c
M	src/config/config-parser.c
M	src/config/sysinfo-get.c
M	src/director/director-test.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-slave-io.c
M	src/imap/main.c
M	src/lda/main.c
M	src/lib-dict/dict-file.c
M	src/lib-dns/dns-lookup.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-lda/smtp-client.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/mountpoint-list.c
M	src/lib-settings/settings-parser.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib/Makefile.am
M	src/lib/askpass.c
D	src/lib/close-keep-errno.c
D	src/lib/close-keep-errno.h
M	src/lib/failures.c
M	src/lib/fdatasync-path.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-kqueue.c
M	src/lib/iostream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/macros.h
M	src/lib/network.c
M	src/lib/nfs-workarounds.c
M	src/lib/randgen.c
M	src/lib/safe-mkstemp.c
M	src/lib/test-ostream-file.c
M	src/lib/unlink-directory.c
M	src/lmtp/commands.c
M	src/login-common/access-lookup.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/master/main.c
M	src/master/service-listen.c
M	src/master/service-monitor.c
M	src/master/service.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3/main.c
M	src/ssl-params/ssl-params.c
M	src/util/gdbhelper.c
M	src/util/rawlog.c

2012-06-25 02:38:29 +0300 Timo Sirainen <tss@iki.fi> (31a574f)

    Added array_append_zero() to write a zero-filled record to an array.
    Replaced (void)array_append_space() calls with it.


M	src/auth/auth-settings.c
M	src/auth/db-ldap.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/imap/cmd-list.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-fetch.c
M	src/lib-auth/auth-master.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap/imap-match.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-master/master-service-settings.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-storage/fail-mail.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib/array.h
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-kqueue.c
M	src/lib/uri-util.c
M	src/lib/var-expand.c
M	src/master/main.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts/fts-search.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/util/script.c

2012-06-25 02:22:12 +0300 Timo Sirainen <tss@iki.fi> (461ffea)

    seq-range-array: Reverted most of recent API changes. Added
    ATTR_NOWARN_UNUSED_RESULT for the functions whose return value can safely be
    ignored.


M	src/lib-index/mail-index-transaction-update.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib/seq-range-array.c
M	src/lib/seq-range-array.h
M	src/lib/test-seq-range-array.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/virtual/virtual-sync.c

2012-06-25 02:20:30 +0300 Timo Sirainen <tss@iki.fi> (61409be)

    Added ATTR_NOWARN_UNUSED_RESULT, which expands to nowarn_unused_result
    attribute if supported. Requires a patched clang.


M	src/lib/macros.h

2012-06-25 02:15:22 +0300 Timo Sirainen <tss@iki.fi> (3785910)

    Added i_stream_get_data_size(). Used it where possible.


M	src/director/director-connection.c
M	src/doveadm/dsync/dsync-slave-io.c
M	src/imap/cmd-append.c
M	src/imap/imap-client.c
M	src/lib-dict/dict-client.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/istream-nonuls.c
M	src/lib-mail/message-parser.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-crlf.c
M	src/lib/istream-seekable.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/istream.h
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-seekable.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c

2012-06-25 01:14:03 +0300 Timo Sirainen <tss@iki.fi> (e34d170)

    Make sure we check all the functions' return values. Minor API changes to
    simplify this. Checked using a patched clang that adds
    attribute(warn_unused_result) to all functions. This commit fixes several
    error handling mistakes.


M	src/anvil/main.c
M	src/auth/auth-request.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-scram-sha1.c
M	src/auth/passdb-blocking.c
M	src/auth/password-scheme-otp.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-sql.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/dict/dict-commands.c
M	src/dict/main.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/test-user-directory.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-mailbox-tree.c
M	src/doveadm/dsync/dsync-brain-mailbox.c
M	src/doveadm/dsync/dsync-brain-mails.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-mailbox-tree.c
M	src/doveadm/dsync/dsync-slave.c
M	src/doveadm/dsync/dsync-slave.h
M	src/doveadm/server-connection.c
M	src/doveadm/server-connection.h
M	src/imap-login/client.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-fetch-body.c
M	src/imap/imap-sync.c
M	src/imap/main.c
M	src/indexer/master-connection.c
M	src/lib-auth/auth-client.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-ntlm/ntlm-des.c
M	src/lib-ntlm/ntlm-des.h
M	src/lib-ntlm/ntlm-encrypt.c
M	src/lib-ntlm/ntlm-encrypt.h
M	src/lib-otp/otp-hash.c
M	src/lib-otp/otp-hash.h
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-storage.h
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib/data-stack.c
M	src/lib/hash.c
M	src/lib/hostpid.c
M	src/lib/iostream-rawlog.c
M	src/lib/md4.c
M	src/lib/md5.c
M	src/lib/mountpoint.c
M	src/lib/nfs-workarounds.c
M	src/lib/nfs-workarounds.h
M	src/lib/seq-range-array.c
M	src/lib/seq-range-array.h
M	src/lib/test-base64.c
M	src/lib/test-network.c
M	src/lib/test-ostream-file.c
M	src/lib/test-seq-range-array.c
M	src/log/log-connection.c
M	src/log/log-connection.h
M	src/login-common/client-common-auth.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/ssl-proxy-openssl.c
M	src/master/main.c
M	src/master/service-anvil.c
M	src/master/service-process.c
M	src/master/service-process.h
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/plugins/zlib/ostream-zlib.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h
M	src/pop3/pop3-commands.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/replicator/notify-connection.c
M	src/stats/main.c
M	src/util/rawlog.c

2012-06-25 00:18:31 +0300 Timo Sirainen <tss@iki.fi> (76e24e0)

    pop3c: Fixed losing timeout on ioloop change.


M	src/lib-storage/index/pop3c/pop3c-client.c

2012-06-25 00:01:59 +0300 Timo Sirainen <tss@iki.fi> (e2a88d5)

    Added o_stream_nsend*() and related functions to make delayed error handling
    safer. Once o_stream_nsend*() is called, o_stream_nfinish() must be called
    before stream is destroyed to finish checking if there were any errors. If
    something failed and the stream is just wanted to be closed,
    o_stream_ignore_last_errors() can be called.

    For streams where errors don't really make any difference (network sockets) 
    you can call o_stream_set_no_error_handling() immediately after creating the 
    stream.

M	src/anvil/anvil-connection.c
M	src/anvil/connect-limit.c
M	src/anvil/penalty.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-client-connection.h
M	src/auth/auth-master-connection.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/main.c
M	src/auth/mech-winbind.c
M	src/config/config-connection.c
M	src/config/doveconf.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-test.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/dsync/dsync-slave-io.c
M	src/doveadm/server-connection.c
M	src/imap-login/imap-proxy.c
M	src/imap/cmd-append.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-thread.c
M	src/imap/imap-client.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-search.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/indexer/indexer-client.c
M	src/indexer/worker-connection.c
M	src/ipc/client.c
M	src/ipc/ipc-connection.c
M	src/lib-auth/auth-master.c
M	src/lib-dict/dict-file.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap/imap-parser.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-write.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-instance.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/list/subscription-file.c
M	src/lib/ostream-file.c
M	src/lib/ostream-private.h
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/ostream.h
M	src/lib/test-ostream-file.c
M	src/lmtp/client.c
M	src/lmtp/lmtp-proxy.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/replication/aggregator/notify-connection.c
M	src/replication/aggregator/replicator-connection.c
M	src/replication/replicator/doveadm-connection.c
M	src/replication/replicator/notify-connection.c
M	src/replication/replicator/replicator-queue.c
M	src/ssl-params/main.c
M	src/stats/client-export.c
M	src/stats/client.c
M	src/stats/mail-server-connection.c
M	src/util/rawlog.c

2012-06-24 21:43:48 +0300 Timo Sirainen <tss@iki.fi> (121b017)

    master: Problems with creating base_dir/statedir should be fatals.


M	src/master/master-settings.c
M	src/master/master-settings.h

2012-06-24 21:35:18 +0300 Timo Sirainen <tss@iki.fi> (e860b24)

    lib-lda: Duplicate database write failures weren't detected.


M	src/lib-lda/duplicate.c

2012-06-24 21:35:18 +0300 Timo Sirainen <tss@iki.fi> (b949f04)

    lib-lda: Duplicate database write failures weren't detected.


M	src/lib-lda/duplicate.c

2012-06-24 21:29:56 +0300 Timo Sirainen <tss@iki.fi> (2738626)

    seq_range_array_add() API change triggered a crash in buggy code.


M	src/lib-index/mail-index-transaction-finish.c

2012-06-24 21:19:33 +0300 Timo Sirainen <tss@iki.fi> (4fb98a3)

    seq_range_array_remove() now returns void. Added
    seq_ranger_array_try_remove().


M	src/lib-index/mail-index-transaction-update.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib/seq-range-array.c
M	src/lib/seq-range-array.h
M	src/lib/test-seq-range-array.c

2012-06-24 21:14:56 +0300 Timo Sirainen <tss@iki.fi> (86bde2c)

    seq_range_array_add() API changed. Added other functions to provide the less
    common use cases.


M	src/doveadm/dsync/dsync-mailbox-export.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/imap/cmd-store.c
M	src/imap/imap-search.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib/seq-range-array.c
M	src/lib/seq-range-array.h
M	src/lib/test-seq-range-array.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-search.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c

2012-06-24 20:58:04 +0300 Timo Sirainen <tss@iki.fi> (3ea86ed)

    Make static analyzer happier.


M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/lib-index/mail-transaction-log-view.c

2012-06-24 20:57:06 +0300 Timo Sirainen <tss@iki.fi> (caa3e6b)

    Merged changes from v2.1 tree.


2012-06-24 20:52:39 +0300 Timo Sirainen <tss@iki.fi> (7bd301f)

    Make static analyzer happier.


M	src/auth/auth-request.c
M	src/auth/db-ldap.c
M	src/auth/password-scheme.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/plugins/fts-squat/squat-uidlist.c

2012-06-24 20:48:38 +0300 Timo Sirainen <tss@iki.fi> (6cb2c6e)

    Added file_dotlock_delete_verified() and changed file_dotlock_delete() to
    return void.


M	src/lib-fs/fs-posix.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-master/master-instance.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/list/subscription-file.c
M	src/lib/file-dotlock.c
M	src/lib/file-dotlock.h

2012-06-24 20:36:05 +0300 Timo Sirainen <tss@iki.fi> (01ca85e)

    lib-mail: Fixed an edge case with message header parser and very long lines.
    If the header was exactly a specific number of bytes, the parser thought the
    header ended there.


M	src/lib-mail/message-header-parser.c
M	src/lib-mail/test-message-header-parser.c

2012-06-24 19:51:40 +0300 Timo Sirainen <tss@iki.fi> (82d3a1d)

    lib-mail: message_header_decode_utf8() API changed to not give return value.
    It's a rather unnecessary optimization and it wasn't even correct when the
    input wasn't valid UTF8.


M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-decode.h
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-storage/index/index-mail-headers.c

2012-06-24 19:44:22 +0300 Timo Sirainen <tss@iki.fi> (efd9d73)

    dict file: Don't ignore write failures.


M	src/lib-dict/dict-file.c

2012-06-24 19:35:11 +0300 Timo Sirainen <tss@iki.fi> (e5f5f89)

    fd_set_nonblock() API changed to i_fatal() on failure. Pretty much none of
    its users were checking if it failed, and there's really no good reason for
    it to fail anyway.


M	src/lib/fd-set-nonblock.c
M	src/lib/fd-set-nonblock.h
M	src/lib/network.c

2012-06-24 19:13:58 +0300 Timo Sirainen <tss@iki.fi> (959ce26)

    dsync: Fixed a potential error if transaction log was completely empty.


M	src/doveadm/dsync/dsync-transaction-log-scan.c

2012-06-24 19:12:26 +0300 Timo Sirainen <tss@iki.fi> (8a71f94)

    imap: CATENATE error handling fix


M	src/imap/cmd-append.c

2012-06-24 18:58:19 +0300 Timo Sirainen <tss@iki.fi> (d13a8e2)

    Avoid a NULL warning in mysql_init() when HAVE_ATTR_NULL capable compiler is
    used.


M	src/lib-sql/driver-mysql.c

2012-06-24 03:19:17 +0300 Timo Sirainen <tss@iki.fi> (bef515a)

    director: Fix to handling duplicate USER-WEAK event.


M	src/director/director-connection.c

2012-06-24 03:02:11 +0300 Timo Sirainen <tss@iki.fi> (03275b0)

    mailbox_list_index=yes: Fixed a potential crash.


M	src/lib-storage/list/mailbox-list-index-status.c

2012-06-24 03:02:11 +0300 Timo Sirainen <tss@iki.fi> (e364d03)

    mailbox_list_index=yes: Fixed a potential crash.


M	src/lib-storage/list/mailbox-list-index-status.c

2012-06-24 02:20:28 +0300 Timo Sirainen <tss@iki.fi> (3070d99)

    Fixed signed integer shift overflows. These didn't actually cause any broken
    behavior. One of these was caught by http://embed.cs.utah.edu/ioc/ and the
    rest I grepped.


M	src/director/mail-host.c
M	src/lib/primes.c
M	src/lib/utc-mktime.c

2012-06-24 00:52:57 +0300 Timo Sirainen <tss@iki.fi> (a10ed8c)

    Marked functions parameters that are allowed to be NULL. Some APIs were also
    changed. The non-obvious APIs where NULL parameter was changed to "" are
    master_service_init() and auth_master_user_list_init().

    These checks can currently be enabled only on a patched clang: 
    http://llvm.org/bugs/show_bug.cgi?id=6786

M	src/anvil/main.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-master-connection.h
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/auth-settings.h
M	src/auth/auth-stream.h
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/auth.h
M	src/auth/db-checkpassword.h
M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/db-passwd-file.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-apop.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-ntlm.c
M	src/auth/mech-otp-skey-common.c
M	src/auth/mech-plain-common.c
M	src/auth/mech-rpa.c
M	src/auth/mech-winbind.c
M	src/auth/mech.c
M	src/auth/password-scheme-otp.c
M	src/auth/password-scheme.h
M	src/auth/userdb-passwd.c
M	src/auth/userdb-static.c
M	src/auth/userdb.h
M	src/config/config-parser-private.h
M	src/config/config-request.h
M	src/config/doveconf.c
M	src/config/main.c
M	src/dict/main.c
M	src/director/director-connection.c
M	src/director/director-test.c
M	src/director/director.h
M	src/dns/dns-client.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-iter.h
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-mailbox-import.c
M	src/doveadm/dsync/dsync-slave-io.c
M	src/doveadm/main.c
M	src/imap-login/client.c
M	src/imap-login/client.h
M	src/imap/cmd-append.c
M	src/imap/cmd-expunge.c
M	src/imap/imap-client.h
M	src/imap/imap-commands-util.h
M	src/imap/imap-expunge.h
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.h
M	src/imap/imap-search.h
M	src/imap/imap-sync.c
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/ipc/client.c
M	src/ipc/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h
M	src/lib-dict/dict.h
M	src/lib-dns/dns-lookup.h
M	src/lib-imap-client/imapc-connection.h
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-parser.h
M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-util.h
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-alloc-cache.h
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-util.h
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-index.h
M	src/lib-lda/mail-deliver.h
M	src/lib-lda/smtp-client.h
M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.h
M	src/lib-mail/message-header-parser.h
M	src/lib-mail/message-parser.h
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-search.h
M	src/lib-mail/message-size.c
M	src/lib-mail/message-size.h
M	src/lib-mail/rfc822-parser.h
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-master/anvil-client.h
M	src/lib-master/ipc-client.h
M	src/lib-master/ipc-server.c
M	src/lib-master/master-service-settings-cache.h
M	src/lib-master/master-service-settings.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/lib-master/mountpoint-list.c
M	src/lib-ntlm/ntlm-encrypt.c
M	src/lib-ntlm/ntlm-encrypt.h
M	src/lib-otp/otp-parse.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.h
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-save.h
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.h
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync-changes.h
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename-flags.h
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-sync.h
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-uidlist.h
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mail-namespace.h
M	src/lib-storage/mail-search.h
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail-thread.h
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-tree.h
M	src/lib-test/test-common.h
M	src/lib/base64.h
M	src/lib/buffer.h
M	src/lib/child-wait.h
M	src/lib/eacces-error.h
M	src/lib/failures.c
M	src/lib/file-dotlock.c
M	src/lib/hash.c
M	src/lib/hash.h
M	src/lib/hash2.h
M	src/lib/ioloop-notify-fd.h
M	src/lib/ioloop.c
M	src/lib/ioloop.h
M	src/lib/iso8601-date.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-chain.c
M	src/lib/istream-chain.h
M	src/lib/istream-crlf.c
M	src/lib/istream-private.h
M	src/lib/istream-seekable.h
M	src/lib/istream.c
M	src/lib/istream.h
M	src/lib/lib-signals.c
M	src/lib/lib-signals.h
M	src/lib/macros.h
M	src/lib/mkdir-parents.c
M	src/lib/module-dir.h
M	src/lib/network.c
M	src/lib/network.h
M	src/lib/ostream-private.h
M	src/lib/ostream.c
M	src/lib/ostream.h
M	src/lib/restrict-access.h
M	src/lib/safe-mkstemp.c
M	src/lib/strfuncs.c
M	src/lib/strfuncs.h
M	src/lib/test-iso8601-date.c
M	src/lib/uri-util.c
M	src/lib/uri-util.h
M	src/lib/var-expand.h
M	src/lmtp/client.h
M	src/lmtp/lmtp-proxy.h
M	src/log/main.c
M	src/login-common/client-common-auth.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.h
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-openssl.c
M	src/master/common.h
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-plugin.h
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.h
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/squat-trie.h
M	src/plugins/fts/fts-storage.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota.c
M	src/pop3/pop3-client.h
M	src/replication/aggregator/aggregator.c
M	src/replication/replicator/replicator.c
M	src/ssl-params/main.c
M	src/stats/mail-domain.h
M	src/stats/mail-ip.h
M	src/stats/mail-session.h
M	src/stats/mail-user.h
M	src/stats/main.c

2012-06-22 21:59:01 +0300 Timo Sirainen <tss@iki.fi> (9272316)

    Makefile: Removed unnecessary code


M	doc/man/Makefile.am

2012-06-22 18:51:42 +0300 Timo Sirainen <tss@iki.fi> (4b79418)

    lib-ssl-iostream: Memory leak fixes


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c

2012-06-21 23:15:21 +0300 Timo Sirainen <tss@iki.fi> (5fdc11f)

    lib-imap: Added IMAP_RESP_CODE_UNKNOWN_CTE


M	src/imap/cmd-append.c
M	src/lib-imap/imap-resp-code.h

2012-06-21 22:56:15 +0300 Timo Sirainen <tss@iki.fi> (24107b2)

    imap: Compile fix due to recent changes


M	src/imap/cmd-fetch.c

2012-06-21 22:50:10 +0300 Timo Sirainen <tss@iki.fi> (db2ab21)

    Makefile: Removed message-binary-part.h which isn't finished yet.


M	src/lib-mail/Makefile.am

2012-06-21 21:58:48 +0300 Timo Sirainen <tss@iki.fi> (94517d9)

    imap: Removed unnecessary code.


M	src/imap/imap-fetch-body.c

2012-06-21 21:52:56 +0300 Timo Sirainen <tss@iki.fi> (6816955)

    imap: Rewrote FETCH command to use imap-msgpart API.


M	src/imap/cmd-select.c
M	src/imap/imap-client.h
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2012-06-21 21:50:35 +0300 Timo Sirainen <tss@iki.fi> (0177594)

    lib-imap-storage: imap-msgpart rewrite and API change. The new API allows
    first parsing the validity of section strings and later relying on them
    being valid without having to re-parse it. The implementation also fixes a
    few things and adds "partial fetch cache".


M	src/lib-imap-storage/Makefile.am
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h
M	src/lib-storage/mail-storage-private.h

2012-06-21 21:47:06 +0300 Timo Sirainen <tss@iki.fi> (ed82563)

    lib-imap: imap_quote() now skips any CR/LF characters from input.


M	src/lib-imap/imap-quote.c

2012-06-21 21:44:28 +0300 Timo Sirainen <tss@iki.fi> (e587908)

    lib-mail: Added istream-nonuls for converting NUL bytes to something else.


M	src/lib-mail/Makefile.am
A	src/lib-mail/istream-nonuls.c
A	src/lib-mail/istream-nonuls.h

2012-06-21 21:25:04 +0300 Timo Sirainen <tss@iki.fi> (2e7a81e)

    imap: If DELETE can't succeed because mailbox has children, don't give
    [ALREADYEXISTS] code.


M	src/imap/cmd-delete.c

2012-06-21 19:12:04 +0300 Timo Sirainen <tss@iki.fi> (0d5689d)

    quota: Don't crash at init if one of the namespaces no root dir.


M	src/plugins/quota/quota.c

2012-06-21 18:48:38 +0300 Timo Sirainen <tss@iki.fi> (e160cd1)

    imapc: Don't crash when using multiple imapc namespaces.


M	src/lib-storage/index/imapc/imapc-storage.c

2012-06-21 14:51:36 +0300 Timo Sirainen <tss@iki.fi> (bf412d6)

    lib-storage: Fixed mailbox_status.unseen count for private indexes.


M	src/lib-storage/index/index-status.c

2012-06-20 06:32:06 +0300 Timo Sirainen <tss@iki.fi> (8e364cb)

    imap MOVE: Don't commit expunge transaction before the copy transaction has
    succeeded.


M	src/imap/cmd-copy.c

2012-06-20 06:21:57 +0300 Timo Sirainen <tss@iki.fi> (d5b9f3d)

    imap parser: literal8 flag was handled in opposite way.


M	src/lib-imap/imap-parser.c

2012-06-20 06:21:17 +0300 Timo Sirainen <tss@iki.fi> (09bb145)

    imap: Implemented MOVE extension.


M	src/imap/cmd-copy.c
M	src/imap/imap-commands.c
M	src/imap/imap-commands.h

2012-06-20 06:17:40 +0300 Timo Sirainen <tss@iki.fi> (807b064)

    quota: Ignore quota when handling mailbox_move().


M	src/plugins/quota/quota-storage.c

2012-06-20 06:17:00 +0300 Timo Sirainen <tss@iki.fi> (7ada346)

    acl: Optimize failing mailbox_move() when expunge right is missing.


M	src/plugins/acl/acl-mailbox.c

2012-06-20 06:15:46 +0300 Timo Sirainen <tss@iki.fi> (02f8843)

    lib-storage: Added mailbox_move(), which is basically copy+expunge.


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2012-06-20 06:09:04 +0300 Timo Sirainen <tss@iki.fi> (2c26b19)

    istream-binary-converter: Added maximum memory usage limit for header
    parsing.


M	src/lib-mail/istream-binary-converter.c
M	src/lib-mail/test-istream-binary-converter.c

2012-06-20 05:41:54 +0300 Timo Sirainen <tss@iki.fi> (5efe153)

    imap: Fixes to handling BINARY APPENDs.


M	src/imap/cmd-append.c

2012-06-20 05:39:50 +0300 Timo Sirainen <tss@iki.fi> (961850d)

    imap: Fixed CATENATE support to send "+ OK" for literals.


M	src/imap/cmd-append.c

2012-06-20 02:45:20 +0300 Timo Sirainen <tss@iki.fi> (f5c82a8)

    imap: Implemented BINARY extension support for APPEND/CATENATE.


M	src/imap/cmd-append.c

2012-06-20 02:44:57 +0300 Timo Sirainen <tss@iki.fi> (8ae7876)

    lib-test: Fixed test istream


M	src/lib-test/test-common.c

2012-06-20 02:44:35 +0300 Timo Sirainen <tss@iki.fi> (a84bd90)

    imap parser: Added support for parsing literal8 (for BINARY extension)


M	src/lib-imap/imap-arg.h
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-parser.h

2012-06-20 02:23:42 +0300 Timo Sirainen <tss@iki.fi> (d51bdde)

    Added istream-binary-converter to convert binary MIME parts to base64.


M	src/lib-mail/Makefile.am
A	src/lib-mail/istream-binary-converter.c
A	src/lib-mail/istream-binary-converter.h
A	src/lib-mail/test-istream-binary-converter.c

2012-06-20 02:22:27 +0300 Timo Sirainen <tss@iki.fi> (46512a5)

    message parser: Added MESSAGE_PARSER_FLAG_INCLUDE_BOUNDARIES flag.


M	src/lib-mail/message-parser.c
M	src/lib-mail/message-parser.h

2012-06-20 02:21:54 +0300 Timo Sirainen <tss@iki.fi> (d6c6713)

    message parser: Fixed infinite loop when parsing a specific message.


M	src/lib-mail/message-parser.c

2012-06-20 02:21:54 +0300 Timo Sirainen <tss@iki.fi> (e078abd)

    message parser: Fixed infinite loop when parsing a specific message.


M	src/lib-mail/message-parser.c

2012-06-20 01:45:55 +0300 Timo Sirainen <tss@iki.fi> (6935756)

    message header parser: Don't skip header if header name is longer than input
    buffer. We'll instead now just return the name in smaller blocks with
    no_newline=TRUE. This allows the caller to reconstruct the exact same
    message.


M	src/lib-mail/message-header-parser.c

2012-06-20 01:40:14 +0300 Timo Sirainen <tss@iki.fi> (6cb3c4f)

    message header parser: Fixed handling very long multiline headers. If the
    header's line fit exactly to input stream's buffer so that the parser
    couldn't see the following character, it assumed that the header ended.


M	src/lib-mail/message-header-parser.c

2012-06-20 00:48:08 +0300 Timo Sirainen <tss@iki.fi> (7252810)

    message parser: Fixes to handling CRLF linefeeds. An extra CR could have
    been left to the end of a MIME part that belonged to its --boundary.


M	src/lib-mail/message-parser.c

2012-06-18 17:05:27 +0300 Timo Sirainen <tss@iki.fi> (0aa8ac8)

    fts-squat: Fixed handling multiple SEARCH parameters.


M	src/plugins/fts-squat/fts-backend-squat.c

2012-06-18 13:21:03 +0300 Timo Sirainen <tss@iki.fi> (6e9eb28)

    lib-ssl-iostream: Don't assert-crash if underlying connection suddenly
    disconnects.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/istream-openssl.c

2012-06-18 13:19:41 +0300 Timo Sirainen <tss@iki.fi> (ad45602)

    doveadm: Fixed crash with proxying some commands.


M	src/doveadm/doveadm-print.c

2012-06-16 02:06:16 +0300 Timo Sirainen <tss@iki.fi> (524c4ab)

    example-config: Refer to ssl=required in disable_plaintext_auth setting.


M	doc/example-config/conf.d/10-auth.conf

2012-06-16 02:03:53 +0300 Timo Sirainen <tss@iki.fi> (35d6ae1)

    imapc: Removed brokenly used explicit data stack frame. Fixes crashes when a
    message has more than 8 keywords.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2012-06-16 01:59:44 +0300 Timo Sirainen <tss@iki.fi> (d3034da)

    doveadm log errors: Usage text update


M	src/doveadm/doveadm-log.c

2012-06-15 23:44:53 +0300 Timo Sirainen <tss@iki.fi> (8f0c238)

    doveadm log errors: Added -s <min_timestamp> parameter


M	src/doveadm/doveadm-log.c

2012-06-15 17:12:24 +0300 Timo Sirainen <tss@iki.fi> (715ac45)

    example-config: imap_logout_format default was wrong.


M	doc/example-config/conf.d/20-imap.conf

2012-06-15 15:12:33 +0300 Timo Sirainen <tss@iki.fi> (566a436)

    maildir++ quota: If reading maildirsize fails with ESTALE, retry it.


M	src/plugins/quota/quota-maildir.c

2012-06-13 16:29:37 +0300 Timo Sirainen <tss@iki.fi> (8e895bb)

    lib-master: Fixed assert crash in some situations after updating instance
    name.


M	src/lib-master/master-instance.c

2012-06-13 15:34:39 +0300 Timo Sirainen <tss@iki.fi> (b3d5b74)

    master: If service_count=1 and process_limit=1 and >1 clients connect, log
    about service_count being why.


M	src/master/service-monitor.c

2012-06-11 23:38:45 +0300 Timo Sirainen <tss@iki.fi> (6e151be)

    shared mailboxes: Avoid doing "@domain" userdb lookups.


M	src/lib-storage/index/shared/shared-list.c

2012-06-11 18:22:06 +0300 Timo Sirainen <tss@iki.fi> (5da1aa5)

    shared mailboxes: Per-user flags can now be stored in private index files.
    This can be enabled by adding e.g.:

    mail_location = mdbox:/var/shared/mdbox:INDEXPVT=~/mdbox/shared

M	src/doveadm/doveadm-dump-log.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log.h
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync-private.h
A	src/lib-storage/index/index-sync-pvt.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2012-06-11 16:54:14 +0300 Timo Sirainen <tss@iki.fi> (c88275b)

    director: Fixed working as standalone.


M	src/director/director.c

2012-06-11 16:30:58 +0300 Timo Sirainen <tss@iki.fi> (c37d807)

    lib-master: -i parameter shouldn't imply -k parameter. This was added
    accidentally when writing the code.


M	src/lib-master/master-service.c

2012-06-11 16:14:13 +0300 Timo Sirainen <tss@iki.fi> (c6b3433)

    lib-charset: Make sure convert_to_utf8*() never returns non-UTF8 output.


M	src/lib-charset/charset-iconv.c

2012-06-05 00:34:32 +0300 Timo Sirainen <tss@iki.fi> (0bf95c4)

    Makefile: Added more missing dsync*.h files


M	src/doveadm/dsync/Makefile.am

2012-06-04 23:33:40 +0300 Timo Sirainen <tss@iki.fi> (8f7ac4c)

    Makefile: Added missing dsync-mail.h


M	src/doveadm/dsync/Makefile.am

2012-06-04 22:15:46 +0300 Timo Sirainen <tss@iki.fi> (9228135)

    Makefile: Added missing dsync-mailbox.h


M	src/doveadm/dsync/Makefile.am

2012-06-04 21:58:00 +0300 Timo Sirainen <tss@iki.fi> (06af65f)

    doveadm config: If -c parameter was given, it wasn't passed to doveconf.


M	src/doveadm/doveadm.c

2012-06-04 21:21:52 +0300 Timo Sirainen <tss@iki.fi> (6ea1de1)

    doveadm instance list: Added -c parameter to easily get the instance's
    config path.


M	src/doveadm/doveadm-instance.c

2012-06-04 21:21:28 +0300 Timo Sirainen <tss@iki.fi> (bf9fd72)

    lib-master: Keep track of config paths in "instances" file. Normally it can
    be looked up from base_dir/dovecot.conf symlink, but base_dir may get
    deleted when system starts up.


M	src/lib-master/master-instance.c
M	src/lib-master/master-instance.h

2012-06-04 17:23:07 +0300 Timo Sirainen <tss@iki.fi> (1c7d885)

    doveadm instance list: Added optional name parameter to list only specified
    instance.


M	src/doveadm/doveadm-instance.c

2012-06-04 14:03:47 +0300 Timo Sirainen <tss@iki.fi> (ddedc8b)

    mdbox: Flush/fsync newly saved mail data before locking map. This reduced
    the amount of time the map needs to be locked.


M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-map.h
M	src/lib-storage/index/dbox-multi/mdbox-save.c

2012-06-04 13:59:40 +0300 Timo Sirainen <tss@iki.fi> (b5e998a)

    mdbox: Make sure map transaction won't succeed after
    mdbox_map_atomic_set_failed()


M	src/lib-storage/index/dbox-multi/mdbox-map-private.h
M	src/lib-storage/index/dbox-multi/mdbox-map.c

2012-06-02 19:39:27 +0300 Timo Sirainen <tss@iki.fi> (57b3896)

    imap: Code cleanup and error handling fixes for CATENATE


M	src/imap/cmd-append.c

2012-06-02 19:01:25 +0300 Timo Sirainen <tss@iki.fi> (639bb36)

    Error handling API changes to previous IMAP URL related changes.


M	src/imap/cmd-append.c
M	src/lib-imap-storage/imap-msgpart-url.c
M	src/lib-imap-storage/imap-msgpart-url.h
M	src/lib-imap-storage/imap-msgpart.c
M	src/lib-imap-storage/imap-msgpart.h
M	src/lib-imap/imap-url.c
M	src/lib-imap/imap-url.h
M	src/lib-imap/test-imap-url.c
M	src/lib/uri-util.c
M	src/lib/uri-util.h

2012-06-02 18:15:46 +0300 Stephan Bosch <stephan@rename-it.nl> (e438c85)

    Adds 'anonymous' field to struct mail_user; derived indirectly from userdb
    extra fields.

    Depends: none

M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.h

2012-06-02 18:14:16 +0300 Stephan Bosch <stephan@rename-it.nl> (9f9063b)

    imap: Implemented CATENATE extension.


M	README
M	configure.in
M	src/imap/cmd-append.c

2012-06-02 17:56:27 +0300 Stephan Bosch <stephan@rename-it.nl> (c502126)

    Created lib-imap-storage for IMAP-specific functionality that uses
    lib-storage. This is done to prevent introducing dependencies on lib-storage
    in lib-imap. It contains IMAP message part access functionality, including
    URL-based access.


M	configure.in
M	src/Makefile.am
M	src/imap/Makefile.am
M	src/imap/imap-fetch-body.c
A	src/lib-imap-storage/Makefile.am
A	src/lib-imap-storage/imap-msgpart-url.c
A	src/lib-imap-storage/imap-msgpart-url.h
A	src/lib-imap-storage/imap-msgpart.c
A	src/lib-imap-storage/imap-msgpart.h
M	src/lib-storage/Makefile.am

2012-06-02 17:53:31 +0300 Stephan Bosch <stephan@rename-it.nl> (6ae6496)

    lib-imap: Added IMAP URL parser.

    Includes support for IMAP URLAUTH URLs.

    Includes extensive testsuite.

    Creation of IMAP URL string from struct data is not implemented and deferred
    to a future patch when this functionality is needed.

M	src/lib-imap/Makefile.am
A	src/lib-imap/imap-url.c
A	src/lib-imap/imap-url.h
A	src/lib-imap/test-imap-url.c

2012-06-02 17:15:18 +0300 Stephan Bosch <stephan@rename-it.nl> (7afab1f)

    imap-parser: Added IMAP_PARSE_FLAG_INSIDE_LIST flag. Adds mode flag to IMAP
    parser which makes it assume it is inside a (...) list, making ')' equal to
    EOL and '\n' an error.


M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-parser.h

2012-06-02 17:12:06 +0300 Stephan Bosch <stephan@rename-it.nl> (0fe2992)

    Added chain istream. This is a nephew of the concat stream with the
    difference that new child streams can be added dynamically.


M	src/lib/Makefile.am
A	src/lib/istream-chain.c
A	src/lib/istream-chain.h

2012-06-02 17:06:21 +0300 Stephan Bosch <stephan@rename-it.nl> (8fe8f97)

    liblib: Added generic URI parsing functions.


M	src/lib/Makefile.am
A	src/lib/uri-util.c
A	src/lib/uri-util.h

2012-06-02 16:55:21 +0300 Stephan Bosch <stephan@rename-it.nl> (5fb662c)

    Adds ISO8601/RFC3339 date format parsing and construction support.

    Interface is somewhat based on message date parser in src/lib-mail, but it 
    also provides access to struct tm.

M	src/lib/Makefile.am
A	src/lib/iso8601-date.c
A	src/lib/iso8601-date.h
A	src/lib/test-iso8601-date.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2012-05-29 22:22:14 +0300 Timo Sirainen <tss@iki.fi> (c33807e)

    Added signature for changeset c92fb8b928f6


M	.hgsigs

2012-05-29 22:22:10 +0300 Timo Sirainen <tss@iki.fi> (02abbed)

    Added tag 2.1.7 for changeset c92fb8b928f6


M	.hgtags

2012-05-29 22:22:10 +0300 Timo Sirainen <tss@iki.fi> (b9969cf)

    Released v2.1.7.


M	NEWS
M	configure.in

2012-05-29 20:51:14 +0300 Timo Sirainen <tss@iki.fi> (f6b77c2)

    mdbox: Fixed assert-crash with index rebuild when using ns prefix and mail
    wasn't originally in INBOX.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2012-05-29 18:38:01 +0300 Timo Sirainen <tss@iki.fi> (750a396)

    Fixed assert-crash on some situations when user had no supplementary groups.


M	src/lib/restrict-access.c

2012-05-23 00:24:06 +0300 Timo Sirainen <tss@iki.fi> (2157a1b)

    lib-storage: Verify that with SEARCH HEADER the header name is valid UTF-8.


M	src/lib-storage/mail-search-register-imap.c

2012-05-22 23:19:16 +0300 Timo Sirainen <tss@iki.fi> (bc5d21b)

    TODO updated


M	TODO

2012-05-22 23:17:31 +0300 Timo Sirainen <tss@iki.fi> (7bd5b1c)

    Initial version of dsync rewrite.  * doveadm backup not implemented at all
    yet  * syncing mailbox renames is somewhat broken (at least renaming
    \noselect    mailboxes)  * saving/restoring "state" is implemented by dsync
    brain, but not by    doveadm. this should be easy to do, just need to figure
    out how the    replication code wants it.


M	src/doveadm/doveadm-settings.c
M	src/doveadm/dsync/Makefile.am
M	src/doveadm/dsync/doveadm-dsync.c
A	src/doveadm/dsync/dsync-brain-mailbox-tree-sync.c
A	src/doveadm/dsync/dsync-brain-mailbox-tree.c
A	src/doveadm/dsync/dsync-brain-mailbox.c
A	src/doveadm/dsync/dsync-brain-mails.c
D	src/doveadm/dsync/dsync-brain-msgs-new.c
D	src/doveadm/dsync/dsync-brain-msgs.c
M	src/doveadm/dsync/dsync-brain-private.h
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-brain.h
D	src/doveadm/dsync/dsync-data.c
D	src/doveadm/dsync/dsync-data.h
A	src/doveadm/dsync/dsync-deserializer.c
A	src/doveadm/dsync/dsync-deserializer.h
A	src/doveadm/dsync/dsync-mail.c
A	src/doveadm/dsync/dsync-mail.h
A	src/doveadm/dsync/dsync-mailbox-export.c
A	src/doveadm/dsync/dsync-mailbox-export.h
A	src/doveadm/dsync/dsync-mailbox-import.c
A	src/doveadm/dsync/dsync-mailbox-import.h
A	src/doveadm/dsync/dsync-mailbox-state-export.h
A	src/doveadm/dsync/dsync-mailbox-state.c
A	src/doveadm/dsync/dsync-mailbox-state.h
A	src/doveadm/dsync/dsync-mailbox-tree-fill.c
A	src/doveadm/dsync/dsync-mailbox-tree-private.h
A	src/doveadm/dsync/dsync-mailbox-tree-sync.c
A	src/doveadm/dsync/dsync-mailbox-tree.c
A	src/doveadm/dsync/dsync-mailbox-tree.h
A	src/doveadm/dsync/dsync-mailbox.h
D	src/doveadm/dsync/dsync-proxy-client.c
D	src/doveadm/dsync/dsync-proxy-server-cmd.c
D	src/doveadm/dsync/dsync-proxy-server.c
D	src/doveadm/dsync/dsync-proxy-server.h
D	src/doveadm/dsync/dsync-proxy.c
D	src/doveadm/dsync/dsync-proxy.h
A	src/doveadm/dsync/dsync-serializer.c
A	src/doveadm/dsync/dsync-serializer.h
A	src/doveadm/dsync/dsync-slave-io.c
A	src/doveadm/dsync/dsync-slave-pipe.c
A	src/doveadm/dsync/dsync-slave-private.h
A	src/doveadm/dsync/dsync-slave.c
A	src/doveadm/dsync/dsync-slave.h
A	src/doveadm/dsync/dsync-transaction-log-scan.c
A	src/doveadm/dsync/dsync-transaction-log-scan.h
D	src/doveadm/dsync/dsync-worker-local.c
D	src/doveadm/dsync/dsync-worker-private.h
D	src/doveadm/dsync/dsync-worker.c
D	src/doveadm/dsync/dsync-worker.h
D	src/doveadm/dsync/test-dsync-brain-msgs.c
D	src/doveadm/dsync/test-dsync-brain.c
D	src/doveadm/dsync/test-dsync-common.c
D	src/doveadm/dsync/test-dsync-common.h
D	src/doveadm/dsync/test-dsync-proxy-server-cmd.c
D	src/doveadm/dsync/test-dsync-proxy.c
D	src/doveadm/dsync/test-dsync-worker.c
D	src/doveadm/dsync/test-dsync-worker.h

2012-05-20 03:08:01 +0300 Timo Sirainen <tss@iki.fi> (9a656df)

    director: When we find unwanted connection, wait for 10s for it to
    disconnect us, not 10ms.


M	src/director/director-connection.c

2012-05-20 02:41:08 +0300 Timo Sirainen <tss@iki.fi> (2b4e112)

    lib-master: Anvil reconnect timeout should be 5 seconds, not 5 milliseconds.


M	src/lib-master/anvil-client.c

2012-05-19 22:25:27 +0300 Timo Sirainen <tss@iki.fi> (a6fbd1f)

    auth: Fixed crash with DIGEST-MD5 when attempting to do master user login
    without master passdbs.


M	src/auth/auth-request.c

2012-05-19 22:11:41 +0300 Timo Sirainen <tss@iki.fi> (3e7565a)

    expire: Handle dict errors. Don't crash if lookup fails. Based on patch by
    Michal Grzedzicki


M	src/plugins/expire/expire-plugin.c

2012-05-19 21:18:04 +0300 Timo Sirainen <tss@iki.fi> (e4194f4)

    director: Implemented ability to remove directors from a running ring. Also
    added doveadm command for adding a new director to a running ring.


M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-host.h
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/main.c
M	src/doveadm/doveadm-director.c

2012-05-19 21:16:42 +0300 Timo Sirainen <tss@iki.fi> (93cc8cf)

    director: Don't crash with quickly disconnecting incoming director
    connections.


M	src/director/director-connection.c

2012-05-19 18:43:13 +0300 Timo Sirainen <tss@iki.fi> (c56500d)

    lib-storage: If chroot is used and mail_debug=yes, log the chroot path.


M	src/lib-storage/mail-storage-service.c

2012-05-17 18:08:58 +0300 Timo Sirainen <tss@iki.fi> (0b27cde)

    update-version.sh: Use mv -f to avoid questions in some systems.


M	update-version.sh

2012-05-16 18:57:05 +0300 Timo Sirainen <tss@iki.fi> (2b58181)

    sdbox: Avoid using too many fds when copying messages. This happened at
    least with quota plugin.


M	src/lib-storage/index/dbox-single/sdbox-save.c

2012-05-16 16:14:31 +0300 Timo Sirainen <tss@iki.fi> (ca843e0)

    login: If user is disabled or password expired, say it in logout reason.


M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h

2012-05-16 16:14:01 +0300 Timo Sirainen <tss@iki.fi> (190d84a)

    auth: If user is disabled or password expired, tell about it to auth-client.


M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h

2012-05-15 18:52:41 +0300 Timo Sirainen <tss@iki.fi> (14e4afa)

    mdbox: mailbox_update() didn't look at the latest index data. So setting
    min_next_uid, min_first_recent_uid or min_highest_modseq may have actually
    shrank them.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2012-05-14 21:07:43 +0300 Timo Sirainen <tss@iki.fi> (bc21bdf)

    pop3: Added pop3_uidl_duplicates setting.


M	doc/example-config/conf.d/20-pop3.conf
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/pop3/pop3-settings.h

2012-05-14 19:30:03 +0300 Timo Sirainen <tss@iki.fi> (7783bfe)

    ldap: If attributes contain ldapAttr=key=template%$ and ldapAttr doesn't
    exist, skip the field. This makes it work again the same as with v2.0.


M	src/auth/db-ldap.c

2012-05-14 19:01:46 +0300 Timo Sirainen <tss@iki.fi> (a0b92d4)

    maildir: If dovecot-uidlist can't be opened as read-write, try opening as
    read-only.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2012-05-14 18:42:58 +0300 Timo Sirainen <tss@iki.fi> (5f99c6a)

    master: Fix to systemd support Patch by Joop Boonen


M	src/master/service-listen.c

2012-05-14 18:09:10 +0300 Timo Sirainen <tss@iki.fi> (aba6eb2)

    lib-master: Added more default ignore prefixes


M	src/lib-master/mountpoint-list.c

2012-05-10 11:26:53 +0300 Timo Sirainen <tss@iki.fi> (c518217)

    imapc: Use imapc_list_prefix also for listing subscriptions


M	src/lib-storage/index/imapc/imapc-list.c

2012-05-09 15:01:20 +0300 Timo Sirainen <tss@iki.fi> (33b0d86)

    master: systemd socket verification wasn't actually being called normally.


M	src/master/service-listen.c

2012-05-09 06:11:58 +0300 Timo Sirainen <tss@iki.fi> (d81131d)

    lib-storage: Added a mailbox.synced flag, which is set when mailbox sync has
    succeeded.


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2012-05-09 04:41:47 +0300 Timo Sirainen <tss@iki.fi> (458752f)

    lib-storage: mailbox_list_get_storage_name/_get_vname() are now public.


M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.h

2012-05-08 08:49:47 +0300 Timo Sirainen <tss@iki.fi> (f0dd98b)

    Compiler warning fixes


M	src/lib/test-bsearch-insert-pos.c

2012-05-08 08:31:27 +0300 Timo Sirainen <tss@iki.fi> (5e114f5)

    Compiler warning fixes


M	src/auth/db-checkpassword.c
M	src/auth/db-checkpassword.h
M	src/auth/passdb-checkpassword.c
M	src/auth/userdb-checkpassword.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib/test-array.c
M	src/lib/test-base64.c

2012-05-08 01:24:01 +0300 Timo Sirainen <tss@iki.fi> (21c7e5b)

    lib-storage: Extra check to mail_shared_explicit_inbox=no


M	src/lib-storage/mailbox-list.c

2012-05-08 01:22:32 +0300 Timo Sirainen <tss@iki.fi> (00a3196)

    layout=fs: Fixes to mail_shared_explicit_inbox=no


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-05-07 23:39:34 +0300 Timo Sirainen <tss@iki.fi> (45529d3)

    lib-storage: Don't auto-drop namespaces with only INBOX shared and
    mail_shared_explicit_inbox=no


M	src/lib-storage/mail-storage.c

2012-05-07 23:39:01 +0300 Timo Sirainen <tss@iki.fi> (abf49ed)

    acl: Fixed listing users who have only INBOX shared and
    mail_shared_explicit_inbox=no


M	src/plugins/acl/acl-shared-storage.c

2012-05-07 08:36:54 +0300 Timo Sirainen <tss@iki.fi> (6649f0e)

    Added signature for changeset 7c249e2a82a9


M	.hgsigs

2012-05-07 08:36:43 +0300 Timo Sirainen <tss@iki.fi> (571fd5f)

    Added tag 2.1.6 for changeset 7c249e2a82a9


M	.hgtags

2012-05-07 08:36:43 +0300 Timo Sirainen <tss@iki.fi> (1db226c)

    Released v2.1.6.


M	NEWS
M	configure.in

2012-05-07 04:06:49 +0300 Timo Sirainen <tss@iki.fi> (9242477)

    Makefile: Remove dovecot-config on make uninstall


M	Makefile.am

2012-05-06 06:44:04 +0300 Timo Sirainen <tss@iki.fi> (593d271)

    auth: Previous change caused crashing with userdb lookups


M	src/auth/auth-request.c

2012-05-05 00:01:32 +0300 Timo Sirainen <tss@iki.fi> (6a2e678)

    auth: Added %{session} variable for passdb/userdb queries.


M	src/auth/auth-request.c

2012-05-04 23:56:51 +0300 Timo Sirainen <tss@iki.fi> (9e7eb7b)

    acl: Memory leak fixes


M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-cache.c

2012-05-04 23:50:22 +0300 Timo Sirainen <tss@iki.fi> (6b3f3a6)

    mail-log: Memory leak fix


M	src/plugins/mail-log/mail-log-plugin.c

2012-05-04 22:55:29 +0300 Timo Sirainen <tss@iki.fi> (3999353)

    shared mailboxes: If successful userdb lookup doesn't return home, fallback
    to mail_home setting for %%h.


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-user.c

2012-05-04 21:52:05 +0300 Timo Sirainen <tss@iki.fi> (b5cbeb1)

    systemd: If a socket is enabled in systemd but not in Dovecot config, close
    it. Based on patch by Michal Hlavinka.


M	src/master/service-listen.c

2012-05-04 21:40:57 +0300 Timo Sirainen <tss@iki.fi> (0bd2599)

    Added mail_shared_explicit_inbox setting.


M	doc/example-config/conf.d/10-mail.conf
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mailbox-list.c

2012-05-04 20:14:20 +0300 Timo Sirainen <tss@iki.fi> (1f85b15)

    dbox: Metadata read buffer's size was supposed to be unlimited, not zero.
    This was broken by 59f5238c6e61, which itself had fixed another bug.


M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c

2012-05-04 20:07:05 +0300 Timo Sirainen <tss@iki.fi> (880ac25)

    doveadm mailbox mutf7: If input data is invalid, exit with EX_DATAERR.


M	src/doveadm/doveadm-mutf7.c

2012-05-04 19:01:46 +0300 Timo Sirainen <tss@iki.fi> (ac8693e)

    mail-log: Removed broken "are we saving?" check from copy event handling.


M	src/plugins/mail-log/mail-log-plugin.c

2012-05-04 19:01:19 +0300 Timo Sirainen <tss@iki.fi> (2c7cde7)

    notify plugin: mailbox_save_using_mail() now sends "save" events, not
    "copy".


M	src/plugins/notify/notify-storage.c

2012-05-04 19:00:04 +0300 Timo Sirainen <tss@iki.fi> (d98c49c)

    lib-storage: Don't set mail_save_context->saving=TRUE when copying via save.


M	src/lib-storage/mail-storage.c

2012-05-04 05:35:36 +0300 Timo Sirainen <tss@iki.fi> (068da0f)

    lib-storage: Added MAILBOX_TRANSACTION_FLAG_SYNC flag


M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage.h

2012-05-22 17:10:20 +0300 Timo Sirainen <tss@iki.fi> (77df9a1)

    dbox: Don't reset index when mailbox_update() changes UIDVALIDITY.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c

2012-05-03 23:26:44 +0300 Timo Sirainen <tss@iki.fi> (515f814)

    lib-index: Fixed MAIL_INDEX_SYNC_FLAG_AVOID_FLAG_UPDATES with concurrent
    keyword changes. If session 1 saw keywords="a", session 2 added keyword "b"
    and session 1 (without the client syncing session) replaced flags with "a",
    the "b" keyword wasn't removed.


M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/test-mail-index-transaction-update.c

2012-05-03 21:46:07 +0300 Timo Sirainen <tss@iki.fi> (e169102)

    Added MAIL_INDEX_TRANSACTION_FLAG_SYNC


M	src/doveadm/doveadm-dump-log.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log.h
M	src/lib-index/test-mail-transaction-log-append.c

2012-05-22 17:03:20 +0300 Timo Sirainen <tss@iki.fi> (250105a)

    Don't write "keyword reset" records to transaction log anymore. These are a
    bit problematic for dsync's keyword merging to handle.


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index.h
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync.c
M	src/plugins/virtual/virtual-sync.c

2012-05-22 16:54:55 +0300 Timo Sirainen <tss@iki.fi> (6d3bb84)

    lib-index: Added mail_transaction_log_view_set_all()


M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.h

2012-05-22 16:54:43 +0300 Timo Sirainen <tss@iki.fi> (a1a0b9b)

    lib-index: Don't log an error if UIDVALIDITY changes. Normally this should
    be done by backend only by resetting the index, but it can be done also by
    dsync.


M	src/lib-index/mail-index-sync-update.c

2012-05-20 03:32:55 +0300 Timo Sirainen <tss@iki.fi> (4b33578)

    Use timeout_add_short() for sub-second timeouts. Fail at compile time if
    timeout_add() is <1s. In future timeout_add() could perhaps also be made
    less precise, so that it would try to group timeouts to run around at the
    same time.


M	src/auth/auth-request-handler.c
M	src/director/director-test.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib/ioloop.c
M	src/lib/ioloop.h
M	src/plugins/fts/fts-indexer.c
M	src/plugins/replication/replication-plugin.c

2012-05-20 03:25:04 +0300 Timo Sirainen <tss@iki.fi> (ed16ab5)

    Merged changes from v2.1 tree.


2012-05-19 22:40:08 +0300 Timo Sirainen <tss@iki.fi> (044a088)

    Extends struct net_unix_cred with pid field and modifies net_getunixcred()
    to fill it in if possible.

    Depends: none

M	configure.in
M	src/lib/network.c
M	src/lib/network.h

2012-05-19 22:28:19 +0300 Timo Sirainen <tss@iki.fi> (50a1b44)

    lib-storage: Sort userdb fields before importing them. This avoids requiring
    manual sorting in some situations, such as when defining new namespaces.


M	src/lib-storage/mail-storage-service.c

2012-05-04 00:48:45 +0300 Timo Sirainen <tss@iki.fi> (d5498f4)

    lib-index: Removed unused locking code.


M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.c

2012-05-04 00:41:51 +0300 Timo Sirainen <tss@iki.fi> (d7c8280)

    lib-index: Updated dovecot.index file only by recreating it, never write to
    it directly. This is safer, and nowadays there shouldn't be much of a
    performance loss with it either, since dovecot.index isn't updated very
    often.

    This also allows removing all locking from dovecot.index file, although for 
    now we'll keep it in case old Dovecot versions are simultaneously writing to 
    the index.

M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-private.h
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/test-mail-index-sync-ext.c

2012-04-27 16:47:30 +0900 SATOH Fumiyasu <fumiyas@osstech.co.jp> (7ba3065)

    Fix the build failure on AIX


M	src/lib-storage/index/index-search-private.h
M	src/plugins/stats/stats-plugin.h

2012-05-01 03:15:46 +0300 Timo Sirainen <tss@iki.fi> (e4cb3bf)

    lib-storage: shared/$user/INBOX is now visible only as shared/$user


M	src/lib-storage/mailbox-list.c

2012-05-01 03:01:49 +0300 Timo Sirainen <tss@iki.fi> (82dee68)

    aqueue: Reversed recent changes, they didn't work as intended.


M	src/lib/aqueue.c

2012-04-30 23:04:08 +0300 Timo Sirainen <tss@iki.fi> (1cd4894)

    Increased initial memory pool size.


M	src/lib-storage/index/index-status.c

2012-04-30 22:53:19 +0300 Timo Sirainen <tss@iki.fi> (d06d666)

    seq_range_array_add(): Ranges weren't always merged when they could have.
    This didn't break anything, but it used up more memory than necessary.


M	src/lib/seq-range-array.c
M	src/lib/test-seq-range-array.c

2012-04-28 18:24:24 +0300 Timo Sirainen <tss@iki.fi> (0f819b4)

    Code cleanup: Use array_count_i() to calculate array's size internally.


M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/array.h

2012-04-28 17:41:14 +0300 Timo Sirainen <tss@iki.fi> (f016dec)

    auth: Include session ID in log line prefix.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h
M	src/login-common/login-settings.c
M	src/login-common/sasl-server.c

2012-04-28 17:33:34 +0300 Timo Sirainen <tss@iki.fi> (d938e9e)

    lib-storage: Allocate MAILBOX_METADATA_CACHE_FIELDS from a new metadata
    mempool.


M	src/lib-storage/index/index-status.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2012-04-26 00:26:58 +0300 Timo Sirainen <tss@iki.fi> (6a764a4)

    acl: Fixed looking up parent mailbox name with different namespace vs.
    layout separators.


M	src/plugins/acl/acl-backend-vfile.c

2012-04-25 23:44:32 +0300 Timo Sirainen <tss@iki.fi> (08a33e7)

    lib-storage: Fixed expanding path that ends with "~/" For example
    mail_location=maildir:~/ would actually try to create '~' directory.


M	src/lib-storage/mail-user.c

2012-04-25 23:34:29 +0300 Timo Sirainen <tss@iki.fi> (3d0cb8d)

    passdb static: Don't crash if password/nopassword isn't set.


M	src/auth/passdb-static.c

2012-04-25 22:28:03 +0300 Timo Sirainen <tss@iki.fi> (c77b85e)

    *-login: Added ssl_require_crl setting.


M	doc/example-config/conf.d/10-ssl.conf
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h
M	src/login-common/ssl-proxy-openssl.c

2012-04-25 22:12:26 +0300 Timo Sirainen <tss@iki.fi> (d4f78a9)

    stats plugin: Open /proc/self/io only once, reopening is unnecessary.


M	src/plugins/stats/stats-plugin.c

2012-04-25 21:32:00 +0300 Timo Sirainen <tss@iki.fi> (e7dd506)

    SSL proxying: Remote's host never matched cert, because auth process changed
    it to IP. Now the "host" parameter isn't changed, but a new optional
    "hostip" parameter contains the IP address where to connect to.


M	src/auth/auth-request.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h
M	src/login-common/login-proxy.c
M	src/login-common/login-proxy.h

2012-04-25 21:29:14 +0300 Timo Sirainen <tss@iki.fi> (4bfb75b)

    *-login: Don't fail client's certificate if CRL is expired. This seems to be
    returned also when there is no CRL..


M	src/login-common/ssl-proxy-openssl.c

2012-04-25 21:28:16 +0300 Timo Sirainen <tss@iki.fi> (be2e4a1)

    *-login: If client certificate isn't valid, log the reason why.


M	src/login-common/login-proxy.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/login-common/ssl-proxy.h

2012-04-25 21:26:25 +0300 Timo Sirainen <tss@iki.fi> (fee4ec4)

    auth: Fixed handling multiple passdbs where some use proxying and others
    don't.


M	src/auth/auth-request.c

2012-04-25 21:23:24 +0300 Timo Sirainen <tss@iki.fi> (aefe174)

    auth: Minor code cleanup.


M	src/auth/auth-request-handler.c

2012-04-25 16:44:22 +0300 Timo Sirainen <tss@iki.fi> (b3a3a66)

    imapc: List INBOX for inbox=yes namespace even imapc_list_prefix is set.


M	src/lib-storage/index/imapc/imapc-list.c

2012-04-25 16:44:00 +0300 Timo Sirainen <tss@iki.fi> (5d00382)

    lib-storage: Make sure both MAILBOX_CHILDREN and MAILBOX_NOCHILDREN flags
    aren't set.


M	src/lib-storage/mailbox-list-iter.c

2012-04-25 16:29:22 +0300 Timo Sirainen <tss@iki.fi> (ca87e89)

    dsync: Treat \Nonexistent mailboxes the same as \Noselect mailboxes.


M	src/doveadm/dsync/dsync-worker-local.c

2012-04-25 02:48:36 +0300 Timo Sirainen <tss@iki.fi> (20bd39d)

    lib-ssl-iostream: Fixed a memory leak when verifying certificate name. This
    mainly mattered when proxying with SSL to remote server.


M	src/lib-ssl-iostream/iostream-openssl.c

2012-04-24 21:12:36 +0300 Timo Sirainen <tss@iki.fi> (12224fc)

    doveadm expunge -d: If mailbox is deleted, unsubscribe it also


M	src/doveadm/doveadm-mail-expunge.c

2012-04-24 21:09:25 +0300 Timo Sirainen <tss@iki.fi> (99cf4c4)

    trash plugin: Fixed behavior when quota is already over limit.


M	src/plugins/trash/trash-plugin.c

2012-04-24 21:03:19 +0300 Timo Sirainen <tss@iki.fi> (269370f)

    quota: Set to quota transaction how many bytes/messages we're over quota.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2012-04-23 17:59:39 +0300 Timo Sirainen <tss@iki.fi> (3f506d4)

    imapc: Fixed imapc_list_prefix setting to work with INBOX.


M	src/lib-storage/index/imapc/imapc-list.c

2012-04-23 16:35:41 +0300 Timo Sirainen <tss@iki.fi> (9c5e665)

    Added signature for changeset 469cee314d9c


M	.hgsigs

2012-04-23 16:35:37 +0300 Timo Sirainen <tss@iki.fi> (e01fbf3)

    Added tag 2.1.5 for changeset 469cee314d9c


M	.hgtags

2012-04-23 16:35:37 +0300 Timo Sirainen <tss@iki.fi> (e2a6a21)

    Released v2.1.5.


M	NEWS
M	TODO
M	configure.in

2012-04-23 16:18:36 +0300 Timo Sirainen <tss@iki.fi> (89b3a2a)

    Make static analyzer happier.


M	src/lib/test-strfuncs.c

2012-04-23 14:50:30 +0300 Timo Sirainen <tss@iki.fi> (37a3ae1)

    lib-index: Added mail_index_have_modseq_tracking() needed for previous
    commit.


M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-modseq.h

2012-04-23 14:47:13 +0300 Timo Sirainen <tss@iki.fi> (9ffa510)

    imap: While modseq tracking hasn't been enabled, return mailbox as NOMODSEQ.
    It would be possible to avoid this by always keeping track of highestmodseq,
    but that requires changing the index format a bit.


M	src/lib-storage/index/index-status.c

2012-04-23 14:11:37 +0300 Timo Sirainen <tss@iki.fi> (8f70c97)

    listescape: Don't unescape namespace prefix.


M	src/lib-storage/mailbox-list.c

2012-04-23 13:19:44 +0300 Timo Sirainen <tss@iki.fi> (87b71ff)

    quota: Recalculation now also counts the namespace prefix mailbox's quota if
    it exists.


M	src/plugins/quota/quota-count.c

2012-04-23 12:58:42 +0300 Timo Sirainen <tss@iki.fi> (9908c7e)

    imapc: Don't list mailboxes that don't match list patterns.


M	src/lib-storage/index/imapc/imapc-list.c

2012-04-23 12:52:59 +0300 Timo Sirainen <tss@iki.fi> (51b9807)

    imapc: Nonexistent mailboxes were returned as selectable mailboxes.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-tree.h

2012-04-20 22:27:01 +0300 Timo Sirainen <tss@iki.fi> (b088225)

    imapc: Added imapc_list_prefix setting to limit what mailboxes are accessed.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h

2012-04-20 19:09:55 +0300 Timo Sirainen <tss@iki.fi> (6cb8e7d)

    director: Delay disconnecting director after sending CONNECT command. The
    director may not otherwise read the CONNECT.


M	src/director/director-connection.c

2012-04-20 19:08:25 +0300 Timo Sirainen <tss@iki.fi> (c9b08dc)

    director: Forward DIRECTOR commands to other connected directors. They can
    use it to realize that the director was restarted and its sequences start
    from 1.


M	src/director/director-connection.c

2012-04-20 19:05:38 +0300 Timo Sirainen <tss@iki.fi> (89d6cd6)

    director: Try harder to connect to ring before thinking we're alone.


M	src/director/director.c
M	src/director/director.h

2012-04-20 19:03:26 +0300 Timo Sirainen <tss@iki.fi> (002f254)

    director: Director ring needs to be set unsynced immediately even when
    sycning is frozen.


M	src/director/director.c

2012-04-20 15:26:43 +0300 Timo Sirainen <tss@iki.fi> (e7f4a8b)

    layout=fs: Fixed listing mailboxes with prefix=INBOX/


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-04-20 15:18:14 +0300 Timo Sirainen <tss@iki.fi> (bfb5618)

    layout=fs: Don't assume '/' hierarchy separator when finding mailbox roots.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-04-20 15:04:58 +0300 Timo Sirainen <tss@iki.fi> (980529d)

    director: When another director reconnects, reset its "last received seq".
    This fixes some problems where HOST updates and others were thought as
    already being received after the originating director was restarted.


M	src/director/director-connection.c

2012-04-20 11:22:26 +0300 Timo Sirainen <tss@iki.fi> (32a9332)

    director: Removed special (time_t)-1 code, it's not actually needed. Also
    this fixes a user refreshing issue.


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c
M	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2012-04-20 11:09:36 +0300 Timo Sirainen <tss@iki.fi> (b37fabe)

    director: Minor error message fix


M	src/director/director-connection.c

2012-04-20 01:35:06 +0300 Timo Sirainen <tss@iki.fi> (f45e509)

    director: And crashfix for previous change..


M	src/director/director-connection.c

2012-04-20 01:32:01 +0300 Timo Sirainen <tss@iki.fi> (a702165)

    director: Adding 25c941423e42 patch yet again, now it seems to work right.
    And also fixes detection of outgoing connections that die during handshake
    sending.


M	src/director/director-connection.c

2012-04-20 01:14:41 +0300 Timo Sirainen <tss@iki.fi> (5a5b39c)

    director: USER sending timeout was higher than it needed to be. The problem
    was USER sending getting stuck, not the timeout itself..


M	src/director/director-connection.c

2012-04-20 00:59:01 +0300 Timo Sirainen <tss@iki.fi> (484324f)

    director: Removed unnecessary error messages.


M	src/director/director-connection.c

2012-04-20 00:49:29 +0300 Timo Sirainen <tss@iki.fi> (f37684a)

    director: Another fix for stuck handshake.


M	src/director/director-connection.c

2012-04-20 00:42:10 +0300 Timo Sirainen <tss@iki.fi> (b695e47)

    director: Make sure handshaking doesn't get stuck sending USERs.


M	src/director/director-connection.c

2012-04-20 00:33:13 +0300 Timo Sirainen <tss@iki.fi> (4847d74)

    director: Fixed protocol error detection/handling.


M	src/director/director-connection.c

2012-04-20 00:32:34 +0300 Timo Sirainen <tss@iki.fi> (3a12bf3)

    director: Improved debug handshake message.


M	src/director/director-connection.c

2012-04-20 00:13:55 +0300 Timo Sirainen <tss@iki.fi> (3574bab)

    director: Increased timeout for sending USER data in handshake.


M	src/director/director-connection.c

2012-04-20 00:03:47 +0300 Timo Sirainen <tss@iki.fi> (cc22ca2)

    director: Improved error message


M	src/director/director-connection.c

2012-04-19 23:51:46 +0300 Timo Sirainen <tss@iki.fi> (0940049)

    director: Reverted previous change, it didn't work properly.


M	src/director/director-connection.c

2012-04-19 23:45:31 +0300 Timo Sirainen <tss@iki.fi> (696e4ec)

    director: Don't delay reading input from remote connection during handshake.


M	src/director/director-connection.c

2012-04-19 23:41:59 +0300 Timo Sirainen <tss@iki.fi> (6e20d8a)

    timeout_reset(): Don't use cached ioloop_timeval. Timeouts are sometimes
    reset after a long running callback. In those cases a cached timeval may be
    too far behind.


M	src/lib/ioloop.c

2012-04-19 23:34:41 +0300 Timo Sirainen <tss@iki.fi> (4865df7)

    director: Decreased timeout for resending lost SYNC request.


M	src/director/director.c

2012-04-19 23:06:55 +0300 Timo Sirainen <tss@iki.fi> (3c296d8)

    Use t_strsplit_tab() wherever possible


M	src/anvil/anvil-connection.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-stream.c
M	src/auth/auth-worker-client.c
M	src/auth/db-checkpassword.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-cache.c
M	src/config/config-connection.c
M	src/dict/dict-commands.c
M	src/director/director-connection.c
M	src/director/director-test.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-who.c
M	src/ipc/ipc-connection.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings.c
M	src/login-common/login-proxy.c
M	src/util/script-login.c

2012-04-19 23:00:16 +0300 Timo Sirainen <tss@iki.fi> (86441ff)

    Added t_strsplit_tab()


M	src/lib/strfuncs.c
M	src/lib/strfuncs.h
M	src/lib/test-strfuncs.c

2012-04-19 22:17:34 +0300 Timo Sirainen <tss@iki.fi> (069d9f1)

    director: Never set user's timestamp higher than our ioloop_time.


M	src/director/user-directory.c

2012-04-19 21:51:48 +0300 Timo Sirainen <tss@iki.fi> (447bf65)

    director: Optimized adding users to linked list during handshake.


M	src/director/Makefile.am
M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c
A	src/director/test-user-directory.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2012-04-19 20:29:25 +0300 Timo Sirainen <tss@iki.fi> (fe7f929)

    director: Increased timeouts.


M	src/director/director-connection.c

2012-04-19 18:59:33 +0300 Timo Sirainen <tss@iki.fi> (4d02858)

    raw storage: Name autocreated namespace as "raw-storage".


M	src/lib-storage/index/raw/raw-storage.c

2012-04-19 18:22:39 +0300 Timo Sirainen <tss@iki.fi> (7f250fe)

    LMTP: Don't add Return-Path: header when proxying. The backend also adds it
    and we don't want duplicates.


M	src/lmtp/commands.c

2012-04-19 18:15:56 +0300 Timo Sirainen <tss@iki.fi> (1a3f9d7)

    doveadm expunge: Added -d parameter to delete mailbox if it's empty after
    expunging.


M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-iter.h

2012-04-19 18:15:37 +0300 Timo Sirainen <tss@iki.fi> (33b469d)

    lib-storage: Added mailbox_delete_empty().


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2012-04-19 14:39:26 +0300 Timo Sirainen <tss@iki.fi> (a8c1d87)

    maildir_very_dirty_syncs=yes: Try harder to avoid readdir()ing.


M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-sync.h
M	src/lib-storage/index/maildir/maildir-util.c

2012-04-18 20:09:30 +0300 Timo Sirainen <tss@iki.fi> (72f5f2c)

    auth: Changed auth-userdb socket's default user to $default_internal_user.
    This makes the defaults more usable for director setups.


M	src/auth/auth-settings.c

2012-04-18 19:56:29 +0300 Timo Sirainen <tss@iki.fi> (4128fe3)

    fts-solr: doveadm fts rescan now resets the last-indexed-uid fields to allow
    reindexing.


M	src/plugins/fts-solr/fts-backend-solr.c

2012-04-18 19:29:22 +0300 Timo Sirainen <tss@iki.fi> (8000687)

    trash plugin fixes


M	src/plugins/trash/trash-plugin.c

2012-04-18 18:33:02 +0300 Timo Sirainen <tss@iki.fi> (1a284e2)

    imapc: Use SHA1 of message header for guid-forced instead of the entire
    body.


M	src/lib-storage/index/imapc/imapc-mail.c

2012-04-18 18:09:14 +0300 Timo Sirainen <tss@iki.fi> (e65df91)

    imapc: Added guid-forced feature to use SHA1(message) as GUID.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h

2012-04-17 13:56:00 +0300 Timo Sirainen <tss@iki.fi> (8601157)

    login: Log message change: Tried to use s/disabled/disallowed/ plaintext
    auth


M	src/login-common/client-common.c

2012-04-16 22:05:47 +0300 Timo Sirainen <tss@iki.fi> (8ef1566)

    login: Fixed per-IP ssl_ca setting inside local/remote block.


M	src/login-common/ssl-proxy-openssl.c

2012-04-12 10:48:55 +0300 Timo Sirainen <tss@iki.fi> (0a731da)

    login: Another attempt at fixing SSL memory leak.


M	src/login-common/ssl-proxy-openssl.c

2012-04-12 10:41:44 +0300 Timo Sirainen <tss@iki.fi> (6240d46)

    login: Reverted memory leak fix, because it broke some SSL setups?


M	src/login-common/ssl-proxy-openssl.c

2012-04-11 19:06:44 +0300 Timo Sirainen <tss@iki.fi> (8ba29b2)

    Memory leak fixes.


M	src/lib-storage/index/index-thread.c
M	src/login-common/ssl-proxy-openssl.c
M	src/plugins/quota/quota.c

2012-04-11 18:23:34 +0300 Timo Sirainen <tss@iki.fi> (921fd0b)

    lib-storage: LIST with mailbox {} settings incorrectly set subscribed-flags.


M	src/lib-storage/mailbox-list-iter.c

2012-04-11 17:21:01 +0300 Timo Sirainen <tss@iki.fi> (c719f74)

    dict file: Fixed assert-crash with fcntl/flock lock method.


M	src/lib-dict/dict-file.c

2012-04-11 15:02:53 +0300 Timo Sirainen <tss@iki.fi> (1a073dd)

    mbox: Make sure each mailbox creation generates a different UIDVALIDITY.


M	src/lib-storage/index/mbox/mbox-storage.h
M	src/lib-storage/index/mbox/mbox-sync.c

2012-04-11 14:44:45 +0300 Timo Sirainen <tss@iki.fi> (10db329)

    mbox: Deleting a mailbox didn't delete its index files.


M	src/lib-storage/index/index-storage.c

2012-04-11 14:29:37 +0300 Timo Sirainen <tss@iki.fi> (32e6395)

    layout=fs: LIST may have shown mailbox as \HasNoChildren when it did. This
    probably only happened with mbox.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-04-11 12:35:19 +0300 Timo Sirainen <tss@iki.fi> (ce82f77)

    --enable-devel-checks: If DEBUG_SILENT environment is set, hide "Growing
    pool" warnings.


M	src/lib/data-stack.c
M	src/lib/mempool-alloconly.c
M	src/master/master-settings.c

2012-04-10 18:05:36 +0300 Timo Sirainen <tss@iki.fi> (bdb0f59)

    dict file: Bugfix for previous lock change and changed its configuration
    syntax.


M	src/lib-dict/dict-file.c

2012-04-10 17:57:09 +0300 Timo Sirainen <tss@iki.fi> (f739c92)

    dict file: Optionally use fcntl/flock locking, instead of dotlocks.


M	src/lib-dict/dict-file.c

2012-04-10 10:09:39 +0300 Timo Sirainen <tss@iki.fi> (cb17980)

    lib-storage: mail_user_try_home_expand() now looks up home only when needed.
    Before a recent code cleanup the lookup was always done, but if the home
    didn't exist it still just happened to return success. The cleanup changed
    it to return failure, which broke the original behavior.


M	src/lib-storage/mail-user.c

2012-04-10 09:52:35 +0300 Timo Sirainen <tss@iki.fi> (9f0a996)

    pop3c: "TOP msgnum 0" was missing the 0 parameter.


M	src/lib-storage/index/pop3c/pop3c-mail.c

2012-04-10 09:52:00 +0300 Timo Sirainen <tss@iki.fi> (1864cbe)

    pop3c: Removed extra "R " prefix from POP3 server error messages.


M	src/lib-storage/index/pop3c/pop3c-client.c

2012-04-09 13:13:32 +0300 Timo Sirainen <tss@iki.fi> (238ef50)

    Added signature for changeset 2c21c940e19d


M	.hgsigs

2012-04-09 13:13:26 +0300 Timo Sirainen <tss@iki.fi> (b95459c)

    Added tag 2.1.4 for changeset 2c21c940e19d


M	.hgtags

2012-04-09 13:13:24 +0300 Timo Sirainen <tss@iki.fi> (494a594)

    Released v2.1.4.


M	NEWS
M	configure.in

2012-04-09 13:12:29 +0300 Timo Sirainen <tss@iki.fi> (4926d90)

    director: Fixed disconnecting unwanted connection.


M	src/director/director-connection.c

2012-04-09 13:04:19 +0300 Timo Sirainen <tss@iki.fi> (adc1802)

    lib-storage: If mailbox deletion crashed, undelete the mailbox when opening
    it. The deletion is assumed to be crashed if it was started over 5 minutes
    ago.


M	src/lib-storage/mail-storage.c

2012-04-03 14:45:10 +0300 Timo Sirainen <tss@iki.fi> (eea8f29)

    lib-index: Minor code cleanup.


M	src/lib-index/mail-transaction-log-file.c

2012-04-09 11:53:46 +0300 Timo Sirainen <tss@iki.fi> (013a8a9)

    lib-storage: Set mail_user.service earlier.


M	src/lib-storage/mail-user.c

2012-04-09 09:53:13 +0300 Timo Sirainen <tss@iki.fi> (1be2142)

    imap: Don't allow FETCH items list to be empty.


M	src/imap/cmd-fetch.c

2012-04-09 08:17:52 +0300 Timo Sirainen <tss@iki.fi> (8c2b4a4)

    director: Don't communicate with directors that recently sent invalid input.
    Track network and protocol failures separately. If a director had sent
    invalid protocol data within last 60 seconds, don't try to connect to it and
    don't allow it to connect to us.


M	src/director/director-connection.c
M	src/director/director-host.h
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c

2012-04-09 07:52:25 +0300 Timo Sirainen <tss@iki.fi> (ee3362f)

    director: Don't try to send the new SYNC parameter to old director versions.
    This should allow adding new directors to an old director ring without
    anything breaking. Once all directors have upgraded they start using the new
    features.


M	src/director/director-connection.c
M	src/director/director-connection.h
M	src/director/director.c

2012-04-04 11:08:32 +0300 Timo Sirainen <tss@iki.fi> (d2d5871)

    lib-storage: Minor code cleanup.


M	src/lib-storage/mail-user.c

2012-04-04 11:07:05 +0300 Timo Sirainen <tss@iki.fi> (0a894d1)

    layout=fs: Fixed iteration with mail_full_filesystem_access=yes


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-04-04 10:07:41 +0300 Timo Sirainen <tss@iki.fi> (a21537d)

    Maildir++: Return nonexistent subscribed mailbox with nonexistent flag. e.g.
    LIST (SUBSCRIBED) "" *


M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/mailbox-list-subscriptions.h

2012-04-04 09:48:46 +0300 Timo Sirainen <tss@iki.fi> (e85148f)

    lib-storage: Human search builder now uses SEARCH_MAILBOX_GLOB only when
    wildcards are used.


M	src/lib-storage/mail-search-register-human.c

2012-04-04 09:42:34 +0300 Timo Sirainen <tss@iki.fi> (e8c6287)

    doveadm: When AND-search includes mailbox names, don't bother going through
    them by list iteration.


M	src/doveadm/doveadm-mailbox-list-iter.c

2012-04-04 09:41:15 +0300 Timo Sirainen <tss@iki.fi> (b1e46e8)

    dovadm mail commands: When mailbox parameter has no wildcard, use
    SEARCH_MAILBOX.


M	src/doveadm/doveadm-mail-mailbox.c

2012-04-04 09:40:24 +0300 Timo Sirainen <tss@iki.fi> (d6e8c83)

    doveadm status: Don't include the fields parameter as a mailbox in search
    query.


M	src/doveadm/doveadm-mail-mailbox-status.c

2012-04-04 09:12:29 +0300 Timo Sirainen <tss@iki.fi> (049da06)

    pop3-migration: Error message improvement.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2012-04-04 07:46:09 +0300 Timo Sirainen <tss@iki.fi> (5b560a3)

    lib-storage: Require at least one namespace to be non-hidden


M	src/lib-storage/mail-namespace.c

2012-04-04 07:26:37 +0300 Timo Sirainen <tss@iki.fi> (18ce10f)

    doveadm user: Added -m parameter to show some of the mail settings.


M	src/doveadm/doveadm-auth.c

2012-04-04 06:25:00 +0300 Timo Sirainen <tss@iki.fi> (740dedb)

    Makefile: Link libdovecot-storage.so with LINKED_STORAGE_LDADD.


M	src/lib-storage/Makefile.am

2012-04-04 06:16:18 +0300 Timo Sirainen <tss@iki.fi> (bf6c5e9)

    ldap: Removed warning about changed user_* settings. This warning can happen
    even with recommended settings when symlinking the passdb's ldap config to
    userdb ldap config.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c

2012-04-04 06:12:24 +0300 Timo Sirainen <tss@iki.fi> (5736aef)

    lib-storage: When doing a userdb lookup, use the user's service instead of
    "lib-storage".


M	src/lib-storage/mail-user.c

2012-04-04 06:10:33 +0300 Timo Sirainen <tss@iki.fi> (914d477)

    ldap: Treat =key the same as =key=, just like v2.0.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2012-04-04 05:34:51 +0300 Timo Sirainen <tss@iki.fi> (9c550be)

    lib-lda: mail_deliver()'s dest_mail now prefetches message's GUID. This
    fixes copying an already expunged mail with maildir.


M	src/lib-lda/mail-deliver.c

2012-04-04 05:34:11 +0300 Timo Sirainen <tss@iki.fi> (46c903e)

    maildir: Remember the mail's GUID/filename in memory once it's fetched once.
    This allows retrieving it later even if the message gets expunged.


M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-mail.c

2012-04-04 05:15:49 +0300 Timo Sirainen <tss@iki.fi> (e3e5ca6)

    sdbox: If copying with link() fails with ENOENT, fallback to trying regular
    copying. This also fixes missing error reporting for that case.


M	src/lib-storage/index/dbox-single/sdbox-copy.c

2012-04-04 04:33:41 +0300 Timo Sirainen <tss@iki.fi> (31327a7)

    lib-storage: Previous change incorrectly reverted setting parent shared
    namespace usable.


M	src/lib-storage/index/shared/shared-storage.c

2012-04-04 04:31:09 +0300 Timo Sirainen <tss@iki.fi> (512f492)

    lib-storage: Fixed setting usable/unusable flags for shared namespaces. If a
    namespace doesn't have a root that exists, mark it as unusable. This avoids
    ACL plugin from autocreating that directory.


M	src/lib-storage/index/shared/shared-storage.c

2012-04-04 03:47:52 +0300 Timo Sirainen <tss@iki.fi> (c43bfb8)

    doveadm mailbox delete: -s parameter wasn't working.


M	src/doveadm/doveadm-mail-mailbox.c

2012-04-04 03:44:04 +0300 Timo Sirainen <tss@iki.fi> (4a01681)

    lib-index: Don't assert-crash with broken extension record intros in log.


M	src/lib-index/mail-index-map.c

2012-04-03 05:58:29 +0300 Timo Sirainen <tss@iki.fi> (5f5713d)

    director: Redesigned connection handling and error handling. Director now
    accepts all connections from everywhere and syncs them until the handshaking
    is finished. At that point it finally decides if this is a connection that
    should be used as our left/right connection, or if it should be
    disconnected. This should make connecting more reliable, especially if one
    of the directors sends broken handshake or has other trouble.


M	src/director/director-connection.c
M	src/director/director-connection.h
M	src/director/director.c
M	src/director/director.h

2012-04-03 00:50:12 +0300 Timo Sirainen <tss@iki.fi> (377dd19)

    director: Handle all commands during handshake. Previously the sender might
    have sent these commands, but the receiver wouldn't have handled them and
    instead just disconnected.


M	src/director/director-connection.c
M	src/director/director-connection.h
M	src/director/director.c

2012-04-03 00:23:02 +0300 Timo Sirainen <tss@iki.fi> (98d5941)

    director: Improved error logging for handling invalid commands/parameters.


M	src/director/director-connection.c

2012-04-02 23:39:48 +0300 Timo Sirainen <tss@iki.fi> (caae18c)

    director: List of director connections belongs to struct director.


M	src/director/director-connection.c
M	src/director/director-connection.h
M	src/director/director.c
M	src/director/director.h

2012-04-02 23:28:22 +0300 Timo Sirainen <tss@iki.fi> (f64b5bc)

    director: Changes to PING handling. Use larger ping timeouts. While waiting
    for sync keep doing rapid pings until the sync is finished, not just once.


M	src/director/director-connection.c
M	src/director/director-connection.h
M	src/director/director.c

2012-04-02 21:49:05 +0300 Timo Sirainen <tss@iki.fi> (66e01d5)

    imap: Enabling SPECIAL-USE selection option should also enable the same
    return option.


M	src/imap/cmd-list.c

2012-03-30 05:20:08 +0300 Timo Sirainen <tss@iki.fi> (adcb46f)

    imapc: Added imapc_features=rfc822.size setting to use RFC822.size for
    physical sizes.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.h

2012-03-30 05:11:09 +0300 Timo Sirainen <tss@iki.fi> (c8c4bbf)

    pop3-replication: Don't request virtual size from IMAP mailbox, we don't
    need it.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2012-03-30 04:26:00 +0300 Timo Sirainen <tss@iki.fi> (b10c3f9)

    pop3-migration: Migrate also POP3 ordering.


M	src/plugins/pop3-migration/pop3-migration-plugin.c

2012-03-30 04:25:46 +0300 Timo Sirainen <tss@iki.fi> (41adda8)

    dsync: Preserve pop3 ordering. This is currently done only when syncing
    locally, because it's not easy to add more fields for the current dsync
    proxying protocol in backwards compatible way. dsync redesign should fix
    this.


M	src/doveadm/dsync/dsync-data.h
M	src/doveadm/dsync/dsync-worker-local.c

2012-03-30 04:23:59 +0300 Timo Sirainen <tss@iki.fi> (9617ac7)

    lib-storage: Added mailbox_save_set_pop3_order() and implemented for
    Maildir.


M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2012-03-30 03:46:37 +0300 Timo Sirainen <tss@iki.fi> (c8593b0)

    Added pop3-migration plugin for getting POP3 UIDLs from POP3 server. The
    idea is to use this with dsync to migrate mails via imapc, but for getting
    POP3 UIDLs via pop3c.


M	configure.in
M	src/plugins/Makefile.am
A	src/plugins/pop3-migration/Makefile.am
A	src/plugins/pop3-migration/pop3-migration-plugin.c
A	src/plugins/pop3-migration/pop3-migration-plugin.h

2012-03-30 03:43:08 +0300 Timo Sirainen <tss@iki.fi> (9a1f68e)

    pop3c: Allow accessing via INBOX, regardless of what namespace it exists in.


M	src/lib-storage/index/pop3c/pop3c-storage.c

2012-03-30 03:42:21 +0300 Timo Sirainen <tss@iki.fi> (f53b3d8)

    layout=fs: Don't crash in iteration if there is no root dir (pop3c).


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-03-30 03:07:12 +0300 Timo Sirainen <tss@iki.fi> (1111aa8)

    dsync: Fixed handling messages without GUID.


M	src/doveadm/dsync/dsync-brain-msgs.c

2012-03-29 01:58:35 +0300 Timo Sirainen <tss@iki.fi> (84aac2d)

    fts-solr: Added assert + minor code cleanup


M	src/plugins/fts-solr/fts-backend-solr.c

2012-03-27 00:12:39 +0300 Timo Sirainen <tss@iki.fi> (42a6ae3)

    *-login: Previous SSL fixes were still broken with service_count=1.


M	src/login-common/client-common.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/login-common/ssl-proxy.h

2012-03-26 20:46:55 +0300 Timo Sirainen <tss@iki.fi> (22d0c23)

    lib-settings: Make static analyzer happier.


M	src/lib-settings/settings-parser.c

2012-03-26 20:39:09 +0300 Timo Sirainen <tss@iki.fi> (3528361)

    Changes to make static analyzer happier.


M	src/config/config-filter.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/test-dsync-proxy-server-cmd.c
M	src/imap/imap-sync.c
M	src/lib-dict/dict-sql.c
M	src/lib-mail/message-parser.c
M	src/lib-master/master-login.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/list/subscription-file.c
M	src/lib/file-cache.c
M	src/lib/ostream.c
M	src/lib/process-title.c
M	src/lib/strfuncs.c
M	src/lib/test-str-find.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c

2012-03-26 20:38:18 +0300 Timo Sirainen <tss@iki.fi> (87b8a4b)

    pgsql: Fixed a potential crash if connection got closed during synchronous
    query.


M	src/lib-sql/driver-pgsql.c

2012-03-26 18:17:52 +0300 Timo Sirainen <tss@iki.fi> (1411680)

    fts-solr: Indexing mail bodies was broken.


M	src/plugins/fts-solr/fts-backend-solr.c

2012-03-26 17:24:59 +0300 Timo Sirainen <tss@iki.fi> (42401be)

    director: Avoid crashing if all directors are removed when reconnecting.
    There's no way to currently remove directors though, so this couldn't have
    actually happened.


M	src/director/director.c

2012-03-26 17:01:21 +0300 Timo Sirainen <tss@iki.fi> (55aa434)

    net_listen(): If bind(ip=any) fails with non-EADDRINUSE, don't crash.


M	src/lib/network.c

2012-03-26 16:57:32 +0300 Timo Sirainen <tss@iki.fi> (b1d374f)

    stats: When freeing memory, make sure we don't crash if some list gets
    empty.


M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-session.c
M	src/stats/mail-user.c

2012-03-26 16:23:18 +0300 Timo Sirainen <tss@iki.fi> (e7b0b54)

    lib-storage: If trying to copy a message into already deleted mailbox, don't
    crash.


M	src/lib-storage/mail-storage.c

2012-03-26 15:34:46 +0300 Timo Sirainen <tss@iki.fi> (2a5d52e)

    data-stack: Fixed calling t_push()/t_malloc() before data_stack_init().


M	src/lib/data-stack.c

2012-03-24 14:21:59 +0200 Timo Sirainen <tss@iki.fi> (494f41a)

    Compiling fix for building without SSL.


M	src/login-common/ssl-proxy.c

2012-03-23 14:37:22 +0200 Timo Sirainen <tss@iki.fi> (8783c6a)

    Compiler warning fixes.


M	src/auth/auth-request.h
M	src/lib-imap/test-imap-utf7.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-test/test-common.c
M	src/lib/strfuncs.h
M	src/master/main.c

2012-03-23 13:59:52 +0200 Timo Sirainen <tss@iki.fi> (9ecdbb8)

    Fixed compiling without SSL.


M	src/login-common/ssl-proxy.c

2012-03-23 13:46:27 +0200 Timo Sirainen <tss@iki.fi> (de482dd)

    mail_temp_scan_interval comment update.


M	doc/example-config/conf.d/10-mail.conf

2012-03-23 13:44:54 +0200 Timo Sirainen <tss@iki.fi> (68b5e13)

    Added mail_temp_scan_interval setting and changed its default from 8h -> 1w.


M	doc/example-config/conf.d/10-mail.conf
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.h
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2012-03-23 13:35:05 +0200 Timo Sirainen <tss@iki.fi> (e736ac9)

    unlink_old_files(): Update atime before scan, not after. If Maildir/dbox
    scanning takes long this makes sure that a lot of processes won't be
    scanning it in parallel.


M	src/lib/unlink-old-files.c
M	src/lib/unlink-old-files.h

2012-03-23 13:24:34 +0200 Timo Sirainen <tss@iki.fi> (1a30613)

    net_getunixcred(): Fixed Solaris to use getpeerucred() properly.


M	src/lib/network.c

2012-03-23 12:26:50 +0200 Timo Sirainen <tss@iki.fi> (f01f983)

    lib-mail: message_date_parse() now also accepts '.' separator in hh.mm.ss
    time.


M	src/lib-mail/message-date.c

2012-03-22 18:28:59 +0200 Timo Sirainen <tss@iki.fi> (9f34f81)

    sdbox: Don't log "Rebuilding index" when another process already did it and
    we cancel it.


M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c

2012-03-22 18:05:08 +0200 Timo Sirainen <tss@iki.fi> (6ae329d)

    quota: Added a kludge to avoid recalculating quota.


M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/mail-storage-private.h
M	src/plugins/quota/quota-storage.c

2012-03-22 17:44:51 +0200 Timo Sirainen <tss@iki.fi> (a249dd2)

    lib-storage: Don't access mail->box->view, but mail->transaction->view. They
    may not be the same. In such cases e.g. mail_set_uid() may have accessed a
    wrong mail.


M	src/lib-storage/index/index-mail.c
M	src/plugins/virtual/virtual-mail.c

2012-03-22 17:12:35 +0200 Timo Sirainen <tss@iki.fi> (dba8af1)

    Increased initial memory pool sizes.


M	src/lib-dict/dict-file.c
M	src/lib-storage/fail-mailbox.c

2012-03-22 17:11:37 +0200 Timo Sirainen <tss@iki.fi> (37ee89f)

    mdbox: Fixed a long loop/crash when mdbox is broken during saving.


M	src/lib-storage/index/dbox-multi/mdbox-sync.c

2012-03-22 16:03:38 +0200 Timo Sirainen <tss@iki.fi> (0c96e29)

    lib-master: Minor memory leak fix on deinit.


M	src/lib-master/master-service.c

2012-03-22 16:03:29 +0200 Timo Sirainen <tss@iki.fi> (b6b7a17)

    imap-login: Memory leak fix.


M	src/login-common/client-common.c

2012-03-22 16:03:04 +0200 Timo Sirainen <tss@iki.fi> (5da4bfd)

    *-login: Another crashfix


M	src/login-common/client-common.c
M	src/login-common/login-proxy.c
M	src/login-common/main.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.h

2012-03-22 15:32:00 +0200 Timo Sirainen <tss@iki.fi> (fa02962)

    *-login: Fixed crashing when proxying SSL connections to a remote server.


M	src/login-common/client-common.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.h

2012-03-21 19:01:44 +0200 Timo Sirainen <tss@iki.fi> (297901b)

    config: Added a comment


M	src/config/config-filter.c

2012-03-21 18:58:37 +0200 Timo Sirainen <tss@iki.fi> (afa5d78)

    lib-settings: settings_parser_apply_changes() now deduplicates SET_STRLIST
    arrays. This fixes overriding strlist keys in config file filters, e.g.:

    plugin {
     foo = general
    } protocol lda {
     plugin {
       foo = lda-specific setting
     }
    }

M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings-parser.h

2012-03-21 14:25:12 +0200 Timo Sirainen <tss@iki.fi> (407e4eb)

    maildir: Avoid duplicate S=size and W=sizes in maildir filenames. This
    happens with maildir_copy_with_hardlinks=no and when copying a mail with
    zlib compression enabled.


M	src/lib-storage/index/maildir/maildir-save.c

2012-03-21 13:43:56 +0200 Timo Sirainen <tss@iki.fi> (7300b38)

    auth: Don't check client PID in non-login auth sockets. This fixes PID
    conflict errors when using TCP auth sockets for e.g. MTAs.


M	src/auth/auth-client-connection.c

2012-03-21 12:08:32 +0200 Timo Sirainen <tss@iki.fi> (585d3d9)

    imap: Handle XLIST command by running LIST command. If the SPECIAL-USE
    mailboxes are enabled, this results in mostly compatible output. This change
    allows easily enabling the GMail XLIST extension simply by adding +XLIST to
    imap_capability setting.


M	src/imap/imap-commands.c

2012-03-20 17:46:44 +0200 Timo Sirainen <tss@iki.fi> (c9fda71)

    doveadm import: Copy also message flags.


M	src/doveadm/doveadm-mail-import.c

2012-03-19 15:53:25 +0200 Timo Sirainen <tss@iki.fi> (289688f)

    layout=fs: Renaming non-UTF8 mailbox names wasn't done in all situations.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-03-16 18:48:46 +0200 Timo Sirainen <tss@iki.fi> (83d4817)

    Added signature for changeset b9adfd52cb66


M	.hgsigs

2012-03-16 18:48:40 +0200 Timo Sirainen <tss@iki.fi> (d24adb7)

    Added tag 2.1.3 for changeset b9adfd52cb66


M	.hgtags

2012-03-16 18:48:40 +0200 Timo Sirainen <tss@iki.fi> (d9036e5)

    Released v2.1.3.


M	NEWS
M	configure.in

2012-03-16 18:45:50 +0200 Timo Sirainen <tss@iki.fi> (d36607c)

    dbox: Reverted recent fstat() avoidance change. It didn't do that, just
    broke mdbox.


M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-file.c

2012-03-15 18:24:15 +0200 Timo Sirainen <tss@iki.fi> (7dd73e0)

    Compiler warning fixes.


M	src/director/user-directory.c
M	src/lib-index/mail-cache-fields.c
M	src/replication/replicator/replicator-queue.c

2012-03-15 18:24:11 +0200 Timo Sirainen <tss@iki.fi> (48bd07d)

    replicator: Fixed off-by-one-second "do we do a full sync now?" check.


M	src/replication/replicator/replicator-brain.c

2012-03-15 16:42:22 +0200 Timo Sirainen <tss@iki.fi> (1c7e30f)

    Added signature for changeset 744e0d7f1b25


M	.hgsigs

2012-03-15 16:42:18 +0200 Timo Sirainen <tss@iki.fi> (39b72f1)

    Added tag 2.1.2 for changeset 744e0d7f1b25


M	.hgtags

2012-03-15 16:42:18 +0200 Timo Sirainen <tss@iki.fi> (f3e30d3)

    Released v2.1.2.


M	NEWS
M	configure.in

2012-03-15 16:39:38 +0200 Timo Sirainen <tss@iki.fi> (77ba962)

    example-config: Added auth_proxy_self setting.


M	doc/example-config/dovecot.conf

2012-03-15 14:18:55 +0200 Timo Sirainen <tss@iki.fi> (e7afe6e)

    imap: Use mailbox_exists() to find out if namespace prefix is selectable or
    not. mailbox_list_mailbox() should be treated as an internal function, since
    ACLs don't apply to it.


M	src/imap/cmd-list.c

2012-03-15 14:18:13 +0200 Timo Sirainen <tss@iki.fi> (81dbd57)

    lib-storage: mailbox_exists() now returns namespace prefix as selectable if
    it is.


M	src/lib-storage/mail-storage.c

2012-03-15 13:25:36 +0200 Timo Sirainen <tss@iki.fi> (b28ea1d)

    layout=maildir++: Don't list INBOX if it doesn't match the list patterns.


M	src/lib-storage/list/mailbox-list-maildir-iter.c

2012-03-15 12:59:41 +0200 Timo Sirainen <tss@iki.fi> (7b2a1f8)

    auth: If global passdb is missing, don't complain if protocol x and !x {
    passdb } exists.


M	src/auth/auth.c

2012-03-14 16:24:05 +0200 Timo Sirainen <tss@iki.fi> (d6d6758)

    layout=fs: Rename mailbox names that aren't valid UTF-8 to avoid crashes
    later.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-03-14 15:40:58 +0200 Timo Sirainen <tss@iki.fi> (cdd7f46)

    mailbox_list_index=yes: Don't add autocreated mailboxes to index before they
    are created.


M	src/lib-storage/list/mailbox-list-index-sync.c

2012-03-14 15:40:35 +0200 Timo Sirainen <tss@iki.fi> (985bcb8)

    mailbox_list_index=yes: Don't crash at deinit (fix to previous change)


M	src/lib-storage/list/mailbox-list-index.c

2012-03-14 15:34:14 +0200 Timo Sirainen <tss@iki.fi> (4047158)

    mailbox_list_index=yes: Delay opening/creating the index until it's needed.
    This also fixes an error when trying to create the index before the parent
    director is created.


M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2012-03-14 14:59:24 +0200 Timo Sirainen <tss@iki.fi> (ca283b8)

    auth: Make sure auth cache doesn't break if any cache keys have TABs.


M	src/auth/auth-cache.c

2012-03-14 14:55:25 +0200 Timo Sirainen <tss@iki.fi> (f2e7603)

    auth: Fixed auth cache key generation to support %{long} variables


M	src/auth/Makefile.am
M	src/auth/auth-cache.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
A	src/auth/test-auth-cache.c

2012-03-14 13:42:08 +0200 Timo Sirainen <tss@iki.fi> (b58cb4b)

    liblib: Added var_get_key_range()


M	src/lib/test-var-expand.c
M	src/lib/var-expand.c
M	src/lib/var-expand.h

2012-03-14 13:39:00 +0200 Timo Sirainen <tss@iki.fi> (4633993)

    anvil: s/memcpy/memmove/ for updating checksum list. This may have caused
    anvil to update penalties wrong.


M	src/anvil/penalty.c

2012-03-14 13:34:43 +0200 Timo Sirainen <tss@iki.fi> (5d37078)

    test-primes: Fixed undefined behavior.


M	src/lib/test-primes.c

2012-03-14 13:14:28 +0200 Timo Sirainen <tss@iki.fi> (48170d4)

    doveconf: Dump protocol/local/remote sections even if there was an error
    earlier. This allows getting a mostly-working config file rather than a
    truncated one.


M	src/config/doveconf.c

2012-03-13 21:19:53 +0200 Timo Sirainen <tss@iki.fi> (38779e6)

    lib-storage: mailbox_list_iter_next() now enforces backends not to return
    mailbox name from data stack.


M	src/lib-storage/mailbox-list-iter.c

2012-03-13 21:18:32 +0200 Timo Sirainen <tss@iki.fi> (0f97c2b)

    mailbox_list_index=yes iteration: Don't allocate returned mailbox names from
    data stack. This breaks dsync.


M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index.h

2012-03-13 17:01:56 +0200 Timo Sirainen <tss@iki.fi> (316ca25)

    dbox: Avoid unnecessary fstat() call during file creation.


M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-file.c

2012-03-13 16:32:56 +0200 Timo Sirainen <tss@iki.fi> (bf5f442)

    lib-storage: Don't log errors if trying to open a mailbox with too long
    name. Handle ENAMETOOLONG errors the same as ENOENT.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib/compat.h

2012-03-13 16:14:13 +0200 Timo Sirainen <tss@iki.fi> (009ec18)

    fts: Another crashfix for recent changes.


M	src/plugins/fts/fts-storage.c

2012-03-13 15:11:13 +0200 Timo Sirainen <tss@iki.fi> (75c2291)

    director: Compiler warning fix


M	src/director/director-request.c

2012-03-12 17:36:29 +0200 Timo Sirainen <tss@iki.fi> (c9914a2)

    stats: When logging about a session crash, log also its service.


M	src/stats/mail-session.c

2012-03-12 14:32:23 +0200 Timo Sirainen <tss@iki.fi> (6f368f8)

    fts: Crashfix when FTS isn't needed for performing search.


M	src/plugins/fts/fts-storage.c

2012-03-12 13:45:19 +0200 Timo Sirainen <tss@iki.fi> (6d41944)

    fts: Added fts_index_timeout setting to abort search if indexing hasn't
    finished by then. This timeout shows up to client as: tag NO [INUSE] Timeout
    while waiting for indexing to finish


M	src/plugins/fts/Makefile.am
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h

2012-03-12 13:17:50 +0200 Timo Sirainen <tss@iki.fi> (a6099cd)

    director: Improved request timeout error more.


M	src/director/director-request.c

2012-03-12 13:15:26 +0200 Timo Sirainen <tss@iki.fi> (c3c9d02)

    director: If request times out, log more information.


M	src/director/director-request.c

2012-03-12 12:59:54 +0200 Timo Sirainen <tss@iki.fi> (1dc155e)

    Makefile: Delete dovecot-config on distclean


M	Makefile.am

2012-03-11 14:50:05 +0200 Timo Sirainen <tss@iki.fi> (34a4888)

    Makefile: Fixed header filename.


M	src/replication/aggregator/Makefile.am

2012-03-11 12:42:53 +0200 Timo Sirainen <tss@iki.fi> (40df892)

    Makefile: Fixed compiling with automake 1.11.2+


M	Makefile.am

2012-03-11 09:08:08 +0200 Timo Sirainen <tss@iki.fi> (290ad6b)

    checkpassword: Compiling fix for some systems


M	src/auth/db-checkpassword.c

2012-03-10 18:32:34 +0200 Timo Sirainen <tss@iki.fi> (f3480d0)

    mbox: Fixed accessing v1.x mbox index files without errors.


M	src/lib-storage/index/mbox/mbox-sync.c

2012-03-10 15:53:39 +0200 Timo Sirainen <tss@iki.fi> (8d513b6)

    stats: Fixes to handling per-command stats updates.


M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/stats/mail-command.c

2012-03-10 15:44:27 +0200 Timo Sirainen <tss@iki.fi> (214cb5b)

    lib-storage: Update search's cost more widely and less often.


M	src/lib-storage/index/index-search.c

2012-03-10 15:07:23 +0200 Timo Sirainen <tss@iki.fi> (2f896df)

    doveadm config: Don't fail on invalid config (e.g. plugin not found) This
    command is often used in init scripts and such to stop/restart Dovecot.


M	src/doveadm/doveadm.c

2012-03-10 15:03:11 +0200 Timo Sirainen <tss@iki.fi> (0618bd1)

    stats: UPDATE-CMD for an existing command wasn't handled properly. The
    command's stats themselves weren't updated. Also due to recent change
    updating session's stats from a command no longer works properly, because
    the session could also be updated in the middle of the command.


M	src/stats/mail-command.c

2012-03-10 14:28:48 +0200 Timo Sirainen <tss@iki.fi> (da11064)

    checkpassword: Set CREDENTIALS_LOOKUP=1 for passdb lookups


M	src/auth/db-checkpassword.c

2012-03-10 14:17:37 +0200 Timo Sirainen <tss@iki.fi> (a08c970)

    checkpassword: Implemented support for credentials lookup.


M	src/auth/db-checkpassword.c
M	src/auth/passdb-checkpassword.c

2012-03-10 14:11:32 +0200 Timo Sirainen <tss@iki.fi> (1294c06)

    checkpassword: Escape transferred extra fields properly.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/checkpassword-reply.c
M	src/auth/db-checkpassword.c
M	src/auth/db-checkpassword.h
M	src/auth/passdb-checkpassword.c
M	src/auth/userdb-checkpassword.c

2012-03-10 13:49:12 +0200 Timo Sirainen <tss@iki.fi> (0266476)

    checkpassword: Error handling fix


M	src/auth/db-checkpassword.c

2012-03-10 13:47:16 +0200 Timo Sirainen <tss@iki.fi> (d2e9712)

    checkpassword: If username+password is too large, treat it as regular auth
    failure.


M	src/auth/db-checkpassword.c

2012-03-10 13:37:39 +0200 Timo Sirainen <tss@iki.fi> (b3c3d6f)

    auth: checkpassword code cleanup. Also fixed some error handling. Removes a
    lot of copy&pasted code between passdb and userdb.


M	src/auth/checkpassword-reply.c
M	src/auth/db-checkpassword.c
M	src/auth/db-checkpassword.h
M	src/auth/passdb-checkpassword.c
M	src/auth/userdb-checkpassword.c

2012-03-08 16:03:45 +0200 Timo Sirainen <tss@iki.fi> (b6b9c99)

    director: Avoid user getting redirected to different servers near its
    expiration. Fixes a problem when user is logging in at the same time on
    director1 which thinks the user is expired, and on director2 which thinks
    the user expires only in 1 second.


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director.c
M	src/director/director.h
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/user-directory.c
M	src/director/user-directory.h

2012-03-08 10:48:08 +0200 Timo Sirainen <tss@iki.fi> (8e78ed2)

    lib-master: Fixed passing request data from login process.


M	src/lib-master/master-login.c

2012-03-08 10:39:58 +0200 Timo Sirainen <tss@iki.fi> (c36b65f)

    imap: Crashfix when running standalone.


M	src/imap/main.c

2012-03-08 10:21:09 +0200 Timo Sirainen <tss@iki.fi> (150d8a7)

    Makefile: s/MKDIR_P/mkdir_p/ to make it actually work


M	Makefile.am

2012-03-07 20:16:33 +0200 Timo Sirainen <tss@iki.fi> (aa79740)

    director: Keep track of the highest supported protocol version in the ring.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h

2012-03-07 16:58:37 +0200 Timo Sirainen <tss@iki.fi> (c53af2e)

    login proxy: Handle proxy-notify errors better. If open() fails with ENOENT,
    it should still be logged as an error. If opening or anything else fails,
    retry opening the fifo 60 secs.


M	src/login-common/login-proxy-state.c

2012-03-07 16:48:47 +0200 Timo Sirainen <tss@iki.fi> (c69561b)

    director: Log a warning if user is refreshed too late.


M	src/director/notify-connection.c

2012-03-07 16:32:14 +0200 Timo Sirainen <tss@iki.fi> (4f2b533)

    director: Add more info to "User hash .. is being redirected to two hosts"
    error.


M	src/director/director-connection.c

2012-03-07 13:36:34 +0200 Timo Sirainen <tss@iki.fi> (b55f914)

    Added a "session ID" string for imap/pop3 connections, available in
    %{session} variable. The session ID passes through Dovecot IMAP/POP3
    proxying to backend server. The same session ID is can be reused after a
    long time (currently a bit under 9 years).


M	src/imap-login/client.c
M	src/imap-login/imap-proxy.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/main.c
M	src/lib-master/master-login.c
M	src/lib-master/master-login.h
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h

2012-03-07 13:32:40 +0200 Timo Sirainen <tss@iki.fi> (21a8678)

    login proxy: Log "disconnecting" message also with
    login_log_format_elements.


M	src/login-common/login-proxy.c

2012-03-07 13:01:23 +0200 Timo Sirainen <tss@iki.fi> (b5917cf)

    login_log_format_elements: Allow using %{long_variables} without breaking.


M	src/login-common/client-common.c

2012-03-07 11:29:42 +0200 Timo Sirainen <tss@iki.fi> (7d359c1)

    doveadm: Handle -NOUSER replies from doveadm-server.


M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/server-connection.c
M	src/doveadm/server-connection.h

2012-03-07 11:23:03 +0200 Timo Sirainen <tss@iki.fi> (c46d921)

    decode2text: Avoid leaving temp files and hanging child processes.


M	src/plugins/fts/decode2text.sh

2012-03-05 19:33:51 +0200 Timo Sirainen <tss@iki.fi> (cd85405)

    stats: Don't log write()=EPIPE failures. Retry opening the pipe once.


M	src/plugins/stats/stats-connection.c

2012-03-05 18:44:01 +0200 Timo Sirainen <tss@iki.fi> (33651ce)

    stats: More changes to send stats while doing long running searches.


M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h

2012-03-05 18:43:05 +0200 Timo Sirainen <tss@iki.fi> (c9d4d12)

    lib-storage: When searching with a sort program, don't prefetch any mails.
    The prefetching probably ends up being pointless.


M	src/lib-storage/index/index-search.c

2012-03-05 18:41:53 +0200 Timo Sirainen <tss@iki.fi> (ae81917)

    pop3: Added assert.


M	src/pop3/pop3-client.c

2012-03-05 18:09:45 +0200 Timo Sirainen <tss@iki.fi> (f13c5e6)

    stats: Update stats once per second for long running nonblocking searches.


M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h

2012-03-05 17:28:06 +0200 Timo Sirainen <tss@iki.fi> (5733207)

    Added director_username_hash setting to specify what part of the username is
    hashed. The default is "%u" meaning the full username. Another potentially
    useful value is "%d" for hashing only the domain (i.e. redirect users from
    the same domain always to same server so they can safely access each others'
    shared mailboxes).


M	src/director/Makefile.am
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-settings.h
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/notify-connection.c
M	src/director/user-directory.c
M	src/director/user-directory.h
M	src/lib-mail/Makefile.am
A	src/lib-mail/mail-user-hash.c
A	src/lib-mail/mail-user-hash.h
M	src/login-common/Makefile.am
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h

2012-03-05 14:27:02 +0200 Timo Sirainen <tss@iki.fi> (19e7781)

    replication_max_conns setting is a number, not a time interval.


M	src/replication/replicator/replicator-settings.c

2012-03-05 13:18:28 +0200 Timo Sirainen <tss@iki.fi> (595f6a9)

    aggregator: Fixed leaking connections to replicator.


M	src/replication/aggregator/replicator-connection.c

2012-03-05 13:08:14 +0200 Timo Sirainen <tss@iki.fi> (8d85914)

    Makefile: Fixed compiling lmtp with some SSL_LIBS options.


M	src/lmtp/Makefile.am

2012-03-05 11:54:33 +0200 Timo Sirainen <tss@iki.fi> (b3e864e)

    dsync: Set user.dsyncing=TRUE also for dsync-server. This avoids dsync
    server immediately triggering another dsync when using replication.


M	src/doveadm/dsync/doveadm-dsync.c

2012-03-05 11:53:45 +0200 Timo Sirainen <tss@iki.fi> (34e2c09)

    dsync: If mailbox was expunged empty, the messages may have reappeared. This
    dependend on what the last UID of the previous mailbox was.


M	src/doveadm/dsync/dsync-worker-local.c

2012-03-04 15:48:48 +0200 Timo Sirainen <tss@iki.fi> (6f5dca6)

    Don't auto-add mountpoints under /media or /cdrom.


M	src/doveadm/doveadm-mount.c
M	src/lib-master/mountpoint-list.c
M	src/lib-master/mountpoint-list.h
M	src/master/main.c

2012-03-04 15:30:31 +0200 Timo Sirainen <tss@iki.fi> (b71ec94)

    Makefile: Link with SSL_LIBS whenever linking libssl_iostream.la


M	configure.in
M	dovecot-config.in.in
M	src/auth/Makefile.am
M	src/doveadm/Makefile.am
M	src/doveadm/dsync/Makefile.am
M	src/imap/Makefile.am
M	src/indexer/Makefile.am
M	src/lda/Makefile.am
M	src/lib-storage/Makefile.am
M	src/lib-storage/index/Makefile.am
M	src/login-common/Makefile.am
M	src/plugins/fts-squat/Makefile.am
M	src/pop3/Makefile.am
M	src/util/Makefile.am

2012-03-04 15:21:21 +0200 Timo Sirainen <tss@iki.fi> (51335e0)

    Makefile: Fix to previous change to get dovecot-config file built again.


M	Makefile.am

2012-03-04 15:11:20 +0200 Timo Sirainen <tss@iki.fi> (01c9d35)

    Makefile: Fixed dovecot-config installation


M	Makefile.am

2012-03-04 14:33:00 +0200 Timo Sirainen <tss@iki.fi> (2d8319a)

    lib-storage: Removed MAILBOX_LIST_ITER_LIST_PREFIXES flag. It was already
    accidentally enabled by default, and there's really no good reason why it
    shouldn't always be enabled.


M	src/doveadm/doveadm-mailbox-list-iter.c
M	src/lib-storage/mailbox-list.h

2012-03-04 14:31:23 +0200 Timo Sirainen <tss@iki.fi> (a6aeafa)

    lib-storage: mailbox_list_iter_init_namespaces() duplicated INBOX if it was
    also ns prefix.


M	src/lib-storage/mailbox-list-iter.c

2012-03-04 14:12:19 +0200 Timo Sirainen <tss@iki.fi> (4c0c72a)

    lib-mail: rfc822_parse_quoted_string() didn't remove '\' from the strings.


M	src/lib-mail/rfc822-parser.c

2012-03-04 13:56:33 +0200 Timo Sirainen <tss@iki.fi> (34ae25c)

    auth: userdb passwd iteration skips now also users with /usr/sbin/nologin
    shell


M	src/auth/userdb-passwd.c

2012-03-04 13:20:21 +0200 Timo Sirainen <tss@iki.fi> (41c2643)

    lib-storage: If mailbox is already open in mailbox_enable(), enable modseqs.


M	src/lib-storage/index/index-storage.c

2012-03-04 13:19:03 +0200 Timo Sirainen <tss@iki.fi> (9d7ab44)

    lib-storage: mailbox_enable() shouldn't actually open the mailbox. This
    combined with mailbox_get_status() never synced the mailbox, so if there
    were any changes they weren't visible in STATUS reply.


M	src/lib-storage/index/index-storage.c

2012-03-04 13:01:09 +0200 Timo Sirainen <tss@iki.fi> (575b1a8)

    dsync server: Ignore -f, -R and -m parameters instead of failing. v2.0 dsync
    did this as well.


M	src/doveadm/dsync/doveadm-dsync.c

2012-03-04 12:50:02 +0200 Timo Sirainen <tss@iki.fi> (db75f60)

    imap: Fixed error handling in APPEND parameters.


M	src/imap/cmd-append.c

2012-03-04 12:31:26 +0200 Timo Sirainen <tss@iki.fi> (b636982)

    log: Avoid an "master input for invalid service_fd" error at deinit.


M	src/log/log-connection.c

2012-03-04 12:24:29 +0200 Timo Sirainen <tss@iki.fi> (9da1a07)

    log: Don't shutdown until all log writers have gone. This fixed losing log
    messages during shutdown.


M	src/log/log-connection.c
M	src/log/main.c

2012-03-04 12:09:35 +0200 Timo Sirainen <tss@iki.fi> (a88f327)

    replicator: Another deinit crashfix


M	src/replication/replicator/replicator-queue.c

2012-03-04 12:07:21 +0200 Timo Sirainen <tss@iki.fi> (64a81f5)

    replicator: Fixed crash on deinit


M	src/replication/replicator/replicator-queue.c

2012-03-04 12:04:46 +0200 Timo Sirainen <tss@iki.fi> (b4fe950)

    replicator: Queue handling was pretty broken


M	src/replication/replicator/replicator-queue.c

2012-03-04 11:23:14 +0200 Timo Sirainen <tss@iki.fi> (82e772a)

    replication plugin: Don't try to close fifo if it wasn't even opened.


M	src/plugins/replication/replication-plugin.c

2012-03-04 11:19:10 +0200 Timo Sirainen <tss@iki.fi> (a3d6dc6)

    Makefile: Added missing replication plugin directory


M	src/plugins/Makefile.am

2012-03-04 11:17:45 +0200 Timo Sirainen <tss@iki.fi> (0caa211)

    auth: userdb passwd iteration now skips users with shell set to /bin/false
    or /sbin/nologin


M	src/auth/userdb-passwd.c

2012-03-04 10:40:19 +0200 Timo Sirainen <tss@iki.fi> (3330317)

    replicator: Crashfix


M	src/replication/replicator/doveadm-connection.c

2012-03-04 10:35:25 +0200 Timo Sirainen <tss@iki.fi> (12e4931)

    doveadm-server: If socket is 0600 mode there's never no need to
    authenticate. Even if the socket's owner doesn't match the process's
    effective UID. This could be e.g. because socket owner is root, while
    doveadm-server runs as vmail.


M	src/doveadm/client-connection.c

2012-03-04 10:26:32 +0200 Timo Sirainen <tss@iki.fi> (cbb6bb8)

    replication plugin: Handle shared namespaces better, skip public namespaces.
    These will be handled better later, maybe in v2.2.


M	src/plugins/replication/replication-plugin.c

2012-03-04 10:25:23 +0200 Timo Sirainen <tss@iki.fi> (529dc11)

    replication plugin: Use one shared notification fifo for all users.


M	src/plugins/replication/replication-plugin.c

2012-03-04 10:11:55 +0200 Timo Sirainen <tss@iki.fi> (c14c556)

    doveadm server now returns unknown users with -NOUSER error.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/replication/replicator/doveadm-connection.c

2012-03-04 09:50:21 +0200 Timo Sirainen <tss@iki.fi> (447e086)

    Initial implementation of dsync-based replication.


M	.hgignore
M	configure.in
M	src/Makefile.am
M	src/doveadm/dsync/doveadm-dsync.c
M	src/lib-storage/mail-user.h
A	src/plugins/replication/Makefile.am
A	src/plugins/replication/replication-plugin.c
A	src/plugins/replication/replication-plugin.h
A	src/replication/Makefile.am
A	src/replication/aggregator/Makefile.am
A	src/replication/aggregator/aggregator-settings.c
A	src/replication/aggregator/aggregator-settings.h
A	src/replication/aggregator/aggregator.c
A	src/replication/aggregator/notify-connection.c
A	src/replication/aggregator/notify-connection.h
A	src/replication/aggregator/replicator-connection.c
A	src/replication/aggregator/replicator-connection.h
A	src/replication/replication-common.h
A	src/replication/replicator/Makefile.am
A	src/replication/replicator/doveadm-connection.c
A	src/replication/replicator/doveadm-connection.h
A	src/replication/replicator/notify-connection.c
A	src/replication/replicator/notify-connection.h
A	src/replication/replicator/replicator-brain.c
A	src/replication/replicator/replicator-brain.h
A	src/replication/replicator/replicator-queue.c
A	src/replication/replicator/replicator-queue.h
A	src/replication/replicator/replicator-settings.c
A	src/replication/replicator/replicator-settings.h
A	src/replication/replicator/replicator.c

2012-03-04 09:39:45 +0200 Timo Sirainen <tss@iki.fi> (fd60124)

    Makefile: Fixed compiling with automake 1.11.2+


M	Makefile.am

2012-03-02 19:24:57 +0200 Timo Sirainen <tss@iki.fi> (dd7abc3)

    lib-sql: If failed query is retried, log it as as warning instead of as
    error.


M	src/lib-sql/driver-sqlpool.c

2012-03-02 17:58:37 +0200 Timo Sirainen <tss@iki.fi> (fea94bc)

    login proxy: Don't assume host is down unless last success was >30s before
    last failure. This avoids thinking that host is down, simply because one
    connection for it failed.


M	src/login-common/login-proxy.c

2012-03-02 15:49:34 +0200 Timo Sirainen <tss@iki.fi> (cd611ca)

    dsync: Added -n parameter to dsync a specific namespace.


M	src/doveadm/doveadm-settings.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-worker-local.c
M	src/doveadm/dsync/dsync-worker.h

2012-03-02 15:34:22 +0200 Timo Sirainen <tss@iki.fi> (4dfaf59)

    eacces_error_get*(): Added ',' to message to improve readability.


M	src/lib/eacces-error.c

2012-03-02 15:31:25 +0200 Timo Sirainen <tss@iki.fi> (23bd9fc)

    eacces_error_get*(): Suggest ACL/MAC error if UNIX permission bits look ok.


M	src/lib/eacces-error.c

2012-03-02 14:36:13 +0200 Timo Sirainen <tss@iki.fi> (900bb5e)

    lib-storage: mail_transaction_commit_changes.changed=TRUE only when
    something actually changed.


M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h

2012-03-02 14:33:41 +0200 Timo Sirainen <tss@iki.fi> (acb0236)

    Increased initial memory pool sizes and marked some of them as "growing".


M	src/config/config-request.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-proxy-server.c
M	src/lib-settings/settings-parser.c

2012-03-02 14:25:49 +0200 Timo Sirainen <tss@iki.fi> (64a323d)

    dsync: Added -d parameter to sync to plugin/mail_replica destination. This
    could be one global default or overridden by userdb.


M	src/doveadm/dsync/doveadm-dsync.c

2012-03-02 14:18:29 +0200 Timo Sirainen <tss@iki.fi> (0ed18ec)

    dsync: Added dsync_remote_cmd setting, which is used to execute remote
    dsync. This is used for the old style "host" and "mailuser@host" parameters,
    as well as for a new "remote:[user@]host" parameter.


M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/dsync/doveadm-dsync.c

2012-03-02 14:06:18 +0200 Timo Sirainen <tss@iki.fi> (69d31af)

    dsync: Prefix remote dsync's error messages with "remote:".


M	src/doveadm/dsync/doveadm-dsync.c

2012-03-02 13:56:37 +0200 Timo Sirainen <tss@iki.fi> (45e5255)

    dsync: Added -l <timeout> parameter to lock the sync (via
    ~/.dovecot-sync.lock)


M	src/doveadm/dsync/doveadm-dsync.c

2012-03-02 13:15:15 +0200 Timo Sirainen <tss@iki.fi> (62d0db1)

    doveadm: Added prerun() method for mail commands.


M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2012-03-02 12:23:00 +0200 Timo Sirainen <tss@iki.fi> (7a94f95)

    login: If session timeouts after authentication, log a better error about
    it.


M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2012-03-01 09:31:40 +0200 Timo Sirainen <tss@iki.fi> (d6c5cee)

    imap: Changed internal FETCH command handling API.


M	src/imap/cmd-fetch.c
M	src/imap/cmd-select.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h

2012-02-29 13:04:24 +0200 Timo Sirainen <tss@iki.fi> (15c5de5)

    mailbox_list_index=yes: Fixed mailbox listing when not using default
    namespace settings.


M	src/lib-storage/list/mailbox-list-index-iter.c

2012-02-29 12:53:21 +0200 Timo Sirainen <tss@iki.fi> (0007969)

    fts-squat: Fixed search to actually work.


M	src/plugins/fts-squat/fts-backend-squat.c

2012-02-28 18:50:46 +0200 Timo Sirainen <tss@iki.fi> (e51bfe0)

    Show SEARCH=FUZZY in IMAP capabilities only when FTS backend actually
    supports it.


M	configure.in
M	src/imap/imap-client.c
M	src/lib-storage/mail-user.h
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-storage.c

2012-02-28 06:52:43 +0200 Timo Sirainen <tss@iki.fi> (9ea0fe2)

    mailbox list indexes: Avoid unnecessary refresh flag writes.


M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2012-02-28 05:27:03 +0200 Timo Sirainen <tss@iki.fi> (aa01a43)

    lib-lda: Fixed mai forward/reject to work with the new smtp_client_open()
    API.


M	src/lib-lda/mail-send.c

2012-02-28 05:21:19 +0200 Timo Sirainen <tss@iki.fi> (025668b)

    pop3-login: Fixed APOP authentication, broken by recent changes.


M	src/pop3-login/client.c

2012-02-28 05:14:00 +0200 Timo Sirainen <tss@iki.fi> (01c1406)

    Compiler warning fixes


M	src/doveadm/dsync/doveadm-dsync.c

2012-02-28 04:29:12 +0200 Timo Sirainen <tss@iki.fi> (42ec79d)

    fs layout: Mailbox listing returned duplicates when patterns contained a
    parent and its children.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-02-27 16:53:50 +0200 Timo Sirainen <tss@iki.fi> (02967c3)

    auth worker: reset idle time after running a command, not before.


M	src/auth/auth-worker-client.c

2012-02-27 16:52:44 +0200 Timo Sirainen <tss@iki.fi> (12d38e7)

    auth worker: When idle_kill timeout is reached, change process title to
    indicate it.


M	src/auth/auth-worker-client.c

2012-02-27 16:31:33 +0200 Timo Sirainen <tss@iki.fi> (933de3f)

    mysql: Log idle time also for CR_SERVER_LOST errors.


M	src/lib-sql/driver-mysql.c

2012-02-27 14:40:19 +0200 Timo Sirainen <tss@iki.fi> (bf99ab4)

    dsync: Removed accidentally committed debug code.


M	src/doveadm/dsync/doveadm-dsync.c

2012-02-27 14:38:05 +0200 Timo Sirainen <tss@iki.fi> (69f200b)

    dsync: Fixes to handling legacy dsync parameters.


M	src/doveadm/dsync/doveadm-dsync.c

2012-02-27 14:37:45 +0200 Timo Sirainen <tss@iki.fi> (290ce42)

    doveadm: Allow subcommands to specify '+' getopt parameter.


M	src/doveadm/doveadm-mail.c

2012-02-27 13:34:20 +0200 Timo Sirainen <tss@iki.fi> (b05f982)

    lib-ssl-iostream: Use SSL_LIBS when linking the shared library.


M	src/lib-ssl-iostream/Makefile.am

2012-02-27 12:02:07 +0200 Timo Sirainen <tss@iki.fi> (fe99b6c)

    lib-lda: smtp_client_open() API changed to return struct ostream, not FILE.


M	src/lib-lda/smtp-client.c
M	src/lib-lda/smtp-client.h

2012-02-27 11:48:18 +0200 Timo Sirainen <tss@iki.fi> (af1699c)

    auth: Removed destuser check from proxy_maybe's "self" check.


M	src/auth/auth-request.c

2012-02-27 11:37:02 +0200 Timo Sirainen <tss@iki.fi> (43fe4d8)

    dovecot-config: moved lib-auth and LIBDOVECOT_SERVICE_INCLUDEs to
    LIBDOVECOT_INCLUDE


M	dovecot-config.in.in

2012-02-27 11:33:34 +0200 Timo Sirainen <tss@iki.fi> (7d102c6)

    lib-dns: dns_lookup() returns now the lookup struct, and it can be aborted.
    Changed all dns_lookup() users also to abort the lookup when needed
    (previously it probably would have just accessed freed memory and crash).


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/lib-dns/dns-lookup.c
M	src/lib-dns/dns-lookup.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-lda/lmtp-client.c
M	src/lib-storage/index/pop3c/pop3c-client.c

2012-02-27 10:36:09 +0200 Timo Sirainen <tss@iki.fi> (c1faff0)

    Minor code cleanup.


M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c

2012-02-27 10:32:03 +0200 Timo Sirainen <tss@iki.fi> (6f2e601)

    pop3: Added module contexts to struct client, and made client_destroy() a
    virtual method.


M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h
M	src/pop3/pop3-common.h

2012-02-27 10:30:57 +0200 Timo Sirainen <tss@iki.fi> (00baa9c)

    imap: Made client_destroy() a virtual method.


M	src/imap/imap-client.c
M	src/imap/imap-client.h

2012-02-26 04:59:36 +0200 Timo Sirainen <tss@iki.fi> (9438eca)

    lib-storage: Removed min_timeout parameter from mailbox_notify_changes()
    It's now internally taken from mailbox_idle_check_interval setting.


M	src/imap/cmd-idle.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/plugins/virtual/virtual-storage.c

2012-02-25 07:36:11 +0200 Timo Sirainen <tss@iki.fi> (73f0217)

    Merged fixes from v2.1 tree.


2012-02-25 07:29:15 +0200 Timo Sirainen <tss@iki.fi> (64437b1)

    imap-login: imap_id_* settings were ignored pre-login.


M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-login-settings.h

2012-02-25 07:08:27 +0200 Timo Sirainen <tss@iki.fi> (113fdc6)

    auth: Added proxy_always extra field. When used with proxy_maybe, it can be
    used to redirect "local" users to local backends via director.


M	src/auth/auth-request.c
M	src/auth/auth-request.h

2012-02-25 07:08:27 +0200 Timo Sirainen <tss@iki.fi> (8ce84ce)

    auth: Added proxy_always extra field. When used with proxy_maybe, it can be
    used to redirect "local" users to local backends via director.


M	src/auth/auth-request.c
M	src/auth/auth-request.h

2012-02-25 06:54:52 +0200 Timo Sirainen <tss@iki.fi> (ddbdc64)

    imap/pop3/lmtp proxy: Implemented detection of proxy loops with TTL. If
    proxying tries to continue after 5 forward connections, it fails. The limit
    of 5 is hard coded currently.


M	src/imap-login/client.c
M	src/imap-login/imap-proxy.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h
M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-proxy.h
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/login-proxy.c
M	src/login-common/login-proxy.h
M	src/pop3-login/client.c
M	src/pop3-login/pop3-proxy.c

2012-02-25 06:41:59 +0200 Timo Sirainen <tss@iki.fi> (f80bf96)

    pop3 proxy: Fixed previous change not to hang.


M	src/pop3-login/pop3-proxy.c

2012-02-25 06:41:59 +0200 Timo Sirainen <tss@iki.fi> (ac84cb7)

    pop3 proxy: Fixed previous change not to hang.


M	src/pop3-login/pop3-proxy.c

2012-02-25 06:39:00 +0200 Timo Sirainen <tss@iki.fi> (2510f24)

    pop3 proxy: Fixed handling XCLIENT reply.


M	src/pop3-login/client.h
M	src/pop3-login/pop3-proxy.c

2012-02-25 06:39:00 +0200 Timo Sirainen <tss@iki.fi> (ab45534)

    pop3 proxy: Fixed handling XCLIENT reply.


M	src/pop3-login/client.h
M	src/pop3-login/pop3-proxy.c

2012-02-25 05:42:05 +0200 Timo Sirainen <tss@iki.fi> (738cfeb)

    auth: Added auth_proxy_self setting to specify IPs that are considered as
    "self" for proxy_maybe.


M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/config/settings-get.pl

2012-02-25 05:42:05 +0200 Timo Sirainen <tss@iki.fi> (170bdf3)

    auth: Added auth_proxy_self setting to specify IPs that are considered as
    "self" for proxy_maybe.


M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/config/settings-get.pl

2012-02-25 05:13:39 +0200 Timo Sirainen <tss@iki.fi> (ca85243)

    dns: Removed login/dns-client socket, since it's no longer necessary.


M	src/dns/dns-client-settings.c

2012-02-25 05:13:27 +0200 Timo Sirainen <tss@iki.fi> (38c92ae)

    login proxy: Removed host DNS lookup code, since auth does it now.


M	src/login-common/Makefile.am
M	src/login-common/client-common-auth.c
M	src/login-common/login-proxy.c
M	src/login-common/login-proxy.h

2012-02-25 05:11:59 +0200 Timo Sirainen <tss@iki.fi> (3368620)

    auth: Use proxy_timeout as DNS lookup timeout, if available. Warn if lookup
    takes >0.5s.


M	src/auth/auth-request.c

2012-02-25 05:11:59 +0200 Timo Sirainen <tss@iki.fi> (5a36aec)

    auth: Use proxy_timeout as DNS lookup timeout, if available. Warn if lookup
    takes >0.5s.


M	src/auth/auth-request.c

2012-02-25 05:04:15 +0200 Timo Sirainen <tss@iki.fi> (91233a8)

    auth: Handle proxy_maybe=yes with host=hostname properly.


M	src/auth/Makefile.am
M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h

2012-02-25 05:20:47 +0200 Timo Sirainen <tss@iki.fi> (ad9da73)

    pop3-login: Implemented XCLIENT command for forwarding client ip/port from
    proxy.


M	src/pop3-login/client.c
M	src/pop3-login/client.h
M	src/pop3-login/pop3-proxy.c

2012-02-25 05:04:15 +0200 Timo Sirainen <tss@iki.fi> (8be0af2)

    auth: Handle proxy_maybe=yes with host=hostname properly.


M	src/auth/Makefile.am
M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h

2012-02-25 04:38:01 +0200 Timo Sirainen <tss@iki.fi> (54dbde5)

    auth: auth_stream_reply_remove() left extra TABs to stream. Normally this
    wouldn't really affect anything, except log some extra debug messages.


M	src/auth/auth-stream.c

2012-02-25 04:38:01 +0200 Timo Sirainen <tss@iki.fi> (c5c670d)

    auth: auth_stream_reply_remove() left extra TABs to stream. Normally this
    wouldn't really affect anything, except log some extra debug messages.


M	src/auth/auth-stream.c

2012-02-25 03:46:10 +0200 Timo Sirainen <tss@iki.fi> (12c6ef6)

    login-common: Code cleanup


M	src/login-common/client-common.c
M	src/login-common/client-common.h

2012-02-25 03:45:13 +0200 Timo Sirainen <tss@iki.fi> (01cd9d4)

    pop3-login: Implemented XCLIENT command for forwarding client ip/port from
    proxy.


M	src/pop3-login/client.c
M	src/pop3-login/client.h
M	src/pop3-login/pop3-proxy.c

2012-02-23 15:26:52 +0200 Timo Sirainen <tss@iki.fi> (7aeb103)

    login proxy: If connect() fails, log how many seconds it tried.


M	src/login-common/login-proxy.c

2012-02-23 11:59:10 +0200 Timo Sirainen <tss@iki.fi> (3322dfd)

    lmtp proxy: Send client's IP/port to destination server via XCLIENT if
    possible.


M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-proxy.h

2012-02-23 11:58:35 +0200 Timo Sirainen <tss@iki.fi> (e772b0a)

    smtp/lmtp client: Send XCLIENT ADDR+PORT when possible.


M	src/lib-lda/lmtp-client.c
M	src/lib-lda/lmtp-client.h

2012-02-23 11:12:04 +0200 Timo Sirainen <tss@iki.fi> (b015d3d)

    lmtp: Implemented Postfix-compatible XCLIENT extension for changing client's
    ip/port.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c
M	src/lmtp/commands.h
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h

2012-02-23 10:35:29 +0200 Timo Sirainen <tss@iki.fi> (a55a990)

    Added signature for changeset 04b0acc03f1e


M	.hgsigs

2012-02-23 10:35:24 +0200 Timo Sirainen <tss@iki.fi> (ca1f191)

    Added tag 2.1.1 for changeset 04b0acc03f1e


M	.hgtags

2012-02-23 10:35:24 +0200 Timo Sirainen <tss@iki.fi> (4a9e1ff)

    Released v2.1.1.


M	NEWS
M	configure.in

2012-02-22 22:34:47 +0000 Pascal Volk <user@localhost.localdomain.org> (7c8f4fa)

    man: Added description of command `log errors' to doveadm-log.1.


M	doc/man/doveadm-log.1.in

2012-02-21 22:58:05 +0200 Timo Sirainen <tss@iki.fi> (aa01480)

    Compiler warning fix.


M	src/lib-storage/index/dbox-single/sdbox-sync.c

2012-02-21 22:50:14 +0200 Timo Sirainen <tss@iki.fi> (d598638)

    lib-storage: Another try at correctly setting autocreated namespace's
    location strings.


M	src/lib-storage/mail-namespace.c

2012-02-21 15:21:19 +0200 Timo Sirainen <tss@iki.fi> (6f0ce13)

    sdbox: Altmove flag changes weren't immediately marked as synced. This
    caused the altmoves to be retried.


M	src/lib-storage/index/dbox-single/sdbox-sync.c

2012-02-21 11:35:21 +0200 Timo Sirainen <tss@iki.fi> (31a1206)

    auth: If auth_cache_size is larger than process VSZ limit, log a warning.


M	src/auth/passdb-cache.c

2012-02-21 11:35:05 +0200 Timo Sirainen <tss@iki.fi> (c11f600)

    Added restrict_get_process_size()


M	src/lib/restrict-process-size.c
M	src/lib/restrict-process-size.h

2012-02-21 11:15:56 +0200 Timo Sirainen <tss@iki.fi> (093cb46)

    auth: passdb imap crashed for non-login (non-imap/pop3) authentication.


M	src/auth/passdb-imap.c

2012-02-21 11:08:05 +0200 Timo Sirainen <tss@iki.fi> (a13e154)

    file-dotlock: Avoid "timestamp is different than current time" errors during
    high disk I/O load.


M	src/lib/file-dotlock.c

2012-02-21 03:07:49 +0200 Timo Sirainen <tss@iki.fi> (382dde8)

    lib-storage: Avoid assert-crashing with non-mUTF7/UTF8 entries in
    subscriptions file.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2012-02-21 02:59:25 +0200 Timo Sirainen <tss@iki.fi> (b56f7fb)

    lib-storage: When autocreating a namespace, don't fill out location setting
    unless necessary. This fixes running dsync when there are no namespaces
    defined.


M	src/lib-storage/mail-namespace.c

2012-02-21 02:43:52 +0200 Timo Sirainen <tss@iki.fi> (77d20bf)

    virtual: "*" wildcard matches now also autocreated shared namespaces.
    Basically this makes "shared/*" work as intended for shared namespaces.


M	src/plugins/virtual/virtual-config.c

2012-02-21 00:13:36 +0000 Pascal Volk <user@localhost.localdomain.org> (27255a0)

    man: Added description for type `dbox' to doveadm-dump.1


M	doc/man/doveadm-dump.1.in

2012-02-21 02:15:54 +0200 Timo Sirainen <tss@iki.fi> (9a8727a)

    ldap: Support attr=name=prefix style template attributes for backwards
    compatibility. This was mainly used for quota, e.g.
    "quotaBytes=quota=*:storage="


M	src/auth/db-ldap.c

2012-02-20 23:39:20 +0000 Pascal Volk <user@localhost.localdomain.org> (4f77d2f)

    doveadm dump: Show available types in case a wrong one was given.


M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-dump.h

2012-02-20 23:34:38 +0200 Timo Sirainen <tss@iki.fi> (421660d)

    man: Move doveadm instance and mount commands to "master commands" group.


M	doc/man/doveadm.1.in

2012-02-17 01:19:59 +0200 Timo Sirainen <tss@iki.fi> (5ff22d6)

    lib-master: If accept() fails, stop listening only temporarily, not
    permanently.


M	src/lib-master/master-service.c

2012-02-17 01:14:02 +0200 Timo Sirainen <tss@iki.fi> (aa4682f)

    Increased initial memory pool size.


M	src/lib-storage/index/shared/shared-list.c

2012-02-17 01:13:51 +0200 Timo Sirainen <tss@iki.fi> (1770610)

    master: Handle internal "out of fds" errors without crashing.


M	src/master/service-monitor.c

2012-02-16 23:05:17 +0000 Pascal Volk <user@localhost.localdomain.org> (7026734)

    man/Makefile: Use SUFFIXES to reduce the number of targets.


M	doc/man/Makefile.am

2012-02-17 00:46:46 +0200 Timo Sirainen <tss@iki.fi> (f55fac3)

    login: Added comment.


M	src/login-common/main.c

2012-02-17 00:34:24 +0200 Timo Sirainen <tss@iki.fi> (f8aa344)

    dsync: If message with same GUID is saved multiple times in session, copy it
    instead of re-saving. This only works if the messages are in different
    mailboxes. It would be possible to fix it also for copying within same
    mailbox, but that's probably rare enough that it's not worth the extra code.


M	src/doveadm/dsync/dsync-brain-msgs-new.c
M	src/doveadm/dsync/dsync-brain-msgs.c
M	src/doveadm/dsync/dsync-brain-private.h

2012-02-17 00:32:06 +0200 Timo Sirainen <tss@iki.fi> (cbcd7b1)

    dsync: GUIDs are case-sensitive, make GUID hash table be as well.


M	src/doveadm/dsync/dsync-brain-msgs.c

2012-02-17 00:30:54 +0200 Timo Sirainen <tss@iki.fi> (e6825aa)

    doveadm force-resync: Don't skip autocreated mailboxes (especially INBOX).
    This fixes rebuilding indexes for mdbox that has all mailbox indexes
    deleted.


M	src/doveadm/doveadm-mail.c

2012-02-16 20:04:01 +0200 Timo Sirainen <tss@iki.fi> (6c0809e)

    acl: Don't crash in mailbox listing when using autocreated mailboxes.


M	src/plugins/acl/acl-mailbox-list.c

2012-02-16 19:16:54 +0200 Timo Sirainen <tss@iki.fi> (f40aa13)

    Messed up with v2.1 release, merging changes that were supposed to be there.


2012-02-16 18:40:29 +0200 Timo Sirainen <tss@iki.fi> (50823df)

    Added signature for changeset e2cd03cc9c69


M	.hgsigs

2012-02-16 18:40:25 +0200 Timo Sirainen <tss@iki.fi> (a438a4d)

    Added tag 2.1.0 for changeset e2cd03cc9c69


M	.hgtags

2012-02-16 18:40:25 +0200 Timo Sirainen <tss@iki.fi> (0e39414)

    Released v2.1.0.


M	NEWS
M	configure.in

2012-02-16 18:31:57 +0200 Timo Sirainen <tss@iki.fi> (e0579d4)

    man: Added doveadm-instance(1) and doveadm-mount(1) roff'ification by Pascal
    Volk.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-instance.1.in
A	doc/man/doveadm-mount.1.in
M	doc/man/doveadm.1.in

2012-02-16 18:10:09 +0200 Timo Sirainen <tss@iki.fi> (6ffebd0)

    fs layout: Fixed crash when autocreate mailboxes were used and LIST had only
    invalid patterns.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-02-15 05:49:20 +0200 Timo Sirainen <tss@iki.fi> (41ed5e8)

    Added signature for changeset 736f1b7af190


M	.hgsigs

2012-02-15 05:49:17 +0200 Timo Sirainen <tss@iki.fi> (a49877a)

    Added tag 2.1.rc7 for changeset 736f1b7af190


M	.hgtags

2012-02-15 05:49:17 +0200 Timo Sirainen <tss@iki.fi> (57281a7)

    Released v2.1.rc7.


M	NEWS
M	configure.in

2012-02-15 05:12:14 +0200 Timo Sirainen <tss@iki.fi> (717bb0d)

    login: If auth client disconnects without having ever succeeded, destroy
    clients.


M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/main.c

2012-02-15 04:32:14 +0200 Timo Sirainen <tss@iki.fi> (3c9c62c)

    lib-master: Fixed crash on IPC client if server disconnected unexpectedly.


M	src/lib-master/ipc-client.c

2012-02-13 21:40:02 +0000 Pascal Volk <user@localhost.localdomain.org> (b909752)

    man: Added descriptions of -t option to doveadm-pw.1.


M	doc/man/doveadm-pw.1.in

2012-02-13 20:40:54 +0000 Pascal Volk <user@localhost.localdomain.org> (153449b)

    doveadm pw: Added -t <hash> parameter to the usage message.


M	src/doveadm/doveadm-pw.c

2012-02-13 19:59:13 +0000 Pascal Volk <user@localhost.localdomain.org> (548c6a2)

    man: Added description of fields pop3.uidl and text.utf8 to doveadm-fetch.1.


M	doc/man/doveadm-fetch.1.in

2012-02-13 18:27:44 +0200 Timo Sirainen <tss@iki.fi> (626216c)

    pop3: If UIDL using %f/%m/%g can't be fetched, mention pop3_uidl_format in
    error message.


M	src/pop3/pop3-commands.c

2012-02-13 18:28:01 +0200 Timo Sirainen <tss@iki.fi> (5979c7d)

    TODO updated


M	TODO

2012-02-13 14:34:31 +0200 Timo Sirainen <tss@iki.fi> (de83c1e)

    lib-storage: Added namespace { ignore_on_failure } setting. If the namespace
    can't be created for any reason, it's simply silently skipped.


M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h

2012-02-13 00:40:03 +0200 Timo Sirainen <tss@iki.fi> (0e0606d)

    message parser: Added MESSAGE_PARSER_FLAG_INCLUDE_MULTIPART_BLOCKS. Patch by
    Stephan Bosch.


M	src/lib-mail/message-parser.c
M	src/lib-mail/message-parser.h

2012-02-13 00:29:55 +0200 Timo Sirainen <tss@iki.fi> (9f627b3)

    login-common API made more extensible for different kinds of protocols.
    Patch by Stephan Bosch.


M	src/imap-login/client-authenticate.c
M	src/imap-login/client-authenticate.h
M	src/imap-login/client.c
M	src/imap-login/client.h
M	src/imap-login/imap-proxy.c
M	src/imap-login/imap-proxy.h
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client-authenticate.h
M	src/pop3-login/client.c
M	src/pop3-login/client.h
M	src/pop3-login/pop3-proxy.c
M	src/pop3-login/pop3-proxy.h

2012-02-12 23:23:25 +0200 Timo Sirainen <tss@iki.fi> (03e877d)

    Updated version number to v2.2.UNSTABLE and added a warning to configure.


M	configure.in

2012-02-12 23:04:13 +0200 Timo Sirainen <tss@iki.fi> (03c15b6)

    README: Added missing RFC to list.


M	README

2012-02-12 23:03:55 +0200 Timo Sirainen <tss@iki.fi> (ec1b8dd)

    TODO updated


M	TODO

2012-02-12 22:35:54 +0200 Timo Sirainen <tss@iki.fi> (309c4ae)

    Added signature for changeset 481860782250


M	.hgsigs

2012-02-12 22:35:52 +0200 Timo Sirainen <tss@iki.fi> (e09de8a)

    Added tag 2.1.rc6 for changeset 481860782250


M	.hgtags

2012-02-12 22:35:52 +0200 Timo Sirainen <tss@iki.fi> (c75f35b)

    Released v2.1.rc6.


M	NEWS
M	TODO
M	configure.in

2012-02-12 22:34:33 +0200 Timo Sirainen <tss@iki.fi> (899ebc9)

    IMAP capabilities: s/FUZZY/SEARCH=FUZZY/ I mistakenly used wrong one..


M	configure.in

2012-02-12 22:16:51 +0200 Timo Sirainen <tss@iki.fi> (9f00f20)

    doveadm mailbox delete: Don't crash when namespace for mailbox isn't found.


M	src/doveadm/doveadm-mail-mailbox.c

2012-02-12 21:10:22 +0200 Timo Sirainen <tss@iki.fi> (5fbccc9)

    doveadm: Improved error handling. Failures should now always have non-zero
    exit code. doveadm now uses sysexits.h exit codes in most places, although
    there are still a lot of places where it simply returns EX_TEMPFAIL even
    though something else might be better.


M	src/doveadm/Makefile.am
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-iter.h
D	src/doveadm/doveadm-mail-list-iter.h
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-move.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
R063	src/doveadm/doveadm-mail-list-iter.c	src/doveadm/doveadm-mailbox-list-iter.c
A	src/doveadm/doveadm-mailbox-list-iter.h
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/main.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/quota/doveadm-quota.c

2012-02-12 19:20:03 +0200 Timo Sirainen <tss@iki.fi> (e17a0e2)

    doveadm pw: Use i_error()/i_fatal() instead of fprintf(stderr)


M	src/doveadm/doveadm-pw.c

2012-02-12 19:16:34 +0200 Timo Sirainen <tss@iki.fi> (b53bec9)

    acl: After checking we have rights to create mailbox, ignore any further ACL
    checks.


M	src/plugins/acl/acl-mailbox.c

2012-02-12 18:59:20 +0200 Timo Sirainen <tss@iki.fi> (dcfab5d)

    example-config: Updated tb-extra-mailbox-sep comment.


M	doc/example-config/conf.d/20-imap.conf

2012-02-12 18:55:28 +0200 Timo Sirainen <tss@iki.fi> (5f58703)

    Updated copyright notices to include year 2012.


M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-postfix-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-stream.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-external.c
M	src/auth/mech-plain.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-imap.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-template.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-template.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-list-iter.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-move.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm.c
M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-brain-msgs-new.c
M	src/doveadm/dsync/dsync-brain-msgs.c
M	src/doveadm/dsync/dsync-brain.c
M	src/doveadm/dsync/dsync-data.c
M	src/doveadm/dsync/dsync-proxy-client.c
M	src/doveadm/dsync/dsync-proxy-server-cmd.c
M	src/doveadm/dsync/dsync-proxy-server.c
M	src/doveadm/dsync/dsync-proxy.c
M	src/doveadm/dsync/dsync-worker-local.c
M	src/doveadm/dsync/dsync-worker.c
M	src/doveadm/dsync/test-dsync-brain-msgs.c
M	src/doveadm/dsync/test-dsync-brain.c
M	src/doveadm/dsync/test-dsync-common.c
M	src/doveadm/dsync/test-dsync-proxy-server-cmd.c
M	src/doveadm/dsync/test-dsync-proxy.c
M	src/doveadm/dsync/test-dsync-worker.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-uid.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-x-cancel.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-settings.c
M	src/indexer/indexer-worker-settings.c
M	src/indexer/indexer-worker.c
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-pool.c
M	src/ipc/client.c
M	src/ipc/ipc-connection.c
M	src/ipc/ipc-group.c
M	src/ipc/ipc-settings.c
M	src/ipc/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-send.c
M	src/lib-mail/message-size.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/ipc-client.c
M	src/lib-master/ipc-server.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service.c
M	src/lib-master/syslog-util.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-openssl-params.c
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl-none.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-storage/fail-mail-storage.c
M	src/lib-storage/fail-mail.c
M	src/lib-storage/fail-mailbox.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-attachment.c
M	src/lib-storage/index/istream-mail.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5-all.c
M	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-mail.c
M	src/lib-storage/index/pop3c/pop3c-settings.c
M	src/lib-storage/index/pop3c/pop3c-storage.c
M	src/lib-storage/index/pop3c/pop3c-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/test-mailbox-get.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base64.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/close-keep-errno.c
M	src/lib/compat.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fd-set-nonblock.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/guid.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream-rawlog.c
M	src/lib/iostream.c
M	src/lib/ipwd.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-rawlog.c
M	src/lib/istream-seekable.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/network.c
M	src/lib/nfs-workarounds.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream-rawlog.c
M	src/lib/ostream.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base64.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-hash-format.c
M	src/lib/test-hex-binary.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-network.c
M	src/lib/test-ostream-file.c
M	src/lib/test-primes.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-time-util.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/time-util.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/log-connection.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-build-mail.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-indexer.c
M	src/plugins/fts/fts-parser-html.c
M	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search-serialize.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/xml2text.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/stats/stats-connection.c
M	src/plugins/stats/stats-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c
M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-openssl.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/stats/client-export.c
M	src/stats/client.c
M	src/stats/global-memory.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-server-connection.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.c
M	src/stats/mail-user.c
M	src/stats/main.c
M	src/stats/stats-settings.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2012-02-12 18:26:22 +0200 Timo Sirainen <tss@iki.fi> (6cc815e)

    lib-lda: Send DSN only for out-of-quota errors. Send MDN for Sieve rejects.


M	src/lda/main.c
M	src/lib-lda/mail-deliver.h
M	src/lib-lda/mail-send.c

2012-02-12 07:25:40 +0200 Timo Sirainen <tss@iki.fi> (3285019)

    example-config: Updated instance_name setting's comments.


M	doc/example-config/dovecot.conf

2012-02-12 07:12:41 +0200 Timo Sirainen <tss@iki.fi> (5aa7c8c)

    Make static analyzer happier.


M	src/lib-storage/index/index-thread-finish.c

2012-02-12 07:05:07 +0200 Timo Sirainen <tss@iki.fi> (6682872)

    lda: If DSN is sent because user is out of quota, send 5.2.2 as Status.


M	src/lda/main.c
M	src/lib-lda/mail-deliver.h
M	src/lib-lda/mail-send.c

2012-02-12 07:00:12 +0200 Timo Sirainen <tss@iki.fi> (aed9c42)

    lib-lda: Send DSN instead of MDN for rejections. I had just copy&pasted the
    MDN sending from Cyrus..


M	src/lib-lda/mail-send.c

2012-02-12 06:59:32 +0200 Timo Sirainen <tss@iki.fi> (4c261fb)

    lib-storage: "Invalid userdb input" showed wrong input in the error message.


M	src/lib-storage/mail-storage-service.c

2012-02-12 06:51:05 +0200 Timo Sirainen <tss@iki.fi> (6b8043a)

    sdbox: Fixed sdbox_read_header() randomly failing.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2012-02-12 06:47:22 +0200 Timo Sirainen <tss@iki.fi> (4a3610a)

    lib-storage: Error handling fix.


M	src/lib-storage/fail-mailbox.c

2012-02-12 05:44:13 +0200 Timo Sirainen <tss@iki.fi> (6cffcee)

    dsync: Don't assert-crash if saving a message fails.


M	src/doveadm/dsync/dsync-worker-local.c

2012-02-12 05:35:54 +0200 Timo Sirainen <tss@iki.fi> (c54f888)

    director: Log an error if auth connection disconnects unexpectedly.


M	src/director/auth-connection.c

2012-02-12 05:17:46 +0200 Timo Sirainen <tss@iki.fi> (1caad3c)

    doveadm: Changes for previous expire plugin changes to actually work.


M	src/doveadm/doveadm-mail.c

2012-02-12 05:16:43 +0200 Timo Sirainen <tss@iki.fi> (d6a026d)

    sdbox: Don't assert-crash on index rebuild if u.X file exists in both
    primary and alt storage.


M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c

2012-02-12 04:58:17 +0200 Timo Sirainen <tss@iki.fi> (3c3002e)

    expire: Only go through users listed by userdb iteration. Delete dict rows
    for nonexistent users, unless expire_keep_nonexistent_users=yes.


M	src/plugins/expire/doveadm-expire.c

2012-02-12 04:18:50 +0200 Timo Sirainen <tss@iki.fi> (efa7704)

    doveadm acl: Added "add" and "remove" commands.


M	src/plugins/acl/doveadm-acl.c

2012-02-12 04:12:44 +0200 Timo Sirainen <tss@iki.fi> (5c3e746)

    doveadm acl set: Replace both positive and negative rights, not just one of
    them.


M	src/plugins/acl/doveadm-acl.c

2012-02-12 04:01:34 +0200 Timo Sirainen <tss@iki.fi> (3e1cc04)

    doveadm mailbox delete: Added -r parameter to recursively delete mailboxes.


M	src/doveadm/doveadm-mail-mailbox.c

2012-02-12 03:51:21 +0200 Timo Sirainen <tss@iki.fi> (c439de1)

    doveadm mailbox delete: Sort the mailbox parameters so that children are
    deleted first.


M	src/doveadm/doveadm-mail-mailbox.c

2012-02-12 03:47:01 +0200 Timo Sirainen <tss@iki.fi> (94fc678)

    message_id_get_next(): Fixed parsing message-ids with no-fold-quotes.


M	src/lib-mail/message-id.c
M	src/lib-mail/test-message-id.c

2012-02-12 03:29:36 +0200 Timo Sirainen <tss@iki.fi> (dc11d99)

    SSL: Enable SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS flag for extra security. This
    is to counter the "BEAST SSL" attack, although I don't think it's practical
    to implement against IMAP/POP3/LMTP protocols. There's really no way for
    attackers to inject any evil data before authentication, so the password is
    safe. Post-authentication attacker could cause clients to download evil
    emails, but even then clients don't typically redownload some specific mail,
    so there's really no way to extract anything useful.


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/login-common/ssl-proxy-openssl.c

2012-02-12 02:53:50 +0200 Timo Sirainen <tss@iki.fi> (2db692a)

    doveadm: Use MAILBOX_LIST_ITER_LIST_PREFIXES when iterating through
    mailboxes. This means that if there exists a mailbox in namespace prefix
    itself, those mailboxes can be accessed. Also "doveadm mailbox list" shows
    all namespace prefixes.

    Note that wildcards match only within namespace, so e.g. '*' will never 
    match any namespace prefix, because it works within the prefix="" namespace.

M	src/doveadm/doveadm-mail-list-iter.c

2012-02-12 02:50:49 +0200 Timo Sirainen <tss@iki.fi> (4a365e6)

    lib-storage: Added MAILBOX_LIST_ITER_LIST_PREFIXES flag.


M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list.h

2012-02-12 02:30:34 +0200 Timo Sirainen <tss@iki.fi> (2caf285)

    doveadm: Removed unnecessary code. "mailbox/" is no longer included in
    listing by default.


M	src/doveadm/doveadm-mail-list-iter.c

2012-02-12 02:22:43 +0200 Timo Sirainen <tss@iki.fi> (12b380e)

    doveadm pw: Added -t <hash> parameter to test if a hash matches to given
    plaintext. Based on patch by Jimmy Thrasibule


M	src/doveadm/doveadm-pw.c

2012-02-09 21:29:25 +0200 Timo Sirainen <tss@iki.fi> (d00ae13)

    shared: Allocate mailbox as fail_mailbox. This fixes crashes when a mailbox
    is attempted to be allocated from the shared namespace itself (e.g. the
    "shared" prefix).


M	src/lib-storage/index/shared/shared-storage.c

2012-02-09 21:28:44 +0200 Timo Sirainen <tss@iki.fi> (b2a476a)

    lib-storage: Renamed test-mail/mailbox/storage to fail-*


M	src/lib-storage/Makefile.am
R052	src/lib-storage/test-mail-storage.c	src/lib-storage/fail-mail-storage.c
A	src/lib-storage/fail-mail-storage.h
R052	src/lib-storage/test-mail.c	src/lib-storage/fail-mail.c
R052	src/lib-storage/test-mailbox.c	src/lib-storage/fail-mailbox.c
D	src/lib-storage/test-mail-storage.h

2012-02-09 21:13:12 +0200 Timo Sirainen <tss@iki.fi> (c529313)

    Increased initial memory pool size.


M	src/plugins/virtual/virtual-storage.c

2012-02-09 20:38:16 +0200 Timo Sirainen <tss@iki.fi> (10ccc94)

    dsync: Fixed a potential assert crash when saving mails.


M	src/doveadm/dsync/dsync-worker-local.c

2012-02-09 20:37:24 +0200 Timo Sirainen <tss@iki.fi> (9047d77)

    dbox: If saving is aborted, don't add a broken record about it to index.


M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-save.c

2012-02-09 20:21:14 +0200 Timo Sirainen <tss@iki.fi> (3cfc375)

    quota: If "quota" setting's value is empty, assume quota is wanted to be
    disabled.


M	src/plugins/quota/quota.c

2012-02-09 19:32:25 +0200 Timo Sirainen <tss@iki.fi> (4abfd8f)

    snarf: Keep the mailbox locked during snarfing to avoid duplicates.


M	src/plugins/snarf/snarf-plugin.c

2012-02-09 16:27:54 +0200 Timo Sirainen <tss@iki.fi> (aa03893)

    imap: Handle invalid APPEND parameters a little nicer.


M	src/imap/cmd-append.c

2012-02-09 15:53:18 +0200 Timo Sirainen <tss@iki.fi> (3cd0737)

    configure: Avoid some unnecessary warnings with clang.


M	configure.in

2012-02-09 05:33:54 +0200 Timo Sirainen <tss@iki.fi> (b6cfbf3)

    auth: password_verify() now returns error string also for password
    mismatches.


M	src/auth/password-scheme.c

2012-02-09 05:27:32 +0200 Timo Sirainen <tss@iki.fi> (2321e7b)

    doveadm pw: Minor code cleanups.


M	src/doveadm/doveadm-pw.c

2012-02-09 05:25:17 +0200 Timo Sirainen <tss@iki.fi> (aecea0d)

    doveadm pw: Improved error messages.


M	src/doveadm/doveadm-pw.c

2012-02-09 05:21:22 +0200 Timo Sirainen <tss@iki.fi> (cbcc083)

    doveadm proxy list: Avoid hanging if we can't connect to ipc socket.


M	src/doveadm/doveadm-proxy.c

2012-02-09 05:16:59 +0200 Timo Sirainen <tss@iki.fi> (1043182)

    lib-master no longer uses 's' option, but it wasn't removed from getopt
    string.


M	src/lib-master/master-service.c

2012-02-09 05:07:57 +0200 Timo Sirainen <tss@iki.fi> (31663a4)

    INSTALL: Updated outdated documentation.


M	INSTALL

2012-02-09 05:04:42 +0200 Timo Sirainen <tss@iki.fi> (1cfa65c)

    acl: Avoid assert-crashing when trying to access invalid mailbox names.


M	src/plugins/acl/acl-backend-vfile.c

2012-02-09 04:26:39 +0200 Timo Sirainen <tss@iki.fi> (cc5fc3c)

    doveadm index: Changed help text to make it clear that mailbox can have
    wildcards.


M	src/doveadm/doveadm-mail-index.c

2012-02-09 04:26:12 +0200 Timo Sirainen <tss@iki.fi> (db45f46)

    doveadm force-resync: Support wildcards in mailbox names.


M	src/doveadm/doveadm-mail.c

2012-02-09 04:13:28 +0200 Timo Sirainen <tss@iki.fi> (0f17bb1)

    lib-storage: Trying to access shared mailboxes of nonexistent users crashed.
    This was broken by commit 18078d6cce84.


M	src/lib-storage/index/shared/shared-storage.c

2012-02-09 03:56:50 +0200 Timo Sirainen <tss@iki.fi> (32b60b9)

    doveadm mailbox list without pattern shows now all shared and public
    mailboxes also. doveadm mailbox list '*' shows only the one matching
    namespace.


M	src/doveadm/doveadm-mail-list-iter.c

2012-02-09 03:44:09 +0200 Timo Sirainen <tss@iki.fi> (20d255b)

    mdbox: Fixed finding appendable m.* files in alt storage.


M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c

2012-02-09 02:58:36 +0200 Timo Sirainen <tss@iki.fi> (9743e5a)

    mbox: Added mbox_md5 setting to select headers for MD5 generation.


M	doc/example-config/conf.d/10-mail.conf
M	src/lib-storage/index/mbox/Makefile.am
A	src/lib-storage/index/mbox/mbox-md5-all.c
R087	src/lib-storage/index/mbox/mbox-md5.c	src/lib-storage/index/mbox/mbox-md5-apop3d.c
M	src/lib-storage/index/mbox/mbox-md5.h
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-settings.h
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-storage.h
M	src/lib-storage/index/mbox/mbox-sync-parse.c

2012-02-09 02:34:23 +0200 Timo Sirainen <tss@iki.fi> (20dbb2d)

    mdbox: Detect duplicate GUIDs for different messages. Don't delete these
    duplicates. Only the message size is used for detecting if they are
    duplicates or not, but since this shouldn't normally happen anyway this is
    good enough.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2012-02-09 02:25:18 +0200 Timo Sirainen <tss@iki.fi> (e43e0a4)

    mdbox: Small code cleanup to storage rebuild.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2012-02-09 02:21:37 +0200 Timo Sirainen <tss@iki.fi> (5768b83)

    mdbox: Avoid deferencing NULL pointer in specific corrupted mailboxes.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2012-02-09 01:23:00 +0200 Timo Sirainen <tss@iki.fi> (79be01e)

    dbox: Index rebuild now preserves caching decisions.


M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c

2012-02-09 01:21:41 +0200 Timo Sirainen <tss@iki.fi> (cb6b9d1)

    lib-index: mail_cache_open_and_verify() is now public.


M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.h

2012-02-09 01:00:14 +0200 Timo Sirainen <tss@iki.fi> (dbc6f14)

    dbox: Never rename() mail files over existing files. If such a file exists,
    rebuild indexes.


M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-file.c

2012-02-09 00:59:44 +0200 Timo Sirainen <tss@iki.fi> (8cb6274)

    mdbox: Fixed initial mailbox creation to work again without errors.


M	src/lib-storage/index/dbox-multi/mdbox-map.c

2012-02-09 00:41:25 +0200 Timo Sirainen <tss@iki.fi> (607a8bc)

    sdbox: Use mail_index_set_ext_init_data() to simplify opening mailboxes. Now
    the initial mailbox index can be created with the necessary sdbox header. If
    the header doesn't exist when opening a mailbox, it's guaranteed to be
    corrupted.


M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.h
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h

2012-02-09 00:39:52 +0200 Timo Sirainen <tss@iki.fi> (47e0598)

    lib-index: Added mail_index_set_ext_init_data() for adding data to index on
    creation. This can be used to avoid race conditions on mailbox creation for
    mailbox formats that require this (sdbox).


M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log-file.c

2012-02-09 00:38:30 +0200 Timo Sirainen <tss@iki.fi> (0b878c6)

    Increase initial memory pool sizes.


M	src/lib-index/mail-cache.c
M	src/lib-master/mountpoint-list.c

2012-02-08 23:27:22 +0200 Timo Sirainen <tss@iki.fi> (2efe19d)

    director: Fixed potential assert crash when moving a user to another
    backend.


M	src/director/main.c

2012-02-08 23:05:26 +0200 Timo Sirainen <tss@iki.fi> (d66ef20)

    iostreams: Set errno to stream_errno when exiting from failing functions.


M	src/lib/istream.c
M	src/lib/ostream.c

2012-02-08 22:50:20 +0200 Timo Sirainen <tss@iki.fi> (2b602d8)

    doveadm instance remove: Allow removing using name as well as base dir.


M	src/doveadm/doveadm-instance.c

2012-02-08 22:07:01 +0200 Timo Sirainen <tss@iki.fi> (fca3974)

    Removed unnecessary code.


M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.h

2012-02-06 22:41:18 +0200 Timo Sirainen <tss@iki.fi> (b18b7c9)

    sdbox: Fix a corrupted mailbox when opening it, instead of losing all of its
    contents.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2012-02-06 21:48:29 +0200 Timo Sirainen <tss@iki.fi> (5f252b9)

    doveadm instance list: Show the last used field.


M	src/doveadm/doveadm-instance.c

2012-02-06 21:45:49 +0200 Timo Sirainen <tss@iki.fi> (9b95d67)

    lib-master: Removed code to auto-drop instances from the list. There
    couldn't be any empty named instances, so it was a bit pointless.


M	src/lib-master/master-instance.c
M	src/lib-master/master-instance.h

2012-02-06 21:42:37 +0200 Timo Sirainen <tss@iki.fi> (b849b2f)

    master: If instance_name doesn't begin with "dovecot", add "dovecot-" prefix
    to process names.


M	src/master/main.c

2012-02-06 21:39:11 +0200 Timo Sirainen <tss@iki.fi> (96d1922)

    lib-master: Added -i parameter to read config by instance name rather than
    path.


M	src/lib-master/Makefile.am
M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c

2012-02-06 21:26:55 +0200 Timo Sirainen <tss@iki.fi> (d47a87c)

    Keep track of what Dovecot instances have been executed and their
    instance_name. doveadm instance command can be used to list/remove them.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-instance.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h
M	src/lib-master/Makefile.am
A	src/lib-master/master-instance.c
A	src/lib-master/master-instance.h
M	src/master/main.c

2012-02-06 21:25:37 +0200 Timo Sirainen <tss@iki.fi> (6a3c23e)

    log: Forgot to add new files to recent commit.


A	src/log/doveadm-connection.c
A	src/log/doveadm-connection.h
A	src/log/log-error-buffer.c
A	src/log/log-error-buffer.h

2012-02-06 19:34:18 +0200 Timo Sirainen <tss@iki.fi> (3fe7d0c)

    rawlog: Renamed -i / -o parameters to "-f in", "-f out" This is mainly to
    get give the -i parameter to lib-master.


M	src/util/rawlog.c

2012-02-06 19:30:12 +0200 Timo Sirainen <tss@iki.fi> (acba68a)

    log: Keep track of last 1000 errors/warnings. "doveadm log errors" shows
    them.


M	src/doveadm/doveadm-log.c
M	src/log/Makefile.am
M	src/log/log-connection.c
M	src/log/log-connection.h
M	src/log/log-settings.c
M	src/log/main.c

2012-02-06 19:28:40 +0200 Timo Sirainen <tss@iki.fi> (7cecac4)

    liblib: Added failure_log_type_names[] array.


M	src/lib/failures.c
M	src/lib/failures.h

2012-02-02 23:22:06 +0200 Timo Sirainen <tss@iki.fi> (2026684)

    pop3c: Fixes to handling filter streams for mail.


M	src/lib-storage/index/pop3c/pop3c-client.c
M	src/lib-storage/index/pop3c/pop3c-mail.c

2012-02-02 17:20:02 +0200 Timo Sirainen <tss@iki.fi> (9ec30d8)

    istream-seekable: If we panic about stream not being seekable, log the
    stream name/offset.


M	src/lib/istream-seekable.c

2012-02-02 17:19:22 +0200 Timo Sirainen <tss@iki.fi> (6d76233)

    pop3c: Last message wasn't visible.


M	src/lib-storage/index/pop3c/pop3c-client.c

2012-02-02 16:50:58 +0200 Timo Sirainen <tss@iki.fi> (067b80d)

    imapc: If base_dir isn't set, do a blocking DNS lookup. This is mostly a
    workaround for being able to run imapc from standalone programs (e.g.
    doveadm) without running Dovecot.


M	src/lib-storage/index/imapc/imapc-storage.c

2012-02-02 16:49:46 +0200 Timo Sirainen <tss@iki.fi> (a8bab60)

    lib-imap-client: If dns_client_socket_path isn't given, do a blocking
    lookup.


M	src/lib-imap-client/imapc-connection.c

2012-02-02 16:46:46 +0200 Timo Sirainen <tss@iki.fi> (c4ac0f2)

    doveadm fetch: Added support for hdr.*.utf8 fields.


M	src/doveadm/doveadm-mail-fetch.c

2012-02-02 16:26:33 +0200 Timo Sirainen <tss@iki.fi> (e1a4e5d)

    lib-storage: One more crashfix for recent maildir_name/mailbox_dir_name
    change.


M	src/lib-storage/mail-storage.c

2012-02-02 15:45:30 +0200 Timo Sirainen <tss@iki.fi> (63cf2e5)

    auth: Get LDAP attribute names automatically from template's %{ldap:attr}
    variables.


M	src/auth/db-ldap.c

2012-02-02 15:44:51 +0200 Timo Sirainen <tss@iki.fi> (9379459)

    var_expand*(): Allow table to be NULL (when using only func_table).


M	src/lib/var-expand.c

2012-02-02 15:28:10 +0200 Timo Sirainen <tss@iki.fi> (c349375)

    auth: LDAP fields can now access any returned LDAP attribtes with
    %{ldap:name}


M	src/auth/db-ldap.c

2012-02-02 15:27:27 +0200 Timo Sirainen <tss@iki.fi> (e130dc7)

    liblib: Added var_expand_with_funcs() to expand variables with function
    callbacks.


M	src/lib/var-expand.c
M	src/lib/var-expand.h

2012-02-02 15:25:04 +0200 Timo Sirainen <tss@iki.fi> (7c85bb5)

    ldap: Crashfixes to previous change.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2012-02-02 13:26:38 +0200 Timo Sirainen <tss@iki.fi> (e8c279d)

    imapc: Crashfix related to recent maildir_name/mailbox_dir_name changes.


M	src/lib-storage/index/imapc/imapc-list.c

2012-02-02 13:12:19 +0200 Timo Sirainen <tss@iki.fi> (9e28e13)

    config: In "key=<path" path is now relative to config file's directory.


M	src/config/config-parser.c

2012-02-02 01:07:37 +0200 Timo Sirainen <tss@iki.fi> (0a8926b)

    ldap: Support using the same LDAP attribute in multiple fields.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2012-02-01 23:33:51 +0200 Timo Sirainen <tss@iki.fi> (19b9d76)

    sdbox: Fixed moving files from alt storage to primary storage.


M	src/lib-storage/index/dbox-single/sdbox-sync.c

2012-02-01 23:06:12 +0200 Timo Sirainen <tss@iki.fi> (31ef688)

    stats plugin disabled calling other plugins' user.deinit() method.


M	src/plugins/stats/stats-plugin.c

2012-02-01 22:18:33 +0200 Timo Sirainen <tss@iki.fi> (63e2075)

    lib-storage: And another fix to previous maildir_name/mailbox_dir_name
    changes.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/mailbox-list.c

2012-02-01 22:04:26 +0200 Timo Sirainen <tss@iki.fi> (a23a481)

    ioloop: I/O and timeout leak messages now include the io_add()/timeout_add()
    source line number. This helps figuring out the leak especially when using
    ASLR. Also in 64bit systems there's no increased memory usage, because the
    line number replaces only padding.


M	src/lib/ioloop-private.h
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2012-02-01 21:27:45 +0200 Timo Sirainen <tss@iki.fi> (5214b67)

    lib-storage: Crashfix to previous change.


M	src/lib-storage/mailbox-list.c

2012-02-01 20:30:18 +0200 Timo Sirainen <tss@iki.fi> (318ef36)

    lib-storage: Abort index/control/alt root dir creation if mountpoint isn't
    mounted.


M	src/lib-master/mountpoint-list.c
M	src/lib-master/mountpoint-list.h
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h
M	src/lib-storage/mailbox-list.c

2012-02-01 20:21:38 +0200 Timo Sirainen <tss@iki.fi> (10e6b32)

    doveadm mount: Renamed "status" command to "list".


M	src/doveadm/doveadm-mount.c

2012-02-01 20:21:06 +0200 Timo Sirainen <tss@iki.fi> (2e09672)

    doveadm mount remove: Allow removing a wildcard path with the '*' suffix.


M	src/doveadm/doveadm-mount.c

2012-02-01 19:29:31 +0200 Timo Sirainen <tss@iki.fi> (680e885)

    Keep track of seen mountpoints and warn at startup if one is missing.
    doveadm mount commands can be used to manipulate the list.

    The list is kept in $rundir/mounts, but since it may be deleted after a 
    reboot a copy is kept also in $statedir/mounts. If it's not found from
    $rundir at startup, it's copied there from $statedir. (The reason why only
    $statedir isn't used is because it's often not world-readable.)

M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-mount.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h
M	src/lib-master/Makefile.am
A	src/lib-master/mountpoint-list.c
A	src/lib-master/mountpoint-list.h
M	src/master/main.c

2012-02-01 19:13:04 +0200 Timo Sirainen <tss@iki.fi> (6176f36)

    doveadm: Added flag to specify which column table formatter expands. The
    default also was changed to last column, not first.


M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.h
M	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm-who.c

2012-02-01 18:57:14 +0200 Timo Sirainen <tss@iki.fi> (4894f02)

    configure: Added getmntinfo() check for BSD mountpoint iteration.


M	configure.in

2012-02-01 20:10:42 +0200 Timo Sirainen <tss@iki.fi> (4b8a6ae)

    lib-storage: mailbox_list_mkdir_root() API changed. Use it now for creating
    mail root dir. It was supposed to be used for it previously, but wasn't..


M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/fts-lucene/fts-backend-lucene.c

2012-02-01 18:55:54 +0200 Timo Sirainen <tss@iki.fi> (74f436c)

    guid_128_generate(): Use 32bit sha1(host@domain) instead of crc32(hostname)


M	src/lib/guid.c

2012-01-30 20:09:04 +0200 Timo Sirainen <tss@iki.fi> (7c7d224)

    Added mountpoint_iter_*() for iterating mounted filesystems.


M	src/lib/mountpoint.c
M	src/lib/mountpoint.h

2012-01-29 20:33:34 +0000 Pascal Volk <user@localhost.localdomain.org> (eb5a561)

    man: Added descriptions of -d and -S options to doveconf.1.


M	doc/man/doveconf.1.in

2012-01-29 01:48:16 +0200 Timo Sirainen <tss@iki.fi> (d10cb4d)

    istream-concat: If EOF is already reached, use that size for stat().st_size


M	src/lib/istream-seekable.c

2012-01-29 01:37:44 +0200 Timo Sirainen <tss@iki.fi> (34dcdf3)

    zlib: zlib/bzlib ostreams no longer assert-crash if parent stream becomes
    full. This fixes assert-crashes with IMAP COMPRESS extension.


M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c

2012-01-29 00:48:43 +0200 Timo Sirainen <tss@iki.fi> (b13d76f)

    pop3c: mail.istream_opened() method wasn't being called.


M	src/lib-storage/index/pop3c/pop3c-mail.c

2012-01-29 00:35:40 +0200 Timo Sirainen <tss@iki.fi> (c08a1a5)

    mdbox: Don't lose save_dates when rebuilding indexes.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2012-01-29 00:30:23 +0200 Timo Sirainen <tss@iki.fi> (162dfa2)

    zlib+mbox: Fixed error handling when opening nonexistent/directory mailbox.


M	src/plugins/zlib/zlib-plugin.c

2012-01-28 23:58:50 +0200 Timo Sirainen <tss@iki.fi> (b104354)

    imap: CONTEXT search return option wasn't handled at all.


M	src/imap/imap-search.c

2012-01-28 23:46:49 +0200 Timo Sirainen <tss@iki.fi> (f71c2d4)

    mdbox: Check that m.X file doesn't have garbage at end of file when saving
    new data to it.


M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.h

2012-01-28 22:39:58 +0200 Timo Sirainen <tss@iki.fi> (5d4aac9)

    dsync: Fixed handling non-ASCII characters in mailbox names.


M	src/doveadm/dsync/dsync-worker-local.c

2012-01-28 22:24:26 +0200 Timo Sirainen <tss@iki.fi> (c45852c)

    doveconf: Added -d parameter for dumping default settings.


M	src/config/config-parser-private.h
M	src/config/config-parser.c
M	src/config/doveconf.c

2012-01-28 22:05:52 +0200 Timo Sirainen <tss@iki.fi> (cc4087c)

    sql: Fixed retrying query when multiple hosts were specified and all of them
    got disconnected.


M	src/lib-sql/driver-sqlpool.c

2012-01-28 20:21:10 +0200 Timo Sirainen <tss@iki.fi> (f9127f0)

    lib-storage: Thread iteration no longer returns dummy nodes without
    children. This fixes returning (0) nodes to IMAP client.


M	src/lib-storage/index/index-thread-finish.c

2012-01-28 20:08:40 +0200 Timo Sirainen <tss@iki.fi> (928f1ab)

    restrict_access(): If privileged and primary GIDs are the same, ignore
    privileged GID.


M	src/lib/restrict-access.c

2012-01-28 19:48:48 +0200 Timo Sirainen <tss@iki.fi> (0e454b5)

    dsync: If brain fails but workers don't, exit without assert-crashing.


M	src/doveadm/dsync/dsync-brain.c

2012-01-28 19:44:24 +0200 Timo Sirainen <tss@iki.fi> (63a5064)

    dsync: Don't crash if one source has indexes disabled.


M	src/doveadm/dsync/dsync-worker-local.c

2012-01-28 19:25:32 +0200 Timo Sirainen <tss@iki.fi> (884275d)

    smtp client: Do DNS blocking lookups. We don't currently have access to
    base_dir, so we can't know what the path to dns-client is. Also smtp client
    is a blocking operation anyway, so doing a blocking DNS lookup isn't a
    problem.


M	src/lib-lda/smtp-client.c

2012-01-28 19:24:17 +0200 Timo Sirainen <tss@iki.fi> (4d40619)

    smtp/lmtp client: If dns-client socket path isn't given, use blocking
    lookup.


M	src/lib-lda/lmtp-client.c

2012-01-28 19:00:56 +0200 Timo Sirainen <tss@iki.fi> (7fa561f)

    fs layout: Handle properly returning path when there is no root dir.


M	src/lib-storage/list/mailbox-list-fs.c

2012-01-27 23:33:00 +0200 Timo Sirainen <tss@iki.fi> (321f178)

    master: Throttle rapid exit failures only if there have never been any exit
    successes. This should still catch buggy services without allowing
    intentional DoSing.


M	src/master/service-monitor.c
M	src/master/service.h

2012-01-27 23:26:42 +0200 Timo Sirainen <tss@iki.fi> (cb211cc)

    master: Make service throttling seconds incremental, starting from 2 secs.


M	src/master/service-monitor.c
M	src/master/service.c
M	src/master/service.h

2012-01-27 23:22:22 +0200 Timo Sirainen <tss@iki.fi> (870bcf0)

    master: If 10 service processes die within a second with no successes
    inbetween, throttle the service.


M	src/master/service-monitor.c
M	src/master/service.h

2012-01-27 22:15:29 +0200 Timo Sirainen <tss@iki.fi> (b71b9e5)

    auth: Monitor how fast userdb passwd lookups are. If they're too slow,
    suggest blocking=yes


M	src/auth/userdb-passwd.c

2012-01-27 21:52:30 +0200 Timo Sirainen <tss@iki.fi> (357c7dd)

    auth: If parsing passwd-file takes a long time, log a warning.


M	src/auth/db-passwd-file.c

2012-01-27 19:31:58 +0200 Timo Sirainen <tss@iki.fi> (8098095)

    login proxy: If remote auth fails, say so in disconnect message instead of
    "internal failure".


M	src/imap-login/imap-proxy.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/pop3-login/pop3-proxy.c

2012-01-27 17:16:46 +0200 Timo Sirainen <tss@iki.fi> (cec5e44)

    dovecot-config: Added missing lib-dns and lib-fs to LIBDOVECOT_INCLUDE


M	dovecot-config.in.in

2012-01-27 15:44:06 +0200 Timo Sirainen <tss@iki.fi> (cf77eee)

    sdbox: Preserve file's atime/mtime when moving it to alt storage.


M	src/lib-storage/index/dbox-single/sdbox-file.c

2012-01-27 14:46:38 +0200 Timo Sirainen <tss@iki.fi> (ac2b94f)

    imapc: If imapc_host is IP, don't look it up via dns-client service.


M	src/lib-imap-client/imapc-connection.c

2012-01-27 14:35:38 +0200 Timo Sirainen <tss@iki.fi> (78a12e1)

    example-config: mdbox_rotate_interval default was wrong.


M	doc/example-config/conf.d/10-mail.conf

2012-01-27 14:17:32 +0200 Timo Sirainen <tss@iki.fi> (ac45ba9)

    login: More verbose_auth -> auth_verbose changes.


M	src/imap-login/imap-proxy.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/pop3-proxy.c

2012-01-27 14:15:30 +0200 Timo Sirainen <tss@iki.fi> (73f70e3)

    login: If auth_debug_passwords=yes, assume auth_debug/auth_verbose=yes


M	src/login-common/login-settings.c
M	src/login-common/login-settings.h

2012-01-27 14:15:06 +0200 Timo Sirainen <tss@iki.fi> (b112698)

    login process wasn't logging all intended messages with auth_verbose=yes It
    was named verbose_auth setting accidentally.


M	src/login-common/client-common-auth.c
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-openssl.c

2012-01-27 02:42:50 +0200 Timo Sirainen <tss@iki.fi> (297959b)

    imapc: If server doesn't support GUIDs, return empty GUID rather than fail.
    This is how other backends do it as well.


M	src/lib-storage/index/imapc/imapc-mail.c

2012-01-26 21:43:27 +0200 Timo Sirainen <tss@iki.fi> (f33d37b)

    doveadm fetch hdr.*.adddress*: Don't crash when printing groups.


M	src/doveadm/doveadm-mail-fetch.c

2012-01-26 21:25:39 +0200 Timo Sirainen <tss@iki.fi> (cf1c3e6)

    doveadm fetch: hdr.*.address and hdr.*.address_name expand to parsed mail
    addresses.


M	src/doveadm/doveadm-mail-fetch.c

2012-01-26 20:46:44 +0200 Timo Sirainen <tss@iki.fi> (9e952e5)

    doveadm fetch text.utf8: Don't return failure on success.


M	src/doveadm/doveadm-mail-fetch.c

2012-01-26 20:19:32 +0200 Timo Sirainen <tss@iki.fi> (46d283e)

    doveadm fetch: Added text.utf8 field, which translates headers/body to
    UTF-8.


M	src/doveadm/doveadm-mail-fetch.c

2012-01-26 16:37:40 +0200 Timo Sirainen <tss@iki.fi> (8e0265f)

    auth: Added PLAIN-TRUNC password schmee. The idea is to allow successful
    authentication when the original plaintext password was stored truncated in
    the database. So e.g. user gave 123456789 as password, but database
    truncated it to 12345678. To make this authentication work,
    {PLAIN-TRUNC}8-12345678 password allows successful authentication with any
    password that begins with 12345678. With the "8-" prefix this prefix
    matching is done only when the password after it is exactly 8 characters.


M	src/auth/password-scheme.c

2012-01-26 15:41:23 +0200 Timo Sirainen <tss@iki.fi> (eab3cb1)

    Makefile: Added UnicodeData.txt dependency to unicodemap.c.


M	src/lib/Makefile.am

2012-01-26 00:44:41 +0200 Timo Sirainen <tss@iki.fi> (21c2eb8)

    Added signature for changeset 0f10b3ed5c18


M	.hgsigs

2012-01-26 00:44:04 +0200 Timo Sirainen <tss@iki.fi> (dccd619)

    Added tag 2.1.rc5 for changeset 0f10b3ed5c18


M	.hgtags

2012-01-26 00:44:04 +0200 Timo Sirainen <tss@iki.fi> (b97b9b7)

    Released v2.1.rc5.


M	NEWS
M	configure.in

2012-01-26 00:37:42 +0200 Timo Sirainen <tss@iki.fi> (4199f70)

    maildir: When saving mails compressed, make sure ,S=size gets added to the
    filename.


M	src/lib-storage/index/maildir/maildir-save.c

2012-01-25 23:45:02 +0200 Timo Sirainen <tss@iki.fi> (a39292e)

    lib-storage: Message size lookups from cache was broken if fields weren't in
    "normal" order in file.


M	src/lib-storage/index/index-mail.c

2012-01-24 17:28:14 +0200 Timo Sirainen <tss@iki.fi> (69b602c)

    Added signature for changeset a20a99b8815d


M	.hgsigs

2012-01-24 17:28:10 +0200 Timo Sirainen <tss@iki.fi> (eb8bdbb)

    Added tag 2.1.rc4 for changeset a20a99b8815d


M	.hgtags

2012-01-24 17:28:10 +0200 Timo Sirainen <tss@iki.fi> (5956aa5)

    Released v2.1.rc4.


M	NEWS
M	TODO
M	configure.in

2012-01-24 16:37:24 +0200 Timo Sirainen <tss@iki.fi> (df3977b)

    Dead code removal.


M	src/lib-storage/list/mailbox-list-index.c

2012-01-24 15:30:47 +0200 Timo Sirainen <tss@iki.fi> (e4e1215)

    lib-index: Handle broken ext-header updates without crashing.


M	src/lib-index/mail-index-sync-ext.c

2012-01-24 03:52:28 +0200 Timo Sirainen <tss@iki.fi> (ec5319f)

    zlib: Getting stream's size failed in some situations. This could have
    caused other trouble, such as with dbox + mail_attachment_dir.


M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c

2012-01-24 03:51:20 +0200 Timo Sirainen <tss@iki.fi> (4a962dc)

    dbox: Minor code correctness fix.


M	src/lib-storage/index/dbox-common/dbox-attachment.c

2012-01-24 03:50:36 +0200 Timo Sirainen <tss@iki.fi> (cfe60fe)

    istream-mail: Skip checking if cached message size is wrong if parent stream
    returns error. An error is not the same as EOF.


M	src/lib-storage/index/istream-mail.c

2012-01-24 03:49:03 +0200 Timo Sirainen <tss@iki.fi> (6cc5a85)

    istream-concat: If looking up stream's size fails, log an error and handle
    it as error, not EOF.


M	src/lib/istream-concat.c

2012-01-22 21:38:48 +0200 Timo Sirainen <tss@iki.fi> (7fa573e)

    login: Make SASL auth buffer size define public.


M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h

2012-01-21 22:23:28 +0200 Timo Sirainen <tss@iki.fi> (83e6a11)

    pop3c: Change the default port to 110, not 143.


M	src/lib-storage/index/pop3c/pop3c-settings.c

2012-01-21 18:57:31 +0200 Timo Sirainen <tss@iki.fi> (56aa97d)

    pop3c: Fixed to work without indexes.


M	src/lib-storage/index/pop3c/pop3c-storage.c

2012-01-21 18:31:25 +0200 Timo Sirainen <tss@iki.fi> (2e78f05)

    imap-login: Fixed handling second AUTHENTICATE command when the first one
    failed.


M	src/imap-login/client-authenticate.c
M	src/imap-login/client-authenticate.h
M	src/imap-login/client.c
M	src/imap-login/client.h
M	src/login-common/client-common-auth.c

2012-01-21 00:43:13 +0200 Timo Sirainen <tss@iki.fi> (1f09437)

    lmtp: Fixed assert-crashing on 3rd client connection.


M	src/lmtp/client.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h

2012-01-21 00:27:52 +0200 Timo Sirainen <tss@iki.fi> (ffaa309)

    lmtp: Make core dumping work also after the first mail delivery.


M	src/lmtp/commands.c
M	src/lmtp/main.c
M	src/lmtp/main.h

2012-01-20 22:12:48 +0200 Timo Sirainen <tss@iki.fi> (b991f3c)

    fs layout: Fixed listing child mailboxes when children flags weren't
    requested.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-01-20 21:57:30 +0200 Timo Sirainen <tss@iki.fi> (9706def)

    fs layout: Don't list subscriptions file as a mailbox.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-01-20 21:13:00 +0200 Timo Sirainen <tss@iki.fi> (8734678)

    notify plugin: Don't crash if user-plugin didn't set mailbox_rename. Patch
    by Ewald Dieterich.


M	src/plugins/notify/notify-plugin.c

2012-01-20 21:11:09 +0200 Timo Sirainen <tss@iki.fi> (95c4f06)

    notify plugin: Added mailbox_update and mailbox_set_subscribed
    notifications.


M	src/plugins/notify/notify-plugin-private.h
M	src/plugins/notify/notify-plugin.c
M	src/plugins/notify/notify-plugin.h
M	src/plugins/notify/notify-storage.c

2012-01-20 18:59:16 +0200 Timo Sirainen <tss@iki.fi> (d646824)

    master: Added instance_name setting, which is used to prefix processes in ps
    output.


M	doc/example-config/dovecot.conf
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/master-settings.h

2012-01-20 18:44:49 +0200 Timo Sirainen <tss@iki.fi> (3ec16f2)

    mysql: If query fails with "MySQL server gone away", log also how long it
    idled.


M	src/lib-sql/driver-mysql.c

2012-01-20 18:28:40 +0200 Timo Sirainen <tss@iki.fi> (3a7113e)

    auth: Make idle_kill work with auth worker processes.


M	src/auth/auth-common.h
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-client.h
M	src/auth/auth-worker-server.c
M	src/auth/main.c
M	src/auth/passdb-pam.c

2012-01-20 18:27:44 +0200 Timo Sirainen <tss@iki.fi> (0161376)

    lib-master: Send service's idle_kill value to process in environment.


M	src/lib-master/master-interface.h
M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/master/service-process.c

2012-01-20 18:14:43 +0200 Timo Sirainen <tss@iki.fi> (9e291f6)

    Typofix.


M	src/master/service-process.c

2012-01-20 18:09:54 +0200 Timo Sirainen <tss@iki.fi> (db81139)

    fts: Run decoder script with 10 second alarm.


M	src/plugins/fts/fts-parser-script.c

2012-01-20 18:09:41 +0200 Timo Sirainen <tss@iki.fi> (8656ae1)

    script: Set alarm() for the script being run only if alarm=<secs> parameter
    is given.


M	src/util/script.c

2012-01-20 17:56:32 +0200 Timo Sirainen <tss@iki.fi> (57d39b7)

    decode2text.sh: Hide catdoc/catppt/xls2csv segmentation faults. We can't do
    anything about them anyway.


M	src/plugins/fts/decode2text.sh

2012-01-20 17:42:47 +0200 Timo Sirainen <tss@iki.fi> (53dff07)

    imap, pop3: Added -t parameter to specify post-login script timeout.


M	src/imap/main.c
M	src/lib-master/master-login.c
M	src/lib-master/master-login.h
M	src/pop3/main.c

2012-01-20 17:42:15 +0200 Timo Sirainen <tss@iki.fi> (db0d525)

    script-login: If we fail to finish, exit with 0 to avoid master logging
    error unnecessarily.


M	src/util/script-login.c

2012-01-20 17:06:06 +0200 Timo Sirainen <tss@iki.fi> (1509371)

    Maildir++ quota: Close maildirsize file after writing to it to force NFS to
    write it. This should fix the "Stale NFS file handle" errors with
    maildirsize.


M	src/plugins/quota/quota-maildir.c

2012-01-20 16:54:17 +0200 Timo Sirainen <tss@iki.fi> (3f9473b)

    eacces_error(): Removed bogus message about UNIX perms appearing to be ok.


M	src/lib/eacces-error.c

2012-01-20 16:40:06 +0200 Timo Sirainen <tss@iki.fi> (84de407)

    lib-auth: Don't log the "auth connection closed" warning if there were 0
    non-aborted requests.


M	src/lib-auth/auth-server-connection.c

2012-01-20 16:37:10 +0200 Timo Sirainen <tss@iki.fi> (9ddd3d7)

    lib-auth: Improved warning message about aborting auth requests.


M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client-request.h
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-client.h
M	src/lib-auth/auth-server-connection.c
M	src/lib-auth/auth-server-connection.h
M	src/login-common/client-common.c
M	src/login-common/main.c

2012-01-19 17:46:52 +0200 Timo Sirainen <tss@iki.fi> (f93c833)

    auth: Throttle SQL auth worker process creation if they can't connect to
    database.


M	src/auth/auth-settings.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-client.h
M	src/auth/auth-worker-server.c
M	src/auth/db-sql.c
M	src/auth/db-sql.h
M	src/auth/main.c
M	src/auth/passdb-sql.c
M	src/auth/userdb-sql.c

2012-01-19 16:33:13 +0200 Timo Sirainen <tss@iki.fi> (b624773)

    auth: Show a better auth worker process title.


M	src/auth/auth-common.h
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-client.h
M	src/auth/main.c

2012-01-19 16:17:52 +0200 Timo Sirainen <tss@iki.fi> (de0022e)

    auth: Avoid adding duplicate extra fields to auth replies. This especially
    fixes default_fields/override_fields.


M	src/auth/auth-request.c

2012-01-19 16:16:56 +0200 Timo Sirainen <tss@iki.fi> (b4205cf)

    auth: Minor optimization.


M	src/auth/auth-stream.c
M	src/auth/auth-stream.h
M	src/auth/userdb-blocking.c

2012-01-19 16:15:03 +0200 Timo Sirainen <tss@iki.fi> (d9fe793)

    auth: Don't crash when setting valueless default/override_fields to passdb.


M	src/auth/passdb-template.c

2012-01-19 15:53:42 +0200 Timo Sirainen <tss@iki.fi> (decb234)

    imap-login: Handle SASL-IR without overflowing master_auth_request's buffer.


M	src/imap-login/client-authenticate.c
M	src/imap-login/client-authenticate.h
M	src/imap-login/client.c
M	src/imap-login/client.h
M	src/lib-master/master-auth.h
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.h

2012-01-19 15:41:16 +0200 Timo Sirainen <tss@iki.fi> (0ad9d53)

    lib-auth: Treat cert_username="" and initial_resp_base64="" the same as
    NULLs.


M	src/lib-auth/auth-client-request.c

2012-01-18 23:44:40 +0200 Timo Sirainen <tss@iki.fi> (964c86d)

    auth: Log a warning if userdb ldap isn't used, but user_* or iterate_*
    aren't defaults. This is intended to stop people from wondering why their
    changes don't do anything.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2012-01-18 23:36:13 +0200 Timo Sirainen <tss@iki.fi> (e665999)

    auth: Log a warning if userdb sql isn't used, but user_query or
    iterate_query isn't default. This is intended to stop people from wondering
    why user_query doesn't do anything.


M	src/auth/db-sql.c
M	src/auth/db-sql.h
M	src/auth/passdb-sql.c
M	src/auth/userdb-sql.c

2012-01-18 17:58:53 +0200 Timo Sirainen <tss@iki.fi> (0af68ff)

    fs layout: Don't crash in mailbox listing if there are only invalid
    patterns.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2012-01-18 16:52:14 +0200 Timo Sirainen <tss@iki.fi> (fd42aa3)

    lib-lda: Added %e / %{from_envelope} variable to deliver_log_format.


M	src/lib-lda/mail-deliver.c

2012-01-18 16:51:22 +0200 Timo Sirainen <tss@iki.fi> (e8dc374)

    lib-storage: Preserve from_envelope in save context's dest_mail even if it's
    temporary. This allows looking it up while the mail is being saved.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-storage.c

2012-01-18 14:21:53 +0200 Timo Sirainen <tss@iki.fi> (3a79fda)

    master: Show the process_limit / client_limit value when logging that it's
    been reached.


M	src/master/service-monitor.c

2012-01-17 23:34:31 +0200 Timo Sirainen <tss@iki.fi> (1bb1570)

    lmtp: Removed unnecessary code.


M	src/lmtp/lmtp-proxy.c

2012-01-17 23:34:22 +0200 Timo Sirainen <tss@iki.fi> (68b7881)

    lib-lda: Fixed LMTP client hanging on sending large mails.


M	src/lib-lda/lmtp-client.c

2012-01-17 23:12:26 +0200 Timo Sirainen <tss@iki.fi> (05c3276)

    lmtp: Get banner text from login_greeting setting.


M	src/lmtp/client.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h

2012-01-17 23:11:16 +0200 Timo Sirainen <tss@iki.fi> (19cadcc)

    lib-storage: Added mail_storage_service_get_var_expand_table().


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2012-01-17 22:54:11 +0200 Timo Sirainen <tss@iki.fi> (433f5c9)

    director: Added timeout to syncing to make sure we don't hang if it somehow
    gets lost.


M	src/director/director-connection.c
M	src/director/director.c
M	src/director/director.h

2012-01-17 22:21:57 +0200 Timo Sirainen <tss@iki.fi> (fe201fb)

    director: Make sure ring syncing doesn't get lost when directors get
    disconnected.


M	src/director/director-connection.c

2012-01-17 17:20:07 +0200 Timo Sirainen <tss@iki.fi> (2b24597)

    auth: DIGEST-MD5 supports authorization id now. Patch by Yubao Liu.


M	src/auth/mech-digest-md5.c

2012-01-17 17:17:24 +0200 Timo Sirainen <tss@iki.fi> (802d296)

    auth: DIGEST-MD5 didn't read nonce-count parameter correctly. Patch by Yubao
    Liu.


M	src/auth/mech-digest-md5.c

2012-01-17 16:18:05 +0200 Timo Sirainen <tss@iki.fi> (69b22a0)

    director: Drop privileges only after adding hosts. This allows reading files
    from /etc/ before chrooting.


M	src/director/main.c

2012-01-17 16:07:13 +0200 Timo Sirainen <tss@iki.fi> (8ff9812)

    auth: Fixed loading passdb/userdb plugins. Patch by Stephan Bosch.


M	src/auth/passdb.c
M	src/auth/userdb.c

2012-01-17 15:44:26 +0200 Timo Sirainen <tss@iki.fi> (c4900d3)

    director: Find director's own IP earlier in init.


M	src/director/director.c
M	src/director/director.h
M	src/director/main.c

2012-01-12 23:09:25 +0200 Timo Sirainen <tss@iki.fi> (f3dccdd)

    dsync: Fixed handling -u parameter in backwards compatibility dsync mode.


M	src/doveadm/dsync/doveadm-dsync.c

2012-01-12 21:53:31 +0200 Timo Sirainen <tss@iki.fi> (b9c76fe)

    login: Added logging if auth process doesn't respond fast enough for
    greeting.


M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h

2012-01-12 15:40:30 +0200 Timo Sirainen <tss@iki.fi> (4c1279d)

    example-config: Updated vsz_limit default values.


M	doc/example-config/conf.d/10-master.conf

2012-01-11 12:07:44 +0200 Timo Sirainen <tss@iki.fi> (18f1bbf)

    login proxy: Added extra logging for bug detection.


M	src/login-common/client-common-auth.c

2012-01-11 10:31:25 +0200 Timo Sirainen <tss@iki.fi> (9675619)

    configure: Add -fno-builtin-strftime flag with gcc to avoid warning.


M	configure.in

2012-01-10 23:34:43 +0200 Timo Sirainen <tss@iki.fi> (1f696b6)

    Compiler warning fix.


M	src/lib/iostream-rawlog.c

2012-01-10 23:30:36 +0200 Timo Sirainen <tss@iki.fi> (dded610)

    decode2text.sh: Exit with 0 even if the decoding failed. There's nothing to
    be done anyway, since they are external programs. These errors just flood
    the error log unnecessarily.


M	src/plugins/fts/decode2text.sh

2012-01-10 23:28:03 +0200 Timo Sirainen <tss@iki.fi> (6a1ecaf)

    Don't assert-crash on mail search if decomposed titlecase of search key is
    empty.


M	src/lib-mail/message-search.c
M	src/lib-mail/message-search.h
M	src/lib-storage/index/index-search.c

2012-01-10 23:14:18 +0200 Timo Sirainen <tss@iki.fi> (46c6ebb)

    quota: Try to avoid logging NFS stale fhandle errors when closing
    maildirsize file.


M	src/plugins/quota/quota-maildir.c

2012-01-10 23:10:04 +0200 Timo Sirainen <tss@iki.fi> (0a5a9cc)

    imap/pop3-login: Include hostname and timestamp in "temporary auth failure"
    message.


M	src/imap-login/client-authenticate.c
M	src/pop3-login/client-authenticate.c

2012-01-10 22:57:09 +0200 Timo Sirainen <tss@iki.fi> (b1f3711)

    Use t_strflocaltime() where possible.


M	src/doveadm/doveadm-util.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/lib/iostream-rawlog.c
M	src/util/rawlog.c

2012-01-10 22:51:52 +0200 Timo Sirainen <tss@iki.fi> (c3c07d6)

    Added t_strflocaltime().


M	src/lib/macros.h
M	src/lib/time-util.c
M	src/lib/time-util.h

2012-01-10 21:39:13 +0200 Timo Sirainen <tss@iki.fi> (c2a5b91)

    master: default_idle_kill setting wasn't "time" type.


M	src/master/master-settings.c

2012-01-10 21:37:54 +0200 Timo Sirainen <tss@iki.fi> (152db3f)

    director: If request is timed out, log an error.


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director-request.h
M	src/director/director.c
M	src/director/director.h
M	src/director/login-connection.c

2012-01-10 13:12:08 +0200 Timo Sirainen <tss@iki.fi> (39dc141)

    s/Fallbacking/Falling back/


M	src/auth/auth-request.c

2012-01-10 02:27:26 +0200 Timo Sirainen <tss@iki.fi> (1e143a6)

    fts-solr: Make sure header name is lowercased in search queries.


M	src/plugins/fts-solr/fts-backend-solr.c

2012-01-10 00:34:09 +0200 Timo Sirainen <tss@iki.fi> (77f1da4)

    login proxy: If server disconnects during auth, log the connection duration.


M	src/login-common/client-common-auth.c

2012-01-09 23:57:25 +0200 Timo Sirainen <tss@iki.fi> (19d01d7)

    master: "Out of memory" message shows now the service {} block around
    vsz_limit.


M	src/master/service-process.c

2012-01-09 21:10:35 +0200 Timo Sirainen <tss@iki.fi> (5c6aa68)

    imapc: Added imapc_master_user setting.


M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2012-01-09 21:10:30 +0200 Timo Sirainen <tss@iki.fi> (b988298)

    imapc: Treat master_user="" the same as NULL.


M	src/lib-imap-client/imapc-client.c

2012-01-09 20:53:51 +0200 Timo Sirainen <tss@iki.fi> (d823000)

    auth: Check also masterdbs when checking if auth mechanism can be used.
    Patch by Yubao Liu


M	src/auth/auth.c

2012-01-09 20:31:53 +0200 Timo Sirainen <tss@iki.fi> (520398a)

    lib-lda: Make lmtp_client_state_to_string() more verbose.


M	src/lib-lda/lmtp-client.c

2012-01-09 16:35:22 +0200 Timo Sirainen <tss@iki.fi> (27abb44)

    auth: Implemented support for Postfix's "TCP map" sockets for user existence
    lookups.


M	src/auth/Makefile.am
A	src/auth/auth-postfix-connection.c
A	src/auth/auth-postfix-connection.h
M	src/auth/main.c

2012-01-09 16:29:37 +0200 Timo Sirainen <tss@iki.fi> (29d4c6e)

    auth: Use linked list instead of array for storing list of auth connections.
    With arrays the removal was slower than necessary.


M	src/auth/auth-client-connection.c
M	src/auth/auth-client-connection.h
M	src/auth/auth-master-connection.c
M	src/auth/auth-master-connection.h
M	src/auth/main.c

2012-01-07 20:28:42 +0200 Timo Sirainen <tss@iki.fi> (f571a68)

    Removed unnecessary code.


M	src/auth/auth-request.c

2012-01-06 21:34:36 +0200 Timo Sirainen <tss@iki.fi> (33e6cf3)

    Added signature for changeset 5398bdb8613f


M	.hgsigs

2012-01-06 21:34:33 +0200 Timo Sirainen <tss@iki.fi> (566856d)

    Added tag 2.1.rc3 for changeset 5398bdb8613f


M	.hgtags

2012-01-06 21:34:33 +0200 Timo Sirainen <tss@iki.fi> (a246e7e)

    Released v2.1.rc3.


M	NEWS
M	TODO
M	configure.in

2012-01-06 20:39:48 +0200 Timo Sirainen <tss@iki.fi> (44d230b)

    Compiler warning fix.


M	src/lib-storage/mail-storage.c

2012-01-06 19:54:03 +0200 Timo Sirainen <tss@iki.fi> (cdc2cb6)

    Make static analyzer happier.


M	src/doveadm/dsync/doveadm-dsync.c
M	src/doveadm/dsync/dsync-proxy.c

2012-01-06 19:29:23 +0200 Timo Sirainen <tss@iki.fi> (e9ac518)

    master: log/anvil listener names weren't set correctly. Also this fixes a
    long standing static analyzer "error".


M	src/master/service-process.c

2012-01-06 19:15:03 +0200 Timo Sirainen <tss@iki.fi> (b951c70)

    Makefile: added missing file


M	src/doveadm/dsync/Makefile.am

2012-01-06 16:02:36 +0200 Timo Sirainen <tss@iki.fi> (c7a44fd)

    Added signature for changeset a14b7333ae45


M	.hgsigs

2012-01-06 16:02:33 +0200 Timo Sirainen <tss@iki.fi> (eb27415)

    Added tag 2.1.rc2 for changeset a14b7333ae45


M	.hgtags

2012-01-06 16:02:33 +0200 Timo Sirainen <tss@iki.fi> (7069d9d)

    Released v2.1.rc2.


M	NEWS
M	TODO
M	configure.in

2012-01-06 16:00:45 +0200 Timo Sirainen <tss@iki.fi> (a790870)

    log: Removed unnecessary code.


M	src/log/log-connection.c

2012-01-06 15:23:53 +0200 Timo Sirainen <tss@iki.fi> (8774bcd)

    mail-log: Log all mail deliveries with "save" event, even if it happened via
    copying.


M	src/plugins/mail-log/mail-log-plugin.c

2012-01-06 15:23:12 +0200 Timo Sirainen <tss@iki.fi> (4f9b0e8)

    lib-lda: Use mailbox_save_using_mail() instead of mailbox_copy() for saving
    mails.


M	src/lib-lda/mail-deliver.c

2012-01-06 15:22:52 +0200 Timo Sirainen <tss@iki.fi> (00aaafa)

    lib-storage: Added mailbox_save_using_mail()


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2012-01-06 15:17:20 +0200 Timo Sirainen <tss@iki.fi> (abec3f4)

    lib-storage: Renamed mail_save_context.copying to copying_via_save.


M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-storage-private.h
M	src/plugins/notify/notify-storage.c
M	src/plugins/quota/quota-storage.c

2012-01-06 14:24:06 +0200 Timo Sirainen <tss@iki.fi> (ad58b50)

    doveadm: Hide "dsync-server" from list of commands.


M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/dsync/doveadm-dsync.c

2012-01-06 14:21:25 +0200 Timo Sirainen <tss@iki.fi> (e7f1fd9)

    doveadm: Renamed dsync commands.


M	src/doveadm/dsync/doveadm-dsync.c

2012-01-06 13:50:07 +0200 Timo Sirainen <tss@iki.fi> (533929e)

    auth: If master_user is specified by userdb, don't add another one to reply.
    The one specified by userdb should have overridden the other one though.


M	src/auth/auth-request-handler.c

2012-01-06 13:26:30 +0200 Timo Sirainen <tss@iki.fi> (6c973cf)

    fts-solr: Avoid using too much memory unnecessarily. Log a warning about
    huge headers.


M	src/plugins/fts-solr/fts-backend-solr.c

2012-01-06 13:09:51 +0200 Timo Sirainen <tss@iki.fi> (2d21dcb)

    istream-data: Avoid assert crashing due to recently added assert.


M	src/lib/istream-data.c

2012-01-04 17:26:25 +0200 Timo Sirainen <tss@iki.fi> (d200ae8)

    lib-index: Avoid assert-crashing on keyword-update record with empty
    keyword.


M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-transaction-log-view.c

2012-01-04 16:46:12 +0200 Timo Sirainen <tss@iki.fi> (3aa7a48)

    dsync: Don't remove other namespaces entirely, just skip the unwanted ones.
    This fixes incorrectly removing subscriptions=no namespaces entries from
    subscriptions.


M	src/doveadm/dsync/dsync-worker-local.c

2012-01-04 15:22:26 +0200 Timo Sirainen <tss@iki.fi> (eacce22)

    imap-acl: Don't log errors when trying to change ACLs for nonexistent
    mailboxes.


M	src/plugins/imap-acl/imap-acl-plugin.c

2012-01-04 15:08:39 +0200 Timo Sirainen <tss@iki.fi> (e3a4539)

    Added MAILBOX_LIST_ITER_SELECT_SPECIALUSE option and enable it for IMAP.
    RECURSIVEMATCH option doesn't currently work properly with it.


M	src/imap/cmd-list.c
M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list.h

2012-01-04 12:00:13 +0200 Timo Sirainen <tss@iki.fi> (97e62b2)

    istream: Don't treat max_block_size=0 as unlimited.


M	src/lib/file-copy.c
M	src/lib/istream.c
M	src/plugins/fts-squat/squat-test.c

2012-01-03 14:42:51 +0200 Timo Sirainen <tss@iki.fi> (4fbbd38)

    dsync: Don't log unnecessary errors about not being able to delete \Noselect
    mailbox dirs.


M	src/doveadm/dsync/dsync-worker-local.c

2012-01-03 14:41:44 +0200 Timo Sirainen <tss@iki.fi> (59b2a62)

    dsync: Previous commit did too many changes, reverting.


M	src/doveadm/dsync/dsync-worker-local.c

2012-01-03 14:33:20 +0200 Timo Sirainen <tss@iki.fi> (34c28e1)

    dsync: Don't log unnecessary errors about not being able to delete \Noselect
    mailbox dirs.


M	src/doveadm/dsync/dsync-worker-local.c

2012-01-03 13:13:37 +0200 Timo Sirainen <tss@iki.fi> (60216d65)

    imap-login: LOGIN_MAX_INBUF_SIZE was too small, because of SASL-IR extension


M	src/login-common/client-common.h

2012-01-02 16:30:06 +0200 Timo Sirainen <tss@iki.fi> (01435c3)

    lib-storage: Added initial support for pop3c backend.


M	configure.in
M	src/lib-storage/index/Makefile.am
A	src/lib-storage/index/pop3c/Makefile.am
A	src/lib-storage/index/pop3c/pop3c-client.c
A	src/lib-storage/index/pop3c/pop3c-client.h
A	src/lib-storage/index/pop3c/pop3c-mail.c
A	src/lib-storage/index/pop3c/pop3c-settings.c
A	src/lib-storage/index/pop3c/pop3c-settings.h
A	src/lib-storage/index/pop3c/pop3c-storage.c
A	src/lib-storage/index/pop3c/pop3c-storage.h
A	src/lib-storage/index/pop3c/pop3c-sync.c
A	src/lib-storage/index/pop3c/pop3c-sync.h

2011-12-30 17:44:23 +0200 Timo Sirainen <tss@iki.fi> (21b4abe)

    doveadm stats top: Added -b parameter to use read_bytes/write_bytes fields
    for disk io. This is useful when the kernel doesn't support the actual disk
    IO fields.


M	src/doveadm/doveadm-stats.c

2011-12-30 12:33:06 +0200 Timo Sirainen <tss@iki.fi> (faec0ab)

    Use master_service_connection.name for determining listener type.


M	src/auth/main.c
M	src/director/main.c
M	src/ipc/main.c

2011-12-30 12:31:58 +0200 Timo Sirainen <tss@iki.fi> (f7423cb)

    Listener names are now in struct master_service_connection.name This allows
    service to use the names to figure out what type the listener is.


M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/master/service-process.c
M	src/master/service.c
M	src/master/service.h

2011-12-30 11:54:48 +0200 Timo Sirainen <tss@iki.fi> (6469cf2)

    lib-storage: Added struct mailbox.set_subscribed() virtual method.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/test-mailbox.c
M	src/plugins/virtual/virtual-storage.c

2011-12-29 14:43:45 +0200 Timo Sirainen <tss@iki.fi> (885a3c2)

    Merged dsync into "doveadm dsync". dsync symlink is installed for backwards
    compatibility.


M	.hgignore
M	configure.in
M	src/Makefile.am
M	src/doveadm/Makefile.am
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/doveadm.c
R081	src/dsync/Makefile.am	src/doveadm/dsync/Makefile.am
A	src/doveadm/dsync/doveadm-dsync.c
A	src/doveadm/dsync/doveadm-dsync.h
R100	src/dsync/dsync-brain-msgs-new.c	src/doveadm/dsync/dsync-brain-msgs-new.c
R100	src/dsync/dsync-brain-msgs.c	src/doveadm/dsync/dsync-brain-msgs.c
R100	src/dsync/dsync-brain-private.h	src/doveadm/dsync/dsync-brain-private.h
R099	src/dsync/dsync-brain.c	src/doveadm/dsync/dsync-brain.c
R100	src/dsync/dsync-brain.h	src/doveadm/dsync/dsync-brain.h
R100	src/dsync/dsync-data.c	src/doveadm/dsync/dsync-data.c
R100	src/dsync/dsync-data.h	src/doveadm/dsync/dsync-data.h
R099	src/dsync/dsync-proxy-client.c	src/doveadm/dsync/dsync-proxy-client.c
R099	src/dsync/dsync-proxy-server-cmd.c	src/doveadm/dsync/dsync-proxy-server-cmd.c
R094	src/dsync/dsync-proxy-server.c	src/doveadm/dsync/dsync-proxy-server.c
R100	src/dsync/dsync-proxy-server.h	src/doveadm/dsync/dsync-proxy-server.h
R100	src/dsync/dsync-proxy.c	src/doveadm/dsync/dsync-proxy.c
R100	src/dsync/dsync-proxy.h	src/doveadm/dsync/dsync-proxy.h
R099	src/dsync/dsync-worker-local.c	src/doveadm/dsync/dsync-worker-local.c
R100	src/dsync/dsync-worker-private.h	src/doveadm/dsync/dsync-worker-private.h
R100	src/dsync/dsync-worker.c	src/doveadm/dsync/dsync-worker.c
R100	src/dsync/dsync-worker.h	src/doveadm/dsync/dsync-worker.h
R100	src/dsync/test-dsync-brain-msgs.c	src/doveadm/dsync/test-dsync-brain-msgs.c
R099	src/dsync/test-dsync-brain.c	src/doveadm/dsync/test-dsync-brain.c
R100	src/dsync/test-dsync-common.c	src/doveadm/dsync/test-dsync-common.c
R100	src/dsync/test-dsync-common.h	src/doveadm/dsync/test-dsync-common.h
R099	src/dsync/test-dsync-proxy-server-cmd.c	src/doveadm/dsync/test-dsync-proxy-server-cmd.c
R100	src/dsync/test-dsync-proxy.c	src/doveadm/dsync/test-dsync-proxy.c
R100	src/dsync/test-dsync-worker.c	src/doveadm/dsync/test-dsync-worker.c
R100	src/dsync/test-dsync-worker.h	src/doveadm/dsync/test-dsync-worker.h
D	src/dsync/dsync.c

2011-12-29 11:19:52 +0200 Timo Sirainen <tss@iki.fi> (994bb1a)

    mail-log: Removed unnecessary code.


M	src/plugins/mail-log/Makefile.am
M	src/plugins/mail-log/mail-log-plugin.c

2011-12-21 14:40:29 +0200 Timo Sirainen <tss@iki.fi> (1f11652)

    imapc: When searching for unused index dirs, ignore any ACLs. This also
    fixes a crash.


M	src/lib-storage/index/imapc/imapc-list.c

2011-12-20 14:45:22 +0200 Timo Sirainen <tss@iki.fi> (6292047)

    script-login -d: Ignore chrooting, we can't exec anything inside chroot.


M	src/util/script-login.c

2011-12-20 14:40:18 +0200 Timo Sirainen <tss@iki.fi> (24a9013)

    script-login: Close extra fds to avoid failing with --enable-devel-checks.


M	src/util/script-login.c

2011-12-20 13:16:55 +0200 Timo Sirainen <tss@iki.fi> (f323e3f)

    dict-file: Updated dotlock settings.


M	src/lib-dict/dict-file.c

2011-12-19 09:10:29 +0200 Timo Sirainen <tss@iki.fi> (eadbca0)

    sdbox: Added support for autodetection.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2011-12-16 13:08:49 +0200 Timo Sirainen <tss@iki.fi> (211cf1d)

    FS layout: Mark memory pool growing to avoid warnings with devel-checks.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2011-12-16 13:08:18 +0200 Timo Sirainen <tss@iki.fi> (ca43e32)

    FS layout: When deleting a mailbox, don't give an error if mailbox has
    children. The mailbox got successfully deleted, but it still gave an error.


M	src/lib-storage/index/index-storage.c

2011-12-16 12:50:53 +0200 Timo Sirainen <tss@iki.fi> (1d9ecfa)

    --enable-devel-checks: Use -fcatch-undefined-behavior -ftrapv with clang.


M	configure.in

2011-12-16 12:43:51 +0200 Timo Sirainen <tss@iki.fi> (2ee4783)

    fts: Expunging could have expunged indexed FTS mail from wrong mailbox.


M	src/plugins/fts/fts-expunge-log.c

2011-12-16 12:42:21 +0200 Timo Sirainen <tss@iki.fi> (3f2dd58)

    lib-storage: mailbox_list_get_permissions() didn't properly erase the full
    return struct. This shouldn't have caused any bugs currently.


M	src/lib-storage/mailbox-list.c

2011-12-15 13:40:20 +0200 Timo Sirainen <tss@iki.fi> (633c4c0)

    imapc: Assert crashfix.


M	src/lib-imap-client/imapc-connection.c

2011-12-14 14:29:07 +0200 Timo Sirainen <tss@iki.fi> (3ed38c6)

    imapc: Try to avoid crashes on deinit/disconnection.


M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c

2011-12-14 13:50:43 +0200 Timo Sirainen <tss@iki.fi> (c28f6aa)

    Added i_stream_unset_destroy_callback()


M	src/lib/istream.c
M	src/lib/istream.h

2011-12-14 13:00:05 +0200 Timo Sirainen <tss@iki.fi> (2ed248f)

    imapc: Avoid assert-crashing when replacing mail stream with a new one.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/index-mail.c

2011-12-14 12:57:55 +0200 Timo Sirainen <tss@iki.fi> (2769852)

    imapc: Fixed missing BODY[]/INTERNALDATE to handle actual failures again.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-12-14 12:33:59 +0200 Timo Sirainen <tss@iki.fi> (2f14155)

    imapc: Handle missing INTERNALDATE reply by returning an empty mail instead
    of disconnecting.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-12-14 11:57:20 +0200 Timo Sirainen <tss@iki.fi> (dab64e8)

    imapc: Handle missing BODY[] reply by returning an empty mail instead of
    disconnecting.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-12-14 10:55:11 +0200 Timo Sirainen <tss@iki.fi> (3028321)

    auth: Don't die if passwd-file can't open the file. The file is parsed after
    we already sent "we're ok" reply to master, so dying triggers infinite
    restarts.


M	src/auth/db-passwd-file.c

2011-12-12 08:45:32 +0200 Timo Sirainen <tss@iki.fi> (df452e9)

    imapc: Added support for fetching GUID from remote server, if supported.
    Currently this is only done for GMail.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-12-12 08:41:50 +0200 Timo Sirainen <tss@iki.fi> (afa672e)

    imapc: Added X-GM-EXT-1 and CONDSTORE to capabilities.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h

2011-12-12 08:36:25 +0200 Timo Sirainen <tss@iki.fi> (fe4691f)

    imapc: Don't crash if we receive tagged BAD reply.


M	src/lib-imap-client/imapc-connection.c

2011-12-12 08:29:50 +0200 Timo Sirainen <tss@iki.fi> (4c97453)

    imap: When fetching X-GUID, set MAIL_FETCH_GUID also as "wanted fields" for
    optimization.


M	src/imap/imap-fetch.c

2011-12-12 08:43:04 +0200 Timo Sirainen <tss@iki.fi> (93ec4c8)

    imapc: Removed HIGHESTMODSEQ handling from STATUS command. We don't
    currently even attempt to handle remote modseqs, so HIGHESTMODSEQ shouldn't
    be used either.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-12-12 07:04:46 +0200 Timo Sirainen <tss@iki.fi> (1114ab1)

    auth: Handle proxy_maybe=yes for PASS lookups. (Fixes it for LMTP.)


M	src/auth/auth-master-connection.c

2011-12-12 06:48:44 +0200 Timo Sirainen <tss@iki.fi> (ec82a9b)

    imap: Convert LIST/LSUB patterns from mUTF-7 to UTF-8 for internal
    representation.


M	src/imap/cmd-list.c

2011-12-12 06:36:31 +0200 Timo Sirainen <tss@iki.fi> (13b063b)

    lib-storage: Handle %{uid} and %{gid} expansion without relying on process's
    euid/egid.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2011-12-12 06:07:33 +0200 Timo Sirainen <tss@iki.fi> (88b0427)

    lib-storage: Previously added %{gid} variable didn't actually work.


M	src/lib-storage/mail-user.c

2011-12-10 10:59:30 +0200 Timo Sirainen <tss@iki.fi> (701c9fc)

    lmtp: Simplify LMTP proxying by first reading the whole input to
    memory/disk. This hopefully fixes problems related to LMTP proxying, at the
    cost of having to write large mails to temp directory.


M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-proxy.h

2011-12-10 08:50:43 +0200 Timo Sirainen <tss@iki.fi> (5f9300c)

    passdb imap: Log about failures.


M	src/auth/passdb-imap.c

2011-12-10 08:44:33 +0200 Timo Sirainen <tss@iki.fi> (28c959a)

    dsync: Update cache fields' decision and last_used fields explicitly. This
    makes v2.1's dsync incompatible with v2.0's when used in different servers.


M	src/dsync/dsync-data.c
M	src/dsync/dsync-data.h
M	src/dsync/dsync-proxy-client.c
M	src/dsync/dsync-proxy-server-cmd.c
M	src/dsync/dsync-proxy.c
M	src/dsync/dsync-proxy.h
M	src/dsync/dsync-worker-local.c
M	src/dsync/dsync-worker-private.h
M	src/dsync/test-dsync-common.c
M	src/dsync/test-dsync-proxy.c
M	src/dsync/test-dsync-worker.c
M	src/dsync/test-dsync-worker.h
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/mail-storage.h

2011-12-10 08:43:09 +0200 Timo Sirainen <tss@iki.fi> (7de34c9)

    doveadm: Compile fix for previous lib-index change.


M	src/doveadm/doveadm-dump-index.c

2011-12-10 08:42:26 +0200 Timo Sirainen <tss@iki.fi> (008a83e)

    lib-index: Allow updating cache's last_used field with
    mail_cache_register_fields()


M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.h

2011-12-10 08:41:01 +0200 Timo Sirainen <tss@iki.fi> (a2150da)

    lib-storage: Added separate %{gid} expansion to mail_user. The default
    %{gid} probably works also, but it's more reliable to do this explicitly.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2011-12-10 08:35:06 +0200 Timo Sirainen <tss@iki.fi> (a373899)

    lib-index: If cache field's decision is forced no, don't update the field's
    last_used.


M	src/lib-index/mail-cache-decisions.c

2011-12-10 08:15:58 +0200 Timo Sirainen <tss@iki.fi> (8a2401d)

    lib-fs: Added "mode" parameter to "posix" backend to specify mode for
    created files/dirs.


M	src/lib-fs/fs-posix.c

2011-12-10 08:01:02 +0200 Timo Sirainen <tss@iki.fi> (723277f)

    maildir: If saving fails, don't bother trying to flush the file's ostream.


M	src/lib-storage/index/maildir/maildir-save.c

2011-12-10 07:57:16 +0200 Timo Sirainen <tss@iki.fi> (b51bac2)

    zlib: Avoid assert-crashing if parent ostream's write had failed earlier.


M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c

2011-12-10 07:28:22 +0200 Timo Sirainen <tss@iki.fi> (b033f0a)

    config: Don't warn that ssl_parameters_regenerate=0 should have "hours"
    suffix.


M	src/config/old-set-parser.c

2011-12-10 07:05:56 +0200 Timo Sirainen <tss@iki.fi> (782f95e)

    lib-storage: FS layout mailbox list iteration code rewrite. This fixes
    listing non-ASCII mailboxes. Also the new way no longer keeps more than one
    file descriptor open.


M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c

2011-12-10 07:03:09 +0200 Timo Sirainen <tss@iki.fi> (9b00ecf)

    lib-storage: mailbox_list_get_vname() no longer treats INBOX case
    insensitively. The INBOX vname is case sensitive, the INBOX storage_name
    isn't, otherwise it's not possible to access <ns prefix>/inBox cased
    mailboxes.


M	src/lib-storage/mailbox-list.c

2011-12-09 18:57:53 +0200 Timo Sirainen <tss@iki.fi> (d758298)

    var_expand(): Added %{uid} and %{gid} variables.


M	src/lib/var-expand.c

2011-12-09 17:49:13 +0200 Timo Sirainen <tss@iki.fi> (bac5a7e)

    lib-storage: Fixed search when mail prefetching is enabled.


M	src/lib-storage/index/index-search.c

2011-12-09 16:26:39 +0200 Timo Sirainen <tss@iki.fi> (2b6bc2e)

    mdbox: Make sure m.* files aren't overwritten when storage index isn't
    found. This mainly helps to avoid situations where m.1 is replaced by mail
    delivery when index directory has been (wrongly) changed.


M	src/lib-storage/index/dbox-multi/mdbox-map-private.h
M	src/lib-storage/index/dbox-multi/mdbox-map.c

2011-12-08 18:56:48 +0200 Timo Sirainen <tss@iki.fi> (2a64bd1)

    auth: If verbose_proctitle=yes, show which processes are auth workers.


M	src/auth/main.c

2011-12-08 11:45:04 +0200 Timo Sirainen <tss@iki.fi> (79a5536)

    lib-storage: Reverted the last INBOX children listing change after all.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2011-12-08 11:41:01 +0200 Timo Sirainen <tss@iki.fi> (16dc6cc)

    lib-storage: Fixed listing INBOX's children with layout=fs and non-mbox
    format.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2011-12-08 11:30:42 +0200 Timo Sirainen <tss@iki.fi> (14a717c)

    imapc: Crashfix on error conditions.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-12-08 09:30:14 +0200 Timo Sirainen <tss@iki.fi> (5df33e9)

    lib-storage: Code cleanup.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/mailbox-header.c

2011-12-08 09:28:54 +0200 Timo Sirainen <tss@iki.fi> (076f8c1)

    liblib: Added str_to_time()


M	src/lib/strnum.c
M	src/lib/strnum.h

2011-12-08 07:51:28 +0200 Timo Sirainen <tss@iki.fi> (a3786ab)

    lib-storage: Removed unnecessarily duplicated code.


M	src/lib-storage/index/index-transaction.c

2011-12-08 07:36:39 +0200 Timo Sirainen <tss@iki.fi> (0de1e37)

    lib-storage: Fixed assert-crash when search query contained ().


M	src/lib-storage/mail-search-build.c

2011-12-08 07:23:25 +0200 Timo Sirainen <tss@iki.fi> (f55d355)

    fts-lucene: Fixed Makefile.am


M	src/plugins/fts-lucene/Makefile.am

2011-12-08 07:02:03 +0200 Timo Sirainen <tss@iki.fi> (a343811)

    lib-sql: If mysql/pgsql commit fails due to server disconnection, reconnect
    and retry.


M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c

2011-12-08 06:11:03 +0200 Timo Sirainen <tss@iki.fi> (e51cfb5)

    lib-storage: Fixed assert-crash in user deinit with some installations.


M	src/lib-storage/mail-user.c

2011-12-08 05:55:19 +0200 Timo Sirainen <tss@iki.fi> (f045034)

    login: Send the last connected client's IP address to log process.


M	src/login-common/main.c

2011-12-08 05:54:54 +0200 Timo Sirainen <tss@iki.fi> (8abe071)

    lib-storage: If client_limit=1, send user's log prefix to log process.


M	src/lib-storage/mail-storage-service.c

2011-12-08 05:54:23 +0200 Timo Sirainen <tss@iki.fi> (986ca1c)

    Added i_set_failure_send_prefix() and renamed i_set_failure_ip() to
    _send_ip().


M	src/lib/failures.c
M	src/lib/failures.h

2011-12-08 05:53:55 +0200 Timo Sirainen <tss@iki.fi> (800fc30)

    Added a new "FATAL" log command, which master uses to log all abnormal
    process exits. The log process adds the process's log prefix or IP address
    to the message if available.


M	src/log/log-connection.c
M	src/master/service-process.c

2011-12-08 05:24:48 +0200 Timo Sirainen <tss@iki.fi> (05f3f77)

    log: Removed slightly confusing code. A log client always receives a BYE, so
    don't free it earlier.


M	src/log/log-connection.c

2011-12-08 05:17:01 +0200 Timo Sirainen <tss@iki.fi> (bfd8127)

    lmtp: If lmtp_save_to_detail_mailbox=yes and there was no detail, mail was
    logged as saved to "".


M	src/lmtp/commands.c

2011-12-08 05:13:44 +0200 Timo Sirainen <tss@iki.fi> (acf8ab0)

    stats: Chroot to empty directory by default.


M	src/stats/stats-settings.c

2011-12-08 05:12:12 +0200 Timo Sirainen <tss@iki.fi> (de84f42)

    ssl_parameters_regenerate setting is now "time" type, as it should have
    been.


M	src/config/old-set-parser.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c

2011-12-08 05:05:57 +0200 Timo Sirainen <tss@iki.fi> (0579b94)

    indexer: Use stricter permissions for indexer-worker socket.


M	src/indexer/indexer-worker-settings.c

2011-12-08 05:03:22 +0200 Timo Sirainen <tss@iki.fi> (263fa7b)

    director: chroot to base_dir by default.


M	src/director/director-settings.c

2011-12-08 05:02:15 +0200 Timo Sirainen <tss@iki.fi> (fb35b9f)

    director: Don't explicitly use base_dir. We're already chdired there, use
    relative paths.


M	src/director/Makefile.am
M	src/director/director-settings.c
M	src/director/director-settings.h
M	src/director/director.c
M	src/director/main.c

2011-12-08 05:02:12 +0200 Timo Sirainen <tss@iki.fi> (b9c9b81)

    director-test.sh script fixed to use a working path for director-test
    binary.


M	src/director/director-test.sh

2011-12-07 01:48:03 +0200 Timo Sirainen <tss@iki.fi> (d0b2bd9)

    dbox: If index was fscked, rebuild indexes to make sure no mails got lost.


M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c

2011-12-07 01:46:42 +0200 Timo Sirainen <tss@iki.fi> (8a3f549)

    lib-index: Added mail_index_reset_fscked()


M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index.h

2011-12-07 01:28:20 +0200 Timo Sirainen <tss@iki.fi> (0f1f0cc)

    lib-storage: MAILBOX_LIST_ITER_RETURN_SPECIALUSE was checked wrong


M	src/lib-storage/mailbox-list-iter.c

2011-12-07 00:48:54 +0200 Timo Sirainen <tss@iki.fi> (a88810d)

    example-config: Added example mailboxes.


A	doc/example-config/conf.d/15-mailboxes.conf
M	doc/example-config/conf.d/Makefile.am

2011-12-07 00:30:26 +0200 Timo Sirainen <tss@iki.fi> (d477b27)

    config: Allow section names to contain spaces.


M	src/config/config-parser.c
M	src/config/doveconf.c
M	src/lib-settings/settings-parser.c

2011-12-06 23:55:48 +0200 Timo Sirainen <tss@iki.fi> (5f46b86)

    example-config: Use a default uncommented "namespace inbox".


M	doc/example-config/conf.d/10-mail.conf

2011-12-06 23:53:44 +0200 Timo Sirainen <tss@iki.fi> (c10669a)

    Moved mailbox {} settings inside namespace {} and no longer require ns
    prefix in name. This allows specifying mailboxes more easily with per-user
    namespace prefixes.


M	src/lib-storage/mail-namespace.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-iter.c
M	src/plugins/autocreate/autocreate-plugin.c

2011-12-06 23:51:09 +0200 Timo Sirainen <tss@iki.fi> (3905cff)

    lib-storage: Avoid crashes if listing subscriptions for a namespace that
    can't have any. i.e. the namespace and its parents all have subscriptions=no


M	src/lib-storage/mailbox-list-iter.c

2011-12-06 23:35:58 +0200 Timo Sirainen <tss@iki.fi> (60d5815)

    master: Be more relaxed about giving service auth's client_limit being too
    low. imap/pop3/lmtp processes with service_count=1 use up a client only for
    a very short time. Don't count them.


M	src/master/master-settings.c

2011-12-05 21:25:22 +0200 Timo Sirainen <tss@iki.fi> (605d968)

    autocreate: Make sure we don't crash if there are no mailbox{}es.


M	src/plugins/autocreate/autocreate-plugin.c

2011-12-05 21:23:40 +0200 Timo Sirainen <tss@iki.fi> (759319c)

    lib-storage: Don't crash when no there are no mailbox {} sections.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-iter.c

2011-12-02 23:47:01 +0200 Timo Sirainen <tss@iki.fi> (33c0df4)

    auth: Fixed vpopmail to work again after recent change.


M	src/auth/passdb-vpopmail.c

2011-12-02 17:59:24 +0200 Timo Sirainen <tss@iki.fi> (caf33f5)

    README: Added SPECIAL-USE RFC


M	README

2011-12-02 17:05:31 +0200 Timo Sirainen <tss@iki.fi> (ed35492)

    Implemented IMAP SPECIAL-USE extension.


M	configure.in
M	src/imap/cmd-list.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.h

2011-12-02 16:22:31 +0200 Timo Sirainen <tss@iki.fi> (eb1572d)

    Moved autocreate plugin functionality into lib-storage. The autocreate
    plugin is still used for backwards compatibility.

    Mailboxes can be configured like:

    mailbox Sent {
     auto = subscribe
    } mailbox Spam {
     auto = create
    }

M	src/config/settings-get.pl
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list-private.h
M	src/plugins/autocreate/autocreate-plugin.c

2011-12-02 14:49:08 +0200 Timo Sirainen <tss@iki.fi> (7ff6268)

    lib-storage: Added pool to struct mailbox_list_iterate_context.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mailbox-list-private.h
M	src/plugins/acl/acl-mailbox-list.c

2011-12-02 14:23:47 +0200 Timo Sirainen <tss@iki.fi> (13d98ff)

    lib-storage: Moved mailbox list iteration functions to a separate file.


M	src/lib-storage/Makefile.am
A	src/lib-storage/mailbox-list-iter.c
M	src/lib-storage/mailbox-list.c

2011-12-02 13:12:16 +0200 Timo Sirainen <tss@iki.fi> (aaea3ad)

    imapc: Check for when to prefer LOGIN to AUTHENTICATE was wrong.


M	src/lib-imap-client/imapc-connection.c

2011-12-01 09:24:58 +0200 Timo Sirainen <tss@iki.fi> (166e683)

    imapc: If remote server disconnects, log the reason.


M	src/lib-imap-client/imapc-connection.c

2011-12-01 09:15:53 +0200 Timo Sirainen <tss@iki.fi> (353fbc1)

    auth: Fixed loading authdb_imap plugin when Dovecot is configured
    --without-shared-libs


M	src/auth/Makefile.am

2011-11-30 18:48:44 +0200 Timo Sirainen <tss@iki.fi> (2bcf783)

    auth: Mention auth_worker_max_count in warning message about worker queue
    being slow.


M	src/auth/auth-worker-server.c

2011-11-25 04:25:09 +0200 Timo Sirainen <tss@iki.fi> (bd49b2e)

    fts-lucene: Fixed search when all terms were MUST_NOT.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-11-24 21:27:19 +0200 Timo Sirainen <tss@iki.fi> (51fb710)

    auth: Dropped default client_limit back to default_client_limit. Having it
    above 1024 logs an annoying warning at startup. Also in most cases the auth
    process wouldn't have nearly that many clients. If about 1000 imap/pop3
    processes were logging in at the exact same time, the limit would be
    reached, but that's a bit unlikely.


M	src/auth/auth-settings.c

2011-11-24 03:05:54 +0200 Timo Sirainen <tss@iki.fi> (aa43e22)

    NEWS, README: Added SCRAM-SHA-1 support.


M	NEWS
M	README

2011-11-24 02:36:32 +0200 Timo Sirainen <tss@iki.fi> (af2ba58)

    Added signature for changeset 18f32bf70fac


M	.hgsigs

2011-11-24 02:36:29 +0200 Timo Sirainen <tss@iki.fi> (16c77a6)

    Added tag 2.1.rc1 for changeset 18f32bf70fac


M	.hgtags

2011-11-24 02:36:29 +0200 Timo Sirainen <tss@iki.fi> (832f5c5)

    Released v2.1.rc1.


M	NEWS
M	configure.in

2011-11-24 02:21:08 +0200 Timo Sirainen <tss@iki.fi> (f6611f1)

    man: mailbox[-guid] doesn't need to be first parameter in search query.


M	doc/man/doveadm-search-query.7

2011-11-24 02:13:13 +0200 Timo Sirainen <tss@iki.fi> (d8fc475)

    Makefile: Added missing hmac-sha1.h


M	src/lib/Makefile.am

2011-11-24 02:06:45 +0200 Timo Sirainen <tss@iki.fi> (8a0641e)

    lib-lda: Use ostream corking better in LMTP/SMTP client.


M	src/lib-lda/lmtp-client.c

2011-11-24 01:58:28 +0200 Timo Sirainen <tss@iki.fi> (f187a8c)

    TODO updated


M	TODO

2011-11-24 01:53:04 +0200 Timo Sirainen <tss@iki.fi> (5a3e9d1)

    example-config: Added ssl_crypto_device.


M	doc/example-config/conf.d/10-ssl.conf

2011-11-24 01:50:35 +0200 Timo Sirainen <tss@iki.fi> (11bbebd)

    imapc: Pass ssl_crypto_device setting to lib-ssl-iostream.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2011-11-24 01:49:58 +0200 Timo Sirainen <tss@iki.fi> (cd5d9e8)

    lib-ssl-iostream: Added crypto_device setting to set OpenSSL engine.
    Multiple engines aren't supported, so the first crypto_device value gets
    used for all SSL connections.


M	src/lib-ssl-iostream/iostream-openssl-context.c
M	src/lib-ssl-iostream/iostream-ssl.h

2011-11-24 01:49:40 +0200 Timo Sirainen <tss@iki.fi> (de82dd4)

    login: Do engine cleanups _after_ finishing the used engine.


M	src/login-common/ssl-proxy-openssl.c

2011-11-24 01:45:59 +0200 Timo Sirainen <tss@iki.fi> (5808006)

    login: Added ssl_crypto_device setting to set OpenSSL engine.


M	src/login-common/login-settings.c
M	src/login-common/login-settings.h
M	src/login-common/ssl-proxy-openssl.c

2011-11-24 01:45:09 +0200 Timo Sirainen <tss@iki.fi> (aebfda1)

    login: Save final SASL reply to client struct.


M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2011-11-24 01:34:02 +0200 Timo Sirainen <tss@iki.fi> (8060dd5)

    lib-ssl-iostream: Call OpenSSL_add_all_algorithms() to make some OpenSSL
    versions happy.


M	src/lib-ssl-iostream/iostream-openssl-context.c

2011-11-24 01:12:33 +0200 Timo Sirainen <tss@iki.fi> (a306698)

    auth: LDAP iterate's debug message didn't use expanded base string.


M	src/auth/userdb-ldap.c

2011-11-24 00:53:37 +0200 Timo Sirainen <tss@iki.fi> (9f6da3b)

    lib-storage: Getting headers as UTF-8 could have returned garbage for
    multi-line headers.


M	src/lib-storage/index/index-mail-headers.c

2011-11-24 00:52:09 +0200 Timo Sirainen <tss@iki.fi> (afa4eb0)

    login: Use AUTH_REQUEST_FLAG_SUPPORT_FINAL_RESP if protocol supports it.


M	src/imap-login/client.c
M	src/login-common/login-common.h
M	src/login-common/sasl-server.c
M	src/pop3-login/client.c

2011-11-24 00:51:41 +0200 Timo Sirainen <tss@iki.fi> (3850584)

    lib-auth: Added AUTH_REQUEST_FLAG_SUPPORT_FINAL_RESP flag.


M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h

2011-11-24 00:51:27 +0200 Timo Sirainen <tss@iki.fi> (723b179)

    auth: If client gives "final-resp-ok" parameter, send it in OK reply with
    DIGEST-MD5, SCRAM-SHA-1


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/mech-digest-md5.c
M	src/auth/mech-scram-sha1.c

2011-11-23 22:55:57 +0200 Timo Sirainen <tss@iki.fi> (3ef451d)

    auth: Cleanups, fix and Dovecot code-stylifications to SCRAM-SHA-1.


M	src/auth/mech-scram-sha1.c

2011-10-30 12:39:53 +0100 Dennis Schridde <devurandom@gmx.net> (a5abb99)

    Add DOVECOT_PREREQ to src/lib/macros.h - convenience macro to test the
    version of dovecot


M	src/lib/macros.h

2011-10-30 12:23:28 +0100 Dennis Schridde <devurandom@gmx.net> (00d1c86)

    Add macros DOVECOT_VERSION_{MAJOR,MINOR} to config.h to allow version checks
    in the preprocessor

    Version number set as PACKAGE_VERSION is assumed to be D.D* with D=digits

M	configure.in

2011-09-16 02:24:00 +0200 Florian Zeitz <florob@babelmonkeys.de> (15cb954)

    auth: Implement the SCRAM-SHA-1 SASL mechanism


M	src/auth/Makefile.am
A	src/auth/mech-scram-sha1.c
M	src/auth/mech.c

2011-09-16 02:22:49 +0200 Florian Zeitz <florob@babelmonkeys.de> (a3350c3)

    lib: Add hmac-sha1 adapted from hmac-md5


M	src/lib/Makefile.am
A	src/lib/hmac-sha1.c
A	src/lib/hmac-sha1.h

2011-11-23 22:08:09 +0200 Timo Sirainen <tss@iki.fi> (665e9d1)

    lib-auth: auth_master_user_list_init() now takes user_mask and info
    parameters. These are passed to auth process, which may use them to limit
    what usernames are returned.


M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-master.h
M	src/lib-storage/mail-storage-service.c

2011-11-23 22:07:08 +0200 Timo Sirainen <tss@iki.fi> (e9371f8)

    auth: Support passing regular %variables to sql/ldap iterate queries.


M	src/auth/auth-master-connection.c
M	src/auth/auth-settings.c
M	src/auth/auth-worker-client.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-blocking.h
M	src/auth/userdb-ldap.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-sql.c
M	src/auth/userdb.h

2011-11-23 21:40:04 +0200 Timo Sirainen <tss@iki.fi> (726e5e8)

    auth: Don't leak memory in deinit.


M	src/auth/main.c

2011-11-23 21:14:11 +0200 Timo Sirainen <tss@iki.fi> (82883d0)

    Compiler warning fix


M	src/master/master-settings.c

2011-11-23 20:31:40 +0200 Timo Sirainen <tss@iki.fi> (742b9a0)

    lib-auth: Log a warning about auth disconnection only if there are pending
    requests.


M	src/lib-auth/auth-server-connection.c

2011-11-23 19:51:06 +0200 Timo Sirainen <tss@iki.fi> (ce7f8b3)

    master: Log a warning at startup if fd limit is too low.


M	src/master/master-settings.c

2011-11-23 19:51:01 +0200 Timo Sirainen <tss@iki.fi> (9a3183f)

    Added restrict_get_fd_limit()


M	src/lib/restrict-process-size.c
M	src/lib/restrict-process-size.h

2011-11-23 19:19:19 +0200 Timo Sirainen <tss@iki.fi> (eecb235)

    lib-storage: Track storage's all mailboxes to make it easier to debug if one
    isn't closed.


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2011-11-23 19:11:13 +0200 Timo Sirainen <tss@iki.fi> (ad0df8e)

    Compile fix for some compilers.


M	src/anvil/anvil-connection.c

2011-11-23 19:10:34 +0200 Timo Sirainen <tss@iki.fi> (521dad6)

    lib-index: Make sure we never go to infinite loop if fsck can't fix syncing
    problem.


M	src/lib-index/mail-index-sync.c

2011-11-23 19:04:15 +0200 Timo Sirainen <tss@iki.fi> (636468e)

    file_cache_set_size(): Cleanup properly after mmap() failure.


M	src/lib/file-cache.c

2011-11-23 19:01:28 +0200 Timo Sirainen <tss@iki.fi> (c2378fc)

    lib-index: Handle transaction log read errors separately from log
    corruption.


M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-transaction-log.h

2011-11-23 17:01:51 +0200 Timo Sirainen <tss@iki.fi> (bfcca12)

    fts-lucene: Crashfix when compiled without stemmer.


M	src/plugins/fts-lucene/fts-lucene-plugin.c

2011-11-23 16:58:10 +0200 Timo Sirainen <tss@iki.fi> (c5a7be1)

    Compile fixes.


M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/imapc-storage.c

2011-11-23 01:00:10 +0200 Timo Sirainen <tss@iki.fi> (bce078c)

    Compiling fix for non-gcc.


M	src/lib-imap-client/imapc-connection.c

2011-11-22 11:29:17 +0200 Timo Sirainen <tss@iki.fi> (b01280b)

    imapc: Added assert to make sure callback is never NULL.


M	src/lib-imap-client/imapc-connection.c

2011-11-22 11:28:33 +0200 Timo Sirainen <tss@iki.fi> (13c96f6)

    imapc: Crashfix after having idled for 29 mins without IDLE.


M	src/lib-imap-client/imapc-connection.c

2011-11-22 00:12:53 +0200 Timo Sirainen <tss@iki.fi> (714c6a1)

    mdbox: Don't assert-crash when having to open mail file during specific
    copying situations.


M	src/lib-storage/index/dbox-multi/mdbox-save.c

2011-11-21 23:26:46 +0200 Timo Sirainen <tss@iki.fi> (f05f569)

    doveadm dump: Added support for dumping dbox headers/metadata.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-dump-dbox.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-dump.h

2011-11-21 23:26:41 +0200 Timo Sirainen <tss@iki.fi> (3c89294)

    dbox: Compiler warning fix if trying to include dbox-file.h directly.


M	src/lib-storage/index/dbox-common/dbox-file.h

2011-11-21 23:26:18 +0200 Timo Sirainen <tss@iki.fi> (c579e4a)

    hex2dec(): Allow data to contain also lowercase hex characters.


M	src/lib/hex-dec.c

2011-11-21 22:43:19 +0200 Timo Sirainen <tss@iki.fi> (d5b030f)

    dbox: Removed unused message type from header.


M	src/lib-storage/index/dbox-common/dbox-file.h

2011-11-19 23:42:05 +0200 Timo Sirainen <tss@iki.fi> (413079d)

    login: Moved all i_fatal()s to preinit stage. This avoids a wrongly
    configured login process from rapidly respawning.


M	src/login-common/main.c

2011-11-19 23:41:50 +0200 Timo Sirainen <tss@iki.fi> (7ee226c)

    director: Moved all i_fatal()s to preinit stage. This avoids a wrongly
    configured director process from rapidly respawning.


M	src/director/main.c

2011-11-19 23:41:17 +0200 Timo Sirainen <tss@iki.fi> (3fc7d2b)

    auth: Moved all i_fatal()s to preinit stage. This avoids a wrongly
    configured auth process from rapidly respawning.


M	src/auth/auth.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c

2011-11-19 23:28:18 +0200 Timo Sirainen <tss@iki.fi> (a54cf83)

    auth: Handle auth worker creation failure without killing the whole auth
    process.


M	src/auth/auth-worker-server.c

2011-11-19 23:15:19 +0200 Timo Sirainen <tss@iki.fi> (88c92ce)

    login: Show empty username in disconnect message.


M	src/login-common/client-common.c

2011-11-19 23:14:59 +0200 Timo Sirainen <tss@iki.fi> (a309a2b)

    auth: If auth fails due to invalid username, send the username in the FAIL
    message.


M	src/auth/auth-request-handler.c

2011-11-19 23:04:54 +0200 Timo Sirainen <tss@iki.fi> (6998ca9)

    login: Log a different disconnect message if client didn't finish SASL auth.


M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2011-11-19 22:29:31 +0200 Timo Sirainen <tss@iki.fi> (2afb378)

    env_clean(): Previous OSX compile fix broke the function completely.


M	src/lib/env-util.c

2011-11-19 21:48:14 +0200 Timo Sirainen <tss@iki.fi> (0740145)

    Compile fix for OSX.


M	src/lib/env-util.c

2011-11-19 05:06:10 +0200 Timo Sirainen <tss@iki.fi> (8fab907)

    doc: Removed auth-protocol.txt from Makefile.


M	doc/Makefile.am

2011-11-18 22:14:02 +0200 Timo Sirainen <tss@iki.fi> (9055976)

    doc: Removed auth-protocol.txt. A more up to date version is in wiki docs.


D	doc/auth-protocol.txt

2011-11-18 22:07:16 +0200 Timo Sirainen <tss@iki.fi> (ab122a3)

    auth: Don't allow auth clients to set internal auth request fields. This
    could have allowed attacker to bypass authentication if login process was
    first successfully attacked to allow arbitrary code execution.


M	src/auth/auth-master-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h

2011-11-18 21:37:34 +0200 Timo Sirainen <tss@iki.fi> (3d99535)

    login: Call master_service_init_finish() later. This prevents automatic
    infinite process respawns if SSL initialization fails.


M	src/login-common/main.c

2011-11-18 21:35:52 +0200 Timo Sirainen <tss@iki.fi> (c444eea)

    lib-master: Set service/client limits already in master_service_init()


M	src/lib-master/master-service.c

2011-11-18 21:31:15 +0200 Timo Sirainen <tss@iki.fi> (f45da0b)

    login proxy: Added ssl_client_cert/key settings. The client cert is used
    sent to proxy destination server when SSL is used.


M	src/login-common/login-settings.c
M	src/login-common/login-settings.h
M	src/login-common/ssl-proxy-openssl.c

2011-11-18 16:22:44 +0200 Timo Sirainen <tss@iki.fi> (2cbef6f)

    login: Added assert.


M	src/login-common/main.c

2011-11-18 16:16:34 +0200 Timo Sirainen <tss@iki.fi> (7c849db)

    login: Differentiate between auth failure and auth process communication
    failure. Log a warning if auth connection dies.


M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h
M	src/lib-auth/auth-server-connection.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2011-11-18 16:15:24 +0200 Timo Sirainen <tss@iki.fi> (a7e2c98)

    auth: Log a warning if auth client disconnects while it still has pending
    requests.


M	src/auth/auth-client-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request-handler.h

2011-11-18 15:52:23 +0200 Timo Sirainen <tss@iki.fi> (2aac7ca)

    login: Minor potential authentication fix when service_count>1


M	src/login-common/client-common.c
M	src/login-common/login-common.h
M	src/login-common/main.c

2011-11-17 02:02:30 +0200 Timo Sirainen <tss@iki.fi> (3653420)

    login: Fixed a memory leak when SSL client connection was closed uncleanly.


M	src/login-common/ssl-proxy-openssl.c

2011-11-17 00:49:30 +0200 Timo Sirainen <tss@iki.fi> (a710cb4)

    passdb vpopmail: Fix to handling mixed cleartext/crypt passwords.


M	src/auth/passdb-vpopmail.c

2011-11-17 00:41:15 +0200 Timo Sirainen <tss@iki.fi> (6272526)

    login proxy: Don't fail connection if CRL isn't found for some certificate.


M	src/login-common/ssl-proxy-openssl.c

2011-11-16 22:59:36 +0200 Timo Sirainen <tss@iki.fi> (5cc9289)

    i_getgr*(): Use a generic workaround for all OSes that report too small
    grbuf size.


M	src/lib/ipwd.c

2011-11-16 22:13:35 +0200 Timo Sirainen <tss@iki.fi> (fdfb215)

    checkpassword: Export all auth %variables to AUTH_* environment.


M	src/auth/db-checkpassword.c

2011-11-16 20:24:07 +0200 Timo Sirainen <tss@iki.fi> (d16cbc7)

    lmtp: Include local/remote port in userdb lookups.


M	src/lmtp/commands.c

2011-11-16 20:23:50 +0200 Timo Sirainen <tss@iki.fi> (27ca6cb)

    lib-storage: Added local/remote port to struct mail_storage_service_input
    for userdb lookups.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2011-11-16 20:00:37 +0200 Timo Sirainen <tss@iki.fi> (6e7954b)

    lib-storage: Fixed listing subscriptions from prefix!="" namespace


M	src/lib-storage/list/mailbox-list-subscriptions.c

2011-11-16 19:48:01 +0200 Timo Sirainen <tss@iki.fi> (1227ccf)

    lib-storage: Fixed error handling for mailbox_set_subscribed()


M	src/lib-storage/mail-storage.c

2011-11-16 19:39:33 +0200 Timo Sirainen <tss@iki.fi> (708efcd)

    lib-storage: Fixed using "auto" driver with shared namespaces.


M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/index/shared/shared-storage.h

2011-11-16 19:39:18 +0200 Timo Sirainen <tss@iki.fi> (259c345)

    lib-storage: Improved storage creation failure error message for "auto"
    driver.


M	src/lib-storage/mail-storage.c

2011-11-16 19:38:55 +0200 Timo Sirainen <tss@iki.fi> (f8e4a8e)

    lib-storage: Crashfix for "auto" driver in some situations.


M	src/lib-storage/mail-storage.c

2011-11-16 19:38:16 +0200 Timo Sirainen <tss@iki.fi> (810321f)

    lib-storage: Use namespace owner user's home dir for autodetection (for
    shared namespaces).


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c

2011-11-16 19:14:43 +0200 Timo Sirainen <tss@iki.fi> (56c122d)

    man: Dovecot version numbers updated.


M	doc/man/doveadm-altmove.1.in
M	doc/man/doveadm-auth.1.in
M	doc/man/doveadm-director.1.in
M	doc/man/doveadm-dump.1.in
M	doc/man/doveadm-expunge.1.in
M	doc/man/doveadm-fetch.1.in
M	doc/man/doveadm-force-resync.1.in
M	doc/man/doveadm-help.1.in
M	doc/man/doveadm-import.1.in
M	doc/man/doveadm-index.1.in
M	doc/man/doveadm-kick.1.in
M	doc/man/doveadm-log.1.in
M	doc/man/doveadm-mailbox.1.in
M	doc/man/doveadm-move.1.in
M	doc/man/doveadm-penalty.1.in
M	doc/man/doveadm-purge.1.in
M	doc/man/doveadm-pw.1.in
M	doc/man/doveadm-quota.1.in
M	doc/man/doveadm-search-query.7
M	doc/man/doveadm-search.1.in
M	doc/man/doveadm-user.1.in
M	doc/man/doveadm-who.1.in
M	doc/man/doveadm.1.in
M	doc/man/doveconf.1.in
M	doc/man/dovecot-lda.1.in
M	doc/man/dovecot.1.in
M	doc/man/dsync.1.in

2011-11-16 19:06:20 +0200 Timo Sirainen <tss@iki.fi> (626e383)

    config: Skip spaces between '<' and value in "key=< value"


M	src/config/config-parser.c

2011-11-16 19:04:31 +0200 Timo Sirainen <tss@iki.fi> (2806f15)

    master: Don't log errors at shutdown about services' "command startup
    failed".


M	src/master/service-monitor.c

2011-11-16 18:15:46 +0200 Timo Sirainen <tss@iki.fi> (28dae6a)

    login: Improved auth failed log messages.


M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2011-11-16 00:28:32 +0200 Timo Sirainen <tss@iki.fi> (9ab62bf)

    man: Fixes to previous doveadm-search-query.7 change.


M	doc/man/doveadm-search-query.7

2011-11-15 22:24:18 +0200 Timo Sirainen <tss@iki.fi> (208f88f)

    man: Updated doveadm-search-query.7 to include MAILBOX[-GUID] as search
    keys.


M	doc/man/doveadm-search-query.7

2011-11-15 20:58:48 +0200 Timo Sirainen <tss@iki.fi> (904324b)

    master: Don't throttle successfully started services just because their
    processes didn't have clients.


M	src/master/service-monitor.c

2011-11-15 20:56:59 +0200 Timo Sirainen <tss@iki.fi> (5bbcbf5)

    stats: If process has crashed/restarted, hide initial "missing session GUID"
    warnings.


M	src/stats/mail-session.c

2011-11-15 18:29:52 +0200 Timo Sirainen <tss@iki.fi> (c886132)

    configure: Don't reorder --with-storages values. The ordering is used for
    storage autodetection.


M	configure.in

2011-11-15 18:29:14 +0200 Timo Sirainen <tss@iki.fi> (13307d0)

    mdbox: Added support for autodetection of ~/mdbox/ as mdbox storage.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2011-11-15 18:21:39 +0200 Timo Sirainen <tss@iki.fi> (c5ae8a7)

    lib-storage: Added "auto" mail storage driver for forcing autodetection.


M	src/lib-storage/mail-storage.c

2011-11-15 17:40:13 +0200 Timo Sirainen <tss@iki.fi> (e1ba134)

    stats: Freeing a user didn't remove it from hash table, leading to crash
    later.


M	src/stats/mail-user.c

2011-11-15 00:34:00 +0200 Timo Sirainen <tss@iki.fi> (80bcc6c)

    maildir: Added maildir_broken_filename_sizes setting.


M	doc/example-config/conf.d/10-mail.conf
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-settings.h

2011-11-15 00:05:50 +0200 Timo Sirainen <tss@iki.fi> (3ec3632)

    maildir: When noticing invalid 'S' in filename, replace it with the correct
    one instead of removing it.


M	src/lib-storage/index/maildir/maildir-mail.c

2011-11-14 23:15:37 +0200 Timo Sirainen <tss@iki.fi> (c632d13)

    imap-stats: Don't send IDLE command updates to stats service.


M	src/plugins/imap-stats/imap-stats-plugin.c

2011-11-14 23:15:17 +0200 Timo Sirainen <tss@iki.fi> (fb9509f)

    stats: Forcibly free command after running for 15 minutes without updates.


M	src/stats/mail-command.c

2011-11-09 22:58:38 +0200 Timo Sirainen <tss@iki.fi> (3920063)

    maildir++: If listing finds non-mUTF7/UTF8 mailbox dir, rename it instead of
    assert-crashing later.


M	src/lib-storage/list/mailbox-list-maildir-iter.c

2011-11-09 18:33:59 +0200 Timo Sirainen <tss@iki.fi> (1a7f099)

    master: Increase process count limit (ulimit -u) at startup high enough that
    we don't reach it.


M	src/master/main.c

2011-11-09 18:30:27 +0200 Timo Sirainen <tss@iki.fi> (9ebd0c5)

    restrict_process_size() API changes.


M	src/lib/restrict-process-size.c
M	src/lib/restrict-process-size.h
M	src/login-common/main.c
M	src/master/service-process.c

2011-11-09 18:20:51 +0200 Timo Sirainen <tss@iki.fi> (4b5ba50)

    restrict_access*(): If setuid() fails with EAGAIN, suggest ulimit -u being
    the problem.


M	src/lib/restrict-access.c

2011-11-09 18:14:04 +0200 Timo Sirainen <tss@iki.fi> (ef56d74)

    imap/pop3-login: Use default_vsz_limit instead of adding our own. There's
    not a huge difference between 64 MB and the default 256 MB, and this change
    makes it easier to change the default limit globally.


M	src/imap-login/imap-login-settings.c
M	src/pop3-login/pop3-login-settings.c

2011-11-09 18:07:28 +0200 Timo Sirainen <tss@iki.fi> (59b7dc2)

    master: vsz_limit enforcement was done for 1024 times too much memory.


M	src/master/service-process.c

2011-11-09 18:05:25 +0200 Timo Sirainen <tss@iki.fi> (e960fec)

    lmtp: Default vsz_limit wasn't used for lmtp service.


M	src/lmtp/lmtp-settings.c

2011-11-09 14:15:18 +0200 Timo Sirainen <tss@iki.fi> (b12b6da)

    maildir: When fixing broken size in filename, try harder to find the latest
    filename.


M	src/lib-storage/index/maildir/maildir-mail.c

2011-11-09 13:24:49 +0200 Timo Sirainen <tss@iki.fi> (2bde897)

    maildir: Whenever we're guessing a filename correctly, remember it in
    uidlist.


M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-uidlist.h
M	src/lib-storage/index/maildir/maildir-util.c

2011-11-09 12:55:37 +0200 Timo Sirainen <tss@iki.fi> (876a944)

    maildir: When renaming filename due to broken size, don't forget message
    flags.


M	src/lib-storage/index/maildir/maildir-mail.c

2011-11-09 00:10:07 +0200 Timo Sirainen <tss@iki.fi> (aecb973)

    Added signature for changeset 437ae2c24872


M	.hgsigs

2011-11-09 00:10:04 +0200 Timo Sirainen <tss@iki.fi> (5c63c7f)

    Added tag 2.1.beta1 for changeset 437ae2c24872


M	.hgtags

2011-11-09 00:10:04 +0200 Timo Sirainen <tss@iki.fi> (25af252)

    Released v2.1.beta1.


M	NEWS
M	configure.in

2011-11-09 00:09:35 +0200 Timo Sirainen <tss@iki.fi> (93b7a21)

    Make static analyzer happier.


M	src/lib-storage/list/mailbox-list-index-sync.c

2011-11-08 23:45:05 +0200 Timo Sirainen <tss@iki.fi> (97fb0af)

    TODO updated


M	TODO

2011-11-08 23:44:31 +0200 Timo Sirainen <tss@iki.fi> (6a40392)

    README: Added FUZZY RFC.


M	README

2011-11-08 23:40:54 +0200 Timo Sirainen <tss@iki.fi> (831f3bc)

    login proxy: Verify that remote hostname matches SSL cert, unless
    ssl=any-cert


M	configure.in
M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/login-common/Makefile.am
M	src/login-common/login-proxy.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/login-common/ssl-proxy.h

2011-11-08 22:49:57 +0200 Timo Sirainen <tss@iki.fi> (74ec4fe)

    eacces_error_get*(): Crashfix for recent change.


M	src/lib/eacces-error.c

2011-11-08 22:38:36 +0200 Timo Sirainen <tss@iki.fi> (45799f8)

    maildir: Log less lines when removing broken sizes from filenames.


M	src/lib-storage/index/maildir/maildir-mail.c

2011-11-08 21:50:46 +0200 Timo Sirainen <tss@iki.fi> (e5097d2)

    master: Never create new processes for services that are being destroyed
    (reload, deinit)


M	src/master/service-process.c

2011-11-08 21:29:34 +0200 Timo Sirainen <tss@iki.fi> (843640f)

    login: If login fails for some reason, but auth was successful, don't log
    "auth failed". For example if proxy fails to connect to remote server.


M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2011-11-08 21:14:32 +0200 Timo Sirainen <tss@iki.fi> (9ec06bb)

    login proxy: Always log the username in the error messages.


M	src/login-common/login-proxy.c

2011-11-07 22:54:32 +0200 Timo Sirainen <tss@iki.fi> (8eefc42)

    auth: When complaining about auth-userdb permission errors, log also the
    wanted UID's name.


M	src/auth/auth-master-connection.c

2011-11-07 22:17:15 +0200 Timo Sirainen <tss@iki.fi> (4605fd7)

    indexer-worker: If indexes are disabled for a mailbox, do nothing but log a
    message.


M	src/indexer/master-connection.c

2011-11-07 20:45:55 +0200 Timo Sirainen <tss@iki.fi> (5d46f4d)

    master: Fixed giving config socket path to anvil process.


M	src/master/service-process.c

2011-11-05 20:35:56 +0200 Timo Sirainen <tss@iki.fi> (5d1ae89)

    configure: Use libtool's -no-undefined flag instead of attempting it
    ourself. Patch by Brad.


M	configure.in

2011-11-05 19:59:55 +0200 Timo Sirainen <tss@iki.fi> (a478890)

    doveadm import: Added -s parameter to subscribe to created mailboxes.


M	src/doveadm/doveadm-mail-import.c

2011-11-05 19:37:23 +0200 Timo Sirainen <tss@iki.fi> (a03eb91)

    dsync: Set user to be admin to ignore quota limits.


M	src/dsync/dsync.c

2011-11-05 19:37:02 +0200 Timo Sirainen <tss@iki.fi> (97daba8)

    quota: Ignore quota limits for admin users.


M	src/plugins/quota/quota.c

2011-11-05 19:17:59 +0200 Timo Sirainen <tss@iki.fi> (1c7b0cb)

    master: Wait for services to stop listening before unlinking the pid file.


M	src/master/main.c
M	src/master/service-monitor.c
M	src/master/service-monitor.h
M	src/master/service.c
M	src/master/service.h

2011-11-05 17:59:11 +0200 Timo Sirainen <tss@iki.fi> (969c10c)

    fts-lucene: Use FTS_BACKEND_FLAG_BUILD_FULL_WORDS flag.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2011-11-05 17:58:50 +0200 Timo Sirainen <tss@iki.fi> (84f447a)

    fts: Added FTS_BACKEND_FLAG_BUILD_FULL_WORDS for sending data to backends
    only in full words.


M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-build-mail.c

2011-11-05 17:31:47 +0200 Timo Sirainen <tss@iki.fi> (65a67a3)

    fts-lucene: Optimize searching for existence of an indexed header.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-11-05 17:30:55 +0200 Timo Sirainen <tss@iki.fi> (d294543)

    fts-lucene: Index the header name tokenized, or we can't search it.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-11-05 17:11:40 +0200 Timo Sirainen <tss@iki.fi> (1c8457a)

    fts-lucene: Fixed handling "maybe" queries (unindexed headers)


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-11-04 21:57:05 +0000 Pascal Volk <user@localhost.localdomain.org> (e5c0676)

    man: Added -f option to doveadm-user.1.


M	doc/man/doveadm-user.1.in

2011-11-05 00:07:14 +0200 Timo Sirainen <tss@iki.fi> (c53a0a2)

    Use SSL_MODE_RELEASE_BUFFERS if available to keep memory usage low. Based on
    patch by Cristian RodrÃ­guez.


M	src/login-common/ssl-proxy-openssl.c

2011-11-05 00:00:49 +0200 Timo Sirainen <tss@iki.fi> (1906aea)

    lmtp: Changed default client_limit to 1. LMTP processes can wait a long time
    on disk I/O, so a single process will be busy waiting long before it reaches
    default_client_limit (100).


M	src/lmtp/lmtp-settings.c

2011-11-04 21:21:11 +0200 Timo Sirainen <tss@iki.fi> (ee773c0)

    imapc: When doing a LIST, delete any extra local mailbox (index)
    directories.


M	src/lib-storage/index/imapc/imapc-list.c

2011-11-04 21:20:19 +0200 Timo Sirainen <tss@iki.fi> (7cf1c7d)

    imapc: Don't use separate indexes/ directory anymore. Fixes/cleanups to make
    it possible.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2011-11-04 21:17:09 +0200 Timo Sirainen <tss@iki.fi> (f86a920)

    imapc: If rawlog directory doesn't exist, silently ignore it.


M	src/lib-imap-client/imapc-connection.c

2011-11-04 20:36:28 +0200 Timo Sirainen <tss@iki.fi> (8e69d32)

    imapc: Index files weren't deleted when mailbox was deleted.


M	src/lib-storage/index/imapc/imapc-list.c

2011-11-04 20:36:06 +0200 Timo Sirainen <tss@iki.fi> (fd05752)

    lib-storage: Added MAILBOX_LIST_FLAG_OPTIONAL_BOXES flag.


M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mailbox-list.h

2011-11-04 20:11:39 +0200 Timo Sirainen <tss@iki.fi> (ab96e72)

    anvil: Handle crash restarts without failing completely.


M	src/anvil/anvil-connection.c
M	src/anvil/common.h
M	src/anvil/main.c
M	src/master/service-anvil.c
M	src/master/service-anvil.h
M	src/master/service-process.c

2011-11-04 19:52:26 +0200 Timo Sirainen <tss@iki.fi> (0374f48)

    doveadm dump index: Dump also mime.parts decoded.


M	src/doveadm/doveadm-dump-index.c

2011-11-04 19:35:30 +0200 Timo Sirainen <tss@iki.fi> (2e5d624)

    fts-lucene: Added whitespace_chars subsetting to fts_lucene. A value of "@."
    could be useful so that user@domain.tld allows searching user, domain and
    tld separately instead of requiring the whole string to match.


M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-11-04 18:50:24 +0200 Timo Sirainen <tss@iki.fi> (93e742e)

    eacces_error_get*(): Log if group has r/w permissions, but we don't belong
    to it.


M	src/lib/eacces-error.c

2011-10-25 22:58:48 +0300 Timo Sirainen <tss@iki.fi> (2f6a8ef)

    master: Assert-crashfix when service process limit was reached. Introduced
    by commit fddbb26400d0.


M	src/master/service-monitor.c

2011-10-25 21:44:38 +0300 Timo Sirainen <tss@iki.fi> (93c3674)

    login: When renegotiating SSL handshake, don't reread settings when TLS SNI
    is used.


M	src/login-common/client-common.h
M	src/login-common/ssl-proxy-openssl.c

2011-10-25 21:41:28 +0300 Timo Sirainen <tss@iki.fi> (3422842)

    login: Increased client's initial memory pool size.


M	src/login-common/main.c

2011-10-20 18:37:09 +0300 Timo Sirainen <tss@iki.fi> (acef354)

    master: When process_limit fills up, wait 10s before closing pending
    connections. It might have only been a temporary burst that gets resolved
    quickly enough.


M	src/master/service-monitor.c
M	src/master/service.h

2011-10-20 18:26:15 +0300 Timo Sirainen <tss@iki.fi> (605cce7)

    master: Reset service's listen_pending flag when it gets a new available
    process.


M	src/master/service-monitor.c

2011-10-20 16:54:36 +0300 Timo Sirainen <tss@iki.fi> (05b24d0)

    imapc: Fixed reopening a mailbox.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h

2011-10-19 16:11:44 +0300 Timo Sirainen <tss@iki.fi> (d336f59)

    auth: passdb static crashed if no password was given


M	src/auth/passdb-static.c

2011-10-18 16:53:06 +0300 Timo Sirainen <tss@iki.fi> (de4e3a2)

    maildir: If maildir filename has broken W/S size, rename the file to drop
    them.


M	src/lib-storage/index/maildir/maildir-mail.c

2011-10-18 16:52:23 +0300 Timo Sirainen <tss@iki.fi> (601c1dd)

    istream-mail: Call mail_cache_set_corrupted() properly


M	src/lib-storage/index/istream-mail.c

2011-10-17 15:35:54 +0300 Timo Sirainen <tss@iki.fi> (3577975)

    imapc: Added imapc_ssl_verify setting.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2011-10-12 19:09:02 +0300 Timo Sirainen <tss@iki.fi> (9c0716d)

    mail-log: Use mail_log_update_wanted_fields() to avoid parsing message
    multiple times.


M	src/plugins/mail-log/mail-log-plugin.c

2011-10-12 19:08:31 +0300 Timo Sirainen <tss@iki.fi> (ecd69c4)

    lib-storage: Added mail_log_update_wanted_fields()


M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/lib-storage/test-mail.c
M	src/plugins/virtual/virtual-mail.c

2011-10-12 17:21:01 +0300 Timo Sirainen <tss@iki.fi> (72c25bc)

    mdbox rebuild: Log an error whenever opening a mailbox fails.


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2011-10-12 19:07:07 +0300 Timo Sirainen <tss@iki.fi> (0b5cf16)

    imapc: Mail body wasn't always prefetched when it should have been.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-10-09 20:46:53 +0300 Timo Sirainen <tss@iki.fi> (019ae3c)

    imapc: When asking for capabilities, try to ask from a logged in connection.


M	src/lib-imap-client/imapc-client.c

2011-10-09 20:46:28 +0300 Timo Sirainen <tss@iki.fi> (a202165)

    imapc: Post-login capabilities weren't detected/used.


M	src/lib-imap-client/imapc-connection.c

2011-10-09 20:38:11 +0300 Timo Sirainen <tss@iki.fi> (f87844c)

    imapc: Support retrying some IMAP commands if we get disconnected.


M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/imapc/imapc-sync.h

2011-10-09 20:36:28 +0300 Timo Sirainen <tss@iki.fi> (428fb4d)

    lib-imap: Added reference counting to imap parser.


M	src/director/director-test.c
M	src/imap-login/client.c
M	src/imap/cmd-append.c
M	src/imap/imap-client.c
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-parser.h
M	src/lib-imap/test-imap-parser.c
M	src/plugins/virtual/virtual-config.c

2011-10-09 19:04:27 +0300 Timo Sirainen <tss@iki.fi> (b2048c4)

    imapc: Mailbox reopening fix.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-10-09 19:04:15 +0300 Timo Sirainen <tss@iki.fi> (f4ec0cc)

    imapc: Fixed expunging too many messages from index.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-10-09 18:27:54 +0300 Timo Sirainen <tss@iki.fi> (4a4fe31)

    imapc: Better implementation of checking if index is missing messages.


M	src/lib-storage/index/imapc/imapc-sync.c

2011-10-09 18:25:18 +0300 Timo Sirainen <tss@iki.fi> (922fc89)

    imapc: Fixes to sending commands.


M	src/lib-imap-client/imapc-connection.c

2011-10-09 17:15:31 +0300 Timo Sirainen <tss@iki.fi> (b50e80d)

    imapc: Fixed detecting when messages are missing from index.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2011-10-09 16:41:17 +0300 Timo Sirainen <tss@iki.fi> (edcd6f7)

    imapc: Initial support for automatically reconnecting to remote server.


M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h
M	src/lib-imap-client/imapc-msgmap.c
M	src/lib-imap-client/imapc-msgmap.h
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-10-08 20:31:22 +0300 Timo Sirainen <tss@iki.fi> (34bc7b5)

    imapc: Fixed updating message flags from another session.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-10-07 21:15:52 +0300 Timo Sirainen <tss@iki.fi> (c33cf22)

    imapc: Fixed handling keywords. The status->keywords must point to
    mail_index's keywords.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-10-07 21:14:58 +0300 Timo Sirainen <tss@iki.fi> (dcb96a0)

    imapc: Detect when message has been unexpectedly expunged from index.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-10-07 20:50:02 +0300 Timo Sirainen <tss@iki.fi> (4769563)

    imapc: IDLE didn't notify immediately about new mails.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-10-07 20:49:32 +0300 Timo Sirainen <tss@iki.fi> (f5be4f5)

    imapc: Code cleanup: avoid unnecessarily accessing imapc-client-private.h


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-10-07 20:34:53 +0300 Timo Sirainen <tss@iki.fi> (f084de1)

    imapc: Removed unused "stop now" functionality.


M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c

2011-10-07 20:31:57 +0300 Timo Sirainen <tss@iki.fi> (fb37a9b)

    imapc: Changed mailbox opening API to be more extensible.


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-storage.c

2011-10-07 20:10:11 +0300 Timo Sirainen <tss@iki.fi> (81d3c21)

    imapc: Command sending API changed to be more extensible.


M	src/lib-imap-client/imapc-client-private.h
M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-imap-client/imapc-connection.c
M	src/lib-imap-client/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c

2011-10-07 19:25:52 +0300 Timo Sirainen <tss@iki.fi> (e5a7769)

    auth: Don't re-add IO to master connection input. This fixes a panic crash
    in some situations.


M	src/auth/auth-master-connection.c

2011-10-07 18:18:20 +0300 Timo Sirainen <tss@iki.fi> (86a5833)

    auth: Improved "auth client doesn't have permissions to do .." errors.


M	src/auth/auth-master-connection.c
M	src/auth/auth-master-connection.h
M	src/auth/main.c

2011-10-05 18:47:56 +0300 Timo Sirainen <tss@iki.fi> (01fd545)

    pop3: When pop3_fast_size_lookups=yes, don't assume we need to fetch virtual
    size. This fixes prefetch unnecessarily opening mail files.


M	src/pop3/pop3-client.c

2011-10-05 17:55:29 +0300 Timo Sirainen <tss@iki.fi> (13f6c87)

    imapc: Fixed fetching data for a saved, but uncommitted, mail.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-10-05 17:51:32 +0300 Timo Sirainen <tss@iki.fi> (8774548)

    lib-storage: Fixed reopening a mail stream.


M	src/lib-storage/index/index-mail.c

2011-10-05 17:51:01 +0300 Timo Sirainen <tss@iki.fi> (6ac48a4)

    imapc: Memory leak fixes.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2011-10-05 17:34:51 +0300 Timo Sirainen <tss@iki.fi> (15979d1)

    imapc: Fixed closing mail properly.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2011-10-05 17:34:16 +0300 Timo Sirainen <tss@iki.fi> (9cc5bd0)

    imapc: Fixed potential assert-crash when saving a mail.


M	src/lib-storage/index/imapc/imapc-save.c

2011-10-05 17:21:46 +0300 Timo Sirainen <tss@iki.fi> (7e24f82)

    imapc: Fixed "Bad file descriptor" errors after mail was closed.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-10-05 15:57:03 +0300 Timo Sirainen <tss@iki.fi> (5b6854f)

    raw storage: Don't crash with mailbox_get_metadata()


M	src/lib-storage/index/raw/raw-storage.c

2011-10-04 17:22:55 +0300 Timo Sirainen <tss@iki.fi> (7c3f900)

    lib-storage: Verify that cached message size matches actually read size.


M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
D	src/lib-storage/index/istream-mail-stats.c
D	src/lib-storage/index/istream-mail-stats.h
A	src/lib-storage/index/istream-mail.c
A	src/lib-storage/index/istream-mail.h

2011-10-04 17:17:12 +0300 Timo Sirainen <tss@iki.fi> (6df0ab0)

    lib-storage: Added mail_get_hdr_stream() and use it where possible. This
    makes it clearer for backends when it needs a message body instead of only
    message header.


M	src/doveadm/doveadm-mail-fetch.c
M	src/imap/imap-fetch-body.c
M	src/lib-lda/mail-send.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-mail.h
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/lib-storage/test-mail.c
M	src/plugins/virtual/virtual-mail.c

2011-10-04 17:14:30 +0300 Timo Sirainen <tss@iki.fi> (0daf6ff)

    imapc: Mail body caching should be done at close(), not at free(). This
    cached wrong mail bodies when fetching multiple mails.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-10-03 20:00:55 +0300 Timo Sirainen <tss@iki.fi> (c0ebeec)

    script-login: Disable alarm after input has been read.


M	src/util/script-login.c

2011-10-02 20:26:02 +0300 Timo Sirainen <tss@iki.fi> (1fb1687)

    passdb vpopmail: Always prefer to lookup plaintext password if it exists.
    This is important when multiple auth mechanisms are used and the password is
    cached.


M	src/auth/passdb-vpopmail.c

2011-10-02 20:09:04 +0300 Timo Sirainen <tss@iki.fi> (8746285)

    mailbox list indexes: Get mailbox_get_metadata(guid) from index if possible.


M	src/lib-storage/list/mailbox-list-index-status.c

2011-10-02 20:06:58 +0300 Timo Sirainen <tss@iki.fi> (206ed2f)

    lib-storage: mailbox_get_metadata() no longer always opens mailbox.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/mail-storage.c
M	src/plugins/virtual/virtual-storage.c

2011-10-02 20:05:23 +0300 Timo Sirainen <tss@iki.fi> (4552316)

    lib-storage: Compile fix for recent change.


M	src/lib-storage/mail-storage.c

2011-10-02 18:54:32 +0300 Timo Sirainen <tss@iki.fi> (c59137a)

    maildir: Maildir list index change check should always check index log
    changes. (Not only when maildir_very_dirty_syncs=no)


M	src/lib-storage/index/maildir/maildir-sync-index.c

2011-10-02 18:49:09 +0300 Timo Sirainen <tss@iki.fi> (167da29)

    mailbox list indexes: Handle name="" mailboxes.


M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c

2011-10-02 18:39:49 +0300 Timo Sirainen <tss@iki.fi> (93ec3b0)

    lib-storage: Mailbox list index's ext_id shouldn't be cached in
    mail_storage. It's mailbox_list-specific, not mail_storage-specific. The
    easiest fix was to just cache it into mailbox rather than create a new
    index_mailbox_list.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/mail-storage-private.h

2011-10-02 18:30:32 +0300 Timo Sirainen <tss@iki.fi> (0daea62)

    mailbox list indexes: Added comment.


M	src/lib-storage/list/mailbox-list-index.h

2011-10-02 18:12:05 +0300 Timo Sirainen <tss@iki.fi> (7887dbf)

    mailbox list indexes: Code cleanups.


M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2011-10-02 17:48:23 +0300 Timo Sirainen <tss@iki.fi> (3a78410)

    mailbox list indexes: Error handling fixes.


M	src/lib-storage/list/mailbox-list-index-status.c
M	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2011-10-02 17:34:49 +0300 Timo Sirainen <tss@iki.fi> (39140d6)

    mailbox list indexes: Moved syncing code to separate file.


M	src/lib-storage/list/Makefile.am
A	src/lib-storage/list/mailbox-list-index-sync.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2011-10-02 17:18:31 +0300 Timo Sirainen <tss@iki.fi> (66e1cf5)

    mailbox list indexes: Moved iteration code to separate file.


M	src/lib-storage/list/Makefile.am
A	src/lib-storage/list/mailbox-list-index-iter.c
M	src/lib-storage/list/mailbox-list-index.c
M	src/lib-storage/list/mailbox-list-index.h

2011-10-02 17:12:58 +0300 Timo Sirainen <tss@iki.fi> (9afe1b3)

    Renamed index-mailbox-list* to mailbox-list-index*


M	src/lib-storage/list/Makefile.am
R089	src/lib-storage/list/index-mailbox-list-status.c	src/lib-storage/list/mailbox-list-index-status.c
R071	src/lib-storage/list/index-mailbox-list.c	src/lib-storage/list/mailbox-list-index.c
R067	src/lib-storage/list/index-mailbox-list.h	src/lib-storage/list/mailbox-list-index.h
M	src/lib-storage/register/Makefile.am

2011-10-02 16:59:51 +0300 Timo Sirainen <tss@iki.fi> (0fe3759)

    mailbox list indexes: Disable index files for shared/public namespaces.


M	src/lib-storage/list/index-mailbox-list.c

2011-10-02 16:55:45 +0300 Timo Sirainen <tss@iki.fi> (6842737)

    mailbox list indexes: Use storage names instead of virtual names.


M	src/lib-storage/list/index-mailbox-list-status.c
M	src/lib-storage/list/index-mailbox-list.c
M	src/lib-storage/list/index-mailbox-list.h

2011-10-02 16:51:40 +0300 Timo Sirainen <tss@iki.fi> (8aa6098)

    lmtp: Code cleanup.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2011-10-02 16:47:25 +0300 Timo Sirainen <tss@iki.fi> (accc2e8)

    lda: Code cleanups


M	src/lda/main.c

2011-10-02 16:35:22 +0300 Timo Sirainen <tss@iki.fi> (15dd185)

    lda/lmtp: Moved common raw mailbox allocation code to raw-storage.


M	src/lda/main.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-storage.h
M	src/lmtp/commands.c

2011-10-02 16:34:41 +0300 Timo Sirainen <tss@iki.fi> (a128174)

    lib-storage: Keep mail_user referenced while storage objects exist. This
    allows unreferencing mail_user after mailbox_alloc() and having it freed on
    mailbox_free().


M	src/lib-storage/mail-storage.c

2011-10-02 16:33:51 +0300 Timo Sirainen <tss@iki.fi> (b7fa2a0)

    ioloop: Memory leak fix on ioloop destroy.


M	src/lib/ioloop.c

2011-10-02 16:32:59 +0300 Timo Sirainen <tss@iki.fi> (c1d4780)

    istream-seekable: Memory leak fix.


M	src/lib/istream-seekable.c

2011-10-02 16:03:10 +0300 Timo Sirainen <tss@iki.fi> (34e9dfb)

    lda/lmtp: Moved raw user creation code to common
    raw_storage_create_from_set()


M	src/lda/main.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-storage.h
M	src/lmtp/client.c

2011-10-02 15:39:45 +0300 Timo Sirainen <tss@iki.fi> (9408711)

    mailbox list index: Minor code cleanup.


M	src/lib-storage/list/index-mailbox-list-status.c

2011-10-01 17:55:18 +0300 Timo Sirainen <tss@iki.fi> (cdf00df)

    imapc: Changed imapc_client_mailbox_cmd() parameter order to be same as in
    _cmdf().


M	src/lib-imap-client/imapc-client.c
M	src/lib-imap-client/imapc-client.h
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c

2011-10-01 17:54:57 +0300 Timo Sirainen <tss@iki.fi> (92daf55)

    imapc: Don't assert-crash when receiving 0 size literal.


M	src/lib-imap-client/imapc-connection.c

2011-10-01 17:47:35 +0300 Timo Sirainen <tss@iki.fi> (17f2b26)

    imapc: Make sure "is mail expunged?" NOOP is sent to correct connection.
    (Although currently there are never more than a single connection.)


M	src/lib-storage/index/imapc/imapc-mail.c

2011-10-01 17:41:12 +0300 Timo Sirainen <tss@iki.fi> (97ff916)

    imapc: Make sure mail cache is freed when mailbox is closed.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-10-01 17:34:39 +0300 Timo Sirainen <tss@iki.fi> (966cb0c)

    auth: Lazily load authdb_* and mech_* plugins only when they're needed.


M	src/auth/auth-common.h
M	src/auth/main.c
M	src/auth/mech.c
M	src/auth/passdb.c
M	src/auth/userdb.c

2011-10-01 17:24:09 +0300 Timo Sirainen <tss@iki.fi> (7732d9f)

    auth: Renamed passdb_imap plugin to authdb_imap.


M	src/auth/Makefile.am
M	src/auth/passdb-imap.c

2011-10-01 17:22:44 +0300 Timo Sirainen <tss@iki.fi> (39d3ce1)

    module_dir_load*(): Support filtering and ignoring missing modules.


M	src/lib/module-dir.c
M	src/lib/module-dir.h

2011-10-01 17:09:00 +0300 Timo Sirainen <tss@iki.fi> (ec89270)

    Added ssl_protocols setting.


M	doc/example-config/conf.d/10-ssl.conf
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h
M	src/login-common/ssl-proxy-openssl.c

2011-10-01 17:06:04 +0300 Timo Sirainen <tss@iki.fi> (269f798)

    doveadm: Compile fix for previous auth change.


M	src/doveadm/doveadm-pw.c

2011-10-01 16:48:17 +0300 Timo Sirainen <tss@iki.fi> (ce6c280)

    auth: If password data isn't valid for specified scheme, give a better error
    message.


M	src/auth/auth-request.c
M	src/auth/passdb.c
M	src/auth/password-scheme.c
M	src/auth/password-scheme.h

2011-09-30 19:02:31 +0300 Timo Sirainen <tss@iki.fi> (cf48ae7)

    imap: Memory leak fixes for invalid parameter handling.


M	src/imap/cmd-copy.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-store.c
M	src/imap/imap-search-args.c

2011-09-30 18:53:09 +0300 Timo Sirainen <tss@iki.fi> (b1a2d20)

    imapc: Keep the last fetched message body cached until mailbox is closed.
    This primarily helps partial IMAP fetches so each partial fetch doesn't
    redownload the message body.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-09-30 18:19:17 +0300 Timo Sirainen <tss@iki.fi> (0d82d77)

    imap: Moved partial fetch cache from static variable into struct client.


M	src/imap/imap-client.h
M	src/imap/imap-fetch-body.c

2011-09-30 15:54:20 +0300 Timo Sirainen <tss@iki.fi> (8363f50)

    maildir: Handle open() failing with ESTALE.


M	src/lib-storage/index/maildir/maildir-mail.c

2011-09-27 18:57:14 +0300 Timo Sirainen <tss@iki.fi> (8654934)

    stats: Mail commands were sorted in wrong order, so they were never removed
    from memory.


M	src/stats/client-export.c
M	src/stats/mail-command.c
M	src/stats/mail-command.h

2011-09-27 18:14:32 +0300 Timo Sirainen <tss@iki.fi> (d93f51b)

    pop3: Fixed POP3-order sorting.


M	src/pop3/pop3-client.c

2011-09-27 00:44:03 +0300 Timo Sirainen <tss@iki.fi> (132bd0d)

    stats: Compiler warning fixes.


M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-session.c
M	src/stats/mail-user.c

2011-09-27 00:41:49 +0300 Timo Sirainen <tss@iki.fi> (f928262)

    stats: Error message fix.


M	src/stats/mail-stats.c

2011-09-27 00:12:49 +0300 Timo Sirainen <tss@iki.fi> (28aa68c)

    Compile fix for Solaris.


M	src/lib/network.c

2011-09-26 21:55:10 +0300 Timo Sirainen <tss@iki.fi> (ae1636c)

    sdbox: Memory leak fix.


M	src/lib-storage/index/dbox-single/sdbox-sync.c

2011-09-26 15:36:21 +0300 Timo Sirainen <tss@iki.fi> (1da01ea)

    auth: Added passdb imap plugin.


M	src/auth/Makefile.am
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
A	src/auth/passdb-imap.c

2011-09-26 15:34:58 +0300 Timo Sirainen <tss@iki.fi> (5035404)

    Moved imapc-client into its own lib-imap-client library.


M	configure.in
M	src/Makefile.am
A	src/lib-imap-client/Makefile.am
R084	src/lib-storage/index/imapc/imapc-client-private.h	src/lib-imap-client/imapc-client-private.h
R090	src/lib-storage/index/imapc/imapc-client.c	src/lib-imap-client/imapc-client.c
R096	src/lib-storage/index/imapc/imapc-client.h	src/lib-imap-client/imapc-client.h
R096	src/lib-storage/index/imapc/imapc-connection.c	src/lib-imap-client/imapc-connection.c
R093	src/lib-storage/index/imapc/imapc-connection.h	src/lib-imap-client/imapc-connection.h
R100	src/lib-storage/index/imapc/imapc-msgmap.c	src/lib-imap-client/imapc-msgmap.c
R100	src/lib-storage/index/imapc/imapc-msgmap.h	src/lib-imap-client/imapc-msgmap.h
M	src/lib-storage/index/imapc/Makefile.am

2011-09-25 22:32:04 +0000 Pascal Volk <user@localhost.localdomain.org> (f6b42d6)

    man: Added doveadm move.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-move.1.in
M	doc/man/doveadm.1.in

2011-09-23 16:07:29 +0300 Timo Sirainen <tss@iki.fi> (6e03a57)

    stats: Make sure unfinished commands get freed when their session
    disconnects.


M	src/stats/mail-command.c

2011-09-23 15:01:57 +0300 Timo Sirainen <tss@iki.fi> (9757435)

    file_dotlock: And fix to previous change..


M	src/lib/file-dotlock.c

2011-09-23 15:01:23 +0300 Timo Sirainen <tss@iki.fi> (bbebb15)

    file_dotlock: Don't warn about changed mtime when it's 1 second. This is
    mainly to avoid bogus warnings with NFS and its caching.


M	src/lib/file-dotlock.c

2011-09-23 14:52:46 +0300 Timo Sirainen <tss@iki.fi> (e0cc94d)

    maildir: Improved guessing filename when it's still in new/ dir.


M	src/lib-storage/index/maildir/maildir-util.c

2011-09-23 14:38:24 +0300 Timo Sirainen <tss@iki.fi> (51335ac)

    maildir: Don't always drop new flag from files when syncing.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2011-09-23 00:49:51 +0300 Timo Sirainen <tss@iki.fi> (fa106fc)

    lib-storage: mail_namespace_find_unalias() crashed when namespace wasn't
    found.


M	src/lib-storage/mail-namespace.c

2011-09-23 00:46:19 +0300 Timo Sirainen <tss@iki.fi> (30eb745)

    doveadm server: Previous non-authentication fix broken authentication.


M	src/doveadm/server-connection.c

2011-09-23 00:04:11 +0300 Timo Sirainen <tss@iki.fi> (c87e043)

    fts: Support also RFC 2231 style parsing when finding the attachment
    filename.


M	src/plugins/fts/fts-parser-script.c

2011-09-22 23:59:48 +0300 Timo Sirainen <tss@iki.fi> (88013ee)

    fts: Fixed running attachment decoder scripts.


M	src/plugins/fts/fts-parser-script.c

2011-09-22 14:31:57 +0300 Timo Sirainen <tss@iki.fi> (aed004e)

    imapc: Fix to previous message saving change.


M	src/lib-storage/index/imapc/imapc-save.c

2011-09-22 14:24:03 +0300 Timo Sirainen <tss@iki.fi> (530f80f)

    imapc: Allow accessing a mail that is being saved without crashing. This
    fixes crashes with LDA, LMTP, mail_log plugin, etc.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-save.c

2011-09-22 14:21:56 +0300 Timo Sirainen <tss@iki.fi> (afb49e8)

    iampc: Small code cleanup.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-09-22 13:09:18 +0300 Timo Sirainen <tss@iki.fi> (a37b4f6)

    lib-mail: Added broken input workaround to rfc822_parse_content_param().


M	src/lib-mail/rfc822-parser.c

2011-09-22 12:54:27 +0300 Timo Sirainen <tss@iki.fi> (baebb41)

    login: Added -R <dir> parameter to write pre-login rawlogs to given
    directory.


M	src/login-common/client-common.c
M	src/login-common/login-common.h
M	src/login-common/main.c

2011-09-22 01:38:34 +0300 Timo Sirainen <tss@iki.fi> (b4b87fa)

    login: "cert required, client didn't start TLS" error could have been logged
    wrongly.


M	src/login-common/client-common.c

2011-09-21 17:51:59 +0300 Timo Sirainen <tss@iki.fi> (1c1cecd)

    Added new mail_location setting "UTF8" to use UTF-8 instead of mUTF-7 in
    storage names. This basically changes mailbox names to be UTF-8 everywhere
    where they are mUTF-7 currently (filesystem, subscriptions, etc.)


M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2011-09-21 16:18:19 +0300 Timo Sirainen <tss@iki.fi> (9efbd93)

    imapc: Don't try to send literal stream output until its '+' has been
    received.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-09-21 15:58:26 +0300 Timo Sirainen <tss@iki.fi> (0998339)

    imapc: Added imapc_rawlog_dir setting.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-21 15:57:57 +0300 Timo Sirainen <tss@iki.fi> (be6ad6e)

    Added rawlog i/ostreams.


M	src/lib/Makefile.am
A	src/lib/iostream-rawlog-private.h
A	src/lib/iostream-rawlog.c
A	src/lib/iostream-rawlog.h
A	src/lib/istream-rawlog.c
A	src/lib/istream-rawlog.h
A	src/lib/ostream-rawlog.c
A	src/lib/ostream-rawlog.h

2011-09-21 15:54:06 +0300 Timo Sirainen <tss@iki.fi> (96f0710)

    lib-ssl-iostream: If flush wants to read, make sure the flush callback isn't
    being called again.


M	src/lib-ssl-iostream/ostream-openssl.c

2011-09-21 15:53:00 +0300 Timo Sirainen <tss@iki.fi> (f285839)

    ostream: Keep track of flush callback for filter ostreams as well.


M	src/lib/ostream.c

2011-09-21 15:51:00 +0300 Timo Sirainen <tss@iki.fi> (9b2d785)

    i_stream_next_line(): Don't fail if stream doesn't have write buffer, we can
    handle it.


M	src/lib/istream.c

2011-09-21 14:40:35 +0300 Timo Sirainen <tss@iki.fi> (e3678f7)

    Simplified creating filter ostreams.


M	src/lib-fs/ostream-cmp.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream-private.h
M	src/lib/ostream.c
M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c

2011-09-21 13:56:13 +0300 Timo Sirainen <tss@iki.fi> (0536ccb)

    Renamed lib/*-internal.h files to lib/*-private.h for consistency.


M	src/lib-fs/ostream-cmp.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib-storage/index/istream-attachment.c
M	src/lib-storage/index/istream-mail-stats.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-test/test-common.c
M	src/lib/Makefile.am
M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-iolist.c
M	src/lib/ioloop-kqueue.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-kqueue.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
R097	src/lib/ioloop-internal.h	src/lib/ioloop-private.h
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
R092	src/lib/iostream-internal.h	src/lib/iostream-private.h
M	src/lib/iostream.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
R095	src/lib/istream-internal.h	src/lib/istream-private.h
M	src/lib/istream-seekable.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
R092	src/lib/ostream-internal.h	src/lib/ostream-private.h
M	src/lib/ostream.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c
M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c

2011-09-19 17:10:11 +0300 Timo Sirainen <tss@iki.fi> (8c2f2e9)

    doveadm: Fixed sending commands to doveadm server when it didn't require
    authentication.


M	src/doveadm/server-connection.c

2011-09-21 12:34:02 +0300 Timo Sirainen <tss@iki.fi> (ed41ec8)

    lib-ssl-iostream: Don't require SSL ostream to always have unlimited buffer
    size. It's important when reading/handshaking wants to write to output
    buffer, but writing itself can safely have zero sized buffer (e.g.  while
    sending a large input stream).


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/ostream-openssl.c

2011-09-20 16:44:32 +0300 Timo Sirainen <tss@iki.fi> (edb71d3)

    imapc: Added more checks to catch buggy IMAP server responses.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-msgmap.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-09-20 16:42:58 +0300 Timo Sirainen <tss@iki.fi> (0b5ae5c)

    imapc: When remote IMAP server becomes confused, don't mark our indexes
    corrupted. Mark them corrupted only when after a reconnection the initial
    mailbox sync doesn't work.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-09-20 15:36:39 +0300 Timo Sirainen <tss@iki.fi> (00bf64c)

    imapc: Filter out X-Message-Flag: header from incoming mails. This is only
    added by MS Exchange when \Flagged flag is set, so it could be made
    optional, but it probably doesn't really hurt to just make it unconditional
    to ease the configuration.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2011-09-20 15:22:37 +0300 Timo Sirainen <tss@iki.fi> (e39459a)

    imapc: If FETCH is missing a reply, but we haven't seen EXPUNGE for it, do
    NOOP and check again. This fixes checking if message is expunged with
    servers that don't immediately send EXPUNGE during UID FETCH.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-09-20 13:34:52 +0300 Timo Sirainen <tss@iki.fi> (feccf3f)

    Increased initial memory pool sizes.


M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/mail-storage-service.c

2011-09-20 13:34:36 +0300 Timo Sirainen <tss@iki.fi> (b148680)

    imapc: If mailbox sync fails, don't mark index corrupted. The sync could
    have failed because of disconnection. The failure will just cause the sync
    to be rollbacked and retried later. No need to delete the whole index.


M	src/lib-storage/index/imapc/imapc-sync.c

2011-09-20 13:33:34 +0300 Timo Sirainen <tss@iki.fi> (bcf478a)

    imapc: next_uid was sometimes lowered.


M	src/lib-storage/index/imapc/imapc-sync.c

2011-09-20 13:31:32 +0300 Timo Sirainen <tss@iki.fi> (bff477a)

    imapc: When IMAP server unexpectedly doesn't send a reply, log also the
    mailbox name.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-09-20 13:30:08 +0300 Timo Sirainen <tss@iki.fi> (8d6a6ec)

    inotify: If read() fails with EAGAIN, ignore it instead of dying.


M	src/lib/ioloop-notify-inotify.c

2011-09-20 11:53:02 +0300 Timo Sirainen <tss@iki.fi> (d5e131e)

    imapc: Handle disconnection better when fetching a mail.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-09-19 18:41:36 +0300 Timo Sirainen <tss@iki.fi> (9b8fa20)

    Enable --no-undefined linker flag only for Linux. BSDs don't seem to be
    happy with it.


M	configure.in

2011-09-19 18:33:40 +0300 Timo Sirainen <tss@iki.fi> (57a712a)

    fts-lucene: Fixed to work without stemmer support.


M	src/plugins/fts-lucene/fts-lucene-plugin.c

2011-09-19 18:28:14 +0300 Timo Sirainen <tss@iki.fi> (bb55679)

    Compile fix for OpenBSD.


M	src/lib/network.c

2011-09-19 14:25:29 +0300 Timo Sirainen <tss@iki.fi> (3b1c890)

    doveadm: Typofix s/messsage/message/


M	src/doveadm/doveadm-mail-move.c

2011-09-16 17:00:30 +0300 Timo Sirainen <tss@iki.fi> (2275a39)

    Added signature for changeset f9e744ffe021


M	.hgsigs

2011-09-16 17:00:24 +0300 Timo Sirainen <tss@iki.fi> (6e3522a)

    Added tag 2.1.alpha2 for changeset f9e744ffe021


M	.hgtags

2011-09-16 17:00:24 +0300 Timo Sirainen <tss@iki.fi> (5966e40)

    Released v2.1.alpha2.


M	configure.in

2011-09-16 16:59:10 +0300 Timo Sirainen <tss@iki.fi> (dc91208)

    Merged changes from v2.0.15.


2011-09-16 16:45:25 +0300 Timo Sirainen <tss@iki.fi> (006be1e)

    Added signature for changeset 11ef52450096


M	.hgsigs

2011-09-16 16:45:22 +0300 Timo Sirainen <tss@iki.fi> (75a5916)

    Added tag 2.0.15 for changeset 11ef52450096


M	.hgtags

2011-09-16 16:45:22 +0300 Timo Sirainen <tss@iki.fi> (cf2c26d)

    Released v2.0.15.


M	NEWS
M	configure.in

2011-09-16 16:40:32 +0300 Timo Sirainen <tss@iki.fi> (f624264)

    auth: Use "auth-worker:" log prefix for auth worker processes.


M	src/auth/main.c

2011-09-16 16:14:14 +0300 Timo Sirainen <tss@iki.fi> (35fab69)

    TODO updated


M	TODO

2011-09-16 16:01:53 +0300 Timo Sirainen <tss@iki.fi> (2fc2efa)

    acl: Fixed listing multiple shared namespaces.


M	src/plugins/acl/acl-plugin.h
M	src/plugins/acl/acl-shared-storage.c

2011-09-16 16:01:29 +0300 Timo Sirainen <tss@iki.fi> (7a2fad1)

    lib-storage: Don't try to use the same mail_storage for shared storages.
    This fixes having multiple independent shared namespaces.


M	src/lib-storage/mail-storage.c

2011-09-16 14:59:34 +0300 Timo Sirainen <tss@iki.fi> (cccfb98)

    lib-storage: Improved debug logging messages.


M	src/lib-storage/mail-storage.c

2011-09-16 14:52:29 +0300 Timo Sirainen <tss@iki.fi> (34e4d77)

    Fixes to listing mailboxes/subscriptions in shared namespaces.


M	src/imap/cmd-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-subscriptions.c

2011-09-16 13:14:11 +0300 Timo Sirainen <tss@iki.fi> (a5bb290)

    lib-storage: If shared namespace prefix doesn't end with hierarchy
    separator, fail.


M	src/lib-storage/index/shared/shared-storage.c

2011-09-16 13:06:48 +0300 Timo Sirainen <tss@iki.fi> (21ce0d7)

    lib-storage: If mailbox_rename() isn't possible and mail_debug=yes, log the
    reason why.


M	src/lib-storage/mail-storage.c

2011-09-16 12:57:40 +0300 Timo Sirainen <tss@iki.fi> (e200d1b)

    lib-storage: Changed debug message to sound less like an error message.


M	src/lib-storage/mailbox-list.c

2011-09-16 12:40:19 +0300 Timo Sirainen <tss@iki.fi> (b089505)

    quota: When matching mailbox names in quota rules, unalias namespaces first.


M	src/plugins/quota/quota.c

2011-09-16 12:39:19 +0300 Timo Sirainen <tss@iki.fi> (288d6ef)

    lib-storage: Added mail_namespace_find_unalias()


M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h

2011-09-16 12:21:02 +0300 Timo Sirainen <tss@iki.fi> (35de8ec)

    lib-sql: Fixed load balancing between multiple SQL hosts to actually work.


M	src/lib-sql/driver-sqlpool.c

2011-09-16 12:11:25 +0300 Timo Sirainen <tss@iki.fi> (1ea57ac)

    s/commiting/committing/ Caught by Marco Nenciarini.


M	src/doveadm/doveadm-mail-iter.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-storage/index/index-sync.c

2011-09-16 12:08:49 +0300 Timo Sirainen <tss@iki.fi> (3617503)

    config: Don't crash strlist section contains a subsection.


M	src/config/config-parser.c

2011-09-16 11:59:15 +0300 Timo Sirainen <tss@iki.fi> (2e79bf7)

    man: Escape fix.


M	doc/man/dsync.1.in

2011-09-15 23:39:33 +0300 Timo Sirainen <tss@iki.fi> (eaec182)

    stats: Export also username for commands.


M	src/stats/client-export.c

2011-09-15 19:51:27 +0000 Pascal Volk <user@localhost.localdomain.org> (6c44496)

    man: Added -r option to doveadm-altmove.1.


M	doc/man/doveadm-altmove.1.in

2011-09-15 13:53:10 +0300 Timo Sirainen <tss@iki.fi> (44e5c39)

    lib-sql: Dropped connect timeout to 5 seconds. Postfix is using 10 second
    auth timeout and this needs to be less than that.


M	src/lib-sql/sql-api-private.h

2011-09-15 13:48:26 +0300 Timo Sirainen <tss@iki.fi> (bbac309)

    lib-sql: Don't try to connect to connections that are going to be
    reconnected later. This avoids unnecessarily trying to connect to failing
    connections.


M	src/lib-sql/driver-sqlpool.c

2011-09-15 13:47:44 +0300 Timo Sirainen <tss@iki.fi> (bf17de7)

    lib-sql: Connect to all configured hosts immediately. This makes load
    balancing between them actually work always.


M	src/lib-sql/driver-sqlpool.c

2011-09-15 13:46:45 +0300 Timo Sirainen <tss@iki.fi> (2d20d46)

    lib-sql: When escaping a string, use the first ready connection (if any).
    This avoids unnecessarily trying to reconnect to a failing connection.


M	src/lib-sql/driver-sqlpool.c

2011-09-15 13:45:35 +0300 Timo Sirainen <tss@iki.fi> (f635aa2)

    lib-sql: If MySQL connect takes more than 1 sec, don't try to reconnect for
    that many secs.


M	src/lib-sql/driver-mysql.c

2011-09-15 13:41:03 +0300 Timo Sirainen <tss@iki.fi> (685a84a)

    lib-sql: If MySQL connect fails, update ioloop times so later timeouts get
    added properly.


M	src/lib-sql/driver-mysql.c

2011-09-15 13:38:54 +0300 Timo Sirainen <tss@iki.fi> (22e0c38)

    liblib: Added io_loop_time_refresh()


M	src/lib/ioloop.c
M	src/lib/ioloop.h

2011-09-15 13:09:50 +0300 Timo Sirainen <tss@iki.fi> (e8a96ad)

    auth: Don't assert-crash if login client disconnects during multi-reply
    mechanism.


M	src/auth/auth-request-handler.c

2011-09-15 12:34:03 +0300 Timo Sirainen <tss@iki.fi> (4b7b7a6)

    mbox: mailbox_get_guid() works now without trying to sync the opened
    mailbox. This fixes assert-crash when LDA was trying to get mailbox GUID
    during save.


M	src/lib-storage/index/mbox/mbox-storage.c

2011-09-15 12:20:55 +0300 Timo Sirainen <tss@iki.fi> (2726ee9)

    lib-storage: Fixed listing subscriptions in shared namespaces.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2011-09-15 11:54:11 +0300 Timo Sirainen <tss@iki.fi> (cb108a8)

    doveadm altmove: Added -r parameter to move mails back to primary storage.


M	src/doveadm/doveadm-mail-altmove.c

2011-09-13 12:42:30 +0300 Timo Sirainen <tss@iki.fi> (9eb6f0b)

    auth: Use auth-worker(pid) prefix for auth processes.


M	src/auth/main.c

2011-09-13 11:55:25 +0300 Timo Sirainen <tss@iki.fi> (67aad95)

    lib-storage: Make sure status/metadata structs are cleared when they're
    looked up.


M	src/lib-storage/mail-storage.c

2011-09-13 11:38:49 +0300 Timo Sirainen <tss@iki.fi> (3e12925)

    imapc: Handle \Noselect flag properly for untagged LSUB replies.


M	src/lib-storage/index/imapc/imapc-list.c

2011-09-13 11:34:21 +0300 Timo Sirainen <tss@iki.fi> (f7b7a05)

    lib-storage: Fixed handling subscriptions when they were saved to prefix!=""
    namespace.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2011-09-13 10:32:11 +0300 Timo Sirainen <tss@iki.fi> (5532e2e)

    imapc: Crashfix when sometimes closing mailbox.


M	src/lib-storage/index/imapc/imapc-client.c

2011-09-13 02:09:02 +0300 Timo Sirainen <tss@iki.fi> (5a64a89)

    Removed unnecessary code.


M	src/lib-storage/mail-storage-service.c

2011-09-13 02:08:15 +0300 Timo Sirainen <tss@iki.fi> (f92db0b)

    dsync: Ignore SIGHUP


M	src/dsync/dsync.c

2011-09-13 02:07:30 +0300 Timo Sirainen <tss@iki.fi> (75e8db3)

    lib-index: mail_index_view_clone() didn't properly clear all fields in the
    destination view. The only caller already had it cleared though. Patch by
    Mike Abbott / Apple.


M	src/lib-index/mail-index-view.c

2011-09-12 18:29:17 +0300 Timo Sirainen <tss@iki.fi> (fbefe73)

    stats: Track [rw]char and sysc[rw] fields in /proc/self/io (with Linux).


M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h
M	src/stats/client-export.c
M	src/stats/mail-stats.c
M	src/stats/mail-stats.h

2011-09-12 18:26:29 +0300 Timo Sirainen <tss@iki.fi> (31e563d)

    stats: Added mail_ prefix to mail transaction statistics. Also added "m"
    prefix for them in the internal protocol.


M	src/plugins/stats/stats-plugin.c
M	src/stats/client-export.c
M	src/stats/mail-stats.c
M	src/stats/mail-stats.h

2011-09-12 16:32:20 +0300 Timo Sirainen <tss@iki.fi> (2c91614)

    dsync: If mailbox can't be opened, log an error but continue anyway.


M	src/dsync/dsync-worker-local.c

2011-09-12 16:30:51 +0300 Timo Sirainen <tss@iki.fi> (b97c762)

    dsync: If mailbox can't be opened, log an error but continue anyway.


M	src/dsync/dsync-worker-local.c

2011-09-12 16:23:21 +0300 Timo Sirainen <tss@iki.fi> (37cd04f)

    fts-squat: Crashfixes on indexing.


M	src/plugins/fts-squat/fts-backend-squat.c

2011-09-12 16:18:56 +0300 Timo Sirainen <tss@iki.fi> (8b304a2)

    fts-solr: Don't break when there are duplicate From/To/Subject/etc. fields.


M	src/plugins/fts-solr/fts-backend-solr.c

2011-09-12 14:44:01 +0300 Timo Sirainen <tss@iki.fi> (3967d4d)

    stats: Increased idle timeout to 15 minutes.


M	src/stats/mail-session.c

2011-09-12 14:43:31 +0300 Timo Sirainen <tss@iki.fi> (c7639a2)

    stats: Avoid duplicate "Couldn't find session GUID" warnings. When it
    happens, just create a dummy session for it and log a warning once.


M	src/stats/mail-command.c
M	src/stats/mail-session.c
M	src/stats/mail-session.h

2011-09-12 14:40:49 +0300 Timo Sirainen <tss@iki.fi> (c4bb032)

    virtual: Compile fix for recent mailbox_exists() change.


M	src/plugins/virtual/virtual-storage.c

2011-09-12 14:32:37 +0300 Timo Sirainen <tss@iki.fi> (5dba704)

    indexer: Fixed assert-crash when number of indexed messages was divisible by
    100.


M	src/indexer/master-connection.c

2011-09-12 14:27:46 +0300 Timo Sirainen <tss@iki.fi> (37fd9ad)

    mbox: Fixed fetching last message from compressed mboxes.


M	src/lib-storage/index/mbox/mbox-mail.c

2011-09-12 14:27:46 +0300 Timo Sirainen <tss@iki.fi> (767cd7e)

    mbox: Fixed fetching last message from compressed mboxes.


M	src/lib-storage/index/mbox/mbox-mail.c

2011-09-12 14:01:36 +0300 Timo Sirainen <tss@iki.fi> (c4c3d48)

    quota-dirsize: Get the quota from "mail root dir", not "mailboxes dir".
    Normally they are different only with dbox (~/dbox vs. ~/dbox/mailboxes).
    This mainly fixes using dirsize with mdbox, where the mail data is in
    ~/dbox/storage/ directory. Patch by Ð Ð¾Ð¼Ð°Ð½ Ð—Ð°Ñ…Ñ€Ð¾Ð².


M	src/plugins/quota/quota-dirsize.c

2011-09-12 14:02:30 +0300 Timo Sirainen <tss@iki.fi> (dfe42ed)

    ldap: Fixed auth binds for nonexistent users with some LDAP servers.


M	src/auth/passdb-ldap.c

2011-09-12 14:01:36 +0300 Timo Sirainen <tss@iki.fi> (d62cb69)

    quota-dirsize: Get the quota from "mail root dir", not "mailboxes dir".
    Normally they are different only with dbox (~/dbox vs. ~/dbox/mailboxes).
    This mainly fixes using dirsize with mdbox, where the mail data is in
    ~/dbox/storage/ directory. Patch by Ð Ð¾Ð¼Ð°Ð½ Ð—Ð°Ñ…Ñ€Ð¾Ð².


M	src/plugins/quota/quota-dirsize.c

2011-09-12 13:14:26 +0300 Timo Sirainen <tss@iki.fi> (1228c06)

    imapc: Fixed mailbox_exists() to actually work. This fixes problems with
    subscribing to mailboxes.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-12 13:13:35 +0300 Timo Sirainen <tss@iki.fi> (352cd70)

    lib-storage: Handle INBOX in the common mailbox_exists() code.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/mail-storage.c

2011-09-12 12:41:09 +0300 Timo Sirainen <tss@iki.fi> (2dc23f3)

    imapc: Fixes to handling non-empty imapc namespace prefix.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-12 12:40:34 +0300 Timo Sirainen <tss@iki.fi> (ba36444)

    lib-storage: Fixed mailbox_list_mailbox() for backends without
    get_mailbox_flags().


M	src/lib-storage/mailbox-list.c

2011-09-12 12:38:04 +0300 Timo Sirainen <tss@iki.fi> (3dddf03)

    lib-storage: Finished previous get_mailbox_flags() change.


M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs.h

2011-09-12 12:02:33 +0300 Timo Sirainen <tss@iki.fi> (fb365ad)

    lib-storage: Removed unused struct stat parameter from
    mailbox_list.get_mailbox_flags()


M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.h
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2011-09-09 13:14:07 +0300 Timo Sirainen <tss@iki.fi> (e925d6d)

    imapc: More fixes to listing mailbox names.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-09 13:05:33 +0300 Timo Sirainen <tss@iki.fi> (4bb24a2)

    imapc: Another try at fixing mUTF-7 mailbox names.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-09-09 12:57:36 +0300 Timo Sirainen <tss@iki.fi> (56956c0)

    imapc: Use mUTF-7 for mailbox names.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-09-08 16:52:32 +0300 Timo Sirainen <tss@iki.fi> (063254b)

    imapc: If mail prefetching fails because of disconnection, don't log about
    it again.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c

2011-09-08 16:51:51 +0300 Timo Sirainen <tss@iki.fi> (bf6d72f)

    imapc: If NOOP fails with disconnection, set "internal error" to storage.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-08 16:37:56 +0300 Timo Sirainen <tss@iki.fi> (a5074ab)

    fts-solr: Fixed indexing messages with multiple MIME body parts.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2011-09-08 16:24:18 +0300 Timo Sirainen <tss@iki.fi> (f2d3c2b)

    lib-storage: Error handling fix for key+=value when key isn't of string
    type.


M	src/lib-storage/mail-storage-service.c

2011-09-08 13:41:20 +0300 Timo Sirainen <tss@iki.fi> (b5a36d9)

    lmtp: Improved "DATA output timeout" error message.


M	src/lmtp/lmtp-proxy.c

2011-09-08 12:39:13 +0300 Timo Sirainen <tss@iki.fi> (9dc53c1)

    imapc: Send NOOP command every 29 minutes to remote server. This avoids
    server idle-disconnecting us after doing nothing for 30 minutes.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-connection.c

2011-09-08 12:14:54 +0300 Timo Sirainen <tss@iki.fi> (c2c0c1e)

    lib-ssl-iostream: If plain stream disconnects, disconnect SSL stream also.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h

2011-09-08 11:51:18 +0300 Timo Sirainen <tss@iki.fi> (4130a33)

    lib-lda: Log message improvement to differentiate mailbox open vs. save
    error.


M	src/lib-lda/mail-deliver.c

2011-09-08 11:51:18 +0300 Timo Sirainen <tss@iki.fi> (2f0c5d4)

    lib-lda: Log message improvement to differentiate mailbox open vs. save
    error.


M	src/lib-lda/mail-deliver.c

2011-09-08 11:50:23 +0300 Timo Sirainen <tss@iki.fi> (d4b2e2b)

    lib-storage: Fixed mail_storage_copy() error handling.


M	src/lib-storage/mail-copy.c

2011-09-08 11:50:23 +0300 Timo Sirainen <tss@iki.fi> (591aa68)

    lib-storage: Fixed mail_storage_copy() error handling.


M	src/lib-storage/mail-copy.c

2011-09-08 11:39:00 +0300 Timo Sirainen <tss@iki.fi> (76a7786)

    lib-storage: Code cleanup to mail_storage_set_critical()


M	src/lib-storage/mail-storage.c

2011-09-08 11:16:55 +0300 Timo Sirainen <tss@iki.fi> (9e17ea6)

    lib-storage: Minor error handling cleanups.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.c

2011-09-08 11:16:55 +0300 Timo Sirainen <tss@iki.fi> (a290ae2)

    lib-storage: Minor error handling cleanups.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.c

2011-09-01 19:33:22 +0300 Timo Sirainen <tss@iki.fi> (882fd2a)

    lib-index: Make sure mail_index_sync_record() doesn't waste data stack.


M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-view-sync.c

2011-09-01 19:33:22 +0300 Timo Sirainen <tss@iki.fi> (6d25194)

    lib-index: Make sure mail_index_sync_record() doesn't waste data stack.


M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-view-sync.c

2011-09-07 17:15:10 +0300 Timo Sirainen <tss@iki.fi> (00a3bb3)

    imapc: When closing mailbox, don't abort any pending non-mailbox commands.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-connection.h

2011-09-07 16:44:14 +0300 Timo Sirainen <tss@iki.fi> (c175b26)

    auth: Don't crash when using default static userdb.


M	src/auth/auth.c

2011-09-07 16:10:16 +0300 Timo Sirainen <tss@iki.fi> (6c6b1e9)

    lib-ssl-iostream: Some tweaks to BIO handling.


M	src/lib-ssl-iostream/iostream-openssl.c

2011-09-07 15:46:43 +0300 Timo Sirainen <tss@iki.fi> (2d8e4a4)

    imapc: Fixed assert-crashing when deleting a mailbox


M	src/lib-storage/index/imapc/imapc-sync.c

2011-09-07 11:52:08 +0300 Timo Sirainen <tss@iki.fi> (d71c50f)

    imapc: Place index files under root_dir/indexes/ directory.


M	src/lib-storage/index/imapc/imapc-list.c

2011-09-07 11:30:05 +0300 Timo Sirainen <tss@iki.fi> (abd4772)

    lib-index: Don't allow syncing to begin if index is marked corrupted.


M	src/lib-index/mail-index-sync.c

2011-09-07 11:19:03 +0300 Timo Sirainen <tss@iki.fi> (c239a1d)

    lib-ssl-iostream: Handle flush_pending and set_max_buffer_size properly.


M	src/lib-ssl-iostream/ostream-openssl.c

2011-09-07 11:18:15 +0300 Timo Sirainen <tss@iki.fi> (ce8cd19)

    lib-ssl-iostream: Fixed ostream to preserve/use flush callback correctly.


M	src/lib-ssl-iostream/ostream-openssl.c

2011-09-07 11:03:33 +0300 Timo Sirainen <tss@iki.fi> (8e6def8)

    imapc: Switch connection output streams' ioloop when needed. This fixes
    hangs when output stream got full.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-09-07 11:02:55 +0300 Timo Sirainen <tss@iki.fi> (e21a2c0)

    lib-ssl-iostream: When plain_output's buffer is full, set it flush-pending.
    This fixes hangs when the output buffer got full.


M	src/lib-ssl-iostream/iostream-openssl.c

2011-09-07 10:59:35 +0300 Timo Sirainen <tss@iki.fi> (71da447)

    Added o_stream_switch_ioloop() and implemented it to all ostreams.


M	src/lib-ssl-iostream/ostream-openssl.c
M	src/lib/ostream-file.c
M	src/lib/ostream-internal.h
M	src/lib/ostream.c
M	src/lib/ostream.h
M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c

2011-09-07 10:38:01 +0300 Timo Sirainen <tss@iki.fi> (b720f55)

    imapc: Connect to server immediately at startup and lookup hierarchy
    separator. If connecting to server fails, this makes it fail earlier. Also
    we don't have to worry about what to do later if hierarchy separator lookup
    fails.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-07 10:24:11 +0300 Timo Sirainen <tss@iki.fi> (52d19b5)

    lib-ssl-iostream: When SSL i/ostream is closed, close also the plain stream.


M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c

2011-09-07 10:01:36 +0300 Timo Sirainen <tss@iki.fi> (d30c35e)

    imapc: Don't crash if a newly seen uncommitted message is expunged.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2011-09-07 09:40:16 +0300 Timo Sirainen <tss@iki.fi> (e844391)

    imapc: Removed accidentally committed debug sleeps.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-09-07 08:41:25 +0300 Timo Sirainen <tss@iki.fi> (5dd17da)

    lib-ssl-iostream: Fixed compiling when SSL is disabled.


M	src/lib-ssl-iostream/iostream-ssl-none.c

2011-09-07 08:40:41 +0300 Timo Sirainen <tss@iki.fi> (da4baa9)

    lib-ssl-iostream: Compiler warning fix.


M	src/lib-ssl-iostream/ostream-openssl.c

2011-09-06 17:29:38 +0300 Timo Sirainen <tss@iki.fi> (f4547bc)

    imapc: Don't crash when trying to use imapc's subscription list for another
    namespace.


M	src/lib-storage/index/imapc/imapc-list.c

2011-09-06 17:03:55 +0300 Timo Sirainen <tss@iki.fi> (417642d)

    lib-storage: When mail_debug=yes logs userdb fields, hide values of all
    whose key contains "pass".


M	src/lib-storage/mail-storage-service.c

2011-09-06 17:03:06 +0300 Timo Sirainen <tss@iki.fi> (61767c7)

    lib-auth: When debug logging auth input, hide values of all fields
    containing "pass" in key.


M	src/lib-auth/auth-master.c

2011-09-06 17:01:29 +0300 Timo Sirainen <tss@iki.fi> (c96a1bf)

    auth: If auth_debug_passwords=no, hide values of userdb keys containing
    "pass" string.


M	src/auth/auth-master-connection.c

2011-09-06 16:42:19 +0300 Timo Sirainen <tss@iki.fi> (24500b3)

    imapc: Error logging fix when SSL handshake fails.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-09-06 16:33:09 +0300 Timo Sirainen <tss@iki.fi> (e1895a1)

    imapc: Verify that SSL certificate matches the connected hostname.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-09-06 16:32:20 +0300 Timo Sirainen <tss@iki.fi> (1c4f8e4)

    lib-ssl-iostream: Added ssl_iostream_cert_match_name()


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-ssl.h

2011-09-06 13:40:50 +0300 Timo Sirainen <tss@iki.fi> (21fed97)

    lib-ssl-iostream: Code cleanups, fixes, asserts and comments.


M	src/lib-ssl-iostream/iostream-openssl.c
M	src/lib-ssl-iostream/iostream-openssl.h
M	src/lib-ssl-iostream/istream-openssl.c
M	src/lib-ssl-iostream/ostream-openssl.c

2011-09-05 14:23:11 +0300 Timo Sirainen <tss@iki.fi> (148a839)

    lib-ssl-iostream: Avoid assert-crashing when remote disconnects during
    write.


M	src/lib-ssl-iostream/iostream-openssl.c

2011-09-05 12:46:49 +0300 Timo Sirainen <tss@iki.fi> (bfa38f1)

    maildir: Avoid refreshing uidlist unnecessarily. Even if the uidlist itself
    wasn't read, it was still stat()ed.


M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/maildir/maildir-sync.c

2011-09-05 11:48:11 +0300 Timo Sirainen <tss@iki.fi> (ae9365d)

    maildir: When logging "scanning took n secs" warning, log also why scan was
    done. This could help debugging why cur/ directory is sometimes scanned with
    maildir_very_dirty_syncs=yes (if the previous commit didn't fully solve it).


M	src/lib-storage/index/maildir/maildir-sync.c

2011-09-05 11:45:45 +0300 Timo Sirainen <tss@iki.fi> (f6b317c)

    maildir: Drop internal new-flag from mails that have been moved from new/ to
    cur/. This avoids unnecessary cur/ directory scans.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2011-09-05 11:34:43 +0300 Timo Sirainen <tss@iki.fi> (e349616)

    stats: Don't crash at deinit if there are still connected sessions.


M	src/stats/mail-session.c

2011-09-05 11:13:12 +0300 Timo Sirainen <tss@iki.fi> (e9ed8d3)

    stats: If forcibly disconnecting a session, show the session's username
    also.


M	src/stats/mail-session.c

2011-09-05 10:32:47 +0300 Timo Sirainen <tss@iki.fi> (d1b3f17)

    imapc: mailbox_status now returns permanent flags/keywords as they are on
    remote server.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-09-05 10:30:15 +0300 Timo Sirainen <tss@iki.fi> (9a3da80)

    lib-storage: mailbox_keyword_is_valid() returns now FALSE if keyword can't
    be created.


M	src/lib-storage/mailbox-keywords.c

2011-09-05 10:28:49 +0300 Timo Sirainen <tss@iki.fi> (b3484b5)

    lib-storage: Added mailbox.disallow_new_keywords and use it for
    mailbox_status.


M	src/lib-storage/index/index-status.c
M	src/lib-storage/mail-storage-private.h

2011-09-04 20:11:33 +0300 Timo Sirainen <tss@iki.fi> (47ca156)

    stats: Add stats_ prefix to all settings.


M	src/stats/stats-settings.c

2011-09-04 19:00:47 +0300 Timo Sirainen <tss@iki.fi> (31ddc69)

    master: fifos weren't created with correct user/group.


M	src/master/service-listen.c

2011-09-04 18:47:30 +0300 Timo Sirainen <tss@iki.fi> (b0b14c6)

    imapc: Another compiler warning fix.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-09-04 18:46:20 +0300 Timo Sirainen <tss@iki.fi> (b0cfc1c)

    imapc: Compiler warning fix.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-09-04 18:29:38 +0300 Timo Sirainen <tss@iki.fi> (854574e)

    imapc: Fixed checking if mail is expunged.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-09-04 18:29:21 +0300 Timo Sirainen <tss@iki.fi> (faa489c)

    imapc: Syncing fixes


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-09-04 17:59:58 +0300 Timo Sirainen <tss@iki.fi> (1af95e0)

    imapc: Redesigned remote sequence <-> index file record mapping is done. The
    previous code didn't work when multiple connections modified the same index
    files.


M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-client-private.h
M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
A	src/lib-storage/index/imapc/imapc-msgmap.c
A	src/lib-storage/index/imapc/imapc-msgmap.h
D	src/lib-storage/index/imapc/imapc-seqmap.c
D	src/lib-storage/index/imapc/imapc-seqmap.h
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c
D	src/lib-storage/index/imapc/test-imapc-seqmap.c

2011-09-04 16:34:23 +0300 Timo Sirainen <tss@iki.fi> (92f9aaf)

    imapc: Delay handling new messages and setting uidvalidity/uidnext until
    sync.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2011-09-04 13:20:27 +0300 Timo Sirainen <tss@iki.fi> (5caec68)

    imapc: Never use box->view for syncing related purposes. The view isn't up
    to date when MAILBOX_SYNC_FLAG_NO_EXPUNGES is used to sync it. Instead
    always use a separate sync view.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-09-04 12:38:24 +0300 Timo Sirainen <tss@iki.fi> (f01d133)

    lib-index: Fixed reopening index file that was marked as corrupted.


M	src/lib-index/mail-index.c

2011-09-04 12:37:51 +0300 Timo Sirainen <tss@iki.fi> (951c92a)

    imapc: Fixed handling immediate changes when starting IDLE.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2011-09-04 12:29:45 +0300 Timo Sirainen <tss@iki.fi> (228e0b0)

    imapc: Avoid assert-crashing if a new message's UID is smaller than
    next_uid.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-09-04 12:04:09 +0300 Timo Sirainen <tss@iki.fi> (e809db9)

    imapc: Error logging cleanups. Don't bother to log disconnection errors for
    NOOP.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2011-09-04 12:03:12 +0300 Timo Sirainen <tss@iki.fi> (b328a8f)

    imapc: Fixed error handling while opening mailbox.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-09-04 11:52:16 +0300 Timo Sirainen <tss@iki.fi> (1be964e)

    lib-index: When marking index corrupted, delete also transaction log file.


M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mail-transaction-log.h

2011-09-04 11:51:23 +0300 Timo Sirainen <tss@iki.fi> (3fd0bcd)

    imapc: Fixed syncing external changes to mailbox when opening it.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-09-04 10:55:33 +0300 Timo Sirainen <tss@iki.fi> (a2d397c)

    imapc: Added assert.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-04 10:48:46 +0300 Timo Sirainen <tss@iki.fi> (6021cfe)

    imapc: Fixed IDLE handling.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-04 10:40:58 +0300 Timo Sirainen <tss@iki.fi> (f1fe62b)

    stats: Minor error message fix.


M	src/stats/mail-session.c

2011-09-04 10:30:21 +0300 Timo Sirainen <tss@iki.fi> (0d5b484)

    imapc: Use EXAMINE command when possible.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-09-04 10:25:39 +0300 Timo Sirainen <tss@iki.fi> (a54e0d5)

    stats: Don't increase session stats based on command stats. This was buggy
    because the session stats were now increased twice. It could have been
    possible to keep doing this and on UPDATE-SESSION simply replace the old
    session stats, but that might still have caused the session stats to
    temporarily go too high and then drop down.


M	src/stats/mail-command.c

2011-09-04 10:15:16 +0300 Timo Sirainen <tss@iki.fi> (d19fb27)

    anvil: Assert-crashfix at exit when there were fifo connections.


M	src/anvil/anvil-connection.c

2011-09-04 10:12:30 +0300 Timo Sirainen <tss@iki.fi> (e736bb7)

    stats: Don't assert-crash at exit if there are unfinished commands.


M	src/stats/mail-command.c

2011-09-03 12:04:56 +0300 Timo Sirainen <tss@iki.fi> (6b26519)

    lib-sql: Don't link sql libraries to libdovecot-sql.so when building them as
    plugins.


M	src/lib-sql/Makefile.am

2011-09-02 07:11:16 +0300 Timo Sirainen <tss@iki.fi> (56a5ecd)

    fts-solr: Don't send delete to Solr if we're quite sure it doesn't exist.


M	src/plugins/fts-solr/fts-backend-solr.c

2011-09-01 17:52:51 +0300 Timo Sirainen <tss@iki.fi> (2894d85)

    stats: Log more verbosely what happened if stats shrink.


M	src/stats/mail-command.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.c
M	src/stats/mail-stats.h

2011-09-01 12:34:11 +0300 Timo Sirainen <tss@iki.fi> (9510cc8)

    stats plugin: Get disk I/O from getrusage(), not from /proc/self/io. They're
    pretty much the same values anyway, and getrusage() is more portable.


M	src/plugins/stats/stats-plugin.c

2011-09-01 11:59:21 +0300 Timo Sirainen <tss@iki.fi> (b57c175)

    Added signature for changeset 8ae243558677


M	.hgsigs

2011-09-01 11:59:16 +0300 Timo Sirainen <tss@iki.fi> (ad938d6)

    Added tag 2.1.alpha1 for changeset 8ae243558677


M	.hgtags

2011-09-01 11:59:14 +0300 Timo Sirainen <tss@iki.fi> (eee5eaa)

    Released v2.1.alpha1.


M	configure.in

2011-09-01 11:57:59 +0300 Timo Sirainen <tss@iki.fi> (febbbf9)

    Make static analyzer happy.


M	src/lib/network.c

2011-09-01 11:50:49 +0300 Timo Sirainen <tss@iki.fi> (55342cb)

    doveadm: Error handling fix


M	src/doveadm/doveadm-stats.c

2011-09-01 11:02:30 +0300 Timo Sirainen <tss@iki.fi> (8972351)

    NEWS updated


M	NEWS

2011-09-01 10:59:50 +0300 Timo Sirainen <tss@iki.fi> (31dcba2)

    TODO updated


M	TODO

2011-09-01 10:58:41 +0300 Timo Sirainen <tss@iki.fi> (0d01146)

    stats: Keep track of session's PIDs.


M	src/plugins/stats/stats-connection.c
M	src/stats/client-export.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.h

2011-09-01 10:40:17 +0300 Timo Sirainen <tss@iki.fi> (699b2bf)

    stats: Keep track of last_update in microsecond precision and export it as
    such.


M	src/stats/client-export.c
M	src/stats/mail-command.c
M	src/stats/mail-domain.c
M	src/stats/mail-ip.c
M	src/stats/mail-session.c
M	src/stats/mail-stats.h
M	src/stats/mail-user.c

2011-09-01 10:39:37 +0300 Timo Sirainen <tss@iki.fi> (9f84515)

    doveadm: Change "stats dump" default formatter to "tab".


M	src/doveadm/doveadm-print.h
M	src/doveadm/doveadm-stats.c

2011-09-01 10:39:19 +0300 Timo Sirainen <tss@iki.fi> (06e3d76)

    doveadm: Initial implementation of "stats top" command. Currently it's hard
    coded to assume ANSI compatible terminal.


M	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h

2011-09-01 10:37:55 +0300 Timo Sirainen <tss@iki.fi> (3f0f905)

    Increased initial memory pool size.


M	src/doveadm/doveadm-print-table.c

2011-09-01 10:37:35 +0300 Timo Sirainen <tss@iki.fi> (91db58d)

    stats plugin: Send one no-change session update after changes. This tells
    the stats client that the session is idle now.


M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h

2011-09-01 09:46:05 +0300 Timo Sirainen <tss@iki.fi> (3f3fa1a)

    stats: Export CPU usecs prefixed with right number of zeros.


M	src/stats/client-export.c

2011-09-01 07:25:23 +0300 Timo Sirainen <tss@iki.fi> (95213c9)

    doveadm stats: Renamed "top" command to "dump" and allow giving any
    parameters to it.


M	src/doveadm/doveadm-stats.c

2011-09-01 07:24:25 +0300 Timo Sirainen <tss@iki.fi> (2923816)

    stats: Fixed dumping command stats.


M	src/stats/client-export.c

2011-09-01 07:21:41 +0300 Timo Sirainen <tss@iki.fi> (0c72013)

    stats: Fixed handling IP address stats.


M	src/stats/client-export.c
M	src/stats/mail-session.c
M	src/stats/main.c

2011-09-01 06:52:43 +0300 Timo Sirainen <tss@iki.fi> (fc45ac8)

    stats plugin: Added stats_refresh and stats_track_cmds settings. The stats
    plugin is enabled only when refresh is set to non-zero. The imap_stats
    plugin tracks commands only when stats_track_cmds=yes.


M	src/plugins/imap-stats/imap-stats-plugin.c
M	src/plugins/stats/Makefile.am
M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h

2011-09-01 06:36:34 +0300 Timo Sirainen <tss@iki.fi> (0c61cba)

    stats plugin: Optimized to lookup statistics only when necessary.


M	src/plugins/stats/stats-plugin.c

2011-09-01 06:13:36 +0300 Timo Sirainen <tss@iki.fi> (ab94710)

    stats: Don't attempt to track stats for autocreated users.


M	src/plugins/stats/stats-plugin.c

2011-09-01 06:13:26 +0300 Timo Sirainen <tss@iki.fi> (f534c0d)

    lib-storage: Set struct mail_users.autocreated for raw/shared users.


M	src/lda/main.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/mail-user.h
M	src/lmtp/client.c

2011-09-01 06:02:23 +0300 Timo Sirainen <tss@iki.fi> (c0beaae)

    stats: Added more statistics fields (syscpu, page faults, context switches).


M	src/plugins/stats/stats-plugin.c
M	src/plugins/stats/stats-plugin.h
M	src/stats/client-export.c
M	src/stats/mail-stats.c
M	src/stats/mail-stats.h

2011-09-01 05:57:42 +0300 Timo Sirainen <tss@iki.fi> (650cd8f)

    doveadm stats top: Don't hang if stats server doesn't send any statistics.


M	src/doveadm/doveadm-stats.c

2011-08-31 14:25:54 +0300 Timo Sirainen <tss@iki.fi> (790c274)

    lib-storage: Recognize "flags" cache field in
    MAILBOX_METADATA_PRECACHE_FIELDS.


M	src/lib-storage/index/index-status.c

2011-08-31 14:23:51 +0300 Timo Sirainen <tss@iki.fi> (adf8264)

    fts-solr: Fixed updating last indexed uid in fts header.


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c

2011-08-31 13:58:27 +0300 Timo Sirainen <tss@iki.fi> (d50ba81)

    fts: Removed unused code.


M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-storage.c

2011-08-31 13:49:48 +0300 Timo Sirainen <tss@iki.fi> (2ced1cb)

    fts-lucene: Fixed checking if optimize should be done directly or via
    indexer.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2011-08-31 12:29:21 +0300 Timo Sirainen <tss@iki.fi> (128ea07)

    lib-index: Changed mail_cache_view_close() API to take pointer-to-pointer.


M	src/doveadm/doveadm-dump-index.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-cache.h
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-transaction.c

2011-08-31 12:02:29 +0300 Timo Sirainen <tss@iki.fi> (ff9eb4a)

    indexer: Send completion% status updates to clients.


M	src/indexer/indexer-queue.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c

2011-08-31 11:39:50 +0300 Timo Sirainen <tss@iki.fi> (421d306)

    Redesigned mail precaching APIs. There's no longer a one monolithic
    mailbox_sync(MAILBOX_SYNC_FLAG_PRECACHE) call, but rather one
    mail_precache() call for each mail to be precached. This allows the callers
    to show the progress and in general is cleaner.


M	src/doveadm/doveadm-mail-index.c
M	src/indexer/master-connection.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/lib-storage/test-mail.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts/Makefile.am
M	src/plugins/fts/fts-api-private.h
R058	src/plugins/fts/fts-build.c	src/plugins/fts/fts-build-mail.c
A	src/plugins/fts/fts-build-mail.h
D	src/plugins/fts/fts-build-mailbox.c
M	src/plugins/fts/fts-build-private.h
D	src/plugins/fts/fts-build-virtual.c
D	src/plugins/fts/fts-build.h
R057	src/plugins/fts/fts-build-indexer.c	src/plugins/fts/fts-indexer.c
A	src/plugins/fts/fts-indexer.h
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-storage.c

2011-08-31 11:35:24 +0300 Timo Sirainen <tss@iki.fi> (96da164)

    fts: Fixed checking settings compatibility with non-INBOX namespaces.


M	src/plugins/fts/fts-api.c

2011-08-31 11:33:54 +0300 Timo Sirainen <tss@iki.fi> (f3976df)

    lib-index: Added mail_cache_exists()


M	src/lib-index/mail-cache.c
M	src/lib-index/mail-cache.h

2011-08-30 09:57:08 +0300 Timo Sirainen <tss@iki.fi> (65a1c01)

    auth: Added missing files from recent commit.


A	src/auth/passdb-template.c
A	src/auth/passdb-template.h
A	src/auth/userdb-template.c
A	src/auth/userdb-template.h

2011-08-30 07:07:31 +0300 Timo Sirainen <tss@iki.fi> (b7fdf4f)

    fts: Added lookup_done() API call. Lucene uses it to close the index. This
    way it Lucene doesn't keep the index files unnecessarily open forever.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-api.h
M	src/plugins/fts/fts-search.c

2011-08-30 05:47:41 +0300 Timo Sirainen <tss@iki.fi> (f0054d0)

    mbox: mailbox_get_guid() does now better error handling when read-only mbox
    doesn't have GUID.


M	src/lib-storage/index/mbox/mbox-storage.c

2011-08-30 05:36:24 +0300 Timo Sirainen <tss@iki.fi> (06ed0c5)

    fts-lucene, fts-solr: Try to optimize searching for existence of header
    name.


M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-solr/fts-backend-solr.c

2011-08-30 05:27:54 +0300 Timo Sirainen <tss@iki.fi> (04052d7)

    auth: Added default_fields and override_fields settings to all passdbs and
    userdbs.


M	doc/example-config/conf.d/auth-ldap.conf.ext
M	doc/example-config/conf.d/auth-passwdfile.conf.ext
M	doc/example-config/conf.d/auth-system.conf.ext
M	src/auth/Makefile.am
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/auth/auth.c
M	src/auth/passdb-static.c
M	src/auth/passdb.c
M	src/auth/passdb.h
M	src/auth/userdb-passwd.c
M	src/auth/userdb-static.c
D	src/auth/userdb-static.h
M	src/auth/userdb.c
M	src/auth/userdb.h

2011-08-30 04:32:55 +0300 Timo Sirainen <tss@iki.fi> (b1ba6a9)

    lib-storage: Added MAILBOX_TRANSACTION_FLAG_NO_CACHE_DEC and use it when
    precaching. The result is that "doveadm index" no longer changes caching
    decisions.


M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage.h

2011-08-30 04:31:28 +0300 Timo Sirainen <tss@iki.fi> (ab9a91e)

    lib-storage: Added MAILBOX_TRANSACTION_FLAG_NO_CACHE_DEC and use it when
    precaching. The result is that "doveadm index" no longer changes caching
    decisions.


M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage.h

2011-08-30 04:31:00 +0300 Timo Sirainen <tss@iki.fi> (ad6fe4a)

    lib-index: Added mail_cache_view_update_cache_decisions()


M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-cache.h

2011-08-30 04:31:00 +0300 Timo Sirainen <tss@iki.fi> (8fa86f7)

    lib-index: Added mail_cache_view_update_cache_decisions()


M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-private.h
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-cache.h

2011-08-30 04:21:36 +0300 Timo Sirainen <tss@iki.fi> (64d3d21)

    Merged changes from v2.0 tree.


2011-08-29 07:08:04 +0300 Timo Sirainen <tss@iki.fi> (f50ad7c)

    Added signature for changeset aa68f38c04f0


M	.hgsigs

2011-08-29 07:08:02 +0300 Timo Sirainen <tss@iki.fi> (15ebb73)

    Added tag 2.0.14 for changeset aa68f38c04f0


M	.hgtags

2011-08-29 07:08:02 +0300 Timo Sirainen <tss@iki.fi> (f7dadfb)

    Released v2.0.14.


M	NEWS
M	TODO
M	configure.in

2011-08-29 07:04:49 +0300 Timo Sirainen <tss@iki.fi> (7f3e6cd)

    doveadm: Proxying fix


M	src/doveadm/doveadm-mail-server.c

2011-08-29 07:03:26 +0300 Timo Sirainen <tss@iki.fi> (3c6807c)

    doveadm: Fixed authentication with remote doveadm server.


M	src/doveadm/server-connection.c

2011-08-29 06:18:26 +0300 Timo Sirainen <tss@iki.fi> (d3af904)

    doveadm: Added "director ring status" command.


M	src/doveadm/doveadm-director.c

2011-08-29 06:18:16 +0300 Timo Sirainen <tss@iki.fi> (4fda77c)

    director: Updated DIRECTOR-LIST doveadm command.


M	src/director/doveadm-connection.c

2011-08-29 05:36:04 +0300 Timo Sirainen <tss@iki.fi> (2b40570)

    doveadm: Skip mailbox optimizations under OR search terms. This fixes
    problem with e.g. "mailbox foo or seen".


M	src/doveadm/doveadm-mail-list-iter.c

2011-08-29 05:30:58 +0300 Timo Sirainen <tss@iki.fi> (649e009)

    lib-index: Error logging fix to previous commit.


M	src/lib-index/mail-index-write.c

2011-08-28 08:32:44 +0300 Timo Sirainen <tss@iki.fi> (bd83e16)

    configure: Added --with-stemmer and output which fts backends are compiled.


M	configure.in

2011-08-28 08:15:33 +0300 Timo Sirainen <tss@iki.fi> (4145cba)

    lib-storage: Replaced MAILBOX_FLAG_KEEP_RECENT flag with reverse
    MAILBOX_FLAG_DROP_RECENT. Very few places actually want to drop recent
    flags, so this way is easier.


M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-move.c
M	src/doveadm/doveadm-mail.c
M	src/dsync/dsync-worker-local.c
M	src/imap/cmd-select.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-status.c
M	src/indexer/master-connection.c
M	src/lib-lda/mail-deliver.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/list/index-mailbox-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-list.c
M	src/plugins/acl/doveadm-acl.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts/fts-api.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/quota/quota-count.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/pop3/pop3-client.c

2011-08-28 07:03:45 +0300 Timo Sirainen <tss@iki.fi> (2120346)

    stats plugin: Fixed stats connection reference counting.


M	src/plugins/stats/stats-plugin.c

2011-08-28 06:20:46 +0300 Timo Sirainen <tss@iki.fi> (7f44ba2)

    doveadm dump: Updated fts_index_header.


M	src/doveadm/doveadm-dump-index.c

2011-08-28 06:19:52 +0300 Timo Sirainen <tss@iki.fi> (5b6470e)

    fts-lucene: If default_language changes, reindex mailbox.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-28 06:18:54 +0300 Timo Sirainen <tss@iki.fi> (54d437d)

    fts: Changed private fts_index_header accessing APIs


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c

2011-08-28 05:49:36 +0300 Timo Sirainen <tss@iki.fi> (c35291c)

    stats plugin: Don't crash if stats collecting is disabled.


M	src/plugins/stats/stats-plugin.c

2011-08-28 05:49:06 +0300 Timo Sirainen <tss@iki.fi> (65889a7)

    lib-storage: Default mail_user.service (from NULL) to master_service.name.


M	src/lib-storage/mail-user.c

2011-08-27 11:48:20 +0300 Timo Sirainen <tss@iki.fi> (6140ef2)

    fts-lucene: Error logging fix.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-26 05:20:01 +0300 Timo Sirainen <tss@iki.fi> (3809ed8)

    stats: Refresh idle timeout whenever session is updated.


M	src/stats/mail-session.c

2011-08-26 05:15:42 +0300 Timo Sirainen <tss@iki.fi> (6565fc6)

    doveadm: Added initial implementation of "stats top" command.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-stats.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h

2011-08-26 05:15:12 +0300 Timo Sirainen <tss@iki.fi> (ede6bdb)

    Initial implementation of statistics gathering daemon and plugins to feed
    it. Some statistics are still missing, some of the code is a bit ugly and
    the internal protocols will probably still change.


M	.hgignore
M	configure.in
M	src/Makefile.am
M	src/plugins/Makefile.am
A	src/plugins/imap-stats/Makefile.am
A	src/plugins/imap-stats/imap-stats-plugin.c
A	src/plugins/imap-stats/imap-stats-plugin.h
A	src/plugins/stats/Makefile.am
A	src/plugins/stats/stats-connection.c
A	src/plugins/stats/stats-connection.h
A	src/plugins/stats/stats-plugin.c
A	src/plugins/stats/stats-plugin.h
A	src/stats/Makefile.am
A	src/stats/client-export.c
A	src/stats/client-export.h
A	src/stats/client.c
A	src/stats/client.h
A	src/stats/global-memory.c
A	src/stats/global-memory.h
A	src/stats/mail-command.c
A	src/stats/mail-command.h
A	src/stats/mail-domain.c
A	src/stats/mail-domain.h
A	src/stats/mail-ip.c
A	src/stats/mail-ip.h
A	src/stats/mail-server-connection.c
A	src/stats/mail-server-connection.h
A	src/stats/mail-session.c
A	src/stats/mail-session.h
A	src/stats/mail-stats.c
A	src/stats/mail-stats.h
A	src/stats/mail-user.c
A	src/stats/mail-user.h
A	src/stats/main.c
A	src/stats/stats-settings.c
A	src/stats/stats-settings.h

2011-08-26 05:10:54 +0300 Timo Sirainen <tss@iki.fi> (93aa246)

    lib-master: Don't count FIFOs as clients anymore. We never see them
    disconnected. This fixes a problem with shutdown_clients=no when a closed
    director process could hang around forever waiting for the FIFO to close.


M	src/director/notify-connection.c
M	src/lib-master/master-service.c
M	src/log/log-connection.c

2011-08-26 05:09:25 +0300 Timo Sirainen <tss@iki.fi> (6cdc919)

    master: If fifo already exists, replace it to be sure it has proper
    permissions.


M	src/master/service-listen.c

2011-08-26 05:08:42 +0300 Timo Sirainen <tss@iki.fi> (b69f4d3)

    imap: Added hooks that can be run always before/after any command handler.


M	src/imap/cmd-append.c
M	src/imap/cmd-uid.c
M	src/imap/imap-client.c
M	src/imap/imap-commands.c
M	src/imap/imap-commands.h

2011-08-26 05:07:53 +0300 Timo Sirainen <tss@iki.fi> (a14f602)

    liblib: Added IPADDR_BITS() macro.


M	src/lib/network.c
M	src/lib/network.h

2011-08-25 03:54:50 +0300 Timo Sirainen <tss@iki.fi> (2d01cc1)

    lib-storage: Moved all transaction stats_* to struct
    mailbox_transaction_stats.


M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/istream-mail-stats.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h

2011-08-25 03:54:18 +0300 Timo Sirainen <tss@iki.fi> (1ee04b5)

    liblib: Added _FULL versions of all linked list handling macros with prev
    and next params. This allows putting structs into multiple linked lists.


M	src/lib/llist.h

2011-08-25 01:16:11 +0300 Timo Sirainen <tss@iki.fi> (de62ce8)

    Moved GUID code to liblib. Use guid_128_t type consistently everywhere.


M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-search.c
M	src/dsync/dsync-brain-msgs.c
M	src/dsync/dsync-data.c
M	src/dsync/dsync-data.h
M	src/dsync/dsync-worker-local.c
M	src/dsync/test-dsync-brain-msgs.c
M	src/dsync/test-dsync-common.c
M	src/dsync/test-dsync-common.h
M	src/dsync/test-dsync-proxy-server-cmd.c
M	src/dsync/test-dsync-proxy.c
M	src/imap/imap-status.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index.h
M	src/lib-index/mail-transaction-log.h
M	src/lib-index/mailbox-log.h
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h
M	src/lib-mail/mail-types.h
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-save.h
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.h
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.h
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-changes.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-uidlist.h
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-storage.h
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/list/index-mailbox-list-status.c
M	src/lib-storage/list/index-mailbox-list.h
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-guid-cache.c
M	src/lib-storage/mailbox-guid-cache.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/lib-storage/test-mailbox-get.c
M	src/lib/Makefile.am
A	src/lib/guid.c
A	src/lib/guid.h
M	src/lmtp/client.c
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h
M	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-expunge-log.c
M	src/plugins/fts/fts-expunge-log.h

2011-08-25 00:27:41 +0300 Timo Sirainen <tss@iki.fi> (6bf4371)

    liblib: Added io_loop_get_current_context()


M	src/lib/ioloop.c
M	src/lib/ioloop.h

2011-08-25 00:27:10 +0300 Timo Sirainen <tss@iki.fi> (ae800c8)

    liblib: io_loop_context_remove_callbacks() now requires also callbacks.


M	src/lib-storage/mail-storage-service.c
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2011-08-24 21:37:15 +0300 Timo Sirainen <tss@iki.fi> (da4e1ef)

    NEWS updated


M	NEWS

2011-08-24 21:24:59 +0300 Timo Sirainen <tss@iki.fi> (d6f592b)

    configure: Removed accidentally committed stats directory.


M	configure.in

2011-08-24 21:07:04 +0300 Timo Sirainen <tss@iki.fi> (c37098f)

    fts-lucene: Added default_language setting and separated stemmer/textcat
    support.


M	configure.in
M	src/plugins/fts-lucene/Makefile.am
M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h

2011-08-23 23:25:14 +0300 Timo Sirainen <tss@iki.fi> (d9f730d)

    lib-index: When creating dovecot.index.backup files, fdatasync() them first.
    Otherwise if the dovecot.index file had been written to recently, it could
    lose both the new and the old backup data.


M	src/lib-index/mail-index-write.c

2011-08-23 23:03:41 +0300 Timo Sirainen <tss@iki.fi> (0fcfa76)

    sdbox: Avoid assert-crashing if mail being saved suddenly became corrupted.


M	src/lib-storage/index/dbox-single/sdbox-mail.c

2011-08-23 22:39:26 +0300 Timo Sirainen <tss@iki.fi> (8ad684f)

    lib-master: Make sure ipc server fd isn't tried to be accessed after it's
    closed.


M	src/lib-master/ipc-server.c

2011-08-23 22:38:24 +0300 Timo Sirainen <tss@iki.fi> (b74cef8)

    rawlog: Use the lib-master API calls.


M	src/util/rawlog.c

2011-08-23 22:14:38 +0300 Timo Sirainen <tss@iki.fi> (36f4f01)

    mbox: Avoid crashing when getting GUID or header-md5 in some conditions.
    mbox file can be opened and locked (especially with pop3_lock_session=yes)
    without actually creating a stream for it.


M	src/lib-storage/index/mbox/mbox-mail.c

2011-08-23 21:41:24 +0300 Timo Sirainen <tss@iki.fi> (f450385)

    zlib: Fixed reading concatenated .gz files.


M	src/plugins/zlib/istream-zlib.c

2011-08-23 21:20:13 +0300 Timo Sirainen <tss@iki.fi> (b8afdaa)

    login proxy: Fixed assert-crash on io_add() when client disconnects at a bad
    time.


M	src/login-common/client-common-auth.c

2011-08-23 20:43:36 +0300 Timo Sirainen <tss@iki.fi> (683bae9)

    lib-lda: Don't crash if remote disconnects during sending mail via LMTP.


M	src/lib-lda/lmtp-client.c

2011-08-23 04:52:55 +0300 Timo Sirainen <tss@iki.fi> (2d28870)

    fts-lucene: Add '/' suffix to textcat_dir if it's not already there.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-23 04:44:26 +0300 Timo Sirainen <tss@iki.fi> (64f30df)

    fts-lucene: Free all Lucene's memory on plugin deinit.


M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h

2011-08-23 04:44:03 +0300 Timo Sirainen <tss@iki.fi> (920f6ee)

    fts-lucene: Fixed memory leak in snowball analyzer.


M	src/plugins/fts-lucene/Snowball.cc
M	src/plugins/fts-lucene/SnowballAnalyzer.h

2011-08-23 03:31:50 +0300 Timo Sirainen <tss@iki.fi> (39d2cc2)

    indexer: Treat worker connections as client connections to avoid early
    idle-kills.


M	src/indexer/worker-pool.c

2011-08-23 03:31:15 +0300 Timo Sirainen <tss@iki.fi> (21e6b4f)

    lib-master: Added master_service_client_connection_created()


M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2011-08-18 18:21:33 +0300 Timo Sirainen <tss@iki.fi> (1ef2ea0)

    mdbox: Remove refcount=0 records from map index on the first purge (not
    second).


M	src/lib-storage/index/dbox-multi/mdbox-purge.c

2011-08-18 18:20:08 +0300 Timo Sirainen <tss@iki.fi> (50854b5)

    mdbox: Remove refcount=0 records from map index on the first purge (not
    second).


M	src/lib-storage/index/dbox-multi/mdbox-purge.c

2011-08-18 18:12:59 +0300 Timo Sirainen <tss@iki.fi> (0575fb5)

    Increased initial memory pool size.


M	src/lib-storage/mail-storage-service.c

2011-08-18 17:59:52 +0300 Timo Sirainen <tss@iki.fi> (6f7b4a6)

    indexer: Code cleanup


M	src/indexer/worker-pool.c

2011-08-16 23:37:42 +0300 Timo Sirainen <tss@iki.fi> (d29ec22)

    fts-lucene: Use TermQuery instead of PrefixQuery for searches. Although
    PrefixQuery gives a more IMAP-like result, it's slower and can fail if the
    prefix string is small.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-16 23:31:31 +0300 Timo Sirainen <tss@iki.fi> (03f4c5f)

    fts-lucene: Automatically delete corrupted indexes and mark all mailboxes
    unindexed.


M	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h

2011-08-16 23:21:52 +0300 Timo Sirainen <tss@iki.fi> (3b55c4f)

    fts-lucene: doveadm fts rescan now resets "last indexed uid" for all
    mailboxes.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-16 23:12:35 +0300 Timo Sirainen <tss@iki.fi> (a92dab6)

    fts-lucene: Avoid unnecessarily creating the lucene-indexes directory.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-16 22:53:01 +0300 Timo Sirainen <tss@iki.fi> (1fb81cb)

    dbox: Create symlink to alt root dir, and warn whenever it changes.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.h

2011-08-16 22:52:19 +0300 Timo Sirainen <tss@iki.fi> (2becb54)

    lib-storage: Don't crash on getting alt root dir, when no alt dir is
    specified.


M	src/lib-storage/mailbox-list.c

2011-08-16 22:36:23 +0300 Timo Sirainen <tss@iki.fi> (37cfbf0)

    lib-storage: Log alt path when mail_debug=yes


M	src/lib-storage/mailbox-list.c

2011-08-16 22:36:04 +0300 Timo Sirainen <tss@iki.fi> (7920a47)

    lib-storage: Log alt path when mail_debug=yes


M	src/lib-storage/mailbox-list.c

2011-08-16 22:27:18 +0300 Timo Sirainen <tss@iki.fi> (05c56ea)

    lib-index: Optimized handling MAIL_TRANSACTION_EXPUNGE_GUID records in large
    index.


M	src/lib-index/mail-index-sync-update.c

2011-08-16 22:27:06 +0300 Timo Sirainen <tss@iki.fi> (73e9db6)

    lib-index: Optimized handling MAIL_TRANSACTION_EXPUNGE_GUID records in large
    index.


M	src/lib-index/mail-index-sync-update.c

2011-08-16 22:26:12 +0300 Timo Sirainen <tss@iki.fi> (03a8375)

    fts-lucene: Don't add messages to expunge log that aren't even in the index.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2011-08-16 22:23:48 +0300 Timo Sirainen <tss@iki.fi> (37fefd2)

    fts-lucene: Once enough messages have been deleted, trigger optimize via
    indexer.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2011-08-16 22:22:32 +0300 Timo Sirainen <tss@iki.fi> (4ca9910)

    fts-lucene: Yet another (final!) attempt at avoiding "Too Many Clauses"
    error.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-16 22:21:38 +0300 Timo Sirainen <tss@iki.fi> (e9257b4)

    fts: Added fts_indexer_cmd() for easily sending commands to indexer.


M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-build-indexer.c

2011-08-16 22:21:06 +0300 Timo Sirainen <tss@iki.fi> (294f579)

    indexer: Added OPTIMIZE command to optimize fts index.


M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-queue.h
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-connection.h

2011-08-16 22:20:40 +0300 Timo Sirainen <tss@iki.fi> (20eafc2)

    lib-storage: Added MAILBOX_SYNC_FLAG_OPTIMIZE flag for triggering fts
    optimize. This is a pretty ugly kludge, since it does nothing when FTS isn't
    enabled..


M	src/lib-storage/mail-storage.h
M	src/plugins/fts/fts-storage.c

2011-08-16 21:08:23 +0300 Timo Sirainen <tss@iki.fi> (1e0842a)

    fts-lucene: Another attempt to avoid "Too Many Clauses" error by not using ?
    wildcard.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-16 20:04:29 +0300 Timo Sirainen <tss@iki.fi> (6bc4417)

    fts-lucene: Fix to previous change: actually use WildcardQuery, not
    TermQuery..


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-16 19:51:28 +0300 Timo Sirainen <tss@iki.fi> (87ac161)

    lazy-expunge: Avoid crashing if user init fails.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2011-08-16 19:46:06 +0300 Timo Sirainen <tss@iki.fi> (bfd9dc2)

    fts-lucene: Use WildcardQuery rather than RangeQuery to limit what UIDs to
    fetch.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-16 19:19:10 +0300 Timo Sirainen <tss@iki.fi> (eae0829)

    lazy-expunge: Fixed assert-crash when trying to open lazy-expunge mailbox.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2011-08-16 19:06:55 +0300 Timo Sirainen <tss@iki.fi> (6727b10)

    lib-storage: MAIL_STORAGE_SERVICE_FLAG_NO_LOG_INIT crashed after previous
    ioloop change.


M	src/lib-storage/mail-storage-service.c

2011-08-16 18:50:42 +0300 Timo Sirainen <tss@iki.fi> (b37dc96)

    fts: Assert-crashfix to HTML parsing if the document ends with a small tag.


M	src/plugins/fts/fts-parser-html.c

2011-08-16 18:33:27 +0300 Timo Sirainen <tss@iki.fi> (1388b59)

    Replaced "ioloop log" with a more generic "ioloop context". The context can
    call multiple callbacks that can do anything they want, including setting
    the log prefix.


M	src/lib-storage/mail-storage-service.c
M	src/lib/ioloop-internal.h
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-kqueue.c
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2011-08-16 18:27:40 +0300 Timo Sirainen <tss@iki.fi> (88f3517)

    lib-storage: Fixed assert-crash caused by previous stats change.


M	src/lib-storage/index/index-search.c

2011-08-16 17:02:08 +0300 Timo Sirainen <tss@iki.fi> (1eaaa2c)

    lib-storage: Moved stats_* from mail to transaction. With the API changes to
    search, having them in mail doesn't make sense anymore, since
    mailbox_search_next() can return multiple different mails with different
    stats.


M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/istream-mail-stats.c
M	src/lib-storage/index/istream-mail-stats.h
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h

2011-08-16 16:59:40 +0300 Timo Sirainen <tss@iki.fi> (015523c)

    Compiler warning fix.


M	src/lib-storage/mail-storage.c

2011-08-15 14:48:52 +0300 Timo Sirainen <tss@iki.fi> (e3f89f8)

    lib-index: Assert-crashfix when reading transaction log header fails with
    ESTALE.


M	src/lib-index/mail-transaction-log-file.c

2011-08-15 14:48:18 +0300 Timo Sirainen <tss@iki.fi> (8f0e6d6)

    lib-index: Avoid crashing when dealing with duplicate transaction log
    sequences.


M	src/lib-index/mail-transaction-log-file.c

2011-08-15 14:33:36 +0300 Timo Sirainen <tss@iki.fi> (edc3dae)

    fts-lucene: Don't crash if expunging didn't actually do anything.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-15 01:18:01 +0300 Timo Sirainen <tss@iki.fi> (2b49daf)

    example-config: Updated auth_username_format default to match reality.


M	doc/example-config/conf.d/10-auth.conf

2011-08-15 01:11:47 +0300 Timo Sirainen <tss@iki.fi> (8eb118a)

    lib-storage: Fixed mail_storage_copy_can_use_hardlink() for mode=0600 with
    different uids.


M	src/lib-storage/mail-copy.c

2011-08-15 01:06:19 +0300 Timo Sirainen <tss@iki.fi> (47d5cc0)

    lib-storage: mailbox_list_get_permissions() now returns struct
    mailbox_permissions. Also added new file_uid and file_gid fields to the
    mailbox_permissions.


M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-backend-vfile.c

2011-08-15 00:44:01 +0300 Timo Sirainen <tss@iki.fi> (6c1a534)

    Compiler warning fix.


M	src/lib-storage/mail.c

2011-08-15 00:34:45 +0300 Timo Sirainen <tss@iki.fi> (bfa7ef8)

    mbox: Generate mailbox GUID without syncing the mbox, locking it is enough.


M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-private.h
M	src/lib-storage/index/mbox/mbox-sync.c

2011-08-15 00:30:18 +0300 Timo Sirainen <tss@iki.fi> (4fe2f0c)

    mbox: Fixed crashing with pop3_lock_session=yes


M	src/lib-storage/index/mbox/mbox-lock.c

2011-08-14 23:39:10 +0300 Timo Sirainen <tss@iki.fi> (1a78f0c)

    lib-storage: Don't crash if INBOX is in a namespace with non-"" non-"INBOX/"
    prefix.


M	src/lib-storage/mail-storage.c

2011-08-14 21:35:39 +0300 Timo Sirainen <tss@iki.fi> (9b66438)

    fts-lucene: doveadm fts rescan now also optimizes the index at the end.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2011-08-14 21:29:07 +0300 Timo Sirainen <tss@iki.fi> (96a738c)

    fts-solr-old: Mailbox names are mUTF-7 in the Solr index, not UTF-8.


M	src/plugins/fts-solr/Makefile.am
M	src/plugins/fts-solr/fts-backend-solr-old.c

2011-08-14 21:28:28 +0300 Timo Sirainen <tss@iki.fi> (09c8ed6)

    lib-imap: Added t_imap_utf8_to_utf7()


M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-utf7.h

2011-08-14 21:02:43 +0300 Timo Sirainen <tss@iki.fi> (df26373)

    indexer: Don't die on "idle kill signal" if workers are still busy.


M	src/indexer/indexer.c
M	src/indexer/worker-pool.c
M	src/indexer/worker-pool.h

2011-08-14 20:55:32 +0300 Timo Sirainen <tss@iki.fi> (2a47231)

    indexer: Potential crashfix on deinit.


M	src/indexer/worker-connection.c

2011-08-14 20:55:12 +0300 Timo Sirainen <tss@iki.fi> (6990472)

    fts-lucene: Actually delete messages from index on expunge/rescan.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-14 20:41:44 +0300 Timo Sirainen <tss@iki.fi> (bc0553d)

    fts: fts_expunge_log_uid_count() returned garbage on nonexistent log.


M	src/plugins/fts/fts-expunge-log.c

2011-08-14 20:41:21 +0300 Timo Sirainen <tss@iki.fi> (a706172)

    fts: Memory leak fix


M	src/plugins/fts/fts-storage.c

2011-08-14 20:41:06 +0300 Timo Sirainen <tss@iki.fi> (def291c)

    fts-lucene: Avoid crashing on doveadm dump.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-14 20:40:49 +0300 Timo Sirainen <tss@iki.fi> (5ab440d)

    fts-lucene: Fixed doveadm dump's lucene-index detection.


M	src/plugins/fts-lucene/doveadm-fts-lucene.c

2011-08-12 17:39:19 +0300 Timo Sirainen <tss@iki.fi> (027c729)

    fts-lucene: Use fts expunge log instead of scanning the entire index for
    expunged mails.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h

2011-08-12 17:37:23 +0300 Timo Sirainen <tss@iki.fi> (3dfa8c7)

    fts: Added "doveadm fts rescan" command.


M	src/plugins/fts/doveadm-fts.c

2011-08-12 17:33:29 +0300 Timo Sirainen <tss@iki.fi> (a569c6d)

    fts: Added fts_backend_rescan()


M	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-api.h

2011-08-12 17:47:29 +0300 Timo Sirainen <tss@iki.fi> (cc2954a)

    fts: Added generic "fts expunge log". This is intended to be used by fts
    backends that can't directly expunge from the index, but rather need to log
    the expunges and do the actual expunging later.

    Added also "doveadm dump" support for the log.

M	src/plugins/fts/Makefile.am
A	src/plugins/fts/doveadm-dump-fts-expunge-log.c
M	src/plugins/fts/doveadm-fts.c
A	src/plugins/fts/doveadm-fts.h
A	src/plugins/fts/fts-expunge-log.c
A	src/plugins/fts/fts-expunge-log.h

2011-08-12 17:27:05 +0300 Timo Sirainen <tss@iki.fi> (39ed514)

    fts-lucene: Added "doveadm dump" support for lucene index.


M	src/plugins/fts-lucene/Makefile.am
A	src/plugins/fts-lucene/doveadm-fts-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h

2011-08-12 17:40:55 +0300 Timo Sirainen <tss@iki.fi> (6feb0ff)

    lib-storage: Added mail_guid_128_hash/cmp()


M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-guid-cache.c

2011-08-12 17:40:19 +0300 Timo Sirainen <tss@iki.fi> (b53af18)

    liblib: Added generic mem_hash()


M	src/lib/hash.c
M	src/lib/hash.h

2011-08-11 18:10:33 +0300 Timo Sirainen <tss@iki.fi> (d3380f1)

    fts: Added "doveadm fts optimize" command.


M	src/plugins/fts/Makefile.am
A	src/plugins/fts/doveadm-fts.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h

2011-08-11 18:05:56 +0300 Timo Sirainen <tss@iki.fi> (009d6d9)

    fts-lucene: Several fixes and improvements.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h

2011-08-11 18:03:20 +0300 Timo Sirainen <tss@iki.fi> (bd4e36a)

    lib-storage: Added mailbox_alloc_guid() for opening mailbox by its GUID.


M	src/lib-storage/Makefile.am
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
A	src/lib-storage/mailbox-guid-cache.c
A	src/lib-storage/mailbox-guid-cache.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2011-08-11 18:02:25 +0300 Timo Sirainen <tss@iki.fi> (fcfe856)

    lib-storage: Added struct mailbox.generation_sequence. This can be used for
    caching struct mailbox pointers and checking later if two struct mailboxes +
    their generation sequences match. If they do, it's the same struct mailbox.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage-private.h

2011-08-11 17:35:45 +0300 Timo Sirainen <tss@iki.fi> (1e1549f)

    fts-lucene: Store indexed header names lowercased so they can actually be
    searched.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-10 18:53:50 +0300 Timo Sirainen <tss@iki.fi> (e2e5558)

    fts-squat: Assert-crashfix on indexing


M	src/plugins/fts-squat/squat-trie.c

2011-08-10 17:47:50 +0300 Timo Sirainen <tss@iki.fi> (a57c161)

    Removed dead code.


M	src/imap/imap-status.c
M	src/lib-storage/index/imapc/imapc-seqmap.c
M	src/lib-storage/list/index-mailbox-list-status.c
M	src/lib-storage/list/index-mailbox-list.c

2011-08-10 17:43:49 +0300 Timo Sirainen <tss@iki.fi> (8f2444f)

    lib-ssl-iostream: ssl_iostream_get_security_string() didn't return
    compression.


M	src/lib-ssl-iostream/iostream-openssl.c

2011-08-10 17:37:16 +0300 Timo Sirainen <tss@iki.fi> (857c9d2)

    Makefile fixes to include everything in dist


M	src/plugins/fts-lucene/Makefile.am
M	src/plugins/fts/Makefile.am

2011-08-10 17:37:07 +0300 Timo Sirainen <tss@iki.fi> (a5e8937)

    fts: Increased initial memory pool size


M	src/plugins/fts/fts-storage.c

2011-08-10 17:02:18 +0300 Timo Sirainen <tss@iki.fi> (68c4776)

    Fixed compiling without OpenSSL.


M	configure.in
M	src/lib-ssl-iostream/Makefile.am
A	src/lib-ssl-iostream/iostream-ssl-none.c

2011-08-10 16:50:19 +0300 Timo Sirainen <tss@iki.fi> (1994ae2)

    fts-lucene: Added missing textcat.conf


A	src/plugins/fts-lucene/textcat.conf

2011-08-10 16:16:57 +0300 Timo Sirainen <tss@iki.fi> (4b4aabb)

    lib-storage: Fixed getting recent count for mailbox when it wasn't synced.


M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync.c

2011-08-10 16:08:45 +0300 Timo Sirainen <tss@iki.fi> (ecf44c7)

    doveadm index -n: Don't sync mailbox when checking the recent count. The
    syncing alone can take a long time with huge maildirs. Better to be slightly
    wrong than waste a lot of time all the time.


M	src/doveadm/doveadm-mail-index.c
M	src/indexer/master-connection.c

2011-08-10 16:00:45 +0300 Timo Sirainen <tss@iki.fi> (08ed4ab)

    lib-storage: Fixes to handling INBOX/ namespace prefix.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c

2011-08-10 15:17:12 +0300 Timo Sirainen <tss@iki.fi> (947e4e6)

    indexer: Deinitialize without crashing when there are requests.


M	src/indexer/indexer.c

2011-08-10 15:16:44 +0300 Timo Sirainen <tss@iki.fi> (7fdc192)

    indexer: Fix to handling disconnected worker.


M	src/indexer/worker-connection.c

2011-08-10 15:03:59 +0300 Timo Sirainen <tss@iki.fi> (451d1a0)

    fts: Assert-crashfix to HTML parsing.


M	src/plugins/fts/fts-parser-html.c

2011-08-10 14:56:00 +0300 Timo Sirainen <tss@iki.fi> (73caa98)

    fts: Don't crash if application/octet-stream attachment doesn't have
    filename.


M	src/plugins/fts/fts-parser-script.c

2011-08-10 14:50:56 +0300 Timo Sirainen <tss@iki.fi> (2ee34f0)

    indexer: If worker disconnects, log whose requests were discarded.


M	src/indexer/worker-connection.c

2011-08-10 14:48:08 +0300 Timo Sirainen <tss@iki.fi> (b24870f)

    indexer: Handle unexpected worker disconnections better.


M	src/indexer/worker-connection.c

2011-08-10 14:19:00 +0300 Timo Sirainen <tss@iki.fi> (fcaf124)

    doveadm: The actual doveadm part of the previous commit..


M	src/doveadm/doveadm-mail-index.c

2011-08-10 14:17:54 +0300 Timo Sirainen <tss@iki.fi> (7c0e7d9)

    doveadm index: Added -n parameter to specify max number of recent msgs to
    perform indexing. The idea is that if a user hasn't opened the mailbox for a
    long time (or ever), there's not much point in wasting time on doing
    indexing.


M	src/indexer/indexer-client.c
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-queue.h
M	src/indexer/indexer.c
M	src/indexer/master-connection.c
M	src/indexer/worker-connection.c
M	src/indexer/worker-connection.h

2011-08-10 13:46:31 +0300 Timo Sirainen <tss@iki.fi> (dc03b7b)

    fts-lucene: Crashfix for handling header searches with stop words (etc).


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-09 20:44:34 +0300 Timo Sirainen <tss@iki.fi> (4f68fa8)

    script: Be sure to handle LF+LF properly.


M	src/plugins/quota/quota.c
M	src/util/script.c

2011-08-09 20:39:33 +0300 Timo Sirainen <tss@iki.fi> (6e52ab0)

    script: Comment update


M	src/util/script.c

2011-08-09 20:05:38 +0300 Timo Sirainen <tss@iki.fi> (0be9d7c)

    indexer-worker: verbose_proctitle=yes now shows username+mailbox.


M	src/indexer/master-connection.c

2011-08-09 19:56:54 +0300 Timo Sirainen <tss@iki.fi> (212fbae)

    fts: Data stack access fix.


M	src/plugins/fts/fts-search.c

2011-08-09 19:50:02 +0300 Timo Sirainen <tss@iki.fi> (fe9fb91)

    indexer: Read configuration earlier while we still have privileges.


M	src/indexer/indexer.c

2011-08-09 19:42:23 +0300 Timo Sirainen <tss@iki.fi> (cfa8a04)

    indexer: If verbose_proctitle=yes, show how many clients/requests there are.


M	src/indexer/indexer-client.c
M	src/indexer/indexer-client.h
M	src/indexer/indexer-queue.c
M	src/indexer/indexer-queue.h
M	src/indexer/indexer.c
M	src/indexer/indexer.h

2011-08-09 19:28:00 +0300 Timo Sirainen <tss@iki.fi> (2ce5b1d)

    fts-lucene: Fixed compiling without textcat/snowball


M	src/plugins/fts-lucene/Makefile.am
M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-09 16:41:29 +0300 Timo Sirainen <tss@iki.fi> (73bc0de)

    fts: Log how many messages were indexed.


M	src/plugins/fts/fts-build-private.h
M	src/plugins/fts/fts-build.c

2011-08-09 16:33:19 +0300 Timo Sirainen <tss@iki.fi> (cfbacf6)

    lib-index: MAIL_INDEX_SYNC_FLAG_DELETING_INDEX comment updated


M	src/lib-index/mail-index.h

2011-08-09 16:32:27 +0300 Timo Sirainen <tss@iki.fi> (4911787)

    lib-index: MAIL_INDEX_SYNC_FLAG_DELETING_INDEX now allows committing changes
    to deleted index. This fixes deleting mailboxes.


M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction.c

2011-08-09 15:29:26 +0300 Timo Sirainen <tss@iki.fi> (b1b0ec3)

    fts-lucene: Crashfix when textcat wasn't enabled.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2011-08-09 15:05:18 +0300 Timo Sirainen <tss@iki.fi> (c8296ac)

    fts-lucene: Added initial support for language detection and stemming. This
    requires textcat and snowball (libstemmer) libraries. This can be enabled by
    setting: fts_lucene = textcat_dir=/usr/share/libtextcat \  
    textcat_conf=/etc/dovecot/textcat.conf

    I'm not yet sure how good of an idea it is to actually use this, so it needs 
    some testing.. For example how bad is it if language is detected 
    incorrectly?

M	configure.in
M	src/plugins/fts-lucene/Makefile.am
A	src/plugins/fts-lucene/Snowball.cc
A	src/plugins/fts-lucene/SnowballAnalyzer.h
A	src/plugins/fts-lucene/SnowballFilter.h
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-lucene/fts-lucene-plugin.h
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h

2011-08-09 14:13:13 +0300 Timo Sirainen <tss@iki.fi> (9a4e08a)

    indexer-worker: Added -D parameter to enable core dumps.


M	src/indexer/indexer-worker.c

2011-08-09 13:53:59 +0300 Timo Sirainen <tss@iki.fi> (5c1fdc9)

    decode2text: If unzip fails, just ignore the attachment silently.


M	src/plugins/fts/decode2text.sh

2011-08-09 13:45:26 +0300 Timo Sirainen <tss@iki.fi> (dd7ec89)

    fts html parser: Assert-crashfix when parsing entities.


M	src/plugins/fts/fts-parser-html.c

2011-08-09 13:42:25 +0300 Timo Sirainen <tss@iki.fi> (4029539)

    decode2text: Ignore any errors from pdftotext


M	src/plugins/fts/decode2text.sh

2011-08-09 12:48:15 +0300 Timo Sirainen <tss@iki.fi> (1bed3cc)

    Compile fix for CentOS 4.9 (and maybe others).


M	src/lib-storage/index/index-mail.c

2011-08-07 22:28:19 +0300 Timo Sirainen <tss@iki.fi> (5dbce18)

    doveadm-server: More fixes


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c

2011-08-07 22:11:20 +0300 Timo Sirainen <tss@iki.fi> (10b8040)

    doveadm-server: Many fixes to make it actually work properly.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/server-connection.c

2011-08-07 22:10:23 +0300 Timo Sirainen <tss@iki.fi> (0950aed)

    doveadm index -q: Delay connecting to indexer.


M	src/doveadm/doveadm-mail-index.c

2011-08-07 20:47:59 +0300 Timo Sirainen <tss@iki.fi> (5230375)

    doveadm server: Fixed handling command parameters


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2011-08-05 12:07:48 +0300 Timo Sirainen <tss@iki.fi> (a9f9c80)

    fts: decode2text.sh now ignores any errors from doc/xls/ppt decoders.


M	src/plugins/fts/decode2text.sh

2011-08-04 20:21:38 +0300 Timo Sirainen <tss@iki.fi> (d5d2eb5)

    ipc client: Fixed crashing on ipc server disconnection.


M	src/lib-master/ipc-server.c

2011-08-04 19:57:35 +0300 Timo Sirainen <tss@iki.fi> (82c7443)

    mail_index_get_keywords() / status.keywords weren't actually guaranteed to
    be NULL terminated This could have caused crashes or garbage keywords be
    presented to clients in some situations.


M	src/lib-index/mail-index.c

2011-08-04 19:57:02 +0300 Timo Sirainen <tss@iki.fi> (f5c5327)

    mail_index_get_keywords() / status.keywords weren't actually guaranteed to
    be NULL terminated This could have caused crashes or garbage keywords be
    presented to clients in some situations.


M	src/lib-index/mail-index.c

2011-08-04 19:29:25 +0300 Timo Sirainen <tss@iki.fi> (1925b60)

    pop3: Fixed RETR/TOP commands.


M	src/pop3/pop3-commands.c

2011-08-04 16:45:02 +0300 Timo Sirainen <tss@iki.fi> (402406d)

    fts-lucene: Several fixes to avoid opening index during expunging.


M	src/plugins/fts-lucene/fts-backend-lucene.c

2011-08-04 16:44:33 +0300 Timo Sirainen <tss@iki.fi> (a0475b2)

    fts: Tell backends if we're currently in the code because we're syncing.
    That basically means it's either indexer process or doveadm index.


M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-storage.c

2011-08-04 16:43:51 +0300 Timo Sirainen <tss@iki.fi> (083c67a)

    fts: Maildir workaround to avoid assert-crash during indexing. This should
    be fixed by simply not having Maildir do a full sync when it's trying to
    find some file.


M	src/plugins/fts/fts-storage.c

2011-08-04 16:42:35 +0300 Timo Sirainen <tss@iki.fi> (e2462f3)

    fts: Don't fail index build if trying to index a message that is already
    expunged.


M	src/plugins/fts/fts-build.c

2011-08-04 16:16:20 +0300 Timo Sirainen <tss@iki.fi> (61af185)

    fts-lucene: Don't crash when trying to search an unsearchable word.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-04 15:49:49 +0300 Timo Sirainen <tss@iki.fi> (a6de00f)

    fts-lucene: Fixed checking if we need to track expunges or optimize.


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-04 15:44:33 +0300 Timo Sirainen <tss@iki.fi> (97c4e23)

    fts-lucene: Fixed handling expunges


M	src/plugins/fts-lucene/fts-backend-lucene.c

2011-08-04 15:40:30 +0300 Timo Sirainen <tss@iki.fi> (cea6742)

    fts: Clear updating flag on update deinit.


M	src/plugins/fts/fts-api.c

2011-08-04 15:08:44 +0300 Timo Sirainen <tss@iki.fi> (9d2ef42)

    fts: Define pkglibexecdir explicitly in Makefile.am, since older automakes
    don't.


M	src/plugins/fts/Makefile.am

2011-08-04 14:49:36 +0300 Timo Sirainen <tss@iki.fi> (57b19a7)

    fts: Added a bit more error checking to decode2text.sh


M	src/plugins/fts/decode2text.sh

2011-08-04 14:13:39 +0300 Timo Sirainen <tss@iki.fi> (ceae1ac)

    fts: force-resync now calls optimize on the backend. This mainly works with
    Lucene backend to recheck what messages actually exist.


M	src/plugins/fts/fts-storage.c

2011-08-04 14:12:56 +0300 Timo Sirainen <tss@iki.fi> (eead39e)

    fts: NULs weren't still handled correctly in message headers.


M	src/plugins/fts/fts-build.c

2011-08-04 14:12:30 +0300 Timo Sirainen <tss@iki.fi> (8a7c362)

    fts-lucene: Don't crash if optimize can't open the index.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-04 14:12:11 +0300 Timo Sirainen <tss@iki.fi> (3000346)

    fts-lucene: If optimize doesn't find an index, set all UIDs as missing.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-04 13:48:14 +0300 Timo Sirainen <tss@iki.fi> (f94e1eb)

    fts-lucene: Delete stale write locks.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-08-04 13:42:49 +0300 Timo Sirainen <tss@iki.fi> (2f971d2)

    fts: Install decode2text to libexecdir.


M	src/plugins/fts/Makefile.am
M	src/plugins/fts/decode2text.sh

2011-08-04 13:40:43 +0300 Timo Sirainen <tss@iki.fi> (c4ba197)

    fts: decode2text added support for openxml and opendocument formats


M	src/plugins/fts/decode2text.sh

2011-08-04 13:38:51 +0300 Timo Sirainen <tss@iki.fi> (04f80fb)

    fts: Added xml2text binary


M	.hgignore
M	src/plugins/fts/Makefile.am
A	src/plugins/fts/xml2text.c

2011-08-04 13:05:26 +0300 Timo Sirainen <tss@iki.fi> (96f6232)

    fts: HTML parser now makes sure space is added for each <tag> This could be
    smarter though, like not doing this for <span>, but it gets a bit complex..


M	src/plugins/fts/fts-parser-html.c

2011-08-03 20:44:43 +0300 Timo Sirainen <tss@iki.fi> (e7bdea8)

    lib-storage: Don't crash listing subscription entry of "ns prefix" without
    separator.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2011-08-03 20:29:53 +0300 Timo Sirainen <tss@iki.fi> (06972d9)

    doveadm server: Non-proxying mode may not have worked.


M	src/doveadm/doveadm-mail-server.c

2011-08-03 20:29:16 +0300 Timo Sirainen <tss@iki.fi> (b38d0e7)

    eacces_error_get*(): Handle non-int struct stat.st_mode properly.


M	src/lib/eacces-error.c

2011-08-03 19:06:37 +0300 Timo Sirainen <tss@iki.fi> (4dd0cbd)

    Merged changes from v2.0 tree.


2011-08-03 18:59:07 +0300 Timo Sirainen <tss@iki.fi> (4d27f95)

    fts: Don't pass NUL bytes to FTS backend. It can confuse them.


M	src/plugins/fts/fts-build.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-parser.h

2011-08-03 18:58:45 +0300 Timo Sirainen <tss@iki.fi> (a483163)

    fts: Fixed a crash in HTML parser.


M	src/plugins/fts/fts-parser-html.c

2011-08-03 18:54:19 +0300 Timo Sirainen <tss@iki.fi> (a34f47b)

    fts: Crashfix.


M	src/plugins/fts/fts-parser-script.c

2011-08-02 13:29:47 +0300 Timo Sirainen <tss@iki.fi> (fe215bf)

    i_getgr*(): OpenBSD workaround is now only used for <5.0. Patch by Brad.


M	src/lib/ipwd.c

2011-07-29 14:30:32 +0300 Timo Sirainen <tss@iki.fi> (9ba9149)

    lib-storage: mailbox_list_mailbox() now returns INBOX as nonexistent if it
    physically doesn't exist. This is important for
    MAILBOX_LIST_ITER_NO_AUTO_BOXES to work correctly with Maildir++ layout
    INBOX.


M	src/lib-storage/mailbox-list.c

2011-07-29 14:29:01 +0300 Timo Sirainen <tss@iki.fi> (cff1f18)

    lib-storage: Added auto_boxes parameter to mailbox_exists().


M	src/imap/cmd-subscribe.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/virtual/virtual-storage.c

2011-07-29 14:21:13 +0300 Timo Sirainen <tss@iki.fi> (da70081)

    lib-storage: Unit test fix


M	src/lib-storage/test-mail.c

2011-07-29 13:41:04 +0300 Timo Sirainen <tss@iki.fi> (647e66c)

    dsync: Crashfix


M	src/dsync/dsync-worker-local.c

2011-07-29 12:25:52 +0300 Timo Sirainen <tss@iki.fi> (253201e)

    lib-storage: renaming mailboxes under different parent was broken in fs
    layout If alt storage was used with sdbox or if index or control dirs were
    used, renaming "foo" to "bar/foo" would result "foo" not being renamed for
    those directories.


M	src/lib-storage/list/mailbox-list-fs.c

2011-07-29 00:04:20 +0300 Timo Sirainen <tss@iki.fi> (ea48f35)

    lib-storage: Removed unnecessary NULL checks.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-namespace.c

2011-07-28 17:46:37 +0300 Timo Sirainen <tss@iki.fi> (0bcc7b7)

    lib-storage: Fixed crashing on "NOT <nonexistent sequence>" search.


M	src/lib-storage/index/index-search.c

2011-07-28 17:23:01 +0300 Timo Sirainen <tss@iki.fi> (ecc5a1a)

    fts: Added attachment decoding via an external script.


M	src/plugins/fts/Makefile.am
A	src/plugins/fts/decode2text.sh
M	src/plugins/fts/fts-build.c
M	src/plugins/fts/fts-parser-html.c
A	src/plugins/fts/fts-parser-script.c
M	src/plugins/fts/fts-parser.c
M	src/plugins/fts/fts-parser.h

2011-07-28 17:01:26 +0300 Timo Sirainen <tss@iki.fi> (7e50cca)

    lib-mail: Added message_decoder_set_return_binary()


M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-decoder.h

2011-07-28 17:01:09 +0300 Timo Sirainen <tss@iki.fi> (7631f16)

    lib-storage: mail->saving was set too late, which could have caused crashes.


M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail.c
M	src/plugins/virtual/virtual-mail.c

2011-07-28 17:00:29 +0300 Timo Sirainen <tss@iki.fi> (e638c0d)

    lmtp: Crashfix


M	src/lmtp/client.c

2011-07-28 16:59:56 +0300 Timo Sirainen <tss@iki.fi> (2d37319)

    "script" service API changed to provide more functionality.


M	src/plugins/quota/quota.c
M	src/util/script.c

2011-07-28 12:23:06 +0300 Timo Sirainen <tss@iki.fi> (ec089b7)

    mdbox: Crashfix


M	src/lib-storage/index/dbox-multi/mdbox-map.c

2011-07-28 12:08:10 +0300 Timo Sirainen <tss@iki.fi> (d495039)

    imap: FETCH BODY[HEADER.FIELDS (..)] may have tried to fetch garbage field
    names. Such situations were quite likely to cause a crash though.


M	src/imap/imap-fetch-body.c

2011-07-27 19:46:01 +0300 Timo Sirainen <tss@iki.fi> (d12d1ac)

    imap-quota: Don't crash if invalid mailbox name is given to GETQUOTAROOT.


M	src/plugins/imap-quota/imap-quota-plugin.c

2011-07-27 17:58:27 +0300 Timo Sirainen <tss@iki.fi> (7721207)

    fts: Strip text/html mails to plaintext before sending them to FTS backend.


M	src/plugins/fts/Makefile.am
M	src/plugins/fts/fts-build-private.h
M	src/plugins/fts/fts-build.c
A	src/plugins/fts/fts-parser-html.c
A	src/plugins/fts/fts-parser.c
A	src/plugins/fts/fts-parser.h
A	src/plugins/fts/html-entities.h

2011-07-27 14:53:52 +0300 Timo Sirainen <tss@iki.fi> (03176d7)

    solr-schema: Version number is Solr's schema version, not Dovecot version.


M	doc/solr-schema.xml

2011-07-26 15:09:02 +0300 Timo Sirainen <tss@iki.fi> (da2f9bc)

    IMAP: Implemented the rest of FUZZY extension.


M	configure.in
M	src/imap/imap-search.c
M	src/imap/imap-search.h

2011-07-26 15:04:57 +0300 Timo Sirainen <tss@iki.fi> (65c3bc9)

    lib-storage: Sorting by relevancy returned messages in reverse order.


M	src/lib-storage/index/index-sort.c

2011-07-26 14:11:23 +0300 Timo Sirainen <tss@iki.fi> (fd14806)

    s/search score/search relevancy/


M	src/imap/cmd-sort.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/mail-storage.h
M	src/plugins/fts/fts-storage.c

2011-07-26 14:10:47 +0300 Timo Sirainen <tss@iki.fi> (0ae79eb)

    fts-lucene: Added fuzzy search support.


M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-07-26 14:10:41 +0300 Timo Sirainen <tss@iki.fi> (154224a)

    fts-solr: Added fuzzy search support.


M	src/plugins/fts-solr/fts-backend-solr.c

2011-07-26 14:09:49 +0300 Timo Sirainen <tss@iki.fi> (560e65f)

    lib-storage: Added FUZZY search key that adds fuzzy=TRUE to its child args.


M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search.h

2011-07-26 13:55:22 +0300 Timo Sirainen <tss@iki.fi> (13d58f3)

    lib-storage: Search query building no longer converts strings to decomposed
    titlecase.


M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-build.h
M	src/lib-storage/mail-search-register-imap.c

2011-07-26 13:54:23 +0300 Timo Sirainen <tss@iki.fi> (5601c23)

    fts-squat: Convert search key to decomposed titlecase instead of assuming it
    is.


M	src/plugins/fts-squat/fts-backend-squat.c

2011-07-26 13:52:20 +0300 Timo Sirainen <tss@iki.fi> (556f584)

    lib-mail: message_search_init() now converts search key to decomposed
    titlecase.


M	src/lib-mail/message-search.c
M	src/lib-mail/message-search.h

2011-07-26 13:38:35 +0300 Timo Sirainen <tss@iki.fi> (0fbea4d)

    fts: Convert input text to decomposed titlecase only for Squat backend.
    Lucene and Solr can handle case-insensitivity internally.


M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-build-private.h
M	src/plugins/fts/fts-build.c

2011-07-22 13:52:27 +0300 Timo Sirainen <tss@iki.fi> (4fd7afd)

    doveadm dump: Added fts support.


M	src/doveadm/doveadm-dump-index.c

2011-07-22 13:52:16 +0300 Timo Sirainen <tss@iki.fi> (fb6e98b)

    fts: Make sure build_more() is called at least once, even when message is 0
    bytes.


M	src/plugins/fts/fts-build.c

2011-07-22 13:51:57 +0300 Timo Sirainen <tss@iki.fi> (403762e)

    fts: Make sure fts_index_get_last_uid() gets the latest value from index.


M	src/plugins/fts/fts-api.c

2011-07-22 13:21:59 +0300 Timo Sirainen <tss@iki.fi> (8d58783)

    fts: Redesigned/enhanced FTS API and how virtual plugin works with it. The
    changes include:

     - Only indexer process and "doveadm index" do FTS indexing now. Other 
    processes connect to the indexer process via UNIX socket and request 
    indexing a specific mailbox.

     - FTS backends can now index/search any search key. Current backends 
    implement indexing for some specific header fields (Subject, From, To, Cc, 
    Bcc), but it would also be possible to add indexing for e.g. message size or
    date.

     - CLucene support is fixed and fully functional.

     - Solr is split to "solr" and "solr_old" backends. The new "solr" backend 
    supports the new header fields. It also uses mailbox GUIDs as mailbox 
    identifiers, so that renaming a mailbox doesn't require reindexing. The
    "solr_old" uses the old Solr schema and doesn't support any new features.

M	configure.in
M	doc/solr-schema.xml
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc
M	src/plugins/fts-lucene/lucene-wrapper.h
M	src/plugins/fts-solr/Makefile.am
A	src/plugins/fts-solr/fts-backend-solr-old.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/fts-solr-plugin.h
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-solr/solr-connection.h
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-trie.h
M	src/plugins/fts/Makefile.am
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-api.h
A	src/plugins/fts/fts-build-indexer.c
A	src/plugins/fts/fts-build-mailbox.c
A	src/plugins/fts/fts-build-private.h
A	src/plugins/fts/fts-build-virtual.c
A	src/plugins/fts/fts-build.c
A	src/plugins/fts/fts-build.h
D	src/plugins/fts/fts-mailbox.c
D	src/plugins/fts/fts-mailbox.h
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-plugin.h
A	src/plugins/fts/fts-search-serialize.c
A	src/plugins/fts/fts-search-serialize.h
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2011-07-22 13:13:29 +0300 Timo Sirainen <tss@iki.fi> (8831124)

    Added uni_utf8_strlen().


M	src/lib/unichar.c
M	src/lib/unichar.h

2011-07-22 13:11:26 +0300 Timo Sirainen <tss@iki.fi> (7e468fa)

    lib-storage: mailbox_exists() now returns NOSELECT for invalid mailbox names
    instead of error.


M	src/lib-storage/mail-storage.c

2011-07-22 13:10:41 +0300 Timo Sirainen <tss@iki.fi> (cef9562)

    lib-storage: Error handling fix for FS layout.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2011-07-22 13:10:09 +0300 Timo Sirainen <tss@iki.fi> (c10706d)

    lib-mail: Added message_header_is_address()


M	src/lib-mail/message-address.c
M	src/lib-mail/message-address.h

2011-07-22 13:09:40 +0300 Timo Sirainen <tss@iki.fi> (6be93b1)

    indexer: Fixed loading some plugins when using configure
    --without-shared-libs.


M	src/indexer/Makefile.am

2011-07-22 13:09:14 +0300 Timo Sirainen <tss@iki.fi> (d616fa4)

    indexer: Send OK reply to client with the given tag.


M	src/indexer/indexer-client.c

2011-07-22 13:08:39 +0300 Timo Sirainen <tss@iki.fi> (71dc24a)

    indexer: When worker disconnects, forget which user it was attached to. This
    fixes an assert crash.


M	src/indexer/worker-connection.c

2011-07-12 09:59:34 +0300 Timo Sirainen <tss@iki.fi> (dbffb9e)

    lib-lda: Do INBOX GUID deduplication based on mailbox GUID, not username.
    This should be a bit more reliable.


M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h

2011-07-12 09:58:29 +0300 Timo Sirainen <tss@iki.fi> (4397845)

    lib-mail: Make a mail_guid_128_t typedef.


M	src/lib-mail/mail-types.h

2011-07-02 07:08:26 +0300 Timo Sirainen <tss@iki.fi> (013a0e0)

    lib-storage: Renamed mail_search_arg.not to match_not. C++ compilers don't
    like the "not".


M	src/doveadm/doveadm-mail-list-iter.c
M	src/imap/imap-search-args.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h
M	src/plugins/fts/fts-search.c

2011-07-02 05:40:54 +0300 Timo Sirainen <tss@iki.fi> (89a2b89)

    lib-storage: Made mailbox_list_mkdir_root() public


M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.h

2011-07-02 05:38:45 +0300 Timo Sirainen <tss@iki.fi> (be110f0)

    lib-storage: mkdir APIs changed.


M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-backend-vfile-acllist.c

2011-06-30 08:54:04 +0300 Timo Sirainen <tss@iki.fi> (6b636dc)

    Fixed compiling ldap/sql/gssapi plugins. I couldn't figure out any way to
    disable NOPLUGIN_FLAGS only for those plugins, so those flags are now always
    disabled for lib-sql library and auth binaries.


M	src/auth/Makefile.am
M	src/lib-sql/Makefile.am

2011-06-30 08:35:43 +0300 Timo Sirainen <tss@iki.fi> (461c2a4)

    lmtp: Error message update


M	src/lmtp/client.c

2011-06-30 08:34:28 +0300 Timo Sirainen <tss@iki.fi> (41dbc52)

    lmtp client: Do corking when sending message data.


M	src/lib-lda/lmtp-client.c

2011-06-30 08:27:32 +0300 Timo Sirainen <tss@iki.fi> (ed45903)

    lmtp: Log the current state in disconnect message.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2011-06-30 08:00:07 +0300 Timo Sirainen <tss@iki.fi> (e30b9e0)

    lib-storage: Fixed /chroot/./home style chrooting from userdb home.


M	src/lib-storage/mail-storage-service.c

2011-06-30 07:26:01 +0300 Timo Sirainen <tss@iki.fi> (90a2e26)

    liblib: Don't try to send a log prefix to log process if there is none.


M	src/lib/failures.c

2011-06-29 22:03:24 +0300 Timo Sirainen <tss@iki.fi> (4bbaac4)

    imapc: Fixed previous UID EXPUNGE fix.


M	src/lib-storage/index/imapc/imapc-sync.c

2011-06-29 12:34:53 +0300 Timo Sirainen <tss@iki.fi> (7d6f8d2)

    imapc: Fixed using UID EXPUNGE for multiple messages


M	src/lib-storage/index/imapc/imapc-sync.c

2011-06-28 03:59:26 +0300 Timo Sirainen <tss@iki.fi> (db4cad7)

    doveadm: Fixed displaying output when using -A or -u wildcards.


M	src/doveadm/doveadm-mail-server.c

2011-06-28 03:31:22 +0300 Timo Sirainen <tss@iki.fi> (674b589)

    doveadm acl: Updated usage string.


M	src/plugins/acl/doveadm-acl.c

2011-06-28 02:49:46 +0300 Timo Sirainen <tss@iki.fi> (7af5f78)

    lib-storage: Changed userdb +key=value to key+=value


M	src/lib-storage/mail-storage-service.c

2011-06-28 02:41:06 +0300 Timo Sirainen <tss@iki.fi> (f21c135)

    lib-lda: waitpid() for executed sendmail binary wasn't called correctly. It
    may have failed with -ECHILD, if the sendmail binary itself forked other
    processes.


M	src/lib-lda/smtp-client.c

2011-06-28 02:31:12 +0300 Timo Sirainen <tss@iki.fi> (c84c3db)

    imap: Don't crash if mailbox UIDVALIDITY is zero when SELECTing a mailbox.


M	src/imap/cmd-select.c

2011-06-28 02:23:10 +0300 Timo Sirainen <tss@iki.fi> (4669fc2)

    mdbox: Minor code cleanup.


M	src/lib-storage/index/dbox-multi/mdbox-mail.c

2011-06-28 02:22:58 +0300 Timo Sirainen <tss@iki.fi> (e790c9b)

    mdbox: Log an error if uidvalidity=0 unexpectedly.


M	src/lib-storage/index/dbox-multi/mdbox-sync.c

2011-06-27 23:48:06 +0300 Timo Sirainen <tss@iki.fi> (de11cf4)

    fts: Replaced unnecessary lock()/unlock() from API with refresh()


M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/fts-solr-plugin.h
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-trie.h
M	src/plugins/fts/fts-api-private.h
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-api.h
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.h

2011-06-27 23:40:13 +0300 Timo Sirainen <tss@iki.fi> (991c176)

    fts: Removed the separation of "substring" and "fast" fts backends and
    search keys. No one wants to use two separate backends and it just makes the
    code more difficult.


M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/fts/fts-storage.h

2011-06-27 23:03:00 +0300 Timo Sirainen <tss@iki.fi> (6c00502)

    doveadm index: Added -q option to do indexing via the new indexer service.


M	src/doveadm/doveadm-mail-index.c

2011-06-27 23:02:40 +0300 Timo Sirainen <tss@iki.fi> (d9e4041)

    Added "indexer" service, which uses worker processes to perform queued
    mailbox indexing. Only a single worker process will index the same user at
    the same time. This avoids lock waits, especially when doing full text
    search indexing with backends that require locking.


M	.hgignore
M	configure.in
M	src/Makefile.am
A	src/indexer/Makefile.am
A	src/indexer/indexer-client.c
A	src/indexer/indexer-client.h
A	src/indexer/indexer-queue.c
A	src/indexer/indexer-queue.h
A	src/indexer/indexer-settings.c
A	src/indexer/indexer-worker-settings.c
A	src/indexer/indexer-worker.c
A	src/indexer/indexer.c
A	src/indexer/indexer.h
A	src/indexer/master-connection.c
A	src/indexer/master-connection.h
A	src/indexer/worker-connection.c
A	src/indexer/worker-connection.h
A	src/indexer/worker-pool.c
A	src/indexer/worker-pool.h

2011-06-27 22:58:49 +0300 Timo Sirainen <tss@iki.fi> (8d85926)

    liblib: Added [tp]_strsplit_tabescaped()


M	src/lib/strescape.c
M	src/lib/strescape.h

2011-06-27 22:58:31 +0300 Timo Sirainen <tss@iki.fi> (ccf5066)

    lib-master: Added master_service_set_idle_die_callback()


M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2011-06-27 22:57:56 +0300 Timo Sirainen <tss@iki.fi> (1ffb2af)

    master process now tells its children their service's process_limit.


M	src/lib-master/master-interface.h
M	src/lib-master/master-service-private.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/master/service-process.c

2011-06-26 19:34:00 +0300 Timo Sirainen <tss@iki.fi> (437a8b0)

    Merged changes from v2.0 tree.


2011-06-26 19:11:52 +0300 Timo Sirainen <tss@iki.fi> (45d178e)

    doveadm: Minor code cleanup


M	src/doveadm/doveadm-mail-index.c

2011-06-23 20:00:16 +0300 Timo Sirainen <tss@iki.fi> (bf37278)

    lib-storage: Error message fix.


M	src/lib-storage/mail-storage.c

2011-06-23 20:00:04 +0300 Timo Sirainen <tss@iki.fi> (90ed6f2)

    lib-storage: Treat "INBOX" in INBOX/children also case-insensitively.


M	src/lib-storage/mail-storage.c

2011-06-22 20:26:24 +0300 Timo Sirainen <tss@iki.fi> (1f5597b)

    lib-storage: Fixed +key=value support to actually work.


M	src/lib-storage/mail-storage-service.c

2011-06-22 20:16:16 +0300 Timo Sirainen <tss@iki.fi> (0854144)

    lib-storage: MAILBOX_SYNC_FLAG_PRECACHE did nothing when mail_debug=yes


M	src/lib-storage/index/index-sync.c

2011-06-16 16:37:42 +0300 Timo Sirainen <tss@iki.fi> (dea0117)

    ssl-params: Make sure we don't leak a timeout.


M	src/ssl-params/main.c

2011-06-14 16:59:57 +0300 Timo Sirainen <tss@iki.fi> (64b61cd)

    Moved the main functionality from "doveadm index" to
    MAILBOX_SYNC_FLAG_PRECACHE This also allows plugins to hook into the sync
    and implement their own precaching easily. fts indexing is now done this way
    rather than kludging.


M	src/doveadm/doveadm-mail-index.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/plugins/fts/fts-storage.c

2011-06-14 16:28:55 +0300 Timo Sirainen <tss@iki.fi> (7375615)

    Merged changes from v2.0 tree.


2011-06-13 17:17:59 +0300 Timo Sirainen <tss@iki.fi> (e5b06a2)

    lmtp: Fixed parsing quoted strings with spaces as local-part for MAIL FROM
    and RCPT TO.


M	src/lmtp/commands.c

2011-06-10 19:11:00 +0300 Timo Sirainen <tss@iki.fi> (d998335)

    lib-storage: When "Recent flags state corrupted" happens, avoid
    assert-crashing afterwards.


M	src/lib-storage/index/index-sync.c

2011-06-08 16:05:32 +0300 Timo Sirainen <tss@iki.fi> (47569a4)

    lib-storage: Allow appending to existing settings via userdb extra fields.
    "foo=bar" replaces the setting, while "+foo=bar" appends to the setting.


M	src/lib-storage/mail-storage-service.c

2011-06-08 16:04:35 +0300 Timo Sirainen <tss@iki.fi> (19ac3ae)

    vpopmail: Fixed opening SMTP relays. Also don't even try to open IPv6
    relays, since vpopmail becomes an open relay then. Based on patch by Matt
    Brookings.


M	src/auth/passdb-vpopmail.c

2011-06-07 16:17:25 +0300 Timo Sirainen <tss@iki.fi> (062ea54)

    auth_username_format default changed to %Lu


M	NEWS
M	src/auth/auth-settings.c

2011-06-07 16:12:13 +0300 Timo Sirainen <tss@iki.fi> (b00c511)

    lib-storage: Fixed mail_chroot to work when process was already chrooted
    there.


M	src/lib-storage/mail-storage-service.c

2011-06-07 15:18:19 +0300 Timo Sirainen <tss@iki.fi> (8967669)

    ldap: Fixed random assert-crashing with with sasl_bind=yes.


M	src/auth/db-ldap.c

2011-06-06 18:26:45 +0300 Timo Sirainen <tss@iki.fi> (5512d42)

    Use SA_RESTART flag for signals wherever possible. Only SIGTERM (and SIGINT
    for standalone programs) shouldn't use it.


M	src/auth/auth-cache.c
M	src/auth/mech-winbind.c
M	src/doveadm/doveadm-mail.c
M	src/lib-master/master-service.c
M	src/lib/child-wait.c
M	src/log/main.c
M	src/master/main.c
M	src/ssl-params/main.c
M	src/util/maildirlock.c

2011-06-06 18:25:52 +0300 Timo Sirainen <tss@iki.fi> (72d404a)

    lib_signals_set_handler(): Changed API to take flags instead of boolean.
    This is still compatible with the old API, because using FALSE/TRUE as the
    flags still maps to the same behavior.


M	src/lib/lib-signals.c
M	src/lib/lib-signals.h

2011-06-06 18:06:22 +0300 Timo Sirainen <tss@iki.fi> (b65c424)

    lib-signals: Removed unnecessary code.


M	src/lib/lib-signals.c

2011-06-03 18:54:27 +0300 Timo Sirainen <tss@iki.fi> (49d3d89)

    script-login: When not using "-d" parameter, don't do unnecessary config
    lookup.


M	src/util/script-login.c

2011-06-03 18:11:00 +0300 Timo Sirainen <tss@iki.fi> (376ed81)

    doveadm acl debug: Show also path to mailbox if it doens't exist.


M	src/plugins/acl/doveadm-acl.c

2011-06-03 17:37:25 +0300 Timo Sirainen <tss@iki.fi> (c4fb8b3)

    master: Fail at startup if default_login_user or default_internal_user
    doesn't exist.


M	src/config/settings-get.pl
M	src/master/master-settings.c

2011-06-03 17:22:09 +0300 Timo Sirainen <tss@iki.fi> (a497e8b)

    eacces_get_error(): Give even better error message for directory permission
    errors.


M	src/lib/eacces-error.c

2011-06-03 17:13:59 +0300 Timo Sirainen <tss@iki.fi> (80b837e)

    eaccess_get_error(): Show also directory mode.


M	src/lib/eacces-error.c

2011-06-03 17:07:37 +0300 Timo Sirainen <tss@iki.fi> (37c4359)

    eaccess_get_error(): Fixes to reporting dir permissions. Also fixed an
    infinite loop if stat("/") fails.


M	src/lib/eacces-error.c

2011-06-03 16:40:03 +0300 Timo Sirainen <tss@iki.fi> (24e8fee)

    IMAP: Treat also "inbox/" case-insensitively as invalid mailbox name.


M	src/imap/imap-commands-util.c

2011-06-03 16:33:43 +0300 Timo Sirainen <tss@iki.fi> (a4e30ea)

    IMAP: Treat "namespace prefix/" as invalid mailbox name.


M	src/imap/imap-commands-util.c

2011-06-03 16:27:41 +0300 Timo Sirainen <tss@iki.fi> (94d509e)

    lib-storage: Treat "namespace prefix/" as invalid mailbox name.


M	src/lib-storage/mail-storage.c

2011-06-03 15:49:50 +0300 Timo Sirainen <tss@iki.fi> (dea871a)

    .hgignore updated


M	.hgignore

2011-06-03 15:49:30 +0300 Timo Sirainen <tss@iki.fi> (373734a)

    Compiler warning fix.


M	src/director/director-connection.c

2011-06-03 15:27:21 +0300 Timo Sirainen <tss@iki.fi> (66fff40)

    doveadm -A: Crashfix for doveadm server when using commands that print
    nothing.


M	src/doveadm/doveadm-print.c

2011-05-31 15:38:03 +0300 Timo Sirainen <tss@iki.fi> (9b6eb5a)

    fts-lucene: Fixes to work with CLucene v2.3.3.4 and new FTS API. It's still
    not recommended to actually use this.


M	src/plugins/fts-lucene/Makefile.am
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/lucene-wrapper.cc

2011-05-31 15:36:22 +0300 Timo Sirainen <tss@iki.fi> (c6ead31)

    liblib: Added uni_utf8_to_ucs4_n().


M	src/lib/unichar.c
M	src/lib/unichar.h

2011-05-24 20:06:24 +0300 Timo Sirainen <tss@iki.fi> (ac11188)

    doveadm proxy: s/kill/kick/ and related internal code changes. Mainly for
    consistency, because "doveadm kick" already existed.


M	src/director/director.c
M	src/doveadm/doveadm-proxy.c
M	src/login-common/login-proxy.c

2011-05-23 16:26:21 +0300 Timo Sirainen <tss@iki.fi> (90da9c1)

    configure: Added missing ipc


M	configure.in

2011-05-23 16:12:44 +0300 Timo Sirainen <tss@iki.fi> (b59960a)

    lib-storage: Export a list of permanent flags via mailbox_status(). Removed
    mailbox_allow_new_keywords(), since it's now included in the status
    structure. ACL plugin may limit what flags are permanent according to ACLs.


M	src/imap/imap-commands-util.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/virtual/virtual-storage.c

2011-05-23 15:47:27 +0300 Timo Sirainen <tss@iki.fi> (d0b929d)

    doveadm: Compile fix for recent auth change.


M	src/doveadm/doveadm-pw.c

2011-05-23 15:45:44 +0300 Timo Sirainen <tss@iki.fi> (026be73)

    acl: ACLs apply to private flags as well. Fixed returning READ-ONLY
    resp-code.


M	src/plugins/acl/acl-mailbox.c

2011-05-23 15:38:16 +0300 Timo Sirainen <tss@iki.fi> (06d948c)

    auth: Don't log warnings/errors when guessing a password's scheme.


M	src/auth/password-scheme-otp.c
M	src/auth/password-scheme.c
M	src/auth/password-scheme.h

2011-05-23 15:37:43 +0300 Timo Sirainen <tss@iki.fi> (31e557d)

    auth: Give password scheme suggestions also when passdb data is invalid for
    scheme.


M	src/auth/auth-request.c

2011-05-23 15:05:13 +0300 Timo Sirainen <tss@iki.fi> (5411e6f)

    director: Changed the "user killed" delay from 12 secs to 2 secs. It was 12
    secs only for testing.


M	src/director/director.c

2011-05-23 15:04:36 +0300 Timo Sirainen <tss@iki.fi> (eef20a5)

    ipc: Fixes when sending commands to an empty group.


M	src/ipc/client.c
M	src/ipc/ipc-group.c
M	src/ipc/ipc-group.h

2011-05-23 14:54:02 +0300 Timo Sirainen <tss@iki.fi> (15ab245)

    director: Added support for moving user to another server with "doveadm
    director move".


M	src/director/director-connection.c
M	src/director/director-request.c
M	src/director/director-test.sh
M	src/director/director.c
M	src/director/director.h
M	src/director/doveadm-connection.c
M	src/director/user-directory.c
M	src/director/user-directory.h
M	src/doveadm/doveadm-director.c
M	src/login-common/login-proxy.c

2011-05-20 21:46:32 +0300 Timo Sirainen <tss@iki.fi> (4bd6702)

    message header parser: Allow NULs in header name also when header is missing
    ':'. This doesn't fix any crashes/corruption unlike the earlier fix, but it
    makes the code more correct. Although it might help with mbox rewriting
    seeing some size mismatches (or might not).


M	src/lib-mail/message-header-parser.c

2011-05-20 19:54:57 +0300 Timo Sirainen <tss@iki.fi> (f56e93c)

    login proxy: Show in disconnect reason who did the disconnection and
    possible error.


M	src/login-common/login-proxy.c

2011-05-20 18:47:26 +0300 Timo Sirainen <tss@iki.fi> (02aedbc)

    doveadm: Added "proxy list" and "proxy kill" commands.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-proxy.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h

2011-05-20 18:47:02 +0300 Timo Sirainen <tss@iki.fi> (833820f)

    login proxy: Connect to IPC server and implement KILL and LIST commands.


M	src/login-common/login-proxy.c

2011-05-20 18:45:29 +0300 Timo Sirainen <tss@iki.fi> (83942ac)

    Added support for a simplified IPC infrastructure. The idea is that you have
    one "ipc" proxy process, where all server processes connect to. IPC clients
    can then connect to the proxy and ask it to forward commands to either a
    specific server or all servers. The proxy does this, and forwards back any
    replies from the server.


M	src/Makefile.am
A	src/ipc/Makefile.am
A	src/ipc/client.c
A	src/ipc/client.h
A	src/ipc/ipc-connection.c
A	src/ipc/ipc-connection.h
A	src/ipc/ipc-group.c
A	src/ipc/ipc-group.h
A	src/ipc/ipc-settings.c
A	src/ipc/main.c
M	src/lib-master/Makefile.am
A	src/lib-master/ipc-client.c
A	src/lib-master/ipc-client.h
A	src/lib-master/ipc-server.c
A	src/lib-master/ipc-server.h

2011-05-20 14:21:51 +0300 Timo Sirainen <tss@iki.fi> (f07f57d)

    doveadm: Added doveadm_allowed_commands setting, which is used by doveadm
    server.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h

2011-05-20 14:20:46 +0300 Timo Sirainen <tss@iki.fi> (584c790)

    doveadm server: Fixed running multiple commands without crashing.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail-server.c

2011-05-20 14:08:43 +0300 Timo Sirainen <tss@iki.fi> (72bc081)

    doveadm: Added support for using local/remote {} settings.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2011-05-20 13:30:40 +0300 Timo Sirainen <tss@iki.fi> (d472804)

    doveadm: Added simple PLAIN authentication for remote connections. Currently
    clients are required to use "doveadm" as the username and the password must
    match doveadm_password setting. When using doveadm as a client, it
    automatically uses these settings when connecting to remote servers.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/server-connection.c

2011-05-20 13:05:16 +0300 Timo Sirainen <tss@iki.fi> (67cc1d2)

    doveadm: Added doveadm_proxy_port setting to make it work with proxying.


M	src/doveadm/Makefile.am
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/main.c

2011-05-20 13:03:34 +0300 Timo Sirainen <tss@iki.fi> (66ed2ab)

    doveadm: Set service=doveadm for userdb lookup.


M	src/doveadm/doveadm-mail.c

2011-05-16 17:34:42 +0300 Timo Sirainen <tss@iki.fi> (01758d8)

    pop3: If mail storage couldn't be initialized, send -ERR to client before
    disconnecting.


M	src/pop3/main.c

2011-05-16 17:29:40 +0300 Timo Sirainen <tss@iki.fi> (3cde0cc)

    pop3: Add [IN-USE] to all login -ERR replies.


M	src/pop3/pop3-client.c

2011-05-16 17:06:11 +0300 Timo Sirainen <tss@iki.fi> (33efc95)

    imap: Changed default imap_logout_format.


M	src/imap/imap-settings.c

2011-05-16 17:02:56 +0300 Timo Sirainen <tss@iki.fi> (d916e67)

    imap: If client disconnects in APPEND, log more about what it did before
    that.


M	src/imap/cmd-append.c

2011-05-16 15:53:13 +0300 Timo Sirainen <tss@iki.fi> (00b6a40)

    Compiler warning fix on 32bit systems. Patch by Mike Abbott / Apple


M	src/director/user-directory.c

2011-05-11 21:46:56 +0000 Pascal Volk <user@localhost.localdomain.org> (a66800c)

    man: Corrected cmd name in doveadm-index.1.


M	doc/man/doveadm-index.1.in

2011-05-11 23:32:26 +0300 Timo Sirainen <tss@iki.fi> (2d193dc)

    lib-storage: Fixed checking if mail's virtual size is cached.


M	src/lib-storage/index/index-mail.c

2011-05-11 23:24:41 +0300 Timo Sirainen <tss@iki.fi> (a543ac6)

    imapc: Fix for 32bit systems.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-05-11 22:34:27 +0300 Timo Sirainen <tss@iki.fi> (ec1fe00)

    doveadm: doveadm_mail_iter_init() API change to fix "doveadm fetch" crash.


M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-iter.h

2011-05-11 22:33:55 +0300 Timo Sirainen <tss@iki.fi> (0027dcd)

    doveadm search crashfix


M	src/doveadm/doveadm-mail-search.c

2011-05-11 22:29:48 +0300 Timo Sirainen <tss@iki.fi> (b3feec9)

    Compiler warning fixes


M	src/lib-storage/list/index-mailbox-list.c

2011-05-11 18:49:44 +0300 Timo Sirainen <tss@iki.fi> (d9866db)

    doveadm: Code correctness fix.


M	src/doveadm/doveadm-mail-index.c

2011-05-11 17:59:59 +0300 Timo Sirainen <tss@iki.fi> (3acfd3a)

    Added signature for changeset aa8dfa085a99


M	.hgsigs

2011-05-11 17:59:56 +0300 Timo Sirainen <tss@iki.fi> (2e6d6c0)

    Added tag 2.0.13 for changeset aa8dfa085a99


M	.hgtags

2011-05-11 17:59:56 +0300 Timo Sirainen <tss@iki.fi> (ba130dc)

    Released v2.0.13.


M	NEWS
M	configure.in

2011-05-11 17:56:25 +0300 Timo Sirainen <tss@iki.fi> (ed1ad90)

    man: Added doveadm index.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-index.1.in
M	doc/man/doveadm.1.in

2011-05-11 17:45:03 +0300 Timo Sirainen <tss@iki.fi> (bafecba)

    man: Added doveadm director dump.


M	doc/man/doveadm-director.1.in

2011-05-11 17:00:08 +0300 Timo Sirainen <tss@iki.fi> (4f8cc3d)

    Increased highest signal number limit. HP-UX can use at least 44.


M	src/lib/lib-signals.c

2011-05-11 16:58:07 +0300 Timo Sirainen <tss@iki.fi> (6a9ecc6)

    Compile fix for HP-UX


M	src/lib/compat.h

2011-05-11 16:28:32 +0300 Timo Sirainen <tss@iki.fi> (e923596)

    example-config: Updated auth_krb5_keytab comment.


M	doc/example-config/conf.d/10-auth.conf

2011-05-11 16:20:15 +0300 Timo Sirainen <tss@iki.fi> (e4ff3c7)

    config: Updated obsolete protocol warning messages.


M	src/config/old-set-parser.c

2011-05-11 15:57:47 +0300 Timo Sirainen <tss@iki.fi> (b75feeb)

    director: Avoid potential problems by making sure users list is always
    sorted by timestamp.


M	src/director/user-directory.c

2011-05-11 15:35:20 +0300 Timo Sirainen <tss@iki.fi> (317beb7)

    man: Updated doveconf.


M	doc/man/doveconf.1.in

2011-05-11 15:20:19 +0300 Timo Sirainen <tss@iki.fi> (ec02103)

    fts: Added assert to make sure all header data is valid UTF-8.


M	src/plugins/fts/fts-storage.c

2011-05-11 15:19:34 +0300 Timo Sirainen <tss@iki.fi> (b516a78)

    message [header] decoder: Output only valid UTF-8 data.


M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c

2011-05-11 15:17:02 +0300 Timo Sirainen <tss@iki.fi> (200500e)

    message header parser: Fixed handling NUL characters in header names.
    line->name_len was too large and line->middle pointer may have pointed past
    allocated memory.  These may have caused crashes/corruption (fts, mbox at
    least).


M	src/lib-mail/message-header-parser.c

2011-05-11 14:35:15 +0300 Timo Sirainen <tss@iki.fi> (5b969a1)

    lda: Log destination address and its source with mail_debug=yes


M	src/lda/main.c

2011-05-11 14:24:18 +0300 Timo Sirainen <tss@iki.fi> (5292200)

    example-config: Updated auth_gssapi_hostname comment.


M	doc/example-config/conf.d/10-auth.conf

2011-05-10 18:24:31 +0300 Timo Sirainen <tss@iki.fi> (36a6564)

    zlib: Don't unnecessarily reset istream caches.


M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c

2011-05-10 18:19:35 +0300 Timo Sirainen <tss@iki.fi> (e34eee5)

    istream-[b]zlib: stat(exact=FALSE) should always return the same value if
    file hasn't changed.


M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c

2011-05-10 17:55:27 +0300 Timo Sirainen <tss@iki.fi> (36b4022)

    doveadm mailbox status: Don't assert-crash at exit if syncing a mailbox
    fails.


M	src/doveadm/doveadm-mail.c

2011-05-10 17:46:50 +0300 Timo Sirainen <tss@iki.fi> (9d7718a)

    acl: Don't waste time doing ACL checks for IMAP LSUB command.


M	src/plugins/acl/acl-mailbox-list.c

2011-05-10 01:24:34 +0300 Timo Sirainen <tss@iki.fi> (a04a1ea)

    Removed ssl_parameters_file setting. It wasn't used by anything.


M	src/login-common/login-settings.c
M	src/login-common/login-settings.h

2011-05-09 20:11:00 +0300 Timo Sirainen <tss@iki.fi> (3449615)

    script-login: When -d isn't given, drop privileges as specified by the
    service settings.


M	src/util/script-login.c

2011-05-09 20:03:24 +0300 Timo Sirainen <tss@iki.fi> (11eee34)

    script-login: Reverted last change.


M	src/util/script-login.c

2011-05-09 19:59:21 +0300 Timo Sirainen <tss@iki.fi> (05aad80)

    script-login: Changed default behavior to be to drop privileges. Also since
    the default is to run as root, allow that. There is now "-n" parameter to
    avoid dropping privileges.


M	src/util/script-login.c

2011-05-09 19:28:27 +0300 Timo Sirainen <tss@iki.fi> (e586724)

    Minor typofix.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.h

2011-05-09 19:25:44 +0300 Timo Sirainen <tss@iki.fi> (a35ebc4)

    lib-settings: Crashfix for broken settings under strlist.


M	src/lib-settings/settings-parser.c

2011-05-09 19:08:43 +0300 Timo Sirainen <tss@iki.fi> (d779da0)

    auth: Added assert.


M	src/auth/db-ldap.c

2011-05-09 18:43:35 +0300 Timo Sirainen <tss@iki.fi> (6a6c640)

    master: Warn if service's vsz_limit < 1 MB It's unlikely anyone wants it to
    be smaller, and small values give random errors/crashes.


M	src/master/master-settings.c

2011-05-09 18:23:23 +0300 Timo Sirainen <tss@iki.fi> (d5b66e8)

    imap: RENAME and DELETE wasn't replying with NONEXISTENT resp code.


M	src/imap/cmd-delete.c
M	src/imap/cmd-rename.c

2011-05-09 17:58:37 +0300 Timo Sirainen <tss@iki.fi> (b9b086b)

    lib-storage: Fixed LIST/LSUB with LAYOUT=none. It shouldn't have listed
    INBOX if it didn't match the given patterns.


M	src/lib-storage/list/mailbox-list-none.c

2011-05-09 17:41:45 +0300 Timo Sirainen <tss@iki.fi> (16dfe1f)

    lmtp: With lmtp_save_to_detail_mailbox=yes, save mail to <inbox ns
    prefix>detail. The previous behavior required using prefix="" namespace to
    work.


M	src/lmtp/commands.c

2011-05-05 18:13:55 +0200 Timo Sirainen <tss@iki.fi> (643a81f)

    doveadm: Added "index" command to add unindexed messages into
    index/cache/fts. The caching adds only the fields that were previously added
    to the mailbox's caching decisions, so it won't do anything useful for
    mailboxes that user's client hasn't accessed yet.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-mail-index.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2011-05-05 17:49:45 +0200 Timo Sirainen <tss@iki.fi> (c7e1482)

    lib-storage: Added mail_parse().


M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c
M	src/lib-storage/test-mail.c
M	src/plugins/virtual/virtual-mail.c

2011-05-05 17:48:55 +0200 Timo Sirainen <tss@iki.fi> (7370fb9)

    lib-storage: Added mail_is_cached()


M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mail.c

2011-05-05 17:47:58 +0200 Timo Sirainen <tss@iki.fi> (5881624)

    lib-index: Added mail_cache_field_exists_any()


M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache.h

2011-05-04 15:03:14 +0200 Timo Sirainen <tss@iki.fi> (dd6e81b)

    doveadm user: Added -f parameter to show only the specified extra field's
    value.


M	src/doveadm/doveadm-auth.c

2011-05-04 14:58:03 +0200 Timo Sirainen <tss@iki.fi> (723c066)

    doveadm cleanup: Don't try to keep auth/user comand handlers in same
    function.


M	src/doveadm/doveadm-auth.c

2011-05-04 11:43:59 +0200 Timo Sirainen <tss@iki.fi> (1045d05)

    pop3: Added support for showing messages in "pop3 order".


M	src/pop3/pop3-client.c
M	src/pop3/pop3-client.h
M	src/pop3/pop3-commands.c

2011-05-04 11:43:16 +0200 Timo Sirainen <tss@iki.fi> (1f47e47)

    lib-storage: Added MAIL_SORT_POP3_ORDER


M	src/lib-storage/index/index-sort.c
M	src/lib-storage/mail-storage.h

2011-05-04 11:42:17 +0200 Timo Sirainen <tss@iki.fi> (e1eeb3b)

    lib-storage: Added MAIL_FETCH_POP3_ORDER special field and implemented for
    Maildir. The idea is that this specifies the order of messages when
    accessing via POP3. This is useful when migrating both POP3 and IMAP users
    from servers where their message ordering differes and they still want to be
    preserved.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-uidlist.h
M	src/lib-storage/mail-storage.h

2011-05-04 10:17:27 +0200 Timo Sirainen <tss@iki.fi> (766f20f)

    pop3: Small code cleanup.


M	src/pop3/pop3-client.h
M	src/pop3/pop3-commands.c

2011-05-03 18:41:10 +0200 Timo Sirainen <tss@iki.fi> (8b16d3b)

    doveadm: Added "director dump" command. It outputs doveadm director commands
    to add/remove the current host configuration, so if all directors are
    stopped, their state can be easily restored by running the commands.


M	src/director/doveadm-connection.c
M	src/doveadm/doveadm-director.c

2011-05-03 09:58:11 +0200 Timo Sirainen <tss@iki.fi> (0f4f40b)

    lib-index: Try to avoid duplicate "duplicate transaction log sequence"
    errors.


M	src/lib-index/mail-transaction-log-file.c

2011-05-03 09:43:41 +0200 Timo Sirainen <tss@iki.fi> (39f78d7)

    lib-storage: Remove invalid subscription file entries instead of only
    ignoring them.


M	src/lib-storage/list/mailbox-list-subscriptions.c

2011-04-30 16:32:28 +0300 Timo Sirainen <tss@iki.fi> (100c33c)

    TODO updated


M	TODO

2011-04-30 16:24:42 +0300 Timo Sirainen <tss@iki.fi> (3df398a)

    Merged changes from v2.0 tree.


2011-04-30 15:55:08 +0300 Timo Sirainen <tss@iki.fi> (7e1b549)

    sdbox: In-memory mailbox GUID differed from on-index GUID after
    mailbox_create().


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2011-04-30 15:12:20 +0300 Timo Sirainen <tss@iki.fi> (0b25846)

    lib-storage: mailbox_delete() for a symlink now removes the symlink instead
    of expunging mails.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-delete.h
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2011-04-30 15:00:42 +0300 Timo Sirainen <tss@iki.fi> (af9eddd)

    lib-storage: mailbox_delete() now always first expunges all mails before
    trying deletion. If any new mails are added during expunging, the mailbox
    deletion fails. This behavior allows removing basically duplicated code
    where this is done for mdbox, sdbox with external attachments, quota updates
    and lazy-expunge.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/quota/quota-storage.c

2011-04-30 14:54:16 +0300 Timo Sirainen <tss@iki.fi> (3aa40b5)

    mdbox: Fixed storage rebuild


M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c

2011-04-30 14:20:30 +0300 Timo Sirainen <tss@iki.fi> (d6c00d7)

    lazy-expunge: Removed support for more than one lazy-expunge namespace. More
    than one is conceptually difficult to understand, complicates the code and
    after the next change it wouldn't even work anymore.


M	src/plugins/lazy-expunge/lazy-expunge-plugin.c

2011-04-30 13:41:18 +0300 Timo Sirainen <tss@iki.fi> (a966016)

    Use -Wl,--as-needed -Wl,--no-undefined GNU ld flags for non-plugins.


M	configure.in
M	src/plugins/acl/Makefile.am
M	src/plugins/autocreate/Makefile.am
M	src/plugins/expire/Makefile.am
M	src/plugins/fts-lucene/Makefile.am
M	src/plugins/fts-solr/Makefile.am
M	src/plugins/fts-squat/Makefile.am
M	src/plugins/fts/Makefile.am
M	src/plugins/imap-acl/Makefile.am
M	src/plugins/imap-quota/Makefile.am
M	src/plugins/imap-zlib/Makefile.am
M	src/plugins/lazy-expunge/Makefile.am
M	src/plugins/listescape/Makefile.am
M	src/plugins/mail-log/Makefile.am
M	src/plugins/notify/Makefile.am
M	src/plugins/quota/Makefile.am
M	src/plugins/snarf/Makefile.am
M	src/plugins/trash/Makefile.am
M	src/plugins/virtual/Makefile.am
M	src/plugins/zlib/Makefile.am

2011-04-30 13:38:20 +0300 Timo Sirainen <tss@iki.fi> (09d81c5)

    Compile fix for previous change.


M	src/lib-ssl-iostream/Makefile.am

2011-04-30 13:18:31 +0300 Timo Sirainen <tss@iki.fi> (5ec40a1)

    Makefile: Fixes to compiling with LDFLAGS="-Wl,--as-needed
    -Wl,--no-undefined"


M	src/lib-sql/Makefile.am
M	src/lib-ssl-iostream/Makefile.am
M	src/login-common/Makefile.am

2011-04-30 13:17:53 +0300 Timo Sirainen <tss@iki.fi> (5a25081)

    login-common API redesign so that the library doesn't refer to nonexistent
    variables.


M	src/imap-login/client.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/client-common.h
M	src/login-common/login-common.h
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/pop3-login/client.c

2011-04-29 19:10:52 +0300 Timo Sirainen <tss@iki.fi> (6ea8dfa)

    master: Increased max. listen() backlog 128 -> 511 (by copying Apache)


M	src/master/service-listen.c

2011-04-29 18:22:00 +0300 Timo Sirainen <tss@iki.fi> (c9ce71e)

    example-config: Removed plugin/mail_log_group_events since it no longer
    exists.


M	doc/example-config/conf.d/10-logging.conf

2011-04-28 21:31:16 +0300 Timo Sirainen <tss@iki.fi> (ced3c1f)

    dbox: If file can't be opened read-write, fallback to read-only.


M	src/lib-storage/index/dbox-common/dbox-file.c

2011-04-28 21:30:21 +0300 Timo Sirainen <tss@iki.fi> (94d5a3f)

    lib-index: If .log file can't be opened read-write, fallback to read-only
    indexes.


M	src/lib-index/mail-transaction-log-file.c

2011-04-28 21:11:30 +0300 Timo Sirainen <tss@iki.fi> (ce05b14)

    Compiler warning fix.


M	src/lib-settings/settings-parser.c

2011-04-28 21:11:23 +0300 Timo Sirainen <tss@iki.fi> (6b9c807)

    mdbox purge: Fixed warning about corrupted extrefs.


M	src/lib-storage/index/dbox-multi/mdbox-purge.c

2011-04-28 21:10:57 +0300 Timo Sirainen <tss@iki.fi> (e6aa82a)

    mbox: Looking up GUID/MD5(header) more than once was broken.


M	src/lib-storage/index/mbox/mbox-mail.c

2011-04-28 17:20:22 +0300 Timo Sirainen <tss@iki.fi> (65e4254)

    Compiler warning fixes about enums.


M	src/doveadm/doveadm-mail-altmove.c
M	src/lib-storage/index/index-sync-changes.c

2011-04-27 16:25:08 +0300 Timo Sirainen <tss@iki.fi> (1b85e6a)

    i_getgr*(): OpenBSD workaround.


M	src/lib/ipwd.c

2011-04-20 18:55:39 +0300 Timo Sirainen <tss@iki.fi> (66d7dd2)

    config: Avoid growing data stack / memory pools.


M	src/config/config-parser.c
M	src/config/doveconf.c

2011-04-20 18:55:17 +0300 Timo Sirainen <tss@iki.fi> (f637b33)

    doveconf: Fixed a broken "subsection has ssl=yes" warning.


M	src/config/config-parser.c

2011-04-20 18:28:49 +0300 Timo Sirainen <tss@iki.fi> (95fa94e)

    lib-lda: If deliver_log_format setting is empty, don't log anything. Patch
    by Joseph Tam.


M	src/lib-lda/mail-deliver.c

2011-04-20 17:58:03 +0300 Timo Sirainen <tss@iki.fi> (ac1c79d)

    maildir: Added asserts to make sure invalid extension records aren't written
    to uidlist.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2011-04-20 17:57:20 +0300 Timo Sirainen <tss@iki.fi> (df91692)

    maildir: Remove invalid extension records from dovecot-uidlist. For now
    we'll assume that if the key is outside A..Z it's invalid. Since only 4 keys
    are used currently, there is still a lot of letters available for future
    use.


M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-uidlist.h

2011-04-20 17:44:36 +0300 Timo Sirainen <tss@iki.fi> (ed34a21)

    maildir: If uidlist has an empty GUID entry, log an error and remove it.
    This fixes an assert-crash in dsync.


M	src/lib-storage/index/maildir/maildir-mail.c

2011-04-13 12:40:48 +0300 Timo Sirainen <tss@iki.fi> (3a6bc9a)

    doveconf: Added -S parameter to dump a simplified machine readable config.
    This should make it slightly easier for external programs/scripts to call
    doveconf and parse its output.


M	src/config/doveconf.c

2011-04-13 12:23:35 +0300 Timo Sirainen <tss@iki.fi> (6a865d4)

    config: Abort local/remote block DNS lookups after 30s and warn after 5s.


M	src/config/config-parser.c

2011-04-13 10:36:00 +0300 Timo Sirainen <tss@iki.fi> (60bdf7c)

    Compiling fix for Solaris.


M	src/lib/ipwd.c

2011-04-12 20:10:17 +0300 Timo Sirainen <tss@iki.fi> (288c572)

    Added signature for changeset 606faab2b896


M	.hgsigs

2011-04-12 20:10:14 +0300 Timo Sirainen <tss@iki.fi> (2a50cac)

    Added tag 2.0.12 for changeset 606faab2b896


M	.hgtags

2011-04-12 20:10:14 +0300 Timo Sirainen <tss@iki.fi> (10ef96a)

    Released v2.0.12.


M	NEWS
M	configure.in

2011-04-12 20:09:44 +0300 Timo Sirainen <tss@iki.fi> (85e7220)

    test-index-fetch unit test fixed.


M	src/lib-storage/index/test-index-fetch.c

2011-04-12 18:41:15 +0300 Timo Sirainen <tss@iki.fi> (ea0ab5d)

    sdbox: When rebuilding index, don't unnecessarily change mailbox's GUID.


M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c

2011-04-12 18:38:50 +0300 Timo Sirainen <tss@iki.fi> (0a7b04e)

    sdbox: If message file is unexpectedly lost, rebuild index.


M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.h

2011-04-12 18:38:00 +0300 Timo Sirainen <tss@iki.fi> (44fb324)

    sdbox: Commit expunges to index first before unlinking the files.


M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-sync.h

2011-04-12 17:55:26 +0300 Timo Sirainen <tss@iki.fi> (5096d15)

    mdbox: Fixed mail_get_save_date() returning wrong return value. This broke
    expire plugin.


M	src/lib-storage/index/dbox-multi/mdbox-mail.c

2011-04-12 17:13:27 +0300 Timo Sirainen <tss@iki.fi> (bd0720c)

    auth: Export/import auth_request->successful for auth workers.


M	src/auth/auth-request.c

2011-04-12 17:05:49 +0300 Timo Sirainen <tss@iki.fi> (3108862)

    auth: Removed max. request queue limit from LDAP. Old requests get dropped
    after 60 seconds, but other than that there is probably not much point in
    having a hard coded limit.


M	src/auth/db-ldap.c
M	src/auth/db-ldap.h

2011-04-10 13:54:06 +0300 Timo Sirainen <tss@iki.fi> (8d5c97b)

    lib-storage: Fixed crash in mail_storage_service_all_init() (doveadm .. -A)


M	src/lib-storage/mail-storage-service.c

2011-04-08 20:23:17 +0300 Timo Sirainen <tss@iki.fi> (447543b)

    imap-login: Reduced the max. number of allowed bad commands. This makes it
    even more sure that we won't reply with anything dangerous when attempting
    to access us with HTTP client.


M	src/imap-login/client.c

2011-04-08 20:21:58 +0300 Timo Sirainen <tss@iki.fi> (cc6807a)

    imap-login: Don't allow IMAP command tags that have invalid characters. This
    simply attempts to prevent HTTP requests from replying with any potentially
    danerous data that some web browsers might execute, e.g.:

    curl --request POST -F 'x="<script>alert(1)</script>"' http://localhost:143/

    The above command probably doesn't work, because max. bad commands is 
    reached earlier. But if it isn't, this change makes sure it doesn't return 
    back anything, because '"' and '(' aren't allowed characters. Even if '"' 
    weren't required, there hopefully isn't much to be done without being able 
    to call any functions.

M	src/imap-login/client.c

2011-04-08 19:50:31 +0300 Timo Sirainen <tss@iki.fi> (85da8c0)

    Linux NFS: fstat() may return ENOENT instead of ESTALE in some kernel
    versions.


M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mailbox-list-index.c
M	src/lib/compat.h

2011-04-08 19:36:51 +0300 Timo Sirainen <tss@iki.fi> (4e43828)

    director: Improved debug/error logging.


M	src/director/director-connection.c
M	src/director/director.c

2011-04-08 19:35:27 +0300 Timo Sirainen <tss@iki.fi> (4c20178)

    director: Reset hosts' last_failed timestamps when they're suspected to be
    working again. This should fix some problems during director removals and
    additions.


M	src/director/director-connection.c
M	src/director/director.c

2011-04-08 17:27:52 +0300 Timo Sirainen <tss@iki.fi> (7feee84)

    doveadm import: Initialize the import user properly.


M	src/doveadm/doveadm-mail-import.c

2011-04-08 17:26:49 +0300 Timo Sirainen <tss@iki.fi> (b9b8415)

    lib-storage: Allow each user lookup to override global
    mail_storage_service_flags.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2011-04-08 17:26:14 +0300 Timo Sirainen <tss@iki.fi> (d9250ee)

    lib-storage: Added mail_namespaces_init_location() for creating a single
    namespace for user.


M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h

2011-04-08 16:41:26 +0300 Timo Sirainen <tss@iki.fi> (6407c61)

    config: Log a warning if global ssl=no, but some section has
    ssl=yes/required. Actually supporting per-protocol (or even worse, per-ip)
    SSL would be too much trouble.


M	src/config/config-parser.c

2011-04-08 16:06:20 +0300 Timo Sirainen <tss@iki.fi> (0622f54)

    eperm_error_get_chgrp(): Changed wiki link.


M	src/lib/eacces-error.c

2011-04-08 16:05:03 +0300 Timo Sirainen <tss@iki.fi> (4a3e6e0)

    eperm_error_get_chgrp(): Improved error message and added a link to wiki.


M	src/lib/eacces-error.c

2011-04-08 15:47:34 +0300 Timo Sirainen <tss@iki.fi> (fc3197e)

    Updated main documentation.txt index.


M	doc/documentation.txt

2011-04-08 15:39:43 +0300 Timo Sirainen <tss@iki.fi> (0992011)

    Changed wiki.dovecot.org links to wiki2.dovecot.org


M	INSTALL
M	README
M	doc/documentation.txt
M	doc/example-config/dovecot-ldap.conf.ext
M	doc/example-config/dovecot-sql.conf.ext
M	doc/example-config/dovecot.conf
M	src/lda/main.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/mail-storage-service.c

2011-04-05 22:43:54 +0300 Timo Sirainen <tss@iki.fi> (513c370)

    sdbox: Added more error message logging.


M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c

2011-04-05 19:08:31 +0300 Timo Sirainen <tss@iki.fi> (a2aa37d)

    lib-index: Fix to previous check.


M	src/lib-index/mail-index-map.c

2011-04-05 19:07:01 +0300 Timo Sirainen <tss@iki.fi> (4ad2966)

    lib-index: Added extra checks against broken extension record introductions.


M	src/lib-index/mail-index-map.c

2011-04-05 13:26:45 +0300 Timo Sirainen <tss@iki.fi> (723c304)

    quota: Fixed the quota limit check changes in previous commit. Casting
    (uint64_t)-1 to (int64_t) isn't a good idea.


M	src/plugins/quota/quota.c

2011-04-05 12:44:21 +0300 Timo Sirainen <tss@iki.fi> (889437f)

    Changed auth-userdb socket's default permissions to 0666.


M	doc/example-config/conf.d/10-master.conf
M	src/auth/auth-settings.c

2011-04-05 12:28:32 +0300 Timo Sirainen <tss@iki.fi> (c95b7ce)

    auth: If auth-userdb socket is 0666, allow peer to do only USER lookups
    whose uid matches its. Anything else results in failure. If userdb doesn't
    return uid, the lookups also fail. To truly give full permissions for
    everyone, use 0777 mode.


M	src/auth/auth-master-connection.c
M	src/auth/auth-master-connection.h
M	src/auth/main.c

2011-04-05 12:24:59 +0300 Timo Sirainen <tss@iki.fi> (e2aabdc)

    Added net_getunixcred() to get UNIX socket peer process's UID and GID.


M	configure.in
M	src/lib/network.c
M	src/lib/network.h

2011-04-04 23:19:01 +0300 Timo Sirainen <tss@iki.fi> (30ad2b0)

    quota: Code cleanup.


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2011-04-04 23:18:31 +0300 Timo Sirainen <tss@iki.fi> (c1838f0)

    quota: Fixed checking message count limit when saving multiple mails in
    transaction.


M	src/plugins/quota/quota.c

2011-04-04 23:07:37 +0300 Timo Sirainen <tss@iki.fi> (64529e3)

    quota: Set quota limit correctly (for code path that doesn't exist).
    quota_alloc() followed by quota_test/try_alloc() set the "quota left" limit
    wrong. But this is only a theoretical problem, because nothing actually
    calls quota_alloc() currently.


M	src/plugins/quota/quota.c

2011-04-04 19:20:20 +0300 Timo Sirainen <tss@iki.fi> (1694d84)

    dbox: External attachment's size was set wrong if base64 MIME part ended
    unexpectedly.


M	src/lib-storage/index/index-attachment.c

2011-04-04 17:53:05 +0300 Timo Sirainen <tss@iki.fi> (2d0a002)

    auth: If initial binding to LDAP server hangs, detect it and abort.


M	src/auth/db-ldap.c

2011-04-04 16:08:50 +0300 Timo Sirainen <tss@iki.fi> (cf1f697)

    lib-storage: Request sort program's all fields, not just the first one.


M	src/lib-storage/index/index-search.c

2011-04-04 16:02:05 +0300 Timo Sirainen <tss@iki.fi> (045aa2f)

    lib-storage: Removed struct mail_private.extra_* fields. There isn't much
    point in keeping them separated.


M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/mail-storage-private.h

2011-04-04 15:41:19 +0300 Timo Sirainen <tss@iki.fi> (bf19004)

    imapc: Minor code cleanup.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-04-04 15:27:33 +0300 Timo Sirainen <tss@iki.fi> (8ddc45f)

    imapc: Fixes to handling expunges.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-04-04 15:08:50 +0300 Timo Sirainen <tss@iki.fi> (68a8f07)

    Compiler warning fix for newer OpenSSL library.


M	src/lib-ssl-iostream/iostream-openssl.c

2011-04-04 14:12:01 +0300 Timo Sirainen <tss@iki.fi> (0102d0a)

    imapc: Make sure we wait for SELECT/APPEND/COPY commands to finish.


M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c

2011-04-04 14:09:11 +0300 Timo Sirainen <tss@iki.fi> (86520dd)

    imapc: Removed support for connection locking and multiple connections to
    mailbox. If needed they can be added back by reversing this change, but for
    now they're no longer needed.


M	src/lib-storage/index/imapc/imapc-client-private.h
M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-04-04 13:51:34 +0300 Timo Sirainen <tss@iki.fi> (b67628e)

    imapc: Don't log an error message about missing BODY[] if message was
    already expunged.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-04-04 13:42:23 +0300 Timo Sirainen <tss@iki.fi> (9ed77dd)

    imapc: Stop FETCH wait after untagged reply is received, don't wait for
    tagged reply.


M	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c

2011-04-04 13:07:19 +0300 Timo Sirainen <tss@iki.fi> (1af0a59)

    lib-storage: Added mail prefetching support for searching.


M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h

2011-04-04 12:57:49 +0300 Timo Sirainen <tss@iki.fi> (c405ed3)

    doveadm: Don't link with all AUTH_LIBS, only -lcrypt is needed.


M	configure.in
M	src/doveadm/Makefile.am

2011-04-04 12:52:21 +0300 Timo Sirainen <tss@iki.fi> (e4c43c3)

    Compile warning fix.


M	src/plugins/autocreate/autocreate-plugin.c

2011-04-03 06:42:48 +0300 Timo Sirainen <tss@iki.fi> (14247d7)

    example-config: Fixed vpopmail config.


M	doc/example-config/conf.d/auth-vpopmail.conf.ext

2011-03-31 11:10:22 +0300 Timo Sirainen <tss@iki.fi> (e15b305)

    Search supports now prefetching data for returned mails. Dropped imapc's own
    prefetching. mail_prefetch_count specifies how many mails can be kept open
    and issue a prefetch.

    This works using posix_fadvise(POSIX_FADV_WILLNEED) for maildir, sdbox and 
    cydir backends. Apparently only Linux supports this.

    imapc backend also implements this internally by sending wanted IMAP 
    commands to remote server. The command pipelining helps with latency. This 
    change also makes it actually possible for imapc backend to first check if 
    wanted data is already cached in local index and avoid sending unnecessary 
    IMAP commands to remote server.

M	configure.in
M	doc/example-config/conf.d/10-mail.conf
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/Makefile.am
A	src/lib-storage/index/imapc/imapc-mail-fetch.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
D	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search-private.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail.c
M	src/lib-storage/test-mail.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-search.c

2011-03-31 09:48:37 +0300 Timo Sirainen <tss@iki.fi> (c3f7ca6)

    lib-storage: Search code cleanup.


M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-sort.h

2011-03-31 09:23:22 +0300 Timo Sirainen <tss@iki.fi> (0a1ec0f)

    lib-storage: Fail mail_search_build() if charset is unknown, even if it's
    not used. For example this causes "SEARCH CHARSET foo ALL" command to fail.


M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-build.h

2011-03-31 09:19:10 +0300 Timo Sirainen <tss@iki.fi> (d798962)

    Changed header/body searching to do search key charset translation earlier.
    This cleans up and simplifies error handling.


M	src/doveadm/doveadm-mail.c
M	src/imap/imap-search-args.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-search.h
M	src/lib-storage/Makefile.am
M	src/lib-storage/index/index-search-private.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-build.h
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-search.h
M	src/lib-storage/mail-storage.h
M	src/plugins/fts/Makefile.am
M	src/plugins/fts/fts-search.c
M	src/plugins/virtual/virtual-config.c

2011-03-31 07:02:55 +0300 Timo Sirainen <tss@iki.fi> (89d7ddf)

    auth: Mention auth_username_chars in log when disallowing username because
    of it.


M	src/auth/auth-request.c

2011-03-29 07:00:40 +0300 Timo Sirainen <tss@iki.fi> (eef4ba0)

    lib-storage: Changed mailbox_search_*() API to return pointer struct mail.
    This reduces the flexibility, because now different mailbox_search_next()
    calls can't have different mail parameters with possibly different
    wanted_fields settings. This flexibility was never used though, and removing
    it gives a couple of benefits:

     * it's now easier for backends to implement prefetch and parallel search
    * usage is easier since mail_alloc()/mail_free() is no longer needed

M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-iter.h
M	src/doveadm/doveadm-mail-search.c
M	src/dsync/dsync-worker-local.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-store.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-fetch.h
M	src/imap/imap-search.c
M	src/imap/imap-search.h
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-search-private.h
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.h
M	src/plugins/virtual/virtual-sync.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c

2011-03-29 04:47:55 +0300 Timo Sirainen <tss@iki.fi> (e2170d0)

    imapc: Try to get received date first from cache.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-03-29 04:45:34 +0300 Timo Sirainen <tss@iki.fi> (5940a2b)

    imapc: Try to get physical/virtual size first from cache.


M	src/lib-storage/index/imapc/imapc-mail.c

2011-03-29 04:32:54 +0300 Timo Sirainen <tss@iki.fi> (bc6ef0b)

    lib-storage: Small optimizations to setting mail's access_parts.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-mail.c

2011-03-26 01:10:59 +0200 Timo Sirainen <tss@iki.fi> (ff640c9)

    lib-settings: Fixed crash when trying treat strlist as having a subsection.
    For example "plugin/foo/bar=yes" crashed, while it should have been just
    ignored.


M	src/lib-settings/settings-parser.c

2011-03-26 00:42:48 +0200 Timo Sirainen <tss@iki.fi> (863ea89)

    lib-index: Delete dovecot.index.log.2 files after 2 days, not after 30 mins.


M	src/lib-index/mail-transaction-log-private.h

2011-03-26 00:40:58 +0200 Timo Sirainen <tss@iki.fi> (abd042f)

    dsync: Fixed handling expunges of last message when it didn't have a known
    GUID.


M	src/dsync/dsync-worker-local.c

2011-03-26 00:39:40 +0200 Timo Sirainen <tss@iki.fi> (4979e25)

    imap: Use mailbox_get_expunged_uids() for QRESYNC code.


M	src/imap/imap-fetch.c

2011-03-26 00:33:51 +0200 Timo Sirainen <tss@iki.fi> (4590a0c)

    lib-storage: Fixed mailbox_get_expunges() to return GUIDs with all mailbox
    formats. Also added mailbox_get_expunged_uids() for use cases that don't
    really need GUIDs.


M	src/lib-storage/index/index-fetch.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/test-index-fetch.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c

2011-03-24 19:30:21 +0200 Timo Sirainen <tss@iki.fi> (1460ef7)

    lib-storage: Moved index_mailbox_context.save_*() methods to mailbox_vfuncs.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/virtual/virtual-storage.c

2011-03-24 19:22:03 +0200 Timo Sirainen <tss@iki.fi> (a9dcc72)

    lib-storage: Removed unused index_mailbox_context.notify_last_check


M	src/lib-storage/index/index-storage.h

2011-03-24 19:14:42 +0200 Timo Sirainen <tss@iki.fi> (1fdae27)

    lib-storage: Removed unused index_mail.uid_validity.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2011-03-24 00:28:06 +0200 Timo Sirainen <tss@iki.fi> (e755d1c)

    lmtp: Fixed loading Sieve plugin when configuring --without-shared-libs


M	src/lmtp/Makefile.am

2011-03-24 00:14:58 +0200 Timo Sirainen <tss@iki.fi> (9f5a3b7)

    autocreate: Disable plugin when running from dsync.


M	src/plugins/autocreate/Makefile.am
M	src/plugins/autocreate/autocreate-plugin.c

2011-03-24 00:10:59 +0200 Timo Sirainen <tss@iki.fi> (ab67045)

    lib-storage: Removed extra "don't allow INBOX to be deleted" check. It's
    already checked in places where it could cause actual harm (accidentally
    deleting other mailboxes) and where it's not allowed (IMAP). This allows
    dsync backup to delete unwanted INBOX if the mail location settings allow
    it.


M	src/lib-storage/mail-storage.c

2011-03-24 00:01:16 +0200 Timo Sirainen <tss@iki.fi> (d799e42)

    dsync backup: Handle better deletion of mailboxes from destination.


M	src/dsync/dsync-worker-local.c

2011-03-23 23:13:00 +0200 Timo Sirainen <tss@iki.fi> (58c8d26)

    lib-storage: When mail_location is looked up from environment, set its
    unexpanded string properly. This fixes a crash when creating index
    directories and mail location was autodetected.


M	src/lib-storage/mail-namespace.c

2011-03-23 22:55:03 +0200 Timo Sirainen <tss@iki.fi> (dff3fee)

    autocreate: Don't list autocreate mailboxes with
    MAILBOX_LIST_ITER_NO_AUTO_BOXES.


M	src/plugins/autocreate/autocreate-plugin.c

2011-03-23 22:54:24 +0200 Timo Sirainen <tss@iki.fi> (b3126be)

    lib-storage: Renamed MAILBOX_LIST_ITER_NO_AUTO_INBOX to _NO_AUTO_BOXES.


M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-search.c
M	src/dsync/dsync-worker-local.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/mailbox-list.h

2011-03-23 22:16:24 +0200 Timo Sirainen <tss@iki.fi> (b932ee7)

    doveadm: Added "move" command for moving mails between mailboxes.


M	src/doveadm/Makefile.am
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-iter.h
A	src/doveadm/doveadm-mail-move.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2011-03-22 23:03:41 +0200 Timo Sirainen <tss@iki.fi> (c84c0d4)

    doveconf: Fixed showing plugin {} section.


M	src/config/config-request.c
M	src/config/doveconf.c

2011-03-22 22:50:26 +0200 Timo Sirainen <tss@iki.fi> (303e375)

    lib-storage: Added MAIL_STORAGE_SERVICE_FLAG_NO_NAMESPACES flag.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2011-03-21 19:16:14 +0200 Timo Sirainen <tss@iki.fi> (76a8438)

    lib-storage: Don't try to create /dovecot.mailbox.index when indexes are
    disabled.


M	src/lib-storage/mailbox-list.c

2011-03-21 19:10:08 +0200 Timo Sirainen <tss@iki.fi> (68fb1a6)

    example-config: Uncommented !include_try local.conf At least one Linux
    distro wants this.


M	doc/example-config/dovecot.conf

2011-03-21 18:51:51 +0200 Timo Sirainen <tss@iki.fi> (089a5b2)

    lmtp/smtp client: Crashfix if remote returned failure to RCPT TO.


M	src/lib-lda/lmtp-client.c

2011-03-17 19:02:26 +0200 Timo Sirainen <tss@iki.fi> (e4f7d8e)

    fts: Don't notify storage about finishing indexing if notify_ok callback is
    NULL.


M	src/plugins/fts/fts-storage.c

2011-03-17 16:37:45 +0200 Timo Sirainen <tss@iki.fi> (2b0856f)

    imapc: Fixed setting flags for newly seen messages.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-03-17 16:37:22 +0200 Timo Sirainen <tss@iki.fi> (8a97355)

    Merged changes from v2.0 tree.


2011-03-17 16:21:00 +0200 Timo Sirainen <tss@iki.fi> (70afae4)

    Replaced all getpw/gr*() to use i_getpw/gr*() with improved error handling.


M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-passwd.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb.c
M	src/lda/main.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/mail-storage-service.c
M	src/lib/eacces-error.c
M	src/lib/home-expand.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/lib.c
M	src/lib/mkdir-parents.c
M	src/lib/restrict-access.c
M	src/master/main.c
M	src/master/service-process.c

2011-03-17 16:20:12 +0200 Timo Sirainen <tss@iki.fi> (596f582)

    Added i_getpw*() and i_getgr*() wrappers for getpw*()/getgr*(). These
    functions make error handling easier.


M	src/lib/Makefile.am
A	src/lib/ipwd.c
A	src/lib/ipwd.h

2011-03-16 19:49:27 +0200 Timo Sirainen <tss@iki.fi> (ba55f12)

    master: Don't close stderr if logging goes there.


M	src/master/main.c

2011-03-16 19:17:57 +0200 Timo Sirainen <tss@iki.fi> (2128e2b)

    virtual: Support +mailbox entries that clear \Recent flag from messages.


M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2011-03-16 18:40:40 +0200 Timo Sirainen <tss@iki.fi> (ee9254c)

    dbox: Fixed crash on creation of a new mailbox. Broken by recent changes.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c

2011-03-16 18:37:14 +0200 Timo Sirainen <tss@iki.fi> (882eb22)

    eacces_error_get*(): Handle errors to / directory better.


M	src/lib/eacces-error.c

2011-03-16 18:20:47 +0200 Timo Sirainen <tss@iki.fi> (7cdf66e)

    lib-auth: If connection to auth-master gets lost, reconnect.


M	src/lib-auth/auth-master.c

2011-03-16 17:59:07 +0200 Timo Sirainen <tss@iki.fi> (7d20b3a)

    lib-storage: Moved mailbox_update() assert check from mdbox to common, plus
    fixed it.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/mail-storage.c

2011-03-16 17:46:29 +0200 Timo Sirainen <tss@iki.fi> (a6f6a70)

    dsync: Preserve \Recent flags state (instead of setting everything \Recent).


M	src/dsync/dsync-brain.c
M	src/dsync/dsync-data.h
M	src/dsync/dsync-proxy.c
M	src/dsync/dsync-worker-local.c
M	src/dsync/test-dsync-brain.c
M	src/dsync/test-dsync-proxy-server-cmd.c

2011-03-16 17:42:42 +0200 Timo Sirainen <tss@iki.fi> (2933770)

    lib-storage: Added min_first_recent_uid to struct mailbox_update.
    Implemented for dbox. Maildir/mbox needs some more code to make this work
    correctly.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/mail-storage.h

2011-03-16 17:42:06 +0200 Timo Sirainen <tss@iki.fi> (97f6b32)

    lib-storage: Added first_recent_uid to struct mailbox_status.


M	src/lib-storage/index/index-status.c
M	src/lib-storage/mail-storage.h

2011-03-15 21:53:21 +0200 Timo Sirainen <tss@iki.fi> (cb2d128)

    imap-login: Changed CAPABILITY's tagged OK reply to say post-login
    capabilities have more.


M	src/imap-login/client.c

2011-03-14 19:43:31 +0200 Timo Sirainen <tss@iki.fi> (2caedbd)

    dbox: Fixed wrong error check while reading external attachments.


M	src/lib-storage/index/dbox-common/dbox-attachment.c

2011-03-12 17:43:46 +0200 Timo Sirainen <tss@iki.fi> (8c109ec)

    dsync: When showing mailbox names, show also their GUIDs.


M	src/dsync/dsync-brain.c

2011-03-12 17:24:38 +0200 Timo Sirainen <tss@iki.fi> (7d73c8f)

    dbox: Give more verbose error message about broken attachment ext-refs.


M	src/lib-storage/index/dbox-common/dbox-attachment.c

2011-03-12 17:18:47 +0200 Timo Sirainen <tss@iki.fi> (c7a50b2)

    maildir, sdbox: If committed transaction has only aborted msg saves, don't
    assert-crash.


M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/maildir/maildir-save.c

2011-03-12 15:48:24 +0200 Timo Sirainen <tss@iki.fi> (b6b63ea)

    dsync: If remote dsync times out, log a more verbose reason.


M	src/dsync/dsync-proxy-client.c

2011-03-12 15:27:54 +0200 Timo Sirainen <tss@iki.fi> (216cd45)

    lib-storage: When uid/gid is invalid, tell if it's from setting or userdb
    lookup.


M	src/lib-storage/mail-storage-service.c

2011-03-12 15:12:22 +0200 Timo Sirainen <tss@iki.fi> (1c3e6a4)

    imap: Added tb-lsub-flags to imap_client_workarounds. Patch by Bruno
    TrÃ©guier.


M	doc/example-config/conf.d/20-imap.conf
M	src/imap/cmd-list.c
M	src/imap/imap-settings.c
M	src/imap/imap-settings.h

2011-03-10 18:44:20 +0200 Timo Sirainen <tss@iki.fi> (731e1bc)

    imapc: When unselecting a mailbox, send DONE to stop IDLE.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-03-10 18:44:00 +0200 Timo Sirainen <tss@iki.fi> (c2ecc7b)

    imapc: If server sends BAD, disconnect from it.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-03-10 18:32:08 +0200 Timo Sirainen <tss@iki.fi> (d83e46e)

    imapc: Initial support for local index files.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/imapc/imapc-sync.h

2011-03-10 18:31:28 +0200 Timo Sirainen <tss@iki.fi> (db8b0a3)

    lib-storage: Allow creating a secondary mailbox_list for a namespace.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2011-03-10 18:29:59 +0200 Timo Sirainen <tss@iki.fi> (4401e78)

    quota-fs: Don't log error if storage doesn't have a root directory.


M	src/plugins/quota/quota-fs.c

2011-03-10 16:25:26 +0200 Timo Sirainen <tss@iki.fi> (dc5606f)

    Moved most of listescape plugin functionality directly to lib-storage. This
    fixes actually opening escaped mailboxes. The plugin may eventually be
    removed and replaced with a setting.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/listescape/listescape-plugin.c

2011-03-10 15:56:46 +0200 Timo Sirainen <tss@iki.fi> (7692e29)

    dsync: Reset idle timeouts at the end of i/o callbacks, not beginning. This
    could make a difference if the callback runs for a long time.


M	src/dsync/dsync-proxy-server.c

2011-03-09 20:22:52 +0200 Timo Sirainen <tss@iki.fi> (cdf9530)

    IMAP: Fixed ID command to log the parameters properly. Patch by Mike Abbott
    / Apple.


M	src/lib-imap/imap-id.c

2011-03-09 19:02:42 +0200 Timo Sirainen <tss@iki.fi> (36de2c0)

    dsync: Use a smaller idle timeout value for client than for server.


M	src/dsync/dsync-proxy-client.c
M	src/dsync/dsync-proxy-server.c
M	src/dsync/dsync-proxy.h

2011-03-07 19:35:09 +0200 Timo Sirainen <tss@iki.fi> (276c4d0)

    dsync: Avoid hanging when saving messages.


M	src/dsync/dsync-proxy-client.c

2011-03-07 01:00:28 +0200 Timo Sirainen <tss@iki.fi> (fd35227)

    expire: Fixed mail_debug logging when same transaction expunged all messages
    and saved new.


M	src/plugins/expire/expire-plugin.c

2011-03-07 00:57:08 +0200 Timo Sirainen <tss@iki.fi> (2e263a9)

    expire: Added more debugging with mail_debug=yes


M	src/plugins/expire/expire-plugin.c

2011-03-07 00:56:54 +0200 Timo Sirainen <tss@iki.fi> (bbd4c4c)

    expire: When saving first message to expire mailbox, use the oldest
    message's save-time. This makes it easier to enable and test expire plugin.
    This also changes how expire dict is used: previously when all messages were
    expunged in a mailbox its entry was deleted in dict, but now its value is
    set to 0.


M	src/plugins/expire/expire-plugin.c

2011-03-07 00:35:25 +0200 Timo Sirainen <tss@iki.fi> (ff4312f)

    Added signature for changeset 3355b4bbd4ac


M	.hgsigs

2011-03-07 00:35:20 +0200 Timo Sirainen <tss@iki.fi> (29593f3)

    Added tag 2.0.11 for changeset 3355b4bbd4ac


M	.hgtags

2011-03-07 00:35:20 +0200 Timo Sirainen <tss@iki.fi> (13aeac6)

    Released v2.0.11.


M	NEWS
M	configure.in

2011-03-07 00:31:22 +0200 Timo Sirainen <tss@iki.fi> (06545b0)

    lib-storage: dotlock_use_excl default was accidentally set to "no".


M	src/lib-storage/mail-storage-settings.c

2011-03-07 00:16:26 +0200 Timo Sirainen <tss@iki.fi> (452eb0c)

    dsync: Fixed a timeout/crash when saving messages to remote dsync.


M	src/dsync/dsync-proxy-client.c

2011-03-06 23:55:01 +0200 Timo Sirainen <tss@iki.fi> (4744861)

    mdbox: Avoid leaking fds when saving many messages larger than
    mdbox_rotate_size.


M	src/lib-storage/index/dbox-multi/mdbox-map.c

2011-03-05 13:36:19 +0200 Timo Sirainen <tss@iki.fi> (baa6930)

    auth: Fixed ldap assert-crash.


M	src/auth/db-ldap.c

2011-03-04 21:21:37 +0200 Timo Sirainen <tss@iki.fi> (be78bc8)

    doveadm acl set: Require non-standard rights to be prefixed with ':' char.


M	src/plugins/acl/doveadm-acl.c

2011-03-04 20:59:31 +0200 Timo Sirainen <tss@iki.fi> (b9139dc)

    Added signature for changeset 755c63ff089f


M	.hgsigs

2011-03-04 20:59:28 +0200 Timo Sirainen <tss@iki.fi> (43effe8)

    Added tag 2.0.10 for changeset 755c63ff089f


M	.hgtags

2011-03-04 20:59:24 +0200 Timo Sirainen <tss@iki.fi> (48dd81b)

    Released v2.0.10.


M	NEWS
M	TODO
M	configure.in

2011-03-04 20:54:29 +0200 Timo Sirainen <tss@iki.fi> (2e37d45)

    Updated copyright notices to include year 2011.


M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-stream.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-external.c
M	src/auth/mech-plain.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-list-iter.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/dsync/dsync-brain-msgs-new.c
M	src/dsync/dsync-brain-msgs.c
M	src/dsync/dsync-brain.c
M	src/dsync/dsync-data.c
M	src/dsync/dsync-proxy-client.c
M	src/dsync/dsync-proxy-server-cmd.c
M	src/dsync/dsync-proxy-server.c
M	src/dsync/dsync-proxy.c
M	src/dsync/dsync-worker-local.c
M	src/dsync/dsync-worker.c
M	src/dsync/dsync.c
M	src/dsync/test-dsync-brain-msgs.c
M	src/dsync/test-dsync-brain.c
M	src/dsync/test-dsync-common.c
M	src/dsync/test-dsync-proxy-server-cmd.c
M	src/dsync/test-dsync-proxy.c
M	src/dsync/test-dsync-worker.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-uid.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-x-cancel.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-send.c
M	src/lib-mail/message-size.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service.c
M	src/lib-master/syslog-util.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-attachment.c
M	src/lib-storage/index/istream-mail-stats.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename-flags.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-get.c
M	src/lib-storage/mailbox-header.c
M	src/lib-storage/mailbox-keywords.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/test-mail-storage.c
M	src/lib-storage/test-mail.c
M	src/lib-storage/test-mailbox-get.c
M	src/lib-storage/test-mailbox.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base64.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/close-keep-errno.c
M	src/lib/compat.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fd-set-nonblock.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-seekable.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/network.c
M	src/lib/nfs-workarounds.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base64.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-hash-format.c
M	src/lib/test-hex-binary.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-network.c
M	src/lib/test-ostream-file.c
M	src/lib/test-primes.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-time-util.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/time-util.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/log-connection.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-mailbox.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c
M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-openssl.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/util/gdbhelper.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2011-03-04 20:53:46 +0200 Timo Sirainen <tss@iki.fi> (183bea4)

    Updated copyright notices to include year 2011.


M	src/anvil/anvil-connection.c
M	src/anvil/anvil-settings.c
M	src/anvil/connect-limit.c
M	src/anvil/main.c
M	src/anvil/penalty.c
M	src/anvil/test-penalty.c
M	src/auth/auth-cache.c
M	src/auth/auth-client-connection.c
M	src/auth/auth-master-connection.c
M	src/auth/auth-penalty.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request.c
M	src/auth/auth-settings.c
M	src/auth/auth-stream.c
M	src/auth/auth-worker-client.c
M	src/auth/auth-worker-server.c
M	src/auth/auth.c
M	src/auth/db-checkpassword.c
M	src/auth/db-ldap.c
M	src/auth/db-passwd-file.c
M	src/auth/db-sql.c
M	src/auth/main.c
M	src/auth/mech-anonymous.c
M	src/auth/mech-cram-md5.c
M	src/auth/mech-digest-md5.c
M	src/auth/mech-external.c
M	src/auth/mech-plain.c
M	src/auth/mech.c
M	src/auth/passdb-blocking.c
M	src/auth/passdb-bsdauth.c
M	src/auth/passdb-cache.c
M	src/auth/passdb-checkpassword.c
M	src/auth/passdb-ldap.c
M	src/auth/passdb-passwd-file.c
M	src/auth/passdb-passwd.c
M	src/auth/passdb-shadow.c
M	src/auth/passdb-sql.c
M	src/auth/passdb-static.c
M	src/auth/passdb-vpopmail.c
M	src/auth/passdb.c
M	src/auth/password-scheme-crypt.c
M	src/auth/password-scheme.c
M	src/auth/userdb-blocking.c
M	src/auth/userdb-checkpassword.c
M	src/auth/userdb-ldap.c
M	src/auth/userdb-nss.c
M	src/auth/userdb-passwd-file.c
M	src/auth/userdb-passwd.c
M	src/auth/userdb-prefetch.c
M	src/auth/userdb-sql.c
M	src/auth/userdb-static.c
M	src/auth/userdb-vpopmail.c
M	src/auth/userdb.c
M	src/config/config-connection.c
M	src/config/config-filter.c
M	src/config/config-parser.c
M	src/config/config-request.c
M	src/config/config-settings.c
M	src/config/doveconf.c
M	src/config/main.c
M	src/config/old-set-parser.c
M	src/config/sysinfo-get.c
M	src/dict/dict-commands.c
M	src/dict/dict-connection.c
M	src/dict/dict-settings.c
M	src/dict/main.c
M	src/director/auth-connection.c
M	src/director/director-connection.c
M	src/director/director-host.c
M	src/director/director-request.c
M	src/director/director-settings.c
M	src/director/director-test.c
M	src/director/director.c
M	src/director/doveadm-connection.c
M	src/director/login-connection.c
M	src/director/mail-host.c
M	src/director/main.c
M	src/director/notify-connection.c
M	src/director/user-directory.c
M	src/dns/dns-client-settings.c
M	src/dns/dns-client.c
M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-auth.c
M	src/doveadm/doveadm-director.c
M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/doveadm/doveadm-dump-mailboxlog.c
M	src/doveadm/doveadm-dump-thread.c
M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-kick.c
M	src/doveadm/doveadm-log.c
M	src/doveadm/doveadm-mail-altmove.c
M	src/doveadm/doveadm-mail-expunge.c
M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-list-iter.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-master.c
M	src/doveadm/doveadm-mutf7.c
M	src/doveadm/doveadm-penalty.c
M	src/doveadm/doveadm-print-flow.c
M	src/doveadm/doveadm-print-pager.c
M	src/doveadm/doveadm-print-server.c
M	src/doveadm/doveadm-print-tab.c
M	src/doveadm/doveadm-print-table.c
M	src/doveadm/doveadm-print.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm-util.c
M	src/doveadm/doveadm-who.c
M	src/doveadm/doveadm.c
M	src/doveadm/main.c
M	src/doveadm/server-connection.c
M	src/dsync/dsync-brain-msgs-new.c
M	src/dsync/dsync-brain-msgs.c
M	src/dsync/dsync-brain.c
M	src/dsync/dsync-data.c
M	src/dsync/dsync-proxy-client.c
M	src/dsync/dsync-proxy-server-cmd.c
M	src/dsync/dsync-proxy-server.c
M	src/dsync/dsync-proxy.c
M	src/dsync/dsync-worker-local.c
M	src/dsync/dsync-worker.c
M	src/dsync/dsync.c
M	src/dsync/test-dsync-brain-msgs.c
M	src/dsync/test-dsync-brain.c
M	src/dsync/test-dsync-common.c
M	src/dsync/test-dsync-proxy-server-cmd.c
M	src/dsync/test-dsync-proxy.c
M	src/dsync/test-dsync-worker.c
M	src/imap-login/client-authenticate.c
M	src/imap-login/client.c
M	src/imap-login/imap-login-settings.c
M	src/imap-login/imap-proxy.c
M	src/imap/cmd-append.c
M	src/imap/cmd-cancelupdate.c
M	src/imap/cmd-capability.c
M	src/imap/cmd-check.c
M	src/imap/cmd-close.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-examine.c
M	src/imap/cmd-expunge.c
M	src/imap/cmd-fetch.c
M	src/imap/cmd-id.c
M	src/imap/cmd-idle.c
M	src/imap/cmd-list.c
M	src/imap/cmd-logout.c
M	src/imap/cmd-lsub.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-noop.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-search.c
M	src/imap/cmd-select.c
M	src/imap/cmd-sort.c
M	src/imap/cmd-status.c
M	src/imap/cmd-store.c
M	src/imap/cmd-subscribe.c
M	src/imap/cmd-thread.c
M	src/imap/cmd-uid.c
M	src/imap/cmd-unselect.c
M	src/imap/cmd-unsubscribe.c
M	src/imap/cmd-x-cancel.c
M	src/imap/imap-client.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands.c
M	src/imap/imap-expunge.c
M	src/imap/imap-fetch-body.c
M	src/imap/imap-fetch.c
M	src/imap/imap-search-args.c
M	src/imap/imap-search.c
M	src/imap/imap-settings.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/imap/mail-storage-callbacks.c
M	src/imap/main.c
M	src/lda/main.c
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.c
M	src/lib-auth/auth-master.c
M	src/lib-auth/auth-server-connection.c
M	src/lib-charset/charset-iconv.c
M	src/lib-charset/charset-utf8.c
M	src/lib-dict/dict-client.c
M	src/lib-dict/dict-db.c
M	src/lib-dict/dict-file.c
M	src/lib-dict/dict-sql-settings.c
M	src/lib-dict/dict-sql.c
M	src/lib-dict/dict.c
M	src/lib-dict/test-dict.c
M	src/lib-dns/dns-lookup.c
M	src/lib-fs/fs-api.c
M	src/lib-fs/fs-posix.c
M	src/lib-fs/fs-sis-common.c
M	src/lib-fs/fs-sis-queue.c
M	src/lib-fs/fs-sis.c
M	src/lib-fs/ostream-cmp.c
M	src/lib-imap/imap-arg.c
M	src/lib-imap/imap-base-subject.c
M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-date.c
M	src/lib-imap/imap-envelope.c
M	src/lib-imap/imap-id.c
M	src/lib-imap/imap-match.c
M	src/lib-imap/imap-parser.c
M	src/lib-imap/imap-quote.c
M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-utf7.c
M	src/lib-imap/imap-util.c
M	src/lib-imap/test-imap-match.c
M	src/lib-imap/test-imap-parser.c
M	src/lib-imap/test-imap-utf7.c
M	src/lib-imap/test-imap-util.c
M	src/lib-index/mail-cache-compress.c
M	src/lib-index/mail-cache-decisions.c
M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache-lookup.c
M	src/lib-index/mail-cache-sync-update.c
M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-cache.c
M	src/lib-index/mail-index-alloc-cache.c
M	src/lib-index/mail-index-dummy-view.c
M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-index-map-hdr.c
M	src/lib-index/mail-index-map-read.c
M	src/lib-index/mail-index-map.c
M	src/lib-index/mail-index-modseq.c
M	src/lib-index/mail-index-strmap.c
M	src/lib-index/mail-index-sync-ext.c
M	src/lib-index/mail-index-sync-keywords.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-index-sync.c
M	src/lib-index/mail-index-transaction-export.c
M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-sort-appends.c
M	src/lib-index/mail-index-transaction-update.c
M	src/lib-index/mail-index-transaction-view.c
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-util.c
M	src/lib-index/mail-index-view-sync.c
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mailbox-list-index-sync.c
M	src/lib-index/mailbox-list-index.c
M	src/lib-index/mailbox-log.c
M	src/lib-index/test-mail-index-sync-ext.c
M	src/lib-index/test-mail-index-transaction-finish.c
M	src/lib-index/test-mail-index-transaction-update.c
M	src/lib-index/test-mail-transaction-log-append.c
M	src/lib-index/test-mail-transaction-log-view.c
M	src/lib-lda/duplicate.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lmtp-client.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-send.c
M	src/lib-lda/smtp-client.c
M	src/lib-mail/istream-dot.c
M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/mbox-from.c
M	src/lib-mail/message-address.c
M	src/lib-mail/message-date.c
M	src/lib-mail/message-decoder.c
M	src/lib-mail/message-header-decode.c
M	src/lib-mail/message-header-encode.c
M	src/lib-mail/message-header-parser.c
M	src/lib-mail/message-id.c
M	src/lib-mail/message-parser.c
M	src/lib-mail/message-part-serialize.c
M	src/lib-mail/message-search.c
M	src/lib-mail/message-send.c
M	src/lib-mail/message-size.c
M	src/lib-mail/quoted-printable.c
M	src/lib-mail/rfc2231-parser.c
M	src/lib-mail/rfc822-parser.c
M	src/lib-mail/test-istream-dot.c
M	src/lib-mail/test-istream-header-filter.c
M	src/lib-mail/test-mbox-from.c
M	src/lib-mail/test-message-address.c
M	src/lib-mail/test-message-date.c
M	src/lib-mail/test-message-decoder.c
M	src/lib-mail/test-message-header-decode.c
M	src/lib-mail/test-message-header-encode.c
M	src/lib-mail/test-message-header-parser.c
M	src/lib-mail/test-message-id.c
M	src/lib-mail/test-message-parser.c
M	src/lib-mail/test-quoted-printable.c
M	src/lib-mail/test-rfc2231-parser.c
M	src/lib-master/anvil-client.c
M	src/lib-master/master-auth.c
M	src/lib-master/master-login-auth.c
M	src/lib-master/master-login.c
M	src/lib-master/master-service-settings-cache.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service.c
M	src/lib-master/syslog-util.c
M	src/lib-settings/settings-parser.c
M	src/lib-settings/settings.c
M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.c
M	src/lib-sql/sql-db-cache.c
M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/cydir/cydir-save.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/cydir/cydir-sync.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-file-fix.c
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/index-fetch.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mailbox-check.c
M	src/lib-storage/index/index-search-result.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort-string.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-sync-changes.c
M	src/lib-storage/index/index-sync-search.c
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/index-thread-finish.c
M	src/lib-storage/index/index-thread-links.c
M	src/lib-storage/index/index-thread.c
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/istream-attachment.c
M	src/lib-storage/index/istream-mail-stats.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-settings.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/istream-raw-mbox.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-md5.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-settings.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync-parse.c
M	src/lib-storage/index/mbox/mbox-sync-rewrite.c
M	src/lib-storage/index/mbox/mbox-sync-update.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/raw/raw-sync.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/index/test-index-fetch.c
M	src/lib-storage/list/index-mailbox-list-sync.c
M	src/lib-storage/list/index-mailbox-list.c
M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-fs-flags.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-error.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-search-build.c
M	src/lib-storage/mail-search-parser-cmdline.c
M	src/lib-storage/mail-search-parser-imap.c
M	src/lib-storage/mail-search-parser.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-search-register.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-hooks.c
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-thread.c
M	src/lib-storage/mail-user.c
M	src/lib-storage/mail.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-search-result.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-uidvalidity.c
M	src/lib-storage/test-mail-storage.c
M	src/lib-storage/test-mail.c
M	src/lib-storage/test-mailbox.c
M	src/lib-test/test-common.c
M	src/lib/abspath.c
M	src/lib/aqueue.c
M	src/lib/array.c
M	src/lib/askpass.c
M	src/lib/backtrace-string.c
M	src/lib/base64.c
M	src/lib/bsearch-insert-pos.c
M	src/lib/buffer.c
M	src/lib/child-wait.c
M	src/lib/close-keep-errno.c
M	src/lib/compat.c
M	src/lib/crc32.c
M	src/lib/data-stack.c
M	src/lib/eacces-error.c
M	src/lib/env-util.c
M	src/lib/execv-const.c
M	src/lib/failures.c
M	src/lib/fd-close-on-exec.c
M	src/lib/fd-set-nonblock.c
M	src/lib/fdatasync-path.c
M	src/lib/fdpass.c
M	src/lib/file-cache.c
M	src/lib/file-copy.c
M	src/lib/file-dotlock.c
M	src/lib/file-lock.c
M	src/lib/file-set-size.c
M	src/lib/hash-format.c
M	src/lib/hash-method.c
M	src/lib/hash.c
M	src/lib/hash2.c
M	src/lib/hex-binary.c
M	src/lib/hex-dec.c
M	src/lib/home-expand.c
M	src/lib/hostpid.c
M	src/lib/imem.c
M	src/lib/ioloop-notify-dn.c
M	src/lib/ioloop-notify-fd.c
M	src/lib/ioloop-notify-inotify.c
M	src/lib/ioloop-notify-none.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/iostream.c
M	src/lib/istream-base64-encoder.c
M	src/lib/istream-concat.c
M	src/lib/istream-crlf.c
M	src/lib/istream-data.c
M	src/lib/istream-file.c
M	src/lib/istream-limit.c
M	src/lib/istream-mmap.c
M	src/lib/istream-seekable.c
M	src/lib/istream-tee.c
M	src/lib/istream.c
M	src/lib/lib-signals.c
M	src/lib/lib.c
M	src/lib/mempool-alloconly.c
M	src/lib/mempool-datastack.c
M	src/lib/mempool-system.c
M	src/lib/mempool-unsafe-datastack.c
M	src/lib/mempool.c
M	src/lib/mkdir-parents.c
M	src/lib/mmap-anon.c
M	src/lib/mmap-util.c
M	src/lib/module-dir.c
M	src/lib/mountpoint.c
M	src/lib/network.c
M	src/lib/nfs-workarounds.c
M	src/lib/ostream-buffer.c
M	src/lib/ostream-file.c
M	src/lib/ostream.c
M	src/lib/printf-format-fix.c
M	src/lib/priorityq.c
M	src/lib/process-title.c
M	src/lib/randgen.c
M	src/lib/read-full.c
M	src/lib/restrict-access.c
M	src/lib/restrict-process-size.c
M	src/lib/safe-memset.c
M	src/lib/safe-mkdir.c
M	src/lib/safe-mkstemp.c
M	src/lib/sendfile-util.c
M	src/lib/seq-range-array.c
M	src/lib/str-find.c
M	src/lib/str-sanitize.c
M	src/lib/str.c
M	src/lib/strescape.c
M	src/lib/strfuncs.c
M	src/lib/strnum.c
M	src/lib/test-aqueue.c
M	src/lib/test-array.c
M	src/lib/test-base64.c
M	src/lib/test-bsearch-insert-pos.c
M	src/lib/test-buffer.c
M	src/lib/test-crc32.c
M	src/lib/test-hash-format.c
M	src/lib/test-hex-binary.c
M	src/lib/test-istream-base64-encoder.c
M	src/lib/test-istream-concat.c
M	src/lib/test-istream-crlf.c
M	src/lib/test-istream-seekable.c
M	src/lib/test-istream-tee.c
M	src/lib/test-lib.c
M	src/lib/test-llist.c
M	src/lib/test-mempool-alloconly.c
M	src/lib/test-network.c
M	src/lib/test-ostream-file.c
M	src/lib/test-primes.c
M	src/lib/test-priorityq.c
M	src/lib/test-seq-range-array.c
M	src/lib/test-str-find.c
M	src/lib/test-str-sanitize.c
M	src/lib/test-strescape.c
M	src/lib/test-strfuncs.c
M	src/lib/test-time-util.c
M	src/lib/test-utc-mktime.c
M	src/lib/test-var-expand.c
M	src/lib/time-util.c
M	src/lib/unichar.c
M	src/lib/unix-socket-create.c
M	src/lib/unlink-directory.c
M	src/lib/unlink-old-files.c
M	src/lib/utc-mktime.c
M	src/lib/utc-offset.c
M	src/lib/var-expand.c
M	src/lib/write-full.c
M	src/lmtp/client.c
M	src/lmtp/commands.c
M	src/lmtp/lmtp-proxy.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/main.c
M	src/log/log-connection.c
M	src/log/log-settings.c
M	src/log/main.c
M	src/login-common/access-lookup.c
M	src/login-common/client-common-auth.c
M	src/login-common/client-common.c
M	src/login-common/login-proxy-state.c
M	src/login-common/login-proxy.c
M	src/login-common/login-settings.c
M	src/login-common/main.c
M	src/login-common/sasl-server.c
M	src/login-common/ssl-proxy-gnutls.c
M	src/login-common/ssl-proxy-openssl.c
M	src/login-common/ssl-proxy.c
M	src/master/dup2-array.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/service-anvil.c
M	src/master/service-listen.c
M	src/master/service-log.c
M	src/master/service-monitor.c
M	src/master/service-process-notify.c
M	src/master/service-process.c
M	src/master/service.c
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/acl/acl-plugin.c
M	src/plugins/acl/acl-shared-storage.c
M	src/plugins/acl/acl-storage.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/expire/doveadm-expire.c
M	src/plugins/expire/expire-plugin.c
M	src/plugins/expire/expire-set.c
M	src/plugins/fts-lucene/fts-backend-lucene.c
M	src/plugins/fts-lucene/fts-lucene-plugin.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-solr/fts-solr-plugin.c
M	src/plugins/fts-solr/solr-connection.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts-squat/fts-squat-plugin.c
M	src/plugins/fts-squat/squat-test.c
M	src/plugins/fts-squat/squat-trie.c
M	src/plugins/fts-squat/squat-uidlist.c
M	src/plugins/fts/fts-api.c
M	src/plugins/fts/fts-plugin.c
M	src/plugins/fts/fts-search.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/mail-log/mail-log-plugin.c
M	src/plugins/quota/doveadm-quota.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-dict.c
M	src/plugins/quota/quota-dirsize.c
M	src/plugins/quota/quota-fs.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-plugin.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-plugin.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-search.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/zlib/doveadm-zlib.c
M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c
M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c
M	src/plugins/zlib/zlib-plugin.c
M	src/pop3-login/client-authenticate.c
M	src/pop3-login/client.c
M	src/pop3-login/pop3-login-settings.c
M	src/pop3-login/pop3-proxy.c
M	src/pop3/main.c
M	src/pop3/pop3-client.c
M	src/pop3/pop3-commands.c
M	src/pop3/pop3-settings.c
M	src/ssl-params/main.c
M	src/ssl-params/ssl-params-openssl.c
M	src/ssl-params/ssl-params-settings.c
M	src/ssl-params/ssl-params.c
M	src/util/gdbhelper.c
M	src/util/listview.c
M	src/util/maildirlock.c
M	src/util/rawlog.c
M	src/util/script-login.c
M	src/util/script.c
M	src/util/tcpwrap-settings.c
M	src/util/tcpwrap.c

2011-03-04 20:46:41 +0200 Timo Sirainen <tss@iki.fi> (ea2a425)

    lib-master: Added reconnection timeout to anvil client. Previously if anvil
    kept disconnecting, the client was rapidly flooding the logs with errors.


M	src/lib-master/anvil-client.c

2011-03-04 20:45:17 +0200 Timo Sirainen <tss@iki.fi> (698a439)

    master: Allow protocols value to be empty (= same as "none")


M	src/master/master-settings.c

2011-03-04 20:37:03 +0200 Timo Sirainen <tss@iki.fi> (29f32cd)

    master: Use per-services_list "master is dead" fd, so services know when
    config is reload.


M	src/master/common.h
M	src/master/main.c
M	src/master/service-monitor.c
M	src/master/service-process.c
M	src/master/service.c
M	src/master/service.h

2011-03-04 20:01:03 +0200 Timo Sirainen <tss@iki.fi> (b825078)

    master: Memory leak fix if services couldn't be initialized. (On config
    reload.)


M	src/master/service.c

2011-03-04 19:51:44 +0200 Timo Sirainen <tss@iki.fi> (2a70702)

    lib-sql: When adding more connections to sql pool, connect to them
    immediately.


M	src/lib-sql/driver-sqlpool.c

2011-03-04 19:51:06 +0200 Timo Sirainen <tss@iki.fi> (294c714)

    pgsql: Don't assert-crash if query fails when trying to send it.


M	src/lib-sql/driver-pgsql.c

2011-03-04 19:33:52 +0200 Timo Sirainen <tss@iki.fi> (554c1c7)

    pgsql: If host isn't given, don't show pgsql((null)) as log prefix (or
    crash).


M	src/lib-sql/driver-pgsql.c

2011-03-04 19:07:31 +0200 Timo Sirainen <tss@iki.fi> (515ec47)

    example-config: Added import_environment.


M	doc/example-config/dovecot.conf

2011-03-04 18:52:17 +0200 Timo Sirainen <tss@iki.fi> (5e992fc)

    login: Skip auth penalty checks from IPs in login_trusted_networks.


M	src/login-common/sasl-server.c

2011-03-04 18:51:46 +0200 Timo Sirainen <tss@iki.fi> (d8702d1)

    auth: Allow clients to specify that they want to skip auth penalty check.
    This is "safe", because the clients specify the IP for the penalty check
    anyway.


M	src/auth/auth-penalty.c
M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/lib-auth/auth-client-request.c
M	src/lib-auth/auth-client.h

2011-03-04 18:32:09 +0200 Timo Sirainen <tss@iki.fi> (f67059a)

    virtual: Allow search rule continuation lines to begin with tab as well as
    space.


M	src/plugins/virtual/virtual-config.c

2011-03-04 18:32:09 +0200 Timo Sirainen <tss@iki.fi> (ebc7480)

    virtual: Allow search rule continuation lines to begin with tab as well as
    space.


M	src/plugins/virtual/virtual-config.c

2011-03-04 18:31:02 +0200 Timo Sirainen <tss@iki.fi> (5000d15)

    lib-imap: imap_parser_finish_line() didn't return failure on invalid input.


M	src/lib-imap/imap-parser.c

2011-03-04 18:31:02 +0200 Timo Sirainen <tss@iki.fi> (1f0d01b)

    lib-imap: imap_parser_finish_line() didn't return failure on invalid input.


M	src/lib-imap/imap-parser.c

2011-03-04 18:20:38 +0200 Timo Sirainen <tss@iki.fi> (7baab0b)

    sdbox: Fixed creating mailbox with given GUID.


M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2011-03-04 18:19:56 +0200 Timo Sirainen <tss@iki.fi> (1c288c4)

    sdbox: Fixed creating mailbox with given GUID.


M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2011-03-04 18:09:01 +0200 Timo Sirainen <tss@iki.fi> (6bd9ffc)

    doveadm acl debug: If any errors are noticed, fix them.


M	src/plugins/acl/doveadm-acl.c

2011-03-04 18:09:01 +0200 Timo Sirainen <tss@iki.fi> (26a0113)

    doveadm acl debug: If any errors are noticed, fix them.


M	src/plugins/acl/doveadm-acl.c

2011-03-04 18:08:30 +0200 Timo Sirainen <tss@iki.fi> (579e706)

    acl: Added acl_backend_nonowner_lookups_rebuild()


M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-api.h
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend-vfile.h

2011-03-04 18:08:30 +0200 Timo Sirainen <tss@iki.fi> (83ecd8b)

    acl: Added acl_backend_nonowner_lookups_rebuild()


M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-api.h
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend-vfile.h

2011-03-04 17:57:29 +0200 Timo Sirainen <tss@iki.fi> (7b39597)

    doveadm acl debug: Compile fix for earlier change.


M	src/plugins/acl/doveadm-acl.c

2011-03-04 17:56:11 +0200 Timo Sirainen <tss@iki.fi> (7ce0510)

    doveadm: Added acl delete command.


M	src/plugins/acl/doveadm-acl.c

2011-03-04 17:56:11 +0200 Timo Sirainen <tss@iki.fi> (3aa600b)

    doveadm: Added acl delete command.


M	src/plugins/acl/doveadm-acl.c

2011-03-04 17:51:46 +0200 Timo Sirainen <tss@iki.fi> (8962fb6)

    doveadm acl debug: Show also if mailbox has private flags.


M	src/plugins/acl/doveadm-acl.c

2011-03-04 17:51:46 +0200 Timo Sirainen <tss@iki.fi> (facd097)

    doveadm acl debug: Show also if mailbox has private flags.


M	src/plugins/acl/doveadm-acl.c

2011-03-04 03:22:45 +0200 Timo Sirainen <tss@iki.fi> (fe25191)

    acl: Added doveadm plugin supporting acl get/set/rights/debug commands.


M	src/plugins/acl/Makefile.am
M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-lookup-dict.h
A	src/plugins/acl/doveadm-acl.c

2011-03-04 03:16:51 +0200 Timo Sirainen <tss@iki.fi> (08968b2)

    lib-storage: Fixed accessing shared mailboxes.


M	src/lib-storage/index/shared/shared-list.c

2011-03-04 03:16:25 +0200 Timo Sirainen <tss@iki.fi> (44fea1d)

    lib-storage: MAIL_STORAGE_SERVICE_FLAG_DEBUG didn't do anything.


M	src/lib-storage/mail-storage-service.c

2011-03-04 03:16:15 +0200 Timo Sirainen <tss@iki.fi> (7a330e7)

    lib-storage: MAIL_STORAGE_SERVICE_FLAG_DEBUG didn't do anything.


M	src/lib-storage/mail-storage-service.c

2011-03-04 03:03:26 +0200 Timo Sirainen <tss@iki.fi> (7c598f3)

    acl: Added doveadm acl debug command.


M	src/plugins/acl/acl-lookup-dict.c
M	src/plugins/acl/acl-lookup-dict.h
M	src/plugins/acl/doveadm-acl.c

2011-03-04 02:51:18 +0200 Timo Sirainen <tss@iki.fi> (78eb65c)

    acl: Fixed crash when acl_lookup_dict was disabled and user belonged to
    groups.


M	src/plugins/acl/acl-lookup-dict.c

2011-03-04 02:50:47 +0200 Timo Sirainen <tss@iki.fi> (fdf03f9)

    acl: Fixed crash when acl_lookup_dict was disabled and user belonged to
    groups.


M	src/plugins/acl/acl-lookup-dict.c

2011-03-04 02:13:26 +0200 Timo Sirainen <tss@iki.fi> (7d8afd1)

    acl: Added doveadm plugin supporting acl get/set/rights commands.


M	src/plugins/acl/Makefile.am
M	src/plugins/acl/acl-api-private.h
M	src/plugins/acl/acl-api.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
A	src/plugins/acl/doveadm-acl.c

2011-03-02 15:52:10 +0200 Timo Sirainen <tss@iki.fi> (27caac4)

    mdbox purge: Fixes to handling corrupted mdbox files.


M	src/lib-storage/index/dbox-multi/mdbox-purge.c

2011-03-02 15:51:28 +0200 Timo Sirainen <tss@iki.fi> (57f4bbb)

    mdbox: Storage rebuilding may have skipped over messages if the file was
    already at EOF. Probably didn't happen except when purging noticed
    corruption and triggered index rebuild.


M	src/lib-storage/index/dbox-common/dbox-file.c

2011-03-02 14:57:58 +0200 Timo Sirainen <tss@iki.fi> (5fbf871)

    mysql/pgsql: Log prefixes now contain also the hostname. This is useful when
    there are multiple hosts in use.


M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c

2011-02-28 19:52:10 +0200 Timo Sirainen <tss@iki.fi> (9b0c832)

    lib-charset: Skip over only invalid characters, not entire buffers around
    them.


M	src/lib-charset/charset-iconv.c

2011-02-28 19:20:00 +0200 Timo Sirainen <tss@iki.fi> (db654c7)

    doveadm import: Fixed potential memory corruption.


M	src/doveadm/doveadm-mail-import.c

2011-02-28 18:57:21 +0200 Timo Sirainen <tss@iki.fi> (2f414d7)

    doveadm: Unload plugins only after calling command's deinit() function. This
    fixes a crash on deinit when using a plugin that hooks into user.deinit().


M	src/doveadm/doveadm-mail.c

2011-02-28 17:50:41 +0200 Timo Sirainen <tss@iki.fi> (218153e)

    doveadm: Memory leak fix.


M	src/doveadm/doveadm-mail.c

2011-02-28 17:34:24 +0200 Timo Sirainen <tss@iki.fi> (3dadeec)

    auth: Log a warning if ldap attribute has unexpectedly multiple values.


M	src/auth/auth-request.c
M	src/auth/auth-request.h
M	src/auth/db-ldap.c
M	src/auth/db-ldap.h
M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2011-02-28 16:34:04 +0200 Timo Sirainen <tss@iki.fi> (fafe153)

    lib-storage: Crashfix on thread handling.


M	src/lib-storage/index/index-thread.c

2011-02-28 16:33:50 +0200 Timo Sirainen <tss@iki.fi> (29371e6)

    imapc: Use multiple client connections when necessary. Some other fixes.


M	src/lib-storage/index/imapc/imapc-client-private.h
M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-02-28 16:03:40 +0200 Timo Sirainen <tss@iki.fi> (b2be590)

    lib-storage: Failures when building thread index were hidden.


M	src/lib-storage/index/index-thread.c

2011-02-28 13:13:38 +0200 Timo Sirainen <tss@iki.fi> (7b8d53b)

    imapc: Fixed sending large streams in commands (APPEND)


M	src/lib-storage/index/imapc/imapc-connection.c

2011-02-25 10:55:34 +0200 Timo Sirainen <tss@iki.fi> (c3a0b43)

    lib-index: If keyword is added and remove within transaction, don't write a
    broken keyword update. This could have caused "No UID ranges (type=0x400)"
    errors.


M	src/lib-index/mail-index-transaction-export.c

2011-02-24 17:06:41 +0200 Timo Sirainen <tss@iki.fi> (9106fd9)

    imapc: Don't try to wait for FETCH to return messages that are known to be
    expunged.


M	src/lib-storage/index/imapc/imapc-search.c

2011-02-24 15:37:22 +0200 Timo Sirainen <tss@iki.fi> (92927ce)

    imapc: Fixes to handling FETCH commands.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-search.c

2011-02-24 15:17:47 +0200 Timo Sirainen <tss@iki.fi> (df48643)

    imapc: Many fixes related to syncing and error handling.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-seqmap.c
M	src/lib-storage/index/imapc/imapc-seqmap.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/imapc/imapc-sync.h

2011-02-24 13:19:05 +0200 Timo Sirainen <tss@iki.fi> (1727610)

    lib-index: Give better assert-crashes if view or log view isn't closed.
    Earlier it should have also assert-crashed with "log->files == NULL", which
    didn't make it clear enough why the files aren't NULL.


M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-view.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-view.c
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/mail-transaction-log.h

2011-02-24 12:57:31 +0200 Timo Sirainen <tss@iki.fi> (ad99e7b)

    ioloop: Memory leak fix.


M	src/lib/ioloop.c

2011-02-24 11:27:42 +0200 Timo Sirainen <tss@iki.fi> (18aeafb)

    imapc: Fixed crashing in IDLE handling when server got disconnected.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-02-24 11:26:27 +0200 Timo Sirainen <tss@iki.fi> (d2470b3)

    Avoid unnecessary data stack leaks.


M	src/imap/imap-sync.c
M	src/lib-index/mail-index-transaction.c
M	src/lib/process-title.c

2011-02-24 11:02:29 +0200 Timo Sirainen <tss@iki.fi> (fad068d)

    lib-index: If keyword is added and remove within transaction, don't write a
    broken keyword update. This could have caused "No UID ranges (type=0x400)"
    errors.


M	src/lib-index/mail-index-transaction-export.c

2011-02-22 15:49:14 +0200 Timo Sirainen <tss@iki.fi> (40b9f64)

    NEWS updated with initial list of new features.


M	NEWS

2011-02-22 15:49:04 +0200 Timo Sirainen <tss@iki.fi> (e686128)

    TODO updated


M	TODO

2011-02-22 15:44:42 +0200 Timo Sirainen <tss@iki.fi> (a37c2c1)

    config: Fixed converting old auth/mail_process_size settings.


M	src/config/old-set-parser.c

2011-02-22 15:31:31 +0200 Timo Sirainen <tss@iki.fi> (072f06b)

    Merged changes from v2.0 tree.


2011-02-22 15:02:23 +0200 Timo Sirainen <tss@iki.fi> (6851806)

    config: Previous commit allows removing "0" from strlist/0/key=value output.


M	src/config/config-request.c

2011-02-22 15:00:37 +0200 Timo Sirainen <tss@iki.fi> (c155262)

    lib-settings: Fixed setting "strlist/key=value" when strlist hadn't been
    initialized yet. This happened when using -O parameter.


M	src/lib-settings/settings-parser.c

2011-02-22 13:57:20 +0200 Timo Sirainen <tss@iki.fi> (d7ec9b4)

    lib-lda: Added submission_host setting to send mails via SMTP instead of
    sendmail.


M	doc/example-config/conf.d/15-lda.conf
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lda-settings.h
M	src/lib-lda/smtp-client.c

2011-02-22 11:59:57 +0200 Timo Sirainen <tss@iki.fi> (d8f73a4)

    imap: Fixed infinite loop / memory eating with SEARCHRES + pipelining $. If
    SEARCH RETURN (SAVE) command was running long enough so that Dovecot started
    executing the next command, and if that command used $ in messageset,
    Dovecot went into infinite function recursion.


M	src/imap/imap-client.c
M	src/imap/imap-client.h

2011-02-22 11:14:31 +0200 Mike Kazantsev (sacrilege) <mk.fraggod@gmail.com> (9f1461d)

    systemd service: added [Install] section, so it can be used independently
    from dovecot.socket


M	dovecot.service.in

2011-02-22 11:04:55 +0200 Timo Sirainen <tss@iki.fi> (88339cc)

    doveadm expire: Added more error and debug messages.


M	src/plugins/expire/doveadm-expire.c

2011-02-22 10:43:28 +0200 Timo Sirainen <tss@iki.fi> (f0b3362)

    doveadm import: Settings weren't correctly used for the import storage. For
    example plugins weren't loaded, causing problems with zlib compressed
    messages.


M	src/doveadm/doveadm-mail-import.c

2011-02-22 10:21:26 +0200 Timo Sirainen <tss@iki.fi> (6f0bb99)

    lib-index: Verify that expunge-guid records have valid UID.


M	src/lib-index/mail-transaction-log-view.c

2011-02-19 16:56:21 +0200 Timo Sirainen <tss@iki.fi> (b9fdd5b)

    Fixed compiling with configure --with-storages when imapc wasn't listed.


M	configure.in
M	src/lib-storage/register/Makefile.am

2011-02-19 16:46:14 +0200 Timo Sirainen <tss@iki.fi> (a5c81d7)

    fs layout: Fixed crash on listing % when namespace had a prefix.


M	src/lib-storage/mailbox-list.c

2011-02-19 16:42:45 +0200 Timo Sirainen <tss@iki.fi> (97dc390)

    imapc: Added more debugging output with mail_debug=yes


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-storage.c

2011-02-18 05:56:38 +0200 Timo Sirainen <tss@iki.fi> (ebc49d9)

    Compiler warning fix.


M	src/plugins/zlib/doveadm-zlib.c

2011-02-18 05:55:34 +0200 Timo Sirainen <tss@iki.fi> (296857b)

    Added uni_utf8_data_is_valid().


M	src/lib/unichar.c
M	src/lib/unichar.h

2011-02-17 18:02:45 +0200 Timo Sirainen <tss@iki.fi> (c2d29d9)

    Makefile: Added missing imapc-client*.h


M	src/lib-storage/index/imapc/Makefile.am

2011-02-17 15:30:46 +0000 Pascal Volk <user@localhost.localdomain.org> (656393f)

    man: Storage quota values are reported in kilobytes.


M	doc/man/doveadm-quota.1.in

2011-02-17 10:57:05 +0200 Timo Sirainen <tss@iki.fi> (e2c9c32)

    dsync: Flush workers' output earlier when saving messages.


M	src/dsync/dsync-brain-msgs-new.c

2011-02-17 10:55:38 +0200 Timo Sirainen <tss@iki.fi> (aa7b953)

    dsync: Error handling fix to "proxy client timed out".


M	src/dsync/dsync-proxy-client.c

2011-02-17 10:55:07 +0200 Timo Sirainen <tss@iki.fi> (69c1f04)

    dsync: Fixed somewhat random failures with saving messages to remote dsync.


M	src/dsync/dsync-proxy-client.c

2011-02-17 09:54:26 +0200 Timo Sirainen <tss@iki.fi> (647a011)

    dbox index rebuild: If alt dir isn't mounted (can't be mkdir()ed), abort
    rebuild.


M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.c
M	src/lib-storage/index/dbox-common/dbox-sync-rebuild.h
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c

2011-02-17 09:32:35 +0200 Timo Sirainen <tss@iki.fi> (b22f7b9)

    dbox: Check that attachment extref parts won't point outside message.


M	src/lib-storage/index/dbox-common/dbox-attachment.c

2011-02-17 09:28:55 +0200 Timo Sirainen <tss@iki.fi> (843197a)

    istream-limit: Allow seeking past limit without assert-crashing. The next
    read() will simply return EOF.


M	src/lib/istream-limit.c

2011-02-17 09:01:38 +0200 Timo Sirainen <tss@iki.fi> (04b7323)

    example-config: mail_max_userip_connections default is 10, even for pop3. 3
    would probably be better, but there's no way to set per-protocol defaults
    currently.


M	doc/example-config/conf.d/20-pop3.conf

2011-02-17 08:58:43 +0200 Timo Sirainen <tss@iki.fi> (6df2db1)

    pgsql: Added assert.


M	src/lib-sql/driver-pgsql.c

2011-02-17 08:41:46 +0200 Timo Sirainen <tss@iki.fi> (f119596)

    pgsql: Don't assert-crash on "query timed out" error.


M	src/lib-sql/driver-pgsql.c

2011-02-17 08:29:47 +0200 Timo Sirainen <tss@iki.fi> (874766f)

    lib-storage: Fixed renaming mailboxes in a non-private namespace.


M	src/lib-storage/mail-storage.c

2011-02-17 08:12:21 +0200 Timo Sirainen <tss@iki.fi> (fcd443a)

    lmtp: Don't forget LHLO host when sending multiple messages in session.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c

2011-02-17 07:45:30 +0200 Timo Sirainen <tss@iki.fi> (8471121)

    imapc: When local IDLE is started, force remote server to first check
    changes with NOOP. This is makes clicking Thunderbird's "get mail" button to
    check for new mails with servers that don't notify about them immediately
    after they arrive.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-02-12 06:06:32 +0200 Timo Sirainen <tss@iki.fi> (31277bf)

    imapc: Mailbox listing code works now perfectly.


M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h

2011-02-12 06:05:40 +0200 Timo Sirainen <tss@iki.fi> (a0cda1e)

    lib-storage: Fixes to mailbox_list_iter_update()


M	src/lib-storage/mailbox-list.c

2011-02-12 06:05:07 +0200 Timo Sirainen <tss@iki.fi> (688d869)

    lib-storage: mailbox_list_mailbox() should have replaced info flags, not
    updated them. Many callers didn't have the flags cleared before calling it.


M	src/lib-storage/mailbox-list.c

2011-02-12 01:29:20 +0200 Timo Sirainen <tss@iki.fi> (c283913)

    lib-storage: Added mailbox_tree_set_separator()


M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-tree.h

2011-02-12 01:09:10 +0200 Timo Sirainen <tss@iki.fi> (45baf5d)

    lib-storage: Minor code cleanup.


M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c

2011-02-12 05:32:25 +0200 Timo Sirainen <tss@iki.fi> (9b2bbd8)

    lib-storage: When listing subscriptions, make sure children flags are
    returned if requested.


M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h

2011-02-12 05:31:32 +0200 Timo Sirainen <tss@iki.fi> (c4529ff)

    printf_format_fix*() assert-crashed if the format ended with "%%".


M	src/lib/printf-format-fix.c

2011-02-12 05:17:12 +0200 Timo Sirainen <tss@iki.fi> (047e3bb)

    lib-storage: layout=fs now uses mailbox_exists() instead of requiring
    storage hooks.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/plugins/virtual/virtual-storage.c

2011-02-12 05:12:36 +0200 Timo Sirainen <tss@iki.fi> (68d9813)

    lib-storage: mailbox_create() failed if it was done to \noselect mailbox.


M	src/lib-storage/mail-storage.c

2011-02-12 04:59:44 +0200 Timo Sirainen <tss@iki.fi> (c8db5bc)

    lib-storage: mailbox_list_index setting meaning was reversed.


M	src/lib-storage/list/index-mailbox-list.c

2011-02-12 04:50:03 +0200 Timo Sirainen <tss@iki.fi> (c292166)

    lib-storage: mailbox_exists() can now return if it's selectable or
    non-selectable.


M	src/imap/cmd-subscribe.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/autocreate/autocreate-plugin.c

2011-02-12 00:48:47 +0200 Timo Sirainen <tss@iki.fi> (4ba962c)

    lib-storage: Changed mailbox_list.subscriptions_refresh() API to be more
    flexible. The new API makes it easier implement subscriptions=no to a
    backend that doesn't use the regular subscriptions file.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/mailbox-list-subscriptions.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c

2011-02-12 00:38:09 +0200 Timo Sirainen <tss@iki.fi> (c563c72)

    lib-storage: Mailbox list indexes are now enabled also for in-memory
    indexes.


M	src/lib-storage/list/index-mailbox-list.c

2011-02-12 00:16:06 +0200 Timo Sirainen <tss@iki.fi> (4b2e3b3)

    lib-storage: Don't allow renaming mailbox under another one with different
    permissions. This is mainly to avoid any weird situations arising with
    shared mailboxes.


M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c

2011-02-12 00:15:04 +0200 Timo Sirainen <tss@iki.fi> (73408e5)

    lib-storage: Crashfix to removing deleted mailboxes from mailbox list index.


M	src/lib-storage/list/index-mailbox-list.c

2011-02-12 00:02:02 +0200 Timo Sirainen <tss@iki.fi> (d06c460)

    lib-storage: When creating a new mailbox, get permissions from its parent
    mailbox, not root.


M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/mailbox-list.c

2011-02-11 23:44:39 +0200 Timo Sirainen <tss@iki.fi> (44aef64)

    auth: If username contains invalid chars, log sanitized username even
    without auth_debug.


M	src/auth/auth-request.c

2011-02-11 23:35:52 +0200 Timo Sirainen <tss@iki.fi> (1be7880)

    doveadm: Previous mailbox create -s fix broke -A/-u parameters. Fixed now
    properly the root cause: -S parameter was handled as -s by getopt.


M	src/doveadm/doveadm-mail.c

2011-02-10 14:58:43 +0100 Dennis Schridde <devurandom@gmx.net> (10823ce)

    Put modulename in quotes when complaining about its non-existence


M	src/lib/module-dir.c

2011-02-10 03:03:28 +0200 Timo Sirainen <tss@iki.fi> (303afe9)

    master: Change stderr to /dev/null just before forking.


M	src/master/main.c

2011-02-10 02:51:22 +0200 Timo Sirainen <tss@iki.fi> (33a8963)

    istream-header-filter: Fixes handling HEADER_FILTER_END_BODY_WITH_LF
    correctly.


M	src/lib-mail/istream-header-filter.c

2011-02-10 02:21:03 +0200 Timo Sirainen <tss@iki.fi> (87a861a)

    Maildir++: Fixed crash when listing subscriptions for a subscriptions=no
    namespace from LAYOUT=fs namespace.


M	src/lib-storage/list/mailbox-list-maildir.c

2011-02-10 01:54:26 +0200 Timo Sirainen <tss@iki.fi> (d5eb47a)

    Added import_environment setting. This also cleans up different places in
    code where TZ and other environments are preserved. If it's not in the
    import_environment setting, it's not preserved.


M	src/doveadm/doveadm.c
M	src/lib-lda/smtp-client.c
M	src/lib-master/master-interface.h
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h
M	src/lib-storage/mail-storage-service.c
M	src/master/main.c
M	src/master/master-settings.c
M	src/master/master-settings.h
M	src/master/service-process.c
M	src/master/service.c
M	src/master/service.h

2011-02-10 00:45:51 +0200 Timo Sirainen <tss@iki.fi> (76ed4f8)

    doveadm: Fixed giving parameters to mail commands.


M	src/doveadm/doveadm-mail.c

2011-02-09 02:26:44 +0200 Timo Sirainen <tss@iki.fi> (461fecc)

    lib-storage: Use RECENT count in mailbox list index to set \Marked and
    \UnMarked LIST flag.


M	src/lib-storage/list/index-mailbox-list-status.c
M	src/lib-storage/list/index-mailbox-list.c
M	src/lib-storage/list/index-mailbox-list.h

2011-02-09 02:25:47 +0200 Timo Sirainen <tss@iki.fi> (4373a04)

    lib-storage: Update mailbox list indexes also after each transaction commit.
    Fixed RECENT counter.


M	src/lib-storage/list/index-mailbox-list-status.c

2011-02-09 01:58:56 +0200 Timo Sirainen <tss@iki.fi> (dae6f47)

    lmtp: Fixed crash at startup.


M	src/lmtp/client.c

2011-02-09 01:54:34 +0200 Timo Sirainen <tss@iki.fi> (828a1be)

    lda: Fixed crash at startup.


M	src/lda/main.c

2011-02-09 01:31:40 +0200 Timo Sirainen <tss@iki.fi> (c0d0699)

    lib-storage: Return STATUS replies from mailbox list index only when it's
    fully up-to-date.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-sync.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.h
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/list/index-mailbox-list-status.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2011-02-08 22:54:14 +0200 Timo Sirainen <tss@iki.fi> (2c01200)

    lib-storage: Mailbox list indexes now refresh the index on
    create/delete/rename.


M	src/lib-storage/list/index-mailbox-list-status.c
M	src/lib-storage/list/index-mailbox-list.c
M	src/lib-storage/list/index-mailbox-list.h

2011-02-08 22:18:14 +0200 Timo Sirainen <tss@iki.fi> (b84451f)

    lib-index: sync_stamp and sync_size fields are unused, mark them as such.


M	src/doveadm/doveadm-dump-index.c
M	src/doveadm/doveadm-dump-log.c
M	src/lib-index/mail-index.h

2011-02-08 22:17:44 +0200 Timo Sirainen <tss@iki.fi> (8bf9b56)

    mbox: No longer try to preserve sync stamps from v1.0 mbox index files. The
    worst that can happen is if a v1.0 user upgrades to v2.1, an mbox gets
    resynced unnecessarily.


M	src/lib-storage/index/mbox/mbox-sync.c

2011-02-08 03:31:46 +0200 Timo Sirainen <tss@iki.fi> (6ef23d3)

    lib-master: If post-login socket disconnects unexpectedly, suggest
    process_limit being the reason.


M	src/lib-master/master-auth.c

2011-02-08 03:31:01 +0200 Timo Sirainen <tss@iki.fi> (f7f13e2)

    master: If process limit is reached, just accept and close the client
    connection. This makes it a bit clearer what the problem is, so that client
    can log a better error message.


M	src/master/service-monitor.c

2011-02-08 01:36:19 +0200 Timo Sirainen <tss@iki.fi> (16f5ed4)

    lib-index: Removed the old "mailbox list" type index, which is no longer
    used. It was rather overdesigned and fragile.


M	src/lib-index/Makefile.am
D	src/lib-index/mailbox-list-index-private.h
D	src/lib-index/mailbox-list-index-sync.c
D	src/lib-index/mailbox-list-index.c
D	src/lib-index/mailbox-list-index.h
M	src/util/Makefile.am
D	src/util/listview.c

2011-02-08 01:35:45 +0200 Timo Sirainen <tss@iki.fi> (dc53fff)

    lib-storage: Initial commit for rewritten mailbox list indexes code. They're
    only enabled with mailbox_list_index=yes setting (default is no). They can
    also get out of sync pretty easily currently.


M	src/lib-storage/list/Makefile.am
A	src/lib-storage/list/index-mailbox-list-status.c
D	src/lib-storage/list/index-mailbox-list-sync.c
M	src/lib-storage/list/index-mailbox-list.c
M	src/lib-storage/list/index-mailbox-list.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/mail-storage.c

2011-02-08 00:08:38 +0200 Timo Sirainen <tss@iki.fi> (8f430e2)

    lib-index: Avoid writing tail offset unnecessarily to transaction log file.
    This could have happened with MAIL_INDEX_TRANSACTION_FLAG_AVOID_FLAG_UPDATES
    when all flag updates were cancelled and no other changes were done.


M	src/lib-index/mail-transaction-log-append.c

2011-02-08 00:06:28 +0200 Timo Sirainen <tss@iki.fi> (9a0cde2)

    lib-storage: Crashfix to layout=fs.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2011-02-07 22:37:45 +0200 Timo Sirainen <tss@iki.fi> (f3e1772)

    lib-storage: Give restrict_access() uid/gid source (userdb or mail_u/gid
    setting).


M	src/lib-storage/mail-storage-service.c

2011-02-07 22:37:19 +0200 Timo Sirainen <tss@iki.fi> (42c9dff)

    restrict_access(): Show uid/gid source in setuid()/setgid() failure messages
    if given.


M	src/lib/restrict-access.c
M	src/lib/restrict-access.h

2011-02-05 04:43:49 +0200 Timo Sirainen <tss@iki.fi> (cb933f0)

    lib-storage: Crashfix.


M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mailbox-list.c

2011-02-04 19:48:29 +0200 Timo Sirainen <tss@iki.fi> (7b22071)

    lmtp: Fixed handling recipient_delimiter when it was found from domain name.


M	src/lmtp/commands.c

2011-02-02 23:58:32 +0200 Timo Sirainen <tss@iki.fi> (c135b70)

    imap: Fixed a hang when trying to COPY to a nonexistent mailbox.


M	src/imap/cmd-copy.c

2011-02-02 05:33:04 +0200 Timo Sirainen <tss@iki.fi> (b13f738)

    lib-storage: Cleaned up subscription listing internally. The subscription
    listing code is now mostly separated from the mailbox listing code.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/index-mailbox-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/mailbox-list-subscriptions.h
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/list/subscription-file.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-tree.c
M	src/lib-storage/mailbox-tree.h

2011-02-02 05:31:46 +0200 Timo Sirainen <tss@iki.fi> (c5f13b6)

    IMAP LIST: Never return subscribed children state if RECURSIVEMATCH isn't
    specified. Not even when backends give it automatically.


M	src/imap/cmd-list.c

2011-02-02 01:43:08 +0200 Timo Sirainen <tss@iki.fi> (8c98b8a)

    imapc: Support IDLE even if remote IMAP server doesn't support it.


M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-02-02 01:27:50 +0200 Timo Sirainen <tss@iki.fi> (e594141)

    autocreate: Redesigned autocreate plugin to create/subscribe mailboxes
    lazily. Mailboxes are listed as if they existed, but they're not created
    until the mailbox is opened for the first time. Mailboxes are autosubscribed
    only during mailbox creation, so subscription file isn't unnecessarily being
    read all the time either.

    This lazy creation also means that if autocreate mailbox is removed from 
    configuration and it was never opened by the client, it was also never 
    physically created.

M	src/plugins/autocreate/Makefile.am
M	src/plugins/autocreate/autocreate-plugin.c

2011-02-02 01:17:59 +0200 Timo Sirainen <tss@iki.fi> (294658a)

    lib-storage: Fixed mailbox listing with Maildir++ layout


M	src/lib-storage/list/mailbox-list-maildir-iter.c

2011-02-02 01:14:57 +0200 Timo Sirainen <tss@iki.fi> (9f46aa4)

    lib-storage: Made struct mailbox_list_iterate_context usable for plugins.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mailbox-list-private.h

2011-02-01 21:07:27 +0200 Timo Sirainen <tss@iki.fi> (70d86de)

    maildir: Avoid stat()ing dovecot-shared unnecessarily.


M	src/lib-storage/index/maildir/maildir-storage.c

2011-02-01 20:59:21 +0200 Timo Sirainen <tss@iki.fi> (e5aa8d4)

    lib-storage: Merged returning dir mode into
    mailbox_list_get_[root_]permissions().


M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/lib-storage/mailbox-uidvalidity.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/quota/quota-maildir.c

2011-02-01 20:41:54 +0200 Timo Sirainen <tss@iki.fi> (636f017)

    lib-storage: Mailbox virtual names are now in UTF-8 format, not IMAP mUTF-7.
    Plugins that use mailbox names in configuration now take them also as UTF-8
    rather than mUTF-7.


M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/imap/cmd-list.c
M	src/imap/cmd-subscribe.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-fetch.c
M	src/lda/main.c
M	src/lib-lda/mail-deliver.c
M	src/lib-storage/mail-search-register-human.c
M	src/lib-storage/mail-search-register-imap.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c

2011-02-01 20:37:17 +0200 Timo Sirainen <tss@iki.fi> (2c88845)

    imapc: Don't use uninitialized variable.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-02-01 19:19:01 +0200 Timo Sirainen <tss@iki.fi> (c458d2e)

    imapc: Default imapc_user to %u.


M	src/lib-storage/index/imapc/imapc-settings.c
M	src/lib-storage/index/imapc/imapc-storage.c

2011-02-01 19:17:36 +0200 Timo Sirainen <tss@iki.fi> (dfaefea)

    imapc: Don't force a root directory to exist.


M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2011-02-01 19:05:54 +0200 Timo Sirainen <tss@iki.fi> (c5d6b45)

    imapc: Moved settings from plugin {} section to proper imapc_* settings.


M	src/lib-storage/index/imapc/Makefile.am
A	src/lib-storage/index/imapc/imapc-settings.c
A	src/lib-storage/index/imapc/imapc-settings.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-01-31 19:29:17 +0200 Timo Sirainen <tss@iki.fi> (241ab33)

    imapc: Added support for STARTTLS.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c

2011-01-31 19:29:04 +0200 Timo Sirainen <tss@iki.fi> (9ab0786)

    lib-ssl-iostream: Don't hang if given output stream is in corked state.


M	src/lib-ssl-iostream/iostream-openssl.c

2011-01-31 19:05:18 +0200 Timo Sirainen <tss@iki.fi> (7eb799c)

    imapc: Avoid hanging with SSL


M	src/lib-storage/index/imapc/imapc-connection.c

2011-01-31 19:01:58 +0200 Timo Sirainen <tss@iki.fi> (ce03ab1)

    imapc: Don't use AUTHENTICATE PLAIN if server doesn't advertise AUTH=PLAIN
    capability.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c

2011-01-31 19:01:22 +0200 Timo Sirainen <tss@iki.fi> (de0170f)

    imapc: Fixed LIST/LSUB handling.


M	src/lib-storage/index/imapc/imapc-list.c

2011-01-31 19:00:57 +0200 Timo Sirainen <tss@iki.fi> (5235a79)

    imapc: Fixed sending STATUS command.


M	src/lib-storage/index/imapc/imapc-storage.c

2011-01-31 18:46:42 +0200 Timo Sirainen <tss@iki.fi> (bec25e9)

    Makefile: Build lib-ssl-iostream earlier


M	src/Makefile.am

2011-01-31 18:41:04 +0200 Timo Sirainen <tss@iki.fi> (bfc7fcd)

    imapc: Added initial support for SSL.


M	configure.in
M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-client-private.h
M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-storage.c

2011-01-31 18:40:27 +0200 Timo Sirainen <tss@iki.fi> (e98de01)

    Added lib-ssl-iostream for handling SSL connections more easily.


M	configure.in
M	src/Makefile.am
A	src/lib-ssl-iostream/Makefile.am
A	src/lib-ssl-iostream/iostream-openssl-context.c
A	src/lib-ssl-iostream/iostream-openssl-params.c
A	src/lib-ssl-iostream/iostream-openssl.c
A	src/lib-ssl-iostream/iostream-openssl.h
A	src/lib-ssl-iostream/iostream-ssl.h
A	src/lib-ssl-iostream/istream-openssl.c
A	src/lib-ssl-iostream/ostream-openssl.c

2011-01-31 04:02:04 +0200 Timo Sirainen <tss@iki.fi> (8a26102)

    imapc: Write large message bodies to temp files rather than keeping in
    memory.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-01-31 04:00:44 +0200 Timo Sirainen <tss@iki.fi> (f6a8cd6)

    lib-imap: struct imap_arg.str_size now contains the string value lengths.
    This is especially useful for literals that might contain NUL bytes.


M	src/lib-imap/imap-arg.h
M	src/lib-imap/imap-parser.c

2011-01-31 02:17:26 +0200 Timo Sirainen <tss@iki.fi> (5fa6399)

    lib-storage: Threading code uses now separate extra_wanted_headers also.


M	src/lib-storage/index/index-thread.c

2011-01-31 02:13:51 +0200 Timo Sirainen <tss@iki.fi> (e3f2f1b)

    imapc: Fixed sending single FETCH queries.


M	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-search.c

2011-01-31 02:13:06 +0200 Timo Sirainen <tss@iki.fi> (e29f8a6)

    lib-storage: Moved setting "wanted fields/headers" fields for sort program
    from imap-specific code. Also separate between fields that are actually
    wanted to be fetched from the fields that sorting wants to temporarily use.


M	src/imap/imap-search.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-search-private.h
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-sort.c
M	src/lib-storage/mail-storage-private.h

2011-01-31 01:36:29 +0200 Timo Sirainen <tss@iki.fi> (d164cc3)

    imapc: Minor code cleanup


M	src/lib-storage/index/imapc/imapc-search.c

2011-01-31 00:27:53 +0200 Timo Sirainen <tss@iki.fi> (b3f46fa)

    lib-sql: Implemented sql_result_get_field_value_binary() for MySQL.


M	src/lib-sql/driver-mysql.c

2011-01-30 23:57:14 +0200 Timo Sirainen <tss@iki.fi> (e1e6235)

    dovecot-config, dovecot.m4: Export SQL_LIBS as DOVECOT_SQL_LIBS


M	dovecot-config.in.in
M	dovecot.m4

2011-01-30 23:56:23 +0200 Timo Sirainen <tss@iki.fi> (6facdb0)

    lib-sql: Install libdovecot-sql.so as well.


M	src/lib-sql/Makefile.am

2011-01-30 23:16:46 +0200 Timo Sirainen <tss@iki.fi> (020f198)

    lib-storage: layout=noop now shows INBOX as existing if namespace has
    inbox=yes. It also shows INBOX as always being subscribed.


M	src/lib-storage/list/mailbox-list-none.c

2011-01-30 20:47:43 +0200 Timo Sirainen <tss@iki.fi> (94a77d6)

    imapc: Send UID FETCH commands with larger uidset parameter if possible.
    This code assumes that server doesn't reorganize FETCH replies when it's
    given an increasing UID range, which in theory IMAP server would be allowed
    to do, but I doubt there are any.


M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-client-private.h
M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-mail.c
A	src/lib-storage/index/imapc/imapc-mail.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h

2011-01-30 20:16:04 +0200 Timo Sirainen <tss@iki.fi> (56b8bee)

    lib-storage: Index search context is now more accessible by backends. Moved
    struct index_search_context to index-search-private.h and added
    recheck_index_args flag that backends can set.


M	src/lib-storage/index/Makefile.am
A	src/lib-storage/index/index-search-private.h
M	src/lib-storage/index/index-search.c

2011-01-30 17:51:17 +0200 Timo Sirainen <tss@iki.fi> (7d41c5a)

    script: Root permissions weren't being dropped before executing the script.


M	src/util/script.c

2011-01-30 17:51:17 +0200 Timo Sirainen <tss@iki.fi> (00c45bd)

    script: Root permissions weren't being dropped before executing the script.


M	src/util/script.c

2011-01-28 19:41:03 +0200 Timo Sirainen <tss@iki.fi> (bd4cc8e)

    script utility now supports the script using stdio/stdout for communication.


M	src/plugins/quota/quota.c
M	src/util/script.c

2011-01-28 19:39:00 +0200 Timo Sirainen <tss@iki.fi> (13aff14)

    imapc: If mail's input stream is changed, don't assume virtual size =
    physical size.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-search.c

2011-01-28 17:57:21 +0200 Timo Sirainen <tss@iki.fi> (689b06e)

    imapc: Added support for saving and copying messages.


M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-save.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-01-26 21:47:52 +0200 Timo Sirainen <tss@iki.fi> (562d0d9)

    ioloop: Use -1 for infinite poll/epoll timeout rather than INT_MAX. Should
    improve performance a tiny bit and also works around a CPU eater bug in
    Linux 2.6.37.


M	src/lib/ioloop.c

2011-01-26 21:47:52 +0200 Timo Sirainen <tss@iki.fi> (61cb43e)

    ioloop: Use -1 for infinite poll/epoll timeout rather than INT_MAX. Should
    improve performance a tiny bit and also works around a CPU eater bug in
    Linux 2.6.37.


M	src/lib/ioloop.c

2011-01-25 17:35:32 +0200 Timo Sirainen <tss@iki.fi> (04807a2)

    imapc: Syncing optimization: Don't wait for STOREs to complete before
    sending EXPUNGE.


M	src/lib-storage/index/imapc/imapc-sync.c

2011-01-25 17:23:52 +0200 Timo Sirainen <tss@iki.fi> (934dbb1)

    imapc: Added support for changing flags and expunging.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-sync.c
M	src/lib-storage/index/imapc/imapc-sync.h

2011-01-25 17:15:54 +0200 Timo Sirainen <tss@iki.fi> (83a03a4)

    imapc: Added support for keywords.


M	src/lib-storage/index/imapc/imapc-mailbox.c

2011-01-25 00:32:50 +0200 Timo Sirainen <tss@iki.fi> (c58c120)

    lib-storage: Give a better error message if mail_location has INBOX but no
    mail root dir.


M	src/lib-storage/mailbox-list.c

2011-01-25 00:10:46 +0200 Timo Sirainen <tss@iki.fi> (8ff346c)

    dotlocks: When locking using hard links, make sure the dotlock's timestamp
    is new enough.


M	src/lib/file-dotlock.c

2011-01-24 00:42:29 +0200 Timo Sirainen <tss@iki.fi> (37f7496)

    dsync: Changes to make it work with imapc storage.


M	src/dsync/dsync-worker-local.c
M	src/dsync/dsync.c

2011-01-24 00:42:06 +0200 Timo Sirainen <tss@iki.fi> (9ca6d68)

    imapc: Fixed mail_set_seq/uid() to work.


M	src/lib-storage/index/imapc/imapc-mail.c
M	src/lib-storage/index/imapc/imapc-search.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-01-24 00:31:05 +0200 Timo Sirainen <tss@iki.fi> (5e04214)

    dbox: mailbox_create/update() might not have updated index header correctly.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c

2011-01-24 00:31:05 +0200 Timo Sirainen <tss@iki.fi> (84e49ad)

    dbox: mailbox_create/update() might not have updated index header correctly.


M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c

2011-01-24 00:00:02 +0200 Timo Sirainen <tss@iki.fi> (719bda7)

    imapc: Implemented more methods.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-01-23 23:32:52 +0200 Timo Sirainen <tss@iki.fi> (51130f0)

    imapc: Fixed mailbox deletion and some error handling. Code cleanups.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-sync.c

2011-01-23 23:32:34 +0200 Timo Sirainen <tss@iki.fi> (56c0277)

    lib-storage: Don't fail mailbox deletion if backend doesn't support mailbox
    GUIDs.


M	src/lib-storage/index/index-storage.c

2011-01-23 22:58:34 +0200 Timo Sirainen <tss@iki.fi> (494a5de)

    lib-storage: Recent changes accidentally made INBOX case-sensitive.


M	src/lib-storage/mailbox-list.c

2011-01-23 22:57:01 +0200 Timo Sirainen <tss@iki.fi> (6f9a5ec)

    imapc: Handle properly mailbox changes while it's selected. Added support
    for IDLE.


M	src/lib-storage/index/imapc/imapc-client.c
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-connection.h
M	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/index/imapc/imapc-sync.c

2011-01-23 20:26:02 +0200 Timo Sirainen <tss@iki.fi> (c291de4)

    imapc: Fixed seqmap to work. The algorithm is a bit slow, could be improved.
    But probably won't make much of a difference in real life.


M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-seqmap.c
A	src/lib-storage/index/imapc/test-imapc-seqmap.c

2011-01-21 21:46:24 +0200 Timo Sirainen <tss@iki.fi> (6d3ebef)

    IDLE: Don't assert-crash if IDLE+DONE is sent in same TCP packet.


M	src/imap/cmd-idle.c

2011-01-21 19:16:34 +0200 Timo Sirainen <tss@iki.fi> (a446ff0)

    Added doveadm zlibconnect command for testing IMAP COMPRESS.


M	src/plugins/zlib/Makefile.am
M	src/plugins/zlib/doveadm-zlib.c

2011-01-21 19:15:37 +0200 Timo Sirainen <tss@iki.fi> (5cbd6f3)

    zlib: Make sure output stream flushes the stream automatically when not
    corked. Fixes hangs with IMAP COMPRESS extension.


M	src/plugins/zlib/ostream-zlib.c

2011-01-21 17:39:24 +0200 Timo Sirainen <tss@iki.fi> (c5c7124)

    imapc: Code cleanups and fixes.


M	src/lib-storage/index/imapc/Makefile.am
M	src/lib-storage/index/imapc/imapc-client.h
M	src/lib-storage/index/imapc/imapc-connection.c
M	src/lib-storage/index/imapc/imapc-list.c
M	src/lib-storage/index/imapc/imapc-list.h
A	src/lib-storage/index/imapc/imapc-mailbox.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h

2011-01-21 01:05:00 +0200 Timo Sirainen <tss@iki.fi> (f6605a4)

    imapc: Call istream_opened() method if it's set for mail.


M	src/lib-storage/index/imapc/imapc-search.c

2011-01-20 23:16:23 +0200 Timo Sirainen <tss@iki.fi> (b8cee9a)

    dotlocks: Refresh current time after having waited for a lock.


M	src/lib/file-dotlock.c

2011-01-20 23:09:44 +0200 Timo Sirainen <tss@iki.fi> (ba02cf1)

    lib-storage: Fixed handling chroot/home for services that don't really
    chroot (lmtp).


M	src/lib-storage/mail-storage-service.c

2011-01-20 22:45:41 +0200 Timo Sirainen <tss@iki.fi> (90de49e)

    imapc: Added support for LIST/LSUB.


M	src/lib-storage/index/imapc/Makefile.am
A	src/lib-storage/index/imapc/imapc-list.c
A	src/lib-storage/index/imapc/imapc-list.h
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/imapc/imapc-storage.h
M	src/lib-storage/register/Makefile.am

2011-01-20 22:44:53 +0200 Timo Sirainen <tss@iki.fi> (80987f1)

    imapc: Don't send broken FETCH command when we don't actually have to fetch
    anything.


M	src/lib-storage/index/imapc/imapc-search.c

2011-01-20 20:59:07 +0200 Timo Sirainen <tss@iki.fi> (c0a87e5)

    lib-storage: mailbox_alloc() now takes a virtual mailbox name and other
    related API changes. All storage_name <-> vname conversions now go through
    the same two mailbox_list methods. This has many benefits, such as:

     * listescape plugin is now much simpler and bugfree
    * allows changing lib-storage API to use UTF-8 mailbox names in future
    * allows creation of "mailbox aliases" plugin

M	TODO
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-list-iter.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/dsync/dsync-worker-local.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-list.c
M	src/imap/cmd-namespace.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-select.c
M	src/imap/cmd-status.c
M	src/imap/cmd-subscribe.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h
M	src/lib-lda/mail-deliver.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.h
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/index/shared/shared-storage.c
M	src/lib-storage/list/index-mailbox-list.c
M	src/lib-storage/list/mailbox-list-fs-iter.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir-iter.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-maildir.h
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/mail-namespace.c
M	src/lib-storage/mail-namespace.h
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/lib-storage/test-mail-storage.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/trash/trash-plugin.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-storage.c
M	src/pop3/pop3-client.c

2011-01-20 19:21:20 +0200 Timo Sirainen <tss@iki.fi> (11352dc)

    lib-storage: Added mailbox_get_last_*error() wrappers and use them.


M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail-iter.c
M	src/doveadm/doveadm-mail-mailbox.c
M	src/doveadm/doveadm-mail.c
M	src/dsync/dsync-worker-local.c
M	src/imap/cmd-fetch.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-status.c
M	src/lda/main.c
M	src/lib-lda/mail-deliver.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lmtp/commands.c
M	src/plugins/autocreate/autocreate-plugin.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/quota/quota-count.c
M	src/plugins/snarf/snarf-plugin.c
M	src/plugins/virtual/virtual-storage.c
M	src/pop3/pop3-client.c

2011-01-20 18:17:22 +0200 Timo Sirainen <tss@iki.fi> (b30f98f)

    lib-storage: Crashfix on trying to create index root dir.


M	src/lib-storage/mailbox-list.c

2011-01-20 18:14:53 +0200 Timo Sirainen <tss@iki.fi> (306cfd7)

    lib-storage: Replaced mailbox_list_get_name_status() with mailbox_exists().


M	src/imap/cmd-subscribe.c
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/imapc/imapc-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/listescape/listescape-plugin.c
M	src/plugins/virtual/virtual-storage.c

2011-01-19 20:06:39 +0000 Pascal Volk <user@localhost.localdomain.org> (16b3aad)

    lmtp: Write "+ext" part to Delivered-To: header. (reverted changeset
    19231e3585db)


M	src/lmtp/commands.c

2011-01-19 01:21:03 +0200 Timo Sirainen <tss@iki.fi> (4afc13f)

    imapc: Fixed authenticating with AUTHENTICATE command without SASL-IR.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-01-19 01:20:48 +0200 Timo Sirainen <tss@iki.fi> (0c7c388)

    imapc: Fixed sending non-syncing literals.


M	src/lib-storage/index/imapc/imapc-connection.c

2011-01-19 00:25:47 +0200 Timo Sirainen <tss@iki.fi> (13b4ea0)

    auth: Logging improvement for nopassword=y.


M	src/auth/auth-request.c

2011-01-17 21:25:01 +0200 Timo Sirainen <tss@iki.fi> (14b8bbb)

    lib-index: Avoid corrupting dovecot.index file when recreating it even in
    case of broken file locking.


M	src/lib-index/mail-index.c

2011-01-16 21:47:15 +0200 Christian Wiese <chris@opensde.org> (afe44ea)

    auth: Fixed mech_winbind_ntlm by using mech_winbind_auth_initial() In
    changeset 9002 a new function named mech_winbind_auth_initial() was
    introduced, but only the mech_winbind_spnego module part was changed to
    finally use this function. The mech_winbind_ntlm module part was not
    properly adapted which leads to a non functioning NTLM authentication
    mechanism while using winbind, because it will never call the `ntlm_auth`
    helper.

    The simple fix is to replace mech_generic_auth_initial() with 
    mech_winbind_auth_initial() as auth_initial "hook" when setting up the 
    mech_winbind_ntlm module, like it is done in the mech_winbind_spnego module.

    References:

    - Changeset 9002:
    http://hg.dovecot.org/dovecot-2.0/diff/9d0037a997f4/src/auth/mech-winbind.c
    ---
    src/auth/mech-winbind.c |    2 +-
    1 files changed, 1 insertions(+), 1 deletions(-)

M	src/auth/mech-winbind.c

2011-01-16 21:26:13 +0200 Timo Sirainen <tss@iki.fi> (c04d269)

    man: Updated dsync.1's -o parameter description.


M	doc/man/dsync.1.in

2011-01-16 21:25:34 +0200 Timo Sirainen <tss@iki.fi> (9d7ea91)

    man: Added -o parameter to dovecot-lda.1


M	doc/man/dovecot-lda.1.in

2011-01-16 21:15:10 +0200 Timo Sirainen <tss@iki.fi> (b710c51)

    mkdir_*chown/chgrp(): If chown() fails, rmdir() the directory.


M	src/lib/mkdir-parents.c

2011-01-16 18:53:27 +0200 Timo Sirainen <tss@iki.fi> (9d522c9)

    dsync: Fixed crash when mailbox had zero cache_fields but its array was
    initialized.


M	src/dsync/dsync-data.c

2011-01-16 18:08:23 +0200 Timo Sirainen <tss@iki.fi> (9fb018d)

    Added initial implementation of "imapc" storage. It can be used to create a
    "smart IMAP proxy" where Dovecot uses remote IMAP server as a mail storage.

    This is a very rough early implementation. Performance isn't good, many 
    required features are missing, error handling is lacking and code needs 
    de-uglification. Still, it should be enough for selecting INBOX and 
    accessing mails in it.

M	configure.in
M	src/lib-storage/index/Makefile.am
A	src/lib-storage/index/imapc/Makefile.am
A	src/lib-storage/index/imapc/imapc-client-private.h
A	src/lib-storage/index/imapc/imapc-client.c
A	src/lib-storage/index/imapc/imapc-client.h
A	src/lib-storage/index/imapc/imapc-connection.c
A	src/lib-storage/index/imapc/imapc-connection.h
A	src/lib-storage/index/imapc/imapc-mail.c
A	src/lib-storage/index/imapc/imapc-save.c
A	src/lib-storage/index/imapc/imapc-search.c
A	src/lib-storage/index/imapc/imapc-seqmap.c
A	src/lib-storage/index/imapc/imapc-seqmap.h
A	src/lib-storage/index/imapc/imapc-storage.c
A	src/lib-storage/index/imapc/imapc-storage.h
A	src/lib-storage/index/imapc/imapc-sync.c
A	src/lib-storage/index/imapc/imapc-sync.h
M	src/lib-storage/index/index-sync-private.h
M	src/lib-storage/index/index-sync.c

2011-01-13 13:18:20 +0200 Timo Sirainen <tss@iki.fi> (520be64)

    Added signature for changeset 440fcf8cb338


M	.hgsigs

2011-01-13 13:18:17 +0200 Timo Sirainen <tss@iki.fi> (8bc7dd1)

    Added tag 2.0.9 for changeset 440fcf8cb338


M	.hgtags

2011-01-13 13:18:17 +0200 Timo Sirainen <tss@iki.fi> (66281cd)

    Released v2.0.9.


M	NEWS
M	TODO
M	configure.in

2011-01-13 13:08:40 +0200 Timo Sirainen <tss@iki.fi> (6dcea8f)

    TODO updated


M	TODO

2011-01-13 13:08:21 +0200 Timo Sirainen <tss@iki.fi> (33d7b37)

    Added io_loop_move_io() and io_loop_move_timeout().


M	src/lib/ioloop.c
M	src/lib/ioloop.h

2011-01-13 13:08:02 +0200 Timo Sirainen <tss@iki.fi> (97ee61d)

    cydir: Minor fix.


M	src/lib-storage/index/cydir/cydir-mail.c

2011-01-09 23:39:00 +0200 Timo Sirainen <tss@iki.fi> (2524ef7)

    i_stream_read(): Added extra assert.


M	src/lib/istream.c

2011-01-09 23:38:49 +0200 Timo Sirainen <tss@iki.fi> (1567369)

    istream-seekable: Minor code cleanup.


M	src/lib/istream-seekable.c

2011-01-09 22:01:36 +0200 Timo Sirainen <tss@iki.fi> (b24ffea)

    auth: Don't give an error if doing a passdb lookup and the result has NULL
    password.


M	src/auth/passdb.c

2011-01-09 21:37:24 +0200 Timo Sirainen <tss@iki.fi> (36c4702)

    pgsql: When executing synchronous queries, don't wrongly add a connect
    timeout.


M	src/lib-sql/driver-pgsql.c

2011-01-09 21:13:31 +0200 Timo Sirainen <tss@iki.fi> (06c5f34)

    cydir: Minor code fix.


M	src/lib-storage/index/cydir/cydir-mail.c

2011-01-08 21:03:15 +0200 Timo Sirainen <tss@iki.fi> (5297aa3)

    istream-seekable: Minor code cleanup.


M	src/lib/istream-seekable.c

2011-01-05 20:21:38 +0200 Timo Sirainen <tss@iki.fi> (d356d47)

    dsync: Don't crash if message can't be saved to destination mailbox.


M	src/dsync/dsync-worker-local.c

2011-01-05 18:47:40 +0200 Timo Sirainen <tss@iki.fi> (a62470c)

    mdbox: Don't leave partially written messages to mdbox files.


M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-single/sdbox-save.c

2011-01-05 18:11:04 +0200 Timo Sirainen <tss@iki.fi> (e27411f)

    dsync: Fixed iterating through mailboxes when using proxy. This fixes
    "Unexpected reply from server: +" errors.


M	src/dsync/dsync-brain-msgs.c

2011-01-04 13:57:33 +0200 Timo Sirainen <tss@iki.fi> (33ef806)

    config: Give clear error that auth settings aren't supported inside
    local/remote blocks.


M	src/config/config-parser.c

2011-01-04 13:53:17 +0200 Timo Sirainen <tss@iki.fi> (434abef)

    login: ssl_require_client_cert and ssl_username_from_cert settings should
    have had auth_ prefix. The actual functionality was provided by the auth_*
    settings, but with these duplicated settings login process didn't give as
    good error messages.


M	src/login-common/client-common.c
M	src/login-common/login-settings.c
M	src/login-common/login-settings.h

2011-01-04 13:22:20 +0200 Timo Sirainen <tss@iki.fi> (6cbe2fa)

    auth: Minor code cleanup, use PASSWORD_HIDDEN_STR macro.


M	src/auth/passdb-cache.c

2011-01-04 13:17:57 +0200 Timo Sirainen <tss@iki.fi> (5a01a2c)

    maildir: Fixed renaming child mailboxes when using a namespace prefix.


M	src/lib-storage/list/mailbox-list-maildir.c

2011-01-04 12:34:48 +0200 Timo Sirainen <tss@iki.fi> (1a8b6bb)

    maildir: Getting mailbox GUID unnecessarily rewrote the uidlist.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2011-01-04 12:14:02 +0200 Timo Sirainen <tss@iki.fi> (5f41bf5)

    IDLE was listed twice in capabilities.


M	configure.in

2011-01-04 12:04:42 +0200 Timo Sirainen <tss@iki.fi> (a31ee53)

    dsync: Saved messages' save-date was set to 1970-01-01.


M	src/dsync/dsync-worker-local.c

2011-01-04 11:55:36 +0200 Timo Sirainen <tss@iki.fi> (395682d)

    virtual: Fixed saving multiple mails in a transaction (e.g. copy multiple
    messages).


M	src/plugins/virtual/virtual-save.c

2011-01-04 11:44:07 +0200 Timo Sirainen <tss@iki.fi> (4371df9)

    lib-sql: Include Dovecot version number check when loading SQL plugins.


M	src/lib-sql/driver-mysql.c
M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlite.c

2011-01-03 19:06:49 +0200 Timo Sirainen <tss@iki.fi> (21fdf53)

    lib-lda: Simplified mail_deliver_deduplicate_guid_if_needed() API.


M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h

2011-01-03 19:06:02 +0200 Timo Sirainen <tss@iki.fi> (d5bc636)

    lib-storage: Added mailbox_save_get_transaction().


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2011-01-03 18:59:07 +0200 Timo Sirainen <tss@iki.fi> (44f3f47)

    lmtp: If delivering duplicate messages to same user's INBOX, use different
    GUIDs. This is to avoid POP3 clients getting confused with duplicate UIDLs,
    when using GUIDs as UIDLs.


M	src/lda/main.c
M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h
M	src/lmtp/commands.c

2011-01-03 18:57:05 +0200 Timo Sirainen <tss@iki.fi> (90e3917)

    dbox: If mail GUID is changed for copied mail, create a new copy of it so it
    changes.


M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c

2011-01-01 16:00:01 +0200 Timo Sirainen <tss@iki.fi> (6f83ab6)

    configure: Added a note that this is the UNSTABLE branch.


M	configure.in

2011-01-01 15:59:02 +0200 Timo Sirainen <tss@iki.fi> (e1f21d0)

    Merged fixes from v2.0 tree.


2011-01-01 15:56:37 +0200 Timo Sirainen <tss@iki.fi> (c8af325)

    TODO updated.


M	TODO

2011-01-01 15:52:39 +0200 Timo Sirainen <tss@iki.fi> (51327f2)

    lib-storage: Moved some items from mailbox_get_status() to a new
    mailbox_get_metadata(). The idea is now that all status items are tracked
    all the time after mailbox is opened and they can always be looked up
    without failure. The metadata items are looked up lazily and the lookups may
    fail at any time.

    mailbox_get_status() can be used after mailbox_alloc() to indicate that the 
    mailbox doesn't necessarily have to be opened, just that the status fields 
    get returned.

    If mailbox is already known to be open, mailbox_get_open_status() can be 
    used. It never fails.

M	src/doveadm/doveadm-mail-fetch.c
M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/doveadm/doveadm-mail-search.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/dsync/dsync-worker-local.c
M	src/imap/cmd-enable.c
M	src/imap/cmd-select.c
M	src/imap/cmd-store.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-commands-util.c
M	src/imap/imap-fetch.c
M	src/imap/imap-search.c
M	src/imap/imap-status.c
M	src/imap/imap-status.h
M	src/imap/imap-sync.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-search.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/list/index-mailbox-list-sync.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/fts/fts-storage.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c
M	src/pop3/pop3-client.c

2011-01-01 14:34:14 +0200 Timo Sirainen <tss@iki.fi> (afff56f)

    lib-storage: Added warning comments about mail_get_*header*utf8().


M	src/lib-storage/mail-storage.h

2011-01-01 13:27:16 +0200 Timo Sirainen <tss@iki.fi> (58fe555)

    lib-storage: Don't double-demimefy headers when DISPLAYFROM/DISPLAYTO
    sorting.


M	src/lib-storage/index/index-sort.c

2010-12-30 13:45:11 +0200 Timo Sirainen <tss@iki.fi> (4cdfd6c)

    lib-storage: Fixed deleting symlinked mailbox.


M	src/lib-storage/list/mailbox-list-delete.c
M	src/lib-storage/list/mailbox-list-delete.h
M	src/lib-storage/list/mailbox-list-maildir-iter.c

2010-12-30 13:41:10 +0200 Timo Sirainen <tss@iki.fi> (2c8041e)

    unlink_directory(): Return ELOOP for unexpected symlinks also when
    O_NOFOLLOW isn't supported.


M	src/lib/unlink-directory.c

2010-12-30 12:45:52 +0200 Timo Sirainen <tss@iki.fi> (a5da67c)

    doveadm quota: Don't crash if quota isn't enabled.


M	src/plugins/quota/doveadm-quota.c

2010-12-30 12:40:50 +0200 Timo Sirainen <tss@iki.fi> (d793248)

    doveadm: Fixed mailbox-guid search key to work with shared/public mailboxes.


M	src/doveadm/doveadm-mail-list-iter.c

2010-12-30 12:04:30 +0200 Timo Sirainen <tss@iki.fi> (47fed6b)

    vpopmail: "Service disabled" check wasn't being done correctly.


M	src/auth/passdb-vpopmail.c

2010-12-30 11:51:59 +0200 Timo Sirainen <tss@iki.fi> (f827f6b)

    doveadm user: If user isn't found, exit with status 2.


M	src/doveadm/doveadm-auth.c

2010-12-29 11:43:01 +0200 Timo Sirainen <tss@iki.fi> (d3280fe)

    lib-storage: mailbox_get_status() can now fail. It might have failed earlier
    also, but the errors were hidden from caller.


M	src/doveadm/doveadm-mail-mailbox-status.c
M	src/dsync/dsync-worker-local.c
M	src/imap/cmd-select.c
M	src/imap/imap-client.c
M	src/imap/imap-status.c
M	src/imap/imap-sync.c
M	src/lib-storage/index/index-status.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/list/index-mailbox-list-sync.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c

2010-12-29 11:39:32 +0200 Timo Sirainen <tss@iki.fi> (e12203f)

    lib-storage: Crashfix for opening sdbox/mdbox mailbox.


M	src/lib-storage/index/index-storage.c

2010-12-17 13:23:07 +0000 Timo Sirainen <tss@iki.fi> (30a2755)

    lda: Removed optimization of not creating temp files for large mails when
    not using Sieve. The backwards seeking was still needed if bouncing the mail
    because of out of quota.


M	src/lda/main.c

2010-12-17 13:16:01 +0000 Timo Sirainen <tss@iki.fi> (c14ceb2)

    snarf: Make sure destination mailbox is open when syncing it.


M	src/plugins/snarf/snarf-plugin.c

2010-12-15 17:07:01 +0000 Timo Sirainen <tss@iki.fi> (cbcba92)

    master-child API change: Use a separate fd for tracking when master dies.
    This works around a Linux performance problem where when one process writes
    to status fd all the other processes of the same service type wake up.


M	src/lib-master/master-interface.h
M	src/lib-master/master-service.c
M	src/master/common.h
M	src/master/main.c
M	src/master/service-process.c

2010-12-13 13:40:27 +0000 Timo Sirainen <tss@iki.fi> (a2e77b0)

    net_listen(): If IPv6 isn't supported, don't fallback to IPv4 if my_ip is
    given.


M	src/lib/network.c

2010-12-13 13:27:18 +0000 Timo Sirainen <tss@iki.fi> (968aab2)

    quota: Quota warnings could have been executed at incorrect times with some
    configs. If target mailbox had quota ignored, the warning was sent if the
    mail would have otherwise exceeded the warning threshold. Same when using
    multiple quota roots where all of the roots weren't used for the target
    mailbox.


M	src/plugins/quota/quota.c

2010-12-09 20:49:53 +0000 Timo Sirainen <tss@iki.fi> (31ed209)

    imap: Fixed a memory leak in ESEARCH


M	src/imap/imap-search.c

2010-12-09 11:16:24 +0000 Timo Sirainen <tss@iki.fi> (c599385)

    lib-storage: Added assert check to make sure we never do timeout_add(0)


M	src/lib-storage/index/index-mailbox-check.c

2010-12-08 23:17:11 +0000 Timo Sirainen <tss@iki.fi> (835e8c5)

    acl: Crashfix at deinit in some configurations.


M	src/plugins/acl/acl-mailbox-list.c

2010-12-07 02:00:45 +0000 Timo Sirainen <tss@iki.fi> (7b32aec)

    auth: Master user login + prefetch userdb changed username to master user.


M	src/auth/auth-request.c

2010-12-07 01:50:43 +0000 Timo Sirainen <tss@iki.fi> (a33cc2d)

    auth: Checkpassword's output fields are now logged with auth_debug=yes


M	src/auth/passdb-checkpassword.c

2010-12-06 04:36:30 +0000 Timo Sirainen <tss@iki.fi> (9981d8d)

    auth: When logging in as anonymous user, return "anonymous" userdb extra
    field.


M	TODO
M	src/auth/auth-request-handler.c

2010-12-06 04:36:30 +0000 Timo Sirainen <tss@iki.fi> (e8e9664)

    auth: When logging in as anonymous user, return "anonymous" userdb extra
    field.


M	TODO
M	src/auth/auth-request-handler.c

2010-12-06 04:00:26 +0000 Timo Sirainen <tss@iki.fi> (90c636f)

    TODO updated.


M	TODO

2010-12-06 03:58:17 +0000 Timo Sirainen <tss@iki.fi> (b62140c)

    lib-storage: Moved mailbox.save_is_attachment() to
    mail_save_context.part_is_attachment()


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-attachment.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/virtual/virtual-storage.c

2010-12-06 03:53:30 +0000 Timo Sirainen <tss@iki.fi> (a4f0974)

    lib-storage: Unvirtualized mailbox_header_lookup_*()


M	src/lib-storage/Makefile.am
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
A	src/lib-storage/mailbox-header.c
M	src/lib-storage/test-mailbox.c
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-storage.c

2010-12-06 03:43:23 +0000 Timo Sirainen <tss@iki.fi> (dbe64f3)

    lib-storage: Unvirtualized some methods from struct mailbox. There was never
    any point in overriding or hooking into them.


M	src/lib-storage/Makefile.am
M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
R088	src/lib-storage/index/index-fetch.c	src/lib-storage/mailbox-get.c
R097	src/lib-storage/index/test-index-fetch.c	src/lib-storage/test-mailbox-get.c
M	src/lib-storage/test-mailbox.c
M	src/plugins/virtual/virtual-storage.c

2010-12-06 03:41:31 +0000 Timo Sirainen <tss@iki.fi> (8871c97)

    lib-storage: Added missing mailbox-keywords.c for recent commit.


A	src/lib-storage/mailbox-keywords.c

2010-12-06 03:40:41 +0000 Timo Sirainen <tss@iki.fi> (1ae4534)

    fts: Added missing new files for last commit.


A	src/plugins/fts/fts-mailbox.c
A	src/plugins/fts/fts-mailbox.h

2010-12-06 03:28:29 +0000 Timo Sirainen <tss@iki.fi> (499fec3)

    Moved fts/virtual plugin communication functions away from lib-storage.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/fts-solr/fts-backend-solr.c
M	src/plugins/fts/Makefile.am
M	src/plugins/fts/fts-storage.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-storage.h

2010-12-06 03:11:08 +0000 Timo Sirainen <tss@iki.fi> (50e6d62)

    lib-lda: duplicate_check() should return bool, not int.


M	src/lib-lda/duplicate.c
M	src/lib-lda/duplicate.h

2010-12-06 03:08:31 +0000 Timo Sirainen <tss@iki.fi> (17cf149)

    lib-storage: Added mailbox_list_get_root_[dir_]permissions() They should be
    used instead of mailbox_list_get_[dir_]permissions() with name=NULL
    parameter.


M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/lib-storage/mailbox-uidvalidity.c
M	src/plugins/acl/acl-backend-vfile-acllist.c
M	src/plugins/lazy-expunge/lazy-expunge-plugin.c
M	src/plugins/quota/quota-maildir.c

2010-12-06 02:16:22 +0000 Timo Sirainen <tss@iki.fi> (4182d8c)

    lib-storage: Simplified mailbox_keyword*() APIs. They are no longer struct
    mailbox methods, because they're always implemented as being wrappers to
    lib-index APIs anyway.

    Also mailbox_keywords_ref/unref() no longer take mailbox parameter.

M	src/dsync/dsync-worker-local.c
M	src/imap/cmd-append.c
M	src/imap/cmd-store.c
M	src/lib-lda/mail-deliver.c
M	src/lib-storage/Makefile.am
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-search.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-storage.c
M	src/plugins/virtual/virtual-sync.c

2010-12-06 01:47:50 +0000 Timo Sirainen <tss@iki.fi> (c000c8e)

    lib-storage: Removed mailbox.backend_readonly. Backends set it internally
    lazily now.


M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-storage.h
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2010-12-06 01:27:11 +0000 Timo Sirainen <tss@iki.fi> (0ed9ccd)

    maildir: Avoid harder to unnecessarily read uidlist when syncing mailbox.


M	src/lib-storage/index/maildir/maildir-sync.c

2010-12-06 01:27:03 +0000 Timo Sirainen <tss@iki.fi> (70fa27d)

    maildir: Avoid harder to unnecessarily read uidlist when syncing mailbox.


M	src/lib-storage/index/maildir/maildir-sync.c

2010-12-06 01:20:14 +0000 Timo Sirainen <tss@iki.fi> (8d889b6)

    maildir: Avoid unnecessarily reading uidlist when opening mailbox.


M	src/lib-storage/index/maildir/maildir-sync.c

2010-12-06 01:19:25 +0000 Timo Sirainen <tss@iki.fi> (2881363)

    maildir: Avoid unnecessarily reading uidlist when opening mailbox.


M	src/lib-storage/index/maildir/maildir-sync.c

2010-12-06 01:11:07 +0000 Timo Sirainen <tss@iki.fi> (8a13b02)

    lib-storage: Moved box->private_flags_mask to
    mailbox_get_private_flags_mask() This allows getting it lazily only when
    it's actually needed.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/acl/acl-mailbox.c
M	src/plugins/virtual/virtual-storage.c

2010-12-06 00:52:42 +0000 Timo Sirainen <tss@iki.fi> (d450553)

    lib-storage: Removed subscription name validity check from lib-storage after
    all. It could have broken when subscriptions were being set for
    subscriptions=no namespace.


M	src/imap/cmd-subscribe.c
M	src/lib-storage/mailbox-list.c

2010-12-06 00:43:28 +0000 Timo Sirainen <tss@iki.fi> (7fd8e15)

    lib-storage: Mailbox directory creation didn't properly enforce that the
    name was valid. The name was checked against "valid existing name" rather
    than "valid create name", which mainly meant that the name could have
    contained control characters and other things that weren't really intended.
    This couldn't be used to cause any security holes though.


M	src/lib-storage/mailbox-list.c

2010-12-06 00:42:42 +0000 Timo Sirainen <tss@iki.fi> (7339ddd)

    acl: Make the mailbox visible only when it has l/r/i right. This change only
    affects the ability to SUBSCRIBE to a mailbox. Previously it was allowed
    when user had any rights at all to mailbox.


M	src/plugins/acl/acl-mailbox-list.c

2010-12-06 00:37:20 +0000 Timo Sirainen <tss@iki.fi> (43a4450)

    lib-storage: Removed unused mailbox_list_get_mailbox_name_status() status
    codes.


M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-mailbox-list.c

2010-12-06 00:37:09 +0000 Timo Sirainen <tss@iki.fi> (f750d1b)

    imap-acl, imap-quota: Compile fix for last change.


M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c

2010-12-06 00:30:36 +0000 Timo Sirainen <tss@iki.fi> (62f49dd)

    imap: Avoid using mailbox_list_get_mailbox_name_status() The validity checks
    should already be done by the actual commands in most cases (if they didn't,
    there would be race condition bugs). The only exception is SUBSCRIBE. It
    doesn't require that the mailbox exists, but we want to enforce that anyway
    via IMAP.


M	src/imap/cmd-append.c
M	src/imap/cmd-copy.c
M	src/imap/cmd-create.c
M	src/imap/cmd-delete.c
M	src/imap/cmd-rename.c
M	src/imap/cmd-select.c
M	src/imap/cmd-status.c
M	src/imap/cmd-subscribe.c
M	src/imap/imap-commands-util.c
M	src/imap/imap-commands-util.h

2010-12-06 00:14:25 +0000 Timo Sirainen <tss@iki.fi> (510c82e)

    lib-storage: Don't allow subscribing to invalid mailbox names.


M	src/lib-storage/mailbox-list.c

2010-12-06 00:13:28 +0000 Timo Sirainen <tss@iki.fi> (1c1e571)

    lib-storage: Mailbox directory creation didn't properly enforce that the
    name was valid. The name was checked against "valid existing name" rather
    than "valid create name", which mainly meant that the name could have
    contained control characters and other things that weren't really intended.
    This couldn't be used to cause any security holes though.


M	src/lib-storage/mailbox-list.c

2010-12-05 23:53:47 +0000 Timo Sirainen <tss@iki.fi> (14609d1)

    Removed unused BITS_IN_UINT and CLAMP macros.


M	src/lib/macros.h

2010-12-05 23:53:25 +0000 Timo Sirainen <tss@iki.fi> (9255065)

    Unexpand BITS_IN_SIZE_T in the only place it's used and remove the macro.


M	src/lib/lib.c
M	src/lib/macros.h

2010-12-05 23:52:37 +0000 Timo Sirainen <tss@iki.fi> (65b15c3)

    Moved a global NVL() macro to the few places in lib-imap where it was
    actually used.


M	src/lib-imap/imap-bodystructure.c
M	src/lib-imap/imap-envelope.c
M	src/lib/macros.h

2010-12-05 23:48:34 +0000 Timo Sirainen <tss@iki.fi> (1e4623e)

    lib-storage: Fixed error handling when trying to delete mailbox under
    noinferiors mailbox.


M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c

2010-12-05 23:44:38 +0000 Timo Sirainen <tss@iki.fi> (df00412)

    lib-storage: Don't allocate index until mailbox_open()


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2010-12-05 23:18:55 +0000 Timo Sirainen <tss@iki.fi> (ca98892)

    lib-storage: Lazily look up mailbox path and permissions. Added functions to
    get them.


M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-sync.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-keywords.c
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-util.c
M	src/lib-storage/index/mbox/mbox-file.c
M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-sync.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c
M	src/plugins/fts-squat/fts-backend-squat.c
M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-sync.c
M	src/plugins/zlib/zlib-plugin.c

2010-12-05 22:11:01 +0000 Timo Sirainen <tss@iki.fi> (de213b5)

    lib-storage: mailbox_create_fd() handles "no inferior mailboxes allowed"
    error now.


M	src/lib-storage/mail-storage.c

2010-12-05 21:39:09 +0000 Timo Sirainen <tss@iki.fi> (c04f9a7)

    lib-storage: Removed struct index_transaction_context. All of its contents
    are now in struct mailbox_transaction_context.


M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/index-mail-headers.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/index-transaction.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/mbox/mbox-storage.h
M	src/lib-storage/mail-storage-private.h
M	src/plugins/virtual/virtual-mail.c
M	src/plugins/virtual/virtual-save.c
M	src/plugins/virtual/virtual-transaction.c
M	src/plugins/virtual/virtual-transaction.h

2010-12-05 21:11:03 +0000 Timo Sirainen <tss@iki.fi> (a457301)

    Compiler warning fix.


M	src/lib-storage/index/maildir/maildir-sync.h

2010-12-03 23:16:26 +0000 Timo Sirainen <tss@iki.fi> (5226c54)

    lib-master: Error message typofix.


M	src/lib-master/master-login-auth.c

2010-12-03 19:38:02 +0000 Timo Sirainen <tss@iki.fi> (a763b99)

    Added signature for changeset 51e41fcc7856


M	.hgsigs

2010-12-03 19:37:58 +0000 Timo Sirainen <tss@iki.fi> (70be0d5)

    Added tag 2.0.8 for changeset 51e41fcc7856


M	.hgtags

2010-12-03 19:37:56 +0000 Timo Sirainen <tss@iki.fi> (a0a488f)

    Released v2.0.8.


M	NEWS
M	TODO
M	configure.in

2010-12-03 19:25:04 +0000 Timo Sirainen <tss@iki.fi> (2017808)

    example-config: Added comments to default_vsz_limit.


M	doc/example-config/conf.d/10-master.conf

2010-12-03 10:47:46 +0000 Timo Sirainen <tss@iki.fi> (d721a5f)

    lib-index: Make static analyzer happier.


M	src/lib-index/mail-index-sync-keywords.c

2010-12-03 10:47:07 +0000 Timo Sirainen <tss@iki.fi> (00a570d)

    Dead code removal.


M	src/lib/test-istream-base64-encoder.c

2010-12-03 10:43:03 +0000 Timo Sirainen <tss@iki.fi> (c0b11b5)

    lib-storage: mail_storage_copy_can_use_hardlink() was always returning TRUE.


M	src/lib-storage/mail-copy.c

2010-12-03 10:15:48 +0000 Timo Sirainen <tss@iki.fi> (fc45e0e)

    dbox: Fixed reading attachments for compressed mails.


M	src/lib-storage/index/dbox-common/dbox-attachment.c

2010-12-03 10:15:20 +0000 Timo Sirainen <tss@iki.fi> (427ad9f)

    dbox: Added dbox_file_get_plaintext_size() for easily getting it.


M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-common/dbox-mail.c

2010-12-03 10:05:38 +0000 Timo Sirainen <tss@iki.fi> (bdb9f7f)

    Log login pid/id for internal failures to allow matching errors between
    processes.


M	src/lib-master/master-login-auth.c
M	src/login-common/client-common.c

2010-12-03 09:10:12 +0000 Timo Sirainen <tss@iki.fi> (928529c)

    lib-storage: Fixed storing newlines at the end of base64 attachments.


M	src/lib-storage/index/index-attachment.c

2010-12-03 09:09:10 +0000 Timo Sirainen <tss@iki.fi> (58438ae)

    istream-base64-encoder: Fixed reading when parent stream returned little
    data.


M	src/lib/istream-base64-encoder.c

2010-12-03 07:39:13 +0000 Timo Sirainen <tss@iki.fi> (e5974be)

    Compiler warning fixes.


M	src/auth/userdb-passwd.c
M	src/lib-fs/fs-posix.c

2010-12-03 07:12:20 +0000 Timo Sirainen <tss@iki.fi> (c74ee9c)

    ioloop: Don't leak memory when detecting a leaked timeout.


M	src/lib/ioloop.c

2010-12-03 07:06:34 +0000 Timo Sirainen <tss@iki.fi> (7992630)

    ioloop log: Added asserts


M	src/lib/ioloop.c

2010-12-03 07:00:17 +0000 Timo Sirainen <tss@iki.fi> (97333cb)

    mail storage service: Use ioloop log prefix automation. This properly fixes
    imap/pop3 when using with client_limit>1.


M	src/lib-storage/mail-storage-service.c

2010-12-03 06:58:38 +0000 Timo Sirainen <tss@iki.fi> (b9a13c1)

    ioloop: Added support for per-io/timeout callback log prefix automation.


M	src/lib/ioloop-epoll.c
M	src/lib/ioloop-internal.h
M	src/lib/ioloop-kqueue.c
M	src/lib/ioloop-poll.c
M	src/lib/ioloop-select.c
M	src/lib/ioloop.c
M	src/lib/ioloop.h

2010-12-03 06:57:58 +0000 Timo Sirainen <tss@iki.fi> (5be786a)

    imap, pop3: Removed previous log prefix hack.


M	src/imap/cmd-append.c
M	src/imap/cmd-idle.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-search.c
M	src/pop3/pop3-client.c

2010-12-03 05:46:57 +0000 Timo Sirainen <tss@iki.fi> (bbb0b24)

    imap, pop3: Small optimization to last logging change. Also added FIXMEs.
    This is an ugly way to change log prefixes.


M	src/imap/imap-client.c
M	src/pop3/pop3-client.c

2010-12-03 05:43:16 +0000 Timo Sirainen <tss@iki.fi> (0fb11b6)

    imap, pop3: Try to use the correct log prefix when service_count!=1.


M	src/imap/cmd-append.c
M	src/imap/cmd-idle.c
M	src/imap/imap-client.c
M	src/imap/imap-client.h
M	src/imap/imap-search.c
M	src/pop3/pop3-client.c

2010-12-03 04:25:06 +0000 Timo Sirainen <tss@iki.fi> (e188bab)

    lib-index: Added "transaction boundary" record for future compatibility.


M	src/doveadm/doveadm-dump-log.c
M	src/lib-index/mail-index-sync-update.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log.h

2010-12-02 22:59:42 +0000 Timo Sirainen <tss@iki.fi> (0b47e00)

    lib_init(): Call srand() with a bit better seed.


M	src/lib/lib.c

2010-12-02 21:42:30 +0000 Timo Sirainen <tss@iki.fi> (b5322c8)

    auth: Fail if auth client tries to use a duplicate ID.


M	src/auth/auth-request-handler.c

2010-12-02 21:42:18 +0000 Timo Sirainen <tss@iki.fi> (65565b1)

    lib-master: Try to use auth request ID numbers from wider range to ease
    debugging.


M	src/lib-master/master-login-auth.c

2010-12-02 19:10:23 +0000 Timo Sirainen <tss@iki.fi> (bc2739c)

    auth: passdb credentials lookup fix when using multiple passdbs. If at least
    one passdb returns "user unknown" and the last passdb returns "credential
    lookup not supported", the proper return value is still "user unknown".


M	src/auth/auth-request.c
M	src/auth/auth-request.h

2010-12-02 17:38:08 +0000 Timo Sirainen <tss@iki.fi> (93f4e5b)

    lib-master: Added extra debug info for a "user not found" error message.


M	src/lib-master/master-login-auth.c

2010-12-02 04:37:38 +0000 Timo Sirainen <tss@iki.fi> (e49769b)

    lib-index: Added a missing sanity check for expunge-guid record's uid. This
    fixes a non-self healing assert-crash.


M	src/lib-index/mail-index-sync-update.c

2010-11-30 22:38:05 +0000 Timo Sirainen <tss@iki.fi> (70af4db)

    lmtp: Added lmtp_save_to_detail_mailbox setting.


M	doc/example-config/conf.d/20-lmtp.conf
M	src/lmtp/commands.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h

2010-11-30 15:01:06 +0000 Timo Sirainen <tss@iki.fi> (0547a82)

    master: Fixed crash due to recent SSL key password askpass change.


M	src/master/service-process.c

2010-11-30 00:20:09 +0000 Timo Sirainen <tss@iki.fi> (eadbe30)

    askpass: Removed unnecessary code.


M	src/lib/askpass.c

2010-11-30 00:17:20 +0000 Timo Sirainen <tss@iki.fi> (24b31da)

    askpass: Allow reading password from stdin even if it's not a tty.


M	src/lib/askpass.c

2010-11-30 00:13:45 +0000 Timo Sirainen <tss@iki.fi> (4ef4644)

    master: Use t_askpass() for getting the manual SSL key password.


M	src/master/common.h
M	src/master/main.c

2010-11-30 00:12:54 +0000 Timo Sirainen <tss@iki.fi> (f7ecae8)

    t_askpass(): Removed a limit of 1024 bytes for the password.


M	src/lib/askpass.c

2010-11-29 23:58:19 +0000 Timo Sirainen <tss@iki.fi> (4afd50d)

    lmtp: Recent change broke accessing mail_temp_dir. Also when it happened, an
    error message wasn't always logged.


M	src/lmtp/client.c
M	src/lmtp/client.h
M	src/lmtp/commands.c
M	src/lmtp/lmtp-settings.c
M	src/lmtp/lmtp-settings.h

2010-11-29 19:13:37 +0000 Timo Sirainen <tss@iki.fi> (66a164c)

    fs-sis: Memory leak fix.


M	src/lib-fs/fs-sis.c

2010-11-29 19:08:37 +0000 Timo Sirainen <tss@iki.fi> (5677285)

    doveadm import: Free memory used by source storage at deinit.


M	src/doveadm/doveadm-mail-import.c

2010-11-26 23:06:24 +0000 Pascal Volk <user@localhost.localdomain.org> (a4fb6a3)

    man: doveadm-import.1: Added missing argument descriptions.


M	doc/man/doveadm-import.1.in

2010-11-26 18:59:29 +0000 Timo Sirainen <tss@iki.fi> (20fec01)

    TODO updated


M	TODO

2010-11-26 18:19:16 +0000 Timo Sirainen <tss@iki.fi> (7af2a19)

    auth sql/ldap: Allow using global %variables in iterate_query/filter. No
    per-query %variables are defined, but e.g. %{hostname} or %{env:*} can be
    used.


M	src/auth/userdb-ldap.c
M	src/auth/userdb-sql.c

2010-11-26 17:46:49 +0000 Timo Sirainen <tss@iki.fi> (d1e7425)

    login: Fixed potential assert-crash during failed proxy authentication.


M	src/login-common/client-common-auth.c

2010-11-26 17:31:00 +0000 Timo Sirainen <tss@iki.fi> (de63a9a)

    auth: Assume inet_listeners are auth client listeners if they exist.


M	src/auth/main.c

2010-11-26 17:27:44 +0000 Timo Sirainen <tss@iki.fi> (b918f91)

    auth: Minor error message fix.


M	src/auth/main.c

2010-11-25 17:44:02 +0000 Pascal Volk <user@localhost.localdomain.org> (44c6dbf)

    man: Added "-S socket_path" description.


M	doc/man/Makefile.am
M	doc/man/doveadm-altmove.1.in
M	doc/man/doveadm-expunge.1.in
M	doc/man/doveadm-fetch.1.in
M	doc/man/doveadm-force-resync.1.in
M	doc/man/doveadm-import.1.in
M	doc/man/doveadm-mailbox.1.in
M	doc/man/doveadm-purge.1.in
M	doc/man/doveadm-quota.1.in
M	doc/man/doveadm-search.1.in
M	doc/man/doveadm.1.in
M	doc/man/global-options-formatter.inc
M	doc/man/global-options.inc
A	doc/man/option-S-socket.inc
M	doc/man/sed.sh

2010-11-24 18:56:48 +0000 Timo Sirainen <tss@iki.fi> (8bce86e)

    doveadm: -s was already used by some mailbox commands, renamed to -S. Also
    added -S to usage output.


M	src/doveadm/doveadm-mail.c

2010-11-24 17:20:33 +0000 Pascal Volk <user@localhost.localdomain.org> (10635b6)

    doveadm: Removed -s option from the usage message (according to
    66428c763354)


M	src/doveadm/doveadm.c

2010-11-23 19:37:56 +0000 Timo Sirainen <tss@iki.fi> (68bc737)

    lib-storage: mail_temp_dir setting should have done %variable expansion.


M	src/lib-storage/mail-storage-settings.c

2010-11-23 19:07:19 +0000 Timo Sirainen <tss@iki.fi> (d5ef380)

    doveadm: Moved -s parameter among -u/-A parameters, since it's only used by
    mail commands.


M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-settings.c
M	src/doveadm/doveadm-settings.h
M	src/doveadm/doveadm.c

2010-11-23 18:42:27 +0000 Pascal Volk <user@localhost.localdomain.org> (7f0736b)

    man: Added -s parameter.


M	doc/man/doveadm.1.in
M	doc/man/global-options-formatter.inc
M	doc/man/global-options.inc

2010-11-23 18:26:38 +0000 Timo Sirainen <tss@iki.fi> (ca0cdd1)

    lib-index: Don't try to stat() in-memory index.


M	src/lib-index/mail-transaction-log.c

2010-11-23 17:39:19 +0000 Pascal Volk <user@localhost.localdomain.org> (c9775de)

    man: *roff syntax-fix.


M	doc/man/doveadm-import.1.in

2010-11-23 17:04:07 +0000 Pascal Volk <user@localhost.localdomain.org> (1add53f)

    doveadm: Added -s parameter to the usage message.


M	src/doveadm/doveadm.c

2010-11-23 17:05:04 +0000 Timo Sirainen <tss@iki.fi> (11ca781)

    man: Make it clear that doveadm-import allows dest_parent to be ""


M	doc/man/doveadm-import.1.in

2010-11-23 16:55:55 +0000 Timo Sirainen <tss@iki.fi> (ddf2fc3)

    man: Added pointer to doveadm-import from doveadm main man page.


M	doc/man/doveadm.1.in

2010-11-23 16:23:31 +0000 Timo Sirainen <tss@iki.fi> (43955c8)

    maildir: Log a warning if scanning new/ or cur/ takes over 60s.


M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-sync.h

2010-11-23 16:11:15 +0000 Timo Sirainen <tss@iki.fi> (35d87d7)

    lib-master: Added missing master_service_get_settings_parser() required by
    recent change.


M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h

2010-11-23 15:59:09 +0000 Timo Sirainen <tss@iki.fi> (7f735cb)

    lib-storage: If disable_reflink_copy_to=TRUE, disable hardlink/refcount
    copying.


M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/mail-copy.c
M	src/lib-storage/mail-copy.h
M	src/lib-storage/mail-storage-private.h

2010-11-23 15:30:32 +0000 Timo Sirainen <tss@iki.fi> (2cc88ff)

    doveadm server: Fixes to command/parameter handling.


M	src/doveadm/doveadm-mail-server.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h
M	src/doveadm/main.c

2010-11-23 15:30:06 +0000 Timo Sirainen <tss@iki.fi> (773eca7)

    doveadm: Added -s parameter to execute mail command via given doveadm
    socket.


M	src/doveadm/doveadm.c

2010-11-23 15:28:47 +0000 Timo Sirainen <tss@iki.fi> (da63ca2)

    doveadm-server: Don't disconnect client after each command.


M	src/doveadm/client-connection.c

2010-11-22 19:04:13 +0000 Timo Sirainen <tss@iki.fi> (61e04b3)

    imap: Make sure IDLE isn't broken too early if DONE is sent in multiple
    packets.


M	src/imap/cmd-idle.c

2010-11-22 18:35:07 +0000 Timo Sirainen <tss@iki.fi> (426e50e)

    quota: If user has unlimited quota, ignore any specific quota rules.


M	src/plugins/quota/quota.c

2010-11-22 18:21:25 +0000 Timo Sirainen <tss@iki.fi> (e170e0d)

    doveadm-server: Fixed command parameter handling.


M	src/doveadm/client-connection.c

2010-11-19 21:08:37 +0000 Timo Sirainen <tss@iki.fi> (9036d32)

    lib-master: Added missing anvil_client_is_connected()


M	src/lib-master/anvil-client.c
M	src/lib-master/anvil-client.h

2010-11-19 16:24:41 +0000 Timo Sirainen <tss@iki.fi> (d47aadd)

    imap, pop3: Fixed giving any -parameters.


M	src/imap/main.c
M	src/pop3/main.c

2010-11-18 20:35:39 +0000 Timo Sirainen <tss@iki.fi> (e9d9f90)

    auth: If we get disconnected from anvil and can't reconnect, die.


M	src/auth/auth-penalty.c

2010-11-18 20:35:20 +0000 Timo Sirainen <tss@iki.fi> (2e0eb7b)

    auth: Fixed assert-crash at deinit if there were clients left with pending
    auth requests.


M	src/auth/auth-client-connection.c

2010-11-18 19:32:50 +0000 Timo Sirainen <tss@iki.fi> (9bd6077)

    snarf: Added mbox_snarf setting to enable snarfing only optionally.


M	src/plugins/snarf/Makefile.am
M	src/plugins/snarf/snarf-plugin.c

2010-11-18 18:58:33 +0000 Timo Sirainen <tss@iki.fi> (a6e79df)

    Replaced broken mbox-snarf plugin with a more generic snarf plugin.


M	configure.in
M	src/plugins/Makefile.am
D	src/plugins/mbox-snarf/mbox-snarf-plugin.c
D	src/plugins/mbox-snarf/mbox-snarf-plugin.h
R052	src/plugins/mbox-snarf/Makefile.am	src/plugins/snarf/Makefile.am
A	src/plugins/snarf/snarf-plugin.c
A	src/plugins/snarf/snarf-plugin.h

2010-11-18 18:57:18 +0000 Timo Sirainen <tss@iki.fi> (00a297e)

    pop3: Avoid crash when updating proctitle if client init fails.


M	src/pop3/pop3-client.c

2010-11-18 18:56:34 +0000 Timo Sirainen <tss@iki.fi> (fbb324f)

    mbox: Allow mail_privileged_group locking for INBOXes also in inbox=no
    namespaces.


M	src/lib-storage/index/mbox/mbox-lock.c
M	src/lib-storage/index/mbox/mbox-storage.c

2010-11-18 18:51:34 +0000 Timo Sirainen <tss@iki.fi> (85bb9e3)

    configure: And small fix to previous --with-systemdsystemunitdir fix.


M	configure.in

2010-11-18 18:49:34 +0000 Timo Sirainen <tss@iki.fi> (ee04300)

    configure: --with-systemdsystemunitdir wasn't working right.


M	configure.in

2010-11-18 18:38:08 +0000 Timo Sirainen <tss@iki.fi> (54f17c2)

    configure: Use AS_HELP_STRING() macro.


M	configure.in

2010-11-18 18:28:40 +0000 Timo Sirainen <tss@iki.fi> (0617586)

    master: Compiling fix when systemd is enabled.


M	src/master/service-listen.c

2010-11-17 18:40:52 +0000 Timo Sirainen <tss@iki.fi> (f6ba2de)

    Added support for systemd. Based on patch by Christophe Fergeau


M	Makefile.am
M	configure.in
A	dovecot.service.in
A	dovecot.socket
M	src/lib-master/master-service.c
M	src/master/Makefile.am
M	src/master/main.c
A	src/master/sd-daemon.c
A	src/master/sd-daemon.h
M	src/master/service-listen.c

2010-11-17 18:21:46 +0000 Timo Sirainen <tss@iki.fi> (71c5cba)

    configure: Use PKG_PROG_PKG_CONFIG to find pkg-config binary.


M	configure.in

2010-11-17 18:10:46 +0000 Timo Sirainen <tss@iki.fi> (b2b2b63)

    istream-header-filter: Fixed header name validation to use case-insensitive
    comparison.


M	src/lib-mail/istream-header-filter.c

2010-11-17 17:52:52 +0000 Timo Sirainen <tss@iki.fi> (1788395)

    lib-master: If auth master login fails, make sure error message is logged.


M	src/lib-master/master-login-auth.c

2010-11-17 16:55:56 +0000 Timo Sirainen <tss@iki.fi> (b57cd99)

    mysql: When using multiple hosts, it never connected to more than the first
    one.


M	src/lib-sql/driver-mysql.c

2010-11-17 16:55:44 +0000 Timo Sirainen <tss@iki.fi> (73bc59c)

    lib-sql: Connect earlier to fallback host when using multiple hosts and
    primary fails.


M	src/lib-sql/driver-sqlpool.c

2010-11-17 14:33:46 +0000 Timo Sirainen <tss@iki.fi> (d190598)

    master: Allow services' vsz_limit to be 0 (unlimited)


M	src/master/master-settings.c

2010-11-16 19:58:03 +0000 Timo Sirainen <tss@iki.fi> (f7f25f9)

    Services' default vsz_limit wasn't actually using default_vsz_limit but
    rather 4 GB.


M	src/anvil/anvil-settings.c
M	src/auth/auth-settings.c
M	src/config/config-settings.c
M	src/dict/dict-settings.c
M	src/director/director-settings.c
M	src/dns/dns-client-settings.c
M	src/doveadm/doveadm-settings.c
M	src/imap/imap-settings.c
M	src/log/log-settings.c
M	src/pop3/pop3-settings.c
M	src/ssl-params/ssl-params-settings.c
M	src/util/tcpwrap-settings.c

2010-11-16 19:51:46 +0000 Timo Sirainen <tss@iki.fi> (002179a)

    Fixed home=/home/./user style chrooting to work again.


M	src/lib-storage/mail-storage-service.c

2010-11-16 19:32:51 +0000 Timo Sirainen <tss@iki.fi> (3f6093a)

    master: Fail if service's vsz_limit is less than 1 kB


M	src/master/master-settings.c

2010-11-16 19:32:00 +0000 Timo Sirainen <tss@iki.fi> (e6aaf5a)

    imap/pop3-login: Default vsz_limit=64 caused it to be unlimited, not 64 MB.


M	src/imap-login/imap-login-settings.c
M	src/pop3-login/pop3-login-settings.c

2010-11-16 18:51:37 +0000 Timo Sirainen <tss@iki.fi> (3d4c241)

    mbox: Another utime()=EPERM log message hiding.


M	src/lib-storage/index/mbox/mbox-file.c

2010-11-16 18:47:48 +0000 Timo Sirainen <tss@iki.fi> (205debb)

    mbox: Ignore utime()=EPERM failures when trying to set atime back. This
    happens with shared mboxes when file's owner isn't the process's euid.


M	src/lib-storage/index/mbox/mbox-save.c
M	src/lib-storage/index/mbox/mbox-sync.c

2010-11-15 17:40:12 +0000 Timo Sirainen <tss@iki.fi> (57dc9b1)

    istream-base64-encoder: Set the stream seekable if parent stream is
    seekable.


M	src/lib/istream-base64-encoder.c

2010-11-15 17:03:52 +0000 Timo Sirainen <tss@iki.fi> (d482079)

    "Running standalone?" check now uses a new DOVECOT_CHILD_PROCESS environment
    rather than GENERATION. The GENERATION environment was already set in some
    systems for Java.


M	src/imap/main.c
M	src/lib-master/master-interface.h
M	src/lmtp/main.c
M	src/master/service-process.c
M	src/pop3/main.c
M	src/util/script-login.c

2010-11-15 16:49:26 +0000 Timo Sirainen <tss@iki.fi> (74b324a)

    lib-settings: Improved performance of previous duplicate key parsing change.


M	src/lib-settings/settings-parser.c

2010-11-15 16:42:19 +0000 Timo Sirainen <tss@iki.fi> (cdc74bd)

    lib-settings: Fixed parsing settings when the key was duplicated to multiple
    roots. Previously only the first one got the value set, now all of them get
    it.


M	src/lib-settings/settings-parser.c

2010-11-15 16:33:27 +0000 Timo Sirainen <tss@iki.fi> (7c20c51)

    Removed unused auth/mail_debug settings from structs.


M	src/imap/imap-settings.c
M	src/imap/imap-settings.h
M	src/master/master-settings.c
M	src/master/master-settings.h
M	src/pop3/pop3-settings.c
M	src/pop3/pop3-settings.h

2010-11-15 16:25:23 +0000 Timo Sirainen <tss@iki.fi> (334fcad)

    istream-file: Minor error message fix.


M	src/lib/istream-file.c

2010-11-15 16:22:08 +0000 Timo Sirainen <tss@iki.fi> (6a3a072)

    Added unit test for istream-base64-encoder.


M	src/lib/Makefile.am
A	src/lib/test-istream-base64-encoder.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2010-11-15 16:21:45 +0000 Timo Sirainen <tss@iki.fi> (5b548e1)

    istream-base64-encoder: Fixed seeking to beginning of stream.


M	src/lib/istream-base64-encoder.c

2010-11-15 16:06:58 +0000 Timo Sirainen <tss@iki.fi> (aa7103b)

    istream-base64-encoder: Don't add unwanted trailing [CR]LF


M	src/lib/istream-base64-encoder.c

2010-11-15 15:42:21 +0000 Timo Sirainen <tss@iki.fi> (010affb)

    dbox: dbox file could have been closed too early in some situations, causing
    EBADF errors.


M	src/lib-storage/index/dbox-common/dbox-mail.c

2010-11-15 15:31:26 +0000 Timo Sirainen <tss@iki.fi> (b545378)

    stream-base64-encoder: Added support for seeking backwards in stream.


M	src/lib/istream-base64-encoder.c

2010-11-15 15:31:02 +0000 Timo Sirainen <tss@iki.fi> (d9ab8a1)

    istream: Exported i_stream_default_seek()


M	src/lib/istream-internal.h
M	src/lib/istream.c

2010-11-15 15:19:13 +0000 Timo Sirainen <tss@iki.fi> (e22ac74)

    sdbox: Fixed race condition when one session opens a mailbox while another
    is still creating it. This happened mostly when nonexistent INBOX was being
    opened by multiple sessions at the same time.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2010-11-10 16:09:14 +0000 Timo Sirainen <tss@iki.fi> (8787860)

    anvil: Don't die until all of our clients have gone.


M	src/anvil/main.c

2010-11-09 21:42:58 +0000 Timo Sirainen <tss@iki.fi> (a857fb6)

    Added env_get_environ_p() as more portable way of accessing environ
    variable. Implemented with OS X using _NSGetEnviron().


M	src/lib-settings/settings-parser.c
M	src/lib/env-util.c
M	src/lib/env-util.h
M	src/lib/process-title.c

2010-11-09 21:17:15 +0000 Timo Sirainen <tss@iki.fi> (ac607f4)

    example-config: sendmail_path defaults to /usr/sbin/sendmail, not
    /usr/lib/sendmail


M	doc/example-config/conf.d/15-lda.conf

2010-11-09 21:16:06 +0000 Timo Sirainen <tss@iki.fi> (a1f2b44)

    example-config: Moved include conf.d/*.conf last in dovecot.conf. This fixes
    problems where conf.d/ files try to modify settings in dovecot.conf,
    especially managesieve adding itself to protocols setting.


M	doc/example-config/dovecot.conf

2010-11-09 21:12:35 +0000 Timo Sirainen <tss@iki.fi> (a2f99d3)

    dsync: Don't assert-crash if trying to convert mailbox whose name is too
    long.


M	src/dsync/dsync-worker-local.c

2010-11-09 21:03:34 +0000 Timo Sirainen <tss@iki.fi> (1a70427)

    istream-[b]zlib: Corking now affects also the parent stream.


M	src/plugins/zlib/ostream-bzlib.c
M	src/plugins/zlib/ostream-zlib.c

2010-11-09 20:25:36 +0000 Timo Sirainen <tss@iki.fi> (fc2a751)

    liblib: Delay sending log prefix updates until it's needed. This avoids
    sending them unnecessarily.


M	src/lib/failures.c

2010-11-09 20:24:12 +0000 Timo Sirainen <tss@iki.fi> (4cf07bf)

    imap: Uncork at logout a bit later.


M	src/imap/cmd-logout.c
M	src/imap/imap-client.c

2010-11-09 19:48:47 +0000 Timo Sirainen <tss@iki.fi> (e599fa1)

    lib-master: Don't wait for handshake before sending auth-master request.


M	src/lib-master/master-login-auth.c

2010-11-09 18:36:37 +0000 Timo Sirainen <tss@iki.fi> (9abf5be)

    lib-storage: Fixed expanding "~" (without '/' afterwards) in mail_location


M	src/lib-storage/mailbox-list.c

2010-11-08 19:55:35 +0000 Timo Sirainen <tss@iki.fi> (feba01f)

    NEWS: Split too long line.


M	NEWS

2010-11-08 19:45:17 +0000 Timo Sirainen <tss@iki.fi> (ea6a5c1)

    Added signature for changeset d0d3aca1c958


M	.hgsigs

2010-11-08 19:45:14 +0000 Timo Sirainen <tss@iki.fi> (6371b34)

    Added tag 2.0.7 for changeset d0d3aca1c958


M	.hgtags

2010-11-08 19:45:14 +0000 Timo Sirainen <tss@iki.fi> (45ed266)

    Released v2.0.7.


M	NEWS
M	TODO
M	configure.in

2010-11-08 18:38:31 +0000 Timo Sirainen <tss@iki.fi> (7aa2dd1)

    lmtp: Don't allow mixed proxy/non-proxy RCPT TO destinations. Although the
    code attempts to handle this case already, the DATA replies aren't sent in
    correct order.


M	src/lmtp/commands.c

2010-11-08 18:37:25 +0000 Timo Sirainen <tss@iki.fi> (1e09507)

    lmtp proxy: Don't internally finish proxying before client has even sent
    DATA command. This fixes some crashes when all recipients were invalid.


M	src/lmtp/lmtp-proxy.c

2010-11-08 18:30:05 +0000 Timo Sirainen <tss@iki.fi> (106e86d)

    istream-tee: Fixed to work right when input stream didn't start from offset
    0.


M	src/lib/istream-tee.c

2010-11-08 18:03:07 +0000 Timo Sirainen <tss@iki.fi> (c991c18)

    maildir: p_strdup() GUID and UIDL_BACKEND to make sure they don't change
    unexpectedly.


M	src/lib-storage/index/maildir/maildir-mail.c

2010-11-05 19:51:47 +0000 Timo Sirainen <tss@iki.fi> (63e2edd)

    lib-index: Fixed another transaction log read optimization. Buffer's size
    should always be the same as sync_offset, otherwise some optimizations could
    think that the data doesn't have to be re-read even though it was updated in
    disk already.


M	src/lib-index/mail-transaction-log-file.c

2010-11-05 18:58:56 +0000 Timo Sirainen <tss@iki.fi> (f34227d)

    lib-index: Fix to transaction log read optimization. The log wasn't always
    refreshed while locked when it should have.


M	src/lib-index/mail-transaction-log-file.c

2010-11-05 12:24:01 +0000 Timo Sirainen <tss@iki.fi> (9d2a30e)

    lib-auth: Less leaky fix to previous auth_master_*() bugfix.


M	src/lib-auth/auth-master.c

2010-11-05 12:15:53 +0000 Timo Sirainen <tss@iki.fi> (f98b69f)

    lib-auth: Don't crash in auth_master_*() lookups if caller hasn't created
    ioloop.


M	src/lib-auth/auth-master.c

2010-11-04 18:56:47 +0000 Timo Sirainen <tss@iki.fi> (40c24f8)

    quota: Better fix to avoid counting quota for virtual mailboxes.


M	src/plugins/quota/quota-maildir.c
M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c

2010-11-04 18:56:13 +0000 Timo Sirainen <tss@iki.fi> (4ba9a1d)

    virtual: Set MAIL_STORAGE_CLASS_FLAG_NOQUOTA to storage's class_flags.


M	src/lib-storage/mail-storage-private.h
M	src/plugins/virtual/virtual-storage.c

2010-11-04 17:55:47 +0000 Timo Sirainen <tss@iki.fi> (a32ac1a)

    lib-index: Minor error message improvement.


M	src/lib-index/mail-transaction-log-file.c

2010-11-04 17:50:42 +0000 Timo Sirainen <tss@iki.fi> (46b0fad)

    lib-fs / posix: If create/link/rename fails with ENOENT, try creating parent
    dir multiple times. This avoids random failures when the parent dir happens
    to be removed at just the right time.


M	src/lib-fs/fs-posix.c

2010-11-04 17:00:42 +0000 Timo Sirainen <tss@iki.fi> (7bb3cf9)

    dbox: Minor optimization when creating a mailbox when its alt dir already
    existed. Patch by DINH ViÃªt HoÃ 


M	src/lib-storage/index/dbox-common/dbox-storage.c

2010-11-04 16:37:49 +0000 Timo Sirainen <tss@iki.fi> (a640b06)

    ssl: Call OpenSSL_add_all_algorithms() to make some OpenSSL versions happy.


M	src/login-common/ssl-proxy-openssl.c

2010-11-04 16:25:39 +0000 Timo Sirainen <tss@iki.fi> (170d90a)

    istream-attachment: Error handling improvements.


M	src/lib-storage/index/istream-attachment.c

2010-11-04 16:25:18 +0000 Timo Sirainen <tss@iki.fi> (64c48ff)

    istream-concat: Fixed error handling when one of the stream read()s failed.


M	src/lib/istream-concat.c

2010-11-04 15:47:37 +0000 Timo Sirainen <tss@iki.fi> (1618629)

    config parser: Log an error about missing '}'.


M	src/config/config-parser-private.h
M	src/config/config-parser.c

2010-11-04 14:11:15 +0000 Timo Sirainen <tss@iki.fi> (effd6c0)

    istream-base64-encoder: Panic if stat() is tried to be called with exact
    size.


M	src/lib/istream-base64-encoder.c

2010-11-04 14:07:30 +0000 Timo Sirainen <tss@iki.fi> (ee083c4)

    istream-attachment: Removed parent stream's size sanity check. It didn't
    work right with base64 streams.


M	src/lib-storage/index/istream-attachment.c

2010-11-03 18:00:15 +0000 Timo Sirainen <tss@iki.fi> (cb506a7)

    lda: If Sieve is disabled, don't create temp files for large mails.


M	src/lda/main.c

2010-11-03 17:57:20 +0000 Timo Sirainen <tss@iki.fi> (291f1e5)

    lib-lda: mail_deliver_save() tries now to avoid re-parsing message header
    when logging the result.


M	src/lib-lda/mail-deliver.c
M	src/lib-lda/mail-deliver.h

2010-11-03 16:27:00 +0000 Timo Sirainen <tss@iki.fi> (8677db8)

    doveadm dump: Added imapzlib type to uncompress IMAP's COMPRESS DEFLATE I/O
    traffic.


M	src/plugins/zlib/Makefile.am
A	src/plugins/zlib/doveadm-zlib.c

2010-11-03 16:24:31 +0000 Timo Sirainen <tss@iki.fi> (134582c)

    doveadm dump: Allow plugins to add more dump types


M	src/doveadm/doveadm-dump.c
M	src/doveadm/doveadm-dump.h
M	src/doveadm/doveadm.c

2010-11-03 15:31:48 +0000 Timo Sirainen <tss@iki.fi> (76dd056)

    master: Log a warning at startup if anvil's client_limit is too low.


M	src/master/master-settings.c

2010-11-03 15:31:36 +0000 Timo Sirainen <tss@iki.fi> (f98cd3b)

    lmtp: Minor code cleanup: s/lmtp_login_/lmtp_/


M	src/lmtp/lmtp-settings.c

2010-11-03 15:27:40 +0000 Timo Sirainen <tss@iki.fi> (412b772)

    director: Show number of connections in process title if
    verbose_proctitle=yes


M	src/director/main.c

2010-11-03 15:26:40 +0000 Timo Sirainen <tss@iki.fi> (737f6f1)

    anvil: Show number of connections in process title if verbose_proctitle=yes


M	src/anvil/main.c

2010-11-03 15:23:52 +0000 Timo Sirainen <tss@iki.fi> (e2bdca8)

    lib-master: Added MASTER_SERVICE_FLAG_UPDATE_PROCTITLE for showing number of
    connections in ps. The title is still only updated if verbose_proctitle=yes,
    so this allows binaries to easily just set the flag and lib-master handles
    the rest.


M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
M	src/lib-master/master-service.c
M	src/lib-master/master-service.h

2010-11-03 14:59:39 +0000 Timo Sirainen <tss@iki.fi> (361c90a)

    auth workers: Don't unnecessary connect to anvil.


M	src/auth/main.c

2010-11-03 13:33:02 +0000 Timo Sirainen <tss@iki.fi> (5543cc0)

    master: default_process_limit wasn't actually used anywhere, rather the
    default was unlimited.


M	src/master/master-settings.c
M	src/master/service.c

2010-11-02 19:23:37 +0000 Timo Sirainen <tss@iki.fi> (89ad7c3)

    lib-storage: Maildir++ mailbox listing could have given wrong flags to
    parent mailboxes.


M	src/lib-storage/list/mailbox-list-maildir-iter.c

2010-11-02 18:25:53 +0000 Timo Sirainen <tss@iki.fi> (cbb5c7a)

    imap: Removed accidentally commited debug code.


M	src/imap/imap-client.c

2010-11-02 18:21:05 +0000 Timo Sirainen <tss@iki.fi> (c4c8182)

    lib-master: Stop accepting new connections after auth-master gets
    disconnected.


M	src/lib-master/master-login-auth.c

2010-11-02 18:13:39 +0000 Timo Sirainen <tss@iki.fi> (0e6bd4b)

    imap, pop3: Use absolute path to auth-master socket.


M	src/imap/main.c
M	src/pop3/main.c

2010-11-02 18:07:20 +0000 Timo Sirainen <tss@iki.fi> (5c9ddc0)

    ldap auth: Hide password_noscheme from debug logs unless
    auth_debug_passwords=yes


M	src/auth/db-ldap.c

2010-11-02 18:06:39 +0000 Timo Sirainen <tss@iki.fi> (dc8ba48)

    sql auth: Fixed using password_noscheme


M	src/auth/passdb-sql.c

2010-11-02 17:31:14 +0000 Timo Sirainen <tss@iki.fi> (9766c24)

    auth: Disable auth caching entirely for master users. The cache key contains
    only the master username, without the logged-in username, so wrong data
    could be looked up from cache.


M	src/auth/auth-request.c
M	src/auth/passdb-cache.c

2010-11-02 17:14:25 +0000 Timo Sirainen <tss@iki.fi> (23163a9)

    imap: Fixed SELECT QRESYNC not to crash on mailbox close if a lot of changes
    were being sent.


M	src/imap/cmd-select.c
M	src/imap/imap-client.c
M	src/imap/main.c

2010-11-02 15:39:28 +0000 Timo Sirainen <tss@iki.fi> (c64e714)

    auth: vpopmail passdb/userdb uses now auth-worker processes by default.
    Adding blocking=no parameter disables this.


M	src/auth/passdb-vpopmail.c
M	src/auth/userdb-vpopmail.c

2010-11-02 15:34:50 +0000 Timo Sirainen <tss@iki.fi> (7c6b8ca)

    dbox: Comment update.


M	src/lib-storage/index/dbox-common/dbox-file.h

2010-11-02 15:32:47 +0000 Timo Sirainen <tss@iki.fi> (676bf7a)

    imap: Fixed LIST-STATUS when listing subscriptions with subscriptions=no
    namespaces.


M	src/imap/cmd-list.c

2010-11-02 14:59:13 +0000 Timo Sirainen <tss@iki.fi> (5bd2cf0)

    mail-log plugin: Log mailbox name as virtual name rather than physical name.


M	src/plugins/mail-log/mail-log-plugin.c

2010-11-02 13:43:43 +0000 Timo Sirainen <tss@iki.fi> (fa87f0e)

    director: inet_listener port finder should ignore doveadm's port.


M	src/director/main.c

2010-11-01 14:33:26 +0000 Timo Sirainen <tss@iki.fi> (53e85e6)

    quota: Added a temporary hack to avoid virtual mailboxes being counted in
    quota.


M	src/plugins/quota/quota-storage.c

2010-10-25 22:22:48 +0100 Timo Sirainen <tss@iki.fi> (1ebce80)

    dsync: Make sure MSG-GET command doesn't hang.


M	src/dsync/dsync-proxy-server-cmd.c

2010-10-25 22:13:05 +0100 Timo Sirainen <tss@iki.fi> (41a8595)

    dsync: Added more idle timeout resets to proxying.


M	src/dsync/dsync-proxy-client.c

2010-10-25 19:26:34 +0100 Timo Sirainen <tss@iki.fi> (0dc7a67)

    dbox: mail_get_special() for POP3 UIDL or GUID return value wasn't permanent
    enough. Another call to mail_get_*() could have caused the string to point
    to some garbage.


M	src/lib-storage/index/dbox-common/dbox-mail.c

2010-10-25 18:53:04 +0100 Timo Sirainen <tss@iki.fi> (afe6229)

    dsync: Error handling fixes.


M	src/dsync/dsync-proxy-client.c
M	src/dsync/dsync-proxy-server.c
M	src/dsync/dsync-worker-local.c

2010-10-25 18:26:50 +0100 Timo Sirainen <tss@iki.fi> (2be46af)

    dsync: If msg input reading fails, don't also log a wrong "Unknown internal
    error" line.


M	src/dsync/dsync-worker-local.c

2010-10-25 18:11:04 +0100 Timo Sirainen <tss@iki.fi> (5ab8558)

    lib-storage: Comment update to mail_get_stream()


M	src/lib-storage/mail-storage.h

2010-10-25 17:34:10 +0100 Timo Sirainen <tss@iki.fi> (5e6abd3)

    master: Use env_clean_except() instead of doing it ourself.


M	src/master/main.c

2010-10-25 17:31:39 +0100 Timo Sirainen <tss@iki.fi> (75e531c)

    lib-master: Use env_clean_except() for master_service_env_clean()


M	src/lib-master/master-service.c

2010-10-25 17:31:01 +0100 Timo Sirainen <tss@iki.fi> (5aaddef)

    Added env_clean_except()


M	src/lib/env-util.c
M	src/lib/env-util.h

2010-10-25 17:22:40 +0100 Timo Sirainen <tss@iki.fi> (3eeaad7)

    lib-master: Code cleanup for master_service_env_clean()


M	src/lib-master/master-service.c

2010-10-25 16:27:42 +0100 Timo Sirainen <tss@iki.fi> (92c474b)

    doveadm expunge: Sync mailbox after commit to make sure messages get
    physically expunged.


M	src/doveadm/doveadm-mail-expunge.c

2010-10-25 16:13:33 +0100 Timo Sirainen <tss@iki.fi> (b3b536d)

    maildir: Duplicate GUIDs during a single save transaction weren't handled
    correctly.


M	src/lib-storage/index/maildir/maildir-save.c

2010-10-21 22:59:26 +0100 Timo Sirainen <tss@iki.fi> (8effb0c)

    file_preallocate(): Don't ignore ENOSPC with OSX either, caller will check
    it.


M	src/lib/file-set-size.c

2010-10-21 22:56:02 +0100 Timo Sirainen <tss@iki.fi> (ed7dbb4)

    file_preallocate(): Added support for OS X.


M	src/lib/file-set-size.c

2010-10-21 22:45:27 +0100 Timo Sirainen <tss@iki.fi> (7f03bac)

    doveadm fetch: Added support for pop3.uidl field.


M	src/doveadm/doveadm-mail-fetch.c

2010-10-21 22:21:57 +0100 Timo Sirainen <tss@iki.fi> (3649d7f)

    NEWS: mdbox_preallocate_space is for ext4, not ext3.


M	NEWS

2010-10-21 22:09:08 +0100 Timo Sirainen <tss@iki.fi> (62c635c)

    configure: Use sdbox name instead of dbox in the help.


M	configure.in

2010-10-21 19:07:18 +0100 Timo Sirainen <tss@iki.fi> (d8346a7)

    Added signature for changeset 8a838dcf8e76


M	.hgsigs

2010-10-21 19:07:15 +0100 Timo Sirainen <tss@iki.fi> (f296236)

    Added tag 2.0.6 for changeset 8a838dcf8e76


M	.hgtags

2010-10-21 19:07:14 +0100 Timo Sirainen <tss@iki.fi> (9b9d8e0)

    Released v2.0.6.


M	NEWS
M	TODO
M	configure.in

2010-10-21 19:03:39 +0100 Timo Sirainen <tss@iki.fi> (0b7d392)

    Static analyzer warning fix.


M	src/doveadm/doveadm-sis.c

2010-10-21 18:59:22 +0100 Timo Sirainen <tss@iki.fi> (13625d4)

    doveadm import: Code correctness fix (wasn't visible to users)


M	src/doveadm/doveadm-mail-import.c

2010-10-21 18:56:24 +0100 Timo Sirainen <tss@iki.fi> (eb4b779)

    lib-fs: Fixed error handling for posix.write_stream_finish()


M	src/lib-fs/fs-posix.c

2010-10-21 18:49:19 +0100 Timo Sirainen <tss@iki.fi> (4ca8361)

    dbox: Reverted the "check if altpath is mounted" change for now. If alt path
    didn't yet exist, it reported bogus errors. It should somehow check if there
    is anything under the alt root dir.


M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-file.h
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-file.h
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c

2010-10-21 18:28:10 +0100 Timo Sirainen <tss@iki.fi> (8342ac5)

    dsync: Make sure POP3 UIDL string isn't corrupted while saving it.


M	src/dsync/dsync-worker-local.c

2010-10-21 18:27:38 +0100 Timo Sirainen <tss@iki.fi> (7cd7bd6)

    lib-storage: Make sure POP3 UIDLs aren't tried to be saved with LFs.


M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/mail-storage.c

2010-10-21 17:12:19 +0100 Timo Sirainen <tss@iki.fi> (cb51bd2)

    Compiler warning fix.


M	src/lib-master/master-login-auth.c

2010-10-21 17:11:02 +0100 Timo Sirainen <tss@iki.fi> (a7f5035)

    auth: userdb passwd iteration now lists only users within
    first_valid_uid..last_valid_uid range.


M	src/auth/auth-settings.c
M	src/auth/auth-settings.h
M	src/auth/userdb-passwd.c

2010-10-21 16:33:28 +0100 Timo Sirainen <tss@iki.fi> (7631552)

    dbox: If alt path is lost, fail with an error rather than rebuilding
    indexes. This could be simply because alt storage is unmounted at the time
    and rebuilding would just lose messages. If this error happens
    unintentionally, it's still possible to fix it with "doveadm force-resync".


M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-file.h
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-storage-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-file.h
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-sync-rebuild.c
M	src/lib-storage/index/dbox-single/sdbox-sync.c

2010-10-21 16:12:13 +0100 Timo Sirainen <tss@iki.fi> (a5925b1)

    dsync: Don't crash if USER environment isn't set and -u parameter isn't
    given.


M	src/dsync/dsync.c

2010-10-20 19:32:16 +0100 Timo Sirainen <tss@iki.fi> (f807d40)

    example-config: Added a warning about mail_attachment* being experimental.


M	doc/example-config/conf.d/10-mail.conf

2010-10-20 19:30:12 +0100 Timo Sirainen <tss@iki.fi> (9ff4eaf)

    example-config: Added mail_attachment_* settings.


M	doc/example-config/conf.d/10-mail.conf

2010-10-20 18:58:42 +0100 Timo Sirainen <tss@iki.fi> (d4f7211)

    zlib: Hook into mail.istream_opened() method rather than mail.get_stream()
    This fixes zlib plugin to work with mail attachments.


M	src/plugins/zlib/zlib-plugin.c

2010-10-20 18:55:36 +0100 Timo Sirainen <tss@iki.fi> (6564208)

    lib-storage: Added istream_opened() method to struct mail. This can be
    hooked into by plugins that want to do something with the message's stream
    in the message file, rather than the virtual resulting stream visible to
    client. For example when using dbox attachments, this stream contains only
    the data in the dbox files without any external attachments.


M	src/lib-storage/index/cydir/cydir-mail.c
M	src/lib-storage/index/dbox-common/dbox-attachment.c
M	src/lib-storage/index/dbox-common/dbox-attachment.h
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-file.h
M	src/lib-storage/index/dbox-common/dbox-mail.c
M	src/lib-storage/index/dbox-multi/mdbox-mail.c
M	src/lib-storage/index/dbox-single/sdbox-mail.c
M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/mbox/mbox-mail.c
M	src/lib-storage/index/raw/raw-mail.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/test-mail.c
M	src/plugins/virtual/virtual-mail.c

2010-10-20 18:49:07 +0100 Timo Sirainen <tss@iki.fi> (64055bc)

    istream-concat: Avoid assert-crashing.


M	src/lib/istream-concat.c

2010-10-20 17:51:07 +0100 Timo Sirainen <tss@iki.fi> (f6aaada)

    mdbox: Added mdbox_preallocate_space setting to preallocate size for newly
    created files.


M	doc/example-config/conf.d/10-mail.conf
M	src/lib-storage/index/dbox-multi/mdbox-file.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.c
M	src/lib-storage/index/dbox-multi/mdbox-settings.h
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.h

2010-10-20 17:50:03 +0100 Timo Sirainen <tss@iki.fi> (54fc388)

    Added file_preallocate() to preallocate space to a file without changing its
    size. Implemented for Linux. Doesn't look like other OSes support this.


M	configure.in
M	src/lib/file-set-size.c
M	src/lib/file-set-size.h

2010-10-20 16:07:03 +0100 Timo Sirainen <tss@iki.fi> (1554bed)

    dbox, maildir: When copying messages, copy the cached fields also. Copy only
    fields whose caching decision is not "no" in the destination mailbox.


M	src/lib-storage/index/dbox-multi/mdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/index-storage.c
M	src/lib-storage/index/index-storage.h
M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-storage.h

2010-10-20 16:03:13 +0100 Timo Sirainen <tss@iki.fi> (f43dce3)

    lib-storage: mailbox_get_status(): return cache fields allocated from data
    stack. Allocating them from mailbox's pool just wastes memory if it's called
    multiple times for same mailbox.


M	src/lib-storage/index/index-status.c

2010-10-20 16:01:46 +0100 Timo Sirainen <tss@iki.fi> (e2e105f)

    lib-index: Added mail_cache_register_get_field().


M	src/lib-index/mail-cache-fields.c
M	src/lib-index/mail-cache.h

2010-10-19 20:20:18 +0100 Timo Sirainen <tss@iki.fi> (d26d536)

    pop3: Don't crash if client disconnects in output handler.


M	src/pop3/pop3-client.c

2010-10-19 19:27:59 +0100 Timo Sirainen <tss@iki.fi> (8b6f569)

    ioloop: If io_add() is called twice for same fd, give a bit more informative
    panic message.


M	src/lib/ioloop-iolist.c

2010-10-19 18:48:00 +0100 Timo Sirainen <tss@iki.fi> (aee9abe)

    istream-header-filter: Fix to previous change.


M	src/lib-mail/istream-header-filter.c

2010-10-19 18:47:17 +0100 Timo Sirainen <tss@iki.fi> (b9f564d)

    lib-storage: Added support for saving mail attachments separately via
    filesystem API. Currently this works only with sdbox and mdbox backends.


M	src/config/settings-get.pl
M	src/lib-storage/index/Makefile.am
M	src/lib-storage/index/cydir/cydir-storage.c
M	src/lib-storage/index/dbox-common/Makefile.am
A	src/lib-storage/index/dbox-common/dbox-attachment.c
A	src/lib-storage/index/dbox-common/dbox-attachment.h
M	src/lib-storage/index/dbox-common/dbox-file.c
M	src/lib-storage/index/dbox-common/dbox-save.c
M	src/lib-storage/index/dbox-common/dbox-storage.c
M	src/lib-storage/index/dbox-common/dbox-storage.h
M	src/lib-storage/index/dbox-multi/mdbox-purge.c
M	src/lib-storage/index/dbox-multi/mdbox-storage.c
M	src/lib-storage/index/dbox-single/Makefile.am
M	src/lib-storage/index/dbox-single/sdbox-copy.c
M	src/lib-storage/index/dbox-single/sdbox-file.c
M	src/lib-storage/index/dbox-single/sdbox-file.h
M	src/lib-storage/index/dbox-single/sdbox-save.c
M	src/lib-storage/index/dbox-single/sdbox-storage.c
M	src/lib-storage/index/dbox-single/sdbox-storage.h
M	src/lib-storage/index/dbox-single/sdbox-sync.c
A	src/lib-storage/index/index-attachment.c
A	src/lib-storage/index/index-attachment.h
M	src/lib-storage/index/index-storage.c
A	src/lib-storage/index/istream-attachment.c
A	src/lib-storage/index/istream-attachment.h
M	src/lib-storage/index/maildir/maildir-storage.c
M	src/lib-storage/index/mbox/mbox-storage.c
M	src/lib-storage/index/raw/raw-storage.c
M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage-settings.c
M	src/lib-storage/mail-storage-settings.h
M	src/lib-storage/test-mailbox.c
M	src/plugins/virtual/virtual-storage.c

2010-10-19 18:30:51 +0100 Timo Sirainen <tss@iki.fi> (dc2e774)

    liblib: Added istream for reading binary data as base64-encoded.


M	src/lib/Makefile.am
A	src/lib/istream-base64-encoder.c
A	src/lib/istream-base64-encoder.h

2010-10-19 18:27:30 +0100 Timo Sirainen <tss@iki.fi> (75d9024)

    doveadm: Added commands for managing SiS directories.


M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-sis.c
M	src/doveadm/doveadm.c
M	src/doveadm/doveadm.h

2010-10-19 18:16:10 +0100 Timo Sirainen <tss@iki.fi> (c33d3f9)

    Added lib-fs for simple filesystem accessing. Implemented POSIX, SiS and
    SiS-queue backends.


M	configure.in
M	src/Makefile.am
M	src/lib-dovecot/Makefile.am
A	src/lib-fs/Makefile.am
A	src/lib-fs/fs-api-private.h
A	src/lib-fs/fs-api.c
A	src/lib-fs/fs-api.h
A	src/lib-fs/fs-posix.c
A	src/lib-fs/fs-sis-common.c
A	src/lib-fs/fs-sis-common.h
A	src/lib-fs/fs-sis-queue.c
A	src/lib-fs/fs-sis.c
A	src/lib-fs/ostream-cmp.c
A	src/lib-fs/ostream-cmp.h

2010-10-19 18:10:34 +0100 Timo Sirainen <tss@iki.fi> (37bd985)

    liblib: Added API for easily building hash strings based on given format
    string and input.


M	src/lib/Makefile.am
A	src/lib/hash-format.c
A	src/lib/hash-format.h
A	src/lib/test-hash-format.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h

2010-10-19 18:09:16 +0100 Timo Sirainen <tss@iki.fi> (74ae325)

    liblib: Added a common API for accessing all hash methods.


M	src/lib/Makefile.am
A	src/lib/hash-method.c
A	src/lib/hash-method.h
M	src/lib/md4.c
M	src/lib/md4.h
M	src/lib/md5.c
M	src/lib/md5.h
M	src/lib/sha1.c
M	src/lib/sha1.h
M	src/lib/sha2.c
M	src/lib/sha2.h

2010-10-19 18:39:27 +0100 Timo Sirainen <tss@iki.fi> (b32c016)

    istream-header-filter: Drop duplicate headers instead of assert-crashing
    with them.


M	src/lib-mail/istream-header-filter.c

2010-10-18 19:00:59 +0100 Timo Sirainen <tss@iki.fi> (dd350fb)

    acl: Recent change broke setting acls.


M	src/plugins/acl/acl-mailbox.c

2010-10-18 18:30:42 +0100 Timo Sirainen <tss@iki.fi> (88c816e)

    doveadm: Added import command for importing mails from other storages.


M	.hgignore
M	doc/man/Makefile.am
A	doc/man/doveadm-import.1.in
M	src/doveadm/Makefile.am
A	src/doveadm/doveadm-mail-import.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2010-10-18 18:30:02 +0100 Timo Sirainen <tss@iki.fi> (354268a)

    doveadm: Call mail command's init() only after service storage is
    initialized.


M	src/doveadm/client-connection.c
M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2010-10-18 18:09:56 +0100 Timo Sirainen <tss@iki.fi> (762e170)

    lib-storage: Added no_userdb_lookup flag to storage service lookups.


M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2010-10-18 16:51:12 +0100 Timo Sirainen <tss@iki.fi> (08baf8e)

    ostream-file: Fixed potential crash in write_at() and also fixed attempted
    optimization.


M	src/lib/Makefile.am
M	src/lib/ostream-file.c
M	src/lib/test-lib.c
M	src/lib/test-lib.h
A	src/lib/test-ostream-file.c

2010-10-18 16:14:08 +0100 Timo Sirainen <tss@iki.fi> (47c7c7a)

    lib-index: More undoing of locking code changes.


M	src/lib-index/mail-index-lock.c

2010-10-18 16:07:17 +0100 Timo Sirainen <tss@iki.fi> (c22572f)

    acl: Fixed memory leaks.


M	src/plugins/acl/acl-mailbox-list.c
M	src/plugins/acl/acl-mailbox.c

2010-10-18 15:38:58 +0100 Timo Sirainen <tss@iki.fi> (f2df306)

    auth: Default for auth_cache_negative_ttl was supposed to be 1 hour, not
    disabled.


M	src/auth/auth-settings.c

2010-10-18 15:35:24 +0100 Timo Sirainen <tss@iki.fi> (25c4225)

    auth: Log userdb cache hits and misses with auth_debug=yes


M	src/auth/auth-request.c

2010-10-18 15:07:02 +0100 Timo Sirainen <tss@iki.fi> (9789e1f)

    lib-storage: Log a debug message if shared user's storage root doesn't exist
    with mail_debug=yes


M	src/lib-storage/mail-storage.c

2010-10-18 14:52:02 +0100 Timo Sirainen <tss@iki.fi> (9c3b041)

    acl: Avoid passing NULL parameter to printf %s when mail_debug=yes


M	src/plugins/acl/acl-backend-vfile.c

2010-10-16 18:33:42 +0100 Timo Sirainen <tss@iki.fi> (0678d7e)

    pop3: Recent corking change caused hangs.


M	src/pop3/pop3-client.c

2010-10-16 00:49:35 +0100 Timo Sirainen <tss@iki.fi> (8406c1d)

    Removed some dead code.


M	src/lib-index/mail-index-sync-ext.c
M	src/lib-mail/istream-header-filter.c
M	src/plugins/acl/acl-backend-vfile.c

2010-10-16 00:43:49 +0100 Timo Sirainen <tss@iki.fi> (b99f3f9)

    lib-index: Work around clang static analyzer's false positive "dead code"
    issue.


M	src/lib-index/mail-index-sync-update.c

2010-10-16 00:35:28 +0100 Timo Sirainen <tss@iki.fi> (4059c8e)

    lib-lda: Make sure duplicate_init() handles non-existent home correctly.
    With previous change mail_user_get_home() always set home, but this is good
    anyway.


M	src/lib-lda/duplicate.c

2010-10-16 00:34:28 +0100 Timo Sirainen <tss@iki.fi> (72276c9)

    lib-storage: mail_user_get_home(): Make sure user_r is always set.


M	src/lib-storage/mail-user.c

2010-10-16 00:30:50 +0100 Timo Sirainen <tss@iki.fi> (751cb41)

    lib-storage: mailbox_get_guid() crashed if storage didn't support GUIDs.


M	src/lib-storage/mail-storage.c

2010-10-16 00:23:20 +0100 Timo Sirainen <tss@iki.fi> (5a0ac2e)

    istream-concat: Fixed another memory leak.


M	src/lib/istream-concat.c

2010-10-16 00:21:35 +0100 Timo Sirainen <tss@iki.fi> (4143cfa)

    lmtp: Don't access freed memory if input couldn't be opened as raw mail.
    This shouldn't really have ever happened.


M	src/lmtp/commands.c

2010-10-15 19:50:51 +0100 Timo Sirainen <tss@iki.fi> (701a594)

    istream-header-filter: Assert-crash if headers aren't given sorted.


M	src/lib-mail/istream-header-filter.c
M	src/lib-mail/test-istream-header-filter.c

2010-10-15 19:40:06 +0100 Timo Sirainen <tss@iki.fi> (fa0762e)

    Compiler warning/error fix to recent logging API changes.


M	src/master/main.c

2010-10-15 19:30:04 +0100 Timo Sirainen <tss@iki.fi> (efb0def)

    lmtp: Reverted last change after all. Besides, the error code was wrong.


M	src/lmtp/commands.c

2010-10-15 19:21:43 +0100 Timo Sirainen <tss@iki.fi> (979b2a0)

    lmtp: Don't allow saving zero byte sized messages.


M	src/lmtp/commands.c

2010-10-15 19:04:42 +0100 Timo Sirainen <tss@iki.fi> (4d4cd9c)

    epoll: Suggest not-so-UUOC if epoll_ctl() fails for stdin


M	src/lib/ioloop-epoll.c

2010-10-15 18:55:52 +0100 Timo Sirainen <tss@iki.fi> (7823ef7)

    istream-concat: Fixed a memory leak.


M	src/lib/istream-concat.c

2010-10-15 18:50:44 +0100 Timo Sirainen <tss@iki.fi> (e648813)

    lib-storage: Added assert to transaction rollback to make sure all mails are
    freed. The same assert was already in commit, so this should be fine.


M	src/lib-storage/index/index-transaction.c

2010-10-15 16:24:25 +0100 Timo Sirainen <tss@iki.fi> (301740f)

    auth: Make sure auth request is kept referenced during the lookup.


M	src/auth/auth-penalty.c

2010-10-15 16:16:23 +0100 Timo Sirainen <tss@iki.fi> (56ba5a9)

    lib-master: Properly fixed accepting FIFO connections with BSDI.


M	src/lib-master/master-service.c

2010-10-15 16:09:13 +0100 Timo Sirainen <tss@iki.fi> (19c587f)

    log: Avoid calling time() unnecessary when logging multiple lines.


M	src/log/log-connection.c

2010-10-15 16:08:12 +0100 Timo Sirainen <tss@iki.fi> (8882cee)

    Failure logging supports now getting timestamp as parameter.


M	src/lib/failures.c
M	src/lib/failures.h

2010-10-15 15:46:43 +0100 Timo Sirainen <tss@iki.fi> (2303ad6)

    Cleaned up log callbacks and made them more extensible.
    fatal_failure_callback_t type is now gone, there's only failure_callback_t
    left that has a struct pointer as parameter. More parameters can be easily
    added to the struct in future.


M	src/doveadm/doveadm-log.c
M	src/lib-test/test-common.c
M	src/lib/failures.c
M	src/lib/failures.h
M	src/log/log-connection.c
M	src/master/main.c

2010-10-15 15:13:59 +0100 Timo Sirainen <tss@iki.fi> (925915b)

    acl: Log mailbox names that are skipped due to missing lookup right with
    mail_debug=yes


M	src/plugins/acl/acl-mailbox-list.c

2010-10-15 15:09:18 +0100 Timo Sirainen <tss@iki.fi> (4ed1c0f)

    lib-storage: Log attempted accesses to nonexistent users' mails with
    mail_debug=yes.


M	src/lib-storage/index/shared/shared-storage.c

2010-10-15 14:57:36 +0100 Timo Sirainen <tss@iki.fi> (cc2c73b)

    lib-storage: Use MAIL_STORAGE_FLAG_NO_AUTOVERIFY for creating shared
    namespace storages. This avoids failing storage creation for nonexistent
    users. Previous failure made it possible for logged in users to figure out
    what other usernames existed on the system.


M	src/lib-storage/index/shared/shared-storage.c

2010-10-15 14:56:05 +0100 Timo Sirainen <tss@iki.fi> (cab9d33)

    lib-storage: Added MAIL_STORAGE_FLAG_NO_AUTOVERIFY to skip checking storage
    root dir existence.


M	src/lib-storage/mail-storage.c
M	src/lib-storage/mail-storage.h

2010-10-15 14:48:31 +0100 Timo Sirainen <tss@iki.fi> (9a3f0c5)

    ldap: Compare LDAP attribute names case-insensitively.


M	src/auth/passdb-ldap.c
M	src/auth/userdb-ldap.c

2010-10-15 13:27:59 +0100 Timo Sirainen <tss@iki.fi> (834726f)

    ldap: Log a warning if iterate_attrs has other fields than 'user'.


M	src/auth/userdb-ldap.c

2010-10-14 18:20:58 +0100 Timo Sirainen <tss@iki.fi> (42eaa08)

    maildir: Check correctly if file is a symlink. Patch by Mike Abbott / Apple.


M	src/lib-storage/index/maildir/maildir-util.c

2010-10-14 17:23:11 +0100 Timo Sirainen <tss@iki.fi> (6c80172)

    lib-index: Put back some of the removed locking complexity. This fixes a
    crash when mmap_disable=no and a index was mmap()ed (which keeps the index
    locked) and later its read-lock was tried to be changed to write-lock.


M	src/lib-index/mail-index-lock.c

2010-10-14 17:02:20 +0100 Timo Sirainen <tss@iki.fi> (506e41a)

    *-login: If client didn't log in, don't log mpid in logout message.


M	src/login-common/client-common.c

2010-10-14 16:58:57 +0100 Timo Sirainen <tss@iki.fi> (53d62bb)

    imap, pop3: Cork TCP connection before trying to flush output in output
    callback.


M	src/imap/imap-client.c
M	src/pop3/pop3-client.c

2010-10-14 16:53:04 +0100 Timo Sirainen <tss@iki.fi> (038cb27)

    lib-storage: If mailbox deletion failed, we crashed while trying to write
    undelete record to index.


M	src/lib-storage/mail-storage.c

2010-10-14 16:22:54 +0100 Timo Sirainen <tss@iki.fi> (b325461)

    lib-index: Don't reopen mailbox log file too often.


M	src/lib-index/mailbox-log.c

2010-10-14 16:17:43 +0100 Timo Sirainen <tss@iki.fi> (dedf3b4)

    lib-index: Mailbox log writing was trying to write to a closed log file fd.


M	src/lib-index/mailbox-log.c

2010-10-14 15:59:11 +0100 Timo Sirainen <tss@iki.fi> (0595524)

    auth: Give a better error message if pass=yes can't be used in master
    passdb.


M	src/auth/auth-request.c

2010-10-06 19:49:31 +0100 Timo Sirainen <tss@iki.fi> (2821420)

    quota: Log a warning if Maildir++ quota is enabled for non-Maildir storage.


M	src/plugins/quota/quota-maildir.c

2010-10-06 19:35:17 +0100 Timo Sirainen <tss@iki.fi> (51a9c44)

    master: Parse and check full config at startup.


M	src/master/main.c

2010-10-06 19:35:06 +0100 Timo Sirainen <tss@iki.fi> (8d173ad)

    lib-master: Added support for parse_full_config input option for settings
    parsing.


M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h

2010-10-06 19:34:41 +0100 Timo Sirainen <tss@iki.fi> (fbef0c4)

    doveconf: Added -p parameter to parse full config even if -m module is
    given.


M	src/config/doveconf.c

2010-10-06 19:19:48 +0100 Timo Sirainen <tss@iki.fi> (6af9d20)

    maildir: Write only base filenames to uidlist. Previously the old filename
    was used to guess the initial filename, but nowadays we do that by building
    the filename based on flags in index.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-10-06 19:08:43 +0100 Timo Sirainen <tss@iki.fi> (de62479)

    imap search: Fixed YOUNGER/OLDER


M	src/lib-storage/mail-search-register-imap.c

2010-10-06 19:02:20 +0100 Timo Sirainen <tss@iki.fi> (c4476f5)

    search: If body search fails due to I/O error, keep the result as "unknown".
    Found by Vadim Okun


M	src/lib-storage/index/index-search.c

2010-10-06 18:57:38 +0100 Timo Sirainen <tss@iki.fi> (7ccae90)

    lda: -m parameter's UTF-8 validity wasn't checked correctly. Found by Vadim
    Okun


M	src/lda/main.c

2010-10-06 18:57:16 +0100 Timo Sirainen <tss@iki.fi> (a2ec982)

    lib-lda: Fixed error handling if newly delivered mail couldn't be opened.
    Found by Vadim Okun.


M	src/lib-lda/mail-deliver.c

2010-10-06 18:20:26 +0100 Timo Sirainen <tss@iki.fi> (5e88e46)

    lib-index: Always update index map while committing a transaction. The
    previous code was doing this only in some situations, which was probably
    enough, except maybe in some special cases. The log file was also read until
    EOF always anyway, so the only thing this was saving was some CPU. With the
    new behavior the committing stage should be more reliable, and also makes it
    easier to do changes without accidentally breaking it.


M	src/lib-index/mail-index-transaction-finish.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction.c

2010-10-06 18:18:30 +0100 Timo Sirainen <tss@iki.fi> (16c28dd)

    lib-index: Cache offsets were sometimes written pointing to an older cache
    file.


M	src/lib-index/mail-cache-transaction.c
M	src/lib-index/mail-index-transaction-private.h
M	src/lib-index/mail-index-transaction-update.c

2010-10-06 17:15:51 +0100 Timo Sirainen <tss@iki.fi> (07e80e0)

    lib-index: Avoid unnecessary pread()s at end of transaction log file. If
    we've already read until EOF while the file has been locked, there's no need
    to do it again. Previously this worked while index was being synced, but not
    while committing a transaction.


M	src/lib-index/mail-index-fsck.c
M	src/lib-index/mail-index-private.h
M	src/lib-index/mail-index-transaction.c
M	src/lib-index/mail-index-write.c
M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log-append.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c
M	src/lib-index/test-mail-transaction-log-view.c

2010-10-06 17:11:52 +0100 Timo Sirainen <tss@iki.fi> (25d2214)

    lib-index: Removed unnecessary code from lock handling. The code was
    intended only for blocking write-locks, but those haven't been used for a
    long time now.


M	src/lib-index/mail-index-lock.c

2010-10-06 16:17:08 +0100 Timo Sirainen <tss@iki.fi> (858aec7)

    lib-dict: If connect() to dict socket fails, log an error, but don't die.


M	src/lib-dict/dict-client.c

2010-10-06 15:54:14 +0100 Timo Sirainen <tss@iki.fi> (596ec38)

    quota: Give better error message for connect() EACCES failure to
    quota-warning socket.


M	src/plugins/quota/quota.c

2010-10-05 22:55:37 +0100 Timo Sirainen <tss@iki.fi> (a3d1e23)

    auth: Added lookup_credentials() support for passdb static


M	src/auth/passdb-static.c

2010-10-05 22:53:58 +0100 Timo Sirainen <tss@iki.fi> (5fcc2aa)

    imap IDLE: Don't send "Still here" notifications if there is already data in
    output buffer.


M	src/imap/cmd-idle.c

2010-10-05 22:52:55 +0100 Timo Sirainen <tss@iki.fi> (28bf185)

    master: Get only master-related configuration from doveconf at startup.


M	src/master/main.c

2010-10-05 02:20:31 +0100 Timo Sirainen <tss@iki.fi> (70cd739)

    maildir: Don't assert-crash when saving a message without locking uidlist.


M	src/lib-storage/index/maildir/maildir-save.c

2010-10-04 17:16:38 +0100 Timo Sirainen <tss@iki.fi> (e622ff6)

    priority queue: Set item's idx value to invalid when it's removed from
    queue. This should assert-crash on double-removes more reliably.


M	src/lib/priorityq.c

2010-10-04 17:10:08 +0100 Timo Sirainen <tss@iki.fi> (8126e56)

    lmtp proxy: Avoid hanging at the end of message input.


M	src/lmtp/lmtp-proxy.c

2010-10-04 16:01:09 +0100 Timo Sirainen <tss@iki.fi> (5a0fc34)

    lib-storage: Don't write to dovecot.mailbox.log if setting subscription
    didn't actually change anything.


M	src/lib-storage/list/subscription-file.c
M	src/lib-storage/list/subscription-file.h
M	src/lib-storage/mailbox-list.c

2010-10-04 15:55:34 +0100 Timo Sirainen <tss@iki.fi> (cbd6cad)

    lib-index: Fixed leaking fds when writing to dovecot.mailbox.log


M	src/lib-index/mailbox-log.c

2010-10-04 15:13:20 +0100 Timo Sirainen <tss@iki.fi> (ac0fed9)

    imap-* plugins: Use the new imap_client_created_hook_set() to set the hook.
    This avoids accessing variables directly, which allows Dovecot to give
    better error messages if imap-* plugins are tried to be loaded by non-imap
    binary.


M	src/plugins/imap-acl/imap-acl-plugin.c
M	src/plugins/imap-quota/imap-quota-plugin.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c

2010-10-04 15:12:23 +0100 Timo Sirainen <tss@iki.fi> (93f0b2f)

    imap: Added imap_client_created_hook_set() to update the hook.


M	src/imap/imap-common.h
M	src/imap/main.c

2010-10-04 14:53:02 +0100 Timo Sirainen <tss@iki.fi> (fdeb669)

    configure: Added IDLE to banner CAPABILITY to make Blackberry happy.


M	configure.in

2010-10-04 14:45:25 +0100 Timo Sirainen <tss@iki.fi> (2a5b41c)

    login: Give a better error message if ssl_cert=path is attempted without '<'


M	src/login-common/ssl-proxy-openssl.c

2010-10-01 22:10:02 +0100 Timo Sirainen <tss@iki.fi> (6524d72)

    Added signature for changeset 2690facaa927


M	.hgsigs

2010-10-01 22:09:44 +0100 Timo Sirainen <tss@iki.fi> (e5d0673)

    Added tag 2.0.5 for changeset 2690facaa927


M	.hgtags

2010-10-01 22:09:43 +0100 Timo Sirainen <tss@iki.fi> (3b5fd54)

    Released v2.0.5.


M	NEWS
M	TODO
M	configure.in

2010-10-01 21:42:18 +0100 Timo Sirainen <tss@iki.fi> (85f8811)

    lmtp: Make sure we partial messages aren't saved if client disconnects
    during DATA.


M	src/lmtp/commands.c

2010-10-01 21:33:38 +0100 Timo Sirainen <tss@iki.fi> (2e42657)

    lib-storage: Don't wrongly ignore subscriptions=no namespace entries.


M	src/lib-storage/list/mailbox-list-subscriptions.c
M	src/lib-storage/list/subscription-file.c

2010-10-01 19:09:29 +0100 Timo Sirainen <tss@iki.fi> (3643fe9)

    dsync: Fail if both source and destination mail location point to same
    directory. This should prevent some accidents.


M	src/dsync/dsync.c

2010-10-01 18:58:47 +0100 Timo Sirainen <tss@iki.fi> (ca7e608)

    config: Show time/size setting values as more human readable.


M	src/config/config-request.c

2010-10-01 18:33:58 +0100 Timo Sirainen <tss@iki.fi> (ea06c6e)

    imap: Don't reset input/output byte counters when COMPRESS is started.


M	src/imap/imap-client.c
M	src/plugins/imap-zlib/imap-zlib-plugin.c

2010-10-01 18:33:19 +0100 Timo Sirainen <tss@iki.fi> (923115f)

    Added i_stream_get_absolute_offset().


M	src/lib/istream.c
M	src/lib/istream.h

2010-10-01 17:46:03 +0100 Timo Sirainen <tss@iki.fi> (344a9a9)

    zlib: eof_offset wasn't always set right, causing assert-crashes.


M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c

2010-10-01 17:35:01 +0100 Timo Sirainen <tss@iki.fi> (6160733)

    zlib: Fixed istream-bzlib also with mark=TRUE seeking


M	src/plugins/zlib/istream-bzlib.c

2010-10-01 17:06:27 +0100 Timo Sirainen <tss@iki.fi> (1546b3a)

    zlib: Fixed istream-zlib when using seeking with mark=TRUE (i.e. mbox)


M	src/plugins/zlib/istream-zlib.c

2010-10-01 16:39:11 +0100 Timo Sirainen <tss@iki.fi> (d5b5529)

    pop3: Added pop3_fast_size_lookups setting.


M	doc/example-config/conf.d/20-pop3.conf
M	src/pop3/pop3-client.c
M	src/pop3/pop3-settings.c
M	src/pop3/pop3-settings.h

2010-10-01 16:19:10 +0100 Timo Sirainen <tss@iki.fi> (fa8f3c6)

    mail-storage.h comments updated.


M	src/lib-storage/mail-storage.h

2010-10-01 16:14:08 +0100 Timo Sirainen <tss@iki.fi> (b9e5738)

    pop3: Code cleanup for mailbox opening code.


M	src/pop3/pop3-client.c

2010-10-01 15:37:19 +0100 Timo Sirainen <tss@iki.fi> (27a7dee)

    acl: Fixed the logic of merging multiple ACLs.


M	src/plugins/acl/acl-api.h
M	src/plugins/acl/acl-backend-vfile.c
M	src/plugins/acl/acl-backend.c
M	src/plugins/acl/acl-cache.c

2010-10-01 15:01:09 +0100 Timo Sirainen <tss@iki.fi> (360e3e4)

    acl: Reverted last change. It still allows reading the default ACL from
    .DEFAULT file.


M	src/plugins/acl/acl-backend-vfile.c

2010-10-01 14:56:07 +0100 Timo Sirainen <tss@iki.fi> (038674c)

    acl: Avoid extra open() on a directory for default acl.


M	src/plugins/acl/acl-backend-vfile.c

2010-09-30 20:28:54 +0100 Timo Sirainen <tss@iki.fi> (e72a7cb)

    acl: Avoid opening two dict iterators at the same time.


M	src/plugins/acl/acl-lookup-dict.c

2010-09-30 19:18:13 +0100 Timo Sirainen <tss@iki.fi> (6860dd5)

    dict: Support file backend also with dict proxy.


M	configure.in
M	src/lib-dict/Makefile.am

2010-09-30 17:57:55 +0100 Timo Sirainen <tss@iki.fi> (1f792fb)

    doveadm fetch: Fixed fetching uid field.


M	src/doveadm/doveadm-mail-fetch.c

2010-09-30 17:49:17 +0100 Timo Sirainen <tss@iki.fi> (5363f51)

    auth: Don't assert-crash if a request still succeeds after its client
    connection is gone.


M	src/auth/auth-client-connection.c
M	src/auth/auth-request-handler.c
M	src/auth/auth-request-handler.h

2010-09-30 17:12:55 +0100 Timo Sirainen <tss@iki.fi> (ea95a05)

    auth: Avoid crashing when finishing failed requests that already timed out.


M	src/auth/auth-request-handler.c
M	src/auth/auth-request.h

2010-09-30 16:49:16 +0100 Timo Sirainen <tss@iki.fi> (755aea8)

    virtual: Allow opening virtual mailboxes that refer to non-existing
    mailboxes. It could be intentional that not everyone has the same set of
    mailboxes always.


M	src/plugins/virtual/virtual-storage.c

2010-09-30 16:05:57 +0100 Timo Sirainen <tss@iki.fi> (b8e2c73)

    lib-index: If mail_index_sync_begin() fails, don't assert-crash


M	src/lib-index/mail-index-sync.c

2010-09-30 15:33:56 +0100 Timo Sirainen <tss@iki.fi> (ef44f82)

    director: Properly detect invalid command parameters in director<->director
    connections. Found by Paul E. Black.


M	src/director/director-connection.c

2010-09-29 19:07:16 +0100 Timo Sirainen <tss@iki.fi> (7133574)

    maildir: Avoid recreating uidlist all the time when indexes are disabled.
    This code originally existed because old records weren't removed from
    uidlist->records and so this compression would never have been done, but
    0818f0a49704 changed this behavior.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-09-29 18:49:34 +0100 Timo Sirainen <tss@iki.fi> (6d50c4d)

    maildir: Avoid opening cache file when getting physical message size.


M	src/lib-storage/index/maildir/maildir-mail.c

2010-09-29 18:38:29 +0100 Timo Sirainen <tss@iki.fi> (a0aedab)

    Maildir: If mail's virtual size can be found from filename/uidlist, do it
    instead of using cache. This is especially useful with POP3 to avoid opening
    cache file.


M	src/lib-storage/index/index-mail.c
M	src/lib-storage/index/index-mail.h
M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-uidlist.h

2010-09-29 18:09:28 +0100 Timo Sirainen <tss@iki.fi> (9061a2a)

    lib-index: If transaction log file is small enough, just read all of it to
    memory immediately.


M	src/lib-index/mail-transaction-log-file.c

2010-09-29 17:15:12 +0100 Timo Sirainen <tss@iki.fi> (3a854fc)

    maildir: Avoid refreshing transaction log immediately on first sync.


M	src/lib-index/mail-index-sync.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/maildir/maildir-sync.c

2010-09-29 17:14:22 +0100 Timo Sirainen <tss@iki.fi> (3c72b9b)

    lib-index: Avoid refreshing transaction log immediately after it was opened.


M	src/lib-index/mail-index.c
M	src/lib-index/mail-transaction-log.c

2010-09-29 16:34:56 +0100 Timo Sirainen <tss@iki.fi> (722957a)

    virtual: Don't unnecessarily stat() the virtual directory. Its existence is
    checked automatically when trying to open dovecot-virtual file.


M	src/plugins/virtual/virtual-config.c
M	src/plugins/virtual/virtual-storage.c

2010-09-29 16:33:12 +0100 Timo Sirainen <tss@iki.fi> (6340dee)

    pop3: Fixed virtual plugin when compiling --without-shared-libs


M	src/pop3/Makefile.am

2010-09-29 16:32:47 +0100 Timo Sirainen <tss@iki.fi> (96975ce)

    lib-index: Don't waste time on every mailbox open checking if .log.2 should
    be deleted.


M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c

2010-09-29 15:46:32 +0100 Timo Sirainen <tss@iki.fi> (e12d288)

    Maildir++: When opening namespace prefix as mailbox, don't add extra '/' to
    path names.


M	src/lib-storage/list/mailbox-list-maildir.c

2010-09-28 19:07:33 +0100 Timo Sirainen <tss@iki.fi> (50349cd)

    lda: If doveconf fails, make it exit with EX_TEMPFAIL.


M	src/config/doveconf.c
M	src/lda/main.c
M	src/lib-master/master-service-settings.c
M	src/lib-master/master-service-settings.h
M	src/lib-storage/mail-storage-service.c
M	src/lib-storage/mail-storage-service.h

2010-09-28 17:41:43 +0100 Timo Sirainen <tss@iki.fi> (38cb3d1)

    login: If master login fails, tell auth process to free the auth request.


M	src/login-common/client-common.h
M	src/login-common/sasl-server.c

2010-09-28 17:15:52 +0100 Timo Sirainen <tss@iki.fi> (f6f021c)

    maildir: If we see unwanted non-empty directories in new/ or cur/, move them
    to ../extra-*


M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-storage.h
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-util.c

2010-09-28 17:09:50 +0100 Timo Sirainen <tss@iki.fi> (098e1a7)

    config: Don't even try to open <file settings for modules we don't care
    about.


M	src/config/config-parser.c

2010-09-28 17:09:29 +0100 Timo Sirainen <tss@iki.fi> (e982ce5)

    doveconf: Skip verifying settings for modules we don't care about. This was
    done sometimes, but not always.


M	src/config/config-parser.c

2010-09-28 16:29:33 +0100 Timo Sirainen <tss@iki.fi> (8a68b40)

    lib-index: Try to keep writing to latest mailbox log. Fixes a problem where
    a long running session keeps writing to a rotate log that has already been
    deleted.


M	src/lib-index/mailbox-log.c

2010-09-28 16:05:40 +0100 Timo Sirainen <tss@iki.fi> (a9a77f4)

    quota: Don't crash if user has quota disabled.


M	src/plugins/quota/quota-storage.c

2010-09-27 19:53:07 +0100 Timo Sirainen <tss@iki.fi> (2c50cca)

    sdbox: Fixed memory leak when copying messages with hard links.


M	src/lib-storage/index/dbox-single/sdbox-copy.c

2010-09-27 19:34:08 +0100 Timo Sirainen <tss@iki.fi> (01afde7)

    config: Verify settings plugins' versions are valid if they're specified.


M	src/config/config-parser.c

2010-09-27 16:46:26 +0100 Timo Sirainen <tss@iki.fi> (d581fe1)

    doveconf: Expand "key=$key" variable even without -x parameter. Without this
    expansion it hides what the settings actually contain.


M	src/config/config-parser.c

2010-09-27 15:50:43 +0100 Timo Sirainen <tss@iki.fi> (e71f711)

    lib-storage: Buffer writes to subscriptions file.


M	src/lib-storage/list/subscription-file.c

2010-09-27 15:40:02 +0100 Timo Sirainen <tss@iki.fi> (063e414)

    lib-storage: Avoid fsyncing subscriptions file when it doesn't change or if
    mail_fsync=never.


M	src/lib-storage/list/subscription-file.c

2010-09-27 13:45:24 +0100 Timo Sirainen <tss@iki.fi> (0b69aad)

    zlib: Avoid using hardcoded storage name strings.


M	src/plugins/zlib/Makefile.am
M	src/plugins/zlib/zlib-plugin.c

2010-09-27 13:44:49 +0100 Timo Sirainen <tss@iki.fi> (03a2840)

    zlib: dbox storage is now called sdbox.


M	src/plugins/zlib/zlib-plugin.c

2010-09-26 18:47:56 +0100 Timo Sirainen <tss@iki.fi> (a2d9acb)

    Added signature for changeset 7f5c5778c4b9


M	.hgsigs

2010-09-26 18:47:51 +0100 Timo Sirainen <tss@iki.fi> (ec4755b)

    Added tag 2.0.4 for changeset 7f5c5778c4b9


M	.hgtags

2010-09-26 18:47:51 +0100 Timo Sirainen <tss@iki.fi> (f70467f)

    Released v2.0.4.


M	NEWS
M	TODO
M	configure.in

2010-09-26 18:36:14 +0100 Timo Sirainen <tss@iki.fi> (3612248)

    Maildir: Fixed accessing INBOX whose tmp/ directory was lost.


M	src/lib-storage/index/maildir/maildir-storage.c

2010-09-26 18:05:25 +0100 Timo Sirainen <tss@iki.fi> (921a0bd)

    imap: Give better error message for "Unknown namespace"


M	src/imap/imap-commands-util.c

2010-09-24 22:32:03 +0100 Timo Sirainen <tss@iki.fi> (83c6bd1)

    module_dir_load(): Make it clearer that "Skipping module" debug message is
    normal.


M	src/lib/module-dir.c

2010-09-24 19:39:41 +0100 Timo Sirainen <tss@iki.fi> (fd420c6)

    mdbox: Removed unused code.


M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2010-09-24 18:36:22 +0100 Timo Sirainen <tss@iki.fi> (407caeb)

    pgsql: Avoid epoll_ctl() errors when closing connection.


M	src/lib-sql/driver-pgsql.c

2010-09-24 18:14:16 +0100 Timo Sirainen <tss@iki.fi> (fe70da4)

    maildir: Another assert for saving messages.


M	src/lib-storage/index/maildir/maildir-save.c

2010-09-24 17:35:51 +0100 Timo Sirainen <tss@iki.fi> (afa201e)

    sdbox: Use "sdbox" name in the internal storage structure. This fixes
    copying with hard links.


M	src/lib-storage/index/dbox-single/sdbox-storage.c

2010-09-24 17:02:08 +0100 Timo Sirainen <tss@iki.fi> (9a56220)

    maildir: Added extra asserts.


M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.c

2010-09-24 16:59:44 +0100 Timo Sirainen <tss@iki.fi> (826bdda)

    maildir: Don't waste time stat()ing if generated filename is in tmp/.


M	src/lib-storage/index/maildir/maildir-save.c

2010-09-24 11:48:57 +0100 Timo Sirainen <tss@iki.fi> (7d12f26)

    lib-storage: Check valid subscriptions list entries with
    _is_valid_existing_name()


M	src/lib-storage/list/subscription-file.c

2010-09-23 20:04:40 +0100 Timo Sirainen <tss@iki.fi> (5183f82)

    quota: When logging about obsolete rule, log the full rule string.


M	src/plugins/quota/quota.c

2010-09-23 20:00:41 +0100 Timo Sirainen <tss@iki.fi> (4c4f614)

    quota: When logging about obsolete rule, log also the quota root name.


M	src/plugins/quota/quota.c

2010-09-23 19:54:26 +0100 Timo Sirainen <tss@iki.fi> (ba8a3fb)

    config: Added conversion support for obsolete sieve/sieve_storage settings.


M	src/config/old-set-parser.c

2010-09-23 19:34:31 +0100 Timo Sirainen <tss@iki.fi> (be04e84)

    lib-storage: Log and hide invalid entries in subscriptions file.


M	src/lib-storage/list/subscription-file.c

2010-09-23 19:25:22 +0100 Timo Sirainen <tss@iki.fi> (35fcdde)

    Fail at startup if process_limit>1 for services that don't support it.


M	src/anvil/anvil-settings.c
M	src/auth/auth-settings.c
M	src/director/director-settings.c
M	src/lib-master/service-settings.h
M	src/log/log-settings.c
M	src/master/master-settings.c

2010-09-23 19:00:31 +0100 Timo Sirainen <tss@iki.fi> (b6455d6)

    lib-master: If auth server is restarted, still log a warning about aborted
    auth request.


M	src/lib-master/master-login-auth.c

2010-09-23 18:39:22 +0100 Timo Sirainen <tss@iki.fi> (0873fc3)

    maildir: Log a warning if mailbox synchronization takes longer than 1 min.


M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-sync.h

2010-09-23 18:21:09 +0100 Timo Sirainen <tss@iki.fi> (ef85943)

    maildir: Use correct enum for getting uidlist record GUID.


M	src/lib-storage/index/maildir/maildir-sync-index.c

2010-09-23 18:18:51 +0100 Timo Sirainen <tss@iki.fi> (24cd47a)

    maildir: Fixed a race condition in getting a new message's GUID.


M	src/lib-storage/index/maildir/maildir-mail.c

2010-09-23 18:02:20 +0100 Timo Sirainen <tss@iki.fi> (4cc8a79)

    maildir: Code cleanup: Use MAILDIR_UIDLIST_HDR_EXT_* when building the
    header string.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-09-23 17:51:07 +0100 Timo Sirainen <tss@iki.fi> (bf289bd)

    maildir: Don't add GUIDs to "external expunge" records. There's no point.


M	src/lib-storage/index/maildir/maildir-sync-index.c

2010-09-23 17:35:37 +0100 Timo Sirainen <tss@iki.fi> (05f3236)

    maildir: When uidlist file is recreated and reread, clear old records from
    memory. This should avoid wasting some memory and also fix "Duplicate file
    entry" errors.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-09-23 17:26:20 +0100 Timo Sirainen <tss@iki.fi> (53f9b87)

    maildir: Cleaned up filename/guid preserving code on save/copy.


M	src/lib-storage/index/maildir/maildir-copy.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-storage.h

2010-09-23 16:40:42 +0100 Timo Sirainen <tss@iki.fi> (cf4b066)

    dsync: Avoid assert-crashing when trying to create a reserved mailbox name
    (e.g. dbox-Mails)


M	src/dsync/dsync-worker-local.c

2010-09-23 16:36:00 +0100 Timo Sirainen <tss@iki.fi> (1d6dbe1)

    maildir: Fixed expunging messages with GUIDs in uidlist.


M	src/lib-storage/index/maildir/maildir-sync-index.c

2010-09-23 16:06:28 +0100 Timo Sirainen <tss@iki.fi> (8a98b2a)

    lib-lda: Fixed handling duplicate database when user has no home dir. Now it
    gives a clear error message and doesn't crash with some OSes.


M	src/lib-lda/duplicate.c

2010-09-23 15:53:09 +0100 Timo Sirainen <tss@iki.fi> (d9fda7e)

    lib-index: Log a warning if transaction log lock is kept over 3 minutes.


M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h

2010-09-22 18:19:31 +0100 Timo Sirainen <tss@iki.fi> (e0923dd)

    Attempt to fix vpopmail support.


M	configure.in
M	src/auth/passdb-vpopmail.c

2010-09-22 18:11:03 +0100 Timo Sirainen <tss@iki.fi> (add4be3)

    dict-file: Don't leak fd on deinit.


M	src/lib-dict/dict-file.c

2010-09-21 18:15:56 +0100 Timo Sirainen <tss@iki.fi> (8eb223b)

    dict quota: Avoid crashing if quota recalculation tries to recurse.


M	src/plugins/quota/quota-count.c
M	src/plugins/quota/quota-private.h

2010-09-21 18:05:13 +0100 Timo Sirainen <tss@iki.fi> (4316355)

    quota: Avoid calling i_fatal() on initialization errors, plus some other
    fixes.


M	src/plugins/quota/quota-storage.c
M	src/plugins/quota/quota.c
M	src/plugins/quota/quota.h

2010-09-21 18:04:30 +0100 Timo Sirainen <tss@iki.fi> (a26b7e8)

    lib-storage: If user->error is set during initialization, fail user
    creation.


M	src/lib-storage/mail-user.c
M	src/lib-storage/mail-user.h

2010-09-21 16:30:20 +0100 Timo Sirainen <tss@iki.fi> (6261a54)

    ssl-params: Don't start it at startup if Dovecot is compiled without SSL
    support.


M	src/ssl-params/ssl-params-settings.c

2010-09-21 15:22:57 +0100 Timo Sirainen <tss@iki.fi> (ba7881c)

    Maildir: If POP3 UIDL is specified for saved message, add it to uidlist.


M	src/lib-storage/index/maildir/maildir-save.c

2010-09-21 15:22:38 +0100 Timo Sirainen <tss@iki.fi> (89dbeaa)

    lib-storage: Added assert against empty UIDL in
    mailbox_save_set_pop3_uidl().


M	src/lib-storage/mail-storage.c

2010-09-21 15:22:16 +0100 Timo Sirainen <tss@iki.fi> (c584cd9)

    dsync: Don't set POP3 UIDLs to empty values.


M	src/dsync/dsync-worker-local.c

2010-09-21 15:11:05 +0100 Timo Sirainen <tss@iki.fi> (57593ca)

    lib-auth: Last change broke multi-step auth mechanisms.


M	src/lib-auth/auth-client-request.c

2010-09-21 14:59:59 +0100 Timo Sirainen <tss@iki.fi> (87e6031)

    dict client: If connect to server socket fails with EACCES, give better
    error message.


M	src/lib-dict/dict-client.c

2010-09-21 14:55:33 +0100 Timo Sirainen <tss@iki.fi> (db87703)

    doveadm-expire: Improved debug logging.


M	src/plugins/expire/doveadm-expire.c

2010-09-21 14:55:22 +0100 Timo Sirainen <tss@iki.fi> (29f138b)

    doveadm: Added iterate_single_user mail context field.


M	src/doveadm/doveadm-mail.c
M	src/doveadm/doveadm-mail.h

2010-09-21 14:04:22 +0100 Timo Sirainen <tss@iki.fi> (c60ae7a)

    lda: If mail_debug=yes and no -d parameter is given, log where username is
    taken from.


M	src/lda/main.c

2010-09-20 19:06:26 +0100 Timo Sirainen <tss@iki.fi> (4a0641e)

    lib-auth: Make sure auth request isn't tried to be double-freed on error
    conditions. This could have happened if auth server crashed.


M	src/lib-auth/auth-client-request.c

2010-09-20 18:19:53 +0100 Timo Sirainen <tss@iki.fi> (9834959)

    Make sure no data is leaked across processes via struct ip_addr fields.


M	src/lib/network.c

2010-09-20 17:50:29 +0100 Timo Sirainen <tss@iki.fi> (f1dd517)

    lib-master: When finishing auth, don't send REQUEST if auth process has
    restarted. This avoids unnecessary "Master requested auth for nonexistent
    client" errors when auth process restarts (crashes).


M	src/lib-master/master-login-auth.c

2010-09-20 16:06:17 +0100 Timo Sirainen <tss@iki.fi> (f302af7)

    lda, storage .so libs: Added explicit linking against other .so libs they
    require Based on patch by Funda Wang


M	src/lib-lda/Makefile.am
M	src/lib-storage/Makefile.am

2010-09-20 15:30:07 +0100 Timo Sirainen <tss@iki.fi> (02d72ab)

    mdbox: If :INDEX=path is specified, keep storage indexes there also.


M	src/lib-storage/index/dbox-multi/mdbox-map-private.h
M	src/lib-storage/index/dbox-multi/mdbox-map.c
M	src/lib-storage/index/dbox-multi/mdbox-map.h
M	src/lib-storage/index/dbox-multi/mdbox-storage.c

2010-09-17 20:20:53 +0100 Timo Sirainen <tss@iki.fi> (6d65b53)

    Added signature for changeset a475e8d4eb21


M	.hgsigs

2010-09-17 20:20:48 +0100 Timo Sirainen <tss@iki.fi> (57df729)

    Added tag 2.0.3 for changeset a475e8d4eb21


M	.hgtags

2010-09-17 20:20:48 +0100 Timo Sirainen <tss@iki.fi> (6634704)

    Released v2.0.3.


M	NEWS
M	TODO
M	configure.in

2010-09-17 18:38:47 +0100 Timo Sirainen <tss@iki.fi> (93305d7)

    lib-storage: If subscriptions contains an invalid entry, don't crash with fs
    layout.


M	src/lib-storage/list/mailbox-list-fs-iter.c

2010-09-17 17:54:22 +0100 Timo Sirainen <tss@iki.fi> (ae7d74d)

    fdpass: Use memcpy() to access data in CMSG_DATA(). This fixes at least AIX
    where the previous way was broken for some reason.


M	src/lib/fdpass.c

2010-09-17 17:30:30 +0100 Timo Sirainen <tss@iki.fi> (cd65920)

    poll: Added a workaround for AIX to get it to notice IO_ERRORs


M	src/lib/ioloop-poll.c

2010-09-16 16:28:58 +0100 Timo Sirainen <tss@iki.fi> (e4e7475)

    maildir: uidlist can now override message's GUID


M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-uidlist.h

2010-09-16 16:26:48 +0100 Timo Sirainen <tss@iki.fi> (e791216)

    maildir: Use array_bsearch() in uidlist instead of reimplementing it.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-09-16 15:19:45 +0100 Timo Sirainen <tss@iki.fi> (d61d56a)

    lib-storage: Recent change broke creating mailboxes with fs layout.


M	src/lib-storage/list/mailbox-list-fs.c

2010-09-16 13:49:35 +0100 Timo Sirainen <tss@iki.fi> (554bade)

    doveadm: Give binary name to plugin loading code so it can give better error
    messages.


M	src/doveadm/doveadm-mail.c

2010-09-15 18:59:34 +0100 Timo Sirainen <tss@iki.fi> (9506271)

    dsync: Don't crash/hang if syncing fails before ioloop is started.


M	src/dsync/dsync-brain.c
M	src/dsync/dsync-brain.h
M	src/dsync/dsync.c

2010-09-15 16:28:32 +0100 Timo Sirainen <tss@iki.fi> (699b275)

    master: Fixed previous "client/process_limit reached" log change.


M	src/master/service-monitor.c

2010-09-15 16:20:21 +0100 Timo Sirainen <tss@iki.fi> (98b27a0)

    lib-storage: Fail if list=yes namespace prefix starts with hierarchy
    separator.


M	src/lib-storage/mail-namespace.c

2010-09-15 16:07:15 +0100 Timo Sirainen <tss@iki.fi> (9042caa)

    lib-mail: Previous message parser optimization caused infinite looping with
    some mails.


M	src/lib-mail/message-parser.c

2010-09-14 21:12:08 +0100 Timo Sirainen <tss@iki.fi> (5f43b6d)

    lib-index: day_first_uid[] array wasn't kept properly up to date. The result
    was that caching decisions could have been sometimes slightly wrong. Based
    on patch by Paul E. Black.


M	src/lib-index/mail-index-transaction-update.c

2010-09-14 17:55:25 +0100 Timo Sirainen <tss@iki.fi> (dadd250)

    master: If service with process_limit=1 reaches client_limit, log it better.


M	src/master/service-monitor.c

2010-09-14 17:39:40 +0100 Timo Sirainen <tss@iki.fi> (ad7abd5)

    When writing to logs, ignore write()=EINTR failures from non-terminal
    signals. The previous code failed after 3 successive EINTRs, which was
    possible if the process got a lot of signals (e.g. master process getting
    lots of SIGCHLD signals).


M	src/lib/failures.c

2010-09-14 17:38:08 +0100 Timo Sirainen <tss@iki.fi> (4c5004b)

    Added signal_term_counter that keeps track of how many terminal signals have
    been received.


M	src/lib/lib-signals.c
M	src/lib/lib-signals.h

2010-09-14 16:43:10 +0100 Timo Sirainen <tss@iki.fi> (703c03f)

    dsync: Fixed creating \noselect mailboxes.


M	src/dsync/dsync-worker-local.c

2010-09-14 16:20:18 +0100 Timo Sirainen <tss@iki.fi> (f466caf)

    dsync: Don't create \Noselect mailboxes as selectable mailboxes, rather just
    don't create them. This fixes creating extra empty mailboxes when mirroring
    mbox+fs layout and maildir++ layout.


M	src/dsync/dsync-worker-local.c

2010-09-14 16:18:13 +0100 Timo Sirainen <tss@iki.fi> (a91bd62)

    lib-storage: Added mailbox_list_create_dir()


M	src/lib-storage/index/shared/shared-list.c
M	src/lib-storage/list/mailbox-list-fs.c
M	src/lib-storage/list/mailbox-list-maildir.c
M	src/lib-storage/list/mailbox-list-none.c
M	src/lib-storage/mail-storage.c
M	src/lib-storage/mailbox-list-private.h
M	src/lib-storage/mailbox-list.c
M	src/lib-storage/mailbox-list.h
M	src/plugins/acl/acl-mailbox-list.c

2010-09-14 15:22:37 +0100 Timo Sirainen <tss@iki.fi> (d4fe93a)

    istream-crlf: Fixed assert-crash.


M	src/lib/istream-crlf.c

2010-09-14 14:45:01 +0100 Timo Sirainen <tss@iki.fi> (691b39f)

    lib-settings: Give a better error message for invalid boolean values


M	src/lib-settings/settings-parser.c

2010-09-14 13:45:57 +0100 Timo Sirainen <tss@iki.fi> (71564d3)

    Added lda_original_recipient_header setting. Removed non-standard use of
    Envelope-To: header.


M	doc/example-config/conf.d/15-lda.conf
M	src/lda/main.c
M	src/lib-lda/lda-settings.c
M	src/lib-lda/lda-settings.h
M	src/lmtp/commands.c

2010-09-14 13:17:18 +0100 Timo Sirainen <tss@iki.fi> (9c45821)

    lda: Added -r parameter to specify final recipient address. (As opposed to
    -a which specifies original recipient address.) This is going to be used by
    Sieve checks.


M	src/lda/main.c
M	src/lib-lda/mail-deliver.h
M	src/lmtp/commands.c

2010-09-14 11:06:44 +0100 Timo Sirainen <tss@iki.fi> (ad4f1b0)

    quota: Added support for reverse quota warnings. Based on patch by Jeroen
    Koekkoek


M	src/plugins/quota/quota-private.h
M	src/plugins/quota/quota.c

2010-09-13 18:11:37 +0100 Timo Sirainen <tss@iki.fi> (f24b881)

    doveadm quota: Removed unused search_args. This fixes a crash when used with
    doveadm_expire plugin.


M	src/plugins/quota/doveadm-quota.c

2010-09-13 16:59:45 +0100 Timo Sirainen <tss@iki.fi> (cb2c44f)

    *-login: Ignore ENOTCONN error for shutdown() It's probably just a duplicate
    of a previous read() failure.


M	src/login-common/client-common-auth.c

2010-09-13 16:18:31 +0100 Timo Sirainen <tss@iki.fi> (c91d461)

    iostream: Call destroy callback after the destroy() method is called.


M	src/lib/iostream.c

2010-09-13 15:08:30 +0100 Timo Sirainen <tss@iki.fi> (3db8062)

    mysql: When sql_exec() fails, log an error.


M	src/lib-sql/driver-mysql.c

2010-09-13 15:08:12 +0100 Timo Sirainen <tss@iki.fi> (a5be5a0)

    mysql: When query fails because connection gets lost, use MySQL failure
    message instead of generic one.


M	src/lib-sql/driver-mysql.c

2010-09-13 14:43:27 +0100 Timo Sirainen <tss@iki.fi> (980061e)

    acl: Don't break if mailbox listing returns an empty name.


M	src/plugins/acl/acl-mailbox-list.c

2010-09-13 13:10:31 +0100 Timo Sirainen <tss@iki.fi> (d6871d3)

    login proxy: If proxy-login pipe isn't found, don't log an error. The pipe
    exists only when director is enabled.


M	src/login-common/login-proxy-state.c

2010-09-13 11:56:08 +0100 Timo Sirainen <tss@iki.fi> (3e42e37)

    lib-index: fsck shouldn't assert-crash when no .log file exists


M	src/lib-index/mail-index-fsck.c

2010-09-13 11:52:18 +0100 Timo Sirainen <tss@iki.fi> (c734f70)

    lib-index: readonly status was checked wrong when deleting corrupted index
    files.


M	src/lib-index/mail-index-map-read.c

2010-09-13 11:29:23 +0100 Timo Sirainen <tss@iki.fi> (73fed8a)

    lib-master: If config file can't be even stat()ed (e.g. permission error),
    give better error msg.


M	src/lib-master/master-service-settings.c

2010-09-13 10:48:28 +0100 Timo Sirainen <tss@iki.fi> (9199305)

    lda: If destination user isn't found, exit with EX_NOUSER, not EX_TEMPFAIL.


M	src/lda/main.c

2010-09-08 17:38:49 +0100 Timo Sirainen <tss@iki.fi> (02aa666)

    Added signature for changeset f4eb53065879


M	.hgsigs

2010-09-08 17:38:41 +0100 Timo Sirainen <tss@iki.fi> (1e0a229)

    Added tag 2.0.2 for changeset f4eb53065879


M	.hgtags

2010-09-08 17:38:41 +0100 Timo Sirainen <tss@iki.fi> (af7e6e2)

    Released v2.0.2.


M	NEWS
M	TODO
M	configure.in

2010-09-08 17:02:48 +0100 Timo Sirainen <tss@iki.fi> (4b9382f)

    acl: Make sure acl-list and dict is rebuild when replacing/clearing ACLs


M	src/plugins/acl/acl-backend-vfile.c

2010-09-08 17:02:25 +0100 Timo Sirainen <tss@iki.fi> (2fff31f)

    acl: Fixed removing entries from shared dict when rebuilding


M	src/plugins/acl/acl-lookup-dict.c

2010-09-08 15:35:32 +0100 Timo Sirainen <tss@iki.fi> (1d23a49)

    dovecot.m4: Added --with-moduledir and export dovecotdir


M	configure.in
M	dovecot.m4

2010-09-08 15:11:03 +0100 Timo Sirainen <tss@iki.fi> (ac5acc5)

    lmtp: Read initial settings with service=lmtp


M	src/lmtp/main.c

2010-09-08 15:02:18 +0100 Timo Sirainen <tss@iki.fi> (57010e7)

    auth: If no passdb is specified, don't fail when userdb static tries to
    verify user existence.


M	src/auth/userdb-static.c

2010-09-08 14:58:31 +0100 Timo Sirainen <tss@iki.fi> (6bd263c)

    Don't fail with auth_cache_size=0


M	src/auth/auth-settings.c
M	src/config/old-set-parser.c

2010-09-08 14:56:15 +0100 Timo Sirainen <tss@iki.fi> (5ce40a7)

    config: Automatically convert old-style auth_cache_size value.


M	src/config/old-set-parser.c

2010-09-08 14:55:57 +0100 Timo Sirainen <tss@iki.fi> (4fc74bb)

    auth: Fail if auth_cache_size value is too small.


M	src/auth/auth-settings.c

2010-09-08 14:47:45 +0100 Timo Sirainen <tss@iki.fi> (1e50a4f)

    auth: Don't crash if auth_cache_size has a very small value.


M	src/auth/auth-cache.c

2010-09-08 14:47:28 +0100 Timo Sirainen <tss@iki.fi> (80e461e)

    login: Crashfix when client disconnects before auth process has started.


M	src/login-common/client-common-auth.c

2010-09-07 19:50:48 +0100 Timo Sirainen <tss@iki.fi> (75113e5)

    sql pool: Delay creating a transaction until commit is called. Otherwise sql
    connection is reserved for the duration of the transaction.


M	src/lib-sql/driver-sqlpool.c

2010-09-07 17:19:40 +0100 Timo Sirainen <tss@iki.fi> (e5de04b)

    Compiler warning fixes.


M	src/lib-master/master-auth.c
M	src/lib-storage/index/index-mail.c
M	src/lib/fdpass.c
M	src/login-common/ssl-proxy-openssl.c

2010-09-07 16:32:17 +0100 Timo Sirainen <tss@iki.fi> (b6ccb2a)

    maildir: Avoid unnecessary uidlist recreation during mail delivery.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-09-07 16:23:03 +0100 Timo Sirainen <tss@iki.fi> (f53a6e8)

    maildir: If uidlist isn't read, don't mark its UIDs as being known when
    saving.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-09-06 19:07:49 +0100 Timo Sirainen <tss@iki.fi> (6fe9129)

    maildir: Moved maildir_filename_flags_*() to a separate file.


M	src/lib-storage/index/maildir/Makefile.am
A	src/lib-storage/index/maildir/maildir-filename-flags.c
A	src/lib-storage/index/maildir/maildir-filename-flags.h
M	src/lib-storage/index/maildir/maildir-filename.c
M	src/lib-storage/index/maildir/maildir-filename.h
M	src/lib-storage/index/maildir/maildir-save.c
M	src/lib-storage/index/maildir/maildir-sync-index.c
M	src/lib-storage/index/maildir/maildir-util.c

2010-12-05 21:07:01 +0000 Timo Sirainen <tss@iki.fi> (d656ea2)

    maildir: uidlist code cleanup.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-12-05 21:05:40 +0000 Timo Sirainen <tss@iki.fi> (6013fba)

    maildir: maildir_uidlist_lookup() -> maildir_sync_lookup() refactoring.


M	src/lib-storage/index/maildir/maildir-mail.c
M	src/lib-storage/index/maildir/maildir-sync.c
M	src/lib-storage/index/maildir/maildir-sync.h
M	src/lib-storage/index/maildir/maildir-uidlist.c
M	src/lib-storage/index/maildir/maildir-uidlist.h
M	src/lib-storage/index/maildir/maildir-util.c

2010-09-06 18:17:17 +0100 Timo Sirainen <tss@iki.fi> (c2f76df)

    zlib: Potential assert-crashfix.


M	src/plugins/zlib/istream-bzlib.c
M	src/plugins/zlib/istream-zlib.c

2010-09-06 16:35:13 +0100 Timo Sirainen <tss@iki.fi> (6600c05)

    lib-storage: Don't fail with "maildir_name not supported" when using empty
    DIRNAME=


M	src/lib-storage/mailbox-list.c

2010-09-06 15:41:31 +0100 Timo Sirainen <tss@iki.fi> (eedc9de)

    maildir: Minor code cleanup.


M	src/lib-storage/index/maildir/maildir-sync-index.c

2010-09-06 15:41:25 +0100 Timo Sirainen <tss@iki.fi> (f84e7ca)

    maildir: If we see duplicate file with retry_rewind set, try rewinding
    first.


M	src/lib-storage/index/maildir/maildir-uidlist.c

2010-09-03 19:10:28 +0100 Timo Sirainen <tss@iki.fi> (95dd508)

    config: Give an error if "block {" continues with non-whitespace.


M	src/config/config-parser.c

2010-09-03 15:18:55 +0100 Timo Sirainen <tss@iki.fi> (49469ba)

    alloconly mempool: Clear pool with memset(), not safe_memset().


M	src/lib/mempool-alloconly.c

2010-09-03 15:18:09 +0100 Timo Sirainen <tss@iki.fi> (2a2beae)

    liblib: Removed unused system-clean and alloconly-clean mempools. They're
    just making the code messier and slower.


M	src/lib/Makefile.am
M	src/lib/mempool-alloconly.c
D	src/lib/mempool-system-clean.c
M	src/lib/mempool.h

2010-09-03 15:11:35 +0100 Timo Sirainen <tss@iki.fi> (767aabe)

    test-imap-match: Don't use "clean" alloconly mempool, there's no point.


M	src/lib-imap/test-imap-match.c

2010-09-02 18:03:13 +0100 Timo Sirainen <tss@iki.fi> (56aa908)

    mdbox: If save fails due to lock failure, don't assert-crash


M	src/lib-storage/index/dbox-multi/mdbox-save.c

2010-09-02 17:46:55 +0100 Timo Sirainen <tss@iki.fi> (bdd7a96)

    lib-index: Lock timeout setting wasn't actually used in all places.


M	src/lib-index/mail-index-lock.c
M	src/lib-index/mail-transaction-log-file.c
M	src/lib-index/mail-transaction-log-private.h
M	src/lib-index/mail-transaction-log.c

2010-09-02 17:28:10 +0100 Timo Sirainen <tss@iki.fi> (f6d63a2)

    lib-storage: Fail earlier if shared namespace prefix contains modifiers.


M	src/lib-storage/index/shared/shared-storage.c

2010-09-02 17:06:37 +0100 Timo Sirainen <tss@iki.fi> (42d16c8)

    lib-storage: Minor namespace error handling cleanup.


M	src/lib-storage/mail-namespace.c

2010-09-02 17:04:15 +0100 Timo Sirainen <tss@iki.fi> (c2c68f7)

    lib-storage: Give an error about duplicate namespace prefixes.


M	src/lib-storage/mail-namespace.c

2010-09-02 17:01:00 +0100 Timo Sirainen <tss@iki.fi> (d32d7ec)

    doveconf: Quote output values when necessary.


M	src/config/config-parser.c
M	src/config/config-parser.h
M	src/config/doveconf.c

2010-09-02 15:53:08 +0100 Timo Sirainen <tss@iki.fi> (c62f5b1)

    lib-storage: If shared namespace uses %% in location, but not in prefix,
    fail with error.


M	src/lib-storage/mail-namespace.c

2010-09-02 15:35:21 +0100 Timo Sirainen <tss@iki.fi> (4bc4042)

    director: If outgoing connection dies soon, mark the host as failed to avoid
    immediate reconnect.


M	src/director/director-connection.c

2010-09-02 13:50:17 +0100 Timo Sirainen <tss@iki.fi> (c17099a)

    fts: More percentage counter calculation fixes. Patch by William Blunn


M	src/plugins/fts/fts-storage.c

2010-09-01 20:33:20 +0100 Timo Sirainen <tss@iki.fi> (f1b2c57)

    fts: Removed float calculations from "Indexed n% of the mailbox" message.


M	src/plugins/fts/fts-storage.c

2010-09-01 18:44:32 +0100 Timo Sirainen <tss@iki.fi> (7058227)

    doveadm: Support accessing mailboxes in non-private namespaces. The default
    is still the same as "*", and wildcards won't cross namespace boundaries so
    unless the namespace prefix is explicitly used non-private namespaces are
    still invisible.


M	src/doveadm/doveadm-mail-list-iter.c

2010-09-01 17:52:33 +0100 Timo Sirainen <tss@iki.fi> (fc57677)

    imap: Don't hang if client sends IDLE + DONE pipelined.


M	src/imap/cmd-idle.c

2010-09-01 17:48:04 +0100 Timo Sirainen <tss@iki.fi> (9691078)

    imap: Make sure we don't crash when client disconnects during IDLE with lots
    of changes.


M	src/imap/cmd-idle.c

2010-09-01 17:37:31 +0100 Timo Sirainen <tss@iki.fi> (4a06dd7)

    imap: Fixed a crash with tb-extra-mailbox-sep workaround and selecting
    "ns-prefix/" box.


M	src/imap/imap-commands-util.c

2010-09-01 17:32:37 +0100 Timo Sirainen <tss@iki.fi> (ef652c9)

    lib-storage: If mailbox deletion fails, mark the index back as undeleted.


M	src/lib-storage/mail-storage.c

2010-09-01 17:10:14 +0100 Timo Sirainen <tss@iki.fi> (b7651d2)

    i_stream_next_line(): Fix for the previous optimization.


M	src/lib/istream.c

2010-09-01 16:55:14 +0100 Timo Sirainen <tss@iki.fi> (ee4d09c)

    master: Make sure base_dir has at least 0755 permissions.


M	src/master/master-settings.c

2010-09-01 16:40:53 +0100 Timo Sirainen <tss@iki.fi> (fed9ba3)

    imap: If selecting a mailbox fails, close the already selected mailbox.


M	src/imap/cmd-select.c

2010-09-01 16:22:20 +0100 Timo Sirainen <tss@iki.fi> (8ad2759)

    istream-crlf optimization. Based on patch by Len7hir


M	src/lib/istream-crlf.c

2010-09-01 16:22:00 +0100 Timo Sirainen <tss@iki.fi> (7b42d6c)

    istream_next_line() optimization. Based on patch by Len7hir


M	src/lib/istream.c

2010-09-01 16:21:30 +0100 Timo Sirainen <tss@iki.fi> (1af6080)

    lib-mail: Optimized message parser code. Based on patch by Len7hir


M	src/lib-mail/message-parser.c

2010-08-31 20:04:24 +0100 Timo Sirainen <tss@iki.fi> (43fb785)

    auth: Give better EACCES error if we can't connect to auth-worker.


M	src/auth/auth-worker-server.c

2010-08-31 20:04:10 +0100 Timo Sirainen <tss@iki.fi> (0471a9d)

    access_get_error(): Fixed to give better error messages with relative paths.


M	src/lib/eacces-error.c

2010-08-31 19:33:21 +0100 Timo Sirainen <tss@iki.fi> (661614a)

    configure: vpopmail is broken, fail configure if --with-vpopmail is used.


M	configure.in

2010-08-31 17:06:20 +0100 Timo Sirainen <tss@iki.fi> (8a7a946)

    Fixed setgid() failure error message. Based on patch by Clint Adams


M	src/lib/restrict-access.c

2010-08-26 20:06:49 +0100 Timo Sirainen <tss@iki.fi> (66fbbac)

    doveconf: When logging an obsolete warning, log a note about using doveconf.


M	src/config/old-set-parser.c

2010-08-24 18:10:31 +0100 Timo Sirainen <tss@iki.fi> (7e93a7b)

    Added signature for changeset 8baa8ccb4021


M	.hgsigs

2010-08-24 18:10:27 +0100 Timo Sirainen <tss@iki.fi> (b86c229)

    Added tag 2.0.1 for changeset 8baa8ccb4021


M	.hgtags

2010-08-24 18:10:27 +0100 Timo Sirainen <tss@iki.fi> (b4dc8d9)

    Released v2.0.1.


M	NEWS
M	configure.in

2010-08-24 18:07:48 +0100 Timo Sirainen <tss@iki.fi> (6c073ea)

    dbox: Create dbox temp files with ".temp." prefix, not "temp." This makes it
    consistent with the rest of the created temp files and also gets any stale
    temp files deleted.


M	src/lib-storage/index/dbox-common/dbox-storage.h

2010-08-24 17:18:01 +0100 Timo Sirainen <tss@iki.fi> (7f472e1)

    lda: Don't fail with "mail_uid/mail_gid not set" error when running without
    -u.


M	src/lib-storage/mail-storage-service.c

2010-08-24 17:01:27 +0100 Timo Sirainen <tss@iki.fi> (b79a09b)

    quota: Mark the mailbox deleted before starting to reduce quota. This fixes
    race conditions with another process modifying the same mailbox at the same
    time.


M	src/plugins/quota/quota-storage.c

2010-08-24 17:00:39 +0100 Timo Sirainen <tss@iki.fi> (6b0d810)

    lib-storage: Allow mailbox_mark_index_deleted() to be called multiple times
    within same mailbox alloc.


M	src/lib-storage/mail-storage-private.h
M	src/lib-storage/mail-storage.c

2010-08-23 20:15:06 +0100 Timo Sirainen <tss@iki.fi> (49215f4)

    fts-solr: Fixes to previous data encoding changes. Patch by Erik Hetzner


M	src/plugins/fts-solr/fts-backend-solr.c

2010-08-23 19:03:05 +0100 Timo Sirainen <tss@iki.fi> (9946947)

    Added base64_is_valid_char()


M	src/lib/base64.c
M	src/lib/base64.h

2010-08-23 18:43:17 +0100 Timo Sirainen <tss@iki.fi> (96bd662)

    liblib: Don't segfault if write is attempted beyond non-dynamic buffer's
    bounds.


M	src/lib/buffer.c

2010-08-23 16:24:22 +0100 Timo Sirainen <tss@iki.fi> (17bb9b0)

    dsync: Assert-crashfix with remote dsyncing.


M	src/dsync/dsync-proxy-client.c

2010-08-23 16:09:11 +0100 Timo Sirainen <tss@iki.fi> (cc4d0d3)

    auth: Crashfix when aborting auth request doing async passdb/userdb lookup.


M	src/auth/auth-request-handler.c

2010-08-23 15:59:22 +0100 Timo Sirainen <tss@iki.fi> (607f0cc)

    auth: Abort any pending SQL requests earler to avoid crashes.


M	src/auth/db-sql.c

2010-08-23 15:58:53 +0100 Timo Sirainen <tss@iki.fi> (9349a0a)

    lib-sql: sql_disconnect() now aborts all pending requests.


M	src/lib-sql/driver-pgsql.c
M	src/lib-sql/driver-sqlpool.c
M	src/lib-sql/sql-api.h

2010-08-23 15:31:37 +0100 Timo Sirainen <tss@iki.fi> (2cbe765)

    imap: Fixed parsing SELECT QRESYNC parameters


M	src/imap/cmd-select.c

2010-08-23 15:28:55 +0100 Timo Sirainen <tss@iki.fi> (46bcd67)

    imap: Fail if QRESYNC seqset parameters use '*'


M	src/imap/cmd-select.c

2010-08-23 15:28:35 +0100 Timo Sirainen <tss@iki.fi> (e12ccf1)

    lib-imap: Added imap_seq_set_nostar_parse()


M	src/lib-imap/imap-seqset.c
M	src/lib-imap/imap-seqset.h

2010-08-23 15:12:56 +0100 Timo Sirainen <tss@iki.fi> (05c6402)

    man: Updated dsync man page.


M	doc/man/dsync.1.in

2010-08-23 14:35:50 +0100 Timo Sirainen <tss@iki.fi> (25ef927)

    dsync: If worker fails, abort earlier.


M	src/dsync/dsync-brain.c

2010-08-23 14:30:08 +0100 Timo Sirainen <tss@iki.fi> (e4e9e0d)

    dsync: Execute remote dsync binary before dropping privileges.


M	src/dsync/dsync.c

2010-08-23 00:26:39 +0100 Timo Sirainen <tss@iki.fi> (b24e8c8)

    configure: --with-ssl=gnutls gives error now immediately


M	configure.in

2010-08-20 20:38:26 +0100 Timo Sirainen <tss@iki.fi> (6f60491)

    fts-solr: Replace characters not valid for XML with replacement char.


M	src/plugins/fts-solr/fts-backend-solr.c

2010-08-20 20:37:31 +0100 Timo Sirainen <tss@iki.fi> (f2de6ec)

    Added a global utf8_replacement_char variable.


M	src/lib/unichar.c
M	src/lib/unichar.h

2010-08-20 20:12:51 +0100 Timo Sirainen <tss@iki.fi> (b955a1c)

    master: Fixed log_path=/dev/stderr


M	src/master/service-process.c

2010-08-20 19:49:42 +0100 Timo Sirainen <tss@iki.fi> (13295d1)

    lib-storage: Don't complain about missing UID/GID when running as root is
    allowed (standalone).


M	src/lib-storage/mail-storage-service.c

2010-08-20 19:45:01 +0100 Timo Sirainen <tss@iki.fi> (0139fcb)

    lib-storage: Give better error message if user is missing UID/GID


M	src/lib-storage/mail-storage-service.c

2010-08-20 18:28:18 +0100 Timo Sirainen <tss@iki.fi> (bbcca9a)

    example-config: Added example dict service


M	doc/example-config/conf.d/10-master.conf

2010-08-20 18:22:39 +0100 Timo Sirainen <tss@iki.fi> (cab0827)

    Reverted previous commit. It's a stupid feature: mail_access_groups already
    exists.


M	src/imap/imap-settings.c
M	src/lmtp/lmtp-settings.c
M	src/master/master-settings.c
M	src/master/master-settings.h
M	src/pop3/pop3-settings.c

2010-08-20 18:19:50 +0100 Timo Sirainen <tss@iki.fi> (8b55be7)

    Added default_mail_extra_groups setting. imap/pop3/lmtp services'
    extra_groups defaults to it. For now this default is empty to make sure
    existing installations don't break.


M	src/imap/imap-settings.c
M	src/lmtp/lmtp-settings.c
M	src/master/master-settings.c
M	src/master/master-settings.h
M	src/pop3/pop3-settings.c

2010-08-20 18:19:04 +0100 Timo Sirainen <tss@iki.fi> (1503ac7)

    lib-storage: Preserve permission settings in master's service blocks. Most
    importantly preserve extra_groups setting.


M	src/lib-storage/mail-storage-service.c

2010-08-20 18:18:01 +0100 Timo Sirainen <tss@iki.fi> (4b2a103)

    master: Set RESTRICT_* environment even when drop_priv_before_exec=yes
    Otherwise the executed process could still try to drop some of the
    privileges (groups).


M	src/master/service-process.c

2010-08-20 16:14:19 +0100 Timo Sirainen <tss@iki.fi> (90257f6)

    lib-storage: Log namespace location with mail_debug=yes


M	src/lib-storage/mail-namespace.c

2010-08-19 18:44:20 +0100 Timo Sirainen <tss@iki.fi> (85646d8)

    doc: Updated tls_cert/key_file comment in dovecot-ldap.conf.ext


M	doc/example-config/dovecot-ldap.conf.ext

2010-08-19 18:36:09 +0100 Timo Sirainen <tss@iki.fi> (905951e)

    imap: Don't crash with QRESYNC SELECT specifying sequences larger than
    mailbox's message count.


M	src/imap/imap-fetch.c

2010-08-19 18:28:20 +0100 Timo Sirainen <tss@iki.fi> (dae0fbe)

    pop3: Show APOP challenge only when APOP auth mechanism is enabled.


M	src/pop3-login/client.c

2010-08-19 18:19:53 +0100 Timo Sirainen <tss@iki.fi> (835ba47)

    lib-master: Fixed accepting FIFO connections with BSDI.


M	src/lib-master/master-service.c

2010-08-19 18:06:22 +0100 Timo Sirainen <tss@iki.fi> (a004446)

    UTF-8 string validity was still checked incorrectly.


M	src/lib/unichar.c
M	src/lib/unichar.h

2010-08-18 16:24:13 +0100 Timo Sirainen <tss@iki.fi> (6bb8c69)

    lib-index: Give a clearer error message for syscall failing with EFBIG.


M	src/lib-index/mail-index.c

2010-08-18 16:21:04 +0100 Timo Sirainen <tss@iki.fi> (613dee7)

    lib-index: Put all syscall error logging through one function.


M	src/lib-index/mail-index.c

2010-08-18 15:17:40 +0100 Timo Sirainen <tss@iki.fi> (6b4c4d9)

    UTF-8 string validity was checked incorrectly.


M	src/lib/unichar.c

2010-08-17 19:16:03 +0100 Timo Sirainen <tss@iki.fi> (750c79d)

    auth: Pass requested_login_user to auth worker processes.


M	src/auth/auth-request.c

2010-08-17 18:10:16 +0100 Timo Sirainen <tss@iki.fi> (873286c)

    auth: Added more master user login debugging.


M	src/auth/auth-request.c

2010-08-16 20:35:26 +0100 Timo Sirainen <tss@iki.fi> (f3ef6fd)

    eaccess_error_get(): If UID/GID doesn't have name, show it as <unknown>


M	src/lib/eacces-error.c

2010-08-16 16:49:29 +0100 Timo Sirainen <tss@iki.fi> (8902503)

    master: Give better error messages for unknown users/groups.


M	src/lib-master/service-settings.h
M	src/master/master-settings.c
M	src/master/service.c

2010-08-16 16:07:01 +0100 Timo Sirainen <tss@iki.fi> (b1f6c5b)

    configure: v2.0.0 is no longer UNSTABLE development branch.


M	configure.in

2010-08-16 15:35:16 +0100 Timo Sirainen <tss@iki.fi> (1f1ce10)

    Added signature for changeset d0d3ba81d205


M	.hgsigs

2010-08-16 15:35:13 +0100 Timo Sirainen <tss@iki.fi> (d009ccd)

    Added tag 2.0.0 for changeset d0d3ba81d205


M	.hgtags

2010-08-16 15:35:11 +0100 Timo Sirainen <tss@iki.fi> (5d5c4f2)

    Released v2.0.0.


M	NEWS
M	configure.in
