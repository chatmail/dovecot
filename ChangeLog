2007-03-23 20:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c: comment update

2007-03-23 20:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-uidlist.c, maildir-uidlist.h: When saving/copying mails,
	  we must not do any sorting based on the filename to saved mails
	  when they're added to uidlist, otherwise they could be saved to
	  index with wrong UID.

2007-03-23 17:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: If duplicate links
	  are found, rename() one over the other to get rid of it.

2007-03-23 16:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Avoid infinite
	  looping when buggy filesystems.

2007-03-23 15:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: If saving to
	  maildir causes flag/expunge syncs, don't crash.

2007-03-23 03:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: If we update the fields
	  list in header, it's committed immediately so if the transaction
	  gets rollbacked, don't overwrite the already committed header.

2007-03-23 03:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-sync.c,
	  maildir-uidlist.c: Last fix broke creating new uidlists.

2007-03-23 02:46  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c, mbox-sync.c: If a
	  broken X-UID header was found with a value larger than last seen
	  X-UID (eg. empty mbox) but less than the expected UID value, we
	  gave "UID inserted in the middle of mailbox" error.

2007-03-23 00:07  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Fixed NFS check again with chroots

2007-03-23 00:06  Timo Sirainen <tss@iki.fi>

	* src/lib/: home-expand.c, home-expand.h: Added home_expand_tilde()

2007-03-23 00:04  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/Makefile.am,
	  doc/dovecot-ldap-example.conf, doc/dovecot-ldap.conf,
	  doc/dovecot-sql-example.conf, doc/dovecot-sql.conf: Renamed
	  dovecot-sql/ldap.conf to dovecot-sql/ldap-example.conf. make
	  install now installs them to sysconfdir.

2007-03-22 23:32  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: If chdir() failed, we still gave wrong
	  reason

2007-03-22 15:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: ~ in mbox root path
	  wasn't expanded early enough

2007-03-22 01:36  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/passdb-passwd.c,
	  src/auth/passdb-shadow.c: Added blocking=yes setting for passdb
	  passwd and shadow also.

2007-03-22 00:06  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Removed security warnings from auth-master
	  socket. They're not actually true. The clients can only look up
	  userdb data, which is practically the same thing as what they can
	  find from /etc/passwd (with system users of course).

2007-03-21 22:52  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Use alarm() to make sure that chdir()
	  returns in 30 seconds (NFS..). Also if chdir() failed, we could
	  have used wrong errno in the checks.

2007-03-21 22:00  Timo Sirainen <tss@iki.fi>

	* configure.in: Check if struct stat has tv_nsec fields

2007-03-21 21:57  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync.c: Check if mbox has been modified
	  externally before doing any dangerous writes. Also changed the
	  old "space needed changed unexpectedly" assert to a more
	  informative panic.

2007-03-21 21:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Changed assert to
	  more informative panic message.

2007-03-21 20:31  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: NFS check + chroots broke home
	  directory for the first login.

2007-03-21 20:12  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-master-connection.c,
	  src/auth/userdb-static.c: If doing a plain userdb lookup with
	  userdb static, verify the user's existence from passdb first,
	  unless allow_all_users=yes

2007-03-21 20:06  Timo Sirainen <tss@iki.fi>

	* src/deliver/auth-client.c: FAIL reply doesn't necessarily have
	  parameters. Don't give "BUG: Unexpected input" if that happens.

2007-03-21 19:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-sync.c,
	  maildir-uidlist.c, maildir-uidlist.h: If uidlist is deleted and
	  we set the uidvalidity from the index file, set also next_uid.

2007-03-21 19:19  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-copy.c, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-sync.c: When copying/syncing a
	  lot of mails, send "* OK Hang in there" replies to client every
	  15 seconds so it doesn't just timeout the connection.

2007-03-21 19:16  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Keep better track of client->last_output
	  timestamp.

2007-03-20 15:00  Timo Sirainen <tss@iki.fi>

	* src/util/: Makefile.am, idxview.c, logview.c: Added idxview and
	  logview to dump index/cache/log file contents.

2007-03-19 13:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: If uidlist file
	  doesn't exist but index files do, resync the maildir to create
	  the uidlist.

2007-03-19 13:43  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: Assert-crashfix

2007-03-17 15:42  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: We defaulted plugin_dir to <moduledir>/imap
	  instead of /pop3.

2007-03-17 15:28  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Log "kept it for n seconds", not -n
	  seconds.

2007-03-17 12:07  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Ignore -m "" parameter. Added -n option to
	  not autocreate the mailbox. If saving to given mailbox fails,
	  fallback to saving to INBOX.

2007-03-16 16:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Crashfix with nonsorted
	  appends

2007-03-16 16:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: When marking transaction
	  log corrupted, set indexid=0 instead of version=0.  Version
	  setting worked too, but indexid=0 makes it log a "marked
	  corrupted" error message.

2007-03-16 15:44  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Creating initial
	  transaction log file leaked memory, created the file twice and
	  caused potential locking problems.

2007-03-16 15:23  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-worker-server.c,
	  lib-auth/auth-server-connection.c: If net_connect_unix() fails,
	  assume also that ECONNREFUSED may be a temporary failure. It can
	  happen if we exceeded the listener's backlog.

2007-03-16 15:11  Timo Sirainen <tss@iki.fi>

	* configure.in: Link dovecot-auth always with -lcrypto if it's
	  needed for crypt(). It could possibly be used with any passdb, so
	  don't bother doing it only for a few of them.

2007-03-15 15:52  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, deliver/deliver.c, imap/main.c,
	  master/mail-process.c, master/main.c, pop3/main.c: Fixes to
	  handling log prefixes. imap/pop3 processes now log the
	  mail_log_prefix even when started with --exec-mail.

2007-03-15 15:51  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: i_set_failure_file() no longer automatically
	  appends ": " to log prefixes.

2007-03-15 14:38  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-epoll.c, ioloop-internal.h, ioloop-kqueue.c,
	  ioloop-poll.c, ioloop-select.c, ioloop.c: If poll()/etc.
	  timeouts, we didn't handle time timeouts immediately but called
	  poll()/etc again with zero timeout and then handled the timeouts.

2007-03-15 14:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Check for the index
	  destroy timeouts a bit less often.

2007-03-15 14:28  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: If timeout wait time was less than 1
	  millisecond, we wasted CPU calling poll() (or whatever) with zero
	  timeout multiple times until the millisecond had passed. Now we
	  round the waits up to next millisecond.

2007-03-15 13:59  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Make processes created with
	  --exec-mail log to the configured location.

2007-03-15 13:58  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: Added missing LF from error message

2007-03-15 13:48  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Crashfix

2007-03-15 12:04  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Error handling crashfix

2007-03-15 11:48  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: INBOX wasn't converted.

2007-03-15 01:50  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Error handling crashfix

2007-03-15 01:05  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Don't give "Unexpected
	  garbage at EOF" error if we don't see a full transaction header's
	  worth of data. It could be just that another process is in the
	  middle of writing the first header.

2007-03-14 19:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Error handling crashfix

2007-03-14 18:20  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: blocking=yes setting was accidentally added
	  to passdb passwd instead of userdb passwd.

2007-03-14 18:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: If new extension was
	  introduced while we had already expunged some messages in the
	  sync, we cleared existing expunge/sync extension contexts, which
	  probably caused assert-crash.

2007-03-14 16:17  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-sync.c: Added casts to some enums to
	  avoid compiler warnings.

2007-03-14 14:42  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-passwd-file.c: Reverted the last change, it was
	  originally correct after all.

2007-03-14 13:59  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-passwd-file.c: Don't expand %variables in extra
	  fields, let dovecot master do that.

2007-03-14 13:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: View syncing fixes

2007-03-14 12:46  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Code cleanup

2007-03-14 12:42  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If unknown user was found from auth
	  cache, we returned an invalid value instead of
	  USERDB_RESULT_USER_UNKNOWN.

2007-03-14 12:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h: uint8_t:1 is GCC
	  extension, changed back to using unsigned int:1 although it takes
	  a bit more memory now.

2007-03-14 11:52  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: Compile fix

2007-03-13 18:52  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 1.0.rc27 released

2007-03-13 17:18  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-create.c: If trying to create <mailbox><real
	  separator>, give an error instead of working like <virtual
	  separator>.

2007-03-13 17:17  Timo Sirainen <tss@iki.fi>

	* src/imap/: commands-util.c, commands-util.h: Added
	  client_find_namespace(). Handle virtual != real hierarchy
	  separators better. Give an error if real separator is tried to be
	  used in the mailbox name.

2007-03-13 16:01  Timo Sirainen <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c: compiler warning fix

2007-03-13 15:55  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Logout crashfix in some conditions.

2007-03-13 15:42  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Error handling fix

2007-03-13 13:37  Timo Sirainen <tss@iki.fi>

	* src/deliver/mail-send.c: Don't add rejection mails to duplicate
	  database. They're never looked up from there.

2007-03-12 21:05  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: If maildirsize file contains
	  only the header, recalculate the quota.

2007-03-12 20:36  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/: quota-maildir.c, quota-private.h: With
	  ignore=box setting the quota was still updated for the mailbox
	  even though it was allowed to go over quota (but quota recount
	  ignored the box).

2007-03-12 12:35  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Mailbox name conversion
	  wasn't done for directories.

2007-03-11 21:58  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: failure_exit_callback hook was set too
	  late, so if log opening failed it exited with wrong exit code.

2007-03-11 21:36  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-gssapi.c: Crashfix in some error conditions

2007-03-11 21:03  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: If passwd-file wasn't found, don't
	  crash.

2007-03-11 19:09  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: DEBUG crashfix

2007-03-11 18:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c: If we can't rotate
	  log file because there's no disk space, don't abort appending the
	  transaction.

2007-03-11 18:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: If anything (syncing)
	  fails because there's not enough disk space, give user a nice
	  error message instead of internal error.

2007-03-11 18:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: Delete copy-lock file instead of
	  rename()ing it if we've moved to in-memory indexes.

2007-03-11 17:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-append.c,
	  mail-transaction-log.c: If write to transaction log fails, we may
	  later need to truncate the file so that after the write there
	  won't be garbage after it.

2007-03-11 17:38  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Use a larger initial pool size for
	  keywords.

2007-03-11 16:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-append.c,
	  mail-transaction-log-private.h: If transaction log grows larger
	  than 1MB, rotate it even if it was created less than 5 minutes
	  ago.

2007-03-11 16:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: If
	  o_stream_send_istream() fails with ENOSPC/EDQUOT, don't log a
	  critical error but just give user a "not enough disk space"
	  error.

2007-03-11 16:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: o_stream_seek() may do
	  buffer flushing internally and cause errors. Do flushing manually
	  before seeking so that we don't confuse the errors. Also did some
	  code cleanups.

2007-03-11 16:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: o_stream_seek()
	  call was missing error handling.

2007-03-11 16:25  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Another failure handling fix

2007-03-11 16:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-sync-update.c,
	  mail-index-sync.c, mail-index.c, mail-transaction-log-append.c,
	  mail-transaction-log-view.c, mail-transaction-log.h: If we run
	  out of disk space, move to in-memory indexes.

2007-03-11 16:02  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: When using MULTIAPPEND and LITERAL+ and
	  message saving failed, we stopped parsing client input too early
	  (for subsequent appends after the failure) which caused BAD
	  replies.

2007-03-10 23:47  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: If mail was in CR+LF format in the
	  disk and we used sendfile() call, but the call couldn't send
	  everything, we hanged.

2007-03-10 23:45  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream.h: Updated o_stream_send_istream() comments

2007-03-10 20:58  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-cache-compress.c,
	  src/lib-index/mail-cache-transaction.c,
	  src/lib-index/mail-index-lock.c,
	  src/lib-index/mail-index-private.h, src/lib-index/mail-index.c,
	  src/lib-index/mail-index.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/dbox/dbox-uidlist.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/maildir/maildir-uidlist.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/master/mail-process.c, src/master/master-settings-defs.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  fsync_disable setting.

2007-03-10 19:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: When moving index file to memory,
	  change the filename to be "(in-memory index)".

2007-03-10 19:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Rotating in-memory transaction log
	  crashed

2007-03-10 19:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mmap_disable=yes crashes with recent
	  changes.

2007-03-10 18:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-index-view-sync.c:
	  View syncing fixes.

2007-03-10 18:46  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: cleanups

2007-03-10 18:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: View log file offset fix

2007-03-10 17:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: We skipped some external
	  transactions that shouldn't have been skipped.  The logic for
	  figuring out if flags are unreliable was also a bit broken.

2007-03-10 16:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: comment update

2007-03-10 16:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync-update.c,
	  mbox-sync.c: Cleaned up the code a bit. Fixed sync rewrite
	  crashing with pseudo mails.

2007-03-10 15:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-transaction.c: After saving mails
	  we didn't update last-uid header in X-IMAP[base] if lazy writes
	  were used.

2007-03-10 15:46  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: When parsing
	  X-IMAP[base] header and its last-uid field is too low, mark it as
	  needing rewrite.

2007-03-10 14:09  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt: Added %m and %c to dovecot-auth.

2007-03-10 14:08  Timo Sirainen <tss@iki.fi>

	* doc/: dovecot-ldap.conf, dovecot-sql.conf: Added wiki links.

2007-03-10 14:04  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-request.h: Added %c variable
	  which expands to "secured" with SSL/TLS/localhost.

2007-03-10 13:24  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-passwd-file.c, passdb-bsdauth.c, passdb-cache.c,
	  passdb-checkpassword.c, passdb-pam.c, passdb-passwd.c,
	  passdb-shadow.c, passdb-sia.c, passdb-vpopmail.c,
	  userdb-passwd.c, userdb-prefetch.c, userdb-vpopmail.c: Added more
	  debug logging.

2007-03-10 12:54  Timo Sirainen <tss@iki.fi>

	* src/plugins/mail-log/mail-log-plugin.c: Log the mailbox name,
	  unless it's INBOX.

2007-03-10 11:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-rewrite.c: When rewriting the first message we could
	  have written next-uid field wrong.

2007-03-09 21:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-append.c,
	  mail-transaction-log-view.c: cleanups

2007-03-09 21:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-private.h,
	  mail-index-sync-update.c: Don't set log sync position right after
	  extension introduction, unless it's at the end of the file. This
	  should fix some "Extension reset without intro prefix" errors.

2007-03-09 20:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Yet another try
	  at fixing this piece of code. The mbox code is way too complex
	  and could use better comments..

2007-03-09 19:37  Timo Sirainen <tss@iki.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c: When returning
	  mailbox name with GETQUOTAROOT, return the original name instead
	  of the converted storage name.

2007-03-09 15:35  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf: Added tls setting.

2007-03-09 00:27  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Added %m = mechanism name

2007-03-08 20:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-transaction-log.c,
	  mail-transaction-log.h: If index file is corrupted, recreate
	  transaction log file instead of trying to reuse it.

2007-03-08 18:27  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: Moved errno preserving to
	  i_error/i_warning/i_info from the failure handler, so each
	  failure handler doesn't have to do that itself.

2007-03-08 13:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added note about ssl_require_client_cert in
	  ssl_verify_client_cert comments.

2007-03-07 17:20  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added LoginProcess wiki link.

2007-03-07 16:07  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: Added a comment about the time moving backwards
	  code.

2007-03-07 15:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-save.c, mbox-sync-private.h,
	  mbox-sync.c: Keep track of the mbox dirty state better. Also when
	  moving mails inside an mbox without changing the file's size,
	  make sure the file's mtime changes even if it means sleeping for
	  a second.

2007-03-07 15:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: minor cleanups

2007-03-07 14:51  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-file.c: Removed caching from i_stream_stat(). The
	  changes could be important in mbox syncing.

2007-03-07 13:40  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: Don't die if "time moved backwards" sleep is
	  interrupted.

2007-03-07 00:47  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Fixed last change: Don't
	  crash now when rotating non-locked log..

2007-03-07 00:44  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c: If write fails with
	  "not enough space" error, log it instead of silently handling it.

2007-03-07 00:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Don't crash when rotating
	  locked in-memory log file.

2007-03-07 00:17  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.rc26.

2007-03-07 00:14  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Fixed a crash when non-plaintext
	  mechanism used auth_cache.

2007-03-06 23:59  Timo Sirainen <tss@iki.fi>

	* src/login-common/sasl-server.c: After calling sasl_callback() the
	  client may be destroyed already. Don't try to modify it.

2007-03-06 23:43  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c: t_push/t_pop the callback.

2007-03-06 23:36  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c: Queueing code was somewhat broken and
	  caused queries to get lost.

2007-03-06 20:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Added assert.

2007-03-06 20:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Changed i_unreached() to more
	  informative i_panic().

2007-03-06 20:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction-private.h,
	  mail-index-transaction-view.c, mail-index-transaction.c: When
	  adding mails to index in non-sorted UID order and then using
	  mail_index_get_header(), the next_uid field could have been
	  wrong.

2007-03-06 20:06  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Log errors given by
	  storage. Convert hierarchy separators in mailbox names.

2007-03-06 19:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: If moving to memory fails,
	  make sure we open the index with create flag set.

2007-03-06 19:51  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: When we were syncing
	  in-memory maps, we still should have updated the log file offsets
	  because other views could have used them.

2007-03-06 19:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_move_to_memory(): Mark
	  index as being in memory even if the file hasn't been opened yet.

2007-03-06 18:50  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-ldap.c, userdb-ldap.c: Don't crash if
	  user_attrs or pass_attrs is empty. It means all the attributes
	  are returned.

2007-03-06 18:27  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: If time moves backwards only max. 5 seconds,
	  sleep instead of killing ourself.

2007-03-06 17:43  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: With namespace prefixes LSUB prefix.* listed
	  INBOX.INBOX.

2007-03-06 16:57  Timo Sirainen <tss@iki.fi>

	* src/deliver/smtp-client.c: Drop out DEBUG environment before
	  calling sendmail binary.

2007-03-06 16:35  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: comment typofix

2007-03-06 16:32  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: If maildirsize contained NUL
	  bytes at the beginning of the line (could happen with NFS), we
	  stopped parsing the file at that point instead of rebuilding it.

2007-03-06 15:52  Timo Sirainen <tss@iki.fi>

	* configure.in: Changed --with-headers to --enable-header-install

2007-03-06 15:48  Timo Sirainen <tss@iki.fi>

	* Makefile.am: fix

2007-03-06 15:43  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated valid_chroot_dirs and mail_chroot
	  comments.

2007-03-06 15:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-storage.c,
	  maildir-storage.h, maildir-sync.c: When syncing huge maildirs
	  check once in a while if we need to update dovecot-uidlist.lock
	  so that another process won't decide that it's stale and
	  overwrite it. Check more often when moving mails from new/ to
	  cur/.

2007-03-06 14:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Don't try to fsck index
	  file in error conditions if it's not yet opened.

2007-03-06 14:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Check index file's endianess earlier,
	  otherwise we'll complain about other problems.

2007-03-06 13:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: X-UID brokeness
	  fixing was worse than ever.

2007-03-06 13:14  Timo Sirainen <tss@iki.fi>

	* src/deliver/: Makefile.am, deliver.c: While parsing the input
	  stream ignore the mbox hidden headers so that eg.  X-IMAP header
	  won't cause us to crash.

2007-03-01 12:57  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: v1.0.rc25 released.

2007-03-01 12:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c, mbox/mbox-storage.c:
	  mbox: Don't allow using .imap directory in the mailbox name/mask.
	  mbox+dbox: Don't allow using "foo/." or "foo/.." in the masks.
	  Although that shouldn't really matter.

2007-03-01 11:15  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Don't crash if mail saving fails.

2007-03-01 11:13  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-limit.c, lib/ostream-crlf.c,
	  lib-mail/istream-header-filter.c,
	  lib-storage/index/mbox/istream-raw-mbox.c: Keep stream_errno
	  updated in filter streams.

2007-03-01 10:38  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h: Added asserts to make sure
	  client_destroy() isn't called while we're handling commands.

2007-03-01 10:18  Timo Sirainen <tss@iki.fi>

	* src/imap/client.h: Removed unused rawlog flag.

2007-02-28 21:00  Timo Sirainen <tss@iki.fi>

	* src/plugins/mail-log/mail-log-plugin.c: Fixed deleted/undeleted
	  logging.

2007-02-28 20:19  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: If time moves backwards, kill ourself.

2007-02-28 19:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync.c: If next_uid field gets to
	  2^31-1, handle it without crashing by creating a new uidvalidity
	  and renumbering the UIDs (although it requires selecting the
	  mailbox twice, first time to get index file deleted).

2007-02-28 19:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: The previous
	  broken X-UID header fixing code was still broken...

2007-02-27 16:56  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-plain.c: Don't crash with invalid PLAIN input.

2007-02-25 15:40  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: alloconly pool: pool_unref()
	  shouldn't set the pool pointer to NULL unless refcount=0.

2007-02-23 18:29  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: If prefix.INBOX has children and we're
	  listing under prefix.%, don't drop the prefix.

2007-02-22 21:50  Timo Sirainen <tss@iki.fi>

	* Makefile.am, configure.in, dovecot-config.in.in,
	  src/auth/Makefile.am, src/deliver/Makefile.am,
	  src/imap/Makefile.am, src/lib/Makefile.am,
	  src/lib-auth/Makefile.am, src/lib-charset/Makefile.am,
	  src/lib-dict/Makefile.am, src/lib-imap/Makefile.am,
	  src/lib-index/Makefile.am, src/lib-mail/Makefile.am,
	  src/lib-settings/Makefile.am, src/lib-sql/Makefile.am,
	  src/lib-storage/Makefile.am, src/lib-storage/index/Makefile.am,
	  src/lib-storage/index/dbox/Makefile.am,
	  src/lib-storage/index/maildir/Makefile.am,
	  src/lib-storage/index/mbox/Makefile.am,
	  src/lib-storage/subscription-file/Makefile.am,
	  src/pop3/Makefile.am: Added --with-headers configure option to
	  install .h files.

2007-02-22 17:36  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.rc24.

2007-02-22 17:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-storage.c, mbox-storage.h:
	  KEEP_LOCK: When using dotlock, touch it every 10 seconds.

2007-02-22 15:42  Timo Sirainen <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c: Fixed priority handling.

2007-02-22 15:38  Timo Sirainen <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c: Fixes for handling multiple
	  storages.

2007-02-22 15:03  Timo Sirainen <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c: Minor memory allocation
	  optimizations.

2007-02-22 14:35  Timo Sirainen <tss@iki.fi>

	* src/: auth/password-scheme.c, deliver/deliver.c, dict/main.c,
	  imap/main.c, lib/module-dir.c, lib/module-dir.h, pop3/main.c:
	  Don't compare to PACKAGE_VERSION in lib/ core directly, rather
	  make module_dir_load() have the version string as parameter.
	  Plugin version checks can be skipped with version_ignore=yes.

2007-02-22 14:27  Timo Sirainen <tss@iki.fi>

	* src/plugins/: acl/acl-plugin.c, convert/convert-plugin.c,
	  imap-quota/imap-quota-plugin.c,
	  lazy-expunge/lazy-expunge-plugin.c, mail-log/mail-log-plugin.c,
	  quota/quota-plugin.c, trash/trash-plugin.c, zlib/zlib-plugin.c:
	  Added <plugin_name>_version string.

2007-02-22 14:25  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: If module contains a <module_name>_version
	  string, fail if it doesn't match PACKAGE_VERSION.

2007-02-22 14:10  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream.c: If o_stream_send_istream() fails, make sure
	  errno is set to outstream.stream_errno.

2007-02-22 14:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: cleanup

2007-02-22 13:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Crashfix in error
	  conditions.

2007-02-22 13:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: If uidlist locking
	  fails because of a timeout, given timeout error message to user
	  instead of internal error.

2007-02-22 13:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.c, index-storage.h,
	  dbox/dbox-storage.c, maildir/maildir-storage.c,
	  mbox/mbox-storage.c: When using KEEP_LOCK, the mbox/uidlist file
	  must be locked before index file is opened. Otherwise we can end
	  up in a deadlock.

2007-02-22 13:30  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: If INBOX can't be opened, give better error
	  messages. The reason is never "INBOX doesn't exist for user".

2007-02-22 13:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c,
	  maildir/maildir-storage.c: If KEEP_LOCK is set and we timeout,
	  don't crash.

2007-02-22 12:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c, dbox/dbox-storage.h,
	  dbox/dbox-uidlist.c, dbox/dbox-uidlist.h,
	  maildir/maildir-storage.c, maildir/maildir-storage.h,
	  maildir/maildir-uidlist.c, maildir/maildir-uidlist.h: If
	  pop3_lock_session=yes, update maildir/dbox uidlist lock file
	  every 10 seconds so it won't be treated as a stale lock.

2007-02-22 12:23  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: PAM dead-child timeout function was called
	  1000 times too often.

2007-02-20 12:01  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0.rc23.

2007-02-20 12:00  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Linux quota v1 apparently returns
	  current quota in kilobytes, not bytes as v2.

2007-02-20 11:51  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: If authentication failed but it
	  still returns proxy, don't do the proxying.

2007-02-20 10:25  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: dovecot -n/-a dumps now also
	  dict/plugin settings.

2007-02-19 23:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync.c: Rewriting still wasn't
	  replacing broken X-UID headers correctly always, causing
	  assert-crashes.

2007-02-19 20:00  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: proxy and nologin was broken in last
	  changes.

2007-02-19 19:59  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-blocking.c: Removed unused variable

2007-02-19 14:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-save.c, mbox-storage.c,
	  mbox-storage.h: Drop X-Delivery-ID header when saving the
	  message.

2007-02-19 14:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: If pop3_uidl_format=%m,
	  add a unique X-Delivery-ID header to all saved mails. Without it
	  it's possible to get duplicate UIDLs which some clients don't
	  handle all that well. (eg. mail sent to two accounts where one is
	  alias to another will get the exact same Received/Delivered-To
	  headers with Postfix)

2007-02-19 14:27  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Get pop3_uidl_format even if it's inside
	  protocol pop3 {}

2007-02-17 12:28  Timo Sirainen <tss@iki.fi>

	* configure.in: Added AC_CACHE_CHECK()s to all AC_TRY_RUN and
	  AC_RUN_IFELSE checks so that cross compiling is possible.

2007-02-17 11:45  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-plain.c: If authorization and authentication IDs
	  are the same, and both contain the master user, the master login
	  failed.

2007-02-17 11:21  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: auth_request_set_fields(): Don't crash
	  with empty fields.

2007-02-16 19:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync-update.c: Fixed some wrong
	  "uid-last unexpectedly lost" errors.

2007-02-16 18:43  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Don't crash at deinit if no modules are
	  loaded.

2007-02-16 18:31  Timo Sirainen <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c: Although messages were
	  expunged, the expunges weren't counted in that same transaction
	  and the APPEND failed.

2007-02-16 18:01  Timo Sirainen <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c: If trash mailbox couldn't be
	  opened, don't crash later either.

2007-02-16 17:55  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: module_dir_init() was calling the init()
	  functions in reverse order.

2007-02-16 17:28  Timo Sirainen <tss@iki.fi>

	* src/auth/checkpassword-reply.c: If USER environment is set,
	  return it in "user" field and not "userdb_user".  Also don't
	  require that the USER environment exists.

2007-02-16 17:26  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Use auth_request_set_fields() to
	  set the fields returned by checkpassword script instead of
	  auth_stream_import()ing directly into extra_fields. This way
	  checkpassword can set special extra fields.

2007-02-16 17:22  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-request.h, passdb-blocking.c,
	  passdb-cache.c: Added auth_request_set_fields() and used it
	  instead of duplicating the code in multiple places.

2007-02-16 17:13  Timo Sirainen <tss@iki.fi>

	* src/auth/checkpassword-reply.c: Don't crash if USER or HOME
	  environment is missing. Allow HOME environment not to exist.

2007-02-16 14:03  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: APPEND ate all CPU if client didn't send
	  the message fast enough (since rc22).

2007-02-16 13:41  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: If authentication fails and
	  we've already destroyed the client, don't go io_add()ing the
	  client anywhere.

2007-02-16 13:40  Timo Sirainen <tss@iki.fi>

	* src/login-common/sasl-server.c: Make sure we crash if we're
	  trying to call sasl_callback() too many times.

2007-02-16 13:12  Timo Sirainen <tss@iki.fi>

	* src/: auth/password-scheme.c, deliver/deliver.c, dict/main.c,
	  imap/main.c, lib/module-dir.c, lib/module-dir.h, pop3/main.c:
	  module_dir_load() doesn't call init() functions anymore. Added a
	  new module_dir_init() which does it. This way imap/pop3 can load
	  the modules before chrooting and initialize them after.

2007-02-16 12:15  Timo Sirainen <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c: If trash mailbox can't be
	  opened, don't crash.

2007-02-16 12:08  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-client.c: Blocking passdbs didn't work as
	  masterdbs.

2007-02-16 10:54  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Allocate cache file's size amount of
	  memory for the file cache so it doesn't have to grow it
	  constantly while reading the file.

2007-02-16 10:53  Timo Sirainen <tss@iki.fi>

	* src/lib/: file-cache.c, file-cache.h: Made file_cache_set_size()
	  public.

2007-02-15 17:38  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Don't bother trying to save the mail twice
	  into the default mailbox (eg. if it's over quota).

2007-02-15 17:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Cleaned up the log_file and info_log_file
	  comments.

2007-02-15 14:26  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Hook all exit()s and if the exit code is
	  one of Dovecot's own FATAL_* ones, replace them with EX_TEMPFAIL.

2007-02-15 14:25  Timo Sirainen <tss@iki.fi>

	* src/lib/: failures.c, failures.h: Added
	  i_set_failure_exit_callback()

2007-02-15 13:57  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: Delay initializing I/O notify backend until the
	  first notify is added.  Non-IMAP processes never need notifies.

2007-02-15 13:31  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/imap-proxy.c, pop3-login/pop3-proxy.c: Don't
	  crash if the remote server disconnects before we're logged in.

2007-02-15 13:10  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Do the delayed login process starting
	  also after SIGHUPing.

2007-02-15 13:08  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, auth-process.h, login-process.c:
	  Start auth processes immediately at startup, not after one second
	  delay.  Don't try to start any login processes before at least
	  one auth process has sent back a handshake.

2007-02-15 12:12  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: RSET: Don't rollback the transaction if LAST
	  is enabled (there's no point, because all the seen flags are
	  removed anyway).

2007-02-15 11:51  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-cache.c, passdb.c: If looking
	  up credentials for NULL passwords, return "scheme not available"
	  instead of assert-crashing.

2007-02-15 11:39  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: mail_debug=yes: Log also home directory.

2007-02-15 11:38  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: If we've a mailbox selected and we're
	  appending to another mailbox, we got extra FLAGS/PERMANENTFLAGS
	  change notifications.

2007-02-15 11:06  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-cache.c, auth-cache.h, auth-request.c: If user is
	  changed with "user=x" in extra_fields, cache the entry with the
	  original username instead of with the changed username.

2007-02-15 10:48  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Removed assert. "pass" field is allowed
	  to be in extra_fields.

2007-02-15 10:46  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-request.h: Special extra_fields
	  weren't saved to auth cache. This was especially problematic for
	  allow_nets which was ignored if the user was already in cache.

2007-02-15 10:31  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-cache.c: If last login was valid and the current
	  one wasn't, we returned "not found from cache" but extra_fields
	  still had been modified, which could have caused crashes later.

2007-02-14 19:32  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: Don't break if current quota
	  value is negative.

2007-02-14 18:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: index/maildir/maildir-keywords.c,
	  subscription-file/subscription-file.c: fsync() subscriptions file
	  and maildir-keywords before rename()ing them.

2007-02-14 18:26  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: If UIDL command can't get the UID, die
	  instead of not returning anything and still replying "OK".

2007-02-14 18:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: When saving a message to
	  an empty mbox file, write X-IMAPbase header so the UID doesn't
	  change.

2007-02-13 19:37  Timo Sirainen <tss@iki.fi>

	* doc/Makefile.am: Removed deleted .txt file.

2007-02-12 21:48  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/userdb-passwd.c: Added
	  blocking=yes setting to userdb passwd.

2007-02-12 21:41  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/passdb-pam.c: Added blocking=yes
	  to PAM passdb to use auth workers instead of forking a new
	  process for each lookup.

2007-02-12 21:07  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: If PAM child process hasn't responded in
	  two minutes, send KILL signal to it.

2007-02-12 18:14  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: When running dump-capability, don't do
	  stderr_close_shutdown since it could break and make epoll_ctl()
	  return with EPERM.

2007-02-12 17:27  Timo Sirainen <tss@iki.fi>

	* doc/: Makefile.am, USE-WIKI-INSTEAD, auth.txt, configuration.txt,
	  design.txt, index.txt, mail-storages.txt, multiaccess.txt,
	  nfs.txt: Removed the old and wrong .txt files.

2007-02-07 01:45  Timo Sirainen <tss@iki.fi>

	* src/plugins/mail-log/mail-log-plugin.c: Don't crash with
	  expunging mails with non-existing message-id header.

2007-02-06 19:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Removed fsync() call. It
	  doesn't really provide any data integrity guarantees, and it
	  could make the performance worse.

2007-02-06 16:13  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.rc22

2007-02-06 16:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: We could have skipped
	  transactions completely (broken a few revisions ago).

2007-02-06 14:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: If extension size wasn't
	  32bit aligned, we broke when syncing it. However all the current
	  extensions are 32bit aligned.

2007-02-06 12:54  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: If client disconnects at the end of append
	  without waiting for a reply, handle it properly.

2007-02-06 10:43  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: _read() could have returned
	  "need more data" in wrong situations, which could have caused
	  problems later.

2007-02-06 09:49  Timo Sirainen <tss@iki.fi>

	* src/: auth/passdb-blocking.c, login-common/sasl-server.c:
	  Assert-crashfixes

2007-02-05 14:15  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: If namespace has a prefix and inbox=no,
	  don't list prefix.inbox if it happens to exist when listing for
	  %.

2007-02-05 13:07  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't use nonportable grep -q.

2007-02-05 12:11  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: BSD filesystem quota was counted
	  wrong. Patch by Manuel Bouyer

2007-02-05 11:42  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Commit the transaction even if client didn't
	  QUIT so cached data gets saved.

2007-02-05 11:27  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings-defs.c: mail_log_max_lines_per_sec was
	  declared as string.

2007-02-04 22:13  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-sql.conf: Added an example of how to concat() user
	  and domain.

2007-02-02 14:17  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.rc21

2007-02-02 14:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: crashfix

2007-02-02 12:59  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 1.0.rc20 released.

2007-02-02 11:20  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/mail-process.c,
	  src/master/master-settings-defs.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added mail_log_max_lines_per_sec
	  setting.

2007-02-02 11:14  Timo Sirainen <tss@iki.fi>

	* src/pop3/Makefile.am: Make sure str-sanitize.o is linked so
	  mail_log plugin works.

2007-02-02 10:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: Another lookup_uid_range() seq2
	  bugfix/crashfix.

2007-02-01 22:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Minor optimization

2007-02-01 22:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: If cache file wasn't
	  opened yet when flushing a transaction, the changes weren't
	  written to the file. Also fixes a "invalid record size" bug which
	  could have happened when transaction flush failed.

2007-02-01 21:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Setting flags other than
	  seen/deleted was broken.

2007-01-30 11:04  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt: Added a note about %E not needed with SQL
	  queries.

2007-01-28 15:45  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: If mailbox initialization failed, log an error
	  instead of just telling about it to the client.

2007-01-27 01:44  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Added --log-error command line option.

2007-01-26 13:58  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-request-handler.c, auth/mech-rpa.c,
	  auth/passdb-checkpassword.c, imap/imap-sync.c, lib/lib-signals.c,
	  lib-auth/auth-server-request.c,
	  lib-index/mail-transaction-log-view.c,
	  lib-index/mail-transaction-log.c, lib-storage/index/index-mail.c,
	  lib-storage/index/mbox/mbox-save.c, login-common/main.c,
	  master/login-process.c, master/ssl-init-openssl.c,
	  plugins/quota/quota-maildir.c, pop3/commands.c, util/rawlog.c:
	  Cleanups and minor fixes

2007-01-26 13:40  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-apop.c: Verify the APOP input before passing it to
	  sscanf() to make sure it's NUL-terminated.

2007-01-26 00:42  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-seekable.c: cleanup

2007-01-26 00:31  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: code cleanup

2007-01-25 17:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-transaction.c: If
	  save_commit_pre() fails, rollback the transaction.

2007-01-25 17:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: lookup_uid_range(): Last change
	  could have caused the returned seq2 to be too high, causing all
	  kinds of problems.

2007-01-25 16:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Error handling
	  fixes

2007-01-25 15:59  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: If we disconnect the client because
	  message ended unexpectedly, log an error.

2007-01-25 14:58  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: If we see exit for unknown child process, log
	  an error but don't crash. If net_listen() fails with EINTR, try
	  again unless it was interrupted by INT/TERM signal.

2007-01-25 09:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-mail.c: If we can't find the mail
	  from dirty mbox even after syncing, fail with error instead of
	  looping forever.

2007-01-25 09:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: When verifying a
	  mail's location in dirty mbox with invalid X-UID headers that
	  weren't yet rewritten, we would trust the X-UID header and cause
	  the verification to fail. Now we trust it only if it's valid,
	  otherwise fallback to MD5 sum of the header.

2007-01-24 20:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: Crashfix

2007-01-24 20:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Don't append
	  "/." to control dir when asking it for "".

2007-01-24 17:39  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: If exec() fails, don't close 0..3 fds
	  before logging the error. There's really no point, and it closes
	  the logging fd so the exec() error can't be logged.

2007-01-24 17:14  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: Fixed a file descriptor leak.

2007-01-24 16:37  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If auth_cache was enabled and userdb
	  returned "user unknown" (typically only deliver can do that), we
	  crashed.

2007-01-23 16:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: "View synchronization from
	  transaction log failed": Log also the index filename.

2007-01-23 16:28  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 1.0.rc19 released

2007-01-23 16:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-view-sync.c: Some
	  mmap_disable=no fixes. Some debug additions. Some generic index
	  fixes.

2007-01-23 13:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-sync.c: Log a
	  warning when we're starting fsck. Log error before calling fsck.

2007-01-23 13:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: cleanups

2007-01-23 11:41  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c: If control_dir wasn't
	  specified, we complained about ACL file existing in it.

2007-01-23 11:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Fix for last check

2007-01-23 10:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: cleanups

2007-01-23 09:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mmap_disable=yes: Verify that
	  header_size and messages_count are low enough so we don't try to
	  allocate too much memory.

2007-01-22 16:30  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.rc18

2007-01-22 16:29  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2007-01-22 16:29  Timo Sirainen <tss@iki.fi>

	* autogen.sh: Removed -f option from autoreconf, since it
	  overwrites our INSTALL file.

2007-01-22 16:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c:
	  maildir_copy_with_hardlinks=yes could have caused "Duplicate file
	  in uidlist" errors. The fix slows it down a bit though, the files
	  are now always first hardlinked to tmp/ and later rename()d from
	  there to cur/ or new/.

2007-01-22 15:21  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/maildir/maildir-save.c,
	  lib-index/mail-index-transaction.c: Added asserts

2007-01-22 12:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync-update.c, mbox-sync.c: Restore
	  sync_ctx->next_uid to original value when beginning a rewrite.
	  This could fix some problems with broken UIDs causing crashes.

2007-01-22 12:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: If mbox had broken UIDs
	  and we didn't rewrite them, don't mark the index as being synced.

2007-01-22 12:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: If message had one
	  invalid X-UID and another valid X-UID, we still marked the valid
	  one with uid_broken=TRUE.

2007-01-22 11:54  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-keywords.c: Removed accidentally
	  committed debug assert.

2007-01-22 10:57  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: If config file contained quoted "value",
	  the quotes weren't stripped.	syslog_facility wasn't converted
	  from name to numeric value.

2007-01-21 15:49  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: If log_timestamp isn't uncommented in
	  dovecot.conf, use the default.

2007-01-21 10:35  Timo Sirainen <tss@iki.fi>

	* src/login-common/: login-proxy.c, login-proxy.h: Forgot to commit
	  for the "log proxy destination" change.

2007-01-19 21:59  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c: Moved dovecot-acl file from
	  control dir to mail directory, except with mboxes. If the file
	  still exists in control dir, Dovecot kills itself (rather than
	  give full access to the mailbox).

2007-01-19 21:19  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/imap-proxy.c, pop3-login/pop3-proxy.c: Log the
	  proxy destination host:port.

2007-01-19 21:07  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-status.c: Doing a STATUS for unknown storage
	  shouldn't return with "needs more data" from the function.

2007-01-19 20:49  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: messages=n actually updated
	  storage.

2007-01-19 20:26  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Ignore empty parameters. "Unknown
	  argument: xx" printed wrong argument.  Patch by Jan Srzednicki

2007-01-19 18:25  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: If we can't open the log file, write the
	  error to stderr instead of relying on the existing fatal handler
	  which may not do anything.

2007-01-19 16:45  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Removed umask setting from here. It's just
	  confusing here because changing it won't anyway work as intended.

2007-01-19 16:33  Timo Sirainen <tss@iki.fi>

	* src/plugins/Makefile.am: Forgot to add mail-log here.

2007-01-19 15:27  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Removed accidentally committed debugging
	  code.

2007-01-19 15:25  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: auth cache: If passdb didn't provide the
	  password, we used the user-given plaintext password, but we
	  cached it with wrong scheme unless the passdb's default scheme
	  was plain.

2007-01-19 15:19  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-connection.c, auth-master-connection.h,
	  auth-request-handler.c, auth.c, db-ldap.h, main.c, userdb-ldap.c:
	  Several fixes to handling deinitialization without crashing.

2007-01-19 15:18  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, passdb-ldap.c: Do ldap_bind() only when
	  there are no requests waiting, and don't do anything until
	  ldap_bind() has finished. This fixes several problems with
	  auth_bind=yes.

2007-01-19 13:27  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If request fails with internal failure,
	  don't crash if auth cache is disabled.

2007-01-18 19:51  Timo Sirainen <tss@iki.fi>

	* configure.in: Allow --with-vpopmail=path specify the
	  vpopmail_home path.

2007-01-18 18:45  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/mail-log/.cvsignore,
	  src/plugins/mail-log/Makefile.am,
	  src/plugins/mail-log/mail-log-plugin.c,
	  src/plugins/mail-log/mail-log-plugin.h: Added mail_log plugin to
	  log various mail operations. Currently it logs mail copies,
	  deletions, expunges and mailbox deletions.

2007-01-18 17:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-keywords.c,
	  maildir-storage.c, maildir-storage.h, maildir-uidlist.c,
	  maildir-util.c: Saved mails and dovecot-keywords file didn't set
	  the group from dovecot-shared file.

2007-01-18 16:53  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Removed mail_read_mmaped setting from the
	  example config. It still exists, but since it might not work too
	  well, it's better to just hide it so new people won't enable it..

2007-01-18 16:44  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c: If inotify_add_watch() fails
	  with ESTALE, don't log an error.

2007-01-18 16:36  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: base_dir doesn't need to be
	  group-readable, don't force it.

2007-01-18 15:36  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: debug: Don't bother warning
	  about cache compressions. It has lived its usefulness.

2007-01-18 15:33  Timo Sirainen <tss@iki.fi>

	* src/lib/: mempool-alloconly.c, mempool-datastack.c,
	  mempool-system.c, mempool-unsafe-datastack.c, mempool.h: Don't
	  keep the memory pool virtual functions in the pool structure
	  itself, rather access them via a pointer to a shared virtual
	  function struct.  Reduces memory usage a bit.

2007-01-18 15:31  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: cleanup

2007-01-17 23:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-keywords.c,
	  mail-index-sync-private.h, mail-index-sync-update.c,
	  mail-index.c: Keywords were sometimes being re-added to the index
	  even while they already existed, causing the record size to
	  bloat.

2007-01-17 18:53  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Don't rename() .log to
	  .log.2, because it temporarily loses the log file.  Use unlink()
	  + link() instead.

2007-01-17 18:47  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: unreliable_flags wasn't
	  always set correctly, which caused "xxx counter wrong" errors and
	  such.

2007-01-17 18:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c: cleanup

2007-01-17 17:59  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c: Disable dnotify silently if it's not
	  supported by the kernel. We were missing one check.

2007-01-17 16:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-view.c,
	  mail-index.c, mail-transaction-log-view.c,
	  mail-transaction-log.c: Fixes to error handling paths.

2007-01-17 14:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: A new "extension
	  introduction" in transaction log could have left some existing
	  views to contain an invalid mapping where it contained the new
	  extension, but with a wrong record_size.

2007-01-16 22:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: And now really fix the log
	  rotation race.

2007-01-16 22:00  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Make sure file_seq isn't zero in
	  cache file header.

2007-01-16 21:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-append.c,
	  mail-transaction-log.c: Fixed a race condition in transaction log
	  rotation, which could have caused log data to be overwritten.

2007-01-16 18:27  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: cleanup

2007-01-16 18:27  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Make sure that extensions don't point
	  outside allocated record size.

2007-01-16 16:59  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/maildir/maildir-util.c: When opening
	  maildir, check if tmp/'s atime is over 8h old. If it is, delete
	  old files in it. However if atime - ctime > 36h, it means there's
	  nothing to be deleted so the scanning isn't done then. We update
	  atime if filesystem is mounted with noatime.

2007-01-16 15:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index.c: Added some
	  extra checks/asserts

2007-01-16 14:09  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: UID -> seq lookup: Optimize
	  UID=1 and UID=<next_uid>-1 cases.

2007-01-16 13:25  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Last change for making ldap_bind() error
	  handling better was actually broken.

2007-01-16 13:23  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/: auth-cache.c, auth-request.c, auth-request.h,
	  userdb-ldap.c, userdb-passwd-file.c, userdb-passwd.c,
	  userdb-sql.c, userdb-vpopmail.c, userdb.h: Authentication cache
	  caches now also userdb data. Code by Tommi Saviranta.

2007-01-16 13:18  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request-handler.c, auth-stream.c, auth-stream.h,
	  passdb-blocking.c, userdb-prefetch.c: extra_fields == NULL and
	  empty extra_fields (reset after each passdb lookup) should be
	  treated the same. Fixes some assert crashes.

2007-01-14 04:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: We could have synced
	  external transactions multiple times, causing corrupted view
	  errors.

2007-01-14 03:37  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: View syncing could have
	  caused some transactions to be synced multiple times in some
	  situations.

2007-01-14 03:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-lookup.c, mail-cache-private.h:
	  Removed file offset caching from mail_cache_foreach(). It didn't
	  work correctly when cache file was just compressed, and caused
	  "cache file corrupted" errors.

2007-01-14 01:49  Timo Sirainen <tss@iki.fi>

	* autogen.sh: Copy config.rpath before running autoreconf.

2007-01-14 01:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Grow the initial
	  pool sizes a bit.

2007-01-09 20:30  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Delete all auth-worker.* files from
	  Dovecot's base_dir when starting.

2007-01-09 20:19  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-body-search.c: When searching MIME body
	  headers, make sure we don't go out of bounds with broken MIME
	  messages and cause assert-crash.

2007-01-09 11:40  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: If ldap_bind() fails directly, log the "ldap
	  server down" errors more nicely.

2007-01-07 07:26  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 1.0.rc17 released

2007-01-07 07:24  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-blocking.c: We sent extra "OK" to master, causing
	  it to think it was the username.

2007-01-05 18:48  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Don't assert-crash if a command is waiting in
	  queue after we've disconnected the client for some reason.

2007-01-05 14:58  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.rc16

2007-01-05 14:52  Timo Sirainen <tss@iki.fi>

	* src/util/rawlog.c: Added -i and -o options to rawlog to restrict
	  logging to only input or output.

2007-01-05 14:22  Timo Sirainen <tss@iki.fi>

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c: If index/control
	  dirs were different than the maildir, deleting mailboxes didn't
	  move their contents correctly.

2007-01-04 14:04  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: Changed assert so it doesn't give a
	  compiler warning with 32bit systems.

2007-01-04 13:21  Timo Sirainen <tss@iki.fi>

	* autogen.sh: Comment out the configurable dir environments.

2007-01-04 00:54  Timo Sirainen <tss@iki.fi>

	* .cvsignore: Added config.rpath

2007-01-04 00:53  Timo Sirainen <tss@iki.fi>

	* autogen.sh: Rewrite. Use autoreconf now. Also copy config.rpath
	  from gettext's directory.

2007-01-04 00:03  Timo Sirainen <tss@iki.fi>

	* src/master/Makefile.am: master-settings-defs.c wasn't listed
	  anywhere

2007-01-03 23:49  Timo Sirainen <tss@iki.fi>

	* src/login-common/main.c: Potential crashfix

2007-01-03 22:59  Timo Sirainen <tss@iki.fi>

	* src/login-common/main.c: Don't keep a connection open to
	  dovecot-auth when we're only proxying.

2007-01-03 22:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c,
	  maildir/maildir-storage.c, mbox/mbox-storage.c:
	  mail_full_filesystem_access=yes: If trying to access ~user
	  directory for a user that doesn't exist, just treat it as a
	  normal mailbox that begins with '~'. Before we created such
	  mailboxes into home directory and trying to delete them crashed.

2007-01-03 22:38  Timo Sirainen <tss@iki.fi>

	* src/lib/: home-expand.c, home-expand.h: Added home_try_expand()

2006-12-31 16:09  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index.c: Minor locking
	  fix/cleanups.

2006-12-31 16:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: If we didn't sync
	  everything in the view, we could have synced some transactions
	  multiple times causing different kinds of problems.

2006-12-29 00:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: If cache compressing notices
	  that it was compressed after locking, we left the cache file
	  locked. Also in case of errors we left it locked.

2006-12-28 23:21  Timo Sirainen <tss@iki.fi>

	* src/: lib/mempool-alloconly.c, lib/mempool.h,
	  lib-storage/index/maildir/maildir-uidlist.c: debug:
	  MEMPOOL_GROWING prefix in alloconly pool names means that when
	  the memory pool needs to be grown, there's no need to log a
	  warning.

2006-12-28 23:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-keywords.c: Grow default
	  pool size

2006-12-28 22:51  Timo Sirainen <tss@iki.fi>

	* src/lib/fd-close-on-exec.c: debug: OSX leaks an fd from
	  gettimeofday(), ignore it.  Also cleaned up the code a bit.

2006-12-28 20:54  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-index-view.c: If
	  there are transactions left while unlocking, don't unlock. Also
	  added some next_uid debugging.

2006-12-28 19:59  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: If ssl_disable=yes, don't bother resolving
	  ssl_listen. Also if listen or ssl_listen resolving fails, log if
	  it was listen or ssl_listen setting that caused the error.

2006-12-28 18:40  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-fetch.c, imap-fetch-body.c, imap-fetch.c,
	  imap-fetch.h: When client fetches message data that has already
	  been expunged, reply with dummy NIL and such values for the
	  message. Don't disconnect the client anymore.

2006-12-28 18:09  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: If we get POLLNVAL, disable events
	  completely for the io so we don't just loop forever.

2006-12-28 16:58  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Forgot to send dotlock_use_excl to
	  mail processes..

2006-12-28 16:54  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/Makefile.am: ACL plugin was supposed to be with
	  01 priority, not 10.

2006-12-28 16:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c, dbox/dbox-storage.h,
	  dbox/dbox-sync-expunge.c, dbox/dbox-uidlist.c,
	  maildir/maildir-keywords.c, maildir/maildir-uidlist.c,
	  mbox/mbox-lock.c: More dotlock_use_excl uses.

2006-12-28 16:32  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: And compile fix..

2006-12-28 16:27  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/deliver/duplicate.c,
	  src/lib-index/mail-cache.c, src/lib-index/mail-index-private.h,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-index/mail-transaction-log.c,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/subscription-file/subscription-file.c,
	  src/master/master-settings-defs.c, src/master/master-settings.c,
	  src/master/master-settings.h,
	  src/plugins/convert/convert-storage.c,
	  src/plugins/quota/quota-maildir.c: Added dotlock_use_excl
	  setting.

2006-12-28 16:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Use rename()
	  instead of link() + unlink() when moving a mail from tmp/ to
	  new/.

2006-12-28 15:21  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/: auth-client.c, auth-server-connection.h: If no
	  auth sockets are found in 10 seconds, kill ourself.

2006-12-28 15:06  Timo Sirainen <tss@iki.fi>

	* src/master/: main.c, master-settings.c, master-settings.h: -n and
	  -a parameters shouldn't be deleting auth sockets.

2006-12-28 14:47  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/: acl-api-private.h, acl-api.c,
	  acl-backend-vfile.c, acl-backend.c, acl-plugin.c: If debug is
	  enabled, log some debugging messages. Also cleaned up the code
	  bit, and made "acl = vfile" not require ":" after the "vfile".

2006-12-28 12:26  Timo Sirainen <tss@iki.fi>

	* src/: deliver/Makefile.am, deliver/deliver.c,
	  master/master-settings-defs.c, master/master-settings.c: deliver
	  was treating boolean settings set to "no" as if they were "yes"
	  (usually they were supposed to be commented out)

2006-12-23 18:06  Timo Sirainen <tss@iki.fi>

	* TODO: Updated

2006-12-22 21:46  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: s/Backtrace/Raw backtrace/

2006-12-22 14:20  Timo Sirainen <timo.sirainen@movial.fi>

	* dovecot-example.conf,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/maildir/maildir-uidlist.c,
	  src/lib-storage/index/maildir/maildir-uidlist.h,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added
	  maildir_copy_preserve_filename setting.

2006-12-21 23:54  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Changed maildir_copy_with_hardlinks
	  setting's description to be much more positive. It'll probably be
	  set to yes by default in v2.0.

2006-12-21 21:25  Timo Sirainen <tss@iki.fi>

	* src/util/dovecotpw.c: argv[] isn't unused.

2006-12-21 21:22  Timo Sirainen <tss@iki.fi>

	* src/util/dovecotpw.c: getopt() return value should be stored into
	  int, not into char. Fixes PowerPC Linux where char is unsigned.

2006-12-21 15:59  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: auth_cache_size comment updated. It no
	  longer has problems with identical usernames in different
	  databases.

2006-12-21 15:57  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-sql.c: "Password query" -> "User query" in error
	  messages.

2006-12-21 15:53  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: If the module dir doesn't exist, die only
	  if we were given a list of modules to load. Otherwise fail
	  silently.

2006-12-21 15:46  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb.c: Fix

2006-12-21 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Give an error if there are duplicate files
	  for a single module. Also if the module directory can't be
	  opened, die immediately.

2006-12-20 20:13  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-status.c: If STATUS command is done for a selected
	  mailbox, don't sync it. This could have caused lost EXPUNGEs
	  among other lost replies..

2006-12-20 17:32  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Fix for last change..

2006-12-20 16:38  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: Take back the last change in here. It was
	  correctly handled already.

2006-12-20 16:35  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, cmd-idle.c: Fixed potential hang problems.

2006-12-20 05:10  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: "Set pop3_uidl_format in config file" may be
	  easier to understand..

2006-12-20 05:07  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated pop3_uidl_format comments.

2006-12-20 04:52  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, login-common/common.h,
	  pop3-login/client-authenticate.c: "Plaintext authentication
	  disabled" -> "Plaintext authentication disallowed on non-secure
	  connections"

2006-12-17 16:34  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: Fixed a file descriptor at
	  deinit.

2006-12-17 14:32  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c: Fixes

2006-12-17 14:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.h:
	  maildir_file_do() takes uid, not seq..

2006-12-16 13:37  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-worker-client.c, passdb.c, passdb.h,
	  password-scheme.c: Changed the default naming for password
	  schemes: HMAC-MD5 -> CRAM-MD5. MD5 -> MD5-CRYPT. The old names
	  still work for backwards compatibility.

2006-12-16 00:08  Timo Sirainen <timo.sirainen@movial.fi>

	* configure.in, dovecot-example.conf, src/plugins/Makefile.am,
	  src/plugins/lazy-expunge/.cvsignore,
	  src/plugins/lazy-expunge/Makefile.am,
	  src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	  src/plugins/lazy-expunge/lazy-expunge-plugin.h: Added lazy
	  expunge plugin.

2006-12-15 23:47  Timo Sirainen <tss@iki.fi>

	* src/imap/: namespace.c, namespace.h: Added
	  namespace_find_prefix() function.

2006-12-15 23:46  Timo Sirainen <tss@iki.fi>

	* src/plugins/: acl/Makefile.am, convert/Makefile.am,
	  imap-quota/Makefile.am, quota/Makefile.am, trash/Makefile.am,
	  zlib/Makefile.am: Changed the plugin filename numbering (ie. the
	  ordering in which the plugins are loaded). This doesn't change
	  anything for current plugins, but future plugins will need this
	  change so they can get themselves loaded between specific
	  plugins.

2006-12-15 23:08  Timo Sirainen <tss@iki.fi>

	* src/: lib/compat.h, lib-storage/index/maildir/maildir-storage.c:
	  Added EDESTDIREXISTS() macro, and changed rename() calls to use
	  it.

2006-12-15 22:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: rename and
	  delete operations didn't touch control directory if it was
	  different from maildir or index dir.

2006-12-15 21:02  Timo Sirainen <tss@iki.fi>

	* src/imap/namespace.h: Minor cleanup

2006-12-10 14:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: If looked up record contains
	  UID=0, mark the index corrupted.

2006-12-09 15:11  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-connection.c, auth-request-handler.c,
	  auth-request.c, auth-request.h, auth-worker-client.c,
	  userdb-blocking.c, userdb-ldap.c, userdb-passwd-file.c,
	  userdb-passwd.c, userdb-prefetch.c, userdb-sql.c,
	  userdb-static.c, userdb-vpopmail.c, userdb.h: We treated internal
	  userdb lookup errors as "user unknown" errors. In such situations
	  this caused deliver to think the user didn't exist and the mail
	  get bounced.

2006-12-05 17:47  Timo Sirainen <tss@iki.fi>

	* src/login-common/sasl-server.c: proxy=y logins can't log in
	  either.

2006-12-03 20:02  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/imap-proxy.c, pop3-login/pop3-proxy.c: Fixed
	  crash with proxying.

2006-12-03 19:23  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, password-scheme.c: Don't crash if
	  plain-md5, plain-md4 or sha1 password is invalid and we're not
	  using digest-md5 authentication..

2006-12-03 19:12  Timo Sirainen <tss@iki.fi>

	* src/: plugins/quota/quota.c, master/mail-process.c: // comments
	  -> /* */ comments

2006-12-03 18:55  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/: Makefile.am, quota-count.c, quota-dict.c,
	  quota-private.h: dict quota: If dictionary doesn't yet contain
	  the quota, calculate it by going through all mails in all
	  mailboxes.

2006-12-03 16:59  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Set default_pass_scheme so that cache_key
	  works instead of just assert-crashing.

2006-12-03 16:15  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/: quota-dict.c, quota-dirsize.c, quota-fs.c,
	  quota-maildir.c, quota-private.h, quota.c: Added ignore setting
	  to maildir quota, which allows ignoring quota in Trash mailbox.

2006-12-03 15:45  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: restrict_gid_first/last wasn't working
	  correctly for non-primary groups.  Also restrict_gid_first=0
	  caused failures if user had 0 in non-primary groups.

2006-12-03 15:21  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: If mremap_anon() fails, don't leak/crash.

2006-12-03 15:09  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: Check against offset/size overflows.

2006-12-03 14:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-keywords.c: Use
	  dovecot-shared file's mode also when creating dovecot-keywords
	  file.

2006-12-03 14:12  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/mech-gssapi.c: Some systems have gssapi
	  elsewhere than gssapi/gssapi.h. So check also plain gssapi.h.
	  Based on patch by Chris Wakelin

2006-12-03 13:50  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/login-common/client-common.c,
	  src/login-common/client-common.h, src/login-common/main.c: Added
	  %a=local port and %b=remote port variables for
	  login_log_format_elements.

2006-12-03 13:35  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/plugins/convert/convert-plugin.c,
	  src/plugins/convert/convert-storage.c,
	  src/plugins/convert/convert-storage.h,
	  src/plugins/convert/convert-tool.c: Create storages with
	  MAIL_STORAGE_FLAG_NO_AUTOCREATE flag so we don't keep recreating
	  the old storage and converting it all the time. Also added
	  convert_skip_broken_mailboxes flag.

2006-12-03 13:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage.h, index/dbox/dbox-storage.c,
	  index/maildir/maildir-storage.c, index/mbox/mbox-storage.c: Added
	  MAIL_STORAGE_FLAG_NO_AUTOCREATE flag which silently fails storage
	  creation if the root directory doesn't exist. Otherwise the root
	  dir is created.

2006-12-03 12:47  Timo Sirainen <tss@iki.fi>

	* src/login-common/sasl-server.c: Uppercase the auth mechanism name
	  so it's always uppercased in logs.

2006-12-03 12:14  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt: Added smtp and deliver to %s explanation.

2006-11-27 01:50  Timo Sirainen <tss@iki.fi>

	* src/util/gdbhelper.c: Ignore SIG32 signal.

2006-11-25 11:56  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-interface.h: Auth request timeout needs to
	  be larger than login process timeout, which was just increased.

2006-11-24 09:32  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: Increase allowed
	  pre-login idle timeout from 1 minute to 3 minutes. This allows
	  the user to type the password more slowly, although I haven't
	  heard this causing problems for anyone.

2006-11-19 22:38  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: chdir() now gives error only if error is
	  something else than ENOENT. Also with debugging enabled log if
	  the home isn't found.

2006-11-19 13:36  Timo Sirainen <tss@iki.fi>

	* src/lib/backtrace-string.c: Handle backtrace_symbols() returning
	  NULL without errors (out of memory).

2006-11-19 13:30  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/Makefile.am, src/lib/backtrace-string.c,
	  src/lib/backtrace-string.h, src/lib/failures.c: Since getting
	  core dumps can be sometimes difficult, if we now do abort()
	  ourself, we first log the backtrace. This works at least with
	  Linux and Solaris.

2006-11-18 23:44  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.rc15.

2006-11-18 23:35  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: And accidentally reverted the first buffer
	  overflow fix in the second commit..

2006-11-18 23:31  Timo Sirainen <tss@iki.fi>

	* src/lib/: ostream-file.c, ostream.c: If connection is closed
	  while buffer is being flushed in uncorking, don't assert-crash.

2006-11-18 23:26  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: And another off-by-one buffer overflow fix.

2006-11-18 23:14  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: Off-by-one buffer overflow fix. The code
	  gets executed only with mmap_disable=yes when it's reading cache
	  file.

2006-11-18 22:17  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Handle vpopmail's nonstandard
	  exit codes.

2006-11-18 22:02  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: When invalid character is found from
	  username, say what character it is in the log message. Also with
	  auth_debug=yes log the whole username (sanitized).

2006-11-18 21:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-keywords.c: If we can't
	  open dovecot-keywords file, don't crash.

2006-11-18 21:34  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Added asserts

2006-11-18 21:29  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: If syncing finished with an error and client
	  had disconnected, we assert-crashed in io_add().

2006-11-18 21:09  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.c: my_strncasecmp() was broken.

2006-11-18 21:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-private.h,
	  mail-transaction-log-view.c, mail-transaction-log.c: Reference
	  counting fixes. Fixes an assert crash when closing the index.

2006-11-18 20:27  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Call ssl_step() at startup
	  instead of ssl_handshake(). If the first input packet was sent
	  along with the handshake, we hanged.

2006-11-15 14:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Maildir
	  separator was still hardcoded to '.' in one place.

2006-11-12 23:10  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Solaris LDAP compiling fix.

2006-11-12 21:31  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: If user has a home directory, but we can't
	  chdir() there, log an error (but don't fail).

2006-11-12 21:31  Timo Sirainen <tss@iki.fi>

	* src/deliver/mail-send.c: Handle fwrite() failure early.

2006-11-12 21:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: If ftruncate() fails in
	  error handling (it really shouldn't), log an error about it
	  anyway.

2006-11-12 20:08  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 1.0.rc14 released

2006-11-12 20:04  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/dbox/dbox-uidlist.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  plugins/acl/acl-backend-vfile.c, plugins/quota/quota-maildir.c:
	  Fixed some warnings with older gccs.

2006-11-12 19:54  Timo Sirainen <tss@iki.fi>

	* doc/auth-protocol.txt, src/auth/auth-master-connection.c: Removed
	  "DIE" command from auth protocol. It wasn't implemented, and I'm
	  not sure if it's such a good idea anyway.

2006-11-12 19:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction.c, mail-index.h: Removed
	  mail_index_update_header_ext(). It's not implemented, it's not
	  currently needed and it won't make it into v1.0 anyway.

2006-11-12 19:50  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Minor fix

2006-11-12 19:34  Timo Sirainen <tss@iki.fi>

	* src/util/.cvsignore: Added gdbhelper

2006-11-12 18:48  Timo Sirainen <tss@iki.fi>

	* src/plugins/: imap-quota/imap-quota-plugin.c,
	  quota/quota-plugin.c, quota/quota-plugin.h,
	  quota/quota-private.h, quota/quota-storage.c,
	  trash/trash-plugin.c: s/quota/quota_set/ so we don't conflict
	  with the quota symbol already present in Mac OS X.

2006-11-12 18:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-index.c: Removed code
	  which is never called.

2006-11-12 15:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Don't crash if syncing breaks.

2006-11-12 14:06  Timo Sirainen <tss@iki.fi>

	* src/deliver/Makefile.am: Removed str-sanitize.o from
	  unused_objects list because we do use it nowadays.

2006-11-12 13:07  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: Don't try to use ldap_bind() with empty
	  passwords, since Windows 2003 AD skips password checking with
	  them and just returns success.

2006-11-12 12:59  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: Cleanups, extra assert

2006-11-12 12:41  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  login-common/master.c, pop3-login/client-authenticate.c,
	  pop3-login/client.c: Fixed potential problems with client
	  disconnecting while master was handling the login.

2006-11-12 12:13  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: auth_bind=yes crashfix

2006-11-12 12:06  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/lib/var-expand.c: Fixed zero padding
	  handling and documented it. %0.1n shouldn't enable it, and it
	  really shouldn't stay for the next %variable. -sign also
	  shouldn't stay for the next variable.

2006-11-12 11:32  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Don't crash if client disconnected while
	  IDLEing.

2006-11-12 11:31  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: If mailbox is changed while syncing is being
	  done, and the second sync's changes aren't fully sent to the
	  client, we hanged (quite rare I think).

2006-11-12 11:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-private.h,
	  mail-transaction-log-view.c, mail-transaction-log.c: Code cleanup

2006-11-12 11:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: Memory/fd leak fix

2006-11-08 20:51  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Don't bother logging
	  "syscall failed: EOF" messages. No-one cares about them.

2006-11-08 17:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-private.h,
	  mail-transaction-log.c: Don't leak opened .log.2 transaction
	  logs.

2006-11-08 13:26  Timo Sirainen <tss@iki.fi>

	* configure.in: 1.0.rc13 released

2006-11-08 13:18  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO: 1.0.rc13 released.

2006-11-08 13:17  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Comment updates, wiki link updates.

2006-11-07 21:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: When verifying the header, check that
	  next_uid is larger than last message's UID.

2006-11-07 21:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-storage.h, maildir-sync.c: Saving mails could have
	  skipped over transactions, which caused different kinds of
	  problems.

2006-11-07 19:37  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Crashfix at quit

2006-11-07 16:16  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, passdb-ldap.c: Handle LDAP
	  requests while being disconnected more correctly.

2006-11-07 15:19  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, imap-login/imap-proxy.c,
	  pop3-login/client.c, pop3-login/pop3-proxy.c: Memory leak fix

2006-11-07 15:06  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/imap-proxy.c, login-common/client-common.h,
	  login-common/sasl-server.c, pop3-login/client-authenticate.c,
	  pop3-login/client.c, pop3-login/pop3-proxy.c: Crashfixes and more
	  asserts. Mostly related to use of AUTHENTICATE/AUTH commands.

2006-11-07 14:55  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-connection.c: Reduce memory usage in
	  case we read a lot of auth replies at once.

2006-11-07 14:01  Timo Sirainen <tss@iki.fi>

	* src/imap-login/imap-proxy.c: If client disconnects before logging
	  into remote server is complete, don't crash/leak memory.

2006-11-07 13:59  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: Missing TAB before "pass" broke
	  proxying.

2006-11-07 13:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-file.c, istream-mmap.c, ostream-file.c: When
	  i/ostream is closed, change the fd to be -1 so it won't be
	  accidentally used.

2006-11-07 13:57  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-epoll.c: Free all the used memory when destroying
	  the ioloop.

2006-11-07 12:52  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.h: Remove sasl_props from here too.

2006-11-05 20:47  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: If we're executing as a normal system
	  user, get the HOME environment from passwd if it's not set. This
	  makes it possible to run deliver from .forward.

2006-11-05 20:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.h: This file hasn't been used
	  for a long time.

2006-11-05 17:55  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: If both mail_location and
	  default_mail_env are set in the config file, give an error.

2006-11-05 17:30  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf: Comment updates

2006-11-05 16:38  Timo Sirainen <tss@iki.fi>

	* doc/: dovecot-ldap.conf, dovecot-sql.conf: Added comments that
	  the files should be owned by root and 0600. Some cleanups to
	  dovecot-ldap.conf.

2006-11-05 16:12  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: Don't send "pass" back if it's
	  already set, or if it's not known.

2006-11-05 16:01  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added missing imap_capability setting.

2006-11-05 15:51  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If proxy is returned, set also no_login
	  automatically, since it's always wanted in such case anyway.

2006-11-05 11:25  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.rc12

2006-11-05 10:58  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: default_mail_env fallbacking was
	  broken with --exec-mail.

2006-11-04 23:04  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: Compile fix

2006-11-04 21:20  Timo Sirainen <tss@iki.fi>

	* TODO: Update

2006-11-04 21:09  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0.rc11.

2006-11-04 21:08  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: Fixes to auth_bind.

2006-11-04 20:55  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Fixes

2006-11-04 20:22  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-ldap.c, userdb-ldap.c: Do better logging.

2006-11-04 20:09  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Don't call ldap_parse_sasl_bind_result() in
	  ldap_bind()'s callback. We're not doing SASL authentication.

2006-11-04 19:51  Timo Sirainen <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c: Trash plugin was completely
	  broken before.

2006-11-04 19:49  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Call deinit() for all modules first before
	  unloading them.

2006-11-04 18:43  Timo Sirainen <tss@iki.fi>

	* src/lib/lib.h: Include stddef.h always to make NULL expand
	  correctly in Solaris.

2006-11-04 15:51  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Cleanup

2006-11-04 15:09  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, passdb-ldap.c: Crashfixes

2006-11-04 15:00  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/db-ldap.c, src/auth/db-ldap.h,
	  src/auth/passdb-ldap.c, src/auth/userdb-ldap.c: LDAP code
	  changes: If auth binds are used, bind back to the default dn
	  before doing a search. Otherwise it could fail if user gave an
	  invalid password. Initial binding is now also done
	  asynchronously. Reconnecting to LDAP server wasn't working with
	  auth binds. Use pass_attrs even with auth_bind=yes since it may
	  contain other non-password fields also. Updated dovecot-ldap.conf
	  to contain sasl_bind settings and reflect these changes.

2006-11-04 12:05  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: inetd logins kept crashing dovecot
	  master.

2006-11-04 11:22  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: If passdb returned only userdb_
	  prefixed extra fields, don't add an extra TAB to the auth
	  client's OK reply.

2006-11-03 22:00  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb.c: Error message string update.

2006-11-03 14:19  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-kqueue.c, ioloop-notify-kqueue.c: Removed
	  compiler warnings with NetBSD.

2006-11-03 14:04  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/mountpoint.c: Added support for statvfs(),
	  which is what the newer BSDs use.

2006-11-03 13:21  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-message.c: Use i_toupper()

2006-11-03 12:59  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Error message fix for 64bit systems.

2006-11-03 09:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Fix

2006-11-02 21:34  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Give TCPLOCALIP and TCPREMOTEIP
	  and PROTO=TCP environments to checkpassword binary so we're UCSPI
	  (and vchkpw) compatible.

2006-11-02 21:19  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-ldap.c, passdb-sql.c: Non-plaintext
	  authentication didn't work with sql as passdb. Cleaned up the
	  same code for LDAP also.

2006-11-02 20:53  Timo Sirainen <tss@iki.fi>

	* src/deliver/mail-send.c: When sending rejects, don't include
	  Content-Type in the rejected mail's headers.

2006-11-02 20:42  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: If we had only prefixed namespaces and we
	  listed for "%", INBOX's flags weren't correct and it wasn't shown
	  at all with LSUB.

2006-11-02 20:05  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Make mail_debug=yes work with deliver too.

2006-11-02 19:55  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Added -f parameter to usage help.

2006-11-02 19:53  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.h: Comment update

2006-11-02 19:52  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Don't crash with -f "". Changed the
	  default from envelope to be MAILER-DAEMON.

2006-11-02 18:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-mail.h: Compiling fix

2006-11-02 18:11  Timo Sirainen <tss@iki.fi>

	* src/deliver/auth-client.c: If we can't get auth user reply in a
	  minute log timeout error and quit.

2006-11-02 17:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-fields.c, mail-cache.h: If cache file
	  contains broken field type or decision type mark the cache
	  corrupted instead of assert-crashing later.

2006-11-02 17:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Last changes broke it
	  badly.

2006-11-01 18:47  Timo Sirainen <tss@iki.fi>

	* src/lib/: failures.c, failures.h, imem.h, macros.h, str.h,
	  strfuncs.h: Added sentinel GCC attribute to *_strconcat()
	  functions. Added format printf-attribute to vprintf-type
	  functions.

2006-10-26 11:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Crashfix

2006-10-26 00:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h, mbox-sync.c:
	  Last keyword pool clearing optimization broke the keywords if we
	  had to move mails around in the file.

2006-10-24 16:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: flock isn't anymore the default
	  locking method, so don't bother giving a special error message if
	  it fails.

2006-10-17 11:26  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-worker-client.c, passdb-blocking.c: Fixes to
	  handling blocking passdb (ie. MySQL) failures. It ignored any
	  non-password related checks, such as allow_nets.

2006-10-17 11:06  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt: default_mail_env -> mail_location.

2006-10-17 11:02  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-storage.c:
	  Use the name "mail root directory" to describe where the
	  non-INBOX mbox mailboxes are and describe what it is in the
	  config file.

2006-10-17 10:55  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/deliver/deliver.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Renamed default_mail_env to
	  mail_location. Keep the default_mail_env working anyway for
	  backwards compatibility.

2006-10-16 11:12  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Handle the last line even if it
	  doesn't end with LF.

2006-10-15 23:31  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 1.0.rc10 released.

2006-10-15 23:11  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: Fix net_ipv6_mapped_ipv4_convert() to be
	  actually portable.

2006-10-15 22:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  istream-raw-mbox.h, mbox-sync-private.h, mbox-sync-rewrite.c,
	  mbox-sync.c: Fixes to handling CRLF linefeeds in mboxes.

2006-10-15 22:14  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added a warning about nss_ldap.

2006-10-15 22:07  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c:
	  Updates to ssl_ca_file and ssl_username_from_cert comments in
	  dovecot-example.conf. Added better logging for "Invalid
	  certificate". Patch by HenkJan Wolthuis (hj wolthuis kaw nl)

2006-10-15 21:31  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-bsdauth.c: Don't check password field ourself.
	  There's no point doing that and some backends won't even return
	  the password.

2006-10-15 21:03  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/lib/var-expand.c: Added %D modified to
	  return "sub.domain.org" as "sub,dc=domain,dc=org" (for LDAP
	  queries). Patch by Andrey Panin.

2006-10-15 20:55  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-blocking.c: If blocking passdb (ie. MySQL) didn't
	  return any extra fields, we didn't notice username changes and we
	  didn't cache the password.

2006-10-15 20:30  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-vpopmail.c: Added support for non-plaintext
	  authentication for vpopmail if it returns plaintext passwords.
	  Based on patch by Remi Gacogne (rgacogne aquaray com).

2006-10-15 20:06  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-passwd-file.c: If auth cache is enabled and %vars
	  are used in passwd-file path, get the non-username part of the
	  cache key from the path.

2006-10-15 20:02  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Don't even try to verify password with
	  deny=yes passdbs.

2006-10-15 17:56  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-view-sync.c, lib-index/mail-index.h,
	  lib-storage/index/index-sync.c: Try to avoid sending
	  duplicate/useless flag updates.

2006-10-15 17:44  Timo Sirainen <tss@iki.fi>

	* src/lib/: seq-range-array.c, seq-range-array.h:
	  seq_range_exists() can take a const pointer to the array.

2006-10-15 16:43  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-cache.c, auth-request.c: auth cache didn't work
	  properly with multiple passdbs.

2006-10-15 16:19  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: When matching allowed_nets IPs, convert
	  IPv6-mapped-IPv4 addresses to actual IPv4 addresses first.

2006-10-15 16:19  Timo Sirainen <tss@iki.fi>

	* src/lib/: network.c, network.h: Added
	  net_ipv6_mapped_ipv4_convert().

2006-10-15 15:54  Timo Sirainen <tss@iki.fi>

	* src/deliver/auth-client.c: Use mail_chroot setting.

2006-10-15 15:52  Timo Sirainen <tss@iki.fi>

	* doc/auth-protocol.txt, src/auth/auth-request-handler.c: Require
	  that the "resp" parameter for AUTH command is the last.

2006-10-15 15:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Filter out "From " lines
	  from headers. There's no reason they should exist in there and
	  they'll cause problems.

2006-10-15 15:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Fix to delayed cache file
	  opening, cached data might have been lost.

2006-10-15 13:05  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: If unknown QoP value is received, log
	  what it is.

2006-10-15 12:23  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-content-parser.c: We didn't skip whitespace
	  after '=' in parameters, which caused the parameter's value to be
	  empty.

2006-10-15 10:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-mail.c, maildir/maildir-mail.c,
	  mbox/mbox-mail.c: We added received date as time_t instead of
	  uint32_t which crashed with 64bit systems.

2006-10-14 00:02  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0.rc9.

2006-10-13 23:52  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: Reference
	  counting fix

2006-10-13 23:50  Timo Sirainen <tss@iki.fi>

	* src/master/: login-process.c, login-process.h, main.c: Reference
	  counter fixes

2006-10-13 23:11  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, imap-login/imap-proxy.c,
	  login-common/login-proxy.c, pop3-login/client.c,
	  pop3-login/pop3-proxy.c: Reference counter fixing for client
	  while it's being used in login proxy.  Fixes crashes.

2006-10-13 23:10  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Cleanup

2006-10-13 22:36  Timo Sirainen <tss@iki.fi>

	* src/lib/sha1.h: Let's be nice and work with older libmysqlclient
	  libraries.

2006-10-13 22:12  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-epoll.c: Don't pass uninitialized data in epoll
	  data struct's union to kernel.  Doesn't matter that much, but
	  keeps valgrind happy.

2006-10-13 20:23  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Deinit crashfix.

2006-10-13 20:06  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, login-common/ssl-proxy-openssl.c,
	  pop3-login/client.c: New asserts / cleanup

2006-10-13 19:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Clear the keywords pool
	  for each mail, so we don't waste memory. Also we can shrink the
	  initial pool size.

2006-10-13 18:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index.c: Handle moving
	  to memory failures better so we won't crash in some situations.

2006-10-13 18:03  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Make sure we don't kill login
	  processes that haven't yet even sent their initialization event.
	  Also added another sanity check.

2006-10-13 17:59  Timo Sirainen <tss@iki.fi>

	* src/master/log.c: Don't crash in log deinitialization.

2006-10-13 17:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Adding space to
	  header could have broken things. This fixes at least "X-IMAPbase
	  uid-last unexpectedly lost in mbox file" errors.

2006-10-13 16:37  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-cache.c,
	  src/auth/auth-cache.h, src/auth/auth-request.c,
	  src/auth/passdb-cache.c: auth_cache: Try to handle changing
	  passwords automatically: If password verification fails, but the
	  last one had succeeded, don't use the cache.	This works only
	  with plaintext auth.

2006-10-13 15:32  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-private.h, lib-index/mail-cache.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h:
	  Don't use time_t anymore in cache file. uint32_t is large enough
	  and makes cache files compatible between 32bit and 64bit systems.

2006-10-13 15:22  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h, lib-storage/index/index-storage.c:
	  Removed MAIL_INDEX_OPEN_FLAG_FAST. It wasn't being used, and we
	  probably want to have that as a default anyway.

2006-10-13 15:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-lookup.c, mail-cache-private.h,
	  mail-cache.c: Delay opening the cache file until it's actually
	  needed.

2006-10-13 15:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c: When registering fields, if
	  they were already exited in the cache file mark the cache file
	  corrupted.

2006-10-13 15:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: If time_t or uoff_t size had changed,
	  we returned -1 instead of FALSE, which broke the check later..

2006-10-13 14:30  Timo Sirainen <tss@iki.fi>

	* src/deliver/: auth-client.c, deliver.c: Don't require home
	  directory to be given. If debug is enabled, log what we get from
	  dovecot-auth.

2006-10-12 09:13  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: If login process dies before
	  initialization, stall creation of them instead of completely
	  shutting down.

2006-10-11 12:22  Timo Sirainen <tss@iki.fi>

	* src/master/log.c: When shutting down do one last read from log
	  fds to see if there's something waiting. Also set log fd to be
	  non-blocking.

2006-10-11 12:16  Timo Sirainen <tss@iki.fi>

	* src/: login-common/master.c, master/login-process.c,
	  master/master-login-interface.h: Send inode number in login
	  requests and verify that they match.

2006-10-11 10:33  Timo Sirainen <tss@iki.fi>

	* src/lib/: mountpoint.c, mountpoint.h: Handle ENOENT silently and
	  return 0.

2006-10-09 18:09  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0rc8

2006-10-09 17:26  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Increase default address sanitizer pool
	  size

2006-10-09 17:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Increase mail's default pool
	  size

2006-10-09 17:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage.c, mail-storage.h,
	  index/maildir/maildir-storage.c, index/mbox/mbox-storage.c: If
	  the mail environment data contains mail format prefix, don't do
	  any kind of autodetection. Practically this means that
	  mbox:/var/mail/user doesn't work anymore.

2006-10-08 23:18  Timo Sirainen <tss@iki.fi>

	* src/auth/: password-scheme-md5crypt.c, password-scheme-rpa.c,
	  password-scheme.c: Based on password length detect if it's
	  hex-encoded or sha1-encoded. Also use MD[45]_RESULTLEN macros
	  instead of hardcoded 16 value.

2006-10-08 23:14  Timo Sirainen <tss@iki.fi>

	* src/lib/: md4.c, md4.h: Added MD4_RESULTLEN macro.

2006-10-08 23:10  Timo Sirainen <tss@iki.fi>

	* src/lib/: md5.c, md5.h: Added MD5_RESULTLEN macro.

2006-10-08 22:41  Timo Sirainen <tss@iki.fi>

	* src/master/log.c: Fix

2006-10-08 21:46  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: If login process sends wrong state
	  information, restart it.

2006-10-08 21:42  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Handle INBOX-prefixed namespaces better.
	  Avoid duplicate INBOX replies if namespace prefix is given.

2006-10-08 21:25  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/auth/passdb-sia.c,
	  src/auth/passdb.c: Tru64 SIA authentication support. Patch by
	  Simon L Jackson (simon jackson carringbush net)

2006-10-08 20:09  Timo Sirainen <tss@iki.fi>

	* src/deliver/: deliver.c, mail-send.c: Log all mail saves and save
	  failures.

2006-10-08 19:24  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Added -f parameter to specify the envelope
	  sender which is used in mbox From-lines.

2006-10-08 19:22  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/index-search.c, lib-imap/imap-envelope.c,
	  lib-mail/message-address.c, lib-mail/message-address.h,
	  imap/imap-sort.c: Added fill_missing parameter to
	  message_address_parse() which specifies if missing mailbox and
	  domain should be returned as MISSING_MAILBOX and MISSING_DOMAIN
	  or just as empty strings.

2006-10-08 17:27  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Expand home directory in mail env if
	  it exists as eg. "mbox:~:INBOX=.." or as the last character

2006-09-25 12:14  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: And remove debugging code..

2006-09-25 12:07  Timo Sirainen <tss@iki.fi>

	* src/master/: login-process.c, login-process.h: SIGHUP caused
	  memory corruption

2006-09-25 10:30  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: If fd_read() returns EAGAIN, ignore
	  it.

2006-09-23 15:34  Timo Sirainen <tss@iki.fi>

	* src/imap/: commands.c, commands.h: Use array_t in commands
	  buffer.

2006-09-22 14:55  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-gssapi.c: POP3 service name is "pop" with GSSAPI.

2006-09-22 14:41  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Comment about protocols=none.

2006-09-22 14:39  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Allow "protocols = none".

2006-09-22 14:29  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: %i didn't work.

2006-09-22 13:26  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: "Can't connect to server" message's host was
	  wrong if uris setting was used.

2006-09-19 21:16  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-sql.conf: More explanation of the "user" field in
	  pass_query.

2006-09-11 19:13  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf: hosts doesn't default to localhost
	  anymore.

2006-09-10 18:01  Timo Sirainen <tss@iki.fi>

	* configure.in: Boehm GC seems to be working now. Removed the
	  broken-warning.

2006-09-10 17:59  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: GC optimization

2006-09-10 17:49  Timo Sirainen <tss@iki.fi>

	* src/lib/: data-stack.c, mempool-alloconly.c, mempool-system.c:
	  Fixes for using GC

2006-09-10 13:11  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-sql.c: Fixed atomic_inc() to work correctly
	  with shared keys.

2006-08-29 11:59  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Set USER environment to the destination
	  user, since some plugins require it to work.

2006-08-28 17:06  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Save queries within transaction in a
	  linked list and send them separately, instead of using one big
	  string with ';' separator, which didn't work with everyone..

2006-08-28 16:54  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-sql.c: Fixes. select/where fields were used in
	  wrong order

2006-08-26 13:56  Timo Sirainen <tss@iki.fi>

	* src/lib/hash.c: Initial hash table size was always 109 even
	  though the initial_size parameter was higher.

2006-08-26 13:55  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-kqueue.c: Fix 100% CPU usage looping when a
	  vnode change event came but it was never untriggered. Patch by
	  Rui Lopes (rgl ruilopes com)

2006-08-26 13:46  Timo Sirainen <tss@iki.fi>

	* src/deliver/duplicate.c: When reading the duplicate entries, the
	  timestamp wasn't saved so the entry was lost afterwards.

2006-08-24 14:17  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated pop3's mail_executable comment

2006-08-23 19:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: And actually fix
	  it instead of leaving it commented out...

2006-08-23 19:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Rename was a bit
	  broken if the new name began with the old name

2006-08-23 10:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Grow
	  index_header_lookup_ctx pool initial size.

2006-08-22 02:49  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: If master db has extra fields
	  set, send them to checkpassword in environment.

2006-08-18 11:35  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c: Compiler warning fix

2006-08-17 22:17  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 1.0.rc7 released

2006-08-17 21:16  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: io_add_notify() didn't set refcount so
	  io_remove() crashed for it.

2006-08-17 19:48  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Crashfix

2006-08-17 18:52  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Reference IOs before calling timeout
	  handlers, in case they call io_remove().

2006-08-17 18:46  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-internal.h, ioloop-kqueue.c, ioloop.c, ioloop.h:
	  OK, so the original kqueue code wasn't actually broken, but it
	  could have been made much simpler. Updated comments in ioloop.h
	  about IO_READ and IO_ERROR usage.

2006-08-17 18:17  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Cleanup + handle dup() failure.

2006-08-17 17:43  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Fixes

2006-08-16 21:33  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-epoll.c, ioloop-kqueue.c: Fixes

2006-08-16 20:48  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Non-plaintext auth: If
	  auth_debug_passwords=yes, show looked up credentials.

2006-08-16 17:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-kqueue.c, ioloop-notify-kqueue.c: Compiling
	  fixes

2006-08-16 15:54  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, ioloop-epoll.c, ioloop-internal.h,
	  ioloop-iolist.c, ioloop-iolist.h, ioloop-kqueue.c,
	  ioloop-notify-kqueue.c, ioloop-poll.c: Rewrote much of the kqueue
	  code. It didn't work correctly if there were both input and
	  output I/O handlers added for the same file descriptor. The code
	  works now very much like epoll code. Did also several cleanups.

2006-08-16 13:31  Timo Sirainen <tss@iki.fi>

	* configure.in: Use notify=kqueue automatically only if
	  ioloop=kqueue.

2006-08-16 12:54  Timo Sirainen <tss@iki.fi>

	* configure.in: Changed --enable-debug's description.

2006-08-16 12:16  Timo Sirainen <tss@iki.fi>

	* src/login-common/: client-common.c, ssl-proxy-openssl.c,
	  ssl-proxy.c, ssl-proxy.h: If SSL/TLS handshake didn't finish,
	  show "TLS handshaking" instead of "TLS" in logout line.

2006-08-11 15:03  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-checkpassword.c, passdb-pam.c: Set SIGCHLD
	  handler in init, not in preinit when lib_signals_init() hasn't
	  yet been called.

2006-08-11 01:12  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Check log_creaate_pipe() and dup()
	  return values and handle failures.

2006-08-10 23:21  Timo Sirainen <tss@iki.fi>

	* configure.in: eval doesn't need to have its parameters quoted.
	  The previous \" quoting was broken with POSIX shells (and
	  autoconf 2.60 now sets POSIX mode to non-bash/zsh shells also
	  where this was previously working wrong). So, all in all this
	  should fix OpenBSD compiling problems.

2006-08-10 22:32  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, client.h, commands.c: Show number of
	  actually expunged messages in logout message, instead of number
	  of messages marked as deleted.

2006-08-10 22:03  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c: Check for XFS quota
	  also from xfs/xqm.h

2006-08-10 21:59  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-checkpassword.c, passdb-pam.c: Use SIGCHLD
	  handler to check for killed child processes instead of a timeout
	  loop.

2006-08-10 21:48  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Set umask from dovecot.conf, or default to
	  0077.

2006-08-10 21:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: After saving a mail with
	  index being in synced state, update the sync_stamp and sync_size
	  fields in the index so that it actually stays synced.

2006-08-10 21:21  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated login_max_connections comment.

2006-08-10 21:14  Timo Sirainen <tss@iki.fi>

	* src/: login-common/client-common.h, login-common/common.h,
	  login-common/main.c, imap-login/client.c,
	  imap-login/imap-proxy.c, pop3-login/client.c,
	  pop3-login/pop3-proxy.c: Fixes for handling near-full connection
	  queues.

2006-08-10 20:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Create
	  maildirfolder file when creating new maildirs.

2006-08-10 20:22  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/lib/var-expand.c: Negative offsets count
	  from the end of the string. Patch by Johannes Berg.

2006-08-10 20:08  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: If dict_init() fails, die with a
	  i_fatal() message instead of crashing.

2006-08-10 19:44  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: If password query returns userdb_
	  prefixed fields (ie. for userdb prefetch) but not userdb_uid or
	  userdb_gid, add them based on the global uid/gid settings.

2006-08-10 19:15  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Allow empty protocols line when
	  using --exec-mail.

2006-08-10 19:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: We got into
	  infinite loops if trying to open a 2 byte sized file as mbox.

2006-08-10 18:52  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Allow base_dir to point to a
	  symlink.

2006-08-10 18:46  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, dict/main.c, imap/main.c, login-common/main.c,
	  master/main.c, master/master-settings.c,
	  master/master-settings.h, pop3/main.c: Require that master's
	  version number matches the child's, unless version_ignore=yes.
	  Usually it's an accidental installation problem if the version
	  numbers don't match.

2006-08-10 17:45  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c,
	  src/plugins/quota/quota-fs.h: Put back specific checks for struct
	  dqblk.dqb_curblocks vs curspace. The removal broke compiling for
	  some OSes such as OSX.

2006-08-10 17:28  Timo Sirainen <tss@iki.fi>

	* configure.in: Updated --with-notify description.

2006-08-10 15:54  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c: Silently disable dnotify if kernel
	  doesn't support RT signals, instead of just dying.

2006-08-07 15:01  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Don't crash if SSL is
	  disabled.

2006-08-07 12:42  Timo Sirainen <tss@iki.fi>

	* src/: deliver/deliver.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/mbox/istream-raw-mbox.c,
	  lib-storage/index/mbox/istream-raw-mbox.h,
	  lib-storage/index/mbox/mbox-file.c: Added
	  MAILBOX_OPEN_MBOX_ONE_MSG_ONLY flag for mailbox_open() which
	  makes it ignore all but the first From-line in a mbox. This
	  kludge is required for deliver which builds a temporary mbox
	  stream from the input. Later it should be fixed to use some
	  plain-mailbox format instead of mbox.

2006-08-06 23:29  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0 rc6

2006-08-06 22:22  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Default _LINUX_QUOTA_VERSION to 1
	  instead of 2, since older Linux v1 sys/quota.h didn't define it
	  at all.

2006-08-06 22:01  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: When listing INBOX from inbox=yes namespace,
	  don't insert the namespace prefix

2006-08-06 21:45  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Fixes to handling INBOX in LIST.

2006-08-06 21:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.h: MAILBOX_LIST_INBOX flag
	  conflicted with MAILBOX_LIST_CHILDREN flag, causing problems.

2006-08-06 21:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-list.c, mbox/mbox-list.c,
	  dbox/dbox-list.c: Handle reference parameter more like UW-IMAP:
	  If it doesn't begin with separator, just use it as a prefix to
	  mask. I'm not sure where I got the earlier rules..

2006-08-06 20:58  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Don't show INBOX if reference parameter is
	  given.

2006-08-06 20:37  Timo Sirainen <tss@iki.fi>

	* src/master/: mail-process.c, master-settings.c: Run imap
	  dump-capability process only after all the settings have been
	  verified to be correct. Added checks against trying
	  mail_drop_priv_before_exec=yes and chrooting, since we can't exec
	  the imap process if that's done. Fixed NFS check with chrooting.

2006-08-06 20:35  Timo Sirainen <tss@iki.fi>

	* src/login-common/main.c: Changed max_connections default value to
	  be 1, not that it should matter.

2006-08-06 20:08  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Minor cleanup, but more
	  importantly last commit message didn't say that the SSL proxy
	  rewrite was once again reverted to the original one, but with
	  SSL_pending() fix from the new one. Hopefully this will finally
	  work with everyone.

2006-08-06 20:05  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client.c,
	  src/login-common/common.h, src/login-common/login-proxy.c,
	  src/login-common/login-proxy.h, src/login-common/main.c,
	  src/login-common/master.c, src/login-common/master.h,
	  src/login-common/ssl-proxy-openssl.c,
	  src/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h,
	  src/master/login-process.c, src/master/login-process.h,
	  src/master/main.c, src/master/master-login-interface.h,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3-login/client.c: Fixes to login process handling,
	  especially with login_process_per_connection=no. Removed
	  login_max_logging_users setting since it was somewhat weird in
	  how it worked. Added login_max_connections to replace it with
	  login_process_per_connection=no, and with =yes its functionality
	  is now within login_max_processes_count.

2006-08-04 17:46  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: When mailbox changes are noticed and they're
	  sent to client, cork before doing it so each command isn't sent
	  in a separate packet.

2006-08-04 16:32  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-cache.c: Crashfix

2006-08-04 16:28  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/: acl-api-private.h, acl-api.c, acl-backend.c: If
	  .DEFAULT file exists in global ACL root directory, use it as the
	  default ACLs for all mailboxes.

2006-08-03 16:21  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If master login failed because of
	  non-password failure (eg. allow_nets) don't continue the
	  authentication to non-master passdbs.

2006-08-03 16:20  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If we logged in with IPv6 address and
	  allow_nets contained IPv4 address, we assert-crashed.

2006-08-03 15:37  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: When logging in as master user,
	  send it as "master_user" field to master among other userdb
	  fields.

2006-08-03 15:27  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Call io_remove() before closing
	  the fd.

2006-08-02 22:39  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c,
	  src/plugins/quota/quota-fs.h: Added --with-linux-quota configure
	  option to specify which Linux quota version to use. Don't bother
	  looking into struct dqblk to see if curblocks or curspace field
	  exists, we can figure it out from the quota version. If
	  quotactl() returns EINVAL, it could have been because wrong quota
	  version was used, so give a friendly message suggesting to look
	  at --with-linux-quota.

2006-08-02 21:22  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: And 1.0.rc5

2006-08-02 20:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c: And fix for previous
	  change..

2006-08-02 19:44  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: And 1.0.rc4..

2006-08-02 19:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c: Transaction view:
	  mail_index_get_header() returns now updated next_uid field after
	  appends.

2006-08-02 16:22  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0.rc3.

2006-08-02 00:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: We wrote mail bodies
	  through raw output stream, instead of the one that made sure that
	  CR+LF linefeeds were as configured.

2006-07-30 23:05  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-master-connection.c: Debug: Don't log empty error
	  when writing "master out" debug lines.

2006-07-30 23:03  Timo Sirainen <tss@iki.fi>

	* src/: dict/dict-server.c, lib-dict/dict-client.c: dict proxy:
	  Dictionary iteration was broken.

2006-07-30 23:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c,
	  index-mail.h: index_mail_cache_add() was used with lib-storage's
	  internal indexes for most of the received date, physical size and
	  virtual size cache additions. This may have caused all kinds of
	  trouble, but since it went unnoticed this long perhaps not..

2006-07-24 01:57  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: Don't count "." and ".."
	  directory sizes to quota. After rewriting maildirsize file keep
	  its fd open so that we can later update it. Patch by Alexander
	  Zagrebin

2006-07-24 00:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c:
	  Restore data stream's offset after it has been internally
	  changed, so that it doesn't have much visible effect on the
	  stream returned by mail_get_stream(). The buffered data will
	  still be lost, but this should help with the most common use
	  cases.

2006-07-23 23:32  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Use SSL_pending() to figure
	  out if we should call SSL_read() again.  Otherwise it breaks..

2006-07-23 23:19  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Don't constantly re-read
	  ssl-parameters.dat. Make sure that in input handler we read
	  everything that SSL_read() has buffered so we don't get stuck.

2006-07-23 22:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Don't crash if sync
	  needs to be rollbacked.

2006-07-23 22:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-mail.c: Slightly improved error
	  message.

2006-07-23 22:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: When saving a mail with
	  initial keywords, lock the uidlist before doing anything with the
	  file's header.

2006-07-23 21:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-keywords.c,
	  mail-index-sync-update.c: In some conditions a keyword could have
	  been added to the index twice. Also a few cleanups.

2006-07-23 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-sync-expunge.c, dbox-uidlist.c:
	  Memory/fd leak fixes

2006-07-23 19:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: When saving new mails,
	  append the changes to uidlist file, but only when doing so
	  doesn't temporarily move the file's mtime backwards.

2006-07-23 17:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: If header counters got
	  broken when updating internal views, say it clearly in error
	  messages instead of saying they're broken in the files
	  themselves.

2006-07-23 16:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c: Fixes to writing flags

2006-07-23 15:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-save.c, dbox-sync.c,
	  dbox-uidlist.c: Fixes for pop3_lock_session=yes. Wasn't as easy
	  as I thought. :)

2006-07-23 14:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Small memory usage optimization.

2006-07-23 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-storage.c, dbox-uidlist.c,
	  dbox-uidlist.h: Make pop3_lock_session work with dbox.

2006-07-23 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-expunge.c: If we find
	  unexpected messages from dbox, rebuild index files to fix the
	  problem.

2006-07-08 15:57  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt: Example fix: %Lp -> %Ls

2006-07-05 19:52  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: dovecot -n and -a: Print the config file path
	  before parsing it so if there are errors you can see what file is
	  being used.

2006-07-05 19:51  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Comment updates

2006-07-04 18:54  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated namespace separator's comments.

2006-07-04 17:51  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 1.0.rc2 released

2006-07-04 17:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-keywords.c,
	  maildir-storage.c: Added automatic upgrades from 0.99:
	  .subscriptions and .customflags are renamed to their new names
	  automatically.

2006-07-03 13:08  Timo Sirainen <tss@iki.fi>

	* configure.in: --with-ioloop=auto changed to --with-ioloop=best

2006-07-02 19:19  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: mail_cache_min_mail_count is
	  supposed to be an integer, not a string.

2006-07-02 17:54  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Added missing t_pop().

2006-07-02 15:30  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't use epoll/kqueue by default unless
	  --with-ioloop=auto is given.	They're not necessarily as stable.

2006-07-02 13:55  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: If something in io_loop_create() failed, we
	  logged the error to /dev/null.

2006-07-02 13:47  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: If writing to log file fails, restore errno
	  before %m is used. Although the log writing most likely fails
	  anyway at that point, but at least strace logs show it right. :)

2006-07-02 11:03  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: List -n and -a in short help. Fixes to
	  --build-options.

2006-07-01 22:54  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Second try with SSL proxy
	  rewrite. Did some fixes since last try.

2006-07-01 22:27  Timo Sirainen <tss@iki.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c: If there is no quota
	  for the user, GETQUOTAROOT leaked memory

2006-07-01 21:19  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: anonymous_username setting wasn't
	  being passed to auth process.

2006-07-01 21:15  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: If verbose_ssl=yes set
	  ssl_info_callback and print any alerts and BIO errors.

2006-07-01 20:26  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-close.c, imap/imap-expunge.c, pop3/commands.c:
	  Don't try to expunge messages if the mailbox is read-only. It'll
	  just cause our index files to go out of sync with the real
	  mailbox and cause errors.

2006-07-01 20:14  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: mountpoint_get() returned broken mount_path
	  and type with BSDs.

2006-07-01 20:13  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: BSD's quotactl() wants a file path,
	  not a device path.

2006-07-01 20:09  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client.c,
	  src/pop3-login/client.c: Removed hardcoded 127.* and ::1 IP
	  checks. Instead just check that local IP matches remote IP to
	  assume the connection is secure.

2006-07-01 19:42  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: Don't require valid uid/gid fields if
	  passwd-file isn't being used as a userdb.

2006-07-01 19:15  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c: Try to handle failures better.

2006-07-01 18:44  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Print the used configuration file's path with
	  -n and -a.

2006-07-01 18:40  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth.h, passdb-ldap.c: Moved
	  the <hidden> string into a macro. Hide the password also from
	  LDAP replies.

2006-07-01 18:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Messages' received
	  time wasn't saved properly when saving/copying multiple messages
	  at a time. Also if using quota plugin the S= size was only set
	  for the first saved file, and even that was wrong.

2006-07-01 17:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c:
	  mail_get_physical_size() was broken with non-committed mails,
	  which broke quota plugin.

2006-07-01 17:45  Timo Sirainen <tss@iki.fi>

	* src/lib/file-copy.c: Try to preserve file's mode and group when
	  copying it.

2006-07-01 17:44  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: If namespace's location field wasn't
	  set, the default location was supposed to be used.

2006-07-01 17:24  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-pgsql.c, driver-sqlite.c,
	  sql-api-private.h, sql-api.c, sql-api.h: sql_escape_string()
	  should return const char *, not char *.

2006-06-30 14:49  Timo Sirainen <tss@iki.fi>

	* src/lib/safe-mkdir.c: safe_mkdir() should return 1 always when it
	  creates a new directory, even if it changes the group/permissions
	  when doing it.

2006-06-29 12:49  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added tpop3d's pop3_uidl_format.

2006-06-28 20:21  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Allow log_path settings in config file to
	  be empty without trying to use empty files then.

2006-06-27 22:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-mail.c, maildir-sync.c,
	  maildir-util.c: Don't break if mailbox path contains ':'
	  characters.

2006-06-27 22:18  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0.rc1

2006-06-27 22:00  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Attempting to fix quota block
	  calculations to be correct.

2006-06-27 21:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: We could have
	  skipped INBOX if there wasn't .INBOX directory.

2006-06-27 21:03  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, imap/main.c, master/mail-process.c,
	  pop3/Makefile.am, pop3/main.c: Changed the
	  mail_plugins/mail_plugin_dir settings to be passed as the same
	  environments. If MAIL_PLUGIN_DIR environment isn't given, use the
	  built-in default.

2006-06-27 10:27  Timo Sirainen <tss@iki.fi>

	* src/: deliver/deliver.c, lib-storage/mail-storage.c:
	  MAIL_STORAGE_FLAG_KEEP_HEADER_MD5 flag was supposed to be set if
	  pop3_uidl_format contained %m. Added it now to
	  mail_storage_parse_env() so it's used everywhere.

2006-06-27 09:25  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-sqlite.c: Escape ' with '' instead of with \'.

2006-06-27 07:20  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't try to use any weird _syscall()s when
	  detecting epoll.

2006-06-26 18:51  Timo Sirainen <tss@iki.fi>

	* configure.in: Fix kqueue notify checking.

2006-06-26 17:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: If
	  dovecot-shared file exists in the Maildir++ root, use the file's
	  mode and gid when creating mailboxes under it.

2006-06-26 08:56  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Don't leak a file descriptor when
	  regenerating ssl-parameters.dat

2006-06-26 08:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Searching (storing,
	  fetching) with sequence sets containing commas was broken

2006-06-24 21:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Don't crash when different
	  search conditions reduce the search range so that minimum
	  sequence becomes larger than maximum..

2006-06-24 21:03  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend.c: Don't crash when checking "owner"
	  ACLs with shared namespaces.

2006-06-24 20:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: We assert-crashed
	  in wrong conditions.

2006-06-24 20:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  mbox-sync-rewrite.c, mbox-sync-update.c: Fixes to handling CR+LF
	  linefeeds.

2006-06-24 19:02  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-passwd-file.c: When using non-plaintext
	  authentication with passdb passwd-file we didn't support
	  extra_fields and we crashed if password scheme wasn't explicitly
	  specified in the passwd-file.

2006-06-24 18:24  Timo Sirainen <tss@iki.fi>

	* configure.in: fix

2006-06-20 15:29  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-search.c: Don't crash if seqset
	  restrictions caused no messages to be searched.

2006-06-20 15:16  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/: mail-search.c, index/index-search.c: NOT
	  condition wasn't handled correctly in SEARCH.

2006-06-20 13:59  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/passdb-checkpassword.c: If checkpassword lookup failed,
	  we crashed. auth_debug logged checkpassword's exit_status wrong.

2006-06-20 13:13  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/passdb-checkpassword.c: Return value 1 from
	  checkpassword can mean either password mismatch or unknown user.
	  Treat it as password mismatch instead of as unknown user.

2006-06-19 18:15  Timo Sirainen <tss@iki.fi>

	* src/lib/file-copy.c: If destination file already existed, we
	  didn't overwrite it with link() copying.

2006-06-19 16:14  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Prefer sasl/sasl.h. Require SASL v2,
	  otherwise disable it.

2006-06-19 16:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/db-ldap.c, src/auth/db-ldap.h: Check for
	  sasl.h and sasl/sasl.h existence and use the one that's found. If
	  neither is found, disable support for LDAP SASL.

2006-06-19 14:16  Timo Sirainen <timo.sirainen@movial.fi>

	* src/imap/imap-thread.c: Optimization for checking loops.

2006-06-18 19:47  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-des.c: Don't include stdint.h directly.

2006-06-18 09:49  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, deliver/Makefile.am, dict/Makefile.am,
	  imap/Makefile.am, pop3/Makefile.am: Added -export-dynamic.

2006-06-18 01:34  Timo Sirainen <tss@iki.fi>

	* configure.in: Fixes to io notify detection. Patch by Marcus
	  Rueckert

2006-06-18 00:24  Timo Sirainen <tss@iki.fi>

	* configure.in: Include linux/unistd.h instead of asm/unistd.h when
	  checking for epoll.

2006-06-17 22:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c: If requested mail
	  isn't found from uidlist, mark the mail as expunged.

2006-06-17 21:03  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: auth_debug: If allow_nets is given,
	  print debug messages when matching

2006-06-17 21:02  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: extra_args field was ignored if the
	  passwd-file wasn't also used as a userdb.

2006-06-17 20:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Crashfix if mail's
	  data is fetched in specific order (I'm not sure how to reproduce
	  this though, but the crash has happened to others)

2006-06-17 20:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Removed assert. In normal
	  situations it doesn't happen and in error cases (cached offset is
	  invalid) it causes a crash.

2006-06-17 19:48  Timo Sirainen <tss@iki.fi>

	* src/imap-login/client-authenticate.c: Don't crash if the initial
	  response isn't given for AUTHENTICATE..

2006-06-17 19:32  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/db-ldap.c, src/auth/db-ldap.h: Added TLS
	  support for LDAP if the library supports it.

2006-06-17 19:15  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech-anonymous.c, mech-apop.c, mech-cram-md5.c,
	  mech-digest-md5.c, mech-login.c, mech-ntlm.c, mech-plain.c,
	  mech-rpa.c, mech.c, mech.h: Added mech_generic_auth_internal()
	  and mech_generic_auth_free() functions and used them wherever
	  possible to reduce code duplication. Patch by Andrey Panin.

2006-06-17 18:03  Timo Sirainen <tss@iki.fi>

	* src/plugins/: acl/Makefile.am, convert/Makefile.am,
	  quota/Makefile.am, trash/Makefile.am: mkdir_p doesn't accept
	  multiple directories in some systems, so do it one at a time.
	  This also cleans up the code.

2006-06-17 18:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: If saved mail's body
	  doesn't end with LF, add it ourself.

2006-06-17 17:19  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap-login/client-authenticate.c: Added support
	  for SASL-IR extension.

2006-06-17 17:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: If mbox headers
	  have CRLF linefeeds, handle them properly instead of corrupting
	  the headers.

2006-06-17 17:10  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-parser.c, message-parser.h: Added
	  crlf_newline flag to header parser, which is set if the header
	  ended with CR+LF instead of LF.

2006-06-17 16:49  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Changed the created state dir's
	  default permissions to be 0750. Although this doesn't currently
	  really matter.

2006-06-17 16:26  Timo Sirainen <tss@iki.fi>

	* configure.in, src/master/Makefile.am,
	  src/master/master-settings.c, src/master/ssl-init.c: Added
	  --with-statedir configure option which defaults to
	  localstatedir/lib/dovecot. ssl-parameters.dat is permanently
	  stored in that directory and copied to login_dirs from there.

2006-06-17 16:24  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, file-copy.c, file-copy.h: Added
	  file_copy().

2006-06-17 16:01  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, password-scheme.c: Compiler warning fixes
	  and some coding style cleanups.

2006-06-17 15:56  Timo Sirainen <tss@iki.fi>

	* src/: lib/compat.h, lib-storage/index/maildir/maildir-copy.c:
	  Handle EMLINK and EPERM errors the same way as EXDEV when
	  handling hardlink failures. Added ECANTLINK() macro for this.

2006-06-17 15:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: When renaming a
	  mailbox's subfolders, read the list of them first into memory to
	  avoid the possibility of readdir() skipping some of the
	  mailboxes.

2006-06-17 15:22  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If multiple passdbs were configured and
	  we tried to authenticate as user which was in more than one of
	  them with different passwords, we gave "multiple passwords not
	  supported" error.

2006-06-17 15:14  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: Fixed memory leak in error
	  handling.

2006-06-17 15:06  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/plugins/trash/trash-plugin.c: Removed
	  hardcoded trash plugin configuration paths. Added information
	  about it to dovecot-example.conf

2006-06-17 14:45  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: Check that initial response
	  doesn't contain invalid characters. Give better error message in
	  case that happens.

2006-06-17 14:02  Timo Sirainen <tss@iki.fi>

	* src/imap/commands-util.c: Fixes to checking if mailbox name is
	  valid. In case mailbox name is invalid, put it through
	  str_sanitize() before giving it in an error message.

2006-06-17 13:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-sync.c,
	  maildir-uidlist.c, maildir-uidlist.h: Don't go fixing duplicate
	  maildir filenames without properly checking that they really are
	  such.

2006-06-17 13:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-transaction-log.c: Handle
	  transaction log deletions silently. Handle whole index directory
	  deletions silently (the most common cases anyway).

2006-06-17 13:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage-private.h, mail-storage.c,
	  index/dbox/dbox-storage.c, index/maildir/maildir-storage.c,
	  index/mbox/mbox-storage.c: When creating a mailbox, limit the
	  number of hierarchies (to 20) and the length of the mailbox name
	  within a hierarchy (to 200).

2006-06-17 12:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_move_to_memory(): Don't
	  break if the index is already in memory.  Fixes
	  mbox_min_index_size.

2006-06-17 12:24  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/dict/dict-server.c,
	  src/lib-dict/dict-client.h, src/master/dict-process.c,
	  src/master/dict-process.h, src/master/log.c, src/master/log.h,
	  src/master/main.c, src/master/master-settings.c,
	  src/master/master-settings.h: Instead of passing URIs directly to
	  dictionary server, it now accepts only named dictionaries which
	  are configured in config file. SIGHUPing master now restarts dict
	  server.

2006-06-17 12:21  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: Don't crash if dict_lookup()
	  didn't return success.

2006-06-17 12:20  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Escaping a string crashed if we
	  weren't connected to mysql.

2006-06-17 11:24  Timo Sirainen <tss@iki.fi>

	* src/dict/main.c: Make sure the process dies when the master
	  process dies.

2006-06-16 18:37  Timo Sirainen <tss@iki.fi>

	* src/deliver/auth-client.c: If USER query doesn't return non-zero
	  uid and gid, give a nice error message.

2006-06-16 18:13  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, login-process.c, mail-process.c,
	  main.c, master-settings.c: Settings parser nowadays returns ""
	  instead of NULL when it reads an empty value from config file
	  (due to some good reason I unfortunately didn't write to commit
	  message and can't remember anymore). Fixed a lot of existing
	  checks which checked for empty strings with NULL instead of ""
	  checks.

2006-06-16 13:24  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c: Added support for XFS
	  disk quotas. Patch by Pawel Jarosz

2006-06-16 11:47  Timo Sirainen <tss@iki.fi>

	* configure.in: Better detection for ioloop and notify methods.
	  Patch by Roy Marples

2006-06-16 11:42  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-client.c: Fixes

2006-06-16 11:42  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Fixes to handling database updates.

2006-06-16 11:09  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Default mail_plugin_dir was wrong for lda.

2006-06-16 10:38  Timo Sirainen <tss@iki.fi>

	* COPYING, src/auth/mech-apop.c, src/auth/mech-gssapi.c,
	  src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth/mech-rpa.c,
	  src/lib/hmac-md5.c, src/lib/ioloop-epoll.c,
	  src/lib-ntlm/ntlm-byteorder.h, src/lib-ntlm/ntlm-encrypt.c,
	  src/lib-ntlm/ntlm-flags.h, src/lib-ntlm/ntlm-message.c,
	  src/lib-ntlm/ntlm-types.h: Relicensed dovecot-auth to MIT.

2006-06-16 10:28  Timo Sirainen <tss@iki.fi>

	* src/auth/password-scheme.c: Added PLAIN-MD4 password scheme.
	  Patch by Andrey Panin.

2006-06-16 10:28  Timo Sirainen <tss@iki.fi>

	* src/lib/: md4.c, md5.c: MD4 was broken with 64bit systems. Added
	  a few x86-64 optimizations. Patch by Andrey Panin

2006-06-16 10:26  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-byteorder.h: X68_64 CPU can do little-endian
	  accesses itself. This patch updates ntlm-byteorder.h to reflect
	  this fact. Patch by Andrey Panin.

2006-06-16 10:25  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-des.c: Replaced LGPL licensed DES
	  implementation with MIT licensed one taken from PuTTY SSH client.
	  Patch by Andrey Panin.

2006-06-16 10:21  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-login.c: Support initial SASL response with LOGIN
	  mechanism. Patch by Anders Karlsson

2006-06-16 10:15  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Handle errors more correctly. Fixes
	  problems with some OSes.

2006-06-16 10:11  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: We broke if ssl_listen wasn't explicitly set
	  in config file. Patch by Jonathan C. Broome

2006-06-16 09:59  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-pam.c: Fixes to handling PAM
	  password expiring. Patch by Vaidas Pilkauskas

2006-06-16 09:09  Timo Sirainen <tss@iki.fi>

	* src/deliver/: Makefile.am, deliver.c: If mail_plugin_dir isn't
	  given, use the default path for it instead of ignoring
	  mail_plugins completely.

2006-06-16 08:59  Timo Sirainen <tss@iki.fi>

	* src/dict/dict-server.c: Minor error message update

2006-06-16 08:47  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-sql.c: Fixes to SQL update statements

2006-06-16 08:42  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: Don't return "no quota" even
	  though current quota for user doesn't exist yet.

2006-06-16 08:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Crashfix in error
	  cases

2006-06-15 10:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-format.h, dbox-save.c: Added
	  save_time field into dbox mails.

2006-06-14 12:46  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-client.c: Fixes to dict proxy

2006-06-14 12:20  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-client.c: t_pop() calls were missing from some
	  error handling paths

2006-06-14 11:16  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-sql.c: Use sql_escape_string() instead of
	  str_escape()

2006-06-13 12:23  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.beta9

2006-06-13 12:23  Timo Sirainen <tss@iki.fi>

	* Makefile.am: Delete dovecot-config in distclean.

2006-06-13 11:26  Timo Sirainen <tss@iki.fi>

	* TODO: Updated

2006-06-13 09:10  Timo Sirainen <tss@iki.fi>

	* src/deliver/Makefile.am: Added mountpoint.o to unused objects
	  list

2006-06-12 16:03  Timo Sirainen <tss@iki.fi>

	* src/deliver/: Makefile.am, deliver.c: Changed hardcoded
	  /var/run/dovecot to PKG_RUNDIR.

2006-06-12 16:02  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated LDA's default auth_socket_path

2006-06-12 15:46  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated postmaster_address and hostname
	  setting descriptions.

2006-06-12 15:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Changed default postmaster_address to
	  @example.com

2006-06-12 12:46  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/mail-process.c: dovecot --exec-mail ext <binary path>
	  now reads the default settings from configuration file, puts them
	  to environment and executes the given binary.

2006-06-12 08:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-file.c, dbox-file.h,
	  dbox-mail.c, dbox-save.c, dbox-storage.h, dbox-sync-expunge.c,
	  dbox-sync-full.c, dbox-sync.c: Allow reading saved mails which
	  haven't been committed yet (ie. make quota plugin work).

2006-06-11 21:55  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Set PAM_TTY.

2006-06-11 21:40  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added protocol lda section.

2006-06-11 20:13  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf:
	  s/login_process_per_use/login_process_per_connection/

2006-06-11 20:12  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Moved around settings and added some main
	  groups to them, hopefully making it easier to find them.

2006-06-11 19:58  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Moved the socket listen example into auth
	  default instead of having its own auth block, which confused
	  people.

2006-06-11 19:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-private.h,
	  mail-index-view-sync.c, mail-index-view.c,
	  mail-transaction-log-append.c: We used "already synced log
	  positions in view" array to store locations of committed hidden
	  transactions. They however weren't really synced, which caused
	  some problems. Added a separate "hidden sync log positions" array
	  for them which is handled differently.

2006-06-11 18:14  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/passdb-pam.c: Don't call
	  pam_setcred() unless setcred=yes PAM passdb argument was given.

2006-06-11 17:51  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-subscribe.c: If tb-extra-mailbox-sep workaround was
	  enabled, subscribing was broken unless the namespace had empty
	  prefix.

2006-06-11 17:44  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: If running from inetd, don't try to open/close
	  listener sockets when receiving SIGHUP.

2006-06-11 17:34  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/: quota-dict.c, quota-dirsize.c, quota-fs.c,
	  quota-maildir.c, quota-private.h, quota-storage.c, quota.c,
	  quota.h: If size of the mail was known before saving started, we
	  allocated the quota twice for it.

2006-06-11 16:11  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-storage.c: Update quota when deleting a
	  mailbox.

2006-06-11 16:04  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-expunge.c: If mailbox_search_deinit() fails, we
	  leaked a bit of memory.

2006-06-11 15:00  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Starting pop3 processes from inetd
	  started actually imap processes after login.

2006-06-11 14:48  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Updates to
	  ssl_verify_client_cert: Check CRLs. If auth_verbose=yes, log
	  invalid sent certificates. If verbose_ssl=yes, log even the valid
	  certificates. When using the username from the certificate, use
	  CommonName.  Based on patch by HenkJan Wolthuis

2006-06-11 14:06  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-mail.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-util.c,
	  plugins/quota/Makefile.am, plugins/quota/quota-maildir.c: Add
	  ",S=size" to maildir filenames when quota plugin is loaded with
	  Maildir++ backend.

2006-06-11 12:51  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-pam.c, passdb.h: If password is
	  expired, give "Password expired" error. Currently works only with
	  PAM. Also added "unknown user" PAM return value handling.

2006-06-11 12:11  Timo Sirainen <tss@iki.fi>

	* src/auth/db-sql.c: s/ldap/sql/ in error message

2006-06-11 12:08  Timo Sirainen <tss@iki.fi>

	* INSTALL: Removed most of the content and added links to Wiki
	  instead.

2006-06-11 12:07  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't enable GSSAPI support by default

2006-06-11 11:49  Timo Sirainen <tss@iki.fi>

	* configure.in: Whitespace cleanup for --help

2006-06-11 11:37  Timo Sirainen <tss@iki.fi>

	* src/deliver/: auth-client.c, auth-client.h, deliver.c: Don't try
	  to change uid/gid to the same one it already is.

2006-06-11 11:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c: If cache field's size is
	  wrong, rebuild the cache file instead of crashing sometimes
	  later.

2006-06-11 11:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: If file begins with
	  ".nfs", stat() it always to see if it's a directory since it may
	  be a temporary file created by kernel.

2006-06-11 11:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/deliver/Makefile.am,
	  src/deliver/auth-client.c, src/deliver/auth-client.h,
	  src/deliver/deliver.c, src/deliver/deliver.h,
	  src/deliver/duplicate.c, src/deliver/duplicate.h,
	  src/deliver/mail-send.c, src/deliver/mail-send.h,
	  src/deliver/smtp-client.c, src/deliver/smtp-client.h: Moved all
	  the non-Sieve code from dovecot-lda in here and rewrote parts of
	  it to be cleaner. The Sieve code can now be run as a plugin from
	  dovecot-sieve CVS module.

2006-06-11 11:07  Timo Sirainen <tss@iki.fi>

	* .cvsignore, Makefile.am, dovecot-config.in, dovecot-config.in.in:
	  dovecot-config contains now module_dir.

2006-06-09 11:04  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: If cert/key directories don't exist, exit
	  immediately instead of just priting the errors.

2006-06-09 10:05  Timo Sirainen <tss@iki.fi>

	* AUTHORS: Some updates

2006-06-09 10:03  Timo Sirainen <tss@iki.fi>

	* src/lib/primes.c: Minor coding style changes. Removed GLib
	  copyrights as the only thing left from the original code is the
	  prime number list.

2006-06-08 21:23  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Convert subscriptions
	  also.

2006-06-08 21:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-format.h: Changed subscriptions
	  filename to just "subscriptions".

2006-06-08 20:25  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: Get the quota limits from plugin
	  parameters instead of from the dictionary itself. Added support
	  for message count limits. Other cleanups.

2006-06-08 20:22  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota.c: Don't return NULL error so we don't
	  crash in some systems.

2006-06-08 19:26  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/istream-header-filter.c,
	  lib-storage/index/mbox/istream-raw-mbox.c: Handle i_stream_stat()
	  better.

2006-06-08 18:52  Timo Sirainen <tss@iki.fi>

	* src/master/: main.c, master-settings.c: If ssl_listen setting was
	  empty in config file, startup failed with "Can't resolve address"
	  error.

2006-06-08 18:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Crashfix

2006-06-08 18:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-save.c, dbox-uidlist.c,
	  dbox-uidlist.h: If mail's size is known beforehand, select the
	  dbox file so that the saving won't grow file larger than
	  dbox_rotate_size.

2006-06-08 16:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: Saving to multiple files
	  within a transaction was broken.

2006-06-08 16:15  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Create destination INBOX
	  always uppercased.

2006-06-08 16:13  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Using file_dotlock_touch() caused Dovecot
	  to think the dotlock had been modified by someone else.

2006-06-08 15:25  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/Makefile.am: Added library dependencies to
	  work correctly for convert-tool.

2006-06-08 14:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: dbox_rotate_size
	  checking was wrong.

2006-06-07 09:05  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-fetch.c: If FETCH fails because client disconnects
	  in the middle of it, return "Disconnected" error message instead
	  of "unknown error".

2006-06-05 20:25  Timo Sirainen <tss@iki.fi>

	* src/: login-common/sasl-server.c, login-common/sasl-server.h,
	  imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: IMAP: Reply with tagged BAD if
	  authentication is aborted because client sent "*" or something
	  else that was a client error.

	  If authentication failed for any reason, the error message was
	  always "Authentication failed". In case of client errors or if
	  auth process gave an error message, it should have been that
	  instead.

2006-06-02 08:39  Timo Sirainen <tss@iki.fi>

	* configure.in: Check for existence of PQescapeStringConn() in
	  PostgreSQL library. Forgot to commit earlier.

2006-05-31 13:59  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: Reversed last change. Instead
	  handle DH_generate_parameters() call's failure.

2006-05-31 13:54  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: Give a nicer error message if
	  i2d_DHparams() returns 0, which apparently it does in some cases.

2006-05-31 13:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: With some NFS
	  implementation DELETE failed if ..DOVECOT-TRASHED directory
	  already existed

2006-05-31 13:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  dbox/dbox-storage.c: Close index files before trying to unlink
	  the index directory

2006-05-31 11:03  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-cache.c, auth-request.c, auth-request.h,
	  db-ldap.c, db-ldap.h, db-passwd-file.c, db-sql.c, passdb-sql.c,
	  userdb-sql.c: Escape SQL strings using sql_escape_string(). Fixes
	  the problems with PostgreSQL.

2006-05-31 11:02  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-pgsql.c, driver-sqlite.c,
	  sql-api-private.h, sql-api.c, sql-api.h: Added
	  sql_escape_string()

2006-05-30 15:10  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Use array instead of buffer for
	  storing connections.

2006-05-30 13:35  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-internal.h, istream.h, nfs-workarounds.h:
	  Include <sys/stat.h> before using struct stat, because some
	  systems may use a macro to define struct stat to something else.

2006-05-30 13:14  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Added assert against NULL reason for
	  client_disconnect().

2006-05-30 13:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Don't return NULL error
	  messages.

2006-05-30 12:20  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/: acl-backend-vfile.c, acl-cache.c, acl-cache.h:
	  Don't check ACL file's timestamp changes more often than once in
	  a second.

2006-05-30 12:18  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c: NULL-terminate the parsed
	  rights

2006-05-30 08:18  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: Trying to use subsequent
	  authentication crashed.

2006-05-28 23:43  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: We were caching the EOF block wrongly in
	  some situations.

2006-05-28 21:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Memory leak fix for last
	  update and some other cleanups

2006-05-28 21:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-sync-update.c, mail-cache.c,
	  mail-index-private.h, mail-index-sync-update.c,
	  mail-index-sync.c, mail-index.c: We were updating index->map also
	  when syncing views.

2006-05-28 20:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: When extension data is being
	  reset, recreate the index file to make sure that other processes
	  notice the reset_id change. Fixes cache file corruption
	  complaints around the time it's being compressed.

2006-05-28 19:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c: Removing and resetting
	  keywords could have operated on wrong file's keyword list.

2006-05-18 21:31  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: BODYSTRUCTURE -> BODY
	  translation was missing CRLF after literal.

2006-05-18 10:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-ext.c,
	  mail-index-sync-keywords.c, mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-sync.c: If we're
	  synchronizing a view (and not index itself) from transaction log,
	  give a different error message and don't mark the file corrupted.

2006-05-18 09:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: If syncing from transaction log
	  fails, fallback to re-reading the index file (and more
	  importantly, try to avoid crashing in assert..)

2006-05-18 09:50  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: If connection closes while appending, we
	  crashed in some situations.

2006-05-18 09:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-format.h, dbox-list.c,
	  dbox-storage.c: Renamed Mails -> dbox-Mails to make it less
	  likely to conflict with user-created mailbox.

2006-05-18 09:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-keywords.c: Fix for handling
	  keywords

2006-05-13 10:28  Timo Sirainen <tss@iki.fi>

	* README: Added a note about using mailing list for questions.

2006-05-13 10:14  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h: Added support for SASL binding.
	  Patch by Geert Jansen

2006-05-12 18:08  Timo Sirainen <tss@iki.fi>

	* src/pop3/Makefile.am: Link mountpoint.o manually to get
	  mountpoint_get() included into binary, so quota plugin can use
	  it.

2006-05-12 17:54  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Fixes to compiling with DEBUG

2006-05-12 13:26  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: Don't cause
	  whitespace offsets to break if some headers before it were
	  removed (eg. extra X-IMAPbase headers)

2006-05-12 13:00  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/: master-settings.c, master-settings.h: Fix for
	  non-C99 compilers.

2006-05-12 09:13  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.beta8

2006-05-12 08:21  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/mail-process.c: NFS check wasn't working if chrooting
	  was used.

2006-05-12 08:12  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Don't allow "."
	  and ".." mailbox names/masks.

2006-05-11 13:18  Timo Sirainen <tss@iki.fi>

	* src/imap/: Makefile.am, cmd-authenticate.c, cmd-login.c,
	  commands.c, commands.h: Removed LOGIN and AUTHENTICATE command
	  handlers completely. They're only valid in non-authenticated
	  state and there's really no point in having them here anymore.

2006-05-11 11:47  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: When checking if we want to override
	  dotlocks, don't use the file-to-be-locked file's mtime if it's
	  higher than current time.

2006-05-10 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Fixed "Unrecognized event" errors that
	  occurred with IO_ERROR. Patch by Vaclav Haisman

2006-05-10 15:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Keep track of write_atomic and
	  write_seq_first/last while copying memory mappings. This is
	  important with mmap_disable=yes because the maps can later be
	  written to index file, and if this information is wrong the file
	  is being updated wrong..

2006-05-10 13:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-mail.c, dbox-sync-full.c: fixes

2006-05-10 11:24  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: If dotlock creation timeouts, unlink()
	  the temp file we used

2006-05-10 11:23  Timo Sirainen <tss@iki.fi>

	* src/lib/sendfile-util.c: Linux's sendfile() returns 0 when remote
	  has closed connection. Convert it to EPIPE.

2006-05-10 10:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: fix

2006-05-10 10:46  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: base_size variable isn't really
	  needed in the pool when DEBUG isn't used.  With DEBUG enabled,
	  check when clearing the pool that the allocated memory is
	  completely cleared, ie. that no-one wrote out of bounds to it.

2006-05-10 10:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Fix

2006-05-10 09:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c: Don't allow accessing
	  Mails directory in any way, just return "Invalid mailbox name".

2006-05-10 07:36  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Read empty string settings as "",
	  not NULL.

2006-05-09 21:21  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: Minor cleanup: Switch hardcoded /etc/mnttab
	  in Solaris to use MNTTAB macro

2006-05-09 20:47  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: If PASS command is given
	  (after unsuccessful USER) with plaintext auth disabled, give
	  proper error message instead of "No username given".

2006-05-08 11:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	  MAIL_CACHE_FLAG_TEXT_PLAIN_7BIT_ASCII wasn't necessarily saved to
	  cache always

2006-05-08 11:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Strings should be freed with
	  str_free(), not p_free().

2006-05-08 08:18  Timo Sirainen <tss@iki.fi>

	* TODO: Update

2006-05-05 15:07  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-connection.c: If authentication client does
	  something bad, don't crash the whole process (clean
	  NULL-pointer-write crash).

2006-05-05 14:53  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-client.c: Don't send extra TABs to auth
	  worker server, they break it.

2006-05-05 14:21  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Fix for building without modules

2006-05-03 22:58  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, deliver/deliver.c, dict/main.c, imap/main.c,
	  login-common/main.c, master/main.c, pop3/main.c: Use
	  lib_signals_ignore() for signals we really want ignored.

2006-05-03 22:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: lib-signals.c, lib-signals.h: And
	  s/lib_signals_ignore_signal/lib_signals_ignore/

2006-05-03 22:54  Timo Sirainen <tss@iki.fi>

	* src/lib/: lib-signals.c, lib-signals.h: Added
	  lib_signals_ignore_signal() and made lib_signals_set_handler()
	  with NULL handler not restart syscall.

2006-05-03 22:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-save.c, dbox-sync.c,
	  dbox-sync.h: s/dbox_sync_if_changed/dbox_sync_is_changed/

2006-05-03 22:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c: Keep track of recent
	  flags.

2006-05-03 22:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: If only changes were recent-flag
	  updates, we didn't write them to index.

2006-05-03 20:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-private.h,
	  mail-cache.c: Don't compress cache file if it was just compressed
	  by another process.

2006-05-03 19:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: When removing
	  recent-flags with mmap_disable, the flags weren't actually
	  removed which caused broken recent counter errors. Also added
	  more checks not to update counters if they're already known to be
	  broken.

2006-05-03 18:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Fix

2006-05-02 22:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-view-private.h,
	  mail-index-view-sync.c, mail-index-view.c: Index header's
	  seen/recent/deleted counters weren't always correct after syncing
	  a view. This caused some problems with recent SEARCH
	  optimizations, eg. EXPUNGE not always working.

2006-05-02 22:05  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Fixes to updating
	  keywords

2006-05-02 20:11  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: When requesting quota
	  resource, don't return it if it's unlimited. Also treat 0 quota
	  limits also in plugin parameters as unlimited.

2006-05-02 20:01  Timo Sirainen <tss@iki.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c: Don't add extra
	  spaces to reply if some of the resources aren't really found.

2006-05-02 19:50  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: Built-in pop3_logout_format default wasn't
	  updated.

2006-05-02 13:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: Offset update fix

2006-05-02 11:11  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-storage.h, maildir-sync.c, maildir-uidlist.c,
	  maildir-uidlist.h: Adding mail to index while saving it had a
	  race condition. Fixing it required a bit larger changes. Switched
	  uidlist/index locking order so that uidlist is now locked first.

2006-05-02 11:04  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-update.c,
	  mail-index.c: mmap_disable: When syncing in-memory index from
	  transaction log, we didn't skip external transactions which were
	  already been in our in-memory mapping, causing "Append with UID
	  n, but next_uid = m" errors.

2006-05-02 08:56  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/acl/acl-backend-vfile.c: Letter ACLs were wrong.

2006-04-27 13:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c: And more generic error
	  fix..

2006-04-27 13:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-mail.c, dbox-sync.c: Error
	  fixes

2006-04-27 12:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Fixes

2006-04-27 12:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-sync-expunge.c, dbox-uidlist.c:
	  Error message fixes

2006-04-27 12:30  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/Makefile.am: Install the quota plugin also for
	  POP3.

2006-04-27 12:29  Timo Sirainen <tss@iki.fi>

	* src/pop3/: common.h, main.c: hook_mail_storage_created: Make it
	  compatible with imap and lda by not taking a pointer to pointer
	  to storage.

2006-04-27 12:26  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Don't validate uid/gid when executing
	  imap for dump-capability

2006-04-27 11:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Fix

2006-04-27 10:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-expunge.c: Fixes / cleanup

2006-04-27 08:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: More fixes.

2006-04-25 13:40  Timo Sirainen <timo.sirainen@movial.fi>

	* src/: lib/nfs-workarounds.c, lib/nfs-workarounds.h,
	  lib-index/mail-index.c, lib-index/mail-transaction-log.c,
	  lib-storage/index/maildir/maildir-uidlist.c: Added
	  nfs_safe_stat() to transparently work around ESTALE with stat().

2006-04-24 13:18  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/master-settings.c: dump-capability wasn't working if
	  dovecot wasn't run as root.

2006-04-24 09:49  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-maildir.c: Accidentally reverted
	  0-is-unlimited-quota change in last commit.

2006-04-24 09:34  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-search.c: Fix for last changes. We
	  didn't handle properly non-sequential messageset ranges.

2006-04-24 09:19  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-index/mail-index-view-sync.c: When beginning to sync from
	  old view, don't keep the old header completely, because there may
	  have been some important new changes. Copy only the message
	  counts and such manually now. Fixes an error message when
	  sometimes adding keywords.

2006-04-24 09:17  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-index/mail-index.c: Added assert

2006-04-24 09:17  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-index/mail-index-transaction.c: Fixed crash while
	  updating keywords (broken by recent changes).

2006-04-22 09:34  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: Fixed a buffer overflow if
	  maildirsize was over 5120 bytes long. Luckily almost no-one used
	  maildir++ quota yet and the bug is highly unlikely to be
	  exploitable anyway.

2006-04-22 09:18  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Fixed last broken commit

2006-04-21 15:14  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: NFS check should be done only once at
	  startup, not every time.

2006-04-21 14:09  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-maildir.c: 0 values in maildirsize means
	  unlimited.

2006-04-21 13:33  Timo Sirainen <tss@iki.fi>

	* src/imap/Makefile.am: Link mountpoint.o manually to get
	  mountpoint_get() included into binary, so quota plugin can use
	  it.

2006-04-21 11:23  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: If mail environment is "", don't use
	  it.

2006-04-21 11:00  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Don't crash in NFS check if using mail
	  path autodetection

2006-04-20 19:50  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Fixed last change: added missing '/' back

2006-04-20 16:56  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Changed example dovecot-auth-client path
	  also to /var/run/dovecot

2006-04-20 16:18  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Changed auth-master example socket to
	  /var/run/dovecot/auth-master again.  Nowadays /var/run/dovecot is
	  world-rx so it's a better place for it.

2006-04-20 16:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-sync-expunge.c, dbox-sync.c,
	  dbox-uidlist.c: Fixes

2006-04-20 16:04  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: file_dotlock_get_lock_path() doesn't
	  return the path from data stack anymore. Also changed the
	  internal logic to use less data stack as well.

2006-04-20 16:02  Timo Sirainen <tss@iki.fi>

	* src/lib/seq-range-array.c: Fix for seq_range_array_remove()

2006-04-20 14:15  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/dbox/dbox-mail.c: If dbox mail is lost,
	  synchronize the dbox instead of just refreshing index (it's not
	  enough).

2006-04-20 14:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: If we sorted appended
	  messages, we weren't sorting extensions and keywords so they were
	  mapped to wrong messages (dbox-only problem, keywords not yet
	  fixed by this change).

2006-04-20 14:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c: Fixed memory leaks

2006-04-18 18:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c: Fixes

2006-04-18 14:49  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c: Don't assert-crash
	  if first mail is expunged and we're doing a full sync.

2006-04-17 19:40  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c: If storage separator is '/',
	  it's possible that we're trying to open a directory as an ACL
	  file. If that happens, use dir/.DEFAULT file as the ACL file
	  instead.

2006-04-17 17:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: If maildir is
	  readonly, don't complain about rename() failing to move mails
	  from new/ to cur/.

2006-04-17 16:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-file.c: Don't try to call utime()
	  for mbox if it's readonly, it'll just fail.

2006-04-14 18:20  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, login-common/common.h,
	  login-common/main.c, master/login-process.c,
	  master/mail-process.c, master/mail-process.h, master/main.c,
	  master/master-settings.c, master/master-settings.h,
	  pop3-login/client-authenticate.c, imap/main.c: If we have plugins
	  set and imap_capability unset, figure out the IMAP capabilities
	  automatically by running imap binary at startup. The generated
	  capability list isn't updated until Dovecot is restarted
	  completely, so if you add or remove IMAP plugins you should
	  restart.

2006-04-14 12:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: index/index-search.c, index/index-storage.h,
	  mail-storage-private.h, index/mbox/mbox-storage.c,
	  index/dbox/dbox-storage.c, index/maildir/maildir-storage.c:
	  Optimized searching a bit for cases where we can restrict search
	  range by simply looking at sequence sets. Also optimized some
	  deleted/seen flag searches where no results would be found. Added
	  search_next_update_seq() virtual method which allows plugins to
	  restrict the search range (eg.  allowing indexed text search
	  plugins).

2006-04-14 11:28  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: Clear mountpoint struct even in error
	  cases.

2006-04-14 11:26  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: mtab path is /etc/mnttab with Solaris

2006-04-14 11:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-save.c, mbox-storage.c,
	  mbox-sync.c: If mailbox was opened with readonly-flag, don't
	  really force it. Fixes EXAMINE box + APPEND box.

2006-04-14 11:00  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: quotactl() parameters were
	  backwards for BSDs and AIX.

2006-04-14 10:55  Timo Sirainen <tss@iki.fi>

	* src/dict/Makefile.am: Added RAND_LIBS

2006-04-14 10:52  Timo Sirainen <tss@iki.fi>

	* src/master/: mail-process.c, master-settings.c,
	  master-settings.h: Unless nfs_check=no or mmap_disable=yes, check
	  for the first login if the user's index directory exists in NFS
	  mount. If so, refuse to run. This is done only on first login to
	  avoid constant extra overhead.

2006-04-14 10:27  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: memset() the returned structure, just in
	  case.

2006-04-14 10:27  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/: quota-fs.c, quota-fs.h: Use mountpoint_get()
	  instead of doing it ourself.

2006-04-14 10:26  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, mountpoint.c, mountpoint.h: Added
	  mountpoint_get() for looking up a path's mount point information.

2006-04-14 10:22  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-listener.c, auth-master-listener.h,
	  main.c: Deinitialization crashfixes.

2006-04-14 08:50  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-client.c: Don't crash if no extra arguments
	  were given to auth worker request.

2006-04-13 21:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: MBOX_MIN_INDEXED_SIZE
	  -> MBOX_MIN_INDEX_SIZE so it actually works

2006-04-13 20:25  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, pop3/main.c: Destroy client connection at
	  deinit before unloading modules.

2006-04-13 19:31  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dirsize.c: When using multiple
	  namespaces, don't count each of them if they're using the same
	  storage backend.

2006-04-13 19:15  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dirsize.c: Count INBOX also if it's
	  outside the default mail directory.

2006-04-13 11:48  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: If LDAP library didn't have ldap_initialize()
	  function, we always complained about the URI settings.

2006-04-13 00:56  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: pop3_lock_session setting wasn't
	  transferred to pop3 process

2006-04-12 20:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: Crashfix when saving
	  fails before even opening the file

2006-04-12 19:40  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/dbox/dbox-storage.c,
	  master/mail-process.c: dbox settings in config file didn't work,
	  and the defaults were also a bit broken.

2006-04-12 19:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-file.c, dbox-mail.c,
	  dbox-uidlist.c: dbox fixes

2006-04-12 18:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: Truncate dbox file
	  immediately if saving is aborted.

2006-04-12 17:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-expunge.c: Removed
	  accidentally committed debugging code

2006-04-12 16:57  Timo Sirainen <tss@iki.fi>

	* src/lib/seq-range-array.c: seq_range_array_remove(): Don't crash
	  if array is empty.

2006-04-12 16:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: Makefile.am, dbox-format.h,
	  dbox-list.c, dbox-storage.c, dbox-storage.h: Moved dbox data
	  structures to dbox-format.h which can be easily included from
	  elsewhere.

2006-04-12 16:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: ftruncate() the file
	  after mail has been appended. We might have reused some existing
	  aborted mail in there.

2006-04-12 16:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c: When creating index
	  directories, create also the Mails directory.

2006-04-12 16:04  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Don't crash if client disconnects while
	  appending message.

2006-04-12 14:36  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	  src/auth/auth.h, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  auth_username_format setting.

2006-04-12 14:04  Timo Sirainen <tss@iki.fi>

	* src/lib/: module-dir.c, module-dir.h: Allow giving module names
	  in non-basename form.

2006-04-12 11:44  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: And 1.0.beta7..

2006-04-12 11:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/main.c, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3/main.c: Added shutdown_clients setting to control if
	  existing imap/pop3 processes should be killed when master is.

2006-04-12 11:27  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Master login fixes, PLAIN authentication
	  was still broken..

2006-04-12 08:03  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0.beta6.

2006-04-12 07:39  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/lib/var-expand.c: %M modifier returns
	  string's MD5 sum. Patch by Ben Winslow

2006-04-12 07:37  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client.c: Add a space between POP3 greeting and
	  APOP challenge

2006-04-12 07:35  Timo Sirainen <tss@iki.fi>

	* src/lib/var-expand.c: %U modifier was actually lowercasing the
	  string. Patch by Ben Winslow

2006-04-10 18:03  Timo Sirainen <tss@iki.fi>

	* configure.in: And add -lm also to LIBS when checking if
	  -lmysqlclient works..

2006-04-10 17:55  Timo Sirainen <tss@iki.fi>

	* configure.in: libmysqlclient needs also -lm

2006-04-09 22:10  Timo Sirainen <tss@iki.fi>

	* INSTALL: Updated GNUTLS information.

2006-04-09 19:37  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c: Make sure errno is restored when
	  exiting SIGRT signal handler.

2006-04-09 17:29  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: Fixed non-plaintext password lookups from
	  LDAP. Patch by Lior Okman.

2006-04-09 17:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-lock.c: fcntl locking: Don't
	  print error if we're only trying to lock (instead of waiting) and
	  it failed.

2006-04-09 15:50  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c,
	  src/master/master-settings.h, src/pop3/client.c,
	  src/pop3/common.h, src/pop3/main.c: Added pop3_lock_session
	  setting.

2006-04-09 15:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage.h, index/index-storage.c,
	  index/index-storage.h, index/dbox/dbox-uidlist.c,
	  index/maildir/maildir-storage.c, index/maildir/maildir-sync.c,
	  index/maildir/maildir-uidlist.c, index/mbox/mbox-storage.c,
	  index/mbox/mbox-storage.h: Added MAILBOX_OPEN_KEEP_LOCKED flag to
	  mailbox opening and implemented it for mbox and maildir. It keeps
	  the mailbox locked the whole time until mailbox_close() is
	  called.

2006-04-09 15:08  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Fixed calculation overflows

2006-04-09 14:48  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.h: IO_ERROR and IO_NOTIFY had conflicting values.

2006-04-09 14:48  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, pop3/main.c: When master dies (by closing log
	  file descriptor), kill ourself also.

2006-04-09 14:36  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, login-process.c: If master process
	  runs out of file descriptors, try to handle it more nicely than
	  getting into infinite loop.

2006-04-09 14:00  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: If %h is used but home directory isn't
	  given by userdb, use
	  "/HOME_DIRECTORY_USED_BUT_NOT_GIVEN_BY_USERDB" as the home
	  directory.

2006-04-09 13:54  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, userdb-prefetch.c: Allow prefetch
	  userdb to exist nicely with other userdbs.

2006-04-09 13:43  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated mechanism list. Added link to
	  MasterPassword in wiki.

2006-04-09 12:38  Timo Sirainen <tss@iki.fi>

	* configure.in: Unbreak last sqlite change

2006-04-09 12:25  Timo Sirainen <tss@iki.fi>

	* configure.in: Print the SQL drivers we're building.

2006-04-09 12:21  Timo Sirainen <tss@iki.fi>

	* configure.in: Added lib64 directory to mysql/pgsql checks.
	  Removed all special lib/include directory handling from SQLite
	  checks (it should usually exist in default paths I think).

2006-04-09 12:09  Timo Sirainen <tss@iki.fi>

	* configure.in: SQLite include/libdir fixing

2006-04-09 11:53  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: The login and master usernames were
	  reversed when using master_user_separator (now the order is
	  UW-IMAP compatible).

2006-04-09 11:34  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Master login attempts weren't logged if
	  no master passdbs were defined.

2006-04-09 11:07  Timo Sirainen <tss@iki.fi>

	* src/master/: main.c, master-settings.c, master-settings.h: Added
	  -a and -n parameters to dovecot to dump all/nondefault settings.
	  A bit ugly code, but it'll do until the whole config handling
	  gets rewritten in Dovecot 2.0.

2006-04-09 09:29  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: Don't crash if passwd-file has entries
	  without passwords.

2006-04-08 08:44  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If master login username is the same as
	  the normal username, we don't want to treat it as master user.
	  Fixes authentication with some clients.

2006-04-07 07:23  Timo Sirainen <tss@iki.fi>

	* src/auth/auth.c: auth_verbose_debug_passwords=yes always sets now
	  auth_verbose_debug=yes, and auth_verbose_debug=yes also sets
	  auth_verbose=yes.

2006-04-06 19:46  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-maildir.c: Fixes. Added storage and
	  messages parameters to quota plugin parameter. If given, they
	  specify the master quota limits, so if maildirsize has different
	  limits Dovecot will replace them. If maildirsize doesn't exist
	  and Dovecot doesn't have limits, Maildir++ quota is disabled for
	  the user.

2006-04-06 15:44  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: Return value of get_resource()
	  was wrong, which caused quota reporting not to work.

2006-04-04 08:42  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 1.0.beta5 released

2006-04-04 08:33  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Reverted back for now.

2006-04-02 17:42  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: stat() the mount point paths
	  instead of the devices to find out where the mount point is.

2006-04-02 17:02  Timo Sirainen <tss@iki.fi>

	* NEWS: update

2006-04-02 16:52  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 1.0.beta4 released

2006-04-02 16:42  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Rewrite. Hopefully works
	  better.

2006-04-02 16:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: If mailbox is
	  opened in non-readonly state and there are mails in new/, make
	  sure they get moved to cur/ so that their recent-state gets
	  removed.

2006-04-02 10:49  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client.c: Same STARTTLS flush callback fix as with
	  imap-login.

2006-04-02 10:48  Timo Sirainen <tss@iki.fi>

	* src/imap-login/client.c: Output flush handler wasn't unset after
	  STARTTLS, which could have caused STARTTLS to be done again (it
	  was unlikely to be ever set though).

2006-04-02 10:46  Timo Sirainen <tss@iki.fi>

	* src/login-common/login-proxy.c: Show client IP properly also with
	  SSL connections.

2006-04-02 10:12  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: If output flush callback closed the
	  stream, don't add another flush I/O handler to it even if there
	  would still be something to flush.

2006-04-02 09:19  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Use mail_storage_parse_env(), even though
	  this code doesn't even compile now..

2006-04-02 09:18  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c,
	  src/lib-storage/mail-storage.c: Changed the default lock_method
	  back to fcntl. flock seems to be broken in some systems..

2006-04-01 10:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c: Hide also "." and ".."
	  when listing mboxes

2006-04-01 09:57  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/pop3/client.c,
	  src/master/master-settings.c: Replaced %T and %R with %p and %b.
	  %R was already used by string-reversion, so uppercase letters
	  should now be reserved for modifiers to avoid this in future..

2006-04-01 09:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-list.c, mbox-storage.c,
	  mbox-storage.h: Don't hide all .files when listing mboxes, only
	  .imap and .subscriptions.  Moved the hardcoded ".imap" strings
	  into a define.

2006-04-01 09:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-list.c,
	  maildir-storage.c, maildir-storage.h: When deleting a maildir,
	  rename it to ..DOVECOT-TRASHED, and assume only that directory to
	  be safe to be deleted, instead of all ..dirs. When deleting
	  maildir with absolute path, don't do renaming at all but delete
	  it directly.

2006-04-01 09:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-lock.c: If we can't lock mbox
	  file, mark those errors as temporary so LDA treats them as
	  temporary errors instead of bouncing.

2006-03-31 21:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-file.c, dbox-storage.h,
	  dbox-sync-expunge.c, dbox-sync.c, dbox-uidlist.c, dbox-uidlist.h:
	  Fixes and cleanups.

2006-03-31 21:19  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Added some t_push/t_pop calls

2006-03-31 21:19  Timo Sirainen <tss@iki.fi>

	* src/lib/seq-range-array.c: Removal didn't work properly from
	  beginning/end if the range contained only a single sequence.

2006-03-31 15:02  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: Don't break if password contains '['
	  characters.

2006-03-31 14:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c: Don't crash with "can't
	  allocate 0 bytes of memory" if there are zero fields in cache
	  file.

2006-03-30 10:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-sync-expunge.c, dbox-sync.c,
	  dbox-sync.h, dbox-uidlist.c: Some fixes to get dbox code working
	  better. Still needs some work though..

2006-03-27 12:54  Timo Sirainen <timo.sirainen@movial.fi>

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	  src/auth/auth.h, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  auth_master_user_separator setting which allows giving the master
	  username inside the normal username.

2006-03-25 11:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Keep \Seen flags
	  privately only in indexes with shared mailboxes.

2006-03-25 10:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Saving (or copying)
	  multiple mails at a time caused all but the first mail to be left
	  to tmp/.

2006-03-25 10:32  Timo Sirainen <tss@iki.fi>

	* src/auth/auth.c: Changed "no user databases" error to be
	  hopefully more easier to understand.

2006-03-25 10:22  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/auth/auth-request.c, src/auth/auth.c, src/auth/auth.h:
	  Removed master_no_passdb setting. Added pass setting which can be
	  used to do the same thing, and other things. Now setting pass=yes
	  to a passdb continues to next passdb if the lookup succeeded.
	  This allows eg. requiring the user to be in multiple passdbs, or
	  doing a username conversion before running the actual userdb,
	  etc.

2006-03-25 10:19  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-passwd-file.c, db-passwd-file.h: Allow empty
	  uid/gid fields, they're required if we want to set extra fields
	  for passdb. Also removed some unused code.

2006-03-25 10:10  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: Timers weren't called always properly when they
	  should have.

2006-03-25 09:25  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/randgen.c: If /dev/urandom didn't exist and
	  we used OpenSSL's random number generator, it wasn't seeded
	  properly at startup. Patch by Vilmos Nebehaj.

2006-03-25 08:08  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Added more debugging information for
	  handling unexpected events. Patch by Vclav Haisman

2006-03-07 14:10  Timo Sirainen <timo.sirainen@movial.fi>

	* doc/auth-protocol.txt: Fixed outdated information: ssl-valid-cert
	  -> valid-client-cert

2006-03-06 21:32  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added ACL plugin comments and updated quota
	  comments.

2006-03-06 21:20  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c: Global ACL dir is now
	  optional.

2006-03-06 20:34  Timo Sirainen <tss@iki.fi>

	* src/: pop3/client.c, pop3/client.h, pop3/commands.c,
	  imap/client.c, imap/client.h, imap/cmd-append.c, imap/cmd-idle.c,
	  imap/cmd-logout.c: Log a line when IMAP client disconnects with a
	  reason why it happened.  Changed the reason strings also a bit
	  with POP3.

2006-03-06 20:13  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: cleanup

2006-03-06 19:05  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/: maildir-mail.c, maildir-save.c,
	  maildir-storage.h: Support accessing saved mails that haven't
	  been committed yet (fixes quota for maildir).

2006-03-06 19:04  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-maildir.c: Fixes to updating maildirsize.

2006-03-06 18:16  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/: maildir-copy.c, maildir-save.c,
	  maildir-storage.c, maildir-storage.h, maildir-transaction.c:
	  Merged save-copying and hardlink-copying code so that
	  hardlink-copying updates indexes immediately.

2006-03-06 18:15  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/maildir-util.c: If maildir_do()
	  failed with "racing" error, return -1.

2006-03-06 18:13  Timo Sirainen <timo.sirainen@movial.fi>

	* src/imap/cmd-copy.c: mailbox_copy() might fail because mail was
	  expunged. Treat that case differently.

2006-03-06 18:13  Timo Sirainen <timo.sirainen@movial.fi>

	* src/imap/namespace.c: Add MAIL_STORAGE_FLAG_SHARED_NAMESPACE for
	  private namespaces.

2006-03-06 16:42  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/maildir-mail.c: Cleanup

2006-03-06 15:48  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/: quota-dirsize.c, quota-fs.c, quota-maildir.c,
	  quota-private.h, quota.c: Cleanups.

2006-03-06 10:31  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/: Makefile.am, quota-dict.c, quota-dirsize.c,
	  quota-maildir.c, quota-private.h, quota.c: Maildir++ quota
	  support.

2006-03-06 10:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: Added t_push/t_pop

2006-03-01 09:14  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/: imap-quota/imap-quota-plugin.c, quota/quota-dict.c,
	  quota/quota-dirsize.c, quota/quota-fs.c, quota/quota-plugin.c,
	  quota/quota-private.h, quota/quota-storage.c, quota/quota.c,
	  quota/quota.h, trash/trash-plugin.c: Quota API redesign. Still
	  not perfect, but better than before. Quota backends no longer
	  need to be told where the mails exist. fs backend doesn't work
	  correctly with multiple partitions (if you've multiple
	  namespaces).

2006-02-28 12:38  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/acl/: acl-api-private.h, acl-api.c,
	  acl-backend-vfile.c, acl-backend.c, acl-cache.c, acl-cache.h,
	  acl-storage.c: Don't keep acl_objects permanently in memory.
	  Moved cache validity information into cache records. Some other
	  cleanups and fixes.

2006-02-28 08:36  Timo Sirainen <timo.sirainen@movial.fi>

	* configure.in, src/plugins/Makefile.am: Added acl.

2006-02-28 08:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added link to QuickConfiguration.

2006-02-28 07:50  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added notes about changing ports and about
	  /etc/pam.d/dovecot

2006-02-28 07:42  Timo Sirainen <tss@iki.fi>

	* Makefile.am: Removed dovecot.spec*

2006-02-27 18:46  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/: auth-request.c, auth-request.h: Added "allow_nets"
	  extra field. If set, the user can log in only from within the
	  given networks (hope the code is correct...)

2006-02-27 16:30  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/acl/: .cvsignore, Makefile.am, acl-api-private.h,
	  acl-api.c, acl-api.h, acl-backend-vfile.c, acl-backend.c,
	  acl-cache.c, acl-cache.h, acl-mailbox.c, acl-plugin.c,
	  acl-plugin.h, acl-storage.c: Added initial support for ACLs.
	  Currently supports reading the ACLs from files. Since no proper
	  support for shared folders exist yet, this is mostly intended to
	  be used only for preventing users from fully accessing the
	  mailboxes they'd otherwise have full access to. It anyway does
	  support "master user" having different ACLs to mailboxes.

2006-02-27 16:21  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/: mail-storage-private.h, mail-storage.h,
	  index/dbox/dbox-list.c, index/maildir/maildir-list.c,
	  index/mbox/mbox-list.c: Moved mailbox_list_flags to struct
	  mailbox_list_context so plugins can see the flags more easily.

2006-02-27 16:14  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib/: strfuncs.c, strfuncs.h: Added strcmp_p and
	  bsearch_strcmp.

2006-02-26 12:15  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/password-scheme.c,
	  src/dict/main.c, src/imap/main.c, src/lib/module-dir.c,
	  src/lib/module-dir.h, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3/main.c: Replaced mail_use_modules and mail_modules
	  settings with mail_plugins and mail_plugin_dir. Now instead of
	  loading all plugins from the directory, you'll have to give a
	  list of plugins to load. If the plugin couldn't be loaded, the
	  process exits instead of just ignoring the problem (this is
	  important with ACL plugin).

2006-02-26 11:24  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-fetch-body.c, imap/imap-fetch.c,
	  imap/imap-fetch.h, lib-storage/index/index-mail.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-keywords.c: Memory leak fixes

2006-02-26 10:32  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-transaction-log.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/subscription-file/subscription-file.c: If we reach
	  the NFS_ESTALE_RETRY_COUNT, give an ESTALE error message as well.

2006-02-26 10:15  Timo Sirainen <tss@iki.fi>

	* src/: lib/Makefile.am, lib/nfs-workarounds.c,
	  lib/nfs-workarounds.h, lib-index/mail-index-private.h,
	  lib-index/mail-index.c, lib-index/mail-transaction-log.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/subscription-file/subscription-file.c: Renamed
	  safe-open.* to nfs-workarounds.*, safe_open() to nfs_safe_open()
	  and added a new global NFS_ESTALE_RETRY_COUNT which everyone uses
	  instead of defining their own.

2006-02-26 10:04  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-master-connection.c, auth/auth-worker-server.c,
	  auth/db-passwd-file.c, deliver/deliver.c, dict/dict-server.c,
	  imap/client.c, lib/istream.c, lib/istream.h, lib/ostream.c,
	  lib/ostream.h, lib-dict/dict-client.c, lib-dict/dict-sql.c,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-envelope.c,
	  lib-index/mail-cache-compress.c, lib-mail/message-body-search.c,
	  lib-settings/settings.c, lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/dbox/dbox-file.c,
	  lib-storage/index/dbox/dbox-sync-expunge.c,
	  lib-storage/index/dbox/dbox-uidlist.c,
	  lib-storage/index/maildir/maildir-keywords.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/mbox/mbox-file.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync-rewrite.c,
	  lib-storage/subscription-file/subscription-file.c,
	  login-common/login-proxy.c, login-common/master.c,
	  master/auth-process.c, master/log.c,
	  plugins/trash/trash-plugin.c, pop3/client.c, util/rawlog.c: Added
	  i_stream_destroy() and o_stream_destroy() and used them instead
	  of *_stream_unref() where possible. Fixes at least one problem
	  with io_remove() being called after socket was closed, which
	  caused problems with epoll.

2006-02-25 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: If connecting with UNIX socket, print
	  the UNIX socket path instead of (null).

2006-02-25 10:58  Timo Sirainen <tss@iki.fi>

	* configure.in: Removed dovecot.spec. It's not being kept
	  up-to-date anyway and it's probably broken for half the rpm based
	  distributions.

2006-02-25 10:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_open(): If index is
	  already open, return 1 instead of 0 so the caller won't think it
	  failed..

2006-02-25 09:24  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Compiler warning fix

2006-02-25 09:24  Timo Sirainen <tss@iki.fi>

	* configure.in: One more Q_QUOTACTL check fix..

2006-02-25 09:16  Timo Sirainen <tss@iki.fi>

	* configure.in: And fix for Q_QUOTACTL check..

2006-02-25 09:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c,
	  src/plugins/quota/quota-fs.h: Support Solaris's
	  ioctl(Q_QUOTACTL).

2006-02-25 08:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-search.c:
	  Last memory leak fix actually started crashing.

2006-02-24 17:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-file.c, dbox-keywords.c,
	  dbox-sync-expunge.c, dbox-sync.c: Fixes

2006-02-24 17:29  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Added comment

2006-02-24 17:27  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Define MNTTYPE_SWAP and
	  MNTTYPE_IGNORE ourself if they're not defined.

2006-02-24 16:42  Timo Sirainen <tss@iki.fi>

	* src/auth/mycrypt.c: Fixed AIX compile

2006-02-24 16:10  Timo Sirainen <tss@iki.fi>

	* configure.in: Unbreak last accidental change..

2006-02-24 16:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-file.c, dbox-mail.c,
	  dbox-storage.h, dbox-sync-expunge.c, dbox-sync.c, dbox-uidlist.c:
	  Fixes

2006-02-24 14:36  Timo Sirainen <tss@iki.fi>

	* configure.in: If size_t and ssize_t exist but we can't figure out
	  their type, don't redefine them.

2006-02-24 13:41  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-request.h: Digest-MD5 logins
	  didn't work if passdb changed username.

2006-02-24 12:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: If transaction log opening fails,
	  don't crash when trying to move it to memory.

2006-02-24 12:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Crashfix

2006-02-24 10:49  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb.h: And one more comma removal

2006-02-24 10:48  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.h: configure was
	  actually checking always only sys/quota.h. Also added jfs/quota.h
	  check for AIX.

2006-02-24 10:33  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't print error if pkg-config isn't found.

2006-02-24 10:24  Timo Sirainen <tss@iki.fi>

	* src/: lib-auth/auth-client.h, auth/auth-client-interface.h: More
	  comma removals

2006-02-24 10:20  Timo Sirainen <tss@iki.fi>

	* src/: lib-sql/sql-api.h, lib-ntlm/ntlm-types.h: Removed extra
	  commas from end of enum lists.

2006-02-24 10:05  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: If no realms are given in
	  configuration file, advertise an empty realm. Also if realms are
	  given and client sends an invalid realm, write the realm to log.

2006-02-23 18:25  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/index-search.c,
	  lib-index/mail-index-sync.c, lib-index/mail-index-view-sync.c:
	  Memory leak fixes

2006-02-22 16:02  Timo Sirainen <timo.sirainen@movial.fi>

	* src/: plugins/quota/quota-dict.c, plugins/quota/quota-dirsize.c,
	  plugins/quota/quota-fs.c, plugins/quota/quota-private.h,
	  plugins/quota/quota-storage.c, plugins/quota/quota.c,
	  plugins/quota/quota.h, lib-storage/mail-copy.c,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/dbox/dbox-save.c,
	  lib-storage/index/dbox/dbox-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.h, imap/cmd-append.c:
	  mailbox_save_init() supports now returning failure. Quota plugin
	  now checks if mail is too large in mailbox_save_init() hook.
	  APPEND fails before giving "+ OK" reply if mailbox_save_init()
	  failed.

	  Also fixed some APPEND failure cases where the next command was
	  eaten away.

2006-02-22 15:48  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib/module-dir.c: Modules were loaded in inverse order..

2006-02-22 15:13  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/auth-request.c: Multiple password database error prints
	  now the passdb name that caused it.

2006-02-22 14:52  Timo Sirainen <timo.sirainen@movial.fi>

	* src/: imap/cmd-append.c, imap/cmd-copy.c,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/dbox/dbox-list.c,
	  lib-storage/index/dbox/dbox-storage.c,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  plugins/convert/convert-storage.c, plugins/quota/quota-plugin.c,
	  plugins/zlib/zlib-plugin.c: Make life easier for plugins:  -
	  Added MAILBOX_OPEN_SAVEONLY flag for mailbox_open(), which is set
	  when mailbox is opened only for append/copy  - Added a couple of
	  MAIL_STORAGE_ERR_* string defines that should be used when giving
	  visible errors to clients  - Added failed-flag for
	  mailbox_list_context, which plugins can directly set to make
	  mail_storage_mailbox_list_deinit() return failure  - Added
	  mail_storage_get_mailbox_path() and
	  mail_storage_get_mailbox_control_dir() to return locations for
	  mailbox directories

	  Also be more strict when validating mailbox names.

2006-02-22 13:58  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/auth-worker-client.c: Fixed passdb credential lookups to
	  work again with blocking passdbs.

2006-02-21 22:50  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.h: Removed extra comma at end of enum list

2006-02-20 17:34  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sync.c: Update message_count only after expunge
	  sends are finished or we'll get to infinite loop (broken in last
	  commit).

2006-02-20 17:17  Timo Sirainen <tss@iki.fi>

	* src/login-common/login-proxy.c: and fix for last cleanup..

2006-02-20 17:14  Timo Sirainen <tss@iki.fi>

	* src/login-common/login-proxy.c: Minor cleanups

2006-02-20 16:31  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-passwd-file.c, db-passwd-file.h,
	  passdb-passwd-file.c, userdb-passwd-file.c: If passwd-file is
	  being used as userdb, complain immediately if some entries don't
	  have userdb information. Also some other cleanups and crashfix
	  for today's earlier changes.

2006-02-20 14:16  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/: db-passwd-file.c, db-passwd-file.h,
	  passdb-passwd-file.c, userdb-passwd-file.c: Updated passwd-file
	  format to allow specifying any key=value fields. Since the value
	  fields may contain ':' characters, this changes the file format a
	  bit. Previously the last two fields were "flags" and "mail".
	  Flags has been empty for last 3 years however, so the new format
	  is used if the flags field contains something. In that case there
	  is no separate mail field, it can instead be specified by adding
	  userdb_mail=<mail> parameter.

2006-02-20 14:12  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/auth-request.h: Added comment

2006-02-20 13:39  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/: checkpassword-reply.c, passdb-checkpassword.c: Allow
	  checkpassword program to send extra parameters to Dovecot. EXTRA
	  environment contains a list of environment variables that are
	  passed to Dovecot.

2006-02-20 13:29  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/passdb-checkpassword.c: Pass LOCAL_IP, REMOTE_IP,
	  SERVICE and MASTER_USER in environment to checkpassword.

2006-02-20 13:14  Timo Sirainen <timo.sirainen@movial.fi>

	* dovecot-example.conf, src/auth/auth-request.c,
	  src/auth/auth-request.h, src/auth/auth-worker-client.c,
	  src/auth/auth.c, src/auth/auth.h, src/auth/mech-plain.c,
	  src/auth/passdb-blocking.c, src/auth/passdb.c, src/auth/passdb.h,
	  src/master/auth-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added support for "master users"
	  who can log in as other people. Currently works only with SASL
	  PLAIN authentication by giving it authorization ID string.

2006-02-18 12:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c: s/Maildir/dbox/

2006-02-18 12:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c: Fixed dbox
	  autodetection and removed unused code.

2006-02-18 09:59  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: BODYSTRUCTURE -> BODY
	  conversion was broken with mails containing message/rfc822 parts.

2006-02-17 23:36  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-sync-update.c,
	  mail-index.c: Added some locking related asserts, comments and
	  when replacing index file, open it immediately into memory
	  (seemed to work before too, though).

2006-02-17 14:20  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-mail.c: Fetching BODY/BODYSTRUCTURE
	  with header fields caused Dovecot to unneededly open the mails
	  and parse their headers, if everything was already in cache.

2006-02-17 12:28  Timo Sirainen <timo.sirainen@movial.fi>

	* src/imap/cmd-append.c: If client disconnected or gave too long
	  APPEND command line, we didn't properly deinitialize saving,
	  which could have caused partially written mails with mbox, or
	  files left lying in tmp/ with maildir.

2006-02-16 15:23  Timo Sirainen <timo.sirainen@movial.fi>

	* src/: lib-storage/index/maildir/maildir-keywords.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/subscription-file/subscription-file.c,
	  lib-index/mail-cache.c, lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-keywords.c,
	  lib-index/mail-index-view.c, lib-index/mail-index.c,
	  lib-index/mail-transaction-log.c, lib/Makefile.am,
	  lib/file-cache.c: Try to handle ESTALE NFS errors the best way we
	  can.

2006-02-16 14:58  Timo Sirainen <tss@iki.fi>

	* configure.in: Removed -Wstrict-aliasing=2 since it gives errors
	  with older gccs

2006-02-15 19:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Allow creating
	  mailbox names with '*' and '%' characters. They don't break
	  anything anyway.

2006-02-14 18:59  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-ntlm.c, auth/mech-rpa.c, imap/imap-sort.c,
	  lib/buffer.c, lib/module-dir.c, lib/write-full.c,
	  lib-index/mail-cache-fields.c,
	  lib-index/mail-index-sync-update.c, lib-ntlm/ntlm-byteorder.h,
	  lib-ntlm/ntlm-message.c, lib-storage/index/dbox/dbox-file.c:
	  While casting const pointers to something else, the const was
	  often unneededly dropped out in the middle of casts.

2006-02-14 18:58  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-private.h, pop3-login/client.h,
	  imap-login/client.h: Removed duplicated function declarations.

2006-02-14 18:28  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/fd-close-on-exec.c, src/lib/network.c:
	  Enable -Wstrict-aliasing=2 warning and fixed a couple of warnings
	  it gave.

2006-02-14 17:43  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-request.c, auth/auth-stream.c,
	  auth/passdb-ldap.c, auth/passdb-sql.c, auth/userdb-ldap.c,
	  auth/userdb-sql.c, auth/userdb-static.c, master/mail-process.c:
	  Check that we don't pass around key=value pairs with empty keys.

2006-02-14 17:42  Timo Sirainen <tss@iki.fi>

	* src/lib/env-util.c: Out of memory may not be the only reason
	  putenv() fails. In OSX it seems to fail if "=value" is given.

2006-02-14 17:22  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: PREAUTH banner should show the capability from
	  capability_string in case some plugins had changed that already.

2006-02-14 17:21  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/Makefile.am: Fixed installing

2006-02-14 14:19  Timo Sirainen <tss@iki.fi>

	* configure.in: Added --with-sql option to build with SQL
	  userdb/passdb but without any built-in SQL drivers.

2006-02-14 14:07  Timo Sirainen <timo.sirainen@movial.fi>

	* configure.in: Building with SQL support replaced passdb list with
	  userdbs.

2006-02-14 13:41  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib/: Makefile.am, close-keep-errno.c, close-keep-errno.h,
	  network.c, unlink-directory.c: Moved dupliated close_save_errno()
	  code to public close_keep_errno() function.

2006-02-14 13:06  Timo Sirainen <timo.sirainen@movial.fi>

	* dovecot-example.conf, src/master/master-settings.c,
	  src/lib-storage/index/mbox/mbox-lock.c: Updated
	  mbox_dotlock_change_timeout default value to 120. Also the mbox
	  default timeout values were wrong when not starting Dovecot via
	  master process.

2006-02-14 13:04  Timo Sirainen <timo.sirainen@movial.fi>

	* src/imap/mail-storage-callbacks.c: Flush the output while writing
	  the "will override lock file" messages, so that the output will
	  actually be sent instead of just left in buffer.

2006-02-13 18:35  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sync.c: Don't notify client about changes in
	  messages it hasn't yet even been notified about.

2006-02-12 10:11  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf: Added uris setting.

2006-02-12 10:03  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Check that uris and hosts settings are
	  correct.

2006-02-12 09:53  Timo Sirainen <tss@iki.fi>

	* configure.in: Give error if --with-storages or --without-storages
	  is used without parameters. Assume --with-sql-drivers means all
	  drivers are wanted.

2006-02-12 09:51  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-gssapi.c: Crashfix. Patch by Mark Davies

2006-02-11 20:38  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: When using --exec-mail, don't care
	  if protocols line is empty.

2006-02-10 15:53  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/Makefile.am: Still wasn't working with Solaris shell.
	  Fix by Chris Wakelin

2006-02-10 15:47  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-epoll.c: Fix by Jakob Hirsch

2006-02-08 20:25  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/Makefile.am: Some shells don't like empty for loops

2006-02-08 17:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c: Don't register cache fields
	  twice. Fixes "duplicate field in header" errors.

2006-02-08 17:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Ignore if cache compression
	  fails.

2006-02-08 10:19  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am,
	  src/plugins/convert/Makefile.am: Build fixes

2006-02-08 10:17  Timo Sirainen <tss@iki.fi>

	* NEWS: Updated

2006-02-08 10:05  Timo Sirainen <tss@iki.fi>

	* TODO, configure.in: 1.0beta3 released.

2006-02-07 16:41  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Call io_remove() earlier.

2006-02-07 15:37  Timo Sirainen <tss@iki.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c: Advertise the QUOTA
	  capability if the plugin is loaded.

2006-02-07 12:38  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-main.c: Fix building without ssl support

2006-02-07 10:07  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Fix to comparing plugin names which begin
	  with "lib".

2006-02-07 08:01  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-client.c: LF wasn't sent at the end of all
	  commands.

2006-02-05 18:00  Timo Sirainen <tss@iki.fi>

	* src/master/: .cvsignore, Makefile.am, common.h, main.c,
	  ssl-init-main.c, ssl-init.c, ssl-init.h: Added ssl-build-param
	  binary to build the ssl-parameters.dat. This way dovecot master
	  binary doesn't anymore need to be linked with SSL libraries, and
	  the process title is also clearer.

2006-02-05 14:14  Timo Sirainen <tss@iki.fi>

	* src/lib/: module-dir.c, module-dir.h: Added module_dir_deinit().

2006-02-05 13:33  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: Don't crash if we couldn't add I/O notifier.

2006-02-05 13:07  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: cleanup

2006-02-05 13:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-sync-expunge.c, dbox-uidlist.c:
	  Dotlock fixes

2006-02-05 13:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Limit maximum
	  mailbox name length while creating them.

2006-02-05 12:59  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Call file_dotlock_touch()
	  once in a while so other process won't override the conversion
	  lock.

2006-02-05 12:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: file-dotlock.c, file-dotlock.h: Added
	  file_dotlock_touch() for updating lock file's timestamp.

2006-02-05 12:46  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-dotlock.c, lib/file-dotlock.h,
	  lib-index/mail-cache-private.h, lib-index/mail-cache.c,
	  lib-index/mail-transaction-log.c,
	  lib-storage/index/dbox/dbox-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/mbox/mbox-lock.c,
	  lib-storage/subscription-file/subscription-file.c,
	  plugins/convert/convert-storage.c: Removed
	  immediate_stale_timeout and changed the stale_timeout behavior to
	  check both dotlock and the file it protects, and overwrite the
	  lock file whenever neither of them have been modified for
	  stale_timeout seconds (ie.  also immediately if their timestamps
	  are old enough).

2006-02-05 12:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-file.c: Don't break if
	  keyword_count is for some reason 0 in dbox file.

2006-02-05 07:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: Keyword comparing still
	  didn't work perfectly when there were no keywords.  This caused
	  some extra unnecessary keyword changes.

2006-02-05 07:24  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: If error message from PAM was over ~500
	  bytes, we crashed. Probably never happened. Also use PIPE_BUF
	  instead of hardcoded 512 bytes.

2006-02-05 07:19  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sort.c: Minor cleanup / comment update

2006-02-02 21:31  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated plugin section

2006-02-02 21:29  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/dict-process.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added plugin {} section to
	  dovecot.conf for passing extra environment variables to mail
	  processes.

2006-02-02 21:20  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/Makefile.am: Forgot to add

2006-02-02 21:00  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: And a few fixes

2006-02-02 20:42  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/convert/.cvsignore,
	  src/plugins/convert/convert-plugin.c,
	  src/plugins/convert/convert-plugin.h,
	  src/plugins/convert/convert-storage.c,
	  src/plugins/convert/convert-storage.h,
	  src/plugins/convert/convert-tool.c: Added "mail storage
	  conversion" plugin. It can be used with IMAP, POP3 and/or LDA to
	  convert one complete mail storage to another format. Also
	  included a convert-tool command line tool to do it manually.
	  Currently doesn't support preserving UID/UIDVALIDITY.

2006-02-02 20:20  Timo Sirainen <tss@iki.fi>

	* src/: pop3/main.c, imap/namespace.c, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h: Moved mailbox flag and lock method
	  parsing to lib-storage.

2006-02-02 19:37  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-search.c, imap/imap-expunge.c, pop3/client.c:
	  Don't bother checking if mailbox_search_init() returns NULL. It
	  never does.

2006-02-02 18:13  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am: If zlib.h isn't found,
	  don't try to build the zlib plugin.

2006-01-31 12:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: Write keywords when
	  appending mails.

2006-01-31 06:05  Timo Sirainen <tss@iki.fi>

	* src/: plugins/quota/quota-dict.c, plugins/quota/quota.c,
	  dict/Makefile.am, dict/dict-cache.c, dict/dict-cache.h,
	  dict/dict-server.c, dict/main.c, lib-dict/dict-client.c,
	  lib-dict/dict-private.h, lib-dict/dict-sql.c, lib-dict/dict.c,
	  lib-dict/dict.h: Dictionary takes now a username parameter, which
	  is used for private queries. Made dict-sql use "insert .. on
	  duplicate key update" syntax, which unfortunately doesn't work
	  with PostgreSQL yet.

2006-01-31 06:02  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Added missing "dict" to process names

2006-01-31 05:06  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c: Make sure queued queries and timeout
	  get freed when deinitializing. Send the first query immediately
	  after connected to pgsql instead of waiting for 5 seconds.

2006-01-29 12:42  Timo Sirainen <tss@iki.fi>

	* src/plugins/zlib/Makefile.am: Link with zlib.

2006-01-29 12:41  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-append.c, imap-sync.c: And the
	  final fix for APPEND hangs ;)

2006-01-29 12:33  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-append.c, imap-sync.c: And one more fix for append
	  hang..

2006-01-29 12:21  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: If DEBUG is enabled, make sure the fd is
	  still open when removing the I/O handler.

2006-01-29 12:14  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-master-connection.c, auth/auth-master-listener.c,
	  auth/auth-worker-server.c, auth/passdb-checkpassword.c,
	  deliver/deliver.c, dict/dict-server.c, imap/client.c,
	  imap/client.h, lib/ostream-file.c, login-common/main.c,
	  login-common/master.c, login-common/ssl-proxy-gnutls.c,
	  login-common/ssl-proxy-openssl.c, master/auth-process.c,
	  master/dict-process.c, pop3/client.c, pop3/client.h: Call
	  io_remove() before closing the fd. It's required by kqueue.

2006-01-29 10:55  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-internal.h, ioloop-notify-dn.c,
	  ioloop-notify-inotify.c, ioloop-notify-kqueue.c, ioloop.c:
	  Cleanups: Make io_remove() do the linked list updating also for
	  notify handlers. Removed notify_context from struct io, and moved
	  it to a new struct inotify_io.

2006-01-29 10:32  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-kqueue.c, ioloop-notify-kqueue.c, ioloop.c:
	  kqueue updates. Patch by Vaclav Haisman

2006-01-29 09:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-save.c, dbox-transaction.c,
	  dbox-uidlist.c, dbox-uidlist.h: When appending, update sync_stamp
	  in index so that dbox won't get a full resync.

2006-01-28 22:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: Makefile.am, dbox-file.c,
	  dbox-file.h, dbox-keywords.c, dbox-keywords.h, dbox-mail.c,
	  dbox-storage.h, dbox-sync-full.c, dbox-sync.c, dbox-uidlist.c:
	  Support storing keywords in dbox files. Doesn't yet work while
	  saving.

2006-01-28 21:47  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  pop3-login/client-authenticate.c, pop3-login/client.c: If client
	  disconnected while we were trying to send authentication
	  continuation to it, we crashed.

2006-01-28 21:28  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: Added asserts

2006-01-28 21:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Changed reservations
	  buffer to array.

2006-01-28 21:09  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: If authentication client
	  disconnects while it still has pending requests, don't crash (got
	  broken in the large pointer-change commit).

2006-01-28 14:07  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Removed "1.0" version number.

2006-01-28 12:45  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/Makefile.am: "make dist" didn't include sources.

2006-01-28 11:32  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Last APPEND-fix left connection always
	  stuck afterwards.

2006-01-27 15:58  Timo Sirainen <tss@iki.fi>

	* configure.in: Make --without-sql-drivers work properly

2006-01-27 15:44  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-sqlite.c: Cleanups.

2006-01-26 23:00  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-sqlite.c: Fixed memory leaks

2006-01-26 22:02  Timo Sirainen <tss@iki.fi>

	* INSTALL: Add directories where they need to be compiled.

2006-01-26 22:02  Timo Sirainen <tss@iki.fi>

	* configure.in: Handle --without-sql-drivers

2006-01-26 22:01  Timo Sirainen <tss@iki.fi>

	* INSTALL, configure.in, src/auth/main.c, src/lib-dict/dict-sql.c,
	  src/lib-sql/.cvsignore, src/lib-sql/Makefile.am,
	  src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c,
	  src/lib-sql/driver-sqlite.c, src/lib-sql/sql-api-private.h,
	  src/lib-sql/sql-api.c, src/lib-sql/sql-api.h: Added support for
	  dynamically building SQL drivers.

2006-01-26 21:08  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: If there had been enough sync changes
	  while APPEND was being done, we never reset flush callback to
	  _client_output, which could have caused hangs later.

2006-01-26 20:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Boolean changes
	  broke istream_raw_mbox_is_valid_from() when it hit unexpected
	  EOF. So broken Content-Length headers at the end of files gave
	  "file size unexpectedly shrinked in mbox" errors.

2006-01-26 20:10  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Ignore gid of ssl-parameters.dat. It may
	  not be what we expect, and since we create it world-readable, it
	  doesn't really matter anyway.

2006-01-25 17:29  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Allow parameters to be passed to
	  checkpassword.

2006-01-25 17:24  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Don't crash if unknown child
	  exits.

2006-01-24 18:49  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Fix building without OpenSSL.

2006-01-23 14:22  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-sqlite.c: Compiler warning fix. Patch by
	  Marcus Rueckert

2006-01-22 19:59  Timo Sirainen <tss@iki.fi>

	* doc/securecoding.txt: Added something about setting freed
	  pointers to NULL.

2006-01-22 19:36  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 1.0.beta2 released

2006-01-22 19:31  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Fix for SSL parameters getting regenerated
	  constantly

2006-01-22 16:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.h: Include sys/mkdev.h with UnixWare
	  for major() and minor()

2006-01-22 16:09  Timo Sirainen <tss@iki.fi>

	* configure.in: And fix for uoff_t checks..

2006-01-22 16:06  Timo Sirainen <tss@iki.fi>

	* src/: auth/passdb-cache.h, lib-imap/imap-util.h: Removed unneeded
	  enum declarations.

2006-01-22 15:53  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.h: If uoff_t type already exists,
	  use it (UnixWare has it).

2006-01-22 15:50  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-client.c: UnixWare creates sockets as fifos.
	  Allow that..

2006-01-22 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-client.c: If we don't have any auth sockets,
	  don't say we're connected to it.

2006-01-22 13:55  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: Compile fix

2006-01-22 13:29  Timo Sirainen <tss@iki.fi>

	* README: Removed code section and did some updates.

2006-01-22 13:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: Don't break with INDEX=MEMORY
	  and lock_method=dotlock

2006-01-22 12:57  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-sqlite.c: Forgot to add in sqlite patch.

2006-01-22 12:21  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-connection.c: Removed assert, since it may
	  happen and crash dovecot-auth.

2006-01-22 12:13  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Fix for 0777 check

2006-01-22 12:12  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Make base_dir world-readable, not
	  world-writable.

2006-01-22 12:09  Timo Sirainen <tss@iki.fi>

	* configure.in, doc/dovecot-sql.conf, src/lib-sql/Makefile.am,
	  src/lib-sql/sql-api-private.h, src/lib-sql/sql-api.c,
	  src/master/main.c: SQLite support. Patch by Jakob Hirsch.

2006-01-22 11:33  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-client-connection.c,
	  src/auth/auth-request.c, src/auth/auth-request.h,
	  src/auth/auth.c, src/auth/auth.h, src/auth/passdb-cache.c,
	  src/auth/passdb-ldap.c, src/auth/passdb-passwd-file.c,
	  src/auth/passdb-sql.c, src/auth/passdb-vpopmail.c,
	  src/master/auth-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added auth_debug_passwords setting.
	  If it's not enabled, hide all password strings from logs.

2006-01-22 10:50  Timo Sirainen <tss@iki.fi>

	* src/master/: main.c, ssl-init.c, ssl-init.h: Added
	  --build-ssl-parameters option to build them.

2006-01-22 10:27  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Removed #ifdef PAM_RHOST, it should be
	  everywhere

2006-01-22 10:00  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: Domain part was dropped from
	  usernames.

2006-01-19 20:39  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: ssl_parameters_regenerate is int,
	  not str.

2006-01-19 19:28  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-sql.c: Settings' default listing wasn't
	  ended properly, which could have caused dovecot-auth to crash at
	  startup (depending on used compiler).

2006-01-18 23:14  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-index.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/dbox/dbox-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added mbox_min_index_size setting.

2006-01-18 23:04  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index.c, mail-index.h:
	  Fixed mail_index_move_to_memory() to work better and made it
	  public

2006-01-18 23:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: Don't try to write to index file
	  if it's in memory.

2006-01-18 22:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-mail.c,
	  src/lib-storage/index/maildir/maildir-mail.c,
	  src/lib-storage/index/index-mail-headers.c,
	  src/lib-storage/index/index-mail.c,
	  src/lib-storage/index/index-mail.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h, dovecot-example.conf,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added mail_cache_min_mail_count
	  setting.

2006-01-18 16:53  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-sql.c: Give a clear error message if
	  SQL/LDAP configuration file path was left empty.

2006-01-17 14:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Error handling /
	  compiler warning fix

2006-01-17 14:03  Timo Sirainen <tss@iki.fi>

	* src/lib/: hash.c, hash.h: size_t -> unsigned int. It's enough.

2006-01-17 13:51  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c: Changed linux/inotify* includes
	  to sys/inotify.h (I thought I had done this already).

2006-01-16 20:15  Timo Sirainen <tss@iki.fi>

	* TODO, configure.in: 1.0 beta1 released

2006-01-16 19:36  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Added a note about SSL parameter
	  regeneration finishing.

2006-01-15 23:56  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Removed ssl_parameters_file setting.

2006-01-15 21:52  Timo Sirainen <tss@iki.fi>

	* src/master/: login-process.c, main.c, master-settings.c,
	  master-settings.h, ssl-init.c, ssl-init.h: Put ssl-parameters
	  file into login directory so it still can be accessed even if
	  login process is chrooted.

2006-01-15 21:24  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Fix base_dir permissions if it
	  exists

2006-01-15 21:14  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.h: mail_max_keyword_length is integer,
	  not boolean.

2006-01-15 21:07  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Add a note about DH parameters being
	  generated for the first time.

2006-01-15 19:02  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: When starting with --exec-mail, keep USER and
	  HOME environments and clear the rest.

2006-01-15 19:01  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Don't crash if username is NULL
	  (shouldn't happen though)

2006-01-15 15:59  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: IDLE: Handle disconnection differently (and
	  maybe we won't crash anymore)

2006-01-15 15:24  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: If ssl_parameters_regenerate=0, don't
	  regenerate it if it's otherwise ok.

2006-01-15 15:22  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: If SSL parameters file is empty, unlink it

2006-01-15 14:22  Timo Sirainen <tss@iki.fi>

	* src/master/dict-process.c: Disable dict server for now

2006-01-15 13:38  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-passwd-file.c, db-passwd-file.h,
	  passdb-passwd-file.c, userdb-passwd-file.c: If debug is enabled,
	  tell how many users are found from passwd-file whenever it's
	  read.

2006-01-15 13:20  Timo Sirainen <tss@iki.fi>

	* src/master/: askpass.c, askpass.h: Forgot to add in last commit

2006-01-15 13:16  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	  src/master/Makefile.am, src/master/common.h,
	  src/master/login-process.c, src/master/main.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  support for password protected SSL private keys. The password can
	  be given in dovecot.conf, or when dovecot is started with -p
	  parameter.

2006-01-15 12:35  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	  src/master/master-settings.c, src/master/ssl-init-openssl.c,
	  src/master/ssl-init.c: Generate DH parameters and use them.
	  Changed default regeneration time to 1 week.

2006-01-15 12:15  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added a note about auth_debug also storing
	  users' passwords in logs.

2006-01-15 12:11  Timo Sirainen <tss@iki.fi>

	* configure.in: Include sys/inotify.h instead of linux/inotify.h.
	  Patch by Marcus Rueckert

2006-01-15 10:07  Timo Sirainen <tss@iki.fi>

	* src/master/dict-process.c: Create dict-server socket to base_dir.

2006-01-15 00:50  Timo Sirainen <tss@iki.fi>

	* src/util/gdbhelper.c: Create the gdbhelper log file only after
	  process has died.

2006-01-15 00:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction-private.h,
	  mail-index-transaction.c: Added some checks and better logging
	  for figuring out why (*seq != 0) assert happens.

2006-01-14 23:27  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c: Fixed

2006-01-14 19:08  Timo Sirainen <tss@iki.fi>

	* configure.in: Default SSL is OpenSSL, not GNUTLS.

2006-01-14 18:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Error handling fix

2006-01-14 18:47  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-cache.c, auth/auth-cache.h,
	  auth/auth-client-connection.c, auth/auth-client-connection.h,
	  auth/auth-master-connection.c, auth/auth-master-connection.h,
	  auth/auth-master-listener.c, auth/auth-master-listener.h,
	  auth/auth-module.c, auth/auth-module.h,
	  auth/auth-request-handler.c, auth/auth-request-handler.h,
	  auth/auth-request.c, auth/auth-request.h,
	  auth/auth-worker-client.c, auth/auth-worker-client.h,
	  auth/auth-worker-server.c, auth/auth.c, auth/auth.h,
	  auth/db-ldap.c, auth/db-ldap.h, auth/db-passwd-file.c,
	  auth/db-passwd-file.h, auth/db-sql.c, auth/db-sql.h, auth/main.c,
	  auth/mech-gssapi.c, auth/passdb-cache.c,
	  auth/passdb-checkpassword.c, auth/passdb-ldap.c,
	  auth/passdb-pam.c, auth/passdb-passwd-file.c, auth/passdb-sql.c,
	  auth/passdb.c, auth/password-scheme.c, auth/userdb-ldap.c,
	  auth/userdb-passwd-file.c, auth/userdb-sql.c, auth/userdb.c,
	  dict/dict-cache.c, dict/dict-server.c, dict/main.c,
	  imap/client.c, imap/cmd-append.c, imap/cmd-close.c,
	  imap/cmd-copy.c, imap/cmd-delete.c, imap/cmd-idle.c,
	  imap/cmd-list.c, imap/cmd-logout.c, imap/cmd-search.c,
	  imap/cmd-select.c, imap/cmd-status.c, imap/cmd-store.c,
	  imap/cmd-unselect.c, imap/imap-expunge.c, imap/imap-fetch-body.c,
	  imap/imap-fetch.c, imap/imap-sort.c, imap/imap-sync.c,
	  imap/imap-thread.c, imap/main.c, imap/namespace.c,
	  imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/imap-proxy.c, lib/buffer.c, lib/buffer.h,
	  lib/file-cache.c, lib/file-cache.h, lib/hash.c, lib/hash.h,
	  lib/ioloop-notify-dn.c, lib/ioloop.c, lib/ioloop.h,
	  lib/istream-limit.c, lib/istream-seekable.c, lib/istream.c,
	  lib/istream.h, lib/lib-signals.c, lib/module-dir.c,
	  lib/module-dir.h, lib/ostream-crlf.c, lib/ostream-file.c,
	  lib/ostream.c, lib/ostream.h, lib/str.c, lib/str.h,
	  lib-auth/auth-client.c, lib-auth/auth-client.h,
	  lib-auth/auth-server-connection.c,
	  lib-auth/auth-server-connection.h,
	  lib-auth/auth-server-request.c, lib-charset/charset-iconv.c,
	  lib-charset/charset-utf8.c, lib-charset/charset-utf8.h,
	  lib-dict/dict-client.c, lib-dict/dict-sql.c, lib-dict/dict.c,
	  lib-dict/dict.h, lib-imap/imap-base-subject.c,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-envelope.c,
	  lib-imap/imap-match.c, lib-imap/imap-match.h,
	  lib-imap/imap-parser.c, lib-imap/imap-parser.h,
	  lib-index/mail-cache-compress.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log-view.c,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-mail/istream-header-filter.c, lib-mail/message-body-search.c,
	  lib-mail/message-header-search.c,
	  lib-mail/message-header-search.h, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-settings/settings.c,
	  lib-sql/driver-mysql.c, lib-sql/driver-pgsql.c,
	  lib-sql/sql-api.c, lib-sql/sql-api.h, lib-storage/mail-copy.c,
	  lib-storage/mail-storage.c, lib-storage/mail-storage.h,
	  lib-storage/mail.c, lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/index-mailbox-check.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/index-transaction.c,
	  lib-storage/index/dbox/dbox-file.c,
	  lib-storage/index/dbox/dbox-list.c,
	  lib-storage/index/dbox/dbox-save.c,
	  lib-storage/index/dbox/dbox-sync-expunge.c,
	  lib-storage/index/dbox/dbox-sync.c,
	  lib-storage/index/dbox/dbox-uidlist.c,
	  lib-storage/index/maildir/maildir-keywords.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/mbox/istream-raw-mbox.c,
	  lib-storage/index/mbox/mbox-file.c,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-mail.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync-rewrite.c,
	  lib-storage/index/mbox/mbox-sync.c,
	  lib-storage/subscription-file/subscription-file.c,
	  login-common/login-proxy.c, login-common/main.c,
	  login-common/master.c, login-common/ssl-proxy-openssl.c,
	  master/auth-process.c, master/dict-process.c, master/log.c,
	  master/login-process.c, master/main.c, master/ssl-init.c,
	  plugins/imap-quota/imap-quota-plugin.c,
	  plugins/quota/quota-storage.c, plugins/trash/trash-plugin.c,
	  plugins/zlib/zlib-plugin.c, pop3/client.c, pop3/commands.c,
	  pop3/main.c, pop3-login/client-authenticate.c,
	  pop3-login/client.c, pop3-login/pop3-proxy.c, util/rawlog.c:
	  deinit, unref, destroy, close, free, etc. functions now take a
	  pointer to their data pointer, and set it to NULL. This makes
	  double-frees less likely to cause security holes.

2006-01-14 17:23  Timo Sirainen <tss@iki.fi>

	* src/lib/: mempool-alloconly.c, mempool-datastack.c,
	  mempool-system.c, mempool-unsafe-datastack.c, mempool.h:
	  pool_unref(): set the pool pointer to NULL, so if we're trying to
	  unref it twice we'll do a clean crash.

2006-01-14 17:14  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-thread.c: THREAD crashed if no search matches were
	  found.

2006-01-14 17:10  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-list.c, namespace.c, namespace.h: Fixes to
	  returning namespace root with "" mask.

2006-01-14 16:48  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Cleaned up and added comments. Also added
	  some kludging so that listing namespace prefix itself with and
	  without trailing separator works.

2006-01-14 16:45  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-quote.h: Fixed macro to put parameter in ()

2006-01-14 15:19  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/index-search.c,
	  lib-storage/index/mbox/mbox-sync.c,
	  plugins/quota/quota-storage.c: Compiler warning fixes and one
	  real fix for int -> bool changes.

2006-01-14 15:14  Timo Sirainen <tss@iki.fi>

	* doc/securecoding.txt: Small updates: Added note about array API
	  and updates to data stack.

2006-01-14 14:51  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h: Don't crash if closing with signal
	  while IDLEing.

2006-01-14 14:09  Timo Sirainen <tss@iki.fi>

	* src/dict/Makefile.am: Compile fix

2006-01-14 14:01  Timo Sirainen <tss@iki.fi>

	* src/: lib-dict/Makefile.am, lib-dict/dict-client.h,
	  master/dict-process.c: Don't use hardcoded /var/run/dovecot in
	  dict-server path, but PKG_RUNDIR/dict-server.

2006-01-14 13:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: Use longer line
	  wrapping with X-IMAP, X-IMAPbase and X-Keywords headers since
	  UW-IMAP doesn't like the wrapping.

2006-01-14 13:22  Timo Sirainen <tss@iki.fi>

	* src/Makefile.am: automake warning fixed

2006-01-14 12:54  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Added assert

2006-01-14 12:47  Timo Sirainen <tss@iki.fi>

	* src/util/gdbhelper.c: Use "bt full" for printing backtrace.

2006-01-14 12:46  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/util/Makefile.am, src/util/gdbhelper.c:
	  Added gdbhelper binary.

2006-01-13 20:25  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/auth-cache.c, src/auth/auth-cache.h,
	  src/auth/auth-client-connection.c,
	  src/auth/auth-master-connection.c,
	  src/auth/auth-master-listener.c, src/auth/auth-master-listener.h,
	  src/auth/auth-request-handler.c, src/auth/auth-request-handler.h,
	  src/auth/auth-request.c, src/auth/auth-request.h,
	  src/auth/auth-worker-client.c, src/auth/auth.c, src/auth/auth.h,
	  src/auth/common.h, src/auth/db-ldap.c, src/auth/db-ldap.h,
	  src/auth/db-passwd-file.c, src/auth/db-passwd-file.h,
	  src/auth/main.c, src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	  src/auth/mech-digest-md5.c, src/auth/mech-ntlm.c,
	  src/auth/mech-rpa.c, src/auth/passdb-bsdauth.c,
	  src/auth/passdb-cache.c, src/auth/passdb-cache.h,
	  src/auth/passdb-pam.c, src/auth/passdb-passwd.c,
	  src/auth/passdb-shadow.c, src/auth/passdb.h,
	  src/auth/password-scheme.c, src/auth/password-scheme.h,
	  src/auth/userdb-ldap.c, src/auth/userdb-prefetch.c,
	  src/auth/userdb.h, src/imap/client.c, src/imap/client.h,
	  src/imap/cmd-append.c, src/imap/cmd-authenticate.c,
	  src/imap/cmd-capability.c, src/imap/cmd-check.c,
	  src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	  src/imap/cmd-delete.c, src/imap/cmd-examine.c,
	  src/imap/cmd-expunge.c, src/imap/cmd-fetch.c,
	  src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap/cmd-login.c,
	  src/imap/cmd-logout.c, src/imap/cmd-lsub.c,
	  src/imap/cmd-namespace.c, src/imap/cmd-noop.c,
	  src/imap/cmd-rename.c, src/imap/cmd-search.c,
	  src/imap/cmd-select.c, src/imap/cmd-sort.c,
	  src/imap/cmd-status.c, src/imap/cmd-store.c,
	  src/imap/cmd-subscribe.c, src/imap/cmd-thread.c,
	  src/imap/cmd-uid.c, src/imap/cmd-unselect.c,
	  src/imap/cmd-unsubscribe.c, src/imap/commands-util.c,
	  src/imap/commands-util.h, src/imap/commands.c,
	  src/imap/commands.h, src/imap/imap-expunge.c,
	  src/imap/imap-expunge.h, src/imap/imap-fetch-body.c,
	  src/imap/imap-fetch.c, src/imap/imap-fetch.h,
	  src/imap/imap-search.c, src/imap/imap-search.h,
	  src/imap/imap-sort.c, src/imap/imap-sync.c, src/imap/imap-sync.h,
	  src/imap/imap-thread.c, src/imap/namespace.c,
	  src/imap-login/client-authenticate.c,
	  src/imap-login/client-authenticate.h, src/imap-login/client.c,
	  src/imap-login/client.h, src/lib/array.h, src/lib/buffer.c,
	  src/lib/buffer.h, src/lib/compat.h, src/lib/data-stack.c,
	  src/lib/data-stack.h, src/lib/fd-close-on-exec.c,
	  src/lib/fd-close-on-exec.h, src/lib/fd-set-nonblock.c,
	  src/lib/fd-set-nonblock.h, src/lib/file-dotlock.c,
	  src/lib/file-dotlock.h, src/lib/hash.c, src/lib/hash.h,
	  src/lib/hex-binary.c, src/lib/ioloop-epoll.c,
	  src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c,
	  src/lib/ioloop-poll.c, src/lib/ioloop.c, src/lib/ioloop.h,
	  src/lib/istream-data.c, src/lib/istream-file.c,
	  src/lib/istream-internal.h, src/lib/istream-limit.c,
	  src/lib/istream-mmap.c, src/lib/istream-seekable.c,
	  src/lib/istream.c, src/lib/istream.h, src/lib/lib-signals.c,
	  src/lib/lib-signals.h, src/lib/mempool-alloconly.c,
	  src/lib/module-dir.c, src/lib/module-dir.h, src/lib/network.c,
	  src/lib/network.h, src/lib/ostream-crlf.c,
	  src/lib/ostream-file.c, src/lib/ostream-internal.h,
	  src/lib/ostream.c, src/lib/ostream.h,
	  src/lib/printf-upper-bound.c, src/lib/restrict-access.c,
	  src/lib/restrict-access.h, src/lib/restrict-process-size.h,
	  src/lib/seq-range-array.c, src/lib/seq-range-array.h,
	  src/lib/strfuncs.c, src/lib/strfuncs.h,
	  src/lib/unlink-directory.c, src/lib/unlink-directory.h,
	  src/lib/var-expand.c, src/lib-auth/auth-client.c,
	  src/lib-auth/auth-client.h,
	  src/lib-auth/auth-server-connection.c,
	  src/lib-auth/auth-server-connection.h,
	  src/lib-auth/auth-server-request.c,
	  src/lib-auth/auth-server-request.h,
	  src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c,
	  src/lib-charset/charset-utf8.h, src/lib-dict/dict-client.c,
	  src/lib-dict/dict-private.h, src/lib-dict/dict-sql.c,
	  src/lib-dict/dict.c, src/lib-dict/dict.h,
	  src/lib-imap/imap-base-subject.c,
	  src/lib-imap/imap-base-subject.h,
	  src/lib-imap/imap-bodystructure.c,
	  src/lib-imap/imap-bodystructure.h, src/lib-imap/imap-date.c,
	  src/lib-imap/imap-date.h, src/lib-imap/imap-envelope.c,
	  src/lib-imap/imap-envelope.h, src/lib-imap/imap-match.c,
	  src/lib-imap/imap-match.h, src/lib-imap/imap-parser.c,
	  src/lib-imap/imap-parser.h, src/lib-imap/imap-quote.c,
	  src/lib-imap/imap-quote.h, src/lib-index/mail-cache-compress.c,
	  src/lib-index/mail-cache-lookup.c,
	  src/lib-index/mail-cache-transaction.c,
	  src/lib-index/mail-cache.c, src/lib-index/mail-cache.h,
	  src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	  src/lib-index/mail-index-private.h,
	  src/lib-index/mail-index-sync-ext.c,
	  src/lib-index/mail-index-sync-private.h,
	  src/lib-index/mail-index-sync-update.c,
	  src/lib-index/mail-index-sync.c,
	  src/lib-index/mail-index-transaction-private.h,
	  src/lib-index/mail-index-transaction.c,
	  src/lib-index/mail-index-view-private.h,
	  src/lib-index/mail-index-view-sync.c,
	  src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	  src/lib-index/mail-index.h,
	  src/lib-index/mail-transaction-log-append.c,
	  src/lib-index/mail-transaction-log-private.h,
	  src/lib-index/mail-transaction-log-view.c,
	  src/lib-index/mail-transaction-log.c,
	  src/lib-index/mail-transaction-log.h,
	  src/lib-mail/istream-header-filter.c,
	  src/lib-mail/istream-header-filter.h,
	  src/lib-mail/message-address.c,
	  src/lib-mail/message-body-search.c,
	  src/lib-mail/message-body-search.h,
	  src/lib-mail/message-content-parser.c,
	  src/lib-mail/message-content-parser.h,
	  src/lib-mail/message-date.c, src/lib-mail/message-date.h,
	  src/lib-mail/message-header-decode.c,
	  src/lib-mail/message-header-decode.h,
	  src/lib-mail/message-header-search.c,
	  src/lib-mail/message-header-search.h,
	  src/lib-mail/message-parser.c, src/lib-mail/message-parser.h,
	  src/lib-mail/message-part-serialize.c,
	  src/lib-mail/message-send.c, src/lib-mail/message-send.h,
	  src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	  src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm/ntlm-message.c,
	  src/lib-ntlm/ntlm-message.h, src/lib-ntlm/ntlm.h,
	  src/lib-settings/settings.c, src/lib-settings/settings.h,
	  src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c,
	  src/lib-storage/mail-search.c, src/lib-storage/mail-search.h,
	  src/lib-storage/mail-storage-private.h,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/mailbox-tree.c, src/lib-storage/mailbox-tree.h,
	  src/lib-storage/index/index-mail-headers.c,
	  src/lib-storage/index/index-mail.c,
	  src/lib-storage/index/index-mailbox-check.c,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/index-sync.c,
	  src/lib-storage/index/dbox/dbox-list.c,
	  src/lib-storage/index/dbox/dbox-mail.c,
	  src/lib-storage/index/dbox/dbox-save.c,
	  src/lib-storage/index/dbox/dbox-storage.c,
	  src/lib-storage/index/dbox/dbox-storage.h,
	  src/lib-storage/index/dbox/dbox-sync-expunge.c,
	  src/lib-storage/index/dbox/dbox-sync.c,
	  src/lib-storage/index/dbox/dbox-sync.h,
	  src/lib-storage/index/dbox/dbox-uidlist.c,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/maildir/maildir-mail.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/maildir/maildir-sync.c,
	  src/lib-storage/index/maildir/maildir-uidlist.c,
	  src/lib-storage/index/maildir/maildir-uidlist.h,
	  src/lib-storage/index/mbox/istream-raw-mbox.c,
	  src/lib-storage/index/mbox/istream-raw-mbox.h,
	  src/lib-storage/index/mbox/mbox-file.c,
	  src/lib-storage/index/mbox/mbox-file.h,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-lock.c,
	  src/lib-storage/index/mbox/mbox-mail.c,
	  src/lib-storage/index/mbox/mbox-md5.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.h,
	  src/lib-storage/index/mbox/mbox-sync-parse.c,
	  src/lib-storage/index/mbox/mbox-sync-private.h,
	  src/lib-storage/index/mbox/mbox-sync-rewrite.c,
	  src/lib-storage/index/mbox/mbox-sync-update.c,
	  src/lib-storage/index/mbox/mbox-sync.c,
	  src/lib-storage/index/mbox/mbox-transaction.c,
	  src/lib-storage/subscription-file/subscription-file.c,
	  src/lib-storage/subscription-file/subscription-file.h,
	  src/login-common/client-common.c,
	  src/login-common/client-common.h, src/login-common/common.h,
	  src/login-common/main.c, src/login-common/master.c,
	  src/login-common/master.h, src/login-common/sasl-server.c,
	  src/login-common/ssl-proxy-gnutls.c,
	  src/login-common/ssl-proxy-openssl.c,
	  src/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h,
	  src/master/auth-process.c, src/master/common.h, src/master/log.c,
	  src/master/login-process.c, src/master/mail-process.c,
	  src/master/mail-process.h, src/master/main.c,
	  src/master/master-login-interface.h,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/master/ssl-init.c, src/master/syslog-util.c,
	  src/master/syslog-util.h,
	  src/plugins/imap-quota/imap-quota-plugin.c,
	  src/plugins/quota/quota-dict.c,
	  src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	  src/plugins/quota/quota-private.h,
	  src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c,
	  src/plugins/quota/quota.h, src/plugins/trash/trash-plugin.c,
	  src/plugins/zlib/istream-zlib.c, src/plugins/zlib/zlib-plugin.c,
	  src/pop3/client.c, src/pop3/commands.c, src/pop3/common.h,
	  src/pop3/main.c, src/pop3-login/client-authenticate.c,
	  src/pop3-login/client-authenticate.h, src/pop3-login/client.c,
	  src/pop3-login/client.h, src/util/rawlog.c: Added "bool" type and
	  changed all ints that were used as booleans to bool.

2006-01-13 15:11  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Compiler warning fix

2006-01-13 15:10  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: Cleanup + removed compiler warnings with
	  64bit systems

2006-01-13 12:49  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Check write()'s return value

2006-01-13 12:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Compiler warning fix

2006-01-13 12:45  Timo Sirainen <tss@iki.fi>

	* src/: dict/dict-server.c, lib-dict/dict-client.c,
	  lib-storage/index/dbox/dbox-uidlist.c: Small (compiling) fixes

2006-01-13 11:14  Timo Sirainen <tss@iki.fi>

	* autogen.sh: Call autoheader earlier

2006-01-12 19:43  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Fixes to handling namespace prefixes.

2006-01-12 10:54  Timo Sirainen <tss@iki.fi>

	* src/master/: dict-process.c, dict-process.h: Forgot to add in
	  last commit.

2006-01-11 23:50  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: /var/run/dovecot can be
	  world-readable. Default to it, and don't try to force any modes
	  to it. All files and directories under it are already protected
	  properly.

2006-01-11 23:47  Timo Sirainen <tss@iki.fi>

	* src/: dict/dict-server.c, dict/dict-server.h, dict/main.c,
	  master/Makefile.am, master/auth-process.c, master/common.h,
	  master/main.c: Start dict server automatically when a client
	  tries to connect to it.

2006-01-11 21:48  Timo Sirainen <tss@iki.fi>

	* src/: dict/dict-cache.c, dict/dict-server.c,
	  lib-dict/dict-client.c: Fixes to dict proxy.

2006-01-11 21:47  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c: Dnotify crashed if we tried to use
	  multiple I/O loops.

2006-01-11 21:45  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c: Added assert

2006-01-11 21:45  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-sql.c: Fixed parsing configuration file.

2006-01-11 20:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c, mbox-mail.c:
	  Handle unexpectedly breaking mboxes better without crashing.

2006-01-11 20:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: Added new assert
	  was wrong in last assert-crashfix, so we still kept crashing to
	  the new assert..

2006-01-11 19:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-mail.c, dbox-uidlist.c: Use
	  CR+LF linefeeds always so that physical size = virtual size.

2006-01-11 19:26  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/index/dbox/dbox-storage.c,
	  src/lib-storage/index/dbox/dbox-storage.h,
	  src/lib-storage/index/dbox/dbox-uidlist.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  dbox_rotate_min_size and fixed rotation checks.

2006-01-09 08:05  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/: quota-dict.c, quota-dirsize.c: try_alloc:
	  Handle mail_get_physical_size() failures.

2006-01-08 22:47  Timo Sirainen <tss@iki.fi>

	* configure.in: Removed deliver until it's working again

2006-01-08 22:18  Timo Sirainen <tss@iki.fi>

	* src/Makefile.am: dict was missing

2006-01-08 21:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: "Free space
	  offset" wasn't updated when headers were moved around, causing
	  assert crashes.

2006-01-07 01:25  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	  doc/dovecot-ldap.conf: Added fast authbinding and
	  auth_bind_userdn setting. Patch by Geff <boing@boing.com>

2006-01-07 01:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-from.c: Handle "Thu, 9 Nov 2002
	  22:33:52" style timestamps also.

2006-01-07 00:53  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: When idling, send an OK message every two
	  minutes to break NAT/firewall timeouts.

2006-01-07 00:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c: Comment update

2006-01-07 00:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-file.c, mbox-list.c: Keep atime
	  < mtime if mbox has recent messages and we're keeping them. Rely
	  on this for setting \UnMarked flag for LIST replies.

2006-01-07 00:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: fix

2006-01-07 00:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: Crashfix to last keyword
	  compare update

2006-01-06 23:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-index-lock.c,
	  mail-index-private.h, mail-index.c,
	  mail-transaction-log-append.c, mail-transaction-log.c,
	  mail-transaction-log.h: Beginnings of fallbacking to in-memory
	  indexes when write fails with "out of disk space" error.

2006-01-06 22:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-sync.c,
	  mail-index-view-sync.c, mail-index.c,
	  mail-transaction-log-view.c, mail-transaction-log.c,
	  mail-transaction-log.h: Handle missing/broken transaction logs
	  better. Handle broken sync position in index header better.

2006-01-06 21:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index.c: Minor cleanups

2006-01-06 20:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: Added "(see lock_method setting
	  in config file)" for flock() not supported error too.

2006-01-06 19:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c: Hidden transaction
	  changes weren't hiding everything. This resulted STORE
	  +FLAGS.SILENT not being silent always.

2006-01-06 18:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view.c, mail-index.h:
	  mail_index_ext_get_size() hadn't been implemented even though it
	  was in mail-index.h. Implemented it and changed
	  mail_index_lookup_keywords() to use it.

2006-01-06 18:38  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: We had been shared-locking index
	  unnecessarily for quite a while when using not-up-to-date views.

2006-01-06 18:22  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: Recent changes broke IDLE when no mailbox
	  was opened.

2006-01-06 17:37  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync.c, lib-index/mail-index-view-sync.c,
	  lib-index/mail-index.h, lib-storage/index/index-sync.c: Changed
	  mail_index_view_sync_next() to return struct
	  mail_index_view_sync_rec records which only contain the type and
	  UID range.  Makes it clearer that the caller won't get anything
	  else, and flag updates now don't need to update
	  add_flags/remove_flags fields.

2006-01-06 17:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-private.h,
	  mail-index-view-sync.c, mail-index-view.c, mail-index.c,
	  mail-index.h, mail-transaction-log-append.c: Comment updates,
	  small cleanups and optimizations.

2006-01-06 15:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-private.h,
	  mail-index-view-sync.c, mail-index-view.c: Converted some buffers
	  to arrays.

2006-01-06 15:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: Make it compile..

2006-01-06 14:50  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h, lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-sync.c: We assumed that keyword index
	  arrays were always sorted. This isn't always the case. Caused
	  unneeded keyword updates.

2006-01-06 14:40  Timo Sirainen <tss@iki.fi>

	* AUTHORS: Minor update

2006-01-06 14:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-private.h,
	  mail-cache.c, mail-index.c, mail-index.h: Moved uoff_t and time_t
	  compatibility checks to cache file, since they're not needed for
	  index/log. Only index file incompatibility check is now endianess
	  flag.

2006-01-06 14:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Comment updates and minor cleanups

2006-01-06 12:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-ext.c,
	  mail-index.c: Moved expunge handlers to
	  mail_index_registered_ext.

2006-01-06 12:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-ext.c,
	  mail-index-transaction-view.c, mail-index-transaction.c,
	  mail-index.c, mail-transaction-log-append.c: Cleanup: Created
	  mail_index_registered_ext which is used for index->extensions
	  array. Put sync_handler to it and removed sync_handlers array.

2006-01-05 01:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c: Read flags properly
	  from header when syncing

2006-01-05 01:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-mail.c: Handle moved mails
	  properly

2006-01-05 01:19  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c,
	  src/master/master-settings.h,
	  src/lib-storage/index/dbox/dbox-storage.c,
	  src/lib-storage/index/dbox/dbox-storage.h,
	  src/lib-storage/index/dbox/dbox-uidlist.c: Added dbox_rotate_size
	  and dbox_rotate_days settings.

2006-01-05 01:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-file.c, dbox-storage.h,
	  dbox-uidlist.c, dbox-uidlist.h: Added rotation by number of days
	  since file was created.

2006-01-04 21:05  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-append.c: If append command
	  failed because input line was too long (highly unlikely), we
	  didn't properly reset flush callback.

2006-01-02 13:45  Timo Sirainen <tss@iki.fi>

	* src/: Makefile.am, deliver/deliver.c: Deliver binary is out of
	  date, dovecot-lda should be used for now.

2006-01-02 13:39  Timo Sirainen <tss@iki.fi>

	* src/master/: master-settings.c, master-settings.h: Ignore
	  "protocol lda" section.

2006-01-02 13:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Don't fdatasync() cache
	  file. It's not all that important.

2006-01-02 12:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: And fix to mmap_disable=yes
	  optimization.

2006-01-02 12:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: typofix

2006-01-02 12:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-private.h,
	  mail-index-sync-ext.c, mail-index-sync-keywords.c,
	  mail-index-sync-update.c: Don't rewrite index file every time
	  with mmap_disable=yes.

2006-01-02 10:04  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: t_strarray_join() was broken with input
	  longer than 63 bytes (good thing we didn't use it in any
	  important places). Patch by Johan Kiviniemi.

2006-01-01 19:37  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: Fix for last change in *_strsplit_spaces().

2006-01-01 17:04  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-passwd-file.c: Don't crash if password is empty

2006-01-01 16:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: There's no "userdb pam".

2005-12-31 17:39  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am,
	  src/plugins/zlib/.cvsignore, src/plugins/zlib/Makefile.am,
	  src/plugins/zlib/istream-zlib.c, src/plugins/zlib/istream-zlib.h,
	  src/plugins/zlib/zlib-plugin.c, src/plugins/zlib/zlib-plugin.h:
	  Added zlib plugin

2005-12-31 17:31  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Grow default pool size

2005-12-31 16:59  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop.c, ioloop.h: Export current_ioloop globally.

2005-12-31 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: In-memory indexes are
	  kept also in index-storage's cache, so we need to free them the
	  normal way (probably changed this some time ago).

2005-12-31 13:49  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Removed X-UIDL after
	  all from hide list. Updated comment + small cleanup.

2005-12-31 13:43  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-body-search.c,
	  lib-mail/message-body-search.h, lib-storage/index/index-search.c:
	  Allow message_body_search() to return "message_part is broken"
	  error. If it happens, clear cache and try again with parsed
	  message_part.

2005-12-31 13:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't send X-UIDL
	  header to clients.

2005-12-30 23:08  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/: dict-client.c, dict-client.h: Forgot to add

2005-12-30 22:19  Timo Sirainen <tss@iki.fi>

	* src/dict/dict-server.c: unlink stale socket

2005-12-30 22:18  Timo Sirainen <tss@iki.fi>

	* src/dict/: dict-server.c, main.c: Small fixes

2005-12-30 22:17  Timo Sirainen <tss@iki.fi>

	* src/dict/: dict-server.c, main.c: Cleanup

2005-12-30 22:16  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, imap/main.c, pop3/Makefile.am,
	  pop3/main.c: Register proxy dictionary support and link libdict.
	  Currently it's used only by quota plugin, but later it'll be
	  useful for more things..

2005-12-30 22:13  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/pop3/main.c, src/imap/main.c: Clarify
	  that workaround lists are space separated. But allow commas as
	  well..

2005-12-30 22:09  Timo Sirainen <tss@iki.fi>

	* src/: dict/.cvsignore, dict/Makefile.am, dict/dict-cache.c,
	  dict/dict-cache.h, dict/dict-server.c, dict/dict-server.h,
	  dict/main.c, lib-dict/Makefile.am, lib-dict/dict-private.h,
	  lib-dict/dict-sql.c, lib-dict/dict.c, lib-dict/dict.h,
	  plugins/quota/quota-dict.c: Added dictinary lookup server and a
	  "proxy" dict implementation to talk to it.

2005-12-30 22:02  Timo Sirainen <tss@iki.fi>

	* configure.in: No GNU_SOURCE checks. We don't want them (I think).

2005-12-30 21:13  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.h: stdio.h needs to be included before
	  mntent.h or sys/mnttab.h

2005-12-30 21:02  Timo Sirainen <tss@iki.fi>

	* configure.in: Cleanups and some more kqueue stuff

2005-12-30 20:57  Timo Sirainen <tss@iki.fi>

	* configure.in: Forgot to add kqueue and kevent function checks

2005-12-30 20:56  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/Makefile.am,
	  src/lib/ioloop-notify-kqueue.c: Added kqueue notification
	  support. Patch by Vaclav Haisman

2005-12-30 20:56  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Fix IO_ERROR behaviour. Patch by Vaclav
	  Haisman

2005-12-30 20:40  Timo Sirainen <tss@iki.fi>

	* configure.in: Check that gssapi/gssapi.h exists before using it.

2005-12-30 20:17  Timo Sirainen <tss@iki.fi>

	* Makefile.am, configure.in: Added --with-docs parameter to specify
	  if documentation should be installed.  Wanted for at least
	  FreeBSD's NOPORTDOCS option. Patch by Robin Breathe

2005-12-30 20:06  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: *_strsplit_spaces() was skipping only space
	  separators, while it should have skipped all (like its API
	  comments said).

2005-12-30 19:49  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: Don't crash if client disconnected in IDLE.
	  If mailbox had been changed before IDLE was started, show the
	  changes immediately. If more changes happened to mailbox while we
	  were sending older changes to client, we crashed.

2005-12-30 19:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Accidentally had
	  changed !partial-check to partial-check. Because of this external
	  expunges weren't always noticed and there might have been some
	  errors about UIDs being invalid.

2005-12-30 19:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-copy.c, maildir-save.c,
	  maildir-storage.h, maildir-sync.c: maildir_copy_with_hardlinks
	  works again.

2005-12-30 18:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Minor optimization.

2005-12-30 18:02  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Added comment

2005-12-30 17:55  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: cleanup

2005-12-30 15:43  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/auth-request.c,
	  src/auth/auth-worker-client.c, src/auth/auth.c,
	  src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	  src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb-ldap.c:
	  Added authentication bind support. Patch by J.M. Maurer.  Also
	  cleaned up the LDAP code a bit and made it possible for passdbs
	  to disable lookup_credentials in runtime.

2005-12-30 13:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-mail.c: If mbox offsets are dirty
	  and the mbox is write-locked (eg. copying mails to box), we got
	  to infinite loop.

2005-12-30 13:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Extra assert

2005-12-29 00:14  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Changed default auth socket path

2005-12-28 20:17  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/: quota-dict.c, quota-dirsize.c,
	  quota-private.h: Make dirsize backend read the directory only
	  once at the beginning of transaction. Added some more variables
	  to struct quota_transaction_context so dict and quota backends
	  can both use it directly.

2005-12-28 17:15  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth.c, mech-anonymous.c, mech-apop.c,
	  mech-cram-md5.c, mech-digest-md5.c, mech-gssapi.c, mech-login.c,
	  mech-ntlm.c, mech-plain.c, mech-rpa.c, mech.h: Removed
	  need_passdb from mechanism definitions.
	  passdb_need_plain/credentials is enough to know that. Also give a
	  better error message if no passdbs are set and a mechanism
	  requires passdb.

2005-12-25 11:24  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-append.c, cmd-check.c, cmd-copy.c, cmd-expunge.c,
	  cmd-fetch.c, cmd-idle.c, cmd-noop.c, cmd-search.c, cmd-sort.c,
	  cmd-store.c, cmd-thread.c, imap-sync.c, imap-sync.h: UID STORE
	  command must return UID parameter in FETCH replies.

2005-12-25 11:05  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/passdb-pam.c: PAM: Changed
	  -session to session=yes to be more consistent with other
	  parameters. Check that invalid parameters aren't given. Added a
	  few examples to configuration file.

2005-12-25 10:51  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, cmd-append.c, cmd-idle.c: IDLE: Sending
	  "DONE" + next command in same TCP packet caused the next command
	  not to be executed until yet another command came (which usually
	  didn't happen).

2005-12-23 22:38  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c,
	  src/plugins/quota/quota-fs.h: Fixed to work with struct
	  dqblk.dqb_curspace also which is apparently the new Linux-way to
	  do it.

2005-12-21 18:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: Makefile.am, dbox-file.c,
	  dbox-sync-full.c, dbox-sync.c, dbox-sync.h, dbox-uidlist.c,
	  dbox-uidlist.h: When index files (dovecot.index and dbox index)
	  aren't synced with each others do a full sync.

2005-12-21 18:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction-private.h,
	  mail-index-transaction.c: Allow appending mails in wrong UID
	  order. Sort them internally when committing.

2005-12-21 18:37  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: ext_offsets can be higher than
	  int_offsets, so check its validity instead before starting
	  syncing.

2005-12-21 17:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Fixes

2005-12-21 17:47  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, bsearch-insert-pos.c,
	  bsearch-insert-pos.h: Added bsearch_insert_pos(). Similar to
	  bsearch(), but if value isn't found, returns the position where
	  it would be inserted.

2005-12-21 17:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Use binary search for
	  finding entries

2005-12-21 17:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-sync-expunge.c, dbox-uidlist.c:
	  Use DBOX_MAIL_FILE_PREFIX macro

2005-12-21 14:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-sync-expunge.c, dbox-sync.c,
	  dbox-sync.h: Write flag changes to dbox files.

2005-12-14 21:50  Timo Sirainen <tss@iki.fi>

	* src/: lib/module-dir.c, plugins/imap-quota/Makefile.am,
	  plugins/quota/Makefile.am, plugins/trash/Makefile.am: Load
	  plugins in sorted order. Prefixed plugins with nn_ set their
	  order.

2005-12-14 21:34  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/: dict.c, dict.h: API changes

2005-12-14 21:34  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/Makefile.am,
	  src/plugins/quota/quota-fs.c, src/plugins/quota/quota-fs.h,
	  src/plugins/quota/quota.c: quotactl() quota checking support

2005-12-14 21:28  Timo Sirainen <tss@iki.fi>

	* src/plugins/imap-quota/: imap-quota-plugin.c,
	  imap-quota-plugin.h: Init/deinit function names were wrong

2005-12-14 18:51  Timo Sirainen <tss@iki.fi>

	* AUTHORS, configure.in, src/lib/Makefile.am,
	  src/lib/ioloop-kqueue.c: Added kqueue support. Patch by Vaclav
	  Haisman.

2005-12-14 17:45  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb.c, userdb.c: Give a few helpul suggestions with
	  "Unknown passdb/usedb driver" errors.

2005-12-12 17:55  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-select.c: Compile fix

2005-12-11 13:10  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: If we see libplugin.so, initialize it with
	  plugin_init(), not libplugin_init().

2005-12-11 12:50  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't allow giving invalid notify methods in
	  --with-notify

2005-12-10 22:29  Timo Sirainen <tss@iki.fi>

	* TODO, configure.in: Alpha5 release

2005-12-10 22:25  Timo Sirainen <tss@iki.fi>

	* src/: lib-dict/Makefile.am, plugins/imap-quota/Makefile.am,
	  plugins/quota/Makefile.am, plugins/trash/Makefile.am: Added
	  missing header files. Fixed plugin install hooks to use DESTDIR.

2005-12-10 22:23  Timo Sirainen <tss@iki.fi>

	* src/master/syslog-util.c: Some syslog facilities aren't defined
	  everywhere. Put #ifdefs around them.

2005-12-10 21:10  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: fix

2005-12-10 21:03  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c: fix

2005-12-10 20:36  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/dovecot-ldap.conf,
	  doc/dovecot-sql.conf: Added some more information about prefetch
	  userdb.

2005-12-10 19:44  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/plugins/.cvsignore,
	  src/plugins/Makefile.am, src/plugins/imap-quota/.cvsignore,
	  src/plugins/imap-quota/Makefile.am,
	  src/plugins/imap-quota/imap-quota-plugin.c,
	  src/plugins/imap-quota/imap-quota-plugin.h,
	  src/plugins/quota/.cvsignore, src/plugins/quota/Makefile.am,
	  src/plugins/quota/quota-dict.c,
	  src/plugins/quota/quota-dirsize.c,
	  src/plugins/quota/quota-plugin.c,
	  src/plugins/quota/quota-plugin.h,
	  src/plugins/quota/quota-private.h,
	  src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c,
	  src/plugins/quota/quota.h, src/plugins/trash/.cvsignore,
	  src/plugins/trash/Makefile.am, src/plugins/trash/trash-plugin.c,
	  src/plugins/trash/trash-plugin.h: Added beginnings of plugin
	  infrastructure. TODO: These could be optionally compiled into
	  binaries with some configure options.

	  Added quota plugin and a new trash plugin. Not very well tested.

2005-12-10 18:58  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/lib-dict/.cvsignore,
	  src/lib-dict/Makefile.am, src/lib-dict/dict-private.h,
	  src/lib-dict/dict-sql.c, src/lib-dict/dict-sql.h,
	  src/lib-dict/dict.c, src/lib-dict/dict.h: Added dictionary API
	  and implementation for SQL. It's meant for looking and modifying
	  key=value pairs. In future we may need to use this for many
	  different things, but for now it's only used by quota-dict
	  plugin.

2005-12-10 18:57  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-pgsql.c, sql-api-private.h,
	  sql-api.c, sql-api.h: Added support for transactions and
	  synchronous SQL queries.

2005-12-10 18:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage-private.h,
	  index/index-transaction.c: Added module_contexts to transactions.

2005-12-06 19:23  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: Don't allow pop3_uidl_format without at least
	  one valid %var in it.

2005-12-06 17:34  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: Make pop3_reuse_xuidl setting actually work.
	  Patch by grant beattie.

2005-12-06 16:58  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Fixed broken index
	  directory creation change

2005-12-06 16:48  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, passdb-ldap.c, userdb-ldap.c: If
	  LDAP lookup fails because connection gets closed, try retrying it
	  again after reconnect.

2005-12-06 15:08  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Added better logging

2005-12-06 14:53  Timo Sirainen <tss@iki.fi>

	* src/auth/main.c: Deinitialize userdbs/passdbs first, so they can
	  still generate auth failure replies without crashing.

2005-12-06 14:37  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-cache.c: Don't crash if cache
	  key isn't set but cache is enabled.

2005-12-06 14:32  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: If DONE was sent while output was still
	  being sent to clients, we didn't deinitialize syncing properly.
	  That output mustn't get lost anyway, so now DONE isn't accepted
	  until all output is sent.

2005-12-06 12:54  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: mailbox_idle_check_interval comment updated

2005-12-02 22:15  Timo Sirainen <tss@iki.fi>

	* src/master/: syslog-util.c, syslog-util.h: Forgot to add in
	  syslog_facility commit

2005-12-02 12:53  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c,
	  src/login-common/main.c, src/master/Makefile.am,
	  src/master/main.c, src/master/master-settings.c,
	  src/master/master-settings.h, src/pop3/main.c: Added
	  syslog_facility setting to config file.

2005-12-02 11:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	  mail_index_keywords_create_from_indexes(): Don't crash with 64bit
	  systems if there are only 0 keywords.

2005-12-02 11:05  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf: Comment changes to reflect the new way to
	  configure pass_attrs and user_attrs (which has been there for
	  months already, the old way still works too).

2005-12-02 10:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-transaction.c: Logic/comments cleanups. Keep uidlist
	  locked a bit shorter time.

2005-11-27 23:05  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-storage/index/Makefile.am,
	  src/lib-storage/index/dbox/.cvsignore,
	  src/lib-storage/index/dbox/Makefile.am,
	  src/lib-storage/index/dbox/dbox-file.c,
	  src/lib-storage/index/dbox/dbox-file.h,
	  src/lib-storage/index/dbox/dbox-list.c,
	  src/lib-storage/index/dbox/dbox-mail.c,
	  src/lib-storage/index/dbox/dbox-save.c,
	  src/lib-storage/index/dbox/dbox-storage.c,
	  src/lib-storage/index/dbox/dbox-storage.h,
	  src/lib-storage/index/dbox/dbox-sync-expunge.c,
	  src/lib-storage/index/dbox/dbox-sync.c,
	  src/lib-storage/index/dbox/dbox-sync.h,
	  src/lib-storage/index/dbox/dbox-transaction.c,
	  src/lib-storage/index/dbox/dbox-uidlist.c,
	  src/lib-storage/index/dbox/dbox-uidlist.h: Initial implementation
	  of Dovecot's own high performance file format, named dbox.
	  Currently relies heavily on index files to work, and isn't able
	  to rebuild them if they're lost. This will be fixed soon. Not
	  tested much yet in general.

2005-11-27 23:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Minor error handling
	  fix

2005-11-25 19:23  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: "userdb prefetch" should be commented out
	  by default.

2005-11-25 15:19  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, hex-dec.c, hex-dec.h: Added decimal <->
	  hex string translation functions.

2005-11-25 15:16  Timo Sirainen <tss@iki.fi>

	* src/: lib/Makefile.am, lib/seq-range-array.c,
	  lib/seq-range-array.h, lib-index/mail-index-transaction.c: Moved
	  seq_range_*() functions to more generic ones in lib/.

2005-11-25 15:15  Timo Sirainen <tss@iki.fi>

	* src/lib/: file-dotlock.c, file-dotlock.h: Added
	  file_dotlock_get_lock_path()

2005-11-20 17:15  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: Changed "pop3_uidl_format not set" error
	  message.

2005-11-19 12:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	  MAILBOX_OPEN_NO_INDEX_FILES flagfix.

2005-11-19 12:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't create index
	  directory if we're not using index files

2005-11-19 12:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Using
	  MAILBOX_OPEN_NO_INDEX_FILES caused crashes in deinitialization

2005-11-04 11:34  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.h: API description update

2005-11-03 18:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Assert change

2005-11-03 18:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: We could have
	  assert-crashed when expunging messages.

2005-10-28 17:11  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-connection.c: Give error message if auth
	  server didn't return mechanism list.

2005-10-28 16:52  Timo Sirainen <tss@iki.fi>

	* src/imap-login/: client.c, client.h: If capability is sent in
	  greeting, don't send it before we have received authentication
	  capabilities from auth process.

2005-10-28 16:24  Timo Sirainen <tss@iki.fi>

	* configure.in: MIT kerberos v1.2 (and older) doesn't work with us.

2005-10-28 15:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: If mail had more
	  extra space in X-UID header than in X-Keywords header (but
	  X-Keywords existed), we broke when rewriting it.

2005-10-28 14:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Make sure we are
	  seeked to correct position if using the last mail's mail_ctx
	  directly.

2005-10-28 14:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: We were handling
	  wrapped X-IMAPbase and X-Keywords headers very badly.

2005-10-28 14:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: Handle duplicate
	  keywords in X-Keywords header properly

2005-10-28 14:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: We added LF+TAB
	  unneededly at the beginning of each X-Keywords header.

2005-10-28 14:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: Growing extension headers
	  broke other extensions, unless it was the first extension.
	  Meaning adding keywords caused crashes.

2005-10-28 14:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Set mail_ctx=NULL
	  always after doing something for the last mail, even if we didn't
	  rewrite its headers. Otherwise internal state breaks and we'll
	  crash.

2005-10-28 13:38  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-body-search.c: Added an assert

2005-10-28 13:38  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c: Validate deserialization
	  better.

2005-10-28 12:03  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, mech-apop.c, mech-gssapi.c,
	  mech-login.c, mech-ntlm.c, mech-plain.c, mech-rpa.c: Use a bit
	  larger initial pool sizes

2005-10-28 12:02  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-cache.c, auth-cache.h, passdb-ldap.c,
	  passdb-sql.c: cache_key was set wrong for sql/ldap passdbs, so
	  auth_cache was completely broken with them

2005-10-28 11:49  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Don't crash with
	  empty mboxes

2005-10-28 11:38  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Comment update

2005-10-28 11:34  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Don't call initgroups() at the start
	  of login processes.

2005-10-28 11:27  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/master/mail-process.c: Added %i for UID

2005-10-28 10:57  Timo Sirainen <tss@iki.fi>

	* src/: pop3/main.c, imap/main.c, auth/main.c, deliver/deliver.c:
	  Ignore SIGALRM signal. We don't want to crash when it happens.

2005-10-28 10:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: mail_cache_delete(): Make
	  sure we don't get to infinite loop if cache records contain a
	  loop.

2005-10-27 15:57  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/auth/auth-request.c: %w contains now
	  password

2005-10-27 15:44  Timo Sirainen <tss@iki.fi>

	* configure.in: typofix

2005-10-27 15:22  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-epoll.c: And even more log verbosity

2005-10-27 14:59  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-epoll.c: Added more verbosity to epoll_ctl()
	  failure messages.

2005-10-27 14:57  Timo Sirainen <tss@iki.fi>

	* AUTHORS, configure.in, dovecot-example.conf,
	  src/auth/Makefile.am, src/auth/auth.c, src/auth/mech-anonymous.c,
	  src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	  src/auth/mech-digest-md5.c, src/auth/mech-gssapi.c,
	  src/auth/mech-login.c, src/auth/mech-ntlm.c,
	  src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	  src/auth/mech.h, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  GSSAPI support. Patch by Jelmer Vernooij and some fixes by
	  pod@herald.ox.ac.uk

2005-10-27 14:29  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Non-plaintext authentication and passdb
	  cache didn't work together. Patch by Andrey Panin.

2005-10-27 13:40  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: Use read() instead of recv() in net_receive(),
	  so it works even with non-sockets. We weren't using any recv()'s
	  flags anyway, so it shouldn't matter.

2005-10-27 13:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-lock.c: Having "dotlock fcntl"
	  locking assert-crashes if dotlock file already exists.

2005-10-27 12:59  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added a note to Solaris users about
	  lock_method.

2005-10-27 12:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: if message was
	  only 0-1 bytes, we skipped the whole message which caused crashes

2005-10-27 12:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync.c: When rewriting mbox, don't
	  parse the last message again. We already have its contents in
	  mail_ctx, so pass it over to rewriter so it can reuse it. This
	  fixes also a crash when last message's header ended unexpectedly
	  and mbox file was grown (the added NULs were treated as the last
	  message's headers).

2005-10-27 12:11  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: If message header ends
	  unexpectedly, return it anyway instead of ignoring it completely.

2005-10-27 12:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: If mbox file
	  contains only single LF, treat it as an invalid mbox file instead
	  of breaking later.

2005-10-27 10:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: When updating pseudo
	  mail, we also tried to update it as the first mail in index file.
	  Normally it shouldn't have mattered, but if there were no mails
	  in mailbox it caused a crash.

2005-10-27 09:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: When expunging the
	  first mail that has X-IMAPbase header and moving it to next mail,
	  make sure the X-UID header gets appended after X-IMAPbase header.
	  Otherwise UIDs of all mails will change.

2005-10-20 09:27  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.h: #ifdef TRU64 -> __osf__

2005-10-20 09:15  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.h: Include inttypes.h with Tru64 to
	  get uint32_t etc. types defined.

2005-10-20 09:09  Timo Sirainen <tss@iki.fi>

	* TODO, configure.in: 1.0alpha4

2005-10-20 09:07  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-request.h, auth-worker-client.c,
	  passdb-ldap.c, passdb-sql.c: If passdb returned NULL password
	  (ie. no password needed), it wasn't cached correctly.

2005-10-19 13:43  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: nologin/proxy are now always in boolean
	  format, ie. without any "=Y".

2005-10-19 13:38  Timo Sirainen <tss@iki.fi>

	* configure.in, dovecot-example.conf, src/auth/Makefile.am,
	  src/auth/userdb-prefetch.c, src/auth/userdb.c: Renamed userdb
	  passdb to prefetch.

2005-10-19 13:37  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-blocking.c: Blocking passdb didn't set
	  nologin/proxy/nodelay flags for the request.

2005-10-19 13:20  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Revert previous "cleanup" which broke
	  things.. Added a comment.

2005-10-16 20:24  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: Complain about missing pop3_uidl_format also if
	  it's empty

2005-10-16 16:22  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: Don't send duplicate lines in LIST command
	  when buffer is full.

2005-10-16 15:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Instead of crashing when
	  trying to copy mails within same mailbox, give an error message
	  to user.

2005-10-16 14:59  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/pop3/main.c,
	  src/master/master-settings.c: pop3_uidl_format is now required to
	  be explicitly set. There is no default anymore.

2005-10-16 14:48  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Added -m parameter to store mail to
	  non-INBOX mailbox without Sieve scripting.

2005-10-16 14:35  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added a warning about multiple passdbs to
	  auth_cache_size.

2005-10-16 14:34  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-worker-client.c, userdb-ldap.c,
	  userdb-passwd-file.c, userdb-passwd.c, userdb-sql.c,
	  userdb-static.c, userdb-vpopmail.c, userdb.c, userdb.h: Separated
	  userdb_module's interface and the actual data struct.  Now it's
	  possible to have multiple userdbs of same type but with different
	  settings.

2005-10-16 14:06  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-cache.c, auth-cache.h, auth-request.c,
	  auth-worker-client.c, auth.c, db-ldap.c, db-passwd-file.c,
	  db-passwd-file.h, passdb-bsdauth.c, passdb-checkpassword.c,
	  passdb-ldap.c, passdb-pam.c, passdb-passwd-file.c,
	  passdb-passwd.c, passdb-shadow.c, passdb-sql.c,
	  passdb-vpopmail.c, passdb.c, passdb.h, userdb-passwd-file.c:
	  Separated passdb_module's interface and the actual data struct.
	  Now it's possible to have multiple passdbs of same type but with
	  different settings.

2005-10-16 12:49  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-request.c,
	  src/auth/passdb-bsdauth.c, src/auth/passdb-pam.c,
	  src/auth/passdb-passwd-file.c, src/auth/passdb-passwd.c,
	  src/auth/passdb-shadow.c, src/auth/passdb-vpopmail.c: Make auth
	  caching work with non-sql/ldap passdbs too.

2005-10-16 12:03  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-worker-client.c,
	  passdb-blocking.c, passdb-cache.c, passdb-cache.h, passdb-ldap.c,
	  passdb-passwd-file.c, passdb-sql.c, passdb.c, passdb.h: Fixes and
	  cleanups to credentials handling. Also fixed auth caching to work
	  more correctly in case of internal failures.

2005-10-16 10:37  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: Don't crash if reopening log file without
	  separate info log file.

2005-10-15 22:21  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Cleanup

2005-10-15 20:53  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sync.c: When output buffer got full while sending
	  syncing changes, we sent the last change twice to client. This
	  was bad if extra EXPUNGEs got sent..

2005-10-15 20:11  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Removed accidentally committed debug
	  errors.

2005-10-12 17:52  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-crlf.c: Type mismatch fixes

2005-10-12 17:14  Timo Sirainen <tss@iki.fi>

	* src/: auth/passdb-pam.c, lib/ioloop-notify-dn.c,
	  lib-index/mail-transaction-log-view.c: Fixed some printf-type
	  mismatches

2005-10-11 12:35  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added compatibility warning about
	  mail_save_crlf.

2005-10-09 09:55  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-data.c, lib/istream-file.c,
	  lib/istream-internal.h, lib/istream-limit.c, lib/istream-mmap.c,
	  lib/istream-seekable.c, lib/istream.c, lib/istream.h,
	  lib/ostream-file.c, lib-mail/istream-header-filter.c,
	  lib-storage/index/mbox/istream-raw-mbox.c,
	  lib-storage/index/mbox/mbox-sync.c: Added exact parameter to
	  i_stream_stat()

2005-10-07 10:43  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-cache.c: Added some more verbosity to cache
	  lookups.

2005-10-07 10:43  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: We were caching failed blocking requests
	  wrong.

2005-10-07 10:23  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-cache.c: Don't crash with SIGUSR2 if auth cache
	  hasn't seen any hits

2005-10-07 10:22  Timo Sirainen <tss@iki.fi>

	* src/auth/main.c: Don't crash with SIGHUP/SIGUSR2 if auth_cache
	  isn't used

2005-10-07 09:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: If mbox root directory
	  doesn't exist, create it instead of just giving error message.

2005-10-07 09:34  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-copy.c, lib-storage/mail-copy.c,
	  lib-storage/mail-copy.h, lib-storage/mail-storage-private.h,
	  lib-storage/mail-storage.c, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-storage.h: Added flags and
	  keywords parameters to mailbox_copy() in case they're wanted to
	  be changed while copying.

2005-10-05 19:44  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-master-connection.c: Added "master out" debugging
	  also for USER queries from master (ie. from deliver)

2005-10-05 19:24  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-static.c: Don't crash if there are keys without
	  =value part in static userdb template.

2005-10-05 19:16  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb.c: Don't crash if we have blocking userdb but
	  non-blocking passdb.

2005-10-03 21:25  Timo Sirainen <tss@iki.fi>

	* src/: deliver/deliver.c, imap/namespace.c, pop3/main.c: And
	  lock_method fixes..

2005-10-03 21:23  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/deliver/deliver.c,
	  src/imap/namespace.c, src/lib-index/mail-index-lock.c,
	  src/master/master-settings.c, src/pop3/main.c: Default
	  lock_method to flock instead of fcntl. This is at least useful
	  for not allowing Dovecot's indexes to be used accidentally with
	  wrong settings in NFS mounted partitions.

2005-10-01 10:52  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-request.c,
	  src/auth/auth-request.h, src/auth/auth.c, src/auth/auth.h,
	  src/auth/passdb-blocking.c, src/auth/passdb-bsdauth.c,
	  src/auth/passdb-passwd.c, src/auth/passdb-shadow.c,
	  src/lib-auth/auth-client.h, src/lib-auth/auth-server-request.c,
	  src/login-common/sasl-server.c,
	  src/login-common/ssl-proxy-openssl.c,
	  src/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h,
	  src/master/auth-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added ssl_username_from_cert
	  setting. Not actually tested yet..

2005-10-01 10:46  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c: Fixed fd leak

2005-10-01 09:48  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: If user's home directory is a
	  non-directory (eg. /dev/null) fallback to /tmp without error
	  message.

2005-10-01 09:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't break if mail
	  root directory is '/'.

2005-10-01 09:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-storage.c, mbox-storage.h:
	  Don't try to check for notifications when mbox was opened from
	  input stream.

2005-09-30 20:25  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: i_stream_stat() should return NULL for closed
	  istreams

2005-09-30 20:10  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-data.c, lib/istream-file.c,
	  lib/istream-internal.h, lib/istream-limit.c, lib/istream-mmap.c,
	  lib/istream-seekable.c, lib/istream.c, lib/istream.h,
	  lib-mail/istream-header-filter.c,
	  lib-storage/index/mbox/istream-raw-mbox.c: Added
	  i_stream_seek_mark() and used it

2005-09-30 18:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage.h,
	  index/maildir/maildir-storage.c, index/mbox/mbox-lock.c,
	  index/mbox/mbox-storage.c: Added MAILBOX_OPEN_NO_INDEX_FILES flag
	  and made streamed mboxes by default also indexed.

2005-09-30 18:46  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-fields.c,
	  mail-cache-private.h, mail-cache-sync-update.c,
	  mail-cache-transaction.c, mail-cache.c: Unlocking cache file can
	  also corrupt it since it modifies it. Added a return value for it
	  and checks to handle the failure. Fixes a crash in some error
	  situations.

2005-09-30 18:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: Don't leak alarm() with
	  in-memory indexes

2005-09-29 04:41  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: And don't crash at exit..

2005-09-28 13:26  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: ioloop needs to be created before setting
	  signals or we crash

2005-09-27 19:49  Timo Sirainen <tss@iki.fi>

	* src/lib/: compat.h, ostream-file.c: Use IOV_MAX instead of
	  UIO_MAXIOV when available.

2005-09-26 21:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: mbox/Makefile.am, maildir/Makefile.am:
	  Removed lib-index/mbox and lib-index/maildir includes. They don't
	  exist anymore.

2005-09-25 11:12  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, fd-set-nonblock.c, fd-set-nonblock.h,
	  ioloop-notify-dn.c, network.c: Added fd_set_nonblock() and
	  changed net_set_nonblock() to use it.

2005-09-25 11:07  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-cache.c, auth/main.c, deliver/deliver.c,
	  imap/main.c, lib/lib-signals.c, lib/lib-signals.h,
	  login-common/main.c, master/main.c, pop3/main.c: Implemented new
	  signal handling framework, which makes handling signals much
	  easier.

2005-09-25 10:52  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: *_strsplit_spaces(): Ignore trailing spaces.

2005-09-25 10:49  Timo Sirainen <tss@iki.fi>

	* src/lib/: ostream-file.c, ostream-internal.h, ostream.c,
	  ostream.h: Changed iov_count to be unsigned int, it's large
	  enough. Added overflow-flag which gets sent if send() failed to
	  both send and buffer the given data.

2005-09-25 10:44  Timo Sirainen <tss@iki.fi>

	* src/: lib/lib.c, lib/lib.h, lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-fields.c: Removed null4 and replaced the few
	  uses of it with buffer_append_zero().

2005-09-25 10:35  Timo Sirainen <tss@iki.fi>

	* src/lib/: hash.c, hash.h: Added hash_copy() and added some consts

2005-09-25 10:24  Timo Sirainen <tss@iki.fi>

	* src/lib/: strfuncs.c, strfuncs.h: Added p_strsplit(),
	  p_strsplit_spaces() and strarray_remove()

2005-09-25 10:20  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: minor cleanup

2005-09-25 10:19  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-epoll.c, ioloop-poll.c, ioloop-select.c,
	  ioloop.h: Added IO_ERROR condition that we can watch now.

2005-09-24 16:32  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-epoll.c: Don't leak epoll fd to child processes.
	  Memory allocations were wrong for 64bit systems. Changed the code
	  to use array_t.

2005-09-24 13:41  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: When passwd-file has %d, drop domain
	  names from username lookups only if %d was given without any
	  modifiers.

2005-09-24 12:56  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: imap.deny -> dovecot.deny

2005-09-24 12:55  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	  src/auth/auth.h, src/auth/passdb.c, src/auth/passdb.h,
	  src/master/auth-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added deny password databases.

2005-09-24 12:51  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: Read also users without password.

2005-09-24 12:25  Timo Sirainen <tss@iki.fi>

	* src/: login-common/main.c, master/login-process.c: Several fixes
	  to make running from inetd working again

2005-09-24 10:50  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-request.h: If passdb lookup fails
	  with internal error, try other passdbs anyway before returning
	  internal failure.

2005-09-24 10:49  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-blocking.c: If blocking userdb lookup fails,
	  don't crash. Also we shouldn't stop trying other userdbs then.

2005-09-24 10:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: Resizing header left header
	  offsets broken and usually assert-crashed while doing it.

2005-09-24 10:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-private.h: Added some comments

2005-09-24 09:48  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Call o_stream_uncork() after sending "+
	  OK", so it gets to client more quickly.

2005-09-24 09:47  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: client_send_line(): Try flushing output
	  immediately if buffer gets full.

2005-09-23 13:28  Timo Sirainen <tss@iki.fi>

	* configure.in: alpha3

2005-09-23 13:05  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added a warning about auth-master socket
	  permissions

2005-09-23 13:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Changed /var/run/dovecot/auth-master to
	  /var/run/dovecot-auth-master

2005-09-23 12:53  Timo Sirainen <tss@iki.fi>

	* src/auth/main.c: Increased count of UNIX socket listener backlogs
	  to 64.

2005-09-23 12:03  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/rfc822-parser.c: Parse obs-phrase correctly. Patch
	  by Chris Wakelin

2005-09-18 18:18  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added information about userdb passdb.

2005-09-18 17:50  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/mycrypt.c: And more changes to get _XPG6
	  stuff working right

2005-09-18 17:37  Timo Sirainen <tss@iki.fi>

	* src/auth/mycrypt.c: Add _XPG6 macro if needed..

2005-09-18 17:36  Timo Sirainen <tss@iki.fi>

	* src/imap/: imap-fetch-body.c, imap-search.c: Compiler warning
	  fixes

2005-09-18 17:31  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: compiler warning fix

2005-09-18 17:31  Timo Sirainen <tss@iki.fi>

	* configure.in: Added check for _XPG6 macro for crypt().

2005-09-18 17:18  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Added --build-options parameter. Patch by
	  Andrey Panin

2005-09-18 17:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: typofix in error
	  message

2005-09-18 16:58  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: If
	  o_stream_send_istream() fails, write an error to log.

2005-09-18 16:58  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: If client input was closed unexpectedly,
	  don't treat it as index error.

2005-09-18 16:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-lock.c: Don't hide error message
	  if fcntl() fails with EAGAIN/EACCES

2005-09-18 15:57  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Don't require private key
	  to be RSA

2005-09-18 15:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Partial syncs
	  caused index's next_uid to be updated even if the new mails
	  weren't added to index. That caused some UID corruption errors.

2005-09-18 15:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: When creating a new index file, mark
	  its log offsets so that the possibly existing log file is
	  completely synced. This caused marking index to be corrupted to
	  be quite useless since the same problem was again brought back
	  from the .log file.

2005-09-18 14:43  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: Make sure corking
	  is removed before calling ssl_proxy_new()

2005-09-18 14:43  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Cork/uncork the SSL socket
	  when writing. Reduces latency a lot.

2005-09-18 12:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: We were forcing a
	  maildir resync when it hadn't changed at all.

2005-09-18 11:46  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Default to ssl_disable=no always,
	  even if SSL isn't compiled in. If SSL isn't compiled in and
	  ssl_disable=no, complain immediately.

2005-09-18 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: s/SOL_TCP/IPPROTO_TCP/

2005-09-16 12:30  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: If dotlock is overwritten/deleted, say in
	  the error message how long we kept the lock.

2005-09-11 20:28  Timo Sirainen <tss@iki.fi>

	* TODO, configure.in: alpha2 released

2005-09-11 20:25  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt: Added %R and %H documentation

2005-09-11 20:22  Timo Sirainen <tss@iki.fi>

	* src/lib/var-expand.c: Added 'R' reverse modifier.

2005-09-11 19:56  Timo Sirainen <tss@iki.fi>

	* src/lib/var-expand.c: Fix to hash modifier handling

2005-09-11 13:23  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-search.c, lib-imap/imap-bodystructure.c,
	  lib-imap/imap-parser.h, lib-mail/message-header-search.c,
	  pop3-login/client-authenticate.c: Compiler warning fixes

2005-09-11 13:19  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: "stack frame changed" crashfix

2005-09-11 13:03  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: Compile fix

2005-09-11 11:53  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf:
	  s/login_process_per_user/login_process_per_connection/

2005-09-11 10:52  Timo Sirainen <tss@iki.fi>

	* src/: master/mail-process.c, master/master-settings.c,
	  master/master-settings.h, pop3/commands.c, pop3/common.h,
	  pop3/main.c: Added pop3_reuse_xuidl setting. Patch by Chris
	  Wakelin

2005-09-01 07:57  Timo Sirainen <tss@iki.fi>

	* src/lib/var-expand.c: Added 'H' hash modifier.

2005-08-28 21:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: assert fix

2005-08-28 19:28  Timo Sirainen <tss@iki.fi>

	* src/lib/: file-dotlock.c, file-dotlock.h: Support creating locks
	  with O_EXCL.

2005-08-28 19:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Compiler warning
	  fix

2005-08-28 18:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-from.c: Timezones in From-lines
	  weren't handled correctly.

2005-08-28 18:08  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Change mail setting in static userdb not to
	  use %h since it doesn't work.

2005-08-28 17:04  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: We could have written
	  corrupted data to cache file if it had just been compressed. Also
	  did some other cleanups.

2005-08-28 12:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-save.c, mbox-sync.c: Try harder
	  to notice bugs

2005-08-27 14:42  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: Fix

2005-08-27 14:35  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: If more mail comes after we have synced
	  ourself initially, don't access/show the new mails. For example
	  UIDL could have shown more than needed, and it may have expunged
	  the new mails when quitting.

2005-08-27 12:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-transaction-log.c: Index
	  creation was racy.

2005-08-27 12:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-index.c,
	  mail-transaction-log.c: When refreshing transaction log while
	  trying to find new log file, don't recreate the log file if it
	  wasn't found or was corrupted. Things have already broken at that
	  point and recreating it could cause recurseive mail_index_map()
	  call with mmap_disable=yes.

	  Also added more assert()s to check that we don't try to
	  recursively call mail_index_map().

2005-08-27 12:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c: Call mail_index_map() with
	  force=TRUE parameter. Required if mmap_disable=yes, otherwise
	  we'd be fscking our internal index built using transaction log.

2005-08-27 12:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Don't try refresh index file while
	  locking it. It just slows down things, is rarely useful and may
	  break sometimes with mmap_disable=yes. Also we were calling it
	  after mail_index_view_open() so it wasn't even working..

2005-08-27 10:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-transaction-log.c: More
	  error message fixing

2005-08-27 10:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-decisions.c,
	  mail-cache-lookup.c, mail-index-lock.c, mail-index.c,
	  mail-transaction-log.c: Removed fcntl() text from some locking
	  error messages, because if lock_method=flock, it was done using
	  flock().. Also did several s/it's/its/ in comments and one error
	  message.

2005-08-25 17:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Error message update

2005-08-25 17:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-keywords.c: We didn't add the
	  ending NUL character in keyword name, which caused more or less
	  random failures.

2005-08-19 16:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c,
	  mbox-sync-update.c: X-IMAPbase's uid-last offset was remembered
	  wrong in some cases. Added also an extra assert.

2005-08-19 15:49  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-from.c: Allow day field to
	  contain only a single digit without preceding zero/space.

2005-08-19 08:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.c: If autodetection failed, give an
	  error message so we don't just get "Failed to create storage with
	  data .."

2005-08-18 17:27  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: Don't log extra bind() errors for
	  net_listen_unix() either

2005-08-18 17:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c: Disable hardlink
	  copying until it's fixed

2005-08-18 16:59  Timo Sirainen <tss@iki.fi>

	* TODO: update

2005-08-18 16:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c: Removed fsync() call
	  when appending to transaction log file. It's not all that
	  important and just slows down.

2005-08-18 16:43  Timo Sirainen <tss@iki.fi>

	* TODO: update

2005-08-16 23:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: We weren't properly
	  checking if X-IMAPbase header was seen when we parsed X-UID
	  header. Could cause assert-crash while rewriting.

2005-08-15 10:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: If mail_get_stream() is
	  called when stream had already been used and seeked to non-start,
	  it calculated the header/body sizes wrong.

2005-08-15 09:03  Timo Sirainen <tss@iki.fi>

	* configure.in: Forgot to commit parts of the inotify patch

2005-08-14 23:19  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: net_listen(): Print bind() errors only if it's
	  not EADDRINUSE. Also do the same for listen().

2005-08-14 22:30  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-sort.c, lib-storage/index/mbox/mbox-sync.c: If
	  UID lookup doesn't return any sequences, don't crash

2005-08-14 22:08  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: The master process itself also needs the TZ
	  environment

2005-08-14 21:54  Timo Sirainen <tss@iki.fi>

	* src/: lib/ioloop-internal.h, lib/ioloop-notify-dn.c,
	  lib/ioloop-notify-inotify.c, lib/ioloop-notify-none.c,
	  lib/ioloop.c, lib/ioloop.h,
	  lib-storage/index/index-mailbox-check.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/mbox/mbox-storage.c: New inotify code and
	  notify API change. Patch by Johannes Berg

2005-08-14 20:39  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-connection.c: If UNIX socket connection
	  fails with EAGAIN, try again for a while.

2005-08-14 20:34  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-server.c: If auth worker socket isn't
	  created yet when we try to connect to it, try for 5 seconds
	  before aborting. (previous fix didn't work)

2005-08-14 19:40  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: If DEBUG environment is set,
	  module_load_dir() now prints some debugging

2005-08-14 19:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c, maildir-sync.c,
	  maildir-uidlist.c, maildir-uidlist.h: Recursive maildir uidlist
	  syncs caused assert crashes. Also did some cleanups.

2005-08-14 18:24  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-static.c: Added missing t_pop() call. static
	  userdb was broken.

2005-08-14 18:18  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-epoll.c, ioloop-poll.c, ioloop-select.c,
	  ioloop.c: If we leaked a t_pop() call, tell where it happened

2005-08-08 09:20  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-stream.c, auth-stream.h: Accidentally committed
	  earlier parts of changes to authentication streams, which tries
	  to make sure that no TABs or LFs are sent in any values to mess
	  up things. This commit now finishes it..

2005-08-07 13:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Fixed a hang if
	  parsed header was already cached.

2005-08-07 13:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Don't try to use cached
	  index if it doesn't exist anymore.

2005-08-07 13:06  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: Added some more error messages. Also if
	  net_connect_ip() gives my_ip parameter and it can't be given to
	  bind(), don't silently ignore it.

2005-08-07 12:51  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Section closing wasn't done
	  properly. Patch by Tom Alsberg

2005-08-07 11:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: If mbox file growing
	  failed, truncate it back to original size so extra NUL chars
	  aren't left at the end of it.

2005-08-07 11:41  Timo Sirainen <tss@iki.fi>

	* doc/auth-protocol.txt, doc/index.txt, src/auth/Makefile.am,
	  src/auth/auth-master-connection.c,
	  src/auth/auth-request-handler.c, src/auth/auth-request.c,
	  src/auth/auth-request.h, src/auth/auth-worker-client.c,
	  src/auth/passdb-blocking.c, src/auth/passdb-checkpassword.c,
	  src/auth/passdb.h, src/auth/userdb-blocking.c,
	  src/auth/userdb-ldap.c, src/auth/userdb-passwd-file.c,
	  src/auth/userdb-passwd.c, src/auth/userdb-sql.c,
	  src/auth/userdb-static.c, src/auth/userdb-vpopmail.c,
	  src/auth/userdb.c, src/auth/userdb.h, src/imap/client.h,
	  src/imap/cmd-idle.c, src/lib/file-cache.h, src/lib/istream.h,
	  src/lib/read-full.h, src/lib/strfuncs.c, src/lib/write-full.h,
	  src/lib-imap/imap-parser.h, src/lib-mail/message-parser.h,
	  src/lib-sql/sql-api.h, src/lib-storage/mail-storage.c,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/maildir/maildir-sync.c,
	  src/lib-storage/subscription-file/subscription-file.h,
	  src/login-common/ssl-proxy-gnutls.c,
	  src/login-common/ssl-proxy.h: s/occured/occurred/

2005-08-07 11:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-update.c, mbox-sync.c: Don't crash
	  in some situations with broken X-UID headers.

2005-07-29 09:21  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth-request-handler.c,
	  auth-request-handler.h: Removed unused code

2005-07-29 08:43  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-fetch.c, imap/commands-util.c, imap/imap-search.c,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h, pop3/client.c: Added separate
	  "temporary error" flag for mail_storage_get_last_error().

2005-07-23 21:33  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Preserve TZ environment to child processes so
	  timezones aren't lost with AIX.

2005-07-23 10:13  Timo Sirainen <tss@iki.fi>

	* src/imap/: commands-util.c, commands-util.h, imap-sync.c: Send
	  untagged FLAGS / PERMANENTFLAGS replies if keywords list changed.

2005-07-23 09:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't even open mbox file
	  when changing flags and mbox_lazy_writes=yes

2005-07-23 08:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Error handling fix, more
	  debugging and a new assert

2005-07-23 07:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: If header wasn't already
	  parsed when opening mail, we read the whole message as its header
	  and left body empty. Happened with maildir.

2005-07-22 18:41  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: ssl_cipher_list setting needs to be
	  uppercased ALL:!LOW or it won't work (there was no problem unless
	  the setting was uncommented).

2005-07-22 17:50  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/cmd-subscribe.c: Updated behavior
	  of tb-extra-mailbox-sep

2005-07-22 17:09  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Update about PAM -session.

2005-07-22 17:07  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Open/close PAM session if -session option
	  is given. Patch by Pasi Sjholm.

2005-07-22 17:01  Timo Sirainen <tss@iki.fi>

	* src/auth/password-scheme.c: digest_md5_generate(): If username
	  isn't given, give an error message instead of crashing. Mostly to
	  avoid crashing with dovecotpw utility.

2005-07-22 14:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Reverted
	  accidental commit.

2005-07-22 14:20  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/cmd-delete.c,
	  src/imap/cmd-subscribe.c, src/imap/common.h, src/imap/main.c:
	  Added tb-extra-mailbox-sep IMAP workaround.

2005-07-22 12:42  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-passwd-file.c, db-passwd-file.h,
	  passdb-passwd-file.c, userdb-passwd-file.c: Added support for
	  variables in passwd-file path.

2005-07-22 11:47  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-header-search.c: Try to compare strings even
	  if charset conversion failed.

2005-07-22 11:32  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, userdb-ldap.c: user_global_uid
	  and user_global_gid settings weren't working. Also changed them
	  to now allow named user/group.

2005-07-22 11:18  Timo Sirainen <tss@iki.fi>

	* src/login-common/client-common.c: We printed "SSL" to log for
	  localhost connections. Use "secured" instead.

2005-07-22 10:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-lock.c: added extra assert for
	  checking deadlocks

2005-07-22 10:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Fix potential
	  deadlocking while saving messages.

2005-07-21 19:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-list.c, mbox/mbox-list.c:
	  Give error message if mailbox listing fails. Don't crash with
	  mbox if .subscriptions file couldn't be opened.

2005-07-21 19:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Check that record alignmentation is
	  actually used correctly. If not, recreate the index.

2005-07-13 21:35  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: If address doesn't have a name,
	  return it as NULL instead of "". This fixes problems with some
	  clients. Patch by Chris Wakelin

2005-07-13 15:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: Keep record size divisible
	  with maximum wanted extension field alignment.

2005-07-13 15:50  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c:
	  mail_cache_register_get_list(): Allocate the returned strings
	  also from given pool to make sure they don't get changed.

2005-07-13 08:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.h:
	  Header caching was more or less broken.

2005-07-12 21:15  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-notify-dn.c, ioloop-notify-inotify.c: Set
	  close-on-exec flags for opened file descriptors.

2005-07-12 20:45  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: Several fixes to FETCHing MIME body
	  parts. [n.MIME] was completely broken.

2005-07-12 20:45  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Boundary line could have been
	  included in next message part's headers.

2005-07-12 18:14  Timo Sirainen <tss@iki.fi>

	* doc/: dovecot-ldap.conf, dovecot-sql.conf: Updates

2005-07-12 16:09  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.h: And removed the other added
	  atom-specials as well..

2005-07-12 16:08  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.h: Removed ']' from atom-specials
	  because our FETCH BODY[] handling fails then..

2005-07-12 15:54  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c: Compile fix

2005-07-12 15:53  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-notify-dn.c, ioloop-notify-inotify.c: If
	  dnotify/inotify isn't in kernel, handle the errors silently and
	  without leaking.

2005-07-12 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Notification was
	  added to maildir root always, not to the actual mailbox that was
	  being selected. Patch by Johannes Berg.

2005-07-12 15:44  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-epoll.c, ioloop-internal.h, ioloop-poll.c,
	  ioloop-select.c: data -> context/ctx naming convention replaces

2005-07-12 15:40  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-internal.h,
	  src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c,
	  src/lib/ioloop-notify-none.c, src/lib/ioloop.c: Added inotify
	  patch by Johannes Berg and did some restructuring to ioloop
	  notify internals.

2005-07-12 14:43  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-parser.c, imap-parser.h: Updated
	  IS_ATOM_SPECIAL() list and moved it to header file.

2005-07-12 14:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: Try to prevent some
	  broken keyword names.

2005-07-12 13:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.h: Removed commented code.

2005-07-12 13:40  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-select.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-status.c: Removed no-diskspace flag from
	  status reply. It wasn't working and we're going to be using
	  alert_no_diskspace callback anyway when it does work properly.

2005-07-12 13:07  Timo Sirainen <tss@iki.fi>

	* src/lib/Makefile.am: Missing array-decl.h

2005-07-12 13:06  Timo Sirainen <tss@iki.fi>

	* src/lib/: lib.h, sendfile-util.c: Include just "config.h", not
	  "../../config.h". The absolute path breaks compiling elsewhere
	  than source tree. It was earlier added to avoid some global
	  config.h files, but those shouldn't exist..

2005-07-12 13:04  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.c: Added comment about config.h hack

2005-07-12 12:58  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-passwd-file.c, db-sql.c,
	  passdb-bsdauth.c, passdb-checkpassword.c, passdb-ldap.c,
	  passdb-pam.c, passdb-passwd-file.c, passdb-passwd.c,
	  passdb-shadow.c, passdb-sql.c, passdb-vpopmail.c, userdb-ldap.c,
	  userdb-passwd-file.c, userdb-passwd.c, userdb-sql.c,
	  userdb-static.c, userdb-vpopmail.c: Removed direct config.h
	  including. I'm not sure why it was done before, probably to
	  reduce compile times a few milliseconds. Ugly anyway..

2005-07-12 12:47  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-search.c: '*' wasn't working in non-SEARCH
	  messagesets.

2005-07-12 12:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-storage.h, maildir-sync.c, maildir-uidlist.c: Store new/
	  directory's timestamp in sync_size header in index (kludgy..).
	  Fixed saving message into empty and non-synced mailboxes.

2005-07-12 12:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Keywords weren't saved to
	  index while saving.

2005-07-04 11:32  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-client-connection.c,
	  auth/auth-master-connection.c, auth/auth-master-listener.c,
	  imap/commands-util.c, imap/imap-fetch.c, lib/array-decl.h,
	  lib/array.h, lib/lib.h, lib-index/mail-cache-lookup.c,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-index-sync-ext.c,
	  lib-index/mail-index-sync-keywords.c,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-transaction-log-append.c,
	  lib-storage/mail-storage.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-keywords.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync-rewrite.c,
	  lib-storage/index/mbox/mbox-sync-update.c,
	  lib-storage/index/mbox/mbox-sync.c, master/mail-process.c: Moved
	  array declaration to array-decl.h and include it in lib.h. So
	  array.h needs to be now included to use any array_*() functions.

2005-07-03 21:35  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, pop3/client.c: Call t_push/t_pop around
	  client command execution function, so if client sends multiple
	  commands at once we don't waste memory.

2005-07-03 21:19  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-server.c: If auth worker socket isn't
	  created yet when we try to connect to it, try for 5 seconds
	  before aborting.

2005-07-03 21:09  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-search.c, lib-storage/index/index-search.c: Moved
	  sequence set range checks to imap-specific code, so that SEARCH
	  can accept sequence sets with sequence being larger than number
	  of messages in mailbox.

2005-07-03 20:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Fetching message parts or
	  virtual size from cache didn't work correctly and could have
	  crashed.

2005-07-03 20:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: If mail_cache_field_exists()
	  returns -1, we can't assume the field can be used..

2005-07-03 15:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Cache mail headers when
	  saving mails to mbox. We should cache everything, but this is a
	  start..

2005-07-03 15:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.h: Mark
	  *all* non-found headers that are registered in cache file as
	  non-found at the end of header parsing.

2005-07-03 15:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Don't crash if hdr.message-id
	  isn't set in cache file.

2005-07-03 15:09  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-fields.c, mail-cache.h: Added
	  mail_cache_register_get_list() to get a list of all registered
	  fields in cache file.

2005-07-03 14:18  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-bodystructure.c, imap-bodystructure.h: Added
	  imap_bodystructure_is_plain_7bit()

2005-07-03 14:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-mail.h: Added
	  MAIL_CACHE_FLAG_TEXT_PLAIN_7BIT_ASCII to compress simple BODY and
	  BODYSTRUCTURE replies into a single flag + message parts. Also
	  did other cleanups.

2005-07-03 13:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c,
	  index-mail.h, maildir/maildir-mail.c: Try to be a bit smarter
	  about when to parse header/body.

2005-07-03 10:51  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: Don't crash if extension
	  array isn't initialized for index map.

2005-07-03 10:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Don't store headers
	  into cache file if they are already there.

2005-07-03 10:37  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: If we seek back to
	  beginning of headers, don't call callback again for headers where
	  it was already called for.

2005-07-02 10:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-transaction.c: Saving messages crashed

2005-07-02 10:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Assert/cleanup

2005-06-30 21:36  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/printf-upper-bound.c, src/lib/sha1.c: Bad
	  endianess fix. It required that LITTLE_ENDIAN and BIG_ENDIAN were
	  already defined. Rather use WORDS_BIGENDIAN which configure
	  already sets.

2005-06-30 20:55  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/printf-upper-bound.c, src/lib/sha1.c:
	  Define I_BYTE_ORDER macro ourself because BYTE_ORDER can't seem
	  to be relied on. Fixes SHA1 giving wrong checksums at least in
	  Solaris/sparc.

2005-06-30 20:38  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2005-06-30 20:30  Timo Sirainen <tss@iki.fi>

	* src/lib/: buffer.c, buffer.h: Added buffer_update_const_data().

2005-06-30 20:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Keyword changes weren't
	  converted properly from sequences to UIDs.

2005-06-30 20:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: Makefile.am, maildir-copy.c,
	  maildir-keywords.c, maildir-keywords.h, maildir-save.c,
	  maildir-storage.c, maildir-storage.h, maildir-sync.c,
	  maildir-uidlist.c, maildir-uidlist.h, maildir-util.c: Keywords
	  are stored in maildir filename and maildir-keywords file
	  (backwards compatible with 0.99.x's .customflags file)

2005-06-28 22:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Merge changes from
	  multiple index sync records into one before actually renaming
	  maildir files.

2005-06-28 17:06  Timo Sirainen <tss@iki.fi>

	* src/: lib/array.h, lib-index/mail-index-sync-ext.c,
	  lib-index/mail-index-sync.c, lib-index/mail-index-transaction.c,
	  lib-index/mail-index.c, lib-storage/index/index-mail.c: Renamed
	  array_modifyable_*() functions. I could never remember how they
	  were named.

2005-06-28 17:05  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-server.c: Compiler warning fix

2005-06-28 11:15  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: crashfix

2005-06-28 11:13  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Yet another try at fixing APPEND.

2005-06-28 09:54  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, commands.c: Don't treat known commands with
	  (somewhat) invalid parameters as "bad commands" causing
	  disconnection. Only unknown commands.

2005-06-28 00:07  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: EOF change fix. Should
	  finally properly fix APPEND.

2005-06-27 23:32  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Yet another APPEND fix.

2005-06-17 20:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Fixed breakage
	  caused by CRLF-support.

2005-06-17 20:30  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: APPEND was broken because of recent
	  eof-change in istream-limit.

2005-06-16 19:46  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: We didn't notice if
	  messages were deleted directly from new/.

2005-06-16 19:46  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: If we have
	  rename()d more than 5 files from new/ to cur/, rescan the
	  directory again to make sure we didn't skip any files.

2005-06-16 19:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-sync-update.c: mail_cache_delete()
	  wasn't actually being called for expunged mails, so cache file
	  kept growing without ever being compressed.

2005-06-16 09:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-mail.c, mbox-sync.c: When
	  syncing mbox, update MD5 sum for mail if it changes. If we need
	  MD5 sum but it's zero, resync mbox to get it.

2005-06-16 08:21  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request-handler.c, auth-request.c,
	  auth-worker-client.c, passdb-blocking.c: Last change caused
	  user-given passwords to be cached, and later the password used
	  instead of the real one (ie. login once with correct password,
	  then you could login using whatever password as long as user is
	  cached). Clearly not good. Did several changes to make sure this
	  can't happen again.

2005-06-15 08:05  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-cache.c: Auth cache wasn't
	  working if password wasn't given (ie. didn't work for proxying).

2005-06-14 21:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c, mbox-sync.c:
	  Handle CR+LF linefeeds

2005-06-14 21:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Another
	  empty-keyword-list fix with 64bit systems

2005-06-14 21:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	  mail_index_keywords_create() crashed with 64bit systems and not
	  exactly correct with 32bit systems either, if it was given empty
	  list of keywords.

2005-06-14 10:29  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If username changes, log the change if
	  debugging is enabled.

2005-06-14 10:28  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Allow PAM to modify username.

2005-06-14 09:17  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-server.c: Destroying auth workers leaked fd.

2005-06-13 08:45  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-content-parser.c: Fixed parsing multiple
	  parameters

2005-06-09 22:29  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-limit.c: Set stream->eof immediately after we
	  have read up to our limit.

2005-06-09 18:44  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-sql.c, db-sql.h, passdb-sql.c, userdb-sql.c: Don't
	  connect to SQL database in main dovecot-auth process if we're
	  using workers to do it.

2005-06-09 18:44  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-pgsql.c, sql-api-private.h,
	  sql-api.c, sql-api.h: Added sql_connect() to do explicit
	  connecting. sql_init() no longer does.

2005-06-09 18:31  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Make MySQL connect abort in 10
	  seconds if it can't connect.

2005-06-09 18:28  Timo Sirainen <tss@iki.fi>

	* src/lib/lib-signals.c: Ignore SIGALRM, but not with SIG_IGN as it
	  causes syscalls to restart.

2005-06-09 14:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-mail.c,
	  maildir-storage.h: Use macros when using W and S extras too.

2005-06-09 14:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-mail.c,
	  maildir-storage.c, maildir-storage.h, maildir-sync.c,
	  maildir-util.c: Replaced ':' and ',' character usages with
	  #defines, so they can be changed easily if needed.

2005-06-09 13:44  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: 32bit UID/GIDs were truncated

2005-06-08 15:45  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-cache.c: Count cache hits and misses, report them
	  on SIGUSR2.

2005-06-08 13:37  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-worker-client.c, auth-worker-client.h, main.c:
	  Auth workers were leaking memory for each request. Fixed also a
	  few invalid memory accesses at deinitialization.

2005-06-05 21:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Added assert

2005-06-05 21:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Don't pass NULL date to
	  message_date_parse(). It crashes nowadays.

2005-06-05 21:40  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt: Update for login_log_format_elements setting.

2005-06-05 21:39  Timo Sirainen <tss@iki.fi>

	* doc/: dovecot-ldap.conf, dovecot-sql.conf: Don't list password
	  schemes in the files. They just get out of date.

2005-06-05 20:39  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/Makefile.am: Removed message-tokenizer code. All
	  code using it was finally replaced with rfc822-parser API.

2005-06-05 20:37  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-thread.c: Changed Message-ID parser to use
	  rfc822-parser API.

2005-06-05 20:36  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: Make Content-Language parser
	  use rfc822-parser API.

2005-06-05 20:07  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-date.c: Make date parser use rfc822-parser
	  API.

2005-06-05 20:07  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-content-parser.c: Skip initial LWSP

2005-06-05 19:32  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-content-parser.c: Converted MIME Content-*
	  header parser to use rfc822-parser API.

2005-06-05 19:32  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: rfc822-parser.c, rfc822-parser.h: Added
	  rfc822_parse_mime_token() to rfc822-parser API.

2005-05-29 10:50  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Changed output handler to work a bit
	  differently to avoid useless io_remove/io_add calls.

2005-05-29 10:50  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Set output I/O handler after output
	  callback if needed.

2005-05-29 00:26  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: Don't return random data if net_getpeername()
	  or net_getsockname() is used for non-inet/inet6 socket.

2005-05-28 15:14  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-server.c: If all auth workers have died,
	  don't complain and fail but just create and use the new process.

2005-05-28 12:51  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-client.c: If worker process has been idle
	  for 10 minutes, make it kill itself.

2005-05-28 12:34  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: auth_request_set_field() shouldn't save
	  password to extra_fields. Fixes a crash with auth_cache enabled
	  and at least with SQL/LDAP passdbs.

2005-05-28 12:17  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-seekable.c: Seekable stream was broken after its
	  memory limit was reached and it started using temporary file.

2005-05-28 11:31  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Don't remove output handler if
	  flush_pending is still set after callback.

2005-05-28 11:20  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Small optimization

2005-05-28 11:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c, mbox-sync.c:
	  Call i_stream_sync() a bit more often, especially before checking
	  file size to make sure it's not cached. Changed an assert to
	  critical error.

2005-05-25 11:39  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Don't forget o_stream_set_flush_pending()
	  call if it's called in flush callback which returns 1.

2005-05-23 22:40  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Code cleanup. Removed useless previous "fix".

2005-05-23 20:50  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Keyword resets were
	  written using sequences to transaction log, which caused keyword
	  breakages.

2005-05-23 19:51  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Parse also pop3_uidl_format setting for %m
	  case, so we know to save the MD5 sum while parsing mbox.

2005-05-23 19:46  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: If we couldn't get UIDL, also write error to
	  log.

2005-05-23 15:16  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: RSET command wasn't working right

2005-05-17 09:34  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-connection.c, auth-request.c: Master
	  connection's USER command was leaking memory (with deliver
	  binary).

2005-05-16 21:00  Timo Sirainen <tss@iki.fi>

	* src/lib/: imem.c, strfuncs.c, strfuncs.h: If p_malloc() used data
	  stack (with DEBUG enabled it might have written a warning about
	  growing memory pool), p_strconcat() gave corrupted reply. It also
	  didn't work correctly if the given pool was a data stack.

	  Also made i_strconcat() to be sure it doesn't break if
	  default_pool's p_malloc() for some reason would some day use data
	  stack.

2005-05-14 20:32  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client-authenticate.c,
	  src/imap-login/client.c, src/login-common/client-common.c,
	  src/login-common/client-common.h, src/login-common/common.h,
	  src/login-common/main.c, src/login-common/sasl-server.c,
	  src/master/login-process.c, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c,
	  src/pop3/common.h, src/pop3/main.c,
	  src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	  Added configurable logging for login process. Added configurable
	  pop3 logout string. Based on a patch by Andrey Panin.

2005-05-14 17:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: We didn't keep dirty flag
	  state long enough.

2005-05-14 14:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: last-uid fix

2005-05-14 12:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c,
	  mbox-sync-update.c: uid-last offset change fixes.

2005-05-14 12:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Pointers into file cache may change
	  as a result of file_cache_write().

2005-05-14 12:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-lookup.c: Error handling fixes

2005-05-14 12:05  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: Optimizations

2005-05-14 11:35  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: still wrong..

2005-05-14 11:32  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: fix

2005-05-14 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-fields.c, mail-cache-private.h,
	  mail-cache-transaction.c, mail-cache.c: Whenever writing to cache
	  file, also updated file_cache. Fixes problems with
	  mmap_disable=yes.

2005-05-14 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib/: file-cache.c, file-cache.h: Added file_cache_write() to
	  update cached memory area.

2005-05-13 13:35  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: if using IPv6, bind both on the IPv4 and IPv6
	  addresses if IPV6_V6ONLY is defined. Patch by Marco d'Itri

2005-05-13 13:11  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Fixed output getting stuck when transmit
	  buffer was full.

2005-05-10 21:36  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: Cache bitmask was still used wrong, maybe
	  now..

2005-05-10 21:04  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: Cache decisions were completely wrong for
	  file sizes larger than 32kB.

2005-05-10 19:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Fix to mmap_disable=yes syncing

2005-05-10 18:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Delete transaction log.2
	  file if we detect it's corrupted.

2005-05-10 17:05  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-vpopmail.c: Don't replace request->user with
	  vpw->pw_name. It drops domain part and causes userdb lookup to
	  fail.

2005-05-10 14:46  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-vpopmail.c: Compile fix

2005-05-10 14:35  Timo Sirainen <tss@iki.fi>

	* src/auth/mycrypt.c: No, #define _XPG6 was after all pre-Solaris10
	  hack...

2005-05-08 17:42  Timo Sirainen <tss@iki.fi>

	* src/auth/mycrypt.c: Added comment

2005-05-08 17:36  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: Added assert

2005-05-08 17:35  Timo Sirainen <tss@iki.fi>

	* src/auth/mycrypt.c: No, The _XPG6 define is still needed with
	  final Solaris 10 release..

2005-05-08 17:19  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Make auth worker processes work with
	  chroot enabled.

2005-05-08 17:16  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: STARTTLS was
	  broken

2005-05-08 14:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-file.c, mbox-sync.c: Added some
	  error handling code to prevent assert crashes.

2005-05-08 10:09  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-expunge.c, imap/imap-sync.c,
	  lib-index/mail-index-view-sync.c: Removed SYNC_FAST_FLAG from
	  EXPUNGE command. Changed delay-newmail workaround to also delay
	  EXPUNGE notifications, otherwise things break.  Changed index to
	  force this with assert.

2005-05-08 09:38  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: If we couldn't fetch header MD5/filename for
	  UIDL, abort instead of giving invalid UIDL.

2005-05-03 17:02  Timo Sirainen <tss@iki.fi>

	* src/lib/: failures.c, imem.h: Added i_free_and_null() macro and
	  first use case.

2005-05-03 17:02  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Compiler warning fix without DEBUG.

2005-04-29 12:46  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: If data inside
	  headers was moved within the first mail, we might have gotten
	  "uid-last unexpectedly lost" error.

2005-04-29 12:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-sync-update.c,
	  mail-index-sync.c, mail-index.c, mail-index.h: Check broken flag
	  counter values every time when updating them. Added fsck-flag to
	  index header, if it's set do fsck when opening index and when
	  syncing.

2005-04-29 11:42  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Connection could have gotten stuck sometimes,
	  doing nothing until idle timeout happens.

2005-04-29 11:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: Added offsets to log
	  file corruption error messages

2005-04-29 10:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Updated timeouts

2005-04-29 10:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Don't require
	  notify_ok/notify_no callbacks to be set. Fixes crash in deliver
	  when mbox locking messages were supposed to be shown.

2005-04-29 10:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Crashfix for some failure
	  handling.

2005-04-26 21:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: If mbox has a pseudo
	  mail, we skipped message updates in partial syncs.

2005-04-26 19:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-sync.c, mail-transaction-util.c,
	  mail-transaction-util.h: Expunge code cleanups.

2005-04-26 19:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't always sync full
	  mbox if first message is the pseudo mail.

2005-04-26 18:36  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync.c,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/index-storage.c: Compiler warning fixes when
	  DEBUG enabled.

2005-04-26 18:36  Timo Sirainen <tss@iki.fi>

	* src/lib/array.h: Still more changes to how typeof() is used. Now
	  it finally seems to be working nicely.

2005-04-26 16:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync.c,
	  mail-transaction-log-private.h, mail-transaction-log-view.c,
	  mail-transaction-log.c: Minor error checking fixes.

2005-04-26 14:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-file.c, mbox-mail.c,
	  mbox-sync-private.h, mbox-sync.c: If we see mbox offsets break,
	  don't invalidate whole index but rather force resyncing.

2005-04-26 14:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-sync.c, mbox/mbox-sync.c:
	  Don't try to handle UIDVALIDITY changes nicely after all. It
	  causes problems when within same transaction there are two
	  different set of UIDs being used.

2005-04-26 14:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync-update.c: If uid-last isn't
	  actually updated while rewriting first message, don't assume it
	  is. Fixes bogus "uid-last changed" errors.

2005-04-26 11:43  Timo Sirainen <tss@iki.fi>

	* doc/auth-protocol.txt, src/auth/auth-master-connection.c,
	  src/auth/auth-request-handler.c, src/auth/auth-request.c,
	  src/auth/auth-request.h, src/auth/auth-worker-client.c,
	  src/deliver/deliver.c: USER auth command requires now service
	  parameter and supports also others parameters. Fixes a crash in
	  dovecot-auth with deliver+mysql.

2005-04-26 11:08  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Try to flush output before uncorking

2005-04-26 10:43  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/imap-fetch-body.c, lib/ostream-crlf.c,
	  lib/ostream-file.c, lib/ostream-internal.h, lib/ostream.c,
	  lib/ostream.h, pop3/client.c: o_stream_uncork() was previously
	  always setting IO_WRITE handler even if there was no reason for
	  it. This was relied on in imap/pop3 code when a handler could
	  just send as much data as it can without actually buffering
	  anything.

	  So, removed the IO_WRITE handler forcing. It's only set if
	  there's actually data in buffer or if flush_pending is set (via
	  o_stream_set_flush_pending() or by returning 0 from flush
	  callback handler).

	  All in all, a minor optimization.

2005-04-26 09:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: If X-UIDs hadn't yet been
	  written, we resynced everything after the first message we had to
	  sync.

2005-04-26 08:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Dirty flags weren't being
	  updated correctly. Caused the same messages to be rewritten over
	  and over again, or skipping some messages causing lost flag
	  changes.

2005-04-23 20:21  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Remove compiler warnings with
	  non-DEBUG.

2005-04-23 19:56  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-create.c: Don't do invalid memory accesses if trying
	  to create empty mailbox name.

2005-04-23 19:41  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-seekable.c: Allow non-first streams also to have
	  pending data.

2005-04-23 19:35  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-seekable.c: Fixes.

2005-04-23 17:10  Timo Sirainen <tss@iki.fi>

	* src/Makefile.am: Also use the --without-deliver option to not
	  build it :)

2005-04-23 17:07  Timo Sirainen <tss@iki.fi>

	* configure.in: Added --with-deliver option.

2005-04-23 17:07  Timo Sirainen <tss@iki.fi>

	* configure.in, src/login-common/Makefile.am,
	  src/master/Makefile.am: Added --with-rundir configure option.

2005-04-23 17:02  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: save_mail() returns 0 if successful, not
	  if failed..

2005-04-23 16:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Don't call
	  index_mail_parse_header() twice when searching headers. Caused
	  assert-crashes.

2005-04-23 15:52  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: LDAP passdb finally should work again.

2005-04-23 15:46  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: Added more LDAP debugging.

2005-04-23 15:18  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log-append.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-sync-private.h,
	  lib-storage/index/mbox/mbox-sync.c: If UIDVALIDITY changes, don't
	  invalidate the whole index. Just expunge all existing messages
	  and update uidvalidity/nextuid fields. Now we don't have to
	  re-login when this happens.

2005-04-23 13:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: When removing recent
	  flags, we didn't update the recent flag count in header.

2005-04-23 09:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-private.h,
	  mail-transaction-log-view.c, mail-transaction-log.c: index.log
	  file is now rotated to .index.log.2 file. When log file is
	  missing, it's used if the wanted log is in it.

2005-04-23 09:20  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-master-listener.c: Crashfix

2005-04-23 09:11  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, mech-anonymous.c, mech-apop.c,
	  mech-login.c, mech-ntlm.c, mech-plain.c, mech-rpa.c: Grow default
	  auth_request pools to 512 bytes per request.

2005-04-23 09:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Don't crash if dotlock
	  replacing failed.

2005-04-23 08:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-cache.h,
	  mail-transaction-log.c: s/PREFIX/SUFFIX/ for .cache and .log
	  filename suffixes..

2005-04-22 20:58  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Error message fix.

2005-04-22 20:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c, mbox-sync.c:
	  Fixes to expunging first mail.

2005-04-22 20:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: When first
	  message was expunged we might have gotten "uid-last unexpectedly
	  lost" errors.

2005-04-22 19:01  Timo Sirainen <tss@iki.fi>

	* src/lib/mkdir-parents.c: Ignore if mkdir() returns ENOSYS. It
	  probably means we tried to mkdir a (NFS) mount point.

2005-04-21 16:33  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-client.c: We weren't sending proxy's
	  password back with blocking passdb.

2005-04-21 16:15  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-sql.c: Allow password field to be NULL. Needed
	  with proxies.

2005-04-19 13:27  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Crashfix in error conditions

2005-04-19 13:11  Timo Sirainen <tss@iki.fi>

	* src/auth/: Makefile.am, auth-client-connection.c,
	  auth-client-connection.h, auth-master-connection.c,
	  auth-master-connection.h, auth-master-listener.c,
	  auth-master-listener.h, auth-request-handler.c,
	  auth-request-handler.h, auth-request.h, main.c: Allow multiple
	  master connections for a single listener.

2005-04-19 06:54  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-connection.c, auth-master-connection.h,
	  main.c: Exit only if all master connections are lost, not only if
	  one of them is.

2005-04-17 16:52  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, passdb-ldap.c, userdb-ldap.c: If
	  both userdb and passdb used LDAP the later one was overriding
	  first one's attribute names.

2005-04-17 16:37  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: LSUB was returning namespace prefixes.

2005-04-17 15:59  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: If transaction log
	  file is lost, mark the index inconsistent. Later we should try to
	  autocreate the missing log files..

2005-04-17 15:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't break with empty
	  mbox files when we're not delay-writing and the mailbox hasn't
	  always been empty.

2005-04-17 15:46  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sort.c: Don't crash if SORT elements don't contain
	  headers.

2005-04-17 15:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-search.c:
	  Don't even try to allow searching zero number of headers.

2005-04-17 15:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-search.c: Some possible fix for HEADER
	  searches and cleanup

2005-04-17 15:42  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: Don't allow FETCH BODY[HEADER.FIELDS
	  ()], ie. empty list.

2005-04-17 14:57  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: If we get POLLNVAL, call the callback
	  anyway so it hopefully gets rid of the condition.

2005-04-16 22:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Raised initial pool
	  sizes.

2005-04-16 22:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index.c,
	  mail-transaction-log-append.c: mmap_disable=yes: Transaction log
	  might have been rotated before everything was committed to index.

2005-04-16 21:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: If we're updating only
	  log_file_ext_offset but log file sequence has changed, update
	  log_file_int_offset also to beginning of next file. Fixes assert
	  in mail_transaction_log_view_set().

2005-04-16 19:44  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth.c, lib/env-util.c, lib-index/mail-index.c,
	  lib-sql/driver-mysql.c, lib-storage/index/index-mail.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c, master/master-settings.c:
	  Raised initial pool sizes.

2005-04-16 19:42  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.h: Added BUFFER_APPROX_SIZE which can be used to
	  approximately calculate the memory used by buffer struct itself.

2005-04-16 19:41  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-passwd.c: Try to detect buggy NSS
	  implementations.

2005-04-16 19:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't assert-crash with
	  0-byte sized "mboxes".

2005-04-12 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail.c: Don't return void.

2005-04-12 11:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: Removed extra 0-initializers from struct
	  storage initializers. They used to be there because -W gave
	  warnings with gcc, but newer versions seem to be silent as long
	  as C99 style member initializers are used. Also fixes a compiling
	  problem with some non-gcc compilers.

2005-04-12 09:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: mail_get_headers()
	  and mail_get_first_header() returned headers with "name:" prefix
	  if they weren't in cache file.

2005-04-12 08:37  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Send all unrecognized parameters from
	  userdb to imap/pop3 processes. Useful for passing plugin
	  parameters.

2005-04-11 19:17  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: We weren't calling mail_storage_init() at
	  startup so we crashed.

2005-04-10 15:47  Timo Sirainen <tss@iki.fi>

	* src/lib/array.h: ARRAY_CREATE() macro fix. Wasn't working in all
	  situations.

2005-04-10 15:37  Timo Sirainen <tss@iki.fi>

	* configure.in, dovecot-config.in: Added

2005-04-08 15:22  Timo Sirainen <tss@iki.fi>

	* src/lib/array.h: Added ARRAY_DEFINE_EXTERN().

2005-04-08 15:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.c: Linked list -> array

2005-04-08 15:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync.c: Since we always parse the first
	  message now, there's no need ever to do sync_restart.

2005-04-08 14:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, maildir/maildir-copy.c,
	  maildir/maildir-list.c, maildir/maildir-mail.c,
	  maildir/maildir-save.c, maildir/maildir-storage.c,
	  maildir/maildir-storage.h, maildir/maildir-sync.c,
	  maildir/maildir-uidlist.c, maildir/maildir-util.c,
	  mbox/mbox-file.c, mbox/mbox-lock.c, mbox/mbox-save.c,
	  mbox/mbox-storage.c, mbox/mbox-storage.h,
	  mbox/mbox-sync-rewrite.c, mbox/mbox-sync.c: Created mbox_storage
	  and maildir_storage.

2005-04-08 13:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.c, index-storage.h,
	  maildir/maildir-copy.c, maildir/maildir-mail.c,
	  maildir/maildir-save.c, maildir/maildir-storage.c,
	  maildir/maildir-storage.h, maildir/maildir-sync.c,
	  maildir/maildir-transaction.c, maildir/maildir-uidlist.c,
	  maildir/maildir-uidlist.h, maildir/maildir-util.c,
	  mbox/mbox-file.c, mbox/mbox-file.h, mbox/mbox-lock.c,
	  mbox/mbox-lock.h, mbox/mbox-mail.c, mbox/mbox-save.c,
	  mbox/mbox-storage.c, mbox/mbox-storage.h, mbox/mbox-sync-parse.c,
	  mbox/mbox-sync-private.h, mbox/mbox-sync-rewrite.c,
	  mbox/mbox-sync-update.c, mbox/mbox-sync.c,
	  mbox/mbox-transaction.c: Moved mbox/maildir-specific variables
	  from struct index_mailbox to mbox_mailbox and maildir_mailbox.

2005-04-08 12:14  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-plain.c, lib-index/mail-cache-fields.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache.h,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.h,
	  lib-mail/istream-header-filter.c,
	  lib-mail/istream-header-filter.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h: Several size_t -> unsigned
	  int changes. Try to keep "unsigned int" for counters, size_t for
	  actual memory range sizes.

2005-04-08 12:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: buffer -> array

2005-04-08 12:04  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Removed element_count variable, it's
	  not used anymore.

2005-04-08 11:17  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: local-part in message address can
	  be quoted-string as well.

2005-04-08 10:28  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-cache.c: Don't crash if cache
	  is enabled and we're caching more than just password.

2005-04-08 10:25  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-ldap.c, passdb-sql.c: Don't crash if password
	  lookup failed.

2005-04-07 23:42  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-request.h, passdb-cache.c,
	  passdb-ldap.c, passdb-sql.c: Try to keep scheme always included
	  in auth_request->passdb_password.

2005-04-07 23:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Don't crash at mail_cache_lock() if
	  mail_cache_map() fails.

2005-04-07 23:19  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-status.c: STATUS command was replying with wrong
	  hierarchy separator if it wasn't default one.

2005-04-07 23:06  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: t_strarray_join() wasn't actually marking the
	  memory allocated that it was returning from data stack. So it
	  might have returned garbage.

2005-04-07 23:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: If keyword was set for
	  message whose seq != uid, we broke index.

2005-04-07 22:44  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Don't panic in stat().
	  o_stream_send_istream() wants to know the file size.	It settles
	  for "unknown" fine, so return that.

2005-04-07 22:37  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-vpopmail.c: Compile fix.

2005-04-07 22:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync-update.c,
	  mbox-sync.c: Large mbox code cleanups, especially related to
	  X-IMAP/X-IMAPbase header handling. uid-next field is updated now
	  every time while syncing.

	  If partial syncing failed, we weren't re-requesting all sync
	  records from index, which could have caused some changes to be
	  lost, and possibly caused some index corruption errors later on.

	  Several other more or less possible problems fixed.

2005-04-07 22:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync.c, mail-index.h: Added
	  mail_index_sync_reset() to restart syncing from beginning.

2005-04-07 22:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: Non-Recent
	  Status-flag wasn't updated correctly.

2005-04-07 22:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Don't crash while saving
	  message if keywords aren't given..

2005-04-07 21:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Last cleanup broke opening
	  mailboxes completely.

2005-04-03 11:36  Timo Sirainen <tss@iki.fi>

	* src/: deliver/deliver.c, imap/namespace.c,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c, pop3/client.c,
	  pop3/main.c: Moved several getenv()s from lib-storage to main
	  code. deliver binary was missing several getenvs..

2005-04-02 22:44  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/common.h,
	  src/imap/imap-fetch-body.c, src/imap/main.c: Removed
	  tb-negative-fetch workaround. It shouldn't be needed anymore
	  because of the FETCH ordering changes.

2005-04-02 22:38  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-sql.conf: Added information about "user" column.

2005-04-02 22:00  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-worker-client.c,
	  passdb-blocking.c, passdb-bsdauth.c, passdb-passwd-file.c,
	  passdb-passwd.c, passdb-shadow.c, passdb-vpopmail.c: passdb can
	  now change the username that was used to log in. This is mostly
	  useful to support case-insensitive username lookups.

2005-04-02 21:20  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-client.c: Auth workers weren't working
	  correctly with more than one passdb/userdb.

2005-04-02 21:12  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Compile fix for recent mailbox_open() API
	  change.

2005-04-02 21:08  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.h, imap/cmd-append.c, imap/cmd-select.c,
	  imap/commands-util.c, imap/commands-util.h, lib/array.h,
	  lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-keywords.c,
	  lib-index/mail-index-sync-private.h, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log-append.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-mail.c,
	  lib-storage/index/index-mail.h, lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync-private.h,
	  lib-storage/index/mbox/mbox-sync-rewrite.c,
	  lib-storage/index/mbox/mbox-sync-update.c,
	  lib-storage/index/mbox/mbox-sync.c: Keywords are now stored in
	  X-Keywords headers in mbox. Did several related API changes to
	  get better performance.

2005-04-02 19:31  Timo Sirainen <tss@iki.fi>

	* src/: lib/array.h, lib-index/mail-index-sync-private.h: Added
	  ARRAY_DEFINE_PTR() which needs to be used instead of
	  ARRAY_DEFINE() for pointers.

2005-04-02 19:29  Timo Sirainen <tss@iki.fi>

	* src/lib/: buffer.c, buffer.h: Added buffer_cmp().

2005-04-02 17:37  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: Fetching partial headers crashed
	  because of recent changes.

2005-03-29 19:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-save.c, mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-update.c, mbox-sync.c: Recent flag
	  handling cleanups. Added some comments.

2005-03-29 16:52  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sort.c: SORT might have crashed just before
	  finishing.

2005-03-29 16:48  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/mail-storage-private.h,
	  lib-storage/mail-storage.h, lib-storage/mail.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/maildir/maildir-mail.c,
	  lib-storage/index/mbox/mbox-mail.c, imap/imap-sort.c,
	  imap/imap-thread.c: Renamed mail_get_header() to
	  mail_get_first_header() and mail_gets_headers() to
	  mail_get_header_stream(). Added new mail_get_headers() which
	  returns NULL-terminated string list of all found headers.

2005-03-29 15:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c,
	  index-mail.h: Changed some buffers to arrays.

2005-03-29 15:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't crash when
	  closing streamed mbox.

2005-03-29 13:33  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/mail-storage-private.h,
	  lib-storage/mail-storage.c, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-storage.c, imap/cmd-append.c,
	  imap/cmd-copy.c, imap/cmd-select.c, imap/cmd-status.c,
	  lib-storage/index/mbox/mbox-file.c,
	  lib-storage/index/mbox/mbox-lock.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync.c, pop3/client.c: Added input
	  stream parameter to mailbox_open(). With mbox it now allows
	  opening a read-only mbox using a stream.

2005-03-29 13:30  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, istream-seekable.c, istream-seekable.h:
	  Added istream-seekable, which allows combining multiple input
	  streams and creating a single seekable stream out of them.

2005-03-29 12:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache.c,
	  mail-index-lock.c, mail-index-private.h, mail-index-sync.c,
	  mail-index.c, mail-transaction-log-append.c,
	  mail-transaction-log-private.h, mail-transaction-log.c: In-memory
	  indexes work again. Just pass dir as NULL to mail_index_alloc().

2005-03-29 10:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  istream-raw-mbox.h, mbox-sync-private.h, mbox-sync-rewrite.c,
	  mbox-sync.c: i_stream_sync() replaced istream_raw_mbox_flush().
	  Use i_stream_stat() instead of fstat() directly. Now we have the
	  possibility to use istreams as read-only mboxes.

2005-03-29 10:28  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-data.c, lib/istream-file.c,
	  lib/istream-internal.h, lib/istream-limit.c, lib/istream-mmap.c,
	  lib/istream.c, lib/istream.h, lib/ostream-file.c,
	  lib-mail/istream-header-filter.c: Replaced i_stream_get_size()
	  with i_stream_stat(). Added i_stream_sync().

2005-03-28 22:35  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-internal.h, istream.c, istream.h:
	  i_stream_next_line() works now even if the stream buffer can't be
	  directly modified.

2005-03-28 13:06  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-data.c, lib/istream-file.c,
	  lib/istream-limit.c, lib/istream-mmap.c, lib/istream.h,
	  lib-mail/istream-header-filter.c: Added seekable variable to
	  struct istream.

2005-03-27 16:38  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Changed alloconly pools to call
	  malloc() only once when creating the pool.  Pool names aren't
	  used anymore without DEBUG. Don't immediately double the pool's
	  initial size for the first allocated block.

2005-03-27 14:42  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.c, src/lib/compat.h: Added setegid()
	  emulation for HP-UX.

2005-03-27 14:36  Timo Sirainen <tss@iki.fi>

	* configure.in: oops, broke fd pass check completely

2005-03-27 14:11  Timo Sirainen <tss@iki.fi>

	* configure.in: Make sure "whether fd passing works" check doesn't
	  get stuck (HP-UX fix).

2005-03-27 13:51  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, buffer.c, istream-file.c, mempool.c,
	  mempool.h, ostream-file.c: Added pool_get_exp_grown_size(). Use
	  it for buffers, istreams and ostreams when buffer needs to grow.
	  Optimizes memory usage a bit.

2005-03-27 13:29  Timo Sirainen <tss@iki.fi>

	* src/lib/: mempool-alloconly.c, mempool-datastack.c,
	  mempool-system.c, mempool-unsafe-datastack.c, mempool.h: Added
	  p_get_max_easy_alloc_size().

2005-03-27 13:29  Timo Sirainen <tss@iki.fi>

	* src/lib/: data-stack.c, data-stack.h: Added
	  t_get_bytes_available().

2005-03-27 12:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync.c,
	  mail-index-transaction.c, mail-index.c, mail-index.h: Changed
	  keywords_buf to array. Added mail_index_sync_get_keywords().

2005-03-27 11:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync-update.c, mbox-sync.c: Changed
	  mails and syncs buffers to arrays.

2005-03-24 22:38  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-ntlm.c: Fixes incorrect error message and adds
	  missing hex_to_binary() return value check. Patch by Andrey
	  Panin.

2005-03-24 22:37  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-rpa.c: Proper realm support for RPA. Now RPA will
	  use auth_realms and auth_default_realm configuration parameters
	  instead of my_hostname variable.  Patch by Andrey Panin.

2005-03-24 22:35  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-worker-client.c: Previous blocking passdb patch
	  fixed APOP only. Fixing others now. Patch by Andrey Panin.

2005-03-24 22:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Blank line was missing at
	  the end of the created pseudo mail.  s/dummy/pseudo/ to be more
	  consistent.

2005-03-24 22:27  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: Skip LWSP at the beginning of
	  address.

2005-03-24 22:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-index-private.h, mail-index.c:
	  Added sync/sync_lost/expunge handler unregistering, and also do
	  that. Fixes crash with mmap_disable=yes when reopening mailbox.

2005-03-24 21:00  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Array code changes broke
	  setting old_data_r in mail_index_update_ext(). This kept breaking
	  cache file.

2005-03-24 20:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_write_base_header() didn't
	  update the header in memory with mmap_disable=no. It's used only
	  with error correction, so after failure trying to reopen index
	  failed every time.

2005-03-24 20:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: If want_mail = TRUE for
	  mbox_save_init() and we sync the mbox, we'll have to open a new
	  view to get the next_uid or it might not be updated.

2005-03-24 20:09  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: Added assert.

2005-03-24 20:03  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Eat away the finishing empty line if
	  APPEND failed so we don't send "* BAD" error to client.

2005-03-24 18:05  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: If transaction log record
	  size is too large, mark the file corrupted.

2005-03-18 19:45  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: We weren't returning "root name" properly
	  with LIST <ref> "".

2005-03-18 18:49  Timo Sirainen <tss@iki.fi>

	* src/imap/: imap-fetch-body.c, imap-fetch.c, imap-fetch.h: Send
	  buffered fetch items to client first. Fixes kmail and Thunderbird
	  issues..

2005-03-18 17:34  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c: Compiler warning fix

2005-03-18 17:33  Timo Sirainen <tss@iki.fi>

	* src/lib/array.h: ARRAY_SET_TYPE() in non-DEBUG-mode was giving
	  errors with older gccs if it was used at the beginning of a
	  function (function can't start with ";").

2005-03-16 20:18  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-worker-client.c, passdb.c, passdb.h:
	  Non-plaintext blocking passdb authentication wasn't working.
	  Patch by Andrey Panin.

2005-03-16 19:03  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, passdb-ldap.c, userdb-ldap.c: LDAP
	  crashfixes.

2005-03-15 22:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-mail.c: get_physical_size() was
	  crashing if mbox hadn't been opened yet.

2005-03-15 21:52  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-append.c, cmd-copy.c, cmd-status.c,
	  commands-util.c, commands-util.h: mailbox_name_equals() renamed
	  to mailbox_equals(), which also now checks that mail storages
	  match. Fixes problems with copying messages from one namespace to
	  another between identically named mailboxes.

2005-03-15 19:01  Timo Sirainen <tss@iki.fi>

	* src/: deliver/deliver.c, imap/cmd-append.c, imap/cmd-copy.c,
	  imap/cmd-search.c, imap/cmd-store.c, imap/common.h,
	  imap/imap-expunge.c, imap/imap-fetch-body.c, imap/imap-fetch.c,
	  imap/imap-fetch.h, imap/imap-sort.c, imap/imap-sync.c,
	  imap/imap-thread.c, imap/main.c, imap/namespace.c,
	  lib-storage/Makefile.am, lib-storage/mail-copy.c,
	  lib-storage/mail-copy.h, lib-storage/mail-storage-private.h,
	  lib-storage/mail-storage.c, lib-storage/mail-storage.h,
	  lib-storage/mail.c, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-transaction.c,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-mail.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-transaction.c,
	  lib-storage/index/mbox/mbox-mail.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h,
	  lib-storage/index/mbox/mbox-transaction.c, pop3/client.c,
	  pop3/commands.c: Major mail-storage API changes. It's now a bit
	  cleaner and much more plugin friendly. Removed proxy_mailbox*
	  stuff, they were difficult to use and there's now much easier way
	  to replace them.

2005-03-15 18:58  Timo Sirainen <tss@iki.fi>

	* src/lib/array.h: Added ARRAY_INIT for initializing array_t in
	  structs.

2005-03-15 11:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage.h, index/index-mail.c,
	  index/maildir/maildir-mail.c, index/mbox/mbox-mail.c: Include
	  transaction pointer in struct mail.

2005-03-14 22:29  Timo Sirainen <tss@iki.fi>

	* configure.in: Limit TIME_T_MAX_BITS to 40.

2005-03-14 21:44  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: listen port comment updates. Patch by
	  Reuben Farrelly.

2005-03-14 21:17  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/cmd-fetch.c, src/imap/common.h,
	  src/imap/imap-sync.c, src/imap/main.c,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-sync.c: Renamed oe6-fetch-no-newmail
	  workaround to delay-newmail and changed it to work more like the
	  name says: only newmail notifications are skipped and not only
	  for FETCH command.

2005-03-14 20:48  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync.c, lib-index/mail-index-view-sync.c,
	  lib-index/mail-index.h, lib-index/mail-transaction-util.c,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-sync.c: mail_index_sync_next()
	  now returns keyword updates (now only thing left to do is to fix
	  maildir and mbox syncing to use them).

2005-03-14 20:22  Timo Sirainen <tss@iki.fi>

	* src/auth/mycrypt.c: Remove #define _XPG6 after all. It was used
	  to avoid #error in Solaris 10 pre-release, but now it breaks the
	  compile in 10 final...

2005-03-14 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: If mailbox name was missing from
	  message address, we didn't set it to MISSING_MAILBOX as we should
	  have, which caused crashing if the field was tried to be
	  SEARCHed. Also cleaned up the code a bit.

2005-03-14 14:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: When writing the dummy
	  message after all messages were expunged from mbox, the
	  UIDVALIDITY value was set to 0 if X-IMAP/X-IMAPbase header wasn't
	  read.  This caused the next parsing to treat the header invalid
	  and didn't recognize it as dummy message.

2005-03-12 23:51  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/deliver/.cvsignore,
	  src/deliver/Makefile.am, src/deliver/deliver.c: Added initial
	  version of Dovecot LDA.

2005-03-12 23:10  Timo Sirainen <tss@iki.fi>

	* src/: lib/data-stack.c, lib/ioloop-epoll.c,
	  lib/mempool-alloconly.c, lib/mempool-system.c,
	  lib/process-title.c, lib/restrict-access.c, auth/passdb-pam.c: If
	  we run out of memory, exit with FATAL_OUTOFMEM status instead of
	  dumping core. Also changed a few other i_panic() calls to others.

2005-03-12 22:48  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Don't give NULL parameters to printf's
	  %s format. Fixes crash with Solaris and some others.

2005-03-12 22:44  Timo Sirainen <tss@iki.fi>

	* src/lib/array.h: #ifdefs were wrong, we need both __GNUC__ and
	  DEBUG to do type checking.  Added new ARRAY_TYPE_CHECKS macro
	  which can also be defined manually to enable it.

2005-03-12 22:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction-view.c,
	  mail-index-transaction.c: ARRAY_ARG_SET_TYPE() ->
	  ARRAY_SET_TYPE()

2005-03-12 22:38  Timo Sirainen <tss@iki.fi>

	* src/lib/array.h: Renamed ARRAY_ARG_SET_TYPE() to ARRAY_SET_TYPE()
	  and updated comments.

2005-03-12 18:32  Timo Sirainen <tss@iki.fi>

	* src/lib/array.h: Updated example code, it was using older API..

2005-03-12 18:20  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Crashfix. Patch by Andrey Panin.

2005-03-12 18:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-lookup.c, mail-cache-private.h,
	  mail-cache.c, mail-index-private.h, mail-index-sync-ext.c,
	  mail-index-sync-keywords.c, mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-sync.c,
	  mail-index-transaction-private.h, mail-index-transaction-view.c,
	  mail-index-transaction.c, mail-index-view.c, mail-index.c,
	  mail-transaction-log-append.c: Changed many buffers to arrays.
	  Cleans up the code a lot.

2005-03-12 18:15  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, array.h, lib.h: Added dynamic array
	  implementation. When compiling with gcc and DEBUG enabled, gcc
	  checks type safety at compile time.

2005-03-12 12:24  Timo Sirainen <tss@iki.fi>

	* src/lib/: buffer.c, buffer.h: Minor cleanup: added _r suffix to
	  used_size pointer parameters.

2005-03-12 12:22  Timo Sirainen <tss@iki.fi>

	* src/lib/lib.h: extern was missing from null4 declaration.

2005-03-12 12:04  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: Code cleanups

2005-03-08 10:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Space reservation fixes
	  and cleanups.

2005-03-07 20:21  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-connection.c, auth-request.c,
	  auth-request.h, auth-worker-client.c: Handle USER requests from
	  master connections.

2005-03-07 19:16  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-worker-client.c, userdb-blocking.c: Blocking
	  userdb: Don't break if user wasn't found.

2005-03-07 18:55  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-master-connection.c,
	  src/auth/auth-request.c, src/auth/auth-request.h,
	  src/auth/auth-worker-client.c, src/auth/auth.c, src/auth/auth.h,
	  src/auth/main.c, src/auth/passdb-blocking.c, src/auth/passdb.c,
	  src/auth/passdb.h, src/auth/userdb-blocking.c,
	  src/auth/userdb-blocking.h, src/auth/userdb.c, src/auth/userdb.h,
	  src/master/auth-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Replaced userdb/passdb settings
	  with blocks so it's possible to give multiple ones. Plaintext
	  password mechanisms now support handling multiple passdbs, but
	  others don't yet. Also fixed a few memory leaks.

2005-03-07 09:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Don't return value from
	  void function.

2005-03-05 20:02  Timo Sirainen <tss@iki.fi>

	* src/master/: main.c, master-settings.h: Give more understandable
	  error message if imap/pop3 listen ports conflict.

2005-03-05 19:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-private.h,
	  mail-transaction-log-view.c, mail-transaction-log.c,
	  mail-transaction-log.h: Several transaction log cleanups and
	  fixes.

2005-03-05 19:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index.c: Assert if
	  mail_index_map() is called recursively.

2005-03-05 19:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c: When rotating log,
	  we locked index and tried to use its header. We didn't call
	  mail_index_map() however to update the header..

2005-03-05 19:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index.c: Some error
	  handling path crashfixes.

2005-03-05 19:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: We might have skipped
	  transaction log records when syncing if log file was just
	  rotated.

2005-03-05 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Cache file space
	  reservation assertfix.

2005-03-05 19:03  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: If we failed to lock the dotlock, don't
	  try to close the file twice.

2005-03-05 12:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-transaction-log-append.c,
	  mail-transaction-log-view.c, mail-transaction-log.c,
	  mail-transaction-log.h: We could have gone past the transaction
	  log view's boundaries if log was just rotated. Plus other
	  transaction log cleanups, fixes and new asserts.

2005-03-05 11:57  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-cache.c: auth_cache_insert(): Don't remove expired
	  nodes just because they're expired. Before inserting a node, make
	  sure it doesn't already exist (expired).

2005-03-05 11:48  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request-handler.c, auth-request.c,
	  auth-request.h, passdb-blocking.c, passdb-cache.c,
	  passdb-cache.h: Added state variable for auth_request and several
	  assertions to make sure the state is always valid. Fixed assert
	  crash when a user having cached passdb entry expired tried to
	  authenticate.

2005-03-05 10:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: hdr_size fix

2005-03-05 10:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-append.c,
	  mail-transaction-log.c, mail-transaction-log.h: Added versioning
	  to transaction log header. Added create_stamp to its header and
	  it's not used to determine if the transaction log should be
	  rotated, not the last time the log was updated. So now if the log
	  is over 128kB, it's rotated as soon as it's at least 5 minutes
	  old.

2005-03-02 20:46  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-worker-client.c, auth-worker-client.h,
	  auth-worker-server.c, auth-worker-server.h, passdb-blocking.c,
	  passdb-blocking.h, userdb-blocking.c, userdb-blocking.h: Forgot
	  to add for blocking passdb/userdb workers..

2005-02-28 22:41  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-cache.c, auth-cache.h, auth-request.c,
	  passdb-cache.c, passdb-cache.h: Fallback to using expired records
	  from auth cache if database lookups fail.

2005-02-28 22:19  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/Makefile.am,
	  src/auth/auth-master-connection.c,
	  src/auth/auth-master-connection.h,
	  src/auth/auth-request-handler.c, src/auth/auth-request-handler.h,
	  src/auth/auth-request.c, src/auth/auth-request.h,
	  src/auth/auth.c, src/auth/auth.h, src/auth/common.h,
	  src/auth/main.c, src/auth/passdb-bsdauth.c,
	  src/auth/passdb-checkpassword.c, src/auth/passdb-ldap.c,
	  src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c,
	  src/auth/passdb-passwd.c, src/auth/passdb-shadow.c,
	  src/auth/passdb-sql.c, src/auth/passdb-vpopmail.c,
	  src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb-ldap.c,
	  src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c,
	  src/auth/userdb-sql.c, src/auth/userdb-static.c,
	  src/auth/userdb-vpopmail.c, src/auth/userdb.h,
	  src/master/auth-process.c, src/master/common.h,
	  src/master/main.c, src/master/master-settings.c,
	  src/master/master-settings.h: Restructuring of auth code.
	  Balancer auth processes were a bad idea. Usually the balancer
	  itself took as much CPU as the actual workers because it acted as
	  a proxy.

	  Now auth worker means different thing: they're used to execute
	  blocking passdb and userdb queries. Currently just MySQL (PAM and
	  checkpassword in TODO).

2005-02-28 22:15  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, unix-socket-create.c,
	  unix-socket-create.h: Added unix_socket_create().

2005-02-26 23:21  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Last changes broke proxying when user
	  was in auth cache.

2005-02-26 23:19  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/sql-api.c: Forgot the actual sql_get_flags()
	  function.

2005-02-26 23:16  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-pgsql.c, sql-api-private.h,
	  sql-api.h: Added sql_get_flags() function, currently returning
	  only SQL_DB_FLAG_BLOCKING.

2005-02-26 22:55  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, auth-request.h, db-ldap.c,
	  passdb-bsdauth.c, passdb-cache.c, passdb-cache.h,
	  passdb-checkpassword.c, passdb-ldap.c, passdb-pam.c,
	  passdb-passwd-file.c, passdb-passwd.c, passdb-shadow.c,
	  passdb-sql.c, passdb-vpopmail.c, passdb.c, passdb.h,
	  userdb-ldap.c: Moved cache handling from sql/ldap-specific code
	  to generic auth-request code. Did some small optimizations on the
	  way.

2005-02-12 14:05  Timo Sirainen <tss@iki.fi>

	* configure.in, src/master/mail-process.c: If setpriority() is
	  found, allow userdb set mail processes' priority by returning
	  nice parameter.

2005-02-12 13:47  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-client-connection.c,
	  auth/auth-master-connection.c, auth/auth-request.c,
	  auth/auth-request.h, auth/db-ldap.c, auth/db-ldap.h,
	  auth/passdb-cache.c, auth/passdb-ldap.c, auth/passdb-sql.c,
	  auth/userdb-ldap.c, auth/userdb-passwd-file.c,
	  auth/userdb-passwd.c, auth/userdb-sql.c, auth/userdb-static.c,
	  auth/userdb-vpopmail.c, auth/userdb.h, master/mail-process.c:
	  userdb can now return extra parameters to master. Removed special
	  handling of home/mail wherever possible, they're just regular
	  extra parameters now.  LDAP passdb and static userdb can return
	  extra parameters now.

2005-02-12 09:36  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Don't crash if client disconnects in the
	  middle of APPEND. The last fix was incorrect.

2005-02-11 18:14  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-fetch.c, imap-fetch.c, imap-fetch.h: If UID FETCH
	  notices in the middle of fetching that message is expunged, don't
	  fail but just don't return all the data.

2005-02-09 22:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: cache growing crashfix

2005-02-09 21:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: lstat() the root
	  directory before trying to mkdir() it.

2005-02-09 21:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: code cleanup

2005-02-09 20:13  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: compile fixes

2005-02-09 20:12  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-rpa.c: Realm fixes. Patch by Andrey Panin

2005-02-08 23:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Keyword reset crashfix

2005-02-08 22:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Don't crash with empty
	  keyword lists.

2005-02-08 22:50  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c: forgot to add

2005-02-08 22:44  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Don't allow duplicate extension names
	  in index header.

2005-02-08 12:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: Makefile.am, mail-index-sync.c,
	  mail-transaction-log-private.h, mail-transaction-log.c: Moved
	  code into mail-transaction-log-append.c

2005-02-08 11:16  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-select.c, cmd-unselect.c: Don't try to access
	  closed mailbox after the closing gives an error.

2005-02-08 11:03  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added a reminder about needing a default
	  namespace.

2005-02-08 10:52  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-sql.c: Fixes credentials retrieving from sql
	  passdb. Patch by Andrey Panin.

2005-02-08 10:40  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: small updates

2005-02-05 18:07  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-append.c, cmd-authenticate.c,
	  cmd-capability.c, cmd-check.c, cmd-close.c, cmd-copy.c,
	  cmd-create.c, cmd-delete.c, cmd-examine.c, cmd-expunge.c,
	  cmd-fetch.c, cmd-idle.c, cmd-list.c, cmd-login.c, cmd-logout.c,
	  cmd-lsub.c, cmd-namespace.c, cmd-noop.c, cmd-rename.c,
	  cmd-search.c, cmd-select.c, cmd-sort.c, cmd-status.c,
	  cmd-store.c, cmd-subscribe.c, cmd-thread.c, cmd-uid.c,
	  cmd-unselect.c, cmd-unsubscribe.c, commands-util.c,
	  commands-util.h, commands.h, imap-fetch-body.c, imap-fetch.c,
	  imap-fetch.h, imap-search.c, imap-search.h, imap-sort.c,
	  imap-sort.h, imap-sync.c, imap-sync.h, imap-thread.c,
	  imap-thread.h: Moved command-specific variables from struct
	  client to struct client_command_context and changed code to use
	  it.

2005-02-05 18:05  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-dummy-view.c, mail-index-sync.c,
	  mail-index-view-private.h: Keep index pointer in dummy views.

2005-02-05 14:45  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.h, commands-util.h, commands.h: cleanups

2005-02-05 12:01  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-store.c,
	  lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-keywords.c,
	  lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-index/mail-transaction-util.c, lib-storage/mail-copy.c,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: Internal changes in how
	  keywords are handled. struct mail_keywords isn't automatically
	  freed anymore, added *_keywords_free() for that.

2005-02-04 21:34  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: cleanups / minor fixes

2005-02-01 20:21  Timo Sirainen <tss@iki.fi>

	* src/: pop3-login/client-authenticate.c, pop3/capability.h: Don't
	  advertise USER capability if we're not allowing plaintext
	  authentication.

2005-02-01 18:14  Timo Sirainen <tss@iki.fi>

	* configure.in: -gnu99 was set again after it was optionally set..

2005-01-31 19:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-sync.c: Recent flags weren't
	  being removed from index causing needless syncing.

2005-01-31 18:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: cleanup

2005-01-31 18:52  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Inode info wasn't saved when using
	  file_dotlock_open() so file_dotlock_delete() thought it was
	  overridden and didn't delete it.

2005-01-31 18:19  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: And a non-crashing fix.

2005-01-31 18:17  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Don't crash if client disconnects in the
	  middle of APPEND.

2005-01-31 18:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-cache.h, mail-index.c: Don't
	  complain about cache indexid changing when recreating index.

2005-01-30 13:03  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: compile fix

2005-01-30 09:04  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-passwd-file.c: userdb passwd-file wasn't working.
	  Patch by Joseph Tam.

2005-01-30 08:58  Timo Sirainen <tss@iki.fi>

	* src/login-common/main.c: inetd startup wasn't working. Patch by
	  Magnus Holmgren.

2005-01-30 08:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: If
	  maildir-shared exists in the Maildir root, copy it for each
	  created mailbox.

2005-01-30 07:59  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: Treat
	  ::ffff:127.* addresses as secure as well.

2005-01-26 18:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: Don't crash when extension
	  header is resized and there are extensions after it.

2005-01-22 23:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: optimization.

2005-01-22 23:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: one more fix

2005-01-22 22:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: still not right

2005-01-22 22:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: and more fixing..

2005-01-22 22:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: fix

2005-01-22 22:47  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: fixes

2005-01-22 22:34  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: extra assert to make sure
	  struct mail_keywords isn't tries to be used between multiple
	  indexes.

2005-01-22 22:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: fix

2005-01-22 16:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: Makefile.am, mail-index-dummy-view.c,
	  mail-index-sync-private.h, mail-index-sync.c,
	  mail-index-transaction.c, mail-index-view-private.h: Instead of
	  using separate transaction sorting code for syncing, just put the
	  data from transactions into a temporary transaction and read it
	  from there.

2005-01-22 16:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction-private.h,
	  mail-index-transaction.c, mail-index.h: Added
	  mail_index_update_flags_range() and optimized the non-range
	  version as well.

2005-01-22 16:41  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: \Seen flag wasn't actually being set with
	  RETR.

2005-01-22 16:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.h: Added padding field
	  explicitly for struct mail_transaction_flag_update. It was done
	  before anyway by compiler.

2005-01-18 23:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: When all mails have been
	  expunged, write dummy message.

2005-01-18 23:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync.c: Don't allow X-UID headers
	  larger than current next-uid.

2005-01-17 13:18  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: The actual fix for last commit..

2005-01-17 13:02  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sync.c: FETCH deinitialization wasn't done properly

2005-01-16 19:18  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-dotlock.c, lib/file-dotlock.h,
	  lib-index/mail-cache-compress.c, lib-index/mail-cache-private.h,
	  lib-index/mail-cache.c, lib-index/mail-index-private.h,
	  lib-index/mail-transaction-log-private.h,
	  lib-index/mail-transaction-log.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/mbox/mbox-lock.c,
	  lib-storage/subscription-file/subscription-file.c: Changed
	  dotlocking API.

2005-01-16 18:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-ext.c, mail-index.c: Added
	  asserts

2005-01-16 18:34  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Removed assert which
	  crashed us every time we were setting flags to messages in
	  non-increasing order (could be done only with POP3).

2005-01-16 18:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: When we detect cache corruption, just
	  mark the cache as unusable instead of immediately closing the
	  file and unmapping. It's too difficult to keep track of all the
	  possible ways in which that can break and cause "bad file
	  descriptor" errors and maybe crashes..

2005-01-16 18:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: crashfix

2005-01-16 17:11  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-ldap.c, userdb-ldap.c: Fixes by Kazuo Moriwaka

2005-01-16 16:59  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: FETCH BODY[] wasn't setting \Seen flag.

2005-01-16 16:47  Timo Sirainen <tss@iki.fi>

	* src/auth/password-scheme-md5crypt.c: MD5crypt was broken with
	  64bit systems.

2005-01-15 18:15  Timo Sirainen <tss@iki.fi>

	* src/lib/sendfile-util.c: Don't call sendfile() if count=0. With
	  FreeBSD this fixes an assert crash.

2005-01-15 13:43  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't use -std=gnu99 if gcc doesn't support it.

2005-01-15 13:09  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: static -> dynamic keyword
	  buffer. It's not actually possible to know the minimum needed
	  size for the buffer beforehand.

2005-01-13 20:33  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Change effective GID as well before
	  trying chdir() to mail directory.

2005-01-13 18:37  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, passdb-ldap.c, userdb-ldap.c: Move default
	  filters/attrs to setting defaults rather than check it from code.
	  Also fixes a crash.

2005-01-13 18:04  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: MIME boundary parsing fix.

2005-01-13 17:52  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/rfc822-parser.c: Quoted strings were parsed wrong.

2005-01-13 13:37  Timo Sirainen <tss@iki.fi>

	* configure.in: Give -std=gnu99 option to gcc.

2005-01-12 21:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction.c, mail-transaction-log.c:
	  Fixed crashes with keywords code when copying/saving many mails.

2005-01-12 12:14  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: Don't allow multiple PASS
	  commands after a USER command. Patch by Andrey Panin.

2005-01-11 00:13  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/passdb-ldap.c,
	  src/auth/userdb-ldap.c: Support variables in LDAP base setting.

2005-01-10 23:44  Timo Sirainen <tss@iki.fi>

	* TODO: sorted things

2005-01-10 17:37  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-store.c, lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-keywords.c,
	  lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-index/mail-transaction-log.c,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-mail.c,
	  lib-storage/index/index-mail.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.h: Keyword fixes.

2005-01-10 16:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: don't allocate
	  memory from data stack uselessly.

2005-01-09 20:12  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, log.c, log.h, login-process.c,
	  mail-process.c: Disable log throttlong for auth process, and for
	  login processes if login_process_per_connection=no.

2005-01-09 19:56  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/pop3-proxy.c: If login failed, send it as "-ERR
	  [IN-USE]" rather as IMAP's "* BYE"..

2005-01-09 19:10  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-master-connection.c: Don't close balancer listener
	  after one worker has connected..

2005-01-09 19:09  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Don't send balancer listener fd to
	  auth workers.

2005-01-09 18:52  Timo Sirainen <tss@iki.fi>

	* src/auth/main.c: fix

2005-01-09 16:54  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, auth/auth-client-connection.c,
	  auth/auth-master-connection.c, auth/auth-master-connection.h,
	  auth/auth-request-handler.c, auth/auth-request-handler.h,
	  auth/auth.c, auth/auth.h, auth/common.h, auth/main.c,
	  auth/mech.h, master/auth-process.c: Changed the way multiple auth
	  processes are handled. It no longer uses a pid appended to socket
	  name but instead there's a balancer process which proxies the
	  requests to worker processes.

2005-01-09 16:52  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: Use nonblocking connecting for unix sockets.

2005-01-09 16:51  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, lib/network.c, lib/network.h,
	  login-common/master.c, master/auth-process.c, master/main.c:
	  Added backlog parameter for net_listen*().

2005-01-09 00:49  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, auth/auth-client-connection.c,
	  auth/auth-client-connection.h, auth/auth-master-connection.c,
	  auth/auth-master-connection.h, auth/auth-request-handler.c,
	  auth/auth-request-handler.h, auth/auth-request.c,
	  auth/auth-request.h, auth/main.c, auth/mech-apop.c,
	  master/auth-process.c: Moving code around.

2005-01-09 00:48  Timo Sirainen <tss@iki.fi>

	* src/: auth/common.h, auth/main.c, auth/mech-apop.c,
	  pop3-login/client.c: Require a valid timestamp in APOP challenge.

2005-01-08 21:37  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth-request.c,
	  auth-request.h, mech-anonymous.c, mech-apop.c, mech-cram-md5.c,
	  mech-digest-md5.c, mech-login.c, mech-ntlm.c, mech-plain.c,
	  mech-rpa.c, mech.h: Another try with API cleanup.

2005-01-08 21:22  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth-request.c,
	  auth-request.h, mech-anonymous.c, mech-apop.c, mech-cram-md5.c,
	  mech-digest-md5.c, mech-login.c, mech-ntlm.c, mech-plain.c,
	  mech-rpa.c, mech.h: API cleanup

2005-01-08 19:01  Timo Sirainen <tss@iki.fi>

	* doc/auth-protocol.txt, src/auth/auth-client-connection.c,
	  src/auth/auth-client-connection.h: Removed SERVICE command. It's
	  quite useless extra state to keep around.

2005-01-08 16:56  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth-master-connection.c,
	  auth-request.c, auth-request.h, auth.c, auth.h, common.h,
	  db-passwd-file.c, main.c, mech-anonymous.c, mech-apop.c,
	  mech-cram-md5.c, mech-digest-md5.c, mech-login.c, mech-ntlm.c,
	  mech-plain.c, mech-rpa.c, passdb-bsdauth.c, passdb-cache.c,
	  passdb-checkpassword.c, passdb-ldap.c, passdb-pam.c,
	  passdb-passwd-file.c, passdb-passwd.c, passdb-shadow.c,
	  passdb-sql.c, passdb-vpopmail.c, passdb.c, userdb-ldap.c,
	  userdb-passwd.c, userdb-sql.c, userdb-vpopmail.c,
	  userdb-vpopmail.h, userdb.c: Added auth_request_log_*().

2005-01-08 15:59  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth-master-connection.c,
	  auth-request.c, auth-request.h, mech-apop.c, mech-cram-md5.c,
	  mech-digest-md5.c, mech-login.c, mech-ntlm.c, mech-plain.c,
	  mech-rpa.c, passdb.h, userdb.h: Cleanups.

2005-01-07 21:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-mail.h,
	  maildir/maildir-mail.c, mbox/mbox-mail.c: mail->expunged field
	  wasn't actually set. Now it's always set if wanted_fields
	  contains message header or body.

2005-01-07 20:01  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb.c, passdb.h, userdb.c, userdb.h: Moved extern
	  userdb/passdb declarations to .c files.

2005-01-07 19:55  Timo Sirainen <tss@iki.fi>

	* src/auth/: Makefile.am, auth-client-connection.c,
	  auth-client-connection.h, auth-master-connection.c,
	  auth-master-connection.h, auth-request.c, auth-request.h, auth.c,
	  auth.h, common.h, main.c, mech-anonymous.c, mech-apop.c,
	  mech-cram-md5.c, mech-digest-md5.c, mech-login.c, mech-ntlm.c,
	  mech-plain.c, mech-rpa.c, mech.c, mech.h, passdb.c, passdb.h,
	  userdb.c, userdb.h: Reorganized the code to have less
	  global/static variables.

2005-01-07 18:51  Timo Sirainen <tss@iki.fi>

	* src/auth/: Makefile.am, auth-cache.c, auth-client-connection.c,
	  auth-master-connection.c, auth-request.c, auth-request.h, main.c,
	  mech-anonymous.c, mech-apop.c, mech-cram-md5.c,
	  mech-digest-md5.c, mech-login.c, mech-ntlm.c, mech-plain.c,
	  mech-rpa.c, mech.c, mech.h, userdb.h: Split auth_request*
	  functions from mech.c to auth-request.c

2005-01-07 18:25  Timo Sirainen <tss@iki.fi>

	* src/auth/: checkpassword-reply.c, passdb-checkpassword.c: userdb
	  = passdb works now with checkpassword passdb.

2005-01-07 18:15  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am,
	  src/auth/auth-client-connection.c, src/auth/userdb.c,
	  src/auth/userdb.h: Added "passdb" userdb. It works only if passdb
	  gives all the information needed for userdb. For example with SQL
	  you can use ".. uid AS userdb_uid, gid AS userdb_gid, home AS
	  userdb_home .." in password_query.

2005-01-07 18:09  Timo Sirainen <tss@iki.fi>

	* src/: auth/passdb-ldap.c, auth/userdb-ldap.c, lib/strfuncs.c,
	  lib/strfuncs.h: Renamed strarray_join() to t_strarray_join() and
	  made it not to crash..

2005-01-07 17:34  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: If connection to auth server
	  is lost, reply with temp error.

2005-01-07 17:29  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, login-common/common.h,
	  pop3-login/client-authenticate.c: If authentication failed
	  because of temporary failure, show different error message to
	  clients.

2005-01-07 17:27  Timo Sirainen <tss@iki.fi>

	* doc/auth-protocol.txt, src/auth/auth-client-connection.c,
	  src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	  src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	  src/auth/mech-login.c, src/auth/mech-ntlm.c,
	  src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	  src/auth/mech.h, src/auth/passdb-ldap.c,
	  src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c,
	  src/auth/passdb.c, src/auth/passdb.h: Make FAIL reply contain
	  "temp" parameter if the authentication failed because of
	  temporary internal error. Also cleaned up the auth code a bit.

2005-01-07 17:24  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: typofix

2005-01-07 17:24  Timo Sirainen <tss@iki.fi>

	* src/login-common/sasl-server.c: cleanup

2005-01-07 17:19  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: removed debugging info

2005-01-07 16:46  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/imap-proxy.c, pop3-login/pop3-proxy.c: proxy:
	  When we can't connect to remote server, show "Temporary login
	  failure." error to client instead of internal error.

2005-01-07 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Mysql driver supports connecting to
	  multiple servers by giving multiple host= parameters in connect
	  string. The queries are sent round robin, and if the query fails
	  because of lost connection for one server it's retried on next
	  one.

2005-01-07 14:39  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Check if mysql_fetch_row() returns
	  error.

2005-01-07 14:07  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-sql.conf: Removed moin.cgi/ from Wiki reference, it's
	  not needed anymore.

2005-01-07 13:22  Timo Sirainen <tss@iki.fi>

	* src/util/rawlog.c: rewrote rawlog code. it's now fully
	  asynchronous which could make it a bit faster, and it should also
	  fix some hangs with it. Timestamps are written now only with
	  IMAP.

2005-01-07 12:40  Timo Sirainen <tss@iki.fi>

	* src/login-common/login-proxy.c: s/proxy/server/ for variables
	  describing remote server.

2005-01-06 22:48  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2005-01-06 22:26  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: We didn't handle properly missing
	  boundaries.

2005-01-06 21:40  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-body-search.c: When searching inside MIME
	  part headers, we were using wrong charset for the search key. It
	  was already in UTF-8.

2005-01-06 21:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: mail->get_header()
	  was pretty broken. This affected SORT/THREAD.

2005-01-06 20:50  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: Allow giving data stack pool for
	  message_address_parse()

2005-01-06 20:13  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-passwd-file.c, userdb-ldap.c, userdb-sql.c,
	  userdb-static.c, userdb.c, userdb.h: If UID or GID isn't numeric,
	  look it up from passwd/group.

2005-01-06 20:02  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-ldap.c: Keep auth_request around so it can be
	  used in error messages.

2005-01-06 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Use random_fill_weak() when creating
	  dotlock file names.

2005-01-06 19:08  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, lib/randgen.c, lib/randgen.h: Added
	  random_fill_weak() and make random_init() always initialize
	  srand() with a seed from random_fill().

2005-01-06 18:14  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-sort.c, lib-imap/imap-envelope.c,
	  lib-mail/Makefile.am, lib-mail/message-address.c,
	  lib-mail/message-address.h, lib-mail/rfc822-parser.c,
	  lib-mail/rfc822-parser.h, lib-storage/index/index-search.c: Added
	  rfc822 parser which will probably replace message_tokenizer at
	  some point. Rewrote address parsing with the new parser. This
	  fixes various bugs in it.

2005-01-06 18:09  Timo Sirainen <tss@iki.fi>

	* src/lib/: strfuncs.c, strfuncs.h: Added strarray_join().

2005-01-06 17:05  Timo Sirainen <tss@iki.fi>

	* src/pop3/: Makefile.am, mail-storage-callbacks.c: lib-imap isn't
	  needed in includes.

2005-01-06 15:41  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-connection.c, passdb-ldap.c, passdb-sql.c,
	  passdb-vpopmail.c, userdb-ldap.c, userdb-sql.c: Added
	  authentication debugging logging.

2005-01-03 20:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Don't break if
	  line begins with NUL. Don't return -2 as long as underlying
	  stream is returning more data (don't just retry once).

2004-12-29 19:24  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, pop3/main.c: Print effective uid/gid when
	  mail_debug is enabled.

2004-12-29 19:10  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/namespace.c,
	  src/lib-storage/mail-storage-private.h,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.h,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h, src/pop3/main.c: Added mail_debug
	  setting. Moved full_filesystem_access from global variable to
	  flag in mail_create*() functions.

2004-12-29 19:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Added assert

2004-12-29 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-util.h: compiler warning fix

2004-12-29 17:38  Timo Sirainen <tss@iki.fi>

	* doc/mail-storages.txt: Fixes.

2004-12-29 17:38  Timo Sirainen <tss@iki.fi>

	* doc/: Makefile.am, USE-WIKI-INSTEAD: Added.

2004-12-29 17:38  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added wiki references.

2004-12-29 17:31  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h:
	  Removed maildir_check_content_changes setting. The feature hasn't
	  existed for a long time.

2004-12-29 17:02  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated comments.

2004-12-29 16:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: we synced one message
	  more than necessary when we were applying changes.

2004-12-29 15:48  Timo Sirainen <tss@iki.fi>

	* src/imap/commands-util.c: Don't create empty keyword lists.

2004-12-29 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Don't crash if keyword
	  update doesn't actually have any keywords set.

2004-12-29 10:56  Timo Sirainen <tss@iki.fi>

	* src/auth/password-scheme.c: comment cleanup.

2004-12-28 15:57  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated mail_cache_fields and
	  mail_never_cache_fields comments.

2004-12-28 15:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-mail.h: Removed
	  "mail.uid". It's not used and will not be used.

2004-12-28 14:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Added assert.

2004-12-26 12:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: Flag updates got lost if
	  there were internal flag updates in same transaction.

2004-12-26 09:18  Timo Sirainen <tss@iki.fi>

	* src/imap/: commands-util.c, commands-util.h: const fixes

2004-12-26 09:12  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-store.c, imap/commands-util.c,
	  imap/commands-util.h, imap/imap-fetch.c, imap/imap-fetch.h,
	  imap/imap-sync.c, lib-imap/imap-util.c, lib-imap/imap-util.h,
	  lib-index/Makefile.am, lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-keywords.c,
	  lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-index/mail-transaction-util.c, lib-mail/mail-types.h,
	  lib-storage/mail-copy.c, lib-storage/mail-storage-private.h,
	  lib-storage/mail-storage.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-mail.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-util.c,
	  lib-storage/index/mbox/mbox-mail.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h,
	  lib-storage/index/mbox/mbox-sync-private.h,
	  lib-storage/index/mbox/mbox-sync-update.c,
	  lib-storage/index/mbox/mbox-sync.c, pop3/client.c,
	  pop3/commands.c: Initial support for keywords. Syncing to
	  mbox/maildir doesn't work yet.

2004-12-26 09:10  Timo Sirainen <tss@iki.fi>

	* src/imap/mail-storage-callbacks.c: Removed unused include.

2004-12-26 09:09  Timo Sirainen <tss@iki.fi>

	* src/lib/: strfuncs.c, strfuncs.h: Added strarray_length().

2004-12-22 06:34  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: pop3_enable_last setting wasn't
	  actually being passed to pop3 process. Patch by Andrey Panin.

2004-12-21 12:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-from.c: Support "quoted spaces"
	  in From-line sender's local-part. Postfix at least may write
	  these..

2004-12-20 16:00  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, master/auth-process.c: Fixes for using socket
	  listen { .. } in auth sections.

2004-12-20 12:51  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-body-search.c, message-header-search.c:
	  Memory leak fix + crashfixes. Found and fixes by Kazuo Moriwaka

2004-12-20 12:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-lock.c: Fix crashes when handling
	  stale dotlocks.

2004-12-20 07:51  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: comment update

2004-12-20 07:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: still not right :)

2004-12-20 07:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Again, don't crash if
	  there are no expunge handlers..

2004-12-20 07:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: If there are no extensions,
	  don't crash while expunging.

2004-12-20 04:59  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't use GNUTLS unless explicitly specified. It's
	  not working currently anyway..

2004-12-20 04:56  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-search.c: Don't try to uppercase search strings. It
	  breaks some character sets.

2004-12-20 04:39  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.c, src/lib/compat.h: If strtoull()
	  isn't supported, fallback to strtouq(). If that's not found
	  either, use our own implementation.

2004-12-19 08:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.h: Warning fix for
	  cygwin.

2004-12-19 08:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Type changes, was
	  probably broken with 64bit systems.

2004-12-19 08:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-private.h: mail_cache_decision_*()
	  prototypes were wrong.

2004-12-19 08:18  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-util.c: my_madvise() wasn't returning anything.

2004-12-19 07:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: In some cases we
	  may have crashed if header didn't end with LF+LF.

2004-12-19 06:36  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-mail.c,
	  src/lib-storage/index/maildir/maildir-mail.c,
	  src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c: Added %f
	  pop3_uidl_format for maildir. Patch by Andrey Panin.

2004-12-19 05:49  Timo Sirainen <tss@iki.fi>

	* src/util/dovecotpw.c: Include libgen.h only if it exists.

2004-12-19 05:30  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, passdb-ldap.c, userdb-ldap.c: Fixed
	  crashing due to free()ing too much.

2004-12-19 05:11  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-search.c: SEARCH UNKEYWORD wasn't working.

2004-12-19 01:53  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: Don't crash if last
	  extension in record needs padding.

2004-12-19 00:46  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: MIME part header fetches weren't
	  working correctly.

2004-12-19 00:45  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Seeking backwards to
	  headers wasn't working.

2004-12-18 14:47  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Don't call bsearch() with
	  zero member count, it crashes in Solaris.

2004-12-17 13:31  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Go back to the version before recent
	  changes. It was correct all the time.

2004-12-17 11:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.h: Added mbox_writeonly
	  variable, forgot in last commit.

2004-12-17 00:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-file.c, mbox-save.c,
	  mbox-sync.c: Named pipes are now treated as write-only mboxes.

2004-12-16 20:41  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: o_stream_send_istream() was broken and
	  could have just caused copying to be done infinitely filling up
	  disk.

2004-12-16 01:41  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: Fix when using multiple auth
	  processes.

2004-12-16 01:37  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-limit.c: Added assert.

2004-12-16 01:37  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-crlf.c: LF-stream might have counted the bytes
	  wrong in certain situations, causing it to skip more data from
	  input than it should have. Caused hangs sometimes when APPENDing
	  into mbox.

2004-12-16 01:35  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Stream copying skipped too much input if
	  the output buffer wasn't empty when it was called.

2004-12-15 22:22  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: Crashfix

2004-12-15 21:38  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Deinitialize pending command only if it's
	  actually executing. Fixes crash if client disconnected while
	  command was only half sent.

2004-12-15 21:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: If mbox isn't synced,
	  don't try to set message's md5sum because it just crashes..

2004-12-15 20:12  Timo Sirainen <tss@iki.fi>

	* src/lib/var-expand.c: Added support for multiple modifiers. Added
	  %X = hex modifier. Prefixing width value with '0' adds
	  '0'-padding to the string if it's smaller than width.

2004-12-15 20:05  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/mail-storage.h,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h, src/lib-storage/index/index-mail.c,
	  src/lib-storage/index/mbox/mbox-storage.c, src/pop3/client.c,
	  src/pop3/client.h, src/pop3/commands.c, src/pop3/common.h,
	  src/pop3/main.c: Added pop3_uidl_format setting.

2004-12-15 19:31  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-cache.c, lib/var-expand.c, lib/var-expand.h: Auth
	  cache key was built wrong if any modifiers were used for %vars.
	  Added var_get_key() function which skips over any modifiers and
	  returns the actual key.

2004-12-15 19:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync.c: Removed
	  X-UIDL header handling. It's not actually used.

2004-12-15 18:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: If we want MD5 sums in
	  indexes, mail saving should also add them.

2004-12-15 18:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: Makefile.am, mbox-md5.c, mbox-md5.h,
	  mbox-sync-parse.c, mbox-sync-private.h: Reorganized mbox md5
	  summing code so it doesn't require sync context anymore.

2004-12-15 18:06  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-cache.c: When building cache key, use each %key
	  only once, more wastes only memory.  This was mostly needed for
	  more complex SQL queries where same key could be used multiple
	  times.

2004-12-15 17:52  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/: auth-server-connection.c,
	  auth-server-connection.h: Connect to available auth sockets by
	  round robin.

2004-12-15 17:44  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: If login_process_per_connection=no,
	  create a separate listener socket for each auth process, so a
	  single long running login process can talk to multiple auth
	  processes for load distribution.

2004-12-15 17:24  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c: Check for duplicate fields in
	  header.

2004-12-15 17:01  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/mail-process.c,
	  src/master/master-settings.c,
	  src/lib-storage/index/index-storage.h,
	  src/master/master-settings.h,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-sync.c,
	  src/lib-storage/index/mbox/mbox-transaction.c: Added
	  mbox_very_dirty_syncs setting.

2004-12-14 03:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Continuing last
	  header-md5 commit..

2004-12-14 03:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, mbox/mbox-sync-parse.c,
	  mbox/mbox-sync.c: Always register the header-md5, but use
	  separate variable to figure out if it should actually be used.

2004-12-14 02:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: Makefile.am, mbox-sync-parse.c,
	  mbox-sync-private.h: Moved mbox header MD5 summing code into
	  separate file so it's easily changed.

2004-12-13 00:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: If log file sequences get
	  broken, complain instead of crashing.

2004-12-13 00:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: A few extra asserts.

2004-12-08 22:35  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-connection.c, mech.c, mech.h: When master
	  looked for auth request, it didn't check if the authentication
	  was yet finished, so auth client could have fooled master by
	  beginning authentication without finishing it. Login processes
	  didn't allow users to do this though, so no real problem.

2004-12-08 22:06  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Don't change login dir permissions
	  if using external auth.

2004-12-08 17:22  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-create.c: CREATE dir/ wasn't working.

2004-12-08 17:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.h: Changed mbox header
	  padding back to 50. It was 5 for debugging (probably shouldn't
	  have been committed).

2004-12-08 02:27  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech.c, mech.h: Requests in failed response queue
	  could still be found from request queue and destroyed again. This
	  made it possible to crash dovecot-auth by sending more
	  authentication data than was expected.

2004-12-07 21:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Added assert

2004-12-07 20:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-rewrite.c, mbox-sync.c: Fixed mbox corruption in
	  certain situations. Added more asserts to catch similiar problems
	  if there still happens to be any.

2004-12-07 03:59  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: Makefile.am, mail-index-sync-ext.c,
	  mail-index-sync-private.h, mail-index-sync-update.c: Moved
	  extension syncing code to separate file.

2004-12-07 02:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Sync contexts are always
	  of type struct mail_index_sync_map_ctx.

2004-12-07 01:19  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/pop3/commands.c, src/pop3/common.h,
	  src/pop3/main.c: Added oe-ns-eoh workaround.

2004-12-07 01:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Crashfix for
	  mmap_disable=yes.

2004-12-07 00:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: mail_cache_merge_bitmask()
	  was broken, cache compression could have crashed or produced
	  broken results.

2004-12-07 00:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: Cache compression didn't
	  work with lock_method = dotlock.

2004-12-07 00:41  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: If pid in dotlock file is same as ours,
	  assume a stale lock file.

2004-12-07 00:26  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Added assert

2004-12-07 00:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-storage.h:
	  mail_deinit() wasn't used anymore.

2004-12-06 16:55  Timo Sirainen <tss@iki.fi>

	* src/auth/mech.c: Crashfix for passdb cache. Patch by Andrey
	  Panin.

2004-12-06 16:46  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-cache.c: Cached passwords didn't return scheme
	  correctly. Patch by Andrey Panin.

2004-12-06 16:42  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech.c, passdb.c: Mechanism list / passdb
	  compatibility checking wasn't working because we were checking it
	  before any mechanisms were initialized.

2004-12-06 16:39  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-bsdauth.c, passdb-checkpassword.c,
	  passdb-ldap.c, passdb-pam.c, passdb-passwd-file.c,
	  passdb-passwd.c, passdb-shadow.c, passdb-sql.c,
	  passdb-vpopmail.c, passdb.c, passdb.h, userdb-ldap.c,
	  userdb-passwd-file.c, userdb-passwd.c, userdb-sql.c,
	  userdb-static.c, userdb-vpopmail.c, userdb.c, userdb.h: Added
	  name variable for userdb_module and passdb_module and changed
	  their initialization a bit.

2004-12-05 04:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-private.h, mail-cache.c,
	  mail-index-lock.c, mail-index-private.h, mail-transaction-log.c:
	  lock_method=dotlock doesn't crash anymore while trying to modify
	  cache file.  We didn't previously deal with any fatal errors that
	  fcntl/flock locking could have given but assumed that the locking
	  succeeded.

2004-12-05 03:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Changed assert() to friendly human
	  readable message.

2004-12-05 02:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mmap_disable=yes: when we're syncing
	  index by reading transaction log, update map header's log file
	  offsets so our checks that use them actually work.

2004-12-05 01:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mmap_disable=yes: if mail_index_map()
	  is called while syncing make sure we don't read past what is
	  already synced into index.

2004-12-05 01:47  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-index-view-sync.c,
	  mail-index.c: Added more asserts.

2004-12-05 01:45  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache.c, lib-index/mail-index-lock.c,
	  lib-index/mail-index-private.h, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-mail.c: Renamed mail_index_refresh()
	  to mail_index_reopen_if_needed(). Added public
	  mail_index_refresh() which makes sure index is fully refreshed at
	  the time.  Added mbox code to call it after mbox is locked to
	  avoid using old mbox offsets.

2004-12-05 01:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-private.h,
	  mail-index-sync-update.c, mail-index.c: Don't try to fsck when
	  we're modifying index. It could have happened with corrupted
	  transaction logs.

2004-12-05 01:38  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-private.h, mail-cache-sync-update.c,
	  mail-cache.c, mail-index-private.h, mail-index.c: Added "sync
	  lost" handlers which are called with mmap_disable=yes when index
	  file is re-read without going through all of the transaction log.

2004-12-05 01:36  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-cache.c, lib/file-cache.h,
	  lib-index/mail-cache-sync-update.c: Changed
	  file_cache_invalidate()'s size argument to uoff_t type.

2004-12-04 22:04  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Expunge sync handlers
	  were using wrong extension contexts. This may have caused
	  cache->locked asserts.

2004-12-04 21:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Don't crash with assert if
	  transaction log was truncated unexpectedly.

2004-12-04 21:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c: If index is completely broken,
	  don't try to fsck it since we'll just crash.

2004-12-04 21:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-fields.c,
	  mail-cache.c: Locking fixes and cleanups

2004-12-04 19:46  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: RETR: Don't bother adding \Seen flag to
	  message if it's already there.

2004-12-04 18:51  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Timeout changes. Default idle timeout is now
	  10 minutes instead of 30 minutes. Also before if client didn't
	  read our output we didn't timeout it until after 16 hours (should
	  have been one minute, changed it to 10min as well).

2004-12-03 04:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Make sure index is reopened if it's
	  marked corrupted.

2004-12-03 04:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-sync-update.c: Don't crash if we failed
	  to lock cache file.

2004-11-30 09:37  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: broken fix for sync
	  handler deinitializing..

2004-11-30 09:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Sync handlers weren't
	  always deinitialized with correct parameters.

2004-11-30 08:59  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: With mmap_disabled=no the index
	  header wasn't always updated causing various problems.

2004-11-29 18:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-update.c,
	  mail-index.c: Wrong extension sync_handler might have been called
	  if index extensions didn't match current map's extensions.

2004-11-29 17:38  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Don't write to closed cache file

2004-11-29 17:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Added assert

2004-11-29 17:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c: If extension data
	  changes was actually found from transaction view, it was returned
	  wrong. Caused problems with cache file.

2004-11-29 12:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-lookup.c, mail-cache-private.h,
	  mail-cache-transaction.c: Crashfixes for reading corrupted cache
	  files.

2004-11-29 12:21  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: Don't crash if trying to read more than
	  INT_MAX bytes. Just silently allow it.

2004-11-29 02:30  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech-ntlm.c, mech-rpa.c: Initial response support for
	  NTLM and RPA. Patch by Andrey Panin.

2004-11-29 01:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Make sure we don't try to
	  write to cache file when it's already closed (could happen if it
	  was corrupted).

2004-11-29 01:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mmap_disable=yes fixes.

2004-11-29 01:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: We were accessing map
	  which was potentially already freed.

2004-11-29 00:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-update.c,
	  mail-index-view-sync.c, mail-index.c: Changed
	  mail_index_map_to_memory() to mail_index_map_clone(). Even if the
	  index is already in memory, we wish to copy it instead of just
	  raising refcount. Fixes some problems with mmap_disable=yes.

2004-11-29 00:27  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-sync-update.c: Don't crash if cache is
	  unusable.

2004-11-29 00:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Don't mark map to be
	  written into disk if we're syncing a view and not index.

2004-11-29 00:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Cache sync handler wasn't registered
	  correctly so it broke with mmap_disable=yes.

2004-11-28 23:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Give UIDVALIDITY for
	  empty mboxes too.

2004-11-28 23:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Still need to update
	  view->hdr..

2004-11-28 23:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: sync_ext_reorder()
	  sometimes added too much data to buffer.

2004-11-28 23:19  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.h, lib-storage/index/index-sync.c,
	  lib-storage/index/mbox/mbox-sync.c: Removed view->messages_count,
	  view->hdr.messages_count is enough. Also fixes assert crash in
	  mail_index_bsearch_uid().

	  Renamed .._get_message_count() to get_messages_count() to be more
	  consistent.

2004-11-28 23:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: added assert

2004-11-28 22:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_write_base_header()
	  doesn't crash anymore if index mapping is in memory. Recent
	  changes broke it.

2004-11-28 00:04  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: Don't destroy
	  client structure immediately when sending line fails. Fixes some
	  writes to freed memory.

2004-11-26 19:15  Timo Sirainen <tss@iki.fi>

	* src/login-common/master.c: fix

2004-11-25 20:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: UID FETCH * gave error
	  message with empty mailbox.

2004-11-25 19:12  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: crashfix

2004-11-25 14:49  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client.c: Username given in USER was was not freed
	  when destroying client.

2004-11-24 23:05  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: When we actually read index file's
	  header make sure it gets copied to memory so log file offsets get
	  updated.

2004-11-24 20:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync.c, mail-index.c: Avoid re-reading
	  index file with mmap_disable=yes.

2004-11-24 20:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: When committing
	  transaction, don't do index locking unless we really want to try
	  rotating the log file.

2004-11-24 20:40  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-private.h, lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-sync.c: mail_index_refresh()
	  isn't public anymore, mail_index_view_open_locked() works better
	  for the purpose.

2004-11-24 18:39  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-decisions.c,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-view-private.h, lib-index/mail-index-view.c,
	  lib-index/mail-index.h, lib-storage/index/index-mail.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync.c: Changed
	  mail_index_get_header() to return the header as return value
	  because it can't fail anymore.

2004-11-24 17:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: recent flag fixes

2004-11-24 17:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: recent flag fixes

2004-11-24 17:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: APPEND/COPY was
	  broken with maildir.

2004-11-24 17:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: If we synced external
	  transactions at the beginning of index sync, we have to reopen
	  the syncing view so it shows the latest updates.

2004-11-24 16:46  Timo Sirainen <tss@iki.fi>

	* src/login-common/master.c: Don't access freed memory.

2004-11-24 16:44  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, common.h, login-process.c,
	  mail-process.c, main.c, master-settings.c: Allow running all
	  executables with parameters.

2004-11-14 01:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync.c,
	  mail-index-view-sync.c, mail-index.c,
	  mail-transaction-log-view.c: Avoid re-reading index file with
	  mmap_disabled=yes. Instead sync it by reading transaction log
	  file.

2004-11-13 23:08  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-sync.c, lib-index/mail-index-lock.c,
	  lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-transaction-log.c: Update
	  view's header only after syncing the view. This and other changes
	  fix several view syncing problems and crashes.

2004-11-13 23:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: We didn't give error if
	  trying to search message by sequence in an empty mailbox.

2004-11-13 22:27  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: When view was synced
	  without expunges, we didn't actually sync the expunges later
	  anymore.

2004-11-12 14:35  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Make SIGUSR1 reopen log files.

2004-11-12 14:35  Timo Sirainen <tss@iki.fi>

	* src/lib/: lib-signals.c, lib-signals.h: Add signal counters to
	  USR1 and USR2 signals too.

2004-11-11 22:24  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c, lib-index/mail-index.c,
	  lib-index/mail-transaction-log.c,
	  lib-storage/index/maildir/maildir-storage.c: dovecot-shared file
	  was supposed to show permissions/gid for files created in the
	  maildir, but it didn't work for indexes.

2004-11-11 22:10  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-append.c: APPEND was using all
	  CPU.

2004-11-11 22:01  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-index/mail-transaction-log.c,
	  lib-storage/index/index-transaction.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-sync.c: Allow specifying to
	  transaction if it's external. Make mail saving transactions
	  external to avoid problems with uids.

2004-11-11 17:45  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-ntlm.c, lib-ntlm/ntlm-message.c: allow LM
	  authentication for older (Win9x) clients which do not pass NTLM
	  response in type 3 message. fixes crash in dovecot-auth (empty
	  credentials could be passed to hex_to_binary function if NTLM2
	  was negotiated). Patch by Andrey Panin

2004-11-11 17:36  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-fetch.c: Make sure fetching gets deinitialized
	  properly if connection closes in the middle of it.

2004-11-11 15:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: crashfix

2004-11-09 16:54  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, pop3/main.c: Make sure imap or pop3 processes
	  cannot be started from inetd.

2004-11-08 02:45  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.c, src/lib/compat.h: Check for
	  libgen.h and if it's not found, use my_basename(). Also
	  my_seteuid() didn't actually replace seteuid() before if it
	  didn't exist.

2004-11-08 02:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: crashfix

2004-11-08 02:12  Timo Sirainen <tss@iki.fi>

	* src/lib/Makefile.am: Removed byteorder.* files. They're not used
	  anymore.

2004-11-08 01:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-sync-update.c, mail-cache.c,
	  mail-index-private.h, mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-view-sync.c, mail-index.c:
	  Cache invalidating needed to hook into view syncing as well.

2004-11-08 01:02  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: Use madvise(MADV_DONTNEED) for invalidated
	  pages to free memory.

2004-11-08 00:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-fields.c, mail-cache-transaction.c,
	  mail-cache.c: More correct file cache invalidating.

2004-11-08 00:40  Timo Sirainen <tss@iki.fi>

	* src/: lib/Makefile.am, lib/file-cache.c, lib/file-cache.h,
	  lib-index/mail-cache-compress.c, lib-index/mail-cache-fields.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache-private.h,
	  lib-index/mail-cache-sync-update.c,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c: Cache
	  file works now with mmap_disable=yes. Still needs a few
	  optimizations.

2004-11-07 20:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-decisions.c: mark decision changes dirty
	  so when we're trying to write them to disk, we don't actually
	  just forget them..

2004-11-07 18:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: Crashfix

2004-11-07 18:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c: Allow calling mail_index_fsck()
	  with log locked.

2004-11-07 18:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: fsck index if transaction
	  log is found to be corrupted.

2004-11-07 18:44  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Added extra checks to
	  avoid crashes with corrupted transaction log.

2004-11-07 18:06  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: DIGEST-MD5 was broken.

2004-11-07 15:21  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-body-search.c: Use dynamic buffer. Probably
	  fixes some "buffer full" crashes.

2004-11-07 15:17  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: Print pool name for "buffer full" errors.

2004-11-07 15:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Removed assert, it's allowed to
	  happen

2004-11-06 20:55  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-cache.c: print info about cache clearing

2004-11-06 20:23  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-cache.c: SIGHUP now clears cache.

2004-11-06 20:22  Timo Sirainen <tss@iki.fi>

	* src/: lib/lib-signals.c, lib/lib-signals.h, master/main.c:
	  Changed lib_signal_hup to lib_signal_hup_count.

2004-11-06 17:20  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/Makefile.am, lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache-private.h,
	  lib-index/mail-cache-sync-update.c,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-index/mail-transaction-util.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-sync.c: Removed cache_offset from
	  mail_index_record and changed it to use extension instead. Added
	  possibility to register sync and expunge handlers for extensions.
	  Changed the way extension resets work: all extension updates
	  which were committed without having seen the reset are ignored.

2004-11-05 15:36  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-logout.c: warning fix

2004-11-05 00:56  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-cache.c: fix

2004-11-04 13:09  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/pop3-proxy.c: Check that PASS replies with OK.

2004-11-02 00:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: Last fix was
	  wrong..

2004-11-02 00:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: line updating was
	  broken

2004-11-02 00:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: idx_seq wasn't properly
	  set when we were seeking into UID which doesn't exist anymore.
	  this sometimes caused valid records to be deleted from index
	  which caused mbox sync errors.

2004-11-01 20:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-storage.h, mbox-sync.c: oops

2004-11-01 20:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: error message fix

2004-11-01 13:53  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-connection.c: Crashfix in some error
	  conditions

2004-11-01 13:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Cleanups

2004-11-01 13:34  Timo Sirainen <tss@iki.fi>

	* src/auth/: userdb-ldap.c, userdb-sql.c: And more leak fixes..

2004-11-01 13:31  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-ldap.c, passdb-sql.c: Fixed memory leaks.

2004-11-01 12:18  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-cache.c, lib-sql/driver-mysql.c: memory leak
	  fixes

2004-11-01 12:15  Timo Sirainen <tss@iki.fi>

	* src/lib/: str.c, str.h: Added str_free_without_data().

2004-10-29 17:56  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: typofix: advertise
	  auth=plain only with disable_plaintext_auth = yes

2004-10-28 15:22  Timo Sirainen <tss@iki.fi>

	* src/imap-login/client.c: another proxy crashfix

2004-10-28 10:27  Timo Sirainen <tss@iki.fi>

	* src/: pop3-login/client.c, imap-login/client.c: crashfixes

2004-10-27 14:20  Timo Sirainen <tss@iki.fi>

	* src/: pop3-login/client.h, pop3-login/pop3-proxy.c,
	  imap-login/client.h, imap-login/imap-proxy.c: Keep proxy_user
	  stored until proxy is destroyed.

2004-10-26 04:38  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Don't show extra LFs in lines
	  longer than input buffer size.

2004-10-26 03:57  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: still not right

2004-10-25 23:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: one more expunge fix..

2004-10-25 22:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: expunge logic still
	  wrong. maybe now?

2004-10-25 22:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: last fix was wrong

2004-10-25 21:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c, mbox-sync.c:
	  Expunge sync fix

2004-10-25 21:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: fix.

2004-10-25 21:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h: cleanup

2004-10-25 21:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h, mbox-sync.c:
	  restart partial syncs correctly. and cleanups.

2004-10-25 20:04  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: one more major version change fix

2004-10-25 19:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: More rebuilding fixes with
	  mmap_disable=yes

2004-10-25 19:51  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Rebuild broken index files with
	  mmap_disabled=yes too..

2004-10-25 19:47  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Handle major version changes silently
	  even if the file isn't large enough to contain full expected
	  header.

2004-10-25 19:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Don't crash if mmap_disable=yes and
	  index is broken.

2004-10-25 18:50  Timo Sirainen <tss@iki.fi>

	* Makefile.am: config.rpath isn't supposed to be here..

2004-10-25 17:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-sync.c,
	  mail-index-view-sync.c, mail-index-view.c, mail-index.c,
	  mail-index.h, mail-transaction-log-view.c,
	  mail-transaction-log.c: Use separate sync offsets for
	  internal/external transactions. Pending external transactions are
	  committed into index at the beginning of syncing, internal ones
	  aren't.

2004-10-25 17:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-storage.h, maildir-sync.c: Always protect maildir syncing
	  with uidlist lock. Before we only tried to do it and if it
	  failed, we went ahead and just didn't sync any new messages.
	  That however could have caused files to be lost temporarily due
	  to race conditions between readdir() and rename().

2004-10-25 02:05  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: getgroups() was used wrongly before
	  and caused problems if there were lots of groups. Patch by Jeff
	  Rife.

2004-10-24 00:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-sync.c, mbox/mbox-sync.c:
	  Don't crash to asserts

2004-10-24 00:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: fix

2004-10-23 23:03  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: buffer_insert() and buffer_insert_zero() didn't
	  work correctly when it used to append data.

2004-10-23 20:55  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-logout.c: Send the "* BYE Logging out" before
	  closing mailbox.

2004-10-22 17:47  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-sql.conf, src/auth/passdb-sql.c: Make it more clear
	  that password query must return a "password" named field.

2004-10-22 14:15  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-cache.c: Don't try to free cache if it doesn't
	  exist.

2004-10-22 13:44  Timo Sirainen <tss@iki.fi>

	* doc/: Makefile.am, auth-protocol.txt: Dovecot authentication
	  protocol v1.0

2004-10-22 13:42  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-client-connection.c,
	  auth/auth-master-connection.c, lib-auth/auth-server-connection.c,
	  master/auth-process.c: Separate major/minor version with TAB
	  instead of dot in VERSION.

2004-10-22 13:34  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-ntlm.c, lib-ntlm/ntlm-message.c, lib-ntlm/ntlm.h:
	  support OEM encoding in NTLM messages. Patch by Andrey Panin.

2004-10-22 00:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c, mbox-sync.c:
	  More expunge/rewrite fixes.

2004-10-21 20:58  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-transaction.c: Don't access
	  freed memory.

2004-10-21 20:47  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c:
	  mail_log_prefix was using old %p, changed it to %s..

2004-10-21 20:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c, mbox-sync.c:
	  rewrite fixes

2004-10-21 17:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: Crashfix

2004-10-21 13:41  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: mysql/pgsql -> sql

2004-10-21 13:40  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: Don't return values from void functions.

2004-10-21 02:36  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-idle.c: IDLE used 100% CPU.

2004-10-21 02:27  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-none.c: cleanup

2004-10-21 02:23  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/Makefile.am,
	  src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/mech.c,
	  src/auth/mech.h, src/auth/passdb-cache.c,
	  src/auth/passdb-cache.h, src/auth/passdb-ldap.c,
	  src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c,
	  src/auth/passdb.c, src/auth/passdb.h, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  simple LRU cache for auth requests. Currently only for sql
	  passdb.

2004-10-20 23:34  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/auth/mech.c, src/master/mail-process.c:
	  Changed %p (protocol) -> %s (service). Also changed %P (pid) ->
	  %p.  Hopefully people weren't using these much yet :)

2004-10-20 23:05  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/imap/Makefile.am,
	  src/imap-login/Makefile.am, src/lib-auth/Makefile.am,
	  src/lib-charset/Makefile.am, src/lib-imap/Makefile.am,
	  src/lib-index/Makefile.am, src/lib-mail/Makefile.am,
	  src/lib-ntlm/Makefile.am, src/lib-settings/Makefile.am,
	  src/lib-sql/Makefile.am, src/lib-storage/Makefile.am,
	  src/lib-storage/index/Makefile.am,
	  src/lib-storage/index/maildir/Makefile.am,
	  src/lib-storage/index/mbox/Makefile.am,
	  src/lib-storage/register/Makefile.am,
	  src/lib-storage/subscription-file/Makefile.am,
	  src/login-common/Makefile.am, src/master/Makefile.am,
	  src/pop3/Makefile.am, src/pop3-login/Makefile.am,
	  src/util/Makefile.am: Upgrades to autoconf 2.5 and automake >1.4.

2004-10-20 20:46  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Removed special
	  Maildir/.INBOX directory. Indexes are now stored in maildir root.

2004-10-20 20:19  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Don't crash if no headers
	  are given (fixes FETCH BODY[n.MIME] crashing)

2004-10-20 18:09  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/common.h,
	  src/imap/imap-fetch-body.c, src/imap/main.c: Added
	  tb-negative-fetch workaround.

2004-10-20 17:49  Timo Sirainen <tss@iki.fi>

	* src/: master/auth-process.c, auth/auth-master-connection.c: Put
	  SPID back, it's needed for standalone dovecot-auth.

2004-10-20 17:07  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-master-connection.c, imap/client.c,
	  imap-login/client.c, lib/ostream-file.c, lib/ostream-internal.h,
	  lib/ostream.c, lib/ostream.h, login-common/login-proxy.c,
	  pop3/client.c, pop3-login/client.c: Changed ostream's flush
	  callback to have return value which can tell if there are more
	  bytes to be sent even if there is none in output buffer itself.
	  Fixes FETCH commands which used o_stream_send_istream() getting
	  stuck.

2004-10-20 17:04  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: input->eof && o_stream_send_istream()
	  == 0 isn't a correct way to check if all is sent. Use
	  i_stream_have_bytes_left() instead.

2004-10-20 17:03  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream.c, istream.h: Added i_stream_have_bytes_left().

2004-10-20 14:02  Timo Sirainen <tss@iki.fi>

	* src/imap-login/: client.c, client.h, imap-proxy.c: Fixes.

2004-10-20 13:59  Timo Sirainen <tss@iki.fi>

	* src/: login-common/login-proxy.c, imap-login/imap-proxy.c,
	  pop3-login/pop3-proxy.c: Logging changes.

2004-10-20 13:49  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/pop3-proxy.c: Use USER/PASS instad for AUTH PLAIN.
	  Also don't require "+OK" to have parameters.

2004-10-19 15:53  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't advertise LISTEXT capability. It's still a
	  draft which changes constantly.

2004-10-19 15:47  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c,
	  pop3-login/pop3-proxy.c: crashfixes

2004-10-19 15:47  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-connection.c: Don't crash with invalid auth
	  client input.

2004-10-19 02:51  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-client-connection.c,
	  auth/auth-client-connection.h, auth/mech-rpa.c, auth/mech.c,
	  auth/mech.h, auth/passdb-pam.c, auth/passdb-vpopmail.c,
	  lib-auth/auth-client.h, lib-auth/auth-server-request.c,
	  login-common/sasl-server.c, login-common/sasl-server.h:
	  s/protocol/service/ in authentication

2004-10-19 01:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mailbox-check.c: If we can't add file
	  to I/O notify list, close the fd so we don't leak.  Fixes IDLE
	  leaking fds with all but Linux.

2004-10-19 01:17  Timo Sirainen <tss@iki.fi>

	* src/: login-common/master.c, master/login-process.c,
	  master/master-login-interface.h: Added version to login <->
	  master communication as well.

2004-10-19 01:17  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: We didn't send VERSION handshake to
	  auth process.

2004-10-19 00:59  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth-client-connection.h: If
	  auth client sends broken input and we disconnect it, wait for a
	  while before disconnecting to avoid flooding.

2004-10-19 00:51  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, auth/auth-client-connection.c,
	  auth/auth-client-connection.h, auth/auth-client-interface.h,
	  auth/auth-master-connection.c, auth/auth-master-connection.h,
	  auth/auth-master-interface.h, lib-auth/auth-server-connection.c,
	  lib-auth/auth-server-connection.h, master/auth-process.c: Added
	  VERSION command and checking to authentication protocol.

2004-10-19 00:42  Timo Sirainen <tss@iki.fi>

	* src/master/log.c: Log flushing fixes.

2004-10-18 23:08  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2004-10-18 23:07  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/client.h, imap-login/imap-proxy.c,
	  imap-login/imap-proxy.h, login-common/common.h,
	  login-common/login-proxy.c, login-common/login-proxy.h,
	  pop3-login/client-authenticate.c, pop3-login/client.c,
	  pop3-login/client.h, pop3-login/pop3-proxy.c,
	  pop3-login/pop3-proxy.h: More smart IMAP and POP3 proxies. Now if
	  remote login fails, it just destroys the proxy and allows trying
	  another username which can go elsewhere.  Also now replies with
	  the same old "Authentication failed" error message instead of
	  showing remote server's failure message.

2004-10-18 23:03  Timo Sirainen <tss@iki.fi>

	* src/: lib-auth/auth-server-request.c, login-common/sasl-server.c,
	  auth/auth-client-connection.c: Use reason=xx field in FAIL to
	  report the error message instead of separate field.

2004-10-18 21:52  Timo Sirainen <tss@iki.fi>

	* configure.in: Use -lz always with mysql. Our previous check
	  wasn't really working because the later -lz check used cached
	  failure.

2004-10-18 20:05  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-sql.conf: comment update

2004-10-18 19:23  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-sql.c: Don't require boolean flags to be 'Y' for
	  yes, only to be non-NULL.

2004-10-18 19:21  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-client-connection.c, auth/mech.h,
	  auth/passdb-sql.c, imap-login/Makefile.am,
	  imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/client.h, imap-login/imap-proxy.c,
	  imap-login/imap-proxy.h, login-common/Makefile.am,
	  login-common/login-proxy.c, login-common/login-proxy.h,
	  login-common/main.c, login-common/sasl-server.c,
	  pop3-login/Makefile.am, pop3-login/client-authenticate.c,
	  pop3-login/client.c, pop3-login/client.h,
	  pop3-login/pop3-proxy.c, pop3-login/pop3-proxy.h: Added IMAP and
	  POP3 proxying support.

2004-10-18 08:17  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: We failed with "Can't drop root group
	  privileges" if root's gid wasn't 0.  This happened often with
	  Solaris. Thanks to Gregory Bond for figuring out.

2004-10-18 01:13  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap-login/client-authenticate.c,
	  src/imap-login/client.c, src/lib-auth/auth-server-request.c,
	  src/login-common/sasl-server.c, src/login-common/sasl-server.h,
	  src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	  Implemented support for LOGIN-REFERRALS using "referral" and
	  "reason" parameters from auth server.

2004-10-18 01:00  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, mech.c, mech.h,
	  passdb-sql.c: Authentication OK and FAIL replies can now contain
	  extra fields from passdb.  Implemented this for sql passdb.
	  Special fields are "nologin" (user can't actually login) and
	  "nodelay" (don't delay failure replies).

2004-10-17 23:36  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-rpa.c: Didn't work with asynchronous passdb.

2004-10-17 23:08  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/: client-authenticate.c, client.c, client.h:
	  tls/secured variables are in common client structure. Plaintext
	  logins didn't work because of this when disable_plaintext_auth =
	  yes, even if SSL was used.

2004-10-17 18:24  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-transaction-private.h,
	  mail-index-transaction.c, mail-index-view-sync.c,
	  mail-transaction-log.c, mail-transaction-log.h,
	  mail-transaction-util.c, mail-transaction-util.h: New way of
	  handling extension introductions in transaction log.

2004-10-17 16:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-private.h,
	  mail-index-view-private.h, mail-index-view-sync.c,
	  mail-index-view.c, mail-index.c: Removed mmap() memory area
	  protections. They weren't always set correctly.  Also grsec
	  crashed with them anyway.

2004-10-17 16:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-index-sync.c,
	  mail-transaction-log.c: Write transactions into index at the
	  beginning of syncing if there's appends or external changes.

2004-10-17 15:15  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: If login fails with
	  internal failure, show it to client as -ERR [IN-USE]

2004-10-17 14:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-storage.h, maildir-transaction.c: Unlock uidlist file
	  only after appends are written to transaction log.

2004-10-16 16:47  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/sql-api.c: warning fix when not compiled with any sql
	  drivers

2004-10-16 16:32  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Growing output buffer size broke the data
	  inside it.

2004-10-16 14:59  Timo Sirainen <tss@iki.fi>

	* src/lib/macros.h: i_unreached(): show also file and line number
	  in error message

2004-10-15 23:12  Timo Sirainen <tss@iki.fi>

	* configure.in, doc/Makefile.am, doc/dovecot-sql.conf,
	  src/Makefile.am, src/auth/Makefile.am,
	  src/auth/auth-master-connection.c, src/auth/db-sql.c,
	  src/auth/db-sql.h, src/auth/passdb-sql.c, src/auth/passdb.c,
	  src/auth/passdb.h, src/auth/userdb-sql.c, src/auth/userdb.c,
	  src/auth/userdb.h, src/lib-sql/.cvsignore,
	  src/lib-sql/Makefile.am, src/lib-sql/driver-mysql.c,
	  src/lib-sql/driver-pgsql.c, src/lib-sql/sql-api-private.h,
	  src/lib-sql/sql-api.c, src/lib-sql/sql-api.h: Created generic
	  asynchronous SQL API and implemented MySQL and PostgreSQL
	  drivers. MySQL is implemented synchronously because it's API
	  doesn't provide async way to do it.

	  Replaced pgsql and mysql userdb/passdb with generic sql
	  userdb/passdb.

2004-10-15 22:56  Timo Sirainen <tss@iki.fi>

	* src/auth/mech.c: extra assert

2004-10-15 22:55  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: t_pop() leakfix

2004-10-15 13:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Try to create the
	  whole directory structure up to root_dir if it doesn't exist.

2004-10-15 13:03  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Don't use sendfile() for files, even with
	  Linux. 2.6 kernels don't support it anymore and I'm not sure
	  anymore if it fully worked with 2.4 either.

2004-10-14 23:57  Timo Sirainen <tss@iki.fi>

	* src/login-common/Makefile.am: missing sasl-server.h

2004-10-14 23:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Fixed error
	  message

2004-10-14 23:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Holes in cache file were
	  broken

2004-10-14 22:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Log syncing fixes

2004-10-14 21:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Don't crash even if view is
	  inconsistent.

2004-10-14 19:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: expunge fix

2004-10-14 17:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync.c: If rewriting began with
	  expunged data areas, we didn't overwrite them which left garbage
	  into mbox and broke things.

2004-10-14 12:27  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: Don't insert extra space before "* n
	  FETCH"

2004-10-13 23:36  Timo Sirainen <tss@iki.fi>

	* src/lib/sendfile-util.c: FreeBSD fix

2004-10-13 20:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: fix

2004-10-13 20:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Added asserts

2004-10-13 19:11  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth-master-connection.c:
	  Auth protocol fix

2004-10-13 17:20  Timo Sirainen <tss@iki.fi>

	* src/login-common/client-common.c: forgot to add

2004-10-13 16:38  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, auth/auth-client-connection.c,
	  auth/auth-client-connection.h, auth/auth-client-interface.h,
	  auth/auth-master-connection.c, auth/auth-master-connection.h,
	  auth/auth-master-interface.h, auth/mech-anonymous.c,
	  auth/mech-apop.c, auth/mech-cram-md5.c, auth/mech-digest-md5.c,
	  auth/mech-login.c, auth/mech-ntlm.c, auth/mech-plain.c,
	  auth/mech-rpa.c, auth/mech.c, auth/mech.h, auth/userdb.h,
	  imap-login/client-authenticate.c, lib-auth/auth-client.h,
	  lib-auth/auth-server-connection.c,
	  lib-auth/auth-server-connection.h,
	  lib-auth/auth-server-request.c, lib-auth/auth-server-request.h,
	  login-common/sasl-server.c, login-common/sasl-server.h,
	  master/auth-process.c, master/auth-process.h, master/common.h,
	  master/login-process.c, master/mail-process.c,
	  master/mail-process.h, pop3-login/client-authenticate.c: Changed
	  dovecot-auth protocol to ASCII based. Should be easier now to
	  write replacement server if needed by someone. Also cleaned
	  up/made more consistent auth code. The new code could still use
	  some cleaning though..

2004-10-13 12:32  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Crashfix

2004-10-11 18:27  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/mail-storage.c,
	  imap-login/client-authenticate.c: Changed the "internal error"
	  message, once again. Hopefully this is finally clear enough for
	  people to actually understand to look at the logs.

2004-10-11 17:14  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/client.h, login-common/Makefile.am,
	  login-common/client-common.h, login-common/sasl-server.c,
	  login-common/sasl-server.h, pop3-login/client-authenticate.c,
	  pop3-login/client.c, pop3-login/client.h: Login process cleanups.
	  Share more authentication code between pop3/imap.

2004-10-11 14:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Make sure nothing is
	  buffered in mbox stream when syncing.

2004-10-11 14:25  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Handle failures without crashing

2004-10-11 13:24  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: Don't send extra ")" line with bad FETCH
	  parameters.

2004-10-11 13:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Don't go trying to updating
	  index, if there's nothing to update.

2004-10-11 13:05  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Check that dotlock PID exists even if we
	  don't do stale lock timeouting.

2004-10-11 12:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Crashfix in error
	  condition.

2004-10-11 12:05  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c: Enable
	  outlook-idle workaround by default.

2004-10-10 22:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-transaction-log.c:
	  typofixes

2004-10-10 17:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, mbox/mbox-mail.c,
	  mbox/mbox-storage.c, mbox/mbox-transaction.c: Don't lock/unlock
	  mbox separately for each message. Drop the lock only at the end
	  of the transaction.

2004-10-10 17:25  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-cache.c,
	  src/lib-index/mail-index-lock.c,
	  src/lib-index/mail-index-private.h,
	  src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	  src/lib-index/mail-index.h, src/lib-index/mail-transaction-log.c,
	  src/lib-storage/index/index-storage.c, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h:
	  Replaced fcntl_locks_disable with lock_method, so it's now
	  possible to use flock() to lock indexes.

2004-10-10 16:25  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, client.h, commands.c: Use only a single
	  transaction for the whole duration of pop3 session. Avoids
	  constant locking/unlocking the indexes.

2004-10-10 14:39  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Write host:pid into lock file *before*
	  link()ing it into real lock file.

2004-10-10 14:32  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/mech.c, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3/client.c, src/pop3/commands.c, src/pop3/common.h,
	  src/pop3/main.c: Renamed pop3_mails_keep_recent to
	  pop3_no_flag_updates which includes not updating seen-flag.

2004-10-10 14:21  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, mech.c: Fix some potential
	  crashes

2004-10-10 13:55  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/auth/mech.c,
	  src/auth/mech.h, src/lib-index/mail-index-view.c,
	  src/master/auth-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Removed Cyrus SASL code completely.
	  It hasn't worked for ages (if ever?) and there's not much point
	  in having it anyway.

2004-10-09 14:22  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: If FETCH failed immediately, we sent back
	  extra ")" line.

2004-10-09 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Copying mapping to memory didn't copy
	  some fields which could have caused problems (especially "lost
	  transaction log file .. seq 1")

2004-10-09 13:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-sync.c, mbox/mbox-sync.c: Recent
	  flag fixes

2004-10-08 21:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-lock.c: Don't close mbox file
	  stream unless we're actually using mmap. Avoids extra read()s.

2004-10-08 21:21  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, commands.c: Buffer more in memory before
	  sending RETR replies.

2004-10-08 20:25  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, client.h, commands.c: Delay writing seen
	  flags to mailbox.

2004-10-08 18:36  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Don't do anything in cork() if stream is
	  closed.

2004-10-08 18:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: fix

2004-10-08 17:51  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-master-connection.c, auth/main.c,
	  auth/mech-cram-md5.c, auth/mech-digest-md5.c, auth/mech-rpa.c,
	  auth/mech.c, auth/passdb-checkpassword.c,
	  auth/password-scheme-rpa.c, auth/password-scheme.c,
	  imap/cmd-sort.c, imap/commands-util.c, imap/commands.c,
	  imap/imap-fetch.c, imap/imap-sort.c,
	  imap-login/client-authenticate.c, lib/base64.c, lib/base64.h,
	  lib/buffer.c, lib/buffer.h, lib/hex-binary.c, lib/hex-binary.h,
	  lib/ostream-crlf.c, lib/str.c, lib-auth/auth-client.c,
	  lib-auth/auth-server-connection.c,
	  lib-auth/auth-server-request.c, lib-charset/charset-utf8.c,
	  lib-imap/imap-base-subject.c, lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-fields.c, lib-index/mail-cache-lookup.c,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-index-sync.c, lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-transaction-log.c,
	  lib-mail/istream-header-filter.c, lib-mail/message-body-search.c,
	  lib-mail/message-parser.c, lib-mail/quoted-printable.c,
	  lib-ntlm/ntlm-encrypt.c, lib-ntlm/ntlm-message.c,
	  lib-storage/mail-search.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/mbox/mbox-sync.c,
	  pop3-login/client-authenticate.c: Buffer API change: we no longer
	  support limited sized buffers where writes past limit wouldn't
	  kill the process. They weren't used hardly anywhere, they could
	  have hidden bugs and the code for handling them was too complex.

	  This also changed base64 and hex-binary APIs.

2004-10-08 17:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: group multiple recent flag
	  updates together

2004-10-08 16:59  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: buffer_insert* were broken

2004-10-08 13:33  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.c, src/lib/compat.h: Add seteuid()
	  wrapper for HP-UX

2004-10-08 12:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: cache_flags were being
	  updated constantly.

2004-10-08 12:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Remove recent-flags even
	  if flags are dirty.

2004-10-07 21:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: Don't complain about
	  corruption when there is none.

2004-10-07 21:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: fix

2004-10-07 20:36  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: Added asserts

2004-10-07 20:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: fix

2004-10-07 19:39  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: Advertise all SASL
	  mechanisms in old-style SASL discovery. Patch by Andrey Panin.

2004-10-07 19:38  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-epoll.c: Missing error checking in epoll_create().
	  Patch by Andrey Panin

2004-10-07 19:37  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-ntlm.c: fix endianness problem, patch by Andrey
	  Panin

2004-10-05 22:50  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: assert

2004-10-05 22:47  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: Make sure fetching is uninitialized always.
	  Do full read/write syncing when expunging.

2004-10-05 20:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: crashfix

2004-10-05 20:01  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-ntlm.c, lib-ntlm/ntlm-encrypt.c,
	  lib-ntlm/ntlm-encrypt.h, lib-ntlm/ntlm-message.c: NTLM2
	  authentication support. Patch by Andrey Panin

2004-10-05 16:00  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/client.h, login-common/common.h, login-common/main.c,
	  master/login-process.c, pop3-login/client-authenticate.c,
	  pop3-login/client.c, pop3-login/client.h: auth_verbose now
	  affects imap/pop3 login processes too. Every authentication
	  attempt by client is logged. Also fixed replies in
	  AUTHENTICATE/AUTH commands when it was aborted by client.

2004-10-05 15:30  Timo Sirainen <tss@iki.fi>

	* src/auth/mech.c: Use the library function for username string
	  sanitization.

2004-10-05 15:29  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, str-sanitize.c, str-sanitize.h: Added
	  string sanitization functions.

2004-10-05 00:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't loop forever if
	  sync record UIDs don't exist anymore.

2004-10-05 00:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync.c: Bringing some sanity into mbox
	  rewrites. Fixes expunge crashes and reduces writes.

2004-10-04 22:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Don't crash if
	  fetching ENVELOPE for expunged message.

2004-10-04 16:31  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync.c, lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-sync.c: When we had dirty messages,
	  we kept resyncing the whole mailbox constantly.

2004-10-03 17:03  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: "UIDL <message>" was broken.

2004-10-03 16:32  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-update.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-index/mail-transaction-log-view.c,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync.c: Index extensions can now
	  specify record alignment, and it's possible to resize header and
	  records. Fixes mbox crashes with some 64bit systems.

2004-10-03 16:30  Timo Sirainen <tss@iki.fi>

	* src/lib/: buffer.c, buffer.h: Added buffer_insert_zero()

2004-10-03 12:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-file.c: Give error message
	  instead of crashing if mbox offset is lost.

2004-10-03 12:28  Timo Sirainen <tss@iki.fi>

	* src/imap/: imap-fetch.c, imap-fetch.h: If fetching fails, finish
	  sending the untagged FETCH reply correctly.

2004-10-01 14:41  Timo Sirainen <tss@iki.fi>

	* src/login-common/: main.c, ssl-proxy-gnutls.c,
	  ssl-proxy-openssl.c, ssl-proxy.c: Show clear error messages if
	  --ssl is tried to be used but it's not builtin/enabled.

2004-10-01 13:46  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-vpopmail.c: Cleanup - we don't need mycrypt.h
	  anymore

2004-09-29 15:44  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-cram-md5.c: Allow spaces in username.

2004-09-28 13:19  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-close.c: Don't crash if CLOSEing without open
	  mailbox.

2004-09-28 10:55  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-fetch.c, imap/imap-fetch-body.c,
	  imap/imap-fetch.c, lib-imap/imap-parser.c, imap/imap-fetch.h:
	  BODY.PEEK[HEADER.FIELDS (...)] list is allowed to contain strings
	  and literals. We didn't handle them correctly before.

2004-09-27 15:58  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/login-common/common.h,
	  src/login-common/main.c, src/master/login-process.c,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/imap-login/client.c, src/pop3-login/client.c: Added
	  login_greeting and login_greeting_capability settings.

2004-09-27 11:58  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added example namespace with comments.

2004-09-26 15:51  Timo Sirainen <tss@iki.fi>

	* src/auth/mech.c: Don't allow empty usernames. Solaris PAM seems
	  to eat all memory with them.

2004-09-26 14:15  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-update.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log-view.c,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-index/mail-transaction-util.c,
	  lib-index/mail-transaction-util.h,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/mbox/mbox-file.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync.c: Renamed "extra record info"
	  and variations of it to "extension" or "ext" in short.

2004-09-26 10:37  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: If message was APPENDed with LITERALPLUS
	  and it failed for some reason (eg.  mailbox didn't exist), we
	  didn't consume the following message but instead treated it as
	  commands.

2004-09-24 13:05  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: updated error messages

2004-09-24 12:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: fix

2004-09-24 12:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: crashfix

2004-09-24 11:49  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated mbox_dirty_syncs and
	  mbox_lazy_writes comments.

2004-09-24 11:47  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-check.c, imap/cmd-logout.c, imap/cmd-select.c,
	  imap/imap-expunge.c, lib-storage/mail-storage.h,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync-private.h,
	  lib-storage/index/mbox/mbox-sync.c,
	  lib-storage/index/mbox/mbox-transaction.c, pop3/client.c: Split
	  sync_flag_full into sync_flag_full_read and _write. Closing
	  mailbox now always writes changes.

2004-09-24 11:44  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: hdr_flag_have_dirty
	  wasn't set if dirty flags were set in appends.

2004-09-24 11:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: If only mbox timestamp
	  changes, do a full sync.

2004-09-23 22:29  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf,
	  src/lib-storage/index/mbox/mbox-sync-private.h,
	  src/lib-storage/index/mbox/mbox-sync-rewrite.c,
	  src/lib-storage/index/mbox/mbox-sync-update.c,
	  src/lib-storage/index/mbox/mbox-sync.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added mbox_lazy_writes setting.

2004-09-23 22:27  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-logout.c, cmd-select.c: Do full syncing at logout,
	  not at select.

2004-09-23 20:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_map_to_memory() didn't
	  resize record if mapping was already in memory.

2004-09-23 10:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync.c: Handle UIDVALIDITY changes.
	  When partial syncing, make sure UIDs of new mails are larger than
	  existing ones. If partial syncing fails, we need to rollback the
	  transaction.

2004-09-23 10:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Don't break if same mail
	  is expunged multiple times.

2004-09-23 09:51  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: When corked, don't limit buffer size to
	  optimal_block_size. Fixes problems with some command replies not
	  being sent completely with IMAP, or crashes with pop3.

2004-09-23 09:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: If MBOX_SYNC_FLAG_FULL is
	  given, make sure we remove dirty syncing.

2004-09-23 09:18  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: Error message update

2004-09-22 19:53  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-encrypt.c: compiler warning fix

2004-09-22 19:50  Timo Sirainen <tss@iki.fi>

	* src/lib/sendfile-util.c: Warning fix with Solaris.

2004-09-22 19:40  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment updates

2004-09-22 18:57  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Re-read the PID from lock file every time
	  before checking if it exists, because it may have changed.

2004-09-21 14:40  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-storage.c: Get index file mode
	  and GID from dovecot-shared file.

2004-09-20 23:22  Timo Sirainen <tss@iki.fi>

	* src/auth/main.c: finish the preinit change..

2004-09-20 21:47  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, passdb-bsdauth.c,
	  passdb-checkpassword.c, passdb-ldap.c, passdb-pam.c,
	  passdb-passwd-file.c, passdb-passwd.c, passdb-shadow.c,
	  passdb-vpopmail.c, passdb.c, passdb.h, userdb-ldap.c,
	  userdb-passwd-file.c, userdb-passwd.c, userdb-static.c,
	  userdb-vpopmail.c, userdb.c, userdb.h: Added preinit() call to
	  userdb/passdbs, which is called before dropping privileges.
	  init() is called after. SQL/LDAP now parses the config file in
	  preinit, but does the actual connecting only in init(). This
	  fixes LDAP crashing at startup.

2004-09-20 21:27  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: If we couldn't send any bytes, don't
	  reset buffer's full-flag.

2004-09-20 20:51  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: signed vs. unsigned warning fix

2004-09-20 20:49  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-bsdauth.c: warning fix

2004-09-20 20:48  Timo Sirainen <tss@iki.fi>

	* src/auth/mech.c: type fixes

2004-09-20 20:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-rewrite.c: signed vs. unsigned comparision fixes

2004-09-20 20:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction.c, mail-transaction-log.c:
	  type fixes

2004-09-19 23:46  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-index-transaction.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/mbox/istream-raw-mbox.c: Memory leak fixes

2004-09-19 23:23  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, cmd-fetch.c, imap-fetch.c: cleanups

2004-09-18 14:37  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: net_connect() should be nonblocking (currently
	  unused in Dovecot)

2004-09-17 17:38  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: Allow buffering of output stream when
	  sending message body, to avoid tons of write() calls if CRs have
	  to be inserted.

2004-09-17 15:54  Timo Sirainen <tss@iki.fi>

	* src/util/rawlog.c: don't loop waiting for input, if it didn't
	  come for some reason.

2004-09-16 15:12  Timo Sirainen <tss@iki.fi>

	* src/auth/Makefile.am: fix

2004-09-16 15:03  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: Make sure we disconnect if mail input
	  is finished unexpectedly.

2004-09-16 14:59  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: o_stream_send_istream() was buggy if
	  input stream's offset wasn't 0 or if sendfile() couldn't be used.
	  Fixes problems with sending large mails.

2004-09-16 14:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Remove
	  size==(uoff_t)-1 handling because it never happens.

2004-09-16 14:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-lookup.c, mail-cache-private.h,
	  mail-cache.c: Fix for circular record list detection, we can't
	  use data stack for buffer.

2004-09-16 14:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-lookup.c: Make sure we don't get into
	  infinite loops while reading cache.

2004-09-15 13:23  Timo Sirainen <tss@iki.fi>

	* src/: auth/password-scheme-cram-md5.c, lib/file-dotlock.c:
	  compiler warning fixes

2004-09-15 13:20  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-apop.c, auth/mech-rpa.c, auth/mech.c,
	  imap-login/client-authenticate.c, lib-storage/index/index-mail.c,
	  login-common/ssl-proxy-openssl.c,
	  pop3-login/client-authenticate.c: Compiler warning fixes and
	  cleanups

2004-09-15 13:19  Timo Sirainen <tss@iki.fi>

	* src/lib/: base64.c, base64.h, sha1.c, sha1.h: Change src from
	  unsigned char* toi void* so callers don't have to do casting
	  always.

2004-09-15 13:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c: don't return void
	  types

2004-09-14 23:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream.c, istream.h: i_stream_read_data(): return 0 if
	  i_stream_read() returned 0.

2004-09-13 10:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: Don't crash if
	  matching fails and we don't have header md5 sums saved.

2004-09-12 16:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: We re-cached internaldate
	  every time again, but never used it.

2004-09-12 16:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: bitmask merging code was
	  corrupting the cache file

2004-09-12 14:55  Timo Sirainen <tss@iki.fi>

	* src/: login-common/main.c, pop3-login/client.c: Replaced
	  timestamp in APOP challenge with 128 bits of randomness.

2004-09-12 14:26  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c,
	  src/master/master-settings.h, src/pop3/client.c,
	  src/pop3/client.h, src/pop3/commands.c, src/pop3/common.h,
	  src/pop3/main.c: Added pop3_enable_last setting to enable
	  deprecated LAST command.

2004-09-12 14:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: fix

2004-09-12 14:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-lookup.c,
	  mail-cache-private.h: ID mapping fixes.

2004-09-12 13:05  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-index.c: Fix
	  buffer_set_used_size crashes.

2004-09-12 13:00  Timo Sirainen <tss@iki.fi>

	* src/lib/: buffer.c, buffer.h: Added buffer_write_zero and
	  buffer_append_zero.

2004-09-12 12:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: Don't check extra
	  updates data_id validity if we're just skipping over them.

2004-09-12 10:34  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-transaction-private.h,
	  mail-index-transaction.c, mail-transaction-log.c: We didn't
	  include extra_rec_updates at checking if transaction had changed
	  anything, and so they didn't necessarily get written to
	  transaction log.  This broke mbox offsets sometimes.

2004-09-11 21:54  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Don't rotate log file if
	  it's not fully synced

2004-09-11 20:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: cleanups

2004-09-11 19:58  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: seek fix

2004-09-11 19:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-lookup.c, mail-index-sync-update.c: a
	  few more cache fixes

2004-09-11 18:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h, mbox-sync.c:
	  Last from offset sync fix broke everything. Another try.

2004-09-11 18:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: added assert

2004-09-11 18:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: added asserts

2004-09-11 18:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-util.c: more extra intro fixes

2004-09-11 17:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: fix

2004-09-11 17:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Make sure
	  MAIL_TRANSACTION_EXTRA_INTRO is 4 byte padded, otherwise it
	  crashes.

2004-09-11 17:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-fields.c,
	  mail-cache-transaction.c, mail-index-sync-update.c: Use global
	  null4[] now.

2004-09-11 17:24  Timo Sirainen <tss@iki.fi>

	* src/lib/: lib.c, lib.h: Added null4[] variable.

2004-09-11 17:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: From offsets were updated
	  incorrectly sometimes.

2004-09-11 16:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: More "cache file
	  reopened" fixes

2004-09-11 16:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: extra asserts

2004-09-11 16:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: if there's pending
	  cache_reset in log file make sure appended records don't have
	  invalid cache_offsets.

2004-09-11 15:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: one more "cache file
	  reopened" fix.

2004-09-11 15:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Don't crash when cache
	  isn't usable.

2004-09-11 14:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-transaction.c,
	  mail-index-sync-update.c: More fixes to make sure we don't write
	  buffered data to cache file after it's been reopened.

2004-09-11 12:21  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/common.h, src/imap/main.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Removed mailbox_check_interval
	  completely. It wasn't currently implemented, and most (all?)
	  clients which would benefit from it support IDLE anyway.

2004-09-11 12:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: Report INBOX as existing always, even if it
	  doesn't yet exist in disk.  Fixes COPYing messages to INBOX when
	  it didn't yet exist in disk.

2004-09-11 12:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: If cache file was
	  recreated the buffered transaction changes were written into the
	  new file which may have corrupted it.

2004-09-11 12:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c: minor fix

2004-09-11 10:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: INBOX fixes for
	  maildir too

2004-09-11 10:38  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Don't force showing INBOX when listing only
	  subscribed mailboxes.

2004-09-11 10:28  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, lib-storage/mail-storage.h,
	  lib-storage/index/mbox/mbox-list.c: Added MAILBOX_LIST_INBOX
	  flag. Do the special cased INBOX handling only if it's set.

2004-09-11 10:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c: Make sure we return
	  always one correct INBOX list entry.

2004-09-11 10:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: When there's nothing to
	  do to sync mbox, still commit index syncing instead of
	  rollbacking because it may need to sync index internally.

2004-09-11 09:59  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Before adding new fields
	  to cache file, make sure they weren't already added by re-reading
	  the header after file is locked.

2004-09-10 12:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: minor fix for error
	  message

2004-09-10 12:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: Crashfix with
	  corrupted log files.

2004-09-10 12:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: fix

2004-09-10 11:45  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/index-mail.c,
	  lib-storage/index/index-storage.h,
	  lib-mail/message-part-serialize.c,
	  lib-mail/message-part-serialize.h,
	  lib-storage/index/mbox/mbox-storage.c: Removed all "unreliable
	  headers" handling code. With mbox we actually handle only virtual
	  header sizes everywhere.

2004-09-10 11:44  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Seeking was broken if
	  header hadn't been read yet.

2004-09-10 11:25  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-part-serialize.c,
	  lib-mail/message-part-serialize.h,
	  lib-storage/index/index-mail.c: When using cached message_parts,
	  update the header size with mbox since it may change. Fixes
	  BODY[1] etc. fetches giving corrupted replies.

2004-09-10 10:49  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h, mbox-sync.c:
	  cleanups

2004-09-10 10:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: If we detect cache
	  corruption, try to avoid printing tons of "bad file descriptor"
	  error messages for writes.

2004-09-10 09:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-lookup.c: Added debugging

2004-09-08 13:58  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: fix

2004-09-07 14:24  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: fix for last fix..

2004-09-07 14:23  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Fixes for handling headers longer
	  than input buffer.

2004-09-07 14:23  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: i_stream_read_data(): return -1 if we didn't
	  read more data, even if buffer has some.

2004-09-05 22:07  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-epoll.c: forgot to commit

2004-09-05 22:06  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c: Ignore SIGIO which gets sent if queue
	  gets full. Also other small fixes/cleanups.

2004-09-05 21:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: cleanup

2004-09-05 21:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-poll.c: Added
	  epoll support if --with-ioloop=epoll is given. Patch by Andrey
	  Panin.

2004-09-05 20:29  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c: Drop F_NOTIFY before setting F_SETSIG
	  back to SIGIO, otherwise we might get SIGIO and get ourself
	  killed.

2004-09-05 20:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: fix

2004-09-05 20:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-util.c: comment fix

2004-09-05 20:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: "UIDs not
	  ordered in file" errors could have occured sometimes wrongly.

2004-09-05 18:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't allow renaming
	  mailboxes under INBOX.

2004-09-05 17:53  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-lock.c,
	  lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log-view.c,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-index/mail-transaction-util.c,
	  lib-index/mail-transaction-util.h,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync.c: Save extra record/header
	  infos into index file permanently.

2004-09-05 17:33  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: buffer_reset() was broken..

2004-09-05 15:27  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: "Corrected permissions for base
	  directory" warning message printed wrong directory if base dir
	  was changed in config file.

2004-09-04 15:03  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-create.c: CREATE was broken if namespace prefixes
	  were set. Patch by Andreas Fuchs.

2004-09-04 12:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-mail.h,
	  index-storage.c, index-storage.h: Cache field indexes are cache
	  file specific, not globals.

2004-09-04 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Use uint32_t for getting
	  mail_cache_flags.

2004-09-04 10:29  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: Don't ask for body size when fetching
	  BODY[HEADER], so body doesn't have to be parsed.

2004-09-04 10:27  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/index-mail.c,
	  lib-storage/index/index-mail.h,
	  lib-storage/index/index-storage.c, master/master-settings.c:
	  Fixed cache flags to work again. Flags are cached by default now.

2004-09-04 10:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-lookup.c: Added
	  support for bitmask type.

2004-09-04 09:09  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Added assert

2004-09-04 08:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Avoid re-mmaping if not needed.

2004-09-04 08:51  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-private.h,
	  mail-index-view-sync.c, mail-index-view.c: Refcounting fixes for
	  index mappings.

2004-09-03 20:59  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: cleanup/new assert

2004-09-03 20:53  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: a few more asserts

2004-09-03 20:50  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: lock mprotect fix

2004-09-03 20:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: lock fix

2004-09-03 20:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: fix

2004-09-03 20:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Don't fail if we can't
	  lock cache file.

2004-09-03 20:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't allow creating
	  mailboxes under INBOX.

2004-09-03 20:00  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: fix

2004-09-03 19:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: mprotect() wasn't always called
	  when index was being locked, and caused crashes.

2004-09-03 19:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: When updating index mappings, don't
	  let it affect existing views mappings.  Fixes some crashes.

2004-09-03 18:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-transaction.c: Fix for error
	  handling.

2004-09-03 12:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Still wrong sync logic

2004-09-03 12:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: sync fix

2004-09-03 10:31  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't check for linux/mman.h, it's not even used.

2004-09-03 09:52  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Fix for having INBOX/ namespace.

2004-09-03 09:00  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: _send_istream() might have crashed.

2004-09-02 19:18  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-client-interface.h,
	  imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: Tell dovecot-auth if SSL/TLS is
	  enabled. Nothing can done with it yet though.

2004-09-02 17:03  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: crashfix in pid generation

2004-09-02 16:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-save.c,
	  maildir-storage.h, maildir-sync.c: Don't break if saving messages
	  to maildir without index files.

2004-09-02 16:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: Recent flags might have been
	  wrong if they weren't set in ascending order.

2004-09-02 16:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: Go back to
	  version 1 dovecot-uidlist file. The flags parameter isn't needed.

2004-09-02 15:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Don't return -2 so
	  easily in read()

2004-09-02 15:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h, mbox-sync.c:
	  Wrong messages were set recent if another client had modified the
	  mbox.

2004-09-02 10:55  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-copy.c: removed extranous code.

2004-09-02 10:48  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: Make RETR mark the message seen.

2004-09-02 10:34  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-base-subject.c: Parsing fix

2004-09-01 14:28  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Log error message if we can't open INBOX.

2004-08-31 15:46  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Create PID file.

2004-08-31 09:32  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-encrypt.c: Patch by Andrey Panin:

	   - open code ntlmssp_des_encrypt_triad() function;
	   - add two missing safe_memset(). It's not safe to leave NTLM
	     hashes on the stack, because they are plain password
	  equivalents.

2004-08-31 09:31  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech-apop.c, mech-cram-md5.c, mech-digest-md5.c,
	  mech-login.c, mech-ntlm.c, mech-plain.c, mech-rpa.c, mech.c,
	  mech.h: Changed "invalid username" error message.

2004-08-31 09:14  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Output stream sometimes duplicated data
	  and sometimes lost data.

2004-08-31 08:17  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: fixed potential crash

2004-08-29 07:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Save sync_last_check for
	  any sync, not just in sync_init() so FAST flag doesn't do another
	  sync if one was just done in transaction commit.

2004-08-29 07:52  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-copy.c, imap/cmd-expunge.c,
	  imap/cmd-search.c, imap/cmd-store.c, imap/imap-expunge.c,
	  imap/imap-fetch.c, imap/imap-sort.c, imap/imap-sync.c,
	  imap/imap-thread.c, lib-storage/mail-storage-private.h,
	  lib-storage/mail-storage.c, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-transaction.c,
	  lib-storage/index/mbox/mbox-storage.h,
	  lib-storage/index/mbox/mbox-transaction.c, pop3/client.c,
	  pop3/commands.c: Added sync flags parameter to
	  mailbox_transaction_commit(), so EXPUNGE can do a full sync with
	  dirty syncing enabled.

2004-08-29 07:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Disabling
	  mbox_dirty_syncs didn't always work. And it was a bit broken.

2004-08-28 20:08  Timo Sirainen <tss@iki.fi>

	* src/auth/main.c: Initialize userdb/passdb/password schemes before
	  dropping privileges.

2004-08-28 20:07  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-static.c: Added mail setting and made home
	  optional.

2004-08-28 18:21  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Default ssl_disabled to yes if SSL
	  isn't compiled in.

2004-08-28 18:04  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Input handler tried to process multiple
	  commands at once which broke things.

2004-08-28 17:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-file.c, mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync.c: When mbox syncing is dirty,
	  read the message headers to verify that we've found the correct
	  message.

2004-08-28 16:39  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/cmd-check.c,
	  src/imap/cmd-expunge.c, src/imap/cmd-select.c,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/mbox/mbox-file.c,
	  src/lib-storage/index/mbox/mbox-file.h,
	  src/lib-storage/index/mbox/mbox-mail.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-sync-private.h,
	  src/lib-storage/index/mbox/mbox-sync.c,
	  src/lib-storage/index/mbox/mbox-transaction.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added mbox_dirty_syncs setting
	  which delays re-reading the whole mbox when it's changed.

2004-08-28 13:25  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/mech-apop.c,
	  src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	  src/auth/mech-login.c, src/auth/mech-ntlm.c,
	  src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	  src/auth/mech.h, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  auth_username_translation setting.

2004-08-28 13:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c: Fixed
	  crash if mail data was fetched in specific order. Plus some minor
	  fixes.

2004-08-28 12:57  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h: Command parameter errors weren't
	  handled right. This was broken a few commits ago..

2004-08-28 12:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: Handle correctly the
	  case when index hasn't yet been synced with transaction log.

2004-08-28 11:04  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-connection.c: Process all input data from
	  stream.

2004-08-28 11:02  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-connection.c: Fixed memory leak.

2004-08-28 10:32  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-fetch-body.c, imap/imap-sort.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-mail.c,
	  lib-storage/index/index-mail.h, lib-storage/index/index-search.c,
	  lib-storage/index/maildir/maildir-mail.c,
	  lib-storage/index/mbox/mbox-mail.c, pop3/client.c,
	  pop3/commands.c: Added mail.get_physical_size().

2004-08-28 10:31  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: removed accidentally committed debugging

2004-08-28 09:34  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Deinitialize pop3 commands if connection is
	  closed unexpectedly.

2004-08-28 09:32  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, cmd-append.c, cmd-idle.c: Deinitialize
	  command handlers always.

2004-08-28 09:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Don't crash if
	  canceling saving

2004-08-28 09:22  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: Or actually check also that
	  RESTRICT_GID_FIRST=0 before allowing gid=0 use

2004-08-28 09:19  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: Allow group id to be 0 even with
	  disallow_root. So setting valid_first_gid to 0 now actually
	  works.

2004-08-28 09:17  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: Don't crash with unknown FETCH commands.

2004-08-25 12:27  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-internal.h, ioloop-poll.c, ioloop-select.c,
	  ioloop.c: Changed io_remove() to destroy the io immediately.
	  Changed struct io to be double linked list. Moved highest_fd into
	  select-specific struct. Some minor optimizations.

2004-08-25 12:09  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-select.c, ioloop.c: Moved highest_fd calculation
	  to select-specific code. Patch by Andrey Panin.

2004-08-25 11:55  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, commands.c: Fixes for nonblocking changes.

2004-08-25 08:25  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-crlf.c: send_istream(): Don't return -1 if input
	  stream just didn't contain anything.

2004-08-25 08:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: Recent flag wasn't
	  written always

2004-08-25 08:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: We kept exclusive index lock too
	  long which caused deadlocks.

2004-08-24 10:12  Timo Sirainen <tss@iki.fi>

	* src/lib/lib-signals.c: Ignore SIGALRM.

2004-08-24 05:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Don't crash if flag update
	  record gets completely overlapped by expunges.

2004-08-23 19:27  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Use larger default buffer
	  sizes

2004-08-23 19:26  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-crlf.c: close/destroy fixes

2004-08-23 19:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Use correct error
	  messages.

2004-08-23 15:29  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch-body.c: fix

2004-08-23 15:27  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: o_stream_send*() might have returned
	  wrong value

2004-08-23 14:48  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: Same FETCH handler could have been
	  executed infinitely if client didn't read the data fast enough.

2004-08-23 14:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-storage.h,
	  mbox/mbox-storage.c: We shouldn't try to use cached header
	  physical_size for mboxes because it changes.

2004-08-23 14:15  Timo Sirainen <tss@iki.fi>

	* src/util/rawlog.c: Rawlog filename was always with date
	  01.01.1970.

2004-08-23 13:47  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-internal.h, ioloop-poll.c, ioloop-select.c,
	  ioloop.c: Internal I/O loop API change in preparation for epoll
	  support. Patch by Andrey Panin.

2004-08-23 10:05  Timo Sirainen <tss@iki.fi>

	* src/lib/Makefile.am: ostream-crlf.h was missing

2004-08-23 07:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mailbox-check.c: Timeout/stat() based
	  mailbox change checker didn't actually ever send notifications.

2004-08-23 07:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Save mails through
	  CRLF or LF output streams.

2004-08-23 07:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: sync fix

2004-08-23 07:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-update.c, mbox-sync.c:
	  Recent flag fixes.

2004-08-23 07:14  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: Crashfix

2004-08-23 07:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Don't crash with
	  empty body

2004-08-23 06:38  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: fix

2004-08-23 04:47  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: o_stream_sendv() returned wrong value if
	  sending more than UIO_MAXIOV iovecs.

2004-08-23 04:36  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-crlf.c: fixes

2004-08-23 04:05  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: fix

2004-08-23 04:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Fixed handling
	  messages with empty body.

2004-08-23 03:58  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: Accidentally committed debugging code.

2004-08-23 03:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: ostream-crlf.c, ostream-crlf.h: Changed LF stream to
	  replace only CRLF pairs. Changed send functions to return the
	  number of input bytes consumed rather than number of bytes
	  actually sent. This fixes send_istream().

2004-08-22 12:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c, mbox-sync.c:
	  Fixed parsing empty messages.

2004-08-22 12:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  istream-raw-mbox.h, mbox-sync.c: istream-raw-mbox now sets
	  stream->eof when it's at the end of message to fix some issues
	  elsewhere.

2004-08-22 12:09  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-file.c: _read() never returns 0 for files.

2004-08-22 12:02  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: fix

2004-08-22 11:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Saving fix.

2004-08-22 11:48  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-append.c: crashfixes

2004-08-22 11:23  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: i_stream_read_data(): don't return -1 unless
	  we're at EOF.

2004-08-22 11:19  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-crlf.c: send_istream() didn't work properly.

2004-08-22 11:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: Buffer wasn't set
	  if _read() returned -2.

2004-08-22 11:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: saving was broken

2004-08-22 11:03  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Forgot want_mail=TRUE parameter from
	  debugging.

2004-08-22 11:00  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream.c: o_stream_send* functions return type is
	  ssize_t, not int.

2004-08-22 11:00  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: AUTHENTICATE and AUTH commands
	  were broken.

2004-08-22 10:48  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: i_stream_read_data(): don't loop if read()
	  returns 0.

2004-08-22 10:32  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-fetch-body.c, lib-mail/istream-header-filter.c,
	  lib-mail/istream-header-filter.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/mbox/mbox-mail.c,
	  lib-storage/index/mbox/mbox-save.c: Changed istream-header-filter
	  API a bit. Added HIDE_BODY option. Fixed mail.get_headers().

2004-08-22 10:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Crashfix

2004-08-22 10:05  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Optimization for setting
	  initial sync_offset from index.

2004-08-22 09:52  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/common.h,
	  src/imap/imap-fetch-body.c, src/imap/imap-fetch.h,
	  src/imap/main.c: Added netscape-eoh workaround.

2004-08-22 09:46  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment fix

2004-08-22 09:17  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, lib-storage/Makefile.am,
	  lib-storage/mail-copy.c, lib-storage/mail-copy.h,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-transaction.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h,
	  lib-storage/index/mbox/mbox-transaction.c: Changed mail saving
	  API to be nonblocking.

2004-08-22 09:15  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, cmd-idle.c: Set bad_counter before calling
	  client_command_reset because it may parse more commands.

2004-08-22 09:13  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-limit.c, lib-mail/istream-header-filter.c,
	  lib-mail/message-parser.c: Fixes for nonblocking streams.

2004-08-22 09:13  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Call callback for EOH too.

2004-08-22 09:12  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: If headers don't end with linefeed
	  and there's no ':' in the line, don't hide the data.

2004-08-22 07:00  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-limit.c: When we reach the limit, set eof = true

2004-08-22 06:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Use madvise() for mmaped
	  transaction log file.

2004-08-22 06:30  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-mmap.c, mmap-util.c, mmap-util.h: Added
	  mmap_get_page_size() call which basically returns getpagesize()
	  but makes sure it's called only once so there's no syscall
	  overhead every time.

2004-08-22 06:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-util.c: If we can't create
	  maildir temp file because we're out of quota, give user readable
	  error message.

2004-08-22 06:00  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: Do the final callback after
	  deinitializing header parser so offsets are correct.

2004-08-22 05:54  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-fetch-body.c, imap/main.c,
	  lib-mail/istream-header-filter.c,
	  lib-mail/istream-header-filter.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/mbox/mbox-mail.c: header filter can now
	  optionally use either LF or CRLF linefeeds.

2004-08-22 05:47  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c: We didn't call callback
	  with NULL header at the end.

2004-08-22 05:46  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-crlf.c: Keep track of offset.

2004-08-22 05:04  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, ostream-crlf.c, ostream-crlf.h: Added
	  CRLF/LF output stream converters.

2004-08-22 04:51  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Limit iovec count to UIO_MAXIOV for
	  writev() calls.

2004-08-22 04:00  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-data.c, lib/istream-file.c,
	  lib/istream-limit.c, lib/istream-mmap.c, lib/istream.c,
	  lib/istream.h, lib-mail/istream-header-filter.c,
	  lib-storage/index/mbox/istream-raw-mbox.c,
	  lib-storage/index/mbox/istream-raw-mbox.h,
	  lib-storage/index/mbox/mbox-sync.c: Removed istream.disconnected,
	  it's too much of a special case and the only place where it's
	  needed will be removed soon. Added istream.eof back, it's more
	  useful.

2004-08-22 03:19  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/istream-header-filter.c,
	  lib-mail/message-body-search.c, lib-mail/message-parser.c,
	  lib-mail/message-parser.h,
	  lib-storage/index/mbox/mbox-sync-parse.c:
	  message_parse_header_next() can now return "need more data" with
	  nonblocking input streams.

2004-08-22 02:58  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-fetch-body.c, lib-mail/istream-header-filter.c,
	  lib-mail/istream-header-filter.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/mbox/mbox-mail.c: istream-header-filter now
	  parses the headers incrementally while read()ing, instead of
	  doing it at initialization and storing into one large buffer.

2004-08-19 03:56  Timo Sirainen <tss@iki.fi>

	* AUTHORS, src/auth/Makefile.am, src/auth/mech-rpa.c,
	  src/auth/mech.c, src/auth/passdb.c, src/auth/passdb.h,
	  src/auth/password-scheme-rpa.c, src/auth/password-scheme.c,
	  src/auth/password-scheme.h: Added Compuserve RPA authentication.
	  Patch by Andrey Panin.

2004-08-18 23:53  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-append.c, cmd-check.c,
	  cmd-copy.c, cmd-expunge.c, cmd-fetch.c, cmd-idle.c, cmd-noop.c,
	  cmd-search.c, cmd-select.c, cmd-sort.c, cmd-status.c,
	  cmd-store.c, cmd-thread.c, commands-util.c, commands-util.h,
	  commands.h, imap-sync.c, imap-sync.h: Syncing works now too
	  without buffering everything. Also fixed handling input while
	  command was being processed.

2004-08-18 23:42  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, mech.c: fixes

2004-08-18 05:13  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-list.c, commands-util.c: LIST
	  command interrupts itself when output buffer gets full and
	  continues again when there's space.

2004-08-18 05:10  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-store.c: Don't do separate kludging for readonly
	  mailboxes.

2004-08-18 00:59  Timo Sirainen <tss@iki.fi>

	* src/lib/: buffer.c, buffer.h: Added buffer_reset()

2004-08-15 03:52  Timo Sirainen <tss@iki.fi>

	* src/: auth/password-scheme.c, lib-storage/mail-storage.h: oops,
	  shouldn't have committed these

2004-08-15 03:40  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-client-connection.c,
	  auth/auth-master-connection.c, auth/password-scheme.c,
	  imap/Makefile.am, imap/client.c, imap/client.h,
	  imap/cmd-append.c, imap/cmd-fetch.c, imap/cmd-idle.c,
	  imap/cmd-search.c, imap/common.h, imap/imap-fetch-body.c,
	  imap/imap-fetch.c, imap/imap-fetch.h, imap/imap-messageset.c,
	  imap/imap-messageset.h, imap/imap-search.c, imap/imap-search.h,
	  imap/imap-thread.c, imap/mail-storage-callbacks.c, imap/main.c,
	  imap-login/client-authenticate.c, imap-login/client.c,
	  lib/Makefile.am, lib/file-lock.c, lib/iostream-internal.h,
	  lib/iostream.c, lib/istream-data.c, lib/istream-file.c,
	  lib/istream-limit.c, lib/istream-mmap.c, lib/istream.c,
	  lib/istream.h, lib/lib.c, lib/ostream-file.c,
	  lib/ostream-internal.h, lib/ostream.c, lib/ostream.h,
	  lib/strfuncs.c, lib/strfuncs.h,
	  lib-auth/auth-server-connection.c,
	  lib-auth/auth-server-request.c, lib-mail/istream-header-filter.c,
	  lib-mail/istream-header-filter.h, lib-mail/message-send.c,
	  lib-mail/message-send.h, lib-storage/mail-storage.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/mbox/istream-raw-mbox.c,
	  lib-storage/index/mbox/mbox-lock.c,
	  lib-storage/index/mbox/mbox-save.c, pop3/client.c, pop3/client.h,
	  pop3/commands.c, pop3-login/client-authenticate.c,
	  pop3-login/client.c: We never do blocking reads/writes to network
	  anymore. Changed imap and pop3 processes to use a single I/O
	  loop.

	  Not much tested yet, and currently LIST/LSUB may eat too much
	  memory and APPEND eats all CPU.

2004-08-15 02:54  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: rollback: don't lock file
	  if we don't need to

2004-08-15 02:50  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-lookup.c: bugfix

2004-08-14 22:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: assert crashfix

2004-08-09 20:13  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  auth_debug setting.

2004-08-09 19:14  Timo Sirainen <tss@iki.fi>

	* configure.in: If -lmysqlclient doesn't automatically link with
	  zlib, do it manually.

2004-08-06 18:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-search.c: SEARCH TEXT was broken

2004-07-31 22:34  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.h: buffer.data should be void, not unsigned char

2004-07-31 20:53  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: buffer_append() fix

2004-07-31 20:43  Timo Sirainen <tss@iki.fi>

	* src/lib/: buffer.c, buffer.h: Removed start_pos and limit
	  handling, they weren't used much and were only making it more
	  complex. Also made data and size variables directly accessible to
	  make it easier to use buffers.

2004-07-31 20:19  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-base-subject.c, imap-base-subject.h: Drop
	  using buffer_set_start_pos(). Also some coding style cleanups.

2004-07-31 04:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c,
	  mail-transaction-log-view.c, mail-transaction-log.c,
	  mail-transaction-log.h, mail-transaction-util.c: Small cleanups.

2004-07-31 04:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index.c: Fixed fd leaks

2004-07-31 03:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: removed assert

2004-07-31 03:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-fields.c,
	  mail-cache-private.h, mail-cache-transaction.c, mail-cache.c,
	  mail-index-private.h, mail-index.c,
	  mail-transaction-log-private.h, mail-transaction-log-view.c,
	  mail-transaction-log.c, mail-transaction-log.h: Transaction log
	  file is now read-lockless.

2004-07-31 00:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-storage.h, mbox-sync-update.c:
	  Don't write Content-Length unless it's value is larger than 1024
	  bytes.

2004-07-31 00:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Fix rewriting pseudo
	  header when it needs to grow.

2004-07-31 00:33  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/istream-header-filter.c,
	  lib-mail/message-parser.c, lib-mail/message-parser.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync-private.h,
	  lib-storage/index/mbox/mbox-sync-rewrite.c: Added struct
	  message_header_line.middle and middle_len to contain the ':' in
	  header and whitespace around it.

2004-07-30 23:37  Timo Sirainen <tss@iki.fi>

	* configure.in: Mysql check fix

2004-07-30 23:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: fix

2004-07-30 23:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Rollback index sync if
	  mbox syncing failed

2004-07-30 23:24  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Changed some asserts to
	  failure return calls since they actually can happen

2004-07-30 09:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Growing index record size
	  in the middle of transaction wasn't working right.

2004-07-30 09:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: read-only mbox fix

2004-07-30 08:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't try to write-lock
	  read-only mboxes

2004-07-30 07:53  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-cram-md5.c: cleanup

2004-07-30 07:52  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-message.c: compile fix

2004-07-30 05:08  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync.c, lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-sync-private.h,
	  lib-storage/index/mbox/mbox-sync.c: Renamed mail_index_sync_end()
	  to _commit() and added _rollback(). Fixed mbox deadlocking issue.

2004-07-30 05:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c:
	  mail_transaction_log_view_next() didn't actually stop at the end
	  of view window, but continued to the end of file. That sometimes
	  caused crashes and maybe other problems.

2004-07-30 03:10  Timo Sirainen <tss@iki.fi>

	* src/util/Makefile.am: RAND_LIBS and MODULE_LIBS are needed for
	  dovecotpw.

2004-07-30 03:08  Timo Sirainen <tss@iki.fi>

	* src/util/dovecotpw.c: getopt.h isn't needed for getopt() and
	  doesn't exist in all systems.

2004-07-30 03:04  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: include lib.h first

2004-07-30 03:02  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm.h: Don't include stdint.h, it's already
	  included in lib.h if it exists.

2004-07-30 03:01  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/: ntlm-encrypt.c, ntlm-message.c: Moved system
	  header includes after local headers to fix some compile problems.

2004-07-30 02:58  Timo Sirainen <tss@iki.fi>

	* src/lib/sha1.h: one more u_int..

2004-07-30 02:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: sha1.c, sha1.h: Changed to use standard uint* types
	  rather than u_int*. Also removed K&R-isms.

2004-07-30 02:07  Timo Sirainen <tss@iki.fi>

	* configure.in: Better MySQL checking. Patch by John Dennis

2004-07-30 01:57  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-cram-md5.c, auth/password-scheme-cram-md5.c,
	  lib/Makefile.am, lib/hmac-md5.c, lib/hmac-md5.h,
	  lib-ntlm/Makefile.am: Merged CRAM-MD5 and NTLM hmac-md5 code.
	  Patch by Joshua Goodall

2004-07-30 01:47  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: Added NTLM kludge. Patch by
	  Andrey Panin

2004-07-30 01:43  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-ntlm.c, auth/passdb.c, auth/passdb.h,
	  auth/password-scheme-ntlm.c, auth/password-scheme.c,
	  auth/password-scheme.h, lib-ntlm/ntlm-encrypt.c,
	  lib-ntlm/ntlm-encrypt.h, lib-ntlm/ntlm-types.h: Added LANMAN
	  password scheme. Patch by Andrey Panin

2004-07-30 01:39  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, util/Makefile.am: Added
	  auth/libpassword.a which util/dovecotpw can use rather than using
	  object files directly.

2004-07-30 01:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: mbox corruption
	  fix

2004-07-28 16:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: mail_cache_lock() crashed if index
	  wasn't locked while it was called.

2004-07-28 15:39  Timo Sirainen <tss@iki.fi>

	* AUTHORS, configure.in, src/Makefile.am, src/auth/Makefile.am,
	  src/auth/mech-ntlm.c, src/auth/mech.c, src/auth/passdb.c,
	  src/auth/passdb.h, src/auth/password-scheme-ntlm.c,
	  src/auth/password-scheme.c, src/auth/password-scheme.h,
	  src/lib/Makefile.am, src/lib/md4.c, src/lib/md4.h,
	  src/lib-ntlm/.cvsignore, src/lib-ntlm/Makefile.am,
	  src/lib-ntlm/ntlm-byteorder.h, src/lib-ntlm/ntlm-des.c,
	  src/lib-ntlm/ntlm-des.h, src/lib-ntlm/ntlm-encrypt.c,
	  src/lib-ntlm/ntlm-encrypt.h, src/lib-ntlm/ntlm-flags.h,
	  src/lib-ntlm/ntlm-message.c, src/lib-ntlm/ntlm-message.h,
	  src/lib-ntlm/ntlm-types.h, src/lib-ntlm/ntlm.h: NTLM
	  authentication. Patch by Andrey Panin

2004-07-28 15:21  Timo Sirainen <tss@iki.fi>

	* src/lib/: hex-binary.c, hex-binary.h: Added binary_to_hex_ucase()

2004-07-27 06:39  Timo Sirainen <tss@iki.fi>

	* AUTHORS: updated

2004-07-26 23:09  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: LSUB sent LIST replies instead of LSUB.

2004-07-26 18:52  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-sync-update.c,
	  lib-storage/index/mbox/mbox-sync.c: Fixed recent flags with mbox.

2004-07-26 17:59  Timo Sirainen <tss@iki.fi>

	* src/util/Makefile.am: dovecotpw_INCLUDES didn't actually work.
	  Don't even try, src/auth/ must be compiled before we get here.

2004-07-26 17:07  Timo Sirainen <tss@iki.fi>

	* src/: lib/sha1.c, lib/sha1.h, util/.cvsignore, util/dovecotpw.c:
	  Forgot from last dovecotpw commit.

2004-07-26 17:06  Timo Sirainen <tss@iki.fi>

	* configure.in: Added MySQL SSL support.

2004-07-26 16:39  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/lib/var-expand.c: Added support for
	  %offset.width format in variables.

2004-07-26 16:21  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/passdb.c, src/auth/password-scheme.c,
	  src/auth/password-scheme.h, src/lib/Makefile.am,
	  src/util/Makefile.am: Added dovecotpw utility. Patch by Joshua
	  Goodall

2004-07-26 15:42  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-vpopmail.c: Support MD5 passwords. Patch by
	  Pascal Malterre

2004-07-26 15:27  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-list.c: fix

2004-07-26 14:49  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: mbox parsing fix

2004-07-24 21:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-fields.c, mail-cache.c: Allocate
	  cache->fields and cache->fields_file_map with malloc rather than
	  from pool.

2004-07-24 16:03  Timo Sirainen <tss@iki.fi>

	* COPYING: mail-thread.c -> imap-thread.c

2004-07-23 19:07  Timo Sirainen <tss@iki.fi>

	* configure.in: If MySQL header checks failed, configure still
	  passed.

2004-07-23 18:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Better error message for
	  unknown fields in mail*_cache_fields

2004-07-23 18:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-mail.h: Fixed a crash
	  with fetch (rfc822.size body). Also fixed it so it doesn't
	  anymore parse the message body twice.

2004-07-23 18:07  Timo Sirainen <tss@iki.fi>

	* src/auth/password-scheme.c: crypt_generate and md5_generate used
	  only 3 different characters for salt.  Patch by Joshua Goodall.

2004-07-23 16:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c,
	  index-mail.h: get_index() wasn't working with caching disabled

2004-07-23 16:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Assert crashfix in
	  certain situations when adding new cache records.

2004-07-23 03:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Force mmap_no_write = yes
	  if configure detected that.

2004-07-23 00:05  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: Make certificate valid for one year

2004-07-22 21:20  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-copy.c, imap/cmd-create.c,
	  imap/cmd-delete.c, imap/cmd-list.c, imap/cmd-namespace.c,
	  imap/cmd-rename.c, imap/cmd-select.c, imap/cmd-status.c,
	  imap/cmd-subscribe.c, imap/commands-util.c, imap/commands-util.h,
	  imap/namespace.c, imap/namespace.h,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-storage.c,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h, pop3/main.c: Moved
	  namespace and hierarchy separator handling to imap-specific code.
	  LIST now shows non-hidden namespaces in the LIST reply.

2004-07-22 19:37  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/fdpass.c: Check BUGGY_CMSG_MACROS in
	  configure.

2004-07-22 18:59  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Added BUGGY_CMSG_HEADERS #define to workaround
	  some OS bugs. Updated comments and macros to be more accurate.

2004-07-22 13:46  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: compiler warning fix

2004-07-22 13:42  Timo Sirainen <tss@iki.fi>

	* AUTHORS, src/auth/Makefile.am, src/auth/mech-login.c,
	  src/auth/mech.c: Added LOGIN SASL mechanism. Patch by Andrey
	  Panin

2004-07-22 13:33  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: POP3 CAPA command shouldn't
	  return "AUTH=" in SASL reply. Patch by Andrey Panin

2004-07-20 18:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Added error checking

2004-07-20 17:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Use larger field_pool size by
	  default.

2004-07-20 17:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-decisions.c, mail-cache-fields.c,
	  mail-cache-private.h: Fixes for big endian systems.

2004-07-20 17:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-private.h, mail-cache-transaction.c:
	  Limit how much a single transaction can reserve space

2004-07-20 17:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-lookup.c: mail_cache_lookup_headers()
	  fix

2004-07-20 16:50  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-decisions.c, lib-index/mail-cache-fields.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache-private.h,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c: Cache fixes. Decisions are saved
	  again.

2004-07-20 12:45  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Compile fix when modules were disabled.
	  Patch by Andrey Panin.

2004-07-20 12:44  Timo Sirainen <tss@iki.fi>

	* src/lib/md5.c: md5_final() didn't properly clear the whole MD5
	  context. Also changed to use safe_memset(). Patch by Andrey Panin

2004-07-18 17:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c,
	  index-mail.h: header caching fixes

2004-07-18 12:54  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: SSL proxy was destroyed
	  after login instead of staying in background.

2004-07-18 12:36  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sync.c: Don't send EXISTS after each EXPUNGE.

2004-07-18 12:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-sync.c,
	  mail-transaction-log-view.c: Don't crash if
	  mail_index_view_sync_next() is called again after it's finished.

2004-07-18 02:31  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Changed default cache fields

2004-07-18 02:30  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Changed default cache fields.

2004-07-18 02:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Avoid parsing headers
	  twice to get IMAP envelope.

2004-07-18 02:25  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-fetch.c, imap/imap-fetch.h, imap/imap-sort.c,
	  imap/imap-thread.c, lib-imap/imap-bodystructure.c,
	  lib-index/Makefile.am, lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-decisions.c, lib-index/mail-cache-fields.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache-private.h,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-mail/istream-header-filter.c,
	  lib-mail/istream-header-filter.h,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-mail.c,
	  lib-storage/index/mbox/mbox-storage.c: Header caching redesigned.
	  New design allows caching decisions per field, so they can be
	  divided to temporary/permanent. Cached headers are now always
	  returned in original order, old code didn't guarantee it. Some
	  other caching changes. (still missing code to store changes in
	  caching decisions)

2004-07-18 01:44  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: bsearch_strcasecmp() actually called strcmp..

2004-07-16 16:20  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/db-ldap.c: Fixed to compile with Solaris
	  LDAP library

2004-07-15 12:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c: Delay memory allocations
	  for cache transaction. We don't always need it.

2004-07-12 18:14  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: outlook-no-nuls workaround fix

2004-07-12 11:35  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, imap/client.h, imap/cmd-idle.c,
	  imap/cmd-select.c, imap/cmd-status.c, imap/cmd-store.c,
	  imap/commands-util.c, imap/imap-fetch.c, imap/imap-sync.c,
	  imap/imap-sync.h, imap/mail-storage-callbacks.c,
	  lib-imap/imap-util.c, lib-imap/imap-util.h,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h,
	  lib-storage/index/index-mailbox-check.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h,
	  lib-storage/index/mbox/mbox-sync.c, pop3/client.c,
	  pop3/mail-storage-callbacks.c: Broke mailbox_sync() into
	  iterator.

2004-07-12 11:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c: View syncing
	  fixes/cleanups.

2004-07-12 08:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Handle recent flags
	  in index file correctly. Fixes recent flag losing when copying or
	  saving mails with flags.

2004-07-11 22:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: mbox recent fixes.

2004-07-11 21:09  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-transaction-log.c,
	  lib-storage/index/index-storage.c: Use CMP_DEV_T() macro to
	  compare struct stat.st_dev

2004-07-11 21:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-status.c,
	  index-storage.h, index-sync.c, maildir/maildir-mail.c,
	  maildir/maildir-storage.c, maildir/maildir-uidlist.h,
	  mbox/mbox-storage.c: Recent flags should be fully working now
	  with maildir.

2004-07-10 17:24  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/common.h, src/imap/main.c,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h, src/pop3/commands.c,
	  src/pop3/common.h, src/pop3/main.c: Split client_workarounds to
	  imap_ and pop3_ ones. Added outlook-no-nuls POP3 workaround.

2004-07-10 11:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-lookup.c, mail-cache-private.h,
	  mail-cache-transaction.c, mail-index-private.h,
	  mail-index-transaction.c: Cache fixes. Lookups now look into
	  transactions too.

2004-07-10 11:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-transaction.c: fetch_mail needs to be
	  deinitialized before transaction is committed or rollbacked

2004-07-10 11:14  Timo Sirainen <tss@iki.fi>

	* src/imap/: imap-sort.c, imap-thread.c: thread/sort: commit the
	  transaction, don't rollback..

2004-07-09 19:59  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: And section fix for --exec-mail..

2004-07-09 19:59  Timo Sirainen <tss@iki.fi>

	* src/: login-common/master.c, master/mail-process.c,
	  master/mail-process.h, master/main.c, master/master-settings.c,
	  master/master-settings.h: Added --exec-mail option to master. It
	  can be used to parse Dovecot config file and exec() imap/pop3
	  process directly. Moved --inetd option into environment as it's
	  only for internal use.

2004-07-09 19:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Create all the
	  missing paths up to maildir

2004-07-09 19:21  Timo Sirainen <tss@iki.fi>

	* src/lib/mkdir-parents.c: check EISDIR in next mkdir() too..

2004-07-09 19:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Some more
	  mailbox name checks.

2004-07-09 19:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Crashfix with empty mailbox

2004-07-09 19:09  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: SIGHUP correctly reloads configuration now

2004-07-09 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: When i_set_failure_file() is called, make
	  sure the handlers are reset back to defaults.

2004-07-09 18:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Never treat "mailbox/"
	  as a valid mailbox name.

2004-07-09 17:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: If we're setting
	  flags to saved mail, put it to cur/ directory directly.  Flags
	  aren't allowed in new dir.

2004-07-09 11:45  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Refcounting fixes.
	  Unexpectedly destroyed SSL connection could have left looping for
	  a long time.

2004-07-09 10:57  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-plain.c: We could read authid past the buffer if
	  \0password wasn't given in input.

2004-07-09 00:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c,
	  index-mail.h, index-transaction.c: Always create cache
	  transaction. Easier that way .. and fixes a crash.

2004-07-08 21:27  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: Fixed compression.

2004-07-08 20:26  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-bodystructure.c,
	  lib-imap/imap-bodystructure.h, lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-decisions.c, lib-index/mail-cache-lookup.c,
	  lib-index/mail-cache-private.h,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/maildir/maildir-mail.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/mbox/mbox-mail.c,
	  lib-storage/index/mbox/mbox-save.c: Cache file fixes, API
	  changes, etc. It's still in somewhat ugly state, but getting
	  better..

2004-07-08 20:24  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: If p_free() frees memory, it must
	  also zero it..

2004-07-08 18:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index-lock.c,
	  mail-index-private.h: crashfix

2004-07-07 13:36  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-limit.c, lib-mail/istream-header-filter.c:
	  Wrapper streams shouldn't try to read data if it's already
	  buffered in main stream. Fixes at least problem with APPEND when
	  the whole message came in one TCP packet.

2004-07-06 08:08  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Updated error message texts.

2004-07-06 06:35  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-apop.c, pop3-login/client.c: Fixes, patch by
	  Andrey Panin

2004-07-06 06:06  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added mysql description to example config
	  file. Changed mysql default settings.

2004-07-06 05:55  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: Add "Error report written to
	  server log." also to internal login error messages.

2004-07-05 15:01  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: pool_alloconly_free() can free the
	  last allocation.

2004-07-04 22:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-view-sync.c,
	  mail-transaction-log.c: fixing crashes from last changes

2004-07-04 22:09  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: disable cache file with
	  mmap_no_write. it and mmap_disable will need some non-mmap buffer
	  for reading.

2004-07-04 22:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: more checks against using
	  old cache_offsets

2004-07-04 21:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-compress.c, mail-cache-transaction.c,
	  mail-index-private.h, mail-index-transaction-private.h,
	  mail-index-transaction.c, mail-transaction-log.c: Make sure we
	  don't set cache_offsets to old cache files.

2004-07-04 21:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: cache fix

2004-07-04 21:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: header and extra_rec
	  syncing crashed because of recent changes.

2004-07-04 21:07  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h:
	  Cache API updates. Don't return direct pointers to mmaped cache
	  file anymore.

2004-07-04 20:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: renaming mailbox under
	  existing mailbox gave wrong error message

2004-07-04 20:00  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache-private.h,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-update.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h,
	  lib-storage/index/index-transaction.c: Cache updating is done now
	  by first reserving space where to write, and then writing to it
	  whenever buffer gets full. There is no persistent cache file
	  locks anymore because of this, but it also means that the same
	  cached field may be written multiple times to the file by
	  different processes. Also since we reserve more space than we
	  actually need at first, it some space can be wasted if multiple
	  processes are updating the cache.

2004-07-04 14:26  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache-private.h,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-transaction.c: Caching fixes and
	  optimizations. Removed all network byte ordering code - it's not
	  worth the trouble and would require massive changes in indexing
	  code as well to be useful. Changed next_offset to prev_offset
	  which is updated while syncing index.

2004-07-04 11:50  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-decisions.c, lib-index/mail-cache-lookup.c,
	  lib-index/mail-cache-private.h,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-index/mail-index-sync.c,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/index-storage.h: Cache file compression works
	  now and compressed cache file is reopened.  Several other
	  cleanups related to opening - cache file isn't created
	  immediately anymore.

2004-07-03 20:17  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-storage.c: Removed
	  mail_index_is_in_memory(). It wasn't implemented and it's useless
	  anyway. User doesn't need to see "couldn't use index files" error
	  message.

2004-07-03 18:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-save.c, mbox-storage.h,
	  mbox-sync-rewrite.c, mbox-sync.c: Updated comment about how
	  syncing is done, and s/extra space/padding/

2004-07-03 17:21  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-util.c,
	  lib-storage/index/maildir/maildir-sync.c:
	  mail_index_sync_sort_flags() now merges flag changes so mail
	  storage backends don't need to do it (and maildir didn't before).
	  Dirty flags will be synced now too.

2004-07-03 10:57  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c, lib-index/mail-index.h,
	  lib-storage/index/index-transaction.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/maildir/maildir-uidlist.h: UIDs for appended
	  messages can now be assigned all at once. Maildir now updates
	  indexes immediately while saving messages.

2004-07-03 10:43  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-apop.c: was missing from last commit

2004-07-03 09:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.h: Dropped
	  MBOX_HEADER_EXTRA_SPACE from 100 to 50. It should be enough.

2004-07-03 09:44  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/: client.c, client.h: If we're not connected to
	  all auth sockets, wait before sending greeting so APOP challenge
	  gets sent.

2004-07-02 22:03  Timo Sirainen <tss@iki.fi>

	* AUTHORS, dovecot-example.conf, src/auth/Makefile.am,
	  src/auth/auth-client-connection.c,
	  src/auth/auth-client-connection.h,
	  src/auth/auth-client-interface.h,
	  src/auth/auth-master-connection.c, src/auth/mech.c,
	  src/imap-login/client-authenticate.c, src/lib-auth/auth-client.c,
	  src/lib-auth/auth-client.h,
	  src/lib-auth/auth-server-connection.c,
	  src/lib-auth/auth-server-connection.h,
	  src/lib-auth/auth-server-request.c,
	  src/pop3-login/client-authenticate.c,
	  src/pop3-login/client-authenticate.h, src/pop3-login/client.c,
	  src/pop3-login/client.h: Added APOP authentication for POP3.
	  Patch by Andrey Panin.

	  This required some changes in auth APIs.

2004-07-02 18:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync.c: Don't keep filling empty spaces
	  which will be overwritten soon anyway. Major speedup for
	  rewriting large mboxes.

2004-07-02 15:36  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: i_stream_read_data() could have returned
	  invalid data at EOF (notable with mboxes since end of mail =
	  "EOF").

2004-07-02 13:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: body_offset wasn't
	  set if mail had no header.

2004-07-02 12:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: make sure there's
	  only LWSP after X-UID

2004-07-02 12:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: fix for mboxes with
	  pseudo header mail

2004-07-02 11:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: saving messages to empty
	  mbox was buggy

2004-07-02 10:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: assert crashfix

2004-06-30 12:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-decisions.c: Cache decision explanation
	  comment.

2004-06-30 08:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: No maildir filename
	  checking after all.

2004-06-29 16:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c: Temporary: never compress
	  cache file as it's broken now.

2004-06-29 15:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Require that
	  filenames in maildir begin with a digit, otherwise complain.

2004-06-29 13:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: no_partial_rewrite
	  was incorrectly set always

2004-06-29 13:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: fix, _read()
	  sometimes returned -2 too early

2004-06-29 12:10  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: added comment about solaris and changed the
	  macros once again, although may be useless change..

2004-06-29 09:29  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy.c: compile fix when SSL is disabled

2004-06-28 22:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-cache.h: fix

2004-06-28 22:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync-update.c, mbox-sync.c: some fixes
	  for handling pseudo headers.

2004-06-28 21:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync-update.c:
	  Several fixes for updating mbox. Recent changes also made it
	  corrupt headers.

2004-06-28 21:31  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: full_value should contain LFs as
	  well

2004-06-28 17:35  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/Makefile.am, lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-decisions.c, lib-index/mail-cache-lookup.c,
	  lib-index/mail-cache-private.h,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-index/mail-index-sync-update.c,
	  lib-index/mail-index-sync.c, lib-index/mail-index.h,
	  lib-storage/index/index-mail.c: Added some smartness for deciding
	  what to cache. Cache compression code compiles, but untested.

2004-06-28 16:44  Timo Sirainen <tss@iki.fi>

	* src/lib/: file-dotlock.c, file-dotlock.h: don't close dotlock fd
	  if it's given as -1

2004-06-28 16:13  Timo Sirainen <tss@iki.fi>

	* src/lib/: ostream-file.c, ostream.h: Allow giving 0
	  max_buffer_size, in which case "optimal" size is used.

2004-06-28 12:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: fixed some fd leaks in
	  error conditions

2004-06-24 14:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Check immediately if
	  we have write-access to mbox.

2004-06-24 13:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, mbox/mbox-sync-parse.c,
	  mbox/mbox-sync-private.h, mbox/mbox-sync.c: Save MD5 sums of some
	  headers for readonly mboxes and use them for syncing

2004-06-24 13:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: removed assert

2004-06-24 11:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-lock.c,
	  mail-index-private.h, mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-sync.c,
	  mail-index-transaction-private.h, mail-index-transaction-view.c,
	  mail-index-transaction.c, mail-index-view-sync.c,
	  mail-index-view.c, mail-index.c, mail-index.h,
	  mail-transaction-log.c, mail-transaction-log.h,
	  mail-transaction-util.c, mail-transaction-util.h: Record size is
	  allowed to change between index files. This will allow adding
	  extensions dynamically for existing indexes.

2004-06-23 20:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: assertfix

2004-06-23 18:33  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache.h, lib-storage/mail-storage.h,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync-private.h,
	  lib-storage/index/mbox/mbox-sync.c, pop3/client.c, pop3/client.h,
	  pop3/commands.c: Added a framework for getting POP3 UIDL strings
	  from mail-storage. The default still is uidvalidity.uid. Added
	  beginnings of overriding it from X-UIDL header in mbox.

2004-06-23 18:05  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: crashfix if client closes
	  connection while authenticating

2004-06-23 17:50  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-master-connection.c,
	  src/auth/auth-master-connection.h,
	  src/auth/auth-master-interface.h, src/auth/common.h,
	  src/auth/main.c, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h:
	  Dovecot can now connect to externally running dovecot-auth.

2004-06-23 17:48  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, login-common/main.c, pop3/main.c,
	  master/main.c: DEBUG: If GDB environment is set, don't do fd leak
	  checks.

2004-06-23 17:47  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb.c, userdb.c: Default to "" args instead of NULL
	  to avoid some crashes

2004-06-23 16:36  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Allow empty section name.

2004-06-23 15:02  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb.c, userdb.c: skip extra whitespace between
	  "dbtype arguments"

2004-06-23 15:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Add a comment about # chars and whitespace.

2004-06-23 14:50  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: don't change our umask permanently

2004-06-23 13:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-lookup.c: Crashfixes for disabled cache.

2004-06-23 06:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: partial syncing
	  fixes

2004-06-23 03:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Complain about
	  reappearing UIDs, but reassign new UIDs to them anyway. Don't try
	  to update \recent mails if we aren't really going to make them
	  non-recent.

2004-06-22 19:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-list.c, mbox-storage.h: We
	  didn't specify full path for .subscriptions file, and it was
	  named without the leading dot..

2004-06-22 07:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage-private.h, mail-storage.c,
	  index/index-storage.c, index/index-storage.h,
	  index/maildir/maildir-storage.c, index/mbox/mbox-storage.c:
	  get_last_error() wasn't virtualizable

2004-06-22 07:36  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/Makefile.am, lib-index/mail-cache-lookup.c,
	  lib-index/mail-cache-transaction.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction-view.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h, lib-index/mail-index-view.c,
	  lib-index/mail-index.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-transaction.c,
	  lib-storage/index/maildir/maildir-transaction.c,
	  lib-storage/index/mbox/mbox-mail.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-transaction.c: Added
	  mail_index_transaction_get_updated_view() which can be used to
	  access uncommitted messages.

2004-06-21 14:51  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/cmd-append.c, src/imap/cmd-copy.c: Removed
	  UIDPLUS after all, it needs more thinking about with maildir.

2004-06-21 14:44  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-lookup.c,
	  lib-index/mail-cache-transaction.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction.c, lib-index/mail-index.h,
	  lib-storage/index/mbox/mbox-save.c: Cache doesn't crash anymore
	  if we're asking it about messages that exist only in uncommitted
	  transactions.

2004-06-21 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-transaction.c, mail-cache.c: Disable
	  cache with mmap_disabled=yes, for now.

2004-06-20 21:27  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-thread.h, lib-storage/mail-storage.h: Moved enum
	  mail_thread_type to imap

2004-06-20 20:55  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment update for setting ports in listen

2004-06-20 20:46  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: assertfix

2004-06-20 20:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: and more fixes..

2004-06-20 20:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: expunge everything in
	  index after missing/invalid X-UID

2004-06-20 13:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync.c: fixes for
	  From-line offset updating

2004-06-20 13:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Hide "folder internal
	  data" messages

2004-06-20 13:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: Exclusive index locking always
	  used copy-locking without even trying fcntl-locking.

2004-06-20 13:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-update.c, mbox-sync.c: Don't die
	  horribly when message with previously expunged UID is inserted
	  into mbox.

2004-06-20 13:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-transaction-log.c:
	  assert crashfixes

2004-06-20 12:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-index-view.c,
	  mail-index.c: Index syncing fixes.

2004-06-20 11:46  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Never overflow secs_left for stale
	  timeout callback

2004-06-20 11:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: fsync() mbox before
	  unlocking if we've modified it

2004-06-20 11:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, mbox/mbox-lock.c,
	  mbox/mbox-sync.c: Allow dropping exclusive mbox locks to shared
	  locks.

2004-06-20 10:37  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-lock.c:
	  Don't require dotlocking to be first in locking list.

2004-06-20 09:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: don't do infinite looping

2004-06-20 09:34  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-transaction-log.c: cache file
	  fixes

2004-06-20 09:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't crash if
	  transaction log contains records for messages that don't exist
	  anymore.

2004-06-20 09:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-lookup.c, mail-cache-private.h,
	  mail-cache-transaction.c, mail-cache.c, mail-cache.h,
	  mail-index-private.h, mail-index-sync-update.c,
	  mail-index-sync.c, mail-index-transaction-private.h,
	  mail-index-transaction.c, mail-index-view.c,
	  mail-transaction-log.c, mail-transaction-log.h,
	  mail-transaction-util.c, mail-transaction-util.h: Several fixes
	  and cleanups to cache file code, still badly broken

2004-06-20 08:05  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache-compress.c,
	  lib-index/mail-cache-lookup.c, lib-index/mail-cache-private.h,
	  lib-index/mail-cache-transaction.c, lib-index/mail-cache.c,
	  lib-index/mail-cache.h, lib-index/mail-index.c,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-transaction.c: Beginnings of getting
	  cache file working again. Easy to break currently, but basics
	  seem to work.

2004-06-20 06:33  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-append.c, cmd-copy.c: APPEND/COPY in non-selected
	  mailbox must not remove the Recent-flag

2004-06-20 06:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: mail_index_lookup() set rec=NULL
	  incorrectly.

2004-06-20 06:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-mail.c, mbox-save.c,
	  mbox-storage.c, mbox-storage.h: Filter internal headers from user
	  visible input stream. Make mailbox_save() use the same header
	  list.

2004-06-20 06:20  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: Makefile.am, istream-header-filter.c,
	  istream-header-filter.h: Added istream-header-filter, which
	  allows filtering specified headers from input stream.

2004-06-20 06:14  Timo Sirainen <tss@iki.fi>

	* src/lib/: strfuncs.c, strfuncs.h: Added bsearch_strcasecmp()

2004-06-20 04:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: assertfix

2004-06-20 04:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-mail.c, mbox-sync.c: Expunge
	  fixes

2004-06-20 04:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view.c, mail-index.h:
	  mail_index_lookup() and mail_index_lookup_extra() now returns 0
	  if message has been expunged, 1 if not.

2004-06-20 03:25  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/cmd-append.c, src/imap/cmd-close.c,
	  src/imap/cmd-copy.c, src/imap/cmd-expunge.c,
	  src/imap/cmd-select.c, src/imap/cmd-status.c,
	  src/imap/commands-util.c, src/imap/commands-util.h,
	  src/imap/commands.c, src/imap/commands.h,
	  src/imap/imap-expunge.c, src/imap/imap-expunge.h,
	  src/lib-index/mail-index-transaction.c,
	  src/lib-index/mail-index.h,
	  src/lib-storage/mail-storage-private.h,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-mail.c,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/mbox/mbox-lock.c,
	  src/lib-storage/index/mbox/mbox-mail.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.h,
	  src/lib-storage/index/mbox/mbox-sync-parse.c,
	  src/lib-storage/index/mbox/mbox-sync-private.h,
	  src/lib-storage/index/mbox/mbox-sync-rewrite.c,
	  src/lib-storage/index/mbox/mbox-sync-update.c,
	  src/lib-storage/index/mbox/mbox-sync.c,
	  src/lib-storage/index/mbox/mbox-transaction.c: mailbox_save() and
	  mailbox_copy() functions can now return the saved mail so it can
	  be immediately queried. Implemented UIDPLUS extension using it.
	  Maildir implementation missing, so it crashes with it for now..
	  APPEND with mbox now doesn't require resyncing the mailbox since
	  it updates indexes directly.

2004-06-20 02:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: Set uid1/uid2 for
	  MAIL_INDEX_SYNC_TYPE_APPEND

2004-06-20 00:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: bugfix for extra-records
	  change

2004-06-19 22:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: read() less often

2004-06-19 22:06  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: seek optimization

2004-06-19 21:44  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Fix for the previous Solaris fix. fd_send() was
	  sending two fds.

2004-06-19 21:29  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: cleanup

2004-06-19 21:24  Timo Sirainen <tss@iki.fi>

	* src/lib/fd-close-on-exec.c: if socket is leaked, show also the
	  remote side of it

2004-06-19 20:29  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-mmap.c: minor optimization

2004-06-19 20:22  Timo Sirainen <tss@iki.fi>

	* configure.in: Use AC_TRY_LINK() for sendfile() checks so it works
	  right with Solaris. Did the same for mremap() too just in case.

2004-06-19 20:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: create mbox root
	  directory if it doesn't exist

2004-06-19 20:07  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: fix for fix

2004-06-19 20:06  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: io_remove() fix

2004-06-19 19:55  Timo Sirainen <tss@iki.fi>

	* configure.in: Removed AC_ARG_PROGRAM. Lets see if this breaks
	  anything..

2004-06-19 19:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: fix

2004-06-19 19:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.h: continuing maildir sync
	  fix commit

2004-06-19 19:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't crash after empty
	  mailbox gets messages

2004-06-19 18:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Don't crash if
	  we're syncing last commit to maildir, but some file was lost

2004-06-19 18:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: index errors always need
	  to store the error message to store

2004-06-19 18:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: don't crash if we wanted
	  to lock mbox for reading but it also needs rewriting

2004-06-19 17:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: minor fix for error handling

2004-06-19 17:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: New mails pointed to
	  beginning of file.

2004-06-19 01:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: assert crashfix for
	  readonly mboxes

2004-06-19 01:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: fix

2004-06-19 01:00  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-limit.c: minor fix

2004-06-19 00:59  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: i_stream_read_data(): don't call read() unless
	  we have to

2004-06-19 00:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync-update.c, mbox-sync.c: fixes

2004-06-18 19:27  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment update

2004-06-18 03:40  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/.cvsignore, src/auth/Makefile.am,
	  src/auth/checkpassword-reply.c, src/auth/passdb-checkpassword.c,
	  src/auth/passdb.c, src/auth/passdb.h: Added checkpassword passdb.
	  userdb has only beginnings.

2004-06-18 00:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  istream-raw-mbox.h, mbox-sync-private.h, mbox-sync.c: Added
	  istream_raw_mbox_is_eof() and fixed updating UIDVALIDITY in index

2004-06-18 00:32  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-file.c, istream-limit.c, istream.c, istream.h:
	  Renamed istream->eof to istream->disconnected which is what it
	  currently does.

2004-06-18 00:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: read-only mbox fix

2004-06-17 23:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c: Fixed updating
	  X-IMAPbase

2004-06-17 23:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-update.c, mbox-sync.c:
	  fixes

2004-06-17 23:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't leak mbox fd
	  when closing mailbox

2004-06-17 23:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync.c: fixes

2004-06-17 22:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: X-IMAPbase update fix

2004-06-17 21:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: Create X-Keywords
	  header if possible.

2004-06-17 21:52  Timo Sirainen <tss@iki.fi>

	* src/lib/: str.c, str.h: Added str_insert()

2004-06-17 21:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync-update.c,
	  mbox-sync.c: Several fixes in space/offset logic. Should be much
	  more robust now.

2004-06-17 21:28  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-body-search.c, lib-mail/message-parser.c,
	  lib-mail/message-parser.h,
	  lib-storage/index/index-mail-headers.c: Added skip_initial_lwsp
	  parameter to message_parse_header_init().

2004-06-16 06:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, mbox/mbox-file.c,
	  mbox/mbox-sync.c: EXAMINE/STATUS should also update metadata
	  changes, they don't really open the mbox as readonly.

2004-06-16 05:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: sync fix

2004-06-16 05:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: fix

2004-06-16 05:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  istream-raw-mbox.h, mbox-mail.c, mbox-sync-rewrite.c,
	  mbox-sync-update.c, mbox-sync.c: Complain if file isn't in mbox
	  format. Complain if From-line wasn't found from expected
	  location. Parser should handle now correctly any kind of mbox no
	  matter how corrupted.

2004-06-16 05:36  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Handle missing last \n from
	  headers more correctly

2004-06-16 02:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-from.c: Oops, don't include the
	  known date formats list (copyrighted by UW-IMAP, copy&pasted
	  there only temporarily and forgot..). They could be compressed
	  just as well for a few short rules.

2004-06-16 02:41  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2004-06-16 02:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: crashfix in error case

2004-06-16 02:04  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib/restrict-access.c,
	  src/lib/restrict-access.h, src/master/auth-process.c,
	  src/master/login-process.c, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  mail_extra_groups setting.

2004-06-16 00:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-storage.h,
	  maildir-sync.c, maildir-util.c: "readonly sync" -> "forced sync"

2004-06-16 00:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: cleanups

2004-06-16 00:46  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-util.c: merging expunge buffers
	  sometimes produced wrong results

2004-06-15 18:17  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c: Raised
	  login_process_size default from 16MB -> 32MB

2004-06-15 17:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-from.c: Allow more From-line date
	  formats.

2004-06-15 03:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: d_type symlink
	  checks

2004-06-15 03:14  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Set PAM_RHOST for PAM if it's known.

2004-06-15 02:49  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment update

2004-06-15 02:44  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-vpopmail.c: Added support for vpopmail
	  pop-before-smtp relay

2004-06-15 02:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-storage.h: forgot to
	  commit

2004-06-15 02:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-util.c: warning

2004-06-15 02:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-lock.c, mbox-save.c,
	  mbox-sync.c: fixes

2004-06-15 01:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-lock.c, mbox-mail.c,
	  mbox-storage.c, mbox-sync-private.h, mbox-sync.c,
	  mbox-transaction.c: lock the mbox before reading it.

2004-06-14 23:42  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Solaris fix by Tim Hurman

2004-06-14 23:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c, mbox-mail.c,
	  mbox-sync-rewrite.c, mbox-sync.c: more syncing fixes

2004-06-14 22:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  istream-raw-mbox.h, mbox-lock.c, mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-update.c, mbox-sync.c: several
	  fixes and optimizations.

2004-06-14 19:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync-update.c, mbox-sync.c: major
	  syncing code cleanups. the code finally looks almost readable.
	  logic should have stayed same.

2004-06-14 05:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-sync.c,
	  maildir-uidlist.c, maildir-uidlist.h: locking fixes

2004-06-14 05:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: crashfix on error

2004-06-14 05:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-sync.c,
	  maildir-uidlist.c: Locking fixes. use less memory

2004-06-14 05:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: bugfixes

2004-06-14 04:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c, mbox-sync.c:
	  fixes

2004-06-14 04:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, mbox/mbox-mail.c,
	  mbox/mbox-storage.c, mbox/mbox-sync-parse.c,
	  mbox/mbox-sync-private.h, mbox/mbox-sync-rewrite.c,
	  mbox/mbox-sync-update.c, mbox/mbox-sync.c: Save mbox offsets to
	  index file using extra_records. Some other fixes.

2004-06-14 04:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Don't let
	  index_storage_alloc() fail

2004-06-14 04:27  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-private.h,
	  mail-index-sync-update.c, mail-index-transaction.c,
	  mail-index-view.c, mail-index.c, mail-index.h,
	  mail-transaction-log.c, mail-transaction-util.c: Fixes for
	  extra_records

2004-06-14 02:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-update.c,
	  mail-index-transaction-private.h, mail-index-transaction.c,
	  mail-index.c, mail-index.h, mail-transaction-log-view.c,
	  mail-transaction-log.c, mail-transaction-log.h,
	  mail-transaction-util.c, mail-transaction-util.h: Modifying
	  extra_records should work now.

2004-06-13 23:38  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-lock.c,
	  mail-index-private.h, mail-index-sync-update.c,
	  mail-index-sync.c, mail-index-transaction.c,
	  mail-index-view-sync.c, mail-index-view.c, mail-index.c,
	  mail-index.h, mail-transaction-log.c, mail-transaction-util.c,
	  mail-transaction-util.h: Added support for per-index sized
	  mail_index_record.

2004-06-13 23:37  Timo Sirainen <tss@iki.fi>

	* src/lib/: network.c, network.h: net_gethostbyname() was broken
	  with IPv6 enabled (wasn't really used with Dovecot anyway). Some
	  other cleanups.

2004-06-13 21:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Don't sync mbox if it
	  hasn't changed

2004-06-13 20:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c, mbox-sync.c:
	  Fixes for expunging first message

2004-06-13 07:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync-update.c,
	  mbox-sync.c: some more fixes

2004-06-13 06:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-rewrite.c, mbox-sync.c:
	  expunges should pretty much work now.

2004-06-11 03:21  Timo Sirainen <tss@iki.fi>

	* src/master/: mail-process.c, master-settings.c,
	  master-settings.h: Some of recent dotlock changes weren't
	  committed..

2004-06-11 03:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  mbox-sync-private.h, mbox-sync-rewrite.c, mbox-sync-update.c,
	  mbox-sync.c: expunging is somewhat working

2004-06-10 16:23  Timo Sirainen <tss@iki.fi>

	* doc/configuration.txt:
	  s/login_process_per_user/login_process_per_connection/

2004-06-10 16:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Make sure INBOX
	  is created when maildir storage is opened.

2004-06-05 19:09  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Changed error message

2004-06-03 15:01  Timo Sirainen <tss@iki.fi>

	* configure.in, dovecot-example.conf,
	  src/lib-storage/index/mbox/mbox-lock.c,
	  src/lib-storage/index/mbox/mbox-sync-parse.c,
	  src/lib-storage/index/mbox/mbox-sync.c: Separate
	  mbox_locks/mbox_read_dotlock to mbox_read_locks and
	  mbox_write_locks. Added support for lockf() method.

2004-05-31 20:10  Timo Sirainen <tss@iki.fi>

	* src/auth/: main.c, mech-cram-md5.c, mech-digest-md5.c, mech.c,
	  mech.h: Delay reporting failed authentications

2004-05-31 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: whops, wrong change.
	  immediate_stale_timeout 2min -> 5min

2004-05-31 19:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Grow log_dotlock_timeout to
	  120sec

2004-05-31 18:57  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-passwd-file.c, db-passwd-file.h, mech-anonymous.c,
	  mech-cram-md5.c, mech-digest-md5.c, mech-plain.c, mech.c, mech.h,
	  passdb-bsdauth.c, passdb-ldap.c, passdb-pam.c,
	  passdb-passwd-file.c, passdb-passwd.c, passdb-shadow.c,
	  passdb-vpopmail.c, userdb-passwd-file.c, userdb-passwd.c: Logging
	  changes. Make sure we don't write control characters to log and
	  also log IP address.

2004-05-31 18:56  Timo Sirainen <tss@iki.fi>

	* src/lib/: network.c, network.h: Added net_getpeername()

2004-05-31 18:04  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/Makefile.am, doc/variables.txt,
	  src/auth/auth-client-interface.h, src/auth/mech.c,
	  src/auth/mech.h, src/imap-login/client-authenticate.c,
	  src/imap-login/client.c, src/imap-login/client.h,
	  src/lib-auth/auth-client.h, src/lib-auth/auth-server-request.c,
	  src/login-common/client-common.h, src/login-common/main.c,
	  src/login-common/master.c, src/master/login-process.c,
	  src/master/mail-process.c, src/master/mail-process.h,
	  src/master/master-login-interface.h,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	  src/pop3-login/client.h: Added %l, %r and %P variables and
	  mail_log_prefix setting.

2004-05-30 21:15  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Don't complain if module directory doesn't
	  exist

2004-05-30 16:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-transaction-log-view.c,
	  mail-transaction-log.c: fixes

2004-05-30 06:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: small fixes

2004-05-30 05:11  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: fix

2004-05-30 05:09  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: assert fix

2004-05-30 05:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: show error messages
	  when log files are missing

2004-05-30 04:55  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Be quiet when we don't want to call init()
	  / deinit() and they don't exist

2004-05-30 04:50  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: PLAIN auth fallbacking works
	  now with initial responses

2004-05-30 04:41  Timo Sirainen <tss@iki.fi>

	* src/imap-login/: client-authenticate.c, client.c, client.h: Use
	  initial SASL response for LOGIN command internally.

2004-05-30 04:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: added assert

2004-05-30 04:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-private.h,
	  mail-index-sync-update.c: fixes

2004-05-30 04:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c: assert fix

2004-05-30 03:57  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, auth/main.c, auth/password-scheme.c,
	  auth/password-scheme.h, imap/main.c, lib/module-dir.c,
	  lib/module-dir.h, pop3/main.c: Added support for password scheme
	  plugins. auth module dir defaults under module_dir now.

2004-05-30 02:21  Timo Sirainen <tss@iki.fi>

	* src/auth/password-scheme.c: Allow either SHA or SHA1.

2004-05-30 01:40  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/: auth-client.c, auth-client.h,
	  auth-server-connection.c, auth-server-connection.h: Allow using
	  more easily outside dovecot.

2004-05-30 01:40  Timo Sirainen <tss@iki.fi>

	* src/auth/mech.c: Case insensitive lookups for mechanism names

2004-05-30 01:39  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/password-scheme.c: SHA1 support via
	  OpenSSL

2004-05-29 22:35  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: updated valid_chroot_dirs error
	  message.

2004-05-29 22:21  Timo Sirainen <tss@iki.fi>

	* configure.in, dovecot-example.conf,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added maildir_stat_dirs option.

2004-05-29 21:40  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, auth/auth-client-connection.c,
	  auth/auth-client-interface.h, auth/auth-master-connection.c,
	  auth/auth-master-connection.h, auth/auth-master-interface.h,
	  auth/main.c, auth/mech-anonymous.c, auth/mech-cram-md5.c,
	  auth/mech-digest-md5.c, auth/mech-plain.c, auth/mech.c,
	  auth/mech.h, auth/passdb.c, imap-login/client-authenticate.c,
	  lib/file-dotlock.c, lib-auth/auth-client.c,
	  lib-auth/auth-client.h, lib-auth/auth-server-connection.c,
	  lib-auth/auth-server-connection.h,
	  lib-auth/auth-server-request.c, pop3-login/client-authenticate.c:
	  Removed hardcoded mechanism lists. It's now possible to add them
	  dynamically. Added support for SASL initial response.

2004-05-29 17:06  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, lib-auth/auth-client.h,
	  lib-auth/auth-server-request.c, auth/auth-client-interface.h,
	  auth/mech.c, auth/mech.h, auth/passdb-pam.c,
	  auth/passdb-vpopmail.c, pop3-login/client-authenticate.c: Don't
	  use hardcoded protocol list for auth process, string is just
	  fine.

2004-05-29 16:43  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-master-connection.c,
	  auth/auth-master-connection.h, auth/main.c, auth/mech.c,
	  master/auth-process.c, master/master-settings.c,
	  master/master-settings.h: dovecot-auth can now be run by itself,
	  it listens in UNIX sockets specified in AUTH_SOCKETS environment.
	  Added extra_sockets auth setting which can be used to do the same
	  thing while started through dovecot master.

2004-05-28 01:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync.c, mail-index-view-sync.c,
	  mail-transaction-log-view.c, mail-transaction-log.h: Keep the
	  transaction log view open all the time for index views (not just
	  while syncing) to avoid losing the log files.

2004-05-28 01:04  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index.c,
	  mail-transaction-log.c: Don't complain about transaction log
	  indexid changes when rebuilding index.

2004-05-26 20:13  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: struct iovec->iov_base may not be defined
	  as void*. add casts to avoid compiler warnings.

2004-05-26 15:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: mmap_disable=yes crashfix

2004-05-26 15:26  Timo Sirainen <tss@iki.fi>

	* configure.in, src/master/Makefile.am,
	  src/master/master-settings.c: Added --with-moduledir configure
	  option

2004-05-26 14:46  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: mail_modules for pop3 should
	  default to lib/pop3, not lib/imap

2004-05-26 03:08  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: oe6-fetch-redundant-msgset workaround
	  doesn't exist anymore, remove it

2004-05-26 02:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Path was missing
	  from Maildir sync-errors.

2004-05-26 02:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: fix

2004-05-25 23:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-view.c: mail_index_lookup_uid_range():
	  don't crash if we look only UIDs larger than our next_uid

2004-05-25 23:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Don't use internal
	  last_cur_mtime stamp - it's index-specific so always get it from
	  index's header.

2004-05-25 23:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-private.h,
	  mail-index.c, mail-index.h: mail_index_refresh() - allows forcing
	  a refresh check

2004-05-25 17:50  Timo Sirainen <tss@iki.fi>

	* src/: imap/mail-storage-callbacks.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c, pop3/mail-storage-callbacks.c:
	  Send recent counter changes when it actually changes.

2004-05-25 14:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c: ,W= fix

2004-05-25 13:01  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy.c: compile fix

2004-05-24 22:51  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: fcntl_locks_disable=yes fix

2004-05-24 22:35  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/imap-sort.c, imap-login/client.c,
	  master/mail-process.c, pop3/commands.c, pop3-login/client.c:
	  cleanup: str_*case(t_strdup_noconst(str)) -> t_str_*case(str)

2004-05-24 22:33  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-master-connection.c,
	  src/auth/mech.c, src/auth/mech.h, src/auth/passdb-ldap.c,
	  src/auth/userdb-ldap.c, src/auth/userdb-passwd-file.c,
	  src/auth/userdb-passwd.c, src/auth/userdb-static.c,
	  src/auth/userdb-vpopmail.c, src/auth/userdb.h,
	  src/lib/strfuncs.c, src/lib/strfuncs.h, src/lib/var-expand.c,
	  src/lib/var-expand.h, src/lib-index/mail-index-sync-update.c,
	  src/master/common.h, src/master/login-process.h,
	  src/master/mail-process.c: Fixed var_expand() to take a table of
	  variables rather than a few predefined ones. Added support for
	  modifiers.

2004-05-24 22:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: don't crash if we
	  can't open directory

2004-05-24 11:22  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: Get internal username from
	  vpw->pw_name after all. It may contain domain which input
	  username doesn't.

2004-05-24 03:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-sync-parse.c, mbox-sync.c:
	  uidvalidity/uidnext fixes

2004-05-24 02:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-sync.c,
	  maildir-uidlist.c, maildir-uidlist.h: race condition fixes

2004-05-24 02:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: cleanup

2004-05-24 02:29  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-fsck.c, lib-index/mail-index.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/maildir/maildir-uidlist.h: Some more
	  UIDVALIDITY issues fixed.

2004-05-24 01:50  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-lock.c,
	  lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-index/mail-transaction-log-view.c,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-index/mail-transaction-util.c,
	  lib-index/mail-transaction-util.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/maildir/maildir-uidlist.h,
	  lib-storage/index/mbox/mbox-sync.c: Index header changes now go
	  through transaction log. Removed the kludgy parameters for
	  mail_index_sync_end(). Removed code duplication of syncing index
	  root mapping and view mapping. Some fixes to handling uidvalidity
	  and nextuid in syncing.

2004-05-24 01:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: fix for last change

2004-05-23 23:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: when index's header size grows,
	  fix it first time we get exclusive lock

2004-05-23 20:03  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Print  version number in "Dovecot starting up"
	  message.

2004-05-23 19:23  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, log.c, log.h, login-process.c,
	  mail-process.c: logging cleanups.

2004-05-23 17:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: more debugging info to log

2004-05-23 16:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-private.h,
	  mail-index-view-sync.c, mail-index-view.c: View's message count
	  shouldn't change until after view is synced.

2004-05-23 16:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Don't try to re-map dirty memory
	  mapping.

2004-05-23 02:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: cleanup

2004-05-23 01:58  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-sync.c, mbox/istream-raw-mbox.c,
	  mbox/mbox-sync-parse.c, mbox/mbox-sync-private.h,
	  mbox/mbox-sync-rewrite.c, mbox/mbox-sync.c: mbox syncing fixes

2004-05-23 01:58  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: o_stream_send_istream() fix

2004-05-22 22:36  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/maildir/maildir-sync.c,
	  src/lib-storage/index/maildir/maildir-uidlist.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h, src/pop3/client.c: Added
	  pop3_mails_keep_recent option. Fixed recent assert crash.

2004-05-22 22:23  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-fsck.c,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-storage/index/index-mail.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c: Recent flag fixes.
	  Should work perfectly now with maildir.

2004-05-22 21:30  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-sync.c: Set dirty flags through
	  transaction log, not directly. Some other flag fixes etc.

2004-05-22 03:42  Timo Sirainen <tss@iki.fi>

	* configure.in: AC_DEFUN warning fixes for aclocal 1.8..

2004-05-22 02:16  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/sendfile-util.c: Solaris: Move from
	  sendfilev() to sendfile() (was it always there?). Make
	  EAFNOSUPPORT error Linux-compatible EINVAL.

2004-05-22 01:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: Fix bogus "UID
	  inserted in the middle of mailbox" errors

2004-05-22 00:48  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log-view.c,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-index/mail-transaction-util.c,
	  lib-index/mail-transaction-util.h,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-sync-parse.c,
	  lib-storage/index/mbox/mbox-sync-update.c,
	  lib-storage/index/mbox/mbox-sync.c: Transaction log contains only
	  UIDs now, no more sequences which just mess up everything.

2004-05-20 13:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync.c, mail-transaction-log-view.c,
	  mail-transaction-util.c, mail-transaction-util.h: last tried
	  fixes with sequences-in-log approach. moving to uids next, wonder
	  why I didn't earlier.

2004-05-17 16:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-util.c: Expunge fix

2004-05-17 13:08  Timo Sirainen <tss@iki.fi>

	* src/auth/mycrypt.c: Solaris 10 comple fix

2004-05-17 02:00  Timo Sirainen <tss@iki.fi>

	* configure.in: Removed LIST-SUBSCRIBED capability, latest LISTEXT
	  draft dropped it.

2004-05-17 01:32  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-client-interface.h,
	  src/auth/mech.c, src/auth/mech.h,
	  src/imap-login/client-authenticate.c, src/imap-login/client.c,
	  src/lib-auth/auth-client.h, src/lib-auth/auth-server-request.c,
	  src/login-common/client-common.h, src/login-common/main.c,
	  src/login-common/ssl-proxy-openssl.c,
	  src/login-common/ssl-proxy.h, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	  Added ssl_require_client_cert auth-specific setting. Hide
	  ssl_verify_client_cert from default config file as it's
	  automatically set if needed and there's not much point in forcing
	  it.

2004-05-16 23:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: Dotlocking: Don't leave the
	  log infinitely locked after rotation

2004-05-16 23:16  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: file_dotlock_delete(): don't complain
	  about mtime changes in lock file, as we most likely did it
	  ourself

2004-05-16 23:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c: Don't remove flag changes
	  in transaction log if they're expunged

2004-05-16 23:11  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-sort.c, cmd-thread.c, imap-sort.c, imap-thread.c:
	  return value fixes

2004-05-16 23:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: fixes

2004-05-16 20:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-view.c,
	  mail-index.c: Locking fixes

2004-05-16 19:50  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: fixes

2004-05-16 01:37  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: fix

2004-05-16 01:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-util.c: fixes

2004-05-16 01:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: more fixes (still not
	  right?)

2004-05-15 12:00  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: bugfixes

2004-05-15 11:59  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: t_push/t_pop

2004-05-10 22:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-util.c: t_push/t_pop

2004-05-10 21:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: fix

2004-05-10 21:27  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: don't crash to errors

2004-05-10 21:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: don't crash with assert if
	  transacton log has expunge with seq 0

2004-05-10 21:25  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: index wasn't unlocked initially

2004-05-10 21:09  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h,
	  lib-storage/index/index-transaction.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/mbox/mbox-sync.c: When committing with no
	  changes, don't try to sync them later.

2004-05-10 21:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: some minor fixes

2004-05-10 20:05  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Don't require initializing
	  RAND_bytes() to return cryptographically strong data.

2004-05-10 19:00  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: Message deletion deleted wrong messages

2004-05-10 18:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: removed assert,
	  that can happen in valid situations

2004-05-10 18:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: some fixes

2004-05-10 17:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: sync fix

2004-05-10 17:45  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: removed debugging

2004-05-10 16:12  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-subscribe.c: fix

2004-05-10 16:05  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, imap/main.c, lib/failures.c, lib/failures.h,
	  login-common/main.c, master/Makefile.am, master/auth-process.c,
	  master/common.h, master/log.c, master/log.h,
	  master/login-process.c, master/mail-process.c, master/main.c,
	  master/master-settings.c, master/master-settings.h, pop3/main.c:
	  Write all logging through master process. Fixes problems with log
	  rotation, chrooting, etc. Master process also allows max. 10 log
	  messages per second per child process, it then begins throttling
	  them (eventually making the child process start blocking on
	  stderr).

2004-05-10 15:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: fix

2004-05-10 02:22  Timo Sirainen <tss@iki.fi>

	* README: Updated RFC list

2004-05-10 02:15  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	  src/master/login-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added ssl_verify_client_cert
	  setting.

2004-05-10 01:55  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	  src/master/login-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added ssl_cipher_list setting.

2004-05-10 01:47  Timo Sirainen <tss@iki.fi>

	* AUTHORS, configure.in, doc/Makefile.am, src/auth/Makefile.am,
	  src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb.c,
	  src/auth/userdb.h: MySQL authentication patch by Matther Reimer

2004-05-10 01:28  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, client.h, commands.c: Fixes to commands
	  after mails have been deleted. Patch by Nic Bellamy.

2004-05-10 01:20  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: show error if config is missing
	  auth section

2004-05-10 01:01  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: allow using data stack without
	  data_stack_init().

2004-05-10 00:59  Timo Sirainen <tss@iki.fi>

	* src/lib-charset/charset-iconv.c: iconv_t isn't necessarily
	  pointer.

2004-05-10 00:45  Timo Sirainen <tss@iki.fi>

	* configure.in: fix

2004-05-10 00:40  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/lib.h: Define PREAD_WRAPPERS if we're using
	  GLIBC, not if we're using Linux.  Removed a few ANSI-C header
	  checks. Added strings.h check and include it automatically if
	  it's found, for strcasecmp().

2004-05-09 23:52  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-view-sync.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/maildir/maildir-uidlist.h: syncing fixes

2004-05-09 23:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: index/index-storage.h,
	  index/maildir/maildir-storage.c, index/maildir/maildir-uidlist.c,
	  index/mbox/mbox-storage.c, subscription-file/subscription-file.c,
	  subscription-file/subscription-file.h: maildir: don't use ".temp"
	  prefix for temporary files, since in ~/Maildir they conflict with
	  mailbox namespace.

2004-05-09 23:21  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: s/custom flags/keywords/

2004-05-09 23:20  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-view.c,
	  lib-storage/index/index-search.c: don't crash when requesting
	  messages from empty mailbox

2004-05-09 23:06  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-private.h, lib-index/mail-index-sync.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.c,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/maildir/maildir-uidlist.h: syncing fixes

2004-05-09 21:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-lock.c, mbox-storage.c,
	  mbox-sync-parse.c, mbox-sync-private.h, mbox-sync-rewrite.c,
	  mbox-sync-update.c, mbox-sync.c: mbox growing and locking works
	  now

2004-05-09 17:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  istream-raw-mbox.h, mbox-sync-parse.c, mbox-sync-private.h,
	  mbox-sync-rewrite.c, mbox-sync-update.c, mbox-sync.c: mbox
	  rewriting is almost working - the hard part is done.

2004-05-09 17:05  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: If value of header contains only
	  LWSP, return all LWSP instead of returning just empty value.

2004-05-06 03:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-mail.c, mbox-sync.c: Some mbox
	  fixes. Kind of works now.

2004-05-06 01:22  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-storage/index/index-mail.c,
	  src/lib-storage/index/index-mail.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/maildir/maildir-mail.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/maildir/maildir-sync.c,
	  src/lib-storage/index/maildir/maildir-uidlist.c,
	  src/lib-storage/index/maildir/maildir-uidlist.h,
	  src/lib-storage/index/mbox/Makefile.am,
	  src/lib-storage/index/mbox/istream-raw-mbox.c,
	  src/lib-storage/index/mbox/istream-raw-mbox.h,
	  src/lib-storage/index/mbox/mbox-file.c,
	  src/lib-storage/index/mbox/mbox-file.h,
	  src/lib-storage/index/mbox/mbox-from.c,
	  src/lib-storage/index/mbox/mbox-from.h,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-lock.c,
	  src/lib-storage/index/mbox/mbox-lock.h,
	  src/lib-storage/index/mbox/mbox-mail.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.h,
	  src/lib-storage/index/mbox/mbox-sync-parse.c,
	  src/lib-storage/index/mbox/mbox-sync-private.h,
	  src/lib-storage/index/mbox/mbox-sync-rewrite.c,
	  src/lib-storage/index/mbox/mbox-sync.c,
	  src/lib-storage/index/mbox/mbox-transaction.c: mbox code compiles
	  again, but syncing is only partially implemented so accessing
	  mboxes fails..

	  Also some cleanups to index-storage and maildir code.

2004-05-04 18:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: error message change

2004-05-03 22:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-private.h,
	  mail-transaction-log.c, mail-transaction-log.h: Don't rotate
	  transaction log too often

2004-05-03 22:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: sync fix

2004-05-03 22:08  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-dotlock.c, lib/file-dotlock.h,
	  lib-index/mail-transaction-log-private.h,
	  lib-index/mail-transaction-log.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/subscription-file/subscription-file.c:
	  file_dotlock_open/delete/replace now has lock_suffix parameter.
	  NULL defaults to ".lock".

	  Fixed dotlocking transaction log.

2004-05-03 21:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: and yet more
	  syncing fixes..

2004-05-03 19:53  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-sync-update.c:
	  fixes for fcntl_locks_disable = yes

2004-05-03 19:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: sync fix

2004-05-03 19:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c: When moving mails
	  to cur/, we must add the ":2," part to filename.

2004-05-03 19:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Create .INBOX/
	  to index directory, if it's different.

2004-05-03 18:01  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-gnutls.c: Fixed to compile with GNUTLS
	  1.0. Patch by Jaldhar H. Vyas.

2004-05-03 14:37  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, lib-index/mail-index.c,
	  lib-index/mail-transaction-log.c,
	  lib-storage/index/index-storage.c: memory leak fixes

2004-05-03 14:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: comment update

2004-05-03 14:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-update.c,
	  mail-index.c, mail-index.h: INDEX_KEYWORDS_BYTE_COUNT was counted
	  wrong so index files were larger than they needed to be. Added
	  sizeof(keywords_mask_t) to compat_data. Added limit to growing
	  index file exponentially.

2004-05-03 13:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	  mail_transaction_log_append() - return seq/offset even if we
	  didn't write anything

2004-05-03 13:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-sync.c,
	  maildir-uidlist.c: Syncing should be fixed now.

2004-05-02 21:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: crashfix

2004-05-02 20:33  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/main.c, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: and a
	  few more custom flag -> keyword changes

2004-05-02 20:32  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/client.h, imap/cmd-append.c,
	  imap/cmd-select.c, imap/cmd-store.c, imap/commands-util.c,
	  imap/commands-util.h, imap/common.h,
	  imap/mail-storage-callbacks.c, imap/main.c, lib-imap/imap-util.c,
	  lib-imap/imap-util.h, lib-index/mail-index-sync-update.c,
	  lib-index/mail-index-sync.c, lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log.h, lib-mail/mail-types.h,
	  lib-storage/mail-storage-private.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-fetch.h,
	  lib-storage/index/index-mail.c, lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-util.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-sync-private.h,
	  lib-storage/index/mbox/mbox-sync-update.c,
	  pop3/mail-storage-callbacks.c: s/custom flags/keywords/

2004-05-02 20:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync.c: comment

2004-05-02 19:24  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache.c, lib-index/mail-cache.h,
	  lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index.h, lib-storage/index/index-mail.c,
	  lib-storage/index/maildir/maildir-sync.c: Added support for
	  setting dirty flags for messages (TODO: undirty..)

	  s/mail_index_record_flag/mail_cache_record_flag/

2004-05-02 18:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, maildir/maildir-sync.c:
	  More syncing changes

2004-05-02 18:07  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-sync-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index.h, lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-storage/index/maildir/maildir-uidlist.h: Syncing
	  optimizations.

2004-05-02 12:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-view.c,
	  mail-transaction-log.c: Don't crash in assert() with corrupted
	  index file.

2004-05-02 00:14  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/maildir/maildir-list.c,
	  imap/cmd-subscribe.c: fixes

2004-05-01 23:15  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: crashfix

2004-05-01 19:09  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: Don't advertise AUTH=PLAIN
	  unless transport is secure

2004-05-01 18:44  Timo Sirainen <tss@iki.fi>

	* configure.in: Default to OpenSSL

2004-05-01 18:30  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-search.c,
	  index-status.c, index-storage.h, index-sync.c,
	  maildir/maildir-mail.c, maildir/maildir-storage.c,
	  maildir/maildir-sync.c, maildir/maildir-uidlist.c,
	  maildir/maildir-uidlist.h, maildir/maildir-util.c: Recent-flag
	  should work now

2004-05-01 18:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: syncing fix

2004-05-01 16:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: cleanup

2004-05-01 16:30  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/Makefile.am, lib-index/mail-index-private.h,
	  lib-index/mail-index.h, lib-storage/index/maildir/maildir-sync.c:
	  remove mail_index_reset() completely

2004-05-01 16:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-lock.c,
	  mail-index-private.h, mail-index.c: missing index file fixes

2004-05-01 16:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-private.h,
	  mail-index-view.c, mail-index.c, mail-transaction-log-view.c,
	  mail-transaction-log.c, mail-transaction-log.h: handle losing
	  index file

2004-05-01 15:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync.c, mail-index-view-sync.c,
	  mail-transaction-log-view.c, mail-transaction-log.c,
	  mail-transaction-log.h: automatically fix broken/missing
	  transaction log files on the fly

2004-05-01 14:30  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/maildir/maildir-sync.c,
	  lib-storage/index/maildir/maildir-uidlist.c,
	  lib-index/mail-index-lock.c, lib-index/mail-index-private.h,
	  lib-index/mail-index-sync.c, lib-index/mail-index-view-private.h,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-transaction-log-view.c,
	  lib-index/mail-transaction-log.c,
	  lib-index/mail-transaction-log.h: fixes

2004-04-30 20:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: changes

2004-04-29 12:59  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-private.h: recent
	  fixes

2004-04-29 12:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-update.c, mail-transaction-log.c:
	  Ignore new mail appends if they're already in transaction log.

2004-04-29 00:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: assert

2004-04-29 00:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index.c,
	  mail-transaction-log-view.c, mail-transaction-log.c,
	  mail-transaction-log.h: Don't modify index file when creating new
	  transaction log.

2004-04-28 23:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c: make sure we
	  unlock uidlist

2004-04-28 23:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-transaction-log-private.h,
	  mail-transaction-log-view.c, mail-transaction-log.c,
	  mail-transaction-util.c: fixes for mmap_disable

2004-04-28 21:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c: fix

2004-04-28 21:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-sync.c, maildir/maildir-uidlist.c:
	  fixes

2004-04-28 20:51  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index-lock.c,
	  lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index.c,
	  lib-storage/index/index-storage.c: fixes

2004-04-28 20:51  Timo Sirainen <tss@iki.fi>

	* src/lib/: read-full.c, write-full.c: whops, retrying was broken

2004-04-28 19:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-private.h, mail-index-sync-update.c:
	  when growing index file, do it exponentially for this session
	  (files being added one at a time).

2004-04-28 19:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-sync-update.c,
	  mail-transaction-log.c: some more locking fixes

2004-04-28 18:57  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: BYE if trying to fetch body[] of expunged
	  message.

2004-04-28 18:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-private.h,
	  mail-index-sync.c, mail-index.c: locking fixes, sync fix

2004-04-28 16:54  Timo Sirainen <tss@iki.fi>

	* configure.in: Put -lcrypt to first in AUTH_LIBS to fix some
	  linking problems with Solaris

2004-04-28 02:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-private.h, mail-index-view.c:
	  cleanup

2004-04-28 02:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index-lock.c,
	  mail-index-private.h, mail-index-sync-update.c,
	  mail-index-sync.c, mail-index-view.c,
	  mail-transaction-log-view.c, mail-transaction-log.c,
	  mail-transaction-util.c: Locking changes. bugfixes.

2004-04-28 02:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-lock.c: whops, was unfinished

2004-04-28 02:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-index-lock.c,
	  src/lib-index/mail-index-private.h, src/lib-index/mail-index.c,
	  src/lib-index/mail-index.h,
	  src/lib-index/mail-transaction-log-private.h,
	  src/lib-index/mail-transaction-log.c,
	  src/lib-storage/index/index-storage.c, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  fcntl_lock_disable setting to allow indexes to work with NFS.
	  Some other locking fixes.

2004-04-28 01:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-lock.c, mail-index-sync-update.c,
	  mail-index.c, mail-transaction-log-view.c,
	  mail-transaction-log.c: locking fixes, mmap_disable=yes fixes

2004-04-28 00:27  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: updated for mmap changes

2004-04-28 00:21  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-copy.c, imap/cmd-select.c,
	  imap/cmd-status.c, imap/common.h, imap/imap-search.h,
	  imap/main.c, lib-index/mail-index-lock.c,
	  lib-index/mail-index-private.h,
	  lib-index/mail-index-sync-update.c, lib-index/mail-index-sync.c,
	  lib-index/mail-index-transaction-private.h,
	  lib-index/mail-index-transaction.c,
	  lib-index/mail-index-view-private.h,
	  lib-index/mail-index-view-sync.c, lib-index/mail-index-view.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-index/mail-transaction-log.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/maildir/maildir-sync.c, master/mail-process.c,
	  master/master-settings.c, master/master-settings.h,
	  pop3/client.c: Forced locking to be right with mprotect()ing
	  index file. Support for disabling mmap for indexes, and disabling
	  just mmap+write().

2004-04-28 00:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: from_envelope crashfix..

2004-04-27 20:25  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/client.c,
	  src/imap/cmd-append.c, src/imap/cmd-close.c, src/imap/cmd-copy.c,
	  src/imap/cmd-create.c, src/imap/cmd-delete.c,
	  src/imap/cmd-expunge.c, src/imap/cmd-fetch.c,
	  src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap/cmd-logout.c,
	  src/imap/cmd-rename.c, src/imap/cmd-search.c,
	  src/imap/cmd-select.c, src/imap/cmd-sort.c,
	  src/imap/cmd-status.c, src/imap/cmd-store.c,
	  src/imap/cmd-subscribe.c, src/imap/cmd-thread.c,
	  src/imap/cmd-unselect.c, src/imap/commands-util.c,
	  src/imap/imap-expunge.c, src/imap/imap-expunge.h,
	  src/imap/imap-fetch.c, src/imap/imap-fetch.h,
	  src/imap/imap-messageset.c, src/imap/imap-messageset.h,
	  src/imap/imap-search.c, src/imap/imap-search.h,
	  src/imap/imap-sort.c, src/imap/imap-thread.c,
	  src/imap/mail-storage-callbacks.c, src/imap/namespace.c,
	  src/lib/Makefile.am, src/lib/compat.h, src/lib/file-dotlock.c,
	  src/lib/file-lock.c, src/lib/istream-data.c,
	  src/lib/istream-file.c, src/lib/istream-limit.c,
	  src/lib/istream-mmap.c, src/lib/macros.h, src/lib/network.c,
	  src/lib/read-full.c, src/lib/read-full.h, src/lib/write-full.c,
	  src/lib/write-full.h, src/lib-imap/imap-util.c,
	  src/lib-imap/imap-util.h, src/lib-index/Makefile.am,
	  src/lib-index/mail-cache-compress.c,
	  src/lib-index/mail-cache-lookup.c,
	  src/lib-index/mail-cache-private.h,
	  src/lib-index/mail-cache-transaction.c,
	  src/lib-index/mail-cache.c, src/lib-index/mail-cache.h,
	  src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	  src/lib-index/mail-index-private.h,
	  src/lib-index/mail-index-sync-private.h,
	  src/lib-index/mail-index-sync-update.c,
	  src/lib-index/mail-index-sync.c,
	  src/lib-index/mail-index-transaction-private.h,
	  src/lib-index/mail-index-transaction.c,
	  src/lib-index/mail-index-view-private.h,
	  src/lib-index/mail-index-view-sync.c,
	  src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	  src/lib-index/mail-index.h,
	  src/lib-index/mail-transaction-log-private.h,
	  src/lib-index/mail-transaction-log-view.c,
	  src/lib-index/mail-transaction-log.c,
	  src/lib-index/mail-transaction-log.h,
	  src/lib-index/mail-transaction-util.c,
	  src/lib-index/mail-transaction-util.h, src/lib-mail/Makefile.am,
	  src/lib-mail/mail-types.h, src/lib-mail/message-parser.c,
	  src/lib-mail/message-parser.h, src/lib-storage/Makefile.am,
	  src/lib-storage/mail-search.h,
	  src/lib-storage/mail-storage-private.h,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/Makefile.am,
	  src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-mail-headers.c,
	  src/lib-storage/index/index-mail.c,
	  src/lib-storage/index/index-mail.h,
	  src/lib-storage/index/index-mailbox-check.c,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/index-status.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/index-sync.c,
	  src/lib-storage/index/index-transaction.c,
	  src/lib-storage/index/maildir/Makefile.am,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/maildir/maildir-mail.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/maildir/maildir-sync.c,
	  src/lib-storage/index/maildir/maildir-transaction.c,
	  src/lib-storage/index/maildir/maildir-uidlist.c,
	  src/lib-storage/index/maildir/maildir-uidlist.h,
	  src/lib-storage/index/maildir/maildir-util.c,
	  src/lib-storage/index/mbox/Makefile.am,
	  src/lib-storage/index/mbox/istream-raw-mbox.c,
	  src/lib-storage/index/mbox/istream-raw-mbox.h,
	  src/lib-storage/index/mbox/mbox-from.c,
	  src/lib-storage/index/mbox/mbox-from.h,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-sync-parse.c,
	  src/lib-storage/index/mbox/mbox-sync-private.h,
	  src/lib-storage/index/mbox/mbox-sync-rewrite.c,
	  src/lib-storage/index/mbox/mbox-sync-update.c,
	  src/lib-storage/index/mbox/mbox-sync.c,
	  src/lib-storage/register/Makefile.am,
	  src/lib-storage/subscription-file/Makefile.am,
	  src/lib-storage/subscription-file/subscription-file.c,
	  src/lib-storage/subscription-file/subscription-file.h,
	  src/pop3/client.c, src/pop3/commands.c,
	  src/pop3/mail-storage-callbacks.c: importing new index code. mbox
	  still broken.

2004-04-27 20:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-cache.h, mail-index-fsck.c,
	  mail-index.c, mail-index.h: removed out of the way of new index
	  code

2004-04-26 20:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.c: "Internal error" message changed.

2004-04-26 17:13  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: typofix

2004-04-25 22:40  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h: Patch by Quentin Garnier:

	  1. Change default value for 'hosts' to NULL instead of
	  'localhost'.	 That way, libldap will choose the default list of
	  server as specified	in OpenLDAP's ldap.conf configuration file.

	  2. Add a new configuration stance, 'uris', which you can set to a
	  list of URIs that will be passed directly to libldap, which
	  understands them.

2004-01-23 19:50  Timo Sirainen <tss@iki.fi>

	* INSTALL: updates about running it

2004-01-19 17:07  Timo Sirainen <tss@iki.fi>

	* src/: login-common/ssl-proxy-openssl.c, master/login-process.c,
	  master/master-settings.c, master/master-settings.h: Added setting
	  ssl_ca_file, patch by Zach Bagnall

2004-01-06 06:14  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: LIST: If reference parameter is given, get
	  the namespace from it.

2004-01-06 06:09  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool.h: pool_unref(x): don't set (x) = NULL, it may
	  have been allocated from the pool that was just freed.

2004-01-06 05:09  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: removed unused trim() function

2004-01-06 03:36  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: Remove service type checking from
	  given URI. It was hardcoded to IMAP, but we would also want it to
	  work with POP3. Also some clients seemed to use something else as
	  imap there..

2003-12-25 15:26  Timo Sirainen <tss@iki.fi>

	* Makefile.am: COPYING.MIT missing

2003-12-08 22:19  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: compiling fix

2003-12-03 18:14  Timo Sirainen <tss@iki.fi>

	* src/lib/hash.c: bugfix

2003-12-03 13:16  Timo Sirainen <tss@iki.fi>

	* src/lib/hash.c: cleanup

2003-12-03 00:40  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-client-connection.c, auth/db-ldap.c,
	  imap/imap-thread.c, imap-login/client.c, lib/hash.c, lib/hash.h,
	  login-common/ssl-proxy-gnutls.c,
	  login-common/ssl-proxy-openssl.c, master/auth-process.c,
	  pop3-login/client.c, master/login-process.c: Changed
	  hash_foreach() to iterator.

2003-12-01 19:07  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: warning fixes

2003-11-25 12:50  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: LSUB should never show \HasChildren flags.

2003-11-25 01:26  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: IMAP AUTHENTICATE and POP3 AUTH
	  commands could have left the process stuck doing nothing forever.

2003-11-21 14:37  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: write dovecot.pem, not imapd.pem files.

2003-11-20 16:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c: Bugfixes

2003-11-20 15:40  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-send.c: message_skip_virtual() calculated
	  returned msg_size wrong. This could have caused some problems
	  with partial body fetches.

2003-11-17 18:03  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Children/NoChildren ->
	  HasChildren/HasNoChildren

2003-11-13 19:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: update lock counters with in-memory
	  indexes too

2003-11-13 16:05  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Always give error if flock is used
	  with a system where it's not supported.  The check was actually
	  checking fcntl before..

2003-11-13 15:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: If mbox wasn't indexed
	  yet when it was being renamed, an extra error message was logged.

2003-11-12 16:21  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-file.c, istream-mmap.c: cleanups

2003-11-11 13:02  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: wrong fix, reverted plus a
	  cleanup..

2003-11-11 12:31  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: When parsing message with CRLF
	  headers, we stopped after CRLFCR instead of CRLFCRLF.

2003-11-11 09:59  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/auth.txt, src/auth/mech-cram-md5.c,
	  src/auth/passdb.c, src/auth/password-scheme-cram-md5.c,
	  src/auth/password-scheme.c: cram-md5 updates.

2003-11-10 21:57  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-body-search.c: istream fix

2003-11-10 21:44  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-cram-md5.c: Don't treat data as NUL-terminated
	  string.

2003-11-10 21:36  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-limit.c, istream.c: fixes

2003-11-10 20:36  Timo Sirainen <tss@iki.fi>

	* src/auth/: Makefile.am, auth-client-interface.h, mech-cram-md5.c,
	  mech-digest-md5.c, mech.c, passdb.c, passdb.h,
	  password-scheme-cram-md5.c, password-scheme-md5crypt.c,
	  password-scheme.c, password-scheme.h: CRAM-MD5 mechanism by
	  Joshua Goodall, plus some cleanups.

2003-11-09 20:20  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: net_set_nonblock(): don't replace flags in fd,
	  change the existing ones

2003-11-09 18:26  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, lib/Makefile.am,
	  lib/iostream-internal.h, lib/istream-data.c, lib/istream-file.c,
	  lib/istream-internal.h, lib/istream-limit.c, lib/istream-mmap.c,
	  lib/istream.c, lib/istream.h, lib/ostream-file.c,
	  lib-mail/message-body-search.c: istream rewrite. instead of
	  directly setting any limits to stream, you now have to use
	  i_stream_create_limit() to existing stream. this should make the
	  istreams much easier to create and understand how they work.

2003-11-09 18:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-index.c: type fixes

2003-11-08 20:47  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-send.c, message-send.h: message_send()'s
	  skip parameter was buggy with messages having CRLF.

2003-11-08 18:17  Timo Sirainen <tss@iki.fi>

	* src/pop3/capability.h: Advertise PIPELINING capability

2003-11-08 15:56  Timo Sirainen <tss@iki.fi>

	* configure.in: cleanup

2003-11-08 14:47  Timo Sirainen <tss@iki.fi>

	* doc/Makefile.am: securecoding.txt missing

2003-11-08 14:23  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.c: whops, too many changes

2003-11-08 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.c: pread/pwrite fixes

2003-11-05 08:42  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream-file.c, lib/istream-mmap.c, lib/istream.c,
	  lib/istream.h, lib/ostream-file.c, lib-mail/message-send.c: Added
	  istream->eof. istream->v_size is now set to 0 with files.

2003-11-04 22:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: we didn't sync mbox again after
	  rewriting which left us broken mail offsets.

2003-11-04 20:40  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-store.c: STORE .. FLAGS.SILENT will now return flags
	  anyway if mailbox is read-only.

2003-10-29 14:54  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-file.c: fix

2003-10-29 14:53  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: cleanup

2003-10-29 14:19  Timo Sirainen <tss@iki.fi>

	* src/lib/: compat.c, compat.h: more kludgeing to get pread/pwrite
	  working

2003-10-29 14:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/auth/passdb-bsdauth.c,
	  src/auth/passdb.c, src/auth/passdb.h: Added bsdauth support,
	  patch by Dan Cross

2003-10-29 13:50  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.c, src/lib/compat.h,
	  src/lib/istream-file.c, src/lib-index/mail-cache.c: pread/pwrite
	  fixes

2003-10-29 13:37  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-file.c: Changed to use pread() with files.

2003-10-29 12:58  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: reset stream_errno

2003-10-26 20:13  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-copy.c, imap/cmd-search.c, imap/cmd-store.c,
	  imap/imap-fetch.c, imap/imap-fetch.h, imap/imap-search.c,
	  imap/imap-search.h, imap/imap-sort.c, imap/imap-thread.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c, pop3/client.c,
	  pop3/commands.c: Removed fetch_init/fetch_next from mail-storage.
	  search_* makes it unnecessary

2003-10-26 19:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-search.c, mail-search.h,
	  index/index-search.c: Some optimizations to messageset handling
	  in search.

2003-10-26 19:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: minor optimization

2003-10-26 18:05  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-copy.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: Moved copy() method from
	  struct mail to struct mailbox - the context parameter makes sense
	  only to destination mailbox handler.

2003-10-26 17:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: cleanup

2003-10-26 17:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: missing t_pop()

2003-10-26 07:27  Timo Sirainen <tss@iki.fi>

	* src/lib/: buffer.c, buffer.h, str.c, str.h: Use unsigned char for
	  buffer_append_c and str_append_c.

2003-10-23 08:30  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: p_strndup() read str[max_chars] byte - could
	  have possibly crashed in some rare conditions

2003-10-21 14:14  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: Don't request empty headers

2003-10-21 13:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: assert

2003-10-21 11:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: header fix

2003-10-21 05:27  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: removed unused #include

2003-10-21 03:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Don't save empty
	  header lists

2003-10-21 03:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: assert

2003-10-21 03:25  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: compression could have broken header
	  lists

2003-10-21 03:14  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache.c,
	  lib-storage/index/index-mail-headers.c: Some cleanups and extra
	  checks to detect if header names list gets duplicated (can
	  happen, why?..)

2003-10-20 07:33  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: recent change broke it

2003-10-20 07:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: mail_create_mode
	  was set too late.

2003-10-20 07:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: fix

2003-10-20 07:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: crashfix

2003-10-20 06:18  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-dotlock.c, lib-index/mail-index.h,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c: fixed
	  dovecot-uidlist permissions for shared mailboxes

2003-10-20 06:01  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h, lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c: If maildir contains
	  dovecot-shared file Dovecot does two things differently: it
	  allows some flags to be private and stored only in index file
	  (currently hardcoded to \Seen flag only) and new mails are
	  created with dovecot-shared file's mode & 0666. So if you set
	  filesystem permissions correctly, you should have fully
	  functioning shared mailboxes.

2003-10-20 05:10  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: If input is empty, return only list with
	  NULL.

2003-10-20 05:01  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-dotlock.c, lib/file-dotlock.h,
	  lib-index/mail-cache.c,
	  lib-storage/subscription-file/subscription-file.c: Added dotlock
	  parameter to specify how old lock file has to be to be
	  immediately deleted. This fixes the problem of never deleting
	  uidlist.lock files.

2003-10-20 04:53  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: *_strconcat() bugfix

2003-10-20 04:15  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech.c, auth/userdb-static.c, imap/imap-fetch.c,
	  lib/strfuncs.c, lib/strfuncs.h, lib-storage/mail-storage.c,
	  lib-storage/index/index-storage.c, master/main.c,
	  master/master-settings.c: Added t_strsplit_spaces().

2003-10-20 03:24  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Sync stamps weren't updated always
	  from header.

2003-10-20 03:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-index.c, mail-index.h: We
	  didn't notice cache compression immediately in other processes.
	  Also some other bugfixes.

2003-10-20 01:50  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: save errno in failures

2003-10-19 20:15  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: MAP_FIXED didn't actually work the way I
	  thought (should have looked the man page more carefully..).
	  Dropped that and now we'll always just memcpy() the data when we
	  want to grow a mmaping.

2003-10-16 15:56  Timo Sirainen <tss@iki.fi>

	* src/imap-login/client.c: Don't disconnect client immediately if
	  there's an error in IMAP syntax.

2003-10-16 15:50  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: cleanup

2003-10-16 15:45  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-copy.c: COPY: Don't crash if no mailbox is selected.

2003-10-06 23:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: If there was multiple
	  headers with same name, we stored only first one into cache.

2003-10-06 20:17  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: BODY[HEADER] and RFC822.HEADER fetching
	  was broken (why did it work before?..)

2003-10-05 19:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: Strip trailing '/' from mail directory if
	  given. Just makes it cleaner in log files.

2003-10-05 18:01  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.c: pread/pwrite doesn't move file offset. make our
	  compat functions restore it

2003-10-03 16:20  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sort.c: Use data stack pool instead of temp_pool.
	  Fixes sorting by subject.

2003-10-03 16:16  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-base-subject.c: Allow using data stack pool
	  with imap_get_base_subject_cased()

2003-10-03 15:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: get_header() returned
	  values wrong

2003-10-03 15:15  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-date.c: Don't require timezone in
	  Date-header.

2003-10-03 15:02  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Put the msg/cmsg checks in CHECK_MSG() and
	  CHECK_CMSG() macros. Add support for Linux 2.0 kernels by
	  checking if LINUX20 is defined.

2003-10-03 14:50  Timo Sirainen <tss@iki.fi>

	* src/lib/: compat.c, compat.h, mmap-util.c, mmap-util.h: If we
	  don't have function foo, do it always as #define foo my_foo and
	  create your own my_foo. Did this to pread/pwrite/madvise.

2003-09-29 14:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: \Draft and \Deleted flags
	  used opposite flag chars in X-Status header. We were incompatible
	  with other mbox accessing software.

2003-09-24 10:16  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Alignment fix

2003-09-23 19:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.c, index-storage.h,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Fixes memory/fd
	  leaking with INDEX=MEMORY.

2003-09-21 18:03  Timo Sirainen <tss@iki.fi>

	* doc/securecoding.txt: Secure coding guide for Dovecot.

2003-09-21 17:55  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/data-stack.c, src/lib/mempool-alloconly.c,
	  src/lib/mempool-system.c: Added support for Boehm GC. However it
	  seems to be crashing for some reason with me..

2003-09-21 17:18  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: cleanup

2003-09-21 16:39  Timo Sirainen <tss@iki.fi>

	* src/lib/: imem.c, imem.h, mempool.h: Make i_free(), p_free() and
	  pool_unref() calls also set the given parameter to NULL.

2003-09-21 16:26  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool.h: Removed pool leak checking stuff, it's not
	  used.

2003-09-21 16:21  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-master-connection.c, auth/mech-digest-md5.c,
	  auth/mech-plain.c, auth/mech.c, auth/passdb-pam.c,
	  imap/cmd-append.c, imap/cmd-sort.c, imap/imap-fetch.c,
	  imap/imap-sort.c, imap/imap-thread.c,
	  imap-login/client-authenticate.c, imap-login/client.c,
	  lib/Makefile.am, lib/mempool-alloconly.c,
	  lib/mempool-datastack.c, lib/mempool-system.c,
	  lib/mempool-unsafe-datastack.c, lib/mempool.h, lib/str.c,
	  lib/strfuncs.c, lib-charset/charset-utf8.c,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-envelope.c,
	  lib-imap/imap-quote.c, lib-index/mail-cache.c,
	  lib-mail/message-address.c, lib-mail/message-body-search.c,
	  lib-mail/message-header-decode.c, lib-storage/mail-search.c,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-search.c,
	  lib-storage/index/maildir/maildir-save.c,
	  pop3-login/client-authenticate.c, pop3-login/client.c:
	  data_stack_pool split into two: unsafe_data_stack_pool which
	  works like before, and a new one which verifies that stack frame
	  stays the same whenever the pool is accessed.

2003-09-20 18:45  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: location defaulted only to
	  default_mail_env, not userdb.

2003-09-17 00:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Revert the
	  mailbox/ == mailbox change after all. It broke LIST and it's not
	  important really..

2003-09-15 21:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Reverted mailbox ==
	  mailbox/ change, it applies to only dual-use mailboxes..

2003-09-15 17:49  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: Ignore hierarchy separator at the end of
	  mailbox name.

2003-09-15 17:38  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-create.c, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: CREATE mailbox/ with
	  maildir now creates the mailbox instead of ignoring it.

2003-09-15 14:13  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: missed

2003-09-15 14:02  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-namespace.c, imap/namespace.c, imap/namespace.h,
	  master/mail-process.c, master/master-settings.h: Added
	  hidden-option to namespaces to hide them from NAMESPACE reply.

2003-09-15 13:59  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Support %vars in namespace prefix.

2003-09-10 02:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: get_header() returned
	  only first line of multiline headers

2003-09-10 02:07  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Headers were returned
	  twice sometimes

2003-09-10 01:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: compile fix

2003-09-09 18:52  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: We stored groups wrong in
	  ENVELOPE.

2003-09-09 18:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: treat ~ mailbox
	  prefix as absolute path too

2003-09-08 13:04  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: Missing spaces in ENVELOPE, BODY and
	  BODYSTRUCTURE replies.

2003-09-08 02:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.h,
	  index-search.c: Stop parsing cached headers when we've got
	  everything.

2003-09-08 01:46  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: Write envelope, body and bodystructure
	  directly into output stream.

2003-09-08 01:29  Timo Sirainen <tss@iki.fi>

	* src/lib/: failures.c, printf-upper-bound.c, printf-upper-bound.h,
	  str.c, strfuncs.c: Call printf_string_fix_format() only when
	  printf_string_upper_bound() sees %m.

2003-09-08 01:14  Timo Sirainen <tss@iki.fi>

	* src/lib/printf-upper-bound.c: minor speedup

2003-09-08 00:57  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-date.c, imap-date.h:
	  imap_to_datetime_offset() isn't needed. optimized
	  imap_to_datetime() a bit.

2003-09-08 00:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: cleanup

2003-09-08 00:36  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: minor speedups

2003-09-08 00:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: bugfix

2003-09-07 18:43  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: minor optimizations

2003-09-07 14:10  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Fixed memory leak after compressing
	  cache file.

2003-09-07 13:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: bugfix

2003-09-07 13:35  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Strict aliasing fix

2003-09-07 13:30  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Header fetching committed changes
	  twice, now we don't commit changes when requesting a field which
	  we know hasn't changed (pretty dummy logic, but works for this
	  case). Continued rows were also counted wrong.

2003-09-07 01:52  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-internal.h: s/int/enum io_condition/

2003-09-06 17:46  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: whops, left extra stuff.

2003-09-06 17:44  Timo Sirainen <tss@iki.fi>

	* src/: imap/namespace.c, imap/namespace.h, master/mail-process.c,
	  master/master-settings.c, master/master-settings.h: Added "inbox"
	  setting to specify which namespace has the INBOX.

2003-09-06 17:37  Timo Sirainen <tss@iki.fi>

	* src/master/: mail-process.c, master-settings.c: If location isn't
	  given for namespace, use the default

2003-09-06 17:29  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: If LISTEXT is used and CHILDREN info isn't
	  wanted, don't send it.

2003-09-06 17:25  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment changes

2003-09-04 22:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Include used-bit for all bytes in
	  offsets to make sure their reads aren't only partial

2003-09-02 22:33  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache.c, lib-index/mail-cache.h,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-mail/message-parser.c, lib-mail/message-part-serialize.c,
	  lib-mail/message-part-serialize.h: mbox reading is kind of
	  working again. Just don't try rewriting or expunging :) Changing
	  headers are also hidden from clients so mbox messages are finally
	  seen immutable as required by IMAP.

2003-08-29 14:31  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Allow key=value without requiring
	  space between key and '='

2003-08-27 14:35  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Support # comments also at the end
	  of setting lines

2003-08-26 22:15  Timo Sirainen <tss@iki.fi>

	* src/lib/safe-mkdir.c: comment updates. it's not possible to
	  change the file mode if you're not the owner..

2003-08-26 21:18  Timo Sirainen <tss@iki.fi>

	* COPYING, COPYING.MIT, src/lib/buffer.c, src/lib/compat.c,
	  src/lib/data-stack.c, src/lib/env-util.c, src/lib/failures.c,
	  src/lib/fd-close-on-exec.c, src/lib/file-lock.c,
	  src/lib/file-set-size.c, src/lib/hash.c, src/lib/hex-binary.c,
	  src/lib/hostpid.c, src/lib/imem.c, src/lib/ioloop-poll.c,
	  src/lib/ioloop-select.c, src/lib/ioloop.c, src/lib/iostream.c,
	  src/lib/istream-data.c, src/lib/istream-file.c,
	  src/lib/istream-mmap.c, src/lib/istream.c, src/lib/lib-signals.c,
	  src/lib/lib.c, src/lib/mempool-alloconly.c,
	  src/lib/mempool-datastack.c, src/lib/mempool-system.c,
	  src/lib/mmap-anon.c, src/lib/mmap-util.c, src/lib/network.c,
	  src/lib/ostream-file.c, src/lib/ostream.c,
	  src/lib/process-title.c, src/lib/randgen.c,
	  src/lib/restrict-access.c, src/lib/restrict-process-size.c,
	  src/lib/safe-memset.c, src/lib/safe-mkdir.c,
	  src/lib/sendfile-util.c, src/lib/str.c, src/lib/strescape.c,
	  src/lib/strfuncs.c, src/lib/unlink-directory.c,
	  src/lib/unlink-lockfiles.c, src/lib/utc-mktime.c,
	  src/lib/utc-offset.c, src/lib/write-full.c: Removed most of the
	  license comments from src/lib/*.c. It's just fine to keep them in
	  a single COPYING.MIT file. Changed a few other comments as well.

2003-08-26 21:06  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Fix for IRIX (plus comment cleanups)

2003-08-26 08:21  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/Makefile.am: missing .h files

2003-08-25 03:02  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: crashfix

2003-08-24 23:10  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: missing initializers

2003-08-24 23:07  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: forgot mail_chroot

2003-08-24 13:14  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  mail_chroot setting to specify default chroot.

2003-08-24 12:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mailbox-check.c: fix

2003-08-24 12:58  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-idle.c, lib-storage/index/index-mailbox-check.c,
	  lib-storage/index/index-storage.h: IDLE fixes..

2003-08-24 12:49  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Don't crash if no protocols were
	  given in config file

2003-08-24 12:45  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-idle.c, imap/cmd-select.c, imap/commands-util.c,
	  lib-storage/mail-storage.h,
	  lib-storage/index/index-mailbox-check.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: IDLE uses now IO_*_NOTIFY
	  to get instant notifying of mails.

2003-08-24 12:43  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-internal.h,
	  src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-none.c,
	  src/lib/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	  src/lib/ioloop.h: Added IO_DIR_NOTIFY and IO_FILE_NOTIFY
	  conditions to io_add(). IO_DIR_NOTIFY is now implemented for
	  Linux dnotify.

2003-08-24 10:49  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/mail-storage.c,
	  src/lib-storage/mail-storage.h: Added oe6-fetch-redundant-msgset
	  workaround.

2003-08-24 09:36  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: added rawlog example

2003-08-24 09:35  Timo Sirainen <tss@iki.fi>

	* src/util/rawlog.c: fixes

2003-08-24 07:55  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client-authenticate.c,
	  src/imap-login/client-authenticate.h, src/imap-login/client.c,
	  src/imap-login/client.h, src/master/master-settings.c,
	  src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	  src/pop3-login/client.h: disable_plaintext_auth defaults to yes
	  now. ipv4 127.* and ipv6 ::1 addresses are considered secure
	  however and plaintext authentication is allowed from them.

2003-08-24 07:37  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, login-process.c, master-settings.c,
	  master-settings.h: Make sure auth process and login process don't
	  share uids.

2003-08-24 07:21  Timo Sirainen <tss@iki.fi>

	* src/master/: master-settings.c, master-settings.h: Reading global
	  auth_* defaults didn't work

2003-08-24 07:06  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: Added back compat_data[]. It wasn't
	  so simple to access data portably in index files after all..

2003-08-24 07:03  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c: use int32_t instead of int in
	  struct mail_sent_date

2003-08-24 06:49  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-index/mail-index.h: Removed index_align
	  stuff. It's not needed anymore.

2003-08-24 06:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: expunge/append behaviour corrupted
	  indexes

2003-08-24 05:57  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Assert -> mark cache
	  corrupted

2003-08-24 05:55  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/userdb-ldap.c: LDAP: Removed the
	  system_user=uid defaulting. LDAP usually has only virtual users
	  which don't exist in /etc/group. Clarified what the system user
	  actually does for ldap/pgsql.

2003-08-22 18:56  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/client.h, lib-auth/auth-server-request.c,
	  lib-index/mail-cache.c, pop3-login/client-authenticate.c,
	  pop3-login/client.c, pop3-login/client.h: fixes. maybe it works
	  now.

2003-08-22 15:40  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-connection.c: crashfix

2003-08-22 06:51  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-master-connection.c, mech.c, mech.h: fixes

2003-08-22 06:44  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-client-connection.c: fix

2003-08-22 06:37  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/: auth-server-connection.c,
	  auth-server-connection.h, auth-server-request.c: fixes

2003-08-22 05:06  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, userdb-ldap.c: Give better error message if
	  uid/gid not found from ldap and no default was set.

2003-08-22 04:57  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, mech-anonymous.c,
	  mech-digest-md5.c, mech-plain.c, mech.c, mech.h, passdb-ldap.c,
	  passdb-pam.c: Fixed crash if login process connection died while
	  there were some auth requests.

2003-08-22 04:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-auth/auth-server-request.c: We now
	  support checking the password against all defined auth processes
	  and use the one that matches.

2003-08-22 03:52  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: s/process/server/

2003-08-22 03:34  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth-master-connection.c, lib-auth/auth-client.c,
	  lib-auth/auth-server-connection.c, login-common/main.c,
	  login-common/master.c: bugfixes

2003-08-22 03:14  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: fix

2003-08-22 02:42  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: forgot

2003-08-22 02:42  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/auth/Makefile.am,
	  src/auth/auth-client-connection.c,
	  src/auth/auth-client-connection.h,
	  src/auth/auth-client-interface.h,
	  src/auth/auth-master-connection.c,
	  src/auth/auth-master-connection.h,
	  src/auth/auth-master-interface.h, src/auth/main.c,
	  src/auth/mech-anonymous.c, src/auth/mech-digest-md5.c,
	  src/auth/mech-plain.c, src/auth/mech.c, src/auth/mech.h,
	  src/imap-login/Makefile.am, src/imap-login/client-authenticate.c,
	  src/imap-login/client.c, src/imap-login/client.h,
	  src/lib-auth/.cvsignore, src/lib-auth/Makefile.am,
	  src/lib-auth/auth-client.c, src/lib-auth/auth-client.h,
	  src/lib-auth/auth-server-connection.c,
	  src/lib-auth/auth-server-connection.h,
	  src/lib-auth/auth-server-request.c,
	  src/lib-auth/auth-server-request.h, src/login-common/Makefile.am,
	  src/login-common/client-common.h, src/login-common/common.h,
	  src/login-common/main.c, src/login-common/master.c,
	  src/login-common/master.h, src/pop3-login/Makefile.am,
	  src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	  src/pop3-login/client.h: Moved client side code for auth process
	  handling to lib-auth. Some other login process cleanups.

2003-08-21 23:31  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: If LDAP connection closes, notify all
	  requests that they failed.

2003-08-21 01:59  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache.c, lib-index/mail-cache.h,
	  lib-mail/message-part-serialize.c,
	  lib-storage/index/index-mail.c: Removed some header/body size
	  fields. We use only message_part now everywhere since it's small
	  enough. virtual_full_size was left because we may know that by
	  just reading maildir filename.

2003-08-21 01:41  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c: Serialized message_parts
	  are now packed into smaller space.

2003-08-21 00:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: bugfix

2003-08-21 00:04  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-parser.c, lib-mail/message-parser.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h:
	  Message parsing can now be done in two parts - header and body.
	  We're now more eager at parsing MIME structure for message. It's
	  done whenever body has to be fully read (eg. rfc822.size).

2003-08-20 23:26  Timo Sirainen <tss@iki.fi>

	* src/util/Makefile.am: Keep rawlog still in libexec/dovecot/
	  directory.

2003-08-20 23:25  Timo Sirainen <tss@iki.fi>

	* INSTALL: Removed --with-rawlog. It's built always now.

2003-08-20 23:24  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/imap/Makefile.am,
	  src/imap/main.c, src/util/.cvsignore, src/util/Makefile.am,
	  src/util/rawlog.c: Separated rawlog into it's own binary.

2003-08-20 22:12  Timo Sirainen <tss@iki.fi>

	* src/master/: mail-process.c, master-settings.c: Allow one
	  parameter for mail_executable.

2003-08-20 03:17  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: We were posing as IMAP
	  instead of POP3 to auth process.

2003-08-20 02:51  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.h: Removed unneeded code

2003-08-20 02:51  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: removed unneeded code

2003-08-20 01:41  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-bodystructure.c,
	  lib-imap/imap-bodystructure.h, lib-mail/message-parser.c,
	  lib-mail/message-parser.h,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h:
	  If BODY/BODYSTRUCTURE is requested with some other headers, parse
	  the headers only once. If body contains multiple MIME parts,
	  cache the internal MIME structure so BODY[part] fetching doesn't
	  need to parse it again.

2003-08-18 03:32  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: auth_methods -> auth_mechanisms

2003-08-18 03:24  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-cache.c, lib-storage/index/Makefile.am,
	  lib-storage/index/index-mail-headers.c,
	  lib-storage/index/index-mail.c, lib-storage/index/index-mail.h:
	  Changed how cached headers are stored. Previously when we added
	  new headers, all the old headers were duplicated as well which
	  wasted space. Also fixed several bugs in caching.

2003-08-18 03:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.h, mail-index.h: Removed NBO32_BIT*
	  stuff

2003-08-18 03:20  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: Inserting to end of buffer or past it didn't
	  work

2003-08-13 22:24  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-sort.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-mail.c: Removed get_address() and
	  get_first_mailbox() from mail interface.

2003-08-11 14:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: some opening fixes

2003-08-11 14:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: message parts were stored
	  corrupted

2003-08-11 02:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: Makefile.am, mail-index.c: Support for upgrading
	  from old index file with smaller header.

2003-08-11 01:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-index.c, mail-index.h: Save
	  sync stamp in index header rather than in file's mtime.

2003-08-11 01:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache.c, mail-index.h: Fixes for opening
	  broken cache file.

2003-08-10 23:56  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-util.h, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-copy.c: Maildir syncing works
	  now without requiring base filenames to be in index cache file.
	  Also message flag updates with +FLAGS and -FLAGS works correctly
	  now if another client had just changed it's flags.

2003-08-10 18:14  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-store.c: crashfix

2003-08-07 09:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/Makefile.am: missing index-expunge.h

2003-08-06 20:15  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-copy.c, imap/cmd-fetch.c, imap/cmd-store.c,
	  imap/imap-fetch.c, imap/imap-fetch.h, imap/imap-search.c,
	  imap/imap-thread.c, lib-imap/imap-envelope.c,
	  lib-imap/imap-envelope.h, lib-index/Makefile.am,
	  lib-index/mail-cache.c, lib-index/mail-cache.h,
	  lib-index/mail-index-fsck.c, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-storage/mail-search.c,
	  lib-storage/mail-search.h, lib-storage/mail-storage.h,
	  lib-storage/index/index-fetch.c, lib-storage/index/index-mail.c,
	  lib-storage/index/index-mail.h, lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-copy.c, pop3/client.c,
	  pop3/commands.c: Index cache file rewrite. It's not finished yet
	  and mbox support is completely broken. But it's getting difficult
	  to maintain outside cvs :)

2003-08-06 19:56  Timo Sirainen <tss@iki.fi>

	* src/lib/Makefile.am: Added some network byte ordering functions
	  and macros

2003-08-06 19:46  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.c, src/lib/compat.h: Added pwrite()
	  compatibility

2003-08-06 19:46  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.h: comment fix

2003-08-06 19:46  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-data.c: bugfix

2003-08-06 19:16  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: reallocing clears memory unneededly
	  since it's always already cleared

2003-08-06 14:39  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: Some message/rfc822 mails were
	  returned as text/plain

2003-08-06 13:04  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: fix

2003-08-06 02:29  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-bodystructure.c, imap-envelope.c: Don't write
	  envelope as NIL into bodystructure even if it's broken.

2003-08-06 00:26  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: "Content-Type: text" (without '/')
	  didn't mark the message as containing text, which generated
	  broken BODYSTRUCTUREs.

2003-08-05 23:10  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-bodystructure.c, imap-parser.c,
	  imap-parser.h: Fixes for parsing BODYSTRUCTURE

2003-08-05 19:45  Timo Sirainen <tss@iki.fi>

	* configure.in: We should be checking C99 types using stdint.h, not
	  inttypes.h

2003-08-03 18:54  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: If user's home dir doesn't exist,
	  fallback to chdiring /tmp.

2003-08-02 17:38  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/utc-mktime.c: utc_mktime() crashed with
	  64bit time_t if gmtime() didn't like >32bit values

2003-07-27 05:52  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: A bit more temporary kludging

2003-07-27 05:37  Timo Sirainen <tss@iki.fi>

	* configure.in, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h:
	  Namespace configuration.

2003-07-27 05:37  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-list.c, cmd-rename.c: fixes

2003-07-27 04:48  Timo Sirainen <tss@iki.fi>

	* src/imap/: Makefile.am, client.c, client.h, cmd-append.c,
	  cmd-close.c, cmd-copy.c, cmd-create.c, cmd-delete.c,
	  cmd-expunge.c, cmd-fetch.c, cmd-idle.c, cmd-list.c,
	  cmd-namespace.c, cmd-rename.c, cmd-search.c, cmd-select.c,
	  cmd-sort.c, cmd-status.c, cmd-store.c, cmd-subscribe.c,
	  cmd-thread.c, cmd-unselect.c, commands-util.c, commands-util.h,
	  commands.c, commands.h, main.c, namespace.c, namespace.h: Getting
	  ready for namespaces. LIST is still broken with them.

2003-07-27 04:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: \Nochildren got
	  lost again..

2003-07-27 03:12  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h, pop3/main.c: Mail storages
	  support now configurable namespace prefix and hierarchy
	  separator. Subscription file handling needs some more thought.

2003-07-27 01:50  Timo Sirainen <tss@iki.fi>

	* src/lib/strescape.c: unescaping was broken

2003-07-26 23:53  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, lib-storage/Makefile.am,
	  lib-storage/mail-storage.h, lib-storage/mailbox-tree.c,
	  lib-storage/mailbox-tree.h,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-storage.h: API change: Mailbox list
	  sorting must now always done by storage itself if it's needed.

	  Maildir listing rewritten.

2003-07-26 23:28  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-match.c: Fixes for inbox case-insensitity
	  matching

2003-07-26 22:42  Timo Sirainen <tss@iki.fi>

	* src/master/Makefile.am: compile fix

2003-07-26 19:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-settings/settings.c: Spaces are now
	  stripped from end of line in config file. You can use " or '
	  quotes if you need them.

2003-07-26 18:29  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, common.h, main.c: Added pop3 hooks

2003-07-26 18:24  Timo Sirainen <tss@iki.fi>

	* src/imap/: imap-expunge.c, imap-expunge.h: forgot to add

2003-07-26 18:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/Makefile.am: Added proxy classes for use with
	  modules.

2003-07-26 18:22  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, common.h, main.c: hook changes

2003-07-26 16:55  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-close.c, imap/cmd-select.c, imap/commands-util.c,
	  imap/imap-fetch.c, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c: API changes: Don't keep
	  variables in mailbox class.

2003-07-26 16:54  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, common.h, main.c: Added hook_client_created
	  and hook_mail_storage_created for modules.

2003-07-26 16:33  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, imap/cmd-close.c, imap/cmd-expunge.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-mail.c,
	  lib-storage/index/index-mail.h,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h, pop3/client.c,
	  pop3/commands.c, pop3/mail-storage-callbacks.c: API change for
	  expunging messages. Not exactly what I wanted, but good enough.

2003-07-23 02:55  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-copy.c, imap/cmd-store.c, imap/imap-fetch.c,
	  lib-storage/mail-storage.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: Explicit lock() method for
	  mailbox.

2003-07-23 01:44  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.h, imap/cmd-copy.c, imap/cmd-store.c,
	  imap/imap-fetch.c, imap/imap-fetch.h,
	  imap/mail-storage-callbacks.c, lib-imap/imap-util.c,
	  lib-imap/imap-util.h, lib-storage/mail-storage.h,
	  lib-storage/index/index-fetch.c, lib-storage/index/index-mail.c,
	  lib-storage/index/index-mail.h, lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: API change for updating
	  message flags.

2003-07-23 00:40  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-copy.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-fetch.c, lib-storage/index/index-mail.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-storage.c: API change for copying
	  messages.

2003-07-22 23:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/Makefile.am: mail-tree.h no longer needed

2003-07-21 14:35  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/Makefile.am, lib-index/mail-index-fsck.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-storage.h: Removed .imap.index.tree file.
	  For now we'll just rewrite .imap.index file whenever there's
	  expunges. "Expunge binary tree" might be added later, but it's
	  not really useful until you have thousands of messages in mailbox
	  and you're deleting old messages from it.

2003-07-18 13:44  Timo Sirainen <tss@iki.fi>

	* autogen.sh: libtoolize --force

2003-07-18 00:45  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-date.c: Allow full month names, compare only
	  the first 3 chars.

2003-07-17 14:50  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: Don't crash if there's no domain
	  in address

2003-07-16 17:34  Timo Sirainen <tss@iki.fi>

	* configure.in: size_t checking fixes

2003-07-16 06:37  Timo Sirainen <tss@iki.fi>

	* src/login-common/main.c: Disable forking after setuid(), so Linux
	  2.6 is happy.

2003-07-16 04:24  Timo Sirainen <tss@iki.fi>

	* autogen.sh: Run libtoolize. Seems to fix newer auto* tools.

2003-07-16 01:46  Timo Sirainen <tss@iki.fi>

	* doc/nfs.txt: Updated, added ideas how to create better NFS
	  indexes.

2003-07-15 20:24  Timo Sirainen <tss@iki.fi>

	* configure.in: Get the size_t type properly in OSX

2003-07-15 19:19  Timo Sirainen <tss@iki.fi>

	* configure.in: bugfix

2003-07-15 18:41  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Minor speedup

2003-07-15 18:28  Timo Sirainen <tss@iki.fi>

	* configure.in: Delete conftest.mmap too

2003-07-15 18:26  Timo Sirainen <tss@iki.fi>

	* configure.in, dovecot-example.conf, src/imap/cmd-append.c,
	  src/imap/cmd-copy.c, src/imap/cmd-select.c,
	  src/imap/cmd-status.c, src/imap/common.h, src/imap/main.c,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h, src/pop3/client.c:
	  index_mmap_invalidate = yes now invalidate memory maps before
	  accessing them. Setting this on should fix some problems with
	  OpenBSD. It should also make it possible to use index files over
	  NFS as long as lock daemon is used.  It might be such a good idea
	  however.

2003-07-15 12:38  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: Quotes around echo

2003-07-15 09:44  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: Added missing randgen initialization.

2003-07-13 23:01  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: Fixes for handling missing
	  Mime-Version

2003-07-13 01:08  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-bodystructure.c, lib-mail/message-parser.c,
	  lib-mail/message-parser.h: Ignore Content-* headers if there's no
	  MIME-Version header. Note that this change breaks cached message
	  parts in indexes.

2003-07-12 23:43  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, common.h, mail-process.c, main.c,
	  master-settings.c, ssl-init.c: Replaced geteuid() calls with one
	  in the beginning and saving it to master_uid. When chdir()ing to
	  user's home dir, temporarily set euid to user's uid.

2003-07-12 15:45  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: We can't always chdir() to user's home
	  directory if it's NFS-mounted.  Ignore that error.

2003-07-11 22:36  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Included comment about passwd+BSD requiring
	  roots.

2003-07-10 14:45  Timo Sirainen <tss@iki.fi>

	* configure.in: test -o and -a are apparently non-POSIX. not using.

2003-07-10 03:04  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/db-ldap.c,
	  src/lib-settings/settings.c, src/lib-settings/settings.h,
	  src/master/auth-process.c, src/master/common.h,
	  src/master/login-process.c, src/master/login-process.h,
	  src/master/mail-process.c, src/master/mail-process.h,
	  src/master/main.c, src/master/master-settings.c,
	  src/master/master-settings.h, src/master/ssl-init.c: New
	  configuration file code. Some syntax changes, but tries to be
	  somewhat backwards compatible. SIGHUP now reverts back to old
	  configuration if it detected errors in new one.

2003-07-10 00:40  Timo Sirainen <tss@iki.fi>

	* configure.in: test -e isn't standard. Use test -c + -s for
	  checking /dev/urandom.

2003-07-09 19:50  Timo Sirainen <tss@iki.fi>

	* configure.in: test -e /dev/urandom, not test -c. BSD/OS has it as
	  a symlink to socket.

2003-07-09 19:30  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, pop3/Makefile.am: RAND_LIBS are needed
	  nowadays for imap/pop3.

2003-07-09 15:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Return BAD instead of NO
	  errors with invalid message sets

2003-07-09 14:51  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-date.c, lib-storage/index/index-search.c:
	  Still more timezone fixes

2003-07-08 16:01  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: typo

2003-07-08 15:09  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: fix

2003-07-06 22:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: call index deinit
	  properly

2003-07-06 22:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.c, index-storage.h,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Destroy all
	  unused indexes 10 seconds after use. Before we destroyed them
	  only when opening a new index.

2003-07-06 00:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c: NFS-safe
	  subscription file

2003-07-05 20:33  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-dotlock.c, lib/file-dotlock.h, lib/randgen.c,
	  imap/main.c: Moved all dotlocking code to lib/. Also we now use
	  temp file + link() rather than rely on working O_EXCL.

2003-07-03 01:01  Timo Sirainen <tss@iki.fi>

	* src/lib/unlink-lockfiles.c: fix :)

2003-07-03 01:01  Timo Sirainen <tss@iki.fi>

	* src/lib/: unlink-lockfiles.c, unlink-lockfiles.h: some more
	  cleanups

2003-07-03 00:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: unlink-lockfiles.c, unlink-lockfiles.h: Minor cleanups.

2003-07-02 15:01  Timo Sirainen <tss@iki.fi>

	* doc/mail-storages.txt: We don't lose UIDs anymore if index is
	  deleted.

2003-07-02 01:02  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  imap_max_line_length setting to config file.

2003-07-02 00:57  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/cmd-append.c, imap/common.h,
	  imap/main.c, imap-login/client.c, lib-imap/imap-bodystructure.c,
	  lib-imap/imap-envelope.c, lib-imap/imap-parser.c,
	  lib-imap/imap-parser.h: IMAP parser memory limits are now
	  enforced by bytes per line rather than limiting maximum amount of
	  tokens per line. Default is 64k now, which should help with the
	  huge message sets generated by some clients.

2003-07-01 19:17  Timo Sirainen <tss@iki.fi>

	* INSTALL: CPPFLAGS/LDFLAGS examples were missing -I / -L options..

2003-07-01 18:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: Expand ~/ from beginning of all paths. Added
	  INBOX=<dir> support for maildir.

2003-07-01 18:48  Timo Sirainen <tss@iki.fi>

	* src/lib/home-expand.c: home_expand(NULL) -> NULL

2003-07-01 18:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-list.c,
	  maildir-storage.c: mail_full_filesystem_access = yes fixes

2003-06-30 15:54  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-capability.c, common.h, main.c: Keep capability in
	  string_t so plugins can modify it.

2003-06-26 16:12  Timo Sirainen <tss@iki.fi>

	* NEWS, README, TODO, configure.in: 0.99.10 released

2003-06-26 14:59  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Comment updates

2003-06-26 00:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c: Don't send \Unmarked in
	  LIST reply unless mbox file is zero-sized. We can't get it right
	  with atime checks, so don't even try.

2003-06-26 00:05  Timo Sirainen <tss@iki.fi>

	* INSTALL: Say something about CPPFLAGS and LDFLAGS.

2003-06-25 23:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: When deleting
	  directory, delete .imap dir under it first.

2003-06-25 23:15  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/auth.txt, src/auth/passdb-pam.c: Using
	  "*" as PAM service name now uses imap/pop3 service.

2003-06-25 22:42  Timo Sirainen <tss@iki.fi>

	* INSTALL: ~/rawlog -> ~/dovecot.rawlog

2003-06-25 16:39  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Call waitpid() until no processes are
	  left, instead of one per second.

2003-06-24 23:35  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client-authenticate.c:
	  Don't advertise STARTTLS/STLS capability when TLS/SSL connection
	  is already established.

2003-06-24 23:26  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Better error message if UID/GID isn't
	  valid.

2003-06-24 23:17  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Use "dovecot" service rather than "imap".

2003-06-24 23:10  Timo Sirainen <tss@iki.fi>

	* src/imap-login/client.c: imap-login could get into infinite loop
	  if connection was closed improperly.

2003-06-24 22:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: get_date() wasn't optimized
	  by using cached ENVELOPE.

2003-06-23 18:22  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, imap/cmd-status.c,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-envelope.c,
	  lib-imap/imap-quote.c, lib-imap/imap-quote.h: LIST and STATUS
	  replies shouldn't strip tabs and spaces from mailbox names.

2003-06-23 05:47  Timo Sirainen <tss@iki.fi>

	* configure.in: fix for openssl detection

2003-06-22 23:08  Timo Sirainen <tss@iki.fi>

	* configure.in: Check OpenSSL using pkg-config which at least
	  redhat uses nowadays.

2003-06-22 19:23  Timo Sirainen <tss@iki.fi>

	* src/lib/: module-dir.c, network.c: Compiler warning fixes

2003-06-19 02:00  Timo Sirainen <tss@iki.fi>

	* src/login-common/main.c: Set process count to 1 instead of 0.

2003-06-19 01:49  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Fork new process for each PAM check. Not
	  exactly fast, but we have to do it so we don't block when
	  incorrect password is given. We could try reusing the processes
	  though..

2003-06-19 00:46  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-send.c: We were sending \0 instead of \r
	  with non-x86 systems.

2003-06-18 22:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c: Hardlink copying
	  crashed.

2003-06-18 01:35  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-quote.c: LWSP stripping with NUL/8bit chars set
	  wrong literal size which broke things.

2003-06-18 01:14  Timo Sirainen <tss@iki.fi>

	* src/lib/randgen.c: Use RAND_bytes() rather than
	  RAND_pseudo_bytes().

2003-06-18 01:12  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Make sure PRNG gets
	  initialized before chrooting so it can open /dev/urandom.

2003-06-16 14:39  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf:
	  s/max_logging_users/login_max_logging_users/

2003-06-16 08:31  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-select.c: compile fixes

2003-06-15 04:02  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2003-06-15 03:42  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-capability.c, imap/cmd-copy.c,
	  imap/cmd-fetch.c, imap/cmd-search.c, imap/cmd-sort.c,
	  imap/cmd-store.c, imap/cmd-thread.c, imap/commands-util.c,
	  imap/commands-util.h, lib-index/mail-index.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/mbox/mbox-save.c: Only NOOP and CHECK will now
	  always do a real mailbox sync. Other commands will also do it but
	  no often than once in 5 seconds. Also with maildir we don't
	  anymore try to sync it before running commands since syncing is
	  now done automatically whenever we try to access a file that
	  doesn't exist.

2003-06-15 02:20  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-storage.c: Dirty maildir flags
	  support works now.

2003-06-15 02:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Make sure we unlock index
	  before unreferencing it, since it's not actually closed at that
	  time

2003-06-14 17:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: "SEARCH DELETED" didn't
	  return anything if all messages were deleted.

2003-06-14 17:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.c, index-storage.h,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Close index files
	  before deleting the mailbox.

2003-06-14 17:22  Timo Sirainen <tss@iki.fi>

	* src/lib/mkdir-parents.c: Check for EISDIR error as well. Fixed
	  problems with BSD/OS.

2003-06-11 23:26  Timo Sirainen <tss@iki.fi>

	* src/login-common/: ssl-proxy-gnutls.c, ssl-proxy-openssl.c:
	  OpenSSL proxy changes - hopefully fixes something. Also don't
	  crash with "key not found from hash" if SSL handshake fails.

2003-06-04 23:00  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-parser.c, lib-mail/message-size.c,
	  lib-mail/message-size.h, lib-storage/index/index-mail.c: Removed
	  useless parameters from message_get_body_size(). Also did some
	  small optimizations to it.

2003-06-04 16:37  Timo Sirainen <tss@iki.fi>

	* configure.in: Check dlopen() from libc before from libdl

2003-06-04 16:35  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, cmd-fetch.c, cmd-list.c, cmd-store.c: Give
	  more verbose protocol level errors + some fixes.

2003-06-04 16:13  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: Add charset/us-ascii into
	  body/bodystructure replies if no charset is given for text/* body
	  parts.

2003-06-04 16:03  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-quote.c: Actually it should assume that
	  beginning of string is LWSP..

2003-06-04 16:03  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-quote.c: imap_quote_append() shouldn't have
	  checked previous string for lwsp

2003-06-04 15:57  Timo Sirainen <tss@iki.fi>

	* src/: imap/imap-fetch.c, lib-index/mail-index.h,
	  lib-mail/message-parser.c, lib-mail/message-parser.h,
	  lib-mail/message-send.c, lib-mail/message-send.h,
	  lib-mail/message-size.c, lib-mail/message-size.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-mail.c: IMAP
	  protocol doesn't allow server to send NULs to client. Send ascii
	  #128 instead.

2003-06-04 14:48  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-quote.c, imap-quote.h: imap_quote*() will now
	  pack all LWSP into a single space and convert NULs to ascii 128.

2003-06-04 14:47  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: message_parse_header(): skip all
	  LWSP after ':' or in continued header. It's not what RFC2822
	  says, but it's historically better behaviour.

2003-06-04 07:53  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: Log using current time, not ioloop_time.

2003-05-30 11:56  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: was missing #ifdef HAVE_OPENSSL

2003-05-30 02:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Keep mailbox indexes
	  cached for a while after they've been closed. Should speed up at
	  least multiple APPENDs.

2003-05-30 01:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-status.c: If we're asking only custom
	  flags (eg. APPEND), don't do any mailbox syncing.

2003-05-30 01:07  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-module.c: Again RTLD_* fixes.

2003-05-30 01:02  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: All systems don't define RTLD_GLOBAL and
	  RTLD_NOW. Default them to 0.

2003-05-29 23:03  Timo Sirainen <tss@iki.fi>

	* configure.in: dlopen wasn't actually checked from libc..

2003-05-29 22:49  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Some
	  fixes/cleanups for cases when maildir doesn't exist

2003-05-29 22:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: Fixes for syncing mails that are kept
	  in new/ dir.

2003-05-29 21:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: uidlist file is read/updated much
	  less often now. did some other improvements for syncing as well.

2003-05-28 11:28  Timo Sirainen <tss@iki.fi>

	* configure.in: Check if dlopen is in libc too.

2003-05-28 11:04  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: Fixed memory leak.

2003-05-27 21:46  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: STLS was missing from
	  capability list.

2003-05-27 07:13  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: If mail didn't end with linefeed, we sent it
	  wrong.

2003-05-26 15:26  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib/restrict-access.c,
	  src/lib/restrict-access.h, src/master/auth-process.c,
	  src/master/login-process.c, src/master/mail-process.c: Allow
	  first_valid_gid to be 0. Drop any supplementary groups not in
	  valid gid range.

2003-05-26 13:07  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: bugfix

2003-05-24 15:21  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: fix

2003-05-24 15:16  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-poll.c, ioloop-select.c, ioloop.c: bugfixes

2003-05-23 14:48  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: wasn't supposed to be committed

2003-05-23 14:47  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: Extra asserts

2003-05-23 14:40  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, imap/client.c,
	  imap-login/client-authenticate.c, imap-login/client.c,
	  lib/ioloop-internal.h, lib/ioloop-poll.c, lib/ioloop-select.c,
	  lib/ioloop.c, lib/ioloop.h, lib/ostream-file.c, lib/ostream.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/subscription-file/subscription-file.c,
	  master/auth-process.c, master/login-process.c,
	  master/ssl-init-openssl.c, pop3/client.c, pop3-login/client.c:
	  Removed I/O priorities. They were pretty much useless and were
	  just getting in way.

2003-05-23 14:39  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: Minor speedup

2003-05-23 14:12  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: minor speedup

2003-05-23 13:54  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: Clear old poll revents when removing the
	  IO. Just extra sanity check.

2003-05-22 23:04  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Reset line->name and full_value*
	  fields at end of headers. Envelope parser was treating the EOH as
	  duplicate of last header.

2003-05-20 18:49  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Check that imap/pop3 module
	  directories exist if they're enabled. Give a warning if module
	  support is enabled in config file but not built into binary.

2003-05-20 18:22  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Generate temporary RSA key
	  when requested. Could be slow, should do some caching in master
	  process side..

2003-05-19 09:57  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: fixes

2003-05-19 09:50  Timo Sirainen <tss@iki.fi>

	* src/lib/: mempool-alloconly.c, mempool-datastack.c,
	  mempool-system.c, mempool.h: Added pool_get_name(), for debugging
	  mostly.

2003-05-19 06:35  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: fixes

2003-05-18 16:37  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: s/host/addr/ in
	  variables

2003-05-18 16:37  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, lib/fd-close-on-exec.c, lib/network.c,
	  lib/network.h, login-common/ssl-proxy-gnutls.c,
	  login-common/ssl-proxy-openssl.c, master/mail-process.c,
	  pop3-login/client.c: s/host/addr/ in a few network functions

2003-05-18 16:26  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Send client's IP to mail process.

2003-05-18 16:02  Timo Sirainen <tss@iki.fi>

	* src/: lib/Makefile.am, lib/compat.h, lib/mkdir-parents.c,
	  lib/mkdir-parents.h, lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-storage.c: More robust error handling
	  for mbox.

2003-05-18 12:26  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-copy.c: Maildir syncing
	  updates: it's now faster, it handles read-only folders, it
	  handles many out of disk space conditions (uidlist doesn't) and
	  all commands finally handle the condition when maildir filename
	  was renamed after our syncing but before we had the chance to
	  open it.

2003-05-18 12:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Misc. fixes.

2003-05-17 13:09  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: Maildir: CONTROL=<dir> in
	  MAIL environment now specifies where to save .customflags and
	  dovecot-uidlist files. This can be useful if the main mail
	  directory is under hard quota.

2003-05-17 09:28  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Automatically set file streams to
	  blocking and don't try to io_add() them.

2003-05-17 09:08  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Don't try to cork files.

2003-05-16 17:14  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: If there were no timeouts, struct timeval
	  wasn't initialized and select() might have failed because of it.
	  Patch by Mark E. Mallett.

2003-05-16 17:09  Timo Sirainen <tss@iki.fi>

	* src/imap-login/client-authenticate.c: If client tries to do LOGIN
	  even if it's disabled, send [ALERT] to user.

2003-05-16 17:05  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  imap-login/client-authenticate.h, imap-login/client.c,
	  pop3-login/client-authenticate.c: Don't advertise AUTH=PLAIN in
	  capability if disable_plaintext_auth = yes and SSL/TLS is not yet
	  negotiated.

2003-05-15 19:22  Timo Sirainen <tss@iki.fi>

	* src/: imap/commands.c, imap/imap-sort.c, lib/buffer.c,
	  lib/buffer.h, lib/str.c, lib-charset/charset-iconv.c,
	  lib-charset/charset-utf8.c, lib-mail/message-part-serialize.c:
	  Renamed buffer_*_space() to buffer_*_space_unsafe() and added
	  several warnings about using them. Fixed their usage in a few
	  places in sources where they could have produced invalid results
	  (no buffer overflows, luckily).

2003-05-14 18:31  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb.c, userdb.c: AUTH_MODULES -> HAVE_MODULES

2003-05-14 18:29  Timo Sirainen <tss@iki.fi>

	* src/master/: mail-process.c, login-process.c: fix

2003-05-14 18:25  Timo Sirainen <tss@iki.fi>

	* configure.in: No, still no oracle here..

2003-05-14 18:23  Timo Sirainen <tss@iki.fi>

	* src/lib/: module-dir.c, module-dir.h: missing

2003-05-14 18:23  Timo Sirainen <tss@iki.fi>

	* INSTALL, configure.in, dovecot-example.conf,
	  src/auth/Makefile.am, src/auth/auth-module.c,
	  src/imap/Makefile.am, src/imap/main.c, src/lib/Makefile.am,
	  src/master/Makefile.am, src/master/login-process.c,
	  src/master/mail-process.c, src/master/mail-process.h,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3/Makefile.am, src/pop3/main.c: Added support for
	  dynamically loadable imap/pop3 modules.

2003-05-14 17:23  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.c, client.h, cmd-uid.c, commands.c, commands.h,
	  main.c: Added command_register() and related functions so we can
	  dynamically register new commands.

2003-05-12 06:15  Timo Sirainen <tss@iki.fi>

	* src/imap/Makefile.am: fix

2003-05-12 06:14  Timo Sirainen <tss@iki.fi>

	* configure.in: libstorage_index_* -> libindex_*

2003-05-12 06:13  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, pop3/Makefile.am: Dependency fixes

2003-05-12 06:04  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-passwd.c, passdb-shadow.c, userdb-passwd.c:
	  Don't check errno of getpwnam() and getspnam() functions. They
	  don't seem to be set correctly in all systems and it's unlikely
	  the error is anything else than "user doesn't exist".

2003-05-12 05:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't give internal
	  errors when trying to select, delete or rename (non-existing)
	  mailboxes under mbox.

2003-05-11 14:43  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Unexpected SSL connection
	  errors sometimes crashed

2003-05-11 14:27  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: cleanups

2003-05-11 11:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c: If we
	  don't have access to write subscriptions file, say "permission
	  denied" to user rather than internal error

2003-05-09 05:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: DELETE should
	  report success to client even if it can't actually delete the
	  folder, as long as it can rename it to "..dir".

2003-05-08 15:53  Timo Sirainen <tss@iki.fi>

	* src/lib/unlink-directory.c: check lstat() error too

2003-05-08 13:56  Timo Sirainen <tss@iki.fi>

	* src/lib/unlink-directory.c: Returned errno was often wrong.

2003-05-08 05:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Give "Permission
	  denied" error instead of internal error if some call fails with
	  EACCES.

2003-05-08 04:53  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-close.c, lib-storage/index/index-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: Some fixes to get
	  read-only mboxes working.

2003-05-08 04:34  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: bugfix

2003-05-08 04:28  Timo Sirainen <tss@iki.fi>

	* doc/auth.txt, doc/dovecot-ldap.conf,
	  src/auth/auth-master-interface.h, src/auth/db-passwd-file.c,
	  src/auth/db-passwd-file.h, src/auth/userdb-ldap.c,
	  src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c,
	  src/auth/userdb.h, src/master/auth-process.c,
	  src/master/mail-process.c: Chrooting changes. Now all userdbs
	  will support "<chroot>/./<homedir>" style home directories.

2003-05-08 04:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c: Crashfix

2003-05-08 04:01  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, login-process.c: If exec() fails,
	  show the full path rather than argv[0]

2003-05-08 03:47  Timo Sirainen <tss@iki.fi>

	* doc/auth.txt: Updated for ANONYMOUS

2003-05-08 03:36  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-passwd.c: Support wu-ftpd-like chrooting in
	  /etc/passwd. If home directory ends with "/./", it's chrooted to.

2003-05-08 03:35  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: We didn't log if chroot directory was
	  invalid.

2003-05-08 03:24  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/Makefile.am,
	  src/auth/mech-anonymous.c, src/auth/mech.c, src/auth/mech.h,
	  src/master/auth-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added support for ANONYMOUS SASL
	  mechanism.

2003-05-08 03:18  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-plain.c: hash.h not needed

2003-05-08 02:29  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-body-search.c: Content-Type wasn't actually
	  set, which caused us to search non-text attachments which
	  unnecessarily slows down things.

2003-05-08 02:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-status.c: Don't crash with invalid
	  first_unseen_uid_lowwater

2003-05-07 12:23  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Use ENOSYS rather than EINVAL for
	  fd_send/fd_recv.

2003-05-07 12:21  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-internal.h, ioloop.h: struct timeval requires
	  sys/time.h

2003-05-07 12:14  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-util.c: remove compiler warnings if we declare
	  madvise() as empty function

2003-05-07 12:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: Makefile.am, index/Makefile.am,
	  index/index-storage.h, index/maildir/maildir-save.c,
	  index/mbox/mbox-save.c: cleanup: message saving code isn't
	  index-specific

2003-05-07 12:05  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Compile even if SCM_RIGHTS isn't supported.

2003-05-07 08:17  Timo Sirainen <tss@iki.fi>

	* src/lib/: compat.c, randgen.c: Use #warning only with GCC.

2003-05-07 08:16  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Don't redefine _XOPEN_SOURCE_EXTENDED.

2003-05-05 16:47  Timo Sirainen <tss@iki.fi>

	* Makefile.am: Keep dovecot.spec in tarball as well.

2003-05-04 16:16  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Don't try to set /dev/null fd nonblocking, all
	  systems don't like that.

2003-05-03 18:46  Timo Sirainen <tss@iki.fi>

	* configure.in: _still_ no oracle here.

2003-05-03 18:45  Timo Sirainen <tss@iki.fi>

	* configure.in: Removed AM_CONFIG_HEADER accidentally

2003-05-03 18:34  Timo Sirainen <tss@iki.fi>

	* configure.in: oracle wasn't supposed to be here yet

2003-05-03 18:33  Timo Sirainen <tss@iki.fi>

	* .cvsignore: added dovecot.spec

2003-05-03 18:32  Timo Sirainen <tss@iki.fi>

	* Makefile.am, NEWS, TODO, configure.in: 0.99.9.1 released. Added
	  redhat spec file.

2003-05-03 18:19  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-envelope.c: imap_envelope_parse() didn't parse
	  literals correctly.

2003-05-03 17:57  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Removed IMAP-specific comment..

2003-05-03 17:36  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Handle inconsistency error separately.

2003-05-03 17:28  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: We stopped parsing message if
	  there was a line longer than input buffer (8192 bytes).

2003-05-03 16:31  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: If no error is set, give "BUG: Unknown error"
	  rather than try to print NULL which crashes in some systems.

2003-04-29 22:10  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Define _XOPEN_SOURCE only for IRIX.

2003-04-28 16:33  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 0.99.9 released

2003-04-28 16:32  Timo Sirainen <tss@iki.fi>

	* src/lib/macros.h: Added __attr_scanf__

2003-04-28 16:31  Timo Sirainen <tss@iki.fi>

	* src/imap/commands-util.c: minor fix

2003-04-28 12:46  Timo Sirainen <tss@iki.fi>

	* doc/Makefile.am: Added dovecot-pgsql.conf

2003-04-28 11:10  Timo Sirainen <tss@iki.fi>

	* src/pop3/Makefile.am: Use STORAGE_LIBS.

2003-04-27 23:55  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: AIX fix

2003-04-27 20:02  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/lib-index/Makefile.am:
	  --with-storage=maildir,mbox can now be used to compile in only
	  the wanted storage formats.

2003-04-27 16:40  Timo Sirainen <tss@iki.fi>

	* configure.in: fix

2003-04-27 16:09  Timo Sirainen <tss@iki.fi>

	* src/lib/istream.c: i_stream_seek() broke stream if read limit was
	  set.

2003-04-27 02:52  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-internal.h: "invalid" no longer needed.

2003-04-27 02:51  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-poll.c: Better handling for POLLNVAL.

2003-04-27 01:21  Timo Sirainen <tss@iki.fi>

	* src/: login-common/main.c, master/login-process.c: Moved setting
	  process limit after exec().

2003-04-27 01:14  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-process-size.c: cleanup

2003-04-27 01:05  Timo Sirainen <tss@iki.fi>

	* AUTHORS: update

2003-04-27 01:05  Timo Sirainen <tss@iki.fi>

	* doc/nfs.txt: updated

2003-04-27 00:59  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-index/mail-index.h: Use separate index
	  alignment from memory alignment. We don't use pointers in index
	  file so required alignmentation comes pretty much from
	  sizeof(off_t).

2003-04-26 21:52  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-send.c, lib-mail/message-send.h,
	  lib-mail/message-size.c, lib-mail/message-size.h,
	  imap/imap-fetch.c: Partial fetches were broken when they stopped
	  between virtual CR and LF.

2003-04-25 19:09  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Fix for IRIX

2003-04-25 15:23  Timo Sirainen <tss@iki.fi>

	* configure.in: mem_align test was broken

2003-04-25 01:35  Timo Sirainen <tss@iki.fi>

	* configure.in: Use mem_align=4 with 32bit off_t

2003-04-23 17:07  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Don't call msync() with with
	  in-memory indexes.

2003-04-23 16:52  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: #ifdef _AIX, not AIX

2003-04-23 15:54  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: and disable debugging :)

2003-04-23 15:54  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: mremap_anon() was broken when it had to move
	  data.

2003-04-23 15:36  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't define OFF_T_MAX if it's already defined

2003-04-23 14:31  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: mmap(MAP_FIXED) may return ENOMEM as well as
	  EINVAL if address+length isn't valid. Also some other cleanups.

2003-04-22 18:49  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-delete.c: allow deleting selected mailbox

2003-04-22 18:37  Timo Sirainen <tss@iki.fi>

	* src/imap/commands-util.c: Give BAD instead of NO when trying to
	  use selected state command in non-selected state.

2003-04-22 18:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: More SEARCH OR fixes.

2003-04-22 18:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-search.c, index/index-search.c: SEARCH OR
	  fixes.

2003-04-22 17:47  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-date.c, lib-imap/imap-date.c: Still some
	  timezone fixes

2003-04-21 20:06  Timo Sirainen <tss@iki.fi>

	* src/: lib/fdpass.c, auth/mycrypt.c: AIX fixes.

2003-04-21 15:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-save.c, mbox/mbox-save.c:
	  fsync() saved mails

2003-04-21 13:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: Use mtime to check changes in
	  dovecot-uidlist file rather than inode changes which aren't
	  reliable.

2003-04-17 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: We got dotlock's mtime before modifying
	  it, which caused problems sometimes.

2003-04-16 16:05  Timo Sirainen <tss@iki.fi>

	* src/master/: mail-process.c, main.c: chdir() to base_dir at
	  startup. chdir() mail processes to home dir if it's known.

2003-04-16 14:30  Timo Sirainen <tss@iki.fi>

	* src/pop3/main.c: cleanup

2003-04-16 14:24  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, client.h, main.c: Crashfix if there was some
	  errors while opening mailbox

2003-04-16 13:38  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-passwd-file.c, db-passwd-file.h,
	  passdb-passwd-file.c, userdb-passwd-file.c: passwd-file fixes.
	  passdb ignores now fields after password, so it can work with
	  shadow-like file.

2003-04-15 23:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: DEBUG: Don't crash with in-memory
	  indexes

2003-04-15 19:00  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Use different warning message for dotlock
	  mtime change.

2003-04-15 16:58  Timo Sirainen <tss@iki.fi>

	* src/master/: common.h, login-process.c, mail-process.c,
	  mail-process.h, main.c: Separate PROCESS_TYPE_MAIL into IMAP and
	  POP3.

2003-04-13 18:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: More optimized mbox
	  rewriting. It now tries to shrink/extend the filler in x-keywords
	  header.

2003-04-13 18:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Don't crash if there
	  was locking problems when trying to rewrite mbox.

2003-04-10 22:37  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, lib/ioloop.c, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h, pop3/main.c: minor memory
	  leak/cleanup fixes

2003-04-10 22:37  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: p_clear() left only the smallest
	  block, not the largest block

2003-04-10 21:19  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: Free memory at exit

2003-04-09 20:28  Timo Sirainen <tss@iki.fi>

	* src/lib/: ostream-file.c, sendfile-util.c: Call safe_sendfile()
	  only with sockets, and also with files under Linux.  Hopefully
	  helps for signal 12 under FreeBSD.

2003-04-09 20:13  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: We don't need these fields

2003-04-09 20:10  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h: Rewritten maildir
	  syncing. Uses dovecot-uidlist file to store UIDs permanently.

2003-04-09 20:07  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-envelope.c: Don't crash if mail doesn't have
	  any headers.

2003-04-08 23:06  Timo Sirainen <tss@iki.fi>

	* configure.in: use test -c for checking /dev/urandom. test -e
	  doesn't work in solaris.

2003-04-08 22:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: s/latest IMAP4rev1
	  draft/RFC-3501/

2003-04-08 16:59  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-passwd-file.c: default is CRYPT, not DES (which
	  doesn't even exist)

2003-04-08 13:12  Timo Sirainen <tss@iki.fi>

	* src/: lib/fdpass.c, master/login-process.c: Tru64 fixes. More
	  comments.

2003-04-05 21:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c: hardlink copying
	  was broken again

2003-04-04 14:41  Timo Sirainen <tss@iki.fi>

	* src/lib/randgen.c: compilefix

2003-04-04 14:40  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/lib/randgen.c: Support
	  using OpenSSL's pseudo-random generator instead of /dev/urandom.
	  If neither are found, allow dovecot-auth still to be started
	  because currently only DIGEST-MD5 requires prng.

2003-04-04 12:33  Timo Sirainen <tss@iki.fi>

	* Makefile.am: config.rpath was missing

2003-04-04 12:09  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Compile fix for tru64

2003-04-03 23:42  Timo Sirainen <tss@iki.fi>

	* src/auth/password-scheme.c: MD5crypt password fixes.

2003-04-02 02:09  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/db-ldap.c,
	  src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	  src/auth/mech.c, src/auth/mech.h, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Moved
	  auth_username_chars from db-pgsql to generic for all. Some other
	  auth code cleanups.

2003-04-02 02:05  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, imap/cmd-status.c, lib/strescape.c,
	  lib/strescape.h: Mailbox names are now sent through imap-quoter
	  instead of just escaping it.	This means that mailbox names that
	  would require escapes are instead sent as literals now.

2003-04-02 01:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/auth-process.c,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	  src/auth/mech.c, src/auth/mech.h: Added auth_default_realm (based
	  on patch by Kristian Hoffmann)

2003-04-01 14:55  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: crashfix

2003-04-01 12:02  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-body-search.c, message-parser.c: crashfix

2003-03-30 12:48  Timo Sirainen <tss@iki.fi>

	* src/: lib/compat.h, lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/mbox/mbox-save.c: Handle EDQUOT errno as "not
	  enough disk space" like ENOSPC.

2003-03-29 08:56  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: rewrite, maybe it works
	  properly now.

2003-03-26 17:52  Timo Sirainen <tss@iki.fi>

	* doc/nfs.txt: updated

2003-03-26 17:29  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-bodystructure.c, lib-imap/imap-envelope.c,
	  lib-imap/imap-envelope.h, lib-imap/imap-quote.c,
	  lib-mail/message-body-search.c, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-storage/index/index-mail.c,
	  lib-storage/index/index-mail.h, lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/mbox/mbox-save.c: Better handling for multiline
	  headers. Before we skipped headers larger than input buffer size
	  (8k with read (default), 256k with mmap). The skipping was also a
	  bit buggy.

	  Now we parse the lines one at a time. There's also a way to read
	  the header fully into memory before parsing it, if really needed.

2003-03-26 15:40  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-envelope.c, lib-imap/imap-envelope.h,
	  lib-imap/imap-quote.c, lib-imap/imap-quote.h,
	  lib-storage/index/index-mail.c: memory usage fixes

2003-03-26 14:58  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: When data stack grew larger than two
	  blocks, t_pop()ing crashed when trying to free extra blocks.

2003-03-26 14:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: fix extra memory usage

2003-03-26 09:35  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Removed default auth_chroot directory from
	  digest-md5 case. If you really want it, you know where to set it.

2003-03-26 08:38  Timo Sirainen <tss@iki.fi>

	* INSTALL: s/imap-master/dovecot/

2003-03-26 08:31  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: Support for mailfront.

2003-03-22 19:13  Timo Sirainen <tss@iki.fi>

	* src/lib/lib.c: compile warning fix

2003-03-21 06:47  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-dotlock.c, lib/lib.c,
	  lib-storage/index/mbox/mbox-save.c: Call the hostpid_init()
	  always at startup. Easier than doing it all around.

2003-03-20 22:31  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-internal.h, istream.c: Fixes for resetting
	  stream limits. Should fix some APPEND problems.

2003-03-20 19:06  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Literals didn't work if they weren't
	  the last argument.

2003-03-20 17:38  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, lib-storage/index/maildir/maildir-list.c:
	  More kludgy LIST fixes for maildir subfolders

2003-03-20 17:19  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: LIST "" foo.% doesn't anymore reply "foo."
	  folder.

2003-03-20 17:06  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: We didn't stop after reading literal
	  size. This broke using non-synced literals with APPEND.

2003-03-17 05:09  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: file offset wasn't kept right.

2003-03-17 04:47  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, pop3/Makefile.am: more fixes..

2003-03-17 04:44  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, pop3/Makefile.am: iconv fixes

2003-03-17 04:43  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-select.c: Whops, test reverted back.

2003-03-17 04:40  Timo Sirainen <tss@iki.fi>

	* src/lib/fd-close-on-exec.c: Don't assume that major() and minor()
	  are unsigned ints.

2003-03-17 04:36  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/cmd-select.c,
	  src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c,
	  src/pop3/Makefile.am: Better iconv() checking.

2003-03-16 14:33  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: Fixes to parsing userdb fields.

2003-03-15 00:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Renaming maildir
	  subfolders inserted extra "." in the middle.

2003-03-14 22:15  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb.c, userdb.c: cleanups

2003-03-14 18:52  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: updated first_valid_uid comment

2003-03-14 09:35  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: "mail process isn't allowed to use UID
	  %s (modify first_valid_uid in config file)"

2003-03-10 00:36  Timo Sirainen <tss@iki.fi>

	* src/: lib/istream.c, lib/istream.h, lib-settings/settings.c,
	  auth/db-passwd-file.c: Added i_stream_read_next_line()

2003-03-09 10:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c: mbox: LIST ""
	  invalid-directory/% doesn't anymore give internal error

2003-03-09 09:56  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-create.c, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: mbox: CREATE mailbox/ now
	  mkdir()s it.

2003-03-09 09:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c: FETCH: \Seen flag updating
	  didn't work (eg. FETCH BODY[]).

2003-03-09 00:35  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Literal parser broke if \r\n wasn't
	  in buffer at the time '}' was parsed.

2003-03-07 00:40  Timo Sirainen <tss@iki.fi>

	* configure.in: pgsql check fixes

2003-03-07 00:37  Timo Sirainen <tss@iki.fi>

	* configure.in: cleanup

2003-03-06 23:31  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: Log vpop_user + vpop_domain too. They
	  may be different from original username after parse_email()..

2003-03-06 23:24  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am: cleanups

2003-03-06 23:20  Timo Sirainen <tss@iki.fi>

	* INSTALL, configure.in, dovecot-example.conf, doc/auth.txt,
	  doc/dovecot-ldap.conf, src/auth/Makefile.am, src/auth/passdb.c,
	  src/auth/passdb.h, src/auth/userdb.c, src/auth/userdb.h: Added
	  PostgreSQL support, patch by Alex Howansky

2003-03-06 21:45  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h: Added ldap_version setting.

2003-03-06 21:44  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, login-common/main.c: We didn't work at
	  all in non-inetd mode. Also fix crash when quitting.

2003-03-06 19:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: UIDs are now saved
	  into mbox file. added a few rewriting optimizations so that we
	  don't always have to rewrite the whole file when updating
	  messages at the beginning of file.

2003-03-05 20:54  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: message_address_write() didn't
	  work.

2003-03-05 20:51  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-address.c: message_address_parse(): allow
	  using data_stack_pool

2003-03-05 01:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.h: Compiler warning fixes.

2003-03-05 01:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: Added
	  index->append_abort() to abort append cleanly.

2003-03-04 22:38  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/client.h, login-common/Makefile.am,
	  login-common/client-common.h, login-common/main.c,
	  login-common/master.c, login-common/master.h,
	  master/login-process.c, pop3-login/client.c, pop3-login/client.h:
	  login: Wait until we're connected to auth process before
	  executing command from client.

	  inetd usage: --group=name can now specify which login group to
	  use. Default is the binary name before '-' character (ie. imap or
	  pop3).

2003-03-04 04:02  Timo Sirainen <tss@iki.fi>

	* src/: login-common/Makefile.am, login-common/main.c,
	  login-common/master.c, login-common/master.h,
	  master/auth-process.c, master/common.h, master/login-process.c,
	  master/mail-process.c, master/main.c,
	  master/master-login-interface.h: Somewhat working code to support
	  loading Dovecot from inetd and such. It still needs possibility
	  to specify which login process to use, and LOGIN and AUTHENTICATE
	  commands shouldn't be allowed before we're connected to auth
	  process.

2003-03-04 04:00  Timo Sirainen <tss@iki.fi>

	* src/lib/: env-util.c, env-util.h, restrict-access.c,
	  restrict-access.h: Removed restrict_access_clean_env() and
	  env_remove(). They're not needed.

2003-03-04 03:59  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: Handle /dev/stderr directly instead of
	  open()ing.

2003-03-04 03:59  Timo Sirainen <tss@iki.fi>

	* src/lib/fd-close-on-exec.c: More verbose error message when
	  leaked fd is noticed.

2003-03-04 02:18  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, lib/network.c,
	  login-common/ssl-proxy-gnutls.c,
	  login-common/ssl-proxy-openssl.c, master/auth-process.c,
	  master/main.c: net_* functions don't anymore set sockets to
	  non-blocking by default.

2003-03-04 01:10  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-quote.c: Use literals for strings containing
	  '"' and '\' characters too. This wasn't done at all before so
	  FETCH ENVELOPE, BODY and BODYSTRUCTURE could have returned pretty
	  broken results.

2003-03-02 22:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Selecting INBOX didn't
	  use index files if full_filesystem_access was yes.

2003-03-01 15:25  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Setting user_global_uid or user_global_gid
	  crashed.

2003-02-27 14:48  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, lib-storage/index/maildir/maildir-list.c:
	  Maildir LIST \Children fixes.

2003-02-26 22:19  Timo Sirainen <tss@iki.fi>

	* src/lib/safe-mkdir.c: safe_mkdir(): usage fchmod() and fchown().
	  chmod() wasn't really safe and lchown() wasn't portable.

2003-02-26 21:27  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-plain.c: Invalid PLAIN auth request crashed auth
	  process.

2003-02-26 11:21  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: [::] address wasn't treated exactly as "ipv6
	  any", but looks like gethostbyname() worked with it.

2003-02-26 11:19  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Added --version

2003-02-26 01:01  Timo Sirainen <tss@iki.fi>

	* doc/nfs.txt: updated

2003-02-25 23:12  Timo Sirainen <tss@iki.fi>

	* doc/index.txt: update

2003-02-25 21:05  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: final fix: text-content
	  subtype wasn't defaulted to plain

2003-02-25 20:58  Timo Sirainen <tss@iki.fi>

	* configure.in: 0.99.8 released

2003-02-25 20:55  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: Default to 7bit instead of
	  8bit content-encoding-type.

2003-02-25 19:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: Don't delete ".."
	  dirs outside our imap root.

2003-02-25 19:10  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-address.c, message-parser.c: A few small
	  fixes to MIME and mail address parsers.

2003-02-24 22:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: Use less strict mailbox name verification
	  when trying to access existing mailboxes. Don't delete
	  directories beginning with ".." outside our maildir root (if
	  full_filesystem_access = yes).

2003-02-24 22:39  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: placeholder -> noselect change broke LIST ""
	  "foo/%" not showing foo/.

2003-02-24 19:38  Timo Sirainen <tss@iki.fi>

	* NEWS, README, TODO: updates

2003-02-24 19:05  Timo Sirainen <tss@iki.fi>

	* src/lib/unlink-directory.c: fd leak fix

2003-02-24 19:01  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy.c: Didn't compile without SSL libs

2003-02-24 18:30  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, lib-storage/index/maildir/maildir-list.c:
	  Use \PlaceHolder only when listing subscriptions.

2003-02-24 18:15  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Try to use optimal block sizes when
	  writing to files.

2003-02-24 17:39  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/cmd-list.c, src/imap/commands.h,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-list.c: Added support for
	  CHILDREN and LISTEXT extensions.

2003-02-24 01:16  Timo Sirainen <tss@iki.fi>

	* src/lib/unlink-directory.c: unlink_directory() is now (hopefully)
	  race-condition free.

2003-02-24 00:29  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: comment update

2003-02-24 00:27  Timo Sirainen <tss@iki.fi>

	* doc/auth.txt: Use pam_unix as example instead of pam_pwdfile.

2003-02-23 21:23  Timo Sirainen <tss@iki.fi>

	* doc/: design.txt, index.txt: updates

2003-02-23 21:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: in-memory index
	  crashfixes

2003-02-23 21:06  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/index.txt, doc/mail-storages.txt,
	  src/lib-index/Makefile.am, src/lib-index/mail-index.c,
	  src/lib-index/mail-index.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Index opening rewrites. We don't
	  try to support .imap.index-<hostname> style indexes anymore. They
	  just made things more difficult, and it's really not a good idea
	  to use index files via NFS anyway.

	  Added support for :INDEX=MEMORY in MAIL env to disable using
	  index files.	Also if we can't open or create index file for any
	  reason, we now fallback to in-memory indexes. Before we
	  fallbacked only with out of disk space errors.

	  If .customflags can't be created, we still work now by not
	  allowing to create new custom flags.

2003-02-23 19:49  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: ..and tell login process about
	  verbose_ssl..

2003-02-23 19:46  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: verbose_ssl here too

2003-02-23 19:44  Timo Sirainen <tss@iki.fi>

	* src/: master/master-settings.c, master/master-settings.h,
	  imap-login/client.c, login-common/common.h, login-common/main.c,
	  login-common/ssl-proxy-gnutls.c,
	  login-common/ssl-proxy-openssl.c, login-common/ssl-proxy.h,
	  pop3-login/client.c: Added setting verbose_ssl

2003-02-23 13:13  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: bugfix

2003-02-23 10:53  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-gnutls.c: proper deinit for gnutls
	  proxy too

2003-02-23 10:53  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: destroy proxies before
	  destroying ssl context

2003-02-23 10:46  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: and compiler warning
	  fixes..

2003-02-23 10:45  Timo Sirainen <tss@iki.fi>

	* src/login-common/: main.c, ssl-proxy-openssl.c: Keep list of the
	  SSL proxies, so they're deinitialized properly if we have to kill
	  them.

2003-02-23 10:43  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Don't listen in imaps/pop3s if ssl_disable =
	  yes. Even if they're listed in protocols.

2003-02-22 16:16  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: [ipv6 address] was still buggy in *_listen

2003-02-21 18:13  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-fetch.c, cmd-search.c, cmd-store.c: Sync EXPUNGEs
	  also with UID FETCH and UID STORE.

2003-02-21 14:28  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: cork the output before sending the ending
	  IDLE replies.

2003-02-21 14:25  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: if connection was closed while trying to
	  write data to client, we sometimes crashed. also errno wasn't
	  saved.

2003-02-21 13:02  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/mail-process.c,
	  src/master/main.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added setting
	  mail_drop_priv_before_exec.

2003-02-21 13:01  Timo Sirainen <tss@iki.fi>

	* src/lib/: env-util.c, env-util.h, restrict-access.c,
	  restrict-access.h: Added env_remove() and
	  restrict_access_clear_env().

2003-02-20 21:43  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: handle error condition better

2003-02-20 19:57  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: fixes

2003-02-20 16:41  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/cmd-list.c,
	  src/lib-imap/imap-match.c, src/lib-storage/mail-storage.c,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/mbox/mbox-list.c: Removed list-sort
	  workarounds. It's pretty much needed for maildir listing.  Also
	  added some more complexity and kludging to make everything work
	  correctly.

2003-02-20 16:40  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: passwd-file changes. Moved flags
	  before MAIL environment which is now last so it allows ':'
	  characters in it..

2003-02-20 16:30  Timo Sirainen <tss@iki.fi>

	* src/lib/: strescape.c, strescape.h: str_unescape(): return char*

2003-02-20 15:48  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: error handling fixes

2003-02-20 15:04  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/auth.txt, doc/configuration.txt:
	  updates

2003-02-20 10:52  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-idle.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: outlook-idle workaround
	  fixes.

2003-02-20 00:46  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/client.c, src/imap/client.h,
	  src/imap/cmd-close.c, src/imap/cmd-idle.c, src/imap/cmd-select.c,
	  src/imap/cmd-unselect.c, src/imap/commands-util.c,
	  src/imap/commands-util.h, src/imap/common.h,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h:
	  workaround: outlook-idle

2003-02-20 00:01  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2003-02-19 23:55  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, passdb-ldap.c, userdb-ldap.c:
	  minor ldap fixes

2003-02-19 23:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, maildir/maildir-save.c,
	  mbox/mbox-save.c: mbox: strip some headers when saving message.
	  also always set Content-Length header so message may safely
	  contain lines beginning with "From ".

2003-02-19 23:35  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: ostream: get initial offset. flush buffer
	  before seeking.

2003-02-19 21:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-copy.c, maildir-save.c,
	  maildir-storage.h: Include microseconds in maildir filename base.

2003-02-19 21:31  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: sendfile bugfix

2003-02-19 21:24  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: Check gettimeofday() failures

2003-02-19 20:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: comment update

2003-02-19 20:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: Assume \Marked if
	  new/ has been modified later than cur/

2003-02-19 20:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: We don't really
	  need the cur, new and tmp symlinks in .INBOX/ dir. Also don't
	  even try to support renaming INBOX since we can't make it atomic.

2003-02-19 20:01  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: mail_read_mmaped = no works now with mbox

2003-02-19 19:55  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/cmd-list.c,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.h,
	  src/lib-storage/subscription-file/subscription-file.c,
	  src/lib-storage/subscription-file/subscription-file.h,
	  src/lib-imap/imap-match.c, src/lib-imap/imap-match.h: Rewrote
	  LIST, LSUB and subscription file handling. LIST replies aren't
	  sorted anymore by default, it can be enabled with
	  client_workarounds = list-sort.

2003-02-19 19:50  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-mmap.c, istream.h, ostream-file.c, ostream.h:
	  o_stream_send_istream() is now safe to use for moving data within
	  file.

2003-02-19 11:47  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf: notes about userPassword

2003-02-19 11:28  Timo Sirainen <tss@iki.fi>

	* src/auth/: Makefile.am, password-scheme.c: crypt-password
	  checking was broken. added support for md5crypt passwords.

2003-02-18 20:58  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: fix

2003-02-18 20:50  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: Use getlogin() alternatively if USER environment
	  isn't found.

2003-02-18 19:24  Timo Sirainen <tss@iki.fi>

	* src/auth/: Makefile.am, mech-digest-md5.c, passdb-ldap.c,
	  passdb-passwd-file.c, passdb.c, password-scheme.c,
	  password-scheme.h: Fix realm usage with DIGEST-MD5. Support
	  generating other password schemes out of plaintext passwords.

2003-02-18 19:11  Timo Sirainen <tss@iki.fi>

	* src/auth/Makefile.am, src/auth/db-ldap.c, src/auth/db-ldap.h,
	  src/auth/db-passwd-file.c, src/auth/db-passwd-file.h,
	  src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	  src/auth/mech.c, src/auth/mech.h, src/auth/passdb-ldap.c,
	  src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c,
	  src/auth/passdb-passwd.c, src/auth/passdb-shadow.c,
	  src/auth/passdb-vpopmail.c, src/auth/passdb.c, src/auth/passdb.h,
	  src/auth/userdb-ldap.c, src/auth/userdb-passwd-file.c,
	  src/auth/userdb-passwd.c, src/auth/userdb-static.c,
	  src/auth/userdb-vpopmail.c, src/auth/userdb-vpopmail.h,
	  src/auth/userdb.h, doc/dovecot-ldap.conf: Added
	  default_pass_scheme to LDAP. Support for more password schemes.
	  Merged password checking code with LDAP and passwd-file, so both
	  support the same schemes now.

2003-02-18 19:09  Timo Sirainen <tss@iki.fi>

	* INSTALL: s/ldap/vpopmail/ in vpopmail.so example

2003-02-18 17:18  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, passdb-ldap.c, userdb-ldap.c:
	  Escape special chars in username if needed.

2003-02-18 11:44  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-delete.c: Don't allow deleting selected mailbox.

2003-02-18 11:09  Timo Sirainen <tss@iki.fi>

	* doc/Makefile.am: missing dovecot-ldap.conf

2003-02-17 20:45  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Do tmp -> new using
	  link() + unlink(). Use "new" way for unique filename generation.

2003-02-17 19:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Check for
	  ENOTEMPTY too for rename() failures.

2003-02-17 16:40  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Remove the mailbox globbing code from here.
	  It should have been done already by mail_storage. Also show
	  parent mailboxes before children, not after. (Patch by Peter
	  Kaas)

2003-02-17 14:57  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, passdb-ldap.c, userdb-ldap.c: Handle LDAP
	  failures better.

2003-02-17 13:38  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Rather than block for two seconds, we can
	  just call ldap_result() again if it returns 0..

2003-02-14 15:23  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment update

2003-02-14 14:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.h: oe6 workaround enum was 0 which
	  didn't really work..

2003-02-14 13:15  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2003-02-14 13:15  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: IDLE setting.

2003-02-14 12:56  Timo Sirainen <tss@iki.fi>

	* src/lib/: file-dotlock.c, file-dotlock.h: Don't even try to
	  override mbox dotlock if we can't get fcntl/flock.

2003-02-14 10:58  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Allow '\' character too in atoms,
	  they're used in flags..

2003-02-14 10:53  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: check cmsg_level too

2003-02-14 10:51  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: fd_read(): make sure it's SCM_RIGHTS that was
	  transferred so that login process couldn't fool us to use some of
	  our existing fds.

2003-02-14 10:46  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/client.c,
	  src/imap/client.h, src/imap/cmd-idle.c, src/imap/cmd-select.c,
	  src/imap/commands.c, src/imap/commands.h, src/imap/common.h,
	  src/imap/main.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-mailbox-check.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/index-sync.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Support for IDLE extension.

2003-02-14 10:45  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: Don't inline timeout_update_next(). gcc 3.2.2
	  with -O2 seems to break it.

2003-02-14 09:08  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: show proper error message to 8bit
	  chars

2003-02-14 09:06  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Allow wildcards anyway in atoms,
	  they're needed with LIST.

2003-02-14 08:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/client.c, src/imap/client.h,
	  src/imap/cmd-append.c, src/imap/cmd-select.c,
	  src/imap/cmd-store.c, src/imap/commands-util.c,
	  src/imap/commands-util.h, src/imap/common.h,
	  src/imap/mail-storage-callbacks.c, src/imap/main.c,
	  src/master/mail-process.c, src/master/master-settings.c,
	  src/master/master-settings.h: Added setting to limit length of
	  custom flag names.

2003-02-14 08:00  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Complain if atoms contain invalid
	  characters.

2003-02-13 21:07  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-quote.c: Quoting didn't remove CR and LF
	  characters, so it could have caused corrupted ENVELOPE/BODY
	  replies.

2003-02-13 08:10  Timo Sirainen <tss@iki.fi>

	* src/lib/sendfile-util.c: Solaris 9 seems to kernel panic if
	  sendfilev() is used with non-socket.

2003-02-13 07:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: typofix

2003-02-12 18:22  Timo Sirainen <tss@iki.fi>

	* src/imap/commands-util.c: more full_filesyste_access fixes
	  (forgot to commit)

2003-02-12 18:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-list.c,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Several fixes to
	  mail_full_filesystem_access = yes handling

2003-02-12 12:07  Timo Sirainen <tss@iki.fi>

	* src/: lib/Makefile.am, lib/file-dotlock.c, lib/file-dotlock.h,
	  lib/file-lock.c, lib/unlink-lockfiles.c, lib-index/mail-index.h,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h: Locking code cleanups and
	  small fixes

2003-02-11 21:04  Timo Sirainen <tss@iki.fi>

	* INSTALL: wordwrapping..

2003-02-11 21:04  Timo Sirainen <tss@iki.fi>

	* INSTALL: -fPIC too

2003-02-11 20:38  Timo Sirainen <tss@iki.fi>

	* INSTALL: updated

2003-02-11 20:25  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb.c: fix

2003-02-11 20:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.c: ..and it went wrong..

2003-02-11 20:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.c: Ignore empty workarounds

2003-02-11 20:08  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: We shouldn't check umask() return
	  value.

2003-02-11 19:46  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: And pass the
	  mail_full_filesystem_access setting to IMAP process too..

2003-02-11 19:37  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib/Makefile.am, src/lib/home-expand.c,
	  src/lib/home-expand.h, src/lib-storage/mail-storage.c,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  mail_full_filesystem_access setting. Some of the setting variable
	  types were declared wrong and caused Dovecot to crash if they
	  were set in config file.

2003-02-11 18:01  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/auth/auth-module.c,
	  src/auth/auth-module.h, src/auth/passdb.c, src/auth/userdb.c:
	  Support for dynamic authentication modules.

2003-02-11 17:42  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-vpopmail.c: compile fix

2003-02-11 16:56  Timo Sirainen <tss@iki.fi>

	* src/: pop3-login/client.c, pop3-login/client.h,
	  imap-login/client.c, imap-login/client.h: Make sure calling
	  client_destroy() multiple times doesn't break anything.

2003-02-11 16:53  Timo Sirainen <tss@iki.fi>

	* src/login-common/master.c: Die cleanly when master tells us so.

2003-02-11 16:37  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-mmap.c, ostream-file.c, sendfile-util.c,
	  sendfile-util.h: Bugfixes to handling >2GB files.

2003-02-11 14:32  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Creating more than one auth process
	  per group didn't really work.

2003-02-11 14:06  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h: Use the same LDAP connection for
	  both userdb and passdb if config_path is the same.

2003-02-11 13:13  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: updated

2003-02-11 12:53  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/db-ldap.c, src/auth/db-ldap.h,
	  src/auth/userdb-ldap.c: Added user_global_uid and user_global_gid
	  LDAP settings.

2003-02-11 12:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: get_size() was buggy

2003-02-11 12:31  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-quote.c: Literals sizes were sometimes set to
	  2^32-1.

2003-02-11 10:30  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/cmd-fetch.c, src/imap/main.c,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-fetch.c, src/master/mail-process.c,
	  src/master/master-settings.c, src/master/master-settings.h: Added
	  client_workarounds setting, with currently one workaround for
	  OE6.

2003-02-11 10:12  Timo Sirainen <tss@iki.fi>

	* doc/dovecot-ldap.conf: Added example config file.

2003-02-11 10:11  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, passdb-ldap.c, userdb-ldap.c:
	  Separate user and pass attrs/filters in config file

2003-02-11 09:55  Timo Sirainen <tss@iki.fi>

	* src/auth/: Makefile.am, db-ldap.c, db-ldap.h, passdb-ldap.c,
	  passdb.c, passdb.h, userdb-ldap.c: passdb ldap added. fixes to
	  userdb ldap.

2003-02-10 07:56  Timo Sirainen <tss@iki.fi>

	* src/login-common/main.c: Don't accept client connections before
	  we're connected to all auth processes.

2003-02-10 07:38  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: i_error, not i_panic..

2003-02-10 07:30  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Auth process communication was a bit
	  broken

2003-02-09 17:23  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: More realm fixes

2003-02-09 17:10  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-plain.c: usernames with '@' char were supposed to
	  be treated as user@realm, but that was a bit buggy

2003-02-08 18:58  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: DEBUG: we cleared wrong memory
	  block..

2003-02-08 17:13  Timo Sirainen <tss@iki.fi>

	* src/auth/: common.h, main.c: Moved login process verbose stuff
	  under verbose_debug.

2003-02-08 15:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/login-common/main.c,
	  src/master/auth-process.c, src/master/mail-process.c,
	  src/master/main.c, src/master/master-login-interface.h:
	  /dev/stderr works now in log paths.

2003-02-08 15:30  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Don't check log dir permission if
	  the log file already exists

2003-02-08 15:14  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: And remove the flock default from
	  here too..

2003-02-08 15:00  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: OpenPAM uses const too.

2003-02-08 14:16  Timo Sirainen <tss@iki.fi>

	* src/login-common/master.c: Show the fd we're sending to master if
	  fd_send() fails.

2003-02-08 14:13  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Don't start those login processes
	  that aren't enabled in protocols setting.

2003-02-08 14:09  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, login-common/ssl-proxy-gnutls.c,
	  login-common/ssl-proxy-openssl.c, pop3-login/client.c: STARTTLS
	  handshake failure fixes.

2003-02-08 13:53  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream-file.c: Don't bother trying sendfile() more than
	  once with the stream.

2003-02-08 13:52  Timo Sirainen <tss@iki.fi>

	* src/lib/sendfile-util.c: FreeBSD's sendfile() works only with
	  sockets. Replace errno with EINVAL to make it look like sendfile
	  isn't supported.

2003-02-08 13:43  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Don't use flock() locking by default. Using
	  both fcntl+flock doesn't work with FreeBSD.

2003-02-08 13:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Autodetect
	  /var/mail/%u and /var/spool/mail/%u INBOXes.

2003-02-08 12:56  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: DEBUG: fill memory with 0xde before
	  freeing it

2003-02-08 12:38  Timo Sirainen <tss@iki.fi>

	* src/lib/istream-file.c: use the file size only for regular files.
	  FreeBSD gave sockets a size of 4 which broke things.

2003-02-08 10:44  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-bodystructure.c, imap-envelope.c,
	  imap-parser.c, imap-parser.h, imap-quote.c, imap-quote.h: Don't
	  do x-unknown mime encoding. Correct way is to just send them as
	  literals to client. ENVELOPE, BODY and BODYSTRUCTURE replies are
	  now always sent as literals if they contain 8bit text, '"' or '\'
	  characters.

	  Added option to IMAP parser to return literals with
	  IMAP_ARG_LITERAL type.

2003-02-08 09:31  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: cleanups

2003-02-08 09:11  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Have to check that msg_controllen is large
	  enough, otherwise cmsg points to uninitialized buffer (at least
	  with freebsd).

2003-02-08 09:00  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-process-size.c: Don't try to set rlimits to
	  infinity, rather just don't change them.

2003-02-08 08:07  Timo Sirainen <tss@iki.fi>

	* src/login-common/master.c: Some extra checks to make sure we
	  notice if auth process ID is 0.

2003-02-08 07:48  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c: Variable type changes,
	  fixes compiler warning.

2003-02-08 07:42  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Don't skip trailing whitespace, it
	  might be wanted (eg. log_timestamp).

2003-02-08 07:40  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: [ipv6 address] didn't work in *_listen

2003-02-08 06:33  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/quoted-printable.c: We handled '=' at end of line
	  wrong.

2003-02-06 02:31  Timo Sirainen <tss@iki.fi>

	* src/lib/fd-close-on-exec.c: Print also the fd number if it fails.

2003-02-04 07:04  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Don't complain about missing
	  *-login binaries if they're not enabled.

2003-02-04 03:49  Timo Sirainen <tss@iki.fi>

	* configure.in: Building in separate directory didn't work

2003-02-04 03:25  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/Makefile.am, pop3-login/Makefile.am: Missing
	  headers

2003-02-04 03:24  Timo Sirainen <tss@iki.fi>

	* src/auth/Makefile.am: missing db-ldap.h

2003-02-04 03:24  Timo Sirainen <tss@iki.fi>

	* src/auth/userdb-ldap.c: cleanups

2003-02-04 00:34  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-shadow.c: s/PASSDB_PASSWD/PASSWD_SHADOW/

2003-02-03 05:17  Timo Sirainen <tss@iki.fi>

	* configure.in: Check for shadow.h before assuming shadow auth is
	  possible.

2003-02-03 05:11  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-status.c: STATUS cleared \Recent flags from messages

2003-02-03 05:01  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, pop3/main.c: We don't need to raise SIGHUP in
	  alarm handler, that was just a mistake in first tests. That also
	  means gdb won't break at SIGALRM and I can remove the
	  DISABLE_ALARMHUP kludge.

2003-02-02 10:59  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Define OPENLDAP_ASYNC_WORKAROUND

2003-02-02 10:53  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: Send protocol with auth
	  requests

2003-02-02 10:46  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client-authenticate.c, imap-login/client.c,
	  imap-login/client.h, login-common/Makefile.am,
	  login-common/client-common.h, pop3-login/client-authenticate.c,
	  pop3-login/client.c, pop3-login/client.h: Moved more auth code to
	  login-common.

2003-02-02 10:16  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-digest-md5.c, auth/mech-plain.c, auth/mech.c,
	  auth/mech.h, imap-login/client-authenticate.c,
	  imap-login/client.c, pop3-login/client.c: auth: kill login
	  connection if it leaves requests hanging too long.

2003-02-02 09:30  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech-digest-md5.c, mech-plain.c, mech.c: fixes

2003-02-02 07:10  Timo Sirainen <tss@iki.fi>

	* src/: imap-login/client.c, pop3-login/client.c: STARTTLS commands
	  crashed. imap-login STARTTLS also ignored next command.

2003-02-02 00:32  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: finally working

2003-02-02 00:21  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: maybe now?

2003-02-02 00:19  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech-digest-md5.c, mech-plain.c, mech.c, mech.h: more
	  fixes

2003-02-02 00:08  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h, mech-digest-md5.c, mech-plain.c,
	  mech.c, mech.h, passdb-pam.c, passdb-passwd-file.c,
	  passdb-passwd.c, passdb-shadow.c, passdb-vpopmail.c, passdb.h,
	  userdb-ldap.c, userdb.c, userdb.h: auth process fixes, LDAP seems
	  to be working (with the kludge define or fixed libldap)

2003-02-01 11:54  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: um. still not.

2003-02-01 11:53  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Changing login_dir or login_chroot
	  wasn't possible

2003-02-01 11:44  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-sort.c: Message size was returned with wrong type

2003-02-01 11:44  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: Don't crash if we couldn't open message.

2003-02-01 11:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Fixes to SEARCH SENT*

2003-02-01 11:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-search.c, mail-search.h,
	  index/index-search.c: Several search fixes, mostly related to
	  matching multiple conditions.

2003-02-01 10:29  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Giving >7 args to imap command was
	  buggy

2003-02-01 10:16  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: wrong debug check

2003-02-01 10:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: SEARCH NOT didn't work

2003-02-01 02:06  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/ioloop-poll.c,
	  src/lib/restrict-process-size.c, src/lib/restrict-process-size.h,
	  src/master/auth-process.c, src/master/login-process.c,
	  src/master/mail-process.c: Don't let login process fork()

2003-01-31 06:58  Timo Sirainen <tss@iki.fi>

	* src/Makefile.am: lib-settings was missing

2003-01-31 06:57  Timo Sirainen <tss@iki.fi>

	* src/: lib-settings/settings.c, lib-settings/settings.h,
	  master/master-settings.c: updates

2003-01-31 06:56  Timo Sirainen <tss@iki.fi>

	* src/auth/: .cvsignore, Makefile.am, db-ldap.c, db-ldap.h,
	  db-passwd-file.c, db-passwd-file.h, main.c, mech.c,
	  passdb-passwd-file.c, passdb.c, userdb-ldap.c,
	  userdb-passwd-file.c, userdb-passwd.c, userdb-static.c, userdb.c,
	  userdb.h: Cleanups, LDAP support compiles again and generally
	  looks ok, even if it doesn't necessarily work :) Works now with
	  new master config.

2003-01-31 06:11  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Handle boundary=""

2003-01-31 05:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-list.c, mbox/mbox-list.c:
	  If there's multiple mailboxes named "inbox", ignore them at least
	  for now (eg. /var/mail/inbox, ~/mail/inbox).

2003-01-30 19:52  Timo Sirainen <tss@iki.fi>

	* src/: pop3/Makefile.am, pop3/capability.h, pop3/client.c,
	  pop3/commands.c, pop3-login/client-authenticate.c,
	  pop3-login/client-authenticate.h, pop3-login/client.c: Support
	  for CAPA command (rfc2449).

2003-01-30 19:01  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-settings/.cvsignore,
	  src/lib-settings/Makefile.am, src/lib-settings/settings.c,
	  src/lib-settings/settings.h, src/master/Makefile.am,
	  src/master/common.h, src/master/main.c,
	  src/master/master-settings.c, src/master/master-settings.h: Moved
	  settings parsing to lib-settings.

2003-01-30 18:27  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am: libldap checks, --without-pop3
	  disables pop3 server

2003-01-30 18:05  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, commands.c, commands.h: Disconnect after too
	  many bad commands. We also crashed if there were no mails in
	  mailbox.

2003-01-30 17:59  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/.cvsignore,
	  src/master/Makefile.am, src/master/auth-process.c,
	  src/imap/main.c, src/login-common/main.c, src/master/common.h,
	  src/master/login-process.c, src/master/mail-process.c,
	  src/master/mail-process.h, src/master/main.c,
	  src/master/master-login-interface.h, src/master/ssl-init.c:
	  Rewrote setting handling. Changed some existing settings also
	  since POP3 support required changes anyway. POP3 seems to be
	  really working now :)

2003-01-30 17:56  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/: client-authenticate.c, client.c: compile fix +
	  complain about unknown commands

2003-01-30 17:55  Timo Sirainen <tss@iki.fi>

	* src/pop3/client.c: Reduce input buffer size

2003-01-30 17:51  Timo Sirainen <tss@iki.fi>

	* src/lib/macros.h: Removed STRUCT_OFFSET, offsetof() is ANSI-C for
	  the same purpose. Added MEMBER() macro to define C99-style struct
	  labels.

2003-01-30 17:50  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: bugfixes

2003-01-28 21:35  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/imap-login/.cvsignore,
	  src/imap-login/Makefile.am, src/imap-login/client-authenticate.c,
	  src/imap-login/client-authenticate.h, src/imap-login/client.c,
	  src/imap-login/client.h, src/login-common/.cvsignore,
	  src/login-common/Makefile.am, src/login-common/client-common.h,
	  src/login-common/common.h, src/login-common/main.c,
	  src/login-common/master.c, src/login-common/master.h,
	  src/login-common/ssl-proxy-gnutls.c,
	  src/login-common/ssl-proxy-openssl.c,
	  src/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h,
	  src/pop3-login/.cvsignore, src/pop3-login/Makefile.am,
	  src/pop3-login/client-authenticate.c,
	  src/pop3-login/client-authenticate.h, src/pop3-login/client.c,
	  src/pop3-login/client.h: Moved common login process code to
	  login-common, created pop3-login.

2003-01-28 19:32  Timo Sirainen <tss@iki.fi>

	* src/lib/macros.h: No i_memmove here, just memmove.

2003-01-27 08:08  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech-digest-md5.c, mech-plain.c, mech.c, mech.h,
	  passdb-pam.c, passdb-passwd-file.c, passdb-passwd.c,
	  passdb-shadow.c, passdb-vpopmail.c, passdb.h,
	  userdb-passwd-file.c, userdb-passwd.c, userdb-static.c,
	  userdb-vpopmail.c, userdb.h: Async userdb and passdb interface.

2003-01-27 07:01  Timo Sirainen <tss@iki.fi>

	* src/pop3/commands.c: Fixes, seems to be working now. Only thing
	  left is the pop3-login..

2003-01-27 06:44  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, client.h, commands.c: Read the sizes of all
	  messages to memory at startup. More failsafe and faster.

2003-01-27 05:45  Timo Sirainen <tss@iki.fi>

	* configure.in, src/pop3/.cvsignore, src/pop3/Makefile.am,
	  src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c,
	  src/pop3/commands.h, src/pop3/common.h,
	  src/pop3/mail-storage-callbacks.c, src/pop3/main.c: Initial code
	  for POP3 server. RETR isn't working right yet, there's some
	  syncing problems to figure out (pop3 wants to keep the mailbox
	  locked) and the whole pop3-login process is still missing.

2003-01-27 05:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c: Allow update_seen to be NULL

2003-01-27 04:23  Timo Sirainen <tss@iki.fi>

	* src/imap/: client.h, cmd-append.c, commands-util.c,
	  commands-util.h, commands.h, imap-search.c, imap-sort.c,
	  imap-thread.c, mail-storage-callbacks.c, main.c: some header file
	  cleanups

2003-01-27 02:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/auth-process.c: Authentication
	  named socket permissions were insecure, an exploited login
	  process could have replaced it with it's own and began reading
	  plaintext passwords sent by other login processes.

2003-01-27 02:05  Timo Sirainen <tss@iki.fi>

	* src/: auth/mech-plain.c, imap/imap-sort.h,
	  lib-storage/index/index-mail.c,
	  lib-storage/index/mbox/mbox-save.c, master/login-process.c:
	  signed/unsigned/const pointer fixes

2003-01-27 01:59  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.h, imap/commands.c, imap/commands.h,
	  imap/imap-sort.c, imap/imap-thread.c, lib/failures.c,
	  lib/failures.h, lib/hash.c, lib/hash.h, lib-index/mail-index.h,
	  lib-mail/message-content-parser.c,
	  lib-mail/message-content-parser.h,
	  lib-mail/message-header-decode.c,
	  lib-mail/message-header-decode.h, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/subscription-file/subscription-file.c,
	  lib-storage/subscription-file/subscription-file.h: Function
	  typedefs now define them as functions, not function pointers.

2003-01-27 01:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/Makefile.am: missing index-mail.h

2003-01-27 01:44  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, imap/client.c, lib/ioloop-internal.h,
	  lib/ioloop-poll.c, lib/ioloop-select.c, lib/ioloop.c,
	  lib/ioloop.h, lib/ostream-file.c,
	  lib-storage/index/index-mailbox-check.c, master/auth-process.c,
	  master/login-process.c, master/main.c, master/ssl-init.c: Removed
	  useless parameters from io_callback_t and timeout_callback_t.

2003-01-27 01:33  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/Makefile.am,
	  src/auth/auth-master-interface.h, src/auth/auth.c,
	  src/auth/auth.h, src/auth/common.h, src/auth/main.c,
	  src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	  src/auth/mech.c, src/auth/mech.h, src/auth/passdb-pam.c,
	  src/auth/passdb-passwd-file.c, src/auth/passdb-passwd.c,
	  src/auth/passdb-shadow.c, src/auth/passdb-vpopmail.c,
	  src/auth/passdb.c, src/auth/passdb.h,
	  src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c,
	  src/auth/userdb-static.c, src/auth/userdb-vpopmail.c,
	  src/auth/userdb-vpopmail.h, src/auth/userdb.c, src/auth/userdb.h,
	  src/imap/main.c, src/master/Makefile.am,
	  src/master/auth-process.c, src/master/auth-process.h,
	  src/master/common.h, src/master/login-process.c,
	  src/master/login-process.h, src/master/main.c,
	  src/master/master-login-interface.h: We have now separate
	  "userdb" and "passdb". They aren't tied to each others in any
	  way, so it's possible to use whatever user database with whatever
	  password database.

	  Added "static" userdb, which uses same uid/gid for everyone and
	  generates home directory from given template. This could be
	  useful with PAM, although insecure since everyone uses same uid.

	  Not too well tested, and userdb/passdb API still needs to be
	  changed to asynchronous for sql/ldap/etc lookups.

2003-01-27 01:27  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, var-expand.c, var-expand.h: Added
	  var_expand()

2003-01-27 00:46  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop.c, ioloop.h: Added io_loop_is_running()

2003-01-27 00:46  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: Allow calling t_push() before
	  data_stack_init().

2003-01-24 02:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-save.c, mbox/mbox-save.c:
	  Memory usage tweaks

2003-01-23 21:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c: Removed the OE workaround,
	  it still didn't work if the EXISTS/RECENT was sent after FETCH.

2003-01-23 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream.c, istream.h, ostream.c, ostream.h: More type
	  safety to i/o streams

2003-01-23 19:02  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-unselect.c: forgot to add

2003-01-23 03:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: When save is
	  aborted, remove the created temp files.

2003-01-23 03:28  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/client.h, imap/cmd-append.c,
	  imap/commands-util.c, lib-imap/imap-parser.c,
	  lib-imap/imap-parser.h: Disconnect client if given non-sync
	  literal size is too large. Better than eating the input.

2003-01-23 03:17  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/cmd-append.c, src/lib-imap/imap-parser.c,
	  src/lib-imap/imap-parser.h: Support for LITERAL+ extension.

2003-01-22 20:46  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/cmd-close.c,
	  src/imap/cmd-select.c, src/imap/commands-util.c,
	  src/imap/commands-util.h, src/imap/commands.c,
	  src/imap/commands.h: Added support for UNSELECT extension with
	  some cleanups for SELECT and CLOSE.

2003-01-22 20:25  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't print the result twice either..

2003-01-22 20:25  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't print checking sendfilev() message twice

2003-01-22 19:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: Modify log used to
	  test if there were other users for every changed flag or expunged
	  message, causing two fcntl() syscalls every time -> SLOW. Now we
	  check it only once after exclusively locking the index.

2003-01-22 19:23  Timo Sirainen <tss@iki.fi>

	* configure.in, doc/multiaccess.txt, src/imap/client.c,
	  src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/common.h,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.h: Support for
	  MULTIAPPEND extension. COPY now behaves like spec says - if it
	  fails, none of the messages are copied.
	  maildir_copy_with_hardlinks didn't actually work.

2003-01-22 18:41  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Externally parsed literal size always
	  stops argument parsing now. Input stream is now skipped when
	  returning success/failure, so the stream can be used for other
	  purposes too.

2003-01-22 18:38  Timo Sirainen <tss@iki.fi>

	* src/lib/iostream.c: i/o streams unreffed their pool, but never
	  referenced it. this didn't matter so far since we always used
	  system/data stack pools where refcounting didn't matter.

2003-01-21 21:51  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-sort.c: Give nice error message for "SORT ()"

2003-01-21 21:48  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-search.c: Don't crash with "SEARCH ()"

2003-01-21 21:43  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Missing ')' wasn't reported
	  correctly.

2003-01-21 21:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c: WORKAROUND: Outlook (Express
	  6) fails with to read FETCH BODY[] if we send EXISTS/RECENT
	  before it

2003-01-21 19:56  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-mail.h: FETCH
	  ENVELOPE failed if it wasn't already cached.

2003-01-21 18:50  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-fetch.c: UID FETCH didn't return the UID.

2003-01-21 18:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: mboxes in subfolders
	  weren't selectable.

2003-01-21 11:24  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-store.c: STORE accepts now multiple flags without
	  requiring them being inside ().

2003-01-21 11:20  Timo Sirainen <tss@iki.fi>

	* src/imap/commands-util.c: store/append crashed if no custom flags
	  were being set (ie. almost always)

2003-01-21 11:17  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: imap-login: disconnect when received 10
	  invalid commands. imap: disconnect when received 20 invalid
	  commands in a row - every successful command resets the counter
	  now.

2003-01-21 07:58  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, common.h, login-process.c, main.c:
	  If auth/login process died unexpectedly, the exit status or
	  killing signal wasn't logged.

2003-01-21 07:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added auth_verbose

2003-01-21 07:40  Timo Sirainen <tss@iki.fi>

	* src/: auth/common.h, auth/main.c, master/auth-process.c:
	  auth_verbose = yes logs now all authentication failures and some
	  other stuff.

2003-01-21 06:50  Timo Sirainen <tss@iki.fi>

	* doc/configuration.txt: updated memory usage counts

2003-01-21 06:46  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: Now it actually leaked memory..

2003-01-21 06:45  Timo Sirainen <tss@iki.fi>

	* src/lib/: str.c, str.h: Added str_free()

2003-01-21 06:42  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-fetch.c: FETCH ate too much memory

2003-01-21 06:05  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: null_strcmp() was broken -> SORT was broken.

2003-01-21 05:37  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.h, imap/cmd-select.c, imap/imap-fetch.c,
	  imap/imap-fetch.h, lib-mail/message-send.c,
	  lib-mail/message-send.h: Partial fetches are working fast again -
	  faster than ever actually.

2003-01-21 05:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail.c, index-mail.h: Forgot to add

2003-01-20 14:52  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, imap/cmd-append.c, imap/cmd-fetch.c,
	  imap/cmd-search.c, imap/cmd-sort.c, imap/cmd-store.c,
	  imap/cmd-thread.c, imap/commands-util.c, imap/commands-util.h,
	  imap/imap-fetch.c, imap/imap-fetch.h, imap/imap-search.c,
	  imap/imap-search.h, imap/imap-sort.c, imap/imap-sort.h,
	  imap/imap-thread.c, imap/imap-thread.h, lib/strfuncs.c,
	  lib/strfuncs.h, lib-imap/Makefile.am, lib-imap/imap-envelope.c,
	  lib-mail/message-address.c, lib-mail/message-address.h,
	  lib-mail/message-body-search.c, lib-mail/message-body-search.h,
	  lib-mail/message-date.c, lib-mail/message-date.h,
	  lib-mail/message-parser.h, lib-mail/message-send.c,
	  lib-mail/message-send.h, lib-mail/message-size.h,
	  lib-storage/Makefile.am, lib-storage/mail-search.c,
	  lib-storage/mail-search.h, lib-storage/mail-storage.h,
	  lib-storage/index/Makefile.am, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-fetch.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h: mail-storage.h interface
	  changes, affects pretty much everything.  FETCH, SEARCH, SORT and
	  THREAD handling were pretty much moved from lib-storage/ to imap/
	  so adding non-index storages would be much easier now.  Also POP3
	  server can now be easily implemented with lib-storage.

	  Not too well tested, and at least one major problem: partial
	  fetching is _slow_.

2003-01-20 13:56  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment updates

2003-01-20 13:54  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.h: comment update

2003-01-20 13:54  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-base-subject.c: Strip CR and LF characters too.

2003-01-20 01:59  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-date.c: imap_parse_date() returned a bit wrong
	  time: mktime() already builds the local date into UTC timestamp,
	  so we don't need to change it again.

2003-01-15 22:08  Timo Sirainen <tss@iki.fi>

	* configure.in: If Solaris sendfilev() is found, don't try checking
	  for Linux one. Linux check some reason passes with
	  sendfile-enabled Solaris..

2003-01-14 21:48  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: comment update

2003-01-14 21:48  Timo Sirainen <tss@iki.fi>

	* doc/configuration.txt: updated

2003-01-14 20:59  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/sendfile-util.c: Support for Solaris
	  sendfilev(). Entirely untested, hope it works.

2003-01-14 13:26  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 0.99.7 out

2003-01-14 12:09  Timo Sirainen <tss@iki.fi>

	* src/lib/hash.c: Still more fixes

2003-01-14 11:41  Timo Sirainen <tss@iki.fi>

	* src/lib/hash.c: Removed the collision table, it was a bad idea
	  and was buggy when nodes were removed.

2003-01-14 02:03  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: Don't check for dropped root gid
	  privileges if our uid is still root.

2003-01-14 01:49  Timo Sirainen <tss@iki.fi>

	* doc/index.txt: updated

2003-01-14 01:45  Timo Sirainen <tss@iki.fi>

	* doc/: design.txt, index.txt, multiaccess.txt: updates

2003-01-13 21:49  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 0.99.6 out

2003-01-13 21:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: SEARCH didn't properly
	  complain about invalid messagesets. high:low never worked (it was
	  recently changed for other commands). "*" in UID set didn't
	  actually match for last uid, but last sequence number..

2003-01-13 20:56  Timo Sirainen <tss@iki.fi>

	* src/lib-charset/charset-utf8.c: Didn't compile without iconv.

2003-01-13 20:01  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-base-subject.c: Blobs weren't removed
	  correctly, resulting in incorrect SORT SUBJECT and THREAD
	  results.

2003-01-13 20:00  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-date.c: Handle one-digit hour in dates.

2003-01-13 20:00  Timo Sirainen <tss@iki.fi>

	* src/lib/hash.c: hash_resize() leaked memory, hash_insert/update
	  didn't update value for existing nodes.

2003-01-11 23:49  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c: minor optimization

2003-01-11 23:13  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-part-serialize.c,
	  message-part-serialize.h: Do some more sanity checking when
	  updating cached message_part. If anything fails, log the error
	  and set index corrupted.

2003-01-11 19:55  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth.c, auth/auth.h, imap/client.c, imap/client.h,
	  imap/cmd-list.c, imap/commands.c, imap/commands.h,
	  lib/failures.c, lib/failures.h, lib/file-lock.c, lib/file-lock.h,
	  lib/hash.c, lib/hash.h, lib/ioloop-internal.h, lib/ioloop-poll.c,
	  lib/ioloop-select.c, lib/ioloop.c, lib/ioloop.h,
	  lib/iostream-internal.h, lib/iostream.c, lib/istream-data.c,
	  lib/istream-file.c, lib/istream-mmap.c, lib/istream.c,
	  lib/istream.h, lib/ostream-file.c, lib/ostream.c, lib/ostream.h,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-mail/message-content-parser.c,
	  lib-mail/message-content-parser.h,
	  lib-mail/message-header-decode.c,
	  lib-mail/message-header-decode.h, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-storage/mail-search.c,
	  lib-storage/mail-search.h, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-storage.h,
	  lib-storage/subscription-file/subscription-file.c,
	  lib-storage/subscription-file/subscription-file.h,
	  master/auth-process.c, master/auth-process.h, master/ssl-init.c:
	  Naming change for function typedefs.

2003-01-11 19:01  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/cmd-thread.c: We support only REFERENCES
	  threading for now - updated capability and trying to use
	  ORDEREDSUBJECT now gives error.

2003-01-11 18:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: SORT and THREAD didn't work
	  with sequence numbers at all. SEARCH was also a bit broken with
	  it if another session had deleted messages which we hadn't yet
	  told to client.

2003-01-11 17:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: SORT optimization. It now
	  uses memory to store one or two of the sort criteria items.
	  Should be "fast enough" now, sorting ~4000 messages doesn't take
	  hardly any time.

2003-01-11 17:42  Timo Sirainen <tss@iki.fi>

	* src/lib/: hash.c, hash.h: hash_clear() can now be used to drop
	  the memory allocated using node_pool.

2003-01-11 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: We don't actually need to reserve the
	  highest UID anymore, don't do it :)

2003-01-11 15:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: If ~/mail isn't found,
	  create it.

2003-01-11 15:37  Timo Sirainen <tss@iki.fi>

	* src/lib/hash.c: Few fixes

2003-01-11 15:29  Timo Sirainen <tss@iki.fi>

	* COPYING, src/lib/hash.c, src/lib/hash.h,
	  src/master/login-process.c, src/master/main.c: Rewrote hash table
	  code, works with less memory now. Also some memory allocation
	  fixes to thread extension code.

2003-01-11 15:09  Timo Sirainen <tss@iki.fi>

	* src/lib/: mempool-alloconly.c, mempool-datastack.c,
	  mempool-system.c, mempool.h: Added alloconly_pool field for
	  checking if pool supports free()

2003-01-10 21:31  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-system.c: compiling fix

2003-01-10 21:30  Timo Sirainen <tss@iki.fi>

	* src/lib/: hash.c, hash.h: whops, shouldn't have been committed.

2003-01-10 20:58  Timo Sirainen <tss@iki.fi>

	* src/: lib/buffer.c, lib/hash.c, lib/hash.h, lib/imem.c,
	  lib/imem.h, lib/ioloop-poll.c, lib/istream-file.c,
	  lib/mempool-alloconly.c, lib/mempool-datastack.c,
	  lib/mempool-system.c, lib/mempool.h, lib/ostream-file.c,
	  lib-imap/imap-parser.c: Added old_size parameter to p_realloc() -
	  we rarely need it and this way each allocation takes 8 bytes less
	  memory.

2003-01-10 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.c, index-storage.h,
	  index-sync.c: index_storage_sync_and_lock() didn't set lock
	  notify function.

2003-01-10 11:02  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-status.c: STATUS reply didn't quote the mailbox
	  name, which broke it if it contained spaces.

2003-01-10 00:30  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-date.c, lib-storage/index/index-search.c:
	  Even more rfc822 date timezone fixes

2003-01-09 22:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Fixes, seems to work
	  properly now. Much faster too.

2003-01-09 22:28  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-date.c: Timezones were still being parsed
	  wrong

2003-01-09 14:02  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-date.c: Timezone parsing was broken.

2003-01-09 12:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Make sure hdr->used_file_size isn't
	  too small.

2003-01-09 12:05  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Don't leak fds in case of errors.

2003-01-08 23:35  Timo Sirainen <tss@iki.fi>

	* src/lib/ostream.c: Remove one of the previous speedups, it broke
	  things

2003-01-08 21:24  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Write "Dovecot starting up" to log file.

2003-01-08 21:13  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, master/auth-process.c, master/login-process.c:
	  Auth and login processes send an "we're ok" reply at the end of
	  initialization. If the process dies before master receives that
	  reply, it shutdowns itself. Usually this is because of some
	  configuration error and it's not nice to start spamming the log
	  files.

2003-01-08 20:49  Timo Sirainen <tss@iki.fi>

	* AUTHORS, COPYING, src/imap/Makefile.am, src/imap/cmd-search.c,
	  src/imap/cmd-sort.c, src/imap/cmd-thread.c, src/imap/cmd-uid.c,
	  src/imap/commands.c, src/imap/commands.h,
	  src/lib-imap/imap-base-subject.c,
	  src/lib-imap/imap-base-subject.h, src/lib-storage/Makefile.am,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/index-storage.h: THREAD=REFERENCES
	  implementation. Doesn't crash, but I'm not sure how correct
	  replies it produces :)

2003-01-08 20:48  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: Reserve UID 2^31-1

2003-01-08 20:47  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.h: comment fix

2003-01-08 18:51  Timo Sirainen <tss@iki.fi>

	* src/lib/: ostream-file.c, ostream.c: Minor speed optimizations

2003-01-07 17:44  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-file.c, istream-internal.h, istream.c: Removed
	  cr_lookup_pos optimization with i_stream_next_line(). It breaks
	  if the stream is used with anything else and it's probably not
	  worth fixing.

2003-01-06 23:28  Timo Sirainen <tss@iki.fi>

	* src/auth/Makefile.am: missing auth-mech-desc.h

2003-01-06 20:13  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Still some fixes, I broke Solaris 8.

2003-01-06 18:54  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-part-serialize.c,
	  message-part-serialize.h: message_part_deserialize() now verifies
	  that the data is valid so we don't later crash to some assert.

2003-01-06 17:51  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: minor cleanup

2003-01-06 15:09  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Call login_process_abormal_exit() only if it
	  was login processes that died..

2003-01-06 11:34  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: fd_read() fixes, hopefully works better now.

2003-01-06 11:15  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.h: Use separate check for
	  uint_fast32_t.

2003-01-05 15:19  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/auth/auth.c,
	  src/auth/auth.h, src/master/auth-process.c: Initial support for
	  Cyrus SASL 2 library. I couldn't get it to work yet though :)

2003-01-05 13:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.h: "ISO C forbids forward references
	  to enum types"

2003-01-05 13:11  Timo Sirainen <tss@iki.fi>

	* doc/auth.txt: Updates to MD5 passwords.

2003-01-05 13:09  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/auth.c, src/auth/auth.h,
	  src/auth/common.h, src/auth/main.c, src/imap/client.c,
	  src/imap/client.h, src/imap/cmd-append.c,
	  src/imap/cmd-authenticate.c, src/imap/cmd-capability.c,
	  src/imap/cmd-check.c, src/imap/cmd-close.c, src/imap/cmd-copy.c,
	  src/imap/cmd-create.c, src/imap/cmd-delete.c,
	  src/imap/cmd-examine.c, src/imap/cmd-expunge.c,
	  src/imap/cmd-fetch.c, src/imap/cmd-list.c, src/imap/cmd-login.c,
	  src/imap/cmd-logout.c, src/imap/cmd-lsub.c, src/imap/cmd-noop.c,
	  src/imap/cmd-rename.c, src/imap/cmd-search.c,
	  src/imap/cmd-select.c, src/imap/cmd-sort.c,
	  src/imap/cmd-status.c, src/imap/cmd-store.c,
	  src/imap/cmd-subscribe.c, src/imap/cmd-uid.c,
	  src/imap/cmd-unsubscribe.c, src/imap/commands-util.c,
	  src/imap/commands-util.h, src/imap/commands.h, src/imap/common.h,
	  src/imap/mail-storage-callbacks.c, src/imap/main.c,
	  src/lib/base64.c, src/lib/base64.h, src/lib/buffer.c,
	  src/lib/buffer.h, src/lib/compat.h, src/lib/data-stack.c,
	  src/lib/env-util.c, src/lib/failures.h, src/lib/hash.c,
	  src/lib/hash.h, src/lib/hex-binary.c, src/lib/hex-binary.h,
	  src/lib/imem.c, src/lib/imem.h, src/lib/ioloop-internal.h,
	  src/lib/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	  src/lib/ioloop.h, src/lib/iostream-internal.h,
	  src/lib/iostream.c, src/lib/istream-data.c,
	  src/lib/istream-file.c, src/lib/istream-internal.h,
	  src/lib/istream-mmap.c, src/lib/istream.c, src/lib/istream.h,
	  src/lib/lib.h, src/lib/macros.h, src/lib/md5.c, src/lib/md5.h,
	  src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c,
	  src/lib/mempool-system.c, src/lib/mempool.h, src/lib/network.c,
	  src/lib/network.h, src/lib/ostream-file.c,
	  src/lib/ostream-internal.h, src/lib/ostream.c, src/lib/ostream.h,
	  src/lib/str.c, src/lib/str.h, src/lib/strescape.c,
	  src/lib/strescape.h, src/lib/strfuncs.c, src/lib/strfuncs.h,
	  src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c,
	  src/lib-charset/charset-utf8.h, src/lib-imap/imap-base-subject.c,
	  src/lib-imap/imap-base-subject.h,
	  src/lib-imap/imap-bodystructure.c,
	  src/lib-imap/imap-bodystructure.h, src/lib-imap/imap-envelope.c,
	  src/lib-imap/imap-envelope.h, src/lib-imap/imap-match.c,
	  src/lib-imap/imap-match.h, src/lib-imap/imap-parser.c,
	  src/lib-imap/imap-parser.h, src/lib-imap/imap-quote.c,
	  src/lib-imap/imap-quote.h, src/lib-imap/imap-util.c,
	  src/lib-imap/imap-util.h, src/lib-index/mail-index-fsck.c,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-mail/Makefile.am, src/lib-mail/message-address.c,
	  src/lib-mail/message-address.h,
	  src/lib-mail/message-body-search.c,
	  src/lib-mail/message-body-search.h,
	  src/lib-mail/message-content-parser.c,
	  src/lib-mail/message-date.c, src/lib-mail/message-date.h,
	  src/lib-mail/message-header-decode.c,
	  src/lib-mail/message-header-search.c,
	  src/lib-mail/message-header-search.h,
	  src/lib-mail/message-parser.c, src/lib-mail/message-parser.h,
	  src/lib-mail/message-part-serialize.c,
	  src/lib-mail/message-part-serialize.h,
	  src/lib-mail/message-send.c, src/lib-mail/message-send.h,
	  src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	  src/lib-mail/quoted-printable.c, src/lib-mail/quoted-printable.h,
	  src/lib-storage/mail-search.c, src/lib-storage/mail-search.h,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-fetch.h,
	  src/lib-storage/index/index-mailbox-check.c,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/index-status.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/index-sync.c,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.h,
	  src/lib-storage/subscription-file/subscription-file.c,
	  src/lib-storage/subscription-file/subscription-file.h,
	  src/master/auth-process.c, src/master/auth-process.h,
	  src/master/common.h, src/master/login-process.c,
	  src/master/main.c, src/master/ssl-init.c: Naming style changes,
	  finally got tired of most of the typedefs. Also the previous enum
	  -> macro change reverted so that we don't use the highest bit
	  anymore, that's incompatible with old indexes so they will be
	  rebuilt.

2003-01-04 17:46  Timo Sirainen <tss@iki.fi>

	* src/lib/macros.h: If PEDANTIC is defined, don't use (void)(..)
	  with STMT_START/END.

2003-01-04 17:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: Replaced
	  MailDataField from being enum to being unsigned int with values
	  defined with macros. Not that pretty, but enums are signed
	  integers and we want to use the highest bit without ugly kludges.

2003-01-04 17:34  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-poll.c, ioloop.c: Misc. compiler warning fixes.

2003-01-04 17:26  Timo Sirainen <tss@iki.fi>

	* src/: lib/imem.c, lib/imem.h, lib/istream-data.c, lib/istream.h,
	  lib/str.c, lib/str.h, lib/strescape.c, lib/strescape.h,
	  lib/strfuncs.c, lib/strfuncs.h, lib-charset/charset-iconv.c,
	  lib-charset/charset-utf8.c, lib-imap/imap-base-subject.c,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-envelope.c,
	  lib-imap/imap-envelope.h, lib-imap/imap-parser.c,
	  lib-imap/imap-quote.c, lib-imap/imap-quote.h,
	  lib-imap/imap-util.h, lib-mail/message-body-search.c,
	  lib-mail/message-content-parser.c,
	  lib-mail/message-content-parser.h,
	  lib-mail/message-header-search.c, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-storage/index/index-search.c: Use
	  unsigned char* when accessing non-NUL terminating strings.
	  Compiler warnings would then notify about accidentally passing
	  them to functions which require them NUL-terminated. Changed a
	  few functions to use void* to avoid unneeded casting.

2003-01-04 13:22  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-content-parser.c,
	  lib-imap/imap-bodystructure.c: Rfc822 tokenizer cleanups

2003-01-03 15:57  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, lib/Makefile.am, lib/strescape.c,
	  lib/strescape.h, lib/strfuncs.c, lib/strfuncs.h,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-parser.c,
	  lib-imap/imap-util.c, lib-imap/imap-util.h,
	  lib-mail/message-body-search.c,
	  lib-mail/message-content-parser.c,
	  lib-mail/message-content-parser.h,
	  lib-mail/message-header-search.c, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-storage/index/index-search.c:
	  Rewrote rfc822-tokenize.c to work one token at a time so it won't
	  uselessly take memory, maybe also a bit faster. This caused
	  pretty large changes all around.

	  Also moved all string (un)escaping code to lib/strescape.c.

2003-01-02 13:39  Timo Sirainen <tss@iki.fi>

	* src/lib/process-title.c: Include unistd.h for setproctitle(),
	  FreeBSD wants it.

2003-01-02 13:32  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Getting ready for 0.99.5 release..

2003-01-02 13:32  Timo Sirainen <tss@iki.fi>

	* README, TODO: updates

2003-01-02 13:05  Timo Sirainen <tss@iki.fi>

	* src/imap/commands-util.c: Handle the MAILBOX_NAME_NOINFERIORS
	  case.

2003-01-02 13:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: CREATE and RENAME
	  should create the folder hierarchy if needed. SELECTing a folder
	  gives now prettier error message.

2003-01-02 13:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.h: comment updates

2003-01-02 12:35  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-create.c: CREATE mailbox<hierarchy separator> failed
	  always.

2003-01-02 11:50  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Handle LIST A B same way as LIST "" A.B

2003-01-02 11:29  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: Make sure UIDs won't
	  wrap around unexpectedly.

2003-01-02 11:06  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-util.c: imap_escape() was broken

2003-01-02 10:21  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-close.c, imap/cmd-search.c, imap/commands-util.c,
	  lib-storage/mail-storage.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: Storage can now specify if
	  errors should be sent to user as BAD or NO.  Some changes to
	  messageset parsing as specified by latest IMAP4rev1 draft.  Bad
	  charset error is prefixed with [BADCHARSET]. Fixed a crash in
	  SEARCH the last commit in it caused.

2003-01-02 09:34  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Changed maildir_check_content_changes = yes
	  now to treat the message as new because IMAP protocol specifies
	  that existing messages are immutable.

2003-01-02 09:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: comment update

2003-01-02 09:06  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-envelope.c, lib-imap/imap-envelope.h,
	  lib-storage/index/index-search.c: SEARCHing headers with "" value
	  should always match if the header is found.  Changed
	  imap_envelope_parse() so that it's possible to differentiate NIL
	  from "".

2003-01-02 08:29  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-select.c: Added UIDNEXT reply to SELECT/EXAMINE, as
	  required by latest IMAP4rev1 draft.

2003-01-02 08:13  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.h: Actually, don't allow NIL with
	  IMAP_ARG_LIST().

2003-01-02 08:09  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-fetch.c, imap/cmd-search.c,
	  imap/cmd-sort.c, imap/cmd-status.c, imap/cmd-store.c,
	  imap/commands-util.c, lib-imap/imap-bodystructure.c,
	  lib-imap/imap-envelope.c, lib-imap/imap-parser.c,
	  lib-imap/imap-parser.h, lib-storage/mail-search.c: Don't access
	  ImapArg's union members directly - too easy to mess up. Fixes a
	  crash with feeding non-string parameters to SEARCH/SORT commands.

2002-12-29 19:44  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: If ssl_disable is set to yes and we
	  get SIGHUPed, don't feed the listening socket to login processes
	  anymore or they'll just keep dying. We still don't actually close
	  the socket though..

2002-12-29 19:34  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: extra assert.

2002-12-29 19:33  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: Use void* always with munmap()

2002-12-29 19:25  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added base_dir setting, so the configure
	  time --localstatedir can be overridden.

2002-12-28 19:57  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: more fixes

2002-12-28 19:20  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Fixed to work with 64bit BSD systems.

2002-12-28 09:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: Complain about missing
	  mbox file.

2002-12-28 09:04  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Forgot to handle FATAL_LOGERROR.

2002-12-28 08:06  Timo Sirainen <tss@iki.fi>

	* src/lib/: failures.c, failures.h: In case of internal errors in
	  logging, exit() with FATAL_LOGERROR.

2002-12-28 08:01  Timo Sirainen <tss@iki.fi>

	* src/lib/printf-upper-bound.c: Allow %m in
	  printf_string_upper_bound(). Fixes syslog failure handler.

2002-12-28 07:09  Timo Sirainen <tss@iki.fi>

	* src/lib/process-title.c: setproctitle() needs stdlib.h

2002-12-28 07:04  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: Keep the mmap()ed area far from heap.

2002-12-27 20:57  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: BODYSTRUCTURE reply was
	  incorrect. pine didn't like it.

2002-12-27 20:33  Timo Sirainen <tss@iki.fi>

	* configure.in: Show STARTTLS in capability only if SSL support is
	  enabled.

2002-12-27 16:03  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-12-27 16:02  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/failures.c, src/lib/macros.h,
	  src/lib/str.c, src/lib/strfuncs.c: We weren't using va_list
	  properly, especially gcc/PowerPC didn't like it.

2002-12-27 15:39  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: Old implementation was overly complex and
	  stupid.

2002-12-27 14:01  Timo Sirainen <tss@iki.fi>

	* src/lib/: data-stack.c, mempool-alloconly.c, mempool-datastack.c,
	  mempool-system.c, mempool.h: Removed pool->realloc_min() which
	  nothing used. A few small fixes to alloc-only pool.

2002-12-27 13:05  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-parser.c, message-send.c, message-size.c,
	  message-size.h: Some bugfixes and speedups for partial fetch
	  handling.

2002-12-22 17:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/Makefile.am: missing index-sort.h

2002-12-22 16:51  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-12-22 16:46  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: Several fixes. I think it's beginning to look
	  safe.

2002-12-22 08:49  Timo Sirainen <tss@iki.fi>

	* configure.in: Enable more warnings with gcc

2002-12-22 08:18  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth.c, auth/auth.h, lib/strfuncs.c, lib/strfuncs.h,
	  lib-storage/index/index-storage.c: t_strsplit() returns now const
	  char **, which removes a few nasty casts.  Removed a few unneded
	  functions and did some small cleanups.

2002-12-22 08:03  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: info log was broken

2002-12-22 07:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c: Don't send \0 char in FETCH
	  replies..

2002-12-22 07:37  Timo Sirainen <tss@iki.fi>

	* configure.in: EXTRA_CFLAGS environment is now added to CFLAGS
	  after all tests. Useful for adding -Werror there.

2002-12-22 07:31  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: _vstrconcat() is now faster

2002-12-22 07:28  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: t_try_realloc() wasn't working right with
	  DISABLE_DATA_STACK.

2002-12-22 07:06  Timo Sirainen <tss@iki.fi>

	* COPYING, src/lib/Makefile.am, src/lib/data-stack.c,
	  src/lib/failures.c, src/lib/imem.c, src/lib/imem.h,
	  src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c,
	  src/lib/mempool-system.c, src/lib/printf-upper-bound.c,
	  src/lib/printf-upper-bound.h, src/lib/str.c, src/lib/strfuncs.c,
	  src/lib/strfuncs.h: String function cleanups. Allocating 0 bytes
	  of memory is treated as error now, it could be an integer
	  overflow. Moved printf_string_upper_bound() to it's own file, so
	  strfuncs.c can be with MIT license.

2002-12-22 06:28  Timo Sirainen <tss@iki.fi>

	* src/lib/: compat.c, failures.c: Don't leak data stack memory.

2002-12-22 06:25  Timo Sirainen <tss@iki.fi>

	* src/lib/: compat.c, data-stack.c, failures.c, str.c, strfuncs.c:
	  Use vsnprintf() always when possible, even if we went through the
	  upper_bound function. DEBUG message in data stack might have
	  sometimes caused an infinite loop. Made sure infinite loops don't
	  happen anymore with failure handlers. str_printfa() didn't handle
	  %m. Made my_vsyslog() a lot simpler, since t_strdup_printf() is
	  now safe enough to call in failure handler.

2002-12-21 22:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Added some missing format attribute
	  declarations. And fixed one more bug found found with them.

2002-12-21 22:28  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/failures.c,
	  src/lib-storage/index/index-storage.c: Compile with
	  -Wformat-nonliteral now. Found a format string bug with it :( But
	  lucky for us, we haven't allowed %n in format strings for a few
	  months now and those bugs were added after that. So arbitrary
	  code execution vulnerabilities count is still zero :)

2002-12-21 22:04  Timo Sirainen <tss@iki.fi>

	* src/lib/str.c: Removed @UNSAFE tag, it's not anymore.

2002-12-21 22:02  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-select.c, imap/cmd-status.c, imap/commands-util.c,
	  lib/Makefile.am, lib/lib.h, lib/str.c, lib/str.h, lib/strfuncs.h,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-envelope.c,
	  lib-imap/imap-envelope.h, lib-imap/imap-quote.c,
	  lib-imap/imap-util.c, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-fetch.h: Replaced TempString with a
	  String which can use any memory pool and uses Buffer internally.

2002-12-21 22:02  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: whops, reverted unwanted changes

2002-12-21 21:56  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: Last update broke used size.

2002-12-21 19:10  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.c: Fixed several bugs, added a small testsuite.
	  Still requires careful auditing.

2002-12-21 14:06  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-select.c: Don't define FD_SETSIZE actually, it
	  should exist and it can be less than 1024 we used..

2002-12-21 13:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: We couldn't delete
	  mbox folders.

2002-12-21 13:38  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-select.c: select() based I/O-loop: Kill ourself if
	  we're trying to use more than FD_SETSIZE (1024) fds. Before we
	  just overflowed fd_set buffer, but it's unlikely it could have
	  been exploited. Default settings prevented this from happening
	  anyway.

2002-12-21 13:12  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: DEBUG: warn when growing pool

2002-12-21 13:08  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, imap/cmd-search.c, imap/cmd-sort.c,
	  lib/Makefile.am, lib/env-util.c, lib/imem.c,
	  lib/mempool-alloconly.c, lib/mempool.c, lib/mempool.h,
	  lib-imap/imap-parser.c, lib-storage/index/index-search.c: We
	  don't have separate read-write pools, so renamed pool_create(..,
	  FALSE) to pool_alloconly_create().

2002-12-21 12:42  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Make sure SSL parameters file has correct
	  permissions before using it. Also use effective uid/gid for
	  checking the base dir, don't assume roots..

2002-12-21 12:35  Timo Sirainen <tss@iki.fi>

	* src/lib/safe-mkdir.c: Whops, should have tested it :) Mode check
	  always failed.

2002-12-21 12:13  Timo Sirainen <tss@iki.fi>

	* src/: lib/Makefile.am, lib/safe-mkdir.c, lib/safe-mkdir.h,
	  lib/unlink-directory.c, lib/unlink-directory.h,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: If used base/login
	  directories exist already, make sure they're with correct
	  permissions. Always delete contents in login directory at
	  startup.

	  Added safe_mkdir(). changed unlink_directory() behaviour, and
	  fixed a race condition which could have made it follow symlinks
	  to other directories and delete them. Didn't really harm us so
	  far, we never used it for deleting unsafe directories.

2002-12-21 10:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-status.c: Better checking for
	  corrupted first_unseen_uid_lowwater.

2002-12-21 10:58  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c: fsck updated
	  first_unseen_uid_lowwater wrong, which caused SELECT or EXAMINE
	  to print wrong [UNSEEN seq] tag, or sometimes complain about
	  corrupted indexes.

2002-12-20 07:53  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/mail-storages.txt,
	  src/lib/unlink-directory.c, src/lib-index/mail-index.h,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c: Added :INDEX=<dir> for
	  both Maildir and mbox to specify different location where to
	  store index files. This would allow keeping mailboxes accessible
	  through NFS but still keep the indexes in fast local disk.

	  Did also some other related cleanups and minor fixes.

2002-12-20 06:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/mail-storage.h,
	  doc/mail-storages.txt,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-storage.c: Support for separate
	  location of mbox INBOX folder.

2002-12-20 04:47  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: default_mail_env behaviour changed. We use
	  %u instead of $U now. Added also several other variables which
	  can be used. Ideas based on David Champion's mailpath library.

2002-12-20 01:47  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c,
	  src/lib/failures.c, src/lib/failures.h, src/master/main.c: Added
	  info_log_file setting and i_info() function to write to it.
	  Default is the same as failure log. Currently only logged
	  information is client logins.

2002-12-19 23:56  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth.c, auth/auth.h, auth/main.c,
	  master/auth-process.c, master/auth-process.h, master/common.h,
	  master/login-process.c, master/main.c: Instead of just trusting
	  randomness of authentication cookies between
	  auth<->master<->login process IPC, master now doesn't accept any
	  cookies from login process which weren't created by it
	  (identified by PID). When login process dies, all it's pending
	  cookies are also removed, so I can't see even a theoretical
	  possiblity anymore for exploited login process to authenticate as
	  someone else.

	  Also fixed some int -> unsigned int.

2002-12-19 01:53  Timo Sirainen <tss@iki.fi>

	* src/: imap/commands-util.c, lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c: Limit the mailbox path. A
	  few cleanups.

2002-12-19 01:02  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, lib/hostpid.c, lib/mempool-alloconly.c,
	  lib/network.c, lib/ostream.c, lib/ostream.h, lib/process-title.c,
	  lib/restrict-access.c, lib/strfuncs.c, lib/strfuncs.h,
	  lib/unlink-directory.c, lib/unlink-lockfiles.c,
	  lib-imap/imap-parser.c, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c, master/auth-process.c,
	  master/login-process.c, master/main.c: Buffer related cleanups.
	  Use PATH_MAX instead of hardcoded 1024 for paths.  Added
	  str_path() and str_ppath() functions. i_snprintf() now returns
	  only -1 or 0 depending on if buffer got full. dec2str() returns
	  the string allocated from data stack. Instead of just casting to
	  (long) or (int), we now use dec2str() with printf-like functions.
	  Added o_stream_send_str(). Added strocpy() and replaced all
	  strcpy()s and strncpy()s with it.

	  Pretty much untested, hope it doesn't break too badly :)

2002-12-18 15:15  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/client.c, src/lib/buffer.c,
	  src/lib/buffer.h, src/lib/compat.c, src/lib/compat.h,
	  src/lib/data-stack.c, src/lib/hex-binary.c,
	  src/lib/ioloop-poll.c, src/lib/istream-file.c, src/lib/istream.c,
	  src/lib/md5.c, src/lib/mempool-alloconly.c,
	  src/lib/mempool-datastack.c, src/lib/mempool-system.c,
	  src/lib/mmap-anon.c, src/lib/network.c, src/lib/network.h,
	  src/lib/ostream-file.c, src/lib/randgen.c, src/lib/strfuncs.c,
	  src/lib/unlink-directory.c, src/lib-imap/imap-envelope.c,
	  src/lib-imap/imap-match.c, src/lib-imap/imap-match.h,
	  src/lib-imap/imap-parser.c, src/lib-imap/imap-util.c,
	  src/lib-mail/message-body-search.c,
	  src/lib-mail/message-header-search.c,
	  src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	  src/lib-storage/subscription-file/subscription-file.c,
	  src/master/auth-process.c, src/master/login-process.c,
	  src/master/main.c, src/master/ssl-init.c: Marked all non-trivial
	  buffer modifications with @UNSAFE tag. Several cleanups and a
	  couple of minor bugfixes.

2002-12-18 10:40  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, safe-memset.c, safe-memset.h: Added
	  safe_memset() which guarantees that compiler optimizations don't
	  optimize it away. Not that we really need to clear the passwords
	  from memory, but won't hurt much either :)

2002-12-18 04:05  Timo Sirainen <tss@iki.fi>

	* src/lib/env-util.c: unix98 says putenv() returns non-zero for
	  errors - check for that rather than just negative values.

2002-12-18 04:00  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, imap/main.c, lib/env-util.c, lib/failures.c,
	  lib/failures.h, lib/lib.c, lib/process-title.c,
	  lib/restrict-access.c, lib/restrict-access.h,
	  master/auth-process.c, master/common.h, master/login-process.c,
	  master/main.c: Drop root privileges earlier. Close syslog more
	  later in imap-master when forking new processes, so that any
	  errors get logged. Make sure that all errors show up in log files
	  - use specific exit status codes if we can't write to log file.
	  Make sure imap and login processes always drop root privileges
	  even if master process didn't ask for it for some reason.
	  putenv() wasn't verified to succeed - luckily we never allowed
	  large user given data there.

2002-12-18 02:23  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/restrict-access.c: Don't bother trying to
	  use setreuid(), setuid() check should be enough and openbsd
	  complains about it being deprecated.

2002-12-18 01:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Try not to split strings to multiple
	  lines from the middle of human readable text. Makes it easier to
	  grep for them.

2002-12-18 01:31  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: Use a bit larger initial data stack size
	  when DEBUG is set - current one is too small for message
	  searching.

2002-12-18 01:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-status.c: More verbose error message
	  when noticing problems with seen messages count.

2002-12-17 10:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c: LSUB
	  failed if there was no subscriptions file.

2002-12-17 05:08  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-12-17 04:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c: LIST: If our root folder
	  doesn't exists, complain about it. Otherwise just ignore those
	  errors.

2002-12-17 04:33  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-base-subject.c, imap-base-subject.h: Forgot
	  from last SORT commit.

2002-12-17 04:28  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-charset/charset-iconv.c,
	  src/lib-charset/charset-utf8.c, src/lib-charset/charset-utf8.h,
	  src/lib-imap/Makefile.am, src/lib-imap/imap-envelope.c,
	  src/lib-imap/imap-envelope.h,
	  src/lib-storage/index/index-search.c: Full not-too-well-tested
	  support for SORT extension. Required a few library interface
	  changes.

2002-12-17 03:00  Timo Sirainen <tss@iki.fi>

	* src/: lib/restrict-access.c, master/auth-process.c,
	  master/common.h, master/login-process.c: Clear separation of
	  virtual and system usernames. passwd-file didn't work before if
	  the user didn't exist in system. Prefixed also all setuid/etc.
	  restriction environments with RESTRICT_.

2002-12-17 02:21  Timo Sirainen <tss@iki.fi>

	* src/lib/buffer.h: comment update

2002-12-16 14:38  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: mailbox_check_interval is now disabled by
	  default, at least Evolution breaks with it.

2002-12-16 08:27  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Don't try creating SSL parameter file when
	  SSL is disabled.

2002-12-16 03:59  Timo Sirainen <tss@iki.fi>

	* src/: lib-charset/charset-iconv.c, lib-charset/charset-utf8.c,
	  lib-charset/charset-utf8.h, lib-mail/message-body-search.c,
	  lib-mail/message-header-search.c: Don't use Buffers with
	  read-only data, just makes it more difficult without gaining
	  anything.

2002-12-16 03:26  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: Makefile.am, message-header-decode.c,
	  message-header-decode.h, message-header-search.c,
	  quoted-printable.c: Quoted-Printable decoding was buggy.
	  Extracted RFC2047 header decoding into separate function.

2002-12-14 17:47  Timo Sirainen <tss@iki.fi>

	* src/imap/commands.c: CHECK command was actually calling COPY, so
	  it gave just error about missing parameters.

2002-12-12 18:57  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-file.c, network.c, network.h, randgen.c:
	  net_receive, net_transmit: Return -2 for regular disconnection
	  errors. Don't log those errors. Some other cleanups.

2002-12-12 18:33  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib/network.c, src/lib/network.h,
	  src/master/main.c: imap_listen and imaps_listen accepts now "*"
	  as "all IPv4 interfaces" and "::" as "all IPv6 interfaces, plus
	  all IPv4 interfaces if supported by OS".

	  Added a few consts to network API and added functions to get
	  inaddr_any for ipv4/ipv6.

2002-12-12 06:04  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: New setting: default_mail_env which can be
	  used to specify where to find users mailbox. Default is still to
	  use autodetection. Authentication process can override this if
	  needed, it's possible with passwd-file authentication.

2002-12-10 08:13  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/ioloop-select.c: select() is nowadays
	  defined to be in sys/select.h

2002-12-09 17:31  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c: still stupid bug :) works
	  now, tested.

2002-12-09 17:28  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c: still broken

2002-12-09 17:21  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c: When printing fsck warnings,
	  print also the index file path

2002-12-09 17:19  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c: message_part_serialize()
	  was broken with multipart messages.

2002-12-09 16:14  Timo Sirainen <tss@iki.fi>

	* src/lib/base64.c: base64_encode() was broken

2002-12-09 15:29  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Fixed "Missing arguments" error msg to work
	  again

2002-12-09 15:25  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/cmd-append.c, imap/cmd-search.c,
	  imap/cmd-sort.c, lib-imap/imap-bodystructure.c,
	  lib-imap/imap-envelope.c, lib-imap/imap-parser.c,
	  lib-imap/imap-parser.h: Limited max. command argument elements to
	  128. Added more verbose error messages to IMAP parser.

2002-12-09 15:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-search.c: Don't crash with missing search
	  argument parameters.

2002-12-09 13:39  Timo Sirainen <tss@iki.fi>

	* src/lib-charset/: charset-iconv.c, charset-utf8.c,
	  charset-utf8.h: Compiles again without iconv()

2002-12-08 05:23  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-list.c, imap/cmd-sort.c, imap/cmd-uid.c,
	  imap/main.c, lib/Makefile.am, lib/base64.c, lib/base64.h,
	  lib/buffer.c, lib/buffer.h, lib/data-stack.c, lib/hex-binary.c,
	  lib/hex-binary.h, lib/lib.h, lib-charset/charset-iconv.c,
	  lib-charset/charset-utf8.h, lib-mail/message-body-search.c,
	  lib-mail/message-header-search.c,
	  lib-mail/message-header-search.h, lib-mail/message-parser.c,
	  lib-mail/message-part-serialize.c,
	  lib-mail/message-part-serialize.h, lib-mail/quoted-printable.c,
	  lib-mail/quoted-printable.h, lib-storage/mail-storage.c,
	  lib-storage/index/index-search.c: Added buffer API. Point is to
	  hide all buffer writing behind this API which verifies that
	  nothing overflows. Much better than doing the same checks all
	  around the code, even if it is slightly slower.

	  Buffer reading is still mostly done directly, that isn't such a
	  big security risk and I can't think of a reasonable API for it
	  anyway.

2002-12-06 01:09  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/client.h, imap/cmd-append.c,
	  imap/cmd-fetch.c, imap/cmd-search.c, imap/cmd-sort.c,
	  imap/mail-storage-callbacks.c, lib/Makefile.am,
	  lib/iostream-internal.h, lib/iostream.c, lib/istream-data.c,
	  lib/istream-file.c, lib/istream-internal.h, lib/istream-mmap.c,
	  lib/istream.c, lib/istream.h, lib/lib.h, lib/ostream-file.c,
	  lib/ostream-internal.h, lib/ostream.c, lib/ostream.h,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-bodystructure.h,
	  lib-imap/imap-envelope.c, lib-imap/imap-parser.c,
	  lib-imap/imap-parser.h, lib-index/mail-index.h,
	  lib-mail/message-body-search.c, lib-mail/message-body-search.h,
	  lib-mail/message-parser.c, lib-mail/message-parser.h,
	  lib-mail/message-send.c, lib-mail/message-send.h,
	  lib-mail/message-size.c, lib-mail/message-size.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-fetch.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.h, master/auth-process.c,
	  master/login-process.c: Renamed IBuffer and OBuffer to IStream
	  and OStream which describes their functionality better. I tried
	  to keep the variable names and comments also sensible.

2002-12-04 18:28  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/cmd-search.c,
	  src/imap/cmd-sort.c, src/imap/commands.c, src/imap/commands.h,
	  src/lib-storage/.cvsignore, src/lib-storage/Makefile.am,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/Makefile.am,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/register/.cvsignore,
	  src/lib-storage/register/Makefile.am: First implementation of
	  SORT extension. String comparing still not up to spec, so we
	  don't advertise it in capability string yet. The code supports
	  getting the data partially pre-sorted to reduce memory usage and
	  make it faster. So, in future we could use this by creating
	  sorted binary trees.

	  Also moved mail-storage-register.c into it's own .a lib to fix
	  circular dependencies.

2002-12-04 00:27  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Send INBOX always uppercased with LIST and
	  LSUB.

2002-12-03 23:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-storage.c, mbox-storage.h:
	  Forgot to commit.

2002-12-03 23:21  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: Subject printing used wrong certificate file.

2002-12-03 23:08  Timo Sirainen <tss@iki.fi>

	* configure.in: #undef _FILE_OFFSET_BITS before checking for
	  sendfile() support, that breaks it.

2002-12-03 22:44  Timo Sirainen <tss@iki.fi>

	* AUTHORS, COPYING, src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/subscription-file/subscription-file.c,
	  src/imap/cmd-list.c, src/lib-imap/imap-match.c,
	  src/lib-imap/imap-match.h,
	  src/lib-storage/index/maildir/maildir-list.c: Rewrote
	  imap_match() function. Maybe not as fast as before, but at least
	  it's understandable now. This was required to fix listing mbox
	  mailboxes where we wanted to match partial paths (it was pretty
	  buggy before).

2002-12-03 13:55  Timo Sirainen <tss@iki.fi>

	* src/lib-charset/: charset-iconv.c, charset-utf8.c:
	  charset_to_ucase_utf8_string() didn't return \0 terminated string
	  with ascii/utf8.

2002-12-03 13:20  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: DEBUG: Don't send shrink messages, they
	  could cause infinite loop.

2002-12-03 01:36  Timo Sirainen <tss@iki.fi>

	* configure.in: Give a hard warning if size_t is signed.

2002-12-03 00:59  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: imap processes open syslog fd now immediately at
	  startup, so dropping roots and potential chrooting won't break
	  it.

2002-12-03 00:45  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: Sanity check to make sure USER environment
	  exists.

2002-12-03 00:28  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Let login process also know if
	  verbose process titles are wanted..

2002-12-03 00:27  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: Set process title for rawlog process.

2002-12-03 00:13  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/Makefile.am, src/lib/process-title.c,
	  src/lib/process-title.h: Login process now changes it's name if
	  verbose_proctitle = yes, and we're running BSD. This is also
	  possible with Linux with a pretty ugly hack, which you can enable
	  by modifying lib/process-title.c if you _really_ want to.

	  And a nasty bugfix - login_process_per_connection setting didn't
	  work with imaps port connections which is exactly where it was
	  mostly wanted.

2002-12-02 13:45  Timo Sirainen <tss@iki.fi>

	* src/lib/: imem.h, mempool.h: We shouldn't cast sizeof() to
	  unsigned int.

2002-12-02 12:41  Timo Sirainen <tss@iki.fi>

	* configure.in: acconfig.h is deprecated with autoconf 2.5, changed
	  configure to contain internal definitions. Also off_t type was
	  detected wrong, long/int were swapped.

2002-12-01 21:44  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: If ssl_disabled = yes, we shouldn't listen in
	  imaps port.

2002-12-01 21:17  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/restrict-process-size.c: RLIMIT_AS isn't
	  supported everywhere - use it if it exists, but also use
	  RLIMIT_DATA.

2002-12-01 18:18  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: DEBUG: We shouldn't verify the fds when running
	  in pre-auth mode (breaks with gdb).

2002-12-01 18:17  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-header-search.c: Added a few t_push/t_pops
	  to prevent unnecessary memory usage.

2002-12-01 18:16  Timo Sirainen <tss@iki.fi>

	* src/lib-charset/charset-iconv.c: We shouldn't be strdup()ing the
	  buffer, it's not \0 terminated.

2002-12-01 18:00  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: All SEARCH arguments still may not
	  have been parsed.

2002-12-01 17:58  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: crashfix when DEBUG was set.

2002-12-01 17:08  Timo Sirainen <tss@iki.fi>

	* configure.in: AC_TYPEOF macro: with gcc we can check the type
	  with printf() + -Werror

2002-12-01 16:38  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 0.99.4 out

2002-12-01 15:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: failures.c, fd-close-on-exec.c, randgen.c: Set
	  close-on-exec flag to failure log, /dev/urandom fd already tried
	  to do that but did it wrong.

2002-12-01 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: bugfix

2002-12-01 15:45  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: DEBUG: we get warnings when
	  growing/shrinking data stack.

2002-12-01 15:39  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, imap/main.c, lib/Makefile.am,
	  lib/fd-close-on-exec.c, lib/fd-close-on-exec.h,
	  master/auth-process.c, master/auth-process.h,
	  master/login-process.c, master/login-process.h, master/main.c: We
	  use close-on-exec flag now to make sure that master process
	  closes the fds when executing other processes.

2002-12-01 15:37  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: Changed so that we can use the functions
	  before calling failures_init().

2002-12-01 14:43  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-12-01 13:50  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: whops, accidentally committed some
	  test code.

2002-12-01 13:48  Timo Sirainen <tss@iki.fi>

	* configure.in, dovecot-example.conf, src/lib/Makefile.am,
	  src/lib/restrict-process-size.c, src/lib/restrict-process-size.h,
	  src/master/auth-process.c, src/master/login-process.c: Added
	  virtual memory size limits to processes. Default values are
	  pretty high, this is mostly because I want it to prevent
	  accidental infinite loops eating memory or some integer
	  overflows, not to actually restrict anything.

2002-12-01 13:10  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c:
	  subsfile_foreach() (LSUB) leaked memory.

2002-11-30 16:32  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, lib-imap/imap-parser.c: Maybe now?

2002-11-30 16:09  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Still not exactly right.

2002-11-30 15:56  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Lists still weren't fully parsed
	  always.

2002-11-30 15:40  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, lib-imap/imap-parser.c: Input parsing was a
	  bit broken in some conditions. Mostly visible with APPEND
	  (_finally_, that should be the last weird bug I've noticed).

2002-11-30 14:58  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-body-search.c,
	  lib-mail/message-body-search.h, lib-storage/index/index-search.c:
	  Body searching wasn't working with unknown charsets, and SEARCH
	  BODY searched also headers.

2002-11-30 14:36  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-header-search.c,
	  lib-storage/index/index-search.c: Non-envelope-cached header
	  searching wasn't working. Also now search works with messages
	  having 8bit headers, assuming them being in same charset as
	  search key.

2002-11-27 00:21  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: added assert.

2002-11-26 23:01  Timo Sirainen <tss@iki.fi>

	* configure.in: --with-ssldir actually didn't do anything, and the
	  default directory for them wasn't set either. Not important
	  enough to release 0.99.4 though.

2002-11-26 22:04  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 0.99.3 release

2002-11-26 21:26  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-select.c: unused variable

2002-11-26 21:13  Timo Sirainen <tss@iki.fi>

	* src/lib/env-util.c: crashfix

2002-11-26 20:59  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO: 0.99.2 released

2002-11-26 20:55  Timo Sirainen <tss@iki.fi>

	* configure.in: OSX puts PAM includes into pam/ directory instead
	  of security. Detect that.

2002-11-26 20:35  Timo Sirainen <tss@iki.fi>

	* src/lib/: hash.c, hash.h: Removed const from key and value of
	  hash_insert() and hash_update().

2002-11-26 20:22  Timo Sirainen <tss@iki.fi>

	* src/lib/: compat.c, compat.h: writev()'s 3rd parameter is
	  declared as "int" pretty much everywhere, so we should do that
	  too.

2002-11-26 20:09  Timo Sirainen <tss@iki.fi>

	* configure.in: No, actually we don't want -Wcast-align :)

2002-11-26 20:05  Timo Sirainen <tss@iki.fi>

	* src/auth/Makefile.am: missing master.h

2002-11-26 20:04  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/main.c, src/imap/cmd-examine.c,
	  src/imap/cmd-list.c, src/imap/cmd-lsub.c, src/imap/cmd-select.c,
	  src/imap/cmd-subscribe.c, src/imap/cmd-unsubscribe.c,
	  src/imap/commands.h, src/lib/mempool-alloconly.c,
	  src/lib/mempool.c, src/lib/mempool.h, src/master/auth-process.c,
	  src/master/login-process.c: Use more warnings with GCC by
	  default. Fixed several warnings.

2002-11-26 19:49  Timo Sirainen <tss@iki.fi>

	* src/: lib/Makefile.am, lib/env-util.c, lib/env-util.h,
	  lib/restrict-access.c, master/auth-process.c,
	  master/login-process.c, master/main.c: Created env_put() and
	  env_clean() for a bit easier handling of environment variables.

2002-11-26 19:30  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.h: Reverted back the isdigit()/etc. They're
	  defined to get int argument, so we shouldn't given them unsigned.

2002-11-26 19:17  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Don't do void* arithmetics.

2002-11-26 19:09  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.h: Cast chars to (unsigned int) instead of (int)
	  in i_isdigit() etc. macros.  Hopefully fixes some warnings with
	  HP/UX.

2002-11-26 19:03  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.h: And the missing sys/sysmacros.h include..

2002-11-26 19:01  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.h: Added CMP_DEV_T macro which uses
	  major()/minor() if possible but fallbacks to direct comparing if
	  it's not a structure.

2002-11-26 18:47  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-index/mail-index.h: We compile now if dev_t
	  is a structure (eg. glibc+tcc).

2002-11-26 18:39  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, auth/mycrypt.c, auth/mycrypt.h,
	  lib/Makefile.am: Moved mycrypt() into auth/ dir, so we don't have
	  to link all programs with -lcrypt

2002-11-26 18:23  Timo Sirainen <tss@iki.fi>

	* src/lib/Makefile.am: Forgot mycrypt.h

2002-11-26 18:06  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: Removed compiler warnings.

2002-11-26 17:56  Timo Sirainen <tss@iki.fi>

	* src/lib/Makefile.am: Still more crypt() problems. Wrapped it into
	  mycrypt() which should finally put end to this kludgeing.

2002-11-26 14:15  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: missing include file

2002-11-26 13:58  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Still not correct order with
	  dup2()ing.

2002-11-26 13:50  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: Close old fds before dup2()ing to fd
	  3, so we don't close it accidentally.

2002-11-26 13:31  Timo Sirainen <tss@iki.fi>

	* src/master/Makefile.am: default settings still pointed to lib dir
	  instead of libexec dir..

2002-11-26 13:27  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, lib/network.c, lib/network.h: net_accept()
	  returns now -2 for fatal failures.

2002-11-26 13:13  Timo Sirainen <tss@iki.fi>

	* configure.in: Get uintmax_t from inttypes.h instead of stdint.h.

2002-11-26 13:07  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/mail-storage-callbacks.c,
	  src/lib/compat.h, src/lib/hostpid.c, src/lib/lib.h,
	  src/lib/strfuncs.c, src/lib/strfuncs.h,
	  src/lib-storage/index/index-search.c: Renamed largest_t to
	  uintmax_t which already exists in C99.

2002-11-26 12:28  Timo Sirainen <tss@iki.fi>

	* configure.in: Created AC_TYPEOF() which tells what base type
	  (int/long/long long) the given type is. This cleans up the
	  ssize_t and off_t checks. We also try another way to figure out
	  the size by checking if compiler allows us to redeclare the type
	  using typedef, at least it works with gcc. This should get rid of
	  the warnings with OSX where ssize_t was previously declared as
	  int instead of long.

2002-11-26 10:28  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-poll.c,
	  src/lib/ioloop-select.c: select() support was broken. Also
	  changed the way it's built.

2002-11-26 10:14  Timo Sirainen <tss@iki.fi>

	* src/: lib/ioloop-select.c, lib-mail/message-header-search.c:
	  Fixed a few compiling warnings about signedness.

2002-11-25 19:02  Timo Sirainen <tss@iki.fi>

	* TODO, src/imap/Makefile.am, src/imap/client.c,
	  src/imap/cmd-select.c, src/imap/mail-storage-callbacks.c,
	  src/lib/file-lock.c, src/lib/file-lock.h,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/index-status.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/index-sync.c,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/subscription-file/subscription-file.c: Locking
	  changes triggered a bit larger cleanup :) If we have to wait for
	  a lock longer, the client is now notified about it every 30
	  seconds. Also if mailbox opening fails because of lock timeout,
	  we won't overwrite the index anymore. Finally user gets a clear
	  error message about lock timeout instead of "internal error".

2002-11-25 13:19  Timo Sirainen <tss@iki.fi>

	* src/: auth/common.h, master/auth-process.c: Moved login listener
	  handle to fd 3 from 1 (stdout), because vpopmail could try
	  writing into it.

2002-11-25 10:52  Timo Sirainen <tss@iki.fi>

	* NEWS: And the date :)

2002-11-25 10:51  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 0.99.1 released

2002-11-25 10:47  Timo Sirainen <tss@iki.fi>

	* src/imap/Makefile.am: Reverted accidental commit.

2002-11-25 10:45  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/login-process.c: Added
	  ssl_disable setting.

2002-11-25 10:35  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: Name the cert and key files as "imapd.pem" after
	  all like they're in config file. I'm not sure what's the standard
	  naming in /etc/ssl though.

2002-11-24 23:13  Timo Sirainen <tss@iki.fi>

	* doc/: auth.txt, configuration.txt: updates

2002-11-24 22:56  Timo Sirainen <tss@iki.fi>

	* doc/configuration.txt: updated

2002-11-24 22:37  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: updated lib paths to libexec ones

2002-11-24 22:14  Timo Sirainen <tss@iki.fi>

	* .cvsignore: updated

2002-11-24 22:08  Timo Sirainen <tss@iki.fi>

	* src/master/Makefile.am: Use --with-ssldir directory instead of
	  hardcoded /etc/ssl

2002-11-24 22:07  Timo Sirainen <tss@iki.fi>

	* configure.in, dovecot-example.conf, doc/Makefile.am,
	  doc/dovecot-openssl.cnf, doc/mkcert.sh: Added script to easily
	  generate self-signed certificate.

2002-11-24 20:05  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, imap/Makefile.am: Use libexecdir instead
	  of libdir to install the binaries.

2002-11-24 19:56  Timo Sirainen <tss@iki.fi>

	* doc/Makefile.am: The txt files are now installed into doc
	  directory, and a few of them were missing.

2002-11-24 19:49  Timo Sirainen <tss@iki.fi>

	* configure.in: Was missing -lcrypto when checking for OpenSSL.

2002-11-24 17:38  Timo Sirainen <tss@iki.fi>

	* configure.in: Final bugfix..

2002-11-24 17:34  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 0.99.0 released

2002-11-22 13:55  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-11-22 08:37  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: handle broken multipart
	  messages without crashing

2002-11-21 20:50  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: MAIL_READ_MMAPED setting was set too
	  late, plus a few cleanups.

2002-11-21 20:31  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-index.h:
	  mail_read_mmaped: Use mmap() instead of read() to read mail
	  files. read() seems to be a bit faster with my Linux/x86 and it's
	  better with NFS, so that's the default.

2002-11-21 20:13  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-index.h: Added mbox lock
	  settings to config file. Support timeouting fcntl() and flock()
	  locks. Plus before the fcntl/flocks weren't even set.

2002-11-20 19:20  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, auth-process.h, login-process.c,
	  login-process.h, main.c: SIGHUP reloads now settings. Logged in
	  clients are left untouched, but clients still logging in are
	  killed.

2002-11-20 18:33  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-11-20 18:31  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-storage.h, mbox/mbox-save.c:
	  COPYing inside same mailbox works now with mbox. Also fixed SAVE
	  leaving From-line written to mbox file if it was aborted.

2002-11-20 18:27  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: debug fix

2002-11-20 16:59  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: typofix

2002-11-20 16:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: typo in comment

2002-11-20 16:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: Don't allow '*' and '%' characters in
	  mailbox names. Maildir RENAME works now properly when renaming
	  folders having subfolders.

2002-11-20 14:18  Timo Sirainen <tss@iki.fi>

	* INSTALL, configure.in, src/master/ssl-init-gnutls.c: SSL fixes
	  and doc updates.

2002-11-20 14:05  Timo Sirainen <tss@iki.fi>

	* configure.in, src/master/Makefile.am,
	  src/master/ssl-init-gnutls.c, src/master/ssl-init-openssl.c,
	  src/master/ssl-init.c, src/master/ssl-init.h: Support for
	  OpenSSL.

2002-11-20 14:04  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: No space before "* PREAUTH" ..

2002-11-19 13:09  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: Send PREAUTH if we were started without
	  LOGIN_TAG environment (ie. not through master process).

2002-11-17 13:59  Timo Sirainen <tss@iki.fi>

	* src/master/: Makefile.am, ssl-init.h, ssl-init.c: forgot

2002-11-17 09:45  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-11-17 09:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/Makefile.am,
	  src/master/common.h, src/master/login-process.c,
	  src/master/login-process.h, src/master/main.c: Master process
	  generates DH/RSA parameters now and stores them into file which
	  login processes read. Added setting for regeneration interval.
	  Some other SSL cleanups.

	  Also fixed default login process path to be ../run/dovecot/login/
	  like example config file said, instead of just ../run/dovecot/
	  which it actually was until now.

2002-11-16 05:57  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/login-process.c:
	  login_process_per_connection = yes scales now better when
	  multiple users are trying to log in at the same time.

2002-11-16 05:21  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/master/login-process.c: Finally support
	  for handling each login connection in it's own process.  Enabled
	  by default. Also a few bugfixes to master process.

2002-11-16 05:19  Timo Sirainen <tss@iki.fi>

	* src/lib/: fdpass.c, fdpass.h: Some fixes, cleanups and
	  possibility to send/receive data without actually passing the fds
	  (ie. just a sendmsg/recvmsg wrapper).

2002-11-15 06:40  Timo Sirainen <tss@iki.fi>

	* src/lib-charset/charset-iconv.c: Removed warnings with Solaris'
	  iconv()

2002-11-14 12:53  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Call setsid() when daemonizing.

2002-11-13 13:47  Timo Sirainen <tss@iki.fi>

	* src/lib-charset/: Makefile.am, charset-iconv.c, charset-utf8.c:
	  We can support UTF-8 charset too without any translations.

2002-11-13 11:08  Timo Sirainen <tss@iki.fi>

	* src/: lib/base64.c, lib/base64.h, lib-charset/charset-iconv.c,
	  lib-charset/charset-utf8.h, lib-mail/Makefile.am,
	  lib-mail/message-body-search.c, lib-mail/message-body-search.h,
	  lib-mail/message-header-search.c,
	  lib-mail/message-header-search.h, lib-mail/quoted-printable.c,
	  lib-mail/quoted-printable.h, lib-storage/index/index-search.c:
	  SEARCH CHARSET now works properly with message bodies, and in
	  general body searching works more correctly by decoding base64/qp
	  data. Non-text MIME parts are currently not included in search,
	  that could be made optional.	Also the body is parsed separately
	  for each keyword, that could be optimized.

	  Changed base64_decode() behaviour so that it can accept
	  non-base64 data as well, ie. line feeds etc.

2002-11-13 11:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_lock_full() doesn't need
	  to be global

2002-11-13 05:00  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: Fix ~ usage - I'm not sure if it was wrong
	  before (it did work), but at least now I know it's correct. :)

2002-11-13 01:44  Timo Sirainen <tss@iki.fi>

	* TODO: update

2002-11-13 01:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-save.c, mbox/mbox-save.c:
	  Use blocking output buffers when writing to files.

2002-11-13 00:43  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: If mbox opening fails, don't leave
	  the lock files lying around.

2002-11-13 00:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c: FETCH RFC822 and RFC822.TEXT
	  also needs to set \Seen flag for message

2002-11-12 05:27  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/index/Makefile.am,
	  src/lib-storage/index/index-mailbox-check.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/index-sync.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.c: mailbox_check_interval
	  setting: Dovecot can notify client of new mail in selected
	  mailbox soon after it's received. This setting specifies the
	  minimum interval in seconds between new mail notifications to
	  client - internally they may be checked more or less often.
	  Setting this to 0 disables the checking.

2002-11-06 14:33  Timo Sirainen <tss@iki.fi>

	* src/imap/main.c: Drop root privileges before handling rawlog
	  opening.

2002-11-06 14:20  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap/main.c, src/master/common.h,
	  src/master/login-process.c: Added verbose_proctitle setting: Show
	  more verbose process titles (in ps).	Currently shows user name
	  and IP address. Useful for seeing who are actually using the IMAP
	  processes (eg. shared mailboxes or if same uid is used for
	  multiple accounts).

2002-11-06 07:46  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: another buggy check

2002-11-06 07:46  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: buggy check

2002-11-06 07:45  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: imap-bodystructure.c, imap-envelope.c: A few extra
	  checks to prevent memory eating by sending mails with multiple
	  header fields with same name.

2002-11-05 07:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Fixed wrong printf-type.

2002-11-04 09:54  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Fixes for anon-mmaped indexes.

2002-11-04 09:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Setting index file's timestamp was
	  done too early - there was msync() immediately after it to reset
	  the timestamp again.

2002-11-04 07:11  Timo Sirainen <tss@iki.fi>

	* src/: lib/macros.h, lib/md5.c, lib/write-full.c,
	  lib-charset/charset-iconv.c, lib-imap/imap-date.c,
	  lib-imap/imap-quote.c, lib-mail/message-parser.c: Several minor
	  fixes: signess, casting away const, missing static, etc.

2002-11-04 06:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: mbox_unlock() actually set exclusive
	  lock

2002-11-04 06:11  Timo Sirainen <tss@iki.fi>

	* configure.in: Print the size of off_t at end.

2002-11-04 06:00  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Never open imaps port if we're building with
	  SSL disabled.

2002-11-04 05:33  Timo Sirainen <tss@iki.fi>

	* src/lib/: failures.c, strfuncs.c, strfuncs.h: Added
	  printf_string_fix_format() which currently just replaces %m with
	  strerror(errno). i_panic, i_fatal, i_error and i_warning didn't
	  expand the %m before when not writing to syslog.

2002-11-04 05:20  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.h: EOVERFLOW doesn't exist everywhere, fallback it
	  to EINVAL.

2002-11-04 04:47  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-copy.c: And more
	  locking/syncing fixes. Now it's finally beginning to look sane
	  again.

2002-11-03 10:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: SEARCH TEXT now checks only
	  field values (not names) from headers. RFC doesn't really specify
	  how this should be handled and I think it's better this way. Also
	  it's easier to handle correctly :)

2002-11-03 08:39  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/imap/Makefile.am,
	  src/imap/cmd-search.c, src/lib-charset/.cvsignore,
	  src/lib-charset/Makefile.am, src/lib-charset/charset-iconv.c,
	  src/lib-charset/charset-utf8.h, src/lib-mail/Makefile.am,
	  src/lib-mail/message-header-search.c,
	  src/lib-mail/message-header-search.h,
	  src/lib-storage/mail-search.c, src/lib-storage/mail-search.h,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/index-storage.h: SEARCH CHARSET support.
	  Currently we do it through iconv() and only ASCII characters are
	  compared case-insensitively.

2002-11-03 08:09  Timo Sirainen <tss@iki.fi>

	* src/lib/base64.h: forgot

2002-11-03 08:03  Timo Sirainen <tss@iki.fi>

	* src/lib/base64.c: size parameter to base64_decode()..

2002-11-03 05:34  Timo Sirainen <tss@iki.fi>

	* src/lib/: base64.c, base64.h: Changed base64_decode() to separate
	  src/dest buffers.

2002-11-02 23:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: APPEND fixed for mbox

2002-11-02 20:10  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-close.c, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-storage/mail-storage.h,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h: Mostly mbox
	  locking/syncing fixes. Still some problems though.

2002-10-30 18:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: don't unref() the ibuffer
	  we got from imap cache.

2002-10-29 06:46  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: mbox locking wasn't
	  working.

2002-10-29 06:29  Timo Sirainen <tss@iki.fi>

	* AUTHORS, COPYING: updates

2002-10-29 06:29  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/client.h,
	  src/imap/main.c: --with-rawlog: Build support for logging traffic
	  of user sessions. If user's home directory contains "rawlog"
	  directory, the input and output traffic is written to
	  YYYYMMDD-hhmmss-pid.in and .out files. This was made for
	  debugging purposes.

2002-10-29 05:12  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.c: DEBUG: when t_pop()ing, fill the free'd
	  memory area with 0xde bytes.

2002-10-29 05:07  Timo Sirainen <tss@iki.fi>

	* configure.in: Call pam_setcred() if it exists.

2002-10-28 09:46  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/auth.c, src/imap/cmd-append.c,
	  src/imap/commands-util.c, src/lib/macros.h,
	  src/lib-imap/imap-parser.c, src/lib-storage/index/index-search.c,
	  src/lib-storage/index/index-storage.c: Added --enable-asserts
	  (default) and fixed some warnings when building without. Added
	  i_unreached() to indicate supposedly unreachable code block and
	  changed a existing i_assert(0) calls to it. Removed
	  return_if_fail() and return_val_if_fail() macros, they're not
	  useful.

2002-10-28 09:31  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-index/mail-index.c: Added --enable-debug.
	  Currently it just forces file locks so that index files can't be
	  written to when not holding exclusive lock. Also main index file
	  can't be even read if we're unlocked (other files don't get
	  notification of unlock, so they don't do this at least yet).

2002-10-28 09:00  Timo Sirainen <tss@iki.fi>

	* src/lib/: mmap-util.c, mmap-util.h: Removed mmap_aligned() which
	  isn't used anywhere. Added mmap_file() which accepts prot
	  argument. We use now fstat() instead of lseek() to get file size.

2002-10-28 07:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-status.c: Previous lowwater change
	  broke STATUS.

2002-10-28 05:34  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-10-28 04:50  Timo Sirainen <tss@iki.fi>

	* src/lib/: data-stack.c, data-stack.h, ioloop-poll.c, ioloop.c:
	  changed t_push() and t_pop() to return unsigned int. added global
	  data_stack_frame which is used by TempString to verify it's
	  accessed only in the same frame.

2002-10-28 04:36  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c: fsck() should reset lowwater
	  marks to end of uids, not to beginning.

2002-10-28 04:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: keep i_buffer_seek() void
	  and make it close the buffer if any errors happen.  next read
	  will then notice the error. easier to handle it that way.

2002-10-28 04:18  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, lib/Makefile.am, lib/file-lock.c, lib/lib.c,
	  lib-storage/index/mbox/mbox-save.c, master/auth-process.c,
	  master/login-process.c: I/O buffers now use real blocking instead
	  of setting up a sub-ioloop to poll(). alarm() is called every 30
	  secs to send SIGHUP and break out of the read/write calls, so the
	  given timeout values aren't exact.

	  Also some other cleanups, like not including ioloop.h in
	  [io]buffer.h which broke several other files which hadn't
	  included it itself..

2002-10-28 03:43  Timo Sirainen <tss@iki.fi>

	* configure.in: and fix linux-sendfile check so it fails with
	  freebsd :)

2002-10-28 03:42  Timo Sirainen <tss@iki.fi>

	* configure.in: buggy checks. we were supposed to compile them, not
	  run. plus fixes for freebsd-sendfile checking so that it fails
	  with linux.

2002-10-28 03:35  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/sendfile-util.c: Support FreeBSD-compatible
	  sendfile(). Completely untested.

2002-10-27 07:13  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-10-27 06:37  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-copy.c: Moved several fields
	  from .imap.index file to .imap.index.data file. Fixed code so
	  that most of the fields do not need to be set when building
	  index, allowing the index building to be fast (just readdir()s
	  with maildir). This still needs some configuration and ability to
	  update the fields whenever it can grab exclusive lock.

	  Also fixed SEARCH LARGER, SMALLER and KEYWORD.

2002-10-26 19:38  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h, lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h: mbox locking fixes /
	  changes. we now read-lock the mbox file before syncing so we can
	  be sure no-one corrupts our reads by expunging mailbox. mbox file
	  is kept open all the time, but re-opened when device/inode for
	  file has changed (ie. someone overwrote it). File is also kept
	  mmap()ed until lock is dropped.

	  we currently create .lock file even when reading the file (ie.
	  being effectively write-lock), but that'll be made configurable
	  later.

2002-10-25 21:01  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: and a couple more fixes..

2002-10-25 21:00  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated SSL certificate comments.

2002-10-25 04:20  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: still not right

2002-10-25 04:16  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Header parser was still a bit
	  wrong.

2002-10-25 03:27  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Header parsing should always keep
	  one character lookahead, so it can see if header continues in
	  next line. This wasn't done properly.

2002-10-25 02:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: Don't crash either if expunge
	  or update_flags sync_callbacks haven't been set when syncing
	  modify log

2002-10-25 01:59  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-select.c, lib-storage/index/index-sync.c: Error
	  message fixes for APPEND. Make sure we don't crash if
	  sync_callbacks isn't set. Don't set sync_callbacks until SELECT
	  is finished.

2002-10-25 01:57  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-parser.c,
	  lib-storage/index/index-search.c: More (char *) -> (const char *)
	  fixes

2002-10-25 01:06  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: Buffer returns const type, don't cast
	  it away.

2002-10-24 22:39  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: imap_parser_read_args() didn't
	  correctly always return "need for more data" which sometimes
	  resulted in broken parsing of client commands.

2002-10-24 01:55  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-10-24 00:34  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.h: Check fdatasync() from -lrt if
	  it's not in libc (solaris). Also fallback to fsync() entirely if
	  fdatasync() doesn't exist.

2002-10-24 00:17  Timo Sirainen <tss@iki.fi>

	* src/lib/: utc-mktime.c, utc-offset.c: comment cleanups

2002-10-24 00:15  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, lib/Makefile.am, lib/ioloop.c,
	  lib/ioloop.h, lib/utc-mktime.c, lib/utc-mktime.h,
	  lib/utc-offset.c, lib/utc-offset.h, lib-imap/imap-date.c,
	  lib-imap/imap-date.h, lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.h: Fixes to timezone handling
	  which were handling quite badly. added ioloop_timezone which gets
	  updated with ioloop_time. Changed some GMT references to UTC.
	  Timezone offsets are in minutes now everywhere instead of
	  seconds. Fixes for unsigned time_t.

2002-10-23 20:41  Timo Sirainen <tss@iki.fi>

	* src/: lib/file-lock.c, lib/file-lock.h, lib/lib-signals.c,
	  lib-index/mail-index.c,
	  lib-storage/subscription-file/subscription-file.c:
	  file_wait_lock() now takes timeout-parameter so one badly
	  behaving process won't start creating tons of lock-waiting
	  processes.

2002-10-23 19:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: minor fixes

2002-10-23 19:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: Use fdatasync()
	  instead of fsync() where possible. msync() all files first, then
	  fsync them instead of msync+fsync+msync+fsync+.. data file now
	  keeps track of when it's been changed, tree file didn't do mmap
	  updates, plus other related cleanups.

2002-10-23 17:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: Modify log was pretty much
	  broken whenever it was switched.

2002-10-23 13:19  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: Assert i_snprintf() string lengths to INT_MAX
	  instead of SSIZE_T_MAX since *printf()s returns int, not
	  ssize_t..

2002-10-23 13:16  Timo Sirainen <tss@iki.fi>

	* src/lib/: compat.c, strfuncs.c: Check vsnprintf() return values
	  more carefully, thanks to Thomas Wouters <thomas@xs4all.net> for
	  noticing.

2002-10-22 23:45  Timo Sirainen <tss@iki.fi>

	* TODO: useless test commit

2002-10-22 23:35  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-10-21 15:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c: cleanups,
	  also file_wait_lock() return value wasn't checked correctly

2002-10-21 00:26  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-10-21 00:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-copy.c, maildir-save.c,
	  maildir-storage.h: Hardlink COPYing still copied the file name
	  instead of generating a new one, which really broke things when
	  mail was duplicated in the same mailbox.

2002-10-21 00:09  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/configuration.txt,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/mbox/mbox-save.c: Added setting
	  mail_save_crlf. Few other settings cleanups.

2002-10-20 03:37  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: List parsing was broken.

2002-10-20 03:27  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: typofix

2002-10-20 03:26  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: include sys/socket.h, not network.h. Required
	  with solaris+ipv6 where _XPG4_2 must be defined to get the
	  cmsg-stuff to work but which also breaks ipv6.

2002-10-20 03:19  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: Fail if %ll is used and we don't have long
	  long.

2002-10-20 03:15  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/failures.c, src/lib/strfuncs.c: Removed
	  several useless handers of printf_string_upper_bound(), and added
	  a few configure checks it required. That function could use a
	  better audit..  Also stdlib.h was missing from failures.c for
	  some reason..

2002-10-20 02:35  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-index.c,
	  src/lib-index/mail-index.h,
	  src/lib-storage/index/index-storage.c: Added mail_cache_fields
	  and mail_never_cache_fields settings, plus settings cleanup.

2002-10-20 01:36  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-search.c: cache_fields_later() doesn't
	  need MailIndexRecord parameter.

2002-10-20 01:12  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-search.c: Added cache_fields_later() to
	  MailIndex interface. That can be used to specify when some field
	  is wanted to be cached, instead of doing it at every
	  lookup_field*() call.

2002-10-20 01:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Indexes were never closed
	  because refcount wasn't updated.

2002-10-20 00:17  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-fetch.h,
	  lib-storage/index/index-search.c: If maildir files are
	  unexpectedly deleted, don't treat it as error, and don't return
	  partially fetched data. Instead try to handle it just as if
	  sync() had noticed it earlier.

2002-10-19 23:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-status.c, index-storage.h,
	  index-sync.c: When doing EXPUNGE, if there's been external flag
	  changes in messages we're going to delete, don't show the
	  changes.

2002-10-19 23:27  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-sync.c: Fixes for expunge handling

2002-10-19 23:09  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c: Modify log now stores the changes
	  in ranges, so store 1:100 doesn't generate 100 entries but just
	  one. For single message changes this takes 8 bytes unneededly
	  though, that could be fixed but for extra complexity so I don't
	  think it's worth it.

	  Also a change in sync-interface, expunge event no longer gets
	  UID. It's not currently needed and I don't see any rfcs/drafts
	  wanting it either. It's removed mostly because the log ranges
	  makes it impossible to get it.

2002-10-19 16:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-fetch.c, index-status.c,
	  index-sync.c, maildir/maildir-copy.c:
	  mail_custom_flags_list_unref() isn't needed, the list returned by
	  ..list_get() can't be free'd even while the flags inside it may
	  change. But only unused flags may change and only while calling
	  ..fix_list(), so it's no problem. Makes COPYing mails to selected
	  mailbox work.

2002-10-19 16:31  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: printf_string_upper_bound(): Instead of just
	  warning we can't handle something, panic. Much better idea than
	  guessing something.

2002-10-19 14:51  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, imap/client.h, imap/cmd-append.c,
	  imap/cmd-capability.c, imap/cmd-check.c, imap/cmd-close.c,
	  imap/cmd-copy.c, imap/cmd-expunge.c, imap/cmd-fetch.c,
	  imap/cmd-noop.c, imap/cmd-search.c, imap/cmd-select.c,
	  imap/cmd-store.c, imap/commands-util.c, imap/commands-util.h,
	  lib-imap/imap-util.c, lib-imap/imap-util.h,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-fetch.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-storage.c,
	  lib-storage/index/mbox/mbox-storage.h: MailStorage interface
	  change. We now let storage call several sync-functions whenever
	  it wants instead of forcing it through sync() function.

	  This now allows us to send client FLAGS and PERMANENTFLAGS
	  messages whenever new custom flags are added. Also EXPUNGE
	  command now goes nicely through expunge() function (which CLOSE
	  used) instead of through flag in sync().  "Out of disk space"
	  alert is also sent now whenever it happens, before it was sent
	  only when opening mailbox.

	  Message set parser now complains when referencing mail sequences
	  outside the possible range. Modify log before sent flags/expunges
	  changes to client even if it didn't know about those messages
	  yet. Also some other smaller cleanups.

	  Beginnings of fixing APPEND and COPY when trying to store mails
	  into selected mailbox. Before this didn't work too well or simply
	  broke things.  Still broken, needs a bit more changes..

2002-10-17 23:57  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: IMAP_ARG_EOL doesn't belong to number
	  of arguments in list.

2002-10-16 22:54  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-bodystructure.c,
	  lib-imap/imap-bodystructure.h, lib-index/mail-index.h: If
	  BODYSTRUCTURE is cached, we can use it to generate BODY reply. It
	  takes some CPU, but probably still faster than needing to open
	  the file.

	  Also removed requirement of FIELD_TYPE_LOCATION to exist in .data
	  file. This will be useful when we don't need the location (eg.
	  filename == uid).

2002-10-16 22:50  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-fetch.c, imap/cmd-search.c,
	  imap/cmd-status.c, imap/cmd-store.c, imap/commands-util.c,
	  imap/commands-util.h, lib-imap/imap-envelope.c,
	  lib-imap/imap-parser.c, lib-imap/imap-parser.h,
	  lib-storage/mail-search.c, lib-storage/mail-search.h,
	  lib-storage/index/index-fetch.c: ImapArgList changed from linked
	  list to array. easier to handle that way.

2002-10-16 15:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: Delete unused temp files.

2002-10-16 15:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: SEARCH SEEN, UNSEEN,
	  DELETED, UNDELETED, RECENT, UNRECENT optimizations.  We can limit
	  the fetched messages by checking lowwater marks in header.  We
	  can also immediately abort searching if header says there's no
	  messages with such flags.

2002-10-16 01:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: SEARCH SMALLER/LARGER - we
	  may be able to handle the request using only physical sizes,
	  avoids calculating the virtual size in those cases

2002-10-16 01:25  Timo Sirainen <tss@iki.fi>

	* INSTALL, configure.in: Added --with-mem-align=BYTES option

2002-10-16 01:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-fetch.c, index-fetch.h: FETCH
	  BODY[] sets \Seen flag to messages now while fetching it, not
	  only after a successful fetch. This means that index is locked
	  while doing this, and we also send FLAGS reply to client for
	  messages where it was changed.

2002-10-15 23:46  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-send.c, message-send.h: Fixed several
	  problems with FETCH BODY[..]<limits>, especially related to
	  handling missing CRs.

2002-10-15 21:35  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, doc/configuration.txt: doc updates

2002-10-15 20:53  Timo Sirainen <tss@iki.fi>

	* src/auth/main.c: Initialize random generator before chrooting so
	  it can open /dev/urandom

2002-10-15 01:04  Timo Sirainen <tss@iki.fi>

	* doc/configuration.txt: updated

2002-10-15 00:47  Timo Sirainen <tss@iki.fi>

	* doc/: design.txt, mail-storages.txt: updates

2002-10-15 00:45  Timo Sirainen <tss@iki.fi>

	* .cvsignore, INSTALL, README, doc/auth.txt, doc/configuration.txt,
	  doc/mail-storages.txt: Documentation updates.

2002-10-14 21:21  Timo Sirainen <tss@iki.fi>

	* INSTALL: Added installation document

2002-10-14 21:14  Timo Sirainen <tss@iki.fi>

	* configure.in: help update

2002-10-14 20:40  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-envelope.c: imap_envelope_parse() wasn't
	  working

2002-10-14 20:36  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: use p_realloc() instead of
	  p_realloc_min().

2002-10-14 20:26  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: p_realloc() was buggy

2002-10-14 17:48  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-send.c: check return value of
	  o_buffer_send() correctly

2002-10-14 00:32  Timo Sirainen <tss@iki.fi>

	* configure.in: bugfix

2002-10-14 00:27  Timo Sirainen <tss@iki.fi>

	* configure.in: checks for writev()

2002-10-13 23:49  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/client.h, imap/cmd-append.c,
	  imap/main.c, lib/Makefile.am, lib/compat.c, lib/compat.h,
	  lib/data-stack.c, lib/lib.h, lib/network.c, lib/network.h,
	  lib-imap/imap-bodystructure.c, lib-imap/imap-bodystructure.h,
	  lib-imap/imap-envelope.c, lib-imap/imap-parser.c,
	  lib-imap/imap-parser.h, lib-index/mail-index.h,
	  lib-mail/message-parser.c, lib-mail/message-parser.h,
	  lib-mail/message-send.c, lib-mail/message-send.h,
	  lib-mail/message-size.c, lib-mail/message-size.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-fetch.c,
	  lib-storage/index/index-fetch.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.h, master/auth-process.c,
	  master/login-process.c: Split IOBuffer into mmaped IBuffer, file
	  IBuffer, memory data IBuffer and file OBuffer.

2002-10-13 15:52  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Check return values for malloc()s
	  and calloc()s.

2002-10-11 22:33  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-envelope.c, lib-imap/imap-envelope.h,
	  lib-imap/imap-parser.c, lib-index/mail-index.h,
	  lib-storage/mail-search.c, lib-storage/mail-search.h,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c: Dropped sent_time and alignment
	  from MailIndexRecord. SEARCH can now use cached ENVELOPE data to
	  search FROM, TO, CC, BCC, SUBJECT, HEADER MESSAGE-ID and HEADER
	  IN-REPLY-TO. They're never cached anymore now. Also SEARCH SENT*
	  had to be changed to use ENVELOPE (or fallback to Date-header
	  parsing) because sent_time was removed.

2002-10-10 02:07  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: bugfix/cleanup

2002-10-10 02:01  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop.c, mempool-datastack.c, network.c: Created
	  datastack_mempool which is used by at least a few temporary
	  IOBuffers. Some other minor speedups/cleanups in IOBuffer and
	  elsewhere..

2002-10-10 01:45  Timo Sirainen <tss@iki.fi>

	* src/lib/Makefile.am: missing mempool-datastack.c

2002-10-09 20:49  Timo Sirainen <tss@iki.fi>

	* src/lib/: data-stack.c, data-stack.h, mempool.h:
	  s/t_try_grow/t_try_realloc/

2002-10-09 18:08  Timo Sirainen <tss@iki.fi>

	* src/lib/data-stack.h: typofix

2002-10-09 17:49  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth.c, lib/base64.h, lib/hex-binary.h,
	  lib-mail/message-content-parser.h, lib-mail/message-parser.h,
	  lib-mail/message-part-serialize.h, lib-storage/mail-storage.h:
	  changed all "temporary memory pool" references to "data stack"

2002-10-09 17:44  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, data-stack.c, data-stack.h, lib.c, lib.h:
	  s/temporary memory pool/data stack/ which is the correct name for
	  it.

2002-10-09 16:45  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: Parse Content-Language
	  correctly for BODYSTRUCTURE.

2002-10-09 14:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: whops, update tree and modifylog with
	  correct uid instead of 0. added extra assertions.

2002-10-09 13:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index.c, mail-index.h:
	  Fixes for first_hole_* updating. Removed last_lookup, it doesn't
	  speed up much anymore and it's just annoyance to keep valid.

2002-10-08 23:35  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: expunge fixes

2002-10-08 23:26  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, imap/main.c, lib/ioloop.c, lib/ioloop.h,
	  lib-index/mail-index-fsck.c, lib-index/mail-index.c,
	  lib-index/mail-index.h, master/main.c: ioloop_create() takes now
	  pool-parameter. io_buffer_create_mmaped() takes start_offset
	  parameter instead of getting it with lseek(). Instead of using
	  offsets to index file, we now use record indexes
	  (first_hole_index, tree file).

2002-10-08 23:22  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: Send error message if close() fails in
	  net_disconnect().

2002-10-08 00:55  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-select.c: \* flag was missing from PERMANENTFLAGS.

2002-10-06 16:08  Timo Sirainen <tss@iki.fi>

	* TODO: updated with lots of new capability comments

2002-10-06 11:03  Timo Sirainen <tss@iki.fi>

	* src/lib/restrict-access.c: kludge: localtime() must be called
	  before chroot(), or the timezone isn't known. fixes wrong
	  timestamps with login process.

2002-10-06 09:20  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-parser.c, lib-mail/message-parser.h,
	  lib-storage/index/index-search.c: message_parse_header() now
	  calls the function with empty name/value at end of headers. we
	  use this feature with mbox to allow usage of Content-Length
	  header field.

2002-10-06 07:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: Compress index when
	  50% of it is deleted.

2002-10-06 06:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: more locking fixes.

2002-10-06 05:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: mbox locking cleanups

2002-10-06 05:44  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, lib-index/mail-index.h,
	  lib-storage/index/index-fetch.c, lib-storage/index/index-fetch.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/mbox/mbox-save.c, master/auth-process.c,
	  master/login-process.c: Added io_buffer_set_start_offset() and
	  io_buffer_ref() and replaced io_buffer_destroy() with
	  io_buffer_unref().

	  mbox file is now kept open all the time.

2002-10-06 03:09  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Added autoclose_fd-flag for
	  io_buffer_create_file() and io_buffer_create_mmap().

2002-10-06 02:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Small optimization for
	  mail_index_lookup() when there's only one hole in index file.

2002-10-06 00:30  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/Makefile.am, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-sync.c: First version of binary tree
	  file, still some locking issues while opening the file.

2002-10-05 21:23  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 0.98.4 released

2002-10-05 21:18  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: compiler warning fixes

2002-10-05 21:07  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: compiler fixes

2002-10-05 21:04  Timo Sirainen <tss@iki.fi>

	* src/lib/: network.c, network.h: keep the port unsigned.

2002-10-05 20:39  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-parser.c, lib-mail/message-parser.c: compiler
	  warning fixes

2002-10-05 20:16  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: hpux compiler fix

2002-10-05 20:09  Timo Sirainen <tss@iki.fi>

	* src/lib/md5.c: Fix for hpux ansi compiler.

2002-10-05 20:06  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: Define CMSG_SPACE always if it's undefined, not
	  only if __sun__ is defined.

2002-10-04 19:28  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: extra checks

2002-10-04 17:15  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-send.c: message_send() didn't correctly add
	  CR to 256k boundaries.

2002-10-01 10:58  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: () was missing around envelope
	  in body/bodystructure.

2002-09-30 21:22  Timo Sirainen <tss@iki.fi>

	* configure.in: 0.98.3 version number update

2002-09-30 21:21  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO: 0.98.3 out..

2002-09-30 21:18  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/: Makefile.am, imap-bodystructure.c,
	  imap-envelope.c, imap-quote.c, imap-quote.h: Several fields in
	  BODY were unquoted.

2002-09-30 20:36  Timo Sirainen <tss@iki.fi>

	* TODO: update

2002-09-30 20:12  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 0.98.2 released

2002-09-30 20:02  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c:
	  message_part_serialize_update_header() was still broken, it
	  modified the start position of header record.

2002-09-29 23:08  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.h, lib-mail/message-part-serialize.c:
	  Cached MessagePart reading wasn't working because alignment broke
	  the strict size checking.

2002-09-29 22:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c: hardlink-COPY
	  fixed.

2002-09-29 18:01  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: cleanup

2002-09-29 17:54  Timo Sirainen <tss@iki.fi>

	* src/master/common.h: cleanup

2002-09-29 17:47  Timo Sirainen <tss@iki.fi>

	* src/lib/: mempool-alloconly.c, mempool-system.c: more ANSI-C
	  fixes.

2002-09-29 17:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: ANSI-C compatibility fixes

2002-09-29 17:41  Timo Sirainen <tss@iki.fi>

	* configure.in: s/--enable/--with/ to all auth modules. added
	  --with-file-offset-size=BITS

2002-09-29 16:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage.h, index/index-fetch.c,
	  index/index-search.c, index/index-sync.c,
	  index/maildir/maildir-copy.c: Modify log fixes. STORE and SEARCH
	  didn't handle properly message sequence numbers when some in the
	  middle were externally deleted.

2002-09-28 10:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-fetch.c, index-fetch.h: cleanup

2002-09-28 09:51  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-fetch.c, imap/cmd-search.c, imap/cmd-store.c,
	  imap/commands-util.c, imap/commands-util.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c: Send RECENT after all EXISTS
	  replies. Check for new mail in mailbox after each FETCH, STORE
	  and SEARCH commands and notify about it with EXISTS.

2002-09-26 17:06  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c:
	  message_part_serialize_update_header() didn't update positions
	  for subparts so they got broken with mbox when headers were
	  updated.

2002-09-25 21:25  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-select.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-status.c: When selecting a mailbox and
	  we're out of disk space, send ALERT to user telling about it.

2002-09-25 20:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Only first search condition
	  was checked.

2002-09-24 17:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: custom flags weren't
	  saved properly.

2002-09-24 17:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: mbox ignored message
	  flags for APPEND.

2002-09-24 16:52  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: released 0.98.1

2002-09-24 16:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: Rewrite only needed parts of mbox. We
	  don't rename() anymore, which means we play nicely now with
	  symlinks and avoid possible data loss when new mail was being
	  sent while we were rewriting.

2002-09-24 13:53  Timo Sirainen <tss@iki.fi>

	* src/lib/lib-signals.c: comment fix

2002-09-24 13:01  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, lib-imap/imap-parser.c: We didn't allow
	  saving messages longer than 8192 bytes. Now we also send the "+
	  OK" only after other parameters have been verified to be ok.

2002-09-24 07:01  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: BODY / BODYSTRUCTURE generator
	  didn't like if message didn't start from zero offset in inbuf.

2002-09-23 17:23  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: mbox-save.c, mbox-storage.c: CREATE
	  and DELETE fixes for mbox (last changes for .98 :)

2002-09-23 17:13  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 0.98 released.

2002-09-23 16:57  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-append.c, cmd-copy.c, cmd-create.c, cmd-rename.c,
	  cmd-subscribe.c, commands-util.c, commands-util.h: UNSUBSCRIBE
	  wasn't working.

2002-09-23 11:47  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-09-23 11:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: mbox locking changes.
	  support read-locking now. there's still problems though..

2002-09-23 10:42  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, imap/cmd-copy.c, imap/cmd-select.c,
	  imap/cmd-status.c, lib-index/mail-index.h,
	  lib-storage/mail-storage.h, lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: Added fast-flag for
	  mailbox opening, which doesn't do any index compressing or cache
	  updating. This flag is set when mailbox is opened by APPEND, COPY
	  or STATUS (ie. not SELECT/EXAMINE).

2002-09-23 10:30  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-logout.c: close mailbox before sending "OK Logout
	  completed", because the closing may take some time with mbox

2002-09-23 09:18  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-09-23 08:27  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/message-parser.c,
	  lib-storage/index/index-search.c: IOBuffer cleanup, hopefully
	  fixes some mbox problems.

2002-09-21 06:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/Makefile.am: missing header file

2002-09-20 11:57  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: list supported auth methods

2002-09-20 11:51  Timo Sirainen <tss@iki.fi>

	* configure.in: vpopmail needs also crypt()

2002-09-20 11:50  Timo Sirainen <tss@iki.fi>

	* configure.in: list vpopmail in auths list.

2002-09-20 11:47  Timo Sirainen <tss@iki.fi>

	* configure.in: print "checking vpopmail"

2002-09-20 11:27  Timo Sirainen <tss@iki.fi>

	* configure.in, dovecot-example.conf, src/auth/Makefile.am:
	  vpopmail authentication. compiles, not tested if it really works.

2002-09-20 11:25  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Print usage with invalid parameters.

2002-09-20 05:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-fsck.c, mail-index.c: Index
	  compression broke it + few other fixes

2002-09-20 05:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c: fsck() now prints what
	  differences it found

2002-09-19 17:49  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-content-parser.c:
	  message_content_parse_header() didn't parse the header properly
	  and just skipped all but the first parameter.

2002-09-17 05:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: FSCK flag is removed at set_lock(),
	  so it can't be directly set anywhere..  but using
	  index->set_flags |= FSCK now keeps it. fixes mbox problems after
	  flag changes.

2002-09-17 01:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: expunging last message
	  from mbox duplicated the whole file. appending mail to mbox works
	  now too.

2002-09-17 01:49  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: message_parse_header() went to
	  infinite loop with partial header

2002-09-16 14:16  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-envelope.c: \r\n chars are now always stripped
	  from headers before placing them in envelope.

2002-09-16 13:51  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-status.c: if hash was rebuilt, it wasn't
	  always mmap()ed. recent-status wasn't updated properly when
	  opening mails. maildir sync() didn't always expunge messages with
	  correct sequence number. added some checks for messages_count in
	  header.

2002-09-16 12:59  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-fetch.c, index-fetch.h: Report
	  FETCH failure properly

2002-09-16 12:28  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-subscribe.c: UNSUBSCRIBE didn't work if folder
	  didn't exist.

2002-09-16 07:39  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_lookup() didn't always
	  return correct record..

2002-09-16 06:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: cleanup/fix

2002-09-16 06:33  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: message_parse_header() works now
	  properly if there's no message body at all, or if the ending \n
	  is missing from header.

2002-09-16 05:52  Timo Sirainen <tss@iki.fi>

	* src/lib/file-set-size.c: file_set_size() was buggy when it was
	  supposed to shrink file

2002-09-16 05:44  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-status.c: bugfix

2002-09-16 05:20  Timo Sirainen <tss@iki.fi>

	* configure.in: report --without-gnutls better..

2002-09-16 05:19  Timo Sirainen <tss@iki.fi>

	* configure.in: another typo .. maybe --without-gnutls works now :)

2002-09-16 05:18  Timo Sirainen <tss@iki.fi>

	* configure.in: typo..

2002-09-16 05:16  Timo Sirainen <tss@iki.fi>

	* configure.in: added --without-gnutls option

2002-09-16 05:09  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: ..and don't #undef the linux mremap()
	  support..

2002-09-16 05:09  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-anon.c: portability fixes

2002-09-16 04:16  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: bugfixes

2002-09-16 04:01  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, lib-index/mail-index.c: Fixes for no
	  diskspace handling. seems to work now.

2002-09-16 03:33  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: previous t_push()/t_pop() changes break
	  things. fixed :)

2002-09-16 03:13  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-09-16 03:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Modify log is now able to stay in
	  memory. Some other fixes/cleanups.

2002-09-16 02:07  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: t_push()/t_pop() around various *sprintf()
	  functions, so "%m" format won't eat extra memory.

2002-09-15 11:09  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-parser.c, message-send.c, message-size.c:
	  s/io_buffer_read_data/io_buffer_read_data_blocking/ and fixed the
	  various kludges elsewhere to use it more easily

2002-09-15 07:20  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-status.c, lib-storage/index/index-status.c: minor
	  fixes

2002-09-15 07:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: messages flags were added twice to
	  header

2002-09-15 07:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: always verify the seen/deleted
	  message counts in index header

2002-09-15 06:31  Timo Sirainen <tss@iki.fi>

	* configure.in: mremap() check

2002-09-15 06:30  Timo Sirainen <tss@iki.fi>

	* src/: lib/write-full.h, lib-index/mail-index.c,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/mbox/mbox-save.c: More cleanups. lib-storage
	  should handle "out of disk space" conditions properly.

2002-09-14 11:09  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, lib/Makefile.am, lib/file-lock.c,
	  lib/file-lock.h, lib/file-set-size.c, lib/file-set-size.h,
	  lib/mmap-anon.c, lib/mmap-util.c, lib/mmap-util.h,
	  lib-index/Makefile.am, lib-index/mail-index-fsck.c,
	  lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-fetch.c, lib-storage/index/index-fetch.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-status.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/subscription-file/subscription-file.c: lots of
	  cleanups. also index/datafile is now capable of staying in
	  memory, as long as it's noticed while opening the index.

2002-09-13 00:01  Timo Sirainen <tss@iki.fi>

	* src/: lib/Makefile.am, lib/file-set-size.c, lib/file-set-size.h,
	  lib/mmap-util.c, lib/mmap-util.h, lib-index/mail-index.c,
	  lib-storage/index/index-status.c: Added extra functions for
	  easier printing of error messages. Moved file_set_size() to
	  generic function in lib. If there's no space to build hash file,
	  it builds itself in anon-mmaped memory and stays there.

2002-09-12 23:09  Timo Sirainen <tss@iki.fi>

	* src/lib/: failures.c, failures.h: make sure failure handlers
	  don't modify errno.

2002-09-10 03:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: expunge() shouldn't update mmap,
	  since we could be just going through the index records.

2002-09-10 03:32  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: SEARCH fixes

2002-09-10 03:06  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: message/rfc822 mime parts weren't
	  parsed correctly

2002-09-10 02:58  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: crashfix for searching from
	  message body

2002-09-10 02:52  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Actually, don't bother fsyncing after
	  each written mail, it slows down too much and the corruption can
	  be handled later just fine.

2002-09-10 02:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: Don't rewrite mbox if no flags were
	  changed.

2002-09-10 01:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: Broke saving new mail

2002-09-09 22:49  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: cleanups /
	  reliability fixes

2002-09-09 13:32  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.h: cast i_toupper() and i_tolower() return as
	  char, so comparing highascii works without casting (breaks if
	  comparing to unsigned char though)

2002-09-09 13:22  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-envelope.c: Highascii + space at end of some
	  ENVELOPE header got into infinite loop.

2002-09-09 02:11  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-storage/index/index-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: X-IMAPbase is now parsed
	  correctly.

2002-09-08 15:34  Timo Sirainen <tss@iki.fi>

	* src/: lib/hash.c, lib/macros.h, master/common.h,
	  master/login-process.c: Replaced INT_TO_POINTER and
	  POINTER_TO_INT macros with POINTER_CAST and POINTER_CAST_TO
	  macros, the CAST_TO takes a parameter to which type we're casting
	  to. Also POINTER_CAST should be valid ANSI-C now.

2002-09-08 15:19  Timo Sirainen <tss@iki.fi>

	* src/: lib/macros.h, lib-imap/imap-bodystructure.c,
	  lib-index/mail-index.c, lib-index/mail-index.h: more size_t
	  fixes.

2002-09-08 15:09  Timo Sirainen <tss@iki.fi>

	* src/lib/lib.c: more size_t fixes

2002-09-08 15:08  Timo Sirainen <tss@iki.fi>

	* configure.in: ssize_t should be checked against long before long
	  long.

2002-09-08 14:59  Timo Sirainen <tss@iki.fi>

	* src/lib/lib.c: ..and now it uses size_t properly..

2002-09-08 14:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: lib.c, lib.h, macros.h: nearest_power() uses now
	  size_t.

2002-09-08 14:54  Timo Sirainen <tss@iki.fi>

	* configure.in: result of ssize_t check wasn't reported

2002-09-08 14:53  Timo Sirainen <tss@iki.fi>

	* configure.in: fixed ssize_t and off_t checks.

2002-09-08 14:39  Timo Sirainen <tss@iki.fi>

	* src/: imap/client.c, imap/cmd-append.c, lib/base64.c,
	  lib/base64.h, lib-imap/imap-envelope.c, lib-imap/imap-envelope.h,
	  lib-imap/imap-parser.c, lib-imap/imap-util.c,
	  lib-index/mail-index.h, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-mail/message-part-serialize.c,
	  lib-mail/message-part-serialize.h, lib-mail/message-send.c,
	  lib-mail/message-size.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.h,
	  lib-storage/subscription-file/subscription-file.c: move size_t
	  fixes

2002-09-08 13:20  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/commands-util.c, src/lib/base64.c,
	  src/lib/base64.h, src/lib/fdpass.c, src/lib/fdpass.h,
	  src/lib/hex-binary.c, src/lib/hex-binary.h, src/lib/imem.c,
	  src/lib/imem.h, src/lib/md5.c, src/lib/md5.h,
	  src/lib/mempool-alloconly.c, src/lib/mempool-system.c,
	  src/lib/mempool.c, src/lib/mempool.h, src/lib/mmap-util.c,
	  src/lib/network.c, src/lib/network.h, src/lib/randgen.c,
	  src/lib/randgen.h, src/lib/strfuncs.c, src/lib/strfuncs.h,
	  src/lib/write-full.c, src/lib-imap/imap-bodystructure.c,
	  src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-search.c: size_t fixes for lib/.
	  Changed OFF_T_FORMAT to PRIuOFF_T which is more C99-like.

2002-09-08 13:08  Timo Sirainen <tss@iki.fi>

	* src/imap/Makefile.am: flags-file isn't needed anymore

2002-09-08 13:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c: mbox compilation fix

2002-09-08 11:36  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.h, src/lib/hostpid.c, src/lib/lib.h,
	  src/lib/strfuncs.c, src/lib/strfuncs.h: added dec2str() function
	  and largest_t type, removed itoa() and ltoa() macros and did some
	  other cleanups.

2002-09-08 10:25  Timo Sirainen <tss@iki.fi>

	* src/lib/macros.h: Better fix for POINTER_TO_UINT

2002-09-08 10:17  Timo Sirainen <tss@iki.fi>

	* src/lib/macros.h: POINTER_TO_UINT() fixed to not give warnings
	  with 64bit pointers.

2002-09-08 09:52  Timo Sirainen <tss@iki.fi>

	* src/lib/compat.c: missed header file with some conditions.

2002-09-07 23:31  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-index/Makefile.am,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-storage/Makefile.am, src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-status.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/index-sync.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c: Moved custom flags
	  handling into lib-index.

2002-09-07 02:06  Timo Sirainen <tss@iki.fi>

	* src/imap/: cmd-fetch.c, cmd-store.c: updated error messages for
	  FETCH/STORE when expunged messages were referenced. we use now
	  exactly the same as rfc2180.

2002-09-07 01:52  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/Makefile.am, lib-storage/index/Makefile.am,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/maildir/maildir-copy.c: Moved
	  lib-index/mail-messageset.* to
	  lib-storage/index/index-messageset.*.

2002-09-07 01:32  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: Don't strip extra spaces after
	  "field: ".

2002-09-06 21:51  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-envelope.c: Convert 8bit text in headers to
	  quoted-printable in ENVELOPE.

2002-09-06 19:27  Timo Sirainen <tss@iki.fi>

	* doc/multiaccess.txt: typofix

2002-09-06 17:27  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Added io_buffer_read_blocking() which can be
	  used to read data blockingly, but with a specified timeout.
	  Client fds are now nonblocking and use it with APPEND fixing a
	  possible infinite wait if client didn't send any data.

2002-09-06 13:45  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-part-serialize.c,
	  message-part-serialize.h: continuing mbox updates

2002-09-06 13:43  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c,
	  lib-storage/index/mbox/mbox-storage.c: Bigger changes..
	  full_virtual_size was removed from index record and MessagePart
	  caching is now forced. Also added per-message flags, including
	  binary flags which can be used to check if CRs need to be
	  inserted into message data.

	  Added mbox-rewrite support which can be used to write out mbox
	  file with updated flags. This still has the problem of being able
	  to read changed custom flags, that'll require another bigger
	  change.

	  There's also several other mostly mbox related fixes.

2002-09-06 13:29  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: net_accept() set listening socket nonblocking,
	  not the new socket. thanks to james.antill@redhat.com for
	  noticing.

2002-09-05 12:52  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Flush output buffer to client at exit, and
	  send a nice "BYE Server shutting down." message when we're being
	  killed.

2002-09-04 16:17  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: message_parse_header() was buggy
	  with big headers, and io_buffer_read_data() should have returned
	  the data so far even if it overflowed.

2002-09-04 15:24  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: s/updateid/sync_id/
	  like it was with modify log.

2002-09-04 15:19  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: index wasn't
	  re-mmap()ed when it's size was changed. this is now done by
	  updating "updateid" field in header and checking if it has
	  changed. also the previous hash-rebuild-check was broken.

2002-09-04 14:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: make sure the hash gets rebuilt if it
	  wasn't opened yet when message was being expunged (probably
	  unnecessary)

2002-09-03 23:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: more verbose error messages for hash
	  corruption

2002-09-03 23:04  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_mark_flag_changes() didn't
	  update deleted-flag changes if there were seen-flag changes..

2002-09-03 22:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.h: index_expunge_seek_first()
	  now separates between "not found" and "failure".  also updated
	  it's error message to be more verbose.

2002-09-03 21:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: verify that mail_hash_lookup_uid()
	  returns offset to correct record.

2002-09-03 21:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: more
	  INBOX-sensitivity fixes

2002-09-03 20:52  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: "CREATE
	  Inbox.sub" created it using that case, instead of "INBOX.sub"
	  which caused trouble.

2002-09-03 20:44  Timo Sirainen <tss@iki.fi>

	* src/: imap/commands-util.c,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-storage.c: "Mailbox doesn't exist"
	  error now gives the name of the mailbox that was tried to be
	  accessed.

2002-09-03 20:15  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-send.c: Removed buffering, it's done by
	  io_buffer_send() now.

2002-09-03 20:08  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-parser.c: because the iobuffer is now buffered,
	  the "+ OK" continuation request wasn't actually sent to client ..
	  we flush it now.

2002-09-03 19:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: update

2002-09-03 19:56  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: previous fix for updating initial
	  message flags wasn't done correctly

2002-09-03 19:31  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Flags for new messages weren't set
	  properly, so the header sum counters were wrong.

2002-09-02 19:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: APPEND always saved
	  mails to INBOX with maildir.

2002-09-02 19:14  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-date.c: IMAP date+time parser bugfix

2002-09-02 19:08  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-append.c, lib-imap/Makefile.am,
	  lib-imap/imap-date.c, lib-imap/imap-date.h,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-search.c: Whops, we were using RFC822
	  dates everywhere instead of IMAP dates.

2002-09-02 18:14  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: APPEND was broken.

2002-09-02 18:13  Timo Sirainen <tss@iki.fi>

	* src/lib/write-full.c: write_full(): behave correctly if given
	  size was 0.

2002-09-02 17:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Reset index error message
	  after it's been moved to storage.

2002-09-02 17:11  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-part-serialize.c,
	  message-part-serialize.h: forgot to add before

2002-09-02 17:10  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-bodystructure.c, lib-mail/message-parser.c:
	  Fixed rfc822_tokens_get_value(). It doesn't have "put spaces
	  around all tokens" option anymore, but instead spaces are always
	  put between atoms.  This should fix address fields with non-7bit
	  charset.

2002-09-02 11:39  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-fetch.c, index-fetch.h: avoid
	  sending extra spaces in FETCH reply.

2002-09-02 06:23  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: index->lookup_uid_range()
	  optimization for first_uid <= first UID in mailbox.

2002-09-02 06:22  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: specifying
	  messageset/uidset in SEARCH broke it

2002-09-02 02:39  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: removed useless (void *) cast.

2002-09-02 02:31  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-bodystructure.c, lib-index/mail-index.h,
	  lib-mail/Makefile.am, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-storage/index/Makefile.am,
	  lib-storage/index/index-fetch.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h: Added support for caching of
	  MessagePart data. This is useful for fetching body[part]s. Also
	  BODY and BODYSTRUCTURE can be generated fast using it.

	  Also fixed index corruption in some situations when more cached
	  data was added to index.

2002-08-31 23:57  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/imap-bodystructure.c, lib-mail/message-parser.c,
	  lib-mail/message-parser.h: there was no need for
	  MessagePart->pos.virtual_pos, so removed it.

2002-08-31 20:12  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: added
	  index->lookup_field_raw() and update_field_raw(), changed mbox to
	  save the offsets in raw uoff_t instead of hex encoded.

2002-08-31 16:02  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Fixed some index rebuilding
	  behaviour.

2002-08-31 15:45  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: ".log.2" is also possible index file.

2002-08-31 15:24  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-index.c,
	  src/lib-storage/index/maildir/maildir-list.c: Added
	  overwrite_incompatible_index setting. Also we now try to use only
	  .imap.index-<hostname> and .imap.index index files instead of
	  scanning the dir for any compatible index. This also fixes
	  (partly) LIST giving \Marked flag when there's no new mails.

2002-08-29 19:21  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-select.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-status.c: Custom flags are now shown in
	  FLAGS and PERMANENTFLAGS lists after SELECT.	It also warns if
	  there's for some reason a duplicate index number in custom flags
	  file.

2002-08-29 18:21  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Don't send \Children or \NoChildren flags
	  for LIST anymore, we never supported the CHILDREN draft properly,
	  and it's not becoming standard anyway. Get it back in when/if we
	  add support for LISTEXT draft.

2002-08-29 00:01  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 0.97 released

2002-08-28 22:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: bugfix for sync fix

2002-08-28 22:33  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: reset modifylog sync mark at the end
	  of opening index file

2002-08-28 21:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: last_lookup wasn't reset after
	  mmap(). still feels somewhat buggy though..

2002-08-28 18:46  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Still memaligns

2002-08-28 18:20  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-index.h: MailHashHeader is now
	  8-byte aligned. Fixed other header alignments too and stored
	  MEM_ALIGN_SIZE into compat_data[].

2002-08-28 18:06  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: t_strsplit(): bad typobug..

2002-08-28 17:56  Timo Sirainen <tss@iki.fi>

	* src/lib/: mempool-alloconly.c, mempool-system.c: Allocated memory
	  wasn't aligned according to MEM_ALIGN_SIZE.

2002-08-28 17:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: wrong assert()s :)

2002-08-28 04:57  Timo Sirainen <tss@iki.fi>

	* configure.in: added -Wcast-qual to list of "remember to test
	  with" cflags :)

2002-08-28 04:54  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-fetch.c, imap/commands.c, lib/network.c,
	  lib/strfuncs.c, lib/strfuncs.h: added t_strdup_noconst() which
	  can be used instead of (char *) t_strdup().  Removed several
	  castings that removed the const qualifier.

2002-08-28 04:43  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: casting fixes

2002-08-28 04:41  Timo Sirainen <tss@iki.fi>

	* src/lib/: randgen.c, randgen.h: removed const attribute from
	  buffer argument for random_fill(), that really shouldn't have
	  been there..

2002-08-28 03:46  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-08-28 00:59  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib-index/mail-index.c,
	  src/lib-index/mail-index.h: Use 8 byte memory alignment by
	  default. Also fixed index headers a bit to be 8 byte aligned.

2002-08-28 00:17  Timo Sirainen <tss@iki.fi>

	* src/lib/hash.c: Don't include system headers before lib.h, since
	  config.h may change their behaviour (64bit off_t)

2002-08-28 00:11  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, sendfile-util.c, sendfile-util.h:
	  sendfile() works now properly with 64bit off_t

2002-08-28 00:11  Timo Sirainen <tss@iki.fi>

	* src/lib/lib.h: config.h should be included first.

2002-08-27 23:39  Timo Sirainen <tss@iki.fi>

	* configure.in, src/lib/compat.h, src/lib/lib.h,
	  src/lib/strfuncs.h: 64bit off_t fixes

2002-08-27 23:27  Timo Sirainen <tss@iki.fi>

	* configure.in: whops, 64bit support was disabled.

2002-08-27 21:51  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: bugfixes for overflow checks :)

2002-08-27 21:36  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/mail-index.c, lib-index/mail-index.h,
	  lib-storage/index/index-status.c, lib-storage/index/index-sync.c:
	  More overflow fixes.

2002-08-27 21:04  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Some cleanups, assertion
	  fixes.

2002-08-27 19:16  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/cmd-fetch.c, src/lib/lib.h,
	  src/lib/strfuncs.c, src/lib-imap/imap-bodystructure.c,
	  src/lib-imap/imap-envelope.c, src/lib-imap/imap-parser.c,
	  src/lib-imap/imap-parser.h, src/lib-index/mail-index-fsck.c,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-mail/message-parser.c, src/lib-mail/message-parser.h,
	  src/lib-mail/message-send.c, src/lib-mail/message-send.h,
	  src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-search.c, src/master/main.c:
	  Introduced uoff_t which is the unsigned-equilevant of off_t. This
	  was needed to be able to handle off_t overflows properly. Also
	  changed a few unsigned int fields into uoff_t so we should now
	  support >2G mails if uoff_t is 64bit. Also fixed several
	  potential integer overflows.

2002-08-27 03:36  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.h: More cleanups / potential overflow
	  fixes

2002-08-27 03:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-fetch.c, index-storage.c,
	  index-storage.h, maildir/maildir-copy.c: Errors in user-specified
	  messagesets are now properly reported back to user.

2002-08-27 03:28  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: fixes for messageset
	  handling

2002-08-27 02:28  Timo Sirainen <tss@iki.fi>

	* src/lib/: hash.c, primes.c, primes.h: Changed behaviour of
	  primes_closest() to return given number back if it's a prime
	  itself.

2002-08-27 02:27  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-util.c: Fail if we try to mmap() files larger than
	  2G fully to memory

2002-08-26 21:20  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Some fixes to checking if SSL should be used.

2002-08-26 21:07  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: imaps host was resolved wrong

2002-08-26 21:03  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c,
	  src/master/main.c: Added log_path and log_timestamp settings to
	  config file. Removed -l command line option for imap-master.

2002-08-26 20:49  Timo Sirainen <tss@iki.fi>

	* src/lib/network.c: fixed compile warnings with some systems

2002-08-26 20:15  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: A bit better index file truncating:
	  Truncate it also when first hole reaches to end of file, even if
	  all messages weren't deleted.

2002-08-26 19:17  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: when all mail is deleted, truncate
	  the index files.

2002-08-25 23:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: Make sure mbox file ends
	  with \n when appending new mail to it

2002-08-25 23:46  Timo Sirainen <tss@iki.fi>

	* TODO, src/lib/Makefile.am, src/lib/write-full.c,
	  src/lib/write-full.h, src/lib-index/Makefile.am,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/subscription-file/subscription-file.c: Added
	  write_full() which is a simple wrapper around write() meant for
	  writing into files.

	  When there's too much deleted data in index files, they're now
	  compressed when the index is being opened.

2002-08-25 23:22  Timo Sirainen <tss@iki.fi>

	* src/lib/fdpass.c: comment update

2002-08-25 21:31  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: default to PAM authentication

2002-08-25 20:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Don't allow '\'
	  character in mailbox name.

2002-08-25 20:50  Timo Sirainen <tss@iki.fi>

	* src/: lib-index/Makefile.am, lib-index/mail-index.c,
	  lib-index/mail-index.h, lib-storage/index/index-fetch.c: after a
	  few times of trying to access uncached fields, they're cached the
	  next time mailbox is opened. also some mbox fixes.

2002-08-25 17:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  mbox/mbox-storage.c: Don't allow using "../" anywhere in mailbox
	  names.

2002-08-24 02:04  Timo Sirainen <tss@iki.fi>

	* src/: imap/main.c, lib-imap/imap-parser.c, lib-index/Makefile.am,
	  lib-index/mail-index.h, lib-storage/mail-storage.c,
	  lib-storage/mail-storage.h,
	  lib-storage/index/maildir/maildir-storage.c,
	  lib-storage/index/mbox/mbox-save.c,
	  lib-storage/index/mbox/mbox-storage.c: mbox fixes, not fully
	  working yet but almost :)

2002-08-23 16:21  Timo Sirainen <tss@iki.fi>

	* COPYING, src/lib/md5.c, src/lib/md5.h: Replaced the MD5
	  implementation with Solar Designer's.

2002-08-23 14:53  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.h: added MAX_LONG_STRLEN and ltoa() macro

2002-08-23 14:52  Timo Sirainen <tss@iki.fi>

	* src/lib/hex-binary.h: comment update

2002-08-22 22:20  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-08-22 22:19  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-send.c: bugfix

2002-08-22 22:12  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c: call imap_message_close() at
	  the end of FETCH, so no message files are left open.

2002-08-22 22:01  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-send.c, message-send.h: message_send()
	  buffers data now instead of making lots of write() calls, so it
	  should be faster.

2002-08-22 14:50  Timo Sirainen <tss@iki.fi>

	* TODO, src/lib-storage/mail-storage.c,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c: "Critical errors"
	  aren't displayed to users anymore, ie. anything that is not a
	  predefined human readable error message is written into log file
	  and user gets only "Internal error [timestamp]".

2002-08-22 14:26  Timo Sirainen <tss@iki.fi>

	* src/: lib-imap/Makefile.am, lib-mail/Makefile.am,
	  lib-mail/message-send.c, lib-mail/message-send.h,
	  lib-storage/index/index-fetch.c: moved
	  lib-imap/imap-message-send.* into lib-mail/message-send.*

2002-08-22 13:27  Timo Sirainen <tss@iki.fi>

	* TODO: updated

2002-08-22 12:48  Timo Sirainen <tss@iki.fi>

	* src/: auth/auth.c, auth/auth.h, auth/main.c, imap/client.c,
	  imap/cmd-list.c, imap/cmd-store.c, imap/commands-util.c,
	  lib/hash.c, lib/hash.h, lib/ioloop-internal.h, lib/ioloop-poll.c,
	  lib/ioloop-select.c, lib/ioloop.c, lib/ioloop.h,
	  lib-imap/imap-bodystructure.c, lib-index/mail-index.h,
	  lib-mail/message-content-parser.c,
	  lib-mail/message-content-parser.h, lib-mail/message-parser.c,
	  lib-mail/message-parser.h, lib-storage/mail-search.c,
	  lib-storage/mail-search.h, lib-storage/mail-storage.h,
	  lib-storage/index/index-fetch.c, lib-storage/index/index-fetch.h,
	  lib-storage/index/index-search.c,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/index-sync.c,
	  lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-list.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/mbox/mbox-list.c,
	  lib-storage/index/mbox/mbox-storage.h,
	  lib-storage/subscription-file/subscription-file.c,
	  lib-storage/subscription-file/subscription-file.h,
	  master/auth-process.c, master/auth-process.h,
	  master/login-process.c, master/main.c: s/user_data/context/ and
	  some s/Data/Context/

2002-08-22 12:12  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-parser.c, message-parser.h,
	  message-size.c: fixes, seems to be somewhat working now.

2002-08-21 22:45  Timo Sirainen <tss@iki.fi>

	* src/lib/strfuncs.c: added some extra asserts

2002-08-21 22:45  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/message-parser.c: removed useless p_free() calls

2002-08-21 22:35  Timo Sirainen <tss@iki.fi>

	* src/lib/mmap-util.c: mmap_aligned() was buggy

2002-08-21 22:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap/client.c, src/imap/cmd-fetch.c,
	  src/imap/cmd-list.c, src/lib/compat.c, src/lib/compat.h,
	  src/lib/imem.c, src/lib/imem.h, src/lib/mmap-util.c,
	  src/lib/strfuncs.c, src/lib/strfuncs.h,
	  src/lib-imap/imap-bodystructure.c,
	  src/lib-imap/imap-bodystructure.h, src/lib-imap/imap-parser.c,
	  src/lib-index/Makefile.am, src/lib-index/mail-index-fsck.c,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-mail/message-parser.c, src/lib-mail/message-parser.h,
	  src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	  src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	  src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/subscription-file/subscription-file.c: Message
	  data is parsed in blocks (no longer entirely mmap()ed). Several
	  IOBuffer changes. All mixed signed/unsigned comparisions were
	  fixed so code can now be compiled with gcc's -W flag. mbox
	  support is broken currently, and there's most likely several
	  other problems too.

2002-08-09 09:23  Timo Sirainen <tss@iki.fi>

	* NEWS: moved ChangeLog into NEWS, ChangeLog will contain CVS
	  changes now

2002-08-09 09:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/.cvsignore: updated

2002-08-09 09:18  Timo Sirainen <tss@iki.fi>

	* COPYING, src/lib-storage/Makefile.am: fixes

2002-08-09 09:15  Timo Sirainen <tss@iki.fi>

	* .cvsignore, AUTHORS, Makefile.am, NEWS, README, TODO, autogen.sh,
	  configure.in, dovecot-example.conf, src/Makefile.am,
	  src/lib/Makefile.am, src/lib/compat.c, src/lib/compat.h,
	  src/lib/failures.c, src/lib/failures.h, src/lib/fdpass.c,
	  src/lib/fdpass.h, src/lib/hash.c, src/lib/hash.h, src/lib/imem.c,
	  src/lib/imem.h, src/lib/ioloop-internal.h, src/lib/ioloop-poll.c,
	  src/lib/ioloop-select.c, src/lib/ioloop.c, src/lib/ioloop.h,
	  src/lib/lib.c, src/lib/lib.h, src/lib/macros.h,
	  src/lib/mempool.h, src/lib/network.c, src/lib/network.h,
	  src/lib/primes.c, src/lib/primes.h, src/lib/strfuncs.c,
	  src/lib/strfuncs.h, src/lib/hex-binary.c, src/lib/hex-binary.h,
	  src/lib/randgen.c, src/lib/unlink-lockfiles.h,
	  src/lib/mempool-alloconly.c, src/lib/lib-signals.c,
	  src/lib/lib-signals.h, src/lib/md5.h, src/lib/mempool.c,
	  src/lib/md5.c, src/lib/mempool-system.c, src/lib/randgen.h,
	  src/lib/restrict-access.c, src/lib/unlink-lockfiles.c,
	  src/lib/base64.c, src/lib/base64.h, src/lib/hostpid.c,
	  src/lib/mmap-util.c, src/lib/mmap-util.h,
	  src/lib/restrict-access.h, src/lib/unlink-directory.c,
	  src/lib/unlink-directory.h, src/imap/Makefile.am,
	  src/imap/client.c, src/imap/client.h, src/imap/cmd-copy.c,
	  src/imap/cmd-logout.c, src/imap/cmd-store.c, src/imap/common.h,
	  src/imap/main.c, src/imap/cmd-append.c,
	  src/imap/cmd-authenticate.c, src/imap/cmd-check.c,
	  src/imap/cmd-create.c, src/imap/cmd-delete.c,
	  src/imap/cmd-examine.c, src/imap/cmd-list.c, src/imap/cmd-lsub.c,
	  src/imap/cmd-rename.c, src/imap/cmd-status.c,
	  src/imap/cmd-unsubscribe.c, src/imap/commands-util.h,
	  src/imap/cmd-capability.c, src/imap/cmd-close.c,
	  src/imap/cmd-expunge.c, src/imap/cmd-fetch.c,
	  src/imap/cmd-login.c, src/imap/cmd-noop.c, src/imap/cmd-search.c,
	  src/imap/cmd-select.c, src/imap/cmd-subscribe.c,
	  src/imap/cmd-uid.c, src/imap/commands-util.c,
	  src/imap/commands.c, src/imap/commands.h, src/master/.cvsignore,
	  src/master/Makefile.am, src/master/auth-process.c,
	  src/master/auth-process.h, src/master/common.h,
	  src/master/main.c, src/lib-storage/.cvsignore,
	  src/lib-storage/Makefile.am, src/lib-storage/mail-storage.c,
	  src/master/login-process.c, src/master/login-process.h,
	  src/lib-storage/mail-search.c, src/lib-storage/mail-search.h,
	  src/lib-storage/mail-storage.h,
	  src/lib-storage/index/Makefile.am,
	  src/lib-storage/index/index-status.c,
	  src/lib-storage/index/index-storage.c,
	  src/lib-storage/index/index-storage.h,
	  src/lib-storage/index/index-sync.c,
	  src/lib-storage/index/index-fetch.c,
	  src/lib-storage/index/index-fetch.h,
	  src/lib-storage/index/index-search.c,
	  src/lib-storage/index/mbox/Makefile.am,
	  src/lib-storage/index/mbox/mbox-save.c,
	  src/lib-storage/index/maildir/Makefile.am,
	  src/lib-storage/index/maildir/maildir-copy.c,
	  src/lib-storage/index/maildir/maildir-save.c,
	  src/lib-storage/index/mbox/mbox-list.c,
	  src/lib-storage/index/mbox/mbox-storage.c,
	  src/lib-storage/index/mbox/mbox-storage.h,
	  src/lib-imap/Makefile.am, src/lib-imap/imap-util.c,
	  src/lib-imap/imap-util.h,
	  src/lib-storage/index/maildir/maildir-list.c,
	  src/lib-storage/index/maildir/maildir-storage.c,
	  src/lib-storage/index/maildir/maildir-storage.h,
	  src/lib-storage/subscription-file/Makefile.am,
	  src/lib-storage/subscription-file/subscription-file.c,
	  src/lib-storage/subscription-file/subscription-file.h,
	  src/lib-imap/imap-bodystructure.h, src/lib-imap/imap-parser.c,
	  src/lib-imap/imap-parser.h, src/lib-imap/imap-bodystructure.c,
	  src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h,
	  src/lib-imap/imap-match.c, src/lib-imap/imap-match.h,
	  src/lib-mail/Makefile.am, src/lib-mail/message-content-parser.c,
	  src/lib-mail/message-content-parser.h,
	  src/lib-mail/message-parser.c, src/lib-mail/message-parser.h,
	  src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	  src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	  src/lib-index/Makefile.am, src/lib-index/mail-index-fsck.c,
	  src/auth/Makefile.am, src/auth/auth.c, src/auth/auth.h,
	  src/auth/common.h, src/auth/main.c, src/auth/.cvsignore,
	  doc/Makefile.am, doc/auth.txt, doc/design.txt, doc/index.txt,
	  doc/multiaccess.txt, doc/nfs.txt: Initial revision

2002-08-09 09:15  Timo Sirainen <tss@iki.fi>

	* .inslog2, stamp.h.in, COPYING.LGPL, src/.cvsignore,
	  src/lib/.cvsignore, src/lib/hostpid.h, src/imap/.cvsignore,
	  src/lib-storage/index/.cvsignore,
	  src/lib-storage/index/mbox/.cvsignore,
	  src/lib-storage/index/maildir/.cvsignore,
	  src/lib-storage/subscription-file/.cvsignore,
	  src/lib-imap/.cvsignore, src/lib-mail/.cvsignore,
	  src/lib-index/.cvsignore, doc/.cvsignore: initial import

