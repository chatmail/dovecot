2007-08-01  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	Released v1.0.3.
	[ab25de86a7e0] [tip]

	* src/imap-login/client.c, src/pop3-login/client.c:
	If STARTTLS failed because max. number of connections for process
	was reached, don't assert-crash.
	[1022900fec05]

	* src/auth/db-ldap.c:
	Retrying delayed auth binds after LDAP server reconnection assert-
	crashed.
	[1860d1dcee4c]

2007-07-30  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-ldap.c:
	auth_bind=yes and empty auth_bind_userdn leaked memory.
	[7009b4409849]

2007-07-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c:
	Ignore inotify_rm_watch() failing with EINVAL.
	[faf0bb8cd57d]

2007-07-24  Timo Sirainen  <tss@iki.fi>

	* src/imap/namespace.c:
	Call mail storage creation hook before getting namespace separator,
	so that it can be changed by a plugin.
	[a23be6956727]

2007-07-23  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If Sieve script didn't save the message anywhere, we saved it to
	INBOX.
	[be2c4dacae2c]

2007-07-21  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	If login_user == mail uid, we logged an error but didn't really
	prevent it.
	[73a5e4b134f1]

2007-07-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/mountpoint.c:
	Removed special autofs check. Instead check ignore mount option
	correctly. Also check swap correctly.
	[89184bad9d10]

2007-07-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	If section opening fails, show the line where the last section was
	opened or closed.
	[0630d47a2c1d]

2007-07-17  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-mailbox.c:
	APPEND and COPY ignored s/t/w flag rights.
	[60ec3834ee46]

	* src/plugins/acl/acl-storage.c:
	If user didn't have "lookup" right to mailbox, "insert" right didn't
	work.
	[e0b3d8f7883b]

	* src/lib/mountpoint.c:
	Skip over autofs entries. Patch by Mike Brudenell
	[bb7d6acd625f]

2007-07-15  Timo Sirainen  <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c:
	Added debug logging.
	[ed5b09997b54]

	* src/imap/namespace.c:
	Give better error messages if storage creation fails.
	[b9e2be098d60]

	* .hgtags:
	Added tag 1.0.2 for changeset 0a4c7d06da84
	[0a2c21749171]

	* NEWS, configure.in:
	Released v1.0.2.
	[0a4c7d06da84] [1.0.2]

2007-07-13  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If Sieve plugin returns any errors, ignore them. Bounce the message
	only if message couldn't be saved anywhere.
	[87d0ae7fbe12]

2007-07-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Fixes for last changes
	[db0818972a19]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Support reading dovecot-uidlist version 3, although all extensions
	are just ignored. Dovecot v1.1 creates them.
	[a948df958d10]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	One more UIDVALIDITY=0 fix
	[b6753fd66298]

2007-07-11  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Allow using --exec-mail imap/pop3 even if imap/pop3 isn't in
	protocols setting.
	[c1d0acf68614]

2007-07-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Fixed UIDVALIDITY changed error when dovecot-uidlist file didn't
	exist but index already had UIDVALIDITY.
	[90ea01bfaf82]

2007-07-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index.c:
	Don't crash if extension record size is 0.
	[5f6e24834919]

2007-07-05  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	%variables in plugin {} settings need to be expanded.
	[f0bf2439bc09]

2007-07-04  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	Crashfix if PAM returns a reply but the process doesn't die.
	[de5d9ffa2a45]

	* configure.in:
	Don't build dbox by default.
	[720cbd0c19a0]

2007-07-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-util.c:
	Update tmp/ directory's atime+mtime with utime(NULL) so it works
	even if we're not the directory owner.
	[8f7e3311006f]

2007-07-02  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Removed an extra 'x' from the beginning of the file.
	[9eb11ba455e0]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Memory leak fix
	[50c79521e8f5]

2007-06-28  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Mention that flock doesn't work with NFS.
	[ebbc85ebf805]

2007-06-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	FIXME comment update
	[7bb0916b17ec]

	* src/lib/lib-signals.c:
	Allow registering signal handlers even before lib_signals_init() is
	called. The signals won't be effective until then though, unless
	they're ignored.
	[a098e94cd318]

	* src/lib/ioloop-notify-inotify.c:
	If inotify_init() fails with EMFILE, give an understandable error
	message.
	[5d841dcab6ab]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-idle.c:
	Changes sent by IDLE shouldn't affect the client's inactivity
	timeout checking.
	[111275296af5]

2007-06-26  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	APPEND {0+} didn't eat the finishing CRLF.
	[ba3c6dc3126c]

2007-06-25  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	LIST "" % with INBOX. namespace returned INBOX with \HasNoChildren.
	[f92ea3eed616]

2007-06-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c:
	Map the log files only after they've all been found. Otherwise we
	could have skipped some transactions from the end of non-head logs.
	[b55165d5e675]

	* src/lib-index/mail-transaction-log.c:
	mmap_disable=yes: Fixed invalid "hdr.size too large" transaction log
	corruption errors.
	[98cd45935799]

2007-06-19  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	If maildirsize file is being rewritten while we're trying to do
	that, recalculate it later instead of failing with "Unknown quota
	error".
	[b919a32cd077]

	* src/plugins/quota/quota.c:
	Changed "Unknown error" to "Unknown quota error".
	[02fb6b136e19]

2007-06-17  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	Even if mailbox sync fails, commit the transaction so that cache
	file gets updated.
	[86766f448e50]

	* src/imap/imap-fetch.c:
	Always commit FETCH transaction to make sure cached data is
	committed.
	[e1cd11c5e00a]

	* src/imap/imap-fetch.c:
	We didn't update last_output timestamp with long fetches, causing
	Dovecot to idle-disconnect the client.
	[f88b1e225be5]

2007-06-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-copy.c:
	Added missing error logging for i_stream_read()
	[b2fe5f3e5562]

2007-06-15  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added 1.0.0 and 1.0.1 tags
	[bbfa05cb432b]

	* NEWS:
	Added release date
	[50777c7bd20d] [1.0.1]

	* NEWS, configure.in:
	Released v1.0.1.
	[ee6955bd39e7]

2007-06-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.c:
	Treat unknown errors as temporary errors.
	[1ffe49573721]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	When saving a message to maildir without dovecot-uidlist file, give
	the newly created uidlist file a non-zero uidvalidity.
	[0f40f19d2ae4]

	* src/lib-storage/index/mbox/mbox-storage.c:
	When trying to use mbox file as the root directory, give a nice
	error.
	[3099b59226af]

	* src/lib-index/mail-cache-lookup.c:
	Cache decisions weren't updated when doing header lookups.
	[60d840dc718e]

	* src/lib-index/mail-cache-lookup.c:
	Header lookup from cache could have returned garbage after headers
	in very rare conditions.
	[114882d75665]

2007-06-13  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If input mail gets lost somehow, log a real error instead of
	"Unknown error".
	[7959ec38de98]

	* dovecot-example.conf:
	Updated passwd/shadow comments.
	[c23926d0aed2]

	* doc/documentation.txt:
	Updated
	[5b8530ff40d8]

	* dovecot-example.conf:
	Point to disable_plaintext_auth in auth mechanisms comment.
	[240826d5a77e]

2007-06-12  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If save failed, log also the reason for it.
	[abc4be10176e]

	* src/deliver/deliver.c:
	Added -e parameter to write rejection error to stderr and exit with
	EX_NOPERM instead of sending the rejection by executing sendmail.
	[0d3d7083b582]

	* src/master/mail-process.c:
	nfs check: If namespaces are defined, use the first one's location
	instead of mail_location.
	[bdd45370eb26]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-sync.c:
	If new/ directory is lost when syncing, assume the mailbox was
	deleted and make the mailbox inconsistent (which disconnects the
	client).
	[072b4b19227f]

	* dovecot-example.conf:
	mail_location mbox comment update.
	[86498791bea9]

	* src/master/auth-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Master and client sockets have default paths now. Section name only
	needs to be uncommented now for the socket to be created.
	[7c29ee3ddcc0]

	* src/lib-imap/imap-date.h:
	Fixed comments.
	[12631f82e897]

	* src/lib-imap/imap-date.c, src/lib-imap/imap-date.h:
	If utc_mktime() fails, it doesn't mean that the IMAP date was
	invalid. Instead the year is just too low or too high to fit to
	time_t. If this happens, use the lowest/highest allowed value
	instead of returning failure.
	[2460c70d1ffb]

	* src/lib-storage/index/maildir/maildir-save.c:
	Don't crash if saving runs out of disk space while in the middle of
	moving multiple files to new/ or cur/ directories and the already
	moved files had keywords.
	[fe4a89b2a548]

	* src/master/main.c:
	When using --log-error, log also a warning and an error.
	[ceb6f164d753]

	* src/plugins/acl/acl-backend-vfile.c:
	Fix also ACL file stat() failing with EACCES.
	[6eded4438f44]

	* src/plugins/acl/acl-backend-vfile.c:
	If dovecot-acl file can't be opened because of permission problems,
	treat it as if no-one has access to the mailbox.
	[69ab5669855a]

2007-06-11  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init.c:
	Compile fix for building without SSL.
	[9110ef0d8937]

2007-06-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	Removed useless getnameinfo() call from net_gethostbyname()
	[84994704291b]

	* src/lib/network.c:
	If getnameinfo() fails, use gai_strerror() as well to return the
	error string.
	[48e0be9f8cbb]

2007-05-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Deleting symlinked maildirs didn't work.
	[aaa2e8397de4]

2007-05-27  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Don't expand %variables in mail setting coming from userdb.
	[2b462faf9867]

2007-05-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c:
	If there's no message body, the final read() should return -1, not
	-2
	[89aa4c7f40b7]

2007-05-23  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	If Dovecot is already running, complain about it instead of wiping
	out login_dir and causing the already running Dovecot to break.
	[325438d789fb]

2007-05-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c:
	Cache compression actually lost the cache with non-x86 CPU and 64bit
	file offsets.
	[da07b096e1b5]

	* src/master/main.c:
	If startup fails because of configuration problems, print "Invalid
	configuration in <path>"
	[651679174b85]

	* src/master/master-settings.c:
	Complain about missing pop3_uidl_format if pop3 is enabled.
	[7e803d7fe2d1]

	* src/pop3/main.c:
	Changed pop3_uidl_format error message once again.
	[ac9475b28a58]

	* src/lib/ioloop.c:
	Added wiki link to "time moved backwards" error.
	[0a67831778ed]

2007-05-19  Timo Sirainen  <tss@iki.fi>

	* .cvsignore, doc/.cvsignore, doc/wiki/.cvsignore, src/.cvsignore,
	src/auth/.cvsignore, src/deliver/.cvsignore, src/dict/.cvsignore,
	src/imap-login/.cvsignore, src/imap/.cvsignore, src/lib-
	auth/.cvsignore, src/lib-charset/.cvsignore, src/lib-
	dict/.cvsignore, src/lib-imap/.cvsignore, src/lib-index/.cvsignore,
	src/lib-mail/.cvsignore, src/lib-ntlm/.cvsignore, src/lib-
	settings/.cvsignore, src/lib-sql/.cvsignore, src/lib-
	storage/.cvsignore, src/lib-storage/index/.cvsignore, src/lib-
	storage/index/dbox/.cvsignore, src/lib-
	storage/index/maildir/.cvsignore, src/lib-
	storage/index/mbox/.cvsignore, src/lib-storage/register/.cvsignore,
	src/lib-storage/subscription-file/.cvsignore, src/lib/.cvsignore,
	src/login-common/.cvsignore, src/master/.cvsignore,
	src/plugins/.cvsignore, src/plugins/acl/.cvsignore,
	src/plugins/convert/.cvsignore, src/plugins/imap-quota/.cvsignore,
	src/plugins/lazy-expunge/.cvsignore, src/plugins/mail-
	log/.cvsignore, src/plugins/quota/.cvsignore,
	src/plugins/trash/.cvsignore, src/plugins/zlib/.cvsignore,
	src/pop3-login/.cvsignore, src/pop3/.cvsignore, src/util/.cvsignore:
	We no longer need .cvsignore files
	[abc7942e0e70]

	* .hgignore, Makefile.am, autogen.sh:
	Mercurify the repository
	[fb19fa523d22]

2007-05-16  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-cache.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/index-storage.c, src/master/mail-process.c, src/master
	/master-settings-defs.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Reversed the last change. It wasn't supposed to go to branch_1_0.
	[6e276e7fb119]

	* dovecot-example.conf, src/lib-index/mail-cache.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/index-storage.c, src/master/mail-process.c, src/master
	/master-settings-defs.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Removed mmap_no_write setting. The only OS requiring it is OpenBSD,
	so we're now forcing mmap_disable=yes with it instead.
	dovecot.index.cache file is the most important file to mmap(), but
	since this didn't work with mmap_no_write, there's not much point in
	keeping special code paths for minimal gains.
	[b09425e50bde]

	* src/lib-storage/index/index-mail-headers.c:
	Assert-crashfix in some conditions.
	[12ed89e4742f]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	When recreating dovecot-uidlist file based on dovecot.index, we set
	next_uid value wrong if new messages had been added.
	[4e4572280ef1]

2007-05-15  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If Return-Path doesn't contain user and domain, treat it as missing
	Return-Path.
	[b2a592a5960e]

	* src/lib-storage/index/maildir/maildir-util.c:
	Handle symlinks pointing to nonexisting files better.
	[3ba4a97d9b31]

2007-05-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c:
	Log an error if pwrite_full() fails while overwriting index mapping.
	[fc35b2d9afdb]

2007-05-13  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init-main.c:
	fix
	[33fcc6d51ceb]

	* src/master/ssl-init.c:
	If ssl-parameters.dat has been updated externally, copy it to our
	base_dir.
	[f7c1b6f2947d]

	* src/deliver/smtp-client.c:
	Removed accidentally committed useless code
	[8292598dae4c]

	* src/deliver/deliver.c, src/deliver/smtp-client.c:
	DEBUG environment removal was pretty much broken. Also it was
	supposed to remove MAIL_DEBUG, not DEBUG.
	[544173d713f4]

	* src/master/main.c, src/master/ssl-init-main.c, src/master/ssl-
	init.c, src/master/ssl-init.h:
	When running multiple Dovecot instances, only one of them needs to
	regenerate ssl-parameters.dat.
	[b95b4a47eddc]

2007-05-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-copy.c:
	We sent "Hang in there.." too early sometimes and checked it too
	often.
	[3bc546f5d866]

	* src/lib/file-dotlock.c:
	Give a better error message if dotlock is deleted immediately under
	us (or more likely an OS bug).
	[8c4d8e1f600a]

	* src/master/main.c:
	Print also Dovecot version with dovecot -n.
	[f8b4f0dbee32]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Keyword characters weren't sorted in the maildir filename.
	[38a6e74ce1d7]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If we don't have write access to cur/ directory, treat the mailbox
	as read-only.
	[4f6b5c18b289]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-request.h:
	Changed auth_request->created to last_access and update it a bit
	more often. If there are slow authentications this could help avoid
	removing timeouted auth requests too early.
	[fb9a905f5153]

2007-05-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	%c wasn't exported to auth worker processes. Patch by Andrey Panin
	[d2efaf104e4c]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Make sure uid_validity and next_uid aren't 0 in the uidlist header.
	[a2b91aeb832c]

	* src/lib/mountpoint.c:
	Compile fix for Tru64.
	[137bcf525612]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Updated error message.
	[5931db6eee16]

2007-04-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	If we synced the mbox while saving the message (happens only with
	quota plugin loaded), we could have used a wrong append offset
	(calculated before sync) which caused "Unexpectedly lost From-line"
	errors, and depending on the sync either extra NUL lines or Content-
	Length header written over existing mails (quite unlikely).
	[912dbd42799a]

	* src/lib-storage/index/mbox/mbox-save.c:
	Another try at fixing the X-Delivery-ID problem.
	[921a11f95203]

2007-04-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	If pop3_uidl_format=%m, it wasn't cached correctly when saving new
	messages (eg. with deliver). X-Delivery-ID wasn't used in the MD5
	sum, causing duplicates when POP3 recalculated the MD5 sum later.
	[9262836c2035]

2007-04-13  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	1.0.0 released.
	[96fb9dad0a0d] [1.0.0]

2007-04-12  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	Released 1.0.rc32.
	[7820b3a33650]

	* src/plugins/convert/convert-storage.c:
	Don't create INBOX mailbox, so with maildir the maildirfolder file
	won't be created there.
	[81ba0b12dcc1]

	* src/auth/db-ldap.h:
	#define LDAP_DEPRECATED for now.
	[10b44e571478]

	* src/auth/db-ldap.c:
	Queue userdb lookup request until bind is finished (with
	auth_bind=yes).
	[7974db2ffb21]

	* src/auth/passdb-ldap.c:
	Don't crash if doing non-plaintext ldap passdb lookup for unknown
	user.
	[d354ba25cba2]

2007-04-08  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	Released 1.0.rc31.
	[536d148ef0e6]

2007-04-07  Timo Sirainen  <tss@iki.fi>

	* autogen.sh:
	Fixed to work with non-GNU sed.
	[8dd09665eae4]

	* src/plugins/convert/convert-storage.c:
	If directory for destination storage doesn't exist, create it.
	[adf50d46d1b6]

	* src/plugins/convert/convert-storage.c:
	Mailbox names weren't converted in subscription list.
	[895b6fd7d078]

2007-04-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Give "mbox file was modified while we were syncing" error only if we
	detect some problems in the mbox file. The check can't be trusted
	with NFS.
	[470cf5845ebe]

	* NEWS, configure.in:
	Released 1.0.rc30.
	[58d67273c90e]

	* src/login-common/ssl-proxy-openssl.c:
	Send list of CA names to client when using
	ssl_verify_client_cert=yes.
	[f31396506df6]

	* src/lib-mail/message-size.c:
	If message body started with a LF, we didn't count it into number of
	lines. This made BODY and BODYSTRUCTURE replies give wrong line
	counts for such messages.
	[e33df71a94d3]

2007-04-03  Timo Sirainen  <tss@iki.fi>

	* autogen.sh:
	Fixed to work with POSIX sh.
	[e64c7840c99a]

	* src/deliver/deliver.c:
	Load plugins before chrooting.
	[9c01ff364326]

	* src/plugins/quota/quota-dict.c:
	Recalculate quota if it's negative.
	[a8572b74ce9b]

	* src/auth/passdb-pam.c:
	Lowercase the PAM service name when calling with "args = *". Linux
	PAM did this internally already, but at least BSD didn't.
	[e380c9ded5c7]

2007-04-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-ldap.c:
	Error message changed
	[f2c545d77b94]

2007-03-30  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	Released 1.0.rc29
	[f6b0841f1a51]

	* autogen.sh:
	Regenerate doc/wiki/Makefile.am always.
	[f42e3b13f548]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Check that mailbox name is valid even when opening a stream.
	[693eca26f23a]

	* dovecot-example.conf:
	Added a note about dovecot -n
	[6800430e3fcc]

2007-03-29  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-crlf.c:
	stream_errno wasn't updated with errors in crlf stream.
	[843a0108cd3e]

	* dovecot-example.conf:
	OS X's Mail v2.1 (at least) no longer breaks without delay-newmail.
	[848444967c32]

2007-03-28  Timo Sirainen  <tss@iki.fi>

	* src/util/rawlog.c:
	Fixed to work with chrooting
	[a4cd0b4dd39f]

	* src/master/mail-process.c:
	When using chrooting, force the home directory to have '/' prefix so
	it's not treated as relative.
	[8614739bc885]

	* src/lib/restrict-access.c:
	After chrooting try to chroot to $HOME instead of to /. If home
	doesn't exist or chrooting fails there, fallback to /.
	[ab4d85e73412]

	* dovecot-example.conf:
	Added a note about namespaces working only with IMAP.
	[5ead34aff9a5]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If we find duplicate hard links which haven't changed for 30 secs,
	unlink() one of the filenames.
	[ba30ab24de7d]

	* doc/wiki/Makefile.am.in:
	.txt files weren't included in the tarball
	[5e0ce79990e6]

	* autogen.sh, configure.in, doc/Makefile.am, doc/USE-WIKI-INSTEAD,
	doc/documentation.txt, doc/variables.txt, doc/wiki/.cvsignore,
	doc/wiki/Makefile.am.in, dovecot-example.conf:
	Added documentation to doc/wiki/. autogen.sh downloads them from
	dovecot.org if they don't exist. Changed wiki links in dovecot-
	example.conf to point to the doc/wiki/ directory instead.
	[4a06e970f8dc]

	* dovecot-example.conf, src/auth/auth.c, src/auth/auth.h, src/auth
	/mech-gssapi.c, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_gssapi_hostname setting.
	[adc2588c3cb9]

	* src/imap/cmd-list.c:
	LIST "" "" should return something even if we don't have a namespace
	with empty prefix. Use INBOX namespace's separator then.
	[46681d912e07]

2007-03-27  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	/dev/null was opened too late.
	[c035bddbded0]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Disable index files if index directory can't be created.
	[69bacb474aaa]

	* src/login-common/sasl-server.c:
	If authentication fails for any reason, reset waiting_auth_reply.
	[a30ef30c8f8e]

	* src/login-common/sasl-server.c:
	Update waiting_auth_reply early enough, so that if client does
	another authentication after a failed one it can send the input
	before waiting for server's initial reply.
	[df4f07d07f92]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	Potential crashfix
	[8e08f7b897a5]

2007-03-26  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c, src/master/master-settings.c:
	Before unlinking auth sockets at startup, try connecting to them
	first to see if there's anyone listening (another Dovecot process).
	If there is, kill ourself.
	[cfd8955ea432]

	* src/lib/ioloop-notify-inotify.c:
	Fixed to work with notify updates to the watched file itself (with
	mbox)
	[1158469e8a6f]

	* src/lib-index/mail-index.c:
	If mail_index_move_to_memory() fails, make sure the future calls to
	it also will fail.
	[8b8a8ca04ef6]

	* src/auth/passdb-passwd.c, src/auth/passdb-shadow.c:
	Verify the password with auth_request_password_verify() so passwd
	and shadow can be used as master and deny passdbs.
	[00345121a458]

	* src/auth/passdb-pam.c:
	removed unneeded include
	[31954f7dd9d3]

	* dovecot-example.conf:
	Added a note about dirsize's slowness with maildir.
	[f28a1135a0fe]

	* src/deliver/mail-send.c:
	If we couldn't send a bounce because of a missing Return-Path
	header, just return success instead of failing with EX_TEMPFAIL.
	[0a0dbf6c7930]

	* src/deliver/deliver.c:
	If storage creation failed, exit with EX_TEMPFAIL instead of
	EX_CONFIG.
	[4256e6e7a0e6]

	* src/deliver/deliver.c:
	INBOX fallbacking with -n wasn't working.
	[77013c86865b]

	* src/deliver/deliver.c:
	failure callback was still set too late.
	[40de934e8410]

2007-03-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	If "nopassword" is set, don't crash if password is non-NULL. However
	give an error if the password is non-empty.
	[4bfd74222126]

	* src/lib-storage/index/maildir/maildir-util.c:
	File's group could have been wrong with shared mailboxes
	[eaea1bdf501c]

	* src/util/.cvsignore:
	updated
	[9f839036e4c3]

2007-03-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-keywords.c:
	When adding new keywords, update the index file atomically so the
	keywords won't break if we crash in the middle of the header update.
	[7a15d19a2900]

	* src/lib-index/mail-index-private.h:
	cleanup
	[36d60cea6cd3]

	* src/lib-storage/index/maildir/maildir-sync.c:
	comment/duplicate link handling fixes.
	[92328067c28b]

2007-03-23  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	1.0.rc28 released
	[6228f0f8c6d6]

	* src/util/idxview.c:
	Try to avoid crashes a bit harder with broken cache files.
	[187f861119d5]

	* src/lib-storage/index/dbox/dbox-save.c:
	minor cleanup
	[f482045bd52e]

	* src/lib-storage/index/maildir/maildir-copy.c:
	comment update
	[fd8c7d8f2ef4]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	When saving/copying mails, we must not do any sorting based on the
	filename to saved mails when they're added to uidlist, otherwise
	they could be saved to index with wrong UID.
	[3de1259f66ad]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If duplicate links are found, rename() one over the other to get rid
	of it.
	[4a0c7d398627]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Avoid infinite looping when buggy filesystems.
	[01272c72aac8]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If saving to maildir causes flag/expunge syncs, don't crash.
	[6133c47c1ecf]

	* src/lib-index/mail-cache-transaction.c:
	If we update the fields list in header, it's committed immediately
	so if the transaction gets rollbacked, don't overwrite the already
	committed header.
	[37e33a6c0733]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Last fix broke creating new uidlists.
	[37efe05ae8ab]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	If a broken X-UID header was found with a value larger than last
	seen X-UID (eg. empty mbox) but less than the expected UID value, we
	gave "UID inserted in the middle of mailbox" error.
	[7ee341f5c06d]

	* src/master/mail-process.c:
	Fixed NFS check again with chroots
	[8a122fbb715a]

	* src/lib/home-expand.c, src/lib/home-expand.h:
	Added home_expand_tilde()
	[3e91f23efe6c]

	* doc/Makefile.am, doc/dovecot-ldap-example.conf, doc/dovecot-
	ldap.conf, doc/dovecot-sql-example.conf, doc/dovecot-sql.conf,
	dovecot-example.conf:
	Renamed dovecot-sql/ldap.conf to dovecot-sql/ldap-example.conf. make
	install now installs them to sysconfdir.
	[0df131e1aecb]

	* src/master/mail-process.c:
	If chdir() failed, we still gave wrong reason
	[4117e7ece75b]

2007-03-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	~ in mbox root path wasn't expanded early enough
	[e0f6b232d0ff]

	* dovecot-example.conf, src/auth/passdb-passwd.c, src/auth/passdb-
	shadow.c:
	Added blocking=yes setting for passdb passwd and shadow also.
	[fab6f1c313b2]

	* dovecot-example.conf:
	Removed security warnings from auth-master socket. They're not
	actually true. The clients can only look up userdb data, which is
	practically the same thing as what they can find from /etc/passwd
	(with system users of course).
	[2e2f66f3bbe6]

	* src/master/mail-process.c:
	Use alarm() to make sure that chdir() returns in 30 seconds (NFS..).
	Also if chdir() failed, we could have used wrong errno in the
	checks.
	[377307770019]

	* configure.in:
	Check if struct stat has tv_nsec fields
	[a48f3279d3d4]

2007-03-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Check if mbox has been modified externally before doing any
	dangerous writes. Also changed the old "space needed changed
	unexpectedly" assert to a more informative panic.
	[147d80a1b26b]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Changed assert to more informative panic message.
	[e7c66f68a077]

	* src/master/mail-process.c:
	NFS check + chroots broke home directory for the first login.
	[36cc87a31506]

	* dovecot-example.conf, src/auth/auth-master-connection.c, src/auth
	/userdb-static.c:
	If doing a plain userdb lookup with userdb static, verify the user's
	existence from passdb first, unless allow_all_users=yes
	[5fffaa484fdd]

	* src/deliver/auth-client.c:
	FAIL reply doesn't necessarily have parameters. Don't give "BUG:
	Unexpected input" if that happens.
	[00f542362ab1]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	If uidlist is deleted and we set the uidvalidity from the index
	file, set also next_uid.
	[8026c2c5a18b]

	* src/imap/cmd-copy.c, src/lib-storage/index/maildir/maildir-sync.c,
	src/lib-storage/mail-storage.h:
	When copying/syncing a lot of mails, send "* OK Hang in there"
	replies to client every 15 seconds so it doesn't just timeout the
	connection.
	[8a2eb2424c36]

	* src/imap/client.c:
	Keep better track of client->last_output timestamp.
	[b5d767635c2f]

2007-03-20  Timo Sirainen  <tss@iki.fi>

	* src/util/Makefile.am, src/util/idxview.c, src/util/logview.c:
	Added idxview and logview to dump index/cache/log file contents.
	[ef1457390d03]

2007-03-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	If uidlist file doesn't exist but index files do, resync the maildir
	to create the uidlist.
	[5c4ed4f7243c]

	* src/imap/cmd-idle.c:
	Assert-crashfix
	[13b1edcaeb2f]

2007-03-17  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	We defaulted plugin_dir to <moduledir>/imap instead of /pop3.
	[35ae2479026a]

	* src/lib/file-dotlock.c:
	Log "kept it for n seconds", not -n seconds.
	[814cdc190876]

	* src/deliver/deliver.c:
	Ignore -m "" parameter. Added -n option to not autocreate the
	mailbox. If saving to given mailbox fails, fallback to saving to
	INBOX.
	[2928d2cec405]

2007-03-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Crashfix with nonsorted appends
	[a153286eed16]

	* src/lib-index/mail-transaction-log.c:
	When marking transaction log corrupted, set indexid=0 instead of
	version=0. Version setting worked too, but indexid=0 makes it log a
	"marked corrupted" error message.
	[24f23a8f0333]

	* src/lib-index/mail-transaction-log.c:
	Creating initial transaction log file leaked memory, created the
	file twice and caused potential locking problems.
	[ab18e3fbd2f8]

	* src/auth/auth-worker-server.c, src/lib-auth/auth-server-
	connection.c:
	If net_connect_unix() fails, assume also that ECONNREFUSED may be a
	temporary failure. It can happen if we exceeded the listener's
	backlog.
	[4c145f92be44]

	* configure.in:
	Link dovecot-auth always with -lcrypto if it's needed for crypt().
	It could possibly be used with any passdb, so don't bother doing it
	only for a few of them.
	[e24c8a20d062]

2007-03-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c, src/deliver/deliver.c, src/imap/main.c, src/master
	/mail-process.c, src/master/main.c, src/pop3/main.c:
	Fixes to handling log prefixes. imap/pop3 processes now log the
	mail_log_prefix even when started with --exec-mail.
	[b5f3ea6cb87c]

	* src/lib/failures.c:
	i_set_failure_file() no longer automatically appends ": " to log
	prefixes.
	[64555816694e]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-internal.h, src/lib/ioloop-
	kqueue.c, src/lib/ioloop-poll.c, src/lib/ioloop-select.c,
	src/lib/ioloop.c:
	If poll()/etc. timeouts, we didn't handle time timeouts immediately
	but called poll()/etc again with zero timeout and then handled the
	timeouts.
	[220837f5e391]

	* src/lib-storage/index/index-storage.c:
	Check for the index destroy timeouts a bit less often.
	[ff89a76889d0]

	* src/lib/ioloop.c:
	If timeout wait time was less than 1 millisecond, we wasted CPU
	calling poll() (or whatever) with zero timeout multiple times until
	the millisecond had passed. Now we round the waits up to next
	millisecond.
	[4e1853646cc9]

	* src/master/mail-process.c:
	Make processes created with --exec-mail log to the configured
	location.
	[12277139b240]

	* src/lib/failures.c:
	Added missing LF from error message
	[fdba51f4888e]

	* src/imap/cmd-append.c:
	Crashfix
	[f74387800e01]

	* src/lib-index/mail-index.c:
	Error handling crashfix
	[e779259a3196]

	* src/plugins/convert/convert-storage.c:
	INBOX wasn't converted.
	[d51264e75cbc]

	* src/lib-index/mail-cache.c:
	Error handling crashfix
	[c1405138f3e1]

	* src/lib-index/mail-transaction-log.c:
	Don't give "Unexpected garbage at EOF" error if we don't see a full
	transaction header's worth of data. It could be just that another
	process is in the middle of writing the first header.
	[aba3d3ae5169]

2007-03-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Error handling crashfix
	[814c0fcf29dc]

	* dovecot-example.conf:
	blocking=yes setting was accidentally added to passdb passwd instead
	of userdb passwd.
	[08bc29e4fc59]

	* src/lib-index/mail-index-sync-ext.c:
	If new extension was introduced while we had already expunged some
	messages in the sync, we cleared existing expunge/sync extension
	contexts, which probably caused assert-crash.
	[e5cee3647078]

	* src/imap/cmd-list.c, src/lib-storage/index/maildir/maildir-sync.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	Added casts to some enums to avoid compiler warnings.
	[b7c657487a37]

	* src/auth/userdb-passwd-file.c:
	Reverted the last change, it was originally correct after all.
	[776261268ea9]

	* src/auth/userdb-passwd-file.c:
	Don't expand %variables in extra fields, let dovecot master do that.
	[97707bfb56c1]

	* src/lib-index/mail-index-view-sync.c:
	View syncing fixes
	[7879d0f9da62]

	* src/imap/client.c:
	Code cleanup
	[5078555dea5f]

	* src/auth/auth-request.c:
	If unknown user was found from auth cache, we returned an invalid
	value instead of USERDB_RESULT_USER_UNKNOWN.
	[8a71cec3fa6d]

	* src/lib-storage/index/mbox/mbox-sync-private.h:
	uint8_t:1 is GCC extension, changed back to using unsigned int:1
	although it takes a bit more memory now.
	[a6f35eb42fb7]

	* src/auth/userdb-vpopmail.c:
	Compile fix
	[af1619a3989b]

2007-03-13  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	1.0.rc27 released
	[780ff48ab34b]

	* src/imap/cmd-create.c:
	If trying to create <mailbox><real separator>, give an error instead
	of working like <virtual separator>.
	[d9ba34f57ffb]

	* src/imap/commands-util.c, src/imap/commands-util.h:
	Added client_find_namespace(). Handle virtual != real hierarchy
	separators better. Give an error if real separator is tried to be
	used in the mailbox name.
	[b5fdc2442ec9]

	* src/plugins/trash/trash-plugin.c:
	compiler warning fix
	[daf9273789cd]

	* src/imap/cmd-append.c:
	Logout crashfix in some conditions.
	[b1cd3f83f160]

	* src/imap/cmd-append.c:
	Error handling fix
	[09972662351e]

	* src/deliver/mail-send.c:
	Don't add rejection mails to duplicate database. They're never
	looked up from there.
	[7658c4d8f9ec]

2007-03-12  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	If maildirsize file contains only the header, recalculate the quota.
	[589500819c24]

	* src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	private.h:
	With ignore=box setting the quota was still updated for the mailbox
	even though it was allowed to go over quota (but quota recount
	ignored the box).
	[cee624ba6398]

	* src/plugins/convert/convert-storage.c:
	Mailbox name conversion wasn't done for directories.
	[f772bf040c9e]

2007-03-11  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	failure_exit_callback hook was set too late, so if log opening
	failed it exited with wrong exit code.
	[fde31a9184c4]

	* src/auth/mech-gssapi.c:
	Crashfix in some error conditions
	[5232b5bf798e]

	* src/auth/db-passwd-file.c:
	If passwd-file wasn't found, don't crash.
	[3b876bea664a]

	* src/lib-index/mail-index-view-sync.c:
	DEBUG crashfix
	[237f7ffb456d]

	* src/lib-index/mail-transaction-log-append.c:
	If we can't rotate log file because there's no disk space, don't
	abort appending the transaction.
	[08ef6d276e1f]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If anything (syncing) fails because there's not enough disk space,
	give user a nice error message instead of internal error.
	[bbb02a072183]

	* src/lib-index/mail-index-lock.c:
	Delete copy-lock file instead of rename()ing it if we've moved to
	in-memory indexes.
	[3b750f057968]

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c:
	If write to transaction log fails, we may later need to truncate the
	file so that after the write there won't be garbage after it.
	[a4c3ba04b41f]

	* src/imap/cmd-append.c:
	Use a larger initial pool size for keywords.
	[9ff22db77574]

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-private.h:
	If transaction log grows larger than 1MB, rotate it even if it was
	created less than 5 minutes ago.
	[8f3a7780503f]

	* src/lib-storage/index/maildir/maildir-save.c:
	If o_stream_send_istream() fails with ENOSPC/EDQUOT, don't log a
	critical error but just give user a "not enough disk space" error.
	[617337344e8b]

	* src/lib-storage/index/mbox/mbox-save.c:
	o_stream_seek() may do buffer flushing internally and cause errors.
	Do flushing manually before seeking so that we don't confuse the
	errors. Also did some code cleanups.
	[bd59f48ffc5f]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	o_stream_seek() call was missing error handling.
	[6b1aa2bb46f1]

	* src/imap/cmd-append.c:
	Another failure handling fix
	[ce637bd30f28]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.c, src/lib-index/mail-transaction-log-append.c, src/lib-index
	/mail-transaction-log-view.c, src/lib-index/mail-transaction-log.h:
	If we run out of disk space, move to in-memory indexes.
	[2952862795e2]

	* src/imap/cmd-append.c:
	When using MULTIAPPEND and LITERAL+ and message saving failed, we
	stopped parsing client input too early (for subsequent appends after
	the failure) which caused BAD replies.
	[e4b19eb1d6ab]

	* src/imap/imap-fetch-body.c:
	If mail was in CR+LF format in the disk and we used sendfile() call,
	but the call couldn't send everything, we hanged.
	[3295a91d0cd3]

	* src/lib/ostream.h:
	Updated o_stream_send_istream() comments
	[5bba57941740]

2007-03-10  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-cache-compress.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-index-lock.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-storage/index/dbox/dbox-uidlist.c,
	src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-save.c, src/master/mail-process.c, src/master/master-settings-
	defs.c, src/master/master-settings.c, src/master/master-settings.h:
	Added fsync_disable setting.
	[9fb60a21c58f]

	* src/lib-index/mail-index.c:
	When moving index file to memory, change the filename to be "(in-
	memory index)".
	[a0d3ab665a54]

	* src/lib-index/mail-index.c:
	Rotating in-memory transaction log crashed
	[1b1d2c32248b]

	* src/lib-index/mail-index.c:
	mmap_disable=yes crashes with recent changes.
	[3cfb0d640c5a]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view-sync.c:
	View syncing fixes.
	[485da7e05fbd]

	* src/lib-index/mail-index-view-sync.c:
	cleanups
	[2095a97a4999]

	* src/lib-index/mail-index-sync-update.c:
	View log file offset fix
	[97bbd0933f2f]

	* src/lib-index/mail-index-view-sync.c:
	We skipped some external transactions that shouldn't have been
	skipped. The logic for figuring out if flags are unreliable was also
	a bit broken.
	[dd51910050e7]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	comment update
	[05589da72213]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	Cleaned up the code a bit. Fixed sync rewrite crashing with pseudo
	mails.
	[6670422ae8c0]

	* src/lib-storage/index/mbox/mbox-transaction.c:
	After saving mails we didn't update last-uid header in X-IMAP[base]
	if lazy writes were used.
	[5bc41ffe29c3]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	When parsing X-IMAP[base] header and its last-uid field is too low,
	mark it as needing rewrite.
	[0f312ea02ee5]

	* doc/variables.txt:
	Added %m and %c to dovecot-auth.
	[462114be72c8]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf:
	Added wiki links.
	[c0be79f86220]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Added %c variable which expands to "secured" with SSL/TLS/localhost.
	[966b145a5281]

	* src/auth/db-passwd-file.c, src/auth/passdb-bsdauth.c, src/auth
	/passdb-cache.c, src/auth/passdb-checkpassword.c, src/auth/passdb-
	pam.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sia.c, src/auth/passdb-vpopmail.c, src/auth/userdb-passwd.c,
	src/auth/userdb-prefetch.c, src/auth/userdb-vpopmail.c:
	Added more debug logging.
	[6fc44d11724a]

	* src/plugins/mail-log/mail-log-plugin.c:
	Log the mailbox name, unless it's INBOX.
	[275ebc3c9789]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c:
	When rewriting the first message we could have written next-uid
	field wrong.
	[7b00950aa7db]

2007-03-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-view.c:
	cleanups
	[3c4684db3658]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c:
	Don't set log sync position right after extension introduction,
	unless it's at the end of the file. This should fix some "Extension
	reset without intro prefix" errors.
	[81af2350fce7]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Yet another try at fixing this piece of code. The mbox code is way
	too complex and could use better comments..
	[ee658585f808]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	When returning mailbox name with GETQUOTAROOT, return the original
	name instead of the converted storage name.
	[c5a2a0c09854]

	* doc/dovecot-ldap.conf:
	Added tls setting.
	[675cfc9e33a2]

	* src/auth/auth-request.c:
	Added %m = mechanism name
	[5090f9337202]

2007-03-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c,
	src/lib-index/mail-transaction-log.h:
	If index file is corrupted, recreate transaction log file instead of
	trying to reuse it.
	[4887efe3beac]

	* src/lib/failures.c:
	Moved errno preserving to i_error/i_warning/i_info from the failure
	handler, so each failure handler doesn't have to do that itself.
	[d457108e6c83]

	* dovecot-example.conf:
	Added note about ssl_require_client_cert in ssl_verify_client_cert
	comments.
	[cca09b413a8c]

2007-03-07  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added LoginProcess wiki link.
	[a7b2cdb674c9]

	* src/lib/ioloop.c:
	Added a comment about the time moving backwards code.
	[d347f0fafd05]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync.c:
	Keep track of the mbox dirty state better. Also when moving mails
	inside an mbox without changing the file's size, make sure the
	file's mtime changes even if it means sleeping for a second.
	[aaf540bec363]

	* src/lib-storage/index/mbox/mbox-sync.c:
	minor cleanups
	[a56cf574cf01]

	* src/lib/istream-file.c:
	Removed caching from i_stream_stat(). The changes could be important
	in mbox syncing.
	[a390752a2a32]

	* src/lib/ioloop.c:
	Don't die if "time moved backwards" sleep is interrupted.
	[d9896790cefa]

	* src/lib-index/mail-transaction-log.c:
	Fixed last change: Don't crash now when rotating non-locked log..
	[3a6c1ce11ca1]

	* src/lib-index/mail-transaction-log-append.c:
	If write fails with "not enough space" error, log it instead of
	silently handling it.
	[a7af07ca334f]

	* src/lib-index/mail-transaction-log.c:
	Don't crash when rotating locked in-memory log file.
	[d96fa7f99607]

	* NEWS, configure.in:
	Released 1.0.rc26.
	[bd080976b96b]

	* src/auth/auth-request.c:
	Fixed a crash when non-plaintext mechanism used auth_cache.
	[67bd670c4c1c]

	* src/login-common/sasl-server.c:
	After calling sasl_callback() the client may be destroyed already.
	Don't try to modify it.
	[5db849212114]

	* src/lib-sql/driver-pgsql.c:
	t_push/t_pop the callback.
	[21c57e462c0d]

	* src/lib-sql/driver-pgsql.c:
	Queueing code was somewhat broken and caused queries to get lost.
	[247e784e9d36]

2007-03-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	Added assert.
	[992762b82c98]

	* src/lib-storage/index/index-mail.c:
	Changed i_unreached() to more informative i_panic().
	[3bdd325825c7]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction-view.c, src/lib-index/mail-index-transaction.c:
	When adding mails to index in non-sorted UID order and then using
	mail_index_get_header(), the next_uid field could have been wrong.
	[bcd5cdccd58d]

	* src/plugins/convert/convert-storage.c:
	Log errors given by storage. Convert hierarchy separators in mailbox
	names.
	[38c418554f22]

	* src/lib-storage/index/index-storage.c:
	If moving to memory fails, make sure we open the index with create
	flag set.
	[b47a759678f0]

	* src/lib-index/mail-index-sync-update.c:
	When we were syncing in-memory maps, we still should have updated
	the log file offsets because other views could have used them.
	[93a7a044bbc4]

	* src/lib-index/mail-index.c:
	mail_index_move_to_memory(): Mark index as being in memory even if
	the file hasn't been opened yet.
	[4b4f9bacfa64]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Don't crash if user_attrs or pass_attrs is empty. It means all the
	attributes are returned.
	[19d5cfbfaac8]

	* src/lib/ioloop.c:
	If time moves backwards only max. 5 seconds, sleep instead of
	killing ourself.
	[fe1cf06b4720]

	* src/imap/cmd-list.c:
	With namespace prefixes LSUB prefix.* listed INBOX.INBOX.
	[976386da9370]

	* src/deliver/smtp-client.c:
	Drop out DEBUG environment before calling sendmail binary.
	[a9c90822889e]

	* src/plugins/quota/quota-maildir.c:
	comment typofix
	[4076db179242]

	* src/plugins/quota/quota-maildir.c:
	If maildirsize contained NUL bytes at the beginning of the line
	(could happen with NFS), we stopped parsing the file at that point
	instead of rebuilding it.
	[a959cb430803]

	* configure.in:
	Changed --with-headers to --enable-header-install
	[d3171bdb775a]

	* Makefile.am:
	fix
	[2490076088e8]

	* dovecot-example.conf:
	Updated valid_chroot_dirs and mail_chroot comments.
	[61f68cba8fbc]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	When syncing huge maildirs check once in a while if we need to
	update dovecot-uidlist.lock so that another process won't decide
	that it's stale and overwrite it. Check more often when moving mails
	from new/ to cur/.
	[18a929db1da2]

	* src/lib-index/mail-transaction-log.c:
	Don't try to fsck index file in error conditions if it's not yet
	opened.
	[27273d8178d5]

	* src/lib-index/mail-index.c:
	Check index file's endianess earlier, otherwise we'll complain about
	other problems.
	[7b72ea18c594]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	X-UID brokeness fixing was worse than ever.
	[434f32319bcf]

	* src/deliver/Makefile.am, src/deliver/deliver.c:
	While parsing the input stream ignore the mbox hidden headers so
	that eg. X-IMAP header won't cause us to crash.
	[8546d6646984]

2007-03-01  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	v1.0.rc25 released.
	[4cd066b9fe1d]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	mbox: Don't allow using .imap directory in the mailbox name/mask.
	mbox+dbox: Don't allow using "foo/." or "foo/.." in the masks.
	Although that shouldn't really matter.
	[25b2ba395f7a]

	* src/imap/cmd-append.c:
	Don't crash if mail saving fails.
	[7eebc38f4864]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-limit.c, src/lib/ostream-
	crlf.c:
	Keep stream_errno updated in filter streams.
	[cf30515a2e7a]

	* src/imap/client.c, src/imap/client.h:
	Added asserts to make sure client_destroy() isn't called while we're
	handling commands.
	[334324980a6e]

	* src/imap/client.h:
	Removed unused rawlog flag.
	[3c6c9364a96e]

2007-02-28  Timo Sirainen  <tss@iki.fi>

	* src/plugins/mail-log/mail-log-plugin.c:
	Fixed deleted/undeleted logging.
	[6bb7515d5a67]

	* src/lib/ioloop.c:
	If time moves backwards, kill ourself.
	[40e66f5847a3]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	If next_uid field gets to 2^31-1, handle it without crashing by
	creating a new uidvalidity and renumbering the UIDs (although it
	requires selecting the mailbox twice, first time to get index file
	deleted).
	[c27a4801eaea]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	The previous broken X-UID header fixing code was still broken...
	[515a350b7af1]

2007-02-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-plain.c:
	Don't crash with invalid PLAIN input.
	[e805aa680c96]

2007-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	alloconly pool: pool_unref() shouldn't set the pool pointer to NULL
	unless refcount=0.
	[a466e40ab064]

2007-02-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	If prefix.INBOX has children and we're listing under prefix.%, don't
	drop the prefix.
	[691fc260a16a]

2007-02-22  Timo Sirainen  <tss@iki.fi>

	* Makefile.am, configure.in, dovecot-config.in.in,
	src/auth/Makefile.am, src/deliver/Makefile.am, src/imap/Makefile.am,
	src/lib-auth/Makefile.am, src/lib-charset/Makefile.am, src/lib-
	dict/Makefile.am, src/lib-imap/Makefile.am, src/lib-
	index/Makefile.am, src/lib-mail/Makefile.am, src/lib-
	settings/Makefile.am, src/lib-sql/Makefile.am, src/lib-
	storage/Makefile.am, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/dbox/Makefile.am, src/lib-
	storage/index/maildir/Makefile.am, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/subscription-
	file/Makefile.am, src/lib/Makefile.am, src/pop3/Makefile.am:
	Added --with-headers configure option to install .h files.
	[6d9a8376ade1]

	* NEWS, configure.in:
	Released 1.0.rc24.
	[e1c29644f001]

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	KEEP_LOCK: When using dotlock, touch it every 10 seconds.
	[8041dbac80d2]

	* src/plugins/trash/trash-plugin.c:
	Fixed priority handling.
	[5db8f7b15800]

	* src/plugins/trash/trash-plugin.c:
	Fixes for handling multiple storages.
	[ee636d3f4708]

	* src/plugins/trash/trash-plugin.c:
	Minor memory allocation optimizations.
	[ba39c8efd2c6]

	* src/auth/password-scheme.c, src/deliver/deliver.c, src/dict/main.c,
	src/imap/main.c, src/lib/module-dir.c, src/lib/module-dir.h,
	src/pop3/main.c:
	Don't compare to PACKAGE_VERSION in lib/ core directly, rather make
	module_dir_load() have the version string as parameter. Plugin
	version checks can be skipped with version_ignore=yes.
	[89e6566d6c55]

	* src/plugins/acl/acl-plugin.c, src/plugins/convert/convert-plugin.c,
	src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/lazy-expunge
	/lazy-expunge-plugin.c, src/plugins/mail-log/mail-log-plugin.c,
	src/plugins/quota/quota-plugin.c, src/plugins/trash/trash-plugin.c,
	src/plugins/zlib/zlib-plugin.c:
	Added <plugin_name>_version string.
	[4e4a86d4f28e]

	* src/lib/module-dir.c:
	If module contains a <module_name>_version string, fail if it
	doesn't match PACKAGE_VERSION.
	[d64da8b50da6]

	* src/lib/ostream.c:
	If o_stream_send_istream() fails, make sure errno is set to
	outstream.stream_errno.
	[9114b8658d1c]

	* src/lib-storage/index/maildir/maildir-save.c:
	cleanup
	[915f6a6b1758]

	* src/lib-index/mail-cache-transaction.c:
	Crashfix in error conditions.
	[5ed05e57c0d0]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	If uidlist locking fails because of a timeout, given timeout error
	message to user instead of internal error.
	[348e4ccaffab]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	When using KEEP_LOCK, the mbox/uidlist file must be locked before
	index file is opened. Otherwise we can end up in a deadlock.
	[99769563839c]

	* src/pop3/client.c:
	If INBOX can't be opened, give better error messages. The reason is
	never "INBOX doesn't exist for user".
	[1ebe3ab87a22]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c:
	If KEEP_LOCK is set and we timeout, don't crash.
	[9908aeb0679b]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox/dbox-
	uidlist.c, src/lib-storage/index/dbox/dbox-uidlist.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	If pop3_lock_session=yes, update maildir/dbox uidlist lock file
	every 10 seconds so it won't be treated as a stale lock.
	[989a855c37cb]

	* src/auth/passdb-pam.c:
	PAM dead-child timeout function was called 1000 times too often.
	[2318896837dd]

2007-02-20  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	Released 1.0.rc23.
	[dbc6d7c21d19]

	* src/plugins/quota/quota-fs.c:
	Linux quota v1 apparently returns current quota in kilobytes, not
	bytes as v2.
	[ae7d3f9bb976]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	If authentication failed but it still returns proxy, don't do the
	proxying.
	[0f4c7c7b5363]

	* src/master/master-settings.c:
	dovecot -n/-a dumps now also dict/plugin settings.
	[66de909ea2ea]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Rewriting still wasn't replacing broken X-UID headers correctly
	always, causing assert-crashes.
	[41c9c0784354]

2007-02-19  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	proxy and nologin was broken in last changes.
	[7d6cc50b60ca]

	* src/auth/passdb-blocking.c:
	Removed unused variable
	[93892619d649]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h:
	Drop X-Delivery-ID header when saving the message.
	[55b7fc6cf104]

	* src/lib-storage/index/mbox/mbox-save.c:
	If pop3_uidl_format=%m, add a unique X-Delivery-ID header to all
	saved mails. Without it it's possible to get duplicate UIDLs which
	some clients don't handle all that well. (eg. mail sent to two
	accounts where one is alias to another will get the exact same
	Received/Delivered-To headers with Postfix)
	[c00e9b3ba680]

	* src/deliver/deliver.c:
	Get pop3_uidl_format even if it's inside protocol pop3 {}
	[88f34145cc17]

2007-02-17  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Added AC_CACHE_CHECK()s to all AC_TRY_RUN and AC_RUN_IFELSE checks
	so that cross compiling is possible.
	[d07b1f337dc7]

	* src/auth/mech-plain.c:
	If authorization and authentication IDs are the same, and both
	contain the master user, the master login failed.
	[a3d1a7cf0e9d]

	* src/auth/auth-request.c:
	auth_request_set_fields(): Don't crash with empty fields.
	[abecf8afdb9f]

2007-02-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c:
	Fixed some wrong "uid-last unexpectedly lost" errors.
	[d1d847534cb7]

	* src/lib/module-dir.c:
	Don't crash at deinit if no modules are loaded.
	[a35ec64026e1]

	* src/plugins/trash/trash-plugin.c:
	Although messages were expunged, the expunges weren't counted in
	that same transaction and the APPEND failed.
	[2a13636cbc9a]

	* src/plugins/trash/trash-plugin.c:
	If trash mailbox couldn't be opened, don't crash later either.
	[7d8fab84db9e]

	* src/lib/module-dir.c:
	module_dir_init() was calling the init() functions in reverse order.
	[be90fd21efdf]

	* src/auth/checkpassword-reply.c:
	If USER environment is set, return it in "user" field and not
	"userdb_user". Also don't require that the USER environment exists.
	[e0d4a54d76b8]

	* src/auth/passdb-checkpassword.c:
	Use auth_request_set_fields() to set the fields returned by
	checkpassword script instead of auth_stream_import()ing directly
	into extra_fields. This way checkpassword can set special extra
	fields.
	[a02eba977fb0]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/passdb-
	blocking.c, src/auth/passdb-cache.c:
	Added auth_request_set_fields() and used it instead of duplicating
	the code in multiple places.
	[b749d87dcc42]

	* src/auth/checkpassword-reply.c:
	Don't crash if USER or HOME environment is missing. Allow HOME
	environment not to exist.
	[84405c8fdf4d]

	* src/imap/cmd-append.c:
	APPEND ate all CPU if client didn't send the message fast enough
	(since rc22).
	[777cacd30d30]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	If authentication fails and we've already destroyed the client,
	don't go io_add()ing the client anywhere.
	[faf9fca0c99b]

	* src/login-common/sasl-server.c:
	Make sure we crash if we're trying to call sasl_callback() too many
	times.
	[11b930e988e9]

	* src/auth/password-scheme.c, src/deliver/deliver.c, src/dict/main.c,
	src/imap/main.c, src/lib/module-dir.c, src/lib/module-dir.h,
	src/pop3/main.c:
	module_dir_load() doesn't call init() functions anymore. Added a new
	module_dir_init() which does it. This way imap/pop3 can load the
	modules before chrooting and initialize them after.
	[eb1e74f45da9]

	* src/plugins/trash/trash-plugin.c:
	If trash mailbox can't be opened, don't crash.
	[26b154b42bb6]

	* src/auth/auth-worker-client.c:
	Blocking passdbs didn't work as masterdbs.
	[1fe0f1aa9a07]

	* src/lib-index/mail-cache.c:
	Allocate cache file's size amount of memory for the file cache so it
	doesn't have to grow it constantly while reading the file.
	[7cf6592ebe57]

	* src/lib/file-cache.c, src/lib/file-cache.h:
	Made file_cache_set_size() public.
	[5e3c781736f5]

2007-02-15  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Don't bother trying to save the mail twice into the default mailbox
	(eg. if it's over quota).
	[29ae2204ab3e]

	* dovecot-example.conf:
	Cleaned up the log_file and info_log_file comments.
	[5223ba63760e]

	* src/deliver/deliver.c:
	Hook all exit()s and if the exit code is one of Dovecot's own
	FATAL_* ones, replace them with EX_TEMPFAIL.
	[f770d0f762e3]

	* src/lib/failures.c, src/lib/failures.h:
	Added i_set_failure_exit_callback()
	[30c2682ae245]

	* src/lib/ioloop.c:
	Delay initializing I/O notify backend until the first notify is
	added. Non-IMAP processes never need notifies.
	[8a5fe45019aa]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	Don't crash if the remote server disconnects before we're logged in.
	[29d27305442e]

	* src/master/auth-process.c:
	Do the delayed login process starting also after SIGHUPing.
	[9f25bb099333]

	* src/master/auth-process.c, src/master/auth-process.h, src/master
	/login-process.c:
	Start auth processes immediately at startup, not after one second
	delay. Don't try to start any login processes before at least one
	auth process has sent back a handshake.
	[2571235c5423]

	* src/pop3/commands.c:
	RSET: Don't rollback the transaction if LAST is enabled (there's no
	point, because all the seen flags are removed anyway).
	[7de2c7c35199]

	* src/auth/auth-request.c, src/auth/passdb-cache.c, src/auth/passdb.c:
	If looking up credentials for NULL passwords, return "scheme not
	available" instead of assert-crashing.
	[5fd23b7fcd1a]

	* src/imap/main.c:
	mail_debug=yes: Log also home directory.
	[7abe107dd635]

	* src/imap/cmd-append.c:
	If we've a mailbox selected and we're appending to another mailbox,
	we got extra FLAGS/PERMANENTFLAGS change notifications.
	[613155b9dfd9]

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/auth-
	request.c:
	If user is changed with "user=x" in extra_fields, cache the entry
	with the original username instead of with the changed username.
	[520694452040]

	* src/auth/auth-request.c:
	Removed assert. "pass" field is allowed to be in extra_fields.
	[e8ce6c7a8ad9]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Special extra_fields weren't saved to auth cache. This was
	especially problematic for allow_nets which was ignored if the user
	was already in cache.
	[1b9e8aba3be2]

	* src/auth/passdb-cache.c:
	If last login was valid and the current one wasn't, we returned "not
	found from cache" but extra_fields still had been modified, which
	could have caused crashes later.
	[aaeb47a4361c]

2007-02-14  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c:
	Don't break if current quota value is negative.
	[9524dba4b9b5]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-storage
	/subscription-file/subscription-file.c:
	fsync() subscriptions file and maildir-keywords before rename()ing
	them.
	[17de9b9f82f8]

	* src/pop3/commands.c:
	If UIDL command can't get the UID, die instead of not returning
	anything and still replying "OK".
	[1f39d6d0e6df]

	* src/lib-storage/index/mbox/mbox-save.c:
	When saving a message to an empty mbox file, write X-IMAPbase header
	so the UID doesn't change.
	[5bbb326864b6]

2007-02-13  Timo Sirainen  <tss@iki.fi>

	* doc/Makefile.am:
	Removed deleted .txt file.
	[1d8815d3dba9]

2007-02-12  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/userdb-passwd.c:
	Added blocking=yes setting to userdb passwd.
	[f6f928450ac3]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	Added blocking=yes to PAM passdb to use auth workers instead of
	forking a new process for each lookup.
	[b735351cd8cd]

	* src/auth/passdb-pam.c:
	If PAM child process hasn't responded in two minutes, send KILL
	signal to it.
	[019004276328]

	* src/master/mail-process.c:
	When running dump-capability, don't do stderr_close_shutdown since
	it could break and make epoll_ctl() return with EPERM.
	[5689765eabbe]

	* doc/Makefile.am, doc/USE-WIKI-INSTEAD, doc/auth.txt,
	doc/configuration.txt, doc/design.txt, doc/index.txt, doc/mail-
	storages.txt, doc/multiaccess.txt, doc/nfs.txt:
	Removed the old and wrong .txt files.
	[189034c0aa77]

2007-02-07  Timo Sirainen  <tss@iki.fi>

	* src/plugins/mail-log/mail-log-plugin.c:
	Don't crash with expunging mails with non-existing message-id
	header.
	[c10ef07a9873]

2007-02-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Removed fsync() call. It doesn't really provide any data integrity
	guarantees, and it could make the performance worse.
	[f0c9931869a9]

	* NEWS, configure.in:
	Released 1.0.rc22
	[f03569c72ccd]

	* src/lib-index/mail-index-sync-update.c:
	We could have skipped transactions completely (broken a few
	revisions ago).
	[7d1d92aa281c]

	* src/lib-index/mail-index-sync-update.c:
	If extension size wasn't 32bit aligned, we broke when syncing it.
	However all the current extensions are 32bit aligned.
	[8e1439a87c91]

	* src/imap/cmd-append.c:
	If client disconnects at the end of append without waiting for a
	reply, handle it properly.
	[30e616d11639]

	* src/lib-mail/istream-header-filter.c:
	_read() could have returned "need more data" in wrong situations,
	which could have caused problems later.
	[bda1f53d95ae]

	* src/auth/passdb-blocking.c, src/login-common/sasl-server.c:
	Assert-crashfixes
	[4ca571382215]

2007-02-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	If namespace has a prefix and inbox=no, don't list prefix.inbox if
	it happens to exist when listing for %.
	[8aab57f13bdf]

	* configure.in:
	Don't use nonportable grep -q.
	[fa5a5c7eb0bd]

	* src/plugins/quota/quota-fs.c:
	BSD filesystem quota was counted wrong. Patch by Manuel Bouyer
	[ae49e8117f07]

	* src/pop3/client.c:
	Commit the transaction even if client didn't QUIT so cached data
	gets saved.
	[5d8413a05bed]

	* src/master/master-settings-defs.c:
	mail_log_max_lines_per_sec was declared as string.
	[2d293755a3e9]

	* doc/dovecot-sql.conf:
	Added an example of how to concat() user and domain.
	[353eca66b6dc]

2007-02-02  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	Released 1.0.rc21
	[6d01f64f004d]

	* src/lib-index/mail-cache-transaction.c:
	crashfix
	[be7f748bb7d7]

	* NEWS, TODO, configure.in:
	1.0.rc20 released.
	[c152be4a207a]

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings-defs.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added mail_log_max_lines_per_sec setting.
	[42b7df8a5afb]

	* src/pop3/Makefile.am:
	Make sure str-sanitize.o is linked so mail_log plugin works.
	[91ddd0934b51]

	* src/lib-index/mail-index-view.c:
	Another lookup_uid_range() seq2 bugfix/crashfix.
	[1b69397319a8]

	* src/lib-storage/index/index-mail.c:
	Minor optimization
	[a6f53ffc21ec]

	* src/lib-index/mail-cache-transaction.c:
	If cache file wasn't opened yet when flushing a transaction, the
	changes weren't written to the file. Also fixes a "invalid record
	size" bug which could have happened when transaction flush failed.
	[d2d5672f827b]

2007-02-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	Setting flags other than seen/deleted was broken.
	[33a918702996]

2007-01-30  Timo Sirainen  <tss@iki.fi>

	* doc/variables.txt:
	Added a note about %E not needed with SQL queries.
	[2f9b87881ad3]

2007-01-28  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	If mailbox initialization failed, log an error instead of just
	telling about it to the client.
	[d1e10884ac1c]

2007-01-27  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Added --log-error command line option.
	[4b059e491b4b]

2007-01-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-handler.c, src/auth/mech-rpa.c, src/auth
	/passdb-checkpassword.c, src/imap/imap-sync.c, src/lib-auth/auth-
	server-request.c, src/lib-index/mail-transaction-log-view.c, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/mbox/mbox-save.c, src/lib/lib-
	signals.c, src/login-common/main.c, src/master/login-process.c,
	src/master/ssl-init-openssl.c, src/plugins/quota/quota-maildir.c,
	src/pop3/commands.c, src/util/rawlog.c:
	Cleanups and minor fixes
	[8b962bec82a0]

	* src/auth/mech-apop.c:
	Verify the APOP input before passing it to sscanf() to make sure
	it's NUL-terminated.
	[4004c886b71f]

	* src/lib/istream-seekable.c:
	cleanup
	[c42a48ddb3dc]

	* src/auth/auth-request-handler.c:
	code cleanup
	[5faa473f89c9]

2007-01-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-transaction.c:
	If save_commit_pre() fails, rollback the transaction.
	[75ae8767f489]

	* src/lib-index/mail-index-view.c:
	lookup_uid_range(): Last change could have caused the returned seq2
	to be too high, causing all kinds of problems.
	[9f3e9ff9f789]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Error handling fixes
	[323feea3d4a3]

	* src/imap/imap-fetch-body.c:
	If we disconnect the client because message ended unexpectedly, log
	an error.
	[973c75b62a51]

	* src/master/main.c:
	If we see exit for unknown child process, log an error but don't
	crash. If net_listen() fails with EINTR, try again unless it was
	interrupted by INT/TERM signal.
	[b58ee3018a59]

	* src/lib-storage/index/mbox/mbox-mail.c:
	If we can't find the mail from dirty mbox even after syncing, fail
	with error instead of looping forever.
	[21784c8245af]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	When verifying a mail's location in dirty mbox with invalid X-UID
	headers that weren't yet rewritten, we would trust the X-UID header
	and cause the verification to fail. Now we trust it only if it's
	valid, otherwise fallback to MD5 sum of the header.
	[c491c4458336]

2007-01-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view.c:
	Crashfix
	[7512baba9992]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Don't append "/." to control dir when asking it for "".
	[dbc8875f6e50]

	* src/master/mail-process.c:
	If exec() fails, don't close 0..3 fds before logging the error.
	There's really no point, and it closes the logging fd so the exec()
	error can't be logged.
	[c2fce3fe9d29]

	* src/plugins/quota/quota-maildir.c:
	Fixed a file descriptor leak.
	[4735f77e8cc2]

	* src/auth/auth-request.c:
	If auth_cache was enabled and userdb returned "user unknown"
	(typically only deliver can do that), we crashed.
	[651bba8050a6]

2007-01-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	"View synchronization from transaction log failed": Log also the
	index filename.
	[48e0cfd447c2]

	* NEWS, configure.in:
	1.0.rc19 released
	[802685677fcc]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-view-sync.c:
	Some mmap_disable=no fixes. Some debug additions. Some generic index
	fixes.
	[7bfecd0e7509]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-sync.c:
	Log a warning when we're starting fsck. Log error before calling
	fsck.
	[645c41a2f029]

	* src/lib-index/mail-index-sync-update.c:
	cleanups
	[720f6dc4f72d]

	* src/plugins/acl/acl-backend-vfile.c:
	If control_dir wasn't specified, we complained about ACL file
	existing in it.
	[68f6f4a37106]

	* src/lib-index/mail-index.c:
	Fix for last check
	[81532742bfec]

	* src/lib-index/mail-index.c:
	cleanups
	[a7bdb31e7f73]

	* src/lib-index/mail-index.c:
	mmap_disable=yes: Verify that header_size and messages_count are low
	enough so we don't try to allocate too much memory.
	[53a618b86369]

2007-01-22  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	Released 1.0.rc18
	[33becbd80a40]

	* TODO:
	updated
	[c0dc0196a86d]

	* autogen.sh:
	Removed -f option from autoreconf, since it overwrites our INSTALL
	file.
	[31046b3616eb]

	* src/lib-storage/index/maildir/maildir-copy.c:
	maildir_copy_with_hardlinks=yes could have caused "Duplicate file in
	uidlist" errors. The fix slows it down a bit though, the files are
	now always first hardlinked to tmp/ and later rename()d from there
	to cur/ or new/.
	[8063a952a4fc]

	* src/lib-index/mail-index-transaction.c, src/lib-
	storage/index/maildir/maildir-save.c:
	Added asserts
	[60adc7855601]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	Restore sync_ctx->next_uid to original value when beginning a
	rewrite. This could fix some problems with broken UIDs causing
	crashes.
	[67811547ad4e]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If mbox had broken UIDs and we didn't rewrite them, don't mark the
	index as being synced.
	[0f4ef6fb78a9]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	If message had one invalid X-UID and another valid X-UID, we still
	marked the valid one with uid_broken=TRUE.
	[a8429aef9bf7]

	* src/lib-index/mail-index-sync-keywords.c:
	Removed accidentally committed debug assert.
	[feca05647a0f]

	* src/deliver/deliver.c:
	If config file contained quoted "value", the quotes weren't
	stripped. syslog_facility wasn't converted from name to numeric
	value.
	[3d07968a689a]

2007-01-21  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If log_timestamp isn't uncommented in dovecot.conf, use the default.
	[c8c68b7dfb83]

	* src/login-common/login-proxy.c, src/login-common/login-proxy.h:
	Forgot to commit for the "log proxy destination" change.
	[2cb8d0feab3e]

2007-01-19  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c:
	Moved dovecot-acl file from control dir to mail directory, except
	with mboxes. If the file still exists in control dir, Dovecot kills
	itself (rather than give full access to the mailbox).
	[49f2fad65108]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	Log the proxy destination host:port.
	[d799c137cc85]

	* src/imap/cmd-status.c:
	Doing a STATUS for unknown storage shouldn't return with "needs more
	data" from the function.
	[6bb118e1760c]

	* src/plugins/quota/quota-dict.c:
	messages=n actually updated storage.
	[ce9f9e306aad]

	* src/deliver/deliver.c:
	Ignore empty parameters. "Unknown argument: xx" printed wrong
	argument. Patch by Jan Srzednicki
	[ed5734f70bd0]

	* src/lib/failures.c:
	If we can't open the log file, write the error to stderr instead of
	relying on the existing fatal handler which may not do anything.
	[3204df7c6c3a]

	* dovecot-example.conf:
	Removed umask setting from here. It's just confusing here because
	changing it won't anyway work as intended.
	[f95ba2627ea2]

	* src/plugins/Makefile.am:
	Forgot to add mail-log here.
	[74f2340e08e5]

	* src/auth/db-ldap.c:
	Removed accidentally committed debugging code.
	[d8d437194a40]

	* src/auth/auth-request.c:
	auth cache: If passdb didn't provide the password, we used the user-
	given plaintext password, but we cached it with wrong scheme unless
	the passdb's default scheme was plain.
	[99e74c3cd7f8]

	* src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/auth-request-handler.c, src/auth/auth.c,
	src/auth/db-ldap.h, src/auth/main.c, src/auth/userdb-ldap.c:
	Several fixes to handling deinitialization without crashing.
	[4afbe5c9e2d2]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c:
	Do ldap_bind() only when there are no requests waiting, and don't do
	anything until ldap_bind() has finished. This fixes several problems
	with auth_bind=yes.
	[cc40e9ce5863]

	* src/auth/auth-request.c:
	If request fails with internal failure, don't crash if auth cache is
	disabled.
	[b091dda43e7a]

2007-01-18  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Allow --with-vpopmail=path specify the vpopmail_home path.
	[79248a1137f5]

	* configure.in, src/plugins/mail-log/.cvsignore, src/plugins/mail-
	log/Makefile.am, src/plugins/mail-log/mail-log-plugin.c, src/plugins
	/mail-log/mail-log-plugin.h:
	Added mail_log plugin to log various mail operations. Currently it
	logs mail copies, deletions, expunges and mailbox deletions.
	[55115da32943]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c:
	Saved mails and dovecot-keywords file didn't set the group from
	dovecot-shared file.
	[74b36e3c96b4]

	* dovecot-example.conf:
	Removed mail_read_mmaped setting from the example config. It still
	exists, but since it might not work too well, it's better to just
	hide it so new people won't enable it..
	[cdf26e50b4a1]

	* src/lib/ioloop-notify-inotify.c:
	If inotify_add_watch() fails with ESTALE, don't log an error.
	[d561ffc5453c]

	* src/master/master-settings.c:
	base_dir doesn't need to be group-readable, don't force it.
	[81a0b105e709]

	* src/lib-index/mail-cache-compress.c:
	debug: Don't bother warning about cache compressions. It has lived
	its usefulness.
	[07838d38c35a]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool-unsafe-datastack.c,
	src/lib/mempool.h:
	Don't keep the memory pool virtual functions in the pool structure
	itself, rather access them via a pointer to a shared virtual
	function struct. Reduces memory usage a bit.
	[f3c18b31ea36]

	* src/lib/buffer.c:
	cleanup
	[f0d3723d9455]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-index/mail-index.c:
	Keywords were sometimes being re-added to the index even while they
	already existed, causing the record size to bloat.
	[0a18e7f056bb]

2007-01-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	Don't rename() .log to .log.2, because it temporarily loses the log
	file. Use unlink() + link() instead.
	[703cf073f937]

	* src/lib-index/mail-index-view-sync.c:
	unreliable_flags wasn't always set correctly, which caused "xxx
	counter wrong" errors and such.
	[357276249161]

	* src/lib-index/mail-index-fsck.c:
	cleanup
	[0b316c370348]

	* src/lib/ioloop-notify-dn.c:
	Disable dnotify silently if it's not supported by the kernel. We
	were missing one check.
	[af2292eef1a7]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c:
	Fixes to error handling paths.
	[20152d20fb05]

	* src/lib-index/mail-index-sync-ext.c:
	A new "extension introduction" in transaction log could have left
	some existing views to contain an invalid mapping where it contained
	the new extension, but with a wrong record_size.
	[105de7d684c9]

	* src/lib-index/mail-transaction-log.c:
	And now really fix the log rotation race.
	[0f2977020aec]

	* src/lib-index/mail-cache.c:
	Make sure file_seq isn't zero in cache file header.
	[82a3278f2461]

2007-01-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c:
	Fixed a race condition in transaction log rotation, which could have
	caused log data to be overwritten.
	[bc076e4a1cf3]

	* src/lib-index/mail-index-sync-update.c:
	cleanup
	[51855ac3d787]

	* src/lib-index/mail-index.c:
	Make sure that extensions don't point outside allocated record size.
	[d53e0cb45da0]

	* configure.in, src/lib-storage/index/maildir/maildir-storage.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-util.c:
	When opening maildir, check if tmp/'s atime is over 8h old. If it
	is, delete old files in it. However if atime - ctime > 36h, it means
	there's nothing to be deleted so the scanning isn't done then. We
	update atime if filesystem is mounted with noatime.
	[79bec2af75ef]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Added some extra checks/asserts
	[459986963f51]

	* src/lib-index/mail-index-view.c:
	UID -> seq lookup: Optimize UID=1 and UID=<next_uid>-1 cases.
	[b70be345b743]

	* src/auth/db-ldap.c:
	Last change for making ldap_bind() error handling better was
	actually broken.
	[eb9a711f0cdd]

2007-01-16  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/auth/auth-cache.c, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/userdb-ldap.c, src/auth/userdb-passwd-file.c,
	src/auth/userdb-passwd.c, src/auth/userdb-sql.c, src/auth/userdb-
	vpopmail.c, src/auth/userdb.h:
	Authentication cache caches now also userdb data. Code by Tommi
	Saviranta.
	[703370087793]

2007-01-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-handler.c, src/auth/auth-stream.c, src/auth
	/auth-stream.h, src/auth/passdb-blocking.c, src/auth/userdb-
	prefetch.c:
	extra_fields == NULL and empty extra_fields (reset after each passdb
	lookup) should be treated the same. Fixes some assert crashes.
	[9a486f85875a]

2007-01-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c:
	We could have synced external transactions multiple times, causing
	corrupted view errors.
	[9f9c1141e91b]

	* src/lib-index/mail-index-view-sync.c:
	View syncing could have caused some transactions to be synced
	multiple times in some situations.
	[179244d36ced]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h:
	Removed file offset caching from mail_cache_foreach(). It didn't
	work correctly when cache file was just compressed, and caused
	"cache file corrupted" errors.
	[54b50ce1b6b6]

	* autogen.sh:
	Copy config.rpath before running autoreconf.
	[bf34b05fa282]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Grow the initial pool sizes a bit.
	[4e9480e19a44]

2007-01-09  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Delete all auth-worker.* files from Dovecot's base_dir when
	starting.
	[3d632792f84f]

	* src/lib-mail/message-body-search.c:
	When searching MIME body headers, make sure we don't go out of
	bounds with broken MIME messages and cause assert-crash.
	[24d810dafa47]

	* src/auth/db-ldap.c:
	If ldap_bind() fails directly, log the "ldap server down" errors
	more nicely.
	[2e6c82a765ea]

2007-01-07  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	1.0.rc17 released
	[836e59b34cbb]

	* src/auth/userdb-blocking.c:
	We sent extra "OK" to master, causing it to think it was the
	username.
	[b9c867a5c185]

2007-01-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	Don't assert-crash if a command is waiting in queue after we've
	disconnected the client for some reason.
	[6a062ba9b6f0]

	* NEWS, configure.in:
	Released 1.0.rc16
	[79f38904da4f]

	* src/util/rawlog.c:
	Added -i and -o options to rawlog to restrict logging to only input
	or output.
	[296dad5ca025]

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	If index/control dirs were different than the maildir, deleting
	mailboxes didn't move their contents correctly.
	[d09652626c0d]

2007-01-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-cache.c:
	Changed assert so it doesn't give a compiler warning with 32bit
	systems.
	[a335e6af6316]

	* autogen.sh:
	Comment out the configurable dir environments.
	[8be2001a1e78]

	* .cvsignore:
	Added config.rpath
	[2e93f853cb8d]

	* autogen.sh:
	Rewrite. Use autoreconf now. Also copy config.rpath from gettext's
	directory.
	[7a8f6915e7db]

	* src/master/Makefile.am:
	master-settings-defs.c wasn't listed anywhere
	[e8e7d8a79cd2]

	* src/login-common/main.c:
	Potential crashfix
	[779573f3d36e]

	* src/login-common/main.c:
	Don't keep a connection open to dovecot-auth when we're only
	proxying.
	[f7688275e645]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	mail_full_filesystem_access=yes: If trying to access ~user directory
	for a user that doesn't exist, just treat it as a normal mailbox
	that begins with '~'. Before we created such mailboxes into home
	directory and trying to delete them crashed.
	[4a7a0a45d5da]

	* src/lib/home-expand.c, src/lib/home-expand.h:
	Added home_try_expand()
	[5a8e30def731]

2006-12-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index.c:
	Minor locking fix/cleanups.
	[017f5c8d0b79]

	* src/lib-index/mail-index-view-sync.c:
	If we didn't sync everything in the view, we could have synced some
	transactions multiple times causing different kinds of problems.
	[a455261e1e5d]

2006-12-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c:
	If cache compressing notices that it was compressed after locking,
	we left the cache file locked. Also in case of errors we left it
	locked.
	[da521bbb3324]

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib/mempool-
	alloconly.c, src/lib/mempool.h:
	debug: MEMPOOL_GROWING prefix in alloconly pool names means that
	when the memory pool needs to be grown, there's no need to log a
	warning.
	[2f85102e6be5]

	* src/lib-storage/index/maildir/maildir-keywords.c:
	Grow default pool size
	[235cef87d1ef]

	* src/lib/fd-close-on-exec.c:
	debug: OSX leaks an fd from gettimeofday(), ignore it. Also cleaned
	up the code a bit.
	[5e75bbcc8353]

2006-12-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view.c:
	If there are transactions left while unlocking, don't unlock. Also
	added some next_uid debugging.
	[62d7735f87af]

	* src/master/main.c:
	If ssl_disable=yes, don't bother resolving ssl_listen. Also if
	listen or ssl_listen resolving fails, log if it was listen or
	ssl_listen setting that caused the error.
	[15495df78ec6]

	* src/imap/cmd-fetch.c, src/imap/imap-fetch-body.c, src/imap/imap-
	fetch.c, src/imap/imap-fetch.h:
	When client fetches message data that has already been expunged,
	reply with dummy NIL and such values for the message. Don't
	disconnect the client anymore.
	[a1f8d598c76b]

	* src/lib/ioloop-poll.c:
	If we get POLLNVAL, disable events completely for the io so we don't
	just loop forever.
	[6bce616d48e0]

	* src/master/mail-process.c:
	Forgot to send dotlock_use_excl to mail processes..
	[a25144f71964]

	* src/plugins/acl/Makefile.am:
	ACL plugin was supposed to be with 01 priority, not 10.
	[c205f55473fb]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox/dbox-
	sync-expunge.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-lock.c:
	More dotlock_use_excl uses.
	[ac6d109cbced]

	* src/plugins/quota/quota-maildir.c:
	And compile fix..
	[31a4789e4e71]

	* dovecot-example.conf, src/deliver/duplicate.c, src/lib-index/mail-
	cache.c, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log.c, src/lib-storage/index/index-storage.c, src/lib-storage/mail-
	storage.c, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/master/master-settings-
	defs.c, src/master/master-settings.c, src/master/master-settings.h,
	src/plugins/convert/convert-storage.c, src/plugins/quota/quota-
	maildir.c:
	Added dotlock_use_excl setting.
	[cb99a64f1841]

	* src/lib-storage/index/maildir/maildir-save.c:
	Use rename() instead of link() + unlink() when moving a mail from
	tmp/ to new/.
	[0dccda0012ee]

	* src/lib-auth/auth-client.c, src/lib-auth/auth-server-connection.h:
	If no auth sockets are found in 10 seconds, kill ourself.
	[db1cc7def10a]

	* src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h:
	-n and -a parameters shouldn't be deleting auth sockets.
	[4bfca12420a0]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-backend.c,
	src/plugins/acl/acl-plugin.c:
	If debug is enabled, log some debugging messages. Also cleaned up
	the code bit, and made "acl = vfile" not require ":" after the
	"vfile".
	[8dca4cb3cc64]

	* src/deliver/Makefile.am, src/deliver/deliver.c, src/master/master-
	settings-defs.c, src/master/master-settings.c:
	deliver was treating boolean settings set to "no" as if they were
	"yes" (usually they were supposed to be commented out)
	[f8d43a17ae14]

2006-12-23  Timo Sirainen  <tss@iki.fi>

	* TODO:
	Updated
	[4d56eeebee1a]

2006-12-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c:
	s/Backtrace/Raw backtrace/
	[d4624eb0e209]

2006-12-22  Timo Sirainen  <timo.sirainen@movial.fi>

	* dovecot-example.conf, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added maildir_copy_preserve_filename setting.
	[0240ff543f69]

2006-12-22  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Changed maildir_copy_with_hardlinks setting's description to be much
	more positive. It'll probably be set to yes by default in v2.0.
	[872a1773a326]

2006-12-21  Timo Sirainen  <tss@iki.fi>

	* src/util/dovecotpw.c:
	argv[] isn't unused.
	[e27f44ba641c]

	* src/util/dovecotpw.c:
	getopt() return value should be stored into int, not into char.
	Fixes PowerPC Linux where char is unsigned.
	[b134dba1ae81]

	* dovecot-example.conf:
	auth_cache_size comment updated. It no longer has problems with
	identical usernames in different databases.
	[37176fea78d7]

	* src/auth/userdb-sql.c:
	"Password query" -> "User query" in error messages.
	[4d972275cc64]

	* src/lib/module-dir.c:
	If the module dir doesn't exist, die only if we were given a list of
	modules to load. Otherwise fail silently.
	[e63524c381d1]

	* src/auth/passdb.c:
	Fix
	[327fbd7615c9]

	* src/lib/module-dir.c:
	Give an error if there are duplicate files for a single module. Also
	if the module directory can't be opened, die immediately.
	[aabcf9035f40]

2006-12-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-status.c:
	If STATUS command is done for a selected mailbox, don't sync it.
	This could have caused lost EXPUNGEs among other lost replies..
	[b108fe6b63c5]

	* src/imap/client.c:
	Fix for last change..
	[b64f38e98359]

	* src/imap/cmd-idle.c:
	Take back the last change in here. It was correctly handled already.
	[ad9d66edab34]

	* src/imap/client.c, src/imap/cmd-idle.c:
	Fixed potential hang problems.
	[5831870e1755]

	* src/pop3/main.c:
	"Set pop3_uidl_format in config file" may be easier to understand..
	[850667a5e241]

	* dovecot-example.conf:
	Updated pop3_uidl_format comments.
	[4734c7118b6a]

	* src/imap-login/client-authenticate.c, src/login-common/common.h,
	src/pop3-login/client-authenticate.c:
	"Plaintext authentication disabled" -> "Plaintext authentication
	disallowed on non-secure connections"
	[eb4d28d64dc7]

2006-12-17  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Fixed a file descriptor at deinit.
	[f259628a8559]

2006-12-17  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	Fixes
	[8fe13bbeccd6]

2006-12-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.h:
	maildir_file_do() takes uid, not seq..
	[57e550061bf3]

2006-12-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/password-scheme.c:
	Changed the default naming for password schemes: HMAC-MD5 -> CRAM-
	MD5. MD5
	-> MD5-CRYPT. The old names still work for backwards compatibility.
	[3b208585b1a1]

2006-12-16  Timo Sirainen  <timo.sirainen@movial.fi>

	* configure.in, dovecot-example.conf, src/plugins/Makefile.am,
	src/plugins/lazy-expunge/.cvsignore, src/plugins/lazy-
	expunge/Makefile.am, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/lazy-expunge/lazy-expunge-plugin.h:
	Added lazy expunge plugin.
	[13624eece6ab]

2006-12-16  Timo Sirainen  <tss@iki.fi>

	* src/imap/namespace.c, src/imap/namespace.h:
	Added namespace_find_prefix() function.
	[05283f5d6dbf]

	* src/plugins/acl/Makefile.am, src/plugins/convert/Makefile.am,
	src/plugins/imap-quota/Makefile.am, src/plugins/quota/Makefile.am,
	src/plugins/trash/Makefile.am, src/plugins/zlib/Makefile.am:
	Changed the plugin filename numbering (ie. the ordering in which the
	plugins are loaded). This doesn't change anything for current
	plugins, but future plugins will need this change so they can get
	themselves loaded between specific plugins.
	[0c8df8a42574]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib/compat.h:
	Added EDESTDIREXISTS() macro, and changed rename() calls to use it.
	[898a6643bd29]

	* src/lib-storage/index/maildir/maildir-storage.c:
	rename and delete operations didn't touch control directory if it
	was different from maildir or index dir.
	[7e14fdcdb06a]

2006-12-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/namespace.h:
	Minor cleanup
	[9f7dfad17acd]

2006-12-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view.c:
	If looked up record contains UID=0, mark the index corrupted.
	[ab67ca912820]

2006-12-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c, src/auth/auth-request-handler.c,
	src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/userdb-blocking.c, src/auth/userdb-ldap.c,
	src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c, src/auth
	/userdb-prefetch.c, src/auth/userdb-sql.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c, src/auth/userdb.h:
	We treated internal userdb lookup errors as "user unknown" errors.
	In such situations this caused deliver to think the user didn't
	exist and the mail get bounced.
	[a0620a3db0d5]

2006-12-05  Timo Sirainen  <tss@iki.fi>

	* src/login-common/sasl-server.c:
	proxy=y logins can't log in either.
	[d2ac4992f51a]

2006-12-03  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	Fixed crash with proxying.
	[d653002728ca]

	* src/auth/auth-request.c, src/auth/password-scheme.c:
	Don't crash if plain-md5, plain-md4 or sha1 password is invalid and
	we're not using digest-md5 authentication..
	[12c0165e1916]

	* src/master/mail-process.c, src/plugins/quota/quota.c:
	// comments -> /* */ comments
	[29bd9ea7b394]

	* src/plugins/quota/Makefile.am, src/plugins/quota/quota-count.c,
	src/plugins/quota/quota-dict.c, src/plugins/quota/quota-private.h:
	dict quota: If dictionary doesn't yet contain the quota, calculate
	it by going through all mails in all mailboxes.
	[c9a8c6ee4c1c]

	* src/auth/passdb-pam.c:
	Set default_pass_scheme so that cache_key works instead of just
	assert-crashing.
	[2da98cf5f901]

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	Added ignore setting to maildir quota, which allows ignoring quota
	in Trash mailbox.
	[d77b098b6d5f]

	* src/lib/restrict-access.c:
	restrict_gid_first/last wasn't working correctly for non-primary
	groups. Also restrict_gid_first=0 caused failures if user had 0 in
	non-primary groups.
	[0f3973e46384]

	* src/lib/file-cache.c:
	If mremap_anon() fails, don't leak/crash.
	[b99bc6fb4902]

	* src/lib/file-cache.c:
	Check against offset/size overflows.
	[31247b0a5281]

	* src/lib-storage/index/maildir/maildir-keywords.c:
	Use dovecot-shared file's mode also when creating dovecot-keywords
	file.
	[c631a7bd6b7e]

	* configure.in, src/auth/mech-gssapi.c:
	Some systems have gssapi elsewhere than gssapi/gssapi.h. So check
	also plain gssapi.h. Based on patch by Chris Wakelin
	[778d228f1f3a]

	* doc/variables.txt, src/login-common/client-common.c, src/login-
	common/client-common.h, src/login-common/main.c:
	Added %a=local port and %b=remote port variables for
	login_log_format_elements.
	[cc1da4127fb6]

	* dovecot-example.conf, src/plugins/convert/convert-plugin.c,
	src/plugins/convert/convert-storage.c, src/plugins/convert/convert-
	storage.h, src/plugins/convert/convert-tool.c:
	Create storages with MAIL_STORAGE_FLAG_NO_AUTOCREATE flag so we
	don't keep recreating the old storage and converting it all the
	time. Also added convert_skip_broken_mailboxes flag.
	[bb41f89a2876]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.h:
	Added MAIL_STORAGE_FLAG_NO_AUTOCREATE flag which silently fails
	storage creation if the root directory doesn't exist. Otherwise the
	root dir is created.
	[9255d575db2c]

	* src/login-common/sasl-server.c:
	Uppercase the auth mechanism name so it's always uppercased in logs.
	[47e75cbf43a9]

	* doc/variables.txt:
	Added smtp and deliver to %s explanation.
	[593837847ef5]

2006-11-27  Timo Sirainen  <tss@iki.fi>

	* src/util/gdbhelper.c:
	Ignore SIG32 signal.
	[5bb757adbba7]

2006-11-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-interface.h:
	Auth request timeout needs to be larger than login process timeout,
	which was just increased.
	[5534264af53d]

2006-11-24  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	Increase allowed pre-login idle timeout from 1 minute to 3 minutes.
	This allows the user to type the password more slowly, although I
	haven't heard this causing problems for anyone.
	[55c7d83eb92b]

2006-11-20  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	chdir() now gives error only if error is something else than ENOENT.
	Also with debugging enabled log if the home isn't found.
	[ddeebcf6ae06]

2006-11-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/backtrace-string.c:
	Handle backtrace_symbols() returning NULL without errors (out of
	memory).
	[b8296a0c213f]

	* configure.in, src/lib/Makefile.am, src/lib/backtrace-string.c,
	src/lib/backtrace-string.h, src/lib/failures.c:
	Since getting core dumps can be sometimes difficult, if we now do
	abort() ourself, we first log the backtrace. This works at least
	with Linux and Solaris.
	[8cb960647473]

	* NEWS, configure.in:
	Released 1.0.rc15.
	[628cc1c05b38]

	* src/lib/file-cache.c:
	And accidentally reverted the first buffer overflow fix in the
	second commit..
	[2f86f2a4eeaf]

	* src/lib/ostream-file.c, src/lib/ostream.c:
	If connection is closed while buffer is being flushed in uncorking,
	don't assert-crash.
	[c531d3e62511]

	* src/lib/file-cache.c:
	And another off-by-one buffer overflow fix.
	[1af761291a7a]

	* src/lib/file-cache.c:
	Off-by-one buffer overflow fix. The code gets executed only with
	mmap_disable=yes when it's reading cache file.
	[e28f54ce1b0d]

	* src/auth/passdb-checkpassword.c:
	Handle vpopmail's nonstandard exit codes.
	[42e3aa8724a0]

	* src/auth/auth-request.c:
	When invalid character is found from username, say what character it
	is in the log message. Also with auth_debug=yes log the whole
	username (sanitized).
	[f9b04710a948]

2006-11-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-keywords.c:
	If we can't open dovecot-keywords file, don't crash.
	[b0131038dc8a]

	* src/imap/client.c:
	Added asserts
	[1acce1f546a7]

	* src/imap/cmd-idle.c:
	If syncing finished with an error and client had disconnected, we
	assert-crashed in io_add().
	[3e84b735f586]

	* src/lib/compat.c:
	my_strncasecmp() was broken.
	[5fe68cca0e44]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c:
	Reference counting fixes. Fixes an assert crash when closing the
	index.
	[2b31415daeb7]

	* src/login-common/ssl-proxy-openssl.c:
	Call ssl_step() at startup instead of ssl_handshake(). If the first
	input packet was sent along with the handshake, we hanged.
	[993f32d72391]

2006-11-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Maildir separator was still hardcoded to '.' in one place.
	[5e89f5ad0985]

2006-11-13  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Solaris LDAP compiling fix.
	[ba03d1e2ad21]

2006-11-12  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If user has a home directory, but we can't chdir() there, log an
	error (but don't fail).
	[7fb21b64b214]

	* src/deliver/mail-send.c:
	Handle fwrite() failure early.
	[bf7d5e124a0f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If ftruncate() fails in error handling (it really shouldn't), log an
	error about it anyway.
	[6bd2d89a97ac]

	* NEWS, TODO, configure.in:
	1.0.rc14 released
	[d4c81793b1fa]

	* src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/plugins/acl/acl-
	backend-vfile.c, src/plugins/quota/quota-maildir.c:
	Fixed some warnings with older gccs.
	[ac886ef251e1]

	* doc/auth-protocol.txt, src/auth/auth-master-connection.c:
	Removed "DIE" command from auth protocol. It wasn't implemented, and
	I'm not sure if it's such a good idea anyway.
	[301a4b9e4178]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-index.h:
	Removed mail_index_update_header_ext(). It's not implemented, it's
	not currently needed and it won't make it into v1.0 anyway.
	[7edffbd8707f]

	* src/master/master-settings.c:
	Minor fix
	[fabecd35858e]

	* src/util/.cvsignore:
	Added gdbhelper
	[73458d759027]

	* src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/quota/quota-
	plugin.c, src/plugins/quota/quota-plugin.h, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota-storage.c, src/plugins/trash
	/trash-plugin.c:
	s/quota/quota_set/ so we don't conflict with the quota symbol
	already present in Mac OS X.
	[7c106913f78b]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index.c:
	Removed code which is never called.
	[05a6444135e1]

	* src/lib-index/mail-index-sync.c:
	Don't crash if syncing breaks.
	[33367e66e715]

	* src/deliver/Makefile.am:
	Removed str-sanitize.o from unused_objects list because we do use it
	nowadays.
	[0bfe9dadef00]

	* src/auth/passdb-ldap.c:
	Don't try to use ldap_bind() with empty passwords, since Windows
	2003 AD skips password checking with them and just returns success.
	[8e2807c0d9a9]

	* src/auth/passdb-ldap.c:
	Cleanups, extra assert
	[b010c0cc59f8]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/login-common/master.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c:
	Fixed potential problems with client disconnecting while master was
	handling the login.
	[1a4875324b73]

	* src/auth/passdb-ldap.c:
	auth_bind=yes crashfix
	[8dd705f83491]

	* doc/variables.txt, src/lib/var-expand.c:
	Fixed zero padding handling and documented it. %0.1n shouldn't
	enable it, and it really shouldn't stay for the next %variable.
	-sign also shouldn't stay for the next variable.
	[66a9bcd733a9]

	* src/imap/client.c:
	Don't crash if client disconnected while IDLEing.
	[d47ce2fd9a38]

	* src/imap/cmd-idle.c:
	If mailbox is changed while syncing is being done, and the second
	sync's changes aren't fully sent to the client, we hanged (quite
	rare I think).
	[c6a7dfd141a7]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c:
	Code cleanup
	[55dd37053293]

	* src/lib-index/mail-transaction-log-view.c:
	Memory/fd leak fix
	[731ea7214f68]

2006-11-08  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Don't bother logging "syscall failed: EOF" messages. No-one cares
	about them.
	[cd7e4bbe957e]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c:
	Don't leak opened .log.2 transaction logs.
	[9d90b7f53f8b]

	* configure.in:
	1.0.rc13 released
	[2e50f9e55565]

	* NEWS, TODO:
	1.0.rc13 released.
	[85834a1d95f9]

	* dovecot-example.conf:
	Comment updates, wiki link updates.
	[eb1bf4e07015]

2006-11-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	When verifying the header, check that next_uid is larger than last
	message's UID.
	[859e23c8a815]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	Saving mails could have skipped over transactions, which caused
	different kinds of problems.
	[dd80dec62623]

	* src/imap/client.c:
	Crashfix at quit
	[b3682897ecb5]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c:
	Handle LDAP requests while being disconnected more correctly.
	[1b234962518b]

	* src/imap-login/client.c, src/imap-login/imap-proxy.c,
	src/pop3-login/client.c, src/pop3-login/pop3-proxy.c:
	Memory leak fix
	[0a9b4386eb35]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/imap-proxy.c, src/login-common/client-common.h, src
	/login-common/sasl-server.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/pop3-proxy.c:
	Crashfixes and more asserts. Mostly related to use of
	AUTHENTICATE/AUTH commands.
	[b792e1ddb2e5]

	* src/lib-auth/auth-server-connection.c:
	Reduce memory usage in case we read a lot of auth replies at once.
	[739b5d7a8624]

	* src/imap-login/imap-proxy.c:
	If client disconnects before logging into remote server is complete,
	don't crash/leak memory.
	[634b6fc5f707]

	* src/auth/auth-request-handler.c:
	Missing TAB before "pass" broke proxying.
	[a3f5070b317a]

	* src/lib/istream-file.c, src/lib/istream-mmap.c, src/lib/ostream-
	file.c:
	When i/ostream is closed, change the fd to be -1 so it won't be
	accidentally used.
	[2f2d342c9be0]

	* src/lib/ioloop-epoll.c:
	Free all the used memory when destroying the ioloop.
	[b39aa7ff81a4]

	* src/auth/db-ldap.h:
	Remove sasl_props from here too.
	[4465fe9f0d4f]

2006-11-05  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If we're executing as a normal system user, get the HOME environment
	from passwd if it's not set. This makes it possible to run deliver
	from .forward.
	[245d8beb8fed]

	* src/lib-storage/index/index-fetch.h:
	This file hasn't been used for a long time.
	[7c0b6ad03f8f]

	* src/master/master-settings.c:
	If both mail_location and default_mail_env are set in the config
	file, give an error.
	[cac73e07b236]

	* doc/dovecot-ldap.conf:
	Comment updates
	[d073fdbc47dc]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf:
	Added comments that the files should be owned by root and 0600. Some
	cleanups to dovecot-ldap.conf.
	[1ba6a0fea777]

	* src/auth/auth-request-handler.c:
	Don't send "pass" back if it's already set, or if it's not known.
	[28276524c3ce]

	* dovecot-example.conf:
	Added missing imap_capability setting.
	[63577dfec3f3]

	* src/auth/auth-request.c:
	If proxy is returned, set also no_login automatically, since it's
	always wanted in such case anyway.
	[2bbd32bb91d3]

	* NEWS, configure.in:
	Released 1.0.rc12
	[1ff31a0ce2d5]

	* src/master/master-settings.c:
	default_mail_env fallbacking was broken with --exec-mail.
	[162035b2514c]

	* src/lib/mountpoint.c:
	Compile fix
	[1b01cdeb690c]

2006-11-04  Timo Sirainen  <tss@iki.fi>

	* TODO:
	Update
	[2a1e2c3b73ab]

	* NEWS, TODO, configure.in:
	Released 1.0.rc11.
	[9bd235c22301]

	* src/auth/passdb-ldap.c:
	Fixes to auth_bind.
	[12a57596f4e0]

	* src/auth/db-ldap.c:
	Fixes
	[8c114674cb6e]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Do better logging.
	[d5cbdd54199f]

	* src/auth/db-ldap.c:
	Don't call ldap_parse_sasl_bind_result() in ldap_bind()'s callback.
	We're not doing SASL authentication.
	[9d58b8551af6]

	* src/plugins/trash/trash-plugin.c:
	Trash plugin was completely broken before.
	[883f623bca6f]

	* src/lib/module-dir.c:
	Call deinit() for all modules first before unloading them.
	[80dcc4d9759e]

	* src/lib/lib.h:
	Include stddef.h always to make NULL expand correctly in Solaris.
	[e0b5f886c2de]

	* src/auth/db-ldap.c:
	Cleanup
	[0071996ac510]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c:
	Crashfixes
	[472c14d006e6]

	* doc/dovecot-ldap.conf, src/auth/db-ldap.c, src/auth/db-ldap.h,
	src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	LDAP code changes: If auth binds are used, bind back to the default
	dn before doing a search. Otherwise it could fail if user gave an
	invalid password. Initial binding is now also done asynchronously.
	Reconnecting to LDAP server wasn't working with auth binds. Use
	pass_attrs even with auth_bind=yes since it may contain other non-
	password fields also. Updated dovecot-ldap.conf to contain sasl_bind
	settings and reflect these changes.
	[bb5c23b445d5]

	* src/master/login-process.c:
	inetd logins kept crashing dovecot master.
	[c3f12a30f648]

	* src/auth/auth-request-handler.c:
	If passdb returned only userdb_ prefixed extra fields, don't add an
	extra TAB to the auth client's OK reply.
	[7d8b80f71824]

	* src/auth/userdb.c:
	Error message string update.
	[049f184f095d]

2006-11-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c:
	Removed compiler warnings with NetBSD.
	[88fc1963ba2e]

	* configure.in, src/lib/mountpoint.c:
	Added support for statvfs(), which is what the newer BSDs use.
	[13acd35b3644]

	* src/lib-ntlm/ntlm-message.c:
	Use i_toupper()
	[7330b975ef60]

	* src/master/login-process.c:
	Error message fix for 64bit systems.
	[cfbfdb7308e2]

	* src/lib-storage/index/index-storage.c:
	Fix
	[36afb661363d]

2006-11-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	Give TCPLOCALIP and TCPREMOTEIP and PROTO=TCP environments to
	checkpassword binary so we're UCSPI (and vchkpw) compatible.
	[12096f3ee52d]

	* src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	Non-plaintext authentication didn't work with sql as passdb. Cleaned
	up the same code for LDAP also.
	[a8715c2a8870]

	* src/deliver/mail-send.c:
	When sending rejects, don't include Content-Type in the rejected
	mail's headers.
	[f980f06c5335]

	* src/imap/cmd-list.c:
	If we had only prefixed namespaces and we listed for "%", INBOX's
	flags weren't correct and it wasn't shown at all with LSUB.
	[af118b5ae1d7]

	* src/deliver/deliver.c:
	Make mail_debug=yes work with deliver too.
	[6951e8345a2b]

	* src/deliver/deliver.c:
	Added -f parameter to usage help.
	[311111a5ab41]

	* src/lib-mail/message-address.h:
	Comment update
	[6578ebe5d787]

	* src/deliver/deliver.c:
	Don't crash with -f "". Changed the default from envelope to be
	MAILER-DAEMON.
	[b1a4c6be291f]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Compiling fix
	[6e8f0236f55c]

	* src/deliver/auth-client.c:
	If we can't get auth user reply in a minute log timeout error and
	quit.
	[dbc1078c2706]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache.h:
	If cache file contains broken field type or decision type mark the
	cache corrupted instead of assert-crashing later.
	[edaeced0bb3a]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Last changes broke it badly.
	[cafa86d2c777]

2006-11-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c, src/lib/failures.h, src/lib/imem.h,
	src/lib/macros.h, src/lib/str.h, src/lib/strfuncs.h:
	Added sentinel GCC attribute to *_strconcat() functions. Added
	format printf-attribute to vprintf-type functions.
	[0ebd741a1cbc]

2006-10-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Crashfix
	[a455f8e098e2]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	Last keyword pool clearing optimization broke the keywords if we had
	to move mails around in the file.
	[15c9348d512f]

2006-10-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c:
	flock isn't anymore the default locking method, so don't bother
	giving a special error message if it fails.
	[dbb062393f51]

2006-10-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c, src/auth/passdb-blocking.c:
	Fixes to handling blocking passdb (ie. MySQL) failures. It ignored
	any non-password related checks, such as allow_nets.
	[8ef729241f9e]

	* doc/variables.txt:
	default_mail_env -> mail_location.
	[9d11bfda85fe]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-storage.c:
	Use the name "mail root directory" to describe where the non-INBOX
	mbox mailboxes are and describe what it is in the config file.
	[12e14a30af50]

	* dovecot-example.conf, src/deliver/deliver.c, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Renamed default_mail_env to mail_location. Keep the default_mail_env
	working anyway for backwards compatibility.
	[38a82465749a]

2006-10-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Handle the last line even if it doesn't end with LF.
	[f1ffc5deb1ee]

	* NEWS, TODO, configure.in:
	1.0.rc10 released.
	[b6645b8cb695]

	* src/lib/network.c:
	Fix net_ipv6_mapped_ipv4_convert() to be actually portable.
	[e1cf412735e1]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	Fixes to handling CRLF linefeeds in mboxes.
	[366a0090b9dd]

	* dovecot-example.conf:
	Added a warning about nss_ldap.
	[c131951c9205]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c:
	Updates to ssl_ca_file and ssl_username_from_cert comments in
	dovecot-example.conf. Added better logging for "Invalid
	certificate". Patch by HenkJan Wolthuis (hj wolthuis kaw nl)
	[5d6271211b09]

	* src/auth/passdb-bsdauth.c:
	Don't check password field ourself. There's no point doing that and
	some backends won't even return the password.
	[5c75459d92b5]

	* doc/variables.txt, src/lib/var-expand.c:
	Added %D modified to return "sub.domain.org" as
	"sub,dc=domain,dc=org" (for LDAP queries). Patch by Andrey Panin.
	[5ad4a76fec2b]

2006-10-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-blocking.c:
	If blocking passdb (ie. MySQL) didn't return any extra fields, we
	didn't notice username changes and we didn't cache the password.
	[6e1daf679892]

	* src/auth/passdb-vpopmail.c:
	Added support for non-plaintext authentication for vpopmail if it
	returns plaintext passwords. Based on patch by Remi Gacogne
	(rgacogne aquaray com).
	[3e12dc793601]

	* src/auth/passdb-passwd-file.c:
	If auth cache is enabled and %vars are used in passwd-file path, get
	the non-username part of the cache key from the path.
	[7998913ec86f]

	* src/auth/auth-request.c:
	Don't even try to verify password with deny=yes passdbs.
	[e0374c330eaf]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c:
	Try to avoid sending duplicate/useless flag updates.
	[cf8fea5524d2]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	seq_range_exists() can take a const pointer to the array.
	[df9799c27283]

	* src/auth/auth-cache.c, src/auth/auth-request.c:
	auth cache didn't work properly with multiple passdbs.
	[af59e1a7d3db]

	* src/auth/auth-request.c:
	When matching allowed_nets IPs, convert IPv6-mapped-IPv4 addresses
	to actual IPv4 addresses first.
	[32b61566ad82]

	* src/lib/network.c, src/lib/network.h:
	Added net_ipv6_mapped_ipv4_convert().
	[b01001cf1911]

	* src/deliver/auth-client.c:
	Use mail_chroot setting.
	[c7c17660e22d]

	* doc/auth-protocol.txt, src/auth/auth-request-handler.c:
	Require that the "resp" parameter for AUTH command is the last.
	[b7f267605647]

	* src/lib-storage/index/mbox/mbox-save.c:
	Filter out "From " lines from headers. There's no reason they should
	exist in there and they'll cause problems.
	[a5d2dd34e61a]

	* src/lib-index/mail-cache-transaction.c:
	Fix to delayed cache file opening, cached data might have been lost.
	[ee6bd5abc1c2]

	* src/auth/mech-digest-md5.c:
	If unknown QoP value is received, log what it is.
	[e6f20b1c71ff]

	* src/lib-mail/message-content-parser.c:
	We didn't skip whitespace after '=' in parameters, which caused the
	parameter's value to be empty.
	[489ffa474982]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/mbox
	/mbox-mail.c:
	We added received date as time_t instead of uint32_t which crashed
	with 64bit systems.
	[cec6051b900d]

2006-10-14  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	Released 1.0.rc9.
	[fbdf955a4f5d]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Reference counting fix
	[f967df4954e8]

	* src/master/login-process.c, src/master/login-process.h,
	src/master/main.c:
	Reference counter fixes
	[aa58d8379f9f]

	* src/imap-login/client.c, src/imap-login/imap-proxy.c, src/login-
	common/login-proxy.c, src/pop3-login/client.c,
	src/pop3-login/pop3-proxy.c:
	Reference counter fixing for client while it's being used in login
	proxy. Fixes crashes.
	[359ee882f9e8]

	* src/master/login-process.c:
	Cleanup
	[3b7b93d9a752]

	* src/lib/sha1.h:
	Let's be nice and work with older libmysqlclient libraries.
	[4651c64f22fa]

	* src/lib/ioloop-epoll.c:
	Don't pass uninitialized data in epoll data struct's union to
	kernel. Doesn't matter that much, but keeps valgrind happy.
	[9eaefefcffde]

2006-10-13  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	Deinit crashfix.
	[e361febd7504]

	* src/imap-login/client.c, src/login-common/ssl-proxy-openssl.c,
	src/pop3-login/client.c:
	New asserts / cleanup
	[383cad0f169b]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Clear the keywords pool for each mail, so we don't waste memory.
	Also we can shrink the initial pool size.
	[be692cb7bbfb]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Handle moving to memory failures better so we won't crash in some
	situations.
	[11e466b0a1c5]

	* src/master/login-process.c:
	Make sure we don't kill login processes that haven't yet even sent
	their initialization event. Also added another sanity check.
	[a5e14b0a11f5]

	* src/master/log.c:
	Don't crash in log deinitialization.
	[fba3be1385fe]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Adding space to header could have broken things. This fixes at least
	"X-IMAPbase uid-last unexpectedly lost in mbox file" errors.
	[3e8d9013a31e]

	* dovecot-example.conf, src/auth/auth-cache.c, src/auth/auth-cache.h,
	src/auth/auth-request.c, src/auth/passdb-cache.c:
	auth_cache: Try to handle changing passwords automatically: If
	password verification fails, but the last one had succeeded, don't
	use the cache. This works only with plaintext auth.
	[a0d4f0cfcf22]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h:
	Don't use time_t anymore in cache file. uint32_t is large enough and
	makes cache files compatible between 32bit and 64bit systems.
	[5efd784d0bad]

	* src/lib-index/mail-index.h, src/lib-storage/index/index-storage.c:
	Removed MAIL_INDEX_OPEN_FLAG_FAST. It wasn't being used, and we
	probably want to have that as a default anyway.
	[c06db047691b]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	Delay opening the cache file until it's actually needed.
	[d714bcbcb206]

	* src/lib-index/mail-cache-fields.c:
	When registering fields, if they were already exited in the cache
	file mark the cache file corrupted.
	[d6789f040bd4]

	* src/lib-index/mail-cache.c:
	If time_t or uoff_t size had changed, we returned -1 instead of
	FALSE, which broke the check later..
	[49a18bd95bff]

	* src/deliver/auth-client.c, src/deliver/deliver.c:
	Don't require home directory to be given. If debug is enabled, log
	what we get from dovecot-auth.
	[32582b9ab8c6]

2006-10-12  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	If login process dies before initialization, stall creation of them
	instead of completely shutting down.
	[2a8bc96de013]

2006-10-11  Timo Sirainen  <tss@iki.fi>

	* src/master/log.c:
	When shutting down do one last read from log fds to see if there's
	something waiting. Also set log fd to be non-blocking.
	[31ea3e807c15]

	* src/login-common/master.c, src/master/login-process.c, src/master
	/master-login-interface.h:
	Send inode number in login requests and verify that they match.
	[d12964a3bf4b]

	* src/lib/mountpoint.c, src/lib/mountpoint.h:
	Handle ENOENT silently and return 0.
	[0e51ea4aeca1]

2006-10-09  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	Released 1.0rc8
	[d2737620aa0f]

	* src/deliver/deliver.c:
	Increase default address sanitizer pool size
	[015d31569bcd]

	* src/lib-storage/index/index-mail.c:
	Increase mail's default pool size
	[aa31c84fa61d]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h:
	If the mail environment data contains mail format prefix, don't do
	any kind of autodetection. Practically this means that
	mbox:/var/mail/user doesn't work anymore.
	[be53f94e57f0]

	* src/auth/password-scheme-md5crypt.c, src/auth/password-scheme-rpa.c,
	src/auth/password-scheme.c:
	Based on password length detect if it's hex-encoded or sha1-encoded.
	Also use MD[45]_RESULTLEN macros instead of hardcoded 16 value.
	[1a7edee4766d]

	* src/lib/md4.c, src/lib/md4.h:
	Added MD4_RESULTLEN macro.
	[5add302cd742]

	* src/lib/md5.c, src/lib/md5.h:
	Added MD5_RESULTLEN macro.
	[12274579cffa]

	* src/master/log.c:
	Fix
	[519150f03c9f]

	* src/master/login-process.c:
	If login process sends wrong state information, restart it.
	[8e3ed90df049]

	* src/imap/cmd-list.c:
	Handle INBOX-prefixed namespaces better. Avoid duplicate INBOX
	replies if namespace prefix is given.
	[189445030658]

	* configure.in, src/auth/Makefile.am, src/auth/passdb-sia.c,
	src/auth/passdb.c:
	Tru64 SIA authentication support. Patch by Simon L Jackson (simon
	jackson carringbush net)
	[75f7b90a002c]

2006-10-08  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/deliver/mail-send.c:
	Log all mail saves and save failures.
	[8aae6882aa9b]

	* src/deliver/deliver.c:
	Added -f parameter to specify the envelope sender which is used in
	mbox From-lines.
	[76e4e4a15173]

	* src/imap/imap-sort.c, src/lib-imap/imap-envelope.c, src/lib-mail
	/message-address.c, src/lib-mail/message-address.h, src/lib-
	storage/index/index-search.c:
	Added fill_missing parameter to message_address_parse() which
	specifies if missing mailbox and domain should be returned as
	MISSING_MAILBOX and MISSING_DOMAIN or just as empty strings.
	[fea806a04136]

	* src/master/mail-process.c:
	Expand home directory in mail env if it exists as eg.
	"mbox:~:INBOX=.." or as the last character
	[600c9d7b5cfb]

2006-09-25  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	And remove debugging code..
	[757cf79f2529]

	* src/master/login-process.c, src/master/login-process.h:
	SIGHUP caused memory corruption
	[b07ce227d6d7]

	* src/master/login-process.c:
	If fd_read() returns EAGAIN, ignore it.
	[85c4352a266e]

2006-09-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands.c, src/imap/commands.h:
	Use array_t in commands buffer.
	[10b0bfd4da69]

2006-09-22  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-gssapi.c:
	POP3 service name is "pop" with GSSAPI.
	[a0f1372001b4]

	* dovecot-example.conf:
	Comment about protocols=none.
	[fc969b89c7b9]

	* src/master/master-settings.c:
	Allow "protocols = none".
	[18e42db1fb33]

	* src/deliver/deliver.c:
	%i didn't work.
	[00895803dd50]

	* src/auth/db-ldap.c:
	"Can't connect to server" message's host was wrong if uris setting
	was used.
	[e2dc4faa5e4c]

2006-09-20  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-sql.conf:
	More explanation of the "user" field in pass_query.
	[c85ce7c0d063]

2006-09-11  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap.conf:
	hosts doesn't default to localhost anymore.
	[5cd72a8ad024]

2006-09-10  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Boehm GC seems to be working now. Removed the broken-warning.
	[9e35efc94908]

	* src/lib/data-stack.c:
	GC optimization
	[43d058bc45cf]

	* src/lib/data-stack.c, src/lib/mempool-alloconly.c, src/lib/mempool-
	system.c:
	Fixes for using GC
	[578b35bd28b5]

	* src/lib-dict/dict-sql.c:
	Fixed atomic_inc() to work correctly with shared keys.
	[e9438f03b0a8]

2006-08-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Set USER environment to the destination user, since some plugins
	require it to work.
	[10188be503cd]

2006-08-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-mysql.c:
	Save queries within transaction in a linked list and send them
	separately, instead of using one big string with ';' separator,
	which didn't work with everyone..
	[7a6454ad676c]

	* src/lib-dict/dict-sql.c:
	Fixes. select/where fields were used in wrong order
	[6d014f044abe]

2006-08-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/hash.c:
	Initial hash table size was always 109 even though the initial_size
	parameter was higher.
	[344506299992]

	* src/lib/ioloop-notify-kqueue.c:
	Fix 100% CPU usage looping when a vnode change event came but it was
	never untriggered. Patch by Rui Lopes (rgl ruilopes com)
	[33e77928065b]

	* src/deliver/duplicate.c:
	When reading the duplicate entries, the timestamp wasn't saved so
	the entry was lost afterwards.
	[0cf28d6fad47]

2006-08-24  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated pop3's mail_executable comment
	[ad0d929e8e6e]

2006-08-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	And actually fix it instead of leaving it commented out...
	[d7ed8f2c887b]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Rename was a bit broken if the new name began with the old name
	[9cdf591ae8a4]

	* src/lib-storage/index/index-mail-headers.c:
	Grow index_header_lookup_ctx pool initial size.
	[59bd6840d76e]

2006-08-22  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	If master db has extra fields set, send them to checkpassword in
	environment.
	[00d6fe90c152]

2006-08-18  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c:
	Compiler warning fix
	[825d8e80d99f]

	* NEWS, TODO, configure.in:
	1.0.rc7 released
	[d628fe5da3be]

	* src/lib/ioloop.c:
	io_add_notify() didn't set refcount so io_remove() crashed for it.
	[f68386460453]

2006-08-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	Crashfix
	[12e12631e445]

	* src/lib/ioloop-kqueue.c:
	Reference IOs before calling timeout handlers, in case they call
	io_remove().
	[e192b7983f0e]

	* src/lib/ioloop-internal.h, src/lib/ioloop-kqueue.c,
	src/lib/ioloop.c, src/lib/ioloop.h:
	OK, so the original kqueue code wasn't actually broken, but it could
	have been made much simpler. Updated comments in ioloop.h about
	IO_READ and IO_ERROR usage.
	[77c2d16243de]

	* src/master/main.c:
	Cleanup + handle dup() failure.
	[4fe94cd91784]

	* src/lib/ioloop-kqueue.c:
	Fixes
	[6b32d20e17c0]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-kqueue.c:
	Fixes
	[89e28381fd48]

2006-08-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Non-plaintext auth: If auth_debug_passwords=yes, show looked up
	credentials.
	[aebffa81b327]

	* src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c:
	Compiling fixes
	[bffa631fbef4]

	* src/lib/Makefile.am, src/lib/ioloop-epoll.c, src/lib/ioloop-
	internal.h, src/lib/ioloop-iolist.c, src/lib/ioloop-iolist.h,
	src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c, src/lib
	/ioloop-poll.c:
	Rewrote much of the kqueue code. It didn't work correctly if there
	were both input and output I/O handlers added for the same file
	descriptor. The code works now very much like epoll code. Did also
	several cleanups.
	[ecc2d2859c13]

	* configure.in:
	Use notify=kqueue automatically only if ioloop=kqueue.
	[3d48d0672382]

	* configure.in:
	Changed --enable-debug's description.
	[45504e695d57]

	* src/login-common/client-common.c, src/login-common/ssl-proxy-
	openssl.c, src/login-common/ssl-proxy.c, src/login-common/ssl-
	proxy.h:
	If SSL/TLS handshake didn't finish, show "TLS handshaking" instead
	of "TLS" in logout line.
	[3f3f5979015a]

2006-08-11  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c, src/auth/passdb-pam.c:
	Set SIGCHLD handler in init, not in preinit when lib_signals_init()
	hasn't yet been called.
	[ca2c7369af3a]

	* src/master/mail-process.c:
	Check log_creaate_pipe() and dup() return values and handle
	failures.
	[43d9e4361907]

	* configure.in:
	eval doesn't need to have its parameters quoted. The previous \"
	quoting was broken with POSIX shells (and autoconf 2.60 now sets
	POSIX mode to non-bash/zsh shells also where this was previously
	working wrong). So, all in all this should fix OpenBSD compiling
	problems.
	[9e14f957af0f]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Show number of actually expunged messages in logout message, instead
	of number of messages marked as deleted.
	[ce8dff5af671]

	* configure.in, src/plugins/quota/quota-fs.c:
	Check for XFS quota also from xfs/xqm.h
	[b08cb6275121]

	* src/auth/passdb-checkpassword.c, src/auth/passdb-pam.c:
	Use SIGCHLD handler to check for killed child processes instead of a
	timeout loop.
	[4b33b03059ec]

	* src/deliver/deliver.c:
	Set umask from dovecot.conf, or default to 0077.
	[ea6d8b9277b2]

	* src/lib-storage/index/mbox/mbox-save.c:
	After saving a mail with index being in synced state, update the
	sync_stamp and sync_size fields in the index so that it actually
	stays synced.
	[e2bcae6694d6]

	* dovecot-example.conf:
	Updated login_max_connections comment.
	[264e94b9870b]

	* src/imap-login/client.c, src/imap-login/imap-proxy.c, src/login-
	common/client-common.h, src/login-common/common.h, src/login-
	common/main.c, src/pop3-login/client.c, src/pop3-login/pop3-proxy.c:
	Fixes for handling near-full connection queues.
	[289d2c134fbb]

2006-08-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Create maildirfolder file when creating new maildirs.
	[24a094a12f0a]

	* doc/variables.txt, src/lib/var-expand.c:
	Negative offsets count from the end of the string. Patch by Johannes
	Berg.
	[17c92b015b7e]

	* src/plugins/quota/quota-dict.c:
	If dict_init() fails, die with a i_fatal() message instead of
	crashing.
	[221c00c9ab4f]

	* src/auth/passdb-ldap.c:
	If password query returns userdb_ prefixed fields (ie. for userdb
	prefetch) but not userdb_uid or userdb_gid, add them based on the
	global uid/gid settings.
	[b0b17d874ff2]

	* src/master/master-settings.c:
	Allow empty protocols line when using --exec-mail.
	[d762c454c418]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	We got into infinite loops if trying to open a 2 byte sized file as
	mbox.
	[374d94a980c4]

	* src/master/master-settings.c:
	Allow base_dir to point to a symlink.
	[0c196247799a]

	* src/auth/main.c, src/dict/main.c, src/imap/main.c, src/login-
	common/main.c, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3/main.c:
	Require that master's version number matches the child's, unless
	version_ignore=yes. Usually it's an accidental installation problem
	if the version numbers don't match.
	[f2687c8089d4]

	* configure.in, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	fs.h:
	Put back specific checks for struct dqblk.dqb_curblocks vs curspace.
	The removal broke compiling for some OSes such as OSX.
	[4794eb8cb4fc]

	* configure.in:
	Updated --with-notify description.
	[dbedfd07552f]

	* src/lib/ioloop-notify-dn.c:
	Silently disable dnotify if kernel doesn't support RT signals,
	instead of just dying.
	[7ed9d01a7d3e]

2006-08-07  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Don't crash if SSL is disabled.
	[d77c187e1337]

	* src/deliver/deliver.c, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/istream-raw-mbox.h,
	src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/mail-
	storage.h:
	Added MAILBOX_OPEN_MBOX_ONE_MSG_ONLY flag for mailbox_open() which
	makes it ignore all but the first From-line in a mbox. This kludge
	is required for deliver which builds a temporary mbox stream from
	the input. Later it should be fixed to use some plain-mailbox format
	instead of mbox.
	[080b00d48370]

	* NEWS, TODO, configure.in:
	Released 1.0 rc6
	[2b040a6dcaa4]

	* src/plugins/quota/quota-fs.c:
	Default _LINUX_QUOTA_VERSION to 1 instead of 2, since older Linux v1
	sys/quota.h didn't define it at all.
	[6a0da298ca34]

	* src/imap/cmd-list.c:
	When listing INBOX from inbox=yes namespace, don't insert the
	namespace prefix
	[bfab66009334]

	* src/imap/cmd-list.c:
	Fixes to handling INBOX in LIST.
	[0847041acbe9]

	* src/lib-storage/mail-storage.h:
	MAILBOX_LIST_INBOX flag conflicted with MAILBOX_LIST_CHILDREN flag,
	causing problems.
	[cd2e8aa5bf42]

	* src/lib-storage/index/dbox/dbox-list.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/mbox
	/mbox-list.c:
	Handle reference parameter more like UW-IMAP: If it doesn't begin
	with separator, just use it as a prefix to mask. I'm not sure where
	I got the earlier rules..
	[21c5369a2965]

2006-08-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	Don't show INBOX if reference parameter is given.
	[87dc24fb34ca]

	* src/master/mail-process.c, src/master/master-settings.c:
	Run imap dump-capability process only after all the settings have
	been verified to be correct. Added checks against trying
	mail_drop_priv_before_exec=yes and chrooting, since we can't exec
	the imap process if that's done. Fixed NFS check with chrooting.
	[f1fe1b48f6fd]

	* src/login-common/main.c:
	Changed max_connections default value to be 1, not that it should
	matter.
	[cb4f0822fe2d]

	* src/login-common/ssl-proxy-openssl.c:
	Minor cleanup, but more importantly last commit message didn't say
	that the SSL proxy rewrite was once again reverted to the original
	one, but with SSL_pending() fix from the new one. Hopefully this
	will finally work with everyone.
	[554a5198207b]

	* dovecot-example.conf, src/imap-login/client.c, src/login-
	common/common.h, src/login-common/login-proxy.c, src/login-common
	/login-proxy.h, src/login-common/main.c, src/login-common/master.c,
	src/login-common/master.h, src/login-common/ssl-proxy-openssl.c, src
	/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h, src/master
	/login-process.c, src/master/login-process.h, src/master/main.c,
	src/master/master-login-interface.h, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3-login/client.c:
	Fixes to login process handling, especially with
	login_process_per_connection=no. Removed login_max_logging_users
	setting since it was somewhat weird in how it worked. Added
	login_max_connections to replace it with
	login_process_per_connection=no, and with =yes its functionality is
	now within login_max_processes_count.
	[23f09df2f259]

2006-08-04  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-idle.c:
	When mailbox changes are noticed and they're sent to client, cork
	before doing it so each command isn't sent in a separate packet.
	[0359e5b16b38]

	* src/plugins/acl/acl-cache.c:
	Crashfix
	[ad297ccf21dd]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-backend.c:
	If .DEFAULT file exists in global ACL root directory, use it as the
	default ACLs for all mailboxes.
	[75c29bc2ff80]

2006-08-03  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	If master login failed because of non-password failure (eg.
	allow_nets) don't continue the authentication to non-master passdbs.
	[acc519f2f052]

	* src/auth/auth-request.c:
	If we logged in with IPv6 address and allow_nets contained IPv4
	address, we assert-crashed.
	[19a8d1a5defe]

	* src/auth/auth-request-handler.c:
	When logging in as master user, send it as "master_user" field to
	master among other userdb fields.
	[6a08086f8dd8]

	* src/auth/passdb-checkpassword.c:
	Call io_remove() before closing the fd.
	[27c757e604ac]

	* configure.in, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	fs.h:
	Added --with-linux-quota configure option to specify which Linux
	quota version to use. Don't bother looking into struct dqblk to see
	if curblocks or curspace field exists, we can figure it out from the
	quota version. If quotactl() returns EINVAL, it could have been
	because wrong quota version was used, so give a friendly message
	suggesting to look at
	--with-linux-quota.
	[ae2321afc737]

	* NEWS, configure.in:
	And 1.0.rc5
	[0ade786ef920]

2006-08-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c:
	And fix for previous change..
	[552143f2f4b5]

	* NEWS, configure.in:
	And 1.0.rc4..
	[c659ccdf8347]

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: mail_index_get_header() returns now updated
	next_uid field after appends.
	[83c3f4a7cb29]

	* NEWS, TODO, configure.in:
	Released 1.0.rc3.
	[ff9b589812f0]

	* src/lib-storage/index/mbox/mbox-save.c:
	We wrote mail bodies through raw output stream, instead of the one
	that made sure that CR+LF linefeeds were as configured.
	[d08241596254]

2006-07-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c:
	Debug: Don't log empty error when writing "master out" debug lines.
	[95d5d5564d4e]

	* src/dict/dict-server.c, src/lib-dict/dict-client.c:
	dict proxy: Dictionary iteration was broken.
	[ca6f6710db1a]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	index_mail_cache_add() was used with lib-storage's internal indexes
	for most of the received date, physical size and virtual size cache
	additions. This may have caused all kinds of trouble, but since it
	went unnoticed this long perhaps not..
	[20f4125005cf]

2006-07-24  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Don't count "." and ".." directory sizes to quota. After rewriting
	maildirsize file keep its fd open so that we can later update it.
	Patch by Alexander Zagrebin
	[1aed9f763faf]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c:
	Restore data stream's offset after it has been internally changed,
	so that it doesn't have much visible effect on the stream returned
	by mail_get_stream(). The buffered data will still be lost, but this
	should help with the most common use cases.
	[785d8b1e914b]

	* src/login-common/ssl-proxy-openssl.c:
	Use SSL_pending() to figure out if we should call SSL_read() again.
	Otherwise it breaks..
	[cb894296cb6b]

	* src/login-common/ssl-proxy-openssl.c:
	Don't constantly re-read ssl-parameters.dat. Make sure that in input
	handler we read everything that SSL_read() has buffered so we don't
	get stuck.
	[840733a8a9d2]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Don't crash if sync needs to be rollbacked.
	[4f33b4c431cf]

	* src/lib-storage/index/dbox/dbox-mail.c:
	Slightly improved error message.
	[5002e5a4b095]

	* src/lib-storage/index/dbox/dbox-save.c:
	When saving a mail with initial keywords, lock the uidlist before
	doing anything with the file's header.
	[c3452ddb5d7f]

	* src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-update.c:
	In some conditions a keyword could have been added to the index
	twice. Also a few cleanups.
	[aaff71bad6ad]

2006-07-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Memory/fd leak fixes
	[9db8ca340850]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	When saving new mails, append the changes to uidlist file, but only
	when doing so doesn't temporarily move the file's mtime backwards.
	[3ae4af9130c8]

	* src/lib-index/mail-index-sync-update.c:
	If header counters got broken when updating internal views, say it
	clearly in error messages instead of saying they're broken in the
	files themselves.
	[8f6f18c12163]

	* src/lib-storage/index/dbox/dbox-sync.c:
	Fixes to writing flags
	[6548df491b2c]

	* src/lib-storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-uidlist.c:
	Fixes for pop3_lock_session=yes. Wasn't as easy as I thought. :)
	[5697b21d078c]

	* src/lib-index/mail-index.c:
	Small memory usage optimization.
	[d86cc579d0dc]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-
	uidlist.h:
	Make pop3_lock_session work with dbox.
	[d57426ed4646]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c:
	If we find unexpected messages from dbox, rebuild index files to fix
	the problem.
	[d0efbe2c696f]

2006-07-08  Timo Sirainen  <tss@iki.fi>

	* doc/variables.txt:
	Example fix: %Lp -> %Ls
	[028dc6813c1f]

2006-07-05  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	dovecot -n and -a: Print the config file path before parsing it so
	if there are errors you can see what file is being used.
	[70f5e85320a9]

	* dovecot-example.conf:
	Comment updates
	[6e0327f74f73]

2006-07-04  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated namespace separator's comments.
	[23805acb2c9d]

	* NEWS, configure.in:
	1.0.rc2 released
	[5be09bd15d5a]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-storage.c:
	Added automatic upgrades from 0.99: .subscriptions and .customflags
	are renamed to their new names automatically.
	[2fc39bb21346]

2006-07-03  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	--with-ioloop=auto changed to --with-ioloop=best
	[de2e5ea4b595]

2006-07-02  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	mail_cache_min_mail_count is supposed to be an integer, not a
	string.
	[59fbcfab2f76]

	* src/master/master-settings.c:
	Added missing t_pop().
	[4faa093883cc]

	* configure.in:
	Don't use epoll/kqueue by default unless --with-ioloop=auto is
	given. They're not necessarily as stable.
	[cbd7a2145635]

	* src/master/main.c:
	If something in io_loop_create() failed, we logged the error to
	/dev/null.
	[a058a93d6797]

	* src/lib/failures.c:
	If writing to log file fails, restore errno before %m is used.
	Although the log writing most likely fails anyway at that point, but
	at least strace logs show it right. :)
	[23289b09e808]

	* src/master/main.c:
	List -n and -a in short help. Fixes to --build-options.
	[2dddd6e31539]

	* src/login-common/ssl-proxy-openssl.c:
	Second try with SSL proxy rewrite. Did some fixes since last try.
	[824a092da633]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	If there is no quota for the user, GETQUOTAROOT leaked memory
	[bafc40f6b954]

	* src/master/auth-process.c:
	anonymous_username setting wasn't being passed to auth process.
	[e37bb21d38b9]

	* src/login-common/ssl-proxy-openssl.c:
	If verbose_ssl=yes set ssl_info_callback and print any alerts and
	BIO errors.
	[711a1b329fee]

2006-07-01  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-close.c, src/imap/imap-expunge.c, src/pop3/commands.c:
	Don't try to expunge messages if the mailbox is read-only. It'll
	just cause our index files to go out of sync with the real mailbox
	and cause errors.
	[380d2334d5c8]

	* src/lib/mountpoint.c:
	mountpoint_get() returned broken mount_path and type with BSDs.
	[48a2d2fdd474]

	* src/plugins/quota/quota-fs.c:
	BSD's quotactl() wants a file path, not a device path.
	[d9201470af2c]

	* dovecot-example.conf, src/imap-login/client.c,
	src/pop3-login/client.c:
	Removed hardcoded 127.* and ::1 IP checks. Instead just check that
	local IP matches remote IP to assume the connection is secure.
	[df64ad3f61cd]

	* src/auth/db-passwd-file.c:
	Don't require valid uid/gid fields if passwd-file isn't being used
	as a userdb.
	[a99ec0af298b]

	* src/lib-sql/driver-pgsql.c:
	Try to handle failures better.
	[3ade3611ac87]

	* src/master/main.c:
	Print the used configuration file's path with -n and -a.
	[4590eb3edefa]

	* src/auth/auth-client-connection.c, src/auth/auth.h, src/auth/passdb-
	ldap.c:
	Moved the <hidden> string into a macro. Hide the password also from
	LDAP replies.
	[775352b2a57e]

	* src/lib-storage/index/maildir/maildir-save.c:
	Messages' received time wasn't saved properly when saving/copying
	multiple messages at a time. Also if using quota plugin the S= size
	was only set for the first saved file, and even that was wrong.
	[f941b5aba37e]

	* src/lib-storage/index/maildir/maildir-mail.c:
	mail_get_physical_size() was broken with non-committed mails, which
	broke quota plugin.
	[ec9bd37bf230]

	* src/lib/file-copy.c:
	Try to preserve file's mode and group when copying it.
	[b75028ff530c]

	* src/master/mail-process.c:
	If namespace's location field wasn't set, the default location was
	supposed to be used.
	[727e3ae702f2]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/driver-sqlite.c, src/lib-sql/sql-api-private.h, src/lib-sql/sql-
	api.c, src/lib-sql/sql-api.h:
	sql_escape_string() should return const char *, not char *.
	[c9eff6d94524]

2006-06-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/safe-mkdir.c:
	safe_mkdir() should return 1 always when it creates a new directory,
	even if it changes the group/permissions when doing it.
	[b78c40037e6d]

2006-06-29  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added tpop3d's pop3_uidl_format.
	[692c3efca425]

2006-06-28  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Allow log_path settings in config file to be empty without trying to
	use empty files then.
	[3f1e37683a23]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c:
	Don't break if mailbox path contains ':' characters.
	[9ff09334a8f2]

	* NEWS, TODO, configure.in:
	Released 1.0.rc1
	[577c5dd0b9a0]

	* src/plugins/quota/quota-fs.c:
	Attempting to fix quota block calculations to be correct.
	[77f3c9bffa04]

	* src/lib-storage/index/maildir/maildir-list.c:
	We could have skipped INBOX if there wasn't .INBOX directory.
	[6ce6aeee441f]

	* src/imap/Makefile.am, src/imap/main.c, src/master/mail-process.c,
	src/pop3/Makefile.am, src/pop3/main.c:
	Changed the mail_plugins/mail_plugin_dir settings to be passed as
	the same environments. If MAIL_PLUGIN_DIR environment isn't given,
	use the built-in default.
	[9a574003aa43]

2006-06-27  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/lib-storage/mail-storage.c:
	MAIL_STORAGE_FLAG_KEEP_HEADER_MD5 flag was supposed to be set if
	pop3_uidl_format contained %m. Added it now to
	mail_storage_parse_env() so it's used everywhere.
	[da0d17e6792e]

	* src/lib-sql/driver-sqlite.c:
	Escape ' with '' instead of with \'.
	[217327e74823]

	* configure.in:
	Don't try to use any weird _syscall()s when detecting epoll.
	[af8946029ff7]

2006-06-26  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Fix kqueue notify checking.
	[794a48263c28]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If dovecot-shared file exists in the Maildir++ root, use the file's
	mode and gid when creating mailboxes under it.
	[91d36bfb51c5]

	* src/master/ssl-init.c:
	Don't leak a file descriptor when regenerating ssl-parameters.dat
	[55f6d9de6d3a]

	* src/lib-storage/index/index-search.c:
	Searching (storing, fetching) with sequence sets containing commas
	was broken
	[eea81593bde9]

2006-06-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	Don't crash when different search conditions reduce the search range
	so that minimum sequence becomes larger than maximum..
	[8b4c42693cce]

	* src/plugins/acl/acl-backend.c:
	Don't crash when checking "owner" ACLs with shared namespaces.
	[6470f32e0955]

2006-06-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	We assert-crashed in wrong conditions.
	[ad6a1b26c903]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c:
	Fixes to handling CR+LF linefeeds.
	[82591e8df0f2]

	* src/auth/passdb-passwd-file.c:
	When using non-plaintext authentication with passdb passwd-file we
	didn't support extra_fields and we crashed if password scheme wasn't
	explicitly specified in the passwd-file.
	[56491360e2bb]

	* configure.in:
	fix
	[cfb898c83ae3]

2006-06-20  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-search.c:
	Don't crash if seqset restrictions caused no messages to be
	searched.
	[5c7283f62bf5]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.c:
	NOT condition wasn't handled correctly in SEARCH.
	[83c83d33348c]

	* src/auth/passdb-checkpassword.c:
	If checkpassword lookup failed, we crashed. auth_debug logged
	checkpassword's exit_status wrong.
	[ea21d77e7a15]

	* src/auth/passdb-checkpassword.c:
	Return value 1 from checkpassword can mean either password mismatch
	or unknown user. Treat it as password mismatch instead of as unknown
	user.
	[5a7603afcee5]

2006-06-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-copy.c:
	If destination file already existed, we didn't overwrite it with
	link() copying.
	[fdba522c617f]

	* src/auth/db-ldap.c:
	Prefer sasl/sasl.h. Require SASL v2, otherwise disable it.
	[673b7f7933e4]

	* configure.in, src/auth/db-ldap.c, src/auth/db-ldap.h:
	Check for sasl.h and sasl/sasl.h existence and use the one that's
	found. If neither is found, disable support for LDAP SASL.
	[62bf3954eee1]

2006-06-19  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/imap/imap-thread.c:
	Optimization for checking loops.
	[862cbc6f1627]

2006-06-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-ntlm/ntlm-des.c:
	Don't include stdint.h directly.
	[30eb8eb1193c]

	* src/auth/Makefile.am, src/deliver/Makefile.am, src/dict/Makefile.am,
	src/imap/Makefile.am, src/pop3/Makefile.am:
	Added -export-dynamic.
	[64fdcf309d44]

	* configure.in:
	Fixes to io notify detection. Patch by Marcus Rueckert
	[5e74d209571a]

	* configure.in:
	Include linux/unistd.h instead of asm/unistd.h when checking for
	epoll.
	[709e8e1b45c7]

	* src/lib-storage/index/maildir/maildir-mail.c:
	If requested mail isn't found from uidlist, mark the mail as
	expunged.
	[53c86d5dc542]

	* src/auth/auth-request.c:
	auth_debug: If allow_nets is given, print debug messages when
	matching
	[962a02f9da6a]

	* src/auth/db-passwd-file.c:
	extra_args field was ignored if the passwd-file wasn't also used as
	a userdb.
	[3f48f1f31599]

2006-06-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	Crashfix if mail's data is fetched in specific order (I'm not sure
	how to reproduce this though, but the crash has happened to others)
	[5f9c3942ca0c]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Removed assert. In normal situations it doesn't happen and in error
	cases (cached offset is invalid) it causes a crash.
	[51c8b7c8f990]

	* src/imap-login/client-authenticate.c:
	Don't crash if the initial response isn't given for AUTHENTICATE..
	[e51bdb8eb6ba]

	* configure.in, src/auth/db-ldap.c, src/auth/db-ldap.h:
	Added TLS support for LDAP if the library supports it.
	[b6f60832ead3]

	* src/auth/mech-anonymous.c, src/auth/mech-apop.c, src/auth/mech-cram-
	md5.c, src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth
	/mech-ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c,
	src/auth/mech.c, src/auth/mech.h:
	Added mech_generic_auth_internal() and mech_generic_auth_free()
	functions and used them wherever possible to reduce code
	duplication. Patch by Andrey Panin.
	[a2954e5c51f9]

	* src/plugins/acl/Makefile.am, src/plugins/convert/Makefile.am,
	src/plugins/quota/Makefile.am, src/plugins/trash/Makefile.am:
	mkdir_p doesn't accept multiple directories in some systems, so do
	it one at a time. This also cleans up the code.
	[5aeb5871b06d]

	* src/lib-storage/index/mbox/mbox-save.c:
	If saved mail's body doesn't end with LF, add it ourself.
	[dc0fd34ac07f]

	* configure.in, src/imap-login/client-authenticate.c:
	Added support for SASL-IR extension.
	[a0e3350a7589]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	If mbox headers have CRLF linefeeds, handle them properly instead of
	corrupting the headers.
	[ac341db19c0b]

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h:
	Added crlf_newline flag to header parser, which is set if the header
	ended with CR+LF instead of LF.
	[1b7f179e773d]

	* src/master/master-settings.c:
	Changed the created state dir's default permissions to be 0750.
	Although this doesn't currently really matter.
	[7a8e98cbefb0]

	* configure.in, src/master/Makefile.am, src/master/master-settings.c,
	src/master/ssl-init.c:
	Added --with-statedir configure option which defaults to
	localstatedir/lib/dovecot. ssl-parameters.dat is permanently stored
	in that directory and copied to login_dirs from there.
	[ba7b159c4e10]

	* src/lib/Makefile.am, src/lib/file-copy.c, src/lib/file-copy.h:
	Added file_copy().
	[6ffb19314d57]

	* src/auth/db-ldap.c, src/auth/password-scheme.c:
	Compiler warning fixes and some coding style cleanups.
	[a84dca2d337e]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib/compat.h:
	Handle EMLINK and EPERM errors the same way as EXDEV when handling
	hardlink failures. Added ECANTLINK() macro for this.
	[69471ea42305]

	* src/lib-storage/index/maildir/maildir-storage.c:
	When renaming a mailbox's subfolders, read the list of them first
	into memory to avoid the possibility of readdir() skipping some of
	the mailboxes.
	[e7053f144a62]

	* src/auth/auth-request.c:
	If multiple passdbs were configured and we tried to authenticate as
	user which was in more than one of them with different passwords, we
	gave "multiple passwords not supported" error.
	[2b1cf566c43d]

	* src/auth/auth-request-handler.c:
	Fixed memory leak in error handling.
	[ac673cf64c25]

	* dovecot-example.conf, src/plugins/trash/trash-plugin.c:
	Removed hardcoded trash plugin configuration paths. Added
	information about it to dovecot-example.conf
	[c40748705667]

	* src/lib-auth/auth-server-request.c:
	Check that initial response doesn't contain invalid characters. Give
	better error message in case that happens.
	[0114e2f02eaf]

	* src/imap/commands-util.c:
	Fixes to checking if mailbox name is valid. In case mailbox name is
	invalid, put it through str_sanitize() before giving it in an error
	message.
	[f912d5a9ddc9]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Don't go fixing duplicate maildir filenames without properly
	checking that they really are such.
	[677dd0df4fba]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c:
	Handle transaction log deletions silently. Handle whole index
	directory deletions silently (the most common cases anyway).
	[0c08b210b9f8]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.c:
	When creating a mailbox, limit the number of hierarchies (to 20) and
	the length of the mailbox name within a hierarchy (to 200).
	[897ef7644f0f]

	* src/lib-index/mail-index.c:
	mail_index_move_to_memory(): Don't break if the index is already in
	memory. Fixes mbox_min_index_size.
	[3cdc37322696]

	* dovecot-example.conf, src/dict/dict-server.c, src/lib-dict/dict-
	client.h, src/master/dict-process.c, src/master/dict-process.h,
	src/master/log.c, src/master/log.h, src/master/main.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Instead of passing URIs directly to dictionary server, it now
	accepts only named dictionaries which are configured in config file.
	SIGHUPing master now restarts dict server.
	[332ab843c1a8]

	* src/plugins/quota/quota-dict.c:
	Don't crash if dict_lookup() didn't return success.
	[41ecb81a740a]

	* src/lib-sql/driver-mysql.c:
	Escaping a string crashed if we weren't connected to mysql.
	[63e567a3ccaf]

	* src/dict/main.c:
	Make sure the process dies when the master process dies.
	[2c5038476aa8]

2006-06-16  Timo Sirainen  <tss@iki.fi>

	* src/deliver/auth-client.c:
	If USER query doesn't return non-zero uid and gid, give a nice error
	message.
	[bc3405f21186]

	* src/master/auth-process.c, src/master/login-process.c, src/master
	/mail-process.c, src/master/main.c, src/master/master-settings.c:
	Settings parser nowadays returns "" instead of NULL when it reads an
	empty value from config file (due to some good reason I
	unfortunately didn't write to commit message and can't remember
	anymore). Fixed a lot of existing checks which checked for empty
	strings with NULL instead of "" checks.
	[5a29e13a27cb]

	* configure.in, src/plugins/quota/quota-fs.c:
	Added support for XFS disk quotas. Patch by Pawel Jarosz
	[a17b4b01684a]

	* configure.in:
	Better detection for ioloop and notify methods. Patch by Roy Marples
	[9127e9a156de]

	* src/lib-dict/dict-client.c:
	Fixes
	[3cc2495826cf]

	* src/lib-sql/driver-mysql.c:
	Fixes to handling database updates.
	[aa895125d061]

	* dovecot-example.conf:
	Default mail_plugin_dir was wrong for lda.
	[30b70c836690]

	* COPYING, src/auth/mech-apop.c, src/auth/mech-gssapi.c, src/auth
	/mech-login.c, src/auth/mech-ntlm.c, src/auth/mech-rpa.c, src/lib-
	ntlm/ntlm-byteorder.h, src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm
	/ntlm-flags.h, src/lib-ntlm/ntlm-message.c, src/lib-ntlm/ntlm-
	types.h, src/lib/hmac-md5.c, src/lib/ioloop-epoll.c:
	Relicensed dovecot-auth to MIT.
	[2bf21770ba5b]

	* src/auth/password-scheme.c:
	Added PLAIN-MD4 password scheme. Patch by Andrey Panin.
	[3a00b36304dd]

	* src/lib/md4.c, src/lib/md5.c:
	MD4 was broken with 64bit systems. Added a few x86-64 optimizations.
	Patch by Andrey Panin
	[4361344fea54]

	* src/lib-ntlm/ntlm-byteorder.h:
	X68_64 CPU can do little-endian accesses itself. This patch updates
	ntlm-byteorder.h to reflect this fact. Patch by Andrey Panin.
	[1b0b7e111cb2]

	* src/lib-ntlm/ntlm-des.c:
	Replaced LGPL licensed DES implementation with MIT licensed one
	taken from PuTTY SSH client. Patch by Andrey Panin.
	[229ee12101da]

	* src/auth/mech-login.c:
	Support initial SASL response with LOGIN mechanism. Patch by Anders
	Karlsson
	[d3d9374141c2]

	* src/lib/module-dir.c:
	Handle errors more correctly. Fixes problems with some OSes.
	[25adaae6d333]

	* src/master/main.c:
	We broke if ssl_listen wasn't explicitly set in config file. Patch
	by Jonathan C. Broome
	[d3f7ea14f15d]

	* src/auth/auth-request.c, src/auth/passdb-pam.c:
	Fixes to handling PAM password expiring. Patch by Vaidas Pilkauskas
	[11265005453c]

	* src/deliver/Makefile.am, src/deliver/deliver.c:
	If mail_plugin_dir isn't given, use the default path for it instead
	of ignoring mail_plugins completely.
	[23814337cec5]

	* src/dict/dict-server.c:
	Minor error message update
	[840580190a9d]

	* src/lib-dict/dict-sql.c:
	Fixes to SQL update statements
	[280d2e5c3b1b]

	* src/plugins/quota/quota-dict.c:
	Don't return "no quota" even though current quota for user doesn't
	exist yet.
	[60138f3fd54f]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Crashfix in error cases
	[1debc9109152]

2006-06-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-format.h, src/lib-storage/index/dbox
	/dbox-save.c:
	Added save_time field into dbox mails.
	[f920c9f39fdf]

2006-06-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-client.c:
	Fixes to dict proxy
	[a293b73ba06d]

	* src/lib-dict/dict-client.c:
	t_pop() calls were missing from some error handling paths
	[6d4e6ea6d73a]

	* src/lib-dict/dict-sql.c:
	Use sql_escape_string() instead of str_escape()
	[17bea8988d92]

2006-06-13  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	Released 1.0.beta9
	[46819c03708d]

	* Makefile.am:
	Delete dovecot-config in distclean.
	[0caf7d41c81d]

	* TODO:
	Updated
	[da3130e8f6e6]

	* src/deliver/Makefile.am:
	Added mountpoint.o to unused objects list
	[bdc5c800339d]

2006-06-12  Timo Sirainen  <tss@iki.fi>

	* src/deliver/Makefile.am, src/deliver/deliver.c:
	Changed hardcoded /var/run/dovecot to PKG_RUNDIR.
	[b724468368a4]

	* dovecot-example.conf:
	Updated LDA's default auth_socket_path
	[f9707808eaae]

	* dovecot-example.conf:
	Updated postmaster_address and hostname setting descriptions.
	[08e78759a495]

	* dovecot-example.conf:
	Changed default postmaster_address to @example.com
	[8b3f3f99f2f0]

2006-06-12  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/master/mail-process.c:
	dovecot --exec-mail ext <binary path> now reads the default settings
	from configuration file, puts them to environment and executes the
	given binary.
	[ea394107b267]

2006-06-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-file.h, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync-full.c, src/lib-storage/index/dbox
	/dbox-sync.c:
	Allow reading saved mails which haven't been committed yet (ie. make
	quota plugin work).
	[d4f6237ae4dc]

	* src/auth/passdb-pam.c:
	Set PAM_TTY.
	[a498d94611b8]

	* dovecot-example.conf:
	Added protocol lda section.
	[934e821fb1f1]

2006-06-11  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	s/login_process_per_use/login_process_per_connection/
	[2731b76aa3b6]

	* dovecot-example.conf:
	Moved around settings and added some main groups to them, hopefully
	making it easier to find them.
	[3ff82552a9a9]

	* dovecot-example.conf:
	Moved the socket listen example into auth default instead of having
	its own auth block, which confused people.
	[95d2dd15910d]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	transaction-log-append.c:
	We used "already synced log positions in view" array to store
	locations of committed hidden transactions. They however weren't
	really synced, which caused some problems. Added a separate "hidden
	sync log positions" array for them which is handled differently.
	[368c1758d737]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	Don't call pam_setcred() unless setcred=yes PAM passdb argument was
	given.
	[3911fade4dbc]

	* src/imap/cmd-subscribe.c:
	If tb-extra-mailbox-sep workaround was enabled, subscribing was
	broken unless the namespace had empty prefix.
	[0ece3d226c1d]

	* src/master/main.c:
	If running from inetd, don't try to open/close listener sockets when
	receiving SIGHUP.
	[4621ddedfd8c]

2006-06-11  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c, src/plugins/quota/quota.h:
	If size of the mail was known before saving started, we allocated
	the quota twice for it.
	[67ef774c639a]

	* src/plugins/quota/quota-storage.c:
	Update quota when deleting a mailbox.
	[840cd1e69e90]

2006-06-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-expunge.c:
	If mailbox_search_deinit() fails, we leaked a bit of memory.
	[9309fa0ee5c5]

	* src/master/login-process.c:
	Starting pop3 processes from inetd started actually imap processes
	after login.
	[68035c04ca30]

	* src/login-common/ssl-proxy-openssl.c:
	Updates to ssl_verify_client_cert: Check CRLs. If auth_verbose=yes,
	log invalid sent certificates. If verbose_ssl=yes, log even the
	valid certificates. When using the username from the certificate,
	use CommonName. Based on patch by HenkJan Wolthuis
	[081574d9d34f]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-util.c,
	src/plugins/quota/Makefile.am, src/plugins/quota/quota-maildir.c:
	Add ",S=size" to maildir filenames when quota plugin is loaded with
	Maildir++ backend.
	[1be4082e6552]

	* src/auth/auth-request.c, src/auth/passdb-pam.c, src/auth/passdb.h:
	If password is expired, give "Password expired" error. Currently
	works only with PAM. Also added "unknown user" PAM return value
	handling.
	[2d9916eb1315]

	* src/auth/db-sql.c:
	s/ldap/sql/ in error message
	[3a04be6e2218]

	* INSTALL:
	Removed most of the content and added links to Wiki instead.
	[cb46a837f0ed]

	* configure.in:
	Don't enable GSSAPI support by default
	[d38b4e5d62ba]

	* configure.in:
	Whitespace cleanup for --help
	[7d963790e163]

	* src/deliver/auth-client.c, src/deliver/auth-client.h,
	src/deliver/deliver.c:
	Don't try to change uid/gid to the same one it already is.
	[e91e75f6a3e5]

	* src/lib-index/mail-cache-fields.c:
	If cache field's size is wrong, rebuild the cache file instead of
	crashing sometimes later.
	[1b4dee36bdaa]

	* src/lib-storage/index/maildir/maildir-list.c:
	If file begins with ".nfs", stat() it always to see if it's a
	directory since it may be a temporary file created by kernel.
	[d3199b139afc]

	* configure.in, src/Makefile.am, src/deliver/Makefile.am, src/deliver
	/auth-client.c, src/deliver/auth-client.h, src/deliver/deliver.c,
	src/deliver/deliver.h, src/deliver/duplicate.c,
	src/deliver/duplicate.h, src/deliver/mail-send.c, src/deliver/mail-
	send.h, src/deliver/smtp-client.c, src/deliver/smtp-client.h:
	Moved all the non-Sieve code from dovecot-lda in here and rewrote
	parts of it to be cleaner. The Sieve code can now be run as a plugin
	from dovecot-sieve CVS module.
	[0b9f441a45be]

	* .cvsignore, Makefile.am, dovecot-config.in, dovecot-config.in.in:
	dovecot-config contains now module_dir.
	[282e04c8e2e7]

2006-06-09  Timo Sirainen  <tss@iki.fi>

	* doc/mkcert.sh:
	If cert/key directories don't exist, exit immediately instead of
	just priting the errors.
	[2dc03f88d92e]

	* AUTHORS:
	Some updates
	[edf69be477dc]

	* src/lib/primes.c:
	Minor coding style changes. Removed GLib copyrights as the only
	thing left from the original code is the prime number list.
	[0db0cb4b6cb3]

	* src/plugins/convert/convert-storage.c:
	Convert subscriptions also.
	[a1fee91a3c7d]

	* src/lib-storage/index/dbox/dbox-format.h:
	Changed subscriptions filename to just "subscriptions".
	[84c88484b2c1]

2006-06-08  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c:
	Get the quota limits from plugin parameters instead of from the
	dictionary itself. Added support for message count limits. Other
	cleanups.
	[4e4019d08493]

	* src/plugins/quota/quota.c:
	Don't return NULL error so we don't crash in some systems.
	[a57fad307ba8]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c:
	Handle i_stream_stat() better.
	[28978f8734b4]

	* src/master/main.c, src/master/master-settings.c:
	If ssl_listen setting was empty in config file, startup failed with
	"Can't resolve address" error.
	[8ba664623c00]

	* src/lib-index/mail-cache.c:
	Crashfix
	[b440e392e974]

	* src/lib-storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-uidlist.h:
	If mail's size is known beforehand, select the dbox file so that the
	saving won't grow file larger than dbox_rotate_size.
	[f0e80cb9a578]

	* src/lib-storage/index/dbox/dbox-save.c:
	Saving to multiple files within a transaction was broken.
	[1f5c5c6ed6b6]

	* src/plugins/convert/convert-storage.c:
	Create destination INBOX always uppercased.
	[9f7cf9697ac6]

	* src/lib/file-dotlock.c:
	Using file_dotlock_touch() caused Dovecot to think the dotlock had
	been modified by someone else.
	[9a93d745f848]

	* src/plugins/convert/Makefile.am:
	Added library dependencies to work correctly for convert-tool.
	[16f6e2db31a2]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	dbox_rotate_size checking was wrong.
	[55b3c5877a5d]

2006-06-07  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-fetch.c:
	If FETCH fails because client disconnects in the middle of it,
	return "Disconnected" error message instead of "unknown error".
	[dfdbc07ea2f3]

2006-06-05  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/login-common/sasl-
	server.c, src/login-common/sasl-server.h, src/pop3-login/client-
	authenticate.c:
	IMAP: Reply with tagged BAD if authentication is aborted because
	client sent "*" or something else that was a client error.

	If authentication failed for any reason, the error message was
	always "Authentication failed". In case of client errors or if auth
	process gave an error message, it should have been that instead.
	[96cd68a569e1]

2006-06-02  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Check for existence of PQescapeStringConn() in PostgreSQL library.
	Forgot to commit earlier.
	[13a796fc9f6a]

2006-05-31  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init-openssl.c:
	Reversed last change. Instead handle DH_generate_parameters() call's
	failure.
	[44204e45c6b6]

	* src/master/ssl-init-openssl.c:
	Give a nicer error message if i2d_DHparams() returns 0, which
	apparently it does in some cases.
	[bc8fb298a14f]

	* src/lib-storage/index/maildir/maildir-storage.c:
	With some NFS implementation DELETE failed if ..DOVECOT-TRASHED
	directory already existed
	[b9e38e60f9b0]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c:
	Close index files before trying to unlink the index directory
	[f82e2f6054b2]

	* src/auth/auth-cache.c, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/db-
	passwd-file.c, src/auth/db-sql.c, src/auth/passdb-sql.c, src/auth
	/userdb-sql.c:
	Escape SQL strings using sql_escape_string(). Fixes the problems
	with PostgreSQL.
	[84ce9a1240a7]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/driver-sqlite.c, src/lib-sql/sql-api-private.h, src/lib-sql/sql-
	api.c, src/lib-sql/sql-api.h:
	Added sql_escape_string()
	[73090317b74c]

2006-05-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-mysql.c:
	Use array instead of buffer for storing connections.
	[86fff2444528]

	* src/lib/istream-internal.h, src/lib/istream.h, src/lib/nfs-
	workarounds.h:
	Include <sys/stat.h> before using struct stat, because some systems
	may use a macro to define struct stat to something else.
	[038d6942dd89]

	* src/imap/client.c:
	Added assert against NULL reason for client_disconnect().
	[f48505046e42]

	* src/lib-storage/index/index-storage.c:
	Don't return NULL error messages.
	[3285eca074e1]

	* src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-cache.h:
	Don't check ACL file's timestamp changes more often than once in a
	second.
	[3b168b2f554d]

	* src/plugins/acl/acl-backend-vfile.c:
	NULL-terminate the parsed rights
	[b75bfd7dd0ac]

	* src/auth/mech-digest-md5.c:
	Trying to use subsequent authentication crashed.
	[2b48cfebc9b3]

2006-05-29  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-cache.c:
	We were caching the EOF block wrongly in some situations.
	[266f3ff2e700]

	* src/lib-index/mail-index-sync-update.c:
	Memory leak fix for last update and some other cleanups
	[c434b2b2a7ec]

	* src/lib-index/mail-cache-sync-update.c, src/lib-index/mail-cache.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.c:
	We were updating index->map also when syncing views.
	[d5ad75c83776]

2006-05-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	When extension data is being reset, recreate the index file to make
	sure that other processes notice the reset_id change. Fixes cache
	file corruption complaints around the time it's being compressed.
	[d6dca749d2a6]

	* src/lib-storage/index/dbox/dbox-sync.c:
	Removing and resetting keywords could have operated on wrong file's
	keyword list.
	[c9021796102f]

2006-05-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	BODYSTRUCTURE -> BODY translation was missing CRLF after literal.
	[0469556e6dc5]

2006-05-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-index/mail-index-sync.c:
	If we're synchronizing a view (and not index itself) from
	transaction log, give a different error message and don't mark the
	file corrupted.
	[9162523f2c7a]

	* src/lib-index/mail-index.c:
	If syncing from transaction log fails, fallback to re-reading the
	index file (and more importantly, try to avoid crashing in assert..)
	[1f337d7402d6]

	* src/imap/cmd-append.c:
	If connection closes while appending, we crashed in some situations.
	[4d45980f78c4]

	* src/lib-storage/index/dbox/dbox-format.h, src/lib-storage/index/dbox
	/dbox-list.c, src/lib-storage/index/dbox/dbox-storage.c:
	Renamed Mails -> dbox-Mails to make it less likely to conflict with
	user-created mailbox.
	[41760031f8cb]

	* src/lib-storage/index/dbox/dbox-keywords.c:
	Fix for handling keywords
	[25b51319cd9d]

2006-05-13  Timo Sirainen  <tss@iki.fi>

	* README:
	Added a note about using mailing list for questions.
	[e091f8b36fc8]

	* src/auth/db-ldap.c, src/auth/db-ldap.h:
	Added support for SASL binding. Patch by Geert Jansen
	[7141bf1b1eb3]

2006-05-12  Timo Sirainen  <tss@iki.fi>

	* src/pop3/Makefile.am:
	Link mountpoint.o manually to get mountpoint_get() included into
	binary, so quota plugin can use it.
	[4066b386eefa]

	* src/lib/mempool-alloconly.c:
	Fixes to compiling with DEBUG
	[fa0eb0898c1c]

2006-05-12  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	Don't cause whitespace offsets to break if some headers before it
	were removed (eg. extra X-IMAPbase headers)
	[3438cd98986e]

	* src/master/master-settings.c, src/master/master-settings.h:
	Fix for non-C99 compilers.
	[a3257e13c529]

2006-05-12  Timo Sirainen  <tss@iki.fi>

	* NEWS, configure.in:
	Released 1.0.beta8
	[1d191afc8bf7]

2006-05-12  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/master/mail-process.c:
	NFS check wasn't working if chrooting was used.
	[0ff79293938e]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Don't allow "." and ".." mailbox names/masks.
	[af5177fa5427]

2006-05-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am, src/imap/cmd-authenticate.c, src/imap/cmd-
	login.c, src/imap/commands.c, src/imap/commands.h:
	Removed LOGIN and AUTHENTICATE command handlers completely. They're
	only valid in non-authenticated state and there's really no point in
	having them here anymore.
	[ecf4c55966ac]

	* src/lib/file-dotlock.c:
	When checking if we want to override dotlocks, don't use the file-
	to-be-locked file's mtime if it's higher than current time.
	[1f8a8ad4374f]

2006-05-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-kqueue.c:
	Fixed "Unrecognized event" errors that occurred with IO_ERROR. Patch
	by Vaclav Haisman
	[64223506d8d8]

	* src/lib-index/mail-index.c:
	Keep track of write_atomic and write_seq_first/last while copying
	memory mappings. This is important with mmap_disable=yes because the
	maps can later be written to index file, and if this information is
	wrong the file is being updated wrong..
	[5aa3fb11fd1b]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox
	/dbox-sync-full.c:
	fixes
	[e11896c0069f]

	* src/lib/file-dotlock.c:
	If dotlock creation timeouts, unlink() the temp file we used
	[7334541b552c]

	* src/lib/sendfile-util.c:
	Linux's sendfile() returns 0 when remote has closed connection.
	Convert it to EPIPE.
	[e4d2661502ce]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	fix
	[b83134beeb66]

	* src/lib/mempool-alloconly.c:
	base_size variable isn't really needed in the pool when DEBUG isn't
	used. With DEBUG enabled, check when clearing the pool that the
	allocated memory is completely cleared, ie. that no-one wrote out of
	bounds to it.
	[f53764b8efa1]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fix
	[38678d2708cc]

	* src/lib-storage/index/dbox/dbox-storage.c:
	Don't allow accessing Mails directory in any way, just return
	"Invalid mailbox name".
	[388fc42d336d]

	* src/lib-settings/settings.c:
	Read empty string settings as "", not NULL.
	[c4fee10b30b3]

	* src/lib/mountpoint.c:
	Minor cleanup: Switch hardcoded /etc/mnttab in Solaris to use MNTTAB
	macro
	[dd1403b801e2]

2006-05-09  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c:
	If PASS command is given (after unsuccessful USER) with plaintext
	auth disabled, give proper error message instead of "No username
	given".
	[7c526201aee5]

2006-05-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	MAIL_CACHE_FLAG_TEXT_PLAIN_7BIT_ASCII wasn't necessarily saved to
	cache always
	[8117049c180f]

	* src/lib-storage/index/index-mail.c:
	Strings should be freed with str_free(), not p_free().
	[0d61f870b521]

	* src/lib-storage/index/index-mail.c:
	Strings should be freed with str_free(), not p_free().
	[327abd67380d]

2006-05-08  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-mail/Makefile.am, src/lib-mail/message-header-parser.c, src
	/lib-mail/message-header-parser.h, src/lib-mail/message-parser.c,
	src/lib-mail/message-parser.h, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-search.c:
	Rewrote the message bodystructure parser to allow parsing from non-
	blocking streams. Also did a couple of API changes and cleanups.
	[fd315deac28f]

2006-05-08  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Note about this being unstable CVS branch
	[bd93316b078b]

	* TODO:
	Update
	[d5381941feea]

2006-05-05  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c:
	If authentication client does something bad, don't crash the whole
	process (clean NULL-pointer-write crash).
	[cfe9e58be252]

	* src/auth/auth-worker-client.c:
	Don't send extra TABs to auth worker server, they break it.
	[4f742c7f7948]

	* src/lib/module-dir.c:
	Fix for building without modules
	[f7d281db12e6]

2006-05-04  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c, src/deliver/deliver.c, src/dict/main.c,
	src/imap/main.c, src/login-common/main.c, src/master/main.c,
	src/pop3/main.c:
	Use lib_signals_ignore() for signals we really want ignored.
	[545a747d0347]

	* src/lib/lib-signals.c, src/lib/lib-signals.h:
	And s/lib_signals_ignore_signal/lib_signals_ignore/
	[ec4782b057f0]

	* src/lib/lib-signals.c, src/lib/lib-signals.h:
	Added lib_signals_ignore_signal() and made lib_signals_set_handler()
	with NULL handler not restart syscall.
	[5bc987dc62a8]

	* src/lib-storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-sync.h:
	s/dbox_sync_if_changed/dbox_sync_is_changed/
	[a767dd4fafb0]

	* src/lib-storage/index/dbox/dbox-sync.c:
	Keep track of recent flags.
	[706c978c7c7d]

	* src/lib-index/mail-index-sync.c:
	If only changes were recent-flag updates, we didn't write them to
	index.
	[f17622d1d927]

2006-05-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	Don't compress cache file if it was just compressed by another
	process.
	[9c3f19110538]

	* src/lib-index/mail-index-sync-update.c:
	When removing recent-flags with mmap_disable, the flags weren't
	actually removed which caused broken recent counter errors. Also
	added more checks not to update counters if they're already known to
	be broken.
	[524a584f2302]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fix
	[be915546ce49]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-view-private.h, src/lib-index/mail-index-view-sync.c,
	src/lib-index/mail-index-view.c:
	Index header's seen/recent/deleted counters weren't always correct
	after syncing a view. This caused some problems with recent SEARCH
	optimizations, eg. EXPUNGE not always working.
	[b9a7a9592f43]

	* src/lib-index/mail-index-transaction.c:
	Fixes to updating keywords
	[07c10799434e]

2006-05-02  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	When requesting quota resource, don't return it if it's unlimited.
	Also treat 0 quota limits also in plugin parameters as unlimited.
	[e05768db2fd7]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	Don't add extra spaces to reply if some of the resources aren't
	really found.
	[4fa5cda580db]

	* src/pop3/main.c:
	Built-in pop3_logout_format default wasn't updated.
	[f58c8751cacf]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Offset update fix
	[edd923a44ef7]

2006-05-02  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Adding mail to index while saving it had a race condition. Fixing it
	required a bit larger changes. Switched uidlist/index locking order
	so that uidlist is now locked first.
	[3c8b191b0019]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c:
	mmap_disable: When syncing in-memory index from transaction log, we
	didn't skip external transactions which were already been in our in-
	memory mapping, causing "Append with UID n, but next_uid = m"
	errors.
	[20e6d554d3fe]

	* src/plugins/acl/acl-backend-vfile.c:
	Letter ACLs were wrong.
	[789b586d9015]

2006-04-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c:
	And more generic error fix..
	[304e4e4410b9]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox
	/dbox-sync.c:
	Error fixes
	[c31d7c833d5c]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fixes
	[dd22380b0fc0]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Error message fixes
	[81ec8a2fbea9]

	* src/plugins/quota/Makefile.am:
	Install the quota plugin also for POP3.
	[8ac54879ca92]

	* src/pop3/common.h, src/pop3/main.c:
	hook_mail_storage_created: Make it compatible with imap and lda by
	not taking a pointer to pointer to storage.
	[8bf51d76a01d]

	* src/master/mail-process.c:
	Don't validate uid/gid when executing imap for dump-capability
	[58d4413314a4]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fix
	[8bd6ee717880]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c:
	Fixes / cleanup
	[9cf143e90327]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	More fixes.
	[83322a523c91]

2006-04-25  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib/nfs-
	workarounds.c, src/lib/nfs-workarounds.h:
	Added nfs_safe_stat() to transparently work around ESTALE with
	stat().
	[abdef9d86a94]

2006-04-24  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/master/master-settings.c:
	dump-capability wasn't working if dovecot wasn't run as root.
	[8736c4deb253]

	* src/plugins/quota/quota-maildir.c:
	Accidentally reverted 0-is-unlimited-quota change in last commit.
	[606144f4e407]

	* src/lib-storage/index/index-search.c:
	Fix for last changes. We didn't handle properly non-sequential
	messageset ranges.
	[b900a7257555]

	* src/lib-index/mail-index-view-sync.c:
	When beginning to sync from old view, don't keep the old header
	completely, because there may have been some important new changes.
	Copy only the message counts and such manually now. Fixes an error
	message when sometimes adding keywords.
	[833f9217c1d6]

	* src/lib-index/mail-index.c:
	Added assert
	[2af75b0379bb]

	* src/lib-index/mail-index-transaction.c:
	Fixed crash while updating keywords (broken by recent changes).
	[53e1edf215e0]

2006-04-22  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Fixed a buffer overflow if maildirsize was over 5120 bytes long.
	Luckily almost no-one used maildir++ quota yet and the bug is highly
	unlikely to be exploitable anyway.
	[a3f9089faadb]

	* src/master/mail-process.c:
	Fixed last broken commit
	[4d9706112af4]

2006-04-21  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	NFS check should be done only once at startup, not every time.
	[9f8493a8cd65]

2006-04-21  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-maildir.c:
	0 values in maildirsize means unlimited.
	[e7ff0eced559]

2006-04-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am:
	Link mountpoint.o manually to get mountpoint_get() included into
	binary, so quota plugin can use it.
	[46f3a7a3eaef]

	* src/master/mail-process.c:
	If mail environment is "", don't use it.
	[096b5a271614]

	* src/master/mail-process.c:
	Don't crash in NFS check if using mail path autodetection
	[59d5370a330f]

2006-04-20  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	Fixed last change: added missing '/' back
	[044889ec438e]

	* dovecot-example.conf:
	Changed example dovecot-auth-client path also to /var/run/dovecot
	[e53deec5e422]

	* dovecot-example.conf:
	Changed auth-master example socket to /var/run/dovecot/auth-master
	again. Nowadays /var/run/dovecot is world-rx so it's a better place
	for it.
	[ca14a26d28b4]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	uidlist.c:
	Fixes
	[67f6d3afa5a5]

	* src/lib/file-dotlock.c:
	file_dotlock_get_lock_path() doesn't return the path from data stack
	anymore. Also changed the internal logic to use less data stack as
	well.
	[96f3908b7c34]

	* src/lib/seq-range-array.c:
	Fix for seq_range_array_remove()
	[ec7e56827ea8]

2006-04-20  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/dbox/dbox-mail.c:
	If dbox mail is lost, synchronize the dbox instead of just
	refreshing index (it's not enough).
	[b56fa3e45dba]

2006-04-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	If we sorted appended messages, we weren't sorting extensions and
	keywords so they were mapped to wrong messages (dbox-only problem,
	keywords not yet fixed by this change).
	[9c8a79d36bb0]

	* src/lib-storage/index/dbox/dbox-storage.c:
	Fixed memory leaks
	[4141aae720fe]

2006-04-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c:
	Fixes
	[581b5a12c7b7]

2006-04-18  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c:
	Don't assert-crash if first mail is expunged and we're doing a full
	sync.
	[dde86781168f]

2006-04-17  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c:
	If storage separator is '/', it's possible that we're trying to open
	a directory as an ACL file. If that happens, use dir/.DEFAULT file
	as the ACL file instead.
	[38a5e4396091]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If maildir is readonly, don't complain about rename() failing to
	move mails from new/ to cur/.
	[fa135b615b01]

	* src/lib-storage/index/mbox/mbox-file.c:
	Don't try to call utime() for mbox if it's readonly, it'll just
	fail.
	[def18c75ced2]

2006-04-14  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/imap/main.c, src/login-common/common.h,
	src/login-common/main.c, src/master/login-process.c, src/master
	/mail-process.c, src/master/mail-process.h, src/master/main.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3-login/client-authenticate.c:
	If we have plugins set and imap_capability unset, figure out the
	IMAP capabilities automatically by running imap binary at startup.
	The generated capability list isn't updated until Dovecot is
	restarted completely, so if you add or remove IMAP plugins you
	should restart.
	[c3ded5b815aa]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage-private.h:
	Optimized searching a bit for cases where we can restrict search
	range by simply looking at sequence sets. Also optimized some
	deleted/seen flag searches where no results would be found. Added
	search_next_update_seq() virtual method which allows plugins to
	restrict the search range (eg. allowing indexed text search
	plugins).
	[6ac0d63b297f]

	* src/lib/mountpoint.c:
	Clear mountpoint struct even in error cases.
	[a00c5d4915f3]

	* src/lib/mountpoint.c:
	mtab path is /etc/mnttab with Solaris
	[de4609242c8a]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-sync.c:
	If mailbox was opened with readonly-flag, don't really force it.
	Fixes EXAMINE box + APPEND box.
	[a47df521d4fa]

	* src/plugins/quota/quota-fs.c:
	quotactl() parameters were backwards for BSDs and AIX.
	[26e028337e1e]

	* src/dict/Makefile.am:
	Added RAND_LIBS
	[c75fb8c60672]

	* src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Unless nfs_check=no or mmap_disable=yes, check for the first login
	if the user's index directory exists in NFS mount. If so, refuse to
	run. This is done only on first login to avoid constant extra
	overhead.
	[19fc27f57b0c]

	* src/lib/mountpoint.c:
	memset() the returned structure, just in case.
	[1fb345878e1b]

	* src/plugins/quota/quota-fs.c, src/plugins/quota/quota-fs.h:
	Use mountpoint_get() instead of doing it ourself.
	[a3dc87033d2f]

	* src/lib/Makefile.am, src/lib/mountpoint.c, src/lib/mountpoint.h:
	Added mountpoint_get() for looking up a path's mount point
	information.
	[e6d38617efdf]

	* src/auth/auth-master-listener.c, src/auth/auth-master-listener.h,
	src/auth/main.c:
	Deinitialization crashfixes.
	[f97b4052dd81]

	* src/auth/auth-worker-client.c:
	Don't crash if no extra arguments were given to auth worker request.
	[8cc6595a9b43]

	* src/lib-storage/index/mbox/mbox-storage.c:
	MBOX_MIN_INDEXED_SIZE -> MBOX_MIN_INDEX_SIZE so it actually works
	[1f4114fe2896]

2006-04-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/pop3/main.c:
	Destroy client connection at deinit before unloading modules.
	[32b5045f8d80]

	* src/plugins/quota/quota-dirsize.c:
	When using multiple namespaces, don't count each of them if they're
	using the same storage backend.
	[85efed60baef]

	* src/plugins/quota/quota-dirsize.c:
	Count INBOX also if it's outside the default mail directory.
	[b58eedd18662]

	* src/auth/db-ldap.c:
	If LDAP library didn't have ldap_initialize() function, we always
	complained about the URI settings.
	[92b572fbb88a]

	* src/master/mail-process.c:
	pop3_lock_session setting wasn't transferred to pop3 process
	[dc5d40160d1b]

2006-04-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c:
	Crashfix when saving fails before even opening the file
	[cd28396bf83a]

	* src/lib-storage/index/dbox/dbox-storage.c, src/master/mail-
	process.c:
	dbox settings in config file didn't work, and the defaults were also
	a bit broken.
	[4eaaef28cc38]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/dbox/dbox-uidlist.c:
	dbox fixes
	[513aa0df39ee]

	* src/lib-storage/index/dbox/dbox-save.c:
	Truncate dbox file immediately if saving is aborted.
	[c0b27c24c098]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c:
	Removed accidentally committed debugging code
	[ab19d3e38f2d]

	* src/lib/seq-range-array.c:
	seq_range_array_remove(): Don't crash if array is empty.
	[1ba7983b814c]

	* src/lib-storage/index/dbox/Makefile.am, src/lib-storage/index/dbox
	/dbox-format.h, src/lib-storage/index/dbox/dbox-list.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	storage.h:
	Moved dbox data structures to dbox-format.h which can be easily
	included from elsewhere.
	[8982857c24fa]

	* src/lib-storage/index/dbox/dbox-save.c:
	ftruncate() the file after mail has been appended. We might have
	reused some existing aborted mail in there.
	[b3251beec0d3]

	* src/lib-storage/index/dbox/dbox-storage.c:
	When creating index directories, create also the Mails directory.
	[ca0a649dbb61]

	* src/imap/cmd-append.c:
	Don't crash if client disconnects while appending message.
	[8686345192e8]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	src/auth/auth.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_username_format setting.
	[3f27bf7832a2]

	* src/lib/module-dir.c, src/lib/module-dir.h:
	Allow giving module names in non-basename form.
	[32dd28f96dce]

	* NEWS, configure.in:
	And 1.0.beta7..
	[cda5c90cae57]

	* dovecot-example.conf, src/imap/main.c, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3/main.c:
	Added shutdown_clients setting to control if existing imap/pop3
	processes should be killed when master is.
	[773c4becceae]

	* src/auth/auth-request.c:
	Master login fixes, PLAIN authentication was still broken..
	[d38dd6312be1]

	* NEWS, TODO, configure.in:
	Released 1.0.beta6.
	[be4b893275a8]

	* doc/variables.txt, src/lib/var-expand.c:
	%M modifier returns string's MD5 sum. Patch by Ben Winslow
	[baa2f72e4010]

	* src/pop3-login/client.c:
	Add a space between POP3 greeting and APOP challenge
	[147d53a049ee]

	* src/lib/var-expand.c:
	%U modifier was actually lowercasing the string. Patch by Ben
	Winslow
	[86fa00c163dc]

2006-04-10  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	And add -lm also to LIBS when checking if -lmysqlclient works..
	[22bc42a33b79]

	* configure.in:
	libmysqlclient needs also -lm
	[f1cd4665f82d]

	* INSTALL:
	Updated GNUTLS information.
	[ed7d77a89b17]

2006-04-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c:
	Make sure errno is restored when exiting SIGRT signal handler.
	[d39ac5712d2e]

	* src/auth/passdb-ldap.c:
	Fixed non-plaintext password lookups from LDAP. Patch by Lior Okman.
	[cf02b2fbcb7a]

	* src/lib-storage/index/mbox/mbox-lock.c:
	fcntl locking: Don't print error if we're only trying to lock
	(instead of waiting) and it failed.
	[7a4c7a12da9e]

	* dovecot-example.conf, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/client.c, src/pop3/common.h,
	src/pop3/main.c:
	Added pop3_lock_session setting.
	[690c72358cd5]

	* src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/mbox/mbox-storage.h, src/lib-storage/mail-
	storage.h:
	Added MAILBOX_OPEN_KEEP_LOCKED flag to mailbox opening and
	implemented it for mbox and maildir. It keeps the mailbox locked the
	whole time until mailbox_close() is called.
	[e2edd333c473]

	* src/plugins/quota/quota-fs.c:
	Fixed calculation overflows
	[2e418435b460]

	* src/lib/ioloop.h:
	IO_ERROR and IO_NOTIFY had conflicting values.
	[49e024519e22]

	* src/imap/main.c, src/pop3/main.c:
	When master dies (by closing log file descriptor), kill ourself
	also.
	[b10fa8ba01ca]

	* src/master/auth-process.c, src/master/login-process.c:
	If master process runs out of file descriptors, try to handle it
	more nicely than getting into infinite loop.
	[f60d73c96618]

	* src/master/mail-process.c:
	If %h is used but home directory isn't given by userdb, use
	"/HOME_DIRECTORY_USED_BUT_NOT_GIVEN_BY_USERDB" as the home
	directory.
	[674f328d5fdd]

	* src/auth/auth-request.c, src/auth/userdb-prefetch.c:
	Allow prefetch userdb to exist nicely with other userdbs.
	[bdf68bc43354]

	* dovecot-example.conf:
	Updated mechanism list. Added link to MasterPassword in wiki.
	[469a60254c79]

	* configure.in:
	Unbreak last sqlite change
	[13665379afa8]

	* configure.in:
	Print the SQL drivers we're building.
	[c2ae6dc37a19]

	* configure.in:
	Added lib64 directory to mysql/pgsql checks. Removed all special
	lib/include directory handling from SQLite checks (it should usually
	exist in default paths I think).
	[08aef9a8e22c]

	* configure.in:
	SQLite include/libdir fixing
	[4a023bede75e]

	* src/auth/auth-request.c:
	The login and master usernames were reversed when using
	master_user_separator (now the order is UW-IMAP compatible).
	[52a2e6f35acf]

	* src/auth/auth-request.c:
	Master login attempts weren't logged if no master passdbs were
	defined.
	[68c2ad5e4f85]

	* src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added -a and -n parameters to dovecot to dump all/nondefault
	settings. A bit ugly code, but it'll do until the whole config
	handling gets rewritten in Dovecot 2.0.
	[f9a6381adbe3]

	* src/auth/db-passwd-file.c:
	Don't crash if passwd-file has entries without passwords.
	[1cbaed584eb8]

2006-04-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	If master login username is the same as the normal username, we
	don't want to treat it as master user. Fixes authentication with
	some clients.
	[f7731e6eec7e]

2006-04-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth.c:
	auth_verbose_debug_passwords=yes always sets now
	auth_verbose_debug=yes, and auth_verbose_debug=yes also sets
	auth_verbose=yes.
	[c942211332a5]

2006-04-06  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-maildir.c:
	Fixes. Added storage and messages parameters to quota plugin
	parameter. If given, they specify the master quota limits, so if
	maildirsize has different limits Dovecot will replace them. If
	maildirsize doesn't exist and Dovecot doesn't have limits, Maildir++
	quota is disabled for the user.
	[8a61b892bd60]

2006-04-06  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Return value of get_resource() was wrong, which caused quota
	reporting not to work.
	[80eeec535031]

2006-04-04  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	1.0.beta5 released
	[66d6fd7c368e]

	* src/login-common/ssl-proxy-openssl.c:
	Reverted back for now.
	[c12bb541f925]

2006-04-02  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c:
	stat() the mount point paths instead of the devices to find out
	where the mount point is.
	[f309f5d124dc]

	* NEWS:
	update
	[632b3117aecc]

	* NEWS, TODO, configure.in:
	1.0.beta4 released
	[9198a457f022]

	* src/login-common/ssl-proxy-openssl.c:
	Rewrite. Hopefully works better.
	[60583fb75d9e]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If mailbox is opened in non-readonly state and there are mails in
	new/, make sure they get moved to cur/ so that their recent-state
	gets removed.
	[63d6890803b3]

	* src/pop3-login/client.c:
	Same STARTTLS flush callback fix as with imap-login.
	[5071c561c455]

	* src/imap-login/client.c:
	Output flush handler wasn't unset after STARTTLS, which could have
	caused STARTTLS to be done again (it was unlikely to be ever set
	though).
	[e65a7848e9e4]

	* src/login-common/login-proxy.c:
	Show client IP properly also with SSL connections.
	[8df011c2cdc4]

	* src/lib/ostream-file.c:
	If output flush callback closed the stream, don't add another flush
	I/O handler to it even if there would still be something to flush.
	[9e5af78ea530]

	* src/deliver/deliver.c:
	Use mail_storage_parse_env(), even though this code doesn't even
	compile now..
	[f63ff46276a8]

	* dovecot-example.conf, src/lib-storage/mail-storage.c, src/master
	/master-settings.c:
	Changed the default lock_method back to fcntl. flock seems to be
	broken in some systems..
	[c9afd13cf2d5]

2006-04-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c:
	Hide also "." and ".." when listing mboxes
	[162d643ee89b]

	* dovecot-example.conf, src/master/master-settings.c,
	src/pop3/client.c:
	Replaced %T and %R with %p and %b. %R was already used by string-
	reversion, so uppercase letters should now be reserved for modifiers
	to avoid this in future..
	[b66da5c1a94b]

	* src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h:
	Don't hide all .files when listing mboxes, only .imap and
	.subscriptions. Moved the hardcoded ".imap" strings into a define.
	[273ae8a1a58a]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h:
	When deleting a maildir, rename it to ..DOVECOT-TRASHED, and assume
	only that directory to be safe to be deleted, instead of all ..dirs.
	When deleting maildir with absolute path, don't do renaming at all
	but delete it directly.
	[9d95aad9e9a7]

	* src/lib-storage/index/mbox/mbox-lock.c:
	If we can't lock mbox file, mark those errors as temporary so LDA
	treats them as temporary errors instead of bouncing.
	[d358e0f0fd18]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-storage.h, src/lib-storage/index/dbox/dbox-sync-expunge.c, src
	/lib-storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-uidlist.h:
	Fixes and cleanups.
	[d1c27abc6ebc]

	* src/lib/file-dotlock.c:
	Added some t_push/t_pop calls
	[770c06dc9adb]

	* src/lib/seq-range-array.c:
	Removal didn't work properly from beginning/end if the range
	contained only a single sequence.
	[d7e169797e3e]

2006-03-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-passwd-file.c:
	Don't break if password contains '[' characters.
	[07ee079dcf0d]

	* src/lib-index/mail-cache-fields.c:
	Don't crash with "can't allocate 0 bytes of memory" if there are
	zero fields in cache file.
	[9662de8fc649]

2006-03-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-uidlist.c:
	Some fixes to get dbox code working better. Still needs some work
	though..
	[988a8ef1deea]

2006-03-27  Timo Sirainen  <timo.sirainen@movial.fi>

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	src/auth/auth.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_master_user_separator setting which allows giving the
	master username inside the normal username.
	[e1774d677536]

2006-03-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	Keep \Seen flags privately only in indexes with shared mailboxes.
	[d29677c59dc5]

	* src/lib-storage/index/maildir/maildir-save.c:
	Saving (or copying) multiple mails at a time caused all but the
	first mail to be left to tmp/.
	[c4bdc1b1aac5]

	* src/auth/auth.c:
	Changed "no user databases" error to be hopefully more easier to
	understand.
	[085bffbdd1b1]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	src/auth/auth.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Removed master_no_passdb setting. Added pass setting which can be
	used to do the same thing, and other things. Now setting pass=yes to
	a passdb continues to next passdb if the lookup succeeded. This
	allows eg. requiring the user to be in multiple passdbs, or doing a
	username conversion before running the actual userdb, etc.
	[77e10f1d2cb2]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h:
	Allow empty uid/gid fields, they're required if we want to set extra
	fields for passdb. Also removed some unused code.
	[25204e1faeb6]

	* src/lib/ioloop.c:
	Timers weren't called always properly when they should have.
	[99b17f13cc1e]

	* configure.in, src/lib/randgen.c:
	If /dev/urandom didn't exist and we used OpenSSL's random number
	generator, it wasn't seeded properly at startup. Patch by Vilmos
	Nebehaj.
	[321469dcb8fb]

	* src/lib/ioloop-kqueue.c:
	Added more debugging information for handling unexpected events.
	Patch by Vclav Haisman
	[ffbcfa5791e6]

2006-03-07  Timo Sirainen  <timo.sirainen@movial.fi>

	* doc/auth-protocol.txt:
	Fixed outdated information: ssl-valid-cert -> valid-client-cert
	[0c11f0b05e19]

2006-03-06  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added ACL plugin comments and updated quota comments.
	[59883de6c516]

	* src/plugins/acl/acl-backend-vfile.c:
	Global ACL dir is now optional.
	[8d37f7d2ec40]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-idle.c, src/imap/cmd-logout.c, src/pop3/client.c,
	src/pop3/client.h, src/pop3/commands.c:
	Log a line when IMAP client disconnects with a reason why it
	happened. Changed the reason strings also a bit with POP3.
	[904c53275e83]

	* src/imap/cmd-idle.c:
	cleanup
	[2fe0d3ab89c9]

2006-03-06  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h:
	Support accessing saved mails that haven't been committed yet (fixes
	quota for maildir).
	[03e14e3a4610]

	* src/plugins/quota/quota-maildir.c:
	Fixes to updating maildirsize.
	[840d6403ef09]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-transaction.c:
	Merged save-copying and hardlink-copying code so that hardlink-
	copying updates indexes immediately.
	[ae38c59ddf60]

	* src/lib-storage/index/maildir/maildir-util.c:
	If maildir_do() failed with "racing" error, return -1.
	[f4cd3e942678]

	* src/imap/cmd-copy.c:
	mailbox_copy() might fail because mail was expunged. Treat that case
	differently.
	[1a526a5017f4]

	* src/imap/namespace.c:
	Add MAIL_STORAGE_FLAG_SHARED_NAMESPACE for private namespaces.
	[029dd4ab2765]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Cleanup
	[43a03c8a6f01]

	* src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota.c:
	Cleanups.
	[61fc347bcceb]

	* src/plugins/quota/Makefile.am, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-
	maildir.c, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota.c:
	Maildir++ quota support.
	[07c3a801c3dc]

2006-03-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c:
	Added t_push/t_pop
	[cce51b1b5d00]

2006-03-01  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/quota/quota-
	dict.c, src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-
	fs.c, src/plugins/quota/quota-plugin.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota-storage.c,
	src/plugins/quota/quota.c, src/plugins/quota/quota.h,
	src/plugins/trash/trash-plugin.c:
	Quota API redesign. Still not perfect, but better than before. Quota
	backends no longer need to be told where the mails exist. fs backend
	doesn't work correctly with multiple partitions (if you've multiple
	namespaces).
	[51306837698b]

2006-02-28  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-backend.c,
	src/plugins/acl/acl-cache.c, src/plugins/acl/acl-cache.h,
	src/plugins/acl/acl-storage.c:
	Don't keep acl_objects permanently in memory. Moved cache validity
	information into cache records. Some other cleanups and fixes.
	[ed4f01bb4701]

	* configure.in, src/plugins/Makefile.am:
	Added acl.
	[dcee3dadef51]

2006-02-28  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added link to QuickConfiguration.
	[81d56edc16c8]

	* dovecot-example.conf:
	Added notes about changing ports and about /etc/pam.d/dovecot
	[89c94b5ac90e]

	* Makefile.am:
	Removed dovecot.spec*
	[b033db13c2e0]

2006-02-27  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Added "allow_nets" extra field. If set, the user can log in only
	from within the given networks (hope the code is correct...)
	[265655f270df]

	* src/plugins/acl/.cvsignore, src/plugins/acl/Makefile.am,
	src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-cache.h, src/plugins/acl/acl-mailbox.c,
	src/plugins/acl/acl-plugin.c, src/plugins/acl/acl-plugin.h,
	src/plugins/acl/acl-storage.c:
	Added initial support for ACLs. Currently supports reading the ACLs
	from files. Since no proper support for shared folders exist yet,
	this is mostly intended to be used only for preventing users from
	fully accessing the mailboxes they'd otherwise have full access to.
	It anyway does support "master user" having different ACLs to
	mailboxes.
	[73573b9ecb00]

	* src/lib-storage/index/dbox/dbox-list.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.h:
	Moved mailbox_list_flags to struct mailbox_list_context so plugins
	can see the flags more easily.
	[7f48190f868f]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added strcmp_p and bsearch_strcmp.
	[bd7aafc736eb]

2006-02-26  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/password-scheme.c, src/dict/main.c,
	src/imap/main.c, src/lib/module-dir.c, src/lib/module-dir.h,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/main.c:
	Replaced mail_use_modules and mail_modules settings with
	mail_plugins and mail_plugin_dir. Now instead of loading all plugins
	from the directory, you'll have to give a list of plugins to load.
	If the plugin couldn't be loaded, the process exits instead of just
	ignoring the problem (this is important with ACL plugin).
	[dadc6e2cccb8]

	* src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-
	fetch.h, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-keywords.c:
	Memory leak fixes
	[cd701884900c]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-storage
	/subscription-file/subscription-file.c:
	If we reach the NFS_ESTALE_RETRY_COUNT, give an ESTALE error message
	as well.
	[7e6acdd8d18d]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/subscription-file/subscription-
	file.c, src/lib/Makefile.am, src/lib/nfs-workarounds.c, src/lib/nfs-
	workarounds.h, src/lib/safe-open.c, src/lib/safe-open.h:
	Renamed safe-open.* to nfs-workarounds.*, safe_open() to
	nfs_safe_open() and added a new global NFS_ESTALE_RETRY_COUNT which
	everyone uses instead of defining their own.
	[cd3d26cf124a]

	* src/auth/auth-master-connection.c, src/auth/auth-worker-server.c,
	src/auth/db-passwd-file.c, src/deliver/deliver.c, src/dict/dict-
	server.c, src/imap/client.c, src/lib-dict/dict-client.c, src/lib-
	dict/dict-sql.c, src/lib-imap/imap-bodystructure.c, src/lib-imap
	/imap-envelope.c, src/lib-index/mail-cache-compress.c, src/lib-mail
	/message-body-search.c, src/lib-settings/settings.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	sync-expunge.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/mbox-file.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/subscription-file/subscription-file.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/ostream.c, src/lib/ostream.h, src/login-
	common/login-proxy.c, src/login-common/master.c, src/master/auth-
	process.c, src/master/log.c, src/plugins/trash/trash-plugin.c,
	src/pop3/client.c, src/util/rawlog.c:
	Added i_stream_destroy() and o_stream_destroy() and used them
	instead of
	*_stream_unref() where possible. Fixes at least one problem with
	io_remove() being called after socket was closed, which caused
	problems with epoll.
	[71b8faa84ec6]

2006-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-mysql.c:
	If connecting with UNIX socket, print the UNIX socket path instead
	of (null).
	[d6c15318e730]

	* configure.in, dovecot.spec.in:
	Removed dovecot.spec. It's not being kept up-to-date anyway and it's
	probably broken for half the rpm based distributions.
	[1f319d46f0dd]

	* src/lib-index/mail-index.c:
	mail_index_open(): If index is already open, return 1 instead of 0
	so the caller won't think it failed..
	[96ae9c096bde]

	* src/plugins/quota/quota-fs.c:
	Compiler warning fix
	[30ad1815cf1e]

	* configure.in:
	One more Q_QUOTACTL check fix..
	[a3090ba7429c]

	* configure.in:
	And fix for Q_QUOTACTL check..
	[f3e7ee9630d0]

	* configure.in, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	fs.h:
	Support Solaris's ioctl(Q_QUOTACTL).
	[f60237ad2edd]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-search.c:
	Last memory leak fix actually started crashing.
	[788f5caab763]

2006-02-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-keywords.c, src/lib-storage/index/dbox/dbox-sync-expunge.c,
	src/lib-storage/index/dbox/dbox-sync.c:
	Fixes
	[1197d5a84bee]

	* src/plugins/quota/quota-fs.c:
	Added comment
	[4158edcd2bf2]

	* src/plugins/quota/quota-fs.c:
	Define MNTTYPE_SWAP and MNTTYPE_IGNORE ourself if they're not
	defined.
	[7bac8d6bf26d]

	* src/auth/mycrypt.c:
	Fixed AIX compile
	[b1fa11d4a346]

	* configure.in:
	Unbreak last accidental change..
	[f4807accc1d5]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-uidlist.c:
	Fixes
	[caddc57d1f61]

	* configure.in:
	If size_t and ssize_t exist but we can't figure out their type,
	don't redefine them.
	[f7ff79c3189b]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Digest-MD5 logins didn't work if passdb changed username.
	[f83d7d14b999]

	* src/lib-index/mail-index.c:
	If transaction log opening fails, don't crash when trying to move it
	to memory.
	[94b3363165c8]

	* src/lib-index/mail-index-sync.c:
	Crashfix
	[ba8185cce4d4]

	* src/auth/passdb.h:
	And one more comma removal
	[af596f6df432]

	* configure.in, src/plugins/quota/quota-fs.h:
	configure was actually checking always only sys/quota.h. Also added
	jfs/quota.h check for AIX.
	[41cb3921d869]

	* configure.in:
	Don't print error if pkg-config isn't found.
	[2fa6dc0e0e27]

	* src/auth/auth-client-interface.h, src/lib-auth/auth-client.h:
	More comma removals
	[9e2a96d7e9ae]

	* src/lib-ntlm/ntlm-types.h, src/lib-sql/sql-api.h:
	Removed extra commas from end of enum lists.
	[20e742b83a79]

	* src/auth/mech-digest-md5.c:
	If no realms are given in configuration file, advertise an empty
	realm. Also if realms are given and client sends an invalid realm,
	write the realm to log.
	[29afb0f7665f]

2006-02-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-storage/index/index-search.c:
	Memory leak fixes
	[5819e0190400]

2006-02-22  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/imap/cmd-append.c, src/lib-storage/index/dbox/dbox-save.c, src
	/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-copy.c, src
	/lib-storage/mail-storage-private.h, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c, src/plugins/quota/quota.h:
	mailbox_save_init() supports now returning failure. Quota plugin now
	checks if mail is too large in mailbox_save_init() hook. APPEND
	fails before giving "+ OK" reply if mailbox_save_init() failed.

	Also fixed some APPEND failure cases where the next command was
	eaten away.
	[da1d65e064f8]

	* src/lib/module-dir.c:
	Modules were loaded in inverse order..
	[ec4061662609]

	* src/auth/auth-request.c:
	Multiple password database error prints now the passdb name that
	caused it.
	[dabe100f3c38]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/lib-
	storage/index/dbox/dbox-list.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/plugins/convert/convert-storage.c,
	src/plugins/quota/quota-plugin.c, src/plugins/zlib/zlib-plugin.c:
	Make life easier for plugins:
	 - Added MAILBOX_OPEN_SAVEONLY flag for mailbox_open(), which is set
	when mailbox is opened only for append/copy
	 - Added a couple of MAIL_STORAGE_ERR_* string defines that should be
	used when giving visible errors to clients
	 - Added failed-flag for mailbox_list_context, which plugins can
	directly set to make mail_storage_mailbox_list_deinit() return
	failure
	 - Added mail_storage_get_mailbox_path() and
	mail_storage_get_mailbox_control_dir() to return locations for
	mailbox directories

	Also be more strict when validating mailbox names.
	[9d7420b0e1ef]

	* src/auth/auth-worker-client.c:
	Fixed passdb credential lookups to work again with blocking passdbs.
	[c0d093d8b8e5]

2006-02-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop.h:
	Removed extra comma at end of enum list
	[fcd4c3281559]

2006-02-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	Update message_count only after expunge sends are finished or we'll
	get to infinite loop (broken in last commit).
	[6d80874fd704]

	* src/login-common/login-proxy.c:
	and fix for last cleanup..
	[3531cc5270b5]

	* src/login-common/login-proxy.c:
	Minor cleanups
	[bb6a724a3396]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	If passwd-file is being used as userdb, complain immediately if some
	entries don't have userdb information. Also some other cleanups and
	crashfix for today's earlier changes.
	[335ac59efffd]

2006-02-20  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	Updated passwd-file format to allow specifying any key=value fields.
	Since the value fields may contain ':' characters, this changes the
	file format a bit. Previously the last two fields were "flags" and
	"mail". Flags has been empty for last 3 years however, so the new
	format is used if the flags field contains something. In that case
	there is no separate mail field, it can instead be specified by
	adding userdb_mail=<mail> parameter.
	[b533c52196e3]

	* src/auth/auth-request.h:
	Added comment
	[7dbfff239206]

	* src/auth/checkpassword-reply.c, src/auth/passdb-checkpassword.c:
	Allow checkpassword program to send extra parameters to Dovecot.
	EXTRA environment contains a list of environment variables that are
	passed to Dovecot.
	[7140f09b464f]

	* src/auth/passdb-checkpassword.c:
	Pass LOCAL_IP, REMOTE_IP, SERVICE and MASTER_USER in environment to
	checkpassword.
	[357175e274b4]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/auth-worker-client.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/mech-plain.c, src/auth/passdb-blocking.c,
	src/auth/passdb.c, src/auth/passdb.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added support for "master users" who can log in as other people.
	Currently works only with SASL PLAIN authentication by giving it
	authorization ID string.
	[faf83f3e19b5]

2006-02-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c:
	s/Maildir/dbox/
	[9bdd186d7b7d]

	* src/lib-storage/index/dbox/dbox-storage.c:
	Fixed dbox autodetection and removed unused code.
	[513318832fb6]

	* src/lib-imap/imap-bodystructure.c:
	BODYSTRUCTURE -> BODY conversion was broken with mails containing
	message/rfc822 parts.
	[0e7a9b0aa8c3]

2006-02-18  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c:
	Added some locking related asserts, comments and when replacing
	index file, open it immediately into memory (seemed to work before
	too, though).
	[20c335412d7d]

2006-02-17  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-mail.c:
	Fetching BODY/BODYSTRUCTURE with header fields caused Dovecot to
	unneededly open the mails and parse their headers, if everything was
	already in cache.
	[d4c02d132a32]

	* src/imap/cmd-append.c:
	If client disconnected or gave too long APPEND command line, we
	didn't properly deinitialize saving, which could have caused
	partially written mails with mbox, or files left lying in tmp/ with
	maildir.
	[7d7b0f427d68]

2006-02-16  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-index.c, src/lib-index/mail-transaction-
	log.c, src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage
	/subscription-file/subscription-file.c, src/lib/Makefile.am, src/lib
	/file-cache.c, src/lib/safe-open.c, src/lib/safe-open.h:
	Try to handle ESTALE NFS errors the best way we can.
	[b19ccbaa3802]

2006-02-16  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Removed -Wstrict-aliasing=2 since it gives errors with older gccs
	[2f26567685ff]

2006-02-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Allow creating mailbox names with '*' and '%' characters. They don't
	break anything anyway.
	[d7d87f1de71d]

2006-02-14  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-ntlm.c, src/auth/mech-rpa.c, src/imap/imap-sort.c, src
	/lib-index/mail-cache-fields.c, src/lib-index/mail-index-sync-
	update.c, src/lib-ntlm/ntlm-byteorder.h, src/lib-ntlm/ntlm-
	message.c, src/lib-storage/index/dbox/dbox-file.c, src/lib/buffer.c,
	src/lib/module-dir.c, src/lib/write-full.c:
	While casting const pointers to something else, the const was often
	unneededly dropped out in the middle of casts.
	[fcfd44f56b04]

	* src/imap-login/client.h, src/lib-index/mail-index-private.h,
	src/pop3-login/client.h:
	Removed duplicated function declarations.
	[19dad76ef68d]

	* configure.in, src/lib/fd-close-on-exec.c, src/lib/network.c:
	Enable -Wstrict-aliasing=2 warning and fixed a couple of warnings it
	gave.
	[989dd95aa8b9]

	* src/auth/auth-request.c, src/auth/auth-stream.c, src/auth/passdb-
	ldap.c, src/auth/passdb-sql.c, src/auth/userdb-ldap.c, src/auth
	/userdb-sql.c, src/auth/userdb-static.c, src/master/mail-process.c:
	Check that we don't pass around key=value pairs with empty keys.
	[e2d267e6f930]

	* src/lib/env-util.c:
	Out of memory may not be the only reason putenv() fails. In OSX it
	seems to fail if "=value" is given.
	[0d3dd32999a0]

	* src/imap/main.c:
	PREAUTH banner should show the capability from capability_string in
	case some plugins had changed that already.
	[4aeb58dc4f18]

	* src/plugins/convert/Makefile.am:
	Fixed installing
	[f406248b1b9f]

	* configure.in:
	Added --with-sql option to build with SQL userdb/passdb but without
	any built-in SQL drivers.
	[bf0357107349]

2006-02-14  Timo Sirainen  <timo.sirainen@movial.fi>

	* configure.in:
	Building with SQL support replaced passdb list with userdbs.
	[d8c1e641b435]

	* src/lib/Makefile.am, src/lib/close-keep-errno.c, src/lib/close-keep-
	errno.h, src/lib/network.c, src/lib/unlink-directory.c:
	Moved dupliated close_save_errno() code to public close_keep_errno()
	function.
	[323c09be5f00]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-lock.c,
	src/master/master-settings.c:
	Updated mbox_dotlock_change_timeout default value to 120. Also the
	mbox default timeout values were wrong when not starting Dovecot via
	master process.
	[6519f3c7bd63]

	* src/imap/mail-storage-callbacks.c:
	Flush the output while writing the "will override lock file"
	messages, so that the output will actually be sent instead of just
	left in buffer.
	[fbff841d532a]

2006-02-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	Don't notify client about changes in messages it hasn't yet even
	been notified about.
	[4e1a816a82a1]

2006-02-12  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap.conf:
	Added uris setting.
	[97a328354a13]

	* src/auth/db-ldap.c:
	Check that uris and hosts settings are correct.
	[0e8f0647504b]

	* configure.in:
	Give error if --with-storages or --without-storages is used without
	parameters. Assume --with-sql-drivers means all drivers are wanted.
	[450ee12c2e26]

	* src/auth/mech-gssapi.c:
	Crashfix. Patch by Mark Davies
	[10d1c3301b87]

2006-02-11  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	When using --exec-mail, don't care if protocols line is empty.
	[de08c05c75cb]

2006-02-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/Makefile.am:
	Still wasn't working with Solaris shell. Fix by Chris Wakelin
	[5ca67bbe93fd]

	* src/lib/ioloop-epoll.c:
	Fix by Jakob Hirsch
	[ebda90c2b911]

2006-02-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/Makefile.am:
	Some shells don't like empty for loops
	[421d844e884d]

	* src/lib-index/mail-cache-fields.c:
	Don't register cache fields twice. Fixes "duplicate field in header"
	errors.
	[f1e29736e60d]

	* src/lib-index/mail-index-sync.c:
	Ignore if cache compression fails.
	[9d1bb677c5ca]

	* configure.in, src/plugins/Makefile.am,
	src/plugins/convert/Makefile.am:
	Build fixes
	[e7df415a97f1]

	* NEWS:
	Updated
	[cbca2fc5ca97]

	* TODO, configure.in:
	1.0beta3 released.
	[becee8ae64a6]

2006-02-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	Call io_remove() earlier.
	[198ad9bf81d2]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	Advertise the QUOTA capability if the plugin is loaded.
	[12ff7067ce62]

	* src/master/ssl-init-main.c:
	Fix building without ssl support
	[04958ae9a2e3]

	* src/lib/module-dir.c:
	Fix to comparing plugin names which begin with "lib".
	[0c26c7f25b9c]

	* src/lib-dict/dict-client.c:
	LF wasn't sent at the end of all commands.
	[e2e6919c6c4d]

2006-02-05  Timo Sirainen  <tss@iki.fi>

	* src/master/.cvsignore, src/master/Makefile.am, src/master/common.h,
	src/master/main.c, src/master/ssl-init-main.c, src/master/ssl-
	init.c, src/master/ssl-init.h:
	Added ssl-build-param binary to build the ssl-parameters.dat. This
	way dovecot master binary doesn't anymore need to be linked with SSL
	libraries, and the process title is also clearer.
	[e93e39326ae1]

	* src/lib/module-dir.c, src/lib/module-dir.h:
	Added module_dir_deinit().
	[ab1a0a377851]

	* src/lib/ioloop.c:
	Don't crash if we couldn't add I/O notifier.
	[9099825aac9a]

	* src/pop3-login/client-authenticate.c:
	cleanup
	[dd389a881380]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Dotlock fixes
	[38c352bb7bb7]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Limit maximum mailbox name length while creating them.
	[882ec6cc5970]

	* src/plugins/convert/convert-storage.c:
	Call file_dotlock_touch() once in a while so other process won't
	override the conversion lock.
	[565e3040a9f5]

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	Added file_dotlock_touch() for updating lock file's timestamp.
	[15c48c43cc75]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache.c, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/dbox/dbox-
	sync.c, src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/subscription-file
	/subscription-file.c, src/lib/file-dotlock.c, src/lib/file-
	dotlock.h, src/plugins/convert/convert-storage.c:
	Removed immediate_stale_timeout and changed the stale_timeout
	behavior to check both dotlock and the file it protects, and
	overwrite the lock file whenever neither of them have been modified
	for stale_timeout seconds (ie. also immediately if their timestamps
	are old enough).
	[0d64f8888dcd]

	* src/lib-storage/index/dbox/dbox-file.c:
	Don't break if keyword_count is for some reason 0 in dbox file.
	[90638cc0d4e4]

	* src/lib-storage/index/index-sync.c:
	Keyword comparing still didn't work perfectly when there were no
	keywords. This caused some extra unnecessary keyword changes.
	[f209b3fc77e4]

	* src/auth/passdb-pam.c:
	If error message from PAM was over ~500 bytes, we crashed. Probably
	never happened. Also use PIPE_BUF instead of hardcoded 512 bytes.
	[6f21ccb60df4]

	* src/imap/imap-sort.c:
	Minor cleanup / comment update
	[dcd4e8ccd639]

2006-02-02  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated plugin section
	[7272c083dca8]

	* dovecot-example.conf, src/master/dict-process.c, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added plugin {} section to dovecot.conf for passing extra
	environment variables to mail processes.
	[9de8bce1077e]

	* src/plugins/convert/Makefile.am:
	Forgot to add
	[10db5f23d3f0]

	* src/plugins/convert/convert-storage.c:
	And a few fixes
	[fec2e36ddb3b]

	* configure.in, src/plugins/convert/.cvsignore, src/plugins/convert
	/convert-plugin.c, src/plugins/convert/convert-plugin.h,
	src/plugins/convert/convert-storage.c, src/plugins/convert/convert-
	storage.h, src/plugins/convert/convert-tool.c:
	Added "mail storage conversion" plugin. It can be used with IMAP,
	POP3 and/or LDA to convert one complete mail storage to another
	format. Also included a convert-tool command line tool to do it
	manually. Currently doesn't support preserving UID/UIDVALIDITY.
	[a506ee4ec31e]

	* src/imap/namespace.c, src/lib-storage/mail-storage.c, src/lib-
	storage/mail-storage.h, src/pop3/main.c:
	Moved mailbox flag and lock method parsing to lib-storage.
	[539a58176e7b]

	* src/imap/cmd-search.c, src/imap/imap-expunge.c, src/pop3/client.c:
	Don't bother checking if mailbox_search_init() returns NULL. It
	never does.
	[23e76fc59a35]

	* configure.in, src/plugins/Makefile.am:
	If zlib.h isn't found, don't try to build the zlib plugin.
	[884da753caba]

2006-01-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c:
	Write keywords when appending mails.
	[93449dc37434]

	* src/dict/Makefile.am, src/dict/dict-cache.c, src/dict/dict-cache.h,
	src/dict/dict-server.c, src/dict/main.c, src/lib-dict/dict-client.c,
	src/lib-dict/dict-private.h, src/lib-dict/dict-sql.c, src/lib-
	dict/dict.c, src/lib-dict/dict.h, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota.c:
	Dictionary takes now a username parameter, which is used for private
	queries. Made dict-sql use "insert .. on duplicate key update"
	syntax, which unfortunately doesn't work with PostgreSQL yet.
	[6fabe878c46d]

	* src/master/main.c:
	Added missing "dict" to process names
	[19dcfd289610]

	* src/lib-sql/driver-pgsql.c:
	Make sure queued queries and timeout get freed when deinitializing.
	Send the first query immediately after connected to pgsql instead of
	waiting for 5 seconds.
	[5b2640d48aa2]

2006-01-29  Timo Sirainen  <tss@iki.fi>

	* src/plugins/zlib/Makefile.am:
	Link with zlib.
	[7dc2460ff0b7]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/imap-sync.c:
	And the final fix for APPEND hangs ;)
	[ccab957a03b3]

	* src/imap/cmd-append.c, src/imap/imap-sync.c:
	And one more fix for append hang..
	[9f607c5685fd]

	* src/lib/ioloop-poll.c:
	If DEBUG is enabled, make sure the fd is still open when removing
	the I/O handler.
	[3a2d31358d55]

	* src/auth/auth-master-connection.c, src/auth/auth-master-listener.c,
	src/auth/auth-worker-server.c, src/auth/passdb-checkpassword.c,
	src/deliver/deliver.c, src/dict/dict-server.c, src/imap/client.c,
	src/imap/client.h, src/lib/ostream-file.c, src/login-common/main.c,
	src/login-common/master.c, src/login-common/ssl-proxy-gnutls.c, src
	/login-common/ssl-proxy-openssl.c, src/master/auth-process.c,
	src/master/dict-process.c, src/pop3/client.c, src/pop3/client.h:
	Call io_remove() before closing the fd. It's required by kqueue.
	[aeb424e64f24]

	* src/lib/ioloop-internal.h, src/lib/ioloop-notify-dn.c, src/lib
	/ioloop-notify-inotify.c, src/lib/ioloop-notify-kqueue.c,
	src/lib/ioloop.c:
	Cleanups: Make io_remove() do the linked list updating also for
	notify handlers. Removed notify_context from struct io, and moved it
	to a new struct inotify_io.
	[ef5595d6ddec]

	* src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c,
	src/lib/ioloop.c:
	kqueue updates. Patch by Vaclav Haisman
	[3e9b43d0cd80]

	* src/lib-storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox
	/dbox-transaction.c, src/lib-storage/index/dbox/dbox-uidlist.c, src
	/lib-storage/index/dbox/dbox-uidlist.h:
	When appending, update sync_stamp in index so that dbox won't get a
	full resync.
	[8f0ff62befd3]

	* src/lib-storage/index/dbox/Makefile.am, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/dbox/dbox-file.h, src/lib-
	storage/index/dbox/dbox-keywords.c, src/lib-storage/index/dbox/dbox-
	keywords.h, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox/dbox-
	sync-full.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Support storing keywords in dbox files. Doesn't yet work while
	saving.
	[a52c36c51ff2]

2006-01-28  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/imap-login/client.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	If client disconnected while we were trying to send authentication
	continuation to it, we crashed.
	[295af5c1cce6]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Added asserts
	[99ed24b66363]

	* src/lib-index/mail-cache-transaction.c:
	Changed reservations buffer to array.
	[d9a7ad93ddde]

	* src/auth/auth-request-handler.c:
	If authentication client disconnects while it still has pending
	requests, don't crash (got broken in the large pointer-change
	commit).
	[d7a0354861b8]

	* dovecot-example.conf:
	Removed "1.0" version number.
	[f504dbc84d38]

	* src/lib-sql/Makefile.am:
	"make dist" didn't include sources.
	[374ff0d56803]

	* src/imap/cmd-append.c:
	Last APPEND-fix left connection always stuck afterwards.
	[4b6f9e5f7f09]

2006-01-27  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Make --without-sql-drivers work properly
	[795cc9739eb3]

	* src/lib-sql/driver-sqlite.c:
	Cleanups.
	[5b21fb41d14d]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-sqlite.c:
	Fixed memory leaks
	[d7051c7a0200]

	* INSTALL:
	Add directories where they need to be compiled.
	[a5c559c847cc]

	* configure.in:
	Handle --without-sql-drivers
	[e7aff159a0d3]

	* INSTALL, configure.in, src/auth/main.c, src/lib-dict/dict-sql.c, src
	/lib-sql/.cvsignore, src/lib-sql/Makefile.am, src/lib-sql/driver-
	mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql/driver-sqlite.c,
	src/lib-sql/sql-api-private.h, src/lib-sql/sql-api.c, src/lib-sql
	/sql-api.h:
	Added support for dynamically building SQL drivers.
	[cbe5c6772e0d]

2006-01-26  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	If there had been enough sync changes while APPEND was being done,
	we never reset flush callback to _client_output, which could have
	caused hangs later.
	[a490e6657329]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Boolean changes broke istream_raw_mbox_is_valid_from() when it hit
	unexpected EOF. So broken Content-Length headers at the end of files
	gave "file size unexpectedly shrinked in mbox" errors.
	[08a302d3e525]

	* src/master/ssl-init.c:
	Ignore gid of ssl-parameters.dat. It may not be what we expect, and
	since we create it world-readable, it doesn't really matter anyway.
	[1357dd2c5b02]

2006-01-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	Allow parameters to be passed to checkpassword.
	[8ccd711c93db]

	* src/auth/passdb-checkpassword.c:
	Don't crash if unknown child exits.
	[f55438f449ba]

2006-01-24  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init.c:
	Fix building without OpenSSL.
	[5f86377d3683]

2006-01-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-sqlite.c:
	Compiler warning fix. Patch by Marcus Rueckert
	[8e827b05047b]

2006-01-22  Timo Sirainen  <tss@iki.fi>

	* doc/securecoding.txt:
	Added something about setting freed pointers to NULL.
	[51406aaccb46]

	* NEWS, configure.in:
	1.0.beta2 released
	[863a3fcac7b2]

	* src/master/ssl-init.c:
	Fix for SSL parameters getting regenerated constantly
	[aebf37667655]

	* configure.in, src/lib/compat.h:
	Include sys/mkdev.h with UnixWare for major() and minor()
	[b079a386a2f7]

	* configure.in:
	And fix for uoff_t checks..
	[d37797a229c3]

	* src/auth/passdb-cache.h, src/lib-imap/imap-util.h:
	Removed unneeded enum declarations.
	[64269f05bf38]

	* configure.in, src/lib/compat.h:
	If uoff_t type already exists, use it (UnixWare has it).
	[49a1a979959e]

	* src/lib-auth/auth-client.c:
	UnixWare creates sockets as fifos. Allow that..
	[0c863c21025c]

	* src/lib-auth/auth-client.c:
	If we don't have any auth sockets, don't say we're connected to it.
	[b7da6fac35a3]

	* src/auth/userdb-vpopmail.c:
	Compile fix
	[c8f7e92f77da]

	* README:
	Removed code section and did some updates.
	[19c42027b621]

	* src/lib-index/mail-index-lock.c:
	Don't break with INDEX=MEMORY and lock_method=dotlock
	[8297377a569b]

	* src/lib-sql/driver-sqlite.c:
	Forgot to add in sqlite patch.
	[e9d45ec624cb]

	* src/auth/auth-client-connection.c:
	Removed assert, since it may happen and crash dovecot-auth.
	[344e4a729318]

	* src/master/master-settings.c:
	Fix for 0777 check
	[51cd47679f05]

	* src/master/master-settings.c:
	Make base_dir world-readable, not world-writable.
	[382f0aafc2bf]

	* configure.in, doc/dovecot-sql.conf, src/lib-sql/Makefile.am, src
	/lib-sql/sql-api-private.h, src/lib-sql/sql-api.c,
	src/master/main.c:
	SQLite support. Patch by Jakob Hirsch.
	[b967ffb7e3a6]

	* dovecot-example.conf, src/auth/auth-client-connection.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/auth.c,
	src/auth/auth.h, src/auth/passdb-cache.c, src/auth/passdb-ldap.c,
	src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c, src/auth
	/passdb-vpopmail.c, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_debug_passwords setting. If it's not enabled, hide all
	password strings from logs.
	[40a461d554e6]

	* src/master/main.c, src/master/ssl-init.c, src/master/ssl-init.h:
	Added --build-ssl-parameters option to build them.
	[ae292bd41926]

	* src/auth/passdb-pam.c:
	Removed #ifdef PAM_RHOST, it should be everywhere
	[3c10e68ceb7c]

	* src/auth/userdb-vpopmail.c:
	Domain part was dropped from usernames.
	[6860c4654b03]

2006-01-19  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	ssl_parameters_regenerate is int, not str.
	[84f90b0c66b1]

	* src/auth/db-ldap.c, src/auth/db-sql.c:
	Settings' default listing wasn't ended properly, which could have
	caused dovecot-auth to crash at startup (depending on used
	compiler).
	[af15aab60ff1]

	* dovecot-example.conf, src/lib-index/mail-index.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added mbox_min_index_size setting.
	[fc0b638330a4]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h:
	Fixed mail_index_move_to_memory() to work better and made it public
	[3a2fe49912f3]

	* src/lib-index/mail-index-lock.c:
	Don't try to write to index file if it's in memory.
	[3b0f9be42126]

	* dovecot-example.conf, src/lib-storage/index/index-mail-headers.c,
	src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-storage.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/maildir/maildir-mail.c, src
	/lib-storage/index/mbox/mbox-mail.c, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added mail_cache_min_mail_count setting.
	[411f20e72a8f]

2006-01-18  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c, src/auth/db-sql.c:
	Give a clear error message if SQL/LDAP configuration file path was
	left empty.
	[afe21b6d4b68]

2006-01-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Error handling / compiler warning fix
	[fc69c8b9439a]

	* src/lib/hash.c, src/lib/hash.h:
	size_t -> unsigned int. It's enough.
	[51db9cedc120]

	* src/lib/ioloop-notify-inotify.c:
	Changed linux/inotify* includes to sys/inotify.h (I thought I had
	done this already).
	[b694c27ad1a8]

2006-01-16  Timo Sirainen  <tss@iki.fi>

	* TODO, configure.in:
	1.0 beta1 released
	[9f8d69605d4b]

	* src/master/ssl-init.c:
	Added a note about SSL parameter regeneration finishing.
	[b284f9e5c4f7]

	* dovecot-example.conf:
	Removed ssl_parameters_file setting.
	[0e47f412e3aa]

2006-01-15  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c, src/master/main.c, src/master/master-
	settings.c, src/master/master-settings.h, src/master/ssl-init.c,
	src/master/ssl-init.h:
	Put ssl-parameters file into login directory so it still can be
	accessed even if login process is chrooted.
	[0ae5f5b468b7]

	* src/master/master-settings.c:
	Fix base_dir permissions if it exists
	[7ee2fc733bf6]

	* src/master/master-settings.h:
	mail_max_keyword_length is integer, not boolean.
	[bc5b6b89a76b]

	* src/master/ssl-init.c:
	Add a note about DH parameters being generated for the first time.
	[3bbd7ba3315e]

	* src/master/main.c:
	When starting with --exec-mail, keep USER and HOME environments and
	clear the rest.
	[9dc2f8f0eb59]

	* src/master/mail-process.c:
	Don't crash if username is NULL (shouldn't happen though)
	[7aea43511bac]

	* src/imap/cmd-idle.c:
	IDLE: Handle disconnection differently (and maybe we won't crash
	anymore)
	[5c047d58a67d]

	* src/master/ssl-init.c:
	If ssl_parameters_regenerate=0, don't regenerate it if it's
	otherwise ok.
	[f777ef3a79ca]

	* src/master/ssl-init.c:
	If SSL parameters file is empty, unlink it
	[1a036356a752]

	* src/master/dict-process.c:
	Disable dict server for now
	[1e37fad03602]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	If debug is enabled, tell how many users are found from passwd-file
	whenever it's read.
	[2d0859490a2f]

	* src/master/askpass.c, src/master/askpass.h:
	Forgot to add in last commit
	[6658a000051d]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/Makefile.am, src/master/common.h, src/master/login-
	process.c, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Added support for password protected SSL private keys. The password
	can be given in dovecot.conf, or when dovecot is started with -p
	parameter.
	[c7462001227b]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/master-settings.c, src/master/ssl-init-openssl.c,
	src/master/ssl-init.c:
	Generate DH parameters and use them. Changed default regeneration
	time to 1 week.
	[650701d41cdf]

	* dovecot-example.conf:
	Added a note about auth_debug also storing users' passwords in logs.
	[f95146a34af9]

	* configure.in:
	Include sys/inotify.h instead of linux/inotify.h. Patch by Marcus
	Rueckert
	[598be05460f5]

	* src/master/dict-process.c:
	Create dict-server socket to base_dir.
	[b624b687fe13]

	* src/util/gdbhelper.c:
	Create the gdbhelper log file only after process has died.
	[c3dc9cedce78]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c:
	Added some checks and better logging for figuring out why (*seq !=
	0) assert happens.
	[434d74a67a81]

	* src/lib/ioloop-notify-inotify.c:
	Fixed
	[2602b791b6c3]

2006-01-14  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Default SSL is OpenSSL, not GNUTLS.
	[ea56e9296b5b]

	* src/lib-index/mail-index-sync.c:
	Error handling fix
	[d194896d58e6]

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/auth-client-
	connection.c, src/auth/auth-client-connection.h, src/auth/auth-
	master-connection.c, src/auth/auth-master-connection.h, src/auth
	/auth-master-listener.c, src/auth/auth-master-listener.h, src/auth
	/auth-module.c, src/auth/auth-module.h, src/auth/auth-request-
	handler.c, src/auth/auth-request-handler.h, src/auth/auth-request.c,
	src/auth/auth-request.h, src/auth/auth-worker-client.c, src/auth
	/auth-worker-client.h, src/auth/auth-worker-server.c,
	src/auth/auth.c, src/auth/auth.h, src/auth/db-ldap.c, src/auth/db-
	ldap.h, src/auth/db-passwd-file.c, src/auth/db-passwd-file.h,
	src/auth/db-sql.c, src/auth/db-sql.h, src/auth/main.c, src/auth
	/mech-gssapi.c, src/auth/passdb-cache.c, src/auth/passdb-
	checkpassword.c, src/auth/passdb-ldap.c, src/auth/passdb-pam.c,
	src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c,
	src/auth/passdb.c, src/auth/password-scheme.c, src/auth/userdb-
	ldap.c, src/auth/userdb-passwd-file.c, src/auth/userdb-sql.c,
	src/auth/userdb.c, src/dict/dict-cache.c, src/dict/dict-server.c,
	src/dict/main.c, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/imap-login/imap-proxy.c, src/imap/client.c,
	src/imap/cmd-append.c, src/imap/cmd-close.c, src/imap/cmd-copy.c,
	src/imap/cmd-delete.c, src/imap/cmd-idle.c, src/imap/cmd-list.c,
	src/imap/cmd-logout.c, src/imap/cmd-search.c, src/imap/cmd-select.c,
	src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-
	unselect.c, src/imap/imap-expunge.c, src/imap/imap-fetch-body.c,
	src/imap/imap-fetch.c, src/imap/imap-sort.c, src/imap/imap-sync.c,
	src/imap/imap-thread.c, src/imap/main.c, src/imap/namespace.c, src
	/lib-auth/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-connection.c, src/lib-auth/auth-server-connection.h,
	src/lib-auth/auth-server-request.c, src/lib-charset/charset-iconv.c,
	src/lib-charset/charset-utf8.c, src/lib-charset/charset-utf8.h, src
	/lib-dict/dict-client.c, src/lib-dict/dict-sql.c, src/lib-
	dict/dict.c, src/lib-dict/dict.h, src/lib-imap/imap-base-subject.c,
	src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-match.c, src/lib-imap/imap-match.h, src/lib-imap
	/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-index/mail-
	cache-compress.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index-sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index
	/mail-index-transaction-private.h, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mail-index-view-sync.c, src/lib-index/mail-index-view.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-index
	/mail-transaction-log-view.c, src/lib-index/mail-transaction-log.c,
	src/lib-index/mail-transaction-log.h, src/lib-mail/istream-header-
	filter.c, src/lib-mail/message-body-search.c, src/lib-mail/message-
	header-search.c, src/lib-mail/message-header-search.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	settings/settings.c, src/lib-sql/driver-mysql.c, src/lib-sql/driver-
	pgsql.c, src/lib-sql/sql-api.c, src/lib-sql/sql-api.h, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	list.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mailbox-check.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-keywords.c, src
	/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/istream-raw-mbox.c,
	src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/mail-copy.c, src/lib-storage/mail-
	storage.c, src/lib-storage/mail-storage.h, src/lib-storage/mail.c,
	src/lib-storage/subscription-file/subscription-file.c,
	src/lib/buffer.c, src/lib/buffer.h, src/lib/file-cache.c, src/lib
	/file-cache.h, src/lib/hash.c, src/lib/hash.h, src/lib/ioloop-
	notify-dn.c, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/istream-
	limit.c, src/lib/istream-seekable.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/lib-signals.c, src/lib/module-dir.c,
	src/lib/module-dir.h, src/lib/ostream-crlf.c, src/lib/ostream-
	file.c, src/lib/ostream.c, src/lib/ostream.h, src/lib/str.c,
	src/lib/str.h, src/login-common/login-proxy.c, src/login-
	common/main.c, src/login-common/master.c, src/login-common/ssl-
	proxy-openssl.c, src/master/auth-process.c, src/master/dict-
	process.c, src/master/log.c, src/master/login-process.c,
	src/master/main.c, src/master/ssl-init.c, src/plugins/imap-quota
	/imap-quota-plugin.c, src/plugins/quota/quota-storage.c,
	src/plugins/trash/trash-plugin.c, src/plugins/zlib/zlib-plugin.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/pop3-proxy.c, src/pop3/client.c, src/pop3/commands.c,
	src/pop3/main.c, src/util/rawlog.c:
	deinit, unref, destroy, close, free, etc. functions now take a
	pointer to their data pointer, and set it to NULL. This makes
	double-frees less likely to cause security holes.
	[928229f8b3e6]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool-unsafe-datastack.c,
	src/lib/mempool.h:
	pool_unref(): set the pool pointer to NULL, so if we're trying to
	unref it twice we'll do a clean crash.
	[bf0a03691989]

	* src/imap/imap-thread.c:
	THREAD crashed if no search matches were found.
	[0d0fad3fb5e9]

	* src/imap/cmd-list.c, src/imap/namespace.c, src/imap/namespace.h:
	Fixes to returning namespace root with "" mask.
	[a291d41bc50d]

	* src/imap/cmd-list.c:
	Cleaned up and added comments. Also added some kludging so that
	listing namespace prefix itself with and without trailing separator
	works.
	[e5abc07d843f]

	* src/lib-imap/imap-quote.h:
	Fixed macro to put parameter in ()
	[a8fef45677ba]

	* src/lib-storage/index/index-search.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/plugins/quota/quota-storage.c:
	Compiler warning fixes and one real fix for int -> bool changes.
	[31d8f49b1a34]

	* doc/securecoding.txt:
	Small updates: Added note about array API and updates to data stack.
	[b054cd10ceaa]

	* src/imap/client.c, src/imap/client.h:
	Don't crash if closing with signal while IDLEing.
	[2506e4077e7a]

	* src/dict/Makefile.am:
	Compile fix
	[099ea3b43ee2]

	* src/lib-dict/Makefile.am, src/lib-dict/dict-client.h, src/master
	/dict-process.c:
	Don't use hardcoded /var/run/dovecot in dict-server path, but
	PKG_RUNDIR/dict-server.
	[0fc7e4bdcaaf]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Use longer line wrapping with X-IMAP, X-IMAPbase and X-Keywords
	headers since UW-IMAP doesn't like the wrapping.
	[398c3890a632]

	* src/Makefile.am:
	automake warning fixed
	[9696b88ae610]

	* src/imap/client.c:
	Added assert
	[c1bf2b79eb7f]

	* src/util/gdbhelper.c:
	Use "bt full" for printing backtrace.
	[749d42902341]

	* dovecot-example.conf, src/util/Makefile.am, src/util/gdbhelper.c:
	Added gdbhelper binary.
	[6124ca416a6c]

2006-01-13  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth
	/auth-client-connection.c, src/auth/auth-master-connection.c,
	src/auth/auth-master-listener.c, src/auth/auth-master-listener.h,
	src/auth/auth-request-handler.c, src/auth/auth-request-handler.h,
	src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/auth.c, src/auth/auth.h,
	src/auth/common.h, src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth
	/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth/main.c,
	src/auth/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-ntlm.c, src/auth/mech-rpa.c, src/auth
	/passdb-bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-cache.h,
	src/auth/passdb-pam.c, src/auth/passdb-passwd.c, src/auth/passdb-
	shadow.c, src/auth/passdb.h, src/auth/password-scheme.c, src/auth
	/password-scheme.h, src/auth/userdb-ldap.c, src/auth/userdb-
	prefetch.c, src/auth/userdb.h, src/imap-login/client-authenticate.c,
	src/imap-login/client-authenticate.h, src/imap-login/client.c, src
	/imap-login/client.h, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-append.c, src/imap/cmd-authenticate.c, src/imap/cmd-
	capability.c, src/imap/cmd-check.c, src/imap/cmd-close.c, src/imap
	/cmd-copy.c, src/imap/cmd-create.c, src/imap/cmd-delete.c, src/imap
	/cmd-examine.c, src/imap/cmd-expunge.c, src/imap/cmd-fetch.c,
	src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap/cmd-login.c,
	src/imap/cmd-logout.c, src/imap/cmd-lsub.c, src/imap/cmd-
	namespace.c, src/imap/cmd-noop.c, src/imap/cmd-rename.c, src/imap
	/cmd-search.c, src/imap/cmd-select.c, src/imap/cmd-sort.c, src/imap
	/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-subscribe.c,
	src/imap/cmd-thread.c, src/imap/cmd-uid.c, src/imap/cmd-unselect.c,
	src/imap/cmd-unsubscribe.c, src/imap/commands-util.c, src/imap
	/commands-util.h, src/imap/commands.c, src/imap/commands.h, src/imap
	/imap-expunge.c, src/imap/imap-expunge.h, src/imap/imap-fetch-
	body.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/imap-
	search.c, src/imap/imap-search.h, src/imap/imap-sort.c, src/imap
	/imap-sync.c, src/imap/imap-sync.h, src/imap/imap-thread.c,
	src/imap/namespace.c, src/lib-auth/auth-client.c, src/lib-auth/auth-
	client.h, src/lib-auth/auth-server-connection.c, src/lib-auth/auth-
	server-connection.h, src/lib-auth/auth-server-request.c, src/lib-
	auth/auth-server-request.h, src/lib-charset/charset-iconv.c, src
	/lib-charset/charset-utf8.c, src/lib-charset/charset-utf8.h, src
	/lib-dict/dict-client.c, src/lib-dict/dict-private.h, src/lib-dict
	/dict-sql.c, src/lib-dict/dict.c, src/lib-dict/dict.h, src/lib-imap
	/imap-base-subject.c, src/lib-imap/imap-base-subject.h, src/lib-imap
	/imap-bodystructure.c, src/lib-imap/imap-bodystructure.h, src/lib-
	imap/imap-date.c, src/lib-imap/imap-date.h, src/lib-imap/imap-
	envelope.c, src/lib-imap/imap-envelope.h, src/lib-imap/imap-match.c,
	src/lib-imap/imap-match.h, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-parser.h, src/lib-imap/imap-quote.c, src/lib-imap/imap-
	quote.h, src/lib-index/mail-cache-compress.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-transaction.c, src/lib-
	index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-index/mail-
	index-fsck.c, src/lib-index/mail-index-lock.c, src/lib-index/mail-
	index-private.h, src/lib-index/mail-index-sync-ext.c, src/lib-index
	/mail-index-sync-private.h, src/lib-index/mail-index-sync-update.c,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index-view-private.h, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h, src/lib-index/mail-transaction-log-
	append.c, src/lib-index/mail-transaction-log-private.h, src/lib-
	index/mail-transaction-log-view.c, src/lib-index/mail-transaction-
	log.c, src/lib-index/mail-transaction-log.h, src/lib-mail/istream-
	header-filter.c, src/lib-mail/istream-header-filter.h, src/lib-mail
	/message-address.c, src/lib-mail/message-body-search.c, src/lib-mail
	/message-body-search.h, src/lib-mail/message-content-parser.c, src
	/lib-mail/message-content-parser.h, src/lib-mail/message-date.c, src
	/lib-mail/message-date.h, src/lib-mail/message-header-decode.c, src
	/lib-mail/message-header-decode.h, src/lib-mail/message-header-
	search.c, src/lib-mail/message-header-search.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-part-serialize.c, src/lib-mail/message-send.c, src/lib-mail
	/message-send.h, src/lib-mail/message-size.c, src/lib-mail/message-
	size.h, src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm/ntlm-message.c,
	src/lib-ntlm/ntlm-message.h, src/lib-ntlm/ntlm.h, src/lib-
	settings/settings.c, src/lib-settings/settings.h, src/lib-sql
	/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-
	storage/index/dbox/dbox-list.c, src/lib-storage/index/dbox/dbox-
	mail.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mailbox-check.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-file.h, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox/mbox-
	lock.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-md5.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c, src
	/lib-storage/mail-search.c, src/lib-storage/mail-search.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/mailbox-tree.c, src
	/lib-storage/mailbox-tree.h, src/lib-storage/subscription-file
	/subscription-file.c, src/lib-storage/subscription-file
	/subscription-file.h, src/lib/array.h, src/lib/buffer.c,
	src/lib/buffer.h, src/lib/compat.h, src/lib/data-stack.c, src/lib
	/data-stack.h, src/lib/fd-close-on-exec.c, src/lib/fd-close-on-
	exec.h, src/lib/fd-set-nonblock.c, src/lib/fd-set-nonblock.h,
	src/lib/file-dotlock.c, src/lib/file-dotlock.h, src/lib/hash.c,
	src/lib/hash.h, src/lib/hex-binary.c, src/lib/ioloop-epoll.c,
	src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c, src/lib
	/ioloop-poll.c, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/istream-
	data.c, src/lib/istream-file.c, src/lib/istream-internal.h, src/lib
	/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream-
	seekable.c, src/lib/istream.c, src/lib/istream.h, src/lib/lib-
	signals.c, src/lib/lib-signals.h, src/lib/mempool-alloconly.c,
	src/lib/module-dir.c, src/lib/module-dir.h, src/lib/network.c,
	src/lib/network.h, src/lib/ostream-crlf.c, src/lib/ostream-file.c,
	src/lib/ostream-internal.h, src/lib/ostream.c, src/lib/ostream.h,
	src/lib/printf-upper-bound.c, src/lib/restrict-access.c, src/lib
	/restrict-access.h, src/lib/restrict-process-size.h, src/lib/seq-
	range-array.c, src/lib/seq-range-array.h, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/lib/unlink-directory.c, src/lib/unlink-
	directory.h, src/lib/var-expand.c, src/login-common/client-common.c,
	src/login-common/client-common.h, src/login-common/common.h, src
	/login-common/main.c, src/login-common/master.c, src/login-
	common/master.h, src/login-common/sasl-server.c, src/login-common
	/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-openssl.c, src
	/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h, src/master
	/auth-process.c, src/master/common.h, src/master/log.c, src/master
	/login-process.c, src/master/mail-process.c, src/master/mail-
	process.h, src/master/main.c, src/master/master-login-interface.h,
	src/master/master-settings.c, src/master/master-settings.h,
	src/master/ssl-init.c, src/master/syslog-util.c, src/master/syslog-
	util.h, src/plugins/imap-quota/imap-quota-plugin.c,
	src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c,
	src/plugins/quota/quota.h, src/plugins/trash/trash-plugin.c,
	src/plugins/zlib/istream-zlib.c, src/plugins/zlib/zlib-plugin.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client-
	authenticate.h, src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3/client.c, src/pop3/commands.c, src/pop3/common.h,
	src/pop3/main.c, src/util/rawlog.c:
	Added "bool" type and changed all ints that were used as booleans to
	bool.
	[55df57c028d4]

	* src/auth/passdb-pam.c:
	Compiler warning fix
	[ea1571f17b96]

	* src/lib/ioloop-poll.c:
	Cleanup + removed compiler warnings with 64bit systems
	[398dcca97d24]

	* src/auth/passdb-pam.c:
	Check write()'s return value
	[0d5d42c49b51]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Compiler warning fix
	[b52ea344e872]

	* src/dict/dict-server.c, src/lib-dict/dict-client.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Small (compiling) fixes
	[2e5c34fe9634]

	* autogen.sh:
	Call autoheader earlier
	[d3342c78ed44]

2006-01-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	Fixes to handling namespace prefixes.
	[b97de2e354bd]

	* src/master/dict-process.c, src/master/dict-process.h:
	Forgot to add in last commit.
	[8ce85fb481aa]

	* src/master/master-settings.c:
	/var/run/dovecot can be world-readable. Default to it, and don't try
	to force any modes to it. All files and directories under it are
	already protected properly.
	[fee060a82236]

	* src/dict/dict-server.c, src/dict/dict-server.h, src/dict/main.c,
	src/master/Makefile.am, src/master/auth-process.c,
	src/master/common.h, src/master/main.c:
	Start dict server automatically when a client tries to connect to
	it.
	[b3e18b51c205]

2006-01-11  Timo Sirainen  <tss@iki.fi>

	* src/dict/dict-cache.c, src/dict/dict-server.c, src/lib-dict/dict-
	client.c:
	Fixes to dict proxy.
	[72606d5256b8]

	* src/lib/ioloop-notify-dn.c:
	Dnotify crashed if we tried to use multiple I/O loops.
	[4fa8e287486e]

	* src/lib-sql/driver-pgsql.c:
	Added assert
	[c00cbfdc71ef]

	* src/lib-dict/dict-sql.c:
	Fixed parsing configuration file.
	[8d2028705702]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-mail.c:
	Handle unexpectedly breaking mboxes better without crashing.
	[5703f0516342]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Added new assert was wrong in last assert-crashfix, so we still kept
	crashing to the new assert..
	[145b9742b741]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox
	/dbox-uidlist.c:
	Use CR+LF linefeeds always so that physical size = virtual size.
	[223ceff28fc3]

	* dovecot-example.conf, src/lib-storage/index/dbox/dbox-storage.c, src
	/lib-storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added dbox_rotate_min_size and fixed rotation checks.
	[18a786df5815]

2006-01-09  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c:
	try_alloc: Handle mail_get_physical_size() failures.
	[93959452e17e]

	* configure.in:
	Removed deliver until it's working again
	[37b54ccbb961]

	* src/Makefile.am:
	dict was missing
	[273fcae9ffba]

2006-01-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	"Free space offset" wasn't updated when headers were moved around,
	causing assert crashes.
	[6b9e9d614c9a]

2006-01-07  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/db-ldap.c, src/auth/db-ldap.h,
	src/auth/passdb-ldap.c:
	Added fast authbinding and auth_bind_userdn setting. Patch by Geff
	<boing@boing.com>
	[935f12d0d2fe]

	* src/lib-storage/index/mbox/mbox-from.c:
	Handle "Thu, 9 Nov 2002 22:33:52" style timestamps also.
	[b48d071d4ea5]

	* src/imap/cmd-idle.c:
	When idling, send an OK message every two minutes to break
	NAT/firewall timeouts.
	[e0881596af32]

	* src/lib-storage/index/mbox/mbox-list.c:
	Comment update
	[073d3f73db51]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-list.c:
	Keep atime < mtime if mbox has recent messages and we're keeping
	them. Rely on this for setting \UnMarked flag for LIST replies.
	[8cd2673e4eb5]

	* src/lib-index/mail-index-lock.c:
	fix
	[309605c0a7fb]

	* src/lib-storage/index/index-sync.c:
	Crashfix to last keyword compare update
	[3a03da46d884]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-lock.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Beginnings of fallbacking to in-memory indexes when write fails with
	"out of disk space" error.
	[318c70c1d4ec]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-sync.c,
	src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Handle missing/broken transaction logs better. Handle broken sync
	position in index header better.
	[76f4be7ae499]

2006-01-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index.c:
	Minor cleanups
	[1a4d3c25feb8]

	* src/lib-index/mail-index-lock.c:
	Added "(see lock_method setting in config file)" for flock() not
	supported error too.
	[385139d2b082]

	* src/lib-index/mail-transaction-log-append.c:
	Hidden transaction changes weren't hiding everything. This resulted
	STORE +FLAGS.SILENT not being silent always.
	[78692225c2ab]

	* src/lib-index/mail-index-view.c, src/lib-index/mail-index.h:
	mail_index_ext_get_size() hadn't been implemented even though it was
	in mail-index.h. Implemented it and changed
	mail_index_lookup_keywords() to use it.
	[eba704899933]

	* src/lib-index/mail-index-view.c:
	We had been shared-locking index unnecessarily for quite a while
	when using not-up-to-date views.
	[7c32107d18c2]

	* src/imap/cmd-idle.c:
	Recent changes broke IDLE when no mailbox was opened.
	[20430dbf04d4]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index.h, src/lib-storage/index/index-sync.c:
	Changed mail_index_view_sync_next() to return struct
	mail_index_view_sync_rec records which only contain the type and UID
	range. Makes it clearer that the caller won't get anything else, and
	flag updates now don't need to update add_flags/remove_flags fields.
	[a983412e1976]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log-append.c:
	Comment updates, small cleanups and optimizations.
	[3e756ea0474b]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c:
	Converted some buffers to arrays.
	[48a2d15ae0c4]

	* src/lib-storage/index/index-sync.c:
	Make it compile..
	[5ba04396479d]

	* src/lib-index/mail-index.h, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/mbox/mbox-sync.c:
	We assumed that keyword index arrays were always sorted. This isn't
	always the case. Caused unneeded keyword updates.
	[c8b2ed2c9961]

	* AUTHORS:
	Minor update
	[ec0119de5aa2]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h:
	Moved uoff_t and time_t compatibility checks to cache file, since
	they're not needed for index/log. Only index file incompatibility
	check is now endianess flag.
	[61f0e1fe9b55]

	* src/lib-index/mail-index.c:
	Comment updates and minor cleanups
	[6758c0f3c318]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index.c:
	Moved expunge handlers to mail_index_registered_ext.
	[dc560ef2654b]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index-transaction-view.c, src/lib-index
	/mail-index-transaction.c, src/lib-index/mail-index.c, src/lib-index
	/mail-transaction-log-append.c:
	Cleanup: Created mail_index_registered_ext which is used for
	index->extensions array. Put sync_handler to it and removed
	sync_handlers array.
	[575c79a0aabc]

2006-01-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c:
	Read flags properly from header when syncing
	[7574c66f1cc7]

	* src/lib-storage/index/dbox/dbox-mail.c:
	Handle moved mails properly
	[dd9849b6977d]

	* dovecot-example.conf, src/lib-storage/index/dbox/dbox-storage.c, src
	/lib-storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added dbox_rotate_size and dbox_rotate_days settings.
	[74289963b8a7]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-storage.h, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/dbox/dbox-uidlist.h:
	Added rotation by number of days since file was created.
	[2881f7e79098]

2006-01-04  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c:
	If append command failed because input line was too long (highly
	unlikely), we didn't properly reset flush callback.
	[03a2ff05bd12]

2006-01-02  Timo Sirainen  <tss@iki.fi>

	* src/Makefile.am, src/deliver/deliver.c:
	Deliver binary is out of date, dovecot-lda should be used for now.
	[4ed2033584b2]

	* src/master/master-settings.c, src/master/master-settings.h:
	Ignore "protocol lda" section.
	[00d6d460966c]

	* src/lib-index/mail-cache-transaction.c:
	Don't fdatasync() cache file. It's not all that important.
	[8ec5b5955235]

	* src/lib-index/mail-index-lock.c:
	And fix to mmap_disable=yes optimization.
	[e2e75fc037ed]

	* src/lib-index/mail-index-sync-update.c:
	typofix
	[de3a73257e78]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-update.c:
	Don't rewrite index file every time with mmap_disable=yes.
	[5d090d03f2b5]

	* src/lib/strfuncs.c:
	t_strarray_join() was broken with input longer than 63 bytes (good
	thing we didn't use it in any important places). Patch by Johan
	Kiviniemi.
	[ae629e747baf]

2006-01-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/strfuncs.c:
	Fix for last change in *_strsplit_spaces().
	[1e3ed6636bfe]

	* src/auth/passdb-passwd-file.c:
	Don't crash if password is empty
	[f91a8dd9c4ec]

	* dovecot-example.conf:
	There's no "userdb pam".
	[0420cf130a20]

2005-12-31  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am, src/plugins/zlib/.cvsignore,
	src/plugins/zlib/Makefile.am, src/plugins/zlib/istream-zlib.c,
	src/plugins/zlib/istream-zlib.h, src/plugins/zlib/zlib-plugin.c,
	src/plugins/zlib/zlib-plugin.h:
	Added zlib plugin
	[68e7519ebd90]

	* src/lib-mail/istream-header-filter.c:
	Grow default pool size
	[87793c933996]

	* src/lib/ioloop.c, src/lib/ioloop.h:
	Export current_ioloop globally.
	[be1bac1dd005]

	* src/lib-storage/index/mbox/mbox-storage.c:
	In-memory indexes are kept also in index-storage's cache, so we need
	to free them the normal way (probably changed this some time ago).
	[1a80323df9c1]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Removed X-UIDL after all from hide list. Updated comment + small
	cleanup.
	[c4efa2acbf7c]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-body-
	search.h, src/lib-storage/index/index-search.c:
	Allow message_body_search() to return "message_part is broken"
	error. If it happens, clear cache and try again with parsed
	message_part.
	[e6c42de08336]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't send X-UIDL header to clients.
	[93658528c5de]

	* src/lib-dict/dict-client.c, src/lib-dict/dict-client.h:
	Forgot to add
	[0b3f3323e460]

	* src/dict/dict-server.c:
	unlink stale socket
	[e8275a1555d5]

	* src/dict/dict-server.c, src/dict/main.c:
	Small fixes
	[785321049f51]

	* src/dict/dict-server.c, src/dict/main.c:
	Cleanup
	[70a9d66adc97]

	* src/imap/Makefile.am, src/imap/main.c, src/pop3/Makefile.am,
	src/pop3/main.c:
	Register proxy dictionary support and link libdict. Currently it's
	used only by quota plugin, but later it'll be useful for more
	things..
	[0120998fb2d9]

	* dovecot-example.conf, src/imap/main.c, src/pop3/main.c:
	Clarify that workaround lists are space separated. But allow commas
	as well..
	[b412da0eb27c]

	* src/dict/.cvsignore, src/dict/Makefile.am, src/dict/dict-cache.c,
	src/dict/dict-cache.h, src/dict/dict-server.c, src/dict/dict-
	server.h, src/dict/main.c, src/lib-dict/Makefile.am, src/lib-dict
	/dict-private.h, src/lib-dict/dict-sql.c, src/lib-dict/dict.c, src
	/lib-dict/dict.h, src/plugins/quota/quota-dict.c:
	Added dictinary lookup server and a "proxy" dict implementation to
	talk to it.
	[40600601502e]

	* configure.in:
	No GNU_SOURCE checks. We don't want them (I think).
	[f4698c4b0668]

2005-12-30  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.h:
	stdio.h needs to be included before mntent.h or sys/mnttab.h
	[b423e18e4c7f]

	* configure.in:
	Cleanups and some more kqueue stuff
	[beeae4f17615]

	* configure.in:
	Forgot to add kqueue and kevent function checks
	[1a1f8789415a]

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-notify-kqueue.c:
	Added kqueue notification support. Patch by Vaclav Haisman
	[c67f77647a6e]

	* src/lib/ioloop-kqueue.c:
	Fix IO_ERROR behaviour. Patch by Vaclav Haisman
	[d996a407aa4b]

	* configure.in:
	Check that gssapi/gssapi.h exists before using it.
	[0128534525d8]

	* Makefile.am, configure.in:
	Added --with-docs parameter to specify if documentation should be
	installed. Wanted for at least FreeBSD's NOPORTDOCS option. Patch by
	Robin Breathe
	[e87a8db60d25]

	* src/lib/strfuncs.c:
	*_strsplit_spaces() was skipping only space separators, while it
	should have skipped all (like its API comments said).
	[91689264d812]

	* src/imap/cmd-idle.c:
	Don't crash if client disconnected in IDLE. If mailbox had been
	changed before IDLE was started, show the changes immediately. If
	more changes happened to mailbox while we were sending older changes
	to client, we crashed.
	[39c293635875]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Accidentally had changed !partial-check to partial-check. Because of
	this external expunges weren't always noticed and there might have
	been some errors about UIDs being invalid.
	[0cae3268c8af]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/maildir/maildir-sync.c:
	maildir_copy_with_hardlinks works again.
	[8321e6191275]

	* src/lib-storage/index/maildir/maildir-save.c:
	Minor optimization.
	[d55568224be6]

	* src/master/auth-process.c:
	Added comment
	[faca306e691a]

	* src/auth/passdb-ldap.c:
	cleanup
	[fbadb37f28e4]

	* doc/dovecot-ldap.conf, src/auth/auth-request.c, src/auth/auth-
	worker-client.c, src/auth/auth.c, src/auth/db-ldap.c, src/auth/db-
	ldap.h, src/auth/passdb-ldap.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-ldap.c:
	Added authentication bind support. Patch by J.M. Maurer. Also
	cleaned up the LDAP code a bit and made it possible for passdbs to
	disable lookup_credentials in runtime.
	[4b6d962485b9]

	* src/lib-storage/index/mbox/mbox-mail.c:
	If mbox offsets are dirty and the mbox is write-locked (eg. copying
	mails to box), we got to infinite loop.
	[697fe3d1643d]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Extra assert
	[064843fae9da]

2005-12-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Changed default auth socket path
	[394a8a4d564d]

2005-12-28  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-private.h:
	Make dirsize backend read the directory only once at the beginning
	of transaction. Added some more variables to struct
	quota_transaction_context so dict and quota backends can both use it
	directly.
	[c96f2e532b9d]

	* src/auth/auth.c, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	gssapi.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.h:
	Removed need_passdb from mechanism definitions.
	passdb_need_plain/credentials is enough to know that. Also give a
	better error message if no passdbs are set and a mechanism requires
	passdb.
	[395bc6e93222]

2005-12-25  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c, src/imap/cmd-check.c, src/imap/cmd-copy.c,
	src/imap/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-idle.c,
	src/imap/cmd-noop.c, src/imap/cmd-search.c, src/imap/cmd-sort.c,
	src/imap/cmd-store.c, src/imap/cmd-thread.c, src/imap/imap-sync.c,
	src/imap/imap-sync.h:
	UID STORE command must return UID parameter in FETCH replies.
	[ce76b6b8ff11]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	PAM: Changed -session to session=yes to be more consistent with
	other parameters. Check that invalid parameters aren't given. Added
	a few examples to configuration file.
	[852274ab176d]

	* src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-idle.c:
	IDLE: Sending "DONE" + next command in same TCP packet caused the
	next command not to be executed until yet another command came
	(which usually didn't happen).
	[454863612b5c]

2005-12-24  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	fs.h:
	Fixed to work with struct dqblk.dqb_curspace also which is
	apparently the new Linux-way to do it.
	[4d44a337ac08]

2005-12-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/Makefile.am, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/dbox/dbox-sync-full.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/dbox/dbox-uidlist.h:
	When index files (dovecot.index and dbox index) aren't synced with
	each others do a full sync.
	[ef482c909771]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c:
	Allow appending mails in wrong UID order. Sort them internally when
	committing.
	[cd2d1de1255f]

	* src/lib-index/mail-index-sync.c:
	ext_offsets can be higher than int_offsets, so check its validity
	instead before starting syncing.
	[f18a7d8ba375]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fixes
	[d216077076b8]

	* src/lib/Makefile.am, src/lib/bsearch-insert-pos.c, src/lib/bsearch-
	insert-pos.h:
	Added bsearch_insert_pos(). Similar to bsearch(), but if value isn't
	found, returns the position where it would be inserted.
	[23c401a76dc9]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Use binary search for finding entries
	[5fcf8e16ba8c]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Use DBOX_MAIL_FILE_PREFIX macro
	[1c830ec05cb5]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h:
	Write flag changes to dbox files.
	[ca188c8f1457]

2005-12-14  Timo Sirainen  <tss@iki.fi>

	* src/lib/module-dir.c, src/plugins/imap-quota/Makefile.am,
	src/plugins/quota/Makefile.am, src/plugins/trash/Makefile.am:
	Load plugins in sorted order. Prefixed plugins with nn_ set their
	order.
	[d531130a0e4d]

	* src/lib-dict/dict.c, src/lib-dict/dict.h:
	API changes
	[aea926f980b8]

	* configure.in, src/plugins/quota/Makefile.am, src/plugins/quota
	/quota-fs.c, src/plugins/quota/quota-fs.h,
	src/plugins/quota/quota.c:
	quotactl() quota checking support
	[768770a01733]

	* src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/imap-quota
	/imap-quota-plugin.h:
	Init/deinit function names were wrong
	[b752272e6355]

	* AUTHORS, configure.in, src/lib/Makefile.am, src/lib/ioloop-kqueue.c:
	Added kqueue support. Patch by Vaclav Haisman.
	[194295062e5e]

	* src/auth/passdb.c, src/auth/userdb.c:
	Give a few helpul suggestions with "Unknown passdb/usedb driver"
	errors.
	[1649ca519b7d]

2005-12-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-select.c:
	Compile fix
	[68a49ef45dfc]

2005-12-11  Timo Sirainen  <tss@iki.fi>

	* src/lib/module-dir.c:
	If we see libplugin.so, initialize it with plugin_init(), not
	libplugin_init().
	[b1bc70f5862c]

	* configure.in:
	Don't allow giving invalid notify methods in --with-notify
	[840cc63e439b]

	* TODO, configure.in:
	Alpha5 release
	[d362e79fdb97]

	* src/lib-dict/Makefile.am, src/plugins/imap-quota/Makefile.am,
	src/plugins/quota/Makefile.am, src/plugins/trash/Makefile.am:
	Added missing header files. Fixed plugin install hooks to use
	DESTDIR.
	[146a924333aa]

	* src/master/syslog-util.c:
	Some syslog facilities aren't defined everywhere. Put #ifdefs around
	them.
	[dc84dc2d0e9a]

2005-12-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-mysql.c:
	fix
	[8c0efcbc3146]

	* src/lib-sql/driver-pgsql.c:
	fix
	[23ac50bedc47]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf, dovecot-example.conf:
	Added some more information about prefetch userdb.
	[ab929802ad6c]

	* configure.in, src/Makefile.am, src/plugins/.cvsignore,
	src/plugins/Makefile.am, src/plugins/imap-quota/.cvsignore,
	src/plugins/imap-quota/Makefile.am, src/plugins/imap-quota/imap-
	quota-plugin.c, src/plugins/imap-quota/imap-quota-plugin.h,
	src/plugins/quota/.cvsignore, src/plugins/quota/Makefile.am,
	src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-plugin.c, src/plugins/quota/quota-plugin.h,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c, src/plugins/quota/quota.h,
	src/plugins/trash/.cvsignore, src/plugins/trash/Makefile.am,
	src/plugins/trash/trash-plugin.c, src/plugins/trash/trash-plugin.h:
	Added beginnings of plugin infrastructure. TODO: These could be
	optionally compiled into binaries with some configure options.

	Added quota plugin and a new trash plugin. Not very well tested.
	[732b62dc1976]

	* configure.in, src/Makefile.am, src/lib-dict/.cvsignore, src/lib-
	dict/Makefile.am, src/lib-dict/dict-private.h, src/lib-dict/dict-
	sql.c, src/lib-dict/dict-sql.h, src/lib-dict/dict.c, src/lib-
	dict/dict.h:
	Added dictionary API and implementation for SQL. It's meant for
	looking and modifying key=value pairs. In future we may need to use
	this for many different things, but for now it's only used by quota-
	dict plugin.
	[d67092398377]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/sql-api-private.h, src/lib-sql/sql-api.c, src/lib-sql/sql-api.h:
	Added support for transactions and synchronous SQL queries.
	[3dd0ab18d8da]

	* src/lib-storage/index/index-transaction.c, src/lib-storage/mail-
	storage-private.h:
	Added module_contexts to transactions.
	[ba95b4cd33aa]

2005-12-06  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	Don't allow pop3_uidl_format without at least one valid %var in it.
	[b1fa09b19b86]

	* src/pop3/commands.c:
	Make pop3_reuse_xuidl setting actually work. Patch by grant beattie.
	[74b27d1e17a4]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Fixed broken index directory creation change
	[bdeac77a4127]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	If LDAP lookup fails because connection gets closed, try retrying it
	again after reconnect.
	[0a7beabfe332]

	* src/auth/passdb-checkpassword.c:
	Added better logging
	[fd0df9ddd688]

	* src/auth/main.c:
	Deinitialize userdbs/passdbs first, so they can still generate auth
	failure replies without crashing.
	[86e1a19b0a9e]

	* src/auth/auth-request.c, src/auth/passdb-cache.c:
	Don't crash if cache key isn't set but cache is enabled.
	[64ed35c97678]

	* src/imap/cmd-idle.c:
	If DONE was sent while output was still being sent to clients, we
	didn't deinitialize syncing properly. That output mustn't get lost
	anyway, so now DONE isn't accepted until all output is sent.
	[de92177c8113]

	* dovecot-example.conf:
	mailbox_idle_check_interval comment updated
	[ad1e6b8a5109]

2005-12-03  Timo Sirainen  <tss@iki.fi>

	* src/master/syslog-util.c, src/master/syslog-util.h:
	Forgot to add in syslog_facility commit
	[cf8933dabc95]

2005-12-02  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c, src/login-
	common/main.c, src/master/Makefile.am, src/master/main.c, src/master
	/master-settings.c, src/master/master-settings.h, src/pop3/main.c:
	Added syslog_facility setting to config file.
	[d22c883021da]

	* src/lib-index/mail-index-transaction.c:
	mail_index_keywords_create_from_indexes(): Don't crash with 64bit
	systems if there are only 0 keywords.
	[17492616f363]

	* doc/dovecot-ldap.conf:
	Comment changes to reflect the new way to configure pass_attrs and
	user_attrs (which has been there for months already, the old way
	still works too).
	[eed9f0930756]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-transaction.c:
	Logic/comments cleanups. Keep uidlist locked a bit shorter time.
	[d46abb12934a]

2005-11-28  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/dbox/.cvsignore, src/lib-
	storage/index/dbox/Makefile.am, src/lib-storage/index/dbox/dbox-
	file.c, src/lib-storage/index/dbox/dbox-file.h, src/lib-
	storage/index/dbox/dbox-list.c, src/lib-storage/index/dbox/dbox-
	mail.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-transaction.c, src/lib-
	storage/index/dbox/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-
	uidlist.h:
	Initial implementation of Dovecot's own high performance file
	format, named dbox. Currently relies heavily on index files to work,
	and isn't able to rebuild them if they're lost. This will be fixed
	soon. Not tested much yet in general.
	[fd0986477809]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Minor error handling fix
	[13b968e8e16e]

2005-11-25  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	"userdb prefetch" should be commented out by default.
	[c62c573560c1]

	* src/lib/Makefile.am, src/lib/hex-dec.c, src/lib/hex-dec.h:
	Added decimal <-> hex string translation functions.
	[599cd2c5d512]

	* src/lib-index/mail-index-transaction.c, src/lib/Makefile.am, src/lib
	/seq-range-array.c, src/lib/seq-range-array.h:
	Moved seq_range_*() functions to more generic ones in lib/.
	[821035fdc9f6]

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	Added file_dotlock_get_lock_path()
	[9680bd9e6346]

2005-11-20  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	Changed "pop3_uidl_format not set" error message.
	[1c50dc060e68]

2005-11-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	MAILBOX_OPEN_NO_INDEX_FILES flagfix.
	[123d9ec53bb7]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't create index directory if we're not using index files
	[8a613c365447]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Using MAILBOX_OPEN_NO_INDEX_FILES caused crashes in deinitialization
	[8f38c99146fc]

2005-11-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream.h:
	API description update
	[fd00b618679d]

2005-11-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Assert change
	[789c01f91c1f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	We could have assert-crashed when expunging messages.
	[ba6a93bb21b9]

2005-10-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/auth-server-connection.c:
	Give error message if auth server didn't return mechanism list.
	[c278d40d99e7]

	* src/imap-login/client.c, src/imap-login/client.h:
	If capability is sent in greeting, don't send it before we have
	received authentication capabilities from auth process.
	[2422546e3c44]

	* configure.in:
	MIT kerberos v1.2 (and older) doesn't work with us.
	[561e81dfa20b]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	If mail had more extra space in X-UID header than in X-Keywords
	header (but X-Keywords existed), we broke when rewriting it.
	[83b65734e32e]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Make sure we are seeked to correct position if using the last mail's
	mail_ctx directly.
	[736583a848a9]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	We were handling wrapped X-IMAPbase and X-Keywords headers very
	badly.
	[50e6aeff6b6d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	Handle duplicate keywords in X-Keywords header properly
	[e9742e1f3741]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	We added LF+TAB unneededly at the beginning of each X-Keywords
	header.
	[5ca6f0751346]

	* src/lib-index/mail-index-sync-ext.c:
	Growing extension headers broke other extensions, unless it was the
	first extension. Meaning adding keywords caused crashes.
	[5b7087ba4118]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Set mail_ctx=NULL always after doing something for the last mail,
	even if we didn't rewrite its headers. Otherwise internal state
	breaks and we'll crash.
	[b358ee31b5ea]

	* src/lib-mail/message-body-search.c:
	Added an assert
	[0353f93f57bc]

	* src/lib-mail/message-part-serialize.c:
	Validate deserialization better.
	[1e1beaff9207]

	* src/auth/auth-request.c, src/auth/mech-apop.c, src/auth/mech-
	gssapi.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c:
	Use a bit larger initial pool sizes
	[4f8598b0ca62]

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/passdb-
	ldap.c, src/auth/passdb-sql.c:
	cache_key was set wrong for sql/ldap passdbs, so auth_cache was
	completely broken with them
	[12d00d9ceb6e]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Don't crash with empty mboxes
	[b4fac5616c03]

	* src/master/login-process.c:
	Comment update
	[162ad2307710]

	* src/master/login-process.c:
	Don't call initgroups() at the start of login processes.
	[e167b71e37e3]

	* doc/variables.txt, src/master/mail-process.c:
	Added %i for UID
	[5595ed76d4c9]

	* src/auth/main.c, src/deliver/deliver.c, src/imap/main.c,
	src/pop3/main.c:
	Ignore SIGALRM signal. We don't want to crash when it happens.
	[8b68997d6e34]

	* src/lib-index/mail-cache-transaction.c:
	mail_cache_delete(): Make sure we don't get to infinite loop if
	cache records contain a loop.
	[1e6af9a000e6]

2005-10-27  Timo Sirainen  <tss@iki.fi>

	* doc/variables.txt, src/auth/auth-request.c:
	%w contains now password
	[629ffe1a3874]

	* configure.in:
	typofix
	[1b86be09b41e]

	* src/lib/ioloop-epoll.c:
	And even more log verbosity
	[dd71819db08e]

	* src/lib/ioloop-epoll.c:
	Added more verbosity to epoll_ctl() failure messages.
	[59b8ac4c031e]

	* AUTHORS, configure.in, dovecot-example.conf, src/auth/Makefile.am,
	src/auth/auth.c, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	gssapi.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added GSSAPI support. Patch by Jelmer Vernooij and some fixes by
	pod@herald.ox.ac.uk
	[28cca6317829]

	* src/auth/auth-request.c:
	Non-plaintext authentication and passdb cache didn't work together.
	Patch by Andrey Panin.
	[0207808033ad]

	* src/lib/network.c:
	Use read() instead of recv() in net_receive(), so it works even with
	non-sockets. We weren't using any recv()'s flags anyway, so it
	shouldn't matter.
	[771cd6776d4b]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Having "dotlock fcntl" locking assert-crashes if dotlock file
	already exists.
	[475c1fe28dad]

	* dovecot-example.conf:
	Added a note to Solaris users about lock_method.
	[3ba5ee54fa3c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	if message was only 0-1 bytes, we skipped the whole message which
	caused crashes
	[bae46114f240]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	When rewriting mbox, don't parse the last message again. We already
	have its contents in mail_ctx, so pass it over to rewriter so it can
	reuse it. This fixes also a crash when last message's header ended
	unexpectedly and mbox file was grown (the added NULs were treated as
	the last message's headers).
	[6f58deb34e8a]

	* src/lib-mail/message-parser.c:
	If message header ends unexpectedly, return it anyway instead of
	ignoring it completely.
	[617213ed79b5]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	If mbox file contains only single LF, treat it as an invalid mbox
	file instead of breaking later.
	[bcefda9b7745]

	* src/lib-storage/index/mbox/mbox-sync.c:
	When updating pseudo mail, we also tried to update it as the first
	mail in index file. Normally it shouldn't have mattered, but if
	there were no mails in mailbox it caused a crash.
	[0bca23bf1b71]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	When expunging the first mail that has X-IMAPbase header and moving
	it to next mail, make sure the X-UID header gets appended after
	X-IMAPbase header. Otherwise UIDs of all mails will change.
	[9dd3cdef8644]

2005-10-20  Timo Sirainen  <tss@iki.fi>

	* src/lib/compat.h:
	#ifdef TRU64 -> __osf__
	[b18e05b0170d]

	* configure.in, src/lib/compat.h:
	Include inttypes.h with Tru64 to get uint32_t etc. types defined.
	[77135b9e26b5]

	* TODO, configure.in:
	1.0alpha4
	[81e73a6714c1]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	If passdb returned NULL password (ie. no password needed), it wasn't
	cached correctly.
	[09b5e002ad8a]

2005-10-19  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	nologin/proxy are now always in boolean format, ie. without any
	"=Y".
	[c9f1bd1e1ec2]

	* configure.in, dovecot-example.conf, src/auth/Makefile.am, src/auth
	/userdb-passdb.c, src/auth/userdb-prefetch.c, src/auth/userdb.c:
	Renamed userdb passdb to prefetch.
	[b7569a6a4ada]

	* src/auth/passdb-blocking.c:
	Blocking passdb didn't set nologin/proxy/nodelay flags for the
	request.
	[b381c9b899a2]

	* src/lib/ostream-file.c:
	Revert previous "cleanup" which broke things.. Added a comment.
	[1f4b4387595b]

2005-10-16  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	Complain about missing pop3_uidl_format also if it's empty
	[9bdf25784ac2]

	* src/pop3/commands.c:
	Don't send duplicate lines in LIST command when buffer is full.
	[6d485bf73429]

	* src/lib-storage/index/mbox/mbox-save.c:
	Instead of crashing when trying to copy mails within same mailbox,
	give an error message to user.
	[247501e81026]

	* dovecot-example.conf, src/master/master-settings.c, src/pop3/main.c:
	pop3_uidl_format is now required to be explicitly set. There is no
	default anymore.
	[a745511d591e]

	* src/deliver/deliver.c:
	Added -m parameter to store mail to non-INBOX mailbox without Sieve
	scripting.
	[f2d65601097c]

	* dovecot-example.conf:
	Added a warning about multiple passdbs to auth_cache_size.
	[7a04c13af9bc]

	* src/auth/auth-request.c, src/auth/auth-worker-client.c, src/auth
	/userdb-ldap.c, src/auth/userdb-passdb.c, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-sql.c, src/auth
	/userdb-static.c, src/auth/userdb-vpopmail.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Separated userdb_module's interface and the actual data struct. Now
	it's possible to have multiple userdbs of same type but with
	different settings.
	[fc4622b1c1ef]

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/auth-
	request.c, src/auth/auth-worker-client.c, src/auth/auth.c, src/auth
	/db-ldap.c, src/auth/db-passwd-file.c, src/auth/db-passwd-file.h,
	src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-passwd-file.c:
	Separated passdb_module's interface and the actual data struct. Now
	it's possible to have multiple passdbs of same type but with
	different settings.
	[0c10475d9968]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/passdb-
	bsdauth.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-
	vpopmail.c:
	Make auth caching work with non-sql/ldap passdbs too.
	[fda241fa5d77]

	* src/auth/auth-request.c, src/auth/auth-worker-client.c, src/auth
	/passdb-blocking.c, src/auth/passdb-cache.c, src/auth/passdb-
	cache.h, src/auth/passdb-ldap.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb-sql.c, src/auth/passdb.c, src/auth/passdb.h:
	Fixes and cleanups to credentials handling. Also fixed auth caching
	to work more correctly in case of internal failures.
	[62fc6883faeb]

	* src/lib/failures.c:
	Don't crash if reopening log file without separate info log file.
	[9adec8bb8a53]

	* src/lib/ostream-file.c:
	Cleanup
	[d408296d9a5d]

2005-10-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	When output buffer got full while sending syncing changes, we sent
	the last change twice to client. This was bad if extra EXPUNGEs got
	sent..
	[440137d72ca0]

	* src/lib/ostream-file.c:
	Removed accidentally committed debug errors.
	[a2d7da8ad64e]

2005-10-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-crlf.c:
	Type mismatch fixes
	[8484001f1584]

	* src/auth/passdb-pam.c, src/lib-index/mail-transaction-log-view.c,
	src/lib/ioloop-notify-dn.c:
	Fixed some printf-type mismatches
	[8c63af0ab91a]

2005-10-11  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added compatibility warning about mail_save_crlf.
	[2c19efe2ddb6]

2005-10-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/mbox-sync.c, src/lib
	/istream-data.c, src/lib/istream-file.c, src/lib/istream-internal.h,
	src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream-
	seekable.c, src/lib/istream.c, src/lib/istream.h, src/lib/ostream-
	file.c:
	Added exact parameter to i_stream_stat()
	[7af5162d934c]

2005-10-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-cache.c:
	Added some more verbosity to cache lookups.
	[f50496e14ac8]

	* src/auth/auth-request.c:
	We were caching failed blocking requests wrong.
	[81180ca12997]

	* src/auth/auth-cache.c:
	Don't crash with SIGUSR2 if auth cache hasn't seen any hits
	[6a94b8412638]

	* src/auth/main.c:
	Don't crash with SIGHUP/SIGUSR2 if auth_cache isn't used
	[5207179e47de]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If mbox root directory doesn't exist, create it instead of just
	giving error message.
	[aab106e80c3c]

	* src/imap/cmd-copy.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-storage
	/mail-copy.c, src/lib-storage/mail-copy.h, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h:
	Added flags and keywords parameters to mailbox_copy() in case
	they're wanted to be changed while copying.
	[3de464cb604f]

2005-10-05  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c:
	Added "master out" debugging also for USER queries from master (ie.
	from deliver)
	[e06617e148fc]

	* src/auth/userdb-static.c:
	Don't crash if there are keys without =value part in static userdb
	template.
	[35a6bc4876e4]

	* src/auth/userdb.c:
	Don't crash if we have blocking userdb but non-blocking passdb.
	[4e55969a6a93]

2005-10-04  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/imap/namespace.c, src/pop3/main.c:
	And lock_method fixes..
	[e30f6e541c2f]

	* dovecot-example.conf, src/deliver/deliver.c, src/imap/namespace.c,
	src/lib-index/mail-index-lock.c, src/master/master-settings.c,
	src/pop3/main.c:
	Default lock_method to flock instead of fcntl. This is at least
	useful for not allowing Dovecot's indexes to be used accidentally
	with wrong settings in NFS mounted partitions.
	[08b768956051]

2005-10-01  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/auth.c, src/auth/auth.h, src/auth/passdb-
	blocking.c, src/auth/passdb-bsdauth.c, src/auth/passdb-passwd.c,
	src/auth/passdb-shadow.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-request.c, src/login-common/sasl-server.c, src/login-
	common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c, src/login-
	common/ssl-proxy.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added ssl_username_from_cert setting. Not actually tested yet..
	[c12df370e1b2]

	* src/lib/ioloop-notify-dn.c:
	Fixed fd leak
	[377f69be914f]

	* src/master/mail-process.c:
	If user's home directory is a non-directory (eg. /dev/null) fallback
	to /tmp without error message.
	[1e053e5e160d]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't break if mail root directory is '/'.
	[277906fcc8ea]

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	Don't try to check for notifications when mbox was opened from input
	stream.
	[fe63974d6365]

2005-09-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream.c:
	i_stream_stat() should return NULL for closed istreams
	[7a9ae11167de]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-internal.h, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream-seekable.c, src/lib/istream.c,
	src/lib/istream.h:
	Added i_stream_seek_mark() and used it
	[e05a1af4bbc7]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/mail-storage.h:
	Added MAILBOX_OPEN_NO_INDEX_FILES flag and made streamed mboxes by
	default also indexed.
	[571336db01f4]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-sync-update.c, src/lib-index/mail-cache-transaction.c, src
	/lib-index/mail-cache.c:
	Unlocking cache file can also corrupt it since it modifies it. Added
	a return value for it and checks to handle the failure. Fixes a
	crash in some error situations.
	[c0e35566dd14]

	* src/lib-index/mail-index-lock.c:
	Don't leak alarm() with in-memory indexes
	[68ab7800d735]

2005-09-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	And don't crash at exit..
	[04e62fc6230f]

2005-09-28  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	ioloop needs to be created before setting signals or we crash
	[d53d0de2ffbb]

2005-09-27  Timo Sirainen  <tss@iki.fi>

	* src/lib/compat.h, src/lib/ostream-file.c:
	Use IOV_MAX instead of UIO_MAXIOV when available.
	[085ebc6e341c]

	* src/lib-storage/index/maildir/Makefile.am, src/lib-
	storage/index/mbox/Makefile.am:
	Removed lib-index/mbox and lib-index/maildir includes. They don't
	exist anymore.
	[b402cc8a5d44]

2005-09-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/Makefile.am, src/lib/fd-set-nonblock.c, src/lib/fd-set-
	nonblock.h, src/lib/ioloop-notify-dn.c, src/lib/network.c:
	Added fd_set_nonblock() and changed net_set_nonblock() to use it.
	[3ae2df67459c]

	* src/auth/auth-cache.c, src/auth/main.c, src/deliver/deliver.c,
	src/imap/main.c, src/lib/lib-signals.c, src/lib/lib-signals.h, src
	/login-common/main.c, src/master/main.c, src/pop3/main.c:
	Implemented new signal handling framework, which makes handling
	signals much easier.
	[3360cc019737]

	* src/lib/strfuncs.c:
	*_strsplit_spaces(): Ignore trailing spaces.
	[86ddbe18538c]

	* src/lib/ostream-file.c, src/lib/ostream-internal.h,
	src/lib/ostream.c, src/lib/ostream.h:
	Changed iov_count to be unsigned int, it's large enough. Added
	overflow-flag which gets sent if send() failed to both send and
	buffer the given data.
	[a16f27ce2eda]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib/lib.c, src/lib/lib.h:
	Removed null4 and replaced the few uses of it with
	buffer_append_zero().
	[904849549eac]

	* src/lib/hash.c, src/lib/hash.h:
	Added hash_copy() and added some consts
	[906b87e236bf]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added p_strsplit(), p_strsplit_spaces() and strarray_remove()
	[0a885029543b]

	* src/lib/ioloop-poll.c:
	minor cleanup
	[67703a43b23f]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.h:
	Added IO_ERROR condition that we can watch now.
	[c4c1b538d8d0]

2005-09-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-epoll.c:
	Don't leak epoll fd to child processes. Memory allocations were
	wrong for 64bit systems. Changed the code to use array_t.
	[c64473977187]

	* src/auth/db-passwd-file.c:
	When passwd-file has %d, drop domain names from username lookups
	only if %d was given without any modifiers.
	[5d92a45fc751]

	* dovecot-example.conf:
	imap.deny -> dovecot.deny
	[24d9c17b4cb6]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/passdb.c, src/auth/passdb.h, src/master
	/auth-process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added deny password databases.
	[ea2266d0a07f]

	* src/auth/db-passwd-file.c:
	Read also users without password.
	[b86d4c76efdf]

	* src/login-common/main.c, src/master/login-process.c:
	Several fixes to make running from inetd working again
	[a2dd3d895e00]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	If passdb lookup fails with internal error, try other passdbs anyway
	before returning internal failure.
	[8a8352cda514]

	* src/auth/userdb-blocking.c:
	If blocking userdb lookup fails, don't crash. Also we shouldn't stop
	trying other userdbs then.
	[c533051d19cd]

	* src/lib-index/mail-index-sync-ext.c:
	Resizing header left header offsets broken and usually assert-
	crashed while doing it.
	[9d2345ba4e30]

	* src/lib-index/mail-index-private.h:
	Added some comments
	[36e1899b109b]

	* src/imap/cmd-append.c:
	Call o_stream_uncork() after sending "+ OK", so it gets to client
	more quickly.
	[c6ebda431efa]

	* src/imap/client.c:
	client_send_line(): Try flushing output immediately if buffer gets
	full.
	[edc6e213048f]

2005-09-23  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	alpha3
	[33e3b0899b47]

	* dovecot-example.conf:
	Added a warning about auth-master socket permissions
	[0229cb5e4384]

	* dovecot-example.conf:
	Changed /var/run/dovecot/auth-master to /var/run/dovecot-auth-master
	[3e737ed2f57b]

	* src/auth/main.c:
	Increased count of UNIX socket listener backlogs to 64.
	[aeb53e34d1f4]

	* src/lib-mail/rfc822-parser.c:
	Parse obs-phrase correctly. Patch by Chris Wakelin
	[71472bab2cbb]

2005-09-18  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added information about userdb passdb.
	[4d2ee2274c70]

	* configure.in, src/auth/mycrypt.c:
	And more changes to get _XPG6 stuff working right
	[f1b407e8debb]

	* src/auth/mycrypt.c:
	Add _XPG6 macro if needed..
	[fa4cbca22d26]

	* src/imap/imap-fetch-body.c, src/imap/imap-search.c:
	Compiler warning fixes
	[5434d427df49]

	* src/lib/file-dotlock.c:
	compiler warning fix
	[69f731759776]

	* configure.in:
	Added check for _XPG6 macro for crypt().
	[340e1b87c27b]

	* src/master/main.c:
	Added --build-options parameter. Patch by Andrey Panin
	[fead84acb13c]

	* src/lib-storage/index/maildir/maildir-save.c:
	typofix in error message
	[1c90049a2ec8]

	* src/lib-storage/index/maildir/maildir-save.c:
	If o_stream_send_istream() fails, write an error to log.
	[1a1f0ec613d6]

	* src/imap/cmd-append.c:
	If client input was closed unexpectedly, don't treat it as index
	error.
	[2cb7ebd43e8c]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Don't hide error message if fcntl() fails with EAGAIN/EACCES
	[1eb7b2ad1ac0]

	* src/login-common/ssl-proxy-openssl.c:
	Don't require private key to be RSA
	[b686c8bbcd6f]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Partial syncs caused index's next_uid to be updated even if the new
	mails weren't added to index. That caused some UID corruption
	errors.
	[a45208fe7c83]

	* src/lib-index/mail-index.c:
	When creating a new index file, mark its log offsets so that the
	possibly existing log file is completely synced. This caused marking
	index to be corrupted to be quite useless since the same problem was
	again brought back from the .log file.
	[bfa542369fdc]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Make sure corking is removed before calling ssl_proxy_new()
	[cb143fc37b58]

	* src/login-common/ssl-proxy-openssl.c:
	Cork/uncork the SSL socket when writing. Reduces latency a lot.
	[748ee6f41fc1]

	* src/lib-storage/index/maildir/maildir-sync.c:
	We were forcing a maildir resync when it hadn't changed at all.
	[09565508b8ba]

	* src/master/master-settings.c:
	Default to ssl_disable=no always, even if SSL isn't compiled in. If
	SSL isn't compiled in and ssl_disable=no, complain immediately.
	[a0f99c5a6961]

	* src/lib/network.c:
	s/SOL_TCP/IPPROTO_TCP/
	[51d30414b8bd]

2005-09-16  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	If dotlock is overwritten/deleted, say in the error message how long
	we kept the lock.
	[827c7137fd78]

2005-09-11  Timo Sirainen  <tss@iki.fi>

	* TODO, configure.in:
	alpha2 released
	[e1888f3d3423]

	* doc/variables.txt:
	Added %R and %H documentation
	[08ee6a4ed96e]

	* src/lib/var-expand.c:
	Added 'R' reverse modifier.
	[85e509808c30]

	* src/lib/var-expand.c:
	Fix to hash modifier handling
	[bb648f016990]

	* src/imap/cmd-search.c, src/lib-imap/imap-bodystructure.c, src/lib-
	imap/imap-parser.h, src/lib-mail/message-header-search.c,
	src/pop3-login/client-authenticate.c:
	Compiler warning fixes
	[b871cd1dc60c]

	* src/lib-imap/imap-bodystructure.c:
	"stack frame changed" crashfix
	[6ea104e75c3d]

	* src/auth/userdb-vpopmail.c:
	Compile fix
	[1b2d685d1660]

	* dovecot-example.conf:
	s/login_process_per_user/login_process_per_connection/
	[1081888c1407]

	* src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/commands.c, src/pop3/common.h,
	src/pop3/main.c:
	Added pop3_reuse_xuidl setting. Patch by Chris Wakelin
	[58e3fa234ef4]

2005-09-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/var-expand.c:
	Added 'H' hash modifier.
	[0355b805cd4c]

2005-08-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	assert fix
	[2b167cc13887]

2005-08-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	Support creating locks with O_EXCL.
	[d3f246330d37]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Compiler warning fix
	[505a5f3f3857]

	* src/lib-storage/index/mbox/mbox-from.c:
	Timezones in From-lines weren't handled correctly.
	[ce873eed7b21]

	* dovecot-example.conf:
	Change mail setting in static userdb not to use %h since it doesn't
	work.
	[7faf81f89cab]

	* src/lib-index/mail-cache-transaction.c:
	We could have written corrupted data to cache file if it had just
	been compressed. Also did some other cleanups.
	[3533923e786f]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Try harder to notice bugs
	[bf294d77e1ec]

2005-08-27  Timo Sirainen  <tss@iki.fi>

	* src/pop3/commands.c:
	Fix
	[bfd47c33c46d]

	* src/pop3/commands.c:
	If more mail comes after we have synced ourself initially, don't
	access/show the new mails. For example UIDL could have shown more
	than needed, and it may have expunged the new mails when quitting.
	[ca22e27202b2]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c:
	Index creation was racy.
	[6170e2e5992a]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log.c:
	When refreshing transaction log while trying to find new log file,
	don't recreate the log file if it wasn't found or was corrupted.
	Things have already broken at that point and recreating it could
	cause recurseive mail_index_map() call with mmap_disable=yes.

	Also added more assert()s to check that we don't try to recursively
	call mail_index_map().
	[afe8ab9072f0]

	* src/lib-index/mail-index-fsck.c:
	Call mail_index_map() with force=TRUE parameter. Required if
	mmap_disable=yes, otherwise we'd be fscking our internal index built
	using transaction log.
	[4b9957c31e1f]

	* src/lib-index/mail-cache.c:
	Don't try refresh index file while locking it. It just slows down
	things, is rarely useful and may break sometimes with
	mmap_disable=yes. Also we were calling it after
	mail_index_view_open() so it wasn't even working..
	[aa071f73382c]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-transaction-
	log.c:
	More error message fixing
	[6a1ea27a4256]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	index-lock.c, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log.c:
	Removed fcntl() text from some locking error messages, because if
	lock_method=flock, it was done using flock().. Also did several
	s/it's/its/ in comments and one error message.
	[65dc45982df9]

2005-08-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Error message update
	[6fbdd79b32a5]

	* src/lib-index/mail-index-sync-keywords.c:
	We didn't add the ending NUL character in keyword name, which caused
	more or less random failures.
	[3c5eb0649d5a]

2005-08-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c:
	X-IMAPbase's uid-last offset was remembered wrong in some cases.
	Added also an extra assert.
	[63ac77faeac8]

	* src/lib-storage/index/mbox/mbox-from.c:
	Allow day field to contain only a single digit without preceding
	zero/space.
	[2909b1c2fddf]

	* src/lib-storage/mail-storage.c:
	If autodetection failed, give an error message so we don't just get
	"Failed to create storage with data .."
	[b954a513257f]

2005-08-18  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	Don't log extra bind() errors for net_listen_unix() either
	[0b6539bc22b9]

	* src/lib-storage/index/maildir/maildir-copy.c:
	Disable hardlink copying until it's fixed
	[f1ecf7ee63db]

	* TODO:
	update
	[d597feda0c5e]

	* src/lib-index/mail-transaction-log-append.c:
	Removed fsync() call when appending to transaction log file. It's
	not all that important and just slows down.
	[ca2121e0d582]

	* TODO:
	update
	[3cc9212b1c66]

2005-08-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	We weren't properly checking if X-IMAPbase header was seen when we
	parsed X-UID header. Could cause assert-crash while rewriting.
	[0ddbfc6aa2d7]

2005-08-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	If mail_get_stream() is called when stream had already been used and
	seeked to non-start, it calculated the header/body sizes wrong.
	[7a94871543f5]

	* configure.in:
	Forgot to commit parts of the inotify patch
	[261d98a81d74]

	* src/lib/network.c:
	net_listen(): Print bind() errors only if it's not EADDRINUSE. Also
	do the same for listen().
	[5ff3b88db948]

	* src/imap/imap-sort.c, src/lib-storage/index/mbox/mbox-sync.c:
	If UID lookup doesn't return any sequences, don't crash
	[6da16ce12b14]

	* src/master/main.c:
	The master process itself also needs the TZ environment
	[08b3e3fd0bc5]

	* src/lib-storage/index/index-mailbox-check.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib/ioloop-internal.h,
	src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c, src/lib
	/ioloop-notify-none.c, src/lib/ioloop.c, src/lib/ioloop.h:
	New inotify code and notify API change. Patch by Johannes Berg
	[a9be1824403b]

2005-08-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/auth-server-connection.c:
	If UNIX socket connection fails with EAGAIN, try again for a while.
	[3ec5c6665bec]

	* src/auth/auth-worker-server.c:
	If auth worker socket isn't created yet when we try to connect to
	it, try for 5 seconds before aborting. (previous fix didn't work)
	[4f7427a5be61]

	* src/lib/module-dir.c:
	If DEBUG environment is set, module_load_dir() now prints some
	debugging
	[c506ec006de5]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Recursive maildir uidlist syncs caused assert crashes. Also did some
	cleanups.
	[e9695ec7925b]

	* src/auth/userdb-passdb.c:
	Removed accidentally committed debugging change
	[e963246c0981]

	* src/auth/userdb-static.c:
	Added missing t_pop() call. static userdb was broken.
	[e8541dcd0c74]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c:
	If we leaked a t_pop() call, tell where it happened
	[56df153e9f65]

2005-08-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-stream.c, src/auth/auth-stream.h:
	Accidentally committed earlier parts of changes to authentication
	streams, which tries to make sure that no TABs or LFs are sent in
	any values to mess up things. This commit now finishes it..
	[0bcee5d7da39]

2005-08-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	Fixed a hang if parsed header was already cached.
	[8ac16ccc3c73]

	* src/lib-storage/index/index-storage.c:
	Don't try to use cached index if it doesn't exist anymore.
	[67179bfce30f]

	* src/lib/network.c:
	Added some more error messages. Also if net_connect_ip() gives my_ip
	parameter and it can't be given to bind(), don't silently ignore it.
	[d1ed3b3548db]

	* src/master/master-settings.c:
	Section closing wasn't done properly. Patch by Tom Alsberg
	[3d9667c5b133]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If mbox file growing failed, truncate it back to original size so
	extra NUL chars aren't left at the end of it.
	[3ccf9db0d117]

	* doc/auth-protocol.txt, doc/index.txt, src/auth/Makefile.am, src/auth
	/auth-master-connection.c, src/auth/auth-request-handler.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/auth-worker-
	client.c, src/auth/passdb-blocking.c, src/auth/passdb-
	checkpassword.c, src/auth/passdb.h, src/auth/userdb-blocking.c,
	src/auth/userdb-ldap.c, src/auth/userdb-passdb.c, src/auth/userdb-
	passwd-file.c, src/auth/userdb-passwd.c, src/auth/userdb-sql.c,
	src/auth/userdb-static.c, src/auth/userdb-vpopmail.c,
	src/auth/userdb.c, src/auth/userdb.h, src/imap/client.h, src/imap
	/cmd-idle.c, src/lib-imap/imap-parser.h, src/lib-mail/message-
	parser.h, src/lib-sql/sql-api.h, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/lib-storage/subscription-file/subscription-
	file.h, src/lib/file-cache.h, src/lib/istream.h, src/lib/read-
	full.h, src/lib/strfuncs.c, src/lib/write-full.h, src/login-common
	/ssl-proxy-gnutls.c, src/login-common/ssl-proxy.h:
	s/occured/occurred/
	[e2fe8222449d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	Don't crash in some situations with broken X-UID headers.
	[7addee16b026]

2005-07-29  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-request-handler.c,
	src/auth/auth-request-handler.h:
	Removed unused code
	[c444e76648e8]

	* src/imap/cmd-fetch.c, src/imap/commands-util.c, src/imap/imap-
	search.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/pop3/client.c:
	Added separate "temporary error" flag for
	mail_storage_get_last_error().
	[46bfbbcc3c54]

2005-07-24  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Preserve TZ environment to child processes so timezones aren't lost
	with AIX.
	[71b0ccba8cf3]

2005-07-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c, src/imap/commands-util.h, src/imap/imap-
	sync.c:
	Send untagged FLAGS / PERMANENTFLAGS replies if keywords list
	changed.
	[1c9f3264f2fc]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't even open mbox file when changing flags and
	mbox_lazy_writes=yes
	[31b5b232c783]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Error handling fix, more debugging and a new assert
	[4d3be62d9db9]

	* src/lib-storage/index/index-mail.c:
	If header wasn't already parsed when opening mail, we read the whole
	message as its header and left body empty. Happened with maildir.
	[83c0a3e62722]

2005-07-22  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	ssl_cipher_list setting needs to be uppercased ALL:!LOW or it won't
	work (there was no problem unless the setting was uncommented).
	[d6d8cdd9b0fa]

	* dovecot-example.conf, src/imap/cmd-subscribe.c:
	Updated behavior of tb-extra-mailbox-sep
	[2910fde2725d]

	* dovecot-example.conf:
	Update about PAM -session.
	[5cec18e2ddd1]

	* src/auth/passdb-pam.c:
	Open/close PAM session if -session option is given. Patch by Pasi
	Sjm.
	[b85c96ba56df]

	* src/auth/password-scheme.c:
	digest_md5_generate(): If username isn't given, give an error
	message instead of crashing. Mostly to avoid crashing with dovecotpw
	utility.
	[5bec038753f5]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Reverted accidental commit.
	[c17e810208a6]

	* dovecot-example.conf, src/imap/cmd-delete.c, src/imap/cmd-
	subscribe.c, src/imap/common.h, src/imap/main.c:
	Added tb-extra-mailbox-sep IMAP workaround.
	[0e05687892dc]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	Added support for variables in passwd-file path.
	[ee0e39cf4ca5]

	* src/lib-mail/message-header-search.c:
	Try to compare strings even if charset conversion failed.
	[c727a35c9602]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/userdb-ldap.c:
	user_global_uid and user_global_gid settings weren't working. Also
	changed them to now allow named user/group.
	[5e78500f1aee]

	* src/login-common/client-common.c:
	We printed "SSL" to log for localhost connections. Use "secured"
	instead.
	[51ffafcee2b8]

	* src/lib-storage/index/mbox/mbox-lock.c:
	added extra assert for checking deadlocks
	[98cf57713f0a]

	* src/lib-storage/index/maildir/maildir-save.c:
	Fix potential deadlocking while saving messages.
	[35be29ba348d]

2005-07-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/mbox/mbox-list.c:
	Give error message if mailbox listing fails. Don't crash with mbox
	if .subscriptions file couldn't be opened.
	[910620d1e19e]

	* src/lib-index/mail-index.c:
	Check that record alignmentation is actually used correctly. If not,
	recreate the index.
	[872218271484]

2005-07-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	If address doesn't have a name, return it as NULL instead of "".
	This fixes problems with some clients. Patch by Chris Wakelin
	[51bf11f92c07]

2005-07-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	Keep record size divisible with maximum wanted extension field
	alignment.
	[5ed3f06cd1b8]

	* src/lib-index/mail-cache-fields.c:
	mail_cache_register_get_list(): Allocate the returned strings also
	from given pool to make sure they don't get changed.
	[7cab5dc6a0cd]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h:
	Header caching was more or less broken.
	[3cc5229f1560]

	* src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c:
	Set close-on-exec flags for opened file descriptors.
	[ab0fc2c1d8e1]

2005-07-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body.c:
	Several fixes to FETCHing MIME body parts. [n.MIME] was completely
	broken.
	[2dbd7232d7df]

	* src/lib-mail/message-parser.c:
	Boundary line could have been included in next message part's
	headers.
	[937ae4aec137]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf:
	Updates
	[16db33dd1bfd]

	* src/lib-imap/imap-parser.h:
	And removed the other added atom-specials as well..
	[f9a0db1ac3e8]

	* src/lib-imap/imap-parser.h:
	Removed ']' from atom-specials because our FETCH BODY[] handling
	fails then..
	[249a15abd572]

	* src/lib/ioloop-notify-inotify.c:
	Compile fix
	[a511aa565020]

	* src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c:
	If dnotify/inotify isn't in kernel, handle the errors silently and
	without leaking.
	[b3e135c37f06]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Notification was added to maildir root always, not to the actual
	mailbox that was being selected. Patch by Johannes Berg.
	[5f23ce0fee04]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-internal.h, src/lib/ioloop-
	poll.c, src/lib/ioloop-select.c:
	data -> context/ctx naming convention replaces
	[84a4f150bd00]

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-internal.h,
	src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c, src/lib
	/ioloop-notify-none.c, src/lib/ioloop.c:
	Added inotify patch by Johannes Berg and did some restructuring to
	ioloop notify internals.
	[465c465c66be]

	* src/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h:
	Updated IS_ATOM_SPECIAL() list and moved it to header file.
	[2d631ab1d90e]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	Try to prevent some broken keyword names.
	[33ec07ee3bcd]

	* src/lib-storage/index/index-fetch.h:
	Removed commented code.
	[3ec1032a4b69]

	* src/imap/cmd-select.c, src/lib-storage/index/index-status.c, src
	/lib-storage/mail-storage.h:
	Removed no-diskspace flag from status reply. It wasn't working and
	we're going to be using alert_no_diskspace callback anyway when it
	does work properly.
	[043466594f88]

	* src/lib/Makefile.am:
	Missing array-decl.h
	[b92ec14d29ef]

	* src/lib/lib.h, src/lib/sendfile-util.c:
	Include just "config.h", not "../../config.h". The absolute path
	breaks compiling elsewhere than source tree. It was earlier added to
	avoid some global config.h files, but those shouldn't exist..
	[bb88b67d72b2]

	* src/lib/compat.c:
	Added comment about config.h hack
	[ed186c6bbfd8]

	* src/auth/db-ldap.c, src/auth/db-passwd-file.c, src/auth/db-sql.c,
	src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/userdb-ldap.c,
	src/auth/userdb-passdb.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c, src/auth/userdb-sql.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c:
	Removed direct config.h including. I'm not sure why it was done
	before, probably to reduce compile times a few milliseconds. Ugly
	anyway..
	[9096b7957413]

	* src/imap/imap-search.c:
	'*' wasn't working in non-SEARCH messagesets.
	[d4eb5d9ee704]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c:
	Store new/ directory's timestamp in sync_size header in index
	(kludgy..). Fixed saving message into empty and non-synced
	mailboxes.
	[db29cc6754d5]

	* src/lib-storage/index/mbox/mbox-save.c:
	Keywords weren't saved to index while saving.
	[138e242c53c9]

2005-07-04  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-master-listener.c, src/imap/commands-
	util.c, src/imap/imap-fetch.c, src/lib-index/mail-cache-lookup.c,
	src/lib-index/mail-cache-transaction.c, src/lib-index/mail-cache.c,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-view.c, src
	/lib-index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log-append.c, src/lib-storage/index
	/index-mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-keywords.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/mail-storage.c, src/lib/array-decl.h, src/lib/array.h,
	src/lib/lib.h, src/master/mail-process.c:
	Moved array declaration to array-decl.h and include it in lib.h. So
	array.h needs to be now included to use any array_*() functions.
	[346a494c2feb]

	* src/imap/client.c, src/pop3/client.c:
	Call t_push/t_pop around client command execution function, so if
	client sends multiple commands at once we don't waste memory.
	[7e39590da48a]

	* src/auth/auth-worker-server.c:
	If auth worker socket isn't created yet when we try to connect to
	it, try for 5 seconds before aborting.
	[3e1d7dffb3a2]

	* src/imap/imap-search.c, src/lib-storage/index/index-search.c:
	Moved sequence set range checks to imap-specific code, so that
	SEARCH can accept sequence sets with sequence being larger than
	number of messages in mailbox.
	[b75125eced7f]

2005-07-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	Fetching message parts or virtual size from cache didn't work
	correctly and could have crashed.
	[c058c73776cc]

	* src/lib-storage/index/index-mail.c:
	If mail_cache_field_exists() returns -1, we can't assume the field
	can be used..
	[163f6efa6a0e]

	* src/lib-storage/index/mbox/mbox-save.c:
	Cache mail headers when saving mails to mbox. We should cache
	everything, but this is a start..
	[0661239a7034]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h:
	Mark *all* non-found headers that are registered in cache file as
	non-found at the end of header parsing.
	[693baa083a79]

	* src/lib-storage/index/index-mail.c:
	Don't crash if hdr.message-id isn't set in cache file.
	[19daba35107a]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache.h:
	Added mail_cache_register_get_list() to get a list of all registered
	fields in cache file.
	[b7ce2532250a]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h:
	Added imap_bodystructure_is_plain_7bit()
	[e8cbf3ae00db]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Added MAIL_CACHE_FLAG_TEXT_PLAIN_7BIT_ASCII to compress simple BODY
	and BODYSTRUCTURE replies into a single flag + message parts. Also
	did other cleanups.
	[8dbce791a1cc]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h, src/lib-
	storage/index/maildir/maildir-mail.c:
	Try to be a bit smarter about when to parse header/body.
	[0c264f105899]

	* src/lib-index/mail-index-sync-ext.c:
	Don't crash if extension array isn't initialized for index map.
	[b5885ba96ec8]

	* src/lib-storage/index/index-mail-headers.c:
	Don't store headers into cache file if they are already there.
	[5ec00b12f4db]

	* src/lib-mail/istream-header-filter.c:
	If we seek back to beginning of headers, don't call callback again
	for headers where it was already called for.
	[e04d4a496a0b]

2005-07-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-transaction.c:
	Saving messages crashed
	[8a175fd7e6e0]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Assert/cleanup
	[f140acbe46b4]

2005-07-01  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/printf-upper-bound.c, src/lib/sha1.c:
	Bad endianess fix. It required that LITTLE_ENDIAN and BIG_ENDIAN
	were already defined. Rather use WORDS_BIGENDIAN which configure
	already sets.
	[09a585f5ad4b]

2005-06-30  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/printf-upper-bound.c, src/lib/sha1.c:
	Define I_BYTE_ORDER macro ourself because BYTE_ORDER can't seem to
	be relied on. Fixes SHA1 giving wrong checksums at least in
	Solaris/sparc.
	[211f0c9588c2]

	* TODO:
	updated
	[5c92b51f2b38]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_update_const_data().
	[5f83939aab50]

	* src/lib-index/mail-index-transaction.c:
	Keyword changes weren't converted properly from sequences to UIDs.
	[ae213c3b4190]

	* src/lib-storage/index/maildir/Makefile.am, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-keywords.c, src/lib-storage/index/maildir/maildir-
	keywords.h, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/maildir/maildir-util.c:
	Keywords are stored in maildir filename and maildir-keywords file
	(backwards compatible with 0.99.x's .customflags file)
	[96de02ea7482]

2005-06-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	Merge changes from multiple index sync records into one before
	actually renaming maildir files.
	[113c888cdca1]

2005-06-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	index.c, src/lib-storage/index/index-mail.c, src/lib/array.h:
	Renamed array_modifyable_*() functions. I could never remember how
	they were named.
	[74475a126e2f]

	* src/auth/auth-worker-server.c:
	Compiler warning fix
	[82170d8364d3]

	* src/imap/cmd-append.c:
	crashfix
	[d4bde07451c4]

	* src/imap/cmd-append.c:
	Yet another try at fixing APPEND.
	[877fa3d04313]

	* src/pop3/client.c, src/pop3/commands.c:
	Don't treat known commands with (somewhat) invalid parameters as
	"bad commands" causing disconnection. Only unknown commands.
	[7888394f2985]

	* src/lib-mail/istream-header-filter.c:
	EOF change fix. Should finally properly fix APPEND.
	[2280ed0a9812]

	* src/imap/cmd-append.c:
	Yet another APPEND fix.
	[6beadbe3fc0d]

2005-06-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Fixed breakage caused by CRLF-support.
	[22d4fd7fd436]

	* src/imap/cmd-append.c:
	APPEND was broken because of recent eof-change in istream-limit.
	[2cb42efa44f6]

2005-06-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	We didn't notice if messages were deleted directly from new/.
	[3c51658d6846]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If we have rename()d more than 5 files from new/ to cur/, rescan the
	directory again to make sure we didn't skip any files.
	[6f7ce690358e]

	* src/lib-index/mail-cache-sync-update.c:
	mail_cache_delete() wasn't actually being called for expunged mails,
	so cache file kept growing without ever being compressed.
	[3a98900070ee]

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	When syncing mbox, update MD5 sum for mail if it changes. If we need
	MD5 sum but it's zero, resync mbox to get it.
	[d517de69f693]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-worker-client.c, src/auth/passdb-blocking.c:
	Last change caused user-given passwords to be cached, and later the
	password used instead of the real one (ie. login once with correct
	password, then you could login using whatever password as long as
	user is cached). Clearly not good. Did several changes to make sure
	this can't happen again.
	[079ec5c2d665]

2005-06-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c, src/auth/passdb-cache.c:
	Auth cache wasn't working if password wasn't given (ie. didn't work
	for proxying).
	[27fb8c9202e2]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Handle CR+LF linefeeds
	[ae472460757b]

	* src/lib-index/mail-index-transaction.c:
	Another empty-keyword-list fix with 64bit systems
	[2f823f8fd1d6]

	* src/lib-index/mail-index-transaction.c:
	mail_index_keywords_create() crashed with 64bit systems and not
	exactly correct with 32bit systems either, if it was given empty
	list of keywords.
	[7091a2e5a52c]

2005-06-14  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	If username changes, log the change if debugging is enabled.
	[3f7575e43202]

	* src/auth/passdb-pam.c:
	Allow PAM to modify username.
	[81ebb30e5ea5]

	* src/auth/auth-worker-server.c:
	Destroying auth workers leaked fd.
	[4233ba7f57b6]

2005-06-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-content-parser.c:
	Fixed parsing multiple parameters
	[12640d81175d]

2005-06-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-limit.c:
	Set stream->eof immediately after we have read up to our limit.
	[61ea539ee5f1]

2005-06-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-sql.c, src/auth/db-sql.h, src/auth/passdb-sql.c,
	src/auth/userdb-sql.c:
	Don't connect to SQL database in main dovecot-auth process if we're
	using workers to do it.
	[28be9a80908e]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/sql-api-private.h, src/lib-sql/sql-api.c, src/lib-sql/sql-api.h:
	Added sql_connect() to do explicit connecting. sql_init() no longer
	does.
	[c624ffa9e6f0]

	* src/lib-sql/driver-mysql.c:
	Make MySQL connect abort in 10 seconds if it can't connect.
	[d1b0dfa6572b]

	* src/lib/lib-signals.c:
	Ignore SIGALRM, but not with SIG_IGN as it causes syscalls to
	restart.
	[b97914e7c941]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-storage.h:
	Use macros when using W and S extras too.
	[37bbed99b90b]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c:
	Replaced ':' and ',' character usages with #defines, so they can be
	changed easily if needed.
	[b0bdf32564b7]

	* src/lib/restrict-access.c:
	32bit UID/GIDs were truncated
	[27312b7941e9]

2005-06-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cache.c:
	Count cache hits and misses, report them on SIGUSR2.
	[4e36a99268dd]

	* src/auth/auth-worker-client.c, src/auth/auth-worker-client.h,
	src/auth/main.c:
	Auth workers were leaking memory for each request. Fixed also a few
	invalid memory accesses at deinitialization.
	[c2497d4c60c9]

2005-06-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Added assert
	[b0b83a2fba69]

	* src/lib-storage/index/index-mail.c:
	Don't pass NULL date to message_date_parse(). It crashes nowadays.
	[27d15196e53e]

	* doc/variables.txt:
	Update for login_log_format_elements setting.
	[77ad773054dd]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf:
	Don't list password schemes in the files. They just get out of date.
	[a9b623236dd3]

2005-06-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/Makefile.am, src/lib-mail/message-tokenize.c, src/lib-
	mail/message-tokenize.h:
	Removed message-tokenizer code. All code using it was finally
	replaced with rfc822-parser API.
	[4748506a4095]

	* src/imap/imap-thread.c:
	Changed Message-ID parser to use rfc822-parser API.
	[9bdf82fd33e1]

	* src/lib-imap/imap-bodystructure.c:
	Make Content-Language parser use rfc822-parser API.
	[f484ad51ad9f]

	* src/lib-mail/message-date.c:
	Make date parser use rfc822-parser API.
	[1f378ca8d95d]

	* src/lib-mail/message-content-parser.c:
	Skip initial LWSP
	[f93a32d1c6b0]

	* src/lib-mail/message-content-parser.c:
	Converted MIME Content-* header parser to use rfc822-parser API.
	[ce3b55886a1e]

	* src/lib-mail/rfc822-parser.c, src/lib-mail/rfc822-parser.h:
	Added rfc822_parse_mime_token() to rfc822-parser API.
	[e64f8694b3f3]

2005-05-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	Changed output handler to work a bit differently to avoid useless
	io_remove/io_add calls.
	[513abd166949]

	* src/lib/ostream-file.c:
	Set output I/O handler after output callback if needed.
	[c19d6448f856]

	* src/lib/network.c:
	Don't return random data if net_getpeername() or net_getsockname()
	is used for non-inet/inet6 socket.
	[ddfa507bb74f]

2005-05-28  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-server.c:
	If all auth workers have died, don't complain and fail but just
	create and use the new process.
	[c8777e7773f8]

	* src/auth/auth-worker-client.c:
	If worker process has been idle for 10 minutes, make it kill itself.
	[97b996dd5942]

	* src/auth/auth-request.c:
	auth_request_set_field() shouldn't save password to extra_fields.
	Fixes a crash with auth_cache enabled and at least with SQL/LDAP
	passdbs.
	[2db396230881]

	* src/lib/istream-seekable.c:
	Seekable stream was broken after its memory limit was reached and it
	started using temporary file.
	[a176b7d20895]

	* src/lib/ostream-file.c:
	Don't remove output handler if flush_pending is still set after
	callback.
	[5573554dce0c]

	* src/pop3/client.c:
	Small optimization
	[30099e1ccf97]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Call i_stream_sync() a bit more often, especially before checking
	file size to make sure it's not cached. Changed an assert to
	critical error.
	[2e7359e17b4c]

2005-05-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	Don't forget o_stream_set_flush_pending() call if it's called in
	flush callback which returns 1.
	[e8c0736ec5be]

2005-05-24  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	Code cleanup. Removed useless previous "fix".
	[d01de9d362c1]

2005-05-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Keyword resets were written using sequences to transaction log,
	which caused keyword breakages.
	[0a4769c38183]

	* src/deliver/deliver.c:
	Parse also pop3_uidl_format setting for %m case, so we know to save
	the MD5 sum while parsing mbox.
	[70c200deddf7]

	* src/pop3/commands.c:
	If we couldn't get UIDL, also write error to log.
	[814ba0c6877f]

	* src/pop3/commands.c:
	RSET command wasn't working right
	[bfb2658a2616]

2005-05-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c, src/auth/auth-request.c:
	Master connection's USER command was leaking memory (with deliver
	binary).
	[e4b84d82c685]

	* src/lib/imem.c, src/lib/strfuncs.c, src/lib/strfuncs.h:
	If p_malloc() used data stack (with DEBUG enabled it might have
	written a warning about growing memory pool), p_strconcat() gave
	corrupted reply. It also didn't work correctly if the given pool was
	a data stack.

	Also made i_strconcat() to be sure it doesn't break if
	default_pool's p_malloc() for some reason would some day use data
	stack.
	[fe4a297379fc]

2005-05-14  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client-authenticate.c, src
	/imap-login/client.c, src/login-common/client-common.c, src/login-
	common/client-common.h, src/login-common/common.h, src/login-
	common/main.c, src/login-common/sasl-server.c, src/master/login-
	process.c, src/master/mail-process.c, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3/client.c, src/pop3/client.h,
	src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Added configurable logging for login process. Added configurable
	pop3 logout string. Based on a patch by Andrey Panin.
	[3b75956d20c4]

	* src/lib-storage/index/mbox/mbox-sync.c:
	We didn't keep dirty flag state long enough.
	[bfba2219b586]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	last-uid fix
	[f3696949cb7c]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c:
	uid-last offset change fixes.
	[91cc142dd4a2]

	* src/lib-index/mail-cache.c:
	Pointers into file cache may change as a result of
	file_cache_write().
	[bf654e4789a1]

	* src/lib-index/mail-cache-lookup.c:
	Error handling fixes
	[f8bf5e2a7fb0]

	* src/lib/file-cache.c:
	Optimizations
	[6334d2ef2ba5]

	* src/lib/file-cache.c:
	still wrong..
	[aac83c891ff9]

	* src/lib/file-cache.c:
	fix
	[7172331c2a7e]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c:
	Whenever writing to cache file, also updated file_cache. Fixes
	problems with mmap_disable=yes.
	[9e2abc4c341c]

	* src/lib/file-cache.c, src/lib/file-cache.h:
	Added file_cache_write() to update cached memory area.
	[8b2dd340e16d]

2005-05-13  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	if using IPv6, bind both on the IPv4 and IPv6 addresses if
	IPV6_V6ONLY is defined. Patch by Marco d'Itri
	[690dcc51cdc1]

	* src/pop3/client.c:
	Fixed output getting stuck when transmit buffer was full.
	[7e046c4cba1f]

2005-05-11  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-cache.c:
	Cache bitmask was still used wrong, maybe now..
	[4bb8af354951]

	* src/lib/file-cache.c:
	Cache decisions were completely wrong for file sizes larger than
	32kB.
	[9f841114991d]

2005-05-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Fix to mmap_disable=yes syncing
	[b4a462cc8737]

	* src/lib-index/mail-transaction-log.c:
	Delete transaction log.2 file if we detect it's corrupted.
	[1069b25164d1]

	* src/auth/passdb-vpopmail.c:
	Don't replace request->user with vpw->pw_name. It drops domain part
	and causes userdb lookup to fail.
	[06fc33bcfa28]

	* src/auth/passdb-vpopmail.c:
	Compile fix
	[548499249451]

	* src/auth/mycrypt.c:
	No, #define _XPG6 was after all pre-Solaris10 hack...
	[90d28c4c0199]

2005-05-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/mycrypt.c:
	Added comment
	[545e79f8605b]

	* src/lib-index/mail-index-view.c:
	Added assert
	[9bd37fc2ce36]

	* src/auth/mycrypt.c:
	No, The _XPG6 define is still needed with final Solaris 10 release..
	[6dc8f3e572ee]

	* src/master/auth-process.c:
	Make auth worker processes work with chroot enabled.
	[5cb55f703d9b]

	* src/imap-login/client.c, src/pop3-login/client.c:
	STARTTLS was broken
	[8df4cfb22171]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Added some error handling code to prevent assert crashes.
	[455b4a29166c]

	* src/imap/cmd-expunge.c, src/imap/imap-sync.c, src/lib-index/mail-
	index-view-sync.c:
	Removed SYNC_FAST_FLAG from EXPUNGE command. Changed delay-newmail
	workaround to also delay EXPUNGE notifications, otherwise things
	break. Changed index to force this with assert.
	[d6723f532d26]

	* src/pop3/commands.c:
	If we couldn't fetch header MD5/filename for UIDL, abort instead of
	giving invalid UIDL.
	[2d8874b023ea]

2005-05-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c, src/lib/imem.h:
	Added i_free_and_null() macro and first use case.
	[02479b3894cc]

	* src/lib/mempool-alloconly.c:
	Compiler warning fix without DEBUG.
	[ab3b9ed3a1a5]

2005-04-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	If data inside headers was moved within the first mail, we might
	have gotten "uid-last unexpectedly lost" error.
	[683ca23b94f7]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h:
	Check broken flag counter values every time when updating them.
	Added fsck-flag to index header, if it's set do fsck when opening
	index and when syncing.
	[286cc0cd888a]

	* src/pop3/client.c:
	Connection could have gotten stuck sometimes, doing nothing until
	idle timeout happens.
	[75cfcf7736a7]

	* src/lib-index/mail-transaction-log-view.c:
	Added offsets to log file corruption error messages
	[63fc076992bf]

	* src/lib-index/mail-transaction-log.c:
	Updated timeouts
	[2af6d96e4134]

	* src/lib-storage/index/index-storage.c:
	Don't require notify_ok/notify_no callbacks to be set. Fixes crash
	in deliver when mbox locking messages were supposed to be shown.
	[2fb11d57a734]

	* src/lib-storage/index/mbox/mbox-save.c:
	Crashfix for some failure handling.
	[34dea04a191e]

2005-04-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	If mbox has a pseudo mail, we skipped message updates in partial
	syncs.
	[12ee3c0ee2c9]

2005-04-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-util.c, src/lib-index/mail-transaction-util.h:
	Expunge code cleanups.
	[8e093a2cc8db]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't always sync full mbox if first message is the pseudo mail.
	[5b6d91616e08]

	* src/lib-index/mail-index-sync.c, src/lib-storage/index/index-mail.c,
	src/lib-storage/index/index-storage.c:
	Compiler warning fixes when DEBUG enabled.
	[09457ba69253]

	* src/lib/array.h:
	Still more changes to how typeof() is used. Now it finally seems to
	be working nicely.
	[239520983a32]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-transaction-log-
	private.h, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c:
	Minor error checking fixes.
	[43d4aad84752]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync.c:
	If we see mbox offsets break, don't invalidate whole index but
	rather force resyncing.
	[fa9fd105fae3]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Don't try to handle UIDVALIDITY changes nicely after all. It causes
	problems when within same transaction there are two different set of
	UIDs being used.
	[9c8220dfde7c]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c:
	If uid-last isn't actually updated while rewriting first message,
	don't assume it is. Fixes bogus "uid-last changed" errors.
	[5cf828dbcd32]

	* doc/auth-protocol.txt, src/auth/auth-master-connection.c, src/auth
	/auth-request-handler.c, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/auth-worker-client.c, src/deliver/deliver.c:
	USER auth command requires now service parameter and supports also
	others parameters. Fixes a crash in dovecot-auth with deliver+mysql.
	[e5ce49c8524a]

	* src/lib/ostream-file.c:
	Try to flush output before uncorking
	[b47043d0d131]

	* src/imap/client.c, src/imap/imap-fetch-body.c, src/lib/ostream-
	crlf.c, src/lib/ostream-file.c, src/lib/ostream-internal.h,
	src/lib/ostream.c, src/lib/ostream.h, src/pop3/client.c:
	o_stream_uncork() was previously always setting IO_WRITE handler
	even if there was no reason for it. This was relied on in imap/pop3
	code when a handler could just send as much data as it can without
	actually buffering anything.

	So, removed the IO_WRITE handler forcing. It's only set if there's
	actually data in buffer or if flush_pending is set (via
	o_stream_set_flush_pending() or by returning 0 from flush callback
	handler).

	All in all, a minor optimization.
	[a3a72d5bdfce]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If X-UIDs hadn't yet been written, we resynced everything after the
	first message we had to sync.
	[ae6f1b54cd59]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Dirty flags weren't being updated correctly. Caused the same
	messages to be rewritten over and over again, or skipping some
	messages causing lost flag changes.
	[9eaead79577c]

2005-04-23  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	Remove compiler warnings with non-DEBUG.
	[4cbb7b67bc98]

	* src/imap/cmd-create.c:
	Don't do invalid memory accesses if trying to create empty mailbox
	name.
	[87edfd6d5151]

	* src/lib/istream-seekable.c:
	Allow non-first streams also to have pending data.
	[98da89360e81]

	* src/lib/istream-seekable.c:
	Fixes.
	[7ca646fc4107]

	* src/Makefile.am:
	Also use the --without-deliver option to not build it :)
	[e29f61128b51]

	* configure.in:
	Added --with-deliver option.
	[fdac6810fe64]

	* configure.in, src/login-common/Makefile.am, src/master/Makefile.am:
	Added --with-rundir configure option.
	[ce0733b39311]

	* src/deliver/deliver.c:
	save_mail() returns 0 if successful, not if failed..
	[5949ce51755b]

	* src/lib-storage/index/index-search.c:
	Don't call index_mail_parse_header() twice when searching headers.
	Caused assert-crashes.
	[38eaa792c405]

	* src/auth/passdb-ldap.c:
	LDAP passdb finally should work again.
	[2a8ff9cbb50b]

	* src/auth/passdb-ldap.c:
	Added more LDAP debugging.
	[2e153b23b830]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index.h, src/lib-index/mail-
	transaction-log-append.c, src/lib-storage/index/maildir/maildir-
	sync.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	If UIDVALIDITY changes, don't invalidate the whole index. Just
	expunge all existing messages and update uidvalidity/nextuid fields.
	Now we don't have to re-login when this happens.
	[49071cc19102]

	* src/lib-index/mail-index-sync-update.c:
	When removing recent flags, we didn't update the recent flag count
	in header.
	[be9bf789a1d4]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c:
	index.log file is now rotated to .index.log.2 file. When log file is
	missing, it's used if the wanted log is in it.
	[0403596c93fd]

	* src/auth/auth-master-listener.c:
	Crashfix
	[850e150beec8]

	* src/auth/auth-request.c, src/auth/mech-anonymous.c, src/auth/mech-
	apop.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth/mech-
	plain.c, src/auth/mech-rpa.c:
	Grow default auth_request pools to 512 bytes per request.
	[04867ddac911]

	* src/lib-index/mail-transaction-log.c:
	Don't crash if dotlock replacing failed.
	[a19268b76093]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-transaction-log.c:
	s/PREFIX/SUFFIX/ for .cache and .log filename suffixes..
	[62d31be5ae60]

2005-04-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Error message fix.
	[ced373b587a9]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Fixes to expunging first mail.
	[3f0c6ed4a950]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	When first message was expunged we might have gotten "uid-last
	unexpectedly lost" errors.
	[2fbb6e7ca781]

	* src/lib/mkdir-parents.c:
	Ignore if mkdir() returns ENOSYS. It probably means we tried to
	mkdir a (NFS) mount point.
	[3cd4ae5f1210]

2005-04-21  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c:
	We weren't sending proxy's password back with blocking passdb.
	[1de641419e81]

	* src/auth/passdb-sql.c:
	Allow password field to be NULL. Needed with proxies.
	[0bd02518613a]

2005-04-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	Crashfix in error conditions
	[46ca6b941177]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-master-connection.c,
	src/auth/auth-master-connection.h, src/auth/auth-master-listener.c,
	src/auth/auth-master-listener.h, src/auth/auth-request-handler.c,
	src/auth/auth-request-handler.h, src/auth/auth-request.h,
	src/auth/main.c:
	Allow multiple master connections for a single listener.
	[3f090bcaffcc]

	* src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/main.c:
	Exit only if all master connections are lost, not only if one of
	them is.
	[38754475d3b6]

2005-04-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	If both userdb and passdb used LDAP the later one was overriding
	first one's attribute names.
	[aebed9a9edac]

	* src/imap/cmd-list.c:
	LSUB was returning namespace prefixes.
	[cccb5c6ba946]

	* src/lib-index/mail-transaction-log-view.c:
	If transaction log file is lost, mark the index inconsistent. Later
	we should try to autocreate the missing log files..
	[c8c7a12d2922]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't break with empty mbox files when we're not delay-writing and
	the mailbox hasn't always been empty.
	[64814c4d5c7c]

	* src/imap/imap-sort.c:
	Don't crash if SORT elements don't contain headers.
	[701526ef703f]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-search.c:
	Don't even try to allow searching zero number of headers.
	[dd19f2e8575f]

	* src/lib-storage/mail-search.c:
	Some possible fix for HEADER searches and cleanup
	[23fceec1e5c9]

	* src/imap/imap-fetch-body.c:
	Don't allow FETCH BODY[HEADER.FIELDS ()], ie. empty list.
	[361ce931354e]

	* src/lib/ioloop-poll.c:
	If we get POLLNVAL, call the callback anyway so it hopefully gets
	rid of the condition.
	[ed7e4f7a2315]

	* src/lib-storage/index/index-mail-headers.c:
	Raised initial pool sizes.
	[b596431525d3]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-append.c:
	mmap_disable=yes: Transaction log might have been rotated before
	everything was committed to index.
	[c2b8904dc21b]

	* src/lib-index/mail-index-sync-update.c:
	If we're updating only log_file_ext_offset but log file sequence has
	changed, update log_file_int_offset also to beginning of next file.
	Fixes assert in mail_transaction_log_view_set().
	[98923db29e39]

2005-04-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth.c, src/lib-index/mail-index.c, src/lib-sql/driver-
	mysql.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib/env-util.c, src/master/master-settings.c:
	Raised initial pool sizes.
	[4600e247da86]

	* src/lib/buffer.h:
	Added BUFFER_APPROX_SIZE which can be used to approximately
	calculate the memory used by buffer struct itself.
	[f8472ced34c0]

	* src/auth/userdb-passwd.c:
	Try to detect buggy NSS implementations.
	[6448d35f8349]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't assert-crash with 0-byte sized "mboxes".
	[611ae3edc1fe]

2005-04-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail.c:
	Don't return void.
	[f82f434a9fdc]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Removed extra 0-initializers from struct storage initializers. They
	used to be there because -W gave warnings with gcc, but newer
	versions seem to be silent as long as C99 style member initializers
	are used. Also fixes a compiling problem with some non-gcc
	compilers.
	[92dd47097bc8]

	* src/lib-storage/index/index-mail-headers.c:
	mail_get_headers() and mail_get_first_header() returned headers with
	"name:" prefix if they weren't in cache file.
	[1fae8494f8f7]

	* src/master/mail-process.c:
	Send all unrecognized parameters from userdb to imap/pop3 processes.
	Useful for passing plugin parameters.
	[47437871d879]

2005-04-11  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	We weren't calling mail_storage_init() at startup so we crashed.
	[def87e4ad3a5]

2005-04-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/array.h:
	ARRAY_CREATE() macro fix. Wasn't working in all situations.
	[ed782bb26632]

	* configure.in, dovecot-config.in:
	Added
	[451a38ca83bb]

2005-04-08  Timo Sirainen  <tss@iki.fi>

	* src/lib/array.h:
	Added ARRAY_DEFINE_EXTERN().
	[21f30709ead8]

	* src/lib-storage/mail-storage.c:
	Linked list -> array
	[6d5f47f5b05b]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Since we always parse the first message now, there's no need ever to
	do sync_restart.
	[bbb22ca660e0]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-list.c, src
	/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Created mbox_storage and maildir_storage.
	[2c72492dfd91]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-transaction.c, src/lib-storage/index/maildir/maildir-
	uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-file.h, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	lock.h, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox/mbox-
	transaction.c:
	Moved mbox/maildir-specific variables from struct index_mailbox to
	mbox_mailbox and maildir_mailbox.
	[b698ae839a18]

	* src/auth/mech-plain.c, src/lib-index/mail-cache-fields.c, src/lib-
	index/mail-cache-lookup.c, src/lib-index/mail-cache.h, src/lib-index
	/mail-index-view-sync.c, src/lib-index/mail-index.h, src/lib-mail
	/istream-header-filter.c, src/lib-mail/istream-header-filter.h, src
	/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	Several size_t -> unsigned int changes. Try to keep "unsigned int"
	for counters, size_t for actual memory range sizes.
	[df372eecc5d0]

	* src/lib-index/mail-cache-transaction.c:
	buffer -> array
	[f022867fb58d]

	* src/lib-imap/imap-parser.c:
	Removed element_count variable, it's not used anymore.
	[b9717fe3bcf3]

	* src/lib-mail/message-address.c:
	local-part in message address can be quoted-string as well.
	[7892e3febad6]

	* src/auth/auth-request.c, src/auth/passdb-cache.c:
	Don't crash if cache is enabled and we're caching more than just
	password.
	[859c4ffd514e]

	* src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	Don't crash if password lookup failed.
	[9860bab7b7e3]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/passdb-
	cache.c, src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	Try to keep scheme always included in auth_request->passdb_password.
	[36db3285f4a7]

	* src/lib-index/mail-cache.c:
	Don't crash at mail_cache_lock() if mail_cache_map() fails.
	[55bc96b23bc1]

	* src/imap/cmd-status.c:
	STATUS command was replying with wrong hierarchy separator if it
	wasn't default one.
	[ae58b4d08de2]

	* src/lib/strfuncs.c:
	t_strarray_join() wasn't actually marking the memory allocated that
	it was returning from data stack. So it might have returned garbage.
	[23d49122f015]

	* src/lib-index/mail-index-transaction.c:
	If keyword was set for message whose seq != uid, we broke index.
	[354bfcbc01d3]

	* src/lib-mail/istream-header-filter.c:
	Don't panic in stat(). o_stream_send_istream() wants to know the
	file size. It settles for "unknown" fine, so return that.
	[10d67baec28f]

	* src/auth/passdb-vpopmail.c:
	Compile fix.
	[beaa5ff9d86a]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	Large mbox code cleanups, especially related to X-IMAP/X-IMAPbase
	header handling. uid-next field is updated now every time while
	syncing.

	If partial syncing failed, we weren't re-requesting all sync records
	from index, which could have caused some changes to be lost, and
	possibly caused some index corruption errors later on.

	Several other more or less possible problems fixed.
	[cb62447e3e75]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h:
	Added mail_index_sync_reset() to restart syncing from beginning.
	[98e3001ca527]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Non-Recent Status-flag wasn't updated correctly.
	[fb34cde02ac8]

	* src/lib-storage/index/mbox/mbox-save.c:
	Don't crash while saving message if keywords aren't given..
	[f1134d265a9d]

	* src/lib-storage/index/index-storage.c:
	Last cleanup broke opening mailboxes completely.
	[74f5843576d0]

2005-04-03  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/imap/namespace.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/pop3/client.c, src/pop3/main.c:
	Moved several getenv()s from lib-storage to main code. deliver
	binary was missing several getenvs..
	[6a179bf1272e]

	* dovecot-example.conf, src/imap/common.h, src/imap/imap-fetch-body.c,
	src/imap/main.c:
	Removed tb-negative-fetch workaround. It shouldn't be needed anymore
	because of the FETCH ordering changes.
	[9ea318f232e0]

	* doc/dovecot-sql.conf:
	Added information about "user" column.
	[4fb1a08bfa11]

	* src/auth/auth-request.c, src/auth/auth-worker-client.c, src/auth
	/passdb-blocking.c, src/auth/passdb-bsdauth.c, src/auth/passdb-
	passwd-file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c,
	src/auth/passdb-vpopmail.c:
	passdb can now change the username that was used to log in. This is
	mostly useful to support case-insensitive username lookups.
	[92c16e82b806]

	* src/auth/auth-worker-client.c:
	Auth workers weren't working correctly with more than one
	passdb/userdb.
	[c18ab708f71c]

	* src/deliver/deliver.c:
	Compile fix for recent mailbox_open() API change.
	[c29326c157da]

	* src/imap/client.h, src/imap/cmd-append.c, src/imap/cmd-select.c,
	src/imap/commands-util.c, src/imap/commands-util.h, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-sync-keywords.c, src
	/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-index
	/mail-transaction-log-append.c, src/lib-storage/index/index-mail.c,
	src/lib-storage/index/index-mail.h, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-
	storage.h, src/lib/array.h:
	Keywords are now stored in X-Keywords headers in mbox. Did several
	related API changes to get better performance.
	[a2943c050571]

2005-04-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-private.h, src/lib/array.h:
	Added ARRAY_DEFINE_PTR() which needs to be used instead of
	ARRAY_DEFINE() for pointers.
	[f5a1c3f7fd72]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_cmp().
	[fb9eee567307]

	* src/imap/imap-fetch-body.c:
	Fetching partial headers crashed because of recent changes.
	[3544d971e7da]

2005-03-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h,
	src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Recent flag handling cleanups. Added some comments.
	[3b820e59610e]

	* src/imap/imap-sort.c:
	SORT might have crashed just before finishing.
	[c913cf1dfb08]

	* src/imap/imap-sort.c, src/imap/imap-thread.c, src/lib-storage/index
	/index-mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-search.c,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.h, src/lib-storage/mail.c:
	Renamed mail_get_header() to mail_get_first_header() and
	mail_gets_headers() to mail_get_header_stream(). Added new
	mail_get_headers() which returns NULL-terminated string list of all
	found headers.
	[ff47e78ad717]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	Changed some buffers to arrays.
	[e7166e2f8b9b]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't crash when closing streamed mbox.
	[3957eece913f]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-select.c,
	src/imap/cmd-status.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-file.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/pop3/client.c:
	Added input stream parameter to mailbox_open(). With mbox it now
	allows opening a read-only mbox using a stream.
	[6491dab63e54]

	* src/lib/Makefile.am, src/lib/istream-seekable.c, src/lib/istream-
	seekable.h:
	Added istream-seekable, which allows combining multiple input
	streams and creating a single seekable stream out of them.
	[f104e4197ac1]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache.c, src
	/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-private.h, src/lib-index/mail-transaction-log.c:
	In-memory indexes work again. Just pass dir as NULL to
	mail_index_alloc().
	[40b4ba3c55b8]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	i_stream_sync() replaced istream_raw_mbox_flush(). Use
	i_stream_stat() instead of fstat() directly. Now we have the
	possibility to use istreams as read-only mboxes.
	[9a08cf5e5f61]

	* src/lib-mail/istream-header-filter.c, src/lib/istream-data.c,
	src/lib/istream-file.c, src/lib/istream-internal.h, src/lib/istream-
	limit.c, src/lib/istream-mmap.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/ostream-file.c:
	Replaced i_stream_get_size() with i_stream_stat(). Added
	i_stream_sync().
	[b79853b4b005]

	* src/lib/istream-internal.h, src/lib/istream.c, src/lib/istream.h:
	i_stream_next_line() works now even if the stream buffer can't be
	directly modified.
	[a6af023db10d]

2005-03-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c, src/lib/istream-data.c,
	src/lib/istream-file.c, src/lib/istream-limit.c, src/lib/istream-
	mmap.c, src/lib/istream.h:
	Added seekable variable to struct istream.
	[904a268921af]

2005-03-27  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	Changed alloconly pools to call malloc() only once when creating the
	pool. Pool names aren't used anymore without DEBUG. Don't
	immediately double the pool's initial size for the first allocated
	block.
	[889a584bd953]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Added setegid() emulation for HP-UX.
	[2f57438d9542]

	* configure.in:
	oops, broke fd pass check completely
	[f6eb50f0d2c0]

	* configure.in:
	Make sure "whether fd passing works" check doesn't get stuck (HP-UX
	fix).
	[d20aee22af6a]

	* src/lib/Makefile.am, src/lib/buffer.c, src/lib/istream-file.c,
	src/lib/mempool.c, src/lib/mempool.h, src/lib/ostream-file.c:
	Added pool_get_exp_grown_size(). Use it for buffers, istreams and
	ostreams when buffer needs to grow. Optimizes memory usage a bit.
	[06f9da4ff7a5]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool-unsafe-datastack.c,
	src/lib/mempool.h:
	Added p_get_max_easy_alloc_size().
	[6396b4c0a721]

	* src/lib/data-stack.c, src/lib/data-stack.h:
	Added t_get_bytes_available().
	[8508869ab276]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync.c,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h:
	Changed keywords_buf to array. Added mail_index_sync_get_keywords().
	[f778bd8b228f]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	Changed mails and syncs buffers to arrays.
	[b85a96766a15]

2005-03-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-ntlm.c:
	Fixes incorrect error message and adds missing hex_to_binary()
	return value check. Patch by Andrey Panin.
	[bb7282d1e2da]

	* src/auth/mech-rpa.c:
	Proper realm support for RPA. Now RPA will use auth_realms and
	auth_default_realm configuration parameters instead of my_hostname
	variable. Patch by Andrey Panin.
	[e2d7f1db71e3]

	* src/auth/auth-worker-client.c:
	Previous blocking passdb patch fixed APOP only. Fixing others now.
	Patch by Andrey Panin.
	[ce26413ea766]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Blank line was missing at the end of the created pseudo mail.
	s/dummy/pseudo/ to be more consistent.
	[2d19bc073996]

	* src/lib-mail/message-address.c:
	Skip LWSP at the beginning of address.
	[43d862951f90]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index.c:
	Added sync/sync_lost/expunge handler unregistering, and also do
	that. Fixes crash with mmap_disable=yes when reopening mailbox.
	[f6e0d1826645]

2005-03-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Array code changes broke setting old_data_r in
	mail_index_update_ext(). This kept breaking cache file.
	[f3c1a9a32a8e]

	* src/lib-index/mail-index.c:
	mail_index_write_base_header() didn't update the header in memory
	with mmap_disable=no. It's used only with error correction, so after
	failure trying to reopen index failed every time.
	[e38e04c7c67c]

	* src/lib-storage/index/mbox/mbox-save.c:
	If want_mail = TRUE for mbox_save_init() and we sync the mbox, we'll
	have to open a new view to get the next_uid or it might not be
	updated.
	[af8fc972fe95]

	* src/lib-index/mail-index-view-sync.c:
	Added assert.
	[0220c7d37fc8]

	* src/imap/cmd-append.c:
	Eat away the finishing empty line if APPEND failed so we don't send
	"* BAD" error to client.
	[b9e8420d979a]

	* src/lib-index/mail-transaction-log.c:
	If transaction log record size is too large, mark the file
	corrupted.
	[746c309e366c]

2005-03-18  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	We weren't returning "root name" properly with LIST <ref> "".
	[23e5925c48dd]

	* src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-
	fetch.h:
	Send buffered fetch items to client first. Fixes kmail and
	Thunderbird issues..
	[8632ec8486c6]

	* src/lib-index/mail-transaction-log-append.c:
	Compiler warning fix
	[929091768426]

	* src/lib/array.h:
	ARRAY_SET_TYPE() in non-DEBUG-mode was giving errors with older gccs
	if it was used at the beginning of a function (function can't start
	with ";").
	[e3f6748c59ba]

2005-03-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c, src/auth/passdb.c, src/auth/passdb.h:
	Non-plaintext blocking passdb authentication wasn't working. Patch
	by Andrey Panin.
	[69b056a3657f]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	LDAP crashfixes.
	[eb840633c9bf]

	* src/lib-storage/index/mbox/mbox-mail.c:
	get_physical_size() was crashing if mbox hadn't been opened yet.
	[4f3e4c8e458f]

2005-03-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-status.c,
	src/imap/commands-util.c, src/imap/commands-util.h:
	mailbox_name_equals() renamed to mailbox_equals(), which also now
	checks that mail storages match. Fixes problems with copying
	messages from one namespace to another between identically named
	mailboxes.
	[2715077f9c3e]

	* src/deliver/deliver.c, src/imap/cmd-append.c, src/imap/cmd-copy.c,
	src/imap/cmd-search.c, src/imap/cmd-store.c, src/imap/common.h,
	src/imap/imap-expunge.c, src/imap/imap-fetch-body.c, src/imap/imap-
	fetch.c, src/imap/imap-fetch.h, src/imap/imap-sort.c, src/imap/imap-
	sync.c, src/imap/imap-thread.c, src/imap/main.c,
	src/imap/namespace.c, src/lib-storage/Makefile.am, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-transaction.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/index/mbox/mbox-
	transaction.c, src/lib-storage/mail-copy.c, src/lib-storage/mail-
	copy.h, src/lib-storage/mail-storage-private.h, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h, src/lib-
	storage/mail.c, src/lib-storage/proxy-mail-storage.c, src/lib-
	storage/proxy-mail-storage.h, src/lib-storage/proxy-mail.c, src/lib-
	storage/proxy-mail.h, src/lib-storage/proxy-mailbox.c, src/lib-
	storage/proxy-mailbox.h, src/pop3/client.c, src/pop3/commands.c:
	Major mail-storage API changes. It's now a bit cleaner and much more
	plugin friendly. Removed proxy_mailbox* stuff, they were difficult
	to use and there's now much easier way to replace them.
	[923ff19873d4]

	* src/lib/array.h:
	Added ARRAY_INIT for initializing array_t in structs.
	[b5fd010a4454]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/mail-storage.h:
	Include transaction pointer in struct mail.
	[605c71410c67]

	* configure.in:
	Limit TIME_T_MAX_BITS to 40.
	[6400a517f087]

2005-03-14  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	listen port comment updates. Patch by Reuben Farrelly.
	[0ddbe4de5a84]

	* dovecot-example.conf, src/imap/cmd-fetch.c, src/imap/common.h,
	src/imap/imap-sync.c, src/imap/main.c, src/lib-storage/index/index-
	sync.c, src/lib-storage/mail-storage.h:
	Renamed oe6-fetch-no-newmail workaround to delay-newmail and changed
	it to work more like the name says: only newmail notifications are
	skipped and not only for FETCH command.
	[c8fffa286b6a]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index.h, src/lib-index/mail-transaction-util.c, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	sync.c:
	mail_index_sync_next() now returns keyword updates (now only thing
	left to do is to fix maildir and mbox syncing to use them).
	[391a1064872e]

	* src/auth/mycrypt.c:
	Remove #define _XPG6 after all. It was used to avoid #error in
	Solaris 10 pre-release, but now it breaks the compile in 10 final...
	[2661cfd533c0]

	* src/lib-mail/message-address.c:
	If mailbox name was missing from message address, we didn't set it
	to MISSING_MAILBOX as we should have, which caused crashing if the
	field was tried to be SEARCHed. Also cleaned up the code a bit.
	[2bf86099376e]

	* src/lib-storage/index/mbox/mbox-sync.c:
	When writing the dummy message after all messages were expunged from
	mbox, the UIDVALIDITY value was set to 0 if X-IMAP/X-IMAPbase header
	wasn't read. This caused the next parsing to treat the header
	invalid and didn't recognize it as dummy message.
	[a9a5a399a027]

2005-03-13  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/Makefile.am, src/deliver/.cvsignore,
	src/deliver/Makefile.am, src/deliver/deliver.c:
	Added initial version of Dovecot LDA.
	[938f948651f1]

	* src/auth/passdb-pam.c, src/lib/data-stack.c, src/lib/ioloop-epoll.c,
	src/lib/mempool-alloconly.c, src/lib/mempool-system.c, src/lib
	/process-title.c, src/lib/restrict-access.c:
	If we run out of memory, exit with FATAL_OUTOFMEM status instead of
	dumping core. Also changed a few other i_panic() calls to others.
	[cb285bd5d8c9]

	* src/master/auth-process.c:
	Don't give NULL parameters to printf's %s format. Fixes crash with
	Solaris and some others.
	[b6faacb023a0]

	* src/lib/array.h:
	#ifdefs were wrong, we need both __GNUC__ and DEBUG to do type
	checking. Added new ARRAY_TYPE_CHECKS macro which can also be
	defined manually to enable it.
	[b426b1d58296]

	* src/lib-index/mail-index-transaction-view.c, src/lib-index/mail-
	index-transaction.c:
	ARRAY_ARG_SET_TYPE() -> ARRAY_SET_TYPE()
	[10532f156263]

	* src/lib/array.h:
	Renamed ARRAY_ARG_SET_TYPE() to ARRAY_SET_TYPE() and updated
	comments.
	[d5935326e06f]

2005-03-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/array.h:
	Updated example code, it was using older API..
	[d0adece8a6a0]

	* src/auth/auth-request.c:
	Crashfix. Patch by Andrey Panin.
	[2ff790d5d9e2]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-
	index-sync-keywords.c, src/lib-index/mail-index-sync-private.h, src
	/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction-view.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c, src/lib-index/mail-transaction-log-append.c:
	Changed many buffers to arrays. Cleans up the code a lot.
	[0df3f5d71958]

	* src/lib/Makefile.am, src/lib/array.h, src/lib/lib.h:
	Added dynamic array implementation. When compiling with gcc and
	DEBUG enabled, gcc checks type safety at compile time.
	[ba17b6e45193]

	* src/lib/buffer.c, src/lib/buffer.h:
	Minor cleanup: added _r suffix to used_size pointer parameters.
	[f80be7e73f71]

	* src/lib/lib.h:
	extern was missing from null4 declaration.
	[e73a0ef9c2c0]

	* src/lib-index/mail-index-view-sync.c:
	Code cleanups
	[aa83063864c7]

2005-03-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	Space reservation fixes and cleanups.
	[31313e1fe036]

2005-03-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/auth-worker-client.c:
	Handle USER requests from master connections.
	[3089083e1d47]

	* src/auth/auth-worker-client.c, src/auth/userdb-blocking.c:
	Blocking userdb: Don't break if user wasn't found.
	[c59506c04088]

	* dovecot-example.conf, src/auth/auth-master-connection.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/auth-worker-
	client.c, src/auth/auth.c, src/auth/auth.h, src/auth/main.c,
	src/auth/passdb-blocking.c, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb-blocking.c, src/auth/userdb-blocking.h,
	src/auth/userdb.c, src/auth/userdb.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Replaced userdb/passdb settings with blocks so it's possible to give
	multiple ones. Plaintext password mechanisms now support handling
	multiple passdbs, but others don't yet. Also fixed a few memory
	leaks.
	[16ea551957ed]

	* src/lib-storage/index/index-storage.c:
	Don't return value from void function.
	[818c75139ac7]

2005-03-05  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c, src/master/master-settings.h:
	Give more understandable error message if imap/pop3 listen ports
	conflict.
	[ef3a07e0a634]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h:
	Several transaction log cleanups and fixes.
	[ef16bb8091aa]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Assert if mail_index_map() is called recursively.
	[c620532e7bc8]

	* src/lib-index/mail-transaction-log-append.c:
	When rotating log, we locked index and tried to use its header. We
	didn't call mail_index_map() however to update the header..
	[845c49350468]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Some error handling path crashfixes.
	[95d2d8d5958b]

	* src/lib-index/mail-index-sync-update.c:
	We might have skipped transaction log records when syncing if log
	file was just rotated.
	[eec0c605e78f]

	* src/lib-index/mail-cache-transaction.c:
	Cache file space reservation assertfix.
	[5d6656a798e5]

	* src/lib/file-dotlock.c:
	If we failed to lock the dotlock, don't try to close the file twice.
	[091821cac480]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	append.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c, src/lib-index/mail-transaction-log.h:
	We could have gone past the transaction log view's boundaries if log
	was just rotated. Plus other transaction log cleanups, fixes and new
	asserts.
	[d137899ea853]

	* src/auth/auth-cache.c:
	auth_cache_insert(): Don't remove expired nodes just because they're
	expired. Before inserting a node, make sure it doesn't already exist
	(expired).
	[b951764080cc]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/passdb-blocking.c, src/auth/passdb-
	cache.c, src/auth/passdb-cache.h:
	Added state variable for auth_request and several assertions to make
	sure the state is always valid. Fixed assert crash when a user
	having cached passdb entry expired tried to authenticate.
	[8a3b57385eca]

	* src/lib-index/mail-transaction-log.c:
	hdr_size fix
	[42e1e9dbf19e]

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Added versioning to transaction log header. Added create_stamp to
	its header and it's not used to determine if the transaction log
	should be rotated, not the last time the log was updated. So now if
	the log is over 128kB, it's rotated as soon as it's at least 5
	minutes old.
	[ec17099a6490]

2005-03-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c, src/auth/auth-worker-client.h,
	src/auth/auth-worker-server.c, src/auth/auth-worker-server.h,
	src/auth/passdb-blocking.c, src/auth/passdb-blocking.h, src/auth
	/userdb-blocking.c, src/auth/userdb-blocking.h:
	Forgot to add for blocking passdb/userdb workers..
	[62f8366cb89c]

2005-03-01  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/auth-
	request.c, src/auth/passdb-cache.c, src/auth/passdb-cache.h:
	Fallback to using expired records from auth cache if database
	lookups fail.
	[97f53e0cce63]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-master-
	connection.c, src/auth/auth-master-connection.h, src/auth/auth-
	request-balancer-child.c, src/auth/auth-request-balancer-worker.c,
	src/auth/auth-request-balancer.h, src/auth/auth-request-handler-
	balancer.c, src/auth/auth-request-handler-default.c, src/auth/auth-
	request-handler.c, src/auth/auth-request-handler.h, src/auth/auth-
	request.c, src/auth/auth-request.h, src/auth/auth.c,
	src/auth/auth.h, src/auth/common.h, src/auth/main.c, src/auth
	/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth/passdb-
	ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-
	sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-ldap.c, src/auth/userdb-passdb.c,
	src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c, src/auth
	/userdb-sql.c, src/auth/userdb-static.c, src/auth/userdb-vpopmail.c,
	src/auth/userdb.h, src/master/auth-process.c, src/master/common.h,
	src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Restructuring of auth code. Balancer auth processes were a bad idea.
	Usually the balancer itself took as much CPU as the actual workers
	because it acted as a proxy.

	Now auth worker means different thing: they're used to execute
	blocking passdb and userdb queries. Currently just MySQL (PAM and
	checkpassword in TODO).
	[e6a487d80288]

	* src/lib/Makefile.am, src/lib/unix-socket-create.c, src/lib/unix-
	socket-create.h:
	Added unix_socket_create().
	[07a1726b7e6b]

2005-02-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Last changes broke proxying when user was in auth cache.
	[da9e4ffef09f]

	* src/lib-sql/sql-api.c:
	Forgot the actual sql_get_flags() function.
	[8a4c6f0491ab]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/sql-api-private.h, src/lib-sql/sql-api.h:
	Added sql_get_flags() function, currently returning only
	SQL_DB_FLAG_BLOCKING.
	[5d6787582410]

	* src/auth/auth-request-handler-default.c, src/auth/auth-request.c,
	src/auth/auth-request.h, src/auth/db-ldap.c, src/auth/passdb-
	bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-cache.h,
	src/auth/passdb-checkpassword.c, src/auth/passdb-ldap.c, src/auth
	/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth/passdb-
	passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-sql.c, src/auth
	/passdb-vpopmail.c, src/auth/passdb.c, src/auth/passdb.h, src/auth
	/userdb-ldap.c, src/auth/userdb-passdb.c:
	Moved cache handling from sql/ldap-specific code to generic auth-
	request code. Did some small optimizations on the way.
	[6a3254e3c3de]

2005-02-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-balancer-child.c:
	Added assert
	[42d18b4e5047]

2005-02-12  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/master/mail-process.c:
	If setpriority() is found, allow userdb set mail processes' priority
	by returning nice parameter.
	[852d010a4563]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-request-handler-default.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/db-ldap.c,
	src/auth/db-ldap.h, src/auth/passdb-cache.c, src/auth/passdb-ldap.c,
	src/auth/passdb-sql.c, src/auth/userdb-ldap.c, src/auth/userdb-
	passdb.c, src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c,
	src/auth/userdb-sql.c, src/auth/userdb-static.c, src/auth/userdb-
	vpopmail.c, src/auth/userdb.h, src/master/mail-process.c:
	userdb can now return extra parameters to master. Removed special
	handling of home/mail wherever possible, they're just regular extra
	parameters now. LDAP passdb and static userdb can return extra
	parameters now.
	[8849f2e380d1]

	* src/imap/cmd-append.c:
	Don't crash if client disconnects in the middle of APPEND. The last
	fix was incorrect.
	[7eb1995f5a27]

2005-02-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-fetch.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h:
	If UID FETCH notices in the middle of fetching that message is
	expunged, don't fail but just don't return all the data.
	[13dbff915a1a]

2005-02-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	cache growing crashfix
	[9abab33f1262]

2005-02-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	lstat() the root directory before trying to mkdir() it.
	[55a36d3793e4]

	* src/lib-storage/index/maildir/maildir-storage.c:
	code cleanup
	[c16260eab83f]

	* src/auth/userdb-vpopmail.c:
	compile fixes
	[a6e0776ac938]

	* src/auth/mech-rpa.c:
	Realm fixes. Patch by Andrey Panin
	[400624966554]

	* src/lib-index/mail-index-sync.c:
	Keyword reset crashfix
	[cf00d5631c2a]

	* src/lib-index/mail-index-transaction.c:
	Don't crash with empty keyword lists.
	[d0981562a9a3]

	* src/lib-index/mail-transaction-log-append.c:
	forgot to add
	[d9327a3dbf97]

	* src/lib-index/mail-index.c:
	Don't allow duplicate extension names in index header.
	[6c7d463eaf1e]

2005-02-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/Makefile.am, src/lib-index/mail-index-sync.c, src/lib-
	index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c:
	Moved code into mail-transaction-log-append.c
	[9a8bf1c86699]

	* src/imap/cmd-select.c, src/imap/cmd-unselect.c:
	Don't try to access closed mailbox after the closing gives an error.
	[941e381733a8]

	* dovecot-example.conf:
	Added a reminder about needing a default namespace.
	[33cbe3dec3b8]

	* src/auth/passdb-sql.c:
	Fixes credentials retrieving from sql passdb. Patch by Andrey Panin.
	[c9889006321d]

	* dovecot-example.conf:
	small updates
	[2bac730c250f]

2005-02-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-authenticate.c, src/imap/cmd-capability.c, src/imap
	/cmd-check.c, src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap
	/cmd-create.c, src/imap/cmd-delete.c, src/imap/cmd-examine.c,
	src/imap/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-idle.c,
	src/imap/cmd-list.c, src/imap/cmd-login.c, src/imap/cmd-logout.c,
	src/imap/cmd-lsub.c, src/imap/cmd-namespace.c, src/imap/cmd-noop.c,
	src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap/cmd-select.c,
	src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/cmd-subscribe.c, src/imap/cmd-thread.c, src/imap/cmd-uid.c,
	src/imap/cmd-unselect.c, src/imap/cmd-unsubscribe.c, src/imap
	/commands-util.c, src/imap/commands-util.h, src/imap/commands.h,
	src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-
	fetch.h, src/imap/imap-search.c, src/imap/imap-search.h, src/imap
	/imap-sort.c, src/imap/imap-sort.h, src/imap/imap-sync.c, src/imap
	/imap-sync.h, src/imap/imap-thread.c, src/imap/imap-thread.h:
	Moved command-specific variables from struct client to struct
	client_command_context and changed code to use it.
	[61abed5f7864]

	* src/lib-index/mail-index-dummy-view.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-private.h:
	Keep index pointer in dummy views.
	[9810fafd04ff]

	* src/imap/client.h, src/imap/commands-util.h, src/imap/commands.h:
	cleanups
	[b813612188d3]

	* src/imap/cmd-append.c, src/imap/cmd-store.c, src/lib-index/mail-
	index-private.h, src/lib-index/mail-index-sync-keywords.c, src/lib-
	index/mail-index-sync-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log.c, src/lib-index/mail-transaction-log.h, src/lib-index/mail-
	transaction-util.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-copy.c, src/lib-storage/mail-storage-private.h,
	src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/proxy-mailbox.c:
	Internal changes in how keywords are handled. struct mail_keywords
	isn't automatically freed anymore, added *_keywords_free() for that.
	[fbe844061fe2]

2005-02-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	cleanups / minor fixes
	[0383923d4759]

2005-02-01  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c, src/pop3/capability.h:
	Don't advertise USER capability if we're not allowing plaintext
	authentication.
	[bf8bc07e546e]

	* configure.in:
	-gnu99 was set again after it was optionally set..
	[d1e5f7ca0f20]

2005-01-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c:
	Recent flags weren't being removed from index causing needless
	syncing.
	[ac9793c61f29]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	cleanup
	[c1840ac9fda6]

	* src/lib/file-dotlock.c:
	Inode info wasn't saved when using file_dotlock_open() so
	file_dotlock_delete() thought it was overridden and didn't delete
	it.
	[3281674159b5]

	* src/imap/cmd-append.c:
	And a non-crashing fix.
	[e139dcb1744d]

	* src/imap/cmd-append.c:
	Don't crash if client disconnects in the middle of APPEND.
	[d14b7e7943c3]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-index.c:
	Don't complain about cache indexid changing when recreating index.
	[1ea614abead3]

2005-01-30  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	compile fix
	[ff8cb5728395]

	* src/auth/userdb-passwd-file.c:
	userdb passwd-file wasn't working. Patch by Joseph Tam.
	[b5c20f0a9649]

	* src/login-common/main.c:
	inetd startup wasn't working. Patch by Magnus Holmgren.
	[4868d061794c]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If maildir-shared exists in the Maildir root, copy it for each
	created mailbox.
	[6446a730f7d1]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Treat ::ffff:127.* addresses as secure as well.
	[122ddc6cc9f5]

2005-01-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	Don't crash when extension header is resized and there are
	extensions after it.
	[c663b234cfcb]

2005-01-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	optimization.
	[314df8f53731]

	* src/lib-index/mail-index-transaction.c:
	one more fix
	[e5a75a7c4ffd]

	* src/lib-index/mail-index-transaction.c:
	still not right
	[9a1ae6bc01f4]

	* src/lib-index/mail-index-transaction.c:
	and more fixing..
	[8ea8ff089ae3]

	* src/lib-index/mail-index-transaction.c:
	fix
	[eea18691435e]

	* src/lib-index/mail-index-transaction.c:
	fixes
	[fd973ec62103]

	* src/lib-index/mail-index-transaction.c:
	extra assert to make sure struct mail_keywords isn't tries to be
	used between multiple indexes.
	[c358df7edc35]

	* src/lib-index/mail-index-transaction.c:
	fix
	[eb0293fbcccf]

2005-01-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/Makefile.am, src/lib-index/mail-index-dummy-view.c,
	src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	index-view-private.h:
	Instead of using separate transaction sorting code for syncing, just
	put the data from transactions into a temporary transaction and read
	it from there.
	[7c7299d1acfe]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index.h:
	Added mail_index_update_flags_range() and optimized the non-range
	version as well.
	[2f53b73b3ea6]

	* src/pop3/commands.c:
	\Seen flag wasn't actually being set with RETR.
	[b5731614206e]

	* src/lib-index/mail-transaction-log.h:
	Added padding field explicitly for struct
	mail_transaction_flag_update. It was done before anyway by compiler.
	[b1eaafa49f53]

2005-01-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	When all mails have been expunged, write dummy message.
	[566558dcc228]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Don't allow X-UID headers larger than current next-uid.
	[bb426c8a8c3f]

2005-01-17  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	The actual fix for last commit..
	[38fa28004689]

	* src/imap/imap-sync.c:
	FETCH deinitialization wasn't done properly
	[adb1a574215b]

2005-01-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-transaction-log-private.h, src/lib-
	index/mail-transaction-log.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/subscription-file
	/subscription-file.c, src/lib/file-dotlock.c, src/lib/file-
	dotlock.h:
	Changed dotlocking API.
	[9c4aa309dbac]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index.c:
	Added asserts
	[f58ff8ec50c4]

	* src/lib-index/mail-index-transaction.c:
	Removed assert which crashed us every time we were setting flags to
	messages in non-increasing order (could be done only with POP3).
	[82e025ea6989]

	* src/lib-index/mail-cache.c:
	When we detect cache corruption, just mark the cache as unusable
	instead of immediately closing the file and unmapping. It's too
	difficult to keep track of all the possible ways in which that can
	break and cause "bad file descriptor" errors and maybe crashes..
	[f2f03044b6b2]

	* src/lib-index/mail-index-transaction.c:
	crashfix
	[0507efd4eaee]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Fixes by Kazuo Moriwaka
	[6269725cce58]

	* src/imap/imap-fetch.c:
	FETCH BODY[] wasn't setting \Seen flag.
	[395d7b248caa]

	* src/auth/password-scheme-md5crypt.c:
	MD5crypt was broken with 64bit systems.
	[fdec0a4ca1d1]

2005-01-15  Timo Sirainen  <tss@iki.fi>

	* src/lib/sendfile-util.c:
	Don't call sendfile() if count=0. With FreeBSD this fixes an assert
	crash.
	[80f7ea6aa94c]

	* configure.in:
	Don't use -std=gnu99 if gcc doesn't support it.
	[3ba362513202]

	* src/lib-index/mail-index-transaction.c:
	static -> dynamic keyword buffer. It's not actually possible to know
	the minimum needed size for the buffer beforehand.
	[65b2d1ec3596]

2005-01-13  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	Change effective GID as well before trying chdir() to mail
	directory.
	[8f254acc036c]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Move default filters/attrs to setting defaults rather than check it
	from code. Also fixes a crash.
	[d78e9a31b6d8]

	* src/lib-mail/message-parser.c:
	MIME boundary parsing fix.
	[ff153dc3910a]

	* src/lib-mail/rfc822-parser.c:
	Quoted strings were parsed wrong.
	[e8a2f4358ca6]

	* configure.in:
	Give -std=gnu99 option to gcc.
	[0704b595c873]

2005-01-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	transaction-log.c:
	Fixed crashes with keywords code when copying/saving many mails.
	[ac3f22f49695]

	* src/pop3-login/client-authenticate.c:
	Don't allow multiple PASS commands after a USER command. Patch by
	Andrey Panin.
	[a171aa34f0e8]

2005-01-11  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/passdb-ldap.c, src/auth/userdb-
	ldap.c:
	Support variables in LDAP base setting.
	[441759ac4f6a]

	* TODO:
	sorted things
	[769e2e2bf1d5]

2005-01-10  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-store.c, src/lib-index/mail-index-private.h, src/lib-
	index/mail-index-sync-keywords.c, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index.c, src/lib-
	index/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/proxy-mail.c, src/lib-
	storage/proxy-mailbox.c:
	Keyword fixes.
	[66c44404f9a1]

	* src/lib-storage/index/maildir/maildir-sync.c:
	don't allocate memory from data stack uselessly.
	[73944f902165]

2005-01-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-handler-default.c:
	We were supposed to remove userdb_* fields from auth reply, but
	instead we removed everything else.
	[873ce1b9747e]

	* src/master/auth-process.c, src/master/log.c, src/master/log.h,
	src/master/login-process.c, src/master/mail-process.c:
	Disable log throttlong for auth process, and for login processes if
	login_process_per_connection=no.
	[a20882c4f092]

	* src/pop3-login/pop3-proxy.c:
	If login failed, send it as "-ERR [IN-USE]" rather as IMAP's "*
	BYE"..
	[620a00db2c7c]

	* src/auth/auth-request-handler-default.c:
	memory leak fix
	[423af565a8b9]

	* src/auth/auth-master-connection.c:
	Don't close balancer listener after one worker has connected..
	[f2671cf166da]

	* src/master/auth-process.c:
	Don't send balancer listener fd to auth workers.
	[b76fed3280be]

	* src/auth/main.c:
	fix
	[fbfd3e691bc5]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-master-connection.c, src/auth/auth-master-connection.h,
	src/auth/auth-request-balancer-child.c, src/auth/auth-request-
	balancer-worker.c, src/auth/auth-request-balancer.h, src/auth/auth-
	request-handler-balancer.c, src/auth/auth-request-handler-default.c,
	src/auth/auth-request-handler.c, src/auth/auth-request-handler.h,
	src/auth/auth.c, src/auth/auth.h, src/auth/common.h,
	src/auth/main.c, src/auth/mech.h, src/master/auth-process.c:
	Changed the way multiple auth processes are handled. It no longer
	uses a pid appended to socket name but instead there's a balancer
	process which proxies the requests to worker processes.
	[eb46a5dee02d]

	* src/lib/network.c:
	Use nonblocking connecting for unix sockets.
	[8d15fea729c2]

	* src/auth/main.c, src/lib/network.c, src/lib/network.h, src/login-
	common/master.c, src/master/auth-process.c, src/master/main.c:
	Added backlog parameter for net_listen*().
	[9cb91ed5a110]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-master-connection.c,
	src/auth/auth-master-connection.h, src/auth/auth-request-handler.c,
	src/auth/auth-request-handler.h, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/main.c, src/auth/mech-apop.c, src/master
	/auth-process.c:
	Moving code around.
	[3feb38ff17f5]

	* src/auth/common.h, src/auth/main.c, src/auth/mech-apop.c,
	src/pop3-login/client.c:
	Require a valid timestamp in APOP challenge.
	[7e0caae73c59]

2005-01-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	login.c, src/auth/mech-ntlm.c, src/auth/mech-plain.c, src/auth/mech-
	rpa.c, src/auth/mech.h:
	Another try with API cleanup.
	[289a98ba5d95]

	* src/auth/auth-client-connection.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	login.c, src/auth/mech-ntlm.c, src/auth/mech-plain.c, src/auth/mech-
	rpa.c, src/auth/mech.h:
	API cleanup
	[c7db6b291daa]

	* doc/auth-protocol.txt, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h:
	Removed SERVICE command. It's quite useless extra state to keep
	around.
	[305ac76afcda]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-request.c, src/auth/auth-request.h,
	src/auth/auth.c, src/auth/auth.h, src/auth/common.h, src/auth/db-
	passwd-file.c, src/auth/main.c, src/auth/mech-anonymous.c, src/auth
	/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth/mech-plain.c,
	src/auth/mech-rpa.c, src/auth/passdb-bsdauth.c, src/auth/passdb-
	cache.c, src/auth/passdb-checkpassword.c, src/auth/passdb-ldap.c,
	src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth
	/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-sql.c,
	src/auth/passdb-vpopmail.c, src/auth/passdb.c, src/auth/userdb-
	ldap.c, src/auth/userdb-passdb.c, src/auth/userdb-passwd.c, src/auth
	/userdb-sql.c, src/auth/userdb-vpopmail.c, src/auth/userdb-
	vpopmail.h, src/auth/userdb.c:
	Added auth_request_log_*().
	[131151e25e4b]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-request.c, src/auth/auth-request.h,
	src/auth/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/passdb.h,
	src/auth/userdb.h:
	Cleanups.
	[b01a8fa09f94]

2005-01-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c:
	mail->expunged field wasn't actually set. Now it's always set if
	wanted_fields contains message header or body.
	[4c92f9eae613]

	* src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb.c,
	src/auth/userdb.h:
	Moved extern userdb/passdb declarations to .c files.
	[34c1cf646467]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-master-connection.c,
	src/auth/auth-master-connection.h, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/auth.c, src/auth/auth.h,
	src/auth/common.h, src/auth/main.c, src/auth/mech-anonymous.c,
	src/auth/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb.c, src/auth/userdb.h:
	Reorganized the code to have less global/static variables.
	[29d83a8bb50d]

	* src/auth/Makefile.am, src/auth/auth-cache.c, src/auth/auth-client-
	connection.c, src/auth/auth-master-connection.c, src/auth/auth-
	request.c, src/auth/auth-request.h, src/auth/main.c, src/auth/mech-
	anonymous.c, src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth/mech-
	ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/userdb.h:
	Split auth_request* functions from mech.c to auth-request.c
	[2d33734b16d5]

	* src/auth/checkpassword-reply.c, src/auth/passdb-checkpassword.c:
	userdb = passdb works now with checkpassword passdb.
	[a0fbf92b41c3]

	* configure.in, src/auth/Makefile.am, src/auth/auth-client-
	connection.c, src/auth/userdb-passdb.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Added "passdb" userdb. It works only if passdb gives all the
	information needed for userdb. For example with SQL you can use "..
	uid AS userdb_uid, gid AS userdb_gid, home AS userdb_home .." in
	password_query.
	[5e2e4cdbfe2e]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h:
	Renamed strarray_join() to t_strarray_join() and made it not to
	crash..
	[42c1ca1f7a45]

	* src/lib-auth/auth-server-request.c:
	If connection to auth server is lost, reply with temp error.
	[4242c19c8617]

	* src/imap-login/client-authenticate.c, src/login-common/common.h,
	src/pop3-login/client-authenticate.c:
	If authentication failed because of temporary failure, show
	different error message to clients.
	[08c640bdf749]

	* doc/auth-protocol.txt, src/auth/auth-client-connection.c, src/auth
	/mech-anonymous.c, src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth/mech-
	ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/passdb-ldap.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-sql.c, src/auth/passdb.c, src/auth/passdb.h:
	Make FAIL reply contain "temp" parameter if the authentication
	failed because of temporary internal error. Also cleaned up the auth
	code a bit.
	[052f3a5743af]

	* src/lib-auth/auth-server-request.c:
	typofix
	[3e5faae6f10b]

	* src/login-common/sasl-server.c:
	cleanup
	[90ac3ec026cf]

	* src/lib-sql/driver-mysql.c:
	removed debugging info
	[6994f6e8be2b]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	proxy: When we can't connect to remote server, show "Temporary login
	failure." error to client instead of internal error.
	[a5dbe1e56c07]

	* src/lib-sql/driver-mysql.c:
	Mysql driver supports connecting to multiple servers by giving
	multiple host= parameters in connect string. The queries are sent
	round robin, and if the query fails because of lost connection for
	one server it's retried on next one.
	[1d005cdce6ec]

	* src/lib-sql/driver-mysql.c:
	Check if mysql_fetch_row() returns error.
	[ced4abfdb2f9]

	* doc/dovecot-sql.conf:
	Removed moin.cgi/ from Wiki reference, it's not needed anymore.
	[b1efe06092ac]

	* src/util/rawlog.c:
	rewrote rawlog code. it's now fully asynchronous which could make it
	a bit faster, and it should also fix some hangs with it. Timestamps
	are written now only with IMAP.
	[83034650fef4]

	* src/login-common/login-proxy.c:
	s/proxy/server/ for variables describing remote server.
	[7f503848533e]

	* TODO:
	updated
	[12fc3c22ffe8]

	* src/lib-mail/message-parser.c:
	We didn't handle properly missing boundaries.
	[89c49afa57fd]

2005-01-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-body-search.c:
	When searching inside MIME part headers, we were using wrong charset
	for the search key. It was already in UTF-8.
	[c35e02d5724a]

	* src/lib-storage/index/index-mail-headers.c:
	mail->get_header() was pretty broken. This affected SORT/THREAD.
	[ccfd78cc07cc]

	* src/lib-mail/message-address.c:
	Allow giving data stack pool for message_address_parse()
	[2d4630db33fd]

	* src/auth/db-passwd-file.c, src/auth/userdb-ldap.c, src/auth/userdb-
	sql.c, src/auth/userdb-static.c, src/auth/userdb.c,
	src/auth/userdb.h:
	If UID or GID isn't numeric, look it up from passwd/group.
	[8b80b69938f0]

	* src/auth/userdb-ldap.c:
	Keep auth_request around so it can be used in error messages.
	[4455da56ad87]

	* src/lib/file-dotlock.c:
	Use random_fill_weak() when creating dotlock file names.
	[933b65191ca3]

	* src/auth/main.c, src/lib/randgen.c, src/lib/randgen.h:
	Added random_fill_weak() and make random_init() always initialize
	srand() with a seed from random_fill().
	[50acbcc7e4d8]

	* src/imap/imap-sort.c, src/lib-imap/imap-envelope.c, src/lib-
	mail/Makefile.am, src/lib-mail/message-address.c, src/lib-mail
	/message-address.h, src/lib-mail/rfc822-parser.c, src/lib-
	mail/rfc822-parser.h, src/lib-storage/index/index-search.c:
	Added rfc822 parser which will probably replace message_tokenizer at
	some point. Rewrote address parsing with the new parser. This fixes
	various bugs in it.
	[d6910d273852]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added strarray_join().
	[2f7ffdcd7d67]

	* src/pop3/Makefile.am, src/pop3/mail-storage-callbacks.c:
	lib-imap isn't needed in includes.
	[2beaee54e942]

	* src/auth/auth-master-connection.c, src/auth/passdb-ldap.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/userdb-ldap.c,
	src/auth/userdb-sql.c:
	Added authentication debugging logging.
	[fcecff14e470]

2005-01-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Don't break if line begins with NUL. Don't return -2 as long as
	underlying stream is returning more data (don't just retry once).
	[6f1ea1c7212f]

2004-12-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/pop3/main.c:
	Print effective uid/gid when mail_debug is enabled.
	[de1b904c4df2]

	* dovecot-example.conf, src/imap/namespace.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-storage-private.h, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h, src/pop3/main.c:
	Added mail_debug setting. Moved full_filesystem_access from global
	variable to flag in mail_create*() functions.
	[146897976cfa]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Added assert
	[bf6a77e42151]

	* src/lib-imap/imap-util.h:
	compiler warning fix
	[2c923618fb3b]

	* doc/mail-storages.txt:
	Fixes.
	[1f92f41addea]

	* doc/Makefile.am, doc/USE-WIKI-INSTEAD:
	Added.
	[166916ab6b1b]

	* dovecot-example.conf:
	Added wiki references.
	[16183e87beaf]

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Removed maildir_check_content_changes setting. The feature hasn't
	existed for a long time.
	[7321b943b34e]

	* dovecot-example.conf:
	Updated comments.
	[80f7050c8bb5]

	* src/lib-storage/index/mbox/mbox-sync.c:
	we synced one message more than necessary when we were applying
	changes.
	[44c5e8c50ad4]

	* src/imap/commands-util.c:
	Don't create empty keyword lists.
	[8939c2d75a89]

	* src/lib-index/mail-transaction-log.c:
	Don't crash if keyword update doesn't actually have any keywords
	set.
	[9d1b05604dd9]

	* src/auth/password-scheme.c:
	comment cleanup.
	[f2d7d6dcedd7]

2004-12-28  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated mail_cache_fields and mail_never_cache_fields comments.
	[b987319c7ce3]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Removed "mail.uid". It's not used and will not be used.
	[d81d15553644]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Added assert.
	[eaf1778d41f5]

2004-12-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c:
	Flag updates got lost if there were internal flag updates in same
	transaction.
	[43685e7aa7b1]

	* src/imap/commands-util.c, src/imap/commands-util.h:
	const fixes
	[044b478e72e6]

	* src/imap/cmd-append.c, src/imap/cmd-store.c, src/imap/commands-
	util.c, src/imap/commands-util.h, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/imap/imap-sync.c, src/lib-imap/imap-util.c, src
	/lib-imap/imap-util.h, src/lib-index/Makefile.am, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-sync-keywords.c, src
	/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log.c, src/lib-index/mail-transaction-log.h,
	src/lib-index/mail-transaction-util.c, src/lib-mail/mail-types.h,
	src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/mail-copy.c, src/lib-storage/mail-storage-private.h,
	src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/proxy-mail.c, src/lib-storage/proxy-mailbox.c,
	src/pop3/client.c, src/pop3/commands.c:
	Initial support for keywords. Syncing to mbox/maildir doesn't work
	yet.
	[61c8d205d887]

	* src/imap/mail-storage-callbacks.c:
	Removed unused include.
	[bd60ceddab2f]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added strarray_length().
	[f23e9957544f]

2004-12-22  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	pop3_enable_last setting wasn't actually being passed to pop3
	process. Patch by Andrey Panin.
	[b4891c3917eb]

2004-12-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-from.c:
	Support "quoted spaces" in From-line sender's local-part. Postfix at
	least may write these..
	[f71446dc9b38]

2004-12-20  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c, src/master/auth-process.c:
	Fixes for using socket listen { .. } in auth sections.
	[ea37520d92e3]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-header-
	search.c:
	Memory leak fix + crashfixes. Found and fixes by Kazuo Moriwaka
	[2a7355f6ebff]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Fix crashes when handling stale dotlocks.
	[2ec32b88c123]

	* src/lib-index/mail-index-sync-update.c:
	comment update
	[8f8a95e06479]

	* src/lib-index/mail-index-sync-update.c:
	still not right :)
	[afbedc8fc88e]

	* src/lib-index/mail-index-sync-update.c:
	Again, don't crash if there are no expunge handlers..
	[496c28357ae6]

	* src/lib-index/mail-index-sync-ext.c:
	If there are no extensions, don't crash while expunging.
	[a41e1f9b9b14]

	* configure.in:
	Don't use GNUTLS unless explicitly specified. It's not working
	currently anyway..
	[60a172e62d11]

	* src/imap/imap-search.c:
	Don't try to uppercase search strings. It breaks some character
	sets.
	[95fad52fec69]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	If strtoull() isn't supported, fallback to strtouq(). If that's not
	found either, use our own implementation.
	[9f765960fca6]

2004-12-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.h:
	Warning fix for cygwin.
	[d86d770ffb85]

	* src/lib-index/mail-cache-transaction.c:
	Type changes, was probably broken with 64bit systems.
	[288a0d56c846]

	* src/lib-index/mail-cache-private.h:
	mail_cache_decision_*() prototypes were wrong.
	[1d328531c466]

	* src/lib/mmap-util.c:
	my_madvise() wasn't returning anything.
	[7e1fdbdaf465]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	In some cases we may have crashed if header didn't end with LF+LF.
	[c64674a0a92a]

	* dovecot-example.conf, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/mail-
	storage.h, src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Added %f pop3_uidl_format for maildir. Patch by Andrey Panin.
	[9219e788d774]

	* src/util/dovecotpw.c:
	Include libgen.h only if it exists.
	[de524f4a1075]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Fixed crashing due to free()ing too much.
	[1ed01cfed3a9]

	* src/imap/imap-search.c:
	SEARCH UNKEYWORD wasn't working.
	[2c92a14458e6]

	* src/lib-index/mail-index-sync-ext.c:
	Don't crash if last extension in record needs padding.
	[3c192eebd919]

	* src/imap/imap-fetch-body.c:
	MIME part header fetches weren't working correctly.
	[ca4341dbde8a]

	* src/lib-mail/istream-header-filter.c:
	Seeking backwards to headers wasn't working.
	[57f91991f4ca]

2004-12-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c:
	Don't call bsearch() with zero member count, it crashes in Solaris.
	[83c791a0b6d9]

2004-12-17  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	Go back to the version before recent changes. It was correct all the
	time.
	[76d0e16d45e6]

	* src/lib-storage/index/index-storage.h:
	Added mbox_writeonly variable, forgot in last commit.
	[d1a2c39d1b50]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-sync.c:
	Named pipes are now treated as write-only mboxes.
	[51a05fd00324]

2004-12-16  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	o_stream_send_istream() was broken and could have just caused
	copying to be done infinitely filling up disk.
	[f1e67917a669]

	* src/lib-auth/auth-server-request.c:
	Fix when using multiple auth processes.
	[3fb1808e7bff]

	* src/lib/istream-limit.c:
	Added assert.
	[c20a64efd608]

	* src/lib/ostream-crlf.c:
	LF-stream might have counted the bytes wrong in certain situations,
	causing it to skip more data from input than it should have. Caused
	hangs sometimes when APPENDing into mbox.
	[3dedde6646c5]

	* src/lib/ostream-file.c:
	Stream copying skipped too much input if the output buffer wasn't
	empty when it was called.
	[ac10b761f179]

	* src/lib-auth/auth-server-request.c:
	Crashfix
	[65e28b1be20e]

2004-12-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	Deinitialize pending command only if it's actually executing. Fixes
	crash if client disconnected while command was only half sent.
	[10d1fd8d0865]

	* src/lib-storage/index/mbox/mbox-save.c:
	If mbox isn't synced, don't try to set message's md5sum because it
	just crashes..
	[982e7432276f]

	* src/lib/var-expand.c:
	Added support for multiple modifiers. Added %X = hex modifier.
	Prefixing width value with '0' adds '0'-padding to the string if
	it's smaller than width.
	[4a6788997812]

	* dovecot-example.conf, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/client.c, src/pop3/client.h,
	src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Added pop3_uidl_format setting.
	[96a4ab34c8f1]

	* src/auth/auth-cache.c, src/lib/var-expand.c, src/lib/var-expand.h:
	Auth cache key was built wrong if any modifiers were used for %vars.
	Added var_get_key() function which skips over any modifiers and
	returns the actual key.
	[c59fd95ad3ee]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	Removed X-UIDL header handling. It's not actually used.
	[8ef9f3d640e0]

	* src/lib-storage/index/mbox/mbox-save.c:
	If we want MD5 sums in indexes, mail saving should also add them.
	[32cc9186d8eb]

	* src/lib-storage/index/mbox/Makefile.am, src/lib-storage/index/mbox
	/mbox-md5.c, src/lib-storage/index/mbox/mbox-md5.h, src/lib-
	storage/index/mbox/mbox-sync-md5.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h:
	Reorganized mbox md5 summing code so it doesn't require sync context
	anymore.
	[7c4238c78aee]

	* src/auth/auth-cache.c:
	When building cache key, use each %key only once, more wastes only
	memory. This was mostly needed for more complex SQL queries where
	same key could be used multiple times.
	[1f7bcbb09f90]

	* src/lib-auth/auth-server-connection.c, src/lib-auth/auth-server-
	connection.h:
	Connect to available auth sockets by round robin.
	[e2876940968e]

	* src/master/auth-process.c:
	If login_process_per_connection=no, create a separate listener
	socket for each auth process, so a single long running login process
	can talk to multiple auth processes for load distribution.
	[cad3a8913d4a]

	* src/lib-index/mail-cache-fields.c:
	Check for duplicate fields in header.
	[2ab037df6cf3]

	* dovecot-example.conf, src/lib-storage/index/index-storage.h, src
	/lib-storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Added mbox_very_dirty_syncs setting.
	[b31f48d152c4]

2004-12-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Continuing last header-md5 commit..
	[7ea6705240b3]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync.c:
	Always register the header-md5, but use separate variable to figure
	out if it should actually be used.
	[89fd53e406dd]

	* src/lib-storage/index/mbox/Makefile.am, src/lib-storage/index/mbox
	/mbox-sync-md5.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src
	/lib-storage/index/mbox/mbox-sync-private.h:
	Moved mbox header MD5 summing code into separate file so it's easily
	changed.
	[e032167a05ca]

2004-12-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	If log file sequences get broken, complain instead of crashing.
	[c0bdb35277fc]

	* src/lib-storage/index/mbox/mbox-sync.c:
	A few extra asserts.
	[d048ef0a67f2]

2004-12-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c, src/auth/mech.c, src/auth/mech.h:
	When master looked for auth request, it didn't check if the
	authentication was yet finished, so auth client could have fooled
	master by beginning authentication without finishing it. Login
	processes didn't allow users to do this though, so no real problem.
	[155386b3149d]

	* src/master/master-settings.c:
	Don't change login dir permissions if using external auth.
	[41a4ea8496d6]

2004-12-08  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-create.c:
	CREATE dir/ wasn't working.
	[b9d1e0262568]

	* src/lib-storage/index/mbox/mbox-storage.h:
	Changed mbox header padding back to 50. It was 5 for debugging
	(probably shouldn't have been committed).
	[d05f419978b2]

	* src/auth/mech.c, src/auth/mech.h:
	Requests in failed response queue could still be found from request
	queue and destroyed again. This made it possible to crash dovecot-
	auth by sending more authentication data than was expected.
	[2f0fd2e7ab89]

2004-12-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Added assert
	[cd257e96a370]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Fixed mbox corruption in certain situations. Added more asserts to
	catch similiar problems if there still happens to be any.
	[d5ee1bbd15f0]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-sync-ext.c, src
	/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-sync-
	update.c:
	Moved extension syncing code to separate file.
	[9dc7a7b06781]

	* src/lib-index/mail-index-sync-update.c:
	Sync contexts are always of type struct mail_index_sync_map_ctx.
	[ce8ff2279fb2]

	* dovecot-example.conf, src/pop3/commands.c, src/pop3/common.h,
	src/pop3/main.c:
	Added oe-ns-eoh workaround.
	[546214c0e6e9]

	* src/lib-index/mail-transaction-log.c:
	Crashfix for mmap_disable=yes.
	[93cdd2b92650]

	* src/lib-index/mail-cache-compress.c:
	mail_cache_merge_bitmask() was broken, cache compression could have
	crashed or produced broken results.
	[30110ac226a7]

	* src/lib-index/mail-cache-compress.c:
	Cache compression didn't work with lock_method = dotlock.
	[05ae72649fd0]

	* src/lib/file-dotlock.c:
	If pid in dotlock file is same as ours, assume a stale lock file.
	[0e7a0e204f5d]

	* src/imap/client.c:
	Added assert
	[a519f183bacf]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	storage.h:
	mail_deinit() wasn't used anymore.
	[06413236d3b1]

2004-12-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech.c:
	Crashfix for passdb cache. Patch by Andrey Panin.
	[e9d9fb39cf9e]

	* src/auth/passdb-cache.c:
	Cached passwords didn't return scheme correctly. Patch by Andrey
	Panin.
	[cd436a43dfd3]

	* src/auth/mech.c, src/auth/passdb.c:
	Mechanism list / passdb compatibility checking wasn't working
	because we were checking it before any mechanisms were initialized.
	[6a6e794bb6d3]

	* src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-ldap.c, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-sql.c, src/auth
	/userdb-static.c, src/auth/userdb-vpopmail.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Added name variable for userdb_module and passdb_module and changed
	their initialization a bit.
	[c7d426f8cb58]

2004-12-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache.c, src
	/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-transaction-log.c:
	lock_method=dotlock doesn't crash anymore while trying to modify
	cache file. We didn't previously deal with any fatal errors that
	fcntl/flock locking could have given but assumed that the locking
	succeeded.
	[89ab5c72430d]

	* src/lib-index/mail-index.c:
	Changed assert() to friendly human readable message.
	[0e1481357fbb]

	* src/lib-index/mail-index.c:
	mmap_disable=yes: when we're syncing index by reading transaction
	log, update map header's log file offsets so our checks that use
	them actually work.
	[00b78082cd50]

	* src/lib-index/mail-index.c:
	mmap_disable=yes: if mail_index_map() is called while syncing make
	sure we don't read past what is already synced into index.
	[bc8ff03715b2]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index.c:
	Added more asserts.
	[43deb226d769]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-lock.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-mail.c:
	Renamed mail_index_refresh() to mail_index_reopen_if_needed(). Added
	public mail_index_refresh() which makes sure index is fully
	refreshed at the time. Added mbox code to call it after mbox is
	locked to avoid using old mbox offsets.
	[57f975a9b63b]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index.c:
	Don't try to fsck when we're modifying index. It could have happened
	with corrupted transaction logs.
	[0b72e95cd3ae]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache-sync-
	update.c, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index.c:
	Added "sync lost" handlers which are called with mmap_disable=yes
	when index file is re-read without going through all of the
	transaction log.
	[c3ae75597952]

	* src/lib-index/mail-cache-sync-update.c, src/lib/file-cache.c,
	src/lib/file-cache.h:
	Changed file_cache_invalidate()'s size argument to uoff_t type.
	[6ec86fd705a6]

	* src/lib-index/mail-index-sync-update.c:
	Expunge sync handlers were using wrong extension contexts. This may
	have caused cache->locked asserts.
	[461bd8486083]

2004-12-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	Don't crash with assert if transaction log was truncated
	unexpectedly.
	[3fc80d3ae8de]

	* src/lib-index/mail-index-fsck.c:
	If index is completely broken, don't try to fsck it since we'll just
	crash.
	[15e8ea839bf9]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache.c:
	Locking fixes and cleanups
	[ba9062032877]

	* src/pop3/commands.c:
	RETR: Don't bother adding \Seen flag to message if it's already
	there.
	[3470bb04fb57]

	* src/pop3/client.c:
	Timeout changes. Default idle timeout is now 10 minutes instead of
	30 minutes. Also before if client didn't read our output we didn't
	timeout it until after 16 hours (should have been one minute,
	changed it to 10min as well).
	[6e2129a4a595]

2004-12-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Make sure index is reopened if it's marked corrupted.
	[c035583b4839]

	* src/lib-index/mail-cache-sync-update.c:
	Don't crash if we failed to lock cache file.
	[f7e3283137db]

2004-11-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	broken fix for sync handler deinitializing..
	[0e6ecb9d06e0]

	* src/lib-index/mail-index-sync-update.c:
	Sync handlers weren't always deinitialized with correct parameters.
	[52000679a7aa]

	* src/lib-index/mail-index.c:
	With mmap_disabled=no the index header wasn't always updated causing
	various problems.
	[fadf33c24902]

2004-11-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c:
	Wrong extension sync_handler might have been called if index
	extensions didn't match current map's extensions.
	[a5eda271256f]

	* src/lib-index/mail-cache.c:
	Don't write to closed cache file
	[9b772db4503d]

	* src/lib-index/mail-index-sync-update.c:
	Added assert
	[3cc0a992ac7d]

	* src/lib-index/mail-index-transaction-view.c:
	If extension data changes was actually found from transaction view,
	it was returned wrong. Caused problems with cache file.
	[7039fc53b4c8]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c:
	Crashfixes for reading corrupted cache files.
	[e657c7874962]

	* src/lib/file-cache.c:
	Don't crash if trying to read more than INT_MAX bytes. Just silently
	allow it.
	[d1780331ad04]

	* src/auth/mech-ntlm.c, src/auth/mech-rpa.c:
	Initial response support for NTLM and RPA. Patch by Andrey Panin.
	[25bc79e67271]

	* src/lib-index/mail-cache-transaction.c:
	Make sure we don't try to write to cache file when it's already
	closed (could happen if it was corrupted).
	[37b81e395f00]

	* src/lib-index/mail-index.c:
	mmap_disable=yes fixes.
	[cd293e5e6a71]

	* src/lib-index/mail-index-sync-update.c:
	We were accessing map which was potentially already freed.
	[e491b5d1a73a]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index.c:
	Changed mail_index_map_to_memory() to mail_index_map_clone(). Even
	if the index is already in memory, we wish to copy it instead of
	just raising refcount. Fixes some problems with mmap_disable=yes.
	[f2c2b17d7659]

	* src/lib-index/mail-cache-sync-update.c:
	Don't crash if cache is unusable.
	[1a9e4676196d]

	* src/lib-index/mail-index-sync-update.c:
	Don't mark map to be written into disk if we're syncing a view and
	not index.
	[f4eaf629bea3]

	* src/lib-index/mail-cache.c:
	Cache sync handler wasn't registered correctly so it broke with
	mmap_disable=yes.
	[ef0b296ad4dd]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Give UIDVALIDITY for empty mboxes too.
	[8fa07cbfd68e]

	* src/lib-index/mail-index-sync-update.c:
	Still need to update view->hdr..
	[b909bce742bf]

	* src/lib-index/mail-index-sync-update.c:
	sync_ext_reorder() sometimes added too much data to buffer.
	[1e0d71e67315]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Removed view->messages_count, view->hdr.messages_count is enough.
	Also fixes assert crash in mail_index_bsearch_uid().

	Renamed .._get_message_count() to get_messages_count() to be more
	consistent.
	[642ba9cd3dac]

	* src/lib-index/mail-index-sync-update.c:
	added assert
	[bd8f47bda4c7]

	* src/lib-index/mail-index.c:
	mail_index_write_base_header() doesn't crash anymore if index
	mapping is in memory. Recent changes broke it.
	[1022caefca74]

2004-11-28  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	Don't destroy client structure immediately when sending line fails.
	Fixes some writes to freed memory.
	[872172ffd005]

2004-11-26  Timo Sirainen  <tss@iki.fi>

	* src/login-common/master.c:
	fix
	[d22205c4539d]

2004-11-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	UID FETCH * gave error message with empty mailbox.
	[1a05764af1e0]

	* src/master/main.c:
	crashfix
	[cf678778b1fa]

	* src/pop3-login/client.c:
	Username given in USER was was not freed when destroying client.
	[90697bb3c368]

	* src/lib-index/mail-index.c:
	When we actually read index file's header make sure it gets copied
	to memory so log file offsets get updated.
	[305476a6f8ed]

2004-11-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.c:
	Avoid re-reading index file with mmap_disable=yes.
	[51be21fc2c9d]

	* src/lib-index/mail-transaction-log.c:
	When committing transaction, don't do index locking unless we really
	want to try rotating the log file.
	[e7d6ae64fd68]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.h, src
	/lib-storage/index/maildir/maildir-sync.c:
	mail_index_refresh() isn't public anymore,
	mail_index_view_open_locked() works better for the purpose.
	[fd431866c674]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-index-transaction-view.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.h, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Changed mail_index_get_header() to return the header as return value
	because it can't fail anymore.
	[62d53b49110d]

	* src/lib-storage/index/index-sync.c:
	recent flag fixes
	[aad29dd2c1c5]

	* src/lib-storage/index/index-sync.c:
	recent flag fixes
	[10d88ed22df0]

	* src/lib-storage/index/maildir/maildir-save.c:
	APPEND/COPY was broken with maildir.
	[51982771ba4c]

	* src/lib-index/mail-index-sync.c:
	If we synced external transactions at the beginning of index sync,
	we have to reopen the syncing view so it shows the latest updates.
	[c1b4d0e7dff0]

	* src/login-common/master.c:
	Don't access freed memory.
	[70ce8c45e86b]

	* src/master/auth-process.c, src/master/common.h, src/master/login-
	process.c, src/master/mail-process.c, src/master/main.c, src/master
	/master-settings.c:
	Allow running all executables with parameters.
	[634cf6aa34d1]

2004-11-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync.c,
	src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log-view.c:
	Avoid re-reading index file with mmap_disabled=yes. Instead sync it
	by reading transaction log file.
	[1880f191278a]

	* src/imap/imap-sync.c, src/lib-index/mail-index-lock.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-sync-update.c, src
	/lib-index/mail-index-sync.c, src/lib-index/mail-index-transaction-
	private.h, src/lib-index/mail-index-transaction-view.c, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index-view.c, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log.c:
	Update view's header only after syncing the view. This and other
	changes fix several view syncing problems and crashes.
	[173a0296e81d]

	* src/lib-storage/index/index-search.c:
	We didn't give error if trying to search message by sequence in an
	empty mailbox.
	[1f5201e660c1]

	* src/lib-index/mail-transaction-log-view.c:
	When view was synced without expunges, we didn't actually sync the
	expunges later anymore.
	[dda3fe468ea3]

2004-11-12  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Make SIGUSR1 reopen log files.
	[bd3f5358de8b]

	* src/lib/lib-signals.c, src/lib/lib-signals.h:
	Add signal counters to USR1 and USR2 signals too.
	[f2718224c9e9]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/maildir
	/maildir-storage.c:
	dovecot-shared file was supposed to show permissions/gid for files
	created in the maildir, but it didn't work for indexes.
	[aa93c7216722]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c:
	APPEND was using all CPU.
	[904c31d74acc]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	src/lib-index/mail-transaction-log.c, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Allow specifying to transaction if it's external. Make mail saving
	transactions external to avoid problems with uids.
	[3cb483d565a6]

2004-11-11  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-ntlm.c, src/lib-ntlm/ntlm-message.c:
	allow LM authentication for older (Win9x) clients which do not pass
	NTLM response in type 3 message. fixes crash in dovecot-auth (empty
	credentials could be passed to hex_to_binary function if NTLM2 was
	negotiated). Patch by Andrey Panin
	[78dc2381f3af]

	* src/imap/cmd-fetch.c:
	Make sure fetching gets deinitialized properly if connection closes
	in the middle of it.
	[90f2ac2d16df]

	* src/lib-index/mail-index-sync-update.c:
	crashfix
	[0f485075ba8f]

2004-11-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/pop3/main.c:
	Make sure imap or pop3 processes cannot be started from inetd.
	[72f28a4b964d]

2004-11-08  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Check for libgen.h and if it's not found, use my_basename(). Also
	my_seteuid() didn't actually replace seteuid() before if it didn't
	exist.
	[c0e2a38b7647]

	* src/lib-index/mail-index-sync-update.c:
	crashfix
	[d72a03773b2f]

	* src/lib/Makefile.am, src/lib/byteorder.c, src/lib/byteorder.h:
	Removed byteorder.* files. They're not used anymore.
	[2f00acfc6bc2]

	* src/lib-index/mail-cache-sync-update.c, src/lib-index/mail-cache.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-view-sync.c, src/lib-index/mail-index.c:
	Cache invalidating needed to hook into view syncing as well.
	[d2daf90c79f1]

	* src/lib/file-cache.c:
	Use madvise(MADV_DONTNEED) for invalidated pages to free memory.
	[316756b50150]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-cache.c:
	More correct file cache invalidating.
	[d416b6d0a7ee]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	cache-private.h, src/lib-index/mail-cache-sync-update.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-cache.c,
	src/lib/Makefile.am, src/lib/file-cache.c, src/lib/file-cache.h:
	Cache file works now with mmap_disable=yes. Still needs a few
	optimizations.
	[bf1e718e7370]

2004-11-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-decisions.c:
	mark decision changes dirty so when we're trying to write them to
	disk, we don't actually just forget them..
	[604e9488a61b]

	* src/lib-index/mail-index-lock.c:
	Crashfix
	[890e1deba03e]

	* src/lib-index/mail-index-fsck.c:
	Allow calling mail_index_fsck() with log locked.
	[f922505b5ade]

	* src/lib-index/mail-transaction-log.c:
	fsck index if transaction log is found to be corrupted.
	[6a8c73bfbcad]

	* src/lib-index/mail-index-sync-update.c:
	Added extra checks to avoid crashes with corrupted transaction log.
	[8b0c2bb2459f]

	* src/auth/mech-digest-md5.c:
	DIGEST-MD5 was broken.
	[48539b255f0c]

	* src/lib-mail/message-body-search.c:
	Use dynamic buffer. Probably fixes some "buffer full" crashes.
	[ddedbc9bf433]

	* src/lib/buffer.c:
	Print pool name for "buffer full" errors.
	[3ecf8b2dfab0]

	* src/lib-index/mail-index.c:
	Removed assert, it's allowed to happen
	[b4a46746eb52]

2004-11-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cache.c:
	print info about cache clearing
	[76a4ecb71b86]

	* src/auth/auth-cache.c:
	SIGHUP now clears cache.
	[0e0682b3167b]

	* src/lib/lib-signals.c, src/lib/lib-signals.h, src/master/main.c:
	Changed lib_signal_hup to lib_signal_hup_count.
	[e0db9324e799]

	* src/lib-index/Makefile.am, src/lib-index/mail-cache-compress.c, src
	/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-private.h,
	src/lib-index/mail-cache-sync-update.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-index/mail-index-transaction-
	private.h, src/lib-index/mail-index-transaction-view.c, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index-view.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/lib-index/mail-transaction-util.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Removed cache_offset from mail_index_record and changed it to use
	extension instead. Added possibility to register sync and expunge
	handlers for extensions. Changed the way extension resets work: all
	extension updates which were committed without having seen the reset
	are ignored.
	[512dd7d76cdc]

2004-11-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-logout.c:
	warning fix
	[a05dfa1d878b]

	* src/auth/auth-cache.c:
	fix
	[190778cbf865]

2004-11-04  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/pop3-proxy.c:
	Check that PASS replies with OK.
	[4e5b1a1494c5]

2004-11-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Last fix was wrong..
	[9099bb8ee151]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	line updating was broken
	[90181a803762]

	* src/lib-storage/index/mbox/mbox-sync.c:
	idx_seq wasn't properly set when we were seeking into UID which
	doesn't exist anymore. this sometimes caused valid records to be
	deleted from index which caused mbox sync errors.
	[68e1fabc7b06]

2004-11-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	oops
	[8fcedb2551c8]

	* src/lib-storage/index/mbox/mbox-sync.c:
	error message fix
	[495718afaa10]

	* src/auth/auth-client-connection.c:
	Crashfix in some error conditions
	[cbf3b2890cad]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Cleanups
	[0db10c307f05]

	* src/auth/userdb-ldap.c, src/auth/userdb-sql.c:
	And more leak fixes..
	[696fe2f5152c]

	* src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	Fixed memory leaks.
	[b66dd3188e6a]

	* src/auth/auth-cache.c, src/lib-sql/driver-mysql.c:
	memory leak fixes
	[1da885e2b04f]

	* src/lib/str.c, src/lib/str.h:
	Added str_free_without_data().
	[aae2a75b0997]

2004-10-29  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c:
	typofix: advertise auth=plain only with disable_plaintext_auth = yes
	[62908cbe2299]

2004-10-28  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c:
	another proxy crashfix
	[0fe39d90ee15]

	* src/imap-login/client.c, src/pop3-login/client.c:
	crashfixes
	[42a86c987c78]

2004-10-27  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.h, src/imap-login/imap-proxy.c,
	src/pop3-login/client.h, src/pop3-login/pop3-proxy.c:
	Keep proxy_user stored until proxy is destroyed.
	[39c315e7697d]

2004-10-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	Don't show extra LFs in lines longer than input buffer size.
	[c921f1e0e517]

	* src/lib-storage/index/mbox/mbox-sync.c:
	still not right
	[a500a6bba13b]

	* src/lib-storage/index/mbox/mbox-sync.c:
	one more expunge fix..
	[5b19bcd5bb28]

	* src/lib-storage/index/mbox/mbox-sync.c:
	expunge logic still wrong. maybe now?
	[909ac8c9039d]

	* src/lib-storage/index/mbox/mbox-sync.c:
	last fix was wrong
	[f71de5c12419]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Expunge sync fix
	[d1bae4aa3f80]

	* src/lib-index/mail-cache.c:
	fix.
	[e1043732c987]

	* src/lib-storage/index/mbox/mbox-sync-private.h:
	cleanup
	[811945597b6a]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	restart partial syncs correctly. and cleanups.
	[e3572b0651f7]

2004-10-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	one more major version change fix
	[645b8442b519]

	* src/lib-index/mail-index.c:
	More rebuilding fixes with mmap_disable=yes
	[431f677bc0b9]

	* src/lib-index/mail-index.c:
	Rebuild broken index files with mmap_disabled=yes too..
	[43bab10e060d]

	* src/lib-index/mail-index.c:
	Handle major version changes silently even if the file isn't large
	enough to contain full expected header.
	[280c933983a9]

	* src/lib-index/mail-index.c:
	Don't crash if mmap_disable=yes and index is broken.
	[b6f8303575b3]

	* Makefile.am:
	config.rpath isn't supposed to be here..
	[f3e7ce34721f]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log-view.c, src/lib-
	index/mail-transaction-log.c:
	Use separate sync offsets for internal/external transactions.
	Pending external transactions are committed into index at the
	beginning of syncing, internal ones aren't.
	[bea9c88c8763]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	Always protect maildir syncing with uidlist lock. Before we only
	tried to do it and if it failed, we went ahead and just didn't sync
	any new messages. That however could have caused files to be lost
	temporarily due to race conditions between readdir() and rename().
	[a758a5b542bb]

	* src/lib/restrict-access.c:
	getgroups() was used wrongly before and caused problems if there
	were lots of groups. Patch by Jeff Rife.
	[cc27696fb36d]

2004-10-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Don't crash to asserts
	[166bb07246ef]

	* src/lib-index/mail-transaction-log.c:
	fix
	[ed85b5a62e06]

	* src/lib/buffer.c:
	buffer_insert() and buffer_insert_zero() didn't work correctly when
	it used to append data.
	[b85473a4df1b]

2004-10-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-logout.c:
	Send the "* BYE Logging out" before closing mailbox.
	[572f29f4fa22]

2004-10-22  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-sql.conf, src/auth/passdb-sql.c:
	Make it more clear that password query must return a "password"
	named field.
	[4481384a4fba]

	* src/auth/passdb-cache.c:
	Don't try to free cache if it doesn't exist.
	[253fae0aa95f]

	* doc/Makefile.am, doc/auth-protocol.txt:
	Dovecot authentication protocol v1.0
	[74517c34a687]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/lib-auth/auth-server-connection.c, src/master
	/auth-process.c:
	Separate major/minor version with TAB instead of dot in VERSION.
	[0b1bef51f207]

	* src/auth/mech-ntlm.c, src/lib-ntlm/ntlm-message.c, src/lib-
	ntlm/ntlm.h:
	support OEM encoding in NTLM messages. Patch by Andrey Panin.
	[48250919bbc4]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	More expunge/rewrite fixes.
	[ad3fcccca2bb]

2004-10-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-transaction.c:
	Don't access freed memory.
	[535e3e2d230e]

	* dovecot-example.conf, src/master/master-settings.c:
	mail_log_prefix was using old %p, changed it to %s..
	[100ecc609dd1]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	rewrite fixes
	[c686e724aba6]

	* src/lib-index/mail-index-view-sync.c:
	Crashfix
	[bbfb6a094bb1]

	* dovecot-example.conf:
	mysql/pgsql -> sql
	[bdfccd54a077]

	* src/lib/buffer.c:
	Don't return values from void functions.
	[7cf652f2a33a]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-idle.c:
	IDLE used 100% CPU.
	[3f7d4af90ec1]

	* src/lib/ioloop-notify-none.c:
	cleanup
	[be9a3a706b7a]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-cache.c,
	src/auth/auth-cache.h, src/auth/mech.c, src/auth/mech.h, src/auth
	/passdb-cache.c, src/auth/passdb-cache.h, src/auth/passdb-ldap.c,
	src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c,
	src/auth/passdb.c, src/auth/passdb.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added simple LRU cache for auth requests. Currently only for sql
	passdb.
	[54b29901a793]

	* doc/variables.txt, src/auth/mech.c, src/master/mail-process.c:
	Changed %p (protocol) -> %s (service). Also changed %P (pid) -> %p.
	Hopefully people weren't using these much yet :)
	[322b580e0eb4]

	* configure.in, src/auth/Makefile.am, src/imap-login/Makefile.am,
	src/imap/Makefile.am, src/lib-auth/Makefile.am, src/lib-
	charset/Makefile.am, src/lib-imap/Makefile.am, src/lib-
	index/Makefile.am, src/lib-mail/Makefile.am, src/lib-
	ntlm/Makefile.am, src/lib-settings/Makefile.am, src/lib-
	sql/Makefile.am, src/lib-storage/Makefile.am, src/lib-
	storage/index/Makefile.am, src/lib-
	storage/index/maildir/Makefile.am, src/lib-
	storage/index/mbox/Makefile.am, src/lib-
	storage/register/Makefile.am, src/lib-storage/subscription-
	file/Makefile.am, src/login-common/Makefile.am,
	src/master/Makefile.am, src/pop3-login/Makefile.am,
	src/pop3/Makefile.am, src/util/Makefile.am:
	Upgrades to autoconf 2.5 and automake >1.4.
	[fb7f862194b5]

	* config.rpath:
	This is a generated file. Shouldn't be in cvs.
	[913f6db2dffc]

2004-10-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Removed special Maildir/.INBOX directory. Indexes are now stored in
	maildir root.
	[1472e409c299]

	* src/lib-mail/istream-header-filter.c:
	Don't crash if no headers are given (fixes FETCH BODY[n.MIME]
	crashing)
	[19a6ff9fed58]

	* dovecot-example.conf, src/imap/common.h, src/imap/imap-fetch-body.c,
	src/imap/main.c:
	Added tb-negative-fetch workaround.
	[7cc03b8278a8]

	* src/auth/auth-master-connection.c, src/master/auth-process.c:
	Put SPID back, it's needed for standalone dovecot-auth.
	[b12e61e55c01]

	* src/auth/auth-master-connection.c, src/imap-login/client.c,
	src/imap/client.c, src/lib/ostream-file.c, src/lib/ostream-
	internal.h, src/lib/ostream.c, src/lib/ostream.h, src/login-common
	/login-proxy.c, src/pop3-login/client.c, src/pop3/client.c:
	Changed ostream's flush callback to have return value which can tell
	if there are more bytes to be sent even if there is none in output
	buffer itself. Fixes FETCH commands which used
	o_stream_send_istream() getting stuck.
	[02c0b8d532c2]

	* src/imap/imap-fetch-body.c:
	input->eof && o_stream_send_istream() == 0 isn't a correct way to
	check if all is sent. Use i_stream_have_bytes_left() instead.
	[c6f128e5520b]

	* src/lib/istream.c, src/lib/istream.h:
	Added i_stream_have_bytes_left().
	[f322b24da429]

	* src/imap-login/client.c, src/imap-login/client.h, src/imap-login
	/imap-proxy.c:
	Fixes.
	[ce98a0248ea1]

	* src/imap-login/imap-proxy.c, src/login-common/login-proxy.c,
	src/pop3-login/pop3-proxy.c:
	Logging changes.
	[9aaa737f8215]

	* src/pop3-login/pop3-proxy.c:
	Use USER/PASS instad for AUTH PLAIN. Also don't require "+OK" to
	have parameters.
	[fc4b1ec1b3ef]

2004-10-19  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Don't advertise LISTEXT capability. It's still a draft which changes
	constantly.
	[12ac68531a3a]

	* src/imap-login/client.c, src/pop3-login/client.c,
	src/pop3-login/pop3-proxy.c:
	crashfixes
	[717f8579f1df]

	* src/auth/auth-client-connection.c:
	Don't crash with invalid auth client input.
	[31154fd63ca8]

	* src/auth/auth-client-connection.c, src/auth/auth-client-
	connection.h, src/auth/mech-rpa.c, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb-pam.c, src/auth/passdb-vpopmail.c, src/lib-auth
	/auth-client.h, src/lib-auth/auth-server-request.c, src/login-common
	/sasl-server.c, src/login-common/sasl-server.h:
	s/protocol/service/ in authentication
	[e44a84dc947c]

	* src/lib-storage/index/index-mailbox-check.c:
	If we can't add file to I/O notify list, close the fd so we don't
	leak. Fixes IDLE leaking fds with all but Linux.
	[4ff5b3e8ee51]

	* src/login-common/master.c, src/master/login-process.c, src/master
	/master-login-interface.h:
	Added version to login <-> master communication as well.
	[1fd55b4341b9]

	* src/master/auth-process.c:
	We didn't send VERSION handshake to auth process.
	[b85e7c414f06]

	* src/auth/auth-client-connection.c, src/auth/auth-client-
	connection.h:
	If auth client sends broken input and we disconnect it, wait for a
	while before disconnecting to avoid flooding.
	[dc309a440bbe]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-client-interface.h,
	src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/auth-master-interface.h, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-connection.h,
	src/master/auth-process.c:
	Added VERSION command and checking to authentication protocol.
	[150f8151c971]

	* src/master/log.c:
	Log flushing fixes.
	[e6e73d1db27c]

	* TODO:
	updated
	[689e4235681f]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap-login/imap-proxy.c, src/imap-login
	/imap-proxy.h, src/login-common/common.h, src/login-common/login-
	proxy.c, src/login-common/login-proxy.h, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3-login/pop3-proxy.c, src/pop3-login/pop3-proxy.h:
	More smart IMAP and POP3 proxies. Now if remote login fails, it just
	destroys the proxy and allows trying another username which can go
	elsewhere. Also now replies with the same old "Authentication
	failed" error message instead of showing remote server's failure
	message.
	[e624a9ad6a30]

	* src/auth/auth-client-connection.c, src/lib-auth/auth-server-
	request.c, src/login-common/sasl-server.c:
	Use reason=xx field in FAIL to report the error message instead of
	separate field.
	[7ac5ee00278c]

	* configure.in:
	Use -lz always with mysql. Our previous check wasn't really working
	because the later -lz check used cached failure.
	[24c128e54337]

2004-10-18  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-sql.conf:
	comment update
	[b69f441e3fa6]

	* src/auth/passdb-sql.c:
	Don't require boolean flags to be 'Y' for yes, only to be non-NULL.
	[0058f0b70402]

	* src/auth/auth-client-connection.c, src/auth/mech.h, src/auth/passdb-
	sql.c, src/imap-login/Makefile.am, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/imap-login/client.h,
	src/imap-login/imap-proxy.c, src/imap-login/imap-proxy.h, src/login-
	common/Makefile.am, src/login-common/login-proxy.c, src/login-common
	/login-proxy.h, src/login-common/main.c, src/login-common/sasl-
	server.c, src/pop3-login/Makefile.am, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3-login/pop3-proxy.c, src/pop3-login/pop3-proxy.h:
	Added IMAP and POP3 proxying support.
	[d344be0bb70f]

	* src/lib/restrict-access.c:
	We failed with "Can't drop root group privileges" if root's gid
	wasn't 0. This happened often with Solaris. Thanks to Gregory Bond
	for figuring out.
	[54dfccbe7f11]

	* configure.in, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/lib-auth/auth-server-request.c, src/login-common
	/sasl-server.c, src/login-common/sasl-server.h, src/pop3-login
	/client-authenticate.c, src/pop3-login/client.c:
	Implemented support for LOGIN-REFERRALS using "referral" and
	"reason" parameters from auth server.
	[26a091f3add6]

	* src/auth/auth-client-connection.c, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb-sql.c:
	Authentication OK and FAIL replies can now contain extra fields from
	passdb. Implemented this for sql passdb. Special fields are
	"nologin" (user can't actually login) and "nodelay" (don't delay
	failure replies).
	[428bba43a387]

	* src/auth/mech-rpa.c:
	Didn't work with asynchronous passdb.
	[3cc4ebb5f42d]

	* src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/client.h:
	tls/secured variables are in common client structure. Plaintext
	logins didn't work because of this when disable_plaintext_auth =
	yes, even if SSL was used.
	[ab14dffd0e91]

2004-10-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-transaction-private.h, src
	/lib-index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/lib-index/mail-transaction-util.c, src/lib-
	index/mail-transaction-util.h:
	New way of handling extension introductions in transaction log.
	[a1c7e92c1839]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c:
	Removed mmap() memory area protections. They weren't always set
	correctly. Also grsec crashed with them anyway.
	[f96a7b2d1c52]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-transaction-log.c:
	Write transactions into index at the beginning of syncing if there's
	appends or external changes.
	[9ad220ac86c3]

	* src/pop3-login/client-authenticate.c:
	If login fails with internal failure, show it to client as -ERR [IN-
	USE]
	[19b9266f720e]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c:
	Unlock uidlist file only after appends are written to transaction
	log.
	[34aeee65368d]

2004-10-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/sql-api.c:
	warning fix when not compiled with any sql drivers
	[b0e039ad5717]

	* src/lib/ostream-file.c:
	Growing output buffer size broke the data inside it.
	[9cd5d91509bb]

	* src/lib/macros.h:
	i_unreached(): show also file and line number in error message
	[13c70c53cb55]

	* configure.in, doc/Makefile.am, doc/dovecot-mysql.conf, doc/dovecot-
	pgsql.conf, doc/dovecot-sql.conf, src/Makefile.am,
	src/auth/Makefile.am, src/auth/auth-master-connection.c, src/auth
	/db-mysql.c, src/auth/db-mysql.h, src/auth/db-pgsql.c, src/auth/db-
	pgsql.h, src/auth/db-sql.c, src/auth/db-sql.h, src/auth/passdb-
	mysql.c, src/auth/passdb-pgsql.c, src/auth/passdb-sql.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb-mysql.c,
	src/auth/userdb-pgsql.c, src/auth/userdb-sql.c, src/auth/userdb.c,
	src/auth/userdb.h, src/lib-sql/.cvsignore, src/lib-sql/Makefile.am,
	src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/sql-api-private.h, src/lib-sql/sql-api.c, src/lib-sql/sql-api.h:
	Created generic asynchronous SQL API and implemented MySQL and
	PostgreSQL drivers. MySQL is implemented synchronously because it's
	API doesn't provide async way to do it.

	Replaced pgsql and mysql userdb/passdb with generic sql
	userdb/passdb.
	[3c3ac12be307]

	* src/auth/mech.c:
	extra assert
	[cc35dc9b9cdf]

	* src/master/auth-process.c:
	t_pop() leakfix
	[3a195d649a73]

2004-10-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Try to create the whole directory structure up to root_dir if it
	doesn't exist.
	[c835f7e5e0e4]

	* src/lib/ostream-file.c:
	Don't use sendfile() for files, even with Linux. 2.6 kernels don't
	support it anymore and I'm not sure anymore if it fully worked with
	2.4 either.
	[63fb0678a7d6]

	* src/login-common/Makefile.am:
	missing sasl-server.h
	[0aaf1fec427c]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Fixed error message
	[a71c11890f34]

	* src/lib-index/mail-cache-transaction.c:
	Holes in cache file were broken
	[1e65e0684377]

	* src/lib-index/mail-transaction-log.c:
	Log syncing fixes
	[bf2bdf2dd9ae]

	* src/lib-storage/index/index-mail.c:
	Don't crash even if view is inconsistent.
	[2e81cd0a9acd]

2004-10-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	expunge fix
	[1c4b1e78ffc5]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	If rewriting began with expunged data areas, we didn't overwrite
	them which left garbage into mbox and broke things.
	[2cada6a7f3eb]

	* src/imap/imap-fetch.c:
	Don't insert extra space before "* n FETCH"
	[192da9681e1b]

	* src/lib/sendfile-util.c:
	FreeBSD fix
	[95fd6024e1e2]

2004-10-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[20faabfb838b]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Added asserts
	[ebcb45283c70]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c:
	Auth protocol fix
	[da392e6e473b]

	* src/login-common/client-common.c:
	forgot to add
	[134ad6e8cd42]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-client-interface.h,
	src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/auth-master-interface.h, src/auth/mech-
	anonymous.c, src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth/mech-
	ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/userdb.h, src/imap-login/client-
	authenticate.c, src/lib-auth/auth-client.h, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-connection.h, src/lib-
	auth/auth-server-request.c, src/lib-auth/auth-server-request.h, src
	/login-common/sasl-server.c, src/login-common/sasl-server.h,
	src/master/auth-process.c, src/master/auth-process.h,
	src/master/common.h, src/master/login-process.c, src/master/mail-
	process.c, src/master/mail-process.h, src/pop3-login/client-
	authenticate.c:
	Changed dovecot-auth protocol to ASCII based. Should be easier now
	to write replacement server if needed by someone. Also cleaned
	up/made more consistent auth code. The new code could still use some
	cleaning though..
	[0f31778d3c34]

	* src/pop3/client.c:
	Crashfix
	[25113dcc9705]

2004-10-11  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/lib-storage/mail-
	storage.c:
	Changed the "internal error" message, once again. Hopefully this is
	finally clear enough for people to actually understand to look at
	the logs.
	[e2ce951fa8e6]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/login-common/Makefile.am, src/login-common
	/auth-common.c, src/login-common/auth-common.h, src/login-common
	/client-common.h, src/login-common/sasl-server.c, src/login-common
	/sasl-server.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h:
	Login process cleanups. Share more authentication code between
	pop3/imap.
	[9b9d9c164a31]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Make sure nothing is buffered in mbox stream when syncing.
	[69c521ecf570]

	* src/imap/cmd-append.c:
	Handle failures without crashing
	[b63b4080c6b2]

	* src/imap/imap-fetch.c:
	Don't send extra ")" line with bad FETCH parameters.
	[eef378c0c07d]

	* src/lib-index/mail-index-sync.c:
	Don't go trying to updating index, if there's nothing to update.
	[26d266d8a2bb]

	* src/lib/file-dotlock.c:
	Check that dotlock PID exists even if we don't do stale lock
	timeouting.
	[486a5dbbc9c8]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Crashfix in error condition.
	[8c82376938a8]

	* dovecot-example.conf, src/master/master-settings.c:
	Enable outlook-idle workaround by default.
	[8ba8f672dc3e]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-transaction-
	log.c:
	typofixes
	[ccd07e584938]

2004-10-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-transaction.c:
	Don't lock/unlock mbox separately for each message. Drop the lock
	only at the end of the transaction.
	[0b4d8354737a]

	* dovecot-example.conf, src/lib-index/mail-cache.c, src/lib-index
	/mail-index-lock.c, src/lib-index/mail-index-private.h, src/lib-
	index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/index-storage.c, src/master/mail-process.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Replaced fcntl_locks_disable with lock_method, so it's now possible
	to use flock() to lock indexes.
	[12b503fbb8af]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Use only a single transaction for the whole duration of pop3
	session. Avoids constant locking/unlocking the indexes.
	[8c5bcd6585a4]

	* src/auth/db-mysql.c:
	Compile fix
	[4ec77eca761d]

	* src/lib/file-dotlock.c:
	Write host:pid into lock file *before* link()ing it into real lock
	file.
	[b0474af863ab]

	* dovecot-example.conf, src/auth/mech.c, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3/client.c, src/pop3/commands.c, src/pop3/common.h,
	src/pop3/main.c:
	Renamed pop3_mails_keep_recent to pop3_no_flag_updates which
	includes not updating seen-flag.
	[f8adc5cb2508]

	* src/auth/auth-client-connection.c, src/auth/mech.c:
	Fix some potential crashes
	[f5b135533197]

	* configure.in, src/auth/Makefile.am, src/auth/mech-cyrus-sasl2.c,
	src/auth/mech.c, src/auth/mech.h, src/lib-index/mail-index-view.c,
	src/master/auth-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Removed Cyrus SASL code completely. It hasn't worked for ages (if
	ever?) and there's not much point in having it anyway.
	[9d83aecdcfd7]

2004-10-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	If FETCH failed immediately, we sent back extra ")" line.
	[ca9d5d046f23]

	* src/lib-index/mail-index.c:
	Copying mapping to memory didn't copy some fields which could have
	caused problems (especially "lost transaction log file .. seq 1")
	[b81a60004612]

	* src/lib-storage/index/index-sync.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Recent flag fixes
	[6ed287e7a31c]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Don't close mbox file stream unless we're actually using mmap.
	Avoids extra read()s.
	[e11ac6ab7470]

	* src/pop3/client.c, src/pop3/commands.c:
	Buffer more in memory before sending RETR replies.
	[c710572d7075]

2004-10-08  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Delay writing seen flags to mailbox.
	[d2e899bb6f5b]

	* src/lib/ostream-file.c:
	Don't do anything in cork() if stream is closed.
	[ebc72e393388]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[e3206b95ec0f]

	* src/auth/auth-master-connection.c, src/auth/main.c, src/auth/mech-
	cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-rpa.c,
	src/auth/mech.c, src/auth/passdb-checkpassword.c, src/auth/password-
	scheme-rpa.c, src/auth/password-scheme.c, src/imap-login/client-
	authenticate.c, src/imap/cmd-sort.c, src/imap/commands-util.c,
	src/imap/commands.c, src/imap/imap-fetch.c, src/imap/imap-sort.c,
	src/lib-auth/auth-client.c, src/lib-auth/auth-server-connection.c,
	src/lib-auth/auth-server-request.c, src/lib-charset/charset-utf8.c,
	src/lib-imap/imap-base-subject.c, src/lib-index/mail-cache-
	compress.c, src/lib-index/mail-cache-fields.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-transaction.c, src/lib-
	index/mail-cache.c, src/lib-index/mail-index-sync.c, src/lib-index
	/mail-index-transaction.c, src/lib-index/mail-index-view-sync.c, src
	/lib-index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-
	index/mail-transaction-log.c, src/lib-mail/istream-header-filter.c,
	src/lib-mail/message-body-search.c, src/lib-mail/message-parser.c,
	src/lib-mail/quoted-printable.c, src/lib-ntlm/ntlm-encrypt.c, src
	/lib-ntlm/ntlm-message.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c, src
	/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-search.c,
	src/lib/base64.c, src/lib/base64.h, src/lib/buffer.c,
	src/lib/buffer.h, src/lib/hex-binary.c, src/lib/hex-binary.h,
	src/lib/ostream-crlf.c, src/lib/str.c, src/pop3-login/client-
	authenticate.c:
	Buffer API change: we no longer support limited sized buffers where
	writes past limit wouldn't kill the process. They weren't used
	hardly anywhere, they could have hidden bugs and the code for
	handling them was too complex.

	This also changed base64 and hex-binary APIs.
	[f1e9f3ec8135]

	* src/lib-index/mail-index-sync.c:
	group multiple recent flag updates together
	[bd250ef1c09a]

	* src/lib/buffer.c:
	buffer_insert* were broken
	[21bb4bb2ca39]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Add seteuid() wrapper for HP-UX
	[20dcf58cc05c]

	* src/lib-storage/index/index-mail.c:
	cache_flags were being updated constantly.
	[7209877f49a0]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Remove recent-flags even if flags are dirty.
	[28693bf81196]

	* src/lib-index/mail-transaction-log-view.c:
	Don't complain about corruption when there is none.
	[d6f25d0e104a]

	* src/lib-index/mail-transaction-log-view.c:
	fix
	[1e7b3a1db07f]

2004-10-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c:
	Added asserts
	[5b07b6fd9bf8]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	fix
	[479680ed12ee]

	* src/pop3-login/client-authenticate.c:
	Advertise all SASL mechanisms in old-style SASL discovery. Patch by
	Andrey Panin.
	[55308ec89931]

	* src/lib/ioloop-epoll.c:
	Missing error checking in epoll_create(). Patch by Andrey Panin
	[f3edd5e3c371]

	* src/auth/mech-ntlm.c:
	fix endianness problem, patch by Andrey Panin
	[e9699fe883a4]

2004-10-06  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	assert
	[f2b10efd15aa]

	* src/pop3/commands.c:
	Make sure fetching is uninitialized always. Do full read/write
	syncing when expunging.
	[7b24c608f225]

2004-10-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	crashfix
	[ba7cd618d916]

	* src/auth/mech-ntlm.c, src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm
	/ntlm-encrypt.h, src/lib-ntlm/ntlm-message.c:
	NTLM2 authentication support. Patch by Andrey Panin
	[1065a557516b]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/login-common/common.h, src/login-
	common/main.c, src/master/login-process.c, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3-login/client.h:
	auth_verbose now affects imap/pop3 login processes too. Every
	authentication attempt by client is logged. Also fixed replies in
	AUTHENTICATE/AUTH commands when it was aborted by client.
	[46f879c46b45]

	* src/auth/mech.c:
	Use the library function for username string sanitization.
	[7b50711a168d]

	* src/lib/Makefile.am, src/lib/str-sanitize.c, src/lib/str-sanitize.h:
	Added string sanitization functions.
	[631611c2d6e6]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't loop forever if sync record UIDs don't exist anymore.
	[606c79327434]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Bringing some sanity into mbox rewrites. Fixes expunge crashes and
	reduces writes.
	[482e1a1fe2ce]

	* src/lib-storage/index/index-mail-headers.c:
	Don't crash if fetching ENVELOPE for expunged message.
	[6e0a7083a880]

2004-10-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index.h, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/mbox/mbox-sync.c:
	When we had dirty messages, we kept resyncing the whole mailbox
	constantly.
	[52352a5859e4]

2004-10-03  Timo Sirainen  <tss@iki.fi>

	* src/pop3/commands.c:
	"UIDL <message>" was broken.
	[7979984b6276]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index.c, src/lib-index/mail-index.h, src
	/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync.c:
	Index extensions can now specify record alignment, and it's possible
	to resize header and records. Fixes mbox crashes with some 64bit
	systems.
	[d41c42a7bf1e]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_insert_zero()
	[f25f48725d95]

	* src/lib-storage/index/mbox/mbox-file.c:
	Give error message instead of crashing if mbox offset is lost.
	[d6c8faedc775]

	* src/imap/imap-fetch.c, src/imap/imap-fetch.h:
	If fetching fails, finish sending the untagged FETCH reply
	correctly.
	[48df7f95fa4a]

2004-10-01  Timo Sirainen  <tss@iki.fi>

	* src/login-common/main.c, src/login-common/ssl-proxy-gnutls.c, src
	/login-common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c:
	Show clear error messages if --ssl is tried to be used but it's not
	builtin/enabled.
	[8f7b01c29bcb]

	* src/auth/passdb-vpopmail.c:
	Cleanup - we don't need mycrypt.h anymore
	[f5726706dc56]

2004-09-29  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-cram-md5.c:
	Allow spaces in username.
	[cf94f1dc1ec5]

2004-09-28  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-close.c:
	Don't crash if CLOSEing without open mailbox.
	[542edc7f6091]

	* src/imap/cmd-fetch.c, src/imap/imap-fetch-body.c, src/imap/imap-
	fetch.c, src/imap/imap-fetch.h, src/lib-imap/imap-parser.c:
	BODY.PEEK[HEADER.FIELDS (...)] list is allowed to contain strings
	and literals. We didn't handle them correctly before.
	[60d33cf81c8e]

2004-09-27  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client.c, src/login-
	common/common.h, src/login-common/main.c, src/master/login-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h, src/pop3-login/client.c:
	Added login_greeting and login_greeting_capability settings.
	[857f5f7b512b]

	* dovecot-example.conf:
	Added example namespace with comments.
	[5f2c5b65b0cd]

2004-09-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech.c:
	Don't allow empty usernames. Solaris PAM seems to eat all memory
	with them.
	[e2b8702fcdf6]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-transaction-private.h, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log-view.c, src/lib-index/mail-transaction-
	log.c, src/lib-index/mail-transaction-log.h, src/lib-index/mail-
	transaction-util.c, src/lib-index/mail-transaction-util.h, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/mbox/mbox-
	file.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync.c:
	Renamed "extra record info" and variations of it to "extension" or
	"ext" in short.
	[3b70ddb51771]

	* src/imap/cmd-append.c:
	If message was APPENDed with LITERALPLUS and it failed for some
	reason (eg. mailbox didn't exist), we didn't consume the following
	message but instead treated it as commands.
	[e24c801dbc09]

2004-09-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/restrict-access.c:
	updated error messages
	[242bb128d493]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[9ef0bcd23ee7]

	* src/lib-storage/index/mbox/mbox-sync.c:
	crashfix
	[1c29c91c6228]

	* dovecot-example.conf:
	Updated mbox_dirty_syncs and mbox_lazy_writes comments.
	[0ba82d7a5aba]

	* src/imap/cmd-check.c, src/imap/cmd-logout.c, src/imap/cmd-select.c,
	src/imap/imap-expunge.c, src/lib-storage/index/mbox/mbox-storage.c,
	src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox/mbox-
	transaction.c, src/lib-storage/mail-storage.h, src/pop3/client.c:
	Split sync_flag_full into sync_flag_full_read and _write. Closing
	mailbox now always writes changes.
	[ccf563859be5]

	* src/lib-index/mail-index-sync-update.c:
	hdr_flag_have_dirty wasn't set if dirty flags were set in appends.
	[f54b0f04c628]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If only mbox timestamp changes, do a full sync.
	[cecf6f5a0d80]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-sync-
	private.h, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added mbox_lazy_writes setting.
	[add94f9aa9e1]

	* src/imap/cmd-logout.c, src/imap/cmd-select.c:
	Do full syncing at logout, not at select.
	[0d585c330c18]

2004-09-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	mail_index_map_to_memory() didn't resize record if mapping was
	already in memory.
	[b1f91349d216]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Handle UIDVALIDITY changes. When partial syncing, make sure UIDs of
	new mails are larger than existing ones. If partial syncing fails,
	we need to rollback the transaction.
	[33ad1877ca6d]

	* src/lib-index/mail-index-transaction.c:
	Don't break if same mail is expunged multiple times.
	[fd607e2be4a9]

	* src/lib/ostream-file.c:
	When corked, don't limit buffer size to optimal_block_size. Fixes
	problems with some command replies not being sent completely with
	IMAP, or crashes with pop3.
	[b89f471a0e04]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If MBOX_SYNC_FLAG_FULL is given, make sure we remove dirty syncing.
	[4a708855a533]

	* src/imap/imap-fetch-body.c:
	Error message update
	[2b5d4de3d827]

2004-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-ntlm/ntlm-encrypt.c:
	compiler warning fix
	[b522b7cea776]

	* src/lib/sendfile-util.c:
	Warning fix with Solaris.
	[dd015282fbdf]

	* dovecot-example.conf:
	comment updates
	[3b24284e4e36]

	* src/lib/file-dotlock.c:
	Re-read the PID from lock file every time before checking if it
	exists, because it may have changed.
	[ec6cd5dcf618]

2004-09-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/maildir/maildir-storage.c:
	Get index file mode and GID from dovecot-shared file.
	[9b78674428f5]

	* src/auth/main.c:
	finish the preinit change..
	[ec268f32e69e]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/db-mysql.c,
	src/auth/db-mysql.h, src/auth/db-pgsql.c, src/auth/db-pgsql.h,
	src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-mysql.c, src/auth/passdb-pam.c,
	src/auth/passdb-passwd-file.c, src/auth/passdb-passwd.c, src/auth
	/passdb-pgsql.c, src/auth/passdb-shadow.c, src/auth/passdb-
	vpopmail.c, src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb-
	ldap.c, src/auth/userdb-mysql.c, src/auth/userdb-passwd-file.c,
	src/auth/userdb-passwd.c, src/auth/userdb-pgsql.c, src/auth/userdb-
	static.c, src/auth/userdb-vpopmail.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Added preinit() call to userdb/passdbs, which is called before
	dropping privileges. init() is called after. SQL/LDAP now parses the
	config file in preinit, but does the actual connecting only in
	init(). This fixes LDAP crashing at startup.
	[cc2e39912eb3]

	* src/lib/ostream-file.c:
	If we couldn't send any bytes, don't reset buffer's full-flag.
	[a17d7463a4dc]

2004-09-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body.c:
	signed vs. unsigned warning fix
	[64e22d5c2829]

	* src/auth/passdb-bsdauth.c:
	warning fix
	[6285910d68a5]

	* src/auth/mech.c:
	type fixes
	[6ffc83f8b91e]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c:
	signed vs. unsigned comparision fixes
	[664e9001183e]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	transaction-log.c:
	type fixes
	[663fc1f2aaf5]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-
	transaction.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/mbox/istream-raw-mbox.c:
	Memory leak fixes
	[e357ebb3137b]

	* src/imap/client.c, src/imap/cmd-fetch.c, src/imap/imap-fetch.c:
	cleanups
	[66cad846df36]

2004-09-18  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	net_connect() should be nonblocking (currently unused in Dovecot)
	[a307ddd22a3a]

2004-09-17  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body.c:
	Allow buffering of output stream when sending message body, to avoid
	tons of write() calls if CRs have to be inserted.
	[f7bad0650b25]

	* src/util/rawlog.c:
	don't loop waiting for input, if it didn't come for some reason.
	[417f835dfcab]

2004-09-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/Makefile.am:
	fix
	[ff227b5c625d]

	* src/imap/imap-fetch-body.c:
	Make sure we disconnect if mail input is finished unexpectedly.
	[e69519ea4682]

	* src/lib/ostream-file.c:
	o_stream_send_istream() was buggy if input stream's offset wasn't 0
	or if sendfile() couldn't be used. Fixes problems with sending large
	mails.
	[b847d8650282]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Remove size==(uoff_t)-1 handling because it never happens.
	[a87abc14de35]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	Fix for circular record list detection, we can't use data stack for
	buffer.
	[ec5601f71ba0]

	* src/lib-index/mail-cache-lookup.c:
	Make sure we don't get into infinite loops while reading cache.
	[519b768e5f2f]

2004-09-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/password-scheme-cram-md5.c, src/lib/file-dotlock.c:
	compiler warning fixes
	[1c8410c8f602]

	* src/auth/mech-apop.c, src/auth/mech-rpa.c, src/auth/mech.c, src
	/imap-login/client-authenticate.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/proxy-mailbox.c, src/login-common/ssl-proxy-
	openssl.c, src/pop3-login/client-authenticate.c:
	Compiler warning fixes and cleanups
	[6ba9dcff11b9]

	* src/lib/base64.c, src/lib/base64.h, src/lib/sha1.c, src/lib/sha1.h:
	Change src from unsigned char* toi void* so callers don't have to do
	casting always.
	[59059ea978b2]

	* src/lib-index/mail-index-transaction-view.c:
	don't return void types
	[f806d35be249]

	* src/lib/istream.c, src/lib/istream.h:
	i_stream_read_data(): return 0 if i_stream_read() returned 0.
	[a2b910e21225]

2004-09-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	Don't crash if matching fails and we don't have header md5 sums
	saved.
	[babebc7ec9b1]

2004-09-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	We re-cached internaldate every time again, but never used it.
	[e9f98454abec]

	* src/lib-index/mail-cache-compress.c:
	bitmask merging code was corrupting the cache file
	[0157839e3c78]

	* src/login-common/main.c, src/pop3-login/client.c:
	Replaced timestamp in APOP challenge with 128 bits of randomness.
	[033d2fd1cd38]

	* dovecot-example.conf, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/client.c, src/pop3/client.h,
	src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Added pop3_enable_last setting to enable deprecated LAST command.
	[c6cc163344c3]

	* src/lib-index/mail-cache-compress.c:
	fix
	[f4f793129402]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h:
	ID mapping fixes.
	[ce8647d94bfc]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index.c:
	Fix buffer_set_used_size crashes.
	[a9599d2f1af6]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_write_zero and buffer_append_zero.
	[b14bbcf002d9]

	* src/lib-index/mail-transaction-log-view.c:
	Don't check extra updates data_id validity if we're just skipping
	over them.
	[13930bda8b69]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-transaction-log.c:
	We didn't include extra_rec_updates at checking if transaction had
	changed anything, and so they didn't necessarily get written to
	transaction log. This broke mbox offsets sometimes.
	[4448b82016bb]

	* src/lib-index/mail-transaction-log.c:
	Don't rotate log file if it's not fully synced
	[2ed8d5c1ecaf]

2004-09-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	cleanups
	[25db7c237229]

	* src/lib-mail/istream-header-filter.c:
	seek fix
	[2844c33a1be9]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-index-sync-
	update.c:
	a few more cache fixes
	[8ab92fe191c9]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	Last from offset sync fix broke everything. Another try.
	[664c732ae195]

	* src/lib-index/mail-index-transaction.c:
	added assert
	[71a0b646fd28]

	* src/lib-index/mail-index-transaction.c:
	added asserts
	[4ac7ab1e6db2]

	* src/lib-index/mail-transaction-util.c:
	more extra intro fixes
	[108c94c2ffae]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[441b4749241f]

	* src/lib-index/mail-transaction-log.c:
	Make sure MAIL_TRANSACTION_EXTRA_INTRO is 4 byte padded, otherwise
	it crashes.
	[7e47cf7a55bb]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-index-sync-update.c:
	Use global null4[] now.
	[9c6238e7a394]

	* src/lib/lib.c, src/lib/lib.h:
	Added null4[] variable.
	[cc0a22b08e4f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	From offsets were updated incorrectly sometimes.
	[9987c8d5a129]

	* src/lib-index/mail-index-transaction.c:
	More "cache file reopened" fixes
	[548dc4251583]

	* src/lib-index/mail-cache-transaction.c:
	extra asserts
	[0f7327288390]

	* src/lib-index/mail-transaction-log.c:
	if there's pending cache_reset in log file make sure appended
	records don't have invalid cache_offsets.
	[859dddfed80c]

	* src/lib-index/mail-cache-transaction.c:
	one more "cache file reopened" fix.
	[2568be07706f]

	* src/lib-index/mail-cache-transaction.c:
	Don't crash when cache isn't usable.
	[18cddf71996a]

	* src/lib-index/mail-cache-transaction.c, src/lib-index/mail-index-
	sync-update.c:
	More fixes to make sure we don't write buffered data to cache file
	after it's been reopened.
	[db059dc5d5c8]

	* dovecot-example.conf, src/imap/common.h, src/imap/main.c, src/master
	/mail-process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Removed mailbox_check_interval completely. It wasn't currently
	implemented, and most (all?) clients which would benefit from it
	support IDLE anyway.
	[b49d2ed4951a]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Report INBOX as existing always, even if it doesn't yet exist in
	disk. Fixes COPYing messages to INBOX when it didn't yet exist in
	disk.
	[96f454eb52c2]

	* src/lib-index/mail-cache-transaction.c:
	If cache file was recreated the buffered transaction changes were
	written into the new file which may have corrupted it.
	[6c03f22b2489]

	* src/lib-index/mail-cache-fields.c:
	minor fix
	[5edda9783458]

	* src/lib-storage/index/maildir/maildir-list.c:
	INBOX fixes for maildir too
	[1c7a73a05778]

	* src/imap/cmd-list.c:
	Don't force showing INBOX when listing only subscribed mailboxes.
	[4e18abf93a6d]

	* src/imap/cmd-list.c, src/lib-storage/index/mbox/mbox-list.c, src
	/lib-storage/mail-storage.h:
	Added MAILBOX_LIST_INBOX flag. Do the special cased INBOX handling
	only if it's set.
	[3a9a34bc0d05]

	* src/lib-storage/index/mbox/mbox-list.c:
	Make sure we return always one correct INBOX list entry.
	[1b69b6e6f0a6]

	* src/lib-storage/index/mbox/mbox-sync.c:
	When there's nothing to do to sync mbox, still commit index syncing
	instead of rollbacking because it may need to sync index internally.
	[7ba2e2d89536]

	* src/lib-index/mail-cache-transaction.c:
	Before adding new fields to cache file, make sure they weren't
	already added by re-reading the header after file is locked.
	[6bff38d73dd3]

2004-09-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c:
	minor fix for error message
	[bd0ffdd2afde]

	* src/lib-index/mail-transaction-log-view.c:
	Crashfix with corrupted log files.
	[70d79fd923c7]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[7abae2dc0498]

	* src/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/mbox/mbox-
	storage.c:
	Removed all "unreliable headers" handling code. With mbox we
	actually handle only virtual header sizes everywhere.
	[39d944735147]

	* src/lib-mail/istream-header-filter.c:
	Seeking was broken if header hadn't been read yet.
	[b88b34d95c7b]

	* src/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-storage/index/index-mail.c:
	When using cached message_parts, update the header size with mbox
	since it may change. Fixes BODY[1] etc. fetches giving corrupted
	replies.
	[a86d97c69e8f]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	cleanups
	[b0ab37ee418a]

	* src/lib-index/mail-cache-transaction.c:
	If we detect cache corruption, try to avoid printing tons of "bad
	file descriptor" error messages for writes.
	[9c76f91ba94c]

	* src/lib-index/mail-cache-lookup.c:
	Added debugging
	[fe4b0f597c38]

2004-09-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	fix
	[4b948cda1138]

2004-09-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	fix for last fix..
	[4bc0a68a9b72]

	* src/lib-mail/message-parser.c:
	Fixes for handling headers longer than input buffer.
	[6dfc352ec61b]

	* src/lib/istream.c:
	i_stream_read_data(): return -1 if we didn't read more data, even if
	buffer has some.
	[d10ad1e5a5aa]

2004-09-06  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-epoll.c:
	forgot to commit
	[829e683fd894]

	* src/lib/ioloop-notify-dn.c:
	Ignore SIGIO which gets sent if queue gets full. Also other small
	fixes/cleanups.
	[cc2127b799c5]

	* src/lib-storage/index/maildir/maildir-sync.c:
	cleanup
	[372d4b90c076]

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-poll.c:
	Added epoll support if --with-ioloop=epoll is given. Patch by Andrey
	Panin.
	[554f1324a435]

2004-09-05  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c:
	Drop F_NOTIFY before setting F_SETSIG back to SIGIO, otherwise we
	might get SIGIO and get ourself killed.
	[69f1ba731c84]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	fix
	[6c802bcb957e]

	* src/lib-storage/index/maildir/maildir-util.c:
	comment fix
	[db11e7936888]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	"UIDs not ordered in file" errors could have occured sometimes
	wrongly.
	[e14c2a36a0a2]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't allow renaming mailboxes under INBOX.
	[15be925bd1c8]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction-view.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-private.h, src/lib-
	index/mail-index-view-sync.c, src/lib-index/mail-index-view.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-index
	/mail-transaction-log-view.c, src/lib-index/mail-transaction-log.c,
	src/lib-index/mail-transaction-log.h, src/lib-index/mail-
	transaction-util.c, src/lib-index/mail-transaction-util.h, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync.c:
	Save extra record/header infos into index file permanently.
	[5752e5ac88f0]

	* src/lib/buffer.c:
	buffer_reset() was broken..
	[a815a495f1c8]

	* src/master/master-settings.c:
	"Corrected permissions for base directory" warning message printed
	wrong directory if base dir was changed in config file.
	[fef8ddd5fe52]

2004-09-04  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-create.c:
	CREATE was broken if namespace prefixes were set. Patch by Andreas
	Fuchs.
	[8319dd235b7b]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-storage.c, src/lib-storage/index
	/index-storage.h:
	Cache field indexes are cache file specific, not globals.
	[ad139af4ac12]

	* src/lib-storage/index/index-mail.c:
	Use uint32_t for getting mail_cache_flags.
	[eb2e47c8139c]

	* src/imap/imap-fetch-body.c:
	Don't ask for body size when fetching BODY[HEADER], so body doesn't
	have to be parsed.
	[1dfae038ecc6]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-storage.c, src/master/master-
	settings.c:
	Fixed cache flags to work again. Flags are cached by default now.
	[d39842e9e83b]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c:
	Added support for bitmask type.
	[87af1f39a69e]

	* src/lib/ostream-file.c:
	Added assert
	[3ad5b4e60321]

	* src/lib-index/mail-index.c:
	Avoid re-mmaping if not needed.
	[1fed92b6cc01]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c:
	Refcounting fixes for index mappings.
	[13c79a556b1f]

2004-09-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c:
	cleanup/new assert
	[111bd1e6d15b]

	* src/lib-index/mail-index-lock.c:
	a few more asserts
	[79de8de19d5e]

	* src/lib-index/mail-index-lock.c:
	lock mprotect fix
	[e81d4021f85b]

	* src/lib-index/mail-index-lock.c:
	lock fix
	[969a585dbc34]

	* src/lib-index/mail-index-sync-update.c:
	fix
	[021f865e1cfa]

	* src/lib-index/mail-index-sync-update.c:
	Don't fail if we can't lock cache file.
	[ea50ff7fe3c2]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't allow creating mailboxes under INBOX.
	[d76795adbbb4]

	* src/lib-index/mail-index-sync-update.c:
	fix
	[21a62d627989]

	* src/lib-index/mail-index-lock.c:
	mprotect() wasn't always called when index was being locked, and
	caused crashes.
	[2257709d7514]

	* src/lib-index/mail-index.c:
	When updating index mappings, don't let it affect existing views
	mappings. Fixes some crashes.
	[c3608081d0e4]

	* src/lib-storage/index/index-transaction.c:
	Fix for error handling.
	[75e8fc49a102]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Still wrong sync logic
	[5f62a2c34729]

	* src/lib-storage/index/mbox/mbox-sync.c:
	sync fix
	[7f247f5587fe]

	* configure.in:
	Don't check for linux/mman.h, it's not even used.
	[7d474e21e0c1]

	* src/imap/cmd-list.c:
	Fix for having INBOX/ namespace.
	[5c95f17f6f25]

	* src/lib/ostream-file.c:
	_send_istream() might have crashed.
	[0d2c47d85a3a]

2004-09-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-interface.h, src/imap-login/client-
	authenticate.c, src/pop3-login/client-authenticate.c:
	Tell dovecot-auth if SSL/TLS is enabled. Nothing can done with it
	yet though.
	[0db84a609ee2]

	* src/master/main.c:
	crashfix in pid generation
	[9c55e054e57d]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	Don't break if saving messages to maildir without index files.
	[89911d2a9126]

	* src/lib-storage/index/index-sync.c:
	Recent flags might have been wrong if they weren't set in ascending
	order.
	[c80b942d5040]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Go back to version 1 dovecot-uidlist file. The flags parameter isn't
	needed.
	[154403134c74]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Don't return -2 so easily in read()
	[83eab0b1872c]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	Wrong messages were set recent if another client had modified the
	mbox.
	[23ac04da861f]

	* src/imap/cmd-copy.c:
	removed extranous code.
	[739533156339]

	* src/pop3/commands.c:
	Make RETR mark the message seen.
	[792b3209f705]

	* src/lib-imap/imap-base-subject.c:
	Parsing fix
	[da6b2e4a8b3a]

2004-09-01  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	Log error message if we can't open INBOX.
	[633683d78bcb]

2004-08-31  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Create PID file.
	[3730256bf3d3]

	* src/lib-ntlm/ntlm-encrypt.c:
	Patch by Andrey Panin:

	 - open code ntlmssp_des_encrypt_triad() function;
	 - add two missing safe_memset(). It's not safe to leave NTLM hashes
	on the stack, because they are plain password equivalents.
	[415b3e8dea35]

	* src/auth/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h:
	Changed "invalid username" error message.
	[a07fb16b9a24]

	* src/lib/ostream-file.c:
	Output stream sometimes duplicated data and sometimes lost data.
	[3418a7f233ff]

	* src/pop3/commands.c:
	fixed potential crash
	[255cea3e2331]

2004-08-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Save sync_last_check for any sync, not just in sync_init() so FAST
	flag doesn't do another sync if one was just done in transaction
	commit.
	[d04c86bf59c9]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-expunge.c,
	src/imap/cmd-search.c, src/imap/cmd-store.c, src/imap/imap-
	expunge.c, src/imap/imap-fetch.c, src/imap/imap-sort.c, src/imap
	/imap-sync.c, src/imap/imap-thread.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/maildir/maildir-
	transaction.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-transaction.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/proxy-mailbox.c, src/pop3/client.c,
	src/pop3/commands.c:
	Added sync flags parameter to mailbox_transaction_commit(), so
	EXPUNGE can do a full sync with dirty syncing enabled.
	[f8be7a5e273a]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Disabling mbox_dirty_syncs didn't always work. And it was a bit
	broken.
	[545a109cbcef]

2004-08-28  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c:
	Initialize userdb/passdb/password schemes before dropping
	privileges.
	[bfd86f40b4c9]

	* src/auth/userdb-static.c:
	Added mail setting and made home optional.
	[113beb6d7d89]

	* src/master/master-settings.c:
	Default ssl_disabled to yes if SSL isn't compiled in.
	[bb5e0b737f81]

	* src/imap/client.c:
	Input handler tried to process multiple commands at once which broke
	things.
	[f6fdf9048a01]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h,
	src/lib-storage/index/mbox/mbox-sync.c:
	When mbox syncing is dirty, read the message headers to verify that
	we've found the correct message.
	[abcdec2299bd]

	* dovecot-example.conf, src/imap/cmd-check.c, src/imap/cmd-expunge.c,
	src/imap/cmd-select.c, src/lib-storage/index/index-storage.h, src
	/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-file.h, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox/mbox-
	transaction.c, src/lib-storage/mail-storage.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added mbox_dirty_syncs setting which delays re-reading the whole
	mbox when it's changed.
	[710e0bf25bf8]

	* dovecot-example.conf, src/auth/mech-apop.c, src/auth/mech-cram-
	md5.c, src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth
	/mech-ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c,
	src/auth/mech.c, src/auth/mech.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added auth_username_translation setting.
	[0f660149c7ef]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c:
	Fixed crash if mail data was fetched in specific order. Plus some
	minor fixes.
	[146591955618]

	* src/imap/client.c, src/imap/client.h:
	Command parameter errors weren't handled right. This was broken a
	few commits ago..
	[467af814d5e2]

	* src/lib-index/mail-transaction-log-view.c:
	Handle correctly the case when index hasn't yet been synced with
	transaction log.
	[5ad6ccb8000b]

	* src/auth/auth-client-connection.c:
	Process all input data from stream.
	[3c5ad10526fb]

	* src/auth/auth-client-connection.c:
	Fixed memory leak.
	[847759a0ff75]

	* src/imap/imap-fetch-body.c, src/imap/imap-sort.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/index-search.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/mail-storage.h, src/lib-storage/proxy-mail.c,
	src/pop3/client.c, src/pop3/commands.c:
	Added mail.get_physical_size().
	[98f6057f27a1]

	* src/pop3/commands.c:
	removed accidentally committed debugging
	[2946fa696774]

	* src/pop3/client.c:
	Deinitialize pop3 commands if connection is closed unexpectedly.
	[e628e0ab8924]

	* src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-idle.c:
	Deinitialize command handlers always.
	[b7eec64e0735]

	* src/lib-storage/index/maildir/maildir-save.c:
	Don't crash if canceling saving
	[430ee8bb6003]

	* src/lib/restrict-access.c:
	Or actually check also that RESTRICT_GID_FIRST=0 before allowing
	gid=0 use
	[fc2ec85f95ca]

	* src/lib/restrict-access.c:
	Allow group id to be 0 even with disallow_root. So setting
	valid_first_gid to 0 now actually works.
	[9232711b7a07]

	* src/imap/imap-fetch.c:
	Don't crash with unknown FETCH commands.
	[5cab421f36be]

2004-08-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c:
	Changed io_remove() to destroy the io immediately. Changed struct io
	to be double linked list. Moved highest_fd into select-specific
	struct. Some minor optimizations.
	[3f2b73c19a52]

	* src/lib/ioloop-select.c, src/lib/ioloop.c:
	Moved highest_fd calculation to select-specific code. Patch by
	Andrey Panin.
	[ed7628af7865]

	* src/pop3/client.c, src/pop3/commands.c:
	Fixes for nonblocking changes.
	[a2e2c76021b9]

	* src/lib/ostream-crlf.c:
	send_istream(): Don't return -1 if input stream just didn't contain
	anything.
	[9ac27c8f2a72]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Recent flag wasn't written always
	[11da9df0890c]

	* src/lib-index/mail-index-lock.c:
	We kept exclusive index lock too long which caused deadlocks.
	[e7e99c2b3cb5]

2004-08-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/lib-signals.c:
	Ignore SIGALRM.
	[0284ec4e6ed7]

	* src/lib-index/mail-index-sync.c:
	Don't crash if flag update record gets completely overlapped by
	expunges.
	[4a2c1f6e1a22]

2004-08-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c:
	Use larger default buffer sizes
	[b2993fe1337b]

	* src/lib/ostream-crlf.c:
	close/destroy fixes
	[270b0db8d18f]

	* src/lib-storage/index/mbox/mbox-save.c:
	Use correct error messages.
	[e7fa0d07f247]

	* src/imap/imap-fetch-body.c:
	fix
	[4f115e8b2e14]

	* src/lib/ostream-file.c:
	o_stream_send*() might have returned wrong value
	[c8b12c26a040]

	* src/imap/imap-fetch.c:
	Same FETCH handler could have been executed infinitely if client
	didn't read the data fast enough.
	[b0fc9984ddcd]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/mbox/mbox-storage.c:
	We shouldn't try to use cached header physical_size for mboxes
	because it changes.
	[626e943aacf1]

	* src/util/rawlog.c:
	Rawlog filename was always with date 01.01.1970.
	[2ad55f027439]

	* src/lib/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c:
	Internal I/O loop API change in preparation for epoll support. Patch
	by Andrey Panin.
	[ac93896adcc3]

	* src/lib/Makefile.am:
	ostream-crlf.h was missing
	[a8f363cef34e]

	* src/lib-storage/index/index-mailbox-check.c:
	Timeout/stat() based mailbox change checker didn't actually ever
	send notifications.
	[87b6d3303031]

	* src/lib-storage/index/maildir/maildir-save.c:
	Save mails through CRLF or LF output streams.
	[63dca331c266]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	sync fix
	[bce342d816f0]

	* src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Recent flag fixes.
	[27bea4044b93]

	* src/imap/cmd-idle.c:
	Crashfix
	[d2a64ae90011]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Don't crash with empty body
	[f4f133f84d63]

	* src/lib-mail/istream-header-filter.c:
	fix
	[90e72abe74bf]

	* src/lib/ostream-file.c:
	o_stream_sendv() returned wrong value if sending more than
	UIO_MAXIOV iovecs.
	[4fa0f02369b1]

	* src/lib/ostream-crlf.c:
	fixes
	[aabebe4dc5bf]

	* src/lib-mail/message-parser.c:
	fix
	[0da663b2265f]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Fixed handling messages with empty body.
	[70afa3cdcb27]

	* src/imap/main.c:
	Accidentally committed debugging code.
	[b932e4f92157]

	* src/lib/ostream-crlf.c, src/lib/ostream-crlf.h:
	Changed LF stream to replace only CRLF pairs. Changed send functions
	to return the number of input bytes consumed rather than number of
	bytes actually sent. This fixes send_istream().
	[b6b702b5f5fe]

2004-08-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Fixed parsing empty messages.
	[74b7dcdeafc5]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	istream-raw-mbox now sets stream->eof when it's at the end of
	message to fix some issues elsewhere.
	[db61972ffeb3]

	* src/lib/istream-file.c:
	_read() never returns 0 for files.
	[46765dafc6e7]

	* src/imap/client.c:
	fix
	[9946b489d21a]

	* src/lib-storage/index/mbox/mbox-save.c:
	Saving fix.
	[e201021f6ad9]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c:
	crashfixes
	[3accbeb04383]

	* src/lib/istream.c:
	i_stream_read_data(): don't return -1 unless we're at EOF.
	[b7a76368fdad]

	* src/lib/ostream-crlf.c:
	send_istream() didn't work properly.
	[346fe259a18c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Buffer wasn't set if _read() returned -2.
	[5506d4cd4973]

	* src/lib-storage/index/mbox/mbox-save.c:
	saving was broken
	[f32419d92307]

	* src/imap/cmd-append.c:
	Forgot want_mail=TRUE parameter from debugging.
	[d38f3876f3ad]

	* src/lib/ostream.c:
	o_stream_send* functions return type is ssize_t, not int.
	[db92fc0bdf67]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	AUTHENTICATE and AUTH commands were broken.
	[d2fe9172e408]

	* src/lib/istream.c:
	i_stream_read_data(): don't loop if read() returns 0.
	[963d95591b49]

	* src/imap/imap-fetch-body.c, src/lib-mail/istream-header-filter.c,
	src/lib-mail/istream-header-filter.h, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c:
	Changed istream-header-filter API a bit. Added HIDE_BODY option.
	Fixed mail.get_headers().
	[f6fef42f01b9]

	* src/lib-index/mail-transaction-log.c:
	Crashfix
	[ace62daa7abd]

	* src/lib-index/mail-transaction-log.c:
	Optimization for setting initial sync_offset from index.
	[1543762353aa]

	* dovecot-example.conf, src/imap/common.h, src/imap/imap-fetch-body.c,
	src/imap/imap-fetch.h, src/imap/main.c:
	Added netscape-eoh workaround.
	[f1e4c99cbb2b]

	* dovecot-example.conf:
	comment fix
	[be2e8dfe25be]

	* src/imap/cmd-append.c, src/lib-storage/Makefile.am, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-transaction.c, src/lib-storage/mail-copy.c,
	src/lib-storage/mail-copy.h, src/lib-storage/mail-save.c, src/lib-
	storage/mail-save.h, src/lib-storage/mail-storage-private.h, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/proxy-mailbox.c:
	Changed mail saving API to be nonblocking.
	[47e1e05cede0]

	* src/imap/client.c, src/imap/cmd-idle.c:
	Set bad_counter before calling client_command_reset because it may
	parse more commands.
	[5376a3c388c0]

	* src/lib-mail/istream-header-filter.c, src/lib-mail/message-parser.c,
	src/lib/istream-limit.c:
	Fixes for nonblocking streams.
	[881e265febfa]

	* src/lib-mail/istream-header-filter.c:
	Call callback for EOH too.
	[aa6b874f7515]

	* src/lib-mail/message-parser.c:
	If headers don't end with linefeed and there's no ':' in the line,
	don't hide the data.
	[95ce60310a56]

	* src/lib/istream-limit.c:
	When we reach the limit, set eof = true
	[b65224a24696]

	* src/lib-index/mail-transaction-log.c:
	Use madvise() for mmaped transaction log file.
	[0ac79623b58e]

	* src/lib/istream-mmap.c, src/lib/mmap-util.c, src/lib/mmap-util.h:
	Added mmap_get_page_size() call which basically returns
	getpagesize() but makes sure it's called only once so there's no
	syscall overhead every time.
	[7d6ca38c8c37]

	* src/lib-storage/index/maildir/maildir-util.c:
	If we can't create maildir temp file because we're out of quota,
	give user readable error message.
	[7daa6c257a56]

	* src/lib-mail/istream-header-filter.c:
	Do the final callback after deinitializing header parser so offsets
	are correct.
	[c58f454afc6b]

	* src/imap/imap-fetch-body.c, src/imap/main.c, src/lib-mail/istream-
	header-filter.c, src/lib-mail/istream-header-filter.h, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/mbox/mbox-
	mail.c:
	header filter can now optionally use either LF or CRLF linefeeds.
	[f8c4ad92092c]

	* src/lib-mail/istream-header-filter.c:
	We didn't call callback with NULL header at the end.
	[288eb0d0ca7d]

	* src/lib/ostream-crlf.c:
	Keep track of offset.
	[5e8e41cb8185]

	* src/lib/Makefile.am, src/lib/ostream-crlf.c, src/lib/ostream-crlf.h:
	Added CRLF/LF output stream converters.
	[be3338893a56]

	* src/lib/ostream-file.c:
	Limit iovec count to UIO_MAXIOV for writev() calls.
	[b8d2a5575fe9]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/istream-raw-mbox.h,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib/istream-data.c,
	src/lib/istream-file.c, src/lib/istream-limit.c, src/lib/istream-
	mmap.c, src/lib/istream.c, src/lib/istream.h:
	Removed istream.disconnected, it's too much of a special case and
	the only place where it's needed will be removed soon. Added
	istream.eof back, it's more useful.
	[8e9d8cb1e674]

	* src/lib-mail/istream-header-filter.c, src/lib-mail/message-body-
	search.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/mail-save.c:
	message_parse_header_next() can now return "need more data" with
	nonblocking input streams.
	[7c1dc4a7db3a]

	* src/imap/imap-fetch-body.c, src/lib-mail/istream-header-filter.c,
	src/lib-mail/istream-header-filter.h, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/mbox/mbox-mail.c:
	istream-header-filter now parses the headers incrementally while
	read()ing, instead of doing it at initialization and storing into
	one large buffer.
	[92f92b3c447b]

2004-08-19  Timo Sirainen  <tss@iki.fi>

	* AUTHORS, src/auth/Makefile.am, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/password-scheme-
	rpa.c, src/auth/password-scheme.c, src/auth/password-scheme.h:
	Added Compuserve RPA authentication. Patch by Andrey Panin.
	[abef2ac8843a]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-check.c, src/imap/cmd-copy.c, src/imap/cmd-expunge.c,
	src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-noop.c,
	src/imap/cmd-search.c, src/imap/cmd-select.c, src/imap/cmd-sort.c,
	src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-thread.c,
	src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.h, src/imap/imap-sync.c, src/imap/imap-sync.h:
	Syncing works now too without buffering everything. Also fixed
	handling input while command was being processed.
	[e1616067df5c]

	* src/auth/auth-client-connection.c, src/auth/mech.c:
	fixes
	[d47a550fc23b]

2004-08-18  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-list.c, src/imap
	/commands-util.c:
	LIST command interrupts itself when output buffer gets full and
	continues again when there's space.
	[8267d11cacfb]

	* src/imap/cmd-store.c:
	Don't do separate kludging for readonly mailboxes.
	[ab170ee24eb2]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_reset()
	[875e7a46a2db]

2004-08-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/password-scheme.c, src/lib-storage/mail-storage.h:
	oops, shouldn't have committed these
	[d5aa32e5a9bc]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/password-scheme.c, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/imap/Makefile.am,
	src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-search.c,
	src/imap/common.h, src/imap/imap-fetch-body-section.c, src/imap
	/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h,
	src/imap/imap-messageset.c, src/imap/imap-messageset.h, src/imap
	/imap-search.c, src/imap/imap-search.h, src/imap/imap-thread.c,
	src/imap/mail-storage-callbacks.c, src/imap/main.c, src/lib-auth
	/auth-server-connection.c, src/lib-auth/auth-server-request.c, src
	/lib-mail/istream-header-filter.c, src/lib-mail/istream-header-
	filter.h, src/lib-mail/message-send.c, src/lib-mail/message-send.h,
	src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/mbox-lock.c, src
	/lib-storage/index/mbox/mbox-save.c, src/lib-storage/mail-storage.h,
	src/lib/Makefile.am, src/lib/alarm-hup.c, src/lib/alarm-hup.h,
	src/lib/file-lock.c, src/lib/iostream-internal.h,
	src/lib/iostream.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/lib.c, src/lib/ostream-file.c, src/lib
	/ostream-internal.h, src/lib/ostream.c, src/lib/ostream.h,
	src/lib/strfuncs.c, src/lib/strfuncs.h, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3/client.c,
	src/pop3/client.h, src/pop3/commands.c:
	We never do blocking reads/writes to network anymore. Changed imap
	and pop3 processes to use a single I/O loop.

	Not much tested yet, and currently LIST/LSUB may eat too much memory
	and APPEND eats all CPU.
	[d141e1bfdd63]

	* src/lib-index/mail-cache-transaction.c:
	rollback: don't lock file if we don't need to
	[90f25ed2dcef]

	* src/lib-index/mail-cache-lookup.c:
	bugfix
	[ba29613cbb19]

	* src/lib-index/mail-transaction-log-view.c:
	assert crashfix
	[f32a2fd0c8b4]

2004-08-09  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_debug setting.
	[af0e73fc6658]

	* configure.in:
	If -lmysqlclient doesn't automatically link with zlib, do it
	manually.
	[e6594431ee4f]

2004-08-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-search.c:
	SEARCH TEXT was broken
	[0b296005452e]

2004-08-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/buffer.h:
	buffer.data should be void, not unsigned char
	[05b348b25d46]

2004-07-31  Timo Sirainen  <tss@iki.fi>

	* src/lib/buffer.c:
	buffer_append() fix
	[55330cd9c610]

	* src/lib/buffer.c, src/lib/buffer.h:
	Removed start_pos and limit handling, they weren't used much and
	were only making it more complex. Also made data and size variables
	directly accessible to make it easier to use buffers.
	[daf5ea7556bc]

	* src/lib-imap/imap-base-subject.c, src/lib-imap/imap-base-subject.h:
	Drop using buffer_set_start_pos(). Also some coding style cleanups.
	[c8fa857c4e08]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h, src/lib-index/mail-transaction-
	util.c:
	Small cleanups.
	[c7c886199f28]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index.c:
	Fixed fd leaks
	[9183098d7fdf]

	* src/lib-index/mail-transaction-log.c:
	removed assert
	[ad3983cc66cb]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	index-private.h, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log-private.h, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h:
	Transaction log file is now read-lockless.
	[fed6d07bd8ee]

	* src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-update.c:
	Don't write Content-Length unless it's value is larger than 1024
	bytes.
	[e08fd0ea6907]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Fix rewriting pseudo header when it needs to grow.
	[4f827b29c9b8]

	* src/imap/imap-fetch-body-section.c, src/lib-mail/istream-header-
	filter.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/mail-save.c:
	Added struct message_header_line.middle and middle_len to contain
	the ':' in header and whitespace around it.
	[8ef002a26f1c]

	* configure.in:
	Mysql check fix
	[3af28e102a39]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[f81e77487092]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Rollback index sync if mbox syncing failed
	[c617b748be41]

	* src/lib-index/mail-index-sync-update.c:
	Changed some asserts to failure return calls since they actually can
	happen
	[8ab6097598a6]

2004-07-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Growing index record size in the middle of transaction wasn't
	working right.
	[b1b05f3b6805]

	* src/lib-storage/index/mbox/mbox-sync.c:
	read-only mbox fix
	[7134d8ea59a4]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't try to write-lock read-only mboxes
	[5ef38528f873]

	* src/auth/mech-cram-md5.c:
	cleanup
	[4f84a146d93a]

	* src/lib-ntlm/ntlm-message.c:
	compile fix
	[6cb29c751e01]

	* src/auth/db-pgsql.c:
	Reconnection fix, thanks to Zsolt Varga.
	[4b7a5545afaf]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Renamed mail_index_sync_end() to _commit() and added _rollback().
	Fixed mbox deadlocking issue.
	[d598c82a3c22]

	* src/lib-index/mail-transaction-log-view.c:
	mail_transaction_log_view_next() didn't actually stop at the end of
	view window, but continued to the end of file. That sometimes caused
	crashes and maybe other problems.
	[dad26f6995ff]

	* src/util/Makefile.am:
	RAND_LIBS and MODULE_LIBS are needed for dovecotpw.
	[6b0901140c16]

	* src/util/dovecotpw.c:
	getopt.h isn't needed for getopt() and doesn't exist in all systems.
	[e2a1407b32f7]

	* src/lib/fdpass.c:
	include lib.h first
	[98cbbce48f9f]

	* src/lib-ntlm/ntlm.h:
	Don't include stdint.h, it's already included in lib.h if it exists.
	[529053546752]

	* src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm/ntlm-message.c:
	Moved system header includes after local headers to fix some compile
	problems.
	[d41d66244eb2]

	* src/lib/sha1.h:
	one more u_int..
	[2f58b0ae7d20]

	* src/lib/sha1.c, src/lib/sha1.h:
	Changed to use standard uint* types rather than u_int*. Also removed
	K&R-isms.
	[161a9e818ad6]

	* configure.in, src/auth/db-mysql.h:
	Better MySQL checking. Patch by John Dennis
	[0cc72087752f]

	* src/auth/mech-cram-md5.c, src/auth/password-scheme-cram-md5.c, src
	/lib-ntlm/Makefile.am, src/lib-ntlm/hmac-md5.c, src/lib-ntlm/hmac-
	md5.h, src/lib/Makefile.am, src/lib/hmac-md5.c, src/lib/hmac-md5.h:
	Merged CRAM-MD5 and NTLM hmac-md5 code. Patch by Joshua Goodall
	[959136e08a70]

	* src/pop3-login/client-authenticate.c:
	Added NTLM kludge. Patch by Andrey Panin
	[34d4c7a7b485]

	* src/auth/mech-ntlm.c, src/auth/passdb.c, src/auth/passdb.h, src/auth
	/password-scheme-ntlm.c, src/auth/password-scheme.c, src/auth
	/password-scheme.h, src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm/ntlm-
	encrypt.h, src/lib-ntlm/ntlm-types.h:
	Added LANMAN password scheme. Patch by Andrey Panin
	[6531fd0f779f]

	* src/auth/Makefile.am, src/util/Makefile.am:
	Added auth/libpassword.a which util/dovecotpw can use rather than
	using object files directly.
	[4e42d4213927]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	mbox corruption fix
	[9a6d22b5bb7a]

2004-07-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c:
	mail_cache_lock() crashed if index wasn't locked while it was
	called.
	[00a4d69a1d1c]

	* AUTHORS, configure.in, src/Makefile.am, src/auth/Makefile.am,
	src/auth/mech-ntlm.c, src/auth/mech.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/password-scheme-ntlm.c, src/auth
	/password-scheme.c, src/auth/password-scheme.h, src/lib-
	ntlm/.cvsignore, src/lib-ntlm/Makefile.am, src/lib-ntlm/hmac-md5.c,
	src/lib-ntlm/hmac-md5.h, src/lib-ntlm/ntlm-byteorder.h, src/lib-ntlm
	/ntlm-des.c, src/lib-ntlm/ntlm-des.h, src/lib-ntlm/ntlm-encrypt.c,
	src/lib-ntlm/ntlm-encrypt.h, src/lib-ntlm/ntlm-flags.h, src/lib-ntlm
	/ntlm-message.c, src/lib-ntlm/ntlm-message.h, src/lib-ntlm/ntlm-
	types.h, src/lib-ntlm/ntlm.h, src/lib/Makefile.am, src/lib/md4.c,
	src/lib/md4.h:
	NTLM authentication. Patch by Andrey Panin
	[8f5be0be3199]

	* src/lib/hex-binary.c, src/lib/hex-binary.h:
	Added binary_to_hex_ucase()
	[05b8b6963b02]

2004-07-27  Timo Sirainen  <tss@iki.fi>

	* AUTHORS:
	updated
	[faeb3d17579a]

	* src/imap/cmd-list.c:
	LSUB sent LIST replies instead of LSUB.
	[42e6f7811385]

2004-07-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index.h, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/mbox/mbox-sync-update.c, src
	/lib-storage/index/mbox/mbox-sync.c:
	Fixed recent flags with mbox.
	[9c830d1a4ebf]

	* src/util/Makefile.am:
	dovecotpw_INCLUDES didn't actually work. Don't even try, src/auth/
	must be compiled before we get here.
	[0169e0cad079]

	* src/auth/db-mysql.c:
	whops, removed debugging
	[d216ff496d01]

	* src/lib/sha1.c, src/lib/sha1.h, src/util/.cvsignore,
	src/util/dovecotpw.c:
	Forgot from last dovecotpw commit.
	[eda658b1557e]

	* configure.in, doc/dovecot-mysql.conf, src/auth/db-mysql.c, src/auth
	/db-mysql.h:
	Added MySQL SSL support.
	[189a6de6b166]

	* doc/variables.txt, src/lib/var-expand.c:
	Added support for %offset.width format in variables.
	[1ce02ffc7ec7]

	* configure.in, src/auth/passdb.c, src/auth/password-scheme.c,
	src/auth/password-scheme.h, src/lib/Makefile.am,
	src/util/Makefile.am:
	Added dovecotpw utility. Patch by Joshua Goodall
	[203938a7f45e]

	* src/auth/passdb-vpopmail.c:
	Support MD5 passwords. Patch by Pascal Malterre
	[33c584ef528a]

	* src/imap/cmd-list.c:
	fix
	[979af608d7c4]

	* src/imap/cmd-list.c:
	fix
	[974b0478a548]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox parsing fix
	[8b0d9d6444be]

2004-07-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache.c:
	Allocate cache->fields and cache->fields_file_map with malloc rather
	than from pool.
	[f2acbe281ac1]

2004-07-24  Timo Sirainen  <tss@iki.fi>

	* COPYING:
	mail-thread.c -> imap-thread.c
	[f3365e8ba7d0]

2004-07-23  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	If MySQL header checks failed, configure still passed.
	[845779ac5507]

	* src/auth/db-mysql.c, src/auth/db-mysql.h:
	db_port and db_client_flags weren't integers. Reconnects now
	immediately if mysql_query() failed because connection was lost.
	[0d76dd47fbf4]

	* src/lib-storage/index/index-storage.c:
	Better error message for unknown fields in mail*_cache_fields
	[3df5796793bd]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Fixed a crash with fetch (rfc822.size body). Also fixed it so it
	doesn't anymore parse the message body twice.
	[52eef63bebfd]

	* src/auth/password-scheme.c:
	crypt_generate and md5_generate used only 3 different characters for
	salt. Patch by Joshua Goodall.
	[d921b930abd7]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	get_index() wasn't working with caching disabled
	[e6b216ab4b4f]

	* src/lib-index/mail-cache-transaction.c:
	Assert crashfix in certain situations when adding new cache records.
	[1556d9ba23dc]

	* src/auth/db-mysql.c:
	MySQL reconnection memleak fix.
	[849f12c9c7d0]

	* src/lib-storage/index/index-storage.c:
	Force mmap_no_write = yes if configure detected that.
	[a75f04938f49]

	* doc/mkcert.sh:
	Make certificate valid for one year
	[080ac35855d5]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-delete.c, src/imap/cmd-list.c, src/imap/cmd-
	namespace.c, src/imap/cmd-rename.c, src/imap/cmd-select.c, src/imap
	/cmd-status.c, src/imap/cmd-subscribe.c, src/imap/commands-util.c,
	src/imap/commands-util.h, src/imap/namespace.c,
	src/imap/namespace.h, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/proxy-mail-storage.c, src/pop3/main.c:
	Moved namespace and hierarchy separator handling to imap-specific
	code. LIST now shows non-hidden namespaces in the LIST reply.
	[1371d41c375f]

2004-07-22  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/fdpass.c:
	Check BUGGY_CMSG_MACROS in configure.
	[b65456de1b49]

	* src/lib/fdpass.c:
	Added BUGGY_CMSG_HEADERS #define to workaround some OS bugs. Updated
	comments and macros to be more accurate.
	[65433665256d]

	* src/lib-storage/index/index-mail-headers.c:
	compiler warning fix
	[c5cc8ccdd0a7]

	* AUTHORS, src/auth/Makefile.am, src/auth/mech-login.c,
	src/auth/mech.c:
	Added LOGIN SASL mechanism. Patch by Andrey Panin
	[13ed27a24f46]

	* src/pop3-login/client-authenticate.c:
	POP3 CAPA command shouldn't return "AUTH=" in SASL reply. Patch by
	Andrey Panin
	[4c9e46b5dcfd]

2004-07-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Added error checking
	[d16f7c305e57]

	* src/lib-index/mail-cache.c:
	Use larger field_pool size by default.
	[52ff483dc7f7]

	* src/lib-index/mail-cache-decisions.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h:
	Fixes for big endian systems.
	[fa529dd77176]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache-
	transaction.c:
	Limit how much a single transaction can reserve space
	[b3c0ed666757]

	* src/lib-index/mail-cache-lookup.c:
	mail_cache_lookup_headers() fix
	[29cc953f1822]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-fields.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-private.h, src/lib-index
	/mail-cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index
	/mail-cache.h, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/index/index-mail.c:
	Cache fixes. Decisions are saved again.
	[406692edc12d]

	* src/lib/module-dir.c:
	Compile fix when modules were disabled. Patch by Andrey Panin.
	[3347a7e133cc]

	* src/lib/md5.c:
	md5_final() didn't properly clear the whole MD5 context. Also
	changed to use safe_memset(). Patch by Andrey Panin
	[beefcc4249ef]

2004-07-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	header caching fixes
	[d4577ee85f0f]

	* src/login-common/ssl-proxy-openssl.c:
	SSL proxy was destroyed after login instead of staying in
	background.
	[891990251008]

	* src/auth/db-pgsql.c:
	Fixed reconnecting to PostgreSQL.
	[eb9bd211e3ac]

	* src/auth/db-mysql.c:
	Fixes reconnecting to MySQL and some cleanups. Patch by Tomi Hakala.
	[c795490b23d2]

	* src/imap/imap-sync.c:
	Don't send EXISTS after each EXPUNGE.
	[7e02790ded71]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-log-view.c:
	Don't crash if mail_index_view_sync_next() is called again after
	it's finished.
	[e5748645a9d6]

	* src/master/master-settings.c:
	Changed default cache fields
	[f6c6ad1a55f9]

	* src/master/login-process.c:
	Changed default cache fields.
	[f34aca0d7c85]

	* src/lib-storage/index/index-mail-headers.c:
	Avoid parsing headers twice to get IMAP envelope.
	[6527f1da0ee3]

	* src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/imap/imap-sort.c, src/imap/imap-thread.c, src
	/lib-imap/imap-bodystructure.c, src/lib-index/Makefile.am, src/lib-
	index/mail-cache-compress.c, src/lib-index/mail-cache-decisions.c,
	src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-mail/istream-header-filter.c, src/lib-mail/istream-
	header-filter.h, src/lib-storage/index/index-mail-headers.c, src
	/lib-storage/index/index-mail.c, src/lib-storage/index/index-mail.h,
	src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/proxy-mail.c, src/lib-
	storage/proxy-mailbox.c:
	Header caching redesigned. New design allows caching decisions per
	field, so they can be divided to temporary/permanent. Cached headers
	are now always returned in original order, old code didn't guarantee
	it. Some other caching changes. (still missing code to store changes
	in caching decisions)
	[7d02e2a7672d]

	* src/lib/strfuncs.c:
	bsearch_strcasecmp() actually called strcmp..
	[0a8c9bfc05a1]

2004-07-16  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/auth/db-ldap.c:
	Fixed to compile with Solaris LDAP library
	[7613e0f68513]

2004-07-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	Delay memory allocations for cache transaction. We don't always need
	it.
	[ea745d0c9c4b]

2004-07-12  Timo Sirainen  <tss@iki.fi>

	* src/pop3/commands.c:
	outlook-no-nuls workaround fix
	[ec1dac19cb06]

	* src/imap/Makefile.am, src/imap/client.h, src/imap/cmd-idle.c,
	src/imap/cmd-select.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/commands-util.c, src/imap/imap-fetch.c, src/imap/imap-
	sync.c, src/imap/imap-sync.h, src/imap/mail-storage-callbacks.c, src
	/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src/lib-
	storage/index/index-mailbox-check.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/proxy-mailbox.c, src/pop3/client.c,
	src/pop3/mail-storage-callbacks.c:
	Broke mailbox_sync() into iterator.
	[aae574ed7f4c]

	* src/lib-index/mail-index-view-sync.c:
	View syncing fixes/cleanups.
	[d803ba0206f0]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Handle recent flags in index file correctly. Fixes recent flag
	losing when copying or saving mails with flags.
	[8a6666a9ac98]

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox recent fixes.
	[7c7e372da1f3]

	* src/lib-index/mail-transaction-log.c, src/lib-storage/index/index-
	storage.c:
	Use CMP_DEV_T() macro to compare struct stat.st_dev
	[4e925eb04b10]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	mail.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-uidlist.h, src/lib-storage/index/mbox
	/mbox-storage.c:
	Recent flags should be fully working now with maildir.
	[0cf316c77b1b]

2004-07-10  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/imap/common.h, src/imap/main.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h, src/master
	/mail-process.c, src/master/master-settings.c, src/master/master-
	settings.h, src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Split client_workarounds to imap_ and pop3_ ones. Added outlook-no-
	nuls POP3 workaround.
	[1c1ed4494aa4]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-transaction.c:
	Cache fixes. Lookups now look into transactions too.
	[22210d6cf238]

	* src/lib-storage/index/index-transaction.c:
	fetch_mail needs to be deinitialized before transaction is committed
	or rollbacked
	[e2714bd499b7]

	* src/imap/imap-sort.c, src/imap/imap-thread.c:
	thread/sort: commit the transaction, don't rollback..
	[affe191f21ed]

2004-07-09  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	And section fix for --exec-mail..
	[cc753e275197]

	* src/login-common/master.c, src/master/mail-process.c, src/master
	/mail-process.h, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Added --exec-mail option to master. It can be used to parse Dovecot
	config file and exec() imap/pop3 process directly. Moved --inetd
	option into environment as it's only for internal use.
	[4558d1b196fd]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Create all the missing paths up to maildir
	[1d03eceb6ae6]

	* src/lib/mkdir-parents.c:
	check EISDIR in next mkdir() too..
	[53428bbf212e]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Some more mailbox name checks.
	[5f34cfdc29e6]

	* src/lib-index/mail-cache.c:
	Crashfix with empty mailbox
	[75d7f8049add]

	* src/master/main.c:
	SIGHUP correctly reloads configuration now
	[6aa77fdf152e]

	* src/lib/failures.c:
	When i_set_failure_file() is called, make sure the handlers are
	reset back to defaults.
	[2594a592d135]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Never treat "mailbox/" as a valid mailbox name.
	[24387fbf3535]

	* src/lib-storage/index/maildir/maildir-save.c:
	If we're setting flags to saved mail, put it to cur/ directory
	directly. Flags aren't allowed in new dir.
	[a32d5d57a24e]

	* src/login-common/ssl-proxy-openssl.c:
	Refcounting fixes. Unexpectedly destroyed SSL connection could have
	left looping for a long time.
	[8438064ddf08]

	* src/auth/mech-plain.c:
	We could read authid past the buffer if \0password wasn't given in
	input.
	[00b4385cfc48]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h, src/lib-
	storage/index/index-transaction.c:
	Always create cache transaction. Easier that way .. and fixes a
	crash.
	[e4460aca7970]

	* src/lib-index/mail-cache-compress.c:
	Fixed compression.
	[ef0cd18d674c]

2004-07-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h, src/lib-index/mail-cache-compress.c, src/lib-index
	/mail-cache-decisions.c, src/lib-index/mail-cache-lookup.c, src/lib-
	index/mail-cache-private.h, src/lib-index/mail-cache-transaction.c,
	src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-save.c:
	Cache file fixes, API changes, etc. It's still in somewhat ugly
	state, but getting better..
	[5beb0c20b6e8]

	* src/lib/mempool-alloconly.c:
	If p_free() frees memory, it must also zero it..
	[59062bb4eaac]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index.c:
	crashfix
	[e504e7d19bf7]

2004-07-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c, src/lib/istream-limit.c:
	Wrapper streams shouldn't try to read data if it's already buffered
	in main stream. Fixes at least problem with APPEND when the whole
	message came in one TCP packet.
	[545c1d3ead54]

	* src/auth/db-mysql.c:
	compile fix
	[dde57895a5be]

2004-07-06  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-mysql.conf:
	varchar(255) is max in mysql
	[f4a8d21dbaf1]

	* src/auth/db-mysql.c:
	don't set default port either
	[867b43870bbf]

	* src/master/mail-process.c:
	Updated error message texts.
	[5feeb01998d1]

	* src/auth/db-mysql.c:
	s/user/db_user/
	[f0379a850f2a]

	* src/auth/mech-apop.c, src/pop3-login/client.c:
	Fixes, patch by Andrey Panin
	[83df1d1bbb05]

	* dovecot-example.conf, src/auth/db-mysql.c:
	Added mysql description to example config file. Changed mysql
	default settings.
	[5633733e6ec1]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	Add "Error report written to server log." also to internal login
	error messages.
	[df0b936ae3ed]

2004-07-05  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	pool_alloconly_free() can free the last allocation.
	[ee918986f94e]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-transaction-log.c:
	fixing crashes from last changes
	[afb81e31b989]

	* src/lib-index/mail-cache.c:
	disable cache file with mmap_no_write. it and mmap_disable will need
	some non-mmap buffer for reading.
	[1a31b3d17b1e]

	* src/lib-index/mail-transaction-log.c:
	more checks against using old cache_offsets
	[199eb3df762c]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-index-private.h, src/lib-index
	/mail-index-transaction-private.h, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-transaction-log.c:
	Make sure we don't set cache_offsets to old cache files.
	[c54f0c01da09]

	* src/lib-storage/index/index-mail-headers.c:
	cache fix
	[e2a9be7c2270]

	* src/lib-index/mail-index-sync-update.c:
	header and extra_rec syncing crashed because of recent changes.
	[d1318d47cd47]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache.h, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h:
	Cache API updates. Don't return direct pointers to mmaped cache file
	anymore.
	[ed0bb4c12f03]

2004-07-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	renaming mailbox under existing mailbox gave wrong error message
	[675ef825829e]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index-sync-update.c, src/lib-index/mail-index-transaction-private.h,
	src/lib-index/mail-index-transaction.c, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-
	transaction.c:
	Cache updating is done now by first reserving space where to write,
	and then writing to it whenever buffer gets full. There is no
	persistent cache file locks anymore because of this, but it also
	means that the same cached field may be written multiple times to
	the file by different processes. Also since we reserve more space
	than we actually need at first, it some space can be wasted if
	multiple processes are updating the cache.
	[41e56f28d085]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-transaction.c:
	Caching fixes and optimizations. Removed all network byte ordering
	code - it's not worth the trouble and would require massive changes
	in indexing code as well to be useful. Changed next_offset to
	prev_offset which is updated while syncing index.
	[5f374049abdb]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	cache-private.h, src/lib-index/mail-cache-transaction.c, src/lib-
	index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-index/mail-
	index-sync.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-storage.h:
	Cache file compression works now and compressed cache file is
	reopened. Several other cleanups related to opening - cache file
	isn't created immediately anymore.
	[c68a3c9f6d73]

2004-07-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/index-storage.c:
	Removed mail_index_is_in_memory(). It wasn't implemented and it's
	useless anyway. User doesn't need to see "couldn't use index files"
	error message.
	[97da1d911484]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.h, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src
	/lib-storage/index/mbox/mbox-sync.c:
	Updated comment about how syncing is done, and s/extra
	space/padding/
	[c48822c8713f]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h, src
	/lib-index/mail-transaction-util.c, src/lib-storage/index/maildir
	/maildir-sync.c:
	mail_index_sync_sort_flags() now merges flag changes so mail storage
	backends don't need to do it (and maildir didn't before). Dirty
	flags will be synced now too.
	[ced88553af0b]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction-view.c, src/lib-index/mail-index-transaction.c,
	src/lib-index/mail-index.h, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	UIDs for appended messages can now be assigned all at once. Maildir
	now updates indexes immediately while saving messages.
	[15d959d262a4]

	* src/auth/mech-apop.c:
	was missing from last commit
	[52a52b3a0357]

	* src/lib-storage/index/mbox/mbox-storage.h:
	Dropped MBOX_HEADER_EXTRA_SPACE from 100 to 50. It should be enough.
	[945403a685f9]

	* src/pop3-login/client.c, src/pop3-login/client.h:
	If we're not connected to all auth sockets, wait before sending
	greeting so APOP challenge gets sent.
	[5bd7fa814d7f]

	* AUTHORS, dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-
	client-connection.c, src/auth/auth-client-connection.h, src/auth
	/auth-client-interface.h, src/auth/auth-master-connection.c,
	src/auth/mech.c, src/imap-login/client-authenticate.c, src/lib-auth
	/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-connection.h, src/lib-
	auth/auth-server-request.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client-authenticate.h, src/pop3-login/client.c,
	src/pop3-login/client.h:
	Added APOP authentication for POP3. Patch by Andrey Panin.

	This required some changes in auth APIs.
	[d2e186f716d8]

2004-07-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Don't keep filling empty spaces which will be overwritten soon
	anyway. Major speedup for rewriting large mboxes.
	[d6001ee7815d]

	* src/lib/istream.c:
	i_stream_read_data() could have returned invalid data at EOF
	(notable with mboxes since end of mail = "EOF").
	[1def5ca25efd]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	body_offset wasn't set if mail had no header.
	[a0ffc18d3185]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	make sure there's only LWSP after X-UID
	[010088ee72de]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix for mboxes with pseudo header mail
	[e4c375ab3b30]

	* src/lib-storage/index/mbox/mbox-save.c:
	saving messages to empty mbox was buggy
	[ba4f6d7b5a58]

	* src/lib-index/mail-index-sync-update.c:
	assert crashfix
	[0e7534c53679]

2004-06-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-decisions.c:
	Cache decision explanation comment.
	[07c8813877cc]

	* src/lib-storage/index/maildir/maildir-sync.c:
	No maildir filename checking after all.
	[087a43e29492]

2004-06-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c:
	Temporary: never compress cache file as it's broken now.
	[487b9179f5dd]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Require that filenames in maildir begin with a digit, otherwise
	complain.
	[93856e13e020]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	no_partial_rewrite was incorrectly set always
	[dfb728afc8a3]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	fix, _read() sometimes returned -2 too early
	[4b24a962ef89]

	* src/lib/fdpass.c:
	added comment about solaris and changed the macros once again,
	although may be useless change..
	[509923906599]

	* src/login-common/ssl-proxy.c:
	compile fix when SSL is disabled
	[54c3bc549e34]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h:
	fix
	[648e1a50b959]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	some fixes for handling pseudo headers.
	[7b70a60c0f9d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c:
	Several fixes for updating mbox. Recent changes also made it corrupt
	headers.
	[cb4dad60f6cd]

	* src/lib-mail/message-parser.c:
	full_value should contain LFs as well
	[8eaf078488d2]

2004-06-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/Makefile.am, src/lib-index/mail-cache-compress.c, src
	/lib-index/mail-cache-decisions.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	index-sync.c, src/lib-index/mail-index.h, src/lib-storage/index
	/index-mail.c:
	Added some smartness for deciding what to cache. Cache compression
	code compiles, but untested.
	[2d51bb58a070]

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	don't close dotlock fd if it's given as -1
	[f16e174e1c24]

	* src/lib/ostream-file.c, src/lib/ostream.h:
	Allow giving 0 max_buffer_size, in which case "optimal" size is
	used.
	[95fe82bbda7a]

	* src/lib-index/mail-transaction-log.c:
	fixed some fd leaks in error conditions
	[e7ccd299e754]

2004-06-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Check immediately if we have write-access to mbox.
	[6850ff275fa5]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h,
	src/lib-storage/index/mbox/mbox-sync.c:
	Save MD5 sums of some headers for readonly mboxes and use them for
	syncing
	[5e2518377c0a]

	* src/lib-index/mail-index.c:
	removed assert
	[c9a27c0875e2]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-private.h,
	src/lib-index/mail-index-transaction-view.c, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-index
	/mail-transaction-log.h, src/lib-index/mail-transaction-util.c, src
	/lib-index/mail-transaction-util.h:
	Record size is allowed to change between index files. This will
	allow adding extensions dynamically for existing indexes.
	[51719889ffcf]

2004-06-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	assertfix
	[1057a5dc0ca7]

	* src/lib-index/mail-cache.h, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-mail.h, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-storage.h,
	src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Added a framework for getting POP3 UIDL strings from mail-storage.
	The default still is uidvalidity.uid. Added beginnings of overriding
	it from X-UIDL header in mbox.
	[9cc23c29aaec]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	crashfix if client closes connection while authenticating
	[6b05e30c669a]

	* dovecot-example.conf, src/auth/auth-master-connection.c, src/auth
	/auth-master-connection.h, src/auth/auth-master-interface.h,
	src/auth/common.h, src/auth/main.c, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Dovecot can now connect to externally running dovecot-auth.
	[43b82a35888d]

	* src/imap/main.c, src/login-common/main.c, src/master/main.c,
	src/pop3/main.c:
	DEBUG: If GDB environment is set, don't do fd leak checks.
	[dcff4c088f1a]

	* src/auth/passdb.c, src/auth/userdb.c:
	Default to "" args instead of NULL to avoid some crashes
	[60802bea8f32]

	* src/lib-settings/settings.c:
	Allow empty section name.
	[089d2cc59538]

	* src/auth/passdb.c, src/auth/userdb.c:
	skip extra whitespace between "dbtype arguments"
	[e5684c8c60f9]

	* dovecot-example.conf:
	Add a comment about # chars and whitespace.
	[58fc6765027c]

	* src/master/auth-process.c:
	don't change our umask permanently
	[12852d295196]

	* src/lib-index/mail-cache-lookup.c:
	Crashfixes for disabled cache.
	[201442d45cac]

	* src/lib-storage/index/maildir/maildir-sync.c:
	partial syncing fixes
	[d19ba01fb5cd]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Complain about reappearing UIDs, but reassign new UIDs to them
	anyway. Don't try to update \recent mails if we aren't really going
	to make them non-recent.
	[a0ad3f6fb90f]

2004-06-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.h:
	We didn't specify full path for .subscriptions file, and it was
	named without the leading dot..
	[f14c54dc41a2]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c:
	get_last_error() wasn't virtualizable
	[5947497c3e40]

	* src/lib-index/Makefile.am, src/lib-index/mail-cache-lookup.c, src
	/lib-index/mail-cache-transaction.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction-view.c,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index-
	view-private.h, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.h, src/lib-storage/index/index-fetch.c, src/lib-storage/index
	/index-mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-transaction.c,
	src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-transaction.c:
	Added mail_index_transaction_get_updated_view() which can be used to
	access uncommitted messages.
	[a816e2d88406]

2004-06-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/proxy-mailbox.c, src/lib-storage/proxy-mailbox.h:
	updates
	[cf5967239463]

	* configure.in, src/imap/cmd-append.c, src/imap/cmd-copy.c:
	Removed UIDPLUS after all, it needs more thinking about with
	maildir.
	[c01f238a37a0]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index.h, src/lib-
	storage/index/mbox/mbox-save.c:
	Cache doesn't crash anymore if we're asking it about messages that
	exist only in uncommitted transactions.
	[e0cb58614ebc]

	* src/lib-index/mail-cache-transaction.c, src/lib-index/mail-cache.c:
	Disable cache with mmap_disabled=yes, for now.
	[357bc14b6d05]

	* src/imap/imap-thread.h, src/lib-storage/mail-storage.h:
	Moved enum mail_thread_type to imap
	[06d77f22cf6c]

2004-06-20  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	comment update for setting ports in listen
	[8864dbc17cfa]

	* src/lib-storage/index/mbox/mbox-sync.c:
	assertfix
	[a242b5b9b287]

	* src/lib-storage/index/mbox/mbox-sync.c:
	and more fixes..
	[81d4e61702a3]

	* src/lib-storage/index/mbox/mbox-sync.c:
	expunge everything in index after missing/invalid X-UID
	[be180a9bf10d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	fixes for From-line offset updating
	[c0b5573d76e3]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Hide "folder internal data" messages
	[a3cd4bebb4aa]

	* src/lib-index/mail-index-lock.c:
	Exclusive index locking always used copy-locking without even trying
	fcntl-locking.
	[f71c36aae566]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	Don't die horribly when message with previously expunged UID is
	inserted into mbox.
	[14badbddd7b7]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log.c:
	assert crashfixes
	[62a2cc099f08]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-index.c:
	Index syncing fixes.
	[2a9c84ed988c]

	* src/lib/file-dotlock.c:
	Never overflow secs_left for stale timeout callback
	[74fcdbb6bcee]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fsync() mbox before unlocking if we've modified it
	[9b3e774a9a67]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-sync.c:
	Allow dropping exclusive mbox locks to shared locks.
	[2157c6aab530]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-lock.c:
	Don't require dotlocking to be first in locking list.
	[821fbe3e892b]

	* src/lib-index/mail-cache.c:
	don't do infinite looping
	[387bccdf00bf]

	* src/lib-index/mail-cache.c, src/lib-index/mail-transaction-log.c:
	cache file fixes
	[9d384176c177]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't crash if transaction log contains records for messages that
	don't exist anymore.
	[7d901b0ec312]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c, src/lib-index/mail-cache.h, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-private.h,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/lib-index/mail-transaction-util.c, src/lib-
	index/mail-transaction-util.h:
	Several fixes and cleanups to cache file code, still badly broken
	[7bdef5ea4591]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-old.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c, src/lib-index/mail-cache.h, src/lib-index/mail-
	index.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-transaction.c:
	Beginnings of getting cache file working again. Easy to break
	currently, but basics seem to work.
	[97bb7b127617]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c:
	APPEND/COPY in non-selected mailbox must not remove the Recent-flag
	[89001f106f8d]

	* src/lib-index/mail-index-view.c:
	mail_index_lookup() set rec=NULL incorrectly.
	[f5baee0fc85f]

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	Filter internal headers from user visible input stream. Make
	mailbox_save() use the same header list.
	[6033af323a61]

	* src/lib-mail/Makefile.am, src/lib-mail/istream-header-filter.c, src
	/lib-mail/istream-header-filter.h:
	Added istream-header-filter, which allows filtering specified
	headers from input stream.
	[0417cdfa6d88]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added bsearch_strcasecmp()
	[40b8be298506]

	* src/lib-storage/mail-save.c:
	Make sure headers end with LF
	[ebeae1eaa900]

	* src/lib-index/mail-index.c:
	assertfix
	[1019b7694a11]

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Expunge fixes
	[d7378b25046b]

	* src/lib-index/mail-index-view.c, src/lib-index/mail-index.h:
	mail_index_lookup() and mail_index_lookup_extra() now returns 0 if
	message has been expunged, 1 if not.
	[4d25f3fe5de1]

	* configure.in, src/imap/cmd-append.c, src/imap/cmd-close.c, src/imap
	/cmd-copy.c, src/imap/cmd-expunge.c, src/imap/cmd-select.c, src/imap
	/cmd-status.c, src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.c, src/imap/commands.h, src/imap/imap-expunge.c,
	src/imap/imap-expunge.h, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index.h, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	mail.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c, src
	/lib-storage/mail-save.c, src/lib-storage/mail-save.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h:
	mailbox_save() and mailbox_copy() functions can now return the saved
	mail so it can be immediately queried. Implemented UIDPLUS extension
	using it. Maildir implementation missing, so it crashes with it for
	now.. APPEND with mbox now doesn't require resyncing the mailbox
	since it updates indexes directly.
	[755ec9442a58]

	* src/lib-index/mail-index-sync.c:
	Set uid1/uid2 for MAIL_INDEX_SYNC_TYPE_APPEND
	[ff99c79b2fc9]

	* src/lib-index/mail-transaction-log.c:
	bugfix for extra-records change
	[d7a314446b47]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	read() less often
	[8f0e6c3b13c5]

	* src/lib/istream.c:
	seek optimization
	[6eb96c8aaac3]

	* src/lib/fdpass.c:
	Fix for the previous Solaris fix. fd_send() was sending two fds.
	[078da7741971]

	* src/master/mail-process.c:
	cleanup
	[9b4555d58737]

	* src/lib/fd-close-on-exec.c:
	if socket is leaked, show also the remote side of it
	[1b0153eb3fa5]

2004-06-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-mmap.c:
	minor optimization
	[4e559fad61fb]

	* configure.in:
	Use AC_TRY_LINK() for sendfile() checks so it works right with
	Solaris. Did the same for mremap() too just in case.
	[7d4e10c5bd93]

	* src/lib-storage/index/mbox/mbox-storage.c:
	create mbox root directory if it doesn't exist
	[2cc1951d6de3]

	* src/lib/ioloop.c:
	fix for fix
	[7b104f7e16c4]

	* src/lib/ioloop.c:
	io_remove() fix
	[39f55e074619]

	* configure.in:
	Removed AC_ARG_PROGRAM. Lets see if this breaks anything..
	[84ffac0d1c04]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	fix
	[a0173f504707]

	* src/lib-storage/index/index-storage.h:
	continuing maildir sync fix commit
	[3e8597575e9f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't crash after empty mailbox gets messages
	[814f55aea322]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Don't crash if we're syncing last commit to maildir, but some file
	was lost
	[9438951e243f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	index errors always need to store the error message to store
	[cee8c4354b20]

	* src/lib-storage/index/mbox/mbox-sync.c:
	don't crash if we wanted to lock mbox for reading but it also needs
	rewriting
	[d0f9f550e71f]

	* src/lib-index/mail-index.c:
	minor fix for error handling
	[fb785d235c43]

	* src/lib-storage/index/mbox/mbox-sync.c:
	New mails pointed to beginning of file.
	[73e9cf84a92a]

	* src/lib-storage/index/mbox/mbox-sync.c:
	assert crashfix for readonly mboxes
	[d6687626c6a1]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	fix
	[9f318b950ea7]

	* src/lib/istream-limit.c:
	minor fix
	[ed6b3d59ce93]

	* src/lib/istream.c:
	i_stream_read_data(): don't call read() unless we have to
	[4c5732a9e2bc]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	fixes
	[e5f9d66d6ced]

2004-06-18  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	comment update
	[506302b8b2fb]

	* configure.in, src/auth/.cvsignore, src/auth/Makefile.am, src/auth
	/checkpassword-reply.c, src/auth/passdb-checkpassword.c,
	src/auth/passdb.c, src/auth/passdb.h:
	Added checkpassword passdb. userdb has only beginnings.
	[95b2a6abc01e]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync.c:
	Added istream_raw_mbox_is_eof() and fixed updating UIDVALIDITY in
	index
	[acc93754e91d]

	* src/lib-storage/mail-save.c, src/lib/istream-file.c, src/lib
	/istream-limit.c, src/lib/istream.c, src/lib/istream.h:
	Renamed istream->eof to istream->disconnected which is what it
	currently does.
	[a0b23396835c]

	* src/lib-storage/index/mbox/mbox-sync.c:
	read-only mbox fix
	[c7616a31589a]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Fixed updating X-IMAPbase
	[787bbde7ced3]

	* src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	fixes
	[4c55020e6b53]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't leak mbox fd when closing mailbox
	[1d55147bd27b]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	fixes
	[282e993b92c4]

	* src/lib-storage/index/mbox/mbox-sync.c:
	X-IMAPbase update fix
	[34ea1398a67b]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Create X-Keywords header if possible.
	[53288223de6c]

	* src/lib/str.c, src/lib/str.h:
	Added str_insert()
	[c7b77b11c89c]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	Several fixes in space/offset logic. Should be much more robust now.
	[16287320d080]

	* src/imap/imap-fetch-body-section.c, src/lib-mail/message-body-
	search.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/mail-save.c:
	Added skip_initial_lwsp parameter to message_parse_header_init().
	[347ca1cf6372]

2004-06-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-sync.c:
	EXAMINE/STATUS should also update metadata changes, they don't
	really open the mbox as readonly.
	[b526decec0b8]

	* src/lib-storage/index/mbox/mbox-sync.c:
	sync fix
	[219fe7776a0c]

	* src/lib-index/mail-index-sync-update.c:
	fix
	[8a3e09139b4c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src
	/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Complain if file isn't in mbox format. Complain if From-line wasn't
	found from expected location. Parser should handle now correctly any
	kind of mbox no matter how corrupted.
	[3a33250e6a2d]

	* src/lib-mail/message-parser.c:
	Handle missing last \n from headers more correctly
	[fd00d1b2fd14]

	* src/lib-storage/index/mbox/mbox-from.c:
	Oops, don't include the known date formats list (copyrighted by UW-
	IMAP, copy&pasted there only temporarily and forgot..). They could
	be compressed just as well for a few short rules.
	[b53b36b6b41d]

	* TODO:
	updated
	[11c1f1203b65]

	* src/lib-storage/index/mbox/mbox-sync.c:
	crashfix in error case
	[535227d3e4b0]

	* dovecot-example.conf, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/master/auth-process.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Added mail_extra_groups setting.
	[8690d2000e33]

	* src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c:
	"readonly sync" -> "forced sync"
	[e2cd51b99359]

	* src/lib-index/mail-index-sync.c:
	cleanups
	[9f90f83835ae]

	* src/lib-index/mail-transaction-util.c:
	merging expunge buffers sometimes produced wrong results
	[0b11c460c64a]

2004-06-15  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c:
	Raised login_process_size default from 16MB -> 32MB
	[7d625d6b33aa]

	* src/lib-storage/index/mbox/mbox-from.c:
	Allow more From-line date formats.
	[33ee7db25ee2]

	* src/lib-storage/index/maildir/maildir-list.c:
	d_type symlink checks
	[fdacb90d3f45]

	* src/auth/passdb-pam.c:
	Set PAM_RHOST for PAM if it's known.
	[c70d0155d93c]

	* dovecot-example.conf:
	comment update
	[6e662d7188e9]

	* src/auth/passdb-vpopmail.c:
	Added support for vpopmail pop-before-smtp relay
	[91358abe5874]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	storage.h:
	forgot to commit
	[44a6af356c45]

	* src/lib-storage/index/maildir/maildir-util.c:
	warning
	[46a58a2da7cc]

	* src/lib-storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-sync.c:
	fixes
	[1039d3650f5c]

	* src/lib-storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c:
	lock the mbox before reading it.
	[2da965864bc4]

	* src/lib/fdpass.c:
	Solaris fix by Tim Hurman
	[5cb49f75e512]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox/mbox-
	sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	more syncing fixes
	[57078e1f2bfc]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	several fixes and optimizations.
	[dc18cc3568b0]

2004-06-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	major syncing code cleanups. the code finally looks almost readable.
	logic should have stayed same.
	[24651c3ac7f3]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	locking fixes
	[e01de478882f]

	* src/lib-index/mail-index.c:
	crashfix on error
	[db5807f350ca]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Locking fixes. use less memory
	[0840edf34f37]

	* src/lib-index/mail-index-sync-update.c:
	bugfixes
	[f434ecc6ef83]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	fixes
	[26dd9aca935e]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Save mbox offsets to index file using extra_records. Some other
	fixes.
	[11febaee5e9b]

	* src/lib-storage/index/index-storage.c:
	Don't let index_storage_alloc() fail
	[e154abe2337c]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log.c, src/lib-index/mail-transaction-util.c:
	Fixes for extra_records
	[fbb4da13ee3b]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index.c, src/lib-
	index/mail-index.h, src/lib-index/mail-transaction-log-view.c, src
	/lib-index/mail-transaction-log.c, src/lib-index/mail-transaction-
	log.h, src/lib-index/mail-transaction-util.c, src/lib-index/mail-
	transaction-util.h:
	Modifying extra_records should work now.
	[f720b3f15333]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-util.c, src/lib-index/mail-transaction-util.h:
	Added support for per-index sized mail_index_record.
	[4aedcb4c51cb]

	* src/lib/network.c, src/lib/network.h:
	net_gethostbyname() was broken with IPv6 enabled (wasn't really used
	with Dovecot anyway). Some other cleanups.
	[c5817f302aa6]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't sync mbox if it hasn't changed
	[55d3864cc4f8]

2004-06-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Fixes for expunging first message
	[eb26aa46686d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	some more fixes
	[18d29a565168]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	expunges should pretty much work now.
	[8c0168d19148]

2004-06-11  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Some of recent dotlock changes weren't committed..
	[0b3a6fea167c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	expunging is somewhat working
	[8266299b92f5]

2004-06-10  Timo Sirainen  <tss@iki.fi>

	* doc/configuration.txt:
	s/login_process_per_user/login_process_per_connection/
	[1d15be422201]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Make sure INBOX is created when maildir storage is opened.
	[2a7e87dea317]

2004-06-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Changed error message
	[193cb9001256]

2004-06-03  Timo Sirainen  <tss@iki.fi>

	* configure.in, dovecot-example.conf, src/lib-storage/index/mbox/mbox-
	lock.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Separate mbox_locks/mbox_read_dotlock to mbox_read_locks and
	mbox_write_locks. Added support for lockf() method.
	[879b0b9ed5d4]

2004-05-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-
	md5.c, src/auth/mech.c, src/auth/mech.h:
	Delay reporting failed authentications
	[a5e7414f1a9a]

	* src/lib-index/mail-transaction-log.c:
	whops, wrong change. immediate_stale_timeout 2min -> 5min
	[9b202e2ac91b]

	* src/lib-index/mail-transaction-log.c:
	Grow log_dotlock_timeout to 120sec
	[6d7c3c150937]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth/mech-
	anonymous.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/mech.h, src/auth
	/passdb-bsdauth.c, src/auth/passdb-ldap.c, src/auth/passdb-mysql.c,
	src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth
	/passdb-passwd.c, src/auth/passdb-pgsql.c, src/auth/passdb-shadow.c,
	src/auth/passdb-vpopmail.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c:
	Logging changes. Make sure we don't write control characters to log
	and also log IP address.
	[eac49325fa23]

	* src/lib/network.c, src/lib/network.h:
	Added net_getpeername()
	[24e382b88232]

	* doc/Makefile.am, doc/variables.txt, dovecot-example.conf, src/auth
	/auth-client-interface.h, src/auth/mech.c, src/auth/mech.h, src
	/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/lib-auth/auth-client.h, src/lib-auth/auth-
	server-request.c, src/login-common/client-common.h, src/login-
	common/main.c, src/login-common/master.c, src/master/login-
	process.c, src/master/mail-process.c, src/master/mail-process.h,
	src/master/master-login-interface.h, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h:
	Added %l, %r and %P variables and mail_log_prefix setting.
	[4e77cb0aff21]

	* src/lib/module-dir.c:
	Don't complain if module directory doesn't exist
	[7e46cf0f3522]

2004-05-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c:
	fixes
	[92d8b70829c8]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	small fixes
	[8f46cf3e9b5a]

	* src/pop3/client.c:
	fix
	[fe795faa81a1]

	* src/pop3/client.c:
	assert fix
	[952a4106d3b8]

	* src/lib-index/mail-transaction-log-view.c:
	show error messages when log files are missing
	[2450b4ff4894]

	* src/lib/module-dir.c:
	Be quiet when we don't want to call init() / deinit() and they don't
	exist
	[0a4b2c006096]

	* src/lib-auth/auth-server-request.c:
	PLAIN auth fallbacking works now with initial responses
	[d8cd285b148b]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h:
	Use initial SASL response for LOGIN command internally.
	[4d0834aaa365]

	* src/lib-index/mail-transaction-log-view.c:
	added assert
	[a11f8fa33848]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c:
	fixes
	[5c851ff00f1a]

	* src/lib-index/mail-transaction-log-view.c:
	assert fix
	[258c8ef1bdc4]

	* src/auth/Makefile.am, src/auth/main.c, src/auth/password-scheme.c,
	src/auth/password-scheme.h, src/imap/main.c, src/lib/module-dir.c,
	src/lib/module-dir.h, src/pop3/main.c:
	Added support for password scheme plugins. auth module dir defaults
	under module_dir now.
	[9ba79ebae6ab]

	* src/auth/password-scheme.c:
	Allow either SHA or SHA1.
	[19394e36178c]

	* src/lib-auth/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-connection.c, src/lib-auth/auth-server-connection.h:
	Allow using more easily outside dovecot.
	[e22e3827a5f3]

	* src/auth/mech.c:
	Case insensitive lookups for mechanism names
	[3c0fb1a4a379]

	* configure.in, src/auth/password-scheme.c:
	SHA1 support via OpenSSL
	[cf8c711f76a0]

	* src/master/mail-process.c:
	updated valid_chroot_dirs error message.
	[729431cc32c1]

	* configure.in, dovecot-example.conf, src/lib-storage/index/maildir
	/maildir-list.c, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added maildir_stat_dirs option.
	[b3daf55df932]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-interface.h, src/auth/auth-master-connection.c,
	src/auth/auth-master-connection.h, src/auth/auth-master-interface.h,
	src/auth/auth-mech-desc.h, src/auth/main.c, src/auth/mech-
	anonymous.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb.c, src/imap-login/client-authenticate.c, src/lib-
	auth/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-connection.h, src/lib-
	auth/auth-server-request.c, src/lib/file-dotlock.c, src/pop3-login
	/client-authenticate.c:
	Removed hardcoded mechanism lists. It's now possible to add them
	dynamically. Added support for SASL initial response.
	[d5b20d679b8a]

2004-05-29  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-interface.h, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb-pam.c, src/auth/passdb-vpopmail.c, src/imap-login
	/client-authenticate.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-request.c, src/pop3-login/client-authenticate.c:
	Don't use hardcoded protocol list for auth process, string is just
	fine.
	[6a72075e3543]

	* src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/main.c, src/auth/mech.c, src/master/auth-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	dovecot-auth can now be run by itself, it listens in UNIX sockets
	specified in AUTH_SOCKETS environment. Added extra_sockets auth
	setting which can be used to do the same thing while started through
	dovecot master.
	[5138b14889a6]

2004-05-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.h:
	Keep the transaction log view open all the time for index views (not
	just while syncing) to avoid losing the log files.
	[cb5269c052e0]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log.c:
	Don't complain about transaction log indexid changes when rebuilding
	index.
	[a58c51c8f37b]

2004-05-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	struct iovec->iov_base may not be defined as void*. add casts to
	avoid compiler warnings.
	[69cef820735f]

	* src/lib-index/mail-index-sync-update.c:
	mmap_disable=yes crashfix
	[fd17ca21af0b]

	* configure.in, src/master/Makefile.am, src/master/master-settings.c:
	Added --with-moduledir configure option
	[0c8f884d1648]

	* src/master/master-settings.c:
	mail_modules for pop3 should default to lib/pop3, not lib/imap
	[028a6cf7488f]

	* dovecot-example.conf:
	oe6-fetch-redundant-msgset workaround doesn't exist anymore, remove
	it
	[d52c8cbf2b9d]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Path was missing from Maildir sync-errors.
	[3f97439ba59e]

	* src/lib-index/mail-index-sync-update.c:
	fix
	[ef96a98b109a]

	* src/lib-index/mail-index-view.c:
	mail_index_lookup_uid_range(): don't crash if we look only UIDs
	larger than our next_uid
	[2e2287c9d5eb]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Don't use internal last_cur_mtime stamp - it's index-specific so
	always get it from index's header.
	[5cfdc99fab69]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	mail_index_refresh() - allows forcing a refresh check
	[21a3e5d08290]

2004-05-25  Timo Sirainen  <tss@iki.fi>

	* src/imap/mail-storage-callbacks.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/mail-storage.h, src/pop3
	/mail-storage-callbacks.c:
	Send recent counter changes when it actually changes.
	[397ce1dbc593]

	* src/lib-storage/index/maildir/maildir-mail.c:
	,W= fix
	[ad296f17c100]

	* src/login-common/ssl-proxy.c:
	compile fix
	[9c18f7e42016]

	* src/lib-index/mail-index-lock.c:
	fcntl_locks_disable=yes fix
	[5847f9dc8ce4]

	* src/imap-login/client.c, src/imap/client.c, src/imap/imap-sort.c,
	src/master/mail-process.c, src/pop3-login/client.c,
	src/pop3/commands.c:
	cleanup: str_*case(t_strdup_noconst(str)) -> t_str_*case(str)
	[0a1755f79392]

	* dovecot-example.conf, src/auth/auth-master-connection.c,
	src/auth/mech.c, src/auth/mech.h, src/auth/passdb-ldap.c, src/auth
	/passdb-mysql.c, src/auth/passdb-pgsql.c, src/auth/userdb-ldap.c,
	src/auth/userdb-mysql.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c, src/auth/userdb-pgsql.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c, src/auth/userdb.h, src/lib-index/mail-
	index-sync-update.c, src/lib/strfuncs.c, src/lib/strfuncs.h, src/lib
	/var-expand.c, src/lib/var-expand.h, src/master/common.h, src/master
	/login-process.h, src/master/mail-process.c:
	Fixed var_expand() to take a table of variables rather than a few
	predefined ones. Added support for modifiers.
	[5e0167577399]

	* src/lib-storage/index/maildir/maildir-list.c:
	don't crash if we can't open directory
	[7c47536833ca]

2004-05-24  Timo Sirainen  <tss@iki.fi>

	* src/auth/userdb-vpopmail.c:
	Get internal username from vpw->pw_name after all. It may contain
	domain which input username doesn't.
	[ef9a46ea2622]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	uidvalidity/uidnext fixes
	[02e066d4df9a]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	race condition fixes
	[66f5d28f9b27]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	cleanup
	[9d1ce6135d4f]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Some more UIDVALIDITY issues fixed.
	[596267d8e2e2]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-private.h,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index-
	view-private.h, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h, src/lib-index/mail-transaction-
	util.c, src/lib-index/mail-transaction-util.h, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/maildir/maildir-storage.c, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Index header changes now go through transaction log. Removed the
	kludgy parameters for mail_index_sync_end(). Removed code
	duplication of syncing index root mapping and view mapping. Some
	fixes to handling uidvalidity and nextuid in syncing.
	[ee1095ccfd23]

	* src/lib-index/mail-index-lock.c:
	fix for last change
	[6bdabb83f1a2]

	* src/lib-index/mail-index-lock.c:
	when index's header size grows, fix it first time we get exclusive
	lock
	[a4babfc85e0a]

2004-05-23  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Print version number in "Dovecot starting up" message.
	[55e3412ae995]

	* src/master/auth-process.c, src/master/log.c, src/master/log.h,
	src/master/login-process.c, src/master/mail-process.c:
	logging cleanups.
	[6ae973f60f43]

	* src/lib-index/mail-transaction-log.c:
	more debugging info to log
	[c7b50945591e]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c:
	View's message count shouldn't change until after view is synced.
	[d2eafac70369]

	* src/lib-index/mail-index.c:
	Don't try to re-map dirty memory mapping.
	[4548def7ac02]

	* src/lib-storage/index/index-search.c:
	cleanup
	[418a0de45c38]

	* src/lib-storage/index/index-sync.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/mbox-sync-parse.c,
	src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	mbox syncing fixes
	[2240a38138db]

	* src/lib/ostream-file.c:
	o_stream_send_istream() fix
	[6920ebecb853]

	* dovecot-example.conf, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/mail-storage.h, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3/client.c:
	Added pop3_mails_keep_recent option. Fixed recent assert crash.
	[f0925b2271e1]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-mail.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c:
	Recent flag fixes. Should work perfectly now with maildir.
	[df504dad3aec]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-sync.c:
	Set dirty flags through transaction log, not directly. Some other
	flag fixes etc.
	[8763032d31bd]

2004-05-22  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	AC_DEFUN warning fixes for aclocal 1.8..
	[b3a56463c812]

	* configure.in, src/lib/sendfile-util.c:
	Solaris: Move from sendfilev() to sendfile() (was it always there?).
	Make EAFNOSUPPORT error Linux-compatible EINVAL.
	[0e65efd14eda]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Fix bogus "UID inserted in the middle of mailbox" errors
	[8078400fe561]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index.h, src/lib-index/mail-transaction-log-view.c, src
	/lib-index/mail-transaction-log.c, src/lib-index/mail-transaction-
	log.h, src/lib-index/mail-transaction-util.c, src/lib-index/mail-
	transaction-util.h, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	sync.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Transaction log contains only UIDs now, no more sequences which just
	mess up everything.
	[4f6b1118a53d]

2004-05-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-util.c, src/lib-index/mail-
	transaction-util.h:
	last tried fixes with sequences-in-log approach. moving to uids
	next, wonder why I didn't earlier.
	[1138c7abb360]

2004-05-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-util.c:
	Expunge fix
	[28d715a903e1]

	* src/auth/mycrypt.c:
	Solaris 10 comple fix
	[4e331341d603]

	* src/lib-storage/proxy-mail-storage.c:
	compile fix
	[25a8c7c21a7a]

	* configure.in:
	Removed LIST-SUBSCRIBED capability, latest LISTEXT draft dropped it.
	[ec22548b6124]

	* dovecot-example.conf, src/auth/auth-client-interface.h,
	src/auth/mech.c, src/auth/mech.h, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/lib-auth/auth-client.h,
	src/lib-auth/auth-server-request.c, src/login-common/client-
	common.h, src/login-common/main.c, src/login-common/ssl-proxy-
	openssl.c, src/login-common/ssl-proxy.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	Added ssl_require_client_cert auth-specific setting. Hide
	ssl_verify_client_cert from default config file as it's
	automatically set if needed and there's not much point in forcing
	it.
	[dc5d0da1abe9]

	* src/lib-index/mail-transaction-log.c:
	Dotlocking: Don't leave the log infinitely locked after rotation
	[53585aa87f9c]

	* src/lib/file-dotlock.c:
	file_dotlock_delete(): don't complain about mtime changes in lock
	file, as we most likely did it ourself
	[ced02e8023c6]

	* src/lib-index/mail-index-transaction.c:
	Don't remove flag changes in transaction log if they're expunged
	[8bb1db13c94a]

	* src/imap/cmd-sort.c, src/imap/cmd-thread.c, src/imap/imap-sort.c,
	src/imap/imap-thread.c:
	return value fixes
	[1659cfc67eaf]

	* src/lib-index/mail-transaction-log.c:
	fixes
	[f5eb6bd7d1aa]

2004-05-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c:
	Locking fixes
	[19e638ade25c]

	* src/pop3/client.c:
	fixes
	[62faff1d0047]

	* src/pop3/client.c:
	fix
	[b6b0d536bed9]

	* src/lib-index/mail-transaction-util.c:
	fixes
	[be02e17d7162]

	* src/lib-index/mail-transaction-log.c:
	more fixes (still not right?)
	[2a047b054e92]

2004-05-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	bugfixes
	[28779a3de9c6]

	* src/pop3/client.c:
	t_push/t_pop
	[0fae715679bc]

2004-05-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-util.c:
	t_push/t_pop
	[6c21c1d25b53]

	* src/lib-index/mail-transaction-log.c:
	fix
	[c4ac66804f8a]

	* src/pop3/client.c:
	don't crash to errors
	[863fbe16e395]

	* src/lib-index/mail-index-sync.c:
	don't crash with assert if transacton log has expunge with seq 0
	[9c2c31893775]

	* src/pop3/client.c:
	index wasn't unlocked initially
	[01d2eb10a1c9]

	* src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/lib-storage/index/index-transaction.c, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	When committing with no changes, don't try to sync them later.
	[2e77ee652e2e]

	* src/lib-index/mail-transaction-log.c:
	some minor fixes
	[23959140f4f5]

2004-05-10  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Don't require initializing RAND_bytes() to return cryptographically
	strong data.
	[3dd9d3165bff]

	* src/pop3/commands.c:
	Message deletion deleted wrong messages
	[e97b7b1b2a1e]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	removed assert, that can happen in valid situations
	[13f8765f08c9]

	* src/lib-index/mail-transaction-log.c:
	some fixes
	[2ab29071a32c]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	sync fix
	[d1a2c2ae7226]

	* src/imap/main.c:
	removed debugging
	[3b1e6485704d]

	* src/imap/cmd-subscribe.c:
	fix
	[1f17e37607fd]

	* src/auth/main.c, src/imap/main.c, src/lib/failures.c,
	src/lib/failures.h, src/login-common/main.c, src/master/Makefile.am,
	src/master/auth-process.c, src/master/common.h, src/master/log.c,
	src/master/log.h, src/master/login-process.c, src/master/mail-
	process.c, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3/main.c:
	Write all logging through master process. Fixes problems with log
	rotation, chrooting, etc. Master process also allows max. 10 log
	messages per second per child process, it then begins throttling
	them (eventually making the child process start blocking on stderr).
	[c7c19f5071c3]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	fix
	[8f0e6d457239]

	* README:
	Updated RFC list
	[7c9e02c14f8e]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/login-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Added ssl_verify_client_cert setting.
	[1d0985f6bdd9]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/login-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Added ssl_cipher_list setting.
	[d8f06a0c818e]

	* AUTHORS, configure.in, doc/Makefile.am, doc/dovecot-mysql.conf,
	src/auth/Makefile.am, src/auth/db-mysql.c, src/auth/db-mysql.h,
	src/auth/passdb-mysql.c, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb-mysql.c, src/auth/userdb.c, src/auth/userdb.h:
	MySQL authentication patch by Matther Reimer
	[cc64f8bb4716]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Fixes to commands after mails have been deleted. Patch by Nic
	Bellamy.
	[77f3111f7976]

	* src/master/master-settings.c:
	show error if config is missing auth section
	[719228a4df3f]

	* src/lib/data-stack.c:
	allow using data stack without data_stack_init().
	[63e67430b580]

	* src/lib-charset/charset-iconv.c:
	iconv_t isn't necessarily pointer.
	[689f791b480f]

	* configure.in:
	fix
	[049502ef137e]

	* configure.in, src/lib/lib.h:
	Define PREAD_WRAPPERS if we're using GLIBC, not if we're using
	Linux. Removed a few ANSI-C header checks. Added strings.h check and
	include it automatically if it's found, for strcasecmp().
	[a2b009c65e02]

	* src/lib-index/mail-index-view-sync.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/maildir/maildir-uidlist.h:
	syncing fixes
	[739b469b99e2]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/mbox/mbox-storage.c, src/lib-storage
	/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h:
	maildir: don't use ".temp" prefix for temporary files, since in
	~/Maildir they conflict with mailbox namespace.
	[3b1f8ed213ca]

	* dovecot-example.conf:
	s/custom flags/keywords/
	[7ac0ef106427]

	* src/lib-index/mail-index-view.c, src/lib-storage/index/index-
	search.c:
	don't crash when requesting messages from empty mailbox
	[3ccd4eb52ee4]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-view-sync.c, src/lib-index/mail-index.c, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/maildir/maildir-sync.c, src
	/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	syncing fixes
	[9c159272f721]

	* src/lib-storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src
	/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	mbox growing and locking works now
	[933cab442392]

2004-05-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-header.c:
	this isn't needed
	[6985631ac6eb]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h,
	src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	mbox rewriting is almost working - the hard part is done.
	[eb282832fc75]

	* src/lib-mail/message-parser.c:
	If value of header contains only LWSP, return all LWSP instead of
	returning just empty value.
	[ab4fbb7727ec]

2004-05-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Some mbox fixes. Kind of works now.
	[a4850e1c56f7]

	* configure.in, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-list.c, src/lib-storage/index/maildir/maildir-mail.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/mbox/Makefile.am, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/istream-raw-mbox.h,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox/mbox-
	file.h, src/lib-storage/index/mbox/mbox-from.c, src/lib-
	storage/index/mbox/mbox-from.h, src/lib-storage/index/mbox/mbox-
	list.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib-
	storage/index/mbox/mbox-lock.h, src/lib-storage/index/mbox/mbox-
	mail.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/index/mbox/mbox-transaction.c:
	mbox code compiles again, but syncing is only partially implemented
	so accessing mboxes fails..

	Also some cleanups to index-storage and maildir code.
	[6303ef092c5b]

2004-05-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	error message change
	[ab2f615e0ce8]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Don't rotate transaction log too often
	[4e0269adb24a]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	sync fix
	[be0269b8e2d4]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/subscription-file/subscription-file.c, src/lib/file-
	dotlock.c, src/lib/file-dotlock.h:
	file_dotlock_open/delete/replace now has lock_suffix parameter. NULL
	defaults to ".lock".

	Fixed dotlocking transaction log.
	[d85f71ffeb8f]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	and yet more syncing fixes..
	[f6d2dba3b78b]

2004-05-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c:
	fixes for fcntl_locks_disable = yes
	[137ed22eb749]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	sync fix
	[e7244b4dd03c]

	* src/lib-storage/index/maildir/maildir-sync.c:
	When moving mails to cur/, we must add the ":2," part to filename.
	[0f4c4a043be1]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Create .INBOX/ to index directory, if it's different.
	[570587f42d29]

	* src/login-common/ssl-proxy-gnutls.c:
	Fixed to compile with GNUTLS 1.0. Patch by Jaldhar H. Vyas.
	[f23cbc64cef4]

	* src/imap/main.c, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log.c, src/lib-storage/index/index-storage.c:
	memory leak fixes
	[b6d900688c55]

	* src/lib-index/mail-index.h:
	comment update
	[ee995fdad8da]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	INDEX_KEYWORDS_BYTE_COUNT was counted wrong so index files were
	larger than they needed to be. Added sizeof(keywords_mask_t) to
	compat_data. Added limit to growing index file exponentially.
	[41f6a04154a3]

	* src/lib-index/mail-transaction-log.c:
	mail_transaction_log_append() - return seq/offset even if we didn't
	write anything
	[8e0cc5b87eab]

	* src/imap/imap-fetch-body-section.c:
	don't access uninitialized memory
	[db06a387ef1a]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Syncing should be fixed now.
	[4775ffa73874]

	* src/lib-index/maildir/.cvsignore, src/lib-index/mbox/.cvsignore:
	removed
	[79a701e60f87]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	crashfix
	[b9ea4db3f8e0]

2004-05-02  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/main.c, src/master/mail-process.c, src/master
	/master-settings.c, src/master/master-settings.h:
	and a few more custom flag -> keyword changes
	[50e24ce4f9c3]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-select.c, src/imap/cmd-store.c, src/imap/commands-
	util.c, src/imap/commands-util.h, src/imap/common.h, src/imap/mail-
	storage-callbacks.c, src/imap/main.c, src/lib-imap/imap-util.c, src
	/lib-imap/imap-util.h, src/lib-index/mail-index-sync-update.c, src
	/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.h, src/lib-mail
	/mail-types.h, src/lib-storage/index/index-fetch.h, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-search.c,
	src/lib-storage/index/index-status.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/mail-storage-private.h, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/proxy-mailbox.c, src/pop3/mail-storage-callbacks.c:
	s/custom flags/keywords/
	[4dec6a3d79fd]

	* src/lib-index/mail-index-sync.c:
	comment
	[d77a2a1e9278]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-index-sync-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.h, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-sync.c:
	Added support for setting dirty flags for messages (TODO: undirty..)

	s/mail_index_record_flag/mail_cache_record_flag/
	[d6941cd8afdc]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-sync.c:
	More syncing changes
	[0f0128b4af5d]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.h, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Syncing optimizations.
	[2f6e137cdc44]

	* src/imap/imap-fetch-body-section.c:
	Add CRLF to end of FETCH BODY[HEADER.FIELDS (...)] always.
	[a1c00aa3a078]

	* src/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.c:
	Don't crash in assert() with corrupted index file.
	[05f76fe32f0d]

	* src/imap/cmd-subscribe.c, src/lib-storage/index/maildir/maildir-
	list.c:
	fixes
	[47f3a846b769]

	* src/pop3/commands.c:
	crashfix
	[c4d246aad338]

2004-05-01  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	Don't advertise AUTH=PLAIN unless transport is secure
	[d2755efdd187]

	* configure.in:
	Default to OpenSSL
	[7fa8697bc2a9]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/maildir/maildir-util.c:
	Recent-flag should work now
	[777da553d1d3]

	* src/lib-index/mail-index.c:
	syncing fix
	[dbec6c9dbffa]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	cleanup
	[268a4096e8be]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index-reset.c, src/lib-index/mail-index.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	remove mail_index_reset() completely
	[5a3c3b4d4a02]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-
	reset.c, src/lib-index/mail-index.c:
	missing index file fixes
	[e473d2df21be]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-reset.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h:
	handle losing index file
	[2b114aa7eeec]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c, src/lib-index/mail-transaction-log.h:
	automatically fix broken/missing transaction log files on the fly
	[ced8e41c137a]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index-view.c, src/lib-index/mail-transaction-log-view.c, src/lib-
	index/mail-transaction-log.c, src/lib-index/mail-transaction-log.h,
	src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	fixes
	[876bd2849a00]

2004-04-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	changes
	[4698c121bae3]

2004-04-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-private.h:
	recent fixes
	[a2eaa322ca8c]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log.c:
	Ignore new mail appends if they're already in transaction log.
	[f56d502b248b]

	* src/lib-index/mail-transaction-log.c:
	assert
	[bb1bde2680b0]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Don't modify index file when creating new transaction log.
	[ec4d5ff99f6e]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	make sure we unlock uidlist
	[08159fcf9eb8]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-util.c:
	fixes for mmap_disable
	[bfdff8c75965]

	* src/lib-index/mail-transaction-log.c:
	fix
	[f04ff2a2ad5d]

	* src/lib-storage/index/index-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c:
	fixes
	[35a947481130]

2004-04-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index.c,
	src/lib-storage/index/index-storage.c:
	fixes
	[8f31c6dae363]

	* src/lib/read-full.c, src/lib/write-full.c:
	whops, retrying was broken
	[e1443315294c]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c:
	when growing index file, do it exponentially for this session (files
	being added one at a time).
	[5ca676060080]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-transaction-log.c:
	some more locking fixes
	[7ad1a47c615e]

	* src/imap/imap-fetch.c:
	BYE if trying to fetch body[] of expunged message.
	[982bd89b42fd]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index.c:
	locking fixes, sync fix
	[e3fa34df2263]

	* configure.in:
	Put -lcrypt to first in AUTH_LIBS to fix some linking problems with
	Solaris
	[4dbe61f1aea6]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view.c:
	cleanup
	[fb656c936c47]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c, src/lib-index/mail-transaction-util.c:
	Locking changes. bugfixes.
	[e4c30cb5d094]

	* src/lib-index/mail-index-lock.c:
	whops, was unfinished
	[e28999e74a12]

	* dovecot-example.conf, src/lib-index/mail-index-lock.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log-private.h, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/index-
	storage.c, src/master/mail-process.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Added fcntl_lock_disable setting to allow indexes to work with NFS.
	Some other locking fixes.
	[d11efbf1d341]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c:
	locking fixes, mmap_disable=yes fixes
	[4aeb7357951a]

	* dovecot-example.conf:
	updated for mmap changes
	[ef89efba1838]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-select.c,
	src/imap/cmd-status.c, src/imap/common.h, src/imap/imap-search.h,
	src/imap/main.c, src/lib-index/mail-index-lock.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-reset.c, src/lib-
	index/mail-index-sync-update.c, src/lib-index/mail-index-sync.c, src
	/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-private.h, src
	/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log.c, src/lib-storage/index/index-search.c,
	src/lib-storage/index/index-status.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/mail-storage.h, src/master/mail-process.c, src/master
	/master-settings.c, src/master/master-settings.h, src/pop3/client.c:
	Forced locking to be right with mprotect()ing index file. Support
	for disabling mmap for indexes, and disabling just mmap+write().
	[68938dccbc45]

	* src/lib-storage/index/index-mail.c:
	from_envelope crashfix..
	[01bce69ac1b4]

2004-04-27  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/client.c, src/imap/cmd-
	append.c, src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-
	create.c, src/imap/cmd-delete.c, src/imap/cmd-expunge.c, src/imap
	/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap
	/cmd-logout.c, src/imap/cmd-rename.c, src/imap/cmd-search.c,
	src/imap/cmd-select.c, src/imap/cmd-sort.c, src/imap/cmd-status.c,
	src/imap/cmd-store.c, src/imap/cmd-subscribe.c, src/imap/cmd-
	thread.c, src/imap/cmd-unselect.c, src/imap/commands-util.c,
	src/imap/imap-expunge.c, src/imap/imap-expunge.h, src/imap/imap-
	fetch-body-section.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h,
	src/imap/imap-messageset.c, src/imap/imap-messageset.h, src/imap
	/imap-search.c, src/imap/imap-search.h, src/imap/imap-sort.c,
	src/imap/imap-thread.c, src/imap/mail-storage-callbacks.c,
	src/imap/namespace.c, src/lib-imap/imap-util.c, src/lib-imap/imap-
	util.h, src/lib-index/Makefile.am, src/lib-index/mail-cache-
	compress.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	cache-old.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-
	lock.c, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index-reset.c, src/lib-index/mail-index-sync-private.h, src/lib-
	index/mail-index-sync-update.c, src/lib-index/mail-index-sync.c, src
	/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-private.h, src
	/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h, src/lib-index/mail-transaction-
	util.c, src/lib-index/mail-transaction-util.h, src/lib-
	index/maildir/Makefile.am, src/lib-index/mbox/Makefile.am, src/lib-
	mail/Makefile.am, src/lib-mail/mail-types.h, src/lib-mail/message-
	parser.c, src/lib-mail/message-parser.h, src/lib-
	storage/Makefile.am, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-expunge.c,
	src/lib-storage/index/index-expunge.h, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/index-mailbox-check.c, src/lib-storage/index
	/index-messageset.c, src/lib-storage/index/index-messageset.h, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/index-transaction.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/Makefile.am,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-transaction.c, src/lib-storage/index/maildir/maildir-
	uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/index/mbox/istream-
	raw-mbox.c, src/lib-storage/index/mbox/istream-raw-mbox.h, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	from.c, src/lib-storage/index/mbox/mbox-from.h, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-sync-header.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/mail-save.c, src
	/lib-storage/mail-save.h, src/lib-storage/mail-search.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/proxy-mail-storage.c,
	src/lib-storage/proxy-mail-storage.h, src/lib-storage/proxy-mail.c,
	src/lib-storage/proxy-mailbox.c, src/lib-storage/proxy-mailbox.h,
	src/lib-storage/register/Makefile.am, src/lib-storage/subscription-
	file/Makefile.am, src/lib-storage/subscription-file/subscription-
	file.c, src/lib-storage/subscription-file/subscription-file.h,
	src/lib/Makefile.am, src/lib/compat.h, src/lib/file-dotlock.c,
	src/lib/file-lock.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib/macros.h,
	src/lib/network.c, src/lib/read-full.c, src/lib/read-full.h, src/lib
	/write-full.c, src/lib/write-full.h, src/pop3/client.c,
	src/pop3/commands.c, src/pop3/mail-storage-callbacks.c:
	importing new index code. mbox still broken.
	[79790750c349]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-custom-flags.c, src/lib-index/mail-custom-flags.h, src
	/lib-index/mail-index-file.c, src/lib-index/mail-index-fsck.c, src
	/lib-index/mail-index-open.c, src/lib-index/mail-index-rebuild.c,
	src/lib-index/mail-index-util.c, src/lib-index/mail-index-util.h,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src/lib-
	index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	clean.c, src/lib-index/maildir/maildir-expunge.c, src/lib-
	index/maildir/maildir-index.c, src/lib-index/maildir/maildir-
	index.h, src/lib-index/maildir/maildir-open.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-uidlist.c, src/lib-
	index/maildir/maildir-uidlist.h, src/lib-index/maildir/maildir-
	update-flags.c, src/lib-index/mbox/istream-mbox.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-lock.h, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rewrite.c, src/lib-
	index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c:
	removed out of the way of new index code
	[1f156d653f4a]

	* src/auth/db-pgsql.c, src/auth/db-pgsql.h, src/auth/passdb-pgsql.c,
	src/auth/userdb-pgsql.c:
	Use PQescapeString() instead of str_escape()
	[be667b9f4605]

2004-04-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-storage.c:
	"Internal error" message changed.
	[e27ec44c0d53]

	* dovecot-example.conf:
	typofix
	[ac810e95cdd6]

	* src/auth/db-ldap.c, src/auth/db-ldap.h:
	Patch by Quentin Garnier:

	1. Change default value for 'hosts' to NULL instead of 'localhost'.
	That way, libldap will choose the default list of server as
	specified in OpenLDAP's ldap.conf configuration file.

	2. Add a new configuration stance, 'uris', which you can set to a
	list of URIs that will be passed directly to libldap, which
	understands them.
	[b9005f93be70]

	* src/imap/imap-fetch-body-section.c:
	Fixes for fetching BODY[n], patch by Rick Jones
	[a3a6b702c766]

2004-01-23  Timo Sirainen  <tss@iki.fi>

	* INSTALL:
	updates about running it
	[0615c22cbda5]

2004-01-19  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c, src/master/login-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added setting ssl_ca_file, patch by Zach Bagnall
	[190f1d315ce6]

2004-01-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	LIST: If reference parameter is given, get the namespace from it.
	[956232f5706c]

	* src/lib/mempool.h:
	pool_unref(x): don't set (x) = NULL, it may have been allocated from
	the pool that was just freed.
	[45a656ec68a1]

	* src/auth/mech-digest-md5.c:
	removed unused trim() function
	[00cc093bb85f]

	* src/auth/mech-digest-md5.c:
	Remove service type checking from given URI. It was hardcoded to
	IMAP, but we would also want it to work with POP3. Also some clients
	seemed to use something else as imap there..
	[3136aa09df05]

	* src/lib-storage/proxy-mail-storage.c:
	don't return values from void function
	[ee8fb7ab106f]

2003-12-25  Timo Sirainen  <tss@iki.fi>

	* Makefile.am:
	COPYING.MIT missing
	[f59cd148bdfe]

2003-12-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/auth-server-request.c:
	compiling fix
	[e3af1cf293ac]

2003-12-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/hash.c:
	bugfix
	[1bfe23d94647]

	* src/lib/hash.c:
	cleanup
	[54e60d63a942]

	* src/auth/auth-client-connection.c, src/auth/db-ldap.c, src/imap-
	login/client.c, src/imap/imap-thread.c, src/lib-index/maildir
	/maildir-sync.c, src/lib/hash.c, src/lib/hash.h, src/login-common
	/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-openssl.c,
	src/master/auth-process.c, src/master/login-process.c,
	src/pop3-login/client.c:
	Changed hash_foreach() to iterator.
	[1e6ed8045f2b]

2003-12-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	warning fixes
	[0613ad9d5034]

2003-11-25  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	LSUB should never show \HasChildren flags.
	[bbdce1697239]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	IMAP AUTHENTICATE and POP3 AUTH commands could have left the process
	stuck doing nothing forever.
	[07324c0d1d0a]

2003-11-21  Timo Sirainen  <tss@iki.fi>

	* doc/mkcert.sh:
	write dovecot.pem, not imapd.pem files.
	[3f85a4b7880e]

2003-11-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c:
	Bugfixes
	[e34c62503933]

	* src/lib-mail/message-send.c:
	message_skip_virtual() calculated returned msg_size wrong. This
	could have caused some problems with partial body fetches.
	[118ed97bd25a]

2003-11-17  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	Children/NoChildren -> HasChildren/HasNoChildren
	[66e5fdc07ac5]

2003-11-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-from.c:
	We didn't skip space between year and potential timezone
	[9ca9f997f0c6]

2003-11-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-sync-full.c:
	don't break if uidvalidity changes + cleanup
	[4c94ab0ff8de]

	* src/lib-index/mail-index.c:
	update lock counters with in-memory indexes too
	[75d86ebb844e]

	* src/master/master-settings.c:
	Always give error if flock is used with a system where it's not
	supported. The check was actually checking fcntl before..
	[de4b5d7ec9b2]

	* src/lib-index/mbox/istream-mbox.c, src/lib-index/mbox/mbox-sync-
	full.c:
	fixes
	[f901e8b9d2e3]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If mbox wasn't indexed yet when it was being renamed, an extra error
	message was logged.
	[61b80f9e6d87]

2003-11-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-file.c, src/lib/istream-mmap.c:
	cleanups
	[aa2341461620]

2003-11-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-sync-
	full.c:
	Fixed "LF not found where expected" error happening in some
	conditions.
	[01a83df6c232]

	* src/lib-mail/message-parser.c:
	wrong fix, reverted plus a cleanup..
	[841087a35d3e]

	* src/lib-mail/message-parser.c:
	When parsing message with CRLF headers, we stopped after CRLFCR
	instead of CRLFCRLF.
	[fe922b90ef08]

	* doc/auth.txt, dovecot-example.conf, src/auth/mech-cram-md5.c,
	src/auth/passdb.c, src/auth/password-scheme-cram-md5.c, src/auth
	/password-scheme.c:
	cram-md5 updates.
	[6d37e8554dbb]

2003-11-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-body-search.c:
	istream fix
	[435e7fc5093f]

	* src/lib-index/mbox/mbox-append.c:
	fix
	[9bbe17257bba]

	* src/auth/mech-cram-md5.c:
	Don't treat data as NUL-terminated string.
	[445fc3dfecad]

	* src/lib-index/mbox/mbox-rewrite.c:
	fix
	[c901f6afdc8d]

	* src/lib/istream-limit.c, src/lib/istream.c:
	fixes
	[4bff66d9b834]

	* src/auth/Makefile.am, src/auth/auth-client-interface.h, src/auth
	/auth-mech-desc.h, src/auth/md5crypt.c, src/auth/md5crypt.h,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech.c, src/auth/passdb.c, src/auth/passdb.h, src/auth
	/password-scheme-cram-md5.c, src/auth/password-scheme-md5crypt.c,
	src/auth/password-scheme.c, src/auth/password-scheme.h:
	CRAM-MD5 mechanism by Joshua Goodall, plus some cleanups.
	[ed5e808d934f]

	* src/lib-storage/index/index-messageset.c:
	cleanup
	[f83bf8214723]

2003-11-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	net_set_nonblock(): don't replace flags in fd, change the existing
	ones
	[638944ab7753]

	* src/imap/cmd-append.c, src/lib-index/mbox/istream-mbox.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-full.c, src
	/lib-mail/message-body-search.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/mail-save.c, src/lib/Makefile.am, src/lib
	/iostream-internal.h, src/lib/istream-data.c, src/lib/istream-
	file.c, src/lib/istream-internal.h, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream.c, src/lib/istream.h, src/lib
	/ostream-file.c:
	istream rewrite. instead of directly setting any limits to stream,
	you now have to use i_stream_create_limit() to existing stream. this
	should make the istreams much easier to create and understand how
	they work.
	[c972ea085643]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index.c:
	type fixes
	[39d0548792d8]

2003-11-08  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body-section.c:
	cleanups and fix for partial header fetching
	[e014a9df5fa6]

	* src/imap/imap-fetch-body-section.c, src/lib-mail/message-send.c, src
	/lib-mail/message-send.h:
	message_send()'s skip parameter was buggy with messages having CRLF.
	[d9d05fc3c905]

	* src/pop3/capability.h:
	Advertise PIPELINING capability
	[c6d327242fa6]

	* configure.in:
	cleanup
	[a0de7b3f133c]

	* doc/Makefile.am:
	securecoding.txt missing
	[b012ed1ab7e1]

	* src/lib/compat.c:
	whops, too many changes
	[d2f729d6f1e2]

	* src/lib/compat.c:
	pread/pwrite fixes
	[3b25ea70b500]

2003-11-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c,
	src/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-
	full.c, src/lib-mail/message-send.c, src/lib-storage/index/mbox
	/mbox-expunge.c, src/lib/istream-file.c, src/lib/istream-mmap.c,
	src/lib/istream.c, src/lib/istream.h, src/lib/ostream-file.c:
	Added istream->eof. istream->v_size is now set to 0 with files.
	[e42d97a85653]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c:
	we didn't sync mbox again after rewriting which left us broken mail
	offsets.
	[8da9b7748bd4]

2003-11-04  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-store.c:
	STORE .. FLAGS.SILENT will now return flags anyway if mailbox is
	read-only.
	[8636c61b3b5a]

2003-10-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c:
	fixes
	[f59f0c50f018]

	* src/lib-index/mbox/istream-mbox.c:
	fixes
	[34bdf8beb23a]

	* src/lib-index/mbox/mbox-sync-full.c:
	fix
	[ef870406de53]

	* src/lib-index/mbox/istream-mbox.c:
	fix
	[56cec02d8f8c]

	* src/lib-index/mbox/istream-mbox.c, src/lib/istream-file.c:
	fix
	[d4a2788f5fa6]

	* src/lib/istream.c:
	cleanup
	[0fd7dbda6704]

	* src/lib/compat.c, src/lib/compat.h:
	more kludgeing to get pread/pwrite working
	[29729fa90bb2]

	* configure.in, src/auth/Makefile.am, src/auth/passdb-bsdauth.c,
	src/auth/passdb.c, src/auth/passdb.h:
	Added bsdauth support, patch by Dan Cross
	[d66d53f57e43]

	* src/lib-storage/mail-save.c:
	removed debugging
	[e19d3d8632b7]

	* configure.in, src/lib-index/mail-cache.c, src/lib/compat.c,
	src/lib/compat.h, src/lib/istream-file.c:
	pread/pwrite fixes
	[83c635deda0b]

	* src/lib-index/mbox/istream-mbox.c, src/lib-index/mbox/mbox-index.c,
	src/lib-storage/mail-save.c:
	Fixes to make copying mail inside same mbox working.
	[8222937d4434]

	* src/lib/istream-file.c:
	Changed to use pread() with files.
	[920307c42b17]

	* src/lib/istream.c:
	reset stream_errno
	[f5d7407d33a0]

2003-10-26  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-copy.c, src/imap/cmd-search.c, src/imap/cmd-store.c,
	src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/imap-
	search.c, src/imap/imap-search.h, src/imap/imap-sort.c, src/imap
	/imap-thread.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h,
	src/lib-storage/proxy-mailbox.c, src/pop3/client.c,
	src/pop3/commands.c:
	Removed fetch_init/fetch_next from mail-storage. search_* makes it
	unnecessary
	[bd8b6ed35327]

	* src/lib-storage/index/index-messageset.c, src/lib-storage/index
	/index-messageset.h, src/lib-storage/index/index-search.c, src/lib-
	storage/mail-search.c, src/lib-storage/mail-search.h:
	Some optimizations to messageset handling in search.
	[4c2678dd65f1]

	* src/lib-index/mail-index.c:
	minor optimization
	[03f4b7b2641d]

	* src/imap/cmd-copy.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.h, src/lib-storage
	/proxy-mail.c:
	Moved copy() method from struct mail to struct mailbox - the context
	parameter makes sense only to destination mailbox handler.
	[b2ceea02ba60]

	* src/lib-index/mail-cache.c:
	cleanup
	[31e628d88253]

	* src/lib-index/mail-cache.c:
	missing t_pop()
	[cbe06afc6455]

	* src/lib/buffer.c, src/lib/buffer.h, src/lib/str.c, src/lib/str.h:
	Use unsigned char for buffer_append_c and str_append_c.
	[364b1e992154]

2003-10-23  Timo Sirainen  <tss@iki.fi>

	* src/lib/strfuncs.c:
	p_strndup() read str[max_chars] byte - could have possibly crashed
	in some rare conditions
	[6e834ae1da0e]

2003-10-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	Don't request empty headers
	[b730eeca8861]

	* src/lib-storage/index/index-mail-headers.c:
	assert
	[36ae8c2e5791]

	* src/lib-index/mail-cache.c:
	header fix
	[3dac992e11e0]

	* src/lib/ostream-file.c:
	removed unused #include
	[6cfa2a123b7e]

	* src/lib-storage/index/index-mail-headers.c:
	Don't save empty header lists
	[d951d5b883ec]

	* src/lib-index/mail-cache.c:
	assert
	[fece302386f4]

	* src/lib-index/mail-cache.c:
	compression could have broken header lists
	[e018d6b0a3df]

	* src/lib-index/mail-cache.c, src/lib-storage/index/index-mail-
	headers.c:
	Some cleanups and extra checks to detect if header names list gets
	duplicated (can happen, why?..)
	[27cc6681ea3e]

2003-10-20  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-digest-md5.c:
	recent change broke it
	[19e1ec244752]

	* src/lib-storage/index/maildir/maildir-storage.c:
	mail_create_mode was set too late.
	[7df3a022ef7d]

	* src/lib-storage/index/maildir/maildir-storage.c:
	fix
	[b1acbfe2a7ed]

	* src/lib-storage/index/maildir/maildir-storage.c:
	crashfix
	[a8f433bcffce]

	* src/lib-index/mail-index.h, src/lib-index/maildir/maildir-uidlist.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib/file-dotlock.c:
	fixed dovecot-uidlist permissions for shared mailboxes
	[ffd430238c32]

	* src/lib-index/mail-index.h, src/lib-index/maildir/maildir-index.c,
	src/lib-index/maildir/maildir-index.h, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-update-flags.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c:
	If maildir contains dovecot-shared file Dovecot does two things
	differently: it allows some flags to be private and stored only in
	index file (currently hardcoded to \Seen flag only) and new mails
	are created with dovecot-shared file's mode & 0666. So if you set
	filesystem permissions correctly, you should have fully functioning
	shared mailboxes.
	[1acb38d177cf]

	* src/lib/strfuncs.c:
	If input is empty, return only list with NULL.
	[cf9fa86e2a91]

	* src/lib-index/mail-cache.c, src/lib-index/maildir/maildir-uidlist.c,
	src/lib-index/mbox/mbox-lock.c, src/lib-storage/subscription-file
	/subscription-file.c, src/lib/file-dotlock.c, src/lib/file-
	dotlock.h:
	Added dotlock parameter to specify how old lock file has to be to be
	immediately deleted. This fixes the problem of never deleting
	uidlist.lock files.
	[7aff4dec4e9b]

	* src/lib/strfuncs.c:
	*_strconcat() bugfix
	[d623907c098a]

	* src/auth/mech.c, src/auth/userdb-static.c, src/imap/imap-fetch.c,
	src/lib-index/mbox/mbox-lock.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/mail-storage.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/master/main.c, src/master/master-settings.c:
	Added t_strsplit_spaces().
	[02bc3ef29b22]

	* src/lib-index/mbox/mbox-sync.c:
	mbox was always synced when mailbox was opened.
	[c9571aa175f8]

	* src/lib-index/mail-index.c:
	Sync stamps weren't updated always from header.
	[7826e88c5679]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-file.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h:
	We didn't notice cache compression immediately in other processes.
	Also some other bugfixes.
	[f8c343c3d283]

	* src/lib/file-dotlock.c:
	save errno in failures
	[af6c65fe9bf8]

2003-10-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/mmap-anon.c:
	MAP_FIXED didn't actually work the way I thought (should have looked
	the man page more carefully..). Dropped that and now we'll always
	just memcpy() the data when we want to grow a mmaping.
	[3045659c65d9]

2003-10-16  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c:
	Don't disconnect client immediately if there's an error in IMAP
	syntax.
	[b523a248424c]

	* src/imap/cmd-append.c:
	cleanup
	[cae2c9166bd0]

	* src/imap/cmd-copy.c:
	COPY: Don't crash if no mailbox is selected.
	[95d03c5a3a31]

2003-10-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	If there was multiple headers with same name, we stored only first
	one into cache.
	[caaeeda81d9d]

	* src/lib-index/mbox/istream-mbox.c:
	bugfixes
	[e3ce78c545f0]

2003-10-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/istream-mbox.c:
	bugfixes
	[2683523cc575]

	* src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c:
	BODY[HEADER] and RFC822.HEADER fetching was broken (why did it work
	before?..)
	[36d0e23dc231]

	* src/lib-index/mail-index-open.c:
	bugfix
	[54d7fb9e0b72]

2003-10-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c:
	bugfix
	[0ac9f72a84a8]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Strip trailing '/' from mail directory if given. Just makes it
	cleaner in log files.
	[2ef8e4ab3f03]

	* src/lib/compat.c:
	pread/pwrite doesn't move file offset. make our compat functions
	restore it
	[e86000107a45]

	* src/lib-index/mbox/mbox-rewrite.c:
	fix
	[4a61ab6c980d]

	* src/lib-index/mail-index-open.c, src/lib-index/mbox/mbox-rewrite.c:
	bugfixes
	[fef0b4df8383]

	* src/lib-storage/index/mbox/mbox-expunge.c:
	mbox expunging works again
	[fe13672d14b3]

	* src/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-
	full.c:
	mbox rewriting should work again..
	[9f25c3d7b378]

2003-10-03  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sort.c:
	Use data stack pool instead of temp_pool. Fixes sorting by subject.
	[eaf7de575156]

	* src/imap/imap-fetch-body-section.c:
	Partial BODY[header] or BODY[part] fetches were buggy if client
	requested more data than was available in the header/part.
	[69c2ec6d198b]

	* src/lib-imap/imap-base-subject.c:
	Allow using data stack pool with imap_get_base_subject_cased()
	[8cdd630e6b07]

	* src/lib-storage/index/index-mail-headers.c:
	get_header() returned values wrong
	[9d8ed97a807f]

	* src/lib-mail/message-date.c:
	Don't require timezone in Date-header.
	[e48b49aaeffc]

	* src/lib/fdpass.c:
	Put the msg/cmsg checks in CHECK_MSG() and CHECK_CMSG() macros. Add
	support for Linux 2.0 kernels by checking if LINUX20 is defined.
	[e1a7e38c17ed]

	* src/lib/compat.c, src/lib/compat.h, src/lib/mmap-util.c, src/lib
	/mmap-util.h:
	If we don't have function foo, do it always as #define foo my_foo
	and create your own my_foo. Did this to pread/pwrite/madvise.
	[82e19ad18784]

2003-09-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-storage/index/mbox/mbox-save.c:
	\Draft and \Deleted flags used opposite flag chars in X-Status
	header. We were incompatible with other mbox accessing software.
	[ccd30c24201a]

2003-09-24  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	Alignment fix
	[924d5279293b]

2003-09-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Fixes memory/fd leaking with INDEX=MEMORY.
	[b101e678e7ac]

	* src/lib-index/mail-index-open.c:
	Fixed potential file descriptor leaks
	[e71256caeff9]

2003-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c:
	Fix for leaking fds with non-writable .customflags files.
	[42d9cae286b5]

2003-09-21  Timo Sirainen  <tss@iki.fi>

	* doc/securecoding.txt:
	Secure coding guide for Dovecot.
	[6cb3cbf8c7c4]

	* configure.in, src/lib/data-stack.c, src/lib/mempool-alloconly.c,
	src/lib/mempool-system.c:
	Added support for Boehm GC. However it seems to be crashing for some
	reason with me..
	[49b6103dd2e0]

	* src/lib/strfuncs.c:
	cleanup
	[35f1682e311b]

	* src/lib/imem.c, src/lib/imem.h, src/lib/mempool.h:
	Make i_free(), p_free() and pool_unref() calls also set the given
	parameter to NULL.
	[0e72d6ab85ad]

	* src/lib/mempool.h:
	Removed pool leak checking stuff, it's not used.
	[46d2094ac470]

	* src/auth/auth-master-connection.c, src/auth/mech-digest-md5.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/passdb-pam.c, src
	/imap-login/client-authenticate.c, src/imap-login/client.c, src/imap
	/cmd-append.c, src/imap/cmd-sort.c, src/imap/imap-fetch-body-
	section.c, src/imap/imap-fetch.c, src/imap/imap-sort.c, src/imap
	/imap-thread.c, src/lib-charset/charset-utf8.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	quote.c, src/lib-index/mail-cache.c, src/lib-index/mail-modifylog.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-mail/message-address.c, src/lib-mail/message-body-search.c,
	src/lib-mail/message-header-decode.c, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/maildir/maildir-
	save.c, src/lib-storage/mail-search.c, src/lib/Makefile.am, src/lib
	/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-
	system.c, src/lib/mempool-unsafe-datastack.c, src/lib/mempool.h,
	src/lib/str.c, src/lib/strfuncs.c, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c:
	data_stack_pool split into two: unsafe_data_stack_pool which works
	like before, and a new one which verifies that stack frame stays the
	same whenever the pool is accessed.
	[2f3d906d99d8]

	* src/imap/imap-fetch-body-section.c:
	Compiler warning fix
	[986d5dac10c8]

2003-09-20  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	location defaulted only to default_mail_env, not userdb.
	[7ebd4bb20815]

2003-09-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Revert the mailbox/ == mailbox change after all. It broke LIST and
	it's not important really..
	[a027c8bac567]

2003-09-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Reverted mailbox == mailbox/ change, it applies to only dual-use
	mailboxes..
	[8edd874f53a3]

2003-09-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body-section.c:
	If client requests invalid body part, return it as NIL.
	[88744e967222]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Ignore hierarchy separator at the end of mailbox name.
	[850bf9389a73]

	* src/imap/cmd-create.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.h:
	CREATE mailbox/ with maildir now creates the mailbox instead of
	ignoring it.
	[99cf3e9393a6]

	* src/master/master-settings.c:
	missed
	[57bd9be0ecff]

	* src/imap/cmd-namespace.c, src/imap/namespace.c,
	src/imap/namespace.h, src/master/mail-process.c, src/master/master-
	settings.h:
	Added hidden-option to namespaces to hide them from NAMESPACE reply.
	[9547667cfa19]

	* src/master/mail-process.c:
	Support %vars in namespace prefix.
	[c5fa45f0ebf6]

2003-09-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	get_header() returned only first line of multiline headers
	[63254344ea0e]

	* src/lib-storage/index/index-mail-headers.c:
	Headers were returned twice sometimes
	[ba17c15b9b40]

	* src/lib-storage/index/index-mail-headers.c:
	compile fix
	[c2ba78db758e]

2003-09-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	We stored groups wrong in ENVELOPE.
	[115ffc7eaff5]

	* src/lib-storage/index/maildir/maildir-storage.c:
	treat ~ mailbox prefix as absolute path too
	[b04610627018]

2003-09-08  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	Missing spaces in ENVELOPE, BODY and BODYSTRUCTURE replies.
	[53e06e33393f]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c:
	Stop parsing cached headers when we've got everything.
	[6c0c2ff2c113]

	* src/imap/imap-fetch.c:
	Write envelope, body and bodystructure directly into output stream.
	[fbb28b07c60f]

	* src/lib/failures.c, src/lib/printf-upper-bound.c, src/lib/printf-
	upper-bound.h, src/lib/str.c, src/lib/strfuncs.c:
	Call printf_string_fix_format() only when
	printf_string_upper_bound() sees %m.
	[32bfcbe2a006]

	* src/lib/printf-upper-bound.c:
	minor speedup
	[520e3a0496db]

	* src/lib-imap/imap-date.c, src/lib-imap/imap-date.h:
	imap_to_datetime_offset() isn't needed. optimized imap_to_datetime()
	a bit.
	[3767595e9069]

	* src/lib-index/mail-cache.c:
	cleanup
	[7bbd17c237a4]

	* src/lib-index/mail-cache.c:
	minor speedups
	[25b42c124efd]

	* src/lib-storage/index/index-mail-headers.c:
	bugfix
	[81ebf6c81fc4]

2003-09-07  Timo Sirainen  <tss@iki.fi>

	* src/lib/buffer.c:
	minor optimizations
	[ebc6c417e6bc]

	* src/lib-index/mail-cache.c:
	Fixed memory leak after compressing cache file.
	[44b90c887345]

	* src/lib-storage/index/index-mail-headers.c:
	bugfix
	[d766c93ffb96]

	* src/auth/passdb-pam.c:
	Strict aliasing fix
	[934cb5f21751]

	* src/lib-index/mail-cache.c:
	Header fetching committed changes twice, now we don't commit changes
	when requesting a field which we know hasn't changed (pretty dummy
	logic, but works for this case). Continued rows were also counted
	wrong.
	[6830c31323c1]

	* src/lib/ioloop-internal.h:
	s/int/enum io_condition/
	[fff38df7f98f]

2003-09-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	whops, left extra stuff.
	[fd33cf8a1261]

	* src/imap/namespace.c, src/imap/namespace.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added "inbox" setting to specify which namespace has the INBOX.
	[4e14ba3c115b]

	* src/master/mail-process.c, src/master/master-settings.c:
	If location isn't given for namespace, use the default
	[9ce1e589d3c1]

	* src/imap/cmd-list.c:
	If LISTEXT is used and CHILDREN info isn't wanted, don't send it.
	[588326f1cd84]

	* dovecot-example.conf:
	comment changes
	[a1183185b013]

2003-09-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c:
	Include used-bit for all bytes in offsets to make sure their reads
	aren't only partial
	[72933c5c0b68]

2003-09-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mbox/Makefile.am, src/lib-index/mbox/istream-mbox.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-full.c, src
	/lib-index/mbox/mbox-sync.c, src/lib-mail/message-parser.c, src/lib-
	mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-storage/index/mbox/mbox-expunge.c:
	mbox reading is kind of working again. Just don't try rewriting or
	expunging :) Changing headers are also hidden from clients so mbox
	messages are finally seen immutable as required by IMAP.
	[7e3ce7515477]

2003-08-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Allow key=value without requiring space between key and '='
	[2a0220362d1b]

2003-08-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Support # comments also at the end of setting lines
	[37881cedb70d]

	* src/lib/safe-mkdir.c:
	comment updates. it's not possible to change the file mode if you're
	not the owner..
	[05427d8112ee]

	* COPYING, COPYING.MIT, src/lib/alarm-hup.c, src/lib/buffer.c,
	src/lib/compat.c, src/lib/data-stack.c, src/lib/env-util.c,
	src/lib/failures.c, src/lib/fd-close-on-exec.c, src/lib/file-lock.c,
	src/lib/file-set-size.c, src/lib/hash.c, src/lib/hex-binary.c,
	src/lib/hostpid.c, src/lib/imem.c, src/lib/ioloop-poll.c, src/lib
	/ioloop-select.c, src/lib/ioloop.c, src/lib/iostream.c, src/lib
	/istream-data.c, src/lib/istream-file.c, src/lib/istream-mmap.c,
	src/lib/istream.c, src/lib/lib-signals.c, src/lib/lib.c, src/lib
	/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-
	system.c, src/lib/mmap-anon.c, src/lib/mmap-util.c,
	src/lib/network.c, src/lib/ostream-file.c, src/lib/ostream.c,
	src/lib/process-title.c, src/lib/randgen.c, src/lib/restrict-
	access.c, src/lib/restrict-process-size.c, src/lib/safe-memset.c,
	src/lib/safe-mkdir.c, src/lib/sendfile-util.c, src/lib/str.c,
	src/lib/strescape.c, src/lib/strfuncs.c, src/lib/unlink-directory.c,
	src/lib/unlink-lockfiles.c, src/lib/utc-mktime.c, src/lib/utc-
	offset.c, src/lib/write-full.c:
	Removed most of the license comments from src/lib/*.c. It's just
	fine to keep them in a single COPYING.MIT file. Changed a few other
	comments as well.
	[9df02b1533b3]

	* src/lib/fdpass.c:
	Fix for IRIX (plus comment cleanups)
	[219b6e9e82f1]

2003-08-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/Makefile.am:
	missing .h files
	[c9026bb73dae]

2003-08-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/md5crypt.c:
	Removed strcat stuff and did some minor tweaks.
	[ec90bae6f20a]

	* src/master/mail-process.c:
	crashfix
	[b94a21f18a13]

	* src/master/master-settings.c:
	missing initializers
	[d55e7dfa9770]

	* src/master/master-settings.c:
	forgot mail_chroot
	[0b4b254cf726]

2003-08-24  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added mail_chroot setting to specify default chroot.
	[d83e16602418]

	* src/lib-storage/index/index-mailbox-check.c:
	fix
	[6c4a75f4e40c]

	* src/imap/cmd-idle.c, src/lib-storage/index/index-mailbox-check.c,
	src/lib-storage/index/index-storage.h:
	IDLE fixes..
	[9f89edcfc043]

	* src/master/master-settings.c:
	Don't crash if no protocols were given in config file
	[687a06278ef5]

	* src/imap/cmd-idle.c, src/imap/cmd-select.c, src/imap/commands-
	util.c, src/lib-storage/index/index-mailbox-check.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h,
	src/lib-storage/proxy-mailbox.c:
	IDLE uses now IO_*_NOTIFY to get instant notifying of mails.
	[8480f945e270]

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-internal.h,
	src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-none.c, src/lib
	/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	src/lib/ioloop.h:
	Added IO_DIR_NOTIFY and IO_FILE_NOTIFY conditions to io_add().
	IO_DIR_NOTIFY is now implemented for Linux dnotify.
	[5bf22d6bb65e]

	* dovecot-example.conf, src/lib-storage/index/index-messageset.c, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Added oe6-fetch-redundant-msgset workaround.
	[d1a6d9d24bd9]

	* dovecot-example.conf:
	added rawlog example
	[6d10ece6cf9f]

	* src/util/rawlog.c:
	fixes
	[f5e6f29731c4]

	* dovecot-example.conf, src/imap-login/client-authenticate.c, src
	/imap-login/client-authenticate.h, src/imap-login/client.c, src
	/imap-login/client.h, src/master/master-settings.c, src/pop3-login
	/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/client.h:
	disable_plaintext_auth defaults to yes now. ipv4 127.* and ipv6 ::1
	addresses are considered secure however and plaintext authentication
	is allowed from them.
	[cc0690f92d96]

	* src/master/auth-process.c, src/master/login-process.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Make sure auth process and login process don't share uids.
	[b3526668de78]

	* src/master/master-settings.c, src/master/master-settings.h:
	Reading global auth_* defaults didn't work
	[c090fc199013]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h:
	Added back compat_data[]. It wasn't so simple to access data
	portably in index files after all..
	[629eb2888e6d]

	* src/lib-index/mail-cache.h, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c:
	use int32_t instead of int in struct mail_sent_date
	[90f1068e2dea]

	* configure.in, src/lib-index/mail-index.h:
	Removed index_align stuff. It's not needed anymore.
	[a0dee56b280d]

	* src/lib-index/mail-index-file.c, src/lib-index/mail-index.c:
	expunge/append behaviour corrupted indexes
	[f25f90d8d24a]

	* src/lib-index/maildir/maildir-sync.c:
	comment update
	[43b4b59310d2]

	* src/lib-storage/index/index-mail-headers.c:
	Assert -> mark cache corrupted
	[443470f8e88b]

	* doc/dovecot-ldap.conf, doc/dovecot-pgsql.conf, src/auth/userdb-
	ldap.c:
	LDAP: Removed the system_user=uid defaulting. LDAP usually has only
	virtual users which don't exist in /etc/group. Clarified what the
	system user actually does for ldap/pgsql.
	[611c552a518c]

	* src/lib-index/maildir/maildir-index.c:
	Don't use microseconds in maildir name if it's not needed.
	[8bb3216773d6]

2003-08-22  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/lib-auth/auth-server-request.c, src/lib-
	index/mail-cache.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h:
	fixes. maybe it works now.
	[96dab004a87a]

	* src/auth/auth-client-connection.c:
	crashfix
	[6a1586f04640]

	* src/auth/auth-master-connection.c, src/auth/mech.c, src/auth/mech.h:
	fixes
	[2bc5207deb0e]

	* src/auth/auth-client-connection.c:
	fix
	[293ec0d24009]

	* src/lib-auth/auth-server-connection.c, src/lib-auth/auth-server-
	connection.h, src/lib-auth/auth-server-request.c:
	fixes
	[f1377239867e]

	* src/auth/db-ldap.c, src/auth/userdb-ldap.c:
	Give better error message if uid/gid not found from ldap and no
	default was set.
	[044fdf70f11a]

	* src/auth/auth-client-connection.c, src/auth/mech-anonymous.c,
	src/auth/mech-cyrus-sasl2.c, src/auth/mech-digest-md5.c, src/auth
	/mech-plain.c, src/auth/mech.c, src/auth/mech.h, src/auth/passdb-
	ldap.c, src/auth/passdb-pam.c:
	Fixed crash if login process connection died while there were some
	auth requests.
	[0731fc436585]

	* dovecot-example.conf, src/lib-auth/auth-server-request.c:
	We now support checking the password against all defined auth
	processes and use the one that matches.
	[ba70d60987e2]

	* src/lib-auth/auth-server-request.c:
	s/process/server/
	[cdf53841c4af]

	* src/auth/auth-master-connection.c, src/lib-auth/auth-client.c, src
	/lib-auth/auth-server-connection.c, src/login-common/main.c, src
	/login-common/master.c:
	bugfixes
	[5121567de516]

	* src/auth/db-ldap.c:
	fix
	[466ed9c67114]

	* src/master/auth-process.c:
	forgot
	[384037d89a12]

	* configure.in, src/Makefile.am, src/auth/Makefile.am, src/auth/auth-
	client-connection.c, src/auth/auth-client-connection.h, src/auth
	/auth-client-interface.h, src/auth/auth-login-interface.h, src/auth
	/auth-master-connection.c, src/auth/auth-master-connection.h,
	src/auth/auth-master-interface.h, src/auth/login-connection.c,
	src/auth/login-connection.h, src/auth/main.c, src/auth/master-
	connection.c, src/auth/master-connection.h, src/auth/mech-
	anonymous.c, src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	src/auth/mech.c, src/auth/mech.h, src/imap-login/Makefile.am, src
	/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap-login/common.h, src/lib-
	auth/.cvsignore, src/lib-auth/Makefile.am, src/lib-auth/auth-
	client.c, src/lib-auth/auth-client.h, src/lib-auth/auth-server-
	connection.c, src/lib-auth/auth-server-connection.h, src/lib-auth
	/auth-server-request.c, src/lib-auth/auth-server-request.h, src
	/login-common/Makefile.am, src/login-common/auth-common.c, src
	/login-common/auth-common.h, src/login-common/auth-connection.c, src
	/login-common/auth-connection.h, src/login-common/client-common.h,
	src/login-common/common.h, src/login-common/main.c, src/login-
	common/master.c, src/login-common/master.h,
	src/pop3-login/Makefile.am, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3-login/common.h:
	Moved client side code for auth process handling to lib-auth. Some
	other login process cleanups.
	[43815588dd6b]

	* src/auth/db-ldap.c:
	If LDAP connection closes, notify all requests that they failed.
	[a8502917689d]

2003-08-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mbox/mbox-index.c, src/lib-mail/message-part-serialize.c, src
	/lib-storage/index/index-mail.c:
	Removed some header/body size fields. We use only message_part now
	everywhere since it's small enough. virtual_full_size was left
	because we may know that by just reading maildir filename.
	[21b1cca4849b]

	* src/lib-mail/message-part-serialize.c:
	Serialized message_parts are now packed into smaller space.
	[e3cbf6d70899]

	* src/lib-storage/index/index-mail.c:
	bugfix
	[d77a282125b6]

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src
	/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	Message parsing can now be done in two parts - header and body.
	We're now more eager at parsing MIME structure for message. It's
	done whenever body has to be fully read (eg. rfc822.size).
	[ef79ce6507ff]

	* src/util/Makefile.am:
	Keep rawlog still in libexec/dovecot/ directory.
	[ad5be4c9cf09]

	* INSTALL:
	Removed --with-rawlog. It's built always now.
	[587f7911b93d]

	* configure.in, src/Makefile.am, src/imap/Makefile.am,
	src/imap/main.c, src/imap/rawlog.c, src/imap/rawlog.h,
	src/util/.cvsignore, src/util/Makefile.am, src/util/rawlog.c:
	Separated rawlog into it's own binary.
	[0fae24674a9a]

	* src/master/mail-process.c, src/master/master-settings.c:
	Allow one parameter for mail_executable.
	[552514c014cc]

2003-08-20  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c:
	We were posing as IMAP instead of POP3 to auth process.
	[e5e5ca4aa466]

	* src/lib-imap/imap-bodystructure.h:
	Removed unneeded code
	[1ad3218d7d08]

	* src/lib-imap/imap-bodystructure.c:
	removed unneeded code
	[cb40abe0ae28]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h, src/lib-mail/message-parser.c, src/lib-mail
	/message-parser.h, src/lib-storage/index/index-mail-headers.c, src
	/lib-storage/index/index-mail.c, src/lib-storage/index/index-mail.h:
	If BODY/BODYSTRUCTURE is requested with some other headers, parse
	the headers only once. If body contains multiple MIME parts, cache
	the internal MIME structure so BODY[part] fetching doesn't need to
	parse it again.
	[c07b98265577]

2003-08-18  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	auth_methods -> auth_mechanisms
	[72624cb9e4d6]

	* src/lib-index/mail-cache.c, src/lib-storage/index/Makefile.am, src
	/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	Changed how cached headers are stored. Previously when we added new
	headers, all the old headers were duplicated as well which wasted
	space. Also fixed several bugs in caching.
	[f5181233b04e]

	* src/lib-index/mail-cache.h, src/lib-index/mail-index.h:
	Removed NBO32_BIT* stuff
	[68258de0a00f]

	* src/lib/byteorder.c, src/lib/byteorder.h:
	Removed the NBO32_BIT* stuff. They don't work well with enums which
	are signed integers..
	[54a6dd88aedd]

	* src/lib/buffer.c:
	Inserting to end of buffer or past it didn't work
	[8ae128679e05]

2003-08-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c:
	crashfix
	[cc366700adfc]

2003-08-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sort.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/mail-storage.h, src/lib-storage/proxy-mail.c:
	Removed get_address() and get_first_mailbox() from mail interface.
	[1534976b029b]

2003-08-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-open.c:
	some opening fixes
	[174b0a707426]

	* src/lib-storage/index/index-mail.c:
	message parts were stored corrupted
	[6a5e548b47d8]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-compress.c, src
	/lib-index/mail-index-file.c, src/lib-index/mail-index-open.c, src
	/lib-index/mail-index.c:
	Support for upgrading from old index file with smaller header.
	[c47ff2e6e946]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-open.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-expunge.c, src/lib-index/maildir/maildir-
	sync.c, src/lib-index/maildir/maildir-update-flags.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync.c:
	Save sync stamp in index header rather than in file's mtime.
	[417558e2103e]

	* src/lib-index/mail-index-open.c:
	comment update
	[c53caaf84cb6]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index.h:
	Fixes for opening broken cache file.
	[3b8c4a370d86]

	* src/lib-imap/imap-util.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/maildir/maildir-build.c, src/lib-
	index/maildir/maildir-expunge.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-open.c, src/lib-index/maildir/maildir-sync.c,
	src/lib-index/maildir/maildir-uidlist.c, src/lib-index/maildir
	/maildir-update-flags.c, src/lib-index/mbox/mbox-index.c, src/lib-
	storage/index/index-update-flags.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/mail-storage.h:
	Maildir syncing works now without requiring base filenames to be in
	index cache file. Also message flag updates with +FLAGS and -FLAGS
	works correctly now if another client had just changed it's flags.
	[b5dc9acbbc9b]

2003-08-10  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-store.c:
	crashfix
	[b20ecf0cf8f6]

2003-08-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/Makefile.am:
	missing index-expunge.h
	[9a6425d70d83]

2003-08-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-copy.c, src/imap/cmd-fetch.c, src/imap/cmd-store.c,
	src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/imap/imap-search.c, src/imap/imap-thread.c, src
	/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	index/Makefile.am, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-custom-flags.c, src/lib-index/mail-
	index-compress.c, src/lib-index/mail-index-data.c, src/lib-index
	/mail-index-data.h, src/lib-index/mail-index-fsck.c, src/lib-index
	/mail-index-open.c, src/lib-index/mail-index-rebuild.c, src/lib-
	index/mail-index-update-cache.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/Makefile.am, src/lib-index/maildir/maildir-build.c,
	src/lib-index/maildir/maildir-expunge.c, src/lib-index/maildir
	/maildir-index.c, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-open.c, src/lib-index/maildir/maildir-
	rebuild.c, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/maildir/maildir-uidlist.c, src/lib-index/maildir/maildir-
	update-flags.c, src/lib-index/mbox/Makefile.am, src/lib-index/mbox
	/mbox-append.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox
	/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-index/mbox
	/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src/lib-
	index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-expunge.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/mail-search.c, src/lib-storage/mail-search.h, src/lib-
	storage/mail-storage.h, src/lib-storage/proxy-mailbox.c,
	src/pop3/client.c, src/pop3/commands.c:
	Index cache file rewrite. It's not finished yet and mbox support is
	completely broken. But it's getting difficult to maintain outside
	cvs :)
	[8920600a8cfc]

	* src/lib/byteorder.c, src/lib/byteorder.h:
	added nbo32_bitmasks[]
	[3c041da53757]

	* src/lib/Makefile.am, src/lib/byteorder.c, src/lib/byteorder.h:
	Added some network byte ordering functions and macros
	[cfaef4f27083]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Added pwrite() compatibility
	[a0dd52443420]

	* src/lib/file-dotlock.h:
	comment fix
	[644268046d59]

	* src/lib/istream-data.c:
	bugfix
	[293143677345]

	* src/lib/mempool-alloconly.c:
	reallocing clears memory unneededly since it's always already
	cleared
	[64bb8794ac15]

	* src/lib-imap/imap-bodystructure.c:
	Some message/rfc822 mails were returned as text/plain
	[e50e21588020]

	* src/lib-imap/imap-bodystructure.c:
	fix
	[60b5179d6131]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c:
	Don't write envelope as NIL into bodystructure even if it's broken.
	[4aca99baa9a4]

	* src/lib-mail/message-parser.c:
	"Content-Type: text" (without '/') didn't mark the message as
	containing text, which generated broken BODYSTRUCTUREs.
	[aff92c2de6f5]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-parser.c, src
	/lib-imap/imap-parser.h:
	Fixes for parsing BODYSTRUCTURE
	[566fb4bf7066]

2003-08-05  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	We should be checking C99 types using stdint.h, not inttypes.h
	[4076387f7ccb]

2003-08-03  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	If user's home dir doesn't exist, fallback to chdiring /tmp.
	[e7f5af0ae65d]

2003-08-02  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/utc-mktime.c:
	utc_mktime() crashed with 64bit time_t if gmtime() didn't like
	>32bit values
	[20519e4bca48]

2003-07-27  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	A bit more temporary kludging
	[a85af58a363c]

	* configure.in, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Namespace configuration.
	[6025913b581b]

	* src/imap/cmd-list.c, src/imap/cmd-rename.c:
	fixes
	[26e150912cc6]

	* src/imap/Makefile.am, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-append.c, src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap
	/cmd-create.c, src/imap/cmd-delete.c, src/imap/cmd-expunge.c,
	src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-list.c,
	src/imap/cmd-namespace.c, src/imap/cmd-rename.c, src/imap/cmd-
	search.c, src/imap/cmd-select.c, src/imap/cmd-sort.c, src/imap/cmd-
	status.c, src/imap/cmd-store.c, src/imap/cmd-subscribe.c, src/imap
	/cmd-thread.c, src/imap/cmd-unselect.c, src/imap/commands-util.c,
	src/imap/commands-util.h, src/imap/commands.c, src/imap/commands.h,
	src/imap/main.c, src/imap/namespace.c, src/imap/namespace.h:
	Getting ready for namespaces. LIST is still broken with them.
	[31c4bb26a1e9]

	* src/lib-storage/index/maildir/maildir-list.c:
	\Nochildren got lost again..
	[949ecc6c272b]

	* src/imap/main.c, src/lib-storage/index/maildir/maildir-list.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/pop3/main.c:
	Mail storages support now configurable namespace prefix and
	hierarchy separator. Subscription file handling needs some more
	thought.
	[193daadc3924]

	* src/lib/strescape.c:
	unescaping was broken
	[43fdcf8d9a0d]

	* src/imap/cmd-list.c, src/lib-storage/Makefile.am, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.h, src/lib-storage/mail-storage.h, src/lib-storage
	/mailbox-tree.c, src/lib-storage/mailbox-tree.h, src/lib-storage
	/proxy-mail-storage.c:
	API change: Mailbox list sorting must now always done by storage
	itself if it's needed.

	Maildir listing rewritten.
	[bc76e08a9c9d]

	* src/lib-imap/imap-match.c:
	Fixes for inbox case-insensitity matching
	[27f68eecfb35]

	* src/master/Makefile.am:
	compile fix
	[f9f7f69f345e]

2003-07-26  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib-settings/settings.c:
	Spaces are now stripped from end of line in config file. You can use
	" or ' quotes if you need them.
	[d6288ae1a71b]

	* src/pop3/client.c, src/pop3/common.h, src/pop3/main.c:
	Added pop3 hooks
	[a7c742b940e5]

	* src/imap/imap-expunge.c, src/imap/imap-expunge.h, src/lib-
	storage/index/index-expunge.h:
	forgot to add
	[c846d6735042]

	* src/lib-storage/Makefile.am, src/lib-storage/proxy-mail-storage.c,
	src/lib-storage/proxy-mail-storage.h, src/lib-storage/proxy-mail.c,
	src/lib-storage/proxy-mail.h, src/lib-storage/proxy-mailbox.c, src
	/lib-storage/proxy-mailbox.h:
	Added proxy classes for use with modules.
	[9ce620b10b28]

	* src/imap/client.c, src/imap/common.h, src/imap/main.c:
	hook changes
	[ca1c2972b78f]

	* src/imap/cmd-close.c, src/imap/cmd-select.c, src/imap/commands-
	util.c, src/imap/imap-fetch.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h:
	API changes: Don't keep variables in mailbox class.
	[72c6e848f583]

	* src/imap/client.c, src/imap/common.h, src/imap/main.c:
	Added hook_client_created and hook_mail_storage_created for modules.
	[6498f3cb9d2c]

	* src/imap/Makefile.am, src/imap/cmd-close.c, src/imap/cmd-expunge.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/index-expunge.c, src/lib-storage/index/index-mail.c,
	src/lib-storage/index/index-mail.h, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-update-flags.c, src/lib-storage/index/maildir
	/maildir-expunge.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage.h, src/pop3/client.c, src/pop3/commands.c,
	src/pop3/mail-storage-callbacks.c:
	API change for expunging messages. Not exactly what I wanted, but
	good enough.
	[db14aa8e2b5c]

2003-07-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-copy.c, src/imap/cmd-store.c, src/imap/imap-fetch.c,
	src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.h:
	Explicit lock() method for mailbox.
	[3621292209f4]

	* src/imap/client.h, src/imap/cmd-copy.c, src/imap/cmd-store.c,
	src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/mail-storage-
	callbacks.c, src/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mail.h, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h:
	API change for updating message flags.
	[e95c0e462591]

	* src/imap/cmd-copy.c, src/lib-storage/index/index-copy.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h:
	API change for copying messages.
	[a64391b49589]

	* src/lib-index/mail-modifylog.c, src/lib-index/mbox/mbox-sync-full.c,
	src/lib-index/mbox/mbox-sync.c:
	Mbox syncing / expunging fixes for previous expunge-commit.
	[20212920c795]

	* src/lib-index/Makefile.am, src/lib-index/maildir/maildir-rebuild.c:
	mail-tree.h no longer needed
	[400165502ee6]

2003-07-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/Makefile.am, src/lib-index/mail-index-compress.c, src
	/lib-index/mail-index-data.c, src/lib-index/mail-index-file.c, src
	/lib-index/mail-index-fsck.c, src/lib-index/mail-index-open.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-index
	/mail-modifylog.c, src/lib-index/mail-modifylog.h, src/lib-index
	/mail-tree-redblack.c, src/lib-index/mail-tree.c, src/lib-index
	/mail-tree.h, src/lib-index/maildir/maildir-rebuild.c, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-storage/index/mbox
	/mbox-expunge.c:
	Removed .imap.index.tree file. For now we'll just rewrite
	.imap.index file whenever there's expunges. "Expunge binary tree"
	might be added later, but it's not really useful until you have
	thousands of messages in mailbox and you're deleting old messages
	from it.
	[e3b88c16d544]

2003-07-18  Timo Sirainen  <tss@iki.fi>

	* autogen.sh:
	libtoolize --force
	[e0e691291c38]

	* src/lib-mail/message-date.c:
	Allow full month names, compare only the first 3 chars.
	[c5018f68752f]

2003-07-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	Don't crash if there's no domain in address
	[c2f5d02965ca]

2003-07-16  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	size_t checking fixes
	[e9e533b323fb]

	* src/login-common/main.c:
	Disable forking after setuid(), so Linux 2.6 is happy.
	[5bc8a5c718ca]

	* autogen.sh:
	Run libtoolize. Seems to fix newer auto* tools.
	[f1fae9ae2e27]

	* doc/nfs.txt:
	Updated, added ideas how to create better NFS indexes.
	[7992e3981b1b]

2003-07-15  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Get the size_t type properly in OSX
	[08b73ec005f8]

	* configure.in:
	bugfix
	[4f38b6de621a]

	* src/lib/file-dotlock.c:
	Minor speedup
	[b31688700d63]

	* configure.in:
	Delete conftest.mmap too
	[e31dbc7ca0da]

	* configure.in, dovecot-example.conf, src/imap/cmd-append.c, src/imap
	/cmd-copy.c, src/imap/cmd-select.c, src/imap/cmd-status.c,
	src/imap/common.h, src/imap/main.c, src/lib-index/mail-index-data.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-modifylog.c, src/lib-index/mail-tree.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/client.c:
	index_mmap_invalidate = yes now invalidate memory maps before
	accessing them. Setting this on should fix some problems with
	OpenBSD. It should also make it possible to use index files over NFS
	as long as lock daemon is used. It might be such a good idea
	however.
	[d22e03714d36]

	* doc/mkcert.sh:
	Quotes around echo
	[401f0c3a3aa2]

	* src/pop3/main.c:
	Added missing randgen initialization.
	[124a42f0be3a]

2003-07-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	Fixes for handling missing Mime-Version
	[5bdda4147b36]

2003-07-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/message-parser.c,
	src/lib-mail/message-parser.h:
	Ignore Content-* headers if there's no MIME-Version header. Note
	that this change breaks cached message parts in indexes.
	[149ade487f48]

	* src/master/auth-process.c, src/master/common.h, src/master/mail-
	process.c, src/master/main.c, src/master/master-settings.c,
	src/master/ssl-init.c:
	Replaced geteuid() calls with one in the beginning and saving it to
	master_uid. When chdir()ing to user's home dir, temporarily set euid
	to user's uid.
	[cc3cef25662c]

2003-07-12  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	We can't always chdir() to user's home directory if it's NFS-
	mounted. Ignore that error.
	[68352df8b24f]

	* dovecot-example.conf:
	Included comment about passwd+BSD requiring roots.
	[a8dc875a8918]

2003-07-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-from.c:
	Support numeric timezones in From-line
	[34f8651349bd]

2003-07-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-modifylog.c:
	compile fix
	[c7459707903d]

	* src/lib-index/mail-modifylog.c:
	DEBUG: crashfix when switching modify log
	[4624a21e1bbb]

	* configure.in:
	test -o and -a are apparently non-POSIX. not using.
	[fcc5d6bb6244]

	* dovecot-example.conf, src/auth/db-ldap.c, src/auth/db-pgsql.c, src
	/lib-settings/settings.c, src/lib-settings/settings.h, src/master
	/auth-process.c, src/master/common.h, src/master/login-process.c,
	src/master/login-process.h, src/master/mail-process.c, src/master
	/mail-process.h, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h, src/master/ssl-init.c:
	New configuration file code. Some syntax changes, but tries to be
	somewhat backwards compatible. SIGHUP now reverts back to old
	configuration if it detected errors in new one.
	[6850142c4e25]

	* configure.in:
	test -e isn't standard. Use test -c + -s for checking /dev/urandom.
	[5c2ad8ec50db]

2003-07-09  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	test -e /dev/urandom, not test -c. BSD/OS has it as a symlink to
	socket.
	[507de0e8d250]

	* src/imap/Makefile.am, src/pop3/Makefile.am:
	RAND_LIBS are needed nowadays for imap/pop3.
	[ec4d15b87491]

	* src/auth/master-connection.c:
	Crashfix if user's home directory wasn't given
	[7bc682625eaa]

	* src/lib-storage/index/index-search.c:
	Return BAD instead of NO errors with invalid message sets
	[92289fa71af4]

	* src/lib-mail/message-date.c, src/lib-storage/index/index-search.c:
	Still more timezone fixes
	[6a18854e6856]

2003-07-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/userdb-vpopmail.c:
	typo
	[88bca4f52f71]

	* src/auth/userdb-vpopmail.c:
	fix
	[c6babc7dae00]

2003-07-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	call index deinit properly
	[5d3d87ab83c1]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Destroy all unused indexes 10 seconds after use. Before we destroyed
	them only when opening a new index.
	[993fe64a5e20]

2003-07-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	updates for syncing comments
	[4c4d0d771350]

	* src/lib-storage/subscription-file/subscription-file.c:
	NFS-safe subscription file
	[d45c613e3b15]

2003-07-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/lib-index/mail-index-open.c, src/lib-
	index/maildir/maildir-uidlist.c, src/lib-index/mbox/mbox-lock.c,
	src/lib/file-dotlock.c, src/lib/file-dotlock.h, src/lib/randgen.c:
	Moved all dotlocking code to lib/. Also we now use temp file +
	link() rather than rely on working O_EXCL.
	[9f503b7851ab]

2003-07-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/unlink-lockfiles.c:
	fix :)
	[beab37ab1617]

	* src/lib/unlink-lockfiles.c, src/lib/unlink-lockfiles.h:
	some more cleanups
	[fc1fbedc3d4e]

	* src/lib/unlink-lockfiles.c, src/lib/unlink-lockfiles.h:
	Minor cleanups.
	[94df30426a96]

2003-07-02  Timo Sirainen  <tss@iki.fi>

	* doc/mail-storages.txt:
	We don't lose UIDs anymore if index is deleted.
	[19ef482ece51]

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added imap_max_line_length setting to config file.
	[8156b82727a8]

	* src/imap-login/client.c, src/imap/client.c, src/imap/cmd-append.c,
	src/imap/common.h, src/imap/main.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	parser.c, src/lib-imap/imap-parser.h:
	IMAP parser memory limits are now enforced by bytes per line rather
	than limiting maximum amount of tokens per line. Default is 64k now,
	which should help with the huge message sets generated by some
	clients.
	[6eca99b727a0]

2003-07-01  Timo Sirainen  <tss@iki.fi>

	* INSTALL:
	CPPFLAGS/LDFLAGS examples were missing -I / -L options..
	[6bf54ebc16af]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Expand ~/ from beginning of all paths. Added INBOX=<dir> support for
	maildir.
	[55431c7b6314]

	* src/lib/home-expand.c:
	home_expand(NULL) -> NULL
	[e0006f30b496]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c:
	mail_full_filesystem_access = yes fixes
	[c390d5ac3327]

2003-06-30  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-capability.c, src/imap/common.h, src/imap/main.c:
	Keep capability in string_t so plugins can modify it.
	[898a95426118]

2003-06-26  Timo Sirainen  <tss@iki.fi>

	* NEWS, README, TODO, configure.in:
	0.99.10 released
	[0b8260468474]

	* src/lib-index/maildir/maildir-index.c:
	INTERNALDATE fetching was broken
	[c7578350f135]

	* src/lib-index/maildir/maildir-sync.c:
	When assigning UIDs to mails, we tried to sort them with strcmp(),
	but that wasn't actually working. Also we now sort properly the
	mails that had unix timestamp older than 1 billion (Sep 9 2001).
	[e5bd44be3f5a]

	* dovecot-example.conf:
	Comment updates
	[498a9b7797f2]

	* src/lib-storage/index/mbox/mbox-list.c:
	Don't send \Unmarked in LIST reply unless mbox file is zero-sized.
	We can't get it right with atime checks, so don't even try.
	[3b853dad23e3]

	* INSTALL:
	Say something about CPPFLAGS and LDFLAGS.
	[a3de39b92838]

	* src/lib-storage/index/mbox/mbox-storage.c:
	When deleting directory, delete .imap dir under it first.
	[a0207c0adf7e]

	* doc/auth.txt, dovecot-example.conf, src/auth/passdb-pam.c:
	Using "*" as PAM service name now uses imap/pop3 service.
	[ab2fb3c6a12b]

	* INSTALL, src/imap/rawlog.c:
	~/rawlog -> ~/dovecot.rawlog
	[b3ae1757f921]

2003-06-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	Call waitpid() until no processes are left, instead of one per
	second.
	[f1711e0f7035]

	* src/imap-login/client.c, src/pop3-login/client-authenticate.c:
	Don't advertise STARTTLS/STLS capability when TLS/SSL connection is
	already established.
	[37c4985b7dc9]

	* src/master/mail-process.c:
	Better error message if UID/GID isn't valid.
	[9b5bcd7b1b5a]

	* src/auth/passdb-pam.c:
	Use "dovecot" service rather than "imap".
	[c0c503ad1cf7]

	* src/auth/mech-cyrus-sasl2.c:
	Compile fix (dunno if it works though)
	[e3d896a9487d]

	* src/imap-login/client.c:
	imap-login could get into infinite loop if connection was closed
	improperly.
	[1cadf76d7c4c]

	* src/lib-storage/index/index-mail.c:
	get_date() wasn't optimized by using cached ENVELOPE.
	[6ec903a5d333]

2003-06-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	More verbose bug reporting.
	[059c82e833b2]

	* src/imap/cmd-list.c, src/imap/cmd-status.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	quote.c, src/lib-imap/imap-quote.h:
	LIST and STATUS replies shouldn't strip tabs and spaces from mailbox
	names.
	[235f67c3cc9f]

	* src/lib-storage/index/index-messageset.c:
	Accessing messages in empty mailbox caused some crashes.
	[253967fa5b8a]

	* configure.in:
	fix for openssl detection
	[919f5aafbc6c]

	* configure.in:
	Check OpenSSL using pkg-config which at least redhat uses nowadays.
	[97572a77243a]

2003-06-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-tree-redblack.c, src/lib/module-dir.c,
	src/lib/network.c:
	Compiler warning fixes
	[e291bf36d57f]

2003-06-19  Timo Sirainen  <tss@iki.fi>

	* src/login-common/main.c:
	Set process count to 1 instead of 0.
	[1ffb486b0ca6]

	* src/auth/db-pgsql.c:
	If query fails with fatal failure, reconnect.
	[95e2fea24d06]

	* src/auth/passdb-pam.c:
	Fork new process for each PAM check. Not exactly fast, but we have
	to do it so we don't block when incorrect password is given. We
	could try reusing the processes though..
	[24dad210417f]

	* src/lib-mail/message-send.c:
	We were sending \0 instead of \r with non-x86 systems.
	[c83031137fdd]

	* src/lib-storage/index/maildir/maildir-copy.c:
	Hardlink copying crashed.
	[640196881ac6]

2003-06-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-quote.c:
	LWSP stripping with NUL/8bit chars set wrong literal size which
	broke things.
	[fa3c261d3556]

	* src/lib/randgen.c:
	Use RAND_bytes() rather than RAND_pseudo_bytes().
	[fa8322b3b7ec]

	* src/login-common/ssl-proxy-openssl.c:
	Make sure PRNG gets initialized before chrooting so it can open
	/dev/urandom.
	[545f6b150e2c]

2003-06-16  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	s/max_logging_users/login_max_logging_users/
	[b566a1ba703e]

	* src/lib/ioloop-select.c:
	compile fixes
	[13111b4073c4]

2003-06-15  Timo Sirainen  <tss@iki.fi>

	* TODO:
	updated
	[25cef50e3b0e]

	* src/imap/cmd-append.c, src/imap/cmd-capability.c, src/imap/cmd-
	copy.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-
	sort.c, src/imap/cmd-store.c, src/imap/cmd-thread.c, src/imap
	/commands-util.c, src/imap/commands-util.h, src/lib-index/mail-
	index-open.c, src/lib-index/mail-index.h, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-rebuild.c, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-index.h, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-status.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/mail-storage.h:
	Only NOOP and CHECK will now always do a real mailbox sync. Other
	commands will also do it but no often than once in 5 seconds. Also
	with maildir we don't anymore try to sync it before running commands
	since syncing is now done automatically whenever we try to access a
	file that doesn't exist.
	[bc3307f2f35d]

	* src/lib-index/maildir/maildir-update-flags.c:
	whops, don't commit debugging
	[313779bde3ec]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-expunge.c, src/lib-index/maildir/maildir-
	index.h, src/lib-index/maildir/maildir-sync.c, src/lib-index/maildir
	/maildir-update-flags.c, src/lib-storage/index/maildir/maildir-
	storage.c:
	Dirty maildir flags support works now.
	[e1b2614c9e16]

	* src/lib-storage/index/index-storage.c:
	Make sure we unlock index before unreferencing it, since it's not
	actually closed at that time
	[3620bfe9cb05]

	* src/auth/login-connection.c:
	We might have crashed if we ended up killing login processes with
	too old auth requests.
	[9e4129202417]

2003-06-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	"SEARCH DELETED" didn't return anything if all messages were
	deleted.
	[54764a1cde30]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Close index files before deleting the mailbox.
	[9c9ce9c71509]

	* src/lib/mkdir-parents.c:
	Check for EISDIR error as well. Fixed problems with BSD/OS.
	[9ce3f3f950c5]

2003-06-12  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-
	openssl.c:
	OpenSSL proxy changes - hopefully fixes something. Also don't crash
	with "key not found from hash" if SSL handshake fails.
	[ac6ee442376d]

2003-06-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c, src/lib-mail/message-size.c, src/lib-
	mail/message-size.h, src/lib-storage/index/index-mail.c:
	Removed useless parameters from message_get_body_size(). Also did
	some small optimizations to it.
	[7ac153f21949]

2003-06-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c:
	New index files were initialized wrong.
	[e3275092817e]

	* src/lib-index/mail-custom-flags.c:
	mbox with in-memory indexes don't have control_dir and doesn't need
	it, so don't crash then.
	[43ed38ee4415]

	* src/lib-index/maildir/maildir-index.c:
	assert
	[ef1bad8ec45c]

	* configure.in:
	Check dlopen() from libc before from libdl
	[c31852cc94f5]

	* src/imap/client.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c,
	src/imap/cmd-store.c:
	Give more verbose protocol level errors + some fixes.
	[4d1c65eded2c]

	* src/lib-imap/imap-bodystructure.c:
	Add charset/us-ascii into body/bodystructure replies if no charset
	is given for text/* body parts.
	[d4563a5ba30b]

	* src/lib-imap/imap-quote.c:
	Actually it should assume that beginning of string is LWSP..
	[09d4674b1d93]

	* src/lib-imap/imap-quote.c:
	imap_quote_append() shouldn't have checked previous string for lwsp
	[ec85645ad1d9]

	* src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c, src/lib-
	index/mail-index-update.c, src/lib-index/mail-index.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-mail/message-
	size.c, src/lib-mail/message-size.h, src/lib-storage/index/index-
	mail.c, src/lib-storage/mail-storage.h:
	IMAP protocol doesn't allow server to send NULs to client. Send
	ascii #128 instead.
	[676995d7c0ca]

	* src/lib-imap/imap-quote.c, src/lib-imap/imap-quote.h:
	imap_quote*() will now pack all LWSP into a single space and convert
	NULs to ascii 128.
	[76d44dda0f32]

	* src/lib-mail/message-parser.c:
	message_parse_header(): skip all LWSP after ':' or in continued
	header. It's not what RFC2822 says, but it's historically better
	behaviour.
	[d15bfc7cae1c]

	* src/lib-index/maildir/maildir-sync.c:
	Handle syncing better while uidlist is locked.
	[d8c58244a5e9]

	* src/lib/failures.c:
	Log using current time, not ioloop_time.
	[b922df9af4de]

2003-05-30  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init-openssl.c:
	was missing #ifdef HAVE_OPENSSL
	[edffbb824d96]

	* src/lib-storage/index/index-storage.c:
	Keep mailbox indexes cached for a while after they've been closed.
	Should speed up at least multiple APPENDs.
	[5e45e1cefb8d]

	* src/lib-storage/index/index-status.c:
	If we're asking only custom flags (eg. APPEND), don't do any mailbox
	syncing.
	[ec674fd47b2c]

	* src/auth/auth-module.c:
	Again RTLD_* fixes.
	[76c89608e4bb]

	* src/lib/module-dir.c:
	All systems don't define RTLD_GLOBAL and RTLD_NOW. Default them to
	0.
	[89aabeac23a3]

	* configure.in:
	dlopen wasn't actually checked from libc..
	[d3015271bb1f]

	* src/lib-index/maildir/maildir-sync.c:
	cleanup
	[626fc3f703a8]

	* src/lib-index/maildir/maildir-sync.c:
	expunges were broken
	[ea0cabfeba02]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Some fixes/cleanups for cases when maildir doesn't exist
	[4236ee2a4ac3]

	* src/lib-index/maildir/maildir-sync.c:
	comment update
	[bbfcb7174733]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-sync.c:
	Fixes for syncing mails that are kept in new/ dir.
	[237c7b872138]

	* src/lib-index/maildir/maildir-uidlist.h:
	Removed unused variable.
	[3720471597f7]

	* src/lib-index/maildir/maildir-sync.c:
	bugfix
	[5c69634f67c6]

	* src/lib-index/mail-index-data.c:
	mail_index_data_get_mmaped() didn't work with in-memory indexes
	[7457ebcf0518]

	* src/lib-index/maildir/maildir-sync.c:
	Use less memory
	[6842036f8931]

	* src/lib-index/maildir/maildir-sync.c:
	whops, removed debugging code
	[1c889e094fb5]

	* src/lib-index/mail-index.h, src/lib-index/maildir/maildir-sync.c,
	src/lib-index/maildir/maildir-uidlist.c, src/lib-index/maildir
	/maildir-uidlist.h, src/lib-index/maildir/maildir-update-flags.c:
	uidlist file is read/updated much less often now. did some other
	improvements for syncing as well.
	[f428ef9fc4d3]

2003-05-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-expunge.c, src/lib-index/maildir
	/maildir-update-flags.c:
	flag updates and expunge now set the cur/ dirty-synced to avoid
	extra sync after them.
	[2554c25f5519]

2003-05-28  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Check if dlopen is in libc too.
	[a4ad03c210af]

	* src/lib-index/maildir/maildir-sync.c:
	bugfix with a temporary kludge
	[f275115c6a1f]

	* src/imap/cmd-append.c:
	Fixed memory leak.
	[69261ad92783]

	* src/pop3-login/client-authenticate.c:
	STLS was missing from capability list.
	[64b8d6b2b457]

2003-05-27  Timo Sirainen  <tss@iki.fi>

	* src/pop3/commands.c:
	If mail didn't end with linefeed, we sent it wrong.
	[1fad8b3d7ef1]

2003-05-26  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/master/auth-process.c, src/master/login-process.c,
	src/master/mail-process.c:
	Allow first_valid_gid to be 0. Drop any supplementary groups not in
	valid gid range.
	[e7c627bacaaf]

	* src/lib-index/mail-index-util.c:
	more verbose error message for "lock timeout"
	[761bd2c8fefa]

	* src/lib/ioloop-poll.c:
	bugfix
	[637b21e11a72]

2003-05-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-poll.c:
	fix
	[6cfb4a7e7c1a]

	* src/lib/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c:
	bugfixes
	[4bff65d2a4b6]

2003-05-23  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init-openssl.c:
	wasn't supposed to be committed
	[98850f1c4ab9]

	* src/lib/ioloop-poll.c:
	Extra asserts
	[40b6118245b2]

	* src/auth/login-connection.c, src/auth/main.c, src/auth/master-
	connection.c, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/imap/client.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/subscription-file/subscription-file.c,
	src/lib/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/ostream-
	file.c, src/lib/ostream.h, src/login-common/auth-connection.c,
	src/master/auth-process.c, src/master/login-process.c, src/master
	/ssl-init-openssl.c, src/pop3-login/client.c, src/pop3/client.c:
	Removed I/O priorities. They were pretty much useless and were just
	getting in way.
	[e850252cdc7e]

	* src/imap/main.c:
	Minor speedup
	[5a247fb1673c]

	* src/lib/ioloop-poll.c:
	minor speedup
	[cdd898d549db]

	* src/lib/ioloop-poll.c:
	Clear old poll revents when removing the IO. Just extra sanity
	check.
	[aa1e8b09b580]

	* src/lib-mail/message-parser.c:
	Reset line->name and full_value* fields at end of headers. Envelope
	parser was treating the EOH as duplicate of last header.
	[4d358048e9d7]

2003-05-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	Fixed index corruption
	[2722aa2c152e]

2003-05-20  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Check that imap/pop3 module directories exist if they're enabled.
	Give a warning if module support is enabled in config file but not
	built into binary.
	[f2dbea57e997]

	* src/login-common/ssl-proxy-openssl.c:
	Generate temporary RSA key when requested. Could be slow, should do
	some caching in master process side..
	[383d87166963]

	* src/lib-index/mbox/mbox-from.c:
	Support From-lines which contain timezone in timestamp.
	[92fb0d55eee9]

2003-05-19  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	fixes
	[63242ba50ea4]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool.h:
	Added pool_get_name(), for debugging mostly.
	[826bed85c807]

	* src/lib-index/mbox/mbox-index.c:
	crahsfix
	[1263becf7cdb]

	* src/lib/ostream-file.c:
	fixes
	[ea32969a28b7]

2003-05-18  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	s/host/addr/ in variables
	[2f5b3da28dd9]

	* src/imap-login/client.c, src/lib/fd-close-on-exec.c,
	src/lib/network.c, src/lib/network.h, src/login-common/ssl-proxy-
	gnutls.c, src/login-common/ssl-proxy-openssl.c, src/master/mail-
	process.c, src/pop3-login/client.c:
	s/host/addr/ in a few network functions
	[8c28289a15a1]

	* src/master/mail-process.c:
	Send client's IP to mail process.
	[8b3e16678100]

	* src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib/Makefile.am, src/lib/compat.h, src/lib
	/mkdir-parents.c, src/lib/mkdir-parents.h:
	More robust error handling for mbox.
	[836c952e17ec]

	* src/lib-index/mail-custom-flags.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/maildir/maildir-sync.c, src/lib-index/maildir
	/maildir-uidlist.c, src/lib-index/maildir/maildir-update-flags.c:
	Some fixes to handling read-only maildirs.
	[4da66d98246c]

	* src/lib-index/mail-index.h, src/lib-index/maildir/Makefile.am, src
	/lib-index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	expunge.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-sync.c, src/lib-index/maildir/maildir-
	uidlist.c, src/lib-index/maildir/maildir-update-flags.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-expunge.c:
	Maildir syncing updates: it's now faster, it handles read-only
	folders, it handles many out of disk space conditions (uidlist
	doesn't) and all commands finally handle the condition when maildir
	filename was renamed after our syncing but before we had the chance
	to open it.
	[f59981f49782]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.c, src
	/lib-index/mbox/mbox-index.c:
	Misc. fixes.
	[135ac8354a8c]

2003-05-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/maildir/maildir-index.c, src
	/lib-index/maildir/maildir-index.h, src/lib-index/maildir/maildir-
	uidlist.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	index.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h:
	Maildir: CONTROL=<dir> in MAIL environment now specifies where to
	save .customflags and dovecot-uidlist files. This can be useful if
	the main mail directory is under hard quota.
	[6f5d7b43fe53]

	* src/lib/ostream-file.c:
	Automatically set file streams to blocking and don't try to io_add()
	them.
	[ce6521e4a191]

	* src/lib-storage/mail-save.c:
	If there's no limit in stream, don't fail with "unexpected EOF".
	[280e6d3772c9]

	* src/lib/ostream-file.c:
	Don't try to cork files.
	[6e2806114f44]

2003-05-16  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop.c:
	If there were no timeouts, struct timeval wasn't initialized and
	select() might have failed because of it. Patch by Mark E. Mallett.
	[474e4b205af7]

	* src/imap-login/client-authenticate.c:
	If client tries to do LOGIN even if it's disabled, send [ALERT] to
	user.
	[e0065ebba5b3]

	* src/imap-login/client-authenticate.c, src/imap-login/client-
	authenticate.h, src/imap-login/client.c, src/pop3-login/client-
	authenticate.c:
	Don't advertise AUTH=PLAIN in capability if disable_plaintext_auth =
	yes and SSL/TLS is not yet negotiated.
	[7709e997903f]

2003-05-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c:
	Reset the header using mmaped memory + msync, instead of lseek() +
	write() which was buggy with OpenBSD (didn't update the mmap).
	[74e28b26b4eb]

	* src/auth/master-connection.c, src/imap/commands.c, src/imap/imap-
	sort.c, src/lib-charset/charset-iconv.c, src/lib-charset/charset-
	utf8.c, src/lib-index/mail-index-update.c, src/lib-index/mail-
	modifylog.c, src/lib-index/mbox/mbox-index.c, src/lib-mail/message-
	part-serialize.c, src/lib/buffer.c, src/lib/buffer.h, src/lib/str.c:
	Renamed buffer_*_space() to buffer_*_space_unsafe() and added
	several warnings about using them. Fixed their usage in a few places
	in sources where they could have produced invalid results (no buffer
	overflows, luckily).
	[8f56379c3917]

2003-05-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-index.c:
	mboxes were always selected read-only
	[f5e7019f6c46]

	* src/auth/passdb.c, src/auth/userdb.c:
	AUTH_MODULES -> HAVE_MODULES
	[d274446d6fb8]

	* src/master/login-process.c, src/master/mail-process.c:
	fix
	[8b7f631a83c3]

	* configure.in:
	No, still no oracle here..
	[4bfaa07d1ff6]

	* src/lib/module-dir.c, src/lib/module-dir.h:
	missing
	[5ecbc9f82019]

	* INSTALL, configure.in, dovecot-example.conf, src/auth/Makefile.am,
	src/auth/auth-module.c, src/imap/Makefile.am, src/imap/main.c,
	src/lib/Makefile.am, src/master/Makefile.am, src/master/login-
	process.c, src/master/mail-process.c, src/master/mail-process.h,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3/Makefile.am, src/pop3/main.c:
	Added support for dynamically loadable imap/pop3 modules.
	[03dd87873a81]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-uid.c,
	src/imap/commands.c, src/imap/commands.h, src/imap/main.c:
	Added command_register() and related functions so we can dynamically
	register new commands.
	[bd489d13479e]

2003-05-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am:
	fix
	[fcc01d10868c]

	* configure.in, src/lib-index/maildir/Makefile.am, src/lib-
	index/mbox/Makefile.am:
	libstorage_index_* -> libindex_*
	[314a91d2761f]

	* src/imap/Makefile.am, src/pop3/Makefile.am:
	Dependency fixes
	[a7676687aac9]

	* src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/userdb-
	passwd.c:
	Don't check errno of getpwnam() and getspnam() functions. They don't
	seem to be set correctly in all systems and it's unlikely the error
	is anything else than "user doesn't exist".
	[88e6a4040955]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't give internal errors when trying to select, delete or rename
	(non-existing) mailboxes under mbox.
	[4b643fcae5c8]

2003-05-11  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Unexpected SSL connection errors sometimes crashed
	[98362534b2c7]

	* src/login-common/ssl-proxy-openssl.c:
	cleanups
	[7dd0e88ed7ef]

	* src/lib-storage/subscription-file/subscription-file.c:
	If we don't have access to write subscriptions file, say "permission
	denied" to user rather than internal error
	[616feacd6bd4]

2003-05-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	DELETE should report success to client even if it can't actually
	delete the folder, as long as it can rename it to "..dir".
	[4f7d146f6201]

2003-05-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-sync.c:
	We have to sync dovecot-uidlist before indexing mails in new/ dir or
	we'll get UID conflicts.
	[80f82c6a3250]

	* src/lib/unlink-directory.c:
	check lstat() error too
	[30e8a75d7842]

	* src/lib/unlink-directory.c:
	Returned errno was often wrong.
	[22495f001acc]

	* src/lib-storage/index/index-update-flags.c:
	No, actually it's valid for server to just ignore any non-permanent
	flag updates.
	[6de098ab4ef3]

	* src/lib-storage/index/index-expunge.c, src/lib-storage/index/index-
	update-flags.c:
	EXPUNGE should reply OK even if mailbox is read-only. STORE should
	use per-session flags, but we'll leave it as FIXME for now..
	[a9a512a5b388]

	* src/lib-index/mail-index-open.c:
	In-memory indexes didn't set index->opened.
	[393c4cf5260c]

	* dovecot.spec.in:
	Updates by Farkas Levente
	[6820c0caa0ae]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Give "Permission denied" error instead of internal error if some
	call fails with EACCES.
	[0d25b85dbe25]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-index/mbox/mbox-sync.c:
	Don't try to rewrite mbox file if it's read-only.
	[91bb57655d96]

	* src/imap/cmd-close.c, src/lib-index/mbox/mbox-index.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/mbox/mbox-
	storage.c:
	Some fixes to get read-only mboxes working.
	[e29bc94711e2]

	* src/auth/master-connection.c, src/master/mail-process.c:
	bugfix
	[3b9a09c18647]

	* doc/auth.txt, doc/dovecot-ldap.conf, doc/dovecot-pgsql.conf,
	src/auth/auth-master-interface.h, src/auth/db-passwd-file.c,
	src/auth/db-passwd-file.h, src/auth/master-connection.c, src/auth
	/userdb-ldap.c, src/auth/userdb-passwd-file.c, src/auth/userdb-
	passwd.c, src/auth/userdb-pgsql.c, src/auth/userdb.h, src/master
	/auth-process.c, src/master/mail-process.c:
	Chrooting changes. Now all userdbs will support
	"<chroot>/./<homedir>" style home directories.
	[c96290faa106]

	* src/lib-storage/index/mbox/mbox-list.c:
	Crashfix
	[e03d22a64fb0]

	* src/master/auth-process.c, src/master/login-process.c:
	If exec() fails, show the full path rather than argv[0]
	[a83ce8395316]

	* doc/auth.txt:
	Updated for ANONYMOUS
	[d11bd93bc098]

	* src/auth/userdb-passwd.c:
	Support wu-ftpd-like chrooting in /etc/passwd. If home directory
	ends with "/./", it's chrooted to.
	[ff6e38e890bf]

	* src/master/mail-process.c:
	We didn't log if chroot directory was invalid.
	[4b12d0d3bbd7]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-login-
	interface.h, src/auth/auth-mech-desc.h, src/auth/mech-anonymous.c,
	src/auth/mech.c, src/auth/mech.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added support for ANONYMOUS SASL mechanism.
	[c27c6089e933]

	* src/auth/mech-plain.c:
	hash.h not needed
	[18d85621dd17]

	* src/lib-mail/message-body-search.c:
	Content-Type wasn't actually set, which caused us to search non-text
	attachments which unnecessarily slows down things.
	[be028b4ce27c]

	* src/lib-storage/index/index-status.c:
	Don't crash with invalid first_unseen_uid_lowwater
	[a80b6837f088]

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY[HEADER.FIELDS ...] now doesn't crash to assert if header
	line contains NULs. IMAP spec actually forbids sending NULs to
	client, uw-imapd changes them to ascii 128. Currently we send them
	though, that requires some more fixing.
	[a07648daa625]

2003-05-07  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	Use ENOSYS rather than EINVAL for fd_send/fd_recv.
	[13c0031b2522]

	* src/lib-index/maildir/maildir-index.h, src/lib/ioloop-internal.h,
	src/lib/ioloop.h:
	struct timeval requires sys/time.h
	[8a2e1c539faf]

	* src/lib/mmap-util.c:
	remove compiler warnings if we declare madvise() as empty function
	[be6749ad05ad]

	* src/lib-storage/Makefile.am, src/lib-storage/index/Makefile.am, src
	/lib-storage/index/index-save.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/mail-save.c, src
	/lib-storage/mail-save.h:
	cleanup: message saving code isn't index-specific
	[5166b1e09f84]

	* src/lib/fdpass.c:
	Compile even if SCM_RIGHTS isn't supported.
	[5693bddad736]

	* src/lib/compat.c, src/lib/randgen.c:
	Use #warning only with GCC.
	[892b52f53e27]

	* src/lib/fdpass.c:
	Don't redefine _XOPEN_SOURCE_EXTENDED.
	[f5b3575194ed]

2003-05-05  Timo Sirainen  <tss@iki.fi>

	* Makefile.am:
	Keep dovecot.spec in tarball as well.
	[cb661e22730a]

	* src/imap/imap-fetch-body-section.c:
	partial->cr_skipped wasn't reset when changing message
	[d8f10cedbc48]

2003-05-04  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Don't try to set /dev/null fd nonblocking, all systems don't like
	that.
	[3e73d02e5f71]

2003-05-03  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	_still_ no oracle here.
	[b53a185eb4b3]

	* configure.in:
	Removed AM_CONFIG_HEADER accidentally
	[7594cb84e9c8]

	* configure.in:
	oracle wasn't supposed to be here yet
	[d6f5ef2247da]

	* .cvsignore:
	added dovecot.spec
	[94035404deed]

	* Makefile.am, NEWS, TODO, configure.in, dovecot.spec.in:
	0.99.9.1 released. Added redhat spec file.
	[c36d18766a35]

	* src/lib-imap/imap-envelope.c:
	imap_envelope_parse() didn't parse literals correctly.
	[6b925a429544]

	* src/pop3/client.c:
	Removed IMAP-specific comment..
	[36d7bec1da26]

	* src/pop3/client.c:
	Handle inconsistency error separately.
	[c1a7da406bbd]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c,
	src/lib-index/mbox/mbox-index.h:
	Rewrite Content-length header if it's broken. UID-validity change
	checking was broken when first message was added to empty mbox.
	[dcc9b7b868d8]

	* src/lib-mail/message-parser.c:
	We stopped parsing message if there was a line longer than input
	buffer (8192 bytes).
	[f9f69a6fdd63]

	* src/pop3/client.c:
	If no error is set, give "BUG: Unknown error" rather than try to
	print NULL which crashes in some systems.
	[ac714d7d0b67]

2003-04-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	Define _XOPEN_SOURCE only for IRIX.
	[027a528ebf01]

2003-04-28  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	0.99.9 released
	[ccb430d3b945]

	* src/lib/macros.h:
	Added __attr_scanf__
	[978cd1c0e6b0]

	* src/imap/commands-util.c:
	minor fix
	[29b56293067b]

	* doc/Makefile.am:
	Added dovecot-pgsql.conf
	[64e3e51001f5]

	* src/pop3/Makefile.am:
	Use STORAGE_LIBS.
	[02c192ea6f31]

	* src/lib/fdpass.c:
	AIX fix
	[fd9419b90b12]

2003-04-27  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/lib-index/Makefile.am:
	--with-storage=maildir,mbox can now be used to compile in only the
	wanted storage formats.
	[54015ae11177]

	* configure.in:
	fix
	[8d12b2a608c5]

	* src/lib-index/mbox/mbox-index.c:
	Use Content-Length: 0 too
	[f35c2472bb30]

	* src/lib/istream.c:
	i_stream_seek() broke stream if read limit was set.
	[5fe1597c6674]

	* src/lib/ioloop-internal.h:
	"invalid" no longer needed.
	[0c9fda55b4d6]

	* src/lib/ioloop-poll.c:
	Better handling for POLLNVAL.
	[c3c2754040ad]

	* src/login-common/main.c, src/master/login-process.c:
	Moved setting process limit after exec().
	[b2a2edafdd91]

	* src/lib/restrict-process-size.c:
	cleanup
	[f6ae4dc25427]

	* AUTHORS:
	update
	[47d79a08aebd]

	* doc/nfs.txt:
	updated
	[b7fa9a51611b]

	* configure.in, src/lib-index/mail-index-data.c, src/lib-index/mail-
	index-open.c, src/lib-index/mail-index-update.c, src/lib-index/mail-
	index.h:
	Use separate index alignment from memory alignment. We don't use
	pointers in index file so required alignmentation comes pretty much
	from sizeof(off_t).
	[059f13d577bb]

	* src/lib-index/maildir/maildir-uidlist.c:
	bugfix
	[c0d6ab3ee2d0]

	* doc/dovecot-pgsql.conf, src/auth/db-pgsql.c, src/auth/userdb-
	pgsql.c:
	Fixes and support for system_user, mail and chroot settings
	[55c9f99cdd3e]

	* src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c, src/lib-
	mail/message-send.c, src/lib-mail/message-send.h, src/lib-mail
	/message-size.c, src/lib-mail/message-size.h:
	Partial fetches were broken when they stopped between virtual CR and
	LF.
	[e0dbaabbc22b]

2003-04-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	Fix for IRIX
	[a7b1ec1ec8ba]

	* configure.in:
	mem_align test was broken
	[56f6dc5f3451]

	* configure.in:
	Use mem_align=4 with 32bit off_t
	[683a8202c037]

2003-04-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index.c, src
	/lib-index/mail-tree.c, src/lib-index/maildir/maildir-rebuild.c, src
	/lib-index/mbox/mbox-rebuild.c:
	Don't call msync() with with in-memory indexes.
	[dfa23fc2f370]

	* src/lib/fdpass.c:
	#ifdef _AIX, not AIX
	[5d16da99b537]

	* src/lib-index/mail-index-open.c:
	Compile fix
	[56d0608a4d17]

	* src/lib/mmap-anon.c:
	and disable debugging :)
	[8602e89a875c]

	* src/lib/mmap-anon.c:
	mremap_anon() was broken when it had to move data.
	[99e862a41b46]

	* configure.in:
	Don't define OFF_T_MAX if it's already defined
	[c4d519a6395d]

	* src/lib/mmap-anon.c:
	mmap(MAP_FIXED) may return ENOMEM as well as EINVAL if
	address+length isn't valid. Also some other cleanups.
	[8ef24a824568]

	* src/lib-storage/index/index-messageset.c:
	Fail if sequence numbers in messageset are out of range.
	[7dff693ab2b2]

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-open.c,
	src/lib-index/mail-modifylog.c, src/lib-index/mail-tree.c:
	Don't crash if mmap_anon() doesn't succeed.
	[42d30992c0a4]

2003-04-22  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-delete.c:
	allow deleting selected mailbox
	[bda297ecd516]

	* src/imap/commands-util.c:
	Give BAD instead of NO when trying to use selected state command in
	non-selected state.
	[b0f075271b2f]

	* src/lib-storage/index/index-search.c:
	More SEARCH OR fixes.
	[1664a3d51a74]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.c:
	SEARCH OR fixes.
	[a3521f4ca773]

	* src/lib-imap/imap-date.c, src/lib-mail/message-date.c:
	Still some timezone fixes
	[008f837263f3]

	* src/lib-index/maildir/maildir-sync.c:
	bugfix
	[9284e4e3d967]

2003-04-21  Timo Sirainen  <tss@iki.fi>

	* src/auth/mycrypt.c, src/lib/fdpass.c:
	AIX fixes.
	[7a7e58744e0a]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-save.c:
	fsync() saved mails
	[b73c2bdd12d0]

	* src/lib-index/mail-index.h, src/lib-index/maildir/maildir-sync.c,
	src/lib-index/maildir/maildir-uidlist.c, src/lib-index/maildir
	/maildir-uidlist.h:
	Use mtime to check changes in dovecot-uidlist file rather than inode
	changes which aren't reliable.
	[5f521a721671]

2003-04-17  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	We got dotlock's mtime before modifying it, which caused problems
	sometimes.
	[945f857cb514]

2003-04-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c:
	Don't set any default cache_fields when building index into memory.
	[33cf08305781]

	* src/master/mail-process.c, src/master/main.c:
	chdir() to base_dir at startup. chdir() mail processes to home dir
	if it's known.
	[533bb936e674]

	* src/lib-index/maildir/maildir-rebuild.c:
	Don't crash if there's tree file hasn't been opened yet.
	[b2005542fc93]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-tree.c, src/lib-
	index/mail-tree.h, src/lib-index/maildir/maildir-rebuild.c, src/lib-
	index/maildir/maildir-sync.c:
	Some fixes to opening index.
	[6f65cc862649]

	* src/pop3/main.c:
	cleanup
	[33426716797a]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/main.c:
	Crashfix if there was some errors while opening mailbox
	[383e4b9e347c]

	* src/lib-index/maildir/Makefile.am, src/lib-index/maildir/maildir-
	build.c, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-update.c:
	If we don't want to precache anything, don't open the file at all
	when building index.
	[085c5b7a69ad]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	passwd-file fixes. passdb ignores now fields after password, so it
	can work with shadow-like file.
	[dc2163fafa70]

	* src/lib-index/mail-index.c:
	DEBUG: Don't crash with in-memory indexes
	[5c67f77e4116]

2003-04-15  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	Use different warning message for dotlock mtime change.
	[bbcbe27926ad]

	* src/master/common.h, src/master/login-process.c, src/master/mail-
	process.c, src/master/mail-process.h, src/master/main.c:
	Separate PROCESS_TYPE_MAIL into IMAP and POP3.
	[70b60399c7d3]

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY[HEADER.FIELDS ...] crashed
	[5986d8920b86]

2003-04-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-storage/index/mbox/mbox-save.c:
	More optimized mbox rewriting. It now tries to shrink/extend the
	filler in x-keywords header.
	[026ae7f33d61]

	* src/lib-index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	storage.c:
	Don't crash if there was locking problems when trying to rewrite
	mbox.
	[96e28b964269]

2003-04-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c:
	mmap_used_length should be updated too when data is appeneded
	[50d1902b4928]

	* src/lib-index/maildir/maildir-sync.c:
	minor cleanup
	[bde1b4fb2852]

	* src/lib-index/maildir/maildir-sync.c:
	Expunging mails broke syncing
	[f447f121fbe5]

2003-04-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/lib/ioloop.c, src/pop3/main.c:
	minor memory leak/cleanup fixes
	[6709d9330885]

	* src/lib/mempool-alloconly.c:
	p_clear() left only the smallest block, not the largest block
	[68544dbee475]

	* src/lib/failures.c:
	Free memory at exit
	[3bd74a1326c9]

2003-04-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	a bit memory allocation tweaks
	[883ba6a7db44]

2003-04-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	Don't index new mails in cur/ if we don't have uidlist.lock
	[80bd51c7d60f]

	* src/lib-index/maildir/Makefile.am:
	missing maildir-uidlist.h
	[6fa223de19f9]

	* src/lib/ostream-file.c, src/lib/sendfile-util.c:
	Call safe_sendfile() only with sockets, and also with files under
	Linux. Hopefully helps for signal 12 under FreeBSD.
	[04b81672c3a3]

	* src/lib-index/mail-index.h:
	We don't need these fields
	[2dcd8cebe5e6]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/Makefile.am, src/lib-index/maildir/maildir-
	build.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-
	rebuild.c, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/maildir/maildir-uidlist.c, src/lib-index/maildir/maildir-
	uidlist.h, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h:
	Rewritten maildir syncing. Uses dovecot-uidlist file to store UIDs
	permanently.
	[e80c784252ea]

	* src/lib-imap/imap-envelope.c:
	Don't crash if mail doesn't have any headers.
	[f1dc24e5bc0f]

	* configure.in:
	use test -c for checking /dev/urandom. test -e doesn't work in
	solaris.
	[fe6f252a389f]

	* src/lib-storage/index/index-messageset.c, src/lib-storage/index
	/index-search.c:
	s/latest IMAP4rev1 draft/RFC-3501/
	[087a9f4304ca]

2003-04-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-passwd-file.c:
	default is CRYPT, not DES (which doesn't even exist)
	[379509d0c196]

	* src/lib/fdpass.c, src/master/login-process.c:
	Tru64 fixes. More comments.
	[04ed7a2536cc]

2003-04-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c:
	hardlink copying was broken again
	[0f2e0b39a747]

2003-04-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/randgen.c:
	compilefix
	[adca691bd671]

	* configure.in, src/auth/Makefile.am, src/lib/randgen.c:
	Support using OpenSSL's pseudo-random generator instead of
	/dev/urandom. If neither are found, allow dovecot-auth still to be
	started because currently only DIGEST-MD5 requires prng.
	[5ad84c54eb7e]

	* src/imap/imap-fetch-body-section.c:
	compile warning fixes
	[968c9d53506a]

	* Makefile.am:
	config.rpath was missing
	[1fa88503bbe6]

	* src/lib/fdpass.c:
	Compile fix for tru64
	[f2f3fe0916c1]

	* src/auth/md5crypt.c, src/auth/md5crypt.h, src/auth/password-
	scheme.c:
	MD5crypt password fixes.
	[d55cf9c28062]

2003-04-02  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-pgsql.conf, dovecot-example.conf, src/auth/db-ldap.c,
	src/auth/db-pgsql.c, src/auth/db-pgsql.h, src/auth/mech-digest-
	md5.c, src/auth/mech-plain.c, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb-pgsql.c, src/auth/userdb-pgsql.c, src/master/auth-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Moved auth_username_chars from db-pgsql to generic for all. Some
	other auth code cleanups.
	[7cde19dbe754]

	* src/imap/cmd-list.c, src/imap/cmd-status.c, src/lib/strescape.c,
	src/lib/strescape.h:
	Mailbox names are now sent through imap-quoter instead of just
	escaping it. This means that mailbox names that would require
	escapes are instead sent as literals now.
	[ae229b7acb4c]

	* dovecot-example.conf, src/auth/mech-digest-md5.c, src/auth/mech-
	plain.c, src/auth/mech.c, src/auth/mech.h, src/master/auth-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added auth_default_realm (based on patch by Kristian Hoffmann)
	[0a524d229f50]

2003-04-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	crashfix
	[36ba64c5dbb2]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-parser.c:
	crashfix
	[baf63e166aeb]

2003-03-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-
	compress.c, src/lib-index/mail-index-data.c, src/lib-index/mail-
	index-util.c, src/lib-index/mail-modifylog.c, src/lib-index/mail-
	tree.c, src/lib-index/maildir/maildir-index.c, src/lib-storage/index
	/index-save.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/mbox/mbox-save.c, src/lib/compat.h:
	Handle EDQUOT errno as "not enough disk space" like ENOSPC.
	[e026f8e4d241]

2003-03-29  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	rewrite, maybe it works properly now.
	[13d8f69d4f1a]

2003-03-26  Timo Sirainen  <tss@iki.fi>

	* doc/nfs.txt:
	updated
	[c0ecdcaca2a6]

	* src/imap/imap-fetch-body-section.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	envelope.h, src/lib-imap/imap-quote.c, src/lib-index/mail-index-
	update.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	index.h, src/lib-index/mbox/mbox-rewrite.c, src/lib-mail/message-
	body-search.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-save.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/mbox/mbox-save.c:
	Better handling for multiline headers. Before we skipped headers
	larger than input buffer size (8k with read (default), 256k with
	mmap). The skipping was also a bit buggy.

	Now we parse the lines one at a time. There's also a way to read the
	header fully into memory before parsing it, if really needed.
	[97f8c00b8d4c]

	* src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	imap/imap-quote.c, src/lib-imap/imap-quote.h, src/lib-index/mail-
	index-update.c, src/lib-storage/index/index-mail.c:
	memory usage fixes
	[1a5705eb23d4]

	* src/lib/data-stack.c:
	When data stack grew larger than two blocks, t_pop()ing crashed when
	trying to free extra blocks.
	[e9e08440df77]

	* src/lib-storage/index/index-mail.c:
	fix extra memory usage
	[233eb6e394bb]

	* dovecot-example.conf:
	Removed default auth_chroot directory from digest-md5 case. If you
	really want it, you know where to set it.
	[d041581ddebf]

	* INSTALL:
	s/imap-master/dovecot/
	[8cdbade3c75f]

	* src/imap/main.c:
	Support for mailfront.
	[02dc0b35af64]

2003-03-24  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY[part]<partial> didn't work correctly
	[d69f8b4adaf6]

2003-03-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/lib.c:
	compile warning fix
	[bd8e8495c7b3]

2003-03-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-util.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib/file-dotlock.c, src/lib/lib.c:
	Call the hostpid_init() always at startup. Easier than doing it all
	around.
	[c4fa748b9f24]

	* src/lib/istream-internal.h, src/lib/istream.c:
	Fixes for resetting stream limits. Should fix some APPEND problems.
	[c893ba64db07]

2003-03-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c:
	Literals didn't work if they weren't the last argument.
	[dab8da005325]

	* src/imap/cmd-list.c, src/lib-storage/index/maildir/maildir-list.c:
	More kludgy LIST fixes for maildir subfolders
	[f0ae8979b0ab]

	* src/imap/cmd-list.c:
	LIST "" foo.% doesn't anymore reply "foo." folder.
	[326e0826467c]

	* src/lib-imap/imap-parser.c:
	We didn't stop after reading literal size. This broke using non-
	synced literals with APPEND.
	[f19fbca465fb]

2003-03-19  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-pgsql.conf:
	forgot to add
	[e360dc131150]

2003-03-18  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body-section.c:
	Partial body fetches were buggy
	[a36ab9657f52]

2003-03-17  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	file offset wasn't kept right.
	[06e9bb095cb3]

	* src/imap/Makefile.am, src/pop3/Makefile.am:
	more fixes..
	[f363925f2f45]

	* src/imap/Makefile.am, src/pop3/Makefile.am:
	iconv fixes
	[7930081ae331]

	* src/imap/cmd-select.c:
	Whops, test reverted back.
	[7fe3ad564eac]

	* src/lib/fd-close-on-exec.c:
	Don't assume that major() and minor() are unsigned ints.
	[cf06c49f6d87]

	* config.rpath, configure.in, src/imap/Makefile.am, src/imap/cmd-
	select.c, src/lib-charset/charset-iconv.c, src/lib-charset/charset-
	utf8.c, src/pop3/Makefile.am:
	Better iconv() checking.
	[952bf533c2ea]

2003-03-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-passwd-file.c:
	Fixes to parsing userdb fields.
	[e7ece7cfb14c]

2003-03-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Renaming maildir subfolders inserted extra "." in the middle.
	[c2935bbfd399]

	* src/auth/passdb.c, src/auth/userdb.c:
	cleanups
	[1bab80054775]

2003-03-14  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-pgsql.c, src/auth/db-pgsql.h, src/auth/passdb-pgsql.c,
	src/auth/userdb-pgsql.c:
	Whops, forgot to add.
	[a9ac5865daf8]

	* dovecot-example.conf:
	updated first_valid_uid comment
	[cc9b61b9959e]

	* src/master/mail-process.c:
	"mail process isn't allowed to use UID %s (modify first_valid_uid in
	config file)"
	[9f8a41f1edae]

2003-03-10  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-passwd-file.c, src/lib-settings/settings.c,
	src/lib/istream.c, src/lib/istream.h:
	Added i_stream_read_next_line()
	[2f2c6335ed6d]

2003-03-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-index.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-open.c, src/lib-
	index/maildir/maildir-sync.c:
	cleanup
	[359334706e65]

	* src/lib-storage/index/mbox/mbox-list.c:
	mbox: LIST "" invalid-directory/% doesn't anymore give internal
	error
	[ddb4ebbf32a9]

	* src/imap/cmd-create.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.h:
	mbox: CREATE mailbox/ now mkdir()s it.
	[9562ba6af1f1]

	* src/lib-storage/index/index-fetch.c:
	FETCH: \Seen flag updating didn't work (eg. FETCH BODY[]).
	[c6c7867b2f6f]

	* src/lib-imap/imap-parser.c:
	Literal parser broke if \r\n wasn't in buffer at the time '}' was
	parsed.
	[fa47d787c2aa]

2003-03-07  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	pgsql check fixes
	[38b7fe3a596e]

	* configure.in:
	cleanup
	[b8ecb067141a]

	* src/auth/userdb-vpopmail.c:
	Log vpop_user + vpop_domain too. They may be different from original
	username after parse_email()..
	[89d6b54b203a]

	* configure.in, src/auth/Makefile.am:
	cleanups
	[71f61b6a0f02]

	* INSTALL, configure.in, doc/auth.txt, doc/dovecot-ldap.conf, dovecot-
	example.conf, src/auth/Makefile.am, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb.c, src/auth/userdb.h:
	Added PostgreSQL support, patch by Alex Howansky
	[2d8af547a8b4]

2003-03-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c, src/auth/db-ldap.h:
	Added ldap_version setting.
	[e8894f2c776f]

	* src/imap-login/client.c, src/login-common/main.c:
	We didn't work at all in non-inetd mode. Also fix crash when
	quitting.
	[043b71a06568]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-index.c, src/lib-index/mbox/mbox-append.c, src
	/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src
	/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c:
	UIDs are now saved into mbox file. added a few rewriting
	optimizations so that we don't always have to rewrite the whole file
	when updating messages at the beginning of file.
	[2ea9661542ee]

2003-03-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	message_address_write() didn't work.
	[b14d1f375039]

	* src/lib-mail/message-address.c:
	message_address_parse(): allow using data_stack_pool
	[4d6c72dc34db]

	* src/lib-storage/index/index-save.c, src/lib-storage/index/index-
	storage.h:
	Compiler warning fixes.
	[c5c17b45cceb]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	index.c:
	Added index->append_abort() to abort append cleanly.
	[3607a2b4f011]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/login-common/Makefile.am, src/login-common
	/auth-connection.c, src/login-common/client-common.h, src/login-
	common/main.c, src/login-common/master.c, src/login-common/master.h,
	src/master/login-process.c, src/pop3-login/client.c,
	src/pop3-login/client.h:
	login: Wait until we're connected to auth process before executing
	command from client.

	inetd usage: --group=name can now specify which login group to use.
	Default is the binary name before '-' character (ie. imap or pop3).
	[af685269ead0]

2003-03-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-save.c:
	Don't crash if something tries to write 0 bytes in headers while
	saving the message. This happened sometimes with mbox.
	[f7fc5d52ac7c]

	* src/login-common/Makefile.am, src/login-common/main.c, src/login-
	common/master.c, src/login-common/master.h, src/master/auth-
	process.c, src/master/common.h, src/master/login-process.c,
	src/master/mail-process.c, src/master/main.c, src/master/master-
	login-interface.h:
	Somewhat working code to support loading Dovecot from inetd and
	such. It still needs possibility to specify which login process to
	use, and LOGIN and AUTHENTICATE commands shouldn't be allowed before
	we're connected to auth process.
	[2cf2e08a6ee9]

	* src/auth/master-connection.c:
	Don't crash if auth request wasn't found.
	[634b5ef110da]

	* src/lib/env-util.c, src/lib/env-util.h, src/lib/restrict-access.c,
	src/lib/restrict-access.h:
	Removed restrict_access_clean_env() and env_remove(). They're not
	needed.
	[0ca6dfe196f1]

	* src/lib/failures.c:
	Handle /dev/stderr directly instead of open()ing.
	[00707938a332]

	* src/lib/fd-close-on-exec.c:
	More verbose error message when leaked fd is noticed.
	[dad400966e72]

	* src/auth/main.c, src/lib/network.c, src/login-common/auth-
	connection.c, src/login-common/ssl-proxy-gnutls.c, src/login-common
	/ssl-proxy-openssl.c, src/master/auth-process.c, src/master/main.c:
	net_* functions don't anymore set sockets to non-blocking by
	default.
	[0d9f0e617a1a]

	* src/lib-imap/imap-quote.c:
	Use literals for strings containing '"' and '\' characters too. This
	wasn't done at all before so FETCH ENVELOPE, BODY and BODYSTRUCTURE
	could have returned pretty broken results.
	[8ceacaf13c9c]

2003-03-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Selecting INBOX didn't use index files if full_filesystem_access was
	yes.
	[4cc2a05c5c88]

2003-03-01  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Setting user_global_uid or user_global_gid crashed.
	[fd2ccb3d67e4]

2003-02-27  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c, src/lib-storage/index/maildir/maildir-list.c:
	Maildir LIST \Children fixes.
	[69642d55545d]

	* src/lib/safe-mkdir.c:
	safe_mkdir(): usage fchmod() and fchown(). chmod() wasn't really
	safe and lchown() wasn't portable.
	[500ec0ec3b85]

2003-02-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-plain.c:
	Invalid PLAIN auth request crashed auth process.
	[7767e5b3e83e]

	* src/master/main.c:
	[::] address wasn't treated exactly as "ipv6 any", but looks like
	gethostbyname() worked with it.
	[5373999355ed]

	* src/master/main.c:
	Added --version
	[e6e81ce8210b]

	* doc/nfs.txt:
	updated
	[3be1497e09b9]

	* doc/index.txt:
	update
	[8672f9897066]

2003-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	final fix: text-content subtype wasn't defaulted to plain
	[cee5e11b08f3]

	* configure.in:
	0.99.8 released
	[cb1782907902]

	* src/lib-imap/imap-bodystructure.c:
	Default to 7bit instead of 8bit content-encoding-type.
	[58041ce0a24c]

	* src/lib-storage/index/maildir/maildir-list.c:
	Don't delete ".." dirs outside our imap root.
	[c7bb9cc26e1f]

	* src/lib-mail/message-address.c, src/lib-mail/message-parser.c:
	A few small fixes to MIME and mail address parsers.
	[39b899338c99]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Use less strict mailbox name verification when trying to access
	existing mailboxes. Don't delete directories beginning with ".."
	outside our maildir root (if full_filesystem_access = yes).
	[61decb945930]

	* src/imap/cmd-list.c:
	placeholder -> noselect change broke LIST "" "foo/%" not showing
	foo/.
	[53f8ac273a9b]

2003-02-24  Timo Sirainen  <tss@iki.fi>

	* NEWS, README, TODO:
	updates
	[31510fc5e02f]

	* src/lib/unlink-directory.c:
	fd leak fix
	[9833f1b94f25]

	* src/login-common/ssl-proxy.c:
	Didn't compile without SSL libs
	[a85455157496]

	* src/lib-index/mail-index-util.c:
	Fallback temp file creation into /tmp with in-memory indexes. Used
	only with mbox rewriting.
	[467e79a48848]

	* src/imap/cmd-list.c, src/lib-storage/index/maildir/maildir-list.c:
	Use \PlaceHolder only when listing subscriptions.
	[d850b16d583f]

	* src/lib/ostream-file.c:
	Try to use optimal block sizes when writing to files.
	[06b1b95ae756]

	* configure.in, src/imap/cmd-list.c, src/imap/commands.h, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-
	storage/mail-storage.h:
	Added support for CHILDREN and LISTEXT extensions.
	[40bae47bdba1]

	* src/lib/unlink-directory.c:
	unlink_directory() is now (hopefully) race-condition free.
	[478471737964]

	* doc/mkcert.sh:
	comment update
	[4c5f325df4ac]

	* doc/auth.txt:
	Use pam_unix as example instead of pam_pwdfile.
	[fc8fb4aa5c14]

2003-02-23  Timo Sirainen  <tss@iki.fi>

	* doc/design.txt, doc/index.txt:
	updates
	[6e893f3f9837]

	* src/lib-storage/index/maildir/maildir-storage.c:
	in-memory index crashfixes
	[844bf41d831b]

	* doc/index.txt, doc/mail-storages.txt, dovecot-example.conf, src/lib-
	index/Makefile.am, src/lib-index/mail-custom-flags.c, src/lib-index
	/mail-index-compress.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index-open.c, src/lib-index/mail-index-util.c, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-index/mail-
	lockdir.c, src/lib-index/mail-lockdir.h, src/lib-index/mail-
	modifylog.c, src/lib-index/mail-tree.c, src/lib-index/maildir
	/maildir-index.c, src/lib-index/mbox/mbox-index.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Index opening rewrites. We don't try to support
	.imap.index-<hostname> style indexes anymore. They just made things
	more difficult, and it's really not a good idea to use index files
	via NFS anyway.

	Added support for :INDEX=MEMORY in MAIL env to disable using index
	files. Also if we can't open or create index file for any reason, we
	now fallback to in-memory indexes. Before we fallbacked only with
	out of disk space errors.

	If .customflags can't be created, we still work now by not allowing
	to create new custom flags.
	[2512ad6fd9e9]

	* src/master/login-process.c:
	..and tell login process about verbose_ssl..
	[9b693201e075]

	* dovecot-example.conf:
	verbose_ssl here too
	[5c73e63c75f7]

	* src/imap-login/client.c, src/login-common/common.h, src/login-
	common/main.c, src/login-common/ssl-proxy-gnutls.c, src/login-common
	/ssl-proxy-openssl.c, src/login-common/ssl-proxy.h, src/master
	/master-settings.c, src/master/master-settings.h,
	src/pop3-login/client.c:
	Added setting verbose_ssl
	[2660b47fd9bc]

	* src/login-common/ssl-proxy-openssl.c:
	bugfix
	[23f28ecd2c21]

	* src/login-common/ssl-proxy-gnutls.c:
	proper deinit for gnutls proxy too
	[42f7c4e8e690]

	* src/login-common/ssl-proxy-openssl.c:
	destroy proxies before destroying ssl context
	[f7da7d46e3f2]

	* src/login-common/ssl-proxy-openssl.c:
	and compiler warning fixes..
	[6352baabd8a1]

	* src/login-common/main.c, src/login-common/ssl-proxy-openssl.c:
	Keep list of the SSL proxies, so they're deinitialized properly if
	we have to kill them.
	[e6d2b8c78519]

	* src/master/main.c:
	Don't listen in imaps/pop3s if ssl_disable = yes. Even if they're
	listed in protocols.
	[88e025c0d1c6]

2003-02-22  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	[ipv6 address] was still buggy in *_listen
	[4e438a5c00d3]

2003-02-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-store.c:
	Sync EXPUNGEs also with UID FETCH and UID STORE.
	[d35e8f84bf71]

	* src/lib-index/mbox/mbox-from.c:
	Support parsing some broken mbox From-lines
	[c0783c50e47c]

	* src/imap/cmd-idle.c:
	cork the output before sending the ending IDLE replies.
	[8c85c03e0485]

	* src/lib/ostream-file.c:
	if connection was closed while trying to write data to client, we
	sometimes crashed. also errno wasn't saved.
	[b661eb87bd26]

	* dovecot-example.conf, src/master/mail-process.c, src/master/main.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added setting mail_drop_priv_before_exec.
	[52e0830ade13]

	* src/lib/env-util.c, src/lib/env-util.h, src/lib/restrict-access.c,
	src/lib/restrict-access.h:
	Added env_remove() and restrict_access_clear_env().
	[ea3f6c93d1a2]

2003-02-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-idle.c:
	handle error condition better
	[bff971233e5d]

	* src/imap/cmd-idle.c:
	fixes
	[fb8cec12d2ee]

	* src/lib-storage/index/index-save.c:
	crashfix
	[e4210f1ea3f1]

	* dovecot-example.conf, src/imap/cmd-list.c, src/lib-imap/imap-
	match.c, src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h:
	Removed list-sort workarounds. It's pretty much needed for maildir
	listing. Also added some more complexity and kludging to make
	everything work correctly.
	[a70ebd3a59e2]

	* src/auth/db-passwd-file.c:
	passwd-file changes. Moved flags before MAIL environment which is
	now last so it allows ':' characters in it..
	[15c1353d74d9]

	* src/lib/strescape.c, src/lib/strescape.h:
	str_unescape(): return char*
	[3784730cfcd8]

	* src/login-common/ssl-proxy-openssl.c:
	error handling fixes
	[69bd0ea4c718]

	* doc/auth.txt, doc/configuration.txt, dovecot-example.conf:
	updates
	[1429fcb2e577]

	* src/imap/cmd-idle.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c:
	outlook-idle workaround fixes.
	[fee90d8ad273]

	* dovecot-example.conf, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-close.c, src/imap/cmd-idle.c, src/imap/cmd-select.c, src/imap
	/cmd-unselect.c, src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/common.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h:
	workaround: outlook-idle
	[9ced30dda6c3]

	* TODO:
	updated
	[6fd1f2e82c9a]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	minor ldap fixes
	[8e6addbf12b3]

	* src/lib-storage/index/index-messageset.c, src/lib-storage/index
	/index-save.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c:
	mbox: strip some headers when saving message. also always set
	Content-Length header so message may safely contain lines beginning
	with "From ".
	[539b7336b68a]

	* src/lib-index/mbox/mbox-rewrite.c:
	X-Keywords-headers were duplicated
	[3aa40f0dde5f]

	* src/lib/ostream-file.c:
	ostream: get initial offset. flush buffer before seeking.
	[cf9558657ded]

2003-02-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h:
	Include microseconds in maildir filename base.
	[60770e7e3dea]

	* src/lib-storage/index/index-save.c:
	Don't save the message if EOF comes too early
	[35ea9b558c2b]

	* src/lib/ostream-file.c:
	sendfile bugfix
	[db5958ba1c32]

	* src/lib/ioloop.c:
	Check gettimeofday() failures
	[6b99a5b076a6]

	* src/lib-storage/index/maildir/maildir-list.c:
	comment update
	[2d14be5b6829]

	* src/lib-storage/index/maildir/maildir-list.c:
	Assume \Marked if new/ has been modified later than cur/
	[e04c2b01ecb2]

	* src/lib-storage/index/maildir/maildir-storage.c:
	We don't really need the cur, new and tmp symlinks in .INBOX/ dir.
	Also don't even try to support renaming INBOX since we can't make it
	atomic.
	[57f6989a6b8d]

	* dovecot-example.conf, src/lib-index/mbox/mbox-index.c:
	mail_read_mmaped = no works now with mbox
	[88c0d1c2b3c3]

	* dovecot-example.conf, src/imap/cmd-list.c, src/lib-imap/imap-
	match.c, src/lib-imap/imap-match.h, src/lib-storage/index/maildir
	/maildir-list.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h, src/lib-
	storage/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h:
	Rewrote LIST, LSUB and subscription file handling. LIST replies
	aren't sorted anymore by default, it can be enabled with
	client_workarounds = list-sort.
	[d28571e8c810]

	* src/lib/istream-mmap.c, src/lib/istream.h, src/lib/ostream-file.c,
	src/lib/ostream.h:
	o_stream_send_istream() is now safe to use for moving data within
	file.
	[e86f259048cf]

	* doc/dovecot-ldap.conf:
	notes about userPassword
	[eb2c2da659df]

	* src/auth/Makefile.am, src/auth/md5crypt.c, src/auth/md5crypt.h,
	src/auth/password-scheme.c:
	crypt-password checking was broken. added support for md5crypt
	passwords.
	[789b0346308e]

2003-02-18  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c:
	fix
	[31deba59422f]

	* src/imap/main.c:
	Use getlogin() alternatively if USER environment isn't found.
	[206190c8c66f]

	* src/auth/Makefile.am, src/auth/mech-digest-md5.c, src/auth/passdb-
	ldap.c, src/auth/passdb-passwd-file.c, src/auth/passdb.c, src/auth
	/password-scheme.c, src/auth/password-scheme.h, src/auth/password-
	verify.c, src/auth/password-verify.h:
	Fix realm usage with DIGEST-MD5. Support generating other password
	schemes out of plaintext passwords.
	[76321f65960d]

	* doc/dovecot-ldap.conf, src/auth/Makefile.am, src/auth/auth-login-
	interface.h, src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/db-
	passwd-file.c, src/auth/db-passwd-file.h, src/auth/master-
	connection.c, src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	src/auth/mech.c, src/auth/mech.h, src/auth/passdb-ldap.c, src/auth
	/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth/passdb-
	passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-vpopmail.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/password-verify.c,
	src/auth/password-verify.h, src/auth/userdb-ldap.c, src/auth/userdb-
	passwd-file.c, src/auth/userdb-passwd.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c, src/auth/userdb-vpopmail.h,
	src/auth/userdb.h, src/login-common/auth-common.c:
	Added default_pass_scheme to LDAP. Support for more password
	schemes. Merged password checking code with LDAP and passwd-file, so
	both support the same schemes now.
	[65e48854491d]

	* INSTALL:
	s/ldap/vpopmail/ in vpopmail.so example
	[c54c61822d27]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	Escape special chars in username if needed.
	[2cb8e2136283]

	* src/imap/cmd-delete.c:
	Don't allow deleting selected mailbox.
	[188e2ca0b36c]

	* doc/Makefile.am:
	missing dovecot-ldap.conf
	[e042bed705af]

2003-02-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c:
	Do tmp -> new using link() + unlink(). Use "new" way for unique
	filename generation.
	[6dc4f89b53c4]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Check for ENOTEMPTY too for rename() failures.
	[66bf2aaf74dc]

	* src/lib-storage/index/mbox/mbox-expunge.c:
	o_stream_seek() return value was checked wrong
	[0dc579b99c9e]

	* src/imap/cmd-list.c:
	Remove the mailbox globbing code from here. It should have been done
	already by mail_storage. Also show parent mailboxes before children,
	not after. (Patch by Peter Kaas)
	[cacfd1b16626]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Handle LDAP failures better.
	[27fb52c532a4]

	* src/auth/db-ldap.c:
	Rather than block for two seconds, we can just call ldap_result()
	again if it returns 0..
	[ac7dbb236b59]

2003-02-14  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	comment update
	[930452c85250]

	* src/lib-storage/mail-storage.h:
	oe6 workaround enum was 0 which didn't really work..
	[538a09318de0]

	* TODO:
	updated
	[933c8f9c241f]

	* dovecot-example.conf:
	IDLE setting.
	[dee729f18aa1]

	* src/lib-index/mbox/mbox-lock.c, src/lib/file-dotlock.c, src/lib
	/file-dotlock.h:
	Don't even try to override mbox dotlock if we can't get fcntl/flock.
	[625d4d2b35ee]

	* src/lib-imap/imap-parser.c:
	Allow '\' character too in atoms, they're used in flags..
	[5bf4efe73b2d]

	* src/lib/fdpass.c:
	check cmsg_level too
	[00dd1db9e312]

	* src/lib/fdpass.c:
	fd_read(): make sure it's SCM_RIGHTS that was transferred so that
	login process couldn't fool us to use some of our existing fds.
	[07c8944fdd28]

	* configure.in, src/imap/Makefile.am, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-idle.c, src/imap/cmd-select.c,
	src/imap/commands.c, src/imap/commands.h, src/imap/common.h,
	src/imap/main.c, src/lib-storage/index/index-mailbox-check.c, src
	/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Support for IDLE extension.
	[f7c273202dc3]

	* src/lib/ioloop.c:
	Don't inline timeout_update_next(). gcc 3.2.2 with -O2 seems to
	break it.
	[6a22587f069a]

	* src/lib-imap/imap-parser.c:
	show proper error message to 8bit chars
	[434727666f19]

	* src/lib-imap/imap-parser.c:
	Allow wildcards anyway in atoms, they're needed with LIST.
	[0eaf51e01ccd]

	* dovecot-example.conf, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-append.c, src/imap/cmd-select.c, src/imap/cmd-store.c, src/imap
	/commands-util.c, src/imap/commands-util.h, src/imap/common.h,
	src/imap/mail-storage-callbacks.c, src/imap/main.c, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added setting to limit length of custom flag names.
	[03f1455664d7]

	* src/lib-imap/imap-parser.c:
	Complain if atoms contain invalid characters.
	[64345e62089c]

2003-02-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-quote.c:
	Quoting didn't remove CR and LF characters, so it could have caused
	corrupted ENVELOPE/BODY replies.
	[fccf13a1c67a]

	* src/lib/sendfile-util.c:
	Solaris 9 seems to kernel panic if sendfilev() is used with non-
	socket.
	[69d922a1d051]

	* src/lib-storage/index/mbox/mbox-storage.c:
	typofix
	[80fe40b9db65]

2003-02-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c:
	more full_filesyste_access fixes (forgot to commit)
	[9626eda973d1]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Several fixes to mail_full_filesystem_access = yes handling
	[c2f6ca19fa29]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-lock.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib/Makefile.am, src/lib/file-dotlock.c, src/lib
	/file-dotlock.h, src/lib/file-lock.c, src/lib/unlink-lockfiles.c:
	Locking code cleanups and small fixes
	[fc5d2e44cc5e]

	* src/login-common/auth-connection.c:
	handshake counter was decreased too often and could have caused
	hangs
	[1a9be391559b]

2003-02-11  Timo Sirainen  <tss@iki.fi>

	* INSTALL:
	wordwrapping..
	[8a93dff28e13]

	* INSTALL:
	-fPIC too
	[d346da6de29d]

	* INSTALL:
	updated
	[d8d8ec83c2f7]

	* src/auth/passdb.c:
	fix
	[cd46f47d559f]

	* src/lib-storage/mail-storage.c:
	..and it went wrong..
	[17899f8ff18a]

	* src/lib-storage/mail-storage.c:
	Ignore empty workarounds
	[0c8c64bd997e]

	* src/master/mail-process.c:
	We shouldn't check umask() return value.
	[5e945f06a142]

	* src/master/mail-process.c:
	And pass the mail_full_filesystem_access setting to IMAP process
	too..
	[95d67b5c3fd4]

	* dovecot-example.conf, src/lib-storage/index/maildir/maildir-list.c,
	src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/lib/Makefile.am, src/lib/home-expand.c, src/lib
	/home-expand.h, src/master/master-settings.c, src/master/master-
	settings.h:
	Added mail_full_filesystem_access setting. Some of the setting
	variable types were declared wrong and caused Dovecot to crash if
	they were set in config file.
	[058f6c26f405]

	* configure.in, src/auth/Makefile.am, src/auth/auth-module.c, src/auth
	/auth-module.h, src/auth/passdb.c, src/auth/userdb.c:
	Support for dynamic authentication modules.
	[18a2074a4d3d]

	* src/auth/userdb-vpopmail.c:
	compile fix
	[38f6130abec2]

	* src/imap-login/client.c, src/imap-login/client.h,
	src/pop3-login/client.c, src/pop3-login/client.h:
	Make sure calling client_destroy() multiple times doesn't break
	anything.
	[b5b172ab0ed9]

	* src/login-common/master.c:
	Die cleanly when master tells us so.
	[0beeeffc6d31]

	* src/lib/istream-mmap.c, src/lib/ostream-file.c, src/lib/sendfile-
	util.c, src/lib/sendfile-util.h:
	Bugfixes to handling >2GB files.
	[ee4bdf40ec10]

	* src/lib-index/mail-index-open.c, src/lib-index/maildir/Makefile.am,
	src/lib-index/maildir/maildir-clean.c, src/lib-index/maildir
	/maildir-index.c, src/lib-index/maildir/maildir-index.h:
	Clean old files from Maildir tmp dirs.
	[40629cdd51fb]

	* src/master/auth-process.c:
	Creating more than one auth process per group didn't really work.
	[6970c1d808ab]

	* src/auth/db-ldap.c, src/auth/db-ldap.h:
	Use the same LDAP connection for both userdb and passdb if
	config_path is the same.
	[50f10a7a3bad]

	* dovecot-example.conf:
	updated
	[3754fb986f65]

	* doc/dovecot-ldap.conf, src/auth/db-ldap.c, src/auth/db-ldap.h,
	src/auth/userdb-ldap.c:
	Added user_global_uid and user_global_gid LDAP settings.
	[873634a5b472]

	* src/lib-storage/index/index-mail.c:
	get_size() was buggy
	[44904d3d7b6b]

	* src/lib-imap/imap-quote.c:
	Literals sizes were sometimes set to 2^32-1.
	[cfe8bafb61d3]

	* dovecot-example.conf, src/imap/cmd-fetch.c, src/imap/main.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added client_workarounds setting, with currently one workaround for
	OE6.
	[340dea0150bf]

	* doc/dovecot-ldap.conf:
	Added example config file.
	[5b5716af5aa8]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	Separate user and pass attrs/filters in config file
	[ad6343bd4479]

	* src/auth/Makefile.am, src/auth/db-ldap.c, src/auth/db-ldap.h,
	src/auth/passdb-ldap.c, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb-ldap.c:
	passdb ldap added. fixes to userdb ldap.
	[81930fff13cf]

2003-02-10  Timo Sirainen  <tss@iki.fi>

	* src/login-common/auth-connection.c, src/login-common/auth-
	connection.h, src/login-common/main.c:
	Don't accept client connections before we're connected to all auth
	processes.
	[bd3dabaa598e]

	* src/master/auth-process.c:
	i_error, not i_panic..
	[f6889bb50a7f]

	* src/login-common/auth-connection.c:
	Crashfix.
	[50727d444717]

	* src/master/auth-process.c:
	Auth process communication was a bit broken
	[817718515e5f]

2003-02-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/master-connection.c:
	cleanup
	[64ebf1b58b53]

	* src/auth/db-passwd-file.c, src/login-common/auth-common.c:
	More realm fixes
	[9a1a79df6238]

	* src/auth/mech-plain.c:
	usernames with '@' char were supposed to be treated as user@realm,
	but that was a bit buggy
	[373ea249ff2f]

2003-02-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	Allocate larger initial pool for maildir syncing.
	[e352e28f80c3]

	* src/lib/mempool-alloconly.c:
	DEBUG: we cleared wrong memory block..
	[e106cde5255c]

	* src/auth/common.h, src/auth/login-connection.c, src/auth/main.c:
	Moved login process verbose stuff under verbose_debug.
	[bf89319ec557]

	* dovecot-example.conf, src/login-common/main.c, src/master/auth-
	process.c, src/master/mail-process.c, src/master/main.c, src/master
	/master-login-interface.h:
	/dev/stderr works now in log paths.
	[5e9430a39611]

	* src/master/master-settings.c:
	Don't check log dir permission if the log file already exists
	[313790fb126e]

	* src/master/master-settings.c:
	And remove the flock default from here too..
	[3e234b658c7b]

	* src/auth/passdb-pam.c:
	OpenPAM uses const too.
	[282e0980c3f2]

	* src/login-common/master.c:
	Show the fd we're sending to master if fd_send() fails.
	[7ddb17390a5c]

	* src/master/login-process.c:
	Don't start those login processes that aren't enabled in protocols
	setting.
	[5c9c681f13ff]

	* src/login-common/auth-connection.c:
	Don't complain about unexpected auth disconnections actually, that's
	normal during shutdown.
	[d7ac3c5eb831]

	* src/imap-login/client.c, src/login-common/ssl-proxy-gnutls.c, src
	/login-common/ssl-proxy-openssl.c, src/pop3-login/client.c:
	STARTTLS handshake failure fixes.
	[71c438e6a40f]

	* src/imap/rawlog.c:
	There's no space before "* OK"
	[cbfee53bcaee]

	* src/lib/ostream-file.c:
	Don't bother trying sendfile() more than once with the stream.
	[6a233fbb02a5]

	* src/lib/sendfile-util.c:
	FreeBSD's sendfile() works only with sockets. Replace errno with
	EINVAL to make it look like sendfile isn't supported.
	[44b531fbb32a]

	* dovecot-example.conf, src/lib-index/mbox/mbox-lock.c:
	Don't use flock() locking by default. Using both fcntl+flock doesn't
	work with FreeBSD.
	[4abeb0fa0fe7]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Autodetect /var/mail/%u and /var/spool/mail/%u INBOXes.
	[a246c1d68061]

	* src/lib/mempool-alloconly.c:
	DEBUG: fill memory with 0xde before freeing it
	[1ae6cf799802]

	* src/lib/istream-file.c:
	use the file size only for regular files. FreeBSD gave sockets a
	size of 4 which broke things.
	[19d58921378f]

	* src/login-common/auth-connection.c:
	Warn if auth process disconnected.
	[7b249ab4a538]

	* src/login-common/auth-common.c:
	Don't crash if authentication was aborted too early.
	[b27e20bbdef5]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-imap
	/imap-quote.c, src/lib-imap/imap-quote.h:
	Don't do x-unknown mime encoding. Correct way is to just send them
	as literals to client. ENVELOPE, BODY and BODYSTRUCTURE replies are
	now always sent as literals if they contain 8bit text, '"' or '\'
	characters.

	Added option to IMAP parser to return literals with IMAP_ARG_LITERAL
	type.
	[4044c2903ed7]

	* src/master/auth-process.c:
	cleanups
	[d981ebb3a155]

	* src/lib/fdpass.c:
	Have to check that msg_controllen is large enough, otherwise cmsg
	points to uninitialized buffer (at least with freebsd).
	[02454eee1775]

	* src/lib/restrict-process-size.c:
	Don't try to set rlimits to infinity, rather just don't change them.
	[95ef12ebc953]

	* src/auth/login-connection.c, src/login-common/auth-connection.c, src
	/login-common/master.c:
	Some extra checks to make sure we notice if auth process ID is 0.
	[0f7ff293c414]

	* src/lib-mail/message-part-serialize.c:
	Variable type changes, fixes compiler warning.
	[fcc3a3b4aec9]

	* src/lib-settings/settings.c:
	Don't skip trailing whitespace, it might be wanted (eg.
	log_timestamp).
	[85f9b3f666e5]

	* src/master/main.c:
	[ipv6 address] didn't work in *_listen
	[95d2f3e60b82]

	* src/lib-mail/quoted-printable.c:
	We handled '=' at end of line wrong.
	[cad379bd76d6]

2003-02-06  Timo Sirainen  <tss@iki.fi>

	* src/lib/fd-close-on-exec.c:
	Print also the fd number if it fails.
	[5a60e173fe9a]

2003-02-04  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Don't complain about missing *-login binaries if they're not
	enabled.
	[d42e2864dc3d]

	* configure.in:
	Building in separate directory didn't work
	[2ea48622afbc]

	* src/lib-index/mbox/mbox-index.c:
	Valid From-line parsing could have crashed too.
	[714661dacead]

	* src/imap-login/Makefile.am, src/pop3-login/Makefile.am:
	Missing headers
	[c1e099b65be0]

	* src/auth/Makefile.am:
	missing db-ldap.h
	[b46e3ca71d66]

	* src/auth/userdb-ldap.c:
	cleanups
	[63e76cf6c9e8]

	* src/lib-index/mbox/mbox-index.c:
	Dovecot might have crashed sometimes when accessing mbox with
	invalid From-lines (eg. in the middle of the message body).
	[a0a1b532fab8]

	* src/auth/passdb-shadow.c:
	s/PASSDB_PASSWD/PASSWD_SHADOW/
	[c871ad112e19]

2003-02-03  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Check for shadow.h before assuming shadow auth is possible.
	[088c7d83f2f2]

	* src/imap/cmd-status.c:
	STATUS cleared \Recent flags from messages
	[eedb1467ccb0]

	* src/imap/main.c, src/lib/alarm-hup.c, src/pop3/main.c:
	We don't need to raise SIGHUP in alarm handler, that was just a
	mistake in first tests. That also means gdb won't break at SIGALRM
	and I can remove the DISABLE_ALARMHUP kludge.
	[c1f6c20cde9a]

2003-02-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Define OPENLDAP_ASYNC_WORKAROUND
	[067130d609b7]

	* src/imap-login/client-authenticate.c, src/login-common/auth-
	connection.c, src/login-common/auth-connection.h, src/pop3-login
	/client-authenticate.c:
	Send protocol with auth requests
	[40c2be9abdd3]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/login-common/Makefile.am, src/login-common
	/auth-common.c, src/login-common/auth-common.h, src/login-common
	/client-common.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h:
	Moved more auth code to login-common.
	[86b8c9cb7ac0]

	* src/auth/auth-login-interface.h, src/auth/login-connection.c,
	src/auth/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/pop3-login/client.c:
	auth: kill login connection if it leaves requests hanging too long.
	[f6ec28683512]

	* src/login-common/auth-connection.c, src/login-common/auth-
	connection.h:
	make sure we don't access free'd memory if auth process dies.
	[c62416017121]

	* src/auth/login-connection.c, src/auth/login-connection.h, src/auth
	/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c:
	fixes
	[98dca3b6b209]

	* src/login-common/auth-connection.c:
	s/imap-auth/auth process/
	[6def98421f46]

	* src/imap-login/client.c, src/pop3-login/client.c:
	STARTTLS commands crashed. imap-login STARTTLS also ignored next
	command.
	[3aece07f3a1b]

	* src/auth/mech-digest-md5.c:
	finally working
	[58ec36002730]

	* src/auth/mech-digest-md5.c:
	maybe now?
	[0106bbf4bdaf]

	* src/auth/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h:
	more fixes
	[e22f21b9ec49]

	* src/auth/auth-login-interface.h, src/auth/db-ldap.c, src/auth/db-
	ldap.h, src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	src/auth/mech.c, src/auth/mech.h, src/auth/passdb-pam.c, src/auth
	/passdb-passwd-file.c, src/auth/passdb-passwd.c, src/auth/passdb-
	shadow.c, src/auth/passdb-vpopmail.c, src/auth/passdb.h, src/auth
	/userdb-ldap.c, src/auth/userdb.c, src/auth/userdb.h:
	auth process fixes, LDAP seems to be working (with the kludge define
	or fixed libldap)
	[f1401fa7ab03]

2003-02-01  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	um. still not.
	[85e2b65cc780]

	* src/master/master-settings.c:
	Changing login_dir or login_chroot wasn't possible
	[389e9d1f4e60]

	* src/imap/imap-sort.c:
	Message size was returned with wrong type
	[a3e831cba5c4]

	* src/pop3/commands.c:
	Don't crash if we couldn't open message.
	[d71e0aa00d75]

	* src/lib-storage/index/index-search.c:
	Fixes to SEARCH SENT*
	[5c34c363a062]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.c,
	src/lib-storage/mail-search.h:
	Several search fixes, mostly related to matching multiple
	conditions.
	[8024a2cdc406]

	* src/lib-imap/imap-parser.c:
	Giving >7 args to imap command was buggy
	[be54621f4079]

	* src/imap/main.c:
	wrong debug check
	[800810173989]

	* src/lib-storage/index/index-search.c:
	SEARCH NOT didn't work
	[06b566bd2623]

	* configure.in, src/lib/ioloop-poll.c, src/lib/restrict-process-
	size.c, src/lib/restrict-process-size.h, src/master/auth-process.c,
	src/master/login-process.c, src/master/mail-process.c:
	Don't let login process fork()
	[6cb5b50aea71]

2003-01-31  Timo Sirainen  <tss@iki.fi>

	* src/Makefile.am:
	lib-settings was missing
	[1577e4cfd569]

	* src/lib-settings/settings.c, src/lib-settings/settings.h, src/master
	/master-settings.c:
	updates
	[af288710044a]

	* src/auth/.cvsignore, src/auth/Makefile.am, src/auth/db-ldap.c,
	src/auth/db-ldap.h, src/auth/db-passwd-file.c, src/auth/db-passwd-
	file.h, src/auth/login-connection.c, src/auth/main.c, src/auth/mech-
	cyrus-sasl2.c, src/auth/mech.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb.c, src/auth/passwd-file.c, src/auth/passwd-file.h,
	src/auth/userdb-ldap.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c, src/auth/userdb-static.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Cleanups, LDAP support compiles again and generally looks ok, even
	if it doesn't necessarily work :) Works now with new master config.
	[0522a0315d2f]

	* src/lib-mail/message-parser.c:
	Handle boundary=""
	[6a19c941a1fc]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/mbox/mbox-list.c:
	If there's multiple mailboxes named "inbox", ignore them at least
	for now (eg. /var/mail/inbox, ~/mail/inbox).
	[d051d031fc09]

2003-01-30  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c, src/pop3-login/client-
	authenticate.h, src/pop3-login/client.c, src/pop3/Makefile.am,
	src/pop3/capability.h, src/pop3/client.c, src/pop3/commands.c:
	Support for CAPA command (rfc2449).
	[d805c2f1d6a9]

	* configure.in, src/lib-settings/.cvsignore, src/lib-
	settings/Makefile.am, src/lib-settings/settings.c, src/lib-
	settings/settings.h, src/master/Makefile.am, src/master/common.h,
	src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h, src/master/settings.c, src/master/settings.h:
	Moved settings parsing to lib-settings.
	[3b8fb7bf7ecc]

	* configure.in, src/Makefile.am:
	libldap checks, --without-pop3 disables pop3 server
	[c5ab972db48c]

	* src/pop3/client.c, src/pop3/commands.c, src/pop3/commands.h:
	Disconnect after too many bad commands. We also crashed if there
	were no mails in mailbox.
	[a9b499b2611e]

	* dovecot-example.conf, src/imap/main.c, src/login-common/main.c,
	src/master/.cvsignore, src/master/Makefile.am, src/master/auth-
	process.c, src/master/common.h, src/master/imap-process.c,
	src/master/imap-process.h, src/master/login-process.c, src/master
	/mail-process.c, src/master/mail-process.h, src/master/main.c,
	src/master/master-login-interface.h, src/master/settings.c,
	src/master/settings.h, src/master/ssl-init.c:
	Rewrote setting handling. Changed some existing settings also since
	POP3 support required changes anyway. POP3 seems to be really
	working now :)
	[a72bba3f8a55]

	* src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	compile fix + complain about unknown commands
	[cd1ac4101adf]

	* src/pop3/client.c:
	Reduce input buffer size
	[28f606ada24a]

	* src/lib/macros.h:
	Removed STRUCT_OFFSET, offsetof() is ANSI-C for the same purpose.
	Added MEMBER() macro to define C99-style struct labels.
	[2f6225f9c170]

	* src/pop3/commands.c:
	bugfixes
	[5c76c96f745f]

2003-01-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/.psrc, src/login/.psrc, src/master/.psrc:
	..wonder how these ever got into here..
	[ff63007297c3]

2003-01-28  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/Makefile.am, src/imap-login/.cvsignore, src/imap-
	login/Makefile.am, src/imap-login/client-authenticate.c, src/imap-
	login/client-authenticate.h, src/imap-login/client.c, src/imap-
	login/client.h, src/imap-login/common.h, src/login-
	common/.cvsignore, src/login-common/Makefile.am, src/login-common
	/auth-connection.c, src/login-common/auth-connection.h, src/login-
	common/client-common.h, src/login-common/common.h, src/login-
	common/main.c, src/login-common/master.c, src/login-common/master.h,
	src/login-common/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-
	openssl.c, src/login-common/ssl-proxy.c, src/login-common/ssl-
	proxy.h, src/login/.cvsignore, src/login/Makefile.am, src/login
	/auth-connection.c, src/login/auth-connection.h, src/login/client-
	authenticate.c, src/login/client-authenticate.h, src/login/client.c,
	src/login/client.h, src/login/common.h, src/login/main.c,
	src/login/master.c, src/login/master.h, src/login/ssl-proxy-
	gnutls.c, src/login/ssl-proxy-openssl.c, src/login/ssl-proxy.c,
	src/login/ssl-proxy.h, src/pop3-login/.cvsignore,
	src/pop3-login/Makefile.am, src/pop3-login/client-authenticate.c,
	src/pop3-login/client-authenticate.h, src/pop3-login/client.c,
	src/pop3-login/client.h, src/pop3-login/common.h:
	Moved common login process code to login-common, created pop3-login.
	[c41787e8c3f4]

	* src/lib/macros.h:
	No i_memmove here, just memmove.
	[526415575295]

2003-01-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/login-connection.c:
	destroy requests for login connection when it does.
	[c8adf40c8f42]

	* src/auth/login-connection.c, src/auth/master-connection.c, src/auth
	/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-vpopmail.c, src/auth/passdb.h, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-static.c, src/auth
	/userdb-vpopmail.c, src/auth/userdb.h:
	Async userdb and passdb interface.
	[561da07883b6]

	* src/pop3/commands.c:
	Fixes, seems to be working now. Only thing left is the pop3-login..
	[be7710b9a819]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Read the sizes of all messages to memory at startup. More failsafe
	and faster.
	[50d258907c99]

	* configure.in, src/pop3/.cvsignore, src/pop3/Makefile.am,
	src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c,
	src/pop3/commands.h, src/pop3/common.h, src/pop3/mail-storage-
	callbacks.c, src/pop3/main.c:
	Initial code for POP3 server. RETR isn't working right yet, there's
	some syncing problems to figure out (pop3 wants to keep the mailbox
	locked) and the whole pop3-login process is still missing.
	[cacabd33c68a]

	* src/lib-storage/index/index-fetch.c:
	Allow update_seen to be NULL
	[002096c1af3c]

	* src/imap/client.h, src/imap/cmd-append.c, src/imap/commands-util.c,
	src/imap/commands-util.h, src/imap/commands.h, src/imap/imap-
	search.c, src/imap/imap-sort.c, src/imap/imap-thread.c, src/imap
	/mail-storage-callbacks.c, src/imap/main.c:
	some header file cleanups
	[47ecd950a702]

	* dovecot-example.conf, src/master/auth-process.c,
	src/master/settings.c:
	Authentication named socket permissions were insecure, an exploited
	login process could have replaced it with it's own and began reading
	plaintext passwords sent by other login processes.
	[299f59fb9ff4]

	* src/auth/mech-plain.c, src/imap/imap-sort.h, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/mbox/mbox-save.c, src/master
	/imap-process.c, src/master/imap-process.h, src/master/login-
	process.c:
	signed/unsigned/const pointer fixes
	[793f05a7e50e]

	* src/auth/passwd-file.c, src/imap/client.h, src/imap/commands.c,
	src/imap/commands.h, src/imap/imap-sort.c, src/imap/imap-thread.c,
	src/lib-index/mail-index-update.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-sync.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-header-decode.c, src/lib-mail/message-header-decode.h, src
	/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	mail/message-tokenize.c, src/lib-mail/message-tokenize.h, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h, src/lib/failures.c,
	src/lib/failures.h, src/lib/hash.c, src/lib/hash.h, src/login/ssl-
	proxy-openssl.c:
	Function typedefs now define them as functions, not function
	pointers.
	[60646878858e]

	* src/lib-storage/index/Makefile.am:
	missing index-mail.h
	[17ac2832c63f]

	* src/auth/login-connection.c, src/auth/main.c, src/auth/master-
	connection.c, src/imap/client.c, src/imap/rawlog.c, src/lib-
	storage/index/index-mailbox-check.c, src/lib/ioloop-internal.h,
	src/lib/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	src/lib/ioloop.h, src/lib/ostream-file.c, src/login/auth-
	connection.c, src/login/client-authenticate.c, src/login/client.c,
	src/login/client.h, src/login/main.c, src/login/master.c, src/login
	/ssl-proxy-gnutls.c, src/master/auth-process.c, src/master/login-
	process.c, src/master/main.c, src/master/ssl-init.c:
	Removed useless parameters from io_callback_t and
	timeout_callback_t.
	[f782b3319553]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-cyrus-
	sasl2.c, src/auth/auth-digest-md5.c, src/auth/auth-interface.h,
	src/auth/auth-login-interface.h, src/auth/auth-master-interface.h,
	src/auth/auth-plain.c, src/auth/auth.c, src/auth/auth.h,
	src/auth/common.h, src/auth/cookie.c, src/auth/cookie.h, src/auth
	/login-connection.c, src/auth/login-connection.h, src/auth/main.c,
	src/auth/master-connection.c, src/auth/master-connection.h,
	src/auth/master.c, src/auth/master.h, src/auth/mech-cyrus-sasl2.c,
	src/auth/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-vpopmail.c, src/auth/passdb.c, src/auth/passdb.h, src/auth
	/passwd-file.c, src/auth/passwd-file.h, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-static.c, src/auth
	/userdb-vpopmail.c, src/auth/userdb-vpopmail.h, src/auth/userdb.c,
	src/auth/userdb.h, src/auth/userinfo-pam.c, src/auth/userinfo-
	passwd-file.c, src/auth/userinfo-passwd.c, src/auth/userinfo-
	passwd.h, src/auth/userinfo-shadow.c, src/auth/userinfo-vpopmail.c,
	src/auth/userinfo.c, src/auth/userinfo.h, src/imap/main.c, src/login
	/auth-connection.c, src/login/auth-connection.h, src/login/client-
	authenticate.c, src/login/client.h, src/login/common.h,
	src/login/master.c, src/login/master.h, src/master/Makefile.am,
	src/master/auth-process.c, src/master/auth-process.h,
	src/master/common.h, src/master/imap-process.c, src/master/imap-
	process.h, src/master/login-process.c, src/master/login-process.h,
	src/master/main.c, src/master/master-interface.h, src/master/master-
	login-interface.h, src/master/settings.c, src/master/settings.h:
	We have now separate "userdb" and "passdb". They aren't tied to each
	others in any way, so it's possible to use whatever user database
	with whatever password database.

	Added "static" userdb, which uses same uid/gid for everyone and
	generates home directory from given template. This could be useful
	with PAM, although insecure since everyone uses same uid.

	Not too well tested, and userdb/passdb API still needs to be changed
	to asynchronous for sql/ldap/etc lookups.
	[fe49ece0f3ea]

	* src/lib/Makefile.am, src/lib/var-expand.c, src/lib/var-expand.h:
	Added var_expand()
	[c077254cbe66]

	* src/lib/ioloop.c, src/lib/ioloop.h:
	Added io_loop_is_running()
	[e37e626902c3]

	* src/lib/data-stack.c:
	Allow calling t_push() before data_stack_init().
	[ea309e90c01a]

	* src/lib/alarm-hup.c:
	comment update
	[f17e2263f223]

2003-01-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-save.c:
	Memory usage tweaks
	[4bcebdcf052b]

2003-01-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c:
	Removed the OE workaround, it still didn't work if the EXISTS/RECENT
	was sent after FETCH.
	[3b5ad60473be]

	* src/auth/auth-digest-md5.c:
	added const
	[b26b83f30f65]

	* src/lib/istream.c, src/lib/istream.h, src/lib/ostream.c,
	src/lib/ostream.h:
	More type safety to i/o streams
	[29f09c05945d]

	* src/imap/cmd-unselect.c:
	forgot to add
	[e147dcbb2ba6]

	* src/lib-index/mail-modifylog.c:
	Modifylog wasn't written for external changes (broken by the
	previous speedup)
	[eb80a942bd8b]

	* src/lib-storage/index/maildir/maildir-save.c:
	When save is aborted, remove the created temp files.
	[2b7eaf2d31a1]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/commands-util.c, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-parser.h:
	Disconnect client if given non-sync literal size is too large.
	Better than eating the input.
	[dc660f588218]

	* configure.in, src/imap/cmd-append.c, src/lib-imap/imap-parser.c, src
	/lib-imap/imap-parser.h:
	Support for LITERAL+ extension.
	[09bac2875ed8]

2003-01-22  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/cmd-close.c, src/imap
	/cmd-select.c, src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.c, src/imap/commands.h:
	Added support for UNSELECT extension with some cleanups for SELECT
	and CLOSE.
	[81cbc1467097]

	* src/lib-index/mail-modifylog.c:
	Bugfix for last optimization
	[d3c7e5f7041c]

	* configure.in:
	Don't print the result twice either..
	[1cccde7c3f20]

	* configure.in:
	Don't print checking sendfilev() message twice
	[000a86b4e4a9]

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY[TEXT] was broken
	[a237bde6bd1e]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-modifylog.c:
	Modify log used to test if there were other users for every changed
	flag or expunged message, causing two fcntl() syscalls every time ->
	SLOW. Now we check it only once after exclusively locking the index.
	[d1caf5d0e77c]

	* configure.in, doc/multiaccess.txt, src/imap/client.c, src/imap/cmd-
	append.c, src/imap/cmd-copy.c, src/imap/common.h, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-messageset.c, src/lib-storage/index/index-
	messageset.h, src/lib-storage/index/index-save.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage.h:
	Support for MULTIAPPEND extension. COPY now behaves like spec says -
	if it fails, none of the messages are copied.
	maildir_copy_with_hardlinks didn't actually work.
	[40a327d356de]

	* src/lib-imap/imap-parser.c:
	Externally parsed literal size always stops argument parsing now.
	Input stream is now skipped when returning success/failure, so the
	stream can be used for other purposes too.
	[26a028e6d7d5]

	* src/lib/iostream.c:
	i/o streams unreffed their pool, but never referenced it. this
	didn't matter so far since we always used system/data stack pools
	where refcounting didn't matter.
	[3415ebfad8d2]

2003-01-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-sort.c:
	Give nice error message for "SORT ()"
	[b2d9219c60af]

	* src/imap/imap-search.c:
	Don't crash with "SEARCH ()"
	[cdfd647b0cbb]

	* src/lib-imap/imap-parser.c:
	Missing ')' wasn't reported correctly.
	[3c30228ae095]

	* src/lib-storage/index/index-fetch.c:
	WORKAROUND: Outlook (Express 6) fails with to read FETCH BODY[] if
	we send EXISTS/RECENT before it
	[fb83ce2a26c3]

	* src/lib-storage/index/index-messageset.c:
	Some fixes for handling messageset ranges.
	[b5ca53885d07]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	FETCH ENVELOPE failed if it wasn't already cached.
	[1222ab408f63]

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY [1.HEADER*|MIME] didn't work
	[95d77998ec16]

	* src/imap/cmd-fetch.c:
	UID FETCH didn't return the UID.
	[cc02c93d254e]

	* src/lib-storage/index/mbox/mbox-storage.c:
	mboxes in subfolders weren't selectable.
	[1109ad591e44]

	* src/imap/cmd-store.c:
	STORE accepts now multiple flags without requiring them being inside
	().
	[61400b3bc338]

	* src/imap/commands-util.c:
	store/append crashed if no custom flags were being set (ie. almost
	always)
	[a5f39241d089]

	* src/imap/client.c, src/login/client.c, src/login/client.h:
	imap-login: disconnect when received 10 invalid commands. imap:
	disconnect when received 20 invalid commands in a row - every
	successful command resets the counter now.
	[fb9c95a8847f]

	* src/master/auth-process.c, src/master/common.h, src/master/login-
	process.c, src/master/main.c:
	If auth/login process died unexpectedly, the exit status or killing
	signal wasn't logged.
	[0fbafade2d85]

	* dovecot-example.conf:
	Added auth_verbose
	[070aee0e5b9f]

	* src/auth/auth-digest-md5.c, src/auth/common.h, src/auth/login-
	connection.c, src/auth/main.c, src/auth/userinfo-pam.c, src/auth
	/userinfo-passwd-file.c, src/auth/userinfo-passwd.c, src/auth
	/userinfo-shadow.c, src/auth/userinfo-vpopmail.c, src/master/auth-
	process.c, src/master/settings.c, src/master/settings.h:
	auth_verbose = yes logs now all authentication failures and some
	other stuff.
	[d0845dca7eca]

	* doc/configuration.txt:
	updated memory usage counts
	[6abffe419582]

	* src/imap/imap-fetch.c:
	Now it actually leaked memory..
	[b26a06cd5e8f]

	* src/lib/str.c, src/lib/str.h:
	Added str_free()
	[4b264ea5d41d]

	* src/imap/imap-fetch.c:
	FETCH ate too much memory
	[ab4091b2ddc2]

	* src/lib/strfuncs.c:
	null_strcmp() was broken -> SORT was broken.
	[cba414845f1b]

	* src/imap/imap-fetch-body-section.c:
	And remove debugging :)
	[5a4461a388d9]

	* src/imap/client.h, src/imap/cmd-select.c, src/imap/imap-fetch-body-
	section.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/lib-
	mail/message-send.c, src/lib-mail/message-send.h:
	Partial fetches are working fast again - faster than ever actually.
	[21788a1e9e39]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Forgot to add
	[9c8df18fb2a9]

	* src/lib-index/mail-index-data.c:
	shouldn't have moved the debug_mprotect()
	[e6a7afe4cca7]

2003-01-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am, src/imap/cmd-append.c, src/imap/cmd-fetch.c,
	src/imap/cmd-search.c, src/imap/cmd-sort.c, src/imap/cmd-store.c,
	src/imap/cmd-thread.c, src/imap/commands-util.c, src/imap/commands-
	util.h, src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c,
	src/imap/imap-fetch.h, src/imap/imap-search.c, src/imap/imap-
	search.h, src/imap/imap-sort.c, src/imap/imap-sort.h, src/imap/imap-
	thread.c, src/imap/imap-thread.h, src/lib-imap/Makefile.am, src/lib-
	imap/imap-envelope.c, src/lib-imap/imap-message-cache.c, src/lib-
	imap/imap-message-cache.h, src/lib-index/mail-index-data.c, src/lib-
	mail/message-address.c, src/lib-mail/message-address.h, src/lib-mail
	/message-body-search.c, src/lib-mail/message-body-search.h, src/lib-
	mail/message-date.c, src/lib-mail/message-date.h, src/lib-mail
	/message-parser.h, src/lib-mail/message-send.c, src/lib-mail
	/message-send.h, src/lib-mail/message-size.h, src/lib-mail/message-
	tokenize.h, src/lib-storage/Makefile.am, src/lib-
	storage/index/Makefile.am, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h, src/lib-
	storage/index/index-messageset.c, src/lib-storage/index/index-
	messageset.h, src/lib-storage/index/index-msgcache.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-sort.c,
	src/lib-storage/index/index-sort.h, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-update-flags.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-search.c,
	src/lib-storage/mail-search.h, src/lib-storage/mail-sort.c, src/lib-
	storage/mail-sort.h, src/lib-storage/mail-storage.h, src/lib-storage
	/mail-thread.c, src/lib-storage/mail-thread.h, src/lib/strfuncs.c,
	src/lib/strfuncs.h:
	mail-storage.h interface changes, affects pretty much everything.
	FETCH, SEARCH, SORT and THREAD handling were pretty much moved from
	lib-storage/ to imap/ so adding non-index storages would be much
	easier now. Also POP3 server can now be easily implemented with lib-
	storage.

	Not too well tested, and at least one major problem: partial
	fetching is _slow_.
	[8028c4dcf38f]

	* dovecot-example.conf:
	comment updates
	[cbf096fbb9f0]

	* src/lib-imap/imap-bodystructure.h:
	comment update
	[efca64f75e62]

	* src/lib-imap/imap-base-subject.c:
	Strip CR and LF characters too.
	[961617a56fb9]

	* src/auth/auth-plain.c, src/login/client-authenticate.c:
	PLAIN SASL-authentication was a bit broken.
	[907b9845eaa6]

	* src/lib/alarm-hup.c:
	DISABLE_ALARMHUP environment: Disable sending SIGHUP every 30 secs.
	Really annoying with debugging.
	[f57cc4bfa195]

	* src/lib-imap/imap-date.c:
	imap_parse_date() returned a bit wrong time: mktime() already builds
	the local date into UTC timestamp, so we don't need to change it
	again.
	[4937e278489c]

2003-01-16  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	If Solaris sendfilev() is found, don't try checking for Linux one.
	Linux check some reason passes with sendfile-enabled Solaris..
	[7e9b90bfe78c]

2003-01-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-vpopmail.c:
	compile fix
	[dd4b74885c43]

2003-01-14  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	comment update
	[fd1438d43443]

	* dovecot-example.conf:
	comment update
	[d3433363bcaa]

	* doc/configuration.txt:
	updated
	[45d04b5dcd24]

	* configure.in, src/lib/sendfile-util.c:
	Support for Solaris sendfilev(). Entirely untested, hope it works.
	[b3e0f857981c]

	* NEWS, TODO, configure.in:
	0.99.7 out
	[7bd8508ed0fa]

	* src/lib/hash.c:
	Still more fixes
	[d9df59a406fb]

	* src/lib-index/maildir/maildir-sync.c:
	Don't call hash_remove() if it isn't there.
	[d634f81c1217]

	* src/lib/hash.c:
	Removed the collision table, it was a bad idea and was buggy when
	nodes were removed.
	[0857c8c7ddf9]

	* src/lib/restrict-access.c:
	Don't check for dropped root gid privileges if our uid is still
	root.
	[91b9d01dc79e]

	* doc/index.txt:
	updated
	[0e7f5f4751d3]

	* doc/design.txt, doc/index.txt, doc/multiaccess.txt:
	updates
	[13f27425cb88]

	* src/lib-storage/mail-thread.c:
	Compiler warning fix
	[eac32e0caeb9]

2003-01-13  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy-openssl.c:
	um. now a correct fix :)
	[4102bebc7411]

	* src/login/ssl-proxy-openssl.c:
	compile error
	[89e736d2247f]

	* NEWS, TODO, configure.in:
	0.99.6 out
	[6f005d5d9931]

	* src/lib-storage/mail-sort.c:
	bugfix
	[951c022b9f8f]

	* src/lib-imap/imap-message-cache.c:
	Caching was a bit broken, it sometimes used free'd context memory.
	[b27b8614d81b]

	* src/lib-storage/index/index-search.c:
	SEARCH didn't properly complain about invalid messagesets. high:low
	never worked (it was recently changed for other commands). "*" in
	UID set didn't actually match for last uid, but last sequence
	number..
	[3b139ccc1858]

	* src/lib-charset/charset-utf8.c:
	Didn't compile without iconv.
	[41b6754c2e35]

	* src/lib-storage/mail-thread.c:
	Some fixes
	[48c5ea7477fe]

	* src/lib-imap/imap-base-subject.c:
	Blobs weren't removed correctly, resulting in incorrect SORT SUBJECT
	and THREAD results.
	[f66455b629cd]

	* src/lib-mail/message-date.c:
	Handle one-digit hour in dates.
	[2c7a2d90e0cb]

	* src/lib/hash.c:
	hash_resize() leaked memory, hash_insert/update didn't update value
	for existing nodes.
	[c1a97fc30d1c]

2003-01-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c:
	minor optimization
	[26cafa3dc09c]

	* src/lib-imap/imap-message-cache.c:
	If we couldn't get message_part for any reason, don't crash.
	[1fd572d68422]

	* src/lib-index/mbox/mbox-sync-full.c, src/lib-mail/message-part-
	serialize.c, src/lib-mail/message-part-serialize.h:
	Do some more sanity checking when updating cached message_part. If
	anything fails, log the error and set index corrupted.
	[f7d0209bb7a6]

2003-01-11  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cyrus-sasl2.c, src/auth/auth-digest-md5.c, src/auth
	/auth-plain.c, src/auth/auth.c, src/auth/auth.h, src/auth/cookie.h,
	src/auth/userinfo-passwd-file.c, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-list.c, src/imap/commands.c,
	src/imap/commands.h, src/lib-imap/imap-message-cache.c, src/lib-
	index/mail-index-update.c, src/lib-index/mail-index-util.c, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-append.c, src
	/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src
	/lib-index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-header-decode.c, src/lib-mail/message-header-decode.h, src
	/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	mail/message-tokenize.c, src/lib-mail/message-tokenize.h, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-
	messageset.c, src/lib-storage/index/index-messageset.h, src/lib-
	storage/index/index-update-flags.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-list.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-search.c, src/lib-storage/mail-
	search.h, src/lib-storage/mail-sort.c, src/lib-storage/mail-
	storage.h, src/lib-storage/mail-thread.c, src/lib-storage
	/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h, src/lib/failures.c,
	src/lib/failures.h, src/lib/file-lock.c, src/lib/file-lock.h,
	src/lib/hash.c, src/lib/hash.h, src/lib/ioloop-internal.h, src/lib
	/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	src/lib/ioloop.h, src/lib/iostream-internal.h, src/lib/iostream.c,
	src/lib/istream-data.c, src/lib/istream-file.c, src/lib/istream-
	mmap.c, src/lib/istream.c, src/lib/istream.h, src/lib/ostream-
	file.c, src/lib/ostream.c, src/lib/ostream.h, src/login/auth-
	connection.c, src/login/auth-connection.h, src/login/common.h,
	src/login/master.c, src/login/master.h, src/master/auth-process.c,
	src/master/auth-process.h, src/master/ssl-init.c:
	Naming change for function typedefs.
	[411006be3c66]

	* configure.in, src/imap/cmd-thread.c, src/lib-storage/mail-thread.c:
	We support only REFERENCES threading for now - updated capability
	and trying to use ORDEREDSUBJECT now gives error.
	[5c8cd0bf94c1]

	* src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort.c, src/lib-storage/index/index-sort.h:
	SORT and THREAD didn't work with sequence numbers at all. SEARCH was
	also a bit broken with it if another session had deleted messages
	which we hadn't yet told to client.
	[6f1e87a51872]

	* src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort.c, src/lib-storage/mail-sort.c, src/lib-storage/mail-sort.h:
	SORT optimization. It now uses memory to store one or two of the
	sort criteria items. Should be "fast enough" now, sorting ~4000
	messages doesn't take hardly any time.
	[ceb3ea5e1a2a]

	* src/lib/hash.c, src/lib/hash.h:
	hash_clear() can now be used to drop the memory allocated using
	node_pool.
	[e601f13d95b1]

	* src/lib-index/mail-index.h:
	We don't actually need to reserve the highest UID anymore, don't do
	it :)
	[70083370cc84]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If ~/mail isn't found, create it.
	[f5658274245f]

	* src/lib/hash.c:
	Few fixes
	[3681ff89f0e2]

	* COPYING, src/auth/cookie.c, src/auth/userinfo-passwd-file.c, src
	/lib-index/maildir/maildir-sync.c, src/lib-storage/mail-thread.c,
	src/lib/hash.c, src/lib/hash.h, src/login/auth-connection.c,
	src/login/client.c, src/master/login-process.c, src/master/main.c:
	Rewrote hash table code, works with less memory now. Also some
	memory allocation fixes to thread extension code.
	[501f076f2e74]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool.h:
	Added alloconly_pool field for checking if pool supports free()
	[4f38538aa4a1]

2003-01-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-system.c:
	compiling fix
	[9a011e9e7070]

	* src/lib/hash.c, src/lib/hash.h:
	whops, shouldn't have been committed.
	[fbd907ad9b27]

	* src/lib-imap/imap-parser.c, src/lib/buffer.c, src/lib/hash.c,
	src/lib/hash.h, src/lib/imem.c, src/lib/imem.h, src/lib/ioloop-
	poll.c, src/lib/istream-file.c, src/lib/mempool-alloconly.c, src/lib
	/mempool-datastack.c, src/lib/mempool-system.c, src/lib/mempool.h,
	src/lib/ostream-file.c:
	Added old_size parameter to p_realloc() - we rarely need it and this
	way each allocation takes 8 bytes less memory.
	[4d6b69558add]

	* src/lib-index/mail-index-data.c:
	A few more sanity checks.
	[65639e7a7cb0]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c:
	index_storage_sync_and_lock() didn't set lock notify function.
	[24b64302f59c]

	* src/lib-index/mbox/mbox-lock.c:
	Don't crash if lock_notify_func isn't set.
	[54e2ef691f93]

	* src/imap/cmd-status.c:
	STATUS reply didn't quote the mailbox name, which broke it if it
	contained spaces.
	[b6a15094b8e1]

	* src/lib-storage/mail-thread.c:
	Duplicate handling was incorrect.
	[ced60aed95bb]

	* src/lib-mail/message-date.c, src/lib-storage/index/index-search.c,
	src/lib-storage/index/index-sort.c:
	Even more rfc822 date timezone fixes
	[bd2d99a3d601]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-thread.c,
	src/lib-storage/mail-thread.h:
	Fixes, seems to work properly now. Much faster too.
	[d0f8479f7b78]

	* src/lib-mail/message-date.c:
	Timezones were still being parsed wrong
	[19e0c6aa8847]

2003-01-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-date.c:
	Timezone parsing was broken.
	[ac69cabf9568]

	* src/lib-index/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-
	index/mail-tree.c:
	Make sure hdr->used_file_size isn't too small.
	[d458f318ab02]

	* src/auth/auth-digest-md5.c, src/auth/auth-interface.h, src/auth
	/auth-plain.c, src/login/auth-connection.c, src/login/auth-
	connection.h, src/login/client-authenticate.c, src/login/client.c,
	src/login/client.h:
	Log username with logins. auth/login processes are getting a bit
	kludgy..
	[fdcc1cab13ff]

	* src/master/login-process.c:
	Don't leak fds in case of errors.
	[a763b3826762]

	* src/login/client-authenticate.c, src/login/client.c,
	src/login/client.h:
	AUTHENTICATE command was broken.
	[0da2cb9368f6]

	* src/lib/ostream.c:
	Remove one of the previous speedups, it broke things
	[935d0b1df754]

2003-01-08  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Write "Dovecot starting up" to log file.
	[274c722acc35]

	* src/auth/main.c, src/auth/master.c, src/login/main.c,
	src/login/master.c, src/master/auth-process.c, src/master/login-
	process.c:
	Auth and login processes send an "we're ok" reply at the end of
	initialization. If the process dies before master receives that
	reply, it shutdowns itself. Usually this is because of some
	configuration error and it's not nice to start spamming the log
	files.
	[2e649dec0f09]

	* AUTHORS, COPYING, src/imap/Makefile.am, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/imap/cmd-thread.c, src/imap/cmd-uid.c,
	src/imap/commands.c, src/imap/commands.h, src/lib-imap/imap-base-
	subject.c, src/lib-imap/imap-base-subject.h, src/lib-
	storage/Makefile.am, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-sort.c, src/lib-storage/index/index-sort.h, src
	/lib-storage/index/index-storage.h, src/lib-storage/mail-sort.c, src
	/lib-storage/mail-sort.h, src/lib-storage/mail-storage.h, src/lib-
	storage/mail-thread.c, src/lib-storage/mail-thread.h:
	THREAD=REFERENCES implementation. Doesn't crash, but I'm not sure
	how correct replies it produces :)
	[4f697dde0fca]

	* src/lib-index/mail-index.h:
	Reserve UID 2^31-1
	[b71883ef0247]

	* src/lib-imap/imap-parser.h:
	comment fix
	[a9a7e57064df]

	* src/lib-mail/message-tokenize.c, src/lib-mail/message-tokenize.h:
	Added message_tokenize_get_parse_position()
	[b9875966b09d]

	* src/lib/ostream-file.c, src/lib/ostream.c:
	Minor speed optimizations
	[30babf122f97]

2003-01-07  Timo Sirainen  <tss@iki.fi>

	* src/login/Makefile.am, src/login/client-authenticate.c, src/login
	/client-authenticate.h, src/login/client.c, src/login/client.h:
	Login process now uses the same imap-parser as the imap process
	itself. This fixes the problem of literals not working before
	logging in.
	[5ebec31b49e0]

	* src/lib/istream-file.c, src/lib/istream-internal.h,
	src/lib/istream.c:
	Removed cr_lookup_pos optimization with i_stream_next_line(). It
	breaks if the stream is used with anything else and it's probably
	not worth fixing.
	[23b42ffe8756]

	* src/auth/Makefile.am:
	missing auth-mech-desc.h
	[5f52674b3a58]

2003-01-06  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy-openssl.c:
	didn't compile
	[5580b1a00e18]

	* src/lib/fdpass.c:
	Still some fixes, I broke Solaris 8.
	[f33a139029db]

	* src/lib-index/mail-index-update.c, src/lib-mail/message-part-
	serialize.c, src/lib-mail/message-part-serialize.h, src/lib-
	storage/index/index-msgcache.c:
	message_part_deserialize() now verifies that the data is valid so we
	don't later crash to some assert.
	[fe0ba77d5506]

	* src/lib-imap/imap-bodystructure.c:
	minor cleanup
	[f8e189e8a98e]

	* src/login/auth-connection.c, src/login/auth-connection.h, src/login
	/client-authenticate.c:
	If authentication was aborted by user, we didn't clean it up
	properly.
	[ee0b3d18edd4]

	* src/master/main.c:
	Call login_process_abormal_exit() only if it was login processes
	that died..
	[7f92d2100795]

	* src/lib/fdpass.c:
	fd_read() fixes, hopefully works better now.
	[e757c5fab691]

	* src/imap/rawlog.c:
	compile fix
	[9d1076e7c090]

	* configure.in, src/lib/compat.h:
	Use separate check for uint_fast32_t.
	[bc55266563cd]

2003-01-05  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/auth/auth-cyrus-sasl2.c,
	src/auth/auth-digest-md5.c, src/auth/auth-interface.h, src/auth
	/auth-mech-desc.h, src/auth/auth-plain.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/login-connection.c, src/auth/userinfo.c,
	src/login/auth-connection.c, src/login/auth-connection.h, src/login
	/client-authenticate.c, src/master/auth-process.c,
	src/master/settings.c, src/master/settings.h:
	Initial support for Cyrus SASL 2 library. I couldn't get it to work
	yet though :)
	[218e68ab290d]

	* src/lib-storage/mail-sort.h, src/lib-storage/mail-storage.h:
	"ISO C forbids forward references to enum types"
	[b176f913d092]

	* src/auth/userinfo-passwd-file.c:
	Don't try looking for plaintext user from all realms. It didn't seem
	to work before and it's probably not a good idea.
	[2d6db119ca9a]

	* doc/auth.txt:
	Updates to MD5 passwords.
	[77a0eb2b5397]

	* configure.in, src/auth/auth-digest-md5.c, src/auth/auth-interface.h,
	src/auth/auth-plain.c, src/auth/auth.c, src/auth/auth.h,
	src/auth/common.h, src/auth/cookie.c, src/auth/cookie.h, src/auth
	/login-connection.c, src/auth/login-connection.h, src/auth/main.c,
	src/auth/master.c, src/auth/userinfo-pam.c, src/auth/userinfo-
	passwd-file.c, src/auth/userinfo-passwd.c, src/auth/userinfo-
	passwd.h, src/auth/userinfo-shadow.c, src/auth/userinfo-vpopmail.c,
	src/auth/userinfo.c, src/auth/userinfo.h, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-append.c, src/imap/cmd-
	authenticate.c, src/imap/cmd-capability.c, src/imap/cmd-check.c,
	src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-delete.c, src/imap/cmd-examine.c, src/imap/cmd-
	expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c, src/imap/cmd-
	login.c, src/imap/cmd-logout.c, src/imap/cmd-lsub.c, src/imap/cmd-
	noop.c, src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap/cmd-
	select.c, src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-
	store.c, src/imap/cmd-subscribe.c, src/imap/cmd-uid.c, src/imap/cmd-
	unsubscribe.c, src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.h, src/imap/common.h, src/imap/mail-storage-
	callbacks.c, src/imap/main.c, src/imap/rawlog.c, src/lib-charset
	/charset-iconv.c, src/lib-charset/charset-utf8.c, src/lib-charset
	/charset-utf8.h, src/lib-imap/imap-base-subject.c, src/lib-imap
	/imap-base-subject.h, src/lib-imap/imap-bodystructure.c, src/lib-
	imap/imap-bodystructure.h, src/lib-imap/imap-envelope.c, src/lib-
	imap/imap-envelope.h, src/lib-imap/imap-match.c, src/lib-imap/imap-
	match.h, src/lib-imap/imap-message-cache.c, src/lib-imap/imap-
	message-cache.h, src/lib-imap/imap-parser.c, src/lib-imap/imap-
	parser.h, src/lib-imap/imap-quote.c, src/lib-imap/imap-quote.h, src
	/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src/lib-index/mail-
	custom-flags.c, src/lib-index/mail-custom-flags.h, src/lib-index
	/mail-index-compress.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index-data.h, src/lib-index/mail-index-fsck.c, src/lib-
	index/mail-index-open.c, src/lib-index/mail-index-update-cache.c,
	src/lib-index/mail-index-update.c, src/lib-index/mail-index-util.c,
	src/lib-index/mail-index-util.h, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/mail-lockdir.c, src/lib-index
	/mail-lockdir.h, src/lib-index/mail-modifylog.c, src/lib-index/mail-
	modifylog.h, src/lib-index/mail-tree-redblack.c, src/lib-index/mail-
	tree.c, src/lib-index/mail-tree.h, src/lib-index/maildir/maildir-
	build.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-rebuild.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-lock.h, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-full.c, src
	/lib-index/mbox/mbox-sync.c, src/lib-mail/Makefile.am, src/lib-mail
	/message-address.c, src/lib-mail/message-address.h, src/lib-mail
	/message-body-search.c, src/lib-mail/message-body-search.h, src/lib-
	mail/message-content-parser.c, src/lib-mail/message-date.c, src/lib-
	mail/message-date.h, src/lib-mail/message-header-decode.c, src/lib-
	mail/message-header-search.c, src/lib-mail/message-header-search.h,
	src/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src
	/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-mail/message-send.c, src/lib-mail/message-
	send.h, src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	src/lib-mail/message-tokenize.c, src/lib-mail/message-tokenize.h,
	src/lib-mail/quoted-printable.c, src/lib-mail/quoted-printable.h,
	src/lib-mail/rfc822-address.c, src/lib-mail/rfc822-address.h, src
	/lib-mail/rfc822-date.c, src/lib-mail/rfc822-date.h, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-expunge.c,
	src/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h, src/lib-
	storage/index/index-mailbox-check.c, src/lib-storage/index/index-
	messageset.c, src/lib-storage/index/index-messageset.h, src/lib-
	storage/index/index-msgcache.c, src/lib-storage/index/index-save.c,
	src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort.c, src/lib-storage/index/index-sort.h, src/lib-storage/index
	/index-status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-expunge.c, src/lib-storage/index/maildir/maildir-list.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-expunge.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-search.c, src/lib-storage/mail-search.h, src/lib-
	storage/mail-sort.c, src/lib-storage/mail-sort.h, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h, src/lib/base64.c,
	src/lib/base64.h, src/lib/buffer.c, src/lib/buffer.h,
	src/lib/compat.h, src/lib/data-stack.c, src/lib/env-util.c,
	src/lib/failures.h, src/lib/hash.c, src/lib/hash.h, src/lib/hex-
	binary.c, src/lib/hex-binary.h, src/lib/imem.c, src/lib/imem.h,
	src/lib/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/iostream-
	internal.h, src/lib/iostream.c, src/lib/istream-data.c, src/lib
	/istream-file.c, src/lib/istream-internal.h, src/lib/istream-mmap.c,
	src/lib/istream.c, src/lib/istream.h, src/lib/lib.h,
	src/lib/macros.h, src/lib/md5.c, src/lib/md5.h, src/lib/mempool-
	alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-system.c,
	src/lib/mempool.h, src/lib/network.c, src/lib/network.h, src/lib
	/ostream-file.c, src/lib/ostream-internal.h, src/lib/ostream.c,
	src/lib/ostream.h, src/lib/str.c, src/lib/str.h,
	src/lib/strescape.c, src/lib/strescape.h, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/login/auth-connection.c, src/login/auth-
	connection.h, src/login/client-authenticate.c, src/login/client-
	authenticate.h, src/login/client.c, src/login/client.h,
	src/login/main.c, src/login/master.c, src/login/master.h, src/login
	/ssl-proxy-gnutls.c, src/login/ssl-proxy-openssl.c, src/master/auth-
	process.c, src/master/auth-process.h, src/master/common.h,
	src/master/imap-process.c, src/master/login-process.c,
	src/master/main.c, src/master/master-interface.h,
	src/master/settings.c, src/master/settings.h, src/master/ssl-init.c:
	Naming style changes, finally got tired of most of the typedefs.
	Also the previous enum -> macro change reverted so that we don't use
	the highest bit anymore, that's incompatible with old indexes so
	they will be rebuilt.
	[fd8888f6f037]

	* src/auth/userinfo-passwd-file.c:
	':' -> '@' change was buggy
	[5043e48c022f]

2003-01-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/macros.h:
	If PEDANTIC is defined, don't use (void)(..) with STMT_START/END.
	[a225abf5f479]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	Replaced MailDataField from being enum to being unsigned int with
	values defined with macros. Not that pretty, but enums are signed
	integers and we want to use the highest bit without ugly kludges.
	[981a359257bb]

	* src/lib-storage/index/index-fetch-section.c, src/lib/ioloop-poll.c,
	src/lib/ioloop.c:
	Misc. compiler warning fixes.
	[d3075affded9]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-imap/imap-base-subject.c, src/lib-imap/imap-bodystructure.c,
	src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	imap/imap-message-cache.c, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-quote.c, src/lib-imap/imap-quote.h, src/lib-imap/imap-util.h,
	src/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-from.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-mail/message-body-search.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-header-search.c, src/lib-mail/message-parser.c, src/lib-
	mail/message-parser.h, src/lib-mail/rfc822-address.c, src/lib-
	mail/rfc822-address.h, src/lib-mail/rfc822-date.c, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/index/index-fetch-section.c, src/lib-storage/index/index-
	search.c, src/lib-storage/mail-sort.c, src/lib/imem.c,
	src/lib/imem.h, src/lib/istream-data.c, src/lib/istream.h,
	src/lib/str.c, src/lib/str.h, src/lib/strescape.c,
	src/lib/strescape.h, src/lib/strfuncs.c, src/lib/strfuncs.h,
	src/login/client-authenticate.c, src/login/ssl-proxy-gnutls.c:
	Use unsigned char* when accessing non-NUL terminating strings.
	Compiler warnings would then notify about accidentally passing them
	to functions which require them NUL-terminated. Changed a few
	functions to use void* to avoid unneeded casting.
	[0d5be52d7131]

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/rfc822-address.c, src/lib-mail/rfc822-date.c,
	src/lib-mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h:
	Rfc822 tokenizer cleanups
	[e27267f227e6]

2003-01-03  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c, src/lib-imap/imap-bodystructure.c, src/lib-imap
	/imap-parser.c, src/lib-imap/imap-util.c, src/lib-imap/imap-util.h,
	src/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-index.c,
	src/lib-mail/message-body-search.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-header-search.c, src/lib-mail/message-parser.c, src/lib-
	mail/message-parser.h, src/lib-mail/rfc822-address.c, src/lib-
	mail/rfc822-date.c, src/lib-mail/rfc822-date.h, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/index/index-fetch-section.c, src/lib-storage/index/index-
	search.c, src/lib/Makefile.am, src/lib/strescape.c,
	src/lib/strescape.h, src/lib/strfuncs.c, src/lib/strfuncs.h,
	src/login/client.c:
	Rewrote rfc822-tokenize.c to work one token at a time so it won't
	uselessly take memory, maybe also a bit faster. This caused pretty
	large changes all around.

	Also moved all string (un)escaping code to lib/strescape.c.
	[21ffcce83c70]

	* src/auth/auth-digest-md5.c:
	s/qop-options/qop/, fixes compatibility problem with Cyrus SASL
	library.
	[68c46e7faf4f]

2003-01-02  Timo Sirainen  <tss@iki.fi>

	* src/lib/process-title.c:
	Include unistd.h for setproctitle(), FreeBSD wants it.
	[efe7c015dd78]

	* NEWS, configure.in:
	Getting ready for 0.99.5 release..
	[4f619b97ee65]

	* README, TODO:
	updates
	[80b847900dfd]

	* src/imap/commands-util.c:
	Handle the MAILBOX_NAME_NOINFERIORS case.
	[fd754a6fa784]

	* src/lib-storage/index/mbox/mbox-storage.c:
	CREATE and RENAME should create the folder hierarchy if needed.
	SELECTing a folder gives now prettier error message.
	[079a620c0261]

	* src/lib-storage/mail-storage.h:
	comment updates
	[f6e6812bd872]

	* src/imap/cmd-create.c:
	CREATE mailbox<hierarchy separator> failed always.
	[986e89b61520]

	* src/lib-storage/index/index-fetch-section.c:
	The ending \r\n is message header shouldn't be filtered with FETCH
	BODY[HEADER.FIELDS...].
	[06776a31f50c]

	* src/imap/cmd-list.c:
	Handle LIST A B same way as LIST "" A.B
	[3a4f468a53c6]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h:
	Make sure UIDs won't wrap around unexpectedly.
	[1b3c679d2c6d]

	* src/lib-imap/imap-util.c:
	imap_escape() was broken
	[c5897896c4f1]

	* src/imap/cmd-close.c, src/imap/cmd-search.c, src/imap/commands-
	util.c, src/lib-storage/index/index-messageset.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Storage can now specify if errors should be sent to user as BAD or
	NO. Some changes to messageset parsing as specified by latest
	IMAP4rev1 draft. Bad charset error is prefixed with [BADCHARSET].
	Fixed a crash in SEARCH the last commit in it caused.
	[39e0b536e708]

	* dovecot-example.conf, src/lib-index/maildir/maildir-sync.c:
	Changed maildir_check_content_changes = yes now to treat the message
	as new because IMAP protocol specifies that existing messages are
	immutable.
	[38b3bc6ddcc4]

	* src/lib-storage/index/index-search.c:
	comment update
	[fe91b60fdb7c]

	* src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-sort.c:
	SEARCHing headers with "" value should always match if the header is
	found. Changed imap_envelope_parse() so that it's possible to
	differentiate NIL from "".
	[d5168cca2052]

	* src/imap/cmd-select.c:
	Added UIDNEXT reply to SELECT/EXAMINE, as required by latest
	IMAP4rev1 draft.
	[488a4c4bcabb]

	* src/lib-imap/imap-parser.h:
	Actually, don't allow NIL with IMAP_ARG_LIST().
	[cc1cf8161203]

	* src/imap/cmd-append.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/commands-util.c, src/lib-imap/imap-bodystructure.c, src
	/lib-imap/imap-envelope.c, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-parser.h, src/lib-storage/mail-search.c:
	Don't access ImapArg's union members directly - too easy to mess up.
	Fixes a crash with feeding non-string parameters to SEARCH/SORT
	commands.
	[7935347f54f1]

2002-12-29  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	If ssl_disable is set to yes and we get SIGHUPed, don't feed the
	listening socket to login processes anymore or they'll just keep
	dying. We still don't actually close the socket though..
	[ad8f7d2107b4]

	* src/master/settings.c:
	The base_dir setting was actually missing..
	[969bdb985a03]

	* src/lib-mail/message-parser.c:
	extra assert.
	[a60e12a66ad3]

	* src/lib/mmap-anon.c:
	Use void* always with munmap()
	[6c42b9c76464]

	* dovecot-example.conf, src/master/settings.c, src/master/settings.h:
	Added base_dir setting, so the configure time --localstatedir can be
	overridden.
	[6377d4f7a31c]

2002-12-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	more fixes
	[28212c00d147]

	* src/lib/fdpass.c:
	Fixed to work with 64bit BSD systems.
	[971947c0034f]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Complain about missing mbox file.
	[2873d04a566e]

	* src/master/imap-process.c:
	default_mail_env wasn't actually working.
	[c0048f0ef101]

	* src/master/main.c:
	Forgot to handle FATAL_LOGERROR.
	[e1656057b9a5]

	* src/lib/failures.c, src/lib/failures.h:
	In case of internal errors in logging, exit() with FATAL_LOGERROR.
	[43a42c16bba8]

	* src/lib/printf-upper-bound.c:
	Allow %m in printf_string_upper_bound(). Fixes syslog failure
	handler.
	[8676ba4f3ba9]

	* src/lib/process-title.c:
	setproctitle() needs stdlib.h
	[a090577ffdca]

	* src/lib/mmap-anon.c:
	Keep the mmap()ed area far from heap.
	[8ecfe2c250ee]

2002-12-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	BODYSTRUCTURE reply was incorrect. pine didn't like it.
	[375923d2f910]

	* configure.in, src/login/client.c:
	Show STARTTLS in capability only if SSL support is enabled.
	[7498eab8903f]

	* TODO:
	updated
	[c3d0eddd6065]

	* configure.in, src/lib/failures.c, src/lib/macros.h, src/lib/str.c,
	src/lib/strfuncs.c:
	We weren't using va_list properly, especially gcc/PowerPC didn't
	like it.
	[c4754c5770f3]

	* src/lib/mmap-anon.c:
	Old implementation was overly complex and stupid.
	[8f4bd02461e0]

	* src/lib/data-stack.c, src/lib/mempool-alloconly.c, src/lib/mempool-
	datastack.c, src/lib/mempool-system.c, src/lib/mempool.h:
	Removed pool->realloc_min() which nothing used. A few small fixes to
	alloc-only pool.
	[3d437b1e5257]

	* src/lib-imap/imap-message-cache.c, src/lib-mail/message-parser.c,
	src/lib-mail/message-send.c, src/lib-mail/message-size.c, src/lib-
	mail/message-size.h:
	Some bugfixes and speedups for partial fetch handling.
	[e49f7397af98]

	* src/lib-imap/imap-message-cache.c:
	Caching IMAP_CACHE_MESSAGE_PART failed if it was already in cache.
	[c77a8b9fb3ef]

2002-12-22  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-passwd.c:
	Always compile in passwd_fill_cookie_reply(), it's used by pretty
	much all auth modules.
	[89f1e0a754f0]

	* src/lib-storage/index/Makefile.am:
	missing index-sort.h
	[a9c273854dd2]

	* TODO:
	updated
	[a327862d07c0]

	* src/lib/buffer.c:
	Several fixes. I think it's beginning to look safe.
	[e73389a2324a]

	* configure.in:
	Enable more warnings with gcc
	[a6f53dbe803f]

	* src/master/settings.h:
	removed double declaration
	[55a2bac7b74a]

	* src/lib-storage/index/index-fetch-section.c:
	A bit more const'ing.
	[b19889528486]

	* src/auth/auth-digest-md5.c, src/auth/auth.c, src/auth/auth.h,
	src/auth/userinfo-passwd-file.c, src/lib-index/mbox/mbox-lock.c, src
	/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-storage.c, src/lib/strfuncs.c, src/lib/strfuncs.h, src/master
	/imap-process.c, src/master/settings.c:
	t_strsplit() returns now const char **, which removes a few nasty
	casts. Removed a few unneded functions and did some small cleanups.
	[7f41a4b33975]

	* src/lib/failures.c:
	info log was broken
	[8144e1025bda]

	* src/auth/auth-digest-md5.c:
	Use larger initial pool size
	[98cde3d3ab1d]

	* src/lib-storage/index/index-fetch.c:
	Don't send \0 char in FETCH replies..
	[bea83e599761]

	* configure.in:
	EXTRA_CFLAGS environment is now added to CFLAGS after all tests.
	Useful for adding -Werror there.
	[e9a5ce16f0f3]

	* src/lib/strfuncs.c:
	_vstrconcat() is now faster
	[42176571725b]

	* src/lib/data-stack.c:
	t_try_realloc() wasn't working right with DISABLE_DATA_STACK.
	[e3a979b1b55d]

	* src/lib-index/mail-index-update.c:
	Use larger initial pool size for MailIndexUpdate.
	[481a678ba019]

	* COPYING, src/lib/Makefile.am, src/lib/data-stack.c,
	src/lib/failures.c, src/lib/imem.c, src/lib/imem.h, src/lib/mempool-
	alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-system.c,
	src/lib/printf-upper-bound.c, src/lib/printf-upper-bound.h,
	src/lib/str.c, src/lib/strfuncs.c, src/lib/strfuncs.h,
	src/master/settings.c:
	String function cleanups. Allocating 0 bytes of memory is treated as
	error now, it could be an integer overflow. Moved
	printf_string_upper_bound() to it's own file, so strfuncs.c can be
	with MIT license.
	[34cb1d196d2b]

	* src/lib/compat.c, src/lib/failures.c:
	Don't leak data stack memory.
	[a6cd073c5283]

	* src/lib/compat.c, src/lib/data-stack.c, src/lib/failures.c,
	src/lib/str.c, src/lib/strfuncs.c:
	Use vsnprintf() always when possible, even if we went through the
	upper_bound function. DEBUG message in data stack might have
	sometimes caused an infinite loop. Made sure infinite loops don't
	happen anymore with failure handlers. str_printfa() didn't handle
	%m. Made my_vsyslog() a lot simpler, since t_strdup_printf() is now
	safe enough to call in failure handler.
	[ec6dd72cb8e3]

	* src/lib-index/mail-index-data.h, src/lib-index/mail-index-util.h,
	src/lib-index/mail-index.c, src/lib-index/mail-tree.h:
	Added some missing format attribute declarations. And fixed one more
	bug found found with them.
	[eefa28ef9646]

	* configure.in, src/lib-storage/index/index-storage.c,
	src/lib/failures.c:
	Compile with -Wformat-nonliteral now. Found a format string bug with
	it :( But lucky for us, we haven't allowed %n in format strings for
	a few months now and those bugs were added after that. So arbitrary
	code execution vulnerabilities count is still zero :)
	[91d7ee63a0b5]

	* src/lib/str.c:
	Removed @UNSAFE tag, it's not anymore.
	[64a7dc694b60]

	* src/auth/auth-digest-md5.c, src/imap/cmd-select.c, src/imap/cmd-
	status.c, src/imap/commands-util.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	envelope.h, src/lib-imap/imap-message-cache.c, src/lib-imap/imap-
	quote.c, src/lib-imap/imap-util.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/mbox/mbox-from.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-mail/rfc822-address.c, src/lib-storage/index
	/index-fetch-section.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-fetch.h, src/lib/Makefile.am,
	src/lib/lib.h, src/lib/str.c, src/lib/str.h, src/lib/strfuncs.h,
	src/lib/temp-string.c, src/lib/temp-string.h, src/login/client-
	authenticate.c, src/master/imap-process.c:
	Replaced TempString with a String which can use any memory pool and
	uses Buffer internally.
	[41ec8cadd238]

	* src/lib/buffer.c:
	whops, reverted unwanted changes
	[e1ca4ef76ab4]

2002-12-21  Timo Sirainen  <tss@iki.fi>

	* src/lib/buffer.c:
	Last update broke used size.
	[0ae9b03a0f05]

	* src/lib/buffer.c:
	Fixed several bugs, added a small testsuite. Still requires careful
	auditing.
	[27774d0493dd]

	* src/lib/ioloop-select.c:
	Don't define FD_SETSIZE actually, it should exist and it can be less
	than 1024 we used..
	[56bbee9df6f4]

	* src/lib-storage/index/mbox/mbox-storage.c:
	We couldn't delete mbox folders.
	[774f32498a7f]

	* src/lib/ioloop-select.c:
	select() based I/O-loop: Kill ourself if we're trying to use more
	than FD_SETSIZE (1024) fds. Before we just overflowed fd_set buffer,
	but it's unlikely it could have been exploited. Default settings
	prevented this from happening anyway.
	[0450b8c216e8]

	* src/lib/mempool-alloconly.c:
	DEBUG: warn when growing pool
	[ca927eb6202f]

	* src/auth/auth-digest-md5.c, src/auth/userinfo-passwd-file.c,
	src/imap/cmd-list.c, src/imap/cmd-search.c, src/imap/cmd-sort.c, src
	/lib-imap/imap-message-cache.c, src/lib-imap/imap-parser.c, src/lib-
	index/mail-index-update.c, src/lib-index/maildir/maildir-sync.c, src
	/lib-storage/index/index-search.c, src/lib-storage/mail-sort.c,
	src/lib/Makefile.am, src/lib/env-util.c, src/lib/imem.c, src/lib
	/mempool-alloconly.c, src/lib/mempool.c, src/lib/mempool.h:
	We don't have separate read-write pools, so renamed pool_create(..,
	FALSE) to pool_alloconly_create().
	[8afbafd5deac]

	* src/master/settings.c, src/master/ssl-init.c:
	Make sure SSL parameters file has correct permissions before using
	it. Also use effective uid/gid for checking the base dir, don't
	assume roots..
	[02cda88b44e2]

	* src/lib/safe-mkdir.c:
	Whops, should have tested it :) Mode check always failed.
	[d00ce0e4de7f]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib/Makefile.am, src/lib/safe-mkdir.c, src/lib
	/safe-mkdir.h, src/lib/unlink-directory.c, src/lib/unlink-
	directory.h, src/master/settings.c:
	If used base/login directories exist already, make sure they're with
	correct permissions. Always delete contents in login directory at
	startup.

	Added safe_mkdir(). changed unlink_directory() behaviour, and fixed
	a race condition which could have made it follow symlinks to other
	directories and delete them. Didn't really harm us so far, we never
	used it for deleting unsafe directories.
	[5101f8bf2368]

	* src/lib-index/mbox/mbox-lock.c:
	Check mbox .lock files with lstat(), not stat(). Just paranoia,
	O_EXCL prevented us from overwriting symlink destinations anyway.
	[9929883228a4]

	* src/lib-storage/index/index-status.c:
	Better checking for corrupted first_unseen_uid_lowwater.
	[9bcd3cc068a5]

	* src/lib-index/mail-index-fsck.c:
	fsck updated first_unseen_uid_lowwater wrong, which caused SELECT or
	EXAMINE to print wrong [UNSEEN seq] tag, or sometimes complain about
	corrupted indexes.
	[ee8acb990752]

	* src/lib-index/mbox/mbox-rewrite.c:
	Don't fsck index after we've rewritten mbox - that doesn't gain us
	anything. Rather just make sure the index's timestamp differs from
	mbox file.
	[3d8767d31fe2]

2002-12-20  Timo Sirainen  <tss@iki.fi>

	* doc/mail-storages.txt, dovecot-example.conf, src/lib-index/mail-
	index.h, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-rebuild.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/mbox/mbox-append.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-lock.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-expunge.c, src
	/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.h, src/lib/unlink-directory.c:
	Added :INDEX=<dir> for both Maildir and mbox to specify different
	location where to store index files. This would allow keeping
	mailboxes accessible through NFS but still keep the indexes in fast
	local disk.

	Did also some other related cleanups and minor fixes.
	[86cf24da85f1]

	* src/lib-index/maildir/maildir-index.c:
	We got into memory eating loop if maildir file contained unknown
	flags.
	[ae9b55f7164e]

	* doc/mail-storages.txt, dovecot-example.conf, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.h:
	Support for separate location of mbox INBOX folder.
	[ef64c9a50326]

	* src/login/client-authenticate.c:
	Removed extra space from capability string.
	[a6d24244c23f]

	* dovecot-example.conf, src/master/imap-process.c:
	default_mail_env behaviour changed. We use %u instead of $U now.
	Added also several other variables which can be used. Ideas based on
	David Champion's mailpath library.
	[493bc8da9e80]

	* src/lib/temp-string.c, src/lib/temp-string.h:
	t_string_append_n() should specify the maximum length for given
	string, which may be shorter than that.
	[9e6317fa800c]

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c,
	src/lib/failures.c, src/lib/failures.h, src/login/client.c,
	src/login/main.c, src/master/imap-process.c, src/master/main.c,
	src/master/settings.c, src/master/settings.h:
	Added info_log_file setting and i_info() function to write to it.
	Default is the same as failure log. Currently only logged
	information is client logins.
	[664de3231e33]

	* src/auth/auth-digest-md5.c, src/auth/auth-interface.h, src/auth
	/auth-plain.c, src/auth/auth.c, src/auth/auth.h, src/auth/cookie.c,
	src/auth/cookie.h, src/auth/login-connection.c, src/auth/main.c,
	src/auth/master.c, src/login/auth-connection.c, src/login/auth-
	connection.h, src/login/client-authenticate.c, src/login/common.h,
	src/login/main.c, src/login/master.c, src/login/master.h, src/master
	/auth-process.c, src/master/auth-process.h, src/master/common.h,
	src/master/login-process.c, src/master/main.c, src/master/master-
	interface.h, src/master/settings.c, src/master/settings.h:
	Instead of just trusting randomness of authentication cookies
	between auth<->master<->login process IPC, master now doesn't accept
	any cookies from login process which weren't created by it
	(identified by PID). When login process dies, all it's pending
	cookies are also removed, so I can't see even a theoretical
	possiblity anymore for exploited login process to authenticate as
	someone else.

	Also fixed some int -> unsigned int.
	[30f6811f4952]

2002-12-19  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c, src/lib-storage/index/mbox/mbox-list.c,
	src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Limit the mailbox path. A few cleanups.
	[27554afad17e]

	* src/auth/userinfo-pam.c:
	compile bugfix
	[574a18ea05d6]

	* src/auth/userinfo-pam.c, src/auth/userinfo-passwd-file.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-vpopmail.c, src/imap/client.c,
	src/imap/rawlog.c, src/lib-imap/imap-parser.c, src/lib-index/mail-
	index-open.c, src/lib-index/maildir/maildir-build.c, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-mail/rfc822-address.c, src/lib-storage/index/index-fetch-
	section.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-sort.c,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c,
	src/lib/hostpid.c, src/lib/mempool-alloconly.c, src/lib/network.c,
	src/lib/ostream.c, src/lib/ostream.h, src/lib/process-title.c,
	src/lib/restrict-access.c, src/lib/strfuncs.c, src/lib/strfuncs.h,
	src/lib/unlink-directory.c, src/lib/unlink-lockfiles.c,
	src/login/client.c, src/login/master.c, src/master/auth-process.c,
	src/master/imap-process.c, src/master/login-process.c,
	src/master/main.c:
	Buffer related cleanups. Use PATH_MAX instead of hardcoded 1024 for
	paths. Added str_path() and str_ppath() functions. i_snprintf() now
	returns only -1 or 0 depending on if buffer got full. dec2str()
	returns the string allocated from data stack. Instead of just
	casting to (long) or (int), we now use dec2str() with printf-like
	functions. Added o_stream_send_str(). Added strocpy() and replaced
	all strcpy()s and strncpy()s with it.

	Pretty much untested, hope it doesn't break too badly :)
	[35abd7a5d381]

2002-12-18  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-vpopmail.c:
	should use mycrypt(), not crypt().
	[5e42a1dbcd0c]

	* configure.in, src/auth/auth-digest-md5.c, src/auth/userinfo-pam.c,
	src/auth/userinfo-passwd-file.c, src/auth/userinfo-passwd.c,
	src/auth/userinfo-shadow.c, src/auth/userinfo-vpopmail.c,
	src/imap/client.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	match.c, src/lib-imap/imap-match.h, src/lib-imap/imap-message-
	cache.c, src/lib-imap/imap-parser.c, src/lib-imap/imap-util.c, src
	/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-mail/message-body-search.c,
	src/lib-mail/message-header-search.c, src/lib-mail/message-size.c,
	src/lib-mail/message-size.h, src/lib-mail/rfc822-tokenize.c, src
	/lib-storage/subscription-file/subscription-file.c,
	src/lib/buffer.c, src/lib/buffer.h, src/lib/compat.c,
	src/lib/compat.h, src/lib/data-stack.c, src/lib/hex-binary.c,
	src/lib/ioloop-poll.c, src/lib/istream-file.c, src/lib/istream.c,
	src/lib/md5.c, src/lib/mempool-alloconly.c, src/lib/mempool-
	datastack.c, src/lib/mempool-system.c, src/lib/mmap-anon.c,
	src/lib/network.c, src/lib/network.h, src/lib/ostream-file.c,
	src/lib/randgen.c, src/lib/strfuncs.c, src/lib/temp-string.c,
	src/lib/unlink-directory.c, src/login/auth-connection.c, src/login
	/client-authenticate.c, src/login/client.c, src/login/master.c,
	src/login/ssl-proxy-gnutls.c, src/login/ssl-proxy-openssl.c,
	src/master/auth-process.c, src/master/imap-process.c, src/master
	/login-process.c, src/master/main.c, src/master/settings.c,
	src/master/ssl-init.c:
	Marked all non-trivial buffer modifications with @UNSAFE tag.
	Several cleanups and a couple of minor bugfixes.
	[5ac361acb316]

	* src/auth/auth-plain.c, src/auth/login-connection.c, src/auth
	/userinfo-pam.c, src/auth/userinfo-passwd.c, src/auth/userinfo-
	passwd.h, src/auth/userinfo-shadow.c, src/auth/userinfo-vpopmail.c,
	src/lib/Makefile.am, src/lib/safe-memset.c, src/lib/safe-memset.h,
	src/login/client-authenticate.c, src/login/client.c:
	Added safe_memset() which guarantees that compiler optimizations
	don't optimize it away. Not that we really need to clear the
	passwords from memory, but won't hurt much either :)
	[bf38c8f30a4c]

	* src/lib-index/mbox/mbox-sync-full.c:
	fix warning with older gccs
	[960b35117c39]

	* src/lib/env-util.c:
	unix98 says putenv() returns non-zero for errors - check for that
	rather than just negative values.
	[681cfbf19424]

	* src/auth/main.c, src/imap/main.c, src/lib/env-util.c,
	src/lib/failures.c, src/lib/failures.h, src/lib/lib.c, src/lib
	/process-title.c, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/login/main.c, src/master/auth-process.c,
	src/master/common.h, src/master/imap-process.c, src/master/login-
	process.c, src/master/main.c:
	Drop root privileges earlier. Close syslog more later in imap-master
	when forking new processes, so that any errors get logged. Make sure
	that all errors show up in log files - use specific exit status
	codes if we can't write to log file. Make sure imap and login
	processes always drop root privileges even if master process didn't
	ask for it for some reason. putenv() wasn't verified to succeed -
	luckily we never allowed large user given data there.
	[86224ff16bf6]

	* configure.in, src/lib/restrict-access.c:
	Don't bother trying to use setreuid(), setuid() check should be
	enough and openbsd complains about it being deprecated.
	[db1608b43054]

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-util.c,
	src/lib-index/mail-index.c, src/lib-index/mail-lockdir.c, src/lib-
	index/mail-tree-redblack.c:
	Try not to split strings to multiple lines from the middle of human
	readable text. Makes it easier to grep for them.
	[41dde6822eea]

	* src/lib/data-stack.c:
	Use a bit larger initial data stack size when DEBUG is set - current
	one is too small for message searching.
	[1c67ec58f0a1]

	* src/lib-storage/index/index-status.c:
	More verbose error message when noticing problems with seen messages
	count.
	[cecf76430cac]

2002-12-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c:
	LSUB failed if there was no subscriptions file.
	[92c25daf3a78]

	* TODO:
	updated
	[bcf35cc1a56b]

	* src/lib-storage/index/mbox/mbox-list.c:
	LIST: If our root folder doesn't exists, complain about it.
	Otherwise just ignore those errors.
	[555e620ee8f1]

	* src/lib-imap/imap-base-subject.c, src/lib-imap/imap-base-subject.h:
	Forgot from last SORT commit.
	[ab093fefe04b]

	* configure.in, src/lib-charset/charset-iconv.c, src/lib-charset
	/charset-utf8.c, src/lib-charset/charset-utf8.h, src/lib-
	imap/Makefile.am, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	envelope.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-sort.c, src/lib-storage/mail-sort.c, src/lib-
	storage/mail-sort.h:
	Full not-too-well-tested support for SORT extension. Required a few
	library interface changes.
	[d573c53946ac]

	* src/auth/auth-interface.h, src/auth/userinfo-passwd-file.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-vpopmail.c, src/lib/restrict-
	access.c, src/master/auth-process.c, src/master/common.h, src/master
	/imap-process.c, src/master/login-process.c:
	Clear separation of virtual and system usernames. passwd-file didn't
	work before if the user didn't exist in system. Prefixed also all
	setuid/etc. restriction environments with RESTRICT_.
	[6efced4f80de]

	* src/lib/buffer.h:
	comment update
	[27b28ba2a306]

2002-12-16  Timo Sirainen  <tss@iki.fi>

	* src/master/imap-process.c:
	Don't crash with empty default_mail_env setting.
	[c50f9f4194d2]

	* dovecot-example.conf, src/master/settings.c:
	mailbox_check_interval is now disabled by default, at least
	Evolution breaks with it.
	[5b2a247ed361]

	* src/master/ssl-init.c:
	Don't try creating SSL parameter file when SSL is disabled.
	[31b22b4a48c9]

	* src/lib-index/maildir/maildir-index.c:
	maildir_filename_set_flags() was broken by the buffer changes. the
	base name of maildir files was lost when flags were updated.
	[c0e7bfb5bab8]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h, src/lib-mail/message-body-search.c, src
	/lib-mail/message-header-search.c:
	Don't use Buffers with read-only data, just makes it more difficult
	without gaining anything.
	[d96cbba73a8b]

	* src/lib-index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-
	append.c:
	Fixed a unnecessarily large data stack usage when indexing new
	mails.
	[2a6cc4f0c3c6]

	* src/lib-mail/Makefile.am, src/lib-mail/message-header-decode.c, src
	/lib-mail/message-header-decode.h, src/lib-mail/message-header-
	search.c, src/lib-mail/quoted-printable.c:
	Quoted-Printable decoding was buggy. Extracted RFC2047 header
	decoding into separate function.
	[d826ab8c8d62]

2002-12-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands.c:
	CHECK command was actually calling COPY, so it gave just error about
	missing parameters.
	[6699647fd049]

2002-12-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/rawlog.c, src/lib/istream-file.c, src/lib/network.c,
	src/lib/network.h, src/lib/randgen.c:
	net_receive, net_transmit: Return -2 for regular disconnection
	errors. Don't log those errors. Some other cleanups.
	[9cb7022749e7]

	* dovecot-example.conf, src/lib/network.c, src/lib/network.h,
	src/master/main.c, src/master/settings.c:
	imap_listen and imaps_listen accepts now "*" as "all IPv4
	interfaces" and "::" as "all IPv6 interfaces, plus all IPv4
	interfaces if supported by OS".

	Added a few consts to network API and added functions to get
	inaddr_any for ipv4/ipv6.
	[1cc947617c8b]

	* dovecot-example.conf, src/master/imap-process.c,
	src/master/settings.c, src/master/settings.h:
	New setting: default_mail_env which can be used to specify where to
	find users mailbox. Default is still to use autodetection.
	Authentication process can override this if needed, it's possible
	with passwd-file authentication.
	[f126b666859e]

	* src/lib-index/mbox/mbox-sync-full.c:
	Deleting messages in the middle of mbox caused dovecot to reindex
	the following messages as new messages (ie. change UIDs and set
	\Recent flag).
	[9c9d89e56514]

2002-12-10  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/ioloop-select.c:
	select() is nowadays defined to be in sys/select.h
	[a02e5e7790bb]

2002-12-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c:
	still stupid bug :) works now, tested.
	[acf904579d84]

	* src/lib-mail/message-part-serialize.c:
	still broken
	[d5a3c18c9082]

	* src/lib-index/mail-index-fsck.c:
	When printing fsck warnings, print also the index file path
	[a2eaa563f40a]

	* src/lib-mail/message-part-serialize.c:
	message_part_serialize() was broken with multipart messages.
	[5984360c231d]

	* src/auth/userinfo-passwd-file.c:
	Digest-MD5 lookup was broken.
	[68248bb9ad82]

	* src/auth/auth-digest-md5.c:
	Added missing comma between realm and nonce.
	[fff9f94f1686]

	* src/lib/base64.c:
	base64_encode() was broken
	[f28f1055e189]

	* src/imap/client.c:
	Fixed "Missing arguments" error msg to work again
	[f17a1f59ac3f]

	* src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/lib-imap/imap-bodystructure.c, src/lib-imap
	/imap-envelope.c, src/lib-imap/imap-parser.c, src/lib-imap/imap-
	parser.h:
	Limited max. command argument elements to 128. Added more verbose
	error messages to IMAP parser.
	[8b3518bb327e]

	* src/lib-storage/mail-search.c:
	Don't crash with missing search argument parameters.
	[c809378a48db]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h:
	Compiles again without iconv()
	[03832c7f389b]

2002-12-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-digest-md5.c, src/auth/auth-plain.c, src/auth
	/userinfo-passwd-file.c, src/imap/cmd-list.c, src/imap/cmd-sort.c,
	src/imap/cmd-uid.c, src/imap/main.c, src/imap/rawlog.c, src/lib-
	charset/charset-iconv.c, src/lib-charset/charset-utf8.h, src/lib-
	index/mail-custom-flags.c, src/lib-index/mail-index-update.c, src
	/lib-index/mail-modifylog.c, src/lib-index/maildir/maildir-index.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-mail/message-body-search.c, src/lib-mail/message-header-
	search.c, src/lib-mail/message-header-search.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-part-serialize.c, src/lib-
	mail/message-part-serialize.h, src/lib-mail/quoted-printable.c, src
	/lib-mail/quoted-printable.h, src/lib-storage/index/index-search.c,
	src/lib-storage/mail-sort.c, src/lib-storage/mail-storage.c,
	src/lib/Makefile.am, src/lib/base64.c, src/lib/base64.h,
	src/lib/buffer.c, src/lib/buffer.h, src/lib/data-stack.c, src/lib
	/hex-binary.c, src/lib/hex-binary.h, src/lib/lib.h, src/login
	/client-authenticate.c, src/login/client.c, src/login/client.h:
	Added buffer API. Point is to hide all buffer writing behind this
	API which verifies that nothing overflows. Much better than doing
	the same checks all around the code, even if it is slightly slower.

	Buffer reading is still mostly done directly, that isn't such a big
	security risk and I can't think of a reasonable API for it anyway.
	[553f050c8313]

2002-12-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/login-connection.c, src/auth/master.c, src/auth/userinfo-
	passwd-file.c, src/imap/client.c, src/imap/client.h, src/imap/cmd-
	append.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-
	sort.c, src/imap/mail-storage-callbacks.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-bodystructure.h, src/lib-imap
	/imap-envelope.c, src/lib-imap/imap-message-cache.c, src/lib-imap
	/imap-message-cache.h, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-parser.h, src/lib-index/mail-index-update-cache.c, src/lib-
	index/mail-index-update.c, src/lib-index/mail-index-util.c, src/lib-
	index/mail-index.h, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-open.c, src/lib-index/maildir/maildir-
	update.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	index.c, src/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-
	lock.c, src/lib-index/mbox/mbox-open.c, src/lib-index/mbox/mbox-
	rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox
	/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c, src/lib-mail
	/message-body-search.c, src/lib-mail/message-body-search.h, src/lib-
	mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-mail/message-
	size.c, src/lib-mail/message-size.h, src/lib-storage/index/index-
	copy.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-fetch.h,
	src/lib-storage/index/index-msgcache.c, src/lib-storage/index/index-
	save.c, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-sort.c, src/lib-storage/index/index-sort.h, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-sort.c, src/lib-storage/mail-
	storage.h, src/lib/Makefile.am, src/lib/ibuffer-data.c, src/lib
	/ibuffer-file.c, src/lib/ibuffer-internal.h, src/lib/ibuffer-mmap.c,
	src/lib/ibuffer.c, src/lib/ibuffer.h, src/lib/iobuffer-internal.h,
	src/lib/iobuffer.c, src/lib/iostream-internal.h, src/lib/iostream.c,
	src/lib/istream-data.c, src/lib/istream-file.c, src/lib/istream-
	internal.h, src/lib/istream-mmap.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/lib.h, src/lib/obuffer-file.c, src/lib
	/obuffer-internal.h, src/lib/obuffer.c, src/lib/obuffer.h, src/lib
	/ostream-file.c, src/lib/ostream-internal.h, src/lib/ostream.c,
	src/lib/ostream.h, src/login/auth-connection.c, src/login/client-
	authenticate.c, src/login/client.c, src/login/client.h, src/master
	/auth-process.c, src/master/login-process.c, src/master/settings.c:
	Renamed IBuffer and OBuffer to IStream and OStream which describes
	their functionality better. I tried to keep the variable names and
	comments also sensible.
	[f57c52738f90]

	* src/lib-storage/mail-sort.c, src/lib-storage/mail-sort.h:
	Small cleanups.
	[bbf682857b4a]

2002-12-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-save.c:
	When APPEND timeouted while waiting for input data, say it now
	nicely instead of writing about it to error log.
	[78f07216daeb]

2002-12-04  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/cmd-search.c, src/imap
	/cmd-sort.c, src/imap/commands.c, src/imap/commands.h, src/lib-
	storage/.cvsignore, src/lib-storage/Makefile.am, src/lib-
	storage/index/Makefile.am, src/lib-storage/index/index-search.c, src
	/lib-storage/index/index-sort.c, src/lib-storage/index/index-sort.h,
	src/lib-storage/index/index-storage.h, src/lib-storage/mail-sort.c,
	src/lib-storage/mail-sort.h, src/lib-storage/mail-storage.h, src
	/lib-storage/register/.cvsignore, src/lib-
	storage/register/Makefile.am:
	First implementation of SORT extension. String comparing still not
	up to spec, so we don't advertise it in capability string yet. The
	code supports getting the data partially pre-sorted to reduce memory
	usage and make it faster. So, in future we could use this by
	creating sorted binary trees.

	Also moved mail-storage-register.c into it's own .a lib to fix
	circular dependencies.
	[d3bd41a56309]

	* src/lib-mail/rfc822-date.c:
	We didn't handle single-digit days.
	[3398c23434de]

	* src/lib/alarm-hup.c:
	Set all required sigaction values when deinitializing.
	[aafe524f26c4]

	* src/imap/cmd-list.c:
	Send INBOX always uppercased with LIST and LSUB.
	[a1dc53fcc0a7]

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	Forgot to commit.
	[5d80c93e6c52]

	* doc/mkcert.sh:
	Subject printing used wrong certificate file.
	[17598099d9ac]

	* configure.in:
	#undef _FILE_OFFSET_BITS before checking for sendfile() support,
	that breaks it.
	[2330d6d75910]

	* AUTHORS, COPYING, src/imap/cmd-list.c, src/lib-imap/imap-match.c,
	src/lib-imap/imap-match.h, src/lib-storage/index/maildir/maildir-
	list.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-storage
	/subscription-file/subscription-file.c:
	Rewrote imap_match() function. Maybe not as fast as before, but at
	least it's understandable now. This was required to fix listing mbox
	mailboxes where we wanted to match partial paths (it was pretty
	buggy before).
	[b531f5cd415e]

2002-12-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c:
	charset_to_ucase_utf8_string() didn't return \0 terminated string
	with ascii/utf8.
	[3521edb6c240]

	* src/master/settings.c:
	We should verify existance of log directory, not the file itself.
	[772d8ad12895]

	* src/lib/data-stack.c:
	DEBUG: Don't send shrink messages, they could cause infinite loop.
	[04e2c5774c3f]

	* configure.in:
	Give a hard warning if size_t is signed.
	[b97c8964d7c1]

	* src/imap/main.c:
	imap processes open syslog fd now immediately at startup, so
	dropping roots and potential chrooting won't break it.
	[501bd2f532ae]

	* src/imap/main.c:
	Sanity check to make sure USER environment exists.
	[474319868e82]

	* src/master/login-process.c:
	Let login process also know if verbose process titles are wanted..
	[db6fb0aa16d1]

	* src/imap/main.c, src/imap/rawlog.c:
	Set process title for rawlog process.
	[ad4292a30b1d]

	* configure.in, src/lib/Makefile.am, src/lib/process-title.c, src/lib
	/process-title.h, src/login/client.c, src/login/client.h,
	src/login/common.h, src/login/main.c:
	Login process now changes it's name if verbose_proctitle = yes, and
	we're running BSD. This is also possible with Linux with a pretty
	ugly hack, which you can enable by modifying lib/process-title.c if
	you _really_ want to.

	And a nasty bugfix - login_process_per_connection setting didn't
	work with imaps port connections which is exactly where it was
	mostly wanted.
	[32040b730b37]

2002-12-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h:
	int -> size_t
	[68d99a09dab2]

	* src/lib/imem.h, src/lib/mempool.h:
	We shouldn't cast sizeof() to unsigned int.
	[a85130f17ab5]

	* acconfig.h, configure.in:
	acconfig.h is deprecated with autoconf 2.5, changed configure to
	contain internal definitions. Also off_t type was detected wrong,
	long/int were swapped.
	[b3dd87844fff]

2002-12-01  Timo Sirainen  <tss@iki.fi>

	* src/master/settings.c:
	Check ssl/log settings while starting up.
	[a0b37087d673]

	* src/master/main.c:
	If ssl_disabled = yes, we shouldn't listen in imaps port.
	[3eae69eb6628]

	* acconfig.h, configure.in, src/lib/restrict-process-size.c:
	RLIMIT_AS isn't supported everywhere - use it if it exists, but also
	use RLIMIT_DATA.
	[f50714973d0b]

	* src/imap/main.c:
	DEBUG: We shouldn't verify the fds when running in pre-auth mode
	(breaks with gdb).
	[1b0205fc4153]

	* src/lib-mail/message-header-search.c:
	Added a few t_push/t_pops to prevent unnecessary memory usage.
	[eae61c3f4f3c]

	* src/lib-charset/charset-iconv.c:
	We shouldn't be strdup()ing the buffer, it's not \0 terminated.
	[edd896dda3bd]

	* src/lib-imap/imap-parser.c:
	All SEARCH arguments still may not have been parsed.
	[ce93054db96b]

	* src/lib/data-stack.c:
	crashfix when DEBUG was set.
	[b89a43bd90c5]

	* configure.in:
	AC_TYPEOF macro: with gcc we can check the type with printf() +
	-Werror
	[280c0952fa90]

	* NEWS, configure.in:
	0.99.4 out
	[890ee8db4f3e]

	* src/login/ssl-proxy-openssl.c:
	Be quiet about syscall/ssl errors, they're rarely fatal.
	[0cf0c312284f]

	* src/lib/failures.c, src/lib/fd-close-on-exec.c, src/lib/randgen.c:
	Set close-on-exec flag to failure log, /dev/urandom fd already tried
	to do that but did it wrong.
	[02fe757df1f0]

	* src/lib/failures.c:
	bugfix
	[9bfc0ee945df]

	* src/lib/data-stack.c:
	DEBUG: we get warnings when growing/shrinking data stack.
	[883cda17d175]

	* src/auth/main.c, src/imap/main.c, src/lib/Makefile.am, src/lib/fd-
	close-on-exec.c, src/lib/fd-close-on-exec.h, src/login/main.c,
	src/master/auth-process.c, src/master/auth-process.h, src/master
	/login-process.c, src/master/login-process.h, src/master/main.c:
	We use close-on-exec flag now to make sure that master process
	closes the fds when executing other processes.
	[8dd8ebe6bcac]

	* src/lib/failures.c:
	Changed so that we can use the functions before calling
	failures_init().
	[d60c6c65d1ca]

	* TODO:
	updated
	[3bc6324e5ba3]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-update-
	cache.c, src/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-
	index.c:
	A few memory leak fixes.
	[1be59bbb13f6]

	* src/master/auth-process.c:
	whops, accidentally committed some test code.
	[2fc7cb5197b4]

	* configure.in, dovecot-example.conf, src/lib/Makefile.am, src/lib
	/restrict-process-size.c, src/lib/restrict-process-size.h,
	src/master/auth-process.c, src/master/imap-process.c, src/master
	/login-process.c, src/master/settings.c, src/master/settings.h:
	Added virtual memory size limits to processes. Default values are
	pretty high, this is mostly because I want it to prevent accidental
	infinite loops eating memory or some integer overflows, not to
	actually restrict anything.
	[0438621d25ff]

	* src/lib-storage/subscription-file/subscription-file.c:
	subsfile_foreach() (LSUB) leaked memory.
	[b01cd1b30764]

2002-11-30  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/lib-imap/imap-parser.c:
	Maybe now?
	[e0825139b0f1]

	* src/lib-imap/imap-parser.c:
	Still not exactly right.
	[d23e1df5efa0]

	* src/lib-imap/imap-parser.c:
	Lists still weren't fully parsed always.
	[70dc986f3164]

	* src/imap/client.c, src/lib-imap/imap-parser.c:
	Input parsing was a bit broken in some conditions. Mostly visible
	with APPEND (_finally_, that should be the last weird bug I've
	noticed).
	[3f817df5eba4]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-body-
	search.h, src/lib-storage/index/index-search.c:
	Body searching wasn't working with unknown charsets, and SEARCH BODY
	searched also headers.
	[dd574ac271c1]

	* src/lib-mail/message-header-search.c, src/lib-storage/index/index-
	search.c:
	Non-envelope-cached header searching wasn't working. Also now search
	works with messages having 8bit headers, assuming them being in same
	charset as search key.
	[3e952f64b2ec]

	* src/lib-index/mail-index-update.c:
	When updating cached fields with mbox, the first message was set to
	size of the whole mbox file, deleting the rest of the messages from
	the index (mbox file itself didn't get corrupted)..
	[c93b47143909]

2002-11-27  Timo Sirainen  <tss@iki.fi>

	* src/master/auth-process.c:
	added assert.
	[a8b43d111284]

	* configure.in:
	--with-ssldir actually didn't do anything, and the default directory
	for them wasn't set either. Not important enough to release 0.99.4
	though.
	[385f862a4005]

	* NEWS, configure.in:
	0.99.3 release
	[f0b27bacadbf]

	* src/lib-index/mbox/mbox-index.c:
	temporarily disabled mail_read_mmaped setting, causes expunge
	corruption.
	[7b1bef7ffbeb]

2002-11-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-select.c:
	unused variable
	[f28c18b7acc3]

	* src/lib/env-util.c:
	crashfix
	[f7a13d96c09d]

	* NEWS, TODO:
	0.99.2 released
	[09c01325e070]

	* acconfig.h, configure.in, src/auth/userinfo-pam.c:
	OSX puts PAM includes into pam/ directory instead of security.
	Detect that.
	[df5bf4ee669f]

	* src/lib-index/maildir/maildir-sync.c, src/lib/hash.c,
	src/lib/hash.h:
	Removed const from key and value of hash_insert() and hash_update().
	[b1bec95ecde3]

	* src/lib/compat.c, src/lib/compat.h, src/lib/obuffer-file.c:
	writev()'s 3rd parameter is declared as "int" pretty much
	everywhere, so we should do that too.
	[fdc1fafb533d]

	* src/login/ssl-proxy.c:
	warning fix
	[f13ff48cb172]

	* configure.in:
	No, actually we don't want -Wcast-align :)
	[f1a1e9333a9e]

	* src/login/ssl-proxy-openssl.c:
	accidental global -> static
	[e7781d662778]

	* src/auth/Makefile.am, src/auth/master.h:
	missing master.h
	[1d20a088aead]

	* configure.in, src/auth/main.c, src/auth/master.c, src/imap/cmd-
	examine.c, src/imap/cmd-list.c, src/imap/cmd-lsub.c, src/imap/cmd-
	select.c, src/imap/cmd-subscribe.c, src/imap/cmd-unsubscribe.c,
	src/imap/commands.h, src/lib/mempool-alloconly.c, src/lib/mempool.c,
	src/lib/mempool.h, src/master/auth-process.c, src/master/login-
	process.c:
	Use more warnings with GCC by default. Fixed several warnings.
	[cc795d74d08f]

	* src/imap/rawlog.c, src/lib-index/mail-index-open.c, src/lib-
	index/mbox/mbox-index.c:
	misc. compiling cleanups.
	[bbc5f74c464f]

	* src/lib/Makefile.am, src/lib/env-util.c, src/lib/env-util.h, src/lib
	/restrict-access.c, src/master/auth-process.c, src/master/imap-
	process.c, src/master/login-process.c, src/master/main.c:
	Created env_put() and env_clean() for a bit easier handling of
	environment variables.
	[7814b29d0862]

	* src/lib/compat.h:
	Reverted back the isdigit()/etc. They're defined to get int
	argument, so we shouldn't given them unsigned.
	[c7f42a8e7176]

	* src/lib/mempool-alloconly.c:
	Don't do void* arithmetics.
	[e7a00568df23]

	* src/lib/compat.h:
	Cast chars to (unsigned int) instead of (int) in i_isdigit() etc.
	macros. Hopefully fixes some warnings with HP/UX.
	[944758e83111]

	* src/lib/compat.h:
	And the missing sys/sysmacros.h include..
	[21233287e9c1]

	* configure.in, src/lib-index/mbox/mbox-lock.c, src/lib-index/mbox
	/mbox-sync.c, src/lib/compat.h:
	Added CMP_DEV_T macro which uses major()/minor() if possible but
	fallbacks to direct comparing if it's not a structure.
	[359f73bf84b5]

	* acconfig.h, configure.in, src/lib-index/mail-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-sync.c:
	We compile now if dev_t is a structure (eg. glibc+tcc).
	[567f5e66c7b8]

	* src/auth/Makefile.am, src/auth/mycrypt.c, src/auth/mycrypt.h,
	src/lib/Makefile.am, src/lib/mycrypt.c, src/lib/mycrypt.h:
	Moved mycrypt() into auth/ dir, so we don't have to link all
	programs with
	-lcrypt
	[413227772e6f]

	* src/lib/Makefile.am:
	Forgot mycrypt.h
	[7d00ff7ef77c]

	* src/master/ssl-init-openssl.c:
	Removed compiler warnings.
	[d36b8eaa259b]

	* src/lib/mycrypt.c:
	And added the rest of the defines to make sure it compiles.
	[ebab743ef4ee]

	* src/auth/userinfo-passwd-file.c, src/auth/userinfo-passwd.c,
	src/auth/userinfo-passwd.h, src/auth/userinfo-shadow.c, src/auth
	/userinfo-vpopmail.c, src/lib/Makefile.am, src/lib/mycrypt.c,
	src/lib/mycrypt.h:
	Still more crypt() problems. Wrapped it into mycrypt() which should
	finally put end to this kludgeing.
	[ae9e39383a72]

	* src/auth/userinfo-passwd.h:
	compile fix for netbsd-current.
	[6e718f25f0d5]

	* src/master/ssl-init.c:
	missing include file
	[e7ad373d4e77]

	* src/master/auth-process.c:
	Still not correct order with dup2()ing.
	[63acdd7a4f83]

	* src/master/auth-process.c:
	Close old fds before dup2()ing to fd 3, so we don't close it
	accidentally.
	[735d59fda607]

	* src/master/Makefile.am, src/master/settings.c:
	default settings still pointed to lib dir instead of libexec dir..
	[d787d0bc3b58]

	* src/auth/main.c, src/lib/network.c, src/lib/network.h,
	src/login/main.c:
	net_accept() returns now -2 for fatal failures.
	[84e398270f7f]

	* configure.in:
	Get uintmax_t from inttypes.h instead of stdint.h.
	[78966c511e57]

	* acconfig.h, configure.in, src/imap/mail-storage-callbacks.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/index-
	search.c, src/lib/compat.h, src/lib/hostpid.c, src/lib/lib.h,
	src/lib/strfuncs.c, src/lib/strfuncs.h:
	Renamed largest_t to uintmax_t which already exists in C99.
	[1e5c655bad25]

	* configure.in:
	Created AC_TYPEOF() which tells what base type (int/long/long long)
	the given type is. This cleans up the ssize_t and off_t checks. We
	also try another way to figure out the size by checking if compiler
	allows us to redeclare the type using typedef, at least it works
	with gcc. This should get rid of the warnings with OSX where ssize_t
	was previously declared as int instead of long.
	[3089685bbb7e]

	* acconfig.h, configure.in, src/lib/Makefile.am, src/lib/ioloop-
	poll.c, src/lib/ioloop-select.c:
	select() support was broken. Also changed the way it's built.
	[3e23fa94f762]

	* src/lib-mail/message-header-search.c, src/lib/ioloop-select.c,
	src/login/client-authenticate.c:
	Fixed a few compiling warnings about signedness.
	[a26d28bbc3ff]

2002-11-25  Timo Sirainen  <tss@iki.fi>

	* TODO, src/imap/Makefile.am, src/imap/client.c, src/imap/cmd-
	select.c, src/imap/mail-storage-callbacks.c, src/imap/mailbox-
	sync.c, src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-
	open.c, src/lib-index/mail-index-util.c, src/lib-index/mail-index-
	util.h, src/lib-index/mail-index.c, src/lib-index/mail-index.h, src
	/lib-index/mail-modifylog.c, src/lib-index/maildir/maildir-index.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-lock.c, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-messageset.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/lib/file-lock.c, src/lib
	/file-lock.h:
	Locking changes triggered a bit larger cleanup :) If we have to wait
	for a lock longer, the client is now notified about it every 30
	seconds. Also if mailbox opening fails because of lock timeout, we
	won't overwrite the index anymore. Finally user gets a clear error
	message about lock timeout instead of "internal error".
	[b7aefd0d7611]

	* src/login/client-authenticate.c:
	We crashed if master process didn't let us authenticate.
	[d864b45e708e]

	* src/auth/userinfo-vpopmail.c:
	whops, commented out too much of the debug macro
	[550eaf0fcb7a]

	* src/auth/userinfo-vpopmail.c:
	vpopmail's parse_email() is buggy, we need to zero fill the username
	buffer before calling it.
	[d2a574cbeccb]

	* src/auth/common.h, src/master/auth-process.c:
	Moved login listener handle to fd 3 from 1 (stdout), because
	vpopmail could try writing into it.
	[e5f32324af3c]

	* NEWS:
	And the date :)
	[d560d17cf23d]

	* NEWS, configure.in:
	0.99.1 released
	[aff68c9e0317]

	* src/imap/Makefile.am:
	Reverted accidental commit.
	[aa33734bccd5]

	* dovecot-example.conf, src/master/login-process.c,
	src/master/settings.c, src/master/settings.h:
	Added ssl_disable setting.
	[36ac2fd352ff]

	* doc/mkcert.sh:
	Name the cert and key files as "imapd.pem" after all like they're in
	config file. I'm not sure what's the standard naming in /etc/ssl
	though.
	[748cbf0af0ed]

	* doc/auth.txt, doc/configuration.txt:
	updates
	[fa8e1eb0b881]

	* doc/configuration.txt:
	updated
	[4b02fde791dd]

	* src/master/settings.c:
	SSLDIR, not SSL_DIR
	[8993ccefd9a0]

	* dovecot-example.conf:
	updated lib paths to libexec ones
	[b88b5488bcfd]

	* src/auth/userinfo-vpopmail.c:
	Missing include file caused compiling to break
	[b9c20fe3ddde]

	* .cvsignore:
	updated
	[47cdbb98fdae]

	* src/master/Makefile.am, src/master/settings.c:
	Use --with-ssldir directory instead of hardcoded /etc/ssl
	[1a86a8b6e6ff]

	* configure.in, doc/Makefile.am, doc/dovecot-openssl.cnf,
	doc/mkcert.sh, dovecot-example.conf:
	Added script to easily generate self-signed certificate.
	[85a888d2766e]

2002-11-24  Timo Sirainen  <tss@iki.fi>

	* src/auth/Makefile.am, src/imap/Makefile.am, src/login/Makefile.am:
	Use libexecdir instead of libdir to install the binaries.
	[da039ae2cfd1]

	* doc/Makefile.am:
	The txt files are now installed into doc directory, and a few of
	them were missing.
	[f3870975abcf]

	* configure.in:
	Was missing -lcrypto when checking for OpenSSL.
	[5ad6e4f51c96]

	* configure.in:
	Final bugfix..
	[67c840670ee2]

	* NEWS, configure.in:
	0.99.0 released
	[d0c09214b803]

2002-11-22  Timo Sirainen  <tss@iki.fi>

	* TODO:
	updated
	[f96c45d2e24a]

	* src/lib-index/mbox/mbox-lock.c:
	Even if we didn't want to create dotlock when reading, first make
	sure it doesn't exist. This is a bit racy, but can't help that.
	[4fb29279235f]

	* src/lib/ibuffer-file.c:
	cleanup
	[e4cf79f2a30f]

	* src/lib/ibuffer-file.c:
	Several bugfixes and speedups related to i_buffer_skip().
	[3663df53b127]

	* src/lib-imap/imap-bodystructure.c:
	handle broken multipart messages without crashing
	[1acbf6c8758c]

2002-11-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-index.c, src/lib-index/mbox/mbox-index.c:
	MAIL_READ_MMAPED setting was set too late, plus a few cleanups.
	[ea7099259c57]

	* src/lib-index/mbox/mbox-index.c:
	lseek() to beginning of file before creating file ibuffer.
	[0834f1490e68]

	* dovecot-example.conf, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index.h, src/lib-index/maildir/maildir-open.c, src/lib-
	index/maildir/maildir-update.c, src/lib-index/mbox/mbox-index.c,
	src/master/imap-process.c, src/master/settings.c,
	src/master/settings.h:
	mail_read_mmaped: Use mmap() instead of read() to read mail files.
	read() seems to be a bit faster with my Linux/x86 and it's better
	with NFS, so that's the default.
	[415498fa78d6]

	* dovecot-example.conf, src/lib-index/mail-index.h, src/lib-index/mbox
	/mbox-lock.c, src/master/imap-process.c, src/master/settings.c,
	src/master/settings.h:
	Added mbox lock settings to config file. Support timeouting fcntl()
	and flock() locks. Plus before the fcntl/flocks weren't even set.
	[da34bdd4e0c6]

	* src/lib-index/mbox/mbox-rewrite.c:
	Don't rewrite when there's no messages (ie. don't write the one
	'\n').
	[5f5fdc45c19d]

2002-11-20  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy-openssl.c:
	Don't log when remote close()d connection.
	[83aaf3dc6362]

	* src/login/master.c:
	bugfix
	[91f2f80123f0]

	* src/login/client-authenticate.c, src/login/client.c:
	Make sure we're not doing io_remove() for already removed IO.
	[252bdd1392f0]

	* src/login/common.h, src/login/main.c, src/login/master.c:
	When connection to master is lost, close listening sockets.
	[78b261175f2d]

	* src/login/ssl-proxy-openssl.c:
	More verbose logging.
	[6e5279a60f82]

	* src/login/client.c:
	If SSL handshake failed we accessed free'd memory.
	[02a80e0f71cb]

	* src/master/auth-process.c, src/master/auth-process.h, src/master
	/login-process.c, src/master/login-process.h, src/master/main.c,
	src/master/settings.c, src/master/settings.h:
	SIGHUP reloads now settings. Logged in clients are left untouched,
	but clients still logging in are killed.
	[90a65c017bf0]

	* TODO:
	updated
	[339c176aba1e]

	* src/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/mbox/mbox-save.c:
	COPYing inside same mailbox works now with mbox. Also fixed SAVE
	leaving From-line written to mbox file if it was aborted.
	[3814fc4f4135]

	* src/lib-index/mbox/mbox-sync.c:
	syncing doesn't do anything now if we know we're already synced
	[8efd9f63e333]

	* src/lib-index/mail-index.c:
	debug fix
	[8abfbce2f72d]

	* src/lib/ibuffer-mmap.c:
	make sure i_buffer_read() sets buf_errno to 0 at eof.
	[03f23250b63d]

	* src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c:
	If first message with our X-IMAPbase is deleted, make sure it's
	added back.
	[2f3b2a5d74d7]

	* src/lib/network.c:
	typofix
	[e4aba04143ad]

	* src/lib-index/mail-tree.c:
	Avoid rebuilding tree twice if two processes notice it's broken at
	the same time.
	[49893535ce92]

	* src/lib-storage/index/maildir/maildir-storage.c:
	typo in comment
	[5ce5aafe28d9]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Don't allow '*' and '%' characters in mailbox names. Maildir RENAME
	works now properly when renaming folders having subfolders.
	[fe017093e4d8]

	* src/login/ssl-proxy-openssl.c:
	bugfix
	[8bc4876397cd]

	* INSTALL, configure.in, src/master/ssl-init-gnutls.c:
	SSL fixes and doc updates.
	[3fa9e363cd3d]

	* acconfig.h, configure.in, src/login/Makefile.am, src/login/ssl-
	proxy-gnutls.c, src/login/ssl-proxy-openssl.c, src/login/ssl-
	proxy.c, src/master/Makefile.am, src/master/ssl-init-gnutls.c,
	src/master/ssl-init-openssl.c, src/master/ssl-init.c, src/master
	/ssl-init.h:
	Support for OpenSSL.
	[235188ee7a05]

	* src/imap/main.c:
	No space before "* PREAUTH" ..
	[5690ce7151c9]

2002-11-19  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c:
	Send PREAUTH if we were started without LOGIN_TAG environment (ie.
	not through master process).
	[d34ee528aa68]

2002-11-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-passwd-file.c:
	re-read passwd file when it changes.
	[fcdff89c3df2]

	* src/master/Makefile.am, src/master/ssl-init.c, src/master/ssl-
	init.h:
	forgot
	[a7c3ea56ba62]

	* src/lib-storage/index/index-fetch-section.c:
	Fix when fetching body[sections] with message/rfc822 parts.
	[c6b5e8af85e7]

	* TODO:
	updated
	[c7a01d999962]

	* dovecot-example.conf, src/login/ssl-proxy.c, src/master/Makefile.am,
	src/master/common.h, src/master/login-process.c, src/master/login-
	process.h, src/master/main.c, src/master/settings.c,
	src/master/settings.h:
	Master process generates DH/RSA parameters now and stores them into
	file which login processes read. Added setting for regeneration
	interval. Some other SSL cleanups.

	Also fixed default login process path to be ../run/dovecot/login/
	like example config file said, instead of just ../run/dovecot/ which
	it actually was until now.
	[0d852af6842e]

2002-11-16  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/login-process.c,
	src/master/settings.c, src/master/settings.h:
	login_process_per_connection = yes scales now better when multiple
	users are trying to log in at the same time.
	[e60620644af3]

	* dovecot-example.conf, src/login/client.c, src/login/client.h,
	src/login/common.h, src/login/main.c, src/login/master.c,
	src/login/master.h, src/login/ssl-proxy.c, src/master/login-
	process.c, src/master/settings.c, src/master/settings.h:
	Finally support for handling each login connection in it's own
	process. Enabled by default. Also a few bugfixes to master process.
	[1906116a62ce]

	* src/lib/fdpass.c, src/lib/fdpass.h:
	Some fixes, cleanups and possibility to send/receive data without
	actually passing the fds (ie. just a sendmsg/recvmsg wrapper).
	[7c91f579ebed]

2002-11-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-charset/charset-iconv.c:
	Removed warnings with Solaris' iconv()
	[9373933b1be1]

2002-11-14  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Call setsid() when daemonizing.
	[bc766660efc4]

2002-11-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-charset/Makefile.am, src/lib-charset/charset-ascii.c, src
	/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c:
	We can support UTF-8 charset too without any translations.
	[5470c0cb13a7]

	* src/lib-charset/charset-ascii.c, src/lib-charset/charset-iconv.c,
	src/lib-charset/charset-utf8.h, src/lib-mail/Makefile.am, src/lib-
	mail/message-body-search.c, src/lib-mail/message-body-search.h, src
	/lib-mail/message-header-search.c, src/lib-mail/message-header-
	search.h, src/lib-mail/quoted-printable.c, src/lib-mail/quoted-
	printable.h, src/lib-storage/index/index-search.c, src/lib/base64.c,
	src/lib/base64.h, src/login/client-authenticate.c:
	SEARCH CHARSET now works properly with message bodies, and in
	general body searching works more correctly by decoding base64/qp
	data. Non-text MIME parts are currently not included in search, that
	could be made optional. Also the body is parsed separately for each
	keyword, that could be optimized.

	Changed base64_decode() behaviour so that it can accept non-base64
	data as well, ie. line feeds etc.
	[debb8468514e]

	* src/lib-index/mail-index.c:
	mail_index_lock_full() doesn't need to be global
	[c857ebe48596]

	* src/lib-index/mail-index-update.c, src/lib/mmap-anon.c:
	Fix ~ usage - I'm not sure if it was wrong before (it did work), but
	at least now I know it's correct. :)
	[f7fe4055d1ae]

	* TODO:
	update
	[e5ff7ddeb895]

	* src/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-save.c:
	Use blocking output buffers when writing to files.
	[b69e50478671]

	* src/lib/obuffer-file.c:
	o_buffer_send() should have tried to send data immediately if the
	buffer was in non-blocking state.
	[abb584aabe31]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.c:
	If mbox opening fails, don't leave the lock files lying around.
	[03ea377ed93b]

	* src/lib-storage/index/index-fetch.c:
	FETCH RFC822 and RFC822.TEXT also needs to set \Seen flag for
	message
	[bfa9ab91eba7]

2002-11-12  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/index-mailbox-check.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/master
	/imap-process.c, src/master/settings.c, src/master/settings.h:
	mailbox_check_interval setting: Dovecot can notify client of new
	mail in selected mailbox soon after it's received. This setting
	specifies the minimum interval in seconds between new mail
	notifications to client - internally they may be checked more or
	less often. Setting this to 0 disables the checking.
	[3b44bc64afd4]

	* src/lib-index/mbox/mbox-sync.c:
	If mbox file is deleted for selected folder, recreate it again so we
	can handle locking issues properly. For example mutt deletes the
	mbox when all mails are expunged.
	[a7691dc0a869]

2002-11-07  Timo Sirainen  <tss@iki.fi>

	* src/imap/rawlog.c:
	Print timestamp marks into rawlog.
	[26691b7d6203]

2002-11-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c:
	Drop root privileges before handling rawlog opening.
	[99c7e303c92a]

	* dovecot-example.conf, src/imap/main.c, src/login/client-
	authenticate.c, src/login/master.c, src/login/master.h,
	src/master/common.h, src/master/imap-process.c, src/master/login-
	process.c, src/master/master-interface.h, src/master/settings.c,
	src/master/settings.h:
	Added verbose_proctitle setting: Show more verbose process titles
	(in ps). Currently shows user name and IP address. Useful for seeing
	who are actually using the IMAP processes (eg. shared mailboxes or
	if same uid is used for multiple accounts).
	[ab3590c3a7d9]

	* src/imap/rawlog.c:
	A bit kludgy bugfix to prevent rawlog from hanging.
	[320f59a5a36c]

	* src/lib-index/maildir/maildir-sync.c:
	Maildir syncing code wasn't updated.
	[7a53aa3bd95d]

	* src/lib-imap/imap-bodystructure.c:
	another buggy check
	[3bd84cc9dbf6]

	* src/lib-imap/imap-bodystructure.c:
	buggy check
	[36090ea10e08]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c:
	A few extra checks to prevent memory eating by sending mails with
	multiple header fields with same name.
	[6c8e172ff068]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-tree.c:
	Don't try to truncate in-memory indexes.
	[e3162b4267ec]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-modifylog.c, src
	/lib-index/mail-tree.c:
	Fixes to make in-memory indexes working again.
	[d1e0cbffe1e1]

	* src/login/client-authenticate.c, src/login/client.c:
	Whops, AUTHENTICATE data still wasn't cleared right.
	[d7eb0bfd3eb5]

	* src/login/client.c:
	More password clearing.
	[6b0125b34bb1]

	* src/auth/auth-plain.c, src/auth/login-connection.c:
	Plaintext passwords weren't cleared from memory after use.
	[50bb42557703]

	* src/lib/ibuffer.c, src/lib/ibuffer.h:
	i_buffer_get_modifyable_data(): Like i_buffer_get_data(), but
	returns non-const data. If modifying isn't allowed to buffer,
	returns NULL.
	[3696d2bd829e]

2002-11-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-index.c:
	Fixes for parsing mbox messages when ending \n in header actually
	belongs to next From-line (eg. "\n\nFrom").
	[291ff43ccf82]

	* src/lib-index/mail-index.c:
	Fixed wrong printf-type.
	[50959a72b966]

2002-11-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index.c:
	Fixes for anon-mmaped indexes.
	[2d76b723dac4]

	* src/lib-index/mail-index.c:
	Setting index file's timestamp was done too early - there was
	msync() immediately after it to reset the timestamp again.
	[c97be611a109]

	* src/lib-index/mbox/mbox-sync.c:
	We did a full sync too often.
	[a0eb55ddb5f0]

	* src/lib-charset/charset-ascii.c, src/lib-charset/charset-iconv.c,
	src/lib-imap/imap-date.c, src/lib-imap/imap-quote.c, src/lib-index
	/mail-custom-flags.c, src/lib-index/mail-index-data.c, src/lib-index
	/mail-index-update.c, src/lib-index/mail-modifylog.c, src/lib-mail
	/message-parser.c, src/lib-storage/index/mbox/mbox-expunge.c,
	src/lib/ibuffer-mmap.c, src/lib/ibuffer.c, src/lib/macros.h,
	src/lib/md5.c, src/lib/obuffer-file.c, src/lib/write-full.c:
	Several minor fixes: signess, casting away const, missing static,
	etc.
	[e524da896d92]

	* src/lib/obuffer.c:
	o_buffer_seek() returns int, not ssize_t
	[4305e0c739cf]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-lock.c:
	mbox_unlock() actually set exclusive lock
	[056f4d135e4c]

	* configure.in:
	Print the size of off_t at end.
	[fa29eb5865e7]

	* src/master/main.c:
	Never open imaps port if we're building with SSL disabled.
	[ba6f89be8237]

	* src/lib/failures.c, src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added printf_string_fix_format() which currently just replaces %m
	with strerror(errno). i_panic, i_fatal, i_error and i_warning didn't
	expand the %m before when not writing to syslog.
	[703bbeceb248]

	* src/lib-charset/charset-ascii.c:
	compiler warning fix
	[c96607edbcb0]

	* src/lib/compat.h:
	EOVERFLOW doesn't exist everywhere, fallback it to EINVAL.
	[3c6a0cb061c6]

	* src/auth/userinfo-pam.c, src/auth/userinfo-passwd-file.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-passwd.h, src/auth/userinfo-
	shadow.c, src/auth/userinfo-vpopmail.c:
	Fixed warnings when compiling with Solaris 8
	[944dbdc61f3d]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/mbox/mbox-rewrite.c, src/lib-
	index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/index-
	update-flags.c, src/lib-storage/index/maildir/maildir-copy.c:
	And more locking/syncing fixes. Now it's finally beginning to look
	sane again.
	[2626acd3c6f4]

2002-11-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	SEARCH TEXT now checks only field values (not names) from headers.
	RFC doesn't really specify how this should be handled and I think
	it's better this way. Also it's easier to handle correctly :)
	[cafe57140f5c]

	* configure.in, src/Makefile.am, src/imap/Makefile.am, src/imap/cmd-
	search.c, src/lib-charset/.cvsignore, src/lib-charset/Makefile.am,
	src/lib-charset/charset-ascii.c, src/lib-charset/charset-iconv.c,
	src/lib-charset/charset-utf8.h, src/lib-imap/imap-message-cache.c,
	src/lib-mail/Makefile.am, src/lib-mail/message-header-search.c, src
	/lib-mail/message-header-search.h, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-storage.h, src/lib-storage
	/mail-search.c, src/lib-storage/mail-search.h, src/lib-storage/mail-
	storage.h:
	SEARCH CHARSET support. Currently we do it through iconv() and only
	ASCII characters are compared case-insensitively.
	[f2aa58c2afd0]

	* src/lib-index/mail-index-update.c:
	updating fields in index data file was buggy
	[a59f68334ad6]

	* src/lib/base64.h:
	forgot
	[a75b7a269674]

	* src/lib/base64.c, src/login/client-authenticate.c:
	size parameter to base64_decode()..
	[41c43eb65c18]

	* src/lib/base64.c, src/lib/base64.h, src/login/client-authenticate.c:
	Changed base64_decode() to separate src/dest buffers.
	[24f2776422c0]

	* src/auth/userinfo-pam.c:
	PAM was implemented pretty wrong, should have read the manual.
	[796c12593140]

	* src/lib-storage/index/mbox/mbox-save.c:
	APPEND fixed for mbox
	[ca988d72265b]

	* src/lib-index/mbox/mbox-sync.c:
	more lock fixes
	[a48ef667e709]

	* src/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-index/mbox/mbox-sync.c:
	mbox locking fixes
	[08d5e82b9068]

2002-11-02  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-close.c, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index-update-cache.c, src/lib-index/mail-index.c, src/lib-
	index/mail-index.h, src/lib-index/mail-tree.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-rewrite.c, src/lib-
	index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-status.c,
	src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-storage.h:
	Mostly mbox locking/syncing fixes. Still some problems though.
	[c834e77b624c]

2002-11-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-update.c:
	update_by_replace_fields() didn't update header
	[4bf3e0cb8159]

2002-10-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	don't unref() the ibuffer we got from imap cache.
	[db3155105b1d]

2002-10-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-rewrite.c:
	mbox locking fixes
	[9d72849fe68e]

	* src/lib-index/mail-index-compress.c:
	index compression was broken.
	[31b87d270b32]

	* src/lib/obuffer-file.c:
	errno wasn't set when timeout occured.
	[85ee22e02ca7]

	* src/lib/ibuffer-file.c, src/lib/obuffer-file.c:
	If timeout wasn't set, it was assumed that it was immediate.
	[c31add7eaa57]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mbox/mbox-lock.c:
	mbox locking wasn't working.
	[33be9c9f3b3a]

	* AUTHORS, COPYING:
	updates
	[ac68ab739a4d]

	* acconfig.h, configure.in, src/imap/Makefile.am, src/imap/client.h,
	src/imap/main.c, src/imap/rawlog.c, src/imap/rawlog.h:
	--with-rawlog: Build support for logging traffic of user sessions.
	If user's home directory contains "rawlog" directory, the input and
	output traffic is written to YYYYMMDD-hhmmss-pid.in and .out files.
	This was made for debugging purposes.
	[3a83b05a0be3]

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-update.c:
	Fixed (recently) broken updating of index data file. Also we don't
	leave deleted data lying around in the file anymore but instead fill
	it with zeros.
	[65b73446b4cf]

	* src/lib/data-stack.c:
	DEBUG: when t_pop()ing, fill the free'd memory area with 0xde bytes.
	[797c5eb84267]

	* acconfig.h, configure.in, src/auth/userinfo-pam.c:
	Call pam_setcred() if it exists.
	[39a24074abf4]

2002-10-28  Timo Sirainen  <tss@iki.fi>

	* acconfig.h, configure.in, src/auth/auth.c, src/auth/userinfo-passwd-
	file.c, src/imap/cmd-append.c, src/imap/commands-util.c, src/lib-
	imap/imap-message-cache.c, src/lib-imap/imap-parser.c, src/lib-index
	/mail-index-update.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-update-
	flags.c, src/lib/macros.h, src/lib/temp-string.c:
	Added --enable-asserts (default) and fixed some warnings when
	building without. Added i_unreached() to indicate supposedly
	unreachable code block and changed a existing i_assert(0) calls to
	it. Removed return_if_fail() and return_val_if_fail() macros,
	they're not useful.
	[e1254b838e0b]

	* src/lib-index/maildir/maildir-build.c:
	path parameter wasn't used
	[c97f631bd26d]

	* acconfig.h, configure.in, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index-util.h, src/lib-index/mail-index.c, src/lib-index
	/mail-modifylog.c, src/lib-index/mail-tree.c:
	Added --enable-debug. Currently it just forces file locks so that
	index files can't be written to when not holding exclusive lock.
	Also main index file can't be even read if we're unlocked (other
	files don't get notification of unlock, so they don't do this at
	least yet).
	[42e65c2ba49d]

	* src/lib/mmap-util.c, src/lib/mmap-util.h:
	Removed mmap_aligned() which isn't used anywhere. Added mmap_file()
	which accepts prot argument. We use now fstat() instead of lseek()
	to get file size.
	[52fd3d82e59a]

	* src/lib-index/mail-index-update.c, src/lib-index/maildir/maildir-
	build.c:
	Support W=rfc822.size flag in maildir file name.
	[14da2c45cdc7]

	* src/lib-index/mail-index-update.c:
	if virtual_size == physical_size in message, update it's binary-
	flag.
	[c8aaf80bc89f]

	* src/lib-index/mail-tree.h:
	comment update
	[9194f598bfbd]

	* src/lib-index/mail-tree-redblack.c, src/lib-index/mail-tree.h:
	node color needs only one bit, not a full 32bit integer. so moved it
	to highest bit of node_count.
	[a182d31b46cd]

	* src/lib-storage/index/index-status.c:
	Previous lowwater change broke STATUS.
	[3952bda70287]

	* TODO:
	updated
	[fe8a014a479e]

	* src/lib/data-stack.c, src/lib/data-stack.h, src/lib/ioloop-poll.c,
	src/lib/ioloop.c, src/lib/temp-string.c:
	changed t_push() and t_pop() to return unsigned int. added global
	data_stack_frame which is used by TempString to verify it's accessed
	only in the same frame.
	[37893ed97492]

	* src/lib-index/mail-index-fsck.c:
	fsck() should reset lowwater marks to end of uids, not to beginning.
	[5a193db8fe56]

	* src/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-msgcache.c, src/lib-storage/index/index-search.c, src/lib
	/ibuffer-data.c, src/lib/ibuffer-file.c, src/lib/ibuffer-internal.h,
	src/lib/ibuffer-mmap.c, src/lib/ibuffer.c, src/lib/ibuffer.h:
	keep i_buffer_seek() void and make it close the buffer if any errors
	happen. next read will then notice the error. easier to handle it
	that way.
	[45b43851bc9a]

	* src/lib/ibuffer-file.c, src/lib/iobuffer-internal.h, src/lib
	/obuffer-file.c:
	cleanups
	[1f1ff728ff65]

	* src/auth/login-connection.c, src/auth/master.c, src/imap/client.c,
	src/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-save.c,
	src/lib/Makefile.am, src/lib/alarm-hup.c, src/lib/alarm-hup.h,
	src/lib/file-lock.c, src/lib/ibuffer-data.c, src/lib/ibuffer-file.c,
	src/lib/ibuffer-mmap.c, src/lib/ibuffer.c, src/lib/ibuffer.h,
	src/lib/iobuffer-internal.h, src/lib/iobuffer.c, src/lib/lib.c,
	src/lib/obuffer-file.c, src/lib/obuffer.c, src/lib/obuffer.h,
	src/login/auth-connection.c, src/login/client-authenticate.c,
	src/login/client.c, src/master/auth-process.c, src/master/login-
	process.c:
	I/O buffers now use real blocking instead of setting up a sub-ioloop
	to poll(). alarm() is called every 30 secs to send SIGHUP and break
	out of the read/write calls, so the given timeout values aren't
	exact.

	Also some other cleanups, like not including ioloop.h in
	[io]buffer.h which broke several other files which hadn't included
	it itself..
	[3b53dd1280c6]

	* src/lib-index/mail-index-compress.c:
	bugfix
	[9aabf64c8da2]

	* configure.in:
	and fix linux-sendfile check so it fails with freebsd :)
	[e815df17e52e]

	* configure.in:
	buggy checks. we were supposed to compile them, not run. plus fixes
	for freebsd-sendfile checking so that it fails with linux.
	[3a1be480d16a]

	* acconfig.h, configure.in, src/lib/sendfile-util.c:
	Support FreeBSD-compatible sendfile(). Completely untested.
	[a95b1ccff82e]

2002-10-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h:
	Forgot in last commit.
	[17888202b002]

	* TODO:
	updated
	[ab394352fcb3]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index-
	data.c, src/lib-index/mail-index-data.h, src/lib-index/mail-index-
	update-cache.c, src/lib-index/mail-index-update.c, src/lib-index
	/mail-index-util.c, src/lib-index/mail-index-util.h, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-index/maildir
	/maildir-build.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-rebuild.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c,
	src/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-msgcache.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-expunge.c,
	src/lib-storage/index/mbox/mbox-expunge.c:
	Moved several fields from .imap.index file to .imap.index.data file.
	Fixed code so that most of the fields do not need to be set when
	building index, allowing the index building to be fast (just
	readdir()s with maildir). This still needs some configuration and
	ability to update the fields whenever it can grab exclusive lock.

	Also fixed SEARCH LARGER, SMALLER and KEYWORD.
	[2cb2e0a3423b]

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/maildir/maildir-update.c:
	Don't bother going through all that trouble to send file size to
	ibuffer. One extra fstat() isn't that bad, and we'll soon get rid of
	the first one..
	[a70ca21d022c]

2002-10-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/ibuffer-mmap.c:
	Print error message if madvise() fails (it never should).
	[08a7cdc53876]

	* src/lib/ibuffer.c:
	i_buffer_set_read_limit() - don't fail if we don't know the file
	size.
	[bd6362f13e7a]

	* src/lib-index/mail-index.h, src/lib-index/mbox/Makefile.am, src/lib-
	index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-lock.c, src/lib-
	index/mbox/mbox-lock.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h:
	mbox locking fixes / changes. we now read-lock the mbox file before
	syncing so we can be sure no-one corrupts our reads by expunging
	mailbox. mbox file is kept open all the time, but re-opened when
	device/inode for file has changed (ie. someone overwrote it). File
	is also kept mmap()ed until lock is dropped.

	we currently create .lock file even when reading the file (ie. being
	effectively write-lock), but that'll be made configurable later.
	[83da62e0675a]

	* src/lib/ibuffer-mmap.c:
	seek: we munmap()ed unneededly sometimes
	[8ca4d597938c]

	* dovecot-example.conf:
	and a couple more fixes..
	[9e121e74c188]

	* dovecot-example.conf:
	Updated SSL certificate comments.
	[1f9b96080525]

2002-10-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	still not right
	[ca99b1d7ceef]

	* src/lib-mail/message-parser.c:
	Header parser was still a bit wrong.
	[fc13fbca2fff]

	* src/lib-index/mbox/mbox-index.c:
	If Content-Length header was invalid, we didn't fix it properly.
	[f0e88a0751e5]

	* src/lib-index/maildir/maildir-sync.c:
	comment update
	[7427dd68c492]

	* src/lib-mail/message-parser.c:
	Header parsing should always keep one character lookahead, so it can
	see if header continues in next line. This wasn't done properly.
	[01e94a80235d]

	* src/lib-index/mail-tree-redblack.c:
	and correct a stupid copy&paste-bug
	[41133ae3feb6]

	* src/lib-index/mail-tree-redblack.c:
	Set node variable after mmap updating which may change it..
	[10d6c1cb6511]

	* src/lib-storage/index/index-sync.c:
	Don't crash either if expunge or update_flags sync_callbacks haven't
	been set when syncing modify log
	[9d4c71bfaed9]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c:
	Small mbox tweaks, hopefully resulting in a bit better performance.
	[48910084a8ce]

	* src/lib-index/mail-tree.c:
	Tree file wasn't correctly re-mmap()ed when sync_id changed.
	[d97b0454692e]

	* src/imap/cmd-select.c, src/lib-storage/index/index-save.c, src/lib-
	storage/index/index-sync.c:
	Error message fixes for APPEND. Make sure we don't crash if
	sync_callbacks isn't set. Don't set sync_callbacks until SELECT is
	finished.
	[eebb12795ea7]

	* src/lib/ibuffer-file.c:
	If i_buffer_read() fails because of EOF, set buf_errno to 0.
	[0329dd6cd40e]

	* src/lib-mail/message-parser.c, src/lib-storage/index/index-search.c:
	More (char *) -> (const char *) fixes
	[78ae6262d6ca]

	* src/lib-imap/imap-parser.c:
	Buffer returns const type, don't cast it away.
	[54788b83654f]

	* src/lib-index/mbox/mbox-sync.c:
	If mbox file's timestamp isn't same as index file's, it means the
	file has changed. We didn't check this properly when opening the
	mbox file first time. Also some cleanups.
	[6c01ae6f3b1c]

	* src/lib-imap/imap-parser.c:
	imap_parser_read_args() didn't correctly always return "need for
	more data" which sometimes resulted in broken parsing of client
	commands.
	[7927650f3b9b]

	* src/lib/ibuffer-internal.h, src/lib/ibuffer.c:
	We dont' need last_cr anymore.
	[81c8140719a4]

	* src/lib/ibuffer.c:
	Don't try to handle CR-only line changes, makes overly complex code
	and it's not needed anywhere.
	[6a5333eea7d1]

2002-10-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-compress.c:
	fdatasync() before close().
	[1f2bbcaf9ac5]

	* src/lib-index/mail-tree-redblack.c:
	after _mail_tree_grow(), the node_base changes and crashes
	[dbccdcccb7fa]

	* TODO:
	updated
	[4ff240ec007a]

	* src/lib-index/mail-tree-redblack.c, src/lib-index/mail-tree.c, src
	/lib-index/mail-tree.h:
	Instead of keeping "unused nodes" list in tree file, just move the
	last node over the deleted one. This way we're also able to truncate
	the file when needed.
	[fef80ac4fb09]

	* src/lib-index/mail-index-compress.c:
	Make sure we never truncate ourself smaller than
	INDEX_FILE_MIN_SIZE.
	[e57417d8f28a]

	* acconfig.h, configure.in, src/lib/compat.h:
	Check fdatasync() from -lrt if it's not in libc (solaris). Also
	fallback to fsync() entirely if fdatasync() doesn't exist.
	[83d4617e1dca]

	* src/lib/utc-mktime.c, src/lib/utc-offset.c:
	comment cleanups
	[293aac070c2c]

	* src/imap/cmd-append.c, src/lib-imap/imap-date.c, src/lib-imap/imap-
	date.h, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	from.c, src/lib-index/mbox/mbox-index.c, src/lib-mail/rfc822-date.c,
	src/lib-mail/rfc822-date.h, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage.h, src/lib/Makefile.am, src/lib/gmtoff.c,
	src/lib/gmtoff.h, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/utc-
	mktime.c, src/lib/utc-mktime.h, src/lib/utc-offset.c, src/lib/utc-
	offset.h:
	Fixes to timezone handling which were handling quite badly. added
	ioloop_timezone which gets updated with ioloop_time. Changed some
	GMT references to UTC. Timezone offsets are in minutes now
	everywhere instead of seconds. Fixes for unsigned time_t.
	[efa46e28a0d7]

	* src/lib-index/maildir/maildir-index.c:
	Ignore and leave maildir flags after ',' character (eg.
	file:2,S,U123).
	[a18cfbfbdad4]

2002-10-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-open.c,
	src/lib-index/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-
	storage/subscription-file/subscription-file.c, src/lib/file-lock.c,
	src/lib/file-lock.h, src/lib/lib-signals.c:
	file_wait_lock() now takes timeout-parameter so one badly behaving
	process won't start creating tons of lock-waiting processes.
	[fd0181ae25f6]

	* src/lib-index/mail-index.c:
	minor fixes
	[9783f589969b]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index-
	data.c, src/lib-index/mail-index-data.h, src/lib-index/mail-index-
	update.c, src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	src/lib-index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src
	/lib-index/mail-tree-redblack.c, src/lib-index/mail-tree.c, src/lib-
	index/mail-tree.h:
	Use fdatasync() instead of fsync() where possible. msync() all files
	first, then fsync them instead of msync+fsync+msync+fsync+.. data
	file now keeps track of when it's been changed, tree file didn't do
	mmap updates, plus other related cleanups.
	[48728d36513a]

	* src/lib-index/mail-custom-flags.h:
	comment update
	[9ad00c2c835e]

	* src/lib-index/mail-modifylog.c:
	if we're only process accessing modify log when it gets full, we can
	just truncate it instead of switching.
	[781c3aef4d68]

	* src/lib-index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src
	/lib-storage/index/index-messageset.c, src/lib-storage/index/index-
	sync.c:
	Modify log was pretty much broken whenever it was switched.
	[9f0263a945ba]

	* src/lib-index/mbox/mbox-rewrite.c:
	input buffer limit wasn't reset in error conditions.
	[006202bcab99]

	* src/lib/strfuncs.c:
	Assert i_snprintf() string lengths to INT_MAX instead of SSIZE_T_MAX
	since
	*printf()s returns int, not ssize_t..
	[990dae663bc3]

	* src/lib/compat.c, src/lib/strfuncs.c:
	Check vsnprintf() return values more carefully, thanks to Thomas
	Wouters <thomas@xs4all.net> for noticing.
	[d2303c38a7cf]

	* TODO:
	useless test commit
	[40b7d6ca51e3]

	* TODO:
	updated
	[24a649e9c6d1]

2002-10-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/obuffer-file.c:
	Still more bugfixes to o_buffer_send_ibuffer() without sendfile.
	[c64ef7b87247]

	* src/lib/obuffer-file.c:
	OBuffer was closed if sendfile() wasn't supported.
	[0363ba999da5]

	* src/lib/obuffer-file.c:
	o_buffer_send_ibuffer() didn't correctly update inbuf->v_offset when
	not using sendfile().
	[6617a4d1c424]

2002-10-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c:
	cleanups, also file_wait_lock() return value wasn't checked
	correctly
	[c519f9f6ae65]

	* src/lib-index/mail-modifylog.c:
	Try to truncate modify log when switching.
	[584aae46e2ca]

	* TODO:
	updated
	[47d0c169bdba]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h:
	Hardlink COPYing still copied the file name instead of generating a
	new one, which really broke things when mail was duplicated in the
	same mailbox.
	[cb7f34709d2d]

	* doc/configuration.txt, dovecot-example.conf, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/mbox/mbox-index.c, src/lib-
	storage/index/index-save.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c, src/master/imap-process.c, src/master/settings.c,
	src/master/settings.h:
	Added setting mail_save_crlf. Few other settings cleanups.
	[2fa0bfb65268]

	* src/lib/obuffer-file.c:
	Always flush buffer before closing it.
	[3448c77bb3d2]

	* src/lib/obuffer-file.c:
	writev() return value wasn't checked properly. EAGAIN and EINTR
	shouldn't be treated as fatal errors.
	[e85c1e9ff3d8]

2002-10-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c:
	List parsing was broken.
	[950b1c519e24]

	* src/master/main.c:
	typofix
	[24722a6b9ed2]

	* src/lib/fdpass.c:
	include sys/socket.h, not network.h. Required with solaris+ipv6
	where _XPG4_2 must be defined to get the cmsg-stuff to work but
	which also breaks ipv6.
	[fd24b81a7f04]

	* src/lib/strfuncs.c:
	Fail if %ll is used and we don't have long long.
	[c58fc0fd7894]

	* src/imap/mailbox-sync.c:
	Whops, this was missing from previous sync changes.
	[eeffd33b6b65]

	* configure.in, src/lib/failures.c, src/lib/strfuncs.c:
	Removed several useless handers of printf_string_upper_bound(), and
	added a few configure checks it required. That function could use a
	better audit.. Also stdlib.h was missing from failures.c for some
	reason..
	[c634b705f24b]

	* src/lib/ibuffer-data.c, src/lib/ibuffer-file.c, src/lib/ibuffer-
	internal.h, src/lib/ibuffer-mmap.c, src/lib/ibuffer.c,
	src/lib/ibuffer.h:
	i_buffer_skip() can't fail anymore, next read determines if it
	failed.
	[7434bac55c08]

	* dovecot-example.conf, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-index/maildir
	/maildir-rebuild.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	storage/index/index-storage.c, src/master/imap-process.c,
	src/master/settings.c, src/master/settings.h:
	Added mail_cache_fields and mail_never_cache_fields settings, plus
	settings cleanup.
	[67d22b7b0918]

	* src/lib-index/mail-index-util.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-storage/index/index-msgcache.c, src
	/lib-storage/index/index-search.c:
	cache_fields_later() doesn't need MailIndexRecord parameter.
	[00d857873975]

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/maildir/maildir-update.c:
	Don't call mail_index_update_header() if we don't want to cache
	anything.
	[985e9f790da5]

	* src/lib-index/mail-tree.c:
	Instead of growing tree file always 64 nodes larger, make it n%
	larger just like the index file. Huge performance gain with large
	mailboxes.
	[960075bacba6]

	* src/lib-index/mail-index-update.c, src/lib-index/mail-index-util.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-index.c, src/lib-index/mbox/mbox-index.c, src
	/lib-storage/index/index-msgcache.c, src/lib-storage/index/index-
	search.c:
	Added cache_fields_later() to MailIndex interface. That can be used
	to specify when some field is wanted to be cached, instead of doing
	it at every lookup_field*() call.
	[06377dd1e2a9]

	* src/lib-storage/index/index-storage.c:
	Indexes were never closed because refcount wasn't updated.
	[31cc41537495]

	* src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-index/mail-index-update-cache.c, src/lib-index
	/mail-index-util.c, src/lib-index/mail-index-util.h, src/lib-index
	/mail-index.h, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-open.c, src/lib-index/mbox/mbox-index.h, src
	/lib-index/mbox/mbox-open.c, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	fetch.h, src/lib-storage/index/index-msgcache.c, src/lib-
	storage/index/index-search.c:
	If maildir files are unexpectedly deleted, don't treat it as error,
	and don't return partially fetched data. Instead try to handle it
	just as if sync() had noticed it earlier.
	[f557fb280fb4]

	* src/lib-storage/index/index-expunge.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c:
	When doing EXPUNGE, if there's been external flag changes in
	messages we're going to delete, don't show the changes.
	[d5e5aef2d2c7]

	* src/lib-index/mail-modifylog.c, src/lib-storage/index/index-sync.c:
	Fixes for expunge handling
	[7b140cb09a2e]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src/lib-
	index/mail-tree-redblack.c, src/lib-storage/index/index-expunge.c,
	src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	messageset.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/index-
	update-flags.c, src/lib-storage/index/maildir/maildir-expunge.c, src
	/lib-storage/index/mbox/mbox-expunge.c, src/lib-storage/mail-
	storage.h:
	Modify log now stores the changes in ranges, so store 1:100 doesn't
	generate 100 entries but just one. For single message changes this
	takes 8 bytes unneededly though, that could be fixed but for extra
	complexity so I don't think it's worth it.

	Also a change in sync-interface, expunge event no longer gets UID.
	It's not currently needed and I don't see any rfcs/drafts wanting it
	either. It's removed mostly because the log ranges makes it
	impossible to get it.
	[0f6fd6802265]

2002-10-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-custom-
	flags.h, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-storage/index/index-copy.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c:
	mail_custom_flags_list_unref() isn't needed, the list returned by
	..list_get() can't be free'd even while the flags inside it may
	change. But only unused flags may change and only while calling
	..fix_list(), so it's no problem. Makes COPYing mails to selected
	mailbox work.
	[b5d9ce840177]

	* src/lib/strfuncs.c:
	printf_string_upper_bound(): Instead of just warning we can't handle
	something, panic. Much better idea than guessing something.
	[af7b05f88dae]

	* src/imap/Makefile.am, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-capability.c, src/imap/cmd-check.c, src/imap/cmd-
	close.c, src/imap/cmd-copy.c, src/imap/cmd-expunge.c, src/imap/cmd-
	fetch.c, src/imap/cmd-noop.c, src/imap/cmd-search.c, src/imap/cmd-
	select.c, src/imap/cmd-store.c, src/imap/commands-util.c, src/imap
	/commands-util.h, src/lib-imap/imap-util.c, src/lib-imap/imap-
	util.h, src/lib-index/mail-custom-flags.c, src/lib-index/mail-
	custom-flags.h, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-modifylog.c, src/lib-storage/index
	/index-expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-fetch.h, src/lib-storage/index/index-
	messageset.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-expunge.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-storage.h:
	MailStorage interface change. We now let storage call several sync-
	functions whenever it wants instead of forcing it through sync()
	function.

	This now allows us to send client FLAGS and PERMANENTFLAGS messages
	whenever new custom flags are added. Also EXPUNGE command now goes
	nicely through expunge() function (which CLOSE used) instead of
	through flag in sync(). "Out of disk space" alert is also sent now
	whenever it happens, before it was sent only when opening mailbox.

	Message set parser now complains when referencing mail sequences
	outside the possible range. Modify log before sent flags/expunges
	changes to client even if it didn't know about those messages yet.
	Also some other smaller cleanups.

	Beginnings of fixing APPEND and COPY when trying to store mails into
	selected mailbox. Before this didn't work too well or simply broke
	things. Still broken, needs a bit more changes..
	[925d6eb5f8be]

2002-10-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c:
	IMAP_ARG_EOL doesn't belong to number of arguments in list.
	[98588f02693b]

2002-10-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c:
	If data file was compressed, other processes didn't reopen it
	properly. Also added a few more sanity checks.
	[ce21406ba256]

	* src/lib-index/mail-index-update.c:
	when record data had to be moved to end of .data file, the old space
	was discarded but wasn't marked into header's deleted_space.
	[2423f01aedd2]

	* src/lib-index/mail-modifylog.c:
	Switching modify log was broken
	[7dfdd149e6a6]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h, src/lib-imap/imap-message-cache.c, src/lib-index
	/mail-index-data.c, src/lib-index/mail-index-data.h, src/lib-index
	/mail-index-update.c, src/lib-index/mail-index.h:
	If BODYSTRUCTURE is cached, we can use it to generate BODY reply. It
	takes some CPU, but probably still faster than needing to open the
	file.

	Also removed requirement of FIELD_TYPE_LOCATION to exist in .data
	file. This will be useful when we don't need the location (eg.
	filename == uid).
	[8179ef2a2c62]

	* src/imap/cmd-append.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c,
	src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/commands-
	util.c, src/imap/commands-util.h, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-
	storage/index/index-fetch.c, src/lib-storage/mail-search.c, src/lib-
	storage/mail-search.h:
	ImapArgList changed from linked list to array. easier to handle that
	way.
	[85ab93a7693b]

2002-10-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h:
	Delete unused temp files.
	[e730a1dcaaff]

	* src/lib-storage/index/index-search.c:
	SEARCH SEEN, UNSEEN, DELETED, UNDELETED, RECENT, UNRECENT
	optimizations. We can limit the fetched messages by checking
	lowwater marks in header. We can also immediately abort searching if
	header says there's no messages with such flags.
	[2a25bf21557b]

	* src/lib-storage/index/index-search.c:
	SEARCH SMALLER/LARGER - we may be able to handle the request using
	only physical sizes, avoids calculating the virtual size in those
	cases
	[4d77a27f7cd1]

	* src/lib-index/mail-index-data.c:
	Verify memory alignment when accessing index data file.
	[c54c1ca69362]

	* INSTALL, configure.in:
	Added --with-mem-align=BYTES option
	[b66ccecbc8a6]

	* src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	fetch.h:
	FETCH BODY[] sets \Seen flag to messages now while fetching it, not
	only after a successful fetch. This means that index is locked while
	doing this, and we also send FLAGS reply to client for messages
	where it was changed.
	[8fd9842b64d9]

	* src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-mail/message-send.c, src/lib-mail/message-send.h,
	src/lib-storage/index/index-fetch-section.c:
	Fixed several problems with FETCH BODY[..]<limits>, especially
	related to handling missing CRs.
	[20d5136a0c6a]

	* src/master/settings.c:
	more checks / fixes / cleanups
	[8a252e6567d7]

	* doc/configuration.txt, dovecot-example.conf:
	doc updates
	[06576f1d9e69]

	* src/master/settings.c:
	Set default SSL cert paths
	[e58a36e61d33]

	* src/login/client.c:
	doing LOGOUT now prints "Aborted login" to logfile instead of
	"Logged out"
	[a607e0ba2a66]

2002-10-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/cookie.c, src/auth/main.c:
	Initialize random generator before chrooting so it can open
	/dev/urandom
	[250a30e3cf70]

	* doc/configuration.txt:
	updated
	[5392919ed5dd]

	* doc/design.txt, doc/mail-storages.txt:
	updates
	[b3073f5b1e37]

	* .cvsignore, INSTALL, README, doc/auth.txt, doc/configuration.txt,
	doc/mail-storages.txt:
	Documentation updates.
	[58899a413569]

	* INSTALL:
	Added installation document
	[4c7d08ae3f6e]

	* src/login/ssl-proxy.c:
	removed gnutls-kludge, we require gnutls 0.5.5 or later now.
	[314bcc861a67]

	* configure.in:
	help update
	[951cb252e577]

2002-10-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-envelope.c:
	imap_envelope_parse() wasn't working
	[a63ec8754d2e]

	* src/lib-imap/imap-parser.c:
	use p_realloc() instead of p_realloc_min().
	[9824d5df1843]

	* src/lib/ibuffer-data.c:
	wasn't working
	[08b99ae95f30]

	* src/lib/mempool-alloconly.c:
	p_realloc() was buggy
	[5138499f90ad]

	* src/lib/obuffer-file.c:
	Use the largest output buffer size when growing corked buffer.
	[37c5e6ef22f4]

	* src/lib-mail/message-send.c:
	check return value of o_buffer_send() correctly
	[0de1093e8054]

	* src/lib/ibuffer-mmap.c:
	bugfix to seek()
	[64b8dc2f0c34]

	* src/lib/obuffer-file.c:
	iovec.iov_len may be signed, fix the warning
	[68bffc14763c]

	* src/lib/obuffer-file.c:
	o_buffer_send_ibuffer() - handle properly writing 0 bytes
	[829e85f92aa6]

	* src/lib-index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib/obuffer-file.c,
	src/lib/obuffer.h:
	Bugfixes to mbox and OBuffer handling.
	[cca1c7004a6f]

	* src/lib/ibuffer-mmap.c:
	bugfix
	[bd30c10f2864]

	* src/lib/ibuffer-mmap.c, src/lib/ibuffer.c:
	bugfixes
	[c9293b1f721b]

	* src/lib/obuffer.c:
	ignore 0 byte long sends.
	[0957ac190eaf]

	* configure.in:
	bugfix
	[79280b4912ff]

	* acconfig.h, configure.in:
	checks for writev()
	[c2fdc076ae7f]

	* src/auth/login-connection.c, src/auth/master.c, src/auth/userinfo-
	passwd-file.c, src/imap/client.c, src/imap/client.h, src/imap/cmd-
	append.c, src/imap/main.c, src/lib-imap/imap-bodystructure.c, src
	/lib-imap/imap-bodystructure.h, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-cache.h,
	src/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-
	index/mail-index-update-cache.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index-util.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-index.h, src/lib-index/maildir/maildir-
	open.c, src/lib-index/maildir/maildir-update.c, src/lib-index/mbox
	/mbox-append.c, src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox
	/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-index/mbox
	/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox
	/mbox-rewrite.c, src/lib-index/mbox/mbox-sync.c, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-mail/message-
	size.c, src/lib-mail/message-size.h, src/lib-storage/index/index-
	copy.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-fetch.h,
	src/lib-storage/index/index-msgcache.c, src/lib-storage/index/index-
	save.c, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-storage
	/mail-storage.h, src/lib/Makefile.am, src/lib/compat.c,
	src/lib/compat.h, src/lib/data-stack.c, src/lib/ibuffer-data.c,
	src/lib/ibuffer-file.c, src/lib/ibuffer-internal.h, src/lib/ibuffer-
	mmap.c, src/lib/ibuffer.c, src/lib/ibuffer.h, src/lib/iobuffer-
	internal.h, src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib/lib.h,
	src/lib/network.c, src/lib/network.h, src/lib/obuffer-file.c,
	src/lib/obuffer-internal.h, src/lib/obuffer.c, src/lib/obuffer.h,
	src/login/auth-connection.c, src/login/client-authenticate.c,
	src/login/client.c, src/login/client.h, src/master/auth-process.c,
	src/master/login-process.c, src/master/settings.c:
	Split IOBuffer into mmaped IBuffer, file IBuffer, memory data
	IBuffer and file OBuffer.
	[1f0e7229ee58]

2002-10-13  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	Check return values for malloc()s and calloc()s.
	[849f3846212a]

2002-10-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	imap/imap-parser.c, src/lib-index/mail-index-update.c, src/lib-index
	/mail-index.h, src/lib-mail/rfc822-date.c, src/lib-
	mail/rfc822-date.h, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/mail-search.c, src
	/lib-storage/mail-search.h:
	Dropped sent_time and alignment from MailIndexRecord. SEARCH can now
	use cached ENVELOPE data to search FROM, TO, CC, BCC, SUBJECT,
	HEADER MESSAGE-ID and HEADER IN-REPLY-TO. They're never cached
	anymore now. Also SEARCH SENT* had to be changed to use ENVELOPE (or
	fallback to Date-header parsing) because sent_time was removed.
	[e057845d94ca]

2002-10-11  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy.c:
	Print alerts to log.
	[6edfb92319cf]

2002-10-10  Timo Sirainen  <tss@iki.fi>

	* src/login/client.c, src/login/ssl-proxy.c:
	STARTTLS was broken
	[d12fa0b21a59]

	* src/lib/mmap-anon.c:
	bugfix/cleanup
	[576967cbd064]

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-open.c, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/maildir/maildir-
	update.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-storage/index/mbox/mbox-expunge.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib/ioloop.c, src/lib
	/mempool-datastack.c, src/lib/network.c:
	Created datastack_mempool which is used by at least a few temporary
	IOBuffers. Some other minor speedups/cleanups in IOBuffer and
	elsewhere..
	[f25e575bf1ca]

	* src/lib/Makefile.am:
	missing mempool-datastack.c
	[c3c7f9345f83]

2002-10-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/data-stack.c, src/lib/data-stack.h, src/lib/mempool.h,
	src/lib/temp-string.c:
	s/t_try_grow/t_try_realloc/
	[e90b95f6d962]

	* src/lib/data-stack.h:
	typofix
	[ec0b16ee7ef9]

	* src/auth/auth.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-parser.h, src/lib-mail/message-part-serialize.h, src/lib-
	mail/rfc822-tokenize.h, src/lib-storage/index/index-fetch-section.c,
	src/lib-storage/mail-storage.h, src/lib/base64.h, src/lib/hex-
	binary.h, src/lib/temp-string.h:
	changed all "temporary memory pool" references to "data stack"
	[f3ab97771ed8]

	* src/lib/Makefile.am, src/lib/data-stack.c, src/lib/data-stack.h,
	src/lib/lib.c, src/lib/lib.h, src/lib/temp-mempool.c, src/lib/temp-
	mempool.h:
	s/temporary memory pool/data stack/ which is the correct name for
	it.
	[383503837741]

	* src/lib-imap/imap-bodystructure.c:
	Parse Content-Language correctly for BODYSTRUCTURE.
	[e807d88e653c]

	* src/lib-mail/rfc822-tokenize.h:
	IS_TOKEN_STRING() wasn't working
	[9dfdd3f999bd]

	* src/lib-index/mbox/mbox-index.c:
	mbox_skip_forward() didn't correctly check for LF+CR+LF header
	ending.
	[d545f7835578]

	* src/lib-storage/index/index-fetch-section.c:
	FETCH BODY[HEADER.FIELDS*] is handled now better for huge headers.
	For headers larger than 32kB we now scan the header data twice
	instead of saving anything to memory.
	[8d3bfd8bc032]

	* src/lib/temp-mempool.c:
	t_try_grow() works now for "last allocated memory in current stack
	frame", instead of just for last allocated memory. ie. x =
	t_malloc(), t_push() ... t_pop(), t_try_grow(x) works.
	[24d69bc634d8]

	* src/lib-index/mail-index.c, src/lib-index/mail-tree-redblack.c:
	whops, update tree and modifylog with correct uid instead of 0.
	added extra assertions.
	[f09e67287f7d]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h:
	Fixes for first_hole_* updating. Removed last_lookup, it doesn't
	speed up much anymore and it's just annoyance to keep valid.
	[2f3d3ba129e1]

	* src/lib-index/mail-tree.c:
	mail_tree_rebuild() wasn't updated for new indexing code
	[55f04b297f87]

	* src/lib-index/mail-index.c:
	expunge fixes
	[0039b676a423]

	* src/auth/main.c, src/imap/main.c, src/lib-index/mail-index-
	compress.c, src/lib-index/mail-index-fsck.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-tree-
	redblack.c, src/lib-index/mail-tree.h, src/lib-index/maildir
	/maildir-open.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib/ioloop.c,
	src/lib/ioloop.h, src/master/main.c:
	ioloop_create() takes now pool-parameter. io_buffer_create_mmaped()
	takes start_offset parameter instead of getting it with lseek().
	Instead of using offsets to index file, we now use record indexes
	(first_hole_index, tree file).
	[60040a9d243f]

	* src/lib/network.c:
	Send error message if close() fails in net_disconnect().
	[792fc5b3daa4]

	* src/login/ssl-proxy.c:
	We didn't destroy the ssl connection after error in send.
	[eaaf0d2fea8d]

	* src/login/main.c, src/login/ssl-proxy.c:
	Don't warn about invalid sessions.
	[fec256b5f3fd]

2002-10-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-message-cache.c:
	imap_msgcache_get_rfc822_partial() calculated missing header size by
	actually reading it, instead of getting it from index file.
	[595aa6817b7f]

	* src/imap/cmd-select.c:
	\* flag was missing from PERMANENTFLAGS.
	[6b5814fd9e7d]

	* src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c:
	minor speedups
	[652553a9f54c]

2002-10-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/rfc822-address.c:
	Comments inside <> mail addresses crashed.
	[d1f925376da7]

	* src/lib-index/mail-index-open.c:
	"fast open" with (eg. used with STATUS) worked exactly opposite way,
	caching was done when "fast" was TRUE.
	[a78def4088c1]

	* src/lib-index/mail-tree-redblack.c:
	speedup
	[fb59a15622d0]

	* src/lib-index/mail-tree-redblack.c:
	mail_tree_lookup_uid_range() still buggy if first_uid wasn't found.
	[b319eb0fc181]

	* src/lib-index/mail-tree-redblack.c:
	sequence number still wasn't right always
	[225d515edaa1]

2002-10-06  Timo Sirainen  <tss@iki.fi>

	* src/lib/iobuffer.c:
	make io_buffer_send_flush() always removes the cork, even if there's
	nothing in output buffer.
	[356fe3713970]

	* TODO:
	updated with lots of new capability comments
	[fd1fc4cf11b7]

	* src/lib-index/mail-tree-redblack.c:
	still wrong seq
	[285b3ca58cf7]

	* src/lib-index/mail-tree-redblack.c:
	mail_tree_lookup_uid_range() didn't return correct seq number if the
	first UID wasn't found.
	[7f8b00d5ff68]

	* src/lib-index/mbox/mbox-lock.c:
	dotlock fixes: don't delete dotlock when we didn't create it (when
	removing a shared lock). if mbox file hasn't been changed for 5
	seconds, assume stale lock file.
	[5d2298649157]

	* src/lib/restrict-access.c:
	kludge: localtime() must be called before chroot(), or the timezone
	isn't known. fixes wrong timestamps with login process.
	[fb674793e75a]

	* src/login/ssl-proxy.c:
	Don't try to deinitialize gnutls if we haven't initialized it..
	[3ac9badb73ba]

	* src/lib-index/mbox/mbox-rewrite.c:
	Write Content-Length header for rewritten messages.
	[b0a62e264b22]

	* src/lib-imap/imap-message-cache.c, src/lib-index/mail-index-
	update.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	fsck.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	index.h, src/lib-index/mbox/mbox-rewrite.c, src/lib-mail/message-
	parser.c, src/lib-mail/message-parser.h, src/lib-storage/index
	/index-fetch-section.c, src/lib-storage/index/index-search.c:
	message_parse_header() now calls the function with empty name/value
	at end of headers. we use this feature with mbox to allow usage of
	Content-Length header field.
	[d037915978ca]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	Compress index when 50% of it is deleted.
	[44751b4d92e1]

	* src/lib-index/mbox/mbox-lock.c:
	lockfix
	[9b36fc3c1385]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-lock.c:
	more locking fixes.
	[0da2b09461aa]

	* src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-lock.c, src
	/lib-index/mbox/mbox-lock.h, src/lib-index/mbox/mbox-rebuild.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-save.c:
	mbox locking cleanups
	[cb405d2f5fd5]

	* src/auth/master.c, src/auth/userinfo-passwd-file.c,
	src/imap/client.c, src/lib-imap/imap-message-cache.c, src/lib-index
	/mail-index-update-cache.c, src/lib-index/mail-index-util.c, src
	/lib-index/mail-index.h, src/lib-index/maildir/maildir-update.c, src
	/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src
	/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-fetch.h, src/lib-storage/index
	/index-msgcache.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib/iobuffer.c, src/lib/iobuffer.h, src/login/auth-
	connection.c, src/login/client.c, src/master/auth-process.c,
	src/master/login-process.c, src/master/settings.c:
	Added io_buffer_set_start_offset() and io_buffer_ref() and replaced
	io_buffer_destroy() with io_buffer_unref().

	mbox file is now kept open all the time.
	[ea958a5b9de1]

	* src/auth/userinfo-passwd-file.c, src/lib-imap/imap-message-cache.c,
	src/lib-index/mail-index-update-cache.c, src/lib-index/mail-index-
	util.c, src/lib-index/maildir/maildir-open.c, src/lib-index/maildir
	/maildir-update.c, src/lib-index/mbox/mbox-fsck.c, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/index-msgcache.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/mbox/mbox-expunge.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h, src/master/settings.c:
	Added autoclose_fd-flag for io_buffer_create_file() and
	io_buffer_create_mmap().
	[567e932cdc66]

	* src/lib-index/mbox/mbox-rewrite.c:
	When updating any of the fields, keep them in the original location
	in header instead of moving to bottom.
	[aa449d013563]

	* src/lib-index/mail-index.c:
	Small optimization for mail_index_lookup() when there's only one
	hole in index file.
	[7a0be5e88815]

	* src/lib-index/mail-tree-redblack.c:
	guess it works now, debugging disabled now.
	[d57e5037db2c]

	* src/lib-index/mail-tree-redblack.c, src/lib-index/mail-tree.c:
	bugfixes
	[9fd132e47845]

	* src/lib-index/mail-index-data.c:
	If the data file was fully truncated, the mmap wasn't updated and it
	crashed later.
	[cf4b8f204aea]

	* src/lib-index/mail-tree-redblack.c:
	bad typo bug
	[16d22ccf3f54]

	* src/lib-index/mail-tree-redblack.c:
	crashfix when growing tree file size
	[a39343e9e197]

	* src/lib-index/Makefile.am, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h, src/lib-index/mail-index-compress.c, src/lib-index
	/mail-index-open.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-modifylog.c, src/lib-index/mail-tree-
	redblack.c, src/lib-index/mail-tree.c, src/lib-index/mail-tree.h,
	src/lib-index/maildir/maildir-index.c, src/lib-index/maildir
	/maildir-rebuild.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-storage/index/index-expunge.c,
	src/lib-storage/index/index-messageset.c, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-sync.c:
	First version of binary tree file, still some locking issues while
	opening the file.
	[0dc59fd3faed]

	* src/auth/userinfo-passwd-file.c:
	one final hpux fix.
	[c2269ed9ffcb]

	* NEWS, configure.in:
	0.98.4 released
	[ae6b163339a8]

	* src/lib-index/mbox/mbox-index.c, src/lib-storage/index/index-save.c,
	src/lib-storage/index/index-search.c:
	compiler warning fixes
	[693f93219218]

	* src/auth/auth-digest-md5.c, src/auth/userinfo-pam.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-shadow.c, src/login/client-
	authenticate.c:
	more compiler warnings fixes
	[adefba58053b]

	* src/lib/fdpass.c, src/lib/iobuffer.c, src/login/auth-connection.c,
	src/login/client.h:
	compiler fixes
	[2c6b6594a14b]

	* src/lib/network.c, src/lib/network.h:
	keep the port unsigned.
	[fd32faeb7ba5]

2002-10-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c, src/lib-index/mbox/mbox-append.c, src
	/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.h, src
	/lib-mail/message-parser.c:
	compiler warning fixes
	[f15420cb362d]

	* src/lib/mmap-anon.c:
	hpux compiler fix
	[5d8688afe0ad]

	* src/lib/md5.c:
	Fix for hpux ansi compiler.
	[19cb83563b20]

	* src/lib/fdpass.c:
	Define CMSG_SPACE always if it's undefined, not only if __sun__ is
	defined.
	[9efeeb4ac5a9]

2002-10-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop.c:
	extra checks
	[2ee7f547201a]

	* src/lib-mail/message-send.c:
	message_send() didn't correctly add CR to 256k boundaries.
	[c756ed5a0351]

2002-10-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	() was missing around envelope in body/bodystructure.
	[eeb855e385ce]

	* configure.in:
	0.98.3 version number update
	[39e430a0d212]

	* NEWS, TODO:
	0.98.3 out..
	[37d52d6a3e7a]

	* src/lib-imap/Makefile.am, src/lib-imap/imap-bodystructure.c, src
	/lib-imap/imap-envelope.c, src/lib-imap/imap-quote.c, src/lib-imap
	/imap-quote.h:
	Several fields in BODY were unquoted.
	[6f4eeb6a0a0d]

2002-09-30  Timo Sirainen  <tss@iki.fi>

	* TODO:
	update
	[36ab6a6c8bdf]

	* NEWS, TODO, configure.in:
	0.98.2 released
	[25f2b396c297]

	* src/lib-index/mbox/mbox-fsck.c:
	t_push() added
	[38bb7337df0c]

	* src/lib-mail/message-part-serialize.c:
	message_part_serialize_update_header() was still broken, it modified
	the start position of header record.
	[526ebe074df1]

	* src/lib-index/mail-index-update.c, src/lib-index/mail-index-util.c,
	src/lib-index/mail-index.h, src/lib-index/mbox/mbox-fsck.c, src/lib-
	index/mbox/mbox-index.c, src/lib-mail/message-part-serialize.c, src
	/lib-storage/index/index-msgcache.c:
	Cached MessagePart reading wasn't working because alignment broke
	the strict size checking.
	[e34e14d758eb]

	* src/lib-storage/index/maildir/maildir-copy.c:
	hardlink-COPY fixed.
	[fad3998041d4]

2002-09-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	cleanup
	[aeff4a271544]

	* src/master/common.h:
	cleanup
	[0903ba071661]

	* src/lib/mempool-alloconly.c, src/lib/mempool-system.c:
	more ANSI-C fixes.
	[1b503c732877]

	* src/lib-index/maildir/maildir-index.c, src/lib-index/mbox/mbox-
	index.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	ANSI-C compatibility fixes
	[39c9a9fc190b]

	* configure.in:
	s/--enable/--with/ to all auth modules. added --with-file-offset-
	size=BITS
	[a0abed892d11]

	* src/lib-index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-messageset.c, src/lib-
	storage/index/index-messageset.h, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/mail-storage.h:
	Modify log fixes. STORE and SEARCH didn't handle properly message
	sequence numbers when some in the middle were externally deleted.
	[276b7a53c264]

2002-09-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h:
	cleanup
	[b79b6da2f84a]

	* src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-store.c,
	src/imap/commands-util.c, src/imap/commands-util.h, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	sync.c, src/lib-storage/mail-storage.h:
	Send RECENT after all EXISTS replies. Check for new mail in mailbox
	after each FETCH, STORE and SEARCH commands and notify about it with
	EXISTS.
	[ba058497efa9]

2002-09-27  Timo Sirainen  <tss@iki.fi>

	* src/login/auth-connection.c:
	if auth processes were killed, login process didn't reconnect to
	them
	[b7f6772b91ff]

2002-09-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-message-cache.c:
	Always return ENVELOPE, even if full of NILs.
	[cdd72de7214b]

	* src/lib/iobuffer.c:
	Handle mmap() failures better.
	[b3bbd1b0fbd7]

	* src/lib-mail/message-part-serialize.c:
	message_part_serialize_update_header() didn't update positions for
	subparts so they got broken with mbox when headers were updated.
	[2b2dc11ea0f6]

	* src/lib-index/mail-index-update-cache.c:
	fsck() before updating the cache.
	[fb2bb2d2b4a5]

	* src/imap/cmd-select.c, src/lib-storage/index/index-status.c, src
	/lib-storage/mail-storage.h:
	When selecting a mailbox and we're out of disk space, send ALERT to
	user telling about it.
	[d0cff4da67ac]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-util.c:
	out of disk space -fixes
	[6f82f54b8e27]

2002-09-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	Only first search condition was checked.
	[79d9a40fbb72]

	* src/login/client-authenticate.c:
	If authentication failed, the failure message was written to output
	buffer but the buffer wasn't flushed.
	[0c1ff60e55e6]

2002-09-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	custom flags weren't saved properly.
	[f07ad72a1c7e]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox ignored message flags for APPEND.
	[d2a305fa0ec2]

	* NEWS, TODO, configure.in:
	released 0.98.1
	[df941be7c6b0]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index.h, src
	/lib-index/mbox/mbox-rewrite.c:
	Rewrite only needed parts of mbox. We don't rename() anymore, which
	means we play nicely now with symlinks and avoid possible data loss
	when new mail was being sent while we were rewriting.
	[f5e59d65d124]

	* src/lib/iobuffer.c:
	io_buffer_send_iobuffer() didn't set buf_errno if sendfile() failed.
	[2cb72f8e0998]

	* src/lib-index/mbox/mbox-from.c:
	One digit day wasn't parsed correctly in From-line.
	[98e62bc03363]

	* src/lib/lib-signals.c:
	comment fix
	[5b20fb38ac92]

	* src/imap/cmd-append.c, src/lib-imap/imap-parser.c:
	We didn't allow saving messages longer than 8192 bytes. Now we also
	send the "+ OK" only after other parameters have been verified to be
	ok.
	[899d3e189dbf]

	* src/lib-imap/imap-bodystructure.c:
	BODY / BODYSTRUCTURE generator didn't like if message didn't start
	from zero offset in inbuf.
	[5954f9c2e620]

	* src/lib-index/mail-index-update.c:
	mail_index_update_headers() seeked always to beginning of file,
	instead of beginning of message, which broke mbox.
	[3f9c648d34db]

2002-09-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	CREATE and DELETE fixes for mbox (last changes for .98 :)
	[21a9d15025c7]

	* NEWS, TODO, configure.in:
	0.98 released.
	[fd304e62e88a]

	* src/lib-index/mbox/mbox-rewrite.c:
	Actually, first don't do anything if there's no dirty flags. Then
	fsck(). Then check again if fsck() removed the dirty flags.
	[19108e7c5af2]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-rename.c, src/imap/cmd-subscribe.c, src/imap/commands-
	util.c, src/imap/commands-util.h:
	UNSUBSCRIBE wasn't working.
	[20769b7516a2]

	* src/lib-index/mbox/mbox-rewrite.c:
	fsck() before checking the rewrite-flag, so we won't write the
	1-byte files..
	[1d4d92c2e8c9]

	* src/lib-index/mbox/mbox-rewrite.c:
	keep exclusive lock while rewriting.
	[a101127403a7]

	* TODO:
	updated
	[696139d3b8f6]

	* src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-lock.c, src
	/lib-index/mbox/mbox-lock.h, src/lib-index/mbox/mbox-rebuild.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-save.c:
	mbox locking changes. support read-locking now. there's still
	problems though..
	[5509d87fe68b]

	* src/lib-index/mail-index-update-cache.c, src/lib-index/mbox/mbox-
	fsck.c, src/lib-index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-
	rebuild.c, src/lib-index/mbox/mbox-rewrite.c:
	some cleanups + fd leaks when recaching mailbox.
	[ef6ae9e1b585]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-select.c,
	src/imap/cmd-status.c, src/lib-index/mail-index-open.c, src/lib-
	index/mail-index.h, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-storage.h:
	Added fast-flag for mailbox opening, which doesn't do any index
	compressing or cache updating. This flag is set when mailbox is
	opened by APPEND, COPY or STATUS (ie. not SELECT/EXAMINE).
	[d66aa1f1fb2d]

	* src/imap/cmd-logout.c:
	close mailbox before sending "OK Logout completed", because the
	closing may take some time with mbox
	[c6c0e376008f]

	* src/lib-index/mbox/mbox-index.c:
	Better checking for the ending From-line, so it won't falsely check
	it in some outbox messages.
	[e6a00377af97]

	* TODO:
	updated
	[21d53f6b38fc]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-fsck.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h:
	Handle properly messages which have only partial header (eg. new
	From-line comes before \n\n).
	[7a4fac415698]

	* src/lib-index/mail-index-compress.c:
	mail_index_compress_data() didn't set used_file_size in header
	[57a111fd821b]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-mail/message-parser.c, src/lib-storage/index/index-save.c,
	src/lib-storage/index/index-search.c, src/lib/iobuffer.c,
	src/lib/iobuffer.h:
	IOBuffer cleanup, hopefully fixes some mbox problems.
	[3dcc2275b4ca]

2002-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-fsck.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h,
	src/lib-index/mbox/mbox-rebuild.c:
	Ignore empty lines at beginning of mbox file.
	[c020e1168cc3]

2002-09-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/Makefile.am:
	missing header file
	[0d75aa8b7344]

	* src/lib-index/mail-modifylog.c:
	switching modifylog crashed.
	[51eea5cbb075]

2002-09-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-fsck.c:
	mbox fsck() didn't like files containing only "\n". fsck also now
	resets dirty flag in header if it didn't find any dirty flags. this
	also fixes mbox_rewrite() creating those \n-files.
	[e5fdb222d38a]

	* src/lib-index/mail-index-data.c:
	wrong parameters to msync(), causing it to fail when trying to mark
	old data file deleted.
	[49e6f5496071]

	* dovecot-example.conf:
	list supported auth methods
	[8d7e46d41ce3]

	* configure.in:
	vpopmail needs also crypt()
	[00dbc7e5f441]

	* configure.in:
	list vpopmail in auths list.
	[536bb62e73bd]

	* configure.in:
	print "checking vpopmail"
	[b7fe6867e549]

	* acconfig.h, configure.in, dovecot-example.conf,
	src/auth/Makefile.am, src/auth/userinfo-vpopmail.c,
	src/auth/userinfo.c, src/auth/userinfo.h:
	vpopmail authentication. compiles, not tested if it really works.
	[fa2d1a1d025e]

	* src/master/main.c:
	Print usage with invalid parameters.
	[49f4b0be0d87]

	* src/lib-index/mail-index-data.c:
	mail_index_data_sync_file() now doesn't complain if mmap_used_length
	is 0
	[abd08fadb297]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index-
	fsck.c, src/lib-index/mail-index.c:
	Index compression broke it + few other fixes
	[6173b306d276]

	* src/lib-index/mail-index-fsck.c:
	fsck() now prints what differences it found
	[406527c791c7]

2002-09-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-expunge.c:
	don't silently ignore if expunge can't unlink() some message.
	[910afdb348ae]

	* src/lib-index/maildir/maildir-index.c:
	rename() file first, only then update index if it was successful.
	[ce5b402f6a7a]

	* src/lib-storage/index/index-update-flags.c:
	STORE needs to sync too, or maildir could see old filenames.
	[9be2c12d0983]

	* src/lib-mail/message-content-parser.c:
	message_content_parse_header() didn't parse the header properly and
	just skipped all but the first parameter.
	[de8683b5bb16]

	* src/lib-index/mail-index-open.c:
	..better crashfix, to fix mbox crashes too..
	[bd51b6445bcd]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-open.c:
	crashed if index or hash was rebuilt
	[6dfdda80e822]

2002-09-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-storage/index/index-expunge.c:
	FSCK flag is removed at set_lock(), so it can't be directly set
	anywhere.. but using index->set_flags |= FSCK now keeps it. fixes
	mbox problems after flag changes.
	[a4eb58705351]

	* src/lib-storage/index/index-update-flags.c:
	Don't save \Recent flag to index.
	[7cb03d43a0ea]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-fsck.c,
	src/lib-storage/index/mbox/mbox-expunge.c:
	Handle 1-bytes mbox files (just \n) without any warnings, and
	expunging all mails now doesn't write the \n.
	[54b3b82bd73e]

	* src/lib-index/mbox/mbox-from.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-save.c:
	expunging last message from mbox duplicated the whole file.
	appending mail to mbox works now too.
	[757c32a1920d]

	* src/lib-mail/message-parser.c:
	message_parse_header() went to infinite loop with partial header
	[d0ba9a65891c]

2002-09-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-envelope.c:
	\r\n chars are now always stripped from headers before placing them
	in envelope.
	[483f4afe5da2]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-open.c, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-rebuild.c, src/lib-index/maildir/maildir-
	sync.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-storage/index
	/index-status.c:
	if hash was rebuilt, it wasn't always mmap()ed. recent-status wasn't
	updated properly when opening mails. maildir sync() didn't always
	expunge messages with correct sequence number. added some checks for
	messages_count in header.
	[30ee462a6457]

	* src/lib-index/mail-index-open.c:
	when opening index, sync before updating cached fields so it won't
	print warnings if mails were deleted
	[f5b444bf9157]

	* src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	fetch.h, src/lib-storage/index/index-messageset.h:
	Report FETCH failure properly
	[29cf23950452]

	* src/imap/cmd-subscribe.c:
	UNSUBSCRIBE didn't work if folder didn't exist.
	[38282593753f]

	* src/lib-index/mail-modifylog.c:
	still wrong..
	[cdf38b5cc2b7]

	* src/lib-index/mail-modifylog.c:
	modifylog opening was buggy
	[0a45c4744f51]

	* src/lib-index/mail-modifylog.c:
	fixed some locking issues
	[90abe1af4c72]

	* src/lib-index/mail-index.c:
	mail_index_lookup() didn't always return correct record..
	[73a5f8a34893]

	* src/lib-index/mail-index-compress.c:
	bugfix
	[518f63be3723]

	* src/lib-index/mail-index.c:
	cleanup/fix
	[08135c37551a]

	* src/lib-mail/message-parser.c:
	message_parse_header() works now properly if there's no message body
	at all, or if the ending \n is missing from header.
	[62058959536a]

	* src/lib/file-set-size.c:
	file_set_size() was buggy when it was supposed to shrink file
	[14bad0a48eb4]

	* src/imap/cmd-status.c:
	bugfix
	[ff68d1f1e75b]

	* src/lib-index/mbox/mbox-index.c:
	don't set flags dirty when they were updated by external change
	[0c5832e58728]

	* src/lib-index/mail-index-data.c:
	data file wasn't initialized properly
	[f0a52521d844]

	* src/lib-index/mail-index-data.c:
	don't set mmap_used_length to 0 before msync()ing with it..
	[fbe3a420e960]

	* configure.in:
	report --without-gnutls better..
	[cba0daefb7a5]

	* configure.in:
	another typo .. maybe --without-gnutls works now :)
	[fa3b4c2e252a]

	* configure.in:
	typo..
	[9cae5f6626ff]

	* configure.in:
	added --without-gnutls option
	[bf1e284fece2]

	* src/lib/mmap-anon.c:
	..and don't #undef the linux mremap() support..
	[1f6f8e4557b1]

	* src/lib/mmap-anon.c:
	portability fixes
	[015910e16bfa]

	* src/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-
	rewrite.c:
	mbox fixes
	[fc8ad9d30478]

	* src/lib-index/mail-modifylog.c:
	fixes
	[5523767c0515]

	* src/lib-index/mail-hash.c:
	hash creation was buggy
	[1e05ff078961]

	* src/lib-index/mail-index.c:
	bugfixes
	[acb77be5d683]

	* src/imap/cmd-append.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-index-data.c, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-storage/index/index-save.c:
	Fixes for no diskspace handling. seems to work now.
	[06d6eca0a45f]

	* src/lib/strfuncs.c:
	previous t_push()/t_pop() changes break things. fixed :)
	[400ac5f9ed40]

	* TODO:
	updated
	[1fe8eae6fd89]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-index
	/mail-modifylog.h:
	Modify log is now able to stay in memory. Some other fixes/cleanups.
	[aef7c7a8f691]

	* src/lib/strfuncs.c:
	t_push()/t_pop() around various *sprintf() functions, so "%m" format
	won't eat extra memory.
	[3f92df43cfa7]

2002-09-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-message-cache.c, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src
	/lib-mail/message-parser.c, src/lib-mail/message-send.c, src/lib-
	mail/message-size.c, src/lib-storage/index/mbox/mbox-expunge.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h:
	s/io_buffer_read_data/io_buffer_read_data_blocking/ and fixed the
	various kludges elsewhere to use it more easily
	[9277e893304e]

	* src/lib-index/mail-modifylog.c:
	we shouldn't crash anymore when modify log gets full
	[bbd248788571]

	* src/imap/cmd-status.c, src/lib-storage/index/index-status.c:
	minor fixes
	[fc1859e67253]

	* src/lib-index/mail-index.c:
	messages flags were added twice to header
	[9ef72cb26b30]

	* src/lib-index/mail-index.c:
	always verify the seen/deleted message counts in index header
	[a97509eb0bc3]

	* src/lib-storage/index/index-fetch-section.c:
	removed extra whitespace
	[2499dad2932b]

	* src/lib-index/mail-index-data.c:
	creating data file didn't work
	[a3fa2d4f441c]

	* acconfig.h:
	mremap check again..
	[c02b968d0378]

	* configure.in:
	mremap() check
	[e8863d6088fe]

	* src/lib-index/mail-hash.c, src/lib-index/mail-hash.h, src/lib-index
	/mail-index-compress.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index-data.h, src/lib-index/mail-index.c, src/lib-index
	/mail-lockdir.c, src/lib-index/mail-modifylog.c, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-save.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib/write-full.h:
	More cleanups. lib-storage should handle "out of disk space"
	conditions properly.
	[ca6967899c05]

2002-09-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/lib-imap/imap-message-cache.c, src/lib-
	index/Makefile.am, src/lib-index/mail-custom-flags.c, src/lib-index
	/mail-hash.c, src/lib-index/mail-index-compress.c, src/lib-index
	/mail-index-data.c, src/lib-index/mail-index-data.h, src/lib-index
	/mail-index-fsck.c, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index-util.c, src/lib-index/mail-index-util.h, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-index/mail-
	modifylog.c, src/lib-index/maildir/maildir-build.c, src/lib-
	index/maildir/maildir-index.c, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-rebuild.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h, src/lib-
	storage/index/index-messageset.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-storage
	/subscription-file/subscription-file.c, src/lib/Makefile.am, src/lib
	/file-lock.c, src/lib/file-lock.h, src/lib/file-set-size.c, src/lib
	/file-set-size.h, src/lib/mmap-anon.c, src/lib/mmap-util.c, src/lib
	/mmap-util.h:
	lots of cleanups. also index/datafile is now capable of staying in
	memory, as long as it's noticed while opening the index.
	[cf4d065f2f85]

2002-09-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-hash.c, src
	/lib-index/mail-index-compress.c, src/lib-index/mail-index-data.c,
	src/lib-index/mail-index-data.h, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index-util.c, src/lib-index/mail-index-util.h,
	src/lib-index/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-
	index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/maildir/maildir-open.c, src/lib-index/maildir
	/maildir-rebuild.c, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync.c, src/lib-storage/index/index-status.c,
	src/lib/Makefile.am, src/lib/file-set-size.c, src/lib/file-set-
	size.h, src/lib/mmap-util.c, src/lib/mmap-util.h:
	Added extra functions for easier printing of error messages. Moved
	file_set_size() to generic function in lib. If there's no space to
	build hash file, it builds itself in anon-mmaped memory and stays
	there.
	[ed0d5b17c7a4]

	* src/lib/failures.c, src/lib/failures.h:
	make sure failure handlers don't modify errno.
	[94382d79ae47]

2002-09-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c:
	Index data file wasn't re-mmap()ed always when file size was
	changed, resulting in corruption error messages.
	[79ae841efc11]

2002-09-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	expunge() shouldn't update mmap, since we could be just going
	through the index records.
	[e506203cffa4]

	* src/lib-index/mbox/mbox-rewrite.c:
	Don't fsck() at mbox_index_rewrite() if there's no dirty flags.
	[b426c07093d3]

	* src/lib-storage/index/index-search.c:
	SEARCH fixes
	[12f056754b7b]

	* src/lib/iobuffer.c:
	io_buffer_read_mmaped() now also returns correct amount of bytes
	[6a18c1cf4d68]

	* src/lib/iobuffer.c:
	fixes for io_buffer_read_max()
	[05a1cf2761da]

	* src/lib-index/mbox/mbox-open.c:
	cleanup
	[2a2ab4994b8a]

	* src/lib-mail/message-parser.c:
	message/rfc822 mime parts weren't parsed correctly
	[4327b1266604]

	* src/lib-storage/index/index-search.c:
	crashfix for searching from message body
	[9ee27ef24ab8]

	* src/lib-index/mail-index.c:
	Actually, don't bother fsyncing after each written mail, it slows
	down too much and the corruption can be handled later just fine.
	[78df368a395b]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-rewrite.c:
	Don't rewrite mbox if no flags were changed.
	[d85a6898bf39]

	* src/lib-index/mail-index-update.c:
	Date-field wasn't saved when ENVELOPE was cached into index.
	[8617d7a36fd6]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	index.c:
	Broke saving new mail
	[9f78db959fdc]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-build.c, src/lib-index/mbox/mbox-append.c:
	cleanups / reliability fixes
	[0bb7bf7266ab]

	* src/lib-index/mail-index-data.c:
	error message update
	[ad2ceb287fce]

2002-09-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/compat.h:
	cast i_toupper() and i_tolower() return as char, so comparing
	highascii works without casting (breaks if comparing to unsigned
	char though)
	[f0f49949009b]

	* src/lib-mail/rfc822-date.c:
	typofix for parsing 'S' timeszone
	[24dda549b0ce]

	* src/lib-imap/imap-envelope.c:
	Highascii + space at end of some ENVELOPE header got into infinite
	loop.
	[70646fbf2c35]

	* src/login/ssl-proxy.c:
	crashfix if client closed before SSL handshake was done
	[16cc35217bfb]

	* src/lib-imap/imap-message-cache.c:
	crashfix
	[16ae7b6a2f0b]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-modifylog.c,
	src/lib-storage/index/index-save.c, src/lib/iobuffer.h:
	custom flag & copy crash fixes.
	[cf1279829ad1]

	* src/lib-storage/index/mbox/mbox-expunge.c:
	EXPUNGE works with mbox. finally.
	[e6e5fd3d4718]

	* src/lib/iobuffer.c:
	offset wasn't updated properly to output buffers with sendfile().
	[38d77994baa5]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-custom-
	flags.h, src/lib-index/mail-index.c, src/lib-index/mbox/mbox-
	append.c, src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-
	index.c, src/lib-index/mbox/mbox-index.h, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/mbox/mbox-storage.c:
	X-IMAPbase is now parsed correctly.
	[95d21ab87eeb]

2002-09-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-util.c, src/lib-storage/index/index-
	msgcache.c, src/lib/hash.c, src/lib/macros.h, src/login/auth-
	connection.c, src/login/ssl-proxy.c, src/master/common.h, src/master
	/login-process.c:
	Replaced INT_TO_POINTER and POINTER_TO_INT macros with POINTER_CAST
	and POINTER_CAST_TO macros, the CAST_TO takes a parameter to which
	type we're casting to. Also POINTER_CAST should be valid ANSI-C now.
	[db6e288be0e9]

	* src/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-fsck.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c:
	more size_t fixes
	[d82e7d23a28d]

	* src/lib-imap/imap-bodystructure.c, src/lib-index/mail-hash.c, src
	/lib-index/mail-index-update.c, src/lib-index/mail-index.c, src/lib-
	index/mail-index.h, src/lib-index/mbox/mbox-fsck.c, src/lib-
	index/mbox/mbox-index.c, src/lib-storage/index/index-save.c,
	src/lib/macros.h, src/login/auth-connection.h:
	more size_t fixes.
	[c095607a1a28]

	* src/lib/lib.c, src/lib/temp-mempool.c:
	more size_t fixes
	[fcd6c11710b4]

	* configure.in:
	ssize_t should be checked against long before long long.
	[e5465a0c6964]

	* src/lib/iobuffer.c:
	size_t breakages
	[d80488b69f6c]

	* src/lib/iobuffer.c:
	forgot to change some ints into ssize_t
	[550398e31b88]

	* src/lib/lib.c:
	..and now it uses size_t properly..
	[88b31d45c8a4]

	* src/lib/lib.c, src/lib/lib.h, src/lib/macros.h:
	nearest_power() uses now size_t.
	[ecbff0f2b811]

	* configure.in:
	result of ssize_t check wasn't reported
	[041fb6098877]

	* configure.in:
	fixed ssize_t and off_t checks.
	[60925d3e2c4d]

	* src/auth/auth-digest-md5.c, src/auth/auth-interface.h, src/auth
	/auth-plain.c, src/auth/login-connection.c, src/auth/userinfo-
	passwd-file.c, src/imap/client.c, src/imap/cmd-append.c, src/lib-
	imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-imap
	/imap-message-cache.c, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-util.c, src/lib-index/mail-custom-flags.c, src/lib-index/mail-
	hash.c, src/lib-index/mail-index-data.c, src/lib-index/mail-index-
	data.h, src/lib-index/mail-index-update.c, src/lib-index/mail-
	index.h, src/lib-index/maildir/maildir-build.c, src/lib-index/mbox
	/mbox-append.c, src/lib-index/mbox/mbox-from.c, src/lib-index/mbox
	/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-index/mbox
	/mbox-rewrite.c, src/lib-mail/message-parser.c, src/lib-mail
	/message-parser.h, src/lib-mail/message-part-serialize.c, src/lib-
	mail/message-part-serialize.h, src/lib-mail/message-send.c, src/lib-
	mail/message-size.c, src/lib-mail/rfc822-date.c, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/index/index-fetch-section.c, src/lib-storage/index/index-
	save.c, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/lib/base64.c,
	src/lib/base64.h, src/login/auth-connection.c, src/login/client-
	authenticate.c, src/login/ssl-proxy.c:
	move size_t fixes
	[4223b9ed0c80]

	* acconfig.h, configure.in, src/imap/commands-util.c, src/lib-imap
	/imap-bodystructure.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib/base64.c, src/lib/base64.h,
	src/lib/fdpass.c, src/lib/fdpass.h, src/lib/hex-binary.c, src/lib
	/hex-binary.h, src/lib/imem.c, src/lib/imem.h, src/lib/iobuffer.c,
	src/lib/iobuffer.h, src/lib/md5.c, src/lib/md5.h, src/lib/mempool-
	alloconly.c, src/lib/mempool-system.c, src/lib/mempool.c,
	src/lib/mempool.h, src/lib/mmap-util.c, src/lib/network.c,
	src/lib/network.h, src/lib/randgen.c, src/lib/randgen.h,
	src/lib/strfuncs.c, src/lib/strfuncs.h, src/lib/temp-mempool.c,
	src/lib/temp-mempool.h, src/lib/temp-string.c, src/lib/temp-
	string.h, src/lib/write-full.c:
	size_t fixes for lib/. Changed OFF_T_FORMAT to PRIuOFF_T which is
	more C99-like.
	[4a7ab9e94f25]

	* src/imap/Makefile.am:
	flags-file isn't needed anymore
	[7fc832e6bab4]

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox compilation fix
	[f1bdcf3448f6]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-rewrite.c:
	partial changes to add X-IMAPbase parser update custom flags
	[38341ad6a9db]

	* acconfig.h, configure.in, src/lib/compat.h, src/lib/hostpid.c,
	src/lib/lib.h, src/lib/strfuncs.c, src/lib/strfuncs.h:
	added dec2str() function and largest_t type, removed itoa() and
	ltoa() macros and did some other cleanups.
	[0ffecd4e7e1a]

	* src/lib/macros.h:
	Better fix for POINTER_TO_UINT
	[f012779ee5ef]

	* src/lib/macros.h:
	POINTER_TO_UINT() fixed to not give warnings with 64bit pointers.
	[af686373b971]

	* src/lib/compat.c:
	missed header file with some conditions.
	[782a0d4baa71]

	* configure.in, src/lib-index/Makefile.am, src/lib-index/mail-custom-
	flags.c, src/lib-index/mail-custom-flags.h, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-storage/Makefile.am,
	src/lib-storage/flags-file/.cvsignore, src/lib-storage/flags-
	file/Makefile.am, src/lib-storage/flags-file/flags-file.c, src/lib-
	storage/flags-file/flags-file.h, src/lib-storage/index/index-copy.c,
	src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c:
	Moved custom flags handling into lib-index.
	[73bf05a1d862]

2002-09-07  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy.c:
	nonblocking handshake was a bit buggy
	[61b0bb62b42e]

	* src/login/ssl-proxy.c:
	Don't log PUSH_ERRORs.
	[d638f42bf813]

	* src/imap/cmd-fetch.c, src/imap/cmd-store.c:
	updated error messages for FETCH/STORE when expunged messages were
	referenced. we use now exactly the same as rfc2180.
	[674d0067ea22]

	* src/lib-index/Makefile.am, src/lib-index/mail-messageset.c, src/lib-
	index/mail-messageset.h, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-messageset.c, src/lib-storage/index/index-
	messageset.h, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c:
	Moved lib-index/mail-messageset.* to lib-storage/index/index-
	messageset.*.
	[4716cf66c2cc]

	* src/lib-index/mail-messageset.c:
	Put back the "not all messages were found" error to
	mail_index_uidset_foreach(). Now it's only sent when they weren't
	found because they were just expunged and client wasn't notified
	yet, not when they don't exist anymore.
	[00e52ea54ed4]

	* src/lib-mail/message-parser.c:
	Don't strip extra spaces after "field: ".
	[53e8e405266b]

	* src/lib-imap/imap-envelope.c:
	Convert 8bit text in headers to quoted-printable in ENVELOPE.
	[bf5adc969d86]

2002-09-06  Timo Sirainen  <tss@iki.fi>

	* doc/multiaccess.txt:
	typofix
	[99a150cfc4e5]

	* src/lib-storage/index/index-save.c:
	minor cleanup
	[69b87c03ea8c]

	* src/lib-storage/index/index-save.c:
	comment update
	[628b12562e4b]

	* src/imap/client.c, src/lib-storage/index/index-save.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h:
	Added io_buffer_read_blocking() which can be used to read data
	blockingly, but with a specified timeout. Client fds are now
	nonblocking and use it with APPEND fixing a possible infinite wait
	if client didn't send any data.
	[2660a5684515]

	* src/lib-index/mbox/mbox-index.c:
	comment cleanup
	[aeb4e8d48aa2]

	* src/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h:
	continuing mbox updates
	[ad47775241a6]

	* src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h:
	Whops, didn't compile :) Removed beginning of wrong way to fix
	custom flags.
	[b045148bf408]

	* src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-index/mail-index-update.c, src/lib-index/mail-
	index-util.c, src/lib-index/mail-index-util.h, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-modifylog.c,
	src/lib-index/mbox/Makefile.am, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	msgcache.c, src/lib-storage/index/index-save.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/mbox/mbox-
	storage.c:
	Bigger changes.. full_virtual_size was removed from index record and
	MessagePart caching is now forced. Also added per-message flags,
	including binary flags which can be used to check if CRs need to be
	inserted into message data.

	Added mbox-rewrite support which can be used to write out mbox file
	with updated flags. This still has the problem of being able to read
	changed custom flags, that'll require another bigger change.

	There's also several other mostly mbox related fixes.
	[ff05b320482c]

	* src/lib/network.c:
	net_accept() set listening socket nonblocking, not the new socket.
	thanks to james.antill@redhat.com for noticing.
	[e0193106a95d]

2002-09-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	Flush output buffer to client at exit, and send a nice "BYE Server
	shutting down." message when we're being killed.
	[a1204e882bc7]

	* src/lib-index/mail-messageset.c:
	Allow UID messageset traversal to go past the synced messages.
	[2800791d1b31]

	* src/lib-storage/index/index-expunge.c:
	also, it shouldn't crash :)
	[e083f01122bb]

	* src/lib-storage/index/index-expunge.c:
	EXPUNGE shouldn't do "internal error" when there's nothing to
	expunge..
	[fd9bd2f01a75]

	* src/lib/iobuffer.c:
	io_buffer_send_iobuffer() was buggy with non-sendfile() method.
	[2dcabe0fd1cb]

2002-09-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c, src/lib/iobuffer.c:
	message_parse_header() was buggy with big headers, and
	io_buffer_read_data() should have returned the data so far even if
	it overflowed.
	[9660df1ca44f]

	* src/lib-storage/index/index-fetch-section.c:
	FETCH BODY[HEADER.FIELDS ...] wasn't working
	[7e1f18c5d708]

	* src/lib-index/mail-hash.c, src/lib-index/mail-hash.h, src/lib-index
	/mail-index-compress.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h:
	s/updateid/sync_id/ like it was with modify log.
	[e0f995ee5969]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h:
	index wasn't re-mmap()ed when it's size was changed. this is now
	done by updating "updateid" field in header and checking if it has
	changed. also the previous hash-rebuild-check was broken.
	[cb05d392ad24]

	* src/lib-index/mail-index.c:
	make sure the hash gets rebuilt if it wasn't opened yet when message
	was being expunged (probably unnecessary)
	[e1a810a57d4e]

	* src/lib-index/mail-messageset.c:
	mail_index_uidset_foreach() bugfix/cleanup for handling deleted
	messages
	[00b6ffc4d342]

	* src/lib-index/mail-index-compress.c:
	Hash wasn't updated when compressing the index
	[e35df75f639d]

	* src/lib-index/mail-index.c, src/lib-index/mail-messageset.c:
	more verbose error messages for hash corruption
	[124856b82684]

	* src/lib-index/mail-index.c:
	mail_index_mark_flag_changes() didn't update deleted-flag changes if
	there were seen-flag changes..
	[dd4c983dd0aa]

	* src/lib-index/mail-messageset.c:
	mail_index_uidset_foreach() still sometimes returned "Some messages
	weren't found".
	[b03fd5ed8ad1]

	* src/login/client.c:
	always use nonblocking I/O
	[0bb796d35d2a]

	* src/lib-storage/index/index-expunge.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/mbox/mbox-expunge.c:
	index_expunge_seek_first() now separates between "not found" and
	"failure". also updated it's error message to be more verbose.
	[524e78f870a2]

	* src/login/ssl-proxy.c:
	don't warn about UNEXPECTED_PACKET_LENGTH errors in SSL, they just
	mean the connection was dropped.
	[4d657b92448f]

	* src/lib-index/mail-messageset.c:
	mail_index_uidset_foreach() now never replies with "some messages
	weren't read". that's mostly a problem with non-UID fetches and a
	bit annoying to handle if last message was expunged.
	[f62c2eee1fa8]

	* src/lib-index/mail-index.c, src/lib-index/mail-messageset.c:
	verify that mail_hash_lookup_uid() returns offset to correct record.
	[71246aeb262d]

	* src/lib-storage/index/maildir/maildir-storage.c:
	more INBOX-sensitivity fixes
	[945063e0fb85]

2002-09-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	"CREATE Inbox.sub" created it using that case, instead of
	"INBOX.sub" which caused trouble.
	[5b631c4f95a1]

	* src/imap/commands-util.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c:
	"Mailbox doesn't exist" error now gives the name of the mailbox that
	was tried to be accessed.
	[899ea73710fc]

	* src/lib-index/mail-modifylog.c:
	"revert back to shared lock" actually tried to set exclusive lock
	again
	[24c8fcb78e0e]

	* src/lib-index/mail-messageset.c:
	messageset traversal: if user function requested stop, we leaked
	t_pop().
	[2ec94f1bf60b]

	* src/lib/iobuffer.c, src/lib/iobuffer.h:
	s/io_buffer_send_buf/io_buffer_send_iobuffer/, also we set buf_errno
	when send or receiving fails, which can be checked later.
	[788d8536ee18]

	* src/lib-index/mail-hash.c:
	mail_hash_rebuild() now tries to lock itself, fixing crash if trying
	to rebuild hash when opening index
	[4dc5d31e2282]

	* src/lib-mail/message-send.c:
	Removed buffering, it's done by io_buffer_send() now.
	[4dd31e34e72f]

	* src/lib-index/mail-modifylog.c:
	mail_modifylog_try_lock() didn't check for EAGAIN error.
	[c2ec223e37ba]

	* src/lib-imap/imap-parser.c:
	because the iobuffer is now buffered, the "+ OK" continuation
	request wasn't actually sent to client .. we flush it now.
	[ed1c4a141118]

	* src/lib-index/mail-index.h:
	update
	[879dcb6e209a]

	* src/lib-index/mail-index.c, src/lib-index/maildir/maildir-build.c,
	src/lib-index/mbox/mbox-append.c:
	previous fix for updating initial message flags wasn't done
	correctly
	[90a604e78df1]

	* src/lib-index/mail-index.c, src/lib-index/maildir/maildir-build.c,
	src/lib-index/mbox/mbox-append.c:
	Flags for new messages weren't set properly, so the header sum
	counters were wrong.
	[cf7de0db6ba8]

	* src/lib-storage/index/index-copy.c:
	COPY was broken.
	[2c641eb4324b]

	* src/lib-storage/index/index-save.c:
	cleanups
	[0d18820ea7af]

	* src/lib-index/mail-messageset.c:
	If we notice hash corruption, we can't rebuild it because we're
	holding shared lock, not exclusive.. So, just fail and mark it to be
	rebuilt later.
	[8d07a46abfdd]

2002-09-02  Timo Sirainen  <tss@iki.fi>

	* src/lib/iobuffer.c:
	If we're corked, try to buffer the data instead of immediately
	trying to write it. But is less syscalls faster than memcpy()ing?..
	[9b87ee7cc19f]

	* src/lib-storage/index/maildir/maildir-save.c:
	APPEND always saved mails to INBOX with maildir.
	[f9522c8629b8]

	* src/lib-imap/imap-date.c:
	IMAP date+time parser bugfix
	[82f566bc9d85]

	* src/imap/cmd-append.c, src/lib-imap/Makefile.am, src/lib-imap/imap-
	date.c, src/lib-imap/imap-date.h, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-search.c:
	Whops, we were using RFC822 dates everywhere instead of IMAP dates.
	[2f67de235489]

	* src/lib-mail/rfc822-date.c:
	timezone check was wrong
	[8abce0f7d065]

	* src/imap/cmd-append.c, src/lib-storage/index/index-save.c:
	APPEND was broken.
	[97d0b9fcc18a]

	* src/lib/write-full.c:
	write_full(): behave correctly if given size was 0.
	[b1d05f79758f]

	* src/lib-index/mail-modifylog.c:
	fixes for modifylog opening
	[91e5141f994c]

	* src/lib-storage/index/index-storage.c:
	Reset index error message after it's been moved to storage.
	[0c3ffb677ad1]

	* src/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-storage/index/index-msgcache.c:
	forgot to add before
	[76a3a6c0c452]

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/message-parser.c,
	src/lib-mail/rfc822-address.c, src/lib-mail/rfc822-tokenize.c, src
	/lib-mail/rfc822-tokenize.h:
	Fixed rfc822_tokens_get_value(). It doesn't have "put spaces around
	all tokens" option anymore, but instead spaces are always put
	between atoms. This should fix address fields with non-7bit charset.
	[d6105a8a6ca9]

	* src/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h:
	avoid sending extra spaces in FETCH reply.
	[8a9c6b71761f]

	* src/lib-index/mail-index.c:
	index->lookup_uid_range() optimization for first_uid <= first UID in
	mailbox.
	[63cd510c6598]

	* src/lib-storage/index/index-search.c:
	specifying messageset/uidset in SEARCH broke it
	[27fd7817b226]

	* src/lib-index/mail-index-update.c:
	when we figure out we should cache old body/bodystructure, use
	preparsed MessagePart from FIELD_TYPE_MESSAGEPART if it's already
	there.
	[eb0659c9841e]

	* src/lib/fdpass.c:
	removed useless (void *) cast.
	[e2fe8921e8ad]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-message-
	cache.c, src/lib-imap/imap-message-cache.h, src/lib-index/mail-
	index-update.c, src/lib-index/mail-index.h, src/lib-
	mail/Makefile.am, src/lib-mail/message-parser.c, src/lib-mail
	/message-parser.h, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/index-fetch-section.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h:
	Added support for caching of MessagePart data. This is useful for
	fetching body[part]s. Also BODY and BODYSTRUCTURE can be generated
	fast using it.

	Also fixed index corruption in some situations when more cached data
	was added to index.
	[5fe3e04ca8d9]

2002-09-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/message-parser.c,
	src/lib-mail/message-parser.h, src/lib-storage/index/index-fetch-
	section.c:
	there was no need for MessagePart->pos.virtual_pos, so removed it.
	[31034993473c]

2002-08-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-index.c, src/lib-index/mbox/mbox-append.c, src
	/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-open.c, src
	/lib-index/mbox/mbox-sync.c:
	added index->lookup_field_raw() and update_field_raw(), changed mbox
	to save the offsets in raw uoff_t instead of hex encoded.
	[a6d7ed739926]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index.c:
	Fixed some index rebuilding behaviour.
	[08186ac2784e]

	* src/lib-index/mail-index.c:
	".log.2" is also possible index file.
	[fc3383ac21a9]

	* dovecot-example.conf, src/lib-index/mail-index.c, src/lib-
	storage/index/maildir/maildir-list.c, src/master/imap-process.c,
	src/master/settings.c, src/master/settings.h:
	Added overwrite_incompatible_index setting. Also we now try to use
	only .imap.index-<hostname> and .imap.index index files instead of
	scanning the dir for any compatible index. This also fixes (partly)
	LIST giving \Marked flag when there's no new mails.
	[edc37d046b08]

2002-08-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-select.c, src/lib-storage/flags-file/flags-file.c, src
	/lib-storage/index/index-status.c, src/lib-storage/mail-storage.h:
	Custom flags are now shown in FLAGS and PERMANENTFLAGS lists after
	SELECT. It also warns if there's for some reason a duplicate index
	number in custom flags file.
	[867ec80dbf42]

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.c, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-sync.c:
	Initial message flags weren't set from file name in maildir folders
	when new mail was added (or when index was built first time).
	[352c2567ba11]

	* src/login/client-authenticate.c:
	disable_plaintext_auth=yes didn't allow them even with TLS/SSL
	connections.
	[bac5a44da22b]

	* src/imap/cmd-list.c:
	Don't send \Children or \NoChildren flags for LIST anymore, we never
	supported the CHILDREN draft properly, and it's not becoming
	standard anyway. Get it back in when/if we add support for LISTEXT
	draft.
	[6f837354f2fe]

	* NEWS, TODO, configure.in:
	0.97 released
	[fb7500933a11]

	* src/lib-imap/imap-message-cache.c:
	allow 0 sized body
	[d0a9a516f00f]

	* src/lib-index/mail-messageset.c:
	added t_push() + t_pop() around the foreach-function call.
	[afa320f00439]

	* src/lib-index/mbox/mbox-open.c:
	mbox_open_mail() was buggy
	[858984f26cf8]

	* src/lib/iobuffer.c:
	warn if io_buffer_create_mmap() contains invalid size parameter
	[a73e43fa20e0]

	* src/lib-index/mail-index.c:
	bugfix for sync fix
	[dc0891523276]

	* src/lib-index/mail-modifylog.c:
	mail_modifylog_mark_synced() didn't update mmap
	[ccb155c2c93f]

	* src/lib-index/mail-index.c:
	reset modifylog sync mark at the end of opening index file
	[616d71338d52]

	* src/lib-index/mbox/mbox-fsck.c:
	mbox fix
	[20e979ad0b6d]

	* src/lib-index/mbox/mbox-index.c:
	fix
	[18f0d0952a7d]

	* src/lib-index/mbox/mbox-fsck.c:
	mbox fsck fixes
	[73e79cf8f496]

	* src/lib-index/mbox/mbox-sync.c:
	mbox fixes
	[5a4d07a88a8e]

	* src/lib/iobuffer.c:
	just removed useles line of code
	[954aadb2b2c2]

	* src/lib-index/mail-index.c:
	last_lookup wasn't reset after mmap(). still feels somewhat buggy
	though..
	[a437489953da]

2002-08-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-append.c:
	maybe now?
	[438d5f258b01]

	* src/lib-index/mbox/mbox-append.c:
	fixes..
	[1dfa3c9d60ef]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-sync.c:
	more fixes
	[2876947b8d38]

	* src/lib-index/mbox/mbox-append.c:
	more fix fixes (maybe i should test these before committing :)
	[d1407cb2b39b]

	* src/lib-index/mbox/mbox-append.c:
	yet more mbox fix fixes
	[0d8bfff71b80]

	* src/lib-index/mbox/mbox-open.c:
	fix to previous mbox fix :)
	[51b449a2a56b]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-sync.c:
	mbox fixes
	[8035cf09b913]

	* src/lib/iobuffer.c:
	IOBuffer was buggy if start_offset wasn't 0
	[7418fefb57a8]

	* src/lib-index/mbox/mbox-sync.c:
	Don't fsck mbox every time it's opened.
	[d6ab9aa7e105]

	* src/lib-index/mbox/mbox-lock.c:
	Notify if waiting for release of mbox dotlock failed.
	[2841fc79578f]

	* src/lib/mempool-alloconly.c, src/lib/temp-mempool.c:
	Still memaligns
	[c081870db35c]

	* src/lib/temp-mempool.c:
	More alignment fixes
	[12746cf2e447]

	* src/login/client-authenticate.c:
	crashfix
	[0e58a036265e]

	* src/lib-index/mail-hash.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h:
	MailHashHeader is now 8-byte aligned. Fixed other header alignments
	too and stored MEM_ALIGN_SIZE into compat_data[].
	[8cef827d2d79]

	* src/lib/strfuncs.c:
	t_strsplit(): bad typobug..
	[9381df54c9c3]

	* src/lib/mempool-alloconly.c, src/lib/mempool-system.c:
	Allocated memory wasn't aligned according to MEM_ALIGN_SIZE.
	[b28ac4106d5a]

	* src/lib-storage/index/index-search.c:
	wrong assert()s :)
	[f239e9a2c96c]

	* configure.in:
	added -Wcast-qual to list of "remember to test with" cflags :)
	[168e0bd616b6]

	* src/auth/auth-digest-md5.c, src/auth/cookie.c, src/auth/userinfo-
	passwd.c, src/auth/userinfo-shadow.c, src/imap/cmd-fetch.c,
	src/imap/commands.c, src/lib/network.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/login/client-authenticate.c:
	added t_strdup_noconst() which can be used instead of (char *)
	t_strdup(). Removed several castings that removed the const
	qualifier.
	[83ae914a583a]

	* src/lib/iobuffer.c, src/lib/strfuncs.c:
	casting fixes
	[8740373ee20e]

	* src/lib/randgen.c, src/lib/randgen.h:
	removed const attribute from buffer argument for random_fill(), that
	really shouldn't have been there..
	[4bcf3ff12c60]

	* TODO:
	updated
	[2ffff61ee5e1]

	* configure.in, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h:
	Use 8 byte memory alignment by default. Also fixed index headers a
	bit to be 8 byte aligned.
	[4ecb78d94182]

	* src/lib/hash.c, src/lib/temp-mempool.c:
	Don't include system headers before lib.h, since config.h may change
	their behaviour (64bit off_t)
	[296c6dbf50a5]

	* src/lib/Makefile.am, src/lib/iobuffer.c, src/lib/sendfile-util.c,
	src/lib/sendfile-util.h:
	sendfile() works now properly with 64bit off_t
	[8aaa39e7aec8]

	* src/lib/lib.h:
	config.h should be included first.
	[2d2e2594e60f]

	* configure.in, src/lib/compat.h, src/lib/iobuffer.c, src/lib/lib.h,
	src/lib/strfuncs.h:
	64bit off_t fixes
	[62fc6c729962]

	* configure.in:
	whops, 64bit support was disabled.
	[db8ea2c11ab7]

	* src/login/ssl-proxy.c:
	Last changes broke SSL. Also handshaking is now non-blocking.
	[71fc142c2d7b]

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index.c:
	bugfixes for overflow checks :)
	[37a388fe4dab]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-storage/index/index-expunge.c, src
	/lib-storage/index/index-status.c, src/lib-storage/index/index-
	sync.c:
	More overflow fixes.
	[d5f0f634b86e]

	* src/lib-storage/index/index-search.c:
	Some cleanups, assertion fixes.
	[b4adc3429867]

2002-08-27  Timo Sirainen  <tss@iki.fi>

	* acconfig.h, configure.in, src/imap/cmd-fetch.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	message-cache.c, src/lib-imap/imap-message-cache.h, src/lib-imap
	/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-index/mail-
	hash.c, src/lib-index/mail-hash.h, src/lib-index/mail-index-
	compress.c, src/lib-index/mail-index-data.c, src/lib-index/mail-
	index-data.h, src/lib-index/mail-index-fsck.c, src/lib-index/mail-
	index-update.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-messageset.c, src/lib-index/mail-
	modifylog.c, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c, src/lib-
	index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-sync.c, src/lib-
	mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-mail/message-
	size.c, src/lib-mail/message-size.h, src/lib-storage/flags-file
	/flags-file.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-save.c, src
	/lib-storage/index/index-search.c, src/lib-storage/mail-storage.h,
	src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib/lib.h,
	src/lib/strfuncs.c, src/lib/temp-string.c, src/master/main.c:
	Introduced uoff_t which is the unsigned-equilevant of off_t. This
	was needed to be able to handle off_t overflows properly. Also
	changed a few unsigned int fields into uoff_t so we should now
	support >2G mails if uoff_t is 64bit. Also fixed several potential
	integer overflows.
	[d493b9cc265e]

	* src/lib-mail/rfc822-date.c:
	Year was set wrong in date parser. We'll also now do full checking
	for date string to make sure we don't overflow/underflow anything.
	[6be018ca51ef]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index-
	data.c, src/lib-index/mail-index-data.h, src/lib-index/mail-index-
	update-cache.c, src/lib-index/mail-index.h:
	More cleanups / potential overflow fixes
	[5e9cf9565353]

	* src/lib-index/mail-messageset.c, src/lib-index/mail-messageset.h,
	src/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c:
	Errors in user-specified messagesets are now properly reported back
	to user.
	[306c20092a96]

	* src/lib-storage/index/index-search.c:
	fixes for messageset handling
	[b2bc8d2e56ff]

	* src/lib-index/mail-hash.c:
	Hash is now properly rebuilt if errors are noticed while opening it.
	[d8ff9a34ed03]

	* src/lib/hash.c, src/lib/primes.c, src/lib/primes.h:
	Changed behaviour of primes_closest() to return given number back if
	it's a prime itself.
	[e399e33d033d]

	* src/lib/mmap-util.c:
	Fail if we try to mmap() files larger than 2G fully to memory
	[526284657da7]

	* src/lib-index/mail-hash.c, src/lib-index/mail-hash.h:
	If hash file was rebuilt, other processes didn't notice that. Also
	added several extra checks to make sure we never overflow anything
	unexpectedly.
	[1ab58549429d]

	* src/login/auth-connection.c:
	"Authentication server isn't connected, try again later.." error is
	sent to user when imap-auth hasn't been connected to for some
	reason.
	[38681cf8c4cd]

	* src/login/auth-connection.c:
	Automatically try to reconnect imap-auths once in a second if any of
	them weren't connected properly. Immediate reconnection was also
	removed, so we don't eat all CPU now if imap-auth behaves badly.
	[1ba4156fe84f]

	* src/lib/iobuffer.c:
	io_buffer_send() was buggy
	[0757e34063ec]

	* src/login/ssl-proxy.c:
	removed warnings when SSL support is disabled.
	[2a56fca685a2]

	* src/login/client.c, src/login/main.c, src/login/ssl-proxy.c,
	src/login/ssl-proxy.h, src/master/main.c:
	Some fixes to checking if SSL should be used.
	[8b4c5ea7e6da]

	* src/master/main.c:
	imaps host was resolved wrong
	[2d6f60efa704]

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c,
	src/login/main.c, src/master/main.c, src/master/settings.c,
	src/master/settings.h:
	Added log_path and log_timestamp settings to config file. Removed -l
	command line option for imap-master.
	[b420373f88f6]

2002-08-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-pam.c, src/auth/userinfo-passwd-file.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-shadow.c, src/lib/network.c,
	src/master/imap-process.c:
	fixed compile warnings with some systems
	[a3d77e73f99b]

	* src/lib-index/mail-index.c:
	A bit better index file truncating: Truncate it also when first hole
	reaches to end of file, even if all messages weren't deleted.
	[148cdb150e64]

	* src/lib-index/mail-messageset.c:
	reset error message so we don't fail before we're looking at an old
	failure..
	[b7d7474cbcb2]

	* src/lib-index/mail-index.c:
	when all mail is deleted, truncate the index files.
	[33e86ee7d167]

	* src/lib-storage/index/mbox/mbox-save.c:
	Make sure mbox file ends with \n when appending new mail to it
	[8509281fda72]

	* TODO, src/lib-index/Makefile.am, src/lib-index/mail-hash.c, src/lib-
	index/mail-hash.h, src/lib-index/mail-index-compress.c, src/lib-
	index/mail-index-data.c, src/lib-index/mail-index-data.h, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-index/mail-
	modifylog.c, src/lib-storage/flags-file/flags-file.c, src/lib-
	storage/index/index-save.c, src/lib-storage/index/mbox/mbox-save.c,
	src/lib-storage/subscription-file/subscription-file.c,
	src/lib/Makefile.am, src/lib/write-full.c, src/lib/write-full.h:
	Added write_full() which is a simple wrapper around write() meant
	for writing into files.

	When there's too much deleted data in index files, they're now
	compressed when the index is being opened.
	[e9375147c0cb]

	* src/lib/fdpass.c:
	comment update
	[6ac07b3fe0ff]

	* dovecot-example.conf:
	default to PAM authentication
	[f182971ba39d]

2002-08-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Don't allow '\' character in mailbox name.
	[91e73c5bb8f3]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-update-cache.c,
	src/lib-index/mail-index-update.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/maildir/maildir-update.c, src
	/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c, src
	/lib-index/mbox/mbox-index.c, src/lib-storage/index/index-fetch.c:
	after a few times of trying to access uncached fields, they're
	cached the next time mailbox is opened. also some mbox fixes.
	[55e09f36d23d]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Don't allow using "../" anywhere in mailbox names.
	[e8de6f485c65]

2002-08-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-sync.c:
	mbox fixes, fsck and sync seems to work now.
	[6cefb1763f3e]

	* src/imap/main.c, src/lib-imap/imap-message-cache.c, src/lib-imap
	/imap-message-cache.h, src/lib-imap/imap-parser.c, src/lib-
	index/Makefile.am, src/lib-index/mail-index-update.c, src/lib-index
	/mail-index.h, src/lib-index/mbox/Makefile.am, src/lib-index/mbox
	/mbox-append.c, src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox
	/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-index/mbox
	/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox
	/mbox-sync.c, src/lib-storage/index/index-copy.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h,
	src/lib/iobuffer.c, src/lib/iobuffer.h:
	mbox fixes, not fully working yet but almost :)
	[a946ce1f09b7]

2002-08-23  Timo Sirainen  <tss@iki.fi>

	* COPYING, src/lib/md5.c, src/lib/md5.h:
	Replaced the MD5 implementation with Solar Designer's.
	[163675942b83]

	* src/lib/strfuncs.h:
	added MAX_LONG_STRLEN and ltoa() macro
	[df8438cd8a43]

	* src/lib/hex-binary.h:
	comment update
	[a766fb2132de]

	* TODO:
	updated
	[6491ac40cdf5]

	* src/lib-mail/message-send.c:
	bugfix
	[b4e760cf04c3]

	* src/lib-storage/index/index-fetch.c:
	call imap_message_close() at the end of FETCH, so no message files
	are left open.
	[3de6ef1b50cb]

	* src/lib-mail/message-send.c, src/lib-mail/message-send.h:
	message_send() buffers data now instead of making lots of write()
	calls, so it should be faster.
	[e01bf167b27c]

2002-08-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-allocfree.h:
	not needed
	[af70462f5ca1]

	* TODO, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h:
	"Critical errors" aren't displayed to users anymore, ie. anything
	that is not a predefined human readable error message is written
	into log file and user gets only "Internal error [timestamp]".
	[bb294faf7379]

	* src/lib-imap/Makefile.am, src/lib-imap/imap-message-send.c, src/lib-
	imap/imap-message-send.h, src/lib-mail/Makefile.am, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-storage/index
	/index-fetch-section.c, src/lib-storage/index/index-fetch.c:
	moved lib-imap/imap-message-send.* into lib-mail/message-send.*
	[a4423c83b2b0]

	* TODO:
	updated
	[e285afe55c48]

	* src/auth/auth-digest-md5.c, src/auth/auth-plain.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/cookie.c, src/auth/cookie.h, src/auth
	/login-connection.c, src/auth/main.c, src/auth/master.c,
	src/imap/client.c, src/imap/cmd-list.c, src/imap/cmd-store.c,
	src/imap/commands-util.c, src/lib-imap/imap-bodystructure.c, src
	/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-cache.h,
	src/lib-index/mail-index-update.c, src/lib-index/mail-index.h, src
	/lib-index/mail-messageset.c, src/lib-index/mail-messageset.h, src
	/lib-index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/flags-file/flags-file.c, src/lib-storage/flags-file/flags-
	file.h, src/lib-storage/index/index-copy.c, src/lib-storage/index
	/index-fetch-section.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-fetch.h, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-expunge.c, src/lib-storage/index/maildir/maildir-list.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	list.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-storage
	/mail-search.c, src/lib-storage/mail-search.h, src/lib-storage/mail-
	storage.h, src/lib-storage/subscription-file/subscription-file.c,
	src/lib-storage/subscription-file/subscription-file.h,
	src/lib/hash.c, src/lib/hash.h, src/lib/iobuffer.c,
	src/lib/iobuffer.h, src/lib/ioloop-internal.h, src/lib/ioloop-
	poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c, src/lib/ioloop.h,
	src/login/auth-connection.c, src/login/auth-connection.h, src/login
	/client-authenticate.c, src/login/client.c, src/login/client.h,
	src/login/main.c, src/login/master.c, src/login/master.h, src/login
	/ssl-proxy.c, src/master/auth-process.c, src/master/auth-process.h,
	src/master/login-process.c, src/master/main.c:
	s/user_data/context/ and some s/Data/Context/
	[82b7de533f98]

	* src/lib-imap/imap-message-cache.h, src/lib-mail/message-parser.c,
	src/lib-mail/message-parser.h, src/lib-mail/message-size.c,
	src/lib/iobuffer.c:
	fixes, seems to be somewhat working now.
	[21c8e080150d]

	* src/lib/strfuncs.c:
	added some extra asserts
	[2d8711a043a0]

	* src/lib-mail/message-parser.c:
	removed useless p_free() calls
	[5ce1e8ca79bb]

	* src/lib/mmap-util.c:
	mmap_aligned() was buggy
	[622e22c0486f]

	* configure.in, src/auth/auth-digest-md5.c, src/auth/login-
	connection.c, src/auth/userinfo-passwd-file.c, src/auth/userinfo.h,
	src/imap/client.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c, src
	/lib-imap/imap-bodystructure.c, src/lib-imap/imap-bodystructure.h,
	src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-imap/imap-message-send.c, src/lib-imap/imap-
	message-send.h, src/lib-imap/imap-parser.c, src/lib-
	index/Makefile.am, src/lib-index/mail-hash.c, src/lib-index/mail-
	index-data.c, src/lib-index/mail-index-fsck.c, src/lib-index/mail-
	index-update.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-modifylog.c, src/lib-index/maildir
	/maildir-build.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-sync.c, src/lib-index/maildir/maildir-
	update.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	fsck.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	index.h, src/lib-index/mbox/mbox-open.c, src/lib-index/mbox/mbox-
	sync.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	src/lib-storage/flags-file/flags-file.c, src/lib-storage/index
	/index-copy.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-save.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/lib-storage/subscription-file
	/subscription-file.c, src/lib/compat.c, src/lib/compat.h,
	src/lib/imem.c, src/lib/imem.h, src/lib/iobuffer.c,
	src/lib/iobuffer.h, src/lib/mmap-util.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/login/auth-connection.c,
	src/master/settings.c:
	Message data is parsed in blocks (no longer entirely mmap()ed).
	Several IOBuffer changes. All mixed signed/unsigned comparisions
	were fixed so code can now be compiled with gcc's -W flag. mbox
	support is broken currently, and there's most likely several other
	problems too.
	[1b34ec11fff8]

2002-08-13  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-allocfree.c:
	not needed
	[744588369401]

2002-08-09  Timo Sirainen  <tss@iki.fi>

	* NEWS:
	moved ChangeLog into NEWS, ChangeLog will contain CVS changes now
	[d2c29e0e2570]

	* src/lib-storage/.cvsignore:
	updated
	[3b288990eb37]

	* COPYING, src/lib-storage/Makefile.am:
	fixes
	[6d0a30d1197c]

	* .cvsignore, .inslog2, AUTHORS, COPYING.LGPL, Makefile.am, NEWS,
	README, TODO, acconfig.h, autogen.sh, configure.in, doc/.cvsignore,
	doc/Makefile.am, doc/auth.txt, doc/design.txt, doc/index.txt,
	doc/multiaccess.txt, doc/nfs.txt, dovecot-example.conf,
	src/.cvsignore, src/Makefile.am, src/auth/.cvsignore,
	src/auth/Makefile.am, src/auth/auth-digest-md5.c, src/auth/auth-
	interface.h, src/auth/auth-plain.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/common.h, src/auth/cookie.c,
	src/auth/cookie.h, src/auth/login-connection.c, src/auth/login-
	connection.h, src/auth/main.c, src/auth/master.c, src/auth/userinfo-
	pam.c, src/auth/userinfo-passwd-file.c, src/auth/userinfo-passwd.c,
	src/auth/userinfo-passwd.h, src/auth/userinfo-shadow.c,
	src/auth/userinfo.c, src/auth/userinfo.h, src/imap/.cvsignore,
	src/imap/.psrc, src/imap/Makefile.am, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-append.c, src/imap/cmd-
	authenticate.c, src/imap/cmd-capability.c, src/imap/cmd-check.c,
	src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-delete.c, src/imap/cmd-examine.c, src/imap/cmd-
	expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c, src/imap/cmd-
	login.c, src/imap/cmd-logout.c, src/imap/cmd-lsub.c, src/imap/cmd-
	noop.c, src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap/cmd-
	select.c, src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-
	subscribe.c, src/imap/cmd-uid.c, src/imap/cmd-unsubscribe.c,
	src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.c, src/imap/commands.h, src/imap/common.h,
	src/imap/main.c, src/lib-imap/.cvsignore, src/lib-imap/Makefile.am,
	src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	envelope.h, src/lib-imap/imap-match.c, src/lib-imap/imap-match.h,
	src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-imap/imap-message-send.c, src/lib-imap/imap-
	message-send.h, src/lib-imap/imap-parser.c, src/lib-imap/imap-
	parser.h, src/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src
	/lib-index/.cvsignore, src/lib-index/Makefile.am, src/lib-index
	/mail-hash.c, src/lib-index/mail-hash.h, src/lib-index/mail-index-
	data.c, src/lib-index/mail-index-data.h, src/lib-index/mail-index-
	fsck.c, src/lib-index/mail-index-update.c, src/lib-index/mail-index-
	util.c, src/lib-index/mail-index-util.h, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h, src/lib-index/mail-lockdir.c, src/lib-
	index/mail-lockdir.h, src/lib-index/mail-messageset.c, src/lib-index
	/mail-messageset.h, src/lib-index/mail-modifylog.c, src/lib-index
	/mail-modifylog.h, src/lib-index/maildir/.cvsignore, src/lib-
	index/maildir/Makefile.am, src/lib-index/maildir/maildir-build.c,
	src/lib-index/maildir/maildir-index.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-open.c, src/lib-
	index/maildir/maildir-rebuild.c, src/lib-index/maildir/maildir-
	sync.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/.cvsignore, src/lib-index/mbox/Makefile.am, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-fsck.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-lock.h, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	index/mbox/mbox-sync.c, src/lib-mail/.cvsignore, src/lib-
	mail/Makefile.am, src/lib-mail/message-content-parser.c, src/lib-
	mail/message-content-parser.h, src/lib-mail/message-parser.c, src
	/lib-mail/message-parser.h, src/lib-mail/message-size.c, src/lib-
	mail/message-size.h, src/lib-mail/rfc822-address.c, src/lib-
	mail/rfc822-address.h, src/lib-mail/rfc822-date.c, src/lib-
	mail/rfc822-date.h, src/lib-mail/rfc822-tokenize.c, src/lib-
	mail/rfc822-tokenize.h, src/lib-storage/.cvsignore, src/lib-
	storage/Makefile.am, src/lib-storage/flags-file/.cvsignore, src/lib-
	storage/flags-file/Makefile.am, src/lib-storage/flags-file/flags-
	file.c, src/lib-storage/flags-file/flags-file.h, src/lib-
	storage/index/.cvsignore, src/lib-storage/index/Makefile.am, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-fetch.h,
	src/lib-storage/index/index-save.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/.cvsignore, src
	/lib-storage/index/maildir/Makefile.am, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-expunge.c, src/lib-storage/index/maildir/maildir-list.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/.cvsignore, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-search.c, src/lib-storage/mail-search.h, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h, src/lib-
	storage/subscription-file/.cvsignore, src/lib-storage/subscription-
	file/Makefile.am, src/lib-storage/subscription-file/subscription-
	file.c, src/lib-storage/subscription-file/subscription-file.h,
	src/lib/.cvsignore, src/lib/Makefile.am, src/lib/base64.c,
	src/lib/base64.h, src/lib/compat.c, src/lib/compat.h,
	src/lib/failures.c, src/lib/failures.h, src/lib/fdpass.c,
	src/lib/fdpass.h, src/lib/gmtoff.c, src/lib/gmtoff.h,
	src/lib/hash.c, src/lib/hash.h, src/lib/hex-binary.c, src/lib/hex-
	binary.h, src/lib/hostpid.c, src/lib/hostpid.h, src/lib/imem.c,
	src/lib/imem.h, src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib
	/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-select.c,
	src/lib/ioloop.c, src/lib/ioloop.h, src/lib/lib-signals.c, src/lib
	/lib-signals.h, src/lib/lib.c, src/lib/lib.h, src/lib/macros.h,
	src/lib/md5.c, src/lib/md5.h, src/lib/mempool-allocfree.c, src/lib
	/mempool-allocfree.h, src/lib/mempool-alloconly.c, src/lib/mempool-
	system.c, src/lib/mempool.c, src/lib/mempool.h, src/lib/mmap-util.c,
	src/lib/mmap-util.h, src/lib/network.c, src/lib/network.h,
	src/lib/primes.c, src/lib/primes.h, src/lib/randgen.c,
	src/lib/randgen.h, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/lib/strfuncs.c, src/lib/strfuncs.h, src/lib/temp-
	mempool.c, src/lib/temp-mempool.h, src/lib/temp-string.c, src/lib
	/temp-string.h, src/lib/unlink-directory.c, src/lib/unlink-
	directory.h, src/lib/unlink-lockfiles.c, src/lib/unlink-lockfiles.h,
	src/login/.cvsignore, src/login/.psrc, src/login/Makefile.am,
	src/login/auth-connection.c, src/login/auth-connection.h, src/login
	/client-authenticate.c, src/login/client-authenticate.h,
	src/login/client.c, src/login/client.h, src/login/common.h,
	src/login/main.c, src/login/master.c, src/login/master.h, src/login
	/ssl-proxy.c, src/login/ssl-proxy.h, src/master/.cvsignore,
	src/master/.psrc, src/master/Makefile.am, src/master/auth-process.c,
	src/master/auth-process.h, src/master/common.h, src/master/imap-
	process.c, src/master/login-process.c, src/master/login-process.h,
	src/master/main.c, src/master/master-interface.h,
	src/master/settings.c, src/master/settings.h, stamp.h.in:
	Initial revision
	[3b1985cbc908]

