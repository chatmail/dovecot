From a75e9af4dd58036e7e63af14bf21df5fc335d639 Mon Sep 17 00:00:00 2001
From: Timo Sirainen <timo.sirainen@open-xchange.com>
Date: Mon, 17 Aug 2020 18:33:20 +0300
Subject: [PATCH 1/2] imap: Escape tag when sending it to imap-hibernate
 process

---
 src/imap/imap-client-hibernate.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

Index: dovecot/src/imap/imap-client-hibernate.c
===================================================================
--- dovecot.orig/src/imap/imap-client-hibernate.c
+++ dovecot/src/imap/imap-client-hibernate.c
@@ -89,8 +89,10 @@ static void imap_hibernate_write_cmd(str
 		str_printfa(cmd, "\tuid=%s", dec2str(user->uid));
 	if (user->gid != (gid_t)-1)
 		str_printfa(cmd, "\tgid=%s", dec2str(user->gid));
-	if (tag != NULL)
-		str_printfa(cmd, "\ttag=%s", tag);
+	if (tag != NULL) {
+		str_append(cmd, "\ttag=");
+		str_append_tabescaped(cmd, tag);
+	}
 	str_append(cmd, "\tstats=");
 	str_append_tabescaped(cmd, client_stats(client));
 	if (client->command_queue != NULL &&
