From 4640109c9c7a58a7d42931ee7e829c4f98f3b5a7 Mon Sep 17 00:00:00 2001
From: Timo Sirainen <timo.sirainen@open-xchange.com>
Date: Tue, 31 Aug 2021 12:08:32 +0300
Subject: [PATCH 1/3] indexer: Use a separate indexer_queue_callback_t type for
 indexer-queue callback

---
 src/indexer/indexer-queue.c | 4 ++--
 src/indexer/indexer-queue.h | 4 +++-
 2 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/src/indexer/indexer-queue.c b/src/indexer/indexer-queue.c
index bc7718791f..e0239a351a 100644
--- a/src/indexer/indexer-queue.c
+++ b/src/indexer/indexer-queue.c
@@ -7,7 +7,7 @@
 #include "indexer-queue.h"
 
 struct indexer_queue {
-	indexer_status_callback_t *callback;
+	indexer_queue_callback_t *callback;
 	void (*listen_callback)(struct indexer_queue *);
 
 	/* username+mailbox -> indexer_request */
@@ -29,7 +29,7 @@ static int indexer_request_cmp(const struct indexer_request *r1,
 }
 
 struct indexer_queue *
-indexer_queue_init(indexer_status_callback_t *callback)
+indexer_queue_init(indexer_queue_callback_t *callback)
 {
 	struct indexer_queue *queue;
 	
diff --git a/src/indexer/indexer-queue.h b/src/indexer/indexer-queue.h
index fe56829faa..a9d5b9d1e7 100644
--- a/src/indexer/indexer-queue.h
+++ b/src/indexer/indexer-queue.h
@@ -3,6 +3,8 @@
 
 #include "indexer.h"
 
+typedef void indexer_queue_callback_t(int status, void *context);
+
 struct indexer_request {
 	struct indexer_request *prev, *next;
 
@@ -30,7 +32,7 @@ struct indexer_request {
 	ARRAY(void *) contexts;
 };
 
-struct indexer_queue *indexer_queue_init(indexer_status_callback_t *callback);
+struct indexer_queue *indexer_queue_init(indexer_queue_callback_t *callback);
 void indexer_queue_deinit(struct indexer_queue **queue);
 
 /* The callback is called whenever a new request is added to the queue. */
-- 
GitLab


